# 영수증 관리 시스템

HANSL 구매 관리 시스템의 영수증 관리 모듈입니다.

## 📋 기능 개요

### 핵심 기능
- **영수증 업로드**: 이미지 파일 업로드 (drag & drop 지원)
- **영수증 조회**: 목록 조회, 상세보기, 검색 및 필터링
- **영수증 다운로드**: 원본 이미지 파일 다운로드
- **영수증 인쇄**: 브라우저 인쇄 기능
- **영수증 삭제**: 권한 기반 삭제 기능

### 권한 시스템
| 권한 | 접근 | 업로드 | 다운로드 | 인쇄 | 삭제 | 등록인 조회 |
|------|------|--------|----------|------|------|-------------|
| `app_admin` | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| `hr` | ✅ | ✅ | ✅ | ✅ | ❌ | ❌ |
| `lead buyer` | ✅ | ✅ | ✅ | ✅ | ❌ | ❌ |
| 기타 | ❌ | ❌ | ❌ | ❌ | ❌ | ❌ |

## 🏗️ 아키텍처

### 컴포넌트 구조
```
📁 receipts/
├── 📄 ReceiptsMain.tsx          # 메인 페이지 (목록, 검색, 필터)
├── 📄 ReceiptDetailModal.tsx    # 상세보기 모달 (이미지 뷰어)
├── 📄 ReceiptUploadModal.tsx    # 업로드 모달
├── 📄 MobileReceiptCard.tsx     # 모바일 카드 컴포넌트
└── 📄 README.md                 # 이 문서
```

### 관련 파일들
```
📁 hooks/
└── 📄 useReceiptPermissions.ts  # 권한 관리 훅

📁 types/
└── 📄 receipt.ts                # 타입 정의

📁 utils/
└── 📄 receipt.ts                # 유틸리티 함수들
```

## 🔧 주요 컴포넌트

### ReceiptsMain
메인 페이지 컴포넌트로 다음 기능을 제공합니다:
- 영수증 목록 표시 (데스크톱: 테이블, 모바일: 카드)
- 검색 및 날짜 필터링
- 권한 기반 UI 표시 제어
- 영수증 업로드, 다운로드, 인쇄, 삭제

### ReceiptDetailModal
전체 화면 이미지 뷰어 모달:
- 이미지 확대/축소/회전
- 동적 이미지 크기 최적화
- 인쇄 및 다운로드 기능
- 권한 기반 삭제 버튼

### ReceiptUploadModal
파일 업로드 모달:
- Drag & Drop 지원
- 파일 유효성 검사 (타입, 크기)
- 메모 추가 기능
- 업로드 진행 상태 표시

## 🛠️ 사용된 기술

### 프론트엔드
- **React 18**: 함수형 컴포넌트, Hooks
- **TypeScript**: 타입 안전성
- **Tailwind CSS**: 스타일링
- **shadcn/ui**: UI 컴포넌트 라이브러리
- **Lucide React**: 아이콘
- **Sonner**: 토스트 알림

### 백엔드 & 스토리지
- **Supabase**: 데이터베이스 및 스토리지
- **Supabase Storage**: 이미지 파일 저장

## 📊 데이터베이스 스키마

### purchase_receipts 테이블
| 컬럼 | 타입 | 설명 |
|------|------|------|
| `id` | UUID | 기본키 |
| `receipt_image_url` | TEXT | 이미지 URL |
| `file_name` | TEXT | 파일명 |
| `file_size` | INTEGER | 파일 크기 (bytes) |
| `uploaded_by` | TEXT | 업로더 이메일 |
| `uploaded_by_name` | TEXT | 업로더 이름 |
| `uploaded_at` | TIMESTAMP | 업로드 시간 |
| `memo` | TEXT | 메모 (선택) |
| `purchase_request_id` | INTEGER | 구매요청 ID (선택) |
| `item_id` | INTEGER | 구매항목 ID (선택) |

## 🚀 성능 최적화

### React 최적화
- **useCallback**: 함수 메모이제이션
- **useMemo**: 계산 결과 메모이제이션
- **Lazy Loading**: 컴포넌트 지연 로딩

### 이미지 최적화
- 동적 이미지 크기 계산
- 이미지 로드 상태 관리
- 메모리 효율적인 이미지 처리

### 네트워크 최적화
- 권한 기반 조건부 로딩
- 효율적인 Supabase 쿼리
- 파일 업로드 최적화

## 🔒 보안 고려사항

### 파일 업로드 보안
- 파일 타입 검증 (이미지만 허용)
- 파일 크기 제한 (10MB)
- 안전한 파일명 생성

### 권한 관리
- 서버사이드 권한 검증
- UI 레벨 권한 제어
- 민감한 정보 접근 제한

### 데이터 보호
- SQL 인젝션 방지
- XSS 공격 방지
- 안전한 파일 다운로드

## 🎯 사용자 경험 (UX)

### 접근성
- 키보드 네비게이션 지원
- 스크린 리더 호환성
- 적절한 색상 대비

### 반응형 디자인
- 모바일 최적화
- 태블릿 지원
- 다양한 화면 크기 대응

### 사용성
- 직관적인 인터페이스
- 명확한 피드백 메시지
- 로딩 상태 표시

## 🐛 에러 처리

### 파일 업로드 에러
- 네트워크 오류 복구
- 파일 유효성 검사 실패
- 스토리지 용량 초과

### 권한 관련 에러
- 접근 권한 없음
- 세션 만료
- 역할 변경 감지

### 사용자 친화적 메시지
- 명확한 오류 설명
- 해결 방법 제시
- 적절한 시각적 피드백

## 🔄 상태 관리

### 로컬 상태
- 파일 업로드 상태
- 모달 표시 상태
- 검색/필터 상태

### 서버 상태
- 영수증 목록 데이터
- 사용자 권한 정보
- 업로드 진행 상태

## 📱 모바일 지원

### 터치 인터페이스
- 터치 친화적 버튼 크기
- 스와이프 제스처 (향후 추가 가능)
- 모바일 카메라 연동 (향후 추가 가능)

### 성능 최적화
- 모바일 네트워크 고려
- 배터리 효율성
- 메모리 사용량 최적화

## 🔮 향후 개선사항

### 기능 확장
- [ ] 카메라로 직접 촬영 업로드
- [ ] OCR을 통한 텍스트 추출
- [ ] 영수증 카테고리 분류
- [ ] 일괄 업로드 기능
- [ ] 영수증 병합 기능

### 사용자 경험 개선
- [ ] 무한 스크롤
- [ ] 고급 검색 기능
- [ ] 즐겨찾기 기능
- [ ] 공유 기능

### 성능 최적화
- [ ] 이미지 CDN 적용
- [ ] 캐싱 전략 개선
- [ ] 프리로딩 구현

## 📞 문의 및 지원

기술적 문의나 버그 신고는 개발팀에게 연락해 주세요.