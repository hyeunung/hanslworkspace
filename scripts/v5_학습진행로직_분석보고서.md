# V5 Engine í•™ìŠµ ì§„í–‰ ë¡œì§ ë¶„ì„ ë³´ê³ ì„œ

## ğŸ“‹ í˜„ì¬ ìƒíƒœ
- **Round**: 10
- **ì™„ë£Œëœ ë³´ë“œ**: 200ê°œ ì´ìƒ
- **ë°ì´í„°ì…‹ íŒŒì¼**: `scripts/v5_dataset.jsonl` (ì¡´ì¬ ì—¬ë¶€ ë¶ˆëª…)

---

## ğŸ”„ í•™ìŠµ ì§„í–‰ ë¡œì§ íë¦„ ë¶„ì„

### 1. ì´ˆê¸°í™” ë‹¨ê³„ (Line 554-566)

```javascript
let round = 1;
let currentModel = INITIAL_MODEL; // 'gpt-4o-mini-2024-07-18'
let progress = { round: 1, completedBoards: [] };

// ì§„í–‰ ìƒí™© ë³µì›
progress = JSON.parse(await fs.readFile(PROGRESS_FILE, 'utf-8'));
round = progress.round; // í˜„ì¬: 10
currentModel = await fs.readFile(LAST_MODEL_FILE, 'utf-8'); // ë§ˆì§€ë§‰ í•™ìŠµëœ ëª¨ë¸
```

**ë™ì‘**: 
- ì´ì „ ì§„í–‰ ìƒí™©ì„ ë¡œë“œí•˜ì—¬ Round 10ë¶€í„° ì¬ê°œ
- ë§ˆì§€ë§‰ í•™ìŠµëœ ëª¨ë¸ì„ ë¡œë“œ

---

### 2. Round ì‹œì‘ ë‹¨ê³„ (Line 568-575)

```javascript
while (true) {
    // Round ì‹œì‘
    if (progress.completedBoards.length === 0) {
        try { await fs.unlink(DATASET_FILE); } catch {}
    }
```

**ë™ì‘**:
- `completedBoards`ê°€ ë¹„ì–´ìˆìœ¼ë©´ ë°ì´í„°ì…‹ íŒŒì¼ ì‚­ì œ
- **ë¬¸ì œ**: Round 10ì—ì„œëŠ” `completedBoards`ê°€ 200ê°œ ì´ìƒì´ë¯€ë¡œ ë°ì´í„°ì…‹ íŒŒì¼ì´ ì‚­ì œë˜ì§€ ì•ŠìŒ
- **ê²°ê³¼**: ì´ì „ Roundì˜ ë°ì´í„°ê°€ ê³„ì† ëˆ„ì ë¨

---

### 3. ë³´ë“œ ìˆ˜ì§‘ ë‹¨ê³„ (Line 577-600)

```javascript
const sets = [];
// sample-data/24_25_SOCKET í´ë”ì—ì„œ ë³´ë“œ íƒìƒ‰
for (const year of years) {
    for (const board of boards) {
        if (progress.completedBoards.includes(board)) continue; // ì´ë¯¸ ì²˜ë¦¬í•œ ë³´ë“œ ìŠ¤í‚µ
        // BOM, ì¢Œí‘œ, ì •ë‹µì§€ íŒŒì¼ ì°¾ê¸°
        const files = await classifyFiles(boardPath);
        if (files.bom && files.coord && files.answer) {
            sets.push({ name: board, ...files });
        }
    }
}
```

**ë™ì‘**:
- `completedBoards`ì— ì—†ëŠ” ë³´ë“œë§Œ ìˆ˜ì§‘
- Round 10ì—ì„œëŠ” ì´ë¯¸ 200ê°œ ì´ìƒ ì²˜ë¦¬í–ˆìœ¼ë¯€ë¡œ ìƒˆë¡œìš´ ë³´ë“œê°€ ì—†ìœ¼ë©´ `sets.length === 0`

---

### 4. ë³´ë“œ ì²˜ë¦¬ ë‹¨ê³„ (Line 606-660)

```javascript
for (let i = 0; i < sets.length; i += BATCH_SIZE) {
    const batch = sets.slice(i, i + BATCH_SIZE);
    const batchResults = await Promise.all(batch.map(set => processBoard(set, round, currentModel)));
    
    for (const res of batchResults) {
        // ê²°ê³¼ ì¶œë ¥
        if (!res.success) failCount++;
        
        progress.completedBoards.push(res.name); // ì™„ë£Œëœ ë³´ë“œ ì¶”ê°€
        await fs.writeFile(PROGRESS_FILE, JSON.stringify(progress)); // ì¦‰ì‹œ ì €ì¥
    }
}
```

**ë™ì‘**:
- ë°°ì¹˜ ë‹¨ìœ„(5ê°œ)ë¡œ ë³´ë“œ ì²˜ë¦¬
- ê° ë³´ë“œ ì²˜ë¦¬ í›„ ì¦‰ì‹œ `completedBoards`ì— ì¶”ê°€í•˜ê³  ì €ì¥
- **ë¬¸ì œ**: ì‹¤íŒ¨í•œ ë³´ë“œë„ `completedBoards`ì— ì¶”ê°€ë¨

---

### 5. ë°ì´í„°ì…‹ ì €ì¥ ë‹¨ê³„ (Line 366-372, 544-546)

```javascript
async function saveTrainingData(bomText, coordText, trueBOM, trueCoords) {
    const bomLine = JSON.stringify({ messages: [...] });
    const coordLine = JSON.stringify({ messages: [...] });
    await fs.appendFile(DATASET_FILE, bomLine + '\n' + coordLine + '\n');
}

// processBoard ë‚´ë¶€ì—ì„œ
if (trueBOM.items && trueBOM.items.length > 0) {
    await saveTrainingData(bomText, coordText, trueBOM, trueCoords);
}
```

**ë™ì‘**:
- **ëª¨ë“  ë³´ë“œ**ì˜ ì •ë‹µ ë°ì´í„°ë¥¼ ë°ì´í„°ì…‹ì— ì¶”ê°€ (ì„±ê³µ/ì‹¤íŒ¨ ë¬´ê´€)
- **ë¬¸ì œ**: ì‹¤íŒ¨í•œ ë³´ë“œì˜ ë°ì´í„°ë„ í¬í•¨ë¨
- **ë¬¸ì œ**: ë°ì´í„°ì…‹ì´ ê³„ì† ëˆ„ì ë˜ì–´ íŒŒì¼ í¬ê¸°ê°€ ì»¤ì§

---

### 6. Round ì¢…ë£Œ ë° ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸ (Line 662-685)

```javascript
console.log(`ğŸ“Š Round ${round} ê²°ê³¼: ì‹¤íŒ¨ ${failCount}ê±´, ì²˜ë¦¬í•œ ë³´ë“œ: ${results.length}ê°œ`);

// ì¢…ë£Œ ì¡°ê±´ ì²´í¬
if (round >= 2 && failCount === 0 && sets.length === 0) {
    console.log('\nğŸ† ì¶•í•˜í•©ë‹ˆë‹¤! ëª¨ë“  ë°ì´í„° ê²€ì¦ ì„±ê³µ! (100% ì¼ì¹˜)');
    break;
}

// Round ì¦ê°€ ë° completedBoards ì´ˆê¸°í™”
progress.round++;  // Round 10 â†’ 11
progress.completedBoards = [];  // 200ê°œ ì´ìƒì˜ ë³´ë“œ ì •ë³´ ì‚­ì œ
await fs.writeFile(PROGRESS_FILE, JSON.stringify(progress));
```

**ë™ì‘**:
- Round ê²°ê³¼ ì¶œë ¥
- ì¢…ë£Œ ì¡°ê±´: Round 2 ì´ìƒ + ì‹¤íŒ¨ 0ê±´ + ì²˜ë¦¬í•  ë³´ë“œ ì—†ìŒ
- **ë¬¸ì œ**: Round ì¦ê°€ì™€ `completedBoards` ì´ˆê¸°í™”ê°€ **í•™ìŠµ ì „**ì— ì¼ì–´ë‚¨
- **ê²°ê³¼**: í•™ìŠµì´ ì‹¤íŒ¨í•´ë„ ì´ë¯¸ Roundê°€ ì¦ê°€í•˜ê³  ì§„í–‰ ìƒí™©ì´ ì´ˆê¸°í™”ë¨

---

### 7. í•™ìŠµ ì¡°ê±´ íŒë‹¨ (Line 687-697)

```javascript
// ë°ì´í„°ì…‹ íŒŒì¼ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
let datasetExists = false;
try {
    await fs.access(DATASET_FILE);
    datasetExists = true;
} catch {}

// í•™ìŠµ ì§„í–‰ ì¡°ê±´:
// 1. Round 1ì—ì„œ ë°ì´í„°ì…‹ì´ ìˆìœ¼ë©´ ë°˜ë“œì‹œ í•™ìŠµ (ì‹¤íŒ¨ 0ê±´ì´ì–´ë„)
// 2. Round 2 ì´ìƒì—ì„œ ì‹¤íŒ¨ê°€ ìˆê³  ë°ì´í„°ì…‹ì´ ìˆìœ¼ë©´ ì¬í•™ìŠµ
const shouldTrain = (round === 1 && datasetExists) || (round >= 2 && failCount > 0 && datasetExists);
```

**í•™ìŠµ ì¡°ê±´**:
- **Round 1**: ë°ì´í„°ì…‹ì´ ìˆìœ¼ë©´ ë¬´ì¡°ê±´ í•™ìŠµ (ì‹¤íŒ¨ 0ê±´ì´ì–´ë„)
- **Round 2 ì´ìƒ**: ì‹¤íŒ¨ê°€ ìˆê³  ë°ì´í„°ì…‹ì´ ìˆìœ¼ë©´ í•™ìŠµ

**í˜„ì¬ ìƒí™© (Round 10)**:
- `round = 11` (ì´ë¯¸ ì¦ê°€í•¨)
- `failCount = ?` (ë³´ë“œ ì²˜ë¦¬ ê²°ê³¼ì— ë”°ë¼)
- `datasetExists = ?` (íŒŒì¼ ì¡´ì¬ ì—¬ë¶€ì— ë”°ë¼)

---

### 8. í•™ìŠµ ì‹¤í–‰ (Line 699-726)

```javascript
if (shouldTrain) {
    console.log('\nğŸ§  í•™ìŠµ ìš”ì²­ ì¤‘...');
    try {
        const file = await openai.files.create({ file: createReadStream(DATASET_FILE), purpose: 'fine-tune' });
        const job = await openai.fineTuning.jobs.create({ 
            training_file: file.id, 
            model: currentModel, 
            hyperparameters: { n_epochs: 3 } 
        });
        
        // í•™ìŠµ ìƒíƒœ í™•ì¸ (30ì´ˆë§ˆë‹¤)
        while(true) {
            const status = await openai.fineTuning.jobs.retrieve(job.id);
            if (status.status === 'succeeded') {
                currentModel = status.fine_tuned_model;
                await fs.writeFile(LAST_MODEL_FILE, currentModel);
                break;
            }
            if (status.status === 'failed') {
                console.log('âš ï¸ í•™ìŠµ ì‹¤íŒ¨, ê¸°ë³¸ ëª¨ë¸ë¡œ ê³„ì† ì§„í–‰...');
                break;
            }
            await new Promise(r => setTimeout(r, 30000));
        }
    } catch(e) { 
        console.log('âš ï¸ í•™ìŠµ ì‹¤íŒ¨:', e.message, 'â†’ ê¸°ë³¸ ëª¨ë¸ë¡œ ê³„ì† ì§„í–‰...'); 
    }
}
```

**ë™ì‘**:
- ë°ì´í„°ì…‹ íŒŒì¼ì„ OpenAIì— ì—…ë¡œë“œ
- Fine-tuning job ìƒì„± (n_epochs: 3)
- 30ì´ˆë§ˆë‹¤ ìƒíƒœ í™•ì¸
- ì„±ê³µ ì‹œ ìƒˆ ëª¨ë¸ ì €ì¥, ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ ëª¨ë¸ë¡œ ê³„ì†

**ë¬¸ì œ**:
- í•™ìŠµ ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ ì—†ìŒ
- í•™ìŠµ ì‹¤íŒ¨í•´ë„ RoundëŠ” ì´ë¯¸ ì¦ê°€í•œ ìƒíƒœ
- í•™ìŠµ ì‹¤íŒ¨í•´ë„ `completedBoards`ëŠ” ì´ë¯¸ ì´ˆê¸°í™”ëœ ìƒíƒœ

---

### 9. í•™ìŠµ ì¡°ê±´ ë¯¸ì¶©ì¡± ì‹œ ì²˜ë¦¬ (Line 727-734)

```javascript
} else if (round === 1 && !datasetExists) {
    console.log('\nâš ï¸ Round 1 ì™„ë£Œí–ˆì§€ë§Œ ë°ì´í„°ì…‹ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤. í•™ìŠµ ì—†ì´ Round 2ë¡œ ì§„í–‰...');
} else if (round >= 2 && failCount > 0 && !datasetExists) {
    console.log('âš ï¸ ì‹¤íŒ¨ê°€ ìˆì§€ë§Œ ë°ì´í„°ì…‹ íŒŒì¼ì´ ì—†ì–´ í•™ìŠµì„ ê±´ë„ˆëœë‹ˆë‹¤.');
} else if (round >= 2 && failCount === 0) {
    console.log('\nâœ… Round 2 ì´ìƒ ì™„ë£Œ (ì‹¤íŒ¨ 0ê±´) â†’ í•™ìŠµ ì—†ì´ ë‹¤ìŒ ë¼ìš´ë“œë¡œ ì§„í–‰...');
}
```

**ë™ì‘**:
- í•™ìŠµ ì¡°ê±´ì„ ë§Œì¡±í•˜ì§€ ì•Šì„ ë•Œ ë©”ì‹œì§€ ì¶œë ¥
- **ë¬¸ì œ**: `round` ë³€ìˆ˜ê°€ ì´ë¯¸ ì¦ê°€í•œ ìƒíƒœì´ë¯€ë¡œ ì¡°ê±´ íŒë‹¨ì´ ì˜ëª»ë  ìˆ˜ ìˆìŒ

---

### 10. Round ì¦ê°€ (Line 736)

```javascript
round++;
```

**ë™ì‘**:
- Roundë¥¼ 1 ì¦ê°€ì‹œí‚´
- **ë¬¸ì œ**: ì´ë¯¸ Line 683ì—ì„œ `progress.round++`ë¥¼ í–ˆëŠ”ë°, ì—¬ê¸°ì„œ ë˜ ì¦ê°€ì‹œí‚´
- **ê²°ê³¼**: Roundê°€ 2ì”© ì¦ê°€í•  ìˆ˜ ìˆìŒ

---

## ğŸš¨ ë°œê²¬ëœ ì£¼ìš” ë¬¸ì œì 

### 1. **Round ì¤‘ë³µ ì¦ê°€**
- Line 683: `progress.round++`
- Line 736: `round++`
- **ê²°ê³¼**: Roundê°€ 2ì”© ì¦ê°€í•  ìˆ˜ ìˆìŒ

### 2. **í•™ìŠµ ì „ ìƒíƒœ ë³€ê²½**
- Round ì¦ê°€ì™€ `completedBoards` ì´ˆê¸°í™”ê°€ í•™ìŠµ **ì „**ì— ì¼ì–´ë‚¨
- í•™ìŠµì´ ì‹¤íŒ¨í•´ë„ ì´ë¯¸ ìƒíƒœê°€ ë³€ê²½ë¨
- **ê²°ê³¼**: í•™ìŠµ ì‹¤íŒ¨ ì‹œ ë³µêµ¬ ë¶ˆê°€ëŠ¥

### 3. **ë°ì´í„°ì…‹ ëˆ„ì  ë¬¸ì œ**
- Round 1 ì‹œì‘ ì‹œì—ë§Œ ë°ì´í„°ì…‹ íŒŒì¼ ì‚­ì œ
- Roundê°€ ì¦ê°€í•´ë„ ë°ì´í„°ì…‹ì´ ê³„ì† ëˆ„ì ë¨
- **ê²°ê³¼**: íŒŒì¼ í¬ê¸°ê°€ ê³„ì† ì»¤ì§€ê³ , ì´ì „ Roundì˜ ì˜ëª»ëœ ë°ì´í„°ê°€ í¬í•¨ë¨

### 4. **ì‹¤íŒ¨í•œ ë³´ë“œë„ ë°ì´í„°ì…‹ì— í¬í•¨**
- `saveTrainingData`ê°€ ì„±ê³µ/ì‹¤íŒ¨ì™€ ë¬´ê´€í•˜ê²Œ ëª¨ë“  ë³´ë“œì˜ ë°ì´í„°ë¥¼ ì €ì¥
- **ê²°ê³¼**: ì˜ëª»ëœ ë°ì´í„°ê°€ í•™ìŠµì— í¬í•¨ë  ìˆ˜ ìˆìŒ

### 5. **í•™ìŠµ ì¡°ê±´ íŒë‹¨ íƒ€ì´ë°**
- `round` ë³€ìˆ˜ê°€ ì´ë¯¸ ì¦ê°€í•œ ìƒíƒœì—ì„œ í•™ìŠµ ì¡°ê±´ì„ íŒë‹¨
- **ê²°ê³¼**: ì¡°ê±´ íŒë‹¨ì´ ì˜ëª»ë  ìˆ˜ ìˆìŒ

### 6. **í•™ìŠµ ì‹¤íŒ¨ ì‹œ ì²˜ë¦¬ ë¶€ì¡±**
- í•™ìŠµ ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ ì—†ìŒ
- í•™ìŠµ ì‹¤íŒ¨í•´ë„ ê³„ì† ì§„í–‰
- **ê²°ê³¼**: í•™ìŠµì´ ì œëŒ€ë¡œ ì´ë£¨ì–´ì§€ì§€ ì•Šì•„ë„ ê³„ì† ì§„í–‰ë¨

### 7. **ë¬¸ë²• ì˜¤ë¥˜ ê°€ëŠ¥ì„±**
- Line 727ì˜ `else if`ê°€ Line 699ì˜ `if`ì™€ ì—°ê²°ë˜ëŠ”ì§€ ë¶ˆëª…í™•
- ì½”ë“œ êµ¬ì¡°ìƒ ë¬¸ì œê°€ ìˆì„ ìˆ˜ ìˆìŒ

---

## ğŸ“Š ì‹¤ì œ ë™ì‘ ì‹œë‚˜ë¦¬ì˜¤ (Round 10 ê¸°ì¤€)

### ì‹œë‚˜ë¦¬ì˜¤ 1: ìƒˆë¡œìš´ ë³´ë“œê°€ ì—†ëŠ” ê²½ìš°
1. `sets.length === 0` (ì²˜ë¦¬í•  ë³´ë“œ ì—†ìŒ)
2. `failCount === 0` (ì²˜ë¦¬í•œ ë³´ë“œ ì—†ìœ¼ë¯€ë¡œ)
3. `progress.round++` â†’ Round 11
4. `progress.completedBoards = []` â†’ ì´ˆê¸°í™”
5. `datasetExists` í™•ì¸
6. `shouldTrain = false` (Round 11ì´ê³  failCount === 0ì´ë¯€ë¡œ)
7. í•™ìŠµ ì—†ì´ `round++` â†’ Round 12
8. **ê²°ê³¼**: Roundê°€ 2ì”© ì¦ê°€í•˜ê³  í•™ìŠµì´ ì•ˆ ë¨

### ì‹œë‚˜ë¦¬ì˜¤ 2: ìƒˆë¡œìš´ ë³´ë“œê°€ ìˆê³  ì‹¤íŒ¨ê°€ ìˆëŠ” ê²½ìš°
1. ë³´ë“œ ì²˜ë¦¬ â†’ ì¼ë¶€ ì‹¤íŒ¨
2. `failCount > 0`
3. `progress.round++` â†’ Round 11
4. `progress.completedBoards = []` â†’ ì´ˆê¸°í™”
5. `datasetExists = true`
6. `shouldTrain = true` (Round 11ì´ê³  failCount > 0ì´ë¯€ë¡œ)
7. í•™ìŠµ ì‹¤í–‰
8. í•™ìŠµ ì„±ê³µ ì‹œ ìƒˆ ëª¨ë¸ ì €ì¥
9. `round++` â†’ Round 12
10. **ê²°ê³¼**: Roundê°€ 2ì”© ì¦ê°€

---

## ğŸ’¡ ê²°ë¡ 

V5 Engineì˜ í•™ìŠµ ì§„í–‰ ë¡œì§ì—ëŠ” ì—¬ëŸ¬ ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤:

1. **Round ì¤‘ë³µ ì¦ê°€**ë¡œ ì¸í•œ ì§„í–‰ ìƒí™© ë¶ˆì¼ì¹˜
2. **í•™ìŠµ ì „ ìƒíƒœ ë³€ê²½**ìœ¼ë¡œ ì¸í•œ ë³µêµ¬ ë¶ˆê°€ëŠ¥
3. **ë°ì´í„°ì…‹ ëˆ„ì **ìœ¼ë¡œ ì¸í•œ í•™ìŠµ í’ˆì§ˆ ì €í•˜
4. **ì‹¤íŒ¨í•œ ë³´ë“œ ë°ì´í„° í¬í•¨**ìœ¼ë¡œ ì¸í•œ í•™ìŠµ ì˜¤ì—¼
5. **í•™ìŠµ ì‹¤íŒ¨ ì‹œ ì²˜ë¦¬ ë¶€ì¡±**ìœ¼ë¡œ ì¸í•œ í•™ìŠµ ëˆ„ë½

ì´ëŸ¬í•œ ë¬¸ì œë“¤ë¡œ ì¸í•´ Round 10ê¹Œì§€ ì§„í–‰ë˜ì—ˆì§€ë§Œ í•™ìŠµì´ ì œëŒ€ë¡œ ì´ë£¨ì–´ì§€ì§€ ì•Šì•˜ì„ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.

