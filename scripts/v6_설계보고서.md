# V6 Engine 설계 보고서

## 목적
BOM, 좌표 원본 파일을 업로드해서 정리본 파일을 만드는 것

---

## 운영 모드

### 1. 학습 모드 (Training Mode) - 현재 진행
- 200개 폴더로 학습 진행
- Round별 검증 및 Fine-tuning
- 100% 정확도 도달까지 반복
- 실행: `node v6-engine.js`

### 2. 추출 모드 (Production Mode) - 학습 완료 후 진행 예정
- 학습 완료된 모델 사용
- 새로운 BOM, 좌표 파일 입력
- 템플릿에 데이터 채워서 정리본 파일 출력
- 실행: `node v6-engine.js --extract <BOM파일> <좌표파일> [출력파일]`

---

## 파일 식별 규칙

### BOM 원본
- 파일명에 `part`, `bom` 포함
- 확장자: .xls, .xlsx, .txt, .bom

### 좌표 원본
- 파일명에 `좌표` 포함
- 확장자: .xls, .xlsx, .txt

### 정리본 (정답지)
- 파일명에 `(숫자)` 패턴
- 예: H25-090_LGIT_BOS_PJT_C50_SAA_V1.1(2505)

---

## 추출 규칙

### BOM 추출 항목
1. PCB Footprint / Partnumber / 제목없음 → 품명
2. Reference → Ref
3. Quantity → SET

### BOM 제외 항목
- Reference가 `TP`로 시작하는 항목 (TP_DOVOD, TP_VD, TP17 등)

### 좌표 추출 항목
1. RefDes
2. Layer (Top/Bottom)
3. LocationX
4. LocationY
5. Rotation

### 좌표 제외 항목
- RefDes가 숫자만인 항목 (1, 2, 3 등)

---

## 학습 항목

### 1. 미삽 처리 항목
- 기본: OPEN, NC, POGO, PAD
- 파일 전체 학습으로 추가 항목 발견

### 2. 품명별 종류 (ItemType)
- 수동정리본에서 적힌 그대로 학습 (추측 불필요)
- 예: IC(SMD), DIODE(SMD), C/C(1005), C/C(1608)

### 3. 종류별 정렬 순서
- IC(SMD) 항상 맨 위
- 커넥터 항상 맨 아래
- 같은 종류끼리 모음, 맨 위에만 이름 있고 나머지 빈칸

---

## 주의사항
- 테이블 테두리 밖 데이터 무시 (작업자 개인 정리)
- 종류 칼럼: 제목 없지만 맨 앞 칼럼
- 비고 칼럼: 제목 없지만 맨 뒤 칼럼
- 원본 데이터 그대로 사용 (환각 금지)

---

## 작업 순서
1. BOM 추출 및 검사
2. 좌표 추출 및 검사
3. 원본과 추출 데이터 1:1 매칭 비교

---

## Round별 검증

### Round 1: 기본 검증
**BOM 검증**
1. SET 총합 확인 (TP 제외)
2. 품명 검증
3. Ref 검증
4. 통과 시 → 종류 학습 (품명→종류 매핑)

**좌표 검증**
1. Layer별 분리 (TOP/BOTTOM)
2. RefDes 검증
3. 좌표값 검증 (X, Y, Rotation)
4. 종류 순서대로 정렬

### Round 2: 종류 검증 추가
- Round 1 검증 + 종류 검증

### Round 3 이상
- 모든 보드 100% 일치까지 무한 반복
- 100% 달성 시 종료

---

## 로그 형식

### 성공
```
✅ H25-120_BOI-T_C40_APS_COMMON2.0_6L
   ✅ SET:일치(100%)
   ✅ 품명:일치(100%)
   ✅ Ref:일치(100%)
   ✅ 종류:일치(100%) [Round 2+]
   ✅ 좌표:일치(100%)
```

### 실패
```
❌ H25-120_BOI-T_C40_APS_COMMON2.0_6L
   ✅ SET:일치(100%)
   ✅ 품명:일치(100%)
   ❌ Ref:불일치 (U4, U7, ...) 32건 누락
   ⏸️ 종류:학습전 [Round 1]
   ✅ 좌표:일치(100%)
```

---

## 모델 전략

### 추출 모델
- 모델: gpt-4o-mini-2024-07-18
- 역할: 원본 파일에서 데이터 추출
- 이유: 토큰 비용 절감, 단순 추출 작업

### 검증 모델
- 모델: gpt-4o
- 역할: 정답지 추출, 비교, 채점
- 이유: 정확한 비교와 분석 필요

### 학습 모델
- 기본: gpt-4o-mini-2024-07-18
- Fine-tuning 후 개선

---

## V5 대비 개선사항

1. TP 필터링, 숫자 RefDes 필터링 자동 적용
2. 테이블 범위 인식
3. 성공한 보드만 학습 (데이터 품질 향상)
4. Round별 데이터셋 관리
5. 학습 성공 후 Round 증가 (버그 수정)
6. Round 중복 증가 버그 수정

---

## 핵심 원칙

1. 원본 데이터 그대로 사용 (추측/환각 금지)
2. 1:1 매칭 확인 (빠진 항목 없이)
3. 같은 종류끼리 모음 (같은 종류 내 오름차순)
4. 단계별 검증 (BOM → 좌표)
5. 성공한 보드만 학습

---

## 파일 구조

### 입력
- sample-data/24_25_SOCKET/{보드명}/
  - BOM 원본 (파일명에 bom/part)
  - 좌표 원본 (파일명에 좌표)
  - 정리본 (파일명에 (숫자))

### 출력
- scripts/v6_dataset.jsonl - 학습 데이터셋
- scripts/v6_last_model.txt - 마지막 모델 ID
- scripts/v6_progress.json - 진행 상황

---

이상 V6 Engine 설계 보고서입니다.

