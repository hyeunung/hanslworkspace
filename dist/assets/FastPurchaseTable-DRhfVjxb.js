const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/exceljs.min-Bv-Vpj4s.js","assets/index-Cexq0bVm.js","assets/index-CRgX5jue.css"])))=>i.map(i=>d[i]);
import{_ as e,r as t,j as a,q as s,p as r,s as l,N as n,k as i,O as c,a as d,l as o}from"./index-Cexq0bVm.js";import{B as m,t as p}from"./index-BPahR4qb.js";import{P as x}from"./PurchaseDetailModal-BAE38ycg.js";import{a as h}from"./helpers-C_CnFjYT.js";import{E as u}from"./eye-DoF6Dg0x.js";import{c as g,R as f,P as y,W as _,C as j,T as w,D as N,d as v,O as b,e as C}from"./input-DP-_2OHk.js";import"./dialog-Bni21Ejp.js";import"./format-iicP_2Fi.js";import"./circle-check-big-DLwfttgc.js";import"./chevron-down-C8waR2_k.js";import"./popover-I8DezEuT.js";import"./calendar-DMyNC-lE.js";import"./package-Dnyumvdv.js";import"./credit-card-BfToutZf.js";import"./trash-2-CtZQ7GWC.js";import"./plus-Sqk7PgVF.js";import"./save-BWb2vKER.js";function $(e){if(!e)return"";const t=new Date(e);return isNaN(t.getTime())?e:`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}function k(e){return e?["KRW","원","₩"].includes(e)?"₩":["USD","$","달러"].includes(e)?"$":["EUR","€"].includes(e)?"€":["JPY","엔","¥"].includes(e)||["CNY","위안","元"].includes(e)?"¥":e:""}const A=t.memo(({purchase:e})=>{const t=e.is_received?"completed":"approved"===e.middle_manager_status&&"approved"===e.final_manager_status?"inProgress":"rejected"===e.middle_manager_status||"rejected"===e.final_manager_status?"rejected":"pending",{text:s,className:r}={completed:{text:"입고완료",className:"bg-green-100 text-green-800"},inProgress:{text:"구매진행",className:"bg-hansl-100 text-hansl-800"},rejected:{text:"반려",className:"bg-red-100 text-red-800"},pending:{text:"승인대기",className:"bg-yellow-100 text-yellow-800"}}[t];return a.jsx(m,{className:`${r} text-xs`,children:s})});A.displayName="StatusBadge";const R=t.memo(({purchase:e,onClick:t})=>{const s=(e=>{if(!e.items||0===e.items.length)return{received:0,total:0,percentage:0};const t=e.items.length,a=e.items.filter(e=>e.is_received||"received"===e.delivery_status).length;return{received:a,total:t,percentage:t>0?Math.round(a/t*100):0}})(e),r="선진행"===e.progress_type||e.progress_type?.includes("선진행");return a.jsxs("div",{className:"bg-white rounded-lg border p-4 space-y-3 cursor-pointer transition-all hover:shadow-md "+(r?"border-red-400 bg-red-50 hover:bg-red-100":"hover:bg-gray-50"),onClick:()=>t(e),children:[a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2",children:[r?a.jsx(m,{className:"bg-red-500 text-white font-bold text-xs px-2 py-0.5",children:"선진행"}):a.jsx(m,{className:"bg-gray-200 text-gray-700 text-xs px-2 py-0.5",children:"일반"}),a.jsx("span",{className:"font-semibold text-sm text-gray-900",children:e.purchase_order_number||"-"})]}),a.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[h(e.request_date)," 요청"]})]}),a.jsx(A,{purchase:e})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center justify-between text-sm",children:[a.jsx("span",{className:"text-gray-600",children:"요청자"}),a.jsx("span",{className:"font-medium",children:e.requester_name})]}),a.jsxs("div",{className:"flex items-center justify-between text-sm",children:[a.jsx("span",{className:"text-gray-600",children:"업체"}),a.jsx("span",{className:"font-medium",children:e.vendor_name})]}),e.project_vendor&&a.jsxs("div",{className:"flex items-center justify-between text-sm",children:[a.jsx("span",{className:"text-gray-600",children:"PJ업체"}),a.jsx("span",{className:"font-medium truncate max-w-[150px]",children:e.project_vendor})]}),e.project_item&&a.jsxs("div",{className:"flex items-center justify-between text-sm",children:[a.jsx("span",{className:"text-gray-600",children:"PJ ITEM"}),a.jsx("span",{className:"font-medium truncate max-w-[150px]",children:e.project_item})]}),e.sales_order_number&&a.jsxs("div",{className:"flex items-center justify-between text-sm",children:[a.jsx("span",{className:"text-gray-600",children:"수주번호"}),a.jsx("span",{className:"font-medium truncate max-w-[150px]",children:e.sales_order_number})]}),e.item_name&&a.jsxs("div",{className:"flex items-center justify-between text-sm",children:[a.jsx("span",{className:"text-gray-600",children:"품목"}),a.jsx("span",{className:"font-medium truncate max-w-[150px]",children:e.item_name})]}),a.jsxs("div",{className:"flex items-center justify-between text-sm",children:[a.jsx("span",{className:"text-gray-600",children:"금액"}),a.jsxs("span",{className:"font-semibold text-gray-900",children:[(e.amount_value||e.total_amount)?.toLocaleString()," ",e.currency]})]})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex items-center justify-between text-xs",children:[a.jsx("span",{className:"text-gray-600",children:"입고현황"}),a.jsxs("span",{className:"text-gray-700",children:[s.received,"/",s.total," (",s.percentage,"%)"]})]}),a.jsx("div",{className:"bg-gray-200 rounded-full h-2",children:a.jsx("div",{className:"h-2 rounded-full transition-all "+(100===s.percentage?"bg-green-500":s.percentage>0?"bg-hansl-500":"bg-gray-300"),style:{width:`${s.percentage}%`}})})]}),void 0!==e.is_payment_completed&&a.jsxs("div",{className:"flex items-center justify-between text-sm",children:[a.jsx("span",{className:"text-gray-600",children:"결제"}),e.is_payment_completed?a.jsx(m,{className:"bg-green-100 text-green-800 text-xs",children:"완료"}):a.jsx(m,{className:"bg-gray-100 text-gray-800 text-xs",children:"대기"})]}),a.jsx("div",{className:"pt-2 border-t",children:a.jsxs("div",{className:"flex items-center justify-center text-xs text-gray-500",children:[a.jsx(u,{className:"w-3 h-3 mr-1"}),"클릭하여 상세보기"]})})]})});R.displayName="MobilePurchaseCard";var D="AlertDialog",[q,E]=r(D,[g]),F=g(),S=e=>{const{__scopeAlertDialog:t,...s}=e,r=F(t);return a.jsx(f,{...r,...s,modal:!0})};S.displayName=D;t.forwardRef((e,t)=>{const{__scopeAlertDialog:s,...r}=e,l=F(s);return a.jsx(C,{...l,...r,ref:t})}).displayName="AlertDialogTrigger";var P=e=>{const{__scopeAlertDialog:t,...s}=e,r=F(t);return a.jsx(y,{...r,...s})};P.displayName="AlertDialogPortal";var T=t.forwardRef((e,t)=>{const{__scopeAlertDialog:s,...r}=e,l=F(s);return a.jsx(b,{...l,...r,ref:t})});T.displayName="AlertDialogOverlay";var z="AlertDialogContent",[B,M]=q(z),L=n("AlertDialogContent"),W=t.forwardRef((e,r)=>{const{__scopeAlertDialog:n,children:i,...c}=e,d=F(n),o=t.useRef(null),m=s(r,o),p=t.useRef(null);return a.jsx(_,{contentName:z,titleName:I,docsSlug:"alert-dialog",children:a.jsx(B,{scope:n,cancelRef:p,children:a.jsxs(j,{role:"alertdialog",...d,...c,ref:m,onOpenAutoFocus:l(c.onOpenAutoFocus,e=>{e.preventDefault(),p.current?.focus({preventScroll:!0})}),onPointerDownOutside:e=>e.preventDefault(),onInteractOutside:e=>e.preventDefault(),children:[a.jsx(L,{children:i}),a.jsx(H,{contentRef:o})]})})})});W.displayName=z;var I="AlertDialogTitle",O=t.forwardRef((e,t)=>{const{__scopeAlertDialog:s,...r}=e,l=F(s);return a.jsx(w,{...l,...r,ref:t})});O.displayName=I;var G="AlertDialogDescription",K=t.forwardRef((e,t)=>{const{__scopeAlertDialog:s,...r}=e,l=F(s);return a.jsx(N,{...l,...r,ref:t})});K.displayName=G;var U=t.forwardRef((e,t)=>{const{__scopeAlertDialog:s,...r}=e,l=F(s);return a.jsx(v,{...l,...r,ref:t})});U.displayName="AlertDialogAction";var J="AlertDialogCancel",Y=t.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...l}=e,{cancelRef:n}=M(J,r),i=F(r),c=s(t,n);return a.jsx(v,{...i,...l,ref:c})});Y.displayName=J;var H=({contentRef:e})=>{const a=`\`${z}\` requires a description for the component to be accessible for screen reader users.\n\nYou can add a description to the \`${z}\` by passing a \`${G}\` component as a child, which also benefits sighted users by adding visible context to the dialog.\n\nAlternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${z}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.\n\nFor more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return t.useEffect(()=>{document.getElementById(e.current?.getAttribute("aria-describedby"))},[a,e]),null},X=T,V=W,Q=U,Z=Y,ee=O,te=K;const ae=S,se=P,re=t.forwardRef(({className:e,...t},s)=>a.jsx(X,{className:i("fixed inset-0 z-50 bg-black/40 backdrop-blur-sm","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:s}));re.displayName=X.displayName;const le=t.forwardRef(({className:e,...t},s)=>a.jsxs(se,{children:[a.jsx(re,{}),a.jsx(V,{ref:s,className:i("fixed left-[50%] top-[50%] z-50","w-full max-w-md translate-x-[-50%] translate-y-[-50%]","grid gap-4 bg-white border border-gray-200","rounded-lg p-6 shadow-professional-xl","duration-200","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0","data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95","data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%]","data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%]",e),...t})]}));le.displayName=V.displayName;const ne=({className:e,...t})=>a.jsx("div",{className:i("flex flex-col space-y-2 text-left",e),...t});ne.displayName="AlertDialogHeader";const ie=({className:e,...t})=>a.jsx("div",{className:i("flex flex-col-reverse sm:flex-row sm:justify-end gap-3",e),...t});ie.displayName="AlertDialogFooter";const ce=t.forwardRef(({className:e,...t},s)=>a.jsx(ee,{ref:s,className:i("text-lg font-semibold text-gray-800 tracking-tight",e),...t}));ce.displayName=ee.displayName;const de=t.forwardRef(({className:e,...t},s)=>a.jsx(te,{ref:s,className:i("text-sm text-gray-600",e),...t}));de.displayName=te.displayName;const oe=t.forwardRef(({className:e,...t},s)=>a.jsx(Q,{ref:s,className:i(c(),e),...t}));oe.displayName=Q.displayName;const me=t.forwardRef(({className:e,...t},s)=>a.jsx(Z,{ref:s,className:i(c({variant:"outline"}),"mt-2 sm:mt-0",e),...t}));me.displayName=Z.displayName;const pe=t.memo(({purchase:e})=>{const t=e.is_received?"completed":"approved"===e.middle_manager_status&&"approved"===e.final_manager_status?"inProgress":"rejected"===e.middle_manager_status||"rejected"===e.final_manager_status?"rejected":"pending",{text:s,className:r}={completed:{text:"입고완료",className:"bg-green-100 text-green-800"},inProgress:{text:"구매진행",className:"bg-hansl-100 text-hansl-800"},rejected:{text:"반려",className:"bg-red-100 text-red-800"},pending:{text:"승인대기",className:"bg-yellow-100 text-yellow-800"}}[t];return a.jsx(m,{className:r,children:s})});pe.displayName="StatusBadge";const xe=e=>e?["KRW","원","₩"].includes(e)?"₩":["USD","$","달러"].includes(e)?"$":["EUR","€"].includes(e)?"€":["JPY","엔","¥"].includes(e)||["CNY","위안","元"].includes(e)?"¥":e:"₩",he="text-center w-20 min-w-[85px] max-w-[85px]",ue="pl-2 w-36 min-w-[145px] max-w-[145px]",ge="text-center w-20 min-w-[85px] max-w-[85px]",fe="w-16 min-w-[68px] max-w-[68px]",ye="w-20 min-w-[85px] max-w-[85px]",_e="w-28 min-w-[115px] max-w-[115px]",je="w-16 min-w-[68px] max-w-[68px]",we="w-20 min-w-[85px] max-w-[85px]",Ne="w-20 min-w-[85px] max-w-[85px]",ve="w-28 min-w-[120px] max-w-[120px]",be="w-64 min-w-[260px] max-w-[260px]",Ce="text-center w-14 min-w-[60px] max-w-[60px]",$e="text-right w-24 min-w-[100px] max-w-[100px]",ke="text-right w-24 min-w-[100px] max-w-[100px]",Ae="w-28 min-w-[115px] max-w-[115px]",Re="w-24 min-w-[100px] max-w-[100px]",De="w-24 min-w-[105px] max-w-[105px]",qe="w-28 min-w-[115px] max-w-[115px]",Ee="w-44 min-w-[180px] max-w-[180px]",Fe="text-center w-20 min-w-[85px] max-w-[85px]",Se="text-center w-20 min-w-[85px] max-w-[85px]",Pe="text-center w-16 min-w-[70px] max-w-[70px]",Te="text-center w-16 min-w-[70px] max-w-[70px]",ze="w-20 min-w-[85px] max-w-[85px]",Be=t.memo(({purchase:e})=>{const t="approved"===e.middle_manager_status,s="rejected"===e.middle_manager_status,r="approved"===e.final_manager_status,l="rejected"===e.final_manager_status;return s||l?a.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[a.jsx("div",{className:"flex items-center gap-0.5",children:a.jsx("div",{className:"w-1.5 h-1.5 bg-red-500 rounded-full animate-pulse"})}),a.jsx(m,{className:"bg-red-100 text-red-800 text-[11px] font-medium px-1.5 py-0",children:"반려"})]}):t&&r?a.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[a.jsx("div",{className:"flex items-center gap-0.5",children:a.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"})}),a.jsx(m,{className:"bg-green-100 text-green-800 text-[11px] font-medium px-1.5 py-0",children:"승인완료"})]}):!t||r||l?a.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full"}),a.jsx("div",{className:"w-3 h-0.5 bg-gray-300"}),a.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full"})]}),a.jsx(m,{className:"bg-gray-100 text-gray-600 text-[11px] font-medium px-1.5 py-0",children:"승인대기"})]}):a.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),a.jsx("div",{className:"w-3 h-0.5 bg-gray-300"}),a.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full"})]}),a.jsx(m,{className:"bg-yellow-100 text-yellow-800 text-[11px] font-medium px-1.5 py-0",children:"1차 승인"})]})});Be.displayName="ApprovalStatusBadge";t.memo(({type:e})=>"선진행"===e||e?.includes("선진행")?a.jsx(m,{className:"bg-red-500 text-white font-bold text-[11px] px-2 py-0.5",children:"선진행"}):a.jsx(m,{className:"bg-gray-200 text-gray-700 text-[11px] px-2 py-0.5",children:"일반"})).displayName="ProgressTypeBadge";const Me=t.memo(({purchase:e,onClick:t,activeTab:s,isLeadBuyer:r,onPaymentComplete:l,onReceiptComplete:n,onExcelDownload:i})=>{const c=(e=>{if(e.is_received)return{received:1,total:1,percentage:100};if(!e.items||0===e.items.length)return{received:0,total:1,percentage:0};const t=e.items.length,a=e.items.filter(e=>!0===e.is_received).length;return{received:a,total:t,percentage:t>0?Math.round(a/t*100):0}})(e),d=(e=>{if(e.is_payment_completed)return{completed:1,total:1,percentage:100};if(!e.items||0===e.items.length)return{completed:0,total:1,percentage:0};const t=e.items.length,a=e.items.filter(e=>!0===e.is_payment_completed).length;return{completed:a,total:t,percentage:t>0?Math.round(a/t*100):0}})(e),o=(e=>{if(!e.items||0===e.items.length){if(e.is_received)return{percentage:100};if(e.is_payment_completed)return{percentage:80};const t="rejected"===e.middle_manager_status,a="rejected"===e.final_manager_status;if(t||a)return{percentage:0};const s="approved"===e.middle_manager_status,r="approved"===e.final_manager_status;return s&&r?{percentage:40}:{percentage:20}}const t=e.items.length,a=e.items.filter(e=>!0===e.is_received).length,s=e.items.filter(e=>!0===e.is_payment_completed).length;if(a===t)return{percentage:100};if(a>0){const e=Math.round(a/t*100);return{percentage:Math.min(80+Math.round(.2*e),99)}}if(s===t)return{percentage:80};if(s>0){const e=Math.round(s/t*100);return{percentage:Math.min(40+Math.round(.4*e),79)}}const r="rejected"===e.middle_manager_status,l="rejected"===e.final_manager_status;if(r||l)return{percentage:0};const n="approved"===e.middle_manager_status,i="approved"===e.final_manager_status;return n&&i?{percentage:40}:{percentage:20}})(e),p="선진행"===e.progress_type||e.progress_type?.includes("선진행");return a.jsxs("tr",{className:"border-b hover:bg-gray-100 cursor-pointer transition-colors "+(p?"bg-red-50 hover:bg-red-100":""),onClick:()=>t(e),children:["pending"===s&&a.jsx("td",{className:`px-2 py-1.5 whitespace-nowrap ${he}`,children:a.jsx(Be,{purchase:e})}),"purchase"===s&&a.jsx("td",{className:`px-2 py-1.5 ${Fe}`,children:a.jsxs("div",{className:"flex items-center justify-center gap-1",children:[a.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:a.jsx("div",{className:"h-1.5 rounded-full "+(100===d.percentage?"bg-blue-500":d.percentage>0?"bg-blue-400":"bg-gray-300"),style:{width:`${d.percentage}%`}})}),a.jsxs("span",{className:"text-[11px] text-gray-600",children:[d.percentage,"%"]})]})}),"receipt"===s&&a.jsx("td",{className:`px-2 py-1.5 ${Fe}`,children:a.jsxs("div",{className:"flex items-center justify-center gap-1",children:[a.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:a.jsx("div",{className:"h-1.5 rounded-full "+(100===c.percentage?"bg-green-500":c.percentage>0?"bg-hansl-500":"bg-gray-300"),style:{width:`${c.percentage}%`}})}),a.jsxs("span",{className:"text-[11px] text-gray-600",children:[c.percentage,"%"]})]})}),a.jsx("td",{className:`px-2 py-1.5 font-medium text-[11px] whitespace-nowrap ${ue}`,children:a.jsxs("div",{className:"flex items-center gap-1",children:[i&&a.jsx("img",{src:"/excels-icon.svg",alt:"엑셀 다운로드",width:"16",height:"16",className:`inline-block align-middle transition-transform p-0.5 rounded\n                ${e.is_po_download?"border border-gray-400":""}\n                ${"선진행"===e.progress_type||e.progress_type?.includes("선진행")||"approved"===e.middle_manager_status&&"approved"===e.final_manager_status?e.is_po_download?"cursor-pointer":"cursor-pointer hover:scale-110":"opacity-40 grayscale cursor-not-allowed"}`,onClick:async t=>{("선진행"===e.progress_type||e.progress_type?.includes("선진행")||"approved"===e.middle_manager_status&&"approved"===e.final_manager_status)&&(t.stopPropagation(),await i(e))},style:{pointerEvents:"선진행"===e.progress_type||e.progress_type?.includes("선진행")||"approved"===e.middle_manager_status&&"approved"===e.final_manager_status?"auto":"none"},title:e.is_po_download?"다운로드 완료":"엑셀 발주서 다운로드"}),a.jsxs("span",{className:"block truncate",title:e.purchase_order_number||"",children:[e.purchase_order_number||"-",e.items&&e.items.length>1&&a.jsxs("span",{className:"text-gray-500 ml-0.5",children:["(",e.items.length,")"]})]})]})}),("pending"===s||"receipt"===s||"done"===s||!s)&&a.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${ge}`,children:a.jsx(m,{className:"text-[11px] "+("구매 요청"===e.payment_category?"bg-blue-100 text-blue-800":"발주"===e.payment_category?"bg-green-100 text-green-800":"경비 청구"===e.payment_category?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:"구매 요청"===e.payment_category?"구매요청":"발주"===e.payment_category?"발주요청":e.payment_category||"-"})}),a.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${fe}`,children:a.jsx("span",{className:"block truncate",title:e.requester_name||"",children:e.requester_name||"-"})}),a.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${ye}`,children:h(e.request_date)}),a.jsx("td",{className:`px-2 py-1.5 text-[11px] ${_e}`,children:a.jsx("span",{className:"block truncate",title:e.vendor_name||"",children:e.vendor_name||"-"})}),a.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${je}`,children:a.jsx("span",{className:"block truncate",title:e.contact_name||"",children:e.contact_name||"-"})}),a.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${we}`,children:h(e.delivery_request_date)}),a.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${Ne}`,children:h(e.revised_delivery_request_date)}),a.jsx("td",{className:`px-2 py-1.5 text-[11px] ${ve}`,children:a.jsx("span",{className:"block truncate",title:e.item_name||"",children:e.item_name||"-"})}),a.jsx("td",{className:`px-2 py-1.5 text-[11px] ${be}`,children:a.jsx("span",{className:"block truncate",title:e.specification||"",children:e.specification||"-"})}),a.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${Ce}`,children:e.quantity||0}),a.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${$e}`,children:e.unit_price_value?`${e.unit_price_value.toLocaleString()} ${xe(e.currency||"KRW")}`:`0 ${xe(e.currency||"KRW")}`}),a.jsx("td",{className:`px-2 py-1.5 text-[11px] font-medium whitespace-nowrap ${ke}`,children:e.amount_value?`${e.amount_value.toLocaleString()} ${xe(e.currency||"KRW")}`:e.total_amount?`${e.total_amount.toLocaleString()} ${xe(e.currency||"KRW")}`:`0 ${xe(e.currency||"KRW")}`}),"pending"===s&&a.jsxs(a.Fragment,{children:[a.jsx("td",{className:`px-2 py-1.5 text-[11px] ${Ae}`,children:a.jsx("span",{className:"block truncate",title:e.remark||"",children:e.remark||"-"})}),a.jsx("td",{className:`px-2 py-1.5 text-[11px] ${De}`,children:a.jsx("span",{className:"block truncate",title:e.project_vendor||"",children:e.project_vendor||"-"})}),a.jsx("td",{className:`px-2 py-1.5 text-[11px] ${Ee}`,children:a.jsx("span",{className:"block truncate",title:e.project_item||"",children:e.project_item||"-"})}),a.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${qe}`,children:a.jsx("span",{className:"block truncate",title:e.sales_order_number||"",children:e.sales_order_number||"-"})})]}),"purchase"===s&&a.jsxs(a.Fragment,{children:[a.jsx("td",{className:`px-2 py-1.5 text-[11px] ${Ae}`,children:a.jsx("span",{className:"block truncate",title:e.remark||"",children:e.remark||"-"})}),a.jsx("td",{className:`px-2 py-1.5 text-[11px] ${ze}`,children:e.link?a.jsx("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline truncate block",title:e.link,children:"링크 보기"}):a.jsx("span",{className:"text-gray-400",children:"-"})}),a.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${Re}`,children:a.jsx("span",{className:"block truncate",title:e.vendor_payment_schedule||"",children:e.vendor_payment_schedule||"-"})})]}),"receipt"===s&&a.jsxs(a.Fragment,{children:[a.jsx("td",{className:`px-2 py-1.5 text-[11px] ${Ae}`,children:a.jsx("span",{className:"block truncate",title:e.remark||"",children:e.remark||"-"})}),a.jsx("td",{className:`px-2 py-1.5 text-[11px] ${De}`,children:a.jsx("span",{className:"block truncate",title:e.project_vendor||"",children:e.project_vendor||"-"})}),a.jsx("td",{className:`px-2 py-1.5 text-[11px] ${Ee}`,children:a.jsx("span",{className:"block truncate",title:e.project_item||"",children:e.project_item||"-"})}),a.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${qe}`,children:a.jsx("span",{className:"block truncate",title:e.sales_order_number||"",children:e.sales_order_number||"-"})}),a.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${Re}`,children:a.jsx("span",{className:"block truncate",title:e.vendor_payment_schedule||"",children:e.vendor_payment_schedule||"-"})})]}),("done"===s||!s)&&a.jsxs(a.Fragment,{children:[a.jsx("td",{className:`px-2 py-1.5 text-[11px] ${Ae}`,children:a.jsx("span",{className:"block truncate",title:e.remark||"",children:e.remark||"-"})}),a.jsx("td",{className:`px-2 py-1.5 text-[11px] ${ze}`,children:e.link?a.jsx("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline truncate block",title:e.link,children:"링크 보기"}):a.jsx("span",{className:"text-gray-400",children:"-"})}),a.jsx("td",{className:`px-2 py-1.5 text-[11px] ${De}`,children:a.jsx("span",{className:"block truncate",title:e.project_vendor||"",children:e.project_vendor||"-"})}),a.jsx("td",{className:`px-2 py-1.5 text-[11px] ${Ee}`,children:a.jsx("span",{className:"block truncate",title:e.project_item||"",children:e.project_item||"-"})}),a.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${qe}`,children:a.jsx("span",{className:"block truncate",title:e.sales_order_number||"",children:e.sales_order_number||"-"})}),a.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${Re}`,children:a.jsx("span",{className:"block truncate",title:e.vendor_payment_schedule||"",children:e.vendor_payment_schedule||"-"})}),a.jsx("td",{className:`px-2 py-1.5 ${Se}`,children:"구매 요청"===e.payment_category?a.jsxs("div",{className:"flex items-center justify-center gap-1",children:[a.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:a.jsx("div",{className:"h-1.5 rounded-full "+(100===o.percentage?"bg-green-500":o.percentage>=80?"bg-blue-500":o.percentage>=40?"bg-hansl-500":o.percentage>0?"bg-gray-400":"bg-red-500"),style:{width:`${o.percentage}%`}})}),a.jsxs("span",{className:"text-[11px] text-gray-600",children:[o.percentage,"%"]})]}):a.jsx("span",{className:"text-gray-400 text-[11px]",children:"-"})}),a.jsx("td",{className:`px-2 py-1.5 ${Pe}`,children:a.jsxs("div",{className:"flex items-center justify-center gap-1",children:[a.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:a.jsx("div",{className:"h-1.5 rounded-full "+(100===c.percentage?"bg-green-500":c.percentage>0?"bg-hansl-500":"bg-gray-300"),style:{width:`${c.percentage}%`}})}),a.jsxs("span",{className:"text-[11px] text-gray-600",children:[c.percentage,"%"]})]})}),a.jsx("td",{className:`px-2 py-1.5 ${Te}`,children:e.is_payment_completed?a.jsx(m,{className:"bg-green-100 text-green-800 text-[11px]",children:"완료"}):a.jsx(m,{className:"bg-gray-100 text-gray-800 text-[11px]",children:"대기"})})]})]})});Me.displayName="TableRow";const Le=t.memo(({purchases:s,activeTab:r="done",currentUserRoles:l=[],onRefresh:n,onPaymentComplete:i,onReceiptComplete:c})=>{const[m,h]=t.useState(null),[u,g]=t.useState(!1),[f,y]=t.useState(!1),[_,j]=t.useState(null),w=d(),N=l&&(l.includes("lead buyer")||l.includes("app_admin"));l.includes("final_approver")||l.includes("app_admin")||l.includes("ceo");const v=e=>{h(e.id),g(!0)},b=async t=>{try{const{data:r,error:i}=await w.from("purchase_requests").select("*").eq("purchase_order_number",t.purchase_order_number).single();if(i||!r)return void p.error("해당 발주요청번호의 데이터를 찾을 수 없습니다.");const{data:c,error:d}=await w.from("purchase_request_items").select("*").eq("purchase_order_number",t.purchase_order_number).order("line_number");if(d||!c||0===c.length)return void p.error("해당 발주요청번호의 품목 데이터를 찾을 수 없습니다.");const o={vendor_name:t.vendor_name,vendor_phone:"",vendor_fax:"",vendor_contact_name:"",vendor_payment_schedule:""};try{const e=r.vendor_id||t.vendor_id,a=r.contact_id||t.contact_id;if(e){const{data:t}=await w.from("vendors").select("vendor_phone, vendor_fax, vendor_payment_schedule").eq("id",e).single();t&&(o.vendor_phone=t.vendor_phone||"",o.vendor_fax=t.vendor_fax||"",o.vendor_payment_schedule=t.vendor_payment_schedule||"")}if(a){const{data:e}=await w.from("vendor_contacts").select("contact_name, contact_phone, contact_email").eq("id",a).single();e&&(o.vendor_contact_name=e.contact_name||"")}}catch(a){}const m={purchase_order_number:r.purchase_order_number||"",request_date:r.request_date,delivery_request_date:r.delivery_request_date,requester_name:r.requester_name,vendor_name:o.vendor_name||"",vendor_contact_name:o.vendor_contact_name,vendor_phone:o.vendor_phone,vendor_fax:o.vendor_fax,project_vendor:r.project_vendor,sales_order_number:r.sales_order_number,project_item:r.project_item,vendor_payment_schedule:o.vendor_payment_schedule,items:c.map(e=>({line_number:e.line_number,item_name:e.item_name,specification:e.specification,quantity:e.quantity,unit_price_value:e.unit_price_value,amount_value:e.amount_value,remark:e.remark,currency:r.currency||"KRW"}))},x=await async function(t){const a=new((await e(()=>import("./exceljs.min-Bv-Vpj4s.js").then(e=>e.e),__vite__mapDeps([0,1,2]))).Workbook),s=a.addWorksheet("발주서",{pageSetup:{paperSize:9,orientation:"portrait",fitToPage:!0,fitToWidth:1,fitToHeight:1,horizontalCentered:!0,verticalCentered:!0,margins:{left:.3,right:.3,top:.5,bottom:.5,header:.2,footer:.2}}});s.getRow(1).height=29.8;for(let e=2;e<=60;e++)s.getRow(e).height=15.75;s.getRow(1).eachCell(e=>{e.font={...e.font||{},name:"맑은 고딕",size:20}});for(let e=2;e<=60;e++)s.getRow(e).eachCell(e=>{e.font={...e.font||{},name:"맑은 고딕",size:11}});s.mergeCells("A1:G1"),s.mergeCells("A2:B2"),s.mergeCells("C2:D2"),s.mergeCells("F2:G2"),s.mergeCells("A3:B3"),s.mergeCells("C3:D3"),s.mergeCells("F3:G3"),s.mergeCells("A4:B4"),s.mergeCells("C4:D4"),s.mergeCells("F4:G4"),s.mergeCells("A5:B5"),s.mergeCells("C5:D5"),s.mergeCells("F5:G5"),s.mergeCells("A6:B6"),s.mergeCells("C6:D6"),s.mergeCells("F6:G6"),s.mergeCells("A7:B7"),s.mergeCells("C7:D7"),s.mergeCells("F7:G7");try{const e=await fetch("/logo_KOR.png"),t=await e.arrayBuffer(),r=a.addImage({buffer:t,extension:"png"}),l=s.getColumn("D").width||22,n=Math.max(1,7.2*l*.58)+4,i=34,c=3,d=.3;s.addImage(r,{tl:{col:c,row:d},ext:{width:n,height:i}})}catch(x){}s.getCell("D1").value="                발 주 서",s.getCell("D1").alignment={horizontal:"left",vertical:"middle",indent:1},s.getCell("D1").font={bold:!0,size:20},s.getCell("A2").value="업   체   명",s.getCell("A2").font={bold:!0},s.getCell("A3").value="담   당   자",s.getCell("A3").font={bold:!0},s.getCell("A4").value="청   구   일",s.getCell("A4").font={bold:!0},s.getCell("A5").value="TEL.",s.getCell("A5").font={bold:!0},s.getCell("A6").value="FAX.",s.getCell("A6").font={bold:!0},s.getCell("A7").value="입고요청일",s.getCell("A7").font={bold:!0},s.getCell("E2").value="구매요청자",s.getCell("E2").font={bold:!0},s.getCell("E3").value="주         소",s.getCell("E3").font={bold:!0},s.getCell("E4").value="발 주 번 호",s.getCell("E4").font={bold:!0},s.getCell("E5").value="TEL.",s.getCell("E5").font={bold:!0},s.getCell("E6").value="FAX.",s.getCell("E6").font={bold:!0},s.getCell("E7").value="지출 예정일",s.getCell("E7").font={bold:!0},s.getCell("F7").value=t.vendor_payment_schedule||"",s.getCell("C2").value=t.vendor_name,s.getCell("C3").value=t.vendor_contact_name||"",s.getCell("C4").value=$(t.request_date),s.getCell("C5").value=t.vendor_phone||"",s.getCell("C6").value=t.vendor_fax||"",s.getCell("C7").value=$(t.delivery_request_date),s.getCell("F2").value=t.requester_name,s.getCell("F3").value="대구광역시 달서구 성서공단북로305",s.getCell("F4").value=t.purchase_order_number,s.getCell("F5").value="(053) 626-7805",s.getCell("F6").value="(053) 657-7905",s.getCell("F5").alignment={horizontal:"center",vertical:"middle"},s.getCell("F6").alignment={horizontal:"center",vertical:"middle"};const r=["No","품명","규격","수량","단가","금액","비고"];for(let e=0;e<r.length;e++)s.getCell(String.fromCharCode(65+e)+"8").value=r[e],s.getCell(String.fromCharCode(65+e)+"8").font={bold:!0},6===e&&(s.getCell("G8").alignment={horizontal:"center",vertical:"middle"});const l=[...t.items].sort((e,t)=>e.line_number-t.line_number),n=l.length,i=9+Math.max(n,45);for(let e=0;e<l.length;e++){const t=l[e],a=9+e;s.getCell("A"+a).value=t.line_number;const r=s.getCell("B"+a);r.value=t.item_name,r.alignment={horizontal:"left",vertical:"middle"},s.getCell("C"+a).value=t.specification,s.getCell("C"+a).alignment={horizontal:"left",vertical:"middle"},s.getCell("D"+a).value=t.quantity;const n=k(t.currency),i=void 0!==t.unit_price_value&&null!==t.unit_price_value?`${t.unit_price_value.toLocaleString()} ${n}`.trim():"";s.getCell("E"+a).value=i,s.getCell("E"+a).alignment={horizontal:"right",vertical:"middle"};const c=k(t.currency),d=void 0!==t.amount_value&&null!==t.amount_value?`${t.amount_value.toLocaleString()} ${c}`.trim():"";s.getCell("F"+a).value=d,s.getCell("F"+a).alignment={horizontal:"right",vertical:"middle"};const o=s.getCell("G"+a);o.value=void 0!==t.remark&&null!==t.remark?String(t.remark):"",o.alignment={horizontal:"left",vertical:"middle",wrapText:!1,shrinkToFit:!0}}for(let e=n;e<45;e++){const t=9+e;for(let e=0;e<7;e++)s.getCell(String.fromCharCode(65+e)+t).value=""}s.mergeCells(`A${i}:E${i}`),s.getCell("A"+i).value="합계",s.getCell("A"+i).font={bold:!0};const c=k(t.items[0]?.currency),d=t.items.reduce((e,t)=>e+(t.amount_value||0),0);s.getCell("F"+i).value=`${d.toLocaleString()} ${c}`.trim(),s.getCell("F"+i).alignment={horizontal:"right",vertical:"middle"};const o=i;for(let e=1;e<=o;e++)for(let t=1;t<=7;t++){const a=String.fromCharCode(64+t)+e,r=s.getCell(a),l=e>=9&&e<i;(5===t||6===t)&&(l||e===i)||3===t&&l||(r.alignment={horizontal:"center",vertical:"middle"}),r.border={top:{style:1===e||2===e||8===e||e===i?"medium":"thin"},left:{style:1===t?"medium":"thin"},right:{style:7===t?"medium":"thin"},bottom:{style:8===e||e===i||e===o?"medium":"thin"}}}for(let e=0;e<n;e++){const t=9+e;s.getCell("C"+t).alignment={horizontal:"left",vertical:"middle"}}for(let e=2;e<=7;e++)s.getCell("B"+e).border={...s.getCell("B"+e).border,right:{style:"medium"}},s.getCell("D"+e).border={...s.getCell("D"+e).border,right:{style:"medium"}},e<=6&&(s.getCell("E"+e).border={...s.getCell("E"+e).border,right:{style:"medium"}});s.getCell("E7").border={...s.getCell("E7").border,top:{style:"thin"},right:{style:"medium"}},s.getCell("G7").border={...s.getCell("G7").border,top:{style:"thin"}};for(let e=1;e<=7;e++){const t=s.getCell("A"+e).border||{};s.getCell("A"+e).border={...t,left:{style:"medium"}}}const m=s.getCell("A"+i).border||{};s.getCell("A"+i).border={...m,left:{style:"medium"}},Object.entries({A:4.7,B:23,C:30,D:11,E:15,F:16,G:37}).forEach(([e,t])=>{s.getColumn(e).width=t}),s.getRow(1).height=29.8,s.getRow(1).eachCell(e=>{e.font={...e.font||{},name:"맑은 고딕",size:20}});for(let e=2;e<=o;e++){const t=s.getRow(e);t.height=15.75,t.eachCell(e=>{e.font={...e.font||{},name:"맑은 고딕",size:11}})}for(let e=9;e<=o;e++)s.getCell("G"+e).alignment={horizontal:"left",vertical:"middle",wrapText:!1,shrinkToFit:!0},s.getCell("B"+e).alignment={horizontal:"left",vertical:"middle"};const p=await a.xlsx.writeBuffer();return new Blob([p],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})}(m),h=`발주서_${m.vendor_name}_${m.purchase_order_number}.xlsx`,u=window.URL.createObjectURL(x),g=document.createElement("a");g.href=u,g.download=h,document.body.appendChild(g),g.click(),document.body.removeChild(g),window.URL.revokeObjectURL(u),p.success("엑셀 파일이 다운로드되었습니다.");try{if(l&&l.includes("lead buyer")){const{error:e}=await w.from("purchase_requests").update({is_po_download:!0}).eq("purchase_order_number",t.purchase_order_number);e||n?.()}}catch(s){}}catch(a){p.error("엑셀 다운로드에 실패했습니다.")}},C=t.useMemo(()=>{if("pending"===r)return a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${he}`,children:"승인상태"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${ue}`,children:"발주번호"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${ge}`,children:"결제종류"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${fe}`,children:"요청자"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${ye}`,children:"청구일"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] text-left ${_e}`,children:"업체"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${je}`,children:"담당자"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${we}`,children:"입고요청일"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${Ne}`,children:"변경 입고일"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] text-left ${ve}`,children:"품명"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] text-left ${be}`,children:"규격"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${Ce}`,children:"수량"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${$e}`,children:"단가"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${ke}`,children:"합계"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${Ae}`,children:"비고"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${De}`,children:"PJ업체"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${Ee}`,children:"PJ ITEM"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${qe}`,children:"수주번호"})]})});const e=a.jsxs(a.Fragment,{children:[a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${ue}`,children:"발주번호"}),("receipt"===r||"done"===r||!r)&&a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${ge}`,children:"결제종류"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${fe}`,children:"요청자"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${ye}`,children:"청구일"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${_e}`,children:"업체"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${je}`,children:"담당자"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${we}`,children:"입고요청일"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${Ne}`,children:"변경 입고일"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] text-left ${ve}`,children:"품명"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] text-left ${be}`,children:"규격"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${Ce}`,children:"수량"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${$e}`,children:"단가"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${ke}`,children:"합계"})]});let t=null;return t="purchase"===r?a.jsxs(a.Fragment,{children:[a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${Ae}`,children:"비고"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${ze}`,children:"링크"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${Re}`,children:"지출예정일"})]}):"receipt"===r?a.jsxs(a.Fragment,{children:[a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${Ae}`,children:"비고"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${De}`,children:"PJ업체"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${Ee}`,children:"PJ ITEM"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${qe}`,children:"수주번호"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${Re}`,children:"지출예정일"})]}):a.jsxs(a.Fragment,{children:[a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${Ae}`,children:"비고"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${ze}`,children:"링크"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${De}`,children:"PJ업체"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${Ee}`,children:"PJ ITEM"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${qe}`,children:"수주번호"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${Re}`,children:"지출예정일"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${Se}`,children:"구매진행"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${Pe}`,children:"입고진행"}),a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${Te}`,children:"결제"})]}),a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:["purchase"===r&&a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${Fe}`,children:"구매진행"}),"receipt"===r&&a.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${Fe}`,children:"입고진행"}),e,t]})})},[r]);return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"hidden md:block w-full",children:a.jsx("div",{className:"overflow-x-auto border rounded-lg",children:a.jsxs("table",{className:"w-full min-w-[1760px]",children:[C,a.jsx("tbody",{children:s.map(e=>a.jsx(Me,{purchase:e,onClick:v,activeTab:r,isLeadBuyer:N,onPaymentComplete:i,onReceiptComplete:c,onExcelDownload:b},e.id))})]})})}),a.jsx("div",{className:"hidden sm:block md:hidden w-full",children:a.jsx("div",{className:"overflow-x-auto border rounded-lg",children:a.jsxs("table",{className:"w-full min-w-[600px] text-[11px]",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"text-left p-2 font-medium text-gray-900 w-24",children:"발주번호"}),a.jsx("th",{className:"text-left p-2 font-medium text-gray-900 w-16",children:"요청자"}),a.jsx("th",{className:"text-left p-2 font-medium text-gray-900 w-20",children:"업체"}),a.jsx("th",{className:"text-left p-2 font-medium text-gray-900 w-32",children:"품명"}),a.jsx("th",{className:"text-right p-2 font-medium text-gray-900 w-20",children:"금액"}),a.jsx("th",{className:"text-center p-2 font-medium text-gray-900 w-16",children:"상태"})]})}),a.jsx("tbody",{children:s.map(e=>a.jsxs("tr",{className:"border-b hover:bg-gray-50 cursor-pointer",onClick:()=>v(e),children:[a.jsx("td",{className:"p-2 font-medium",children:e.purchase_order_number||"-"}),a.jsx("td",{className:"p-2",children:e.requester_name}),a.jsx("td",{className:"p-2 truncate",title:e.vendor_name,children:e.vendor_name}),a.jsx("td",{className:"p-2 truncate",title:e.item_name,children:e.item_name||"-"}),a.jsx("td",{className:"p-2 text-right font-medium",children:e.amount_value?`${e.amount_value.toLocaleString()} ${xe(e.currency||"KRW")}`:e.total_amount?`${e.total_amount.toLocaleString()} ${xe(e.currency||"KRW")}`:`0 ${xe(e.currency||"KRW")}`}),a.jsx("td",{className:"p-2 text-center",children:a.jsx(pe,{purchase:e})})]},e.id))})]})})}),a.jsx("div",{className:"sm:hidden space-y-3",children:s.map(e=>a.jsx(R,{purchase:e,onClick:()=>v(e)},e.id))}),a.jsx(x,{purchaseId:m,isOpen:u,onClose:()=>{g(!1),h(null)},currentUserRoles:l,activeTab:r,onRefresh:n,onDelete:e=>{j(e),y(!0)}}),a.jsx(ae,{open:f,onOpenChange:y,children:a.jsxs(le,{children:[a.jsxs(ne,{children:[a.jsx(ce,{children:"발주요청 내역 삭제"}),a.jsxs(de,{children:["발주요청번호 ",_?.purchase_order_number,"를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."]})]}),a.jsxs(ie,{children:[a.jsx(me,{children:"취소"}),a.jsx(oe,{onClick:async()=>{if(_){o.debug("발주 삭제 확인",{id:_.id,purchase_order_number:_.purchase_order_number,requester_name:_.requester_name,final_manager_status:_.final_manager_status});try{const{data:{user:e},error:t}=await w.auth.getUser();if(t||!e)return void p.error("로그인이 필요합니다.");const{data:a,error:s}=await w.from("employees").select("name, email, purchase_role").eq("email",e.email).single();if(o.debug("사용자 권한 확인",{employee:a?.name,roles:a?.purchase_role,email:a?.email}),s||!a)return void p.error("사용자 권한을 확인할 수 없습니다.");let r=[];if(a.purchase_role)if(Array.isArray(a.purchase_role))r=a.purchase_role.map(e=>String(e).trim());else{r=String(a.purchase_role).split(",").map(e=>e.trim()).filter(e=>e.length>0)}const l=r.includes("final_approver")||r.includes("app_admin")||r.includes("ceo"),i="approved"===_.final_manager_status,c=_.requester_name===a.name,d=i?l:l||c;if(o.debug("삭제 권한 확인",{canEdit:l,isApproved:i,isRequester:c,canDeleteThis:d,userRoles:r}),!d)return void p.error("삭제 권한이 없습니다.");const{data:m,error:x}=await w.from("purchase_request_items").delete().eq("purchase_request_id",_.id).select();if(x)throw o.error("아이템 삭제 중 오류 발생",x,{code:x.code,message:x.message,details:x.details,hint:x.hint}),x;o.debug("아이템 삭제 완료",{deletedItemsCount:m?.length||0,purchaseRequestId:_.id});const{data:h,error:u}=await w.from("purchase_requests").delete().eq("id",_.id).select();if(u)throw o.error("발주요청 삭제 중 오류 발생",u,{code:u.code,message:u.message,details:u.details,hint:u.hint}),u;o.debug("발주요청 삭제 완료",{deletedRequestId:_.id,purchase_order_number:_.purchase_order_number}),p.success("발주요청 내역이 삭제되었습니다."),n?.()}catch(e){const t=e;o.error("발주요청 삭제 중 예외 발생",t,{name:t?.name,message:t?.message,code:t?.code,details:t?.details,hint:t?.hint,stack:t?.stack}),p.error(`삭제 중 오류가 발생했습니다: ${t?.message||"알 수 없는 오류"}`)}y(!1),j(null)}},className:"bg-red-600 hover:bg-red-700",children:"삭제"})]})]})})]})});Le.displayName="FastPurchaseTable";export{Le as default};
//# sourceMappingURL=FastPurchaseTable-DRhfVjxb.js.map
