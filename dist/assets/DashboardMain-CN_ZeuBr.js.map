{"version":3,"file":"DashboardMain-CN_ZeuBr.js","sources":["../../node_modules/lucide-react/dist/esm/icons/clock.js","../../src/services/dashboardService.ts","../../src/components/dashboard/DashboardMain.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M12 6v6l4 2\", key: \"mmk7yg\" }],\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }]\n];\nconst Clock = createLucideIcon(\"clock\", __iconNode);\n\nexport { __iconNode, Clock as default };\n//# sourceMappingURL=clock.js.map\n","import { createClient } from '@/lib/supabase/client'\nimport { logger } from '@/lib/logger'\nimport { purchaseMemoryCache, CACHE_DURATION } from '@/stores/purchaseMemoryStore'\nimport type { \n  DashboardData, \n  DashboardStats, \n  UrgentRequest, \n  MyRequestStatus, \n  QuickAction,\n  Employee,\n  PurchaseRequestWithDetails,\n  Purchase\n} from '@/types/purchase'\n\n// ëŒ€ì‹œë³´ë“œ ë°ì´í„° ìºì‹œ\nconst dashboardCache = {\n  data: null as DashboardData | null,\n  lastFetch: 0,\n  CACHE_DURATION: 30 * 1000, // 30ì´ˆ ìºì‹œ\n  employeeId: null as string | null\n}\n\nexport class DashboardService {\n  private supabase = createClient()\n\n  private hasValidPurchaseMemory(employee?: Employee | null): boolean {\n    if (!purchaseMemoryCache.allPurchases || purchaseMemoryCache.allPurchases.length === 0) return false\n    if (!employee?.id) return false\n    \n    const now = Date.now()\n    const lastFetch = purchaseMemoryCache.lastFetch || 0\n    const isFresh = (now - lastFetch) < CACHE_DURATION\n    const isSameUser = purchaseMemoryCache.currentUser?.id === String(employee.id)\n    \n    return isFresh && isSameUser\n  }\n\n  private getPurchaseMemory(): Purchase[] {\n    return (purchaseMemoryCache.allPurchases || []) as Purchase[]\n  }\n\n  // ì—­í•  íŒŒì‹± ìœ í‹¸: ë°°ì—´/CSV ë¬¸ìì—´/ë‹¨ì¼ ë¬¸ìì—´ì„ ëª¨ë‘ ë°°ì—´ë¡œ ì •ê·œí™”\n  private parseRoles(purchaseRole: string | string[] | null | undefined): string[] {\n    let roles: string[] = []\n    \n    if (purchaseRole) {\n      if (Array.isArray(purchaseRole)) {\n        // ë°°ì—´ì¸ ê²½ìš°\n        roles = purchaseRole.map((r: any) => String(r).trim())\n      } else {\n        // ë¬¸ìì—´ì¸ ê²½ìš° (ì¼ë°˜ì )\n        const roleString = String(purchaseRole)\n        // ì‰¼í‘œë¡œ ë¶„í• í•˜ê³  ê³µë°± ì œê±°\n        roles = roleString\n          .split(',')\n          .map((r: string) => r.trim())\n          .filter((r: string) => r.length > 0)\n      }\n    }\n    \n    return roles\n  }\n\n  // ë©”ì¸ ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ\n  async getDashboardData(employee: Employee, forceRefresh = false): Promise<DashboardData> {\n    const now = Date.now()\n    const cacheValid = !forceRefresh && \n                       dashboardCache.data && \n                       dashboardCache.employeeId === employee.id &&\n                       (now - dashboardCache.lastFetch) < dashboardCache.CACHE_DURATION\n\n    // ìºì‹œê°€ ìœ íš¨í•˜ë©´ ì¦‰ì‹œ ë°˜í™˜\n    if (cacheValid && dashboardCache.data) {\n      return dashboardCache.data\n    }\n\n    // âœ… ë°œì£¼ìš”ì²­ ê´€ë¦¬ì™€ ë™ì¼í•œ ë°©ì‹: ë©”ëª¨ë¦¬ ìºì‹œ(ìµœê·¼ 2000ê±´ + í’ˆëª©) ê¸°ë°˜ìœ¼ë¡œ ëŒ€ì‹œë³´ë“œ êµ¬ì„±\n    // - DataInitializerì—ì„œ ì´ë¯¸ loadAllPurchaseDataë¥¼ ìˆ˜í–‰í•˜ë¯€ë¡œ ëŒ€ì‹œë³´ë“œ ì§„ì… ì‹œ ì¶”ê°€ DB ì¿¼ë¦¬ë¥¼ ì¤„ì¼ ìˆ˜ ìˆìŒ\n    // - ë©”ëª¨ë¦¬ê°€ ì—†ìœ¼ë©´ ê¸°ì¡´ Supabase ì¿¼ë¦¬ ë°©ì‹ìœ¼ë¡œ í´ë°±\n    const useMemory = this.hasValidPurchaseMemory(employee)\n\n    const results = await Promise.allSettled([\n      useMemory ? this.getDashboardStatsFromMemory(employee) : this.getDashboardStats(employee),\n      useMemory ? this.getMyRecentRequestsFromMemory(employee) : this.getMyRecentRequests(employee),\n      useMemory ? this.getPendingApprovalsFromMemory(employee) : this.getPendingApprovals(employee),\n      useMemory ? this.getQuickActionsFromMemory(employee) : this.getQuickActions(employee),\n      useMemory ? this.getTodaySummaryFromMemory(employee) : this.getTodaySummary(employee),\n      useMemory ? this.getMyPurchaseStatusFromMemory(employee) : this.getMyPurchaseStatus(employee)\n    ])\n    \n    const statsResult = results[0]\n    const myRecentRequestsResult = results[1]\n    const pendingApprovalsResult = results[2]\n    const quickActionsResult = results[3]\n    const todaySummaryResult = results[4]\n    const myPurchaseStatusResult = results[5]\n    \n    const stats: DashboardStats = statsResult.status === 'fulfilled' \n      ? statsResult.value \n      : { total: 0, myRequests: 0, pending: 0, completed: 0, urgent: 0, todayActions: 0 }\n    \n    const myRecentRequests: MyRequestStatus[] = myRecentRequestsResult.status === 'fulfilled'\n      ? myRecentRequestsResult.value\n      : []\n    \n    const pendingApprovals: PurchaseRequestWithDetails[] = pendingApprovalsResult.status === 'fulfilled'\n      ? pendingApprovalsResult.value\n      : []\n    \n    const quickActions: QuickAction[] = quickActionsResult.status === 'fulfilled'\n      ? quickActionsResult.value\n      : []\n    \n    const todaySummary = todaySummaryResult.status === 'fulfilled'\n      ? todaySummaryResult.value\n      : { approved: 0, requested: 0, received: 0 }\n    \n    const myPurchaseStatus = myPurchaseStatusResult.status === 'fulfilled'\n      ? myPurchaseStatusResult.value\n      : { waitingPurchase: [], waitingDelivery: [], recentCompleted: [] }\n    \n    // ì‹¤íŒ¨í•œ í•­ëª© ë¡œê¹…\n    if (statsResult.status === 'rejected') {\n      logger.error('[DashboardService] getDashboardStats ì‹¤íŒ¨:', statsResult.reason)\n    }\n    if (myRecentRequestsResult.status === 'rejected') {\n      logger.error('[DashboardService] getMyRecentRequests ì‹¤íŒ¨:', myRecentRequestsResult.reason)\n    }\n    if (pendingApprovalsResult.status === 'rejected') {\n      logger.error('[DashboardService] getPendingApprovals ì‹¤íŒ¨:', pendingApprovalsResult.reason)\n    }\n    if (quickActionsResult.status === 'rejected') {\n      logger.error('[DashboardService] getQuickActions ì‹¤íŒ¨:', quickActionsResult.reason)\n    }\n    if (todaySummaryResult.status === 'rejected') {\n      logger.error('[DashboardService] getTodaySummary ì‹¤íŒ¨:', todaySummaryResult.reason)\n    }\n    if (myPurchaseStatusResult.status === 'rejected') {\n      logger.error('[DashboardService] getMyPurchaseStatus ì‹¤íŒ¨:', myPurchaseStatusResult.reason)\n    }\n\n    const dashboardData: DashboardData = {\n      employee,\n      stats,\n      urgentRequests: [],\n      myRecentRequests,\n      pendingApprovals,\n      quickActions,\n      todaySummary,\n      myPurchaseStatus\n    }\n\n    // ìºì‹œ ì—…ë°ì´íŠ¸\n    dashboardCache.data = dashboardData\n    dashboardCache.lastFetch = now\n    dashboardCache.employeeId = employee.id\n\n    return dashboardData\n  }\n\n  // ===== Memory-based implementations (ë°œì£¼ìš”ì²­ ê´€ë¦¬ì™€ ë™ì¼: ë©”ëª¨ë¦¬ ìºì‹œ ê¸°ë°˜) =====\n\n  private isPendingStatus(status: any): boolean {\n    return status === 'pending' || status === 'ëŒ€ê¸°' || status === '' || status === null || status === undefined\n  }\n\n  private toTime(value?: string | null): number {\n    if (!value) return 0\n    const t = new Date(value).getTime()\n    return Number.isFinite(t) ? t : 0\n  }\n\n  async getDashboardStatsFromMemory(employee: Employee): Promise<DashboardStats> {\n    const purchases = this.getPurchaseMemory()\n    const today = new Date().toISOString().split('T')[0]\n    const roles = this.parseRoles(employee.purchase_role)\n\n    const requesterName = employee.name || employee.email\n    const monthStart = new Date(new Date().getFullYear(), new Date().getMonth(), 1).toISOString()\n    const threeDaysAgo = new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString()\n\n    const total = purchases.length\n    const myRequests = purchases.filter(p => (p.requester_name || '') === employee.name).length\n    const pending = await this.getPendingCountFromMemory(employee, roles)\n    const completed = purchases.filter(p => p.is_received === true && this.toTime(p.received_at) >= this.toTime(monthStart)).length\n    const urgent = this.getUrgentCountFromMemory(employee, roles, threeDaysAgo)\n    const todayActions = this.getTodayActionsCountFromMemory(employee, today)\n\n    return { total, myRequests, pending, completed, urgent, todayActions }\n  }\n\n  async getMyRecentRequestsFromMemory(employee: Employee): Promise<MyRequestStatus[]> {\n    const purchases = this.getPurchaseMemory()\n    const requesterName = employee.name || employee.email\n\n    const filtered = purchases\n      .filter((item: any) => (item.requester_name || '') === requesterName)\n      .filter((item: any) => {\n        // ìŠ¹ì¸ ì§„í–‰ì¤‘ì¸ í•­ëª©ë§Œ (ìŠ¹ì¸ ëŒ€ê¸°ëŠ” ì œì™¸)\n        const middleApproved = item.middle_manager_status === 'approved'\n        const finalPending = this.isPendingStatus(item.final_manager_status)\n        const finalApproved = item.final_manager_status === 'approved'\n        const notPaid = !item.is_payment_completed\n        return (middleApproved && finalPending) || (finalApproved && notPaid)\n      })\n      .sort((a: any, b: any) => this.toTime(b.created_at) - this.toTime(a.created_at))\n      .slice(0, 5)\n\n    return filtered.map((item: any) => ({\n      ...item,\n      vendor_name: item.vendor_name,\n      total_items: (item.purchase_request_items || []).length,\n      progress_percentage: this.calculateProgress(item),\n      current_step: this.getCurrentStep(item),\n      next_action: this.getNextAction(item),\n      estimated_completion: this.estimateCompletion(item)\n    })) as MyRequestStatus[]\n  }\n\n  async getPendingApprovalsFromMemory(employee: Employee): Promise<PurchaseRequestWithDetails[]> {\n    const roles = this.parseRoles(employee.purchase_role)\n    if (roles.length === 0) return []\n\n    const purchases = this.getPurchaseMemory()\n\n    // ìµœì‹  ìˆœ ì •ë ¬ í›„ ì²˜ë¦¬ (ê¸°ì¡´ ì¿¼ë¦¬: request_date desc, limit 100)\n    const sorted = [...purchases].sort((a: any, b: any) => this.toTime(b.request_date) - this.toTime(a.request_date))\n\n    // ìŠ¹ì¸ ëŒ€ê¸°ì¸ í•­ëª©ë§Œ í•„í„°ë§\n    const filteredPending = sorted.filter((item: any) => {\n      const middlePending = this.isPendingStatus(item.middle_manager_status)\n      const finalPending = this.isPendingStatus(item.final_manager_status)\n\n      // ë°˜ë ¤ëœ ê²½ìš°ëŠ” ì œì™¸\n      const middleRejected = item.middle_manager_status === 'rejected'\n      const finalRejected = item.final_manager_status === 'rejected'\n      if (middleRejected || finalRejected) return false\n\n      return middlePending || finalPending\n    })\n\n    // ì—­í• ë³„ ê¶Œí•œì— ë”°ë¥¸ ì¶”ê°€ í•„í„°ë§\n    let roleFiltered = filteredPending\n\n    if (roles.includes('app_admin')) {\n      // all\n    } else if (roles.includes('middle_manager')) {\n      roleFiltered = filteredPending.filter((item: any) => this.isPendingStatus(item.middle_manager_status))\n    } else if (roles.includes('final_approver') || roles.includes('ceo')) {\n      roleFiltered = filteredPending.filter((item: any) => item.middle_manager_status === 'approved' && this.isPendingStatus(item.final_manager_status))\n    } else if (roles.includes('raw_material_manager') || roles.includes('consumable_manager')) {\n      roleFiltered = filteredPending.filter((item: any) => item.middle_manager_status === 'approved' && this.isPendingStatus(item.final_manager_status))\n    } else if (roles.includes('lead buyer')) {\n      roleFiltered = filteredPending.filter((item: any) => item.final_manager_status === 'approved' && !item.is_payment_completed)\n    } else {\n      roleFiltered = []\n    }\n\n    // ë°ì´í„° ê°€ê³µ: total_amount ë³´ê°•\n    const enhanced = roleFiltered.slice(0, 100).map((item: any) => {\n      const items = item.purchase_request_items || item.items || []\n      const total_amount = Number(item.total_amount) || items.reduce((sum: number, i: any) => {\n        const amount = Number(i?.amount_value) || (Number(i?.quantity) || 0) * (Number(i?.unit_price_value) || 0)\n        return sum + amount\n      }, 0)\n\n      return {\n        ...item,\n        purchase_request_items: items,\n        items,\n        total_amount,\n        vendor_name: item.vendor_name || item.project_vendor || item.vendor?.vendor_name\n      }\n    })\n\n    return enhanced as PurchaseRequestWithDetails[]\n  }\n\n  async getQuickActionsFromMemory(employee: Employee): Promise<QuickAction[]> {\n    const roles = this.parseRoles(employee.purchase_role)\n    const actions: QuickAction[] = []\n\n    if (roles.includes('app_admin') || roles.includes('middle_manager') || roles.includes('final_approver') || roles.includes('ceo')) {\n      const pendingCount = await this.getPendingCountFromMemory(employee, roles)\n      if (pendingCount > 0) {\n        actions.push({\n          id: 'approve',\n          type: 'approve',\n          label: 'ìŠ¹ì¸ ëŒ€ê¸°',\n          description: `${pendingCount}ê±´ì˜ ìŠ¹ì¸ ëŒ€ê¸° ì¤‘`,\n          count: pendingCount,\n          color: 'red'\n        })\n      }\n    }\n\n    if (roles.includes('lead buyer') || roles.includes('lead buyer')) {\n      const purchases = this.getPurchaseMemory()\n      const purchaseCount = purchases.filter((p: any) => p.final_manager_status === 'approved' && p.is_payment_completed === false).length\n      if (purchaseCount > 0) {\n        actions.push({\n          id: 'purchase',\n          type: 'purchase',\n          label: 'êµ¬ë§¤ ì²˜ë¦¬',\n          description: `${purchaseCount}ê±´ì˜ êµ¬ë§¤ ëŒ€ê¸° ì¤‘`,\n          count: purchaseCount,\n          color: 'yellow'\n        })\n      }\n    }\n\n    return actions\n  }\n\n  async getTodaySummaryFromMemory(employee: Employee) {\n    const purchases = this.getPurchaseMemory()\n    const today = new Date().toISOString().split('T')[0]\n    const tomorrow = new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString().split('T')[0]\n\n    const inRange = (ts?: string | null) => {\n      const t = this.toTime(ts)\n      return t >= this.toTime(today) && t < this.toTime(tomorrow)\n    }\n\n    const approved = purchases.filter((p: any) => inRange(p.updated_at) && (p.middle_manager_status === 'approved' || p.final_manager_status === 'approved')).length\n    const requested = purchases.filter((p: any) => (p.requester_name || '') === employee.name && inRange(p.created_at)).length\n    const received = purchases.filter((p: any) => p.is_received === true && inRange(p.received_at)).length\n\n    return { approved, requested, received }\n  }\n\n  async getMyPurchaseStatusFromMemory(employee: Employee): Promise<{ waitingPurchase: PurchaseRequestWithDetails[], waitingDelivery: PurchaseRequestWithDetails[], recentCompleted: PurchaseRequestWithDetails[] }> {\n    const roles = this.parseRoles(employee.purchase_role)\n    const isLeadBuyer = roles.includes('lead buyer') || roles.includes('app_admin')\n\n    const requesterName = employee.name || employee.email\n    const purchases = this.getPurchaseMemory()\n    const sevenDaysAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString()\n\n    // lead buyer/app_admin: ì „ì²´, ê·¸ ì™¸: ë³¸ì¸ ê²ƒë§Œ\n    const allMyRequests = isLeadBuyer\n      ? purchases\n      : purchases.filter((p: any) => (p.requester_name || '') === requesterName)\n\n    const waitingPurchase = allMyRequests.filter((item: any) => {\n      const category = (item.payment_category || '').trim()\n      const isPurchaseRequest = category === 'êµ¬ë§¤ ìš”ì²­'\n      const notPaid = !item.is_payment_completed\n      if (!isPurchaseRequest || !notPaid) return false\n\n      const isSeonJin = (item.progress_type || '').includes('ì„ ì§„í–‰')\n      if (isSeonJin) return true\n\n      const isIlban = (item.progress_type || '').includes('ì¼ë°˜') || !item.progress_type || item.progress_type === ''\n      const finalApproved = item.final_manager_status === 'approved'\n      return isIlban && finalApproved\n    })\n\n    const waitingDelivery = purchases.filter((item: any) => {\n      const notReceived = !item.is_received\n      const isSeonJin = (item.progress_type || '').includes('ì„ ì§„í–‰')\n\n      // ì…ê³  ëŒ€ê¸°ëŠ” í•­ìƒ ë³¸ì¸ ê²ƒë§Œ (ê¸°ì¡´ ë¡œì§)\n      if ((item.requester_name || '') !== requesterName) return false\n\n      if (notReceived && isSeonJin) return true\n\n      const finalApproved = item.final_manager_status === 'approved'\n      return notReceived && finalApproved\n    })\n\n    const recentCompleted = purchases.filter((item: any) => {\n      if (item.is_received !== true) return false\n      if (!item.received_at) return false\n      if ((item.requester_name || '') !== requesterName) return false\n      return this.toTime(item.received_at) >= this.toTime(sevenDaysAgo)\n    })\n\n    // ëŒ€ì‹œë³´ë“œ UIìš©: ìµœì‹ ìˆœ ì •ë ¬ (created_at desc)\n    const sortDesc = (a: any, b: any) => this.toTime(b.created_at) - this.toTime(a.created_at)\n\n    return {\n      waitingPurchase: [...waitingPurchase].sort(sortDesc) as any,\n      waitingDelivery: [...waitingDelivery].sort(sortDesc) as any,\n      recentCompleted: [...recentCompleted].sort(sortDesc) as any\n    }\n  }\n\n  private async getPendingCountFromMemory(employee: Employee, roles: string[]): Promise<number> {\n    const purchases = this.getPurchaseMemory()\n\n    if (roles.includes('app_admin')) {\n      const mid = purchases.filter((p: any) => this.isPendingStatus(p.middle_manager_status)).length\n      const fin = purchases.filter((p: any) => p.middle_manager_status === 'approved' && this.isPendingStatus(p.final_manager_status)).length\n      const pur = purchases.filter((p: any) => p.final_manager_status === 'approved' && p.is_payment_completed === false).length\n      return mid + fin + pur\n    }\n\n    if (roles.includes('middle_manager')) {\n      return purchases.filter((p: any) => this.isPendingStatus(p.middle_manager_status)).length\n    }\n\n    if (roles.includes('final_approver') || roles.includes('ceo')) {\n      return purchases.filter((p: any) => p.middle_manager_status === 'approved' && this.isPendingStatus(p.final_manager_status)).length\n    }\n\n    if (roles.includes('lead buyer')) {\n      return purchases.filter((p: any) => p.final_manager_status === 'approved' && p.is_payment_completed === false).length\n    }\n\n    return 0\n  }\n\n  private getUrgentCountFromMemory(employee: Employee, roles: string[], threeDaysAgoIso: string): number {\n    const purchases = this.getPurchaseMemory()\n    const threeDaysAgo = this.toTime(threeDaysAgoIso)\n\n    const base = purchases.filter((p: any) => this.toTime(p.created_at) > 0 && this.toTime(p.created_at) < threeDaysAgo)\n\n    if (roles.includes('app_admin')) {\n      return base.filter((p: any) =>\n        p.middle_manager_status === 'pending' ||\n        p.final_manager_status === 'pending' ||\n        p.is_payment_completed === false\n      ).length\n    }\n    if (roles.includes('middle_manager')) {\n      return base.filter((p: any) => p.middle_manager_status === 'pending').length\n    }\n    if (roles.includes('final_approver') || roles.includes('ceo')) {\n      return base.filter((p: any) => p.middle_manager_status === 'approved' && p.final_manager_status === 'pending').length\n    }\n    if (roles.includes('lead buyer')) {\n      return base.filter((p: any) => p.final_manager_status === 'approved' && p.is_payment_completed === false).length\n    }\n    return 0\n  }\n\n  private getTodayActionsCountFromMemory(employee: Employee, todayIsoDate: string): number {\n    const purchases = this.getPurchaseMemory()\n    const tomorrowIsoDate = new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString().split('T')[0]\n\n    const inRange = (ts?: string | null) => {\n      const t = this.toTime(ts)\n      return t >= this.toTime(todayIsoDate) && t < this.toTime(tomorrowIsoDate)\n    }\n\n    return purchases.filter((p: any) => inRange(p.updated_at) && (p.requester_name || '') === employee.name).length\n  }\n\n  // í†µê³„ ì •ë³´ (ìš°ì„ ìˆœìœ„ ì¬ì •ë ¬)\n  async getDashboardStats(employee: Employee): Promise<DashboardStats> {\n    const today = new Date().toISOString().split('T')[0]\n    const roles = this.parseRoles(employee.purchase_role)\n\n\n    // ë³‘ë ¬ ì¿¼ë¦¬ë¡œ ì„±ëŠ¥ ìµœì í™”\n    const [\n      totalResult,\n      myRequestsResult,\n      pendingResult,\n      completedResult,\n      urgentResult,\n      todayActionsResult\n    ] = await Promise.all([\n      // ì „ì²´ ìš”ì²­ ìˆ˜\n      this.supabase\n        .from('purchase_requests')\n        .select('id', { count: 'exact', head: true }),\n\n      // ë‚´ ìš”ì²­ ìˆ˜\n      this.supabase\n        .from('purchase_requests')\n        .select('id', { count: 'exact', head: true })\n        .eq('requester_name', employee.name),\n\n      // ë‚´ê°€ ì²˜ë¦¬í•´ì•¼ í•  ìŠ¹ì¸ ëŒ€ê¸°\n      this.getPendingCount(employee, roles),\n\n      // ì´ë²ˆ ë‹¬ ì™„ë£Œëœ ìš”ì²­ ìˆ˜  \n      this.supabase\n        .from('purchase_requests')\n        .select('id', { count: 'exact', head: true })\n        .eq('is_received', true)\n        .gte('received_at', new Date(new Date().getFullYear(), new Date().getMonth(), 1).toISOString()),\n\n      // ê¸´ê¸‰ ìš”ì²­ ìˆ˜ (3ì¼ ì´ìƒ ëŒ€ê¸°)\n      this.getUrgentCount(employee, roles),\n\n      // ì˜¤ëŠ˜ ì²˜ë¦¬í•œ ì•¡ì…˜ ìˆ˜\n      this.getTodayActionsCount(employee, today)\n    ])\n\n    const stats = {\n      total: totalResult.count || 0,\n      myRequests: myRequestsResult.count || 0,\n      pending: pendingResult,\n      completed: completedResult.count || 0,\n      urgent: urgentResult,\n      todayActions: todayActionsResult\n    }\n\n    return stats\n  }\n\n  // ë‚´ ìµœê·¼ ìš”ì²­ ìƒíƒœ (ìŠ¹ì¸ ì§„í–‰ì¤‘ì¸ í•­ëª©ë§Œ - ìŠ¹ì¸ ëŒ€ê¸°ëŠ” ì œì™¸) - ì´ë¯¸ JOIN ìµœì í™”ë¨\n  async getMyRecentRequests(employee: Employee): Promise<MyRequestStatus[]> {\n    const { data } = await this.supabase\n      .from('purchase_requests')\n      .select('*,vendors(vendor_name),purchase_request_items(id)')\n      .eq('requester_name', employee.name)\n      // ìŠ¹ì¸ì´ ì§„í–‰ì¤‘ì¸ í•­ëª©ë§Œ (1ì°¨ ìŠ¹ì¸ë¨ + ìµœì¢… ëŒ€ê¸°ì¤‘ OR ëª¨ë“  ìŠ¹ì¸ ì™„ë£Œ + êµ¬ë§¤ ëŒ€ê¸°ì¤‘)\n      .or('and(middle_manager_status.eq.approved,final_manager_status.eq.pending),and(final_manager_status.eq.approved,is_payment_completed.eq.false)')\n      .order('created_at', { ascending: false })\n      .limit(5)\n\n    return (data || []).map((item: any) => ({\n      ...item,\n      vendor_name: item.vendors?.vendor_name,\n      total_items: item.purchase_request_items?.length || 0,\n      progress_percentage: this.calculateProgress(item),\n      current_step: this.getCurrentStep(item),\n      next_action: this.getNextAction(item),\n      estimated_completion: this.estimateCompletion(item)\n    })) as MyRequestStatus[]\n  }\n\n  // ìŠ¹ì¸ ëŒ€ê¸° í•­ëª© (ì „ì²´ ì¡°íšŒ) - JOIN ì¿¼ë¦¬ë¡œ N+1 ë¬¸ì œ í•´ê²°\n  async getPendingApprovals(employee: Employee): Promise<PurchaseRequestWithDetails[]> {\n    const roles = this.parseRoles(employee.purchase_role)\n\n    // ì—­í• ì´ ìˆëŠ” ì‚¬ìš©ìë§Œ ìŠ¹ì¸ ëŒ€ê¸° í•­ëª©ì„ ë³¼ ìˆ˜ ìˆìŒ\n    if (roles.length === 0) {\n      return []\n    }\n\n    logger.debug('ğŸš€ ìŠ¹ì¸ ëŒ€ê¸° í•­ëª© ì¡°íšŒ ì‹œì‘', {\n      employeeName: employee.name,\n      employeeRoles: roles\n    })\n\n    // âœ… N+1 ë¬¸ì œ í•´ê²°: JOINì„ ì‚¬ìš©í•˜ì—¬ í•œ ë²ˆì˜ ì¿¼ë¦¬ë¡œ ëª¨ë“  ê´€ë ¨ ë°ì´í„° ì¡°íšŒ\n    const { data: allRequests, error: requestsError } = await this.supabase\n      .from('purchase_requests')\n      .select(`\n        *,\n        vendors(vendor_name),\n        purchase_request_items(\n          id,\n          item_name,\n          specification,\n          quantity,\n          unit_price_value,\n          amount_value\n        )\n      `)\n      .order('request_date', { ascending: false })\n      .limit(100) // ì„±ëŠ¥ ìµœì í™”: 100ê°œë¡œ ì œí•œ\n\n    if (requestsError) {\n      logger.error('âŒ ìŠ¹ì¸ ëŒ€ê¸° í•­ëª© ì¡°íšŒ ì‹¤íŒ¨', requestsError)\n      return []\n    }\n\n    // í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œ ìŠ¹ì¸ ëŒ€ê¸° ìƒíƒœ í•„í„°ë§\n    let filteredData = allRequests || []\n\n    // pending, ëŒ€ê¸°, ë¹ˆë¬¸ìì—´, null ëª¨ë‘ ëŒ€ê¸°ë¡œ ì²˜ë¦¬\n    const isPending = (status: any) => (\n      status === 'pending' || status === 'ëŒ€ê¸°' || status === '' || status === null || status === undefined\n    )\n\n    logger.debug('ğŸ” ìŠ¹ì¸ ëŒ€ê¸° í•„í„°ë§ ì „ ë°ì´í„°', {\n      totalRequests: allRequests?.length || 0\n    })\n    \n    // ìŠ¹ì¸ ëŒ€ê¸°ì¸ í•­ëª©ë§Œ í•„í„°ë§\n    filteredData = filteredData.filter((item: any) => {\n      const middlePending = isPending(item.middle_manager_status)\n      const finalPending = isPending(item.final_manager_status)\n      \n      // ë°˜ë ¤ëœ ê²½ìš°ëŠ” ì œì™¸\n      const middleRejected = item.middle_manager_status === 'rejected'\n      const finalRejected = item.final_manager_status === 'rejected'\n      \n      if (middleRejected || finalRejected) return false\n      \n      // ì¤‘ê°„ìŠ¹ì¸ ëŒ€ê¸° ë˜ëŠ” ìµœì¢…ìŠ¹ì¸ ëŒ€ê¸°\n      return middlePending || finalPending\n    })\n\n    // ì—­í• ë³„ ê¶Œí•œì— ë”°ë¥¸ ì¶”ê°€ í•„í„°ë§\n    let roleFilteredData = filteredData\n    \n    if (roles.includes('app_admin')) {\n      // app_adminì€ ëª¨ë“  ìŠ¹ì¸ ëŒ€ê¸° í•­ëª© ë³¼ ìˆ˜ ìˆìŒ (í•„í„°ë§ ì—†ìŒ)\n      logger.debug('ğŸ”‘ app_admin ê¶Œí•œìœ¼ë¡œ ëª¨ë“  ìŠ¹ì¸ëŒ€ê¸° í•­ëª© í‘œì‹œ', {\n        totalItems: roleFilteredData.length\n      })\n    } else if (roles.includes('middle_manager')) {\n      // ì¤‘ê°„ìŠ¹ì¸ì: ì¤‘ê°„ìŠ¹ì¸ ëŒ€ê¸° í•­ëª©ë§Œ\n      roleFilteredData = filteredData.filter((item: any) => isPending(item.middle_manager_status))\n      logger.debug('ğŸ”‘ middle_manager ê¶Œí•œìœ¼ë¡œ ì¤‘ê°„ìŠ¹ì¸ ëŒ€ê¸° í•­ëª©ë§Œ í‘œì‹œ', {\n        beforeFilter: filteredData.length,\n        afterFilter: roleFilteredData.length\n      })\n    } else if (roles.includes('final_approver') || roles.includes('ceo')) {\n      // ìµœì¢…ìŠ¹ì¸ì: ì¤‘ê°„ìŠ¹ì¸ ì™„ë£Œ + ìµœì¢…ìŠ¹ì¸ ëŒ€ê¸° í•­ëª©ë§Œ\n      roleFilteredData = filteredData.filter((item: any) => {\n        const middleApproved = item.middle_manager_status === 'approved'\n        const finalPending = isPending(item.final_manager_status)\n        return middleApproved && finalPending\n      })\n      logger.debug('ğŸ”‘ final_approver/ceo ê¶Œí•œìœ¼ë¡œ ìµœì¢…ìŠ¹ì¸ ëŒ€ê¸° í•­ëª©ë§Œ í‘œì‹œ', {\n        beforeFilter: filteredData.length,\n        afterFilter: roleFilteredData.length\n      })\n    } else if (roles.includes('raw_material_manager') || roles.includes('consumable_manager')) {\n      // ì›ìì¬/ì†Œëª¨í’ˆ ë§¤ë‹ˆì €: ìµœì¢…ìŠ¹ì¸ìì™€ ë™ì¼í•œ ê¶Œí•œ\n      roleFilteredData = filteredData.filter((item: any) => {\n        const middleApproved = item.middle_manager_status === 'approved'\n        const finalPending = isPending(item.final_manager_status)\n        return middleApproved && finalPending\n      })\n      logger.debug('ğŸ”‘ material_manager ê¶Œí•œìœ¼ë¡œ ìµœì¢…ìŠ¹ì¸ ëŒ€ê¸° í•­ëª©ë§Œ í‘œì‹œ', {\n        beforeFilter: filteredData.length,\n        afterFilter: roleFilteredData.length\n      })\n    } else if (roles.includes('lead buyer')) {\n      // êµ¬ë§¤ë‹´ë‹¹ì: ìµœì¢…ìŠ¹ì¸ ì™„ë£Œ + êµ¬ë§¤ ëŒ€ê¸° í•­ëª©ë§Œ\n      roleFilteredData = filteredData.filter((item: any) => {\n        const finalApproved = item.final_manager_status === 'approved'\n        const purchasePending = !item.is_payment_completed\n        return finalApproved && purchasePending\n      })\n      logger.debug('ğŸ”‘ lead buyer ê¶Œí•œìœ¼ë¡œ êµ¬ë§¤ ëŒ€ê¸° í•­ëª©ë§Œ í‘œì‹œ', {\n        beforeFilter: filteredData.length,\n        afterFilter: roleFilteredData.length\n      })\n    } else {\n      // ê¸°íƒ€ ì—­í• ì€ ìŠ¹ì¸ ê¶Œí•œ ì—†ìŒ\n      roleFilteredData = []\n      logger.debug('ğŸ”‘ ìŠ¹ì¸ ê¶Œí•œ ì—†ëŠ” ì—­í• ', { roles, result: 'empty' })\n    }\n\n    // âœ… ë°ì´í„° ê°€ê³µ: JOINìœ¼ë¡œ ê°€ì ¸ì˜¨ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì²˜ë¦¬\n    const enhancedData = roleFilteredData.map((item: any) => {\n      // vendor_name ì²˜ë¦¬ (JOIN ê²°ê³¼ ì‚¬ìš©)\n      const vendor_name = item.vendors?.vendor_name || item.vendor_name || 'ì—…ì²´ ì •ë³´ ì—†ìŒ'\n      \n      // purchase_request_items ì²˜ë¦¬ (ì´ë¯¸ JOINìœ¼ë¡œ ê°€ì ¸ì˜´)\n      const purchase_request_items = item.purchase_request_items || []\n      \n      // total_amount ê³„ì‚°\n      const total_amount = purchase_request_items.reduce((sum: number, i: any) => {\n        const amount = Number(i?.amount_value) || (Number(i?.quantity) || 0) * (Number(i?.unit_price_value) || 0)\n        return sum + amount\n      }, 0)\n\n      return {\n        ...item,\n        vendor_name,\n        purchase_request_items,\n        total_amount\n      }\n    })\n    \n    logger.debug('âœ… ìŠ¹ì¸ ëŒ€ê¸° í•­ëª© ì¡°íšŒ ì™„ë£Œ (ìµœì í™”ë¨)', {\n      finalCount: enhancedData.length,\n      performanceNote: 'N+1 ë¬¸ì œ í•´ê²° - ë‹¨ì¼ JOIN ì¿¼ë¦¬ ì‚¬ìš©'\n    })\n\n    return enhancedData\n  }\n\n  // ë¹ ë¥¸ ì•¡ì…˜ ë²„íŠ¼ ë°ì´í„°\n  async getQuickActions(employee: Employee): Promise<QuickAction[]> {\n    const roles = this.parseRoles(employee.purchase_role)\n\n    const actions: QuickAction[] = []\n\n    // ìŠ¹ì¸ ê¶Œí•œì´ ìˆëŠ” ê²½ìš°\n    if (roles.includes('app_admin') || roles.includes('middle_manager') || roles.includes('final_approver') || roles.includes('ceo')) {\n      const pendingCount = await this.getPendingCount(employee, roles)\n      if (pendingCount > 0) {\n        actions.push({\n          id: 'approve',\n          type: 'approve',\n          label: 'ìŠ¹ì¸ ëŒ€ê¸°',\n          description: `${pendingCount}ê±´ì˜ ìŠ¹ì¸ ëŒ€ê¸° ì¤‘`,\n          count: pendingCount,\n          color: 'red'\n        })\n      }\n    }\n\n    // êµ¬ë§¤ ê¶Œí•œì´ ìˆëŠ” ê²½ìš°\n    if (roles.includes('lead buyer') || roles.includes('lead buyer')) {\n      const { count: purchaseCount } = await this.supabase\n        .from('purchase_requests')\n        .select('id', { count: 'exact', head: true })\n        .eq('final_manager_status', 'approved')\n        .eq('is_payment_completed', false)\n\n      if (purchaseCount && purchaseCount > 0) {\n        actions.push({\n          id: 'purchase',\n          type: 'purchase',\n          label: 'êµ¬ë§¤ ì²˜ë¦¬',\n          description: `${purchaseCount}ê±´ì˜ êµ¬ë§¤ ëŒ€ê¸° ì¤‘`,\n          count: purchaseCount,\n          color: 'yellow'\n        })\n      }\n    }\n\n    return actions\n  }\n\n  // ì˜¤ëŠ˜ ìš”ì•½ ì •ë³´\n  async getTodaySummary(employee: Employee) {\n    const today = new Date().toISOString().split('T')[0]\n    const tomorrow = new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString().split('T')[0]\n\n    const [approvedResult, requestedResult, receivedResult] = await Promise.all([\n      // ì˜¤ëŠ˜ ë‚´ê°€ ìŠ¹ì¸í•œ ê±´ìˆ˜\n      this.supabase\n        .from('purchase_requests')\n        .select('id', { count: 'exact', head: true })\n        .gte('updated_at', today)\n        .lt('updated_at', tomorrow)\n        .or('middle_manager_status.eq.approved,final_manager_status.eq.approved'),\n\n      // ì˜¤ëŠ˜ ë‚´ê°€ ìš”ì²­í•œ ê±´ìˆ˜\n      this.supabase\n        .from('purchase_requests')\n        .select('id', { count: 'exact', head: true })\n        .eq('requester_name', employee.name)\n        .gte('created_at', today)\n        .lt('created_at', tomorrow),\n\n      // ì˜¤ëŠ˜ ì…ê³  ì²˜ë¦¬í•œ ê±´ìˆ˜\n      this.supabase\n        .from('purchase_requests')\n        .select('id', { count: 'exact', head: true })\n        .eq('is_received', true)\n        .gte('received_at', today)\n        .lt('received_at', tomorrow)\n    ])\n\n    return {\n      approved: approvedResult.count || 0,\n      requested: requestedResult.count || 0,\n      received: receivedResult.count || 0\n    }\n  }\n\n  // ë‚´ êµ¬ë§¤/ì…ê³  ìƒíƒœ í™•ì¸ - JOIN ì¿¼ë¦¬ë¡œ ìµœì í™”ë¨\n  async getMyPurchaseStatus(employee: Employee): Promise<{ waitingPurchase: PurchaseRequestWithDetails[], waitingDelivery: PurchaseRequestWithDetails[], recentCompleted: PurchaseRequestWithDetails[] }> {\n    \n    const roles = this.parseRoles(employee.purchase_role)\n    const isLeadBuyer = roles.includes('lead buyer') || roles.includes('app_admin')\n    \n    // nameì´ ì—†ìœ¼ë©´ email ì‚¬ìš©\n    const requesterName = employee.name || employee.email\n    \n    const sevenDaysAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString()\n\n    // âœ… JOINì„ ì‚¬ìš©í•˜ì—¬ í•œ ë²ˆì˜ ì¿¼ë¦¬ë¡œ ëª¨ë“  ê´€ë ¨ ë°ì´í„° ì¡°íšŒ\n    // lead buyer ë˜ëŠ” app_adminì€ ëª¨ë“  í•­ëª© ì¡°íšŒ, ê·¸ ì™¸ëŠ” ë³¸ì¸ ê²ƒë§Œ\n    // PurchaseItemsModalê³¼ ë™ì¼í•œ ë°ì´í„° êµ¬ì¡°ë¥¼ ìœ„í•´ purchase_request_items ì „ì²´ í•„ë“œ ì¡°íšŒ\n    let query = this.supabase\n      .from('purchase_requests')\n      .select('*,vendors(vendor_name),purchase_request_items(*)')\n      .order('created_at', { ascending: false })\n      .limit(500)  // ì¶©ë¶„í•œ ê°œìˆ˜ë¡œ ì¦ê°€\n    \n    if (!isLeadBuyer) {\n      query = query.eq('requester_name', requesterName)\n    }\n    \n    const myRequests = await query\n\n    if (myRequests.error) {\n      logger.error('getMyPurchaseStatus ì—ëŸ¬', myRequests.error)\n      return {\n        waitingPurchase: [],\n        waitingDelivery: [],\n        recentCompleted: []\n      }\n    }\n\n    const allMyRequests = myRequests.data || []\n    \n\n    // í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ í•„í„°ë§ (PurchaseListMain êµ¬ë§¤/ì…ê³  íƒ­ê³¼ ë™ì¼í•œ ë¡œì§)\n    \n    const waitingPurchase = allMyRequests.filter((item: any) => {\n      // êµ¬ë§¤ ëŒ€ê¸°: êµ¬ë§¤ ìš”ì²­ + ê²°ì œ ë¯¸ì™„ë£Œ + (ì„ ì§„í–‰ì´ê±°ë‚˜ ìµœì¢…ìŠ¹ì¸ì™„ë£Œ)\n      const category = (item.payment_category || '').trim()\n      const isPurchaseRequest = category === 'êµ¬ë§¤ ìš”ì²­'\n      const notPaid = !item.is_payment_completed\n      \n      // êµ¬ë§¤ ìš”ì²­ì´ ì•„ë‹ˆê±°ë‚˜ ì´ë¯¸ ê²°ì œ ì™„ë£Œëœ ê²ƒì€ ì œì™¸\n      if (!isPurchaseRequest || !notPaid) return false\n      \n      const isSeonJin = (item.progress_type || '').includes('ì„ ì§„í–‰')\n      \n      // ì„ ì§„í–‰ì€ ìŠ¹ì¸ ìƒíƒœì™€ ë¬´ê´€í•˜ê²Œ êµ¬ë§¤ ëŒ€ê¸°\n      if (isSeonJin) {\n        return true\n      }\n      \n      // ì¼ë°˜ì€ ìµœì¢… ìŠ¹ì¸ ì™„ë£Œë˜ì–´ì•¼ êµ¬ë§¤ ëŒ€ê¸°\n      const isIlban = (item.progress_type || '').includes('ì¼ë°˜') || !item.progress_type || item.progress_type === ''\n      const finalApproved = item.final_manager_status === 'approved'\n      \n      return isIlban && finalApproved\n    })\n\n\n    const waitingDelivery = allMyRequests.filter((item: any) => {\n      // ì…ê³  íƒ­ ë¡œì§: ì…ê³  ë¯¸ì™„ë£Œ + ì„ ì§„í–‰(ìŠ¹ì¸ë¬´ê´€) OR ìµœì¢…ìŠ¹ì¸\n      const notReceived = !item.is_received\n      const isSeonJin = (item.progress_type || '').includes('ì„ ì§„í–‰')\n      \n      // ì…ê³  ëŒ€ê¸°ëŠ” í•­ìƒ ë³¸ì¸ ê²ƒë§Œ (lead buyerë„ ë³¸ì¸ ê²ƒë§Œ)\n      if (item.requester_name !== requesterName) {\n        return false\n      }\n      \n      // ì„ ì§„í–‰ì€ ìŠ¹ì¸ ìƒíƒœì™€ ë¬´ê´€í•˜ê²Œ ì…ê³  ëŒ€ê¸°\n      if (notReceived && isSeonJin) {\n        return true\n      }\n      \n      // ì¼ë°˜ì€ ìµœì¢… ìŠ¹ì¸ ì™„ë£Œë˜ì–´ì•¼ ì…ê³  ëŒ€ê¸°\n      const finalApproved = item.final_manager_status === 'approved'\n      \n      return notReceived && finalApproved\n    })\n\n\n    const recentCompleted = allMyRequests.filter((item: any) => {\n      // ì…ê³  ì™„ë£Œ && 7ì¼ ì´ë‚´ && ë³¸ì¸ ê²ƒë§Œ\n      if (item.is_received !== true) return false\n      if (!item.received_at) return false\n      if (item.requester_name !== requesterName) return false\n      \n      const receivedDate = new Date(item.received_at)\n      const sevenDaysAgoDate = new Date(sevenDaysAgo)\n      return receivedDate >= sevenDaysAgoDate\n    })\n\n\n    return {\n      waitingPurchase: waitingPurchase,\n      waitingDelivery: waitingDelivery,\n      recentCompleted: recentCompleted\n    }\n  }\n\n  // ì›í´ë¦­ ìŠ¹ì¸ API\n  async quickApprove(requestId: string, employee: Employee): Promise<{success: boolean, error?: string}> {\n    \n    try {\n      const roles = this.parseRoles(employee.purchase_role)\n\n      // ë¨¼ì € í˜„ì¬ ìš”ì²­ì˜ ìƒíƒœë¥¼ í™•ì¸\n      const { data: request } = await this.supabase\n        .from('purchase_requests')\n        .select('middle_manager_status, final_manager_status')\n        .eq('id', requestId)\n        .single()\n\n      if (!request) {\n        return { success: false, error: 'ìš”ì²­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.' }\n      }\n      \n\n      let updateData: any = {}\n\n      // pending, ëŒ€ê¸°, null, ë¹ˆ ë¬¸ìì—´ ëª¨ë‘ ëŒ€ê¸° ìƒíƒœë¡œ ê°„ì£¼\n      const isPending = (status: any) => (\n        status === 'pending' || status === 'ëŒ€ê¸°' || status === '' || status === null || status === undefined\n      )\n\n      // app_adminì€ í˜„ì¬ í•„ìš”í•œ ìŠ¹ì¸ ë‹¨ê³„ë¥¼ ì²˜ë¦¬\n      if (roles.includes('app_admin')) {\n        if (isPending(request.middle_manager_status)) {\n          updateData = {\n            middle_manager_status: 'approved'\n          }\n        } else if (request.middle_manager_status === 'approved' && isPending(request.final_manager_status)) {\n          updateData = {\n            final_manager_status: 'approved'\n          }\n        }\n      } else if (roles.includes('middle_manager')) {\n        if (isPending(request.middle_manager_status)) {\n          updateData = {\n            middle_manager_status: 'approved'\n          }\n        }\n      } else if (roles.includes('final_approver') || roles.includes('ceo')) {\n        if (request.middle_manager_status === 'approved' && isPending(request.final_manager_status)) {\n          updateData = {\n            final_manager_status: 'approved'\n          }\n        }\n      } else if (roles.includes('raw_material_manager') || roles.includes('consumable_manager')) {\n        // raw_material_managerì™€ consumable_managerë„ ìµœì¢… ìŠ¹ì¸ ê¶Œí•œì´ ìˆìŒ\n        if (request.middle_manager_status === 'approved' && isPending(request.final_manager_status)) {\n          updateData = {\n            final_manager_status: 'approved'\n          }\n        }\n      }\n\n      // updateDataê°€ ë¹„ì–´ìˆìœ¼ë©´ ìŠ¹ì¸í•  ë‹¨ê³„ê°€ ì—†ìŒ\n      if (Object.keys(updateData).length === 0) {\n        return { success: false, error: 'ìŠ¹ì¸í•  ìˆ˜ ìˆëŠ” ìƒíƒœê°€ ì•„ë‹™ë‹ˆë‹¤.' }\n      }\n      \n\n      const { data: updatedData, error } = await this.supabase\n        .from('purchase_requests')\n        .update(updateData)\n        .eq('id', requestId)\n        .select()\n        .single()\n\n      if (error) {\n        // Error details are handled by the caller\n        throw error\n      }\n\n      return { success: true }\n    } catch (error) {\n      return { success: false, error: (error as Error).message }\n    }\n  }\n\n  // Helper methods\n  private async getPendingCount(employee: Employee, roles: string[]): Promise<number> {\n    // ê³µí†µ: 'ëŒ€ê¸°', null, ë¹ˆ ë¬¸ìì—´ë„ ëŒ€ê¸° ìƒíƒœë¡œ ê°„ì£¼\n    const pendingClause = (col: string) => (\n      `${col}.in.(pending,ëŒ€ê¸°),${col}.is.null`\n    )\n\n    // ì—­í• ë³„ ì¹´ìš´íŠ¸ ì¿¼ë¦¬ êµ¬ì„±\n    if (roles.includes('app_admin')) {\n      // 1) ì¤‘ê°„ ìŠ¹ì¸ ëŒ€ê¸° + 2) ìµœì¢… ìŠ¹ì¸ ëŒ€ê¸°(ì¤‘ê°„ ìŠ¹ì¸ ì™„ë£Œ) + 3) êµ¬ë§¤ ëŒ€ê¸°(ìµœì¢… ìŠ¹ì¸ ì™„ë£Œ)\n      const [mid, fin, pur] = await Promise.all([\n        this.supabase\n          .from('purchase_requests')\n          .select('id', { count: 'exact', head: true })\n          .or(`middle_manager_status.in.(pending,ëŒ€ê¸°),middle_manager_status.is.null`),\n        this.supabase\n          .from('purchase_requests')\n          .select('id', { count: 'exact', head: true })\n          .eq('middle_manager_status', 'approved')\n          .or(`final_manager_status.in.(pending,ëŒ€ê¸°),final_manager_status.is.null`),\n        this.supabase\n          .from('purchase_requests')\n          .select('id', { count: 'exact', head: true })\n          .eq('final_manager_status', 'approved')\n          .eq('is_payment_completed', false)\n      ])\n\n      const total = (mid.count || 0) + (fin.count || 0) + (pur.count || 0)\n      return total\n    }\n\n    if (roles.includes('middle_manager')) {\n      const { count, error } = await this.supabase\n        .from('purchase_requests')\n        .select('id', { count: 'exact', head: true })\n        .or(`middle_manager_status.in.(pending,ëŒ€ê¸°),middle_manager_status.is.null`)\n\n      if (error) {\n        // Count error for middle_manager - will use 0\n        return 0\n      }\n      return count || 0\n    }\n\n    if (roles.includes('final_approver') || roles.includes('ceo')) {\n      const { count, error } = await this.supabase\n        .from('purchase_requests')\n        .select('id', { count: 'exact', head: true })\n        .eq('middle_manager_status', 'approved')\n        .or(`final_manager_status.in.(pending,ëŒ€ê¸°),final_manager_status.is.null`)\n\n      if (error) {\n        // Count error for final_approver/ceo - will use 0\n        return 0\n      }\n      return count || 0\n    }\n\n    if (roles.includes('lead buyer')) {\n      const { count, error } = await this.supabase\n        .from('purchase_requests')\n        .select('id', { count: 'exact', head: true })\n        .eq('final_manager_status', 'approved')\n        .eq('is_payment_completed', false)\n\n      if (error) {\n        // Count error for lead buyer - will use 0\n        return 0\n      }\n      return count || 0\n    }\n\n    return 0\n  }\n\n  private async getUrgentCount(employee: Employee, roles: string[]): Promise<number> {\n    // ì—­í• ì´ ì—†ìœ¼ë©´ ê¸´ê¸‰ ìš”ì²­ ì¹´ìš´íŠ¸ë„ 0\n    if (roles.length === 0) {\n      return 0\n    }\n\n    const threeDaysAgo = new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString()\n    \n    let query = this.supabase\n      .from('purchase_requests')\n      .select('id', { count: 'exact', head: true })\n      .lt('created_at', threeDaysAgo)\n\n    if (roles.includes('app_admin')) {\n      query = query.or('middle_manager_status.eq.pending,final_manager_status.eq.pending,is_payment_completed.eq.false')\n    } else if (roles.includes('middle_manager')) {\n      query = query.eq('middle_manager_status', 'pending')\n    } else if (roles.includes('final_approver') || roles.includes('ceo')) {\n      query = query\n        .eq('middle_manager_status', 'approved')\n        .eq('final_manager_status', 'pending')\n    } else if (roles.includes('lead buyer')) {\n      query = query\n        .eq('final_manager_status', 'approved')\n        .eq('is_payment_completed', false)\n    } else {\n      return 0\n    }\n\n    const { count } = await query\n    return count || 0\n  }\n\n  private async getTodayActionsCount(employee: Employee, today: string): Promise<number> {\n    // middle_manager_idì™€ final_manager_id ì»¬ëŸ¼ì´ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ\n    // ì˜¤ëŠ˜ ì—…ë°ì´íŠ¸ëœ ìš”ì²­ ì¤‘ í•´ë‹¹ ì§ì›ì´ ìš”ì²­í•œ ìš”ì²­ë§Œ ì¹´ìš´íŠ¸\n    const tomorrow = new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString().split('T')[0]\n    \n    const { count } = await this.supabase\n      .from('purchase_requests')\n      .select('id', { count: 'exact', head: true })\n      .gte('updated_at', today)\n      .lt('updated_at', tomorrow)\n      .eq('requester_name', employee.name)\n\n    return count || 0\n  }\n\n  // ì „ì²´ ì…ê³ ëŒ€ê¸° ê±´ìˆ˜ ì¡°íšŒ (ê¶Œí•œì— ê´€ê³„ì—†ì´ ì „ì²´ ì¡°íšŒ)\n  async getTotalDeliveryWaitingCount(): Promise<number> {\n    const { count } = await this.supabase\n      .from('purchase_requests')\n      .select('id', { count: 'exact', head: true })\n      .eq('is_received', false)\n      .or('is_payment_completed.eq.true,progress_type.ilike.%ì„ ì§„í–‰%')\n\n    return count || 0\n  }\n\n  private calculateProgress(request: any): number {\n    let progress = 0\n    \n    if (request.middle_manager_status === 'approved') progress += 25\n    if (request.final_manager_status === 'approved') progress += 25\n    if (request.is_payment_completed) progress += 25\n    if (request.is_received) progress += 25\n    \n    return progress\n  }\n\n  private getCurrentStep(request: any): 'approval' | 'purchase' | 'delivery' | 'payment' | 'completed' {\n    if (request.is_received) return 'completed'\n    if (request.is_payment_completed) return 'delivery'\n    if (request.final_manager_status === 'approved') return 'purchase'\n    return 'approval'\n  }\n\n  private getNextAction(request: any): string {\n    if (request.middle_manager_status === 'pending') return 'ì¤‘ê°„ ìŠ¹ì¸ ëŒ€ê¸° ì¤‘'\n    if (request.final_manager_status === 'pending') return 'ìµœì¢… ìŠ¹ì¸ ëŒ€ê¸° ì¤‘'\n    if (!request.is_payment_completed) return 'êµ¬ë§¤ ì²˜ë¦¬ ëŒ€ê¸° ì¤‘'\n    if (!request.is_received) return 'ì…ê³  ëŒ€ê¸° ì¤‘'\n    return 'ì™„ë£Œ'\n  }\n\n  private estimateCompletion(request: any): string {\n    const created = new Date(request.created_at)\n    const today = new Date()\n    const daysPassed = Math.floor((today.getTime() - created.getTime()) / (1000 * 60 * 60 * 24))\n    \n    // í‰ê·  ì²˜ë¦¬ ì‹œê°„ì„ ê¸°ë°˜ìœ¼ë¡œ ì˜ˆìƒ ì™„ë£Œì¼ ê³„ì‚°\n    let estimatedDays = 7 // ê¸°ë³¸ 7ì¼\n    if (request.progress_type === 'ê¸´ê¸‰') estimatedDays = 3\n    \n    const estimatedCompletion = new Date(created.getTime() + estimatedDays * 24 * 60 * 60 * 1000)\n    return estimatedCompletion.toLocaleDateString('ko-KR')\n  }\n\n  // lead buyer ë˜ëŠ” app_adminì„ ìœ„í•œ ë¯¸ë‹¤ìš´ë¡œë“œ ë°œì£¼ì„œ ëª©ë¡ ì¡°íšŒ - ì´ë¯¸ JOIN ìµœì í™”ë¨\n  async getUndownloadedOrders(employee: Employee): Promise<PurchaseRequestWithDetails[]> {\n    const roles = this.parseRoles(employee.purchase_role)\n    \n    // lead buyer ë˜ëŠ” app_admin ê¶Œí•œ ì²´í¬\n    if (!roles.includes('lead buyer') && !roles.includes('app_admin')) {\n      logger.info('[DashboardService] ë¯¸ë‹¤ìš´ë¡œë“œ ë°œì£¼ì„œ ì¡°íšŒ ê¶Œí•œ ì—†ìŒ:', { roles })\n      return []\n    }\n\n    // âœ… ë©”ëª¨ë¦¬ ìºì‹œê°€ ìˆìœ¼ë©´ DB ì¡°íšŒ ì—†ì´ ì¦‰ì‹œ ê³„ì‚° (ëŒ€ì‹œë³´ë“œ ì²´ê° ì†ë„ ê°œì„ )\n    if (this.hasValidPurchaseMemory(employee)) {\n      const purchases = this.getPurchaseMemory()\n        .filter((item: any) => item.is_po_download !== true) // NULL/false í¬í•¨\n        .sort((a: any, b: any) => this.toTime(b.created_at) - this.toTime(a.created_at))\n        .slice(0, 500)\n\n      const filteredData = purchases.filter((item: any) => {\n        if (item.is_po_download === true) return false\n        if (item.progress_type === 'ì„ ì§„í–‰') return true\n        return item.final_manager_status === 'approved'\n      })\n\n      return filteredData as any\n    }\n\n    try {\n      // ë¯¸ë‹¤ìš´ë¡œë“œ ë°œì£¼ì„œë§Œ ë¨¼ì € ê°€ì ¸ì˜¤ê¸° (NULLì´ê±°ë‚˜ falseì¸ ê²ƒë“¤)\n      const { data, error } = await this.supabase\n        .from('purchase_requests')\n        .select(`\n          *,\n          purchase_request_items(\n            id,\n            item_name,\n            specification,\n            quantity,\n            unit_price_value,\n            amount_value\n          )\n        `)\n        .or('is_po_download.is.null,is_po_download.eq.false')\n        .order('created_at', { ascending: false })  // ìµœì‹  ìˆœìœ¼ë¡œ ì •ë ¬\n        .limit(500)  // ë” ë§ì€ ë°ì´í„° ì¡°íšŒ\n\n      if (error) {\n        logger.error('[DashboardService] ë¯¸ë‹¤ìš´ë¡œë“œ ë°œì£¼ì„œ ì¡°íšŒ ì¿¼ë¦¬ ì—ëŸ¬:', error)\n        throw error\n      }\n\n      // í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œ ì¡°ê±´ì— ë§ëŠ” ê²ƒë§Œ í•„í„°ë§\n      const filteredData = (data || []).filter((item: any) => {\n        if (item.is_po_download === true) return false\n        if (item.progress_type === 'ì„ ì§„í–‰') return true\n        return item.final_manager_status === 'approved'\n      })\n\n      return filteredData\n    } catch (error) {\n      logger.error('[DashboardService] getUndownloadedOrders ì—ëŸ¬:', error)\n      throw error // ì—ëŸ¬ë¥¼ ìƒìœ„ë¡œ ì „íŒŒ\n    }\n  }\n}\n\nexport const dashboardService = new DashboardService()","\nimport { useState, useEffect, useCallback, useRef, useMemo } from 'react'\nimport { useAuth } from '@/contexts/AuthContext'\nimport { dashboardService } from '@/services/dashboardService'\nimport { createClient } from '@/lib/supabase/client'\nimport { updatePurchaseInMemory, addCacheListener, markPurchaseAsPaymentCompleted } from '@/stores/purchaseMemoryStore'\nimport { Button } from '@/components/ui/button'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Input } from '@/components/ui/input'\nimport { Clock, CheckCircle, ArrowRight, X, Package, Truck, ShoppingCart, Download, Search } from 'lucide-react'\nimport { downloadPurchaseOrderExcel } from '@/utils/excelDownload'\n\n// ëª¨ë“  ì¹´ë“œì—ì„œ ì‚¬ìš©í•˜ëŠ” ëª¨ë‹¬ (activeTabì— ë”°ë¼ ë‹¤ë¥¸ ë‚´ìš© í‘œì‹œ)\nimport PurchaseDetailModal from '@/components/purchase/PurchaseDetailModal'\n\nimport { toast } from 'sonner'\nimport type { DashboardData, Purchase } from '@/types/purchase'\nimport { useNavigate } from 'react-router-dom'\nimport { logger } from '@/lib/logger'\n\nexport default function DashboardMain() {\n  const [data, setData] = useState<DashboardData | null>(null)\n  const [loading, setLoading] = useState(true)\n  const [actionLoading, setActionLoading] = useState<string | null>(null)\n  const [currentUserRoles, setCurrentUserRoles] = useState<string[]>([])\n  const [undownloadedOrders, setUndownloadedOrders] = useState<any[]>([])\n  const [downloadingIds, setDownloadingIds] = useState<Set<string>>(new Set())\n  \n  const supabase = createClient()\n  \n  // PurchaseDetailModal ìƒíƒœ (ëª¨ë“  ì¹´ë“œì—ì„œ ì‚¬ìš©)\n  const [selectedPurchaseId, setSelectedPurchaseId] = useState<number | null>(null)\n  const [isModalOpen, setIsModalOpen] = useState(false)\n  const [modalActiveTab, setModalActiveTab] = useState<string>('pending') // ëª¨ë‹¬ì˜ activeTab ê°’\n  \n  // ê²€ìƒ‰ ìƒíƒœ\n  const [searchTerms, setSearchTerms] = useState({\n    undownloaded: '',\n    pending: '',\n    purchase: '',\n    delivery: ''\n  })\n  \n  const navigate = useNavigate()\n  const { employee, currentUserRoles: userRoles } = useAuth()\n\n  const loadDashboardData = useCallback(async (showLoading = true, forceRefresh = false) => {\n    if (!employee) {\n      logger.error('[DashboardMain] No employee data available')\n      if (showLoading) {\n        setLoading(false)\n      }\n      return\n    }\n\n    try {\n      if (showLoading && !forceRefresh && !data) {\n        setLoading(true)\n      }\n      \n      const dashboardData = await dashboardService.getDashboardData(employee, forceRefresh)\n      setData(dashboardData)\n      setCurrentUserRoles(userRoles)\n      \n      // lead buyer ë˜ëŠ” app_adminì¸ ê²½ìš° ë¯¸ë‹¤ìš´ë¡œë“œ í•­ëª© ì¡°íšŒ\n      if (userRoles.includes('lead buyer') || userRoles.includes('app_admin')) {\n        try {\n          const undownloaded = await dashboardService.getUndownloadedOrders(employee)\n          logger.info('[DashboardMain] ë¯¸ë‹¤ìš´ë¡œë“œ ë°œì£¼ì„œ ì¡°íšŒ ê²°ê³¼:', { \n            count: undownloaded.length,\n            userRoles,\n            employeeName: employee.name,\n            sampleItems: undownloaded.slice(0, 3).map(item => ({\n              purchase_order_number: item.purchase_order_number,\n              requester_name: item.requester_name,\n              vendor_name: item.vendor_name\n            }))\n          })\n          setUndownloadedOrders(undownloaded)\n        } catch (undownloadedError) {\n          logger.error('[DashboardMain] ë¯¸ë‹¤ìš´ë¡œë“œ ë°œì£¼ì„œ ì¡°íšŒ ì‹¤íŒ¨:', undownloadedError)\n          toast.error('ë¯¸ë‹¤ìš´ë¡œë“œ ë°œì£¼ì„œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.')\n        }\n      }\n    } catch (error) {\n      logger.error('[DashboardMain] Failed to load dashboard data:', error)\n      toast.error('ëŒ€ì‹œë³´ë“œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.')\n      // ì—ëŸ¬ ë°œìƒ ì‹œì—ë„ ë¡œë”© ìƒíƒœ í•´ì œ\n      setLoading(false)\n      // ë¹ˆ ë°ì´í„°ë¼ë„ ì„¤ì •í•´ì„œ UIê°€ ë Œë”ë§ë˜ë„ë¡\n      setData(null)\n    } finally {\n      if (showLoading) {\n        setLoading(false)\n      }\n    }\n  }, [employee, userRoles, data])\n\n  useEffect(() => {\n    loadDashboardData()\n  }, [loadDashboardData])\n\n  // ğŸš€ Realtime ì´ë²¤íŠ¸ êµ¬ë… - DB ë³€ê²½ ì‹œ ìë™ ìƒˆë¡œê³ ì¹¨\n  const isFirstMount = useRef(true)\n  useEffect(() => {\n    const handleCacheUpdate = () => {\n      // ì²« ë§ˆìš´íŠ¸ ì‹œì—ëŠ” ë¬´ì‹œ (ì´ˆê¸° ë¡œë“œì™€ ì¤‘ë³µ ë°©ì§€)\n      if (isFirstMount.current) {\n        isFirstMount.current = false\n        return\n      }\n      // Realtime ì´ë²¤íŠ¸ ë°œìƒ ì‹œ ë°±ê·¸ë¼ìš´ë“œ ìƒˆë¡œê³ ì¹¨\n      loadDashboardData(false, true)\n    }\n\n    const unsubscribe = addCacheListener(handleCacheUpdate)\n    return () => unsubscribe()\n  }, [loadDashboardData])\n\n  const handleQuickApprove = async (requestId: string) => {\n    if (!data?.employee) {\n      toast.error('ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')\n      return\n    }\n\n    // ìŠ¹ì¸ í™•ì¸ ë©”ì‹œì§€\n    if (!confirm('ì •ë§ë¡œ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {\n      return\n    }\n\n    setActionLoading(requestId)\n    \n    // UI ë¸”ë¡œí‚¹ ë°©ì§€ë¥¼ ìœ„í•´ ë‹¤ìŒ í‹±ìœ¼ë¡œ ì§€ì—°\n    await new Promise(resolve => setTimeout(resolve, 0))\n    \n    // Optimistic Update: ì¦‰ì‹œ UIì—ì„œ ì œê±°\n    const originalData = data\n    setData(prev => {\n      if (!prev) return prev\n      return {\n        ...prev,\n        pendingApprovals: prev.pendingApprovals.filter(item => item.id !== requestId),\n        stats: {\n          ...prev.stats,\n          pending: Math.max(0, prev.stats.pending - 1)\n        }\n      }\n    })\n\n    try {\n      const result = await dashboardService.quickApprove(requestId, data.employee)\n      \n      if (result.success) {\n        toast.success('ìŠ¹ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.')\n        // ì„±ê³µ ì‹œ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë°ì´í„° ë™ê¸°í™” (UI ê¹œë¹¡ì„ ì—†ì´)\n        setTimeout(() => {\n          loadDashboardData(false)  // falseë¥¼ ì „ë‹¬í•˜ì—¬ ë¡œë”© í™”ë©´ í‘œì‹œ ì•ˆ í•¨\n        }, 1000)\n      } else {\n        // ì‹¤íŒ¨ ì‹œ ì›ë˜ ë°ì´í„°ë¡œ ë¡¤ë°±\n        setData(originalData)\n        toast.error(result.error || 'ìŠ¹ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n      }\n    } catch (error) {\n      // ì—ëŸ¬ ì‹œ ì›ë˜ ë°ì´í„°ë¡œ ë¡¤ë°±\n      setData(originalData)\n      toast.error('ìŠ¹ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    } finally {\n      setActionLoading(null)\n    }\n  }\n\n  // ëª¨ë‹¬ ì—´ê¸° í—¬í¼ í•¨ìˆ˜ (PurchaseDetailModal ì‚¬ìš©, activeTab ì „ë‹¬)\n  const openPurchaseModal = (item: any, activeTab: string = 'pending') => {\n    setSelectedPurchaseId(Number(item.id))\n    setModalActiveTab(activeTab)\n    setIsModalOpen(true)\n  }\n\n  // ê²€ìƒ‰ í•„í„°ë§ í•¨ìˆ˜\n  const filterItems = useCallback((items: any[], searchTerm: string) => {\n    if (!searchTerm.trim()) return items\n    \n    return items.filter(item => {\n      const orderNumber = item.purchase_order_number || ''\n      const vendorName = item.vendor_name || ''\n      const itemsText = (item.purchase_request_items || [])\n        .map((pItem: any) => pItem.item_name || '')\n        .join(' ')\n      \n      return [orderNumber, vendorName, itemsText]\n        .join(' ')\n        .toLowerCase()\n        .includes(searchTerm.toLowerCase())\n    })\n  }, [])\n\n  // í•„í„°ë§ëœ ê²°ê³¼ ë©”ëª¨ì´ì œì´ì…˜ (ì…ë ¥í•  ë•Œë§ˆë‹¤ ì¬ê³„ì‚° ë°©ì§€)\n  const filteredUndownloaded = useMemo(() => filterItems(undownloadedOrders, searchTerms.undownloaded), [undownloadedOrders, searchTerms.undownloaded, filterItems])\n  const filteredPending = useMemo(() => filterItems(data?.pendingApprovals || [], searchTerms.pending), [data?.pendingApprovals, searchTerms.pending, filterItems])\n  const filteredPurchase = useMemo(() => filterItems(data?.myPurchaseStatus?.waitingPurchase || [], searchTerms.purchase), [data?.myPurchaseStatus?.waitingPurchase, searchTerms.purchase, filterItems])\n  const filteredDelivery = useMemo(() => filterItems(data?.myPurchaseStatus?.waitingDelivery || [], searchTerms.delivery), [data?.myPurchaseStatus?.waitingDelivery, searchTerms.delivery, filterItems])\n\n  const handleDownloadExcel = async (purchase: any) => {\n    try {\n      setDownloadingIds(prev => new Set(prev).add(purchase.id))\n      \n      // UI ë¸”ë¡œí‚¹ ë°©ì§€ë¥¼ ìœ„í•´ ë‹¤ìŒ í‹±ìœ¼ë¡œ ì§€ì—°\n      await new Promise(resolve => setTimeout(resolve, 0))\n      \n      // ê´€ë¦¬íƒ­ê³¼ ë™ì¼í•œ Excel ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜ í˜¸ì¶œ\n      await downloadPurchaseOrderExcel(\n        {\n          id: purchase.id,\n          purchase_order_number: purchase.purchase_order_number,\n          vendor_name: purchase.vendor_name,\n          vendor_id: purchase.vendor_id,\n          contact_id: purchase.contact_id\n        },\n        currentUserRoles,\n        () => {\n          // ì„±ê³µ ì½œë°±: UIì—ì„œ ë‹¤ìš´ë¡œë“œ ì™„ë£Œëœ í•­ëª© ì œê±°\n          setUndownloadedOrders(prev => prev.filter(item => item.id !== purchase.id))\n        }\n      )\n    } catch (error) {\n      logger.error('Excel ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ', error)\n    } finally {\n      setDownloadingIds(prev => {\n        const newSet = new Set(prev)\n        newSet.delete(purchase.id)\n        return newSet\n      })\n    }\n  }\n\n  const getStepColor = (step: string) => {\n    switch (step) {\n      case 'approval': return 'bg-yellow-100 text-yellow-800'\n      case 'purchase': return 'bg-blue-100 text-blue-800'\n      case 'delivery': return 'bg-purple-100 text-purple-800'\n      case 'completed': return 'bg-green-100 text-green-800'\n      default: return 'bg-gray-100 text-gray-800'\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center\" style={{ minHeight: '400px', backgroundColor: '#f9fafb' }}>\n        <div className=\"text-center\">\n          <div className=\"w-12 h-12 border-3 border-hansl-500 border-t-transparent rounded-full animate-spin mx-auto\" />\n          <p className=\"mt-4 card-subtitle\">ëŒ€ì‹œë³´ë“œë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆìŠµë‹ˆë‹¤...</p>\n          <p className=\"text-xs text-gray-400 mt-2\">Employee: {employee?.name || 'ì—†ìŒ'}</p>\n        </div>\n      </div>\n    )\n  }\n\n  if (!data?.employee) {\n    logger.warn('[DashboardMain] ë°ì´í„° ì—†ìŒ', { \n      hasData: !!data, \n      hasEmployee: !!employee,\n      employeeName: employee?.name,\n      loading \n    })\n    return (\n      <div className=\"flex items-center justify-center\" style={{ minHeight: '400px', backgroundColor: '#f9fafb' }}>\n        <div className=\"text-center bg-white p-8 rounded-lg border border-gray-200 shadow-sm\">\n          <h3 className=\"modal-subtitle mb-2\">ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h3>\n          <p className=\"card-subtitle mb-4\">ë¡œê·¸ì¸ì„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p>\n          <div className=\"text-xs text-gray-400 space-y-1\">\n            <p>Employee: {employee?.name || 'ì—†ìŒ'}</p>\n            <p>Loading: {loading ? 'true' : 'false'}</p>\n            <p>Has Data: {data ? 'true' : 'false'}</p>\n          </div>\n        </div>\n      </div>\n    )\n  }\n\n  // ê¶Œí•œ íŒŒì‹± ë° í‘œì‹œ ì—¬ë¶€ ê²°ì •\n  const roles = Array.isArray(data.employee.purchase_role)\n    ? (data.employee.purchase_role as any[]).map((r: any) => String(r).trim())\n    : (data.employee.purchase_role\n        ? String(data.employee.purchase_role)\n            .split(',')\n            .map((r: string) => r.trim())\n            .filter((r: string) => r.length > 0)\n        : [])\n\n  const canSeeApprovalBox = roles.some((r: string) => ['middle_manager', 'final_approver', 'app_admin', 'raw_material_manager', 'consumable_manager'].includes(r))\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <div className=\"w-full px-4 lg:px-6\">\n        {/* í—¤ë” */}\n        <div className=\"mb-3\">\n          <div>\n            <h1 className=\"page-title\">ëŒ€ì‹œë³´ë“œ</h1>\n            <p className=\"page-subtitle\" style={{marginTop:'-2px',marginBottom:'-4px'}}>Dashboard</p>\n          </div>\n        </div>\n\n        {/* í†µí•© ëŒ€ì‹œë³´ë“œ ê·¸ë¦¬ë“œ */}\n        <div className=\"mb-2\">\n          <h2 className=\"section-title mb-2 flex items-center gap-1.5\">\n            <Package className=\"w-3.5 h-3.5 text-gray-600\" />\n            ì „ì²´ í˜„í™©\n            <span className=\"badge-stats border border-gray-300 bg-white text-gray-600 ml-2\">\n              {new Date().toLocaleDateString('ko-KR', { \n                month: 'long', \n                day: 'numeric',\n                weekday: 'short'\n              })}\n            </span>\n          </h2>\n        </div>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3\">\n          {/* Lead Buyer / App Admin - ë¯¸ë‹¤ìš´ë¡œë“œ ë°œì£¼ì„œ */}\n          {(currentUserRoles.includes('lead buyer') || currentUserRoles.includes('app_admin')) && (\n            <Card className=\"w-full col-span-1 row-span-2 border-gray-200 shadow-sm hover:shadow-md transition-shadow\">\n              <CardHeader className=\"h-12 px-4 bg-gray-50 border-b flex items-center\">\n                <CardTitle className=\"section-title flex items-center justify-between w-full\">\n                  <div className=\"flex items-center gap-2\">\n                    <Download className=\"w-4 h-4 text-orange-600\" />\n                    <span>ë¯¸ë‹¤ìš´ë¡œë“œ ë°œì£¼ì„œ</span>\n                  </div>\n                  <span className=\"badge-stats bg-gray-200 text-gray-700\">\n                    {undownloadedOrders.length}\n                  </span>\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"p-4\">\n                <div className=\"space-y-3\">\n                  {/* ê²€ìƒ‰ ì…ë ¥ */}\n                  <div className=\"relative\">\n                    <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                    <Input\n                      placeholder=\"ë°œì£¼ë²ˆí˜¸, ì—…ì²´ëª…, í’ˆëª©ìœ¼ë¡œ ê²€ìƒ‰...\"\n                      value={searchTerms.undownloaded}\n                      onChange={(e) => setSearchTerms(prev => ({ ...prev, undownloaded: e.target.value }))}\n                      className=\"pl-10 h-8 text-xs\"\n                    />\n                  </div>\n                  \n                  \n                  {/* í•­ëª© ë¦¬ìŠ¤íŠ¸ */}\n                  <div className=\"space-y-2 h-[36rem] overflow-y-auto\">\n                    {filteredUndownloaded.length === 0 ? (\n                      <div className=\"text-center py-12 text-gray-400\">\n                        <Download className=\"w-10 h-10 mx-auto mb-3 text-gray-300\" />\n                        <p className=\"card-subtitle\">ë¯¸ë‹¤ìš´ë¡œë“œ ë°œì£¼ì„œê°€ ì—†ìŠµë‹ˆë‹¤</p>\n                      </div>\n                    ) : (\n                      filteredUndownloaded.map((item, index) => {\n                        const items = item.purchase_request_items || []\n                        const firstItem = items[0] || {}\n                        const isAdvance = item.progress_type === 'ì„ ì§„í–‰'\n                      \n                      return (\n                        <div \n                          key={`undownloaded-${item.id}`} \n                          className={`border rounded-lg p-2 hover:shadow-sm transition-all cursor-pointer mb-2 ${\n                            isAdvance ? 'bg-red-50 border-red-200' : 'hover:bg-orange-50/30'\n                          }`}\n                          onClick={(e) => {\n                            // ë²„íŠ¼ í´ë¦­ì€ ë¬´ì‹œ\n                            if ((e.target as HTMLElement).closest('button')) return\n                            openPurchaseModal(item, 'pending') // ë¯¸ë‹¤ìš´ë¡œë“œ ë°œì£¼ì„œëŠ” ìŠ¹ì¸ëŒ€ê¸° íƒ­ê³¼ ë™ì¼\n                          }}\n                        >\n                          <div className=\"flex items-center justify-between gap-2\">\n                            <div className=\"flex items-center gap-2 flex-1 min-w-0\">\n                              <span className=\"card-title\">\n                                {item.purchase_order_number || `PO-${item.id.slice(0, 8)}`}\n                              </span>\n                              <span className=\"card-subtitle truncate\">\n                                {item.vendor_name || 'ì—…ì²´ëª… ì—†ìŒ'}\n                              </span>\n                              <span className=\"card-description truncate\">\n                                {firstItem.item_name || 'í’ˆëª©'} \n                                {items.length > 1 && (\n                                  <span className=\"text-gray-400\"> ì™¸ {items.length - 1}ê±´</span>\n                                )}\n                              </span>\n                            </div>\n                            <Button\n                              className=\"button-base bg-gray-500 hover:bg-gray-600 text-white\"\n                              onClick={async (e) => {\n                                e.stopPropagation()\n                                await handleDownloadExcel(item)\n                              }}\n                              disabled={downloadingIds.has(item.id)}\n                            >\n                              {downloadingIds.has(item.id) ? (\n                                <div className=\"w-3 h-3 border border-white border-t-transparent rounded-full animate-spin\" />\n                              ) : (\n                                \"ë‹¤ìš´ë¡œë“œ\"\n                              )}\n                            </Button>\n                          </div>\n                        </div>\n                      )\n                      })\n                    )}\n                    {filteredUndownloaded.length >= 100 && (\n                      <div className=\"text-center text-xs text-gray-500 mt-3 pb-2\">\n                        í‘œì‹œëœ í•­ëª©: {filteredUndownloaded.length}ê°œ\n                        <br />\n                        ë” ë§ì€ í•­ëª©ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê²€ìƒ‰ìœ¼ë¡œ í•„í„°ë§í•˜ì„¸ìš”.\n                      </div>\n                    )}\n                    {filteredUndownloaded.length > 0 && (\n                      <div className=\"text-center text-xs text-gray-400 mt-2 pb-2\">\n                        ì´ {filteredUndownloaded.length}ê°œ ë¯¸ë‹¤ìš´ë¡œë“œ ë°œì£¼ì„œ\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          )}\n\n\n          {/* ìŠ¹ì¸ ëŒ€ê¸° (ìŠ¹ì¸ ê¶Œí•œìë§Œ í‘œì‹œ) */}\n          {canSeeApprovalBox && (\n            <Card className=\"w-full col-span-1 row-span-2\">\n              <CardHeader className=\"h-12 px-4 bg-gray-50 border-b flex items-center\">\n                <CardTitle className=\"section-title flex items-center justify-between w-full\">\n                  <div className=\"flex items-center gap-2\">\n                    <Clock className=\"w-3.5 h-3.5 text-orange-500\" />\n                    <span>ìŠ¹ì¸ ëŒ€ê¸°</span>\n                  </div>\n                  {data.pendingApprovals.length > 0 && (\n                    <span className=\"badge-stats bg-gray-200 text-gray-700\">\n                      {data.pendingApprovals.length}\n                    </span>\n                  )}\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"p-4\">\n                {data.pendingApprovals.length === 0 ? (\n                  <div className=\"text-center py-4 text-gray-400\">\n                    <CheckCircle className=\"w-6 h-6 mx-auto mb-1\" />\n                    <p className=\"card-description\">ëŒ€ê¸° í•­ëª© ì—†ìŒ</p>\n                  </div>\n                  ) : (\n                  <div className=\"space-y-3\">\n                    {/* ê²€ìƒ‰ ì…ë ¥ */}\n                    <div className=\"relative\">\n                      <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                      <Input\n                        placeholder=\"ë°œì£¼ë²ˆí˜¸, ì—…ì²´ëª…, í’ˆëª©ìœ¼ë¡œ ê²€ìƒ‰...\"\n                        value={searchTerms.pending}\n                        onChange={(e) => setSearchTerms(prev => ({ ...prev, pending: e.target.value }))}\n                        className=\"pl-10 h-8 text-xs\"\n                      />\n                    </div>\n                    \n                    {/* í•­ëª© ë¦¬ìŠ¤íŠ¸ */}\n                    <div className=\"space-y-2 h-[36rem] overflow-y-auto\">\n                      {filteredPending.slice(0, 10).map((approval, index) => {\n                        const items = approval.purchase_request_items || []\n                        const firstItem = items[0] || {}\n                        const totalAmount = approval.total_amount || items.reduce((sum: number, i: any) => sum + (Number(i.amount_value) || 0), 0)\n                        const isAdvance = approval.progress_type === 'ì„ ì§„í–‰'\n                        \n                        return (\n                          <div \n                            key={`approval-${approval.id}`} \n                            className={`border rounded-lg p-2 hover:shadow-sm transition-all cursor-pointer mb-2 ${\n                              isAdvance ? 'bg-red-50 border-red-200' : 'hover:bg-orange-50/30'\n                            }`}\n                            onClick={(e) => {\n                              // ë²„íŠ¼ í´ë¦­ì€ ë¬´ì‹œ\n                              if ((e.target as HTMLElement).closest('button')) return\n                              openPurchaseModal(approval, 'pending') // ìŠ¹ì¸ëŒ€ê¸° íƒ­\n                            }}\n                          >\n                            <div className=\"flex items-center justify-between gap-2\">\n                              <div className=\"flex items-center gap-2 flex-1 min-w-0\">\n                                <span className=\"card-title\">\n                                  {approval.purchase_order_number}\n                                </span>\n                                <span className=\"card-subtitle truncate\">{approval.vendor_name || 'ì—…ì²´'}</span>\n                                <span className=\"card-description truncate\">\n                                  {firstItem.item_name || 'í’ˆëª©'} {items.length > 1 && `ì™¸ ${items.length - 1}ê±´`}\n                                </span>\n                              </div>\n                              <Button\n                                onClick={async (e) => {\n                                  e.stopPropagation()\n                                  await handleQuickApprove(approval.id)\n                                }}\n                                disabled={actionLoading === approval.id}\n                                className={`button-base text-white ${\n                                  approval.middle_manager_status === 'approved' \n                                    ? 'bg-blue-600 hover:bg-blue-700' \n                                    : 'bg-green-600 hover:bg-green-700'\n                                }`}\n                              >\n                                {actionLoading === approval.id ? (\n                                  <div className=\"w-3 h-3 border border-white border-t-transparent rounded-full animate-spin\" />\n                                ) : (\n                                  <>\n                                    {approval.middle_manager_status === 'approved' ? 'ìµœì¢…' : '1ì°¨'} ìŠ¹ì¸\n                                  </>\n                                )}\n                              </Button>\n                            </div>\n                          </div>\n                        )\n                      })}\n                    </div>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          )}\n          \n\n          {/* êµ¬ë§¤ ëŒ€ê¸°ì¤‘ - Lead Buyerì™€ App Adminë§Œ í‘œì‹œ */}\n          {(currentUserRoles.includes('lead buyer') || currentUserRoles.includes('app_admin')) && (\n            <Card className=\"w-full col-span-1 border-gray-200 shadow-sm hover:shadow-md transition-shadow\">\n              <CardHeader className=\"h-12 px-4 bg-gray-50 border-b flex items-center\">\n                <CardTitle className=\"section-title flex items-center justify-between w-full\">\n                  <div className=\"flex items-center gap-2\">\n                    <ShoppingCart className=\"w-4 h-4 text-yellow-600\" />\n                    <span>êµ¬ë§¤ ëŒ€ê¸°</span>\n                  </div>\n                  {data.myPurchaseStatus && data.myPurchaseStatus.waitingPurchase && data.myPurchaseStatus.waitingPurchase.length > 0 && (\n                    <span className=\"badge-stats bg-gray-200 text-gray-700\">\n                      {data.myPurchaseStatus.waitingPurchase.length}\n                    </span>\n                  )}\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"p-4\">\n                {!data.myPurchaseStatus || !data.myPurchaseStatus.waitingPurchase || data.myPurchaseStatus.waitingPurchase.length === 0 ? (\n                  <div className=\"text-center py-12 text-gray-400\">\n                    <ShoppingCart className=\"w-10 h-10 mx-auto mb-3 text-gray-300\" />\n                    <p className=\"card-subtitle\">êµ¬ë§¤ ëŒ€ê¸° í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤</p>\n                  </div>\n                ) : (\n                  <div className=\"space-y-3\">\n                    {/* ê²€ìƒ‰ ì…ë ¥ */}\n                    <div className=\"relative\">\n                      <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                      <Input\n                        placeholder=\"ë°œì£¼ë²ˆí˜¸, ì—…ì²´ëª…, í’ˆëª©ìœ¼ë¡œ ê²€ìƒ‰...\"\n                        value={searchTerms.purchase}\n                        onChange={(e) => setSearchTerms(prev => ({ ...prev, purchase: e.target.value }))}\n                        className=\"pl-10 h-8 text-xs\"\n                      />\n                    </div>\n                    \n                    {/* í•­ëª© ë¦¬ìŠ¤íŠ¸ */}\n                    <div className=\"space-y-2 h-[36rem] overflow-y-auto\">\n                      {filteredPurchase.map((item) => {\n                        const items = item.purchase_request_items || []\n                        const firstItem = items[0]\n                        const totalAmount = items.reduce((sum: number, i: any) => sum + (Number(i.amount_value) || 0), 0)\n                        const isSeonJin = (item.progress_type || '').includes('ì„ ì§„í–‰')\n                        \n                        return (\n                          <div \n                            key={item.id} \n                            className={`border rounded-lg p-2 transition-all hover:shadow-sm mb-2 ${\n                              isSeonJin ? 'bg-red-50 hover:bg-red-100 border-red-200' : 'bg-white hover:bg-gray-50 border-gray-200'\n                            }`}\n                          >\n                            <div className=\"flex items-center justify-between gap-2\">\n                              <div \n                                className=\"flex items-center gap-2 flex-1 cursor-pointer\"\n                                onClick={(e) => {\n                                  // ë²„íŠ¼ í´ë¦­ì€ ë¬´ì‹œ\n                                  if ((e.target as HTMLElement).closest('button')) return\n                                  openPurchaseModal(item, 'purchase') // êµ¬ë§¤í˜„í™© íƒ­\n                                }}\n                              >\n                                <span className=\"card-title\">\n                                  {item.purchase_order_number || `PO-${item.id.slice(0, 8)}`}\n                                </span>\n                                <span className=\"card-subtitle truncate\">\n                                  {item.vendor_name || 'ì—…ì²´ëª… ì—†ìŒ'}\n                                </span>\n                                <span className=\"card-description truncate\">\n                                  {firstItem?.item_name || 'í’ˆëª©'} \n                                  {items.length > 1 && (\n                                    <span className=\"text-gray-400\"> ì™¸ {items.length - 1}ê±´</span>\n                                  )}\n                                </span>\n                              </div>\n                              \n                              {/* êµ¬ë§¤ì™„ë£Œ ë²„íŠ¼ - Lead Buyer, App Adminë§Œ í‘œì‹œ */}\n                              {(currentUserRoles.includes('lead buyer') || \n                                currentUserRoles.includes('app_admin')) && !item.is_payment_completed && (\n                                <Button\n                                  onClick={async (e) => {\n                                    e.stopPropagation()\n                                    if (!confirm('ì´ ë°œì£¼ë¥¼ êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return\n                                    \n                                    // UI ë¸”ë¡œí‚¹ ë°©ì§€ë¥¼ ìœ„í•´ ë‹¤ìŒ í‹±ìœ¼ë¡œ ì§€ì—°\n                                    await new Promise(resolve => setTimeout(resolve, 0))\n                                    \n                                    try {\n                                      const { error } = await supabase\n                                        .from('purchase_requests')\n                                        .update({ \n                                          is_payment_completed: true,\n                                          payment_completed_at: new Date().toISOString()\n                                        })\n                                        .eq('id', item.id)\n\n                                      if (error) throw error\n                                      \n                                      // ğŸš€ ë©”ëª¨ë¦¬ ìºì‹œ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (ìë™ìœ¼ë¡œ notifyCacheListeners í˜¸ì¶œë¨)\n                                      markPurchaseAsPaymentCompleted(item.id)\n                                      \n                                      toast.success('êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.')\n                                    } catch (error) {\n                                      toast.error('ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n                                    }\n                                  }}\n                                  className=\"button-base bg-orange-500 hover:bg-orange-600 text-white\"\n                                >\n                                  êµ¬ë§¤ì™„ë£Œ\n                                </Button>\n                              )}\n                              \n                              {/* ì´ë¯¸ êµ¬ë§¤ì™„ë£Œëœ ê²½ìš° ì™„ë£Œ í‘œì‹œ */}\n                              {item.is_payment_completed && (\n                                <div className=\"bg-green-100 text-green-700 px-2 py-1 business-radius-badge badge-text shrink-0\">\n                                  ì™„ë£Œë¨\n                                </div>\n                              )}\n                            </div>\n                          </div>\n                        )\n                      })}\n                    </div>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          )}\n\n          {/* ì…ê³  ëŒ€ê¸°ì¤‘ */}\n          <Card className=\"w-full col-span-1 border-gray-200 shadow-sm hover:shadow-md transition-shadow\">\n              <CardHeader className=\"h-12 px-4 bg-gray-50 border-b flex items-center\">\n                <CardTitle className=\"section-title flex items-center justify-between w-full\">\n                  <div className=\"flex items-center gap-2\">\n                    <Truck className=\"w-4 h-4 text-blue-600\" />\n                    <span>ì…ê³  ëŒ€ê¸°</span>\n                  </div>\n                  {data.myPurchaseStatus.waitingDelivery.length > 0 && (\n                    <span className=\"badge-stats bg-gray-200 text-gray-700\">\n                      {data.myPurchaseStatus.waitingDelivery.length}\n                    </span>\n                  )}\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"p-4\">\n                {data.myPurchaseStatus.waitingDelivery.length === 0 ? (\n                  <div className=\"text-center py-12 text-gray-400\">\n                    <Truck className=\"w-10 h-10 mx-auto mb-3 text-gray-300\" />\n                    <p className=\"card-subtitle\">ì…ê³  ëŒ€ê¸° í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤</p>\n                  </div>\n                ) : (\n                  <div className=\"space-y-3\">\n                    {/* ê²€ìƒ‰ ì…ë ¥ */}\n                    <div className=\"relative\">\n                      <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                      <Input\n                        placeholder=\"ë°œì£¼ë²ˆí˜¸, ì—…ì²´ëª…, í’ˆëª©ìœ¼ë¡œ ê²€ìƒ‰...\"\n                        value={searchTerms.delivery}\n                        onChange={(e) => setSearchTerms(prev => ({ ...prev, delivery: e.target.value }))}\n                        className=\"pl-10 h-8 text-xs\"\n                      />\n                    </div>\n                    \n                    {/* í•­ëª© ë¦¬ìŠ¤íŠ¸ */}\n                    <div className=\"space-y-2 h-[36rem] overflow-y-auto\">\n                      {filteredDelivery.slice(0, 10).map((item) => {\n                        const items = item.purchase_request_items || []\n                        const firstItem = items[0]\n                        const totalItems = items.length\n                        const receivedItems = items.filter((i: any) => i.is_received).length\n                        const progress = totalItems > 0 ? Math.round((receivedItems / totalItems) * 100) : 0\n                        const totalAmount = items.reduce((sum: number, i: any) => sum + (Number(i.amount_value) || 0), 0)\n                        const isSeonJin = (item.progress_type || '').includes('ì„ ì§„í–‰')\n                        \n                        return (\n                          <div \n                            key={item.id} \n                            className={`border rounded-lg p-2 transition-all cursor-pointer hover:shadow-sm mb-2 ${\n                              isSeonJin ? 'bg-red-50 hover:bg-red-100 border-red-200' : 'bg-white hover:bg-gray-50 border-gray-200'\n                            }`}\n                            onClick={(e) => {\n                              // ë²„íŠ¼ í´ë¦­ì€ ë¬´ì‹œ\n                              if ((e.target as HTMLElement).closest('button')) return\n                              openPurchaseModal(item, 'receipt') // ì…ê³ í˜„í™© íƒ­\n                            }}\n                          >\n                            <div className=\"flex items-center gap-2\">\n                              <span className=\"card-title\">\n                                {item.purchase_order_number || `PO-${item.id.slice(0, 8)}`}\n                              </span>\n                              <span className=\"card-subtitle truncate\">\n                                {item.vendor_name || 'ì—…ì²´ëª… ì—†ìŒ'}\n                              </span>\n                              <span className=\"card-description truncate\">\n                                {firstItem?.item_name || 'í’ˆëª©'} \n                                {totalItems > 1 && (\n                                  <span className=\"text-gray-400\"> ì™¸ {totalItems - 1}ê±´</span>\n                                )}\n                              </span>\n                            </div>\n                          </div>\n                        )\n                      })}\n                    </div>\n                  </div>\n                )}\n              </CardContent>\n          </Card>\n\n        </div>\n\n        {/* ì˜¤ëŠ˜ì˜ ìš”ì•½ - ìƒë‹¨ í†µê³„ì— í†µí•© */}\n      </div>\n      \n      {/* PurchaseDetailModal - ëª¨ë“  ì¹´ë“œì—ì„œ ì‚¬ìš© (activeTabì— ë”°ë¼ ë‹¤ë¥¸ ë‚´ìš© í‘œì‹œ) */}\n      <PurchaseDetailModal\n        purchaseId={selectedPurchaseId}\n        isOpen={isModalOpen}\n        onClose={() => {\n          setIsModalOpen(false)\n          setSelectedPurchaseId(null)\n          setModalActiveTab('pending')\n        }}\n        currentUserRoles={currentUserRoles}\n        activeTab={modalActiveTab}\n        onRefresh={() => {\n          loadDashboardData(false)\n          setIsModalOpen(false)\n          setSelectedPurchaseId(null)\n          setModalActiveTab('pending')\n        }}\n        onOptimisticUpdate={(purchaseId: number, updater: (prev: Purchase) => Purchase) => {\n          updatePurchaseInMemory(purchaseId, updater)\n          loadDashboardData(false)\n        }}\n      />\n    </div>\n  )\n}"],"names":["Clock","createLucideIcon","d","key","cx","cy","r","dashboardCache","data","lastFetch","CACHE_DURATION","employeeId","dashboardService","constructor","this","supabase","createClient","hasValidPurchaseMemory","employee","purchaseMemoryCache","allPurchases","length","id","isFresh","Date","now","isSameUser","currentUser","String","getPurchaseMemory","parseRoles","purchaseRole","roles","Array","isArray","map","trim","split","filter","getDashboardData","forceRefresh","useMemory","results","Promise","allSettled","getDashboardStatsFromMemory","getDashboardStats","getMyRecentRequestsFromMemory","getMyRecentRequests","getPendingApprovalsFromMemory","getPendingApprovals","getQuickActionsFromMemory","getQuickActions","getTodaySummaryFromMemory","getTodaySummary","getMyPurchaseStatusFromMemory","getMyPurchaseStatus","statsResult","myRecentRequestsResult","pendingApprovalsResult","quickActionsResult","todaySummaryResult","myPurchaseStatusResult","stats","status","value","total","myRequests","pending","completed","urgent","todayActions","myRecentRequests","pendingApprovals","quickActions","todaySummary","approved","requested","received","myPurchaseStatus","waitingPurchase","waitingDelivery","recentCompleted","logger","error","reason","dashboardData","urgentRequests","isPendingStatus","toTime","t","getTime","Number","isFinite","purchases","today","toISOString","purchase_role","name","email","monthStart","getFullYear","getMonth","threeDaysAgo","p","requester_name","getPendingCountFromMemory","is_received","received_at","getUrgentCountFromMemory","getTodayActionsCountFromMemory","requesterName","item","middleApproved","middle_manager_status","finalPending","final_manager_status","finalApproved","notPaid","is_payment_completed","sort","a","b","created_at","slice","vendor_name","total_items","purchase_request_items","progress_percentage","calculateProgress","current_step","getCurrentStep","next_action","getNextAction","estimated_completion","estimateCompletion","filteredPending","request_date","middlePending","middleRejected","finalRejected","roleFiltered","includes","items","total_amount","reduce","sum","i","amount_value","quantity","unit_price_value","project_vendor","vendor","actions","pendingCount","push","type","label","description","count","color","purchaseCount","tomorrow","inRange","ts","updated_at","isLeadBuyer","sevenDaysAgo","isPurchaseRequest","payment_category","progress_type","isIlban","notReceived","isSeonJin","sortDesc","threeDaysAgoIso","base","todayIsoDate","tomorrowIsoDate","totalResult","myRequestsResult","pendingResult","completedResult","urgentResult","todayActionsResult","all","from","select","head","eq","getPendingCount","gte","getUrgentCount","getTodayActionsCount","or","order","ascending","limit","vendors","debug","employeeName","employeeRoles","allRequests","requestsError","filteredData","isPending","totalRequests","roleFilteredData","totalItems","beforeFilter","afterFilter","purchasePending","result","enhancedData","finalCount","performanceNote","approvedResult","requestedResult","receivedResult","lt","query","allMyRequests","quickApprove","requestId","request","single","success","updateData","Object","keys","updatedData","update","message","mid","fin","pur","getTotalDeliveryWaitingCount","progress","created","Math","floor","estimatedDays","toLocaleDateString","getUndownloadedOrders","info","is_po_download","DashboardMain","setData","useState","loading","setLoading","actionLoading","setActionLoading","currentUserRoles","setCurrentUserRoles","undownloadedOrders","setUndownloadedOrders","downloadingIds","setDownloadingIds","Set","selectedPurchaseId","setSelectedPurchaseId","isModalOpen","setIsModalOpen","modalActiveTab","setModalActiveTab","searchTerms","setSearchTerms","undownloaded","purchase","delivery","useNavigate","userRoles","useAuth","loadDashboardData","useCallback","async","showLoading","sampleItems","purchase_order_number","undownloadedError","toast","useEffect","isFirstMount","useRef","unsubscribe","addCacheListener","current","openPurchaseModal","activeTab","filterItems","searchTerm","pItem","item_name","join","toLowerCase","filteredUndownloaded","useMemo","filteredPurchase","filteredDelivery","jsx","className","style","minHeight","backgroundColor","children","jsxs","warn","hasData","hasEmployee","canSeeApprovalBox","some","marginTop","marginBottom","Package","month","day","weekday","Card","CardHeader","CardTitle","Download","CardContent","Search","Input","placeholder","onChange","e","prev","target","index","firstItem","isAdvance","onClick","closest","Button","stopPropagation","add","resolve","setTimeout","downloadPurchaseOrderExcel","vendor_id","contact_id","newSet","delete","handleDownloadExcel","disabled","has","CheckCircle","approval","confirm","originalData","max","handleQuickApprove","Fragment","ShoppingCart","payment_completed_at","markPurchaseAsPaymentCompleted","Truck","PurchaseDetailModal","purchaseId","isOpen","onClose","onRefresh","onOptimisticUpdate","updater","updatePurchaseInMemory"],"mappings":"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","x_google_ignoreList":[0]}