{"version":3,"file":"PurchaseDetailModal-BoD9pFVr.js","sources":["../../node_modules/lucide-react/dist/esm/icons/dollar-sign.js","../../node_modules/lucide-react/dist/esm/icons/truck.js","../../src/components/ui/date-picker-popover.tsx","../../src/components/ui/date-amount-picker-popover.tsx","../../src/components/ui/date-quantity-picker-popover.tsx","../../src/hooks/useConfirmDateAction.ts","../../src/components/purchase/PurchaseDetailModal.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"line\", { x1: \"12\", x2: \"12\", y1: \"2\", y2: \"22\", key: \"7eqyqh\" }],\n  [\"path\", { d: \"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6\", key: \"1b0p4s\" }]\n];\nconst DollarSign = createLucideIcon(\"dollar-sign\", __iconNode);\n\nexport { __iconNode, DollarSign as default };\n//# sourceMappingURL=dollar-sign.js.map\n","/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2\", key: \"wrbu53\" }],\n  [\"path\", { d: \"M15 18H9\", key: \"1lyqi6\" }],\n  [\n    \"path\",\n    {\n      d: \"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14\",\n      key: \"lysw3i\"\n    }\n  ],\n  [\"circle\", { cx: \"17\", cy: \"18\", r: \"2\", key: \"332jqn\" }],\n  [\"circle\", { cx: \"7\", cy: \"18\", r: \"2\", key: \"19iecd\" }]\n];\nconst Truck = createLucideIcon(\"truck\", __iconNode);\n\nexport { __iconNode, Truck as default };\n//# sourceMappingURL=truck.js.map\n","import { useState } from 'react'\nimport { Calendar } from '@/components/ui/calendar'\nimport { Button } from '@/components/ui/button'\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from '@/components/ui/popover'\nimport { Calendar as CalendarIcon } from 'lucide-react'\nimport { format } from 'date-fns'\nimport { ko } from 'date-fns/locale'\nimport { cn } from '@/lib/utils'\nimport { logger } from '@/lib/logger'\n\ninterface DatePickerPopoverProps {\n  children: React.ReactNode\n  onDateSelect: (date: Date) => void\n  disabled?: boolean\n  placeholder?: string\n  align?: \"center\" | \"start\" | \"end\"\n  side?: \"top\" | \"right\" | \"bottom\" | \"left\"\n}\n\nexport function DatePickerPopover({\n  children,\n  onDateSelect,\n  disabled = false,\n  placeholder = \"ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”\",\n  align = \"center\",\n  side = \"bottom\"\n}: DatePickerPopoverProps) {\n  const [open, setOpen] = useState(false)\n\n  const handleDateSelect = (date: Date | undefined) => {\n    logger.debug('ğŸ“… DatePickerPopover handleDateSelect í˜¸ì¶œ:', { \n      date, \n      isToday: date && new Date().toDateString() === date.toDateString(),\n      dateString: date?.toDateString(),\n      todayString: new Date().toDateString()\n    });\n    if (date) {\n      logger.debug('âœ… ë‚ ì§œ ì„ íƒë¨, onDateSelect í˜¸ì¶œ ì˜ˆì •');\n      onDateSelect(date)\n      setOpen(false) // ë‚ ì§œ ì„ íƒ í›„ íŒì˜¤ë²„ ë‹«ê¸°\n      logger.debug('ğŸ”š DatePickerPopover ì²˜ë¦¬ ì™„ë£Œ');\n    } else {\n      logger.debug('âŒ ë‚ ì§œê°€ undefinedì„');\n    }\n  }\n\n  return (\n    <Popover open={open} onOpenChange={setOpen}>\n      <PopoverTrigger asChild disabled={disabled}>\n        {children}\n      </PopoverTrigger>\n      <PopoverContent \n        className=\"w-auto p-0 border-gray-200 shadow-lg\" \n        align={align}\n        side={side}\n        sideOffset={8}\n      >\n        <div className=\"bg-white business-radius-card p-2\">\n          <div className=\"mb-2 px-1\">\n            <div className=\"modal-label text-gray-600 text-center\">\n              {placeholder}\n            </div>\n          </div>\n          <Calendar\n            mode=\"single\"\n            selected={undefined}\n            onSelect={(date) => {\n              logger.debug('ğŸ—“ï¸ Calendar onSelect ì§ì ‘ í˜¸ì¶œ:', { \n                date, \n                isToday: date && new Date().toDateString() === date.toDateString(),\n                dateValue: date?.getTime(),\n                todayValue: new Date().getTime()\n              });\n              handleDateSelect(date);\n            }}\n            locale={ko}\n            initialFocus\n            className=\"compact-calendar\"\n            disabled={false}\n            fromDate={new Date('2020-01-01')}\n            toDate={new Date('2030-12-31')}\n            defaultMonth={new Date()}\n            modifiers={{\n              today: new Date()\n            }}\n            modifiersClassNames={{\n              today: \"bg-blue-500 text-white font-semibold cursor-pointer hover:bg-blue-600 rounded-md\"\n            }}\n          />\n        </div>\n      </PopoverContent>\n    </Popover>\n  )\n}","import { useState } from 'react'\nimport { Calendar } from '@/components/ui/calendar'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from '@/components/ui/popover'\nimport { Calendar as CalendarIcon } from 'lucide-react'\nimport { format } from 'date-fns'\nimport { ko } from 'date-fns/locale'\nimport { cn } from '@/lib/utils'\nimport { logger } from '@/lib/logger'\n\ninterface DateAmountPickerPopoverProps {\n  children: React.ReactNode\n  onConfirm: (date: Date, amount: number) => void\n  disabled?: boolean\n  placeholder?: string\n  align?: \"center\" | \"start\" | \"end\"\n  side?: \"top\" | \"right\" | \"bottom\" | \"left\"\n  defaultDate?: Date\n  defaultAmount?: number\n}\n\nexport function DateAmountPickerPopover({\n  children,\n  onConfirm,\n  disabled = false,\n  placeholder = \"ë‚ ì§œì™€ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”\",\n  align = \"center\",\n  side = \"bottom\",\n  defaultDate,\n  defaultAmount\n}: DateAmountPickerPopoverProps) {\n  const [open, setOpen] = useState(false)\n  const [selectedDate, setSelectedDate] = useState<Date | undefined>(defaultDate)\n  const [amount, setAmount] = useState<string>(defaultAmount?.toString() || '')\n\n  const handleConfirm = () => {\n    if (!selectedDate) {\n      return\n    }\n    \n    const amountNum = parseFloat(amount.replace(/,/g, ''))\n    if (isNaN(amountNum) || amountNum <= 0) {\n      return\n    }\n\n    onConfirm(selectedDate, amountNum)\n    setOpen(false)\n    // Reset after close\n    setSelectedDate(defaultDate)\n    setAmount(defaultAmount?.toString() || '')\n  }\n\n  const handleAmountChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const value = e.target.value.replace(/[^0-9]/g, '')\n    if (value) {\n      const numValue = parseInt(value, 10)\n      setAmount(numValue.toLocaleString())\n    } else {\n      setAmount('')\n    }\n  }\n\n  return (\n    <Popover open={open} onOpenChange={setOpen}>\n      <PopoverTrigger asChild disabled={disabled}>\n        {children}\n      </PopoverTrigger>\n      <PopoverContent \n        className=\"w-auto p-0 border-gray-200 shadow-lg\" \n        align={align}\n        side={side}\n        sideOffset={8}\n      >\n        <div className=\"bg-white business-radius-card p-3\">\n          <div className=\"mb-2 px-1\">\n            <div className=\"modal-label text-gray-600 text-center\">\n              {placeholder}\n            </div>\n          </div>\n          <Calendar\n            mode=\"single\"\n            selected={selectedDate}\n            onSelect={setSelectedDate}\n            locale={ko}\n            initialFocus\n            className=\"compact-calendar\"\n            disabled={false}\n            fromDate={new Date('2020-01-01')}\n            toDate={new Date('2030-12-31')}\n            defaultMonth={selectedDate || new Date()}\n            modifiers={{\n              today: new Date()\n            }}\n            modifiersClassNames={{\n              today: \"bg-blue-500 text-white font-semibold cursor-pointer hover:bg-blue-600 rounded-md\"\n            }}\n          />\n          <div className=\"mt-3 px-1\">\n            <label className=\"block text-xs font-medium text-gray-700 mb-1\">\n              ì§€ì¶œê¸ˆì•¡\n            </label>\n            <Input\n              type=\"text\"\n              value={amount}\n              onChange={handleAmountChange}\n              placeholder=\"ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”\"\n              className=\"w-full\"\n            />\n          </div>\n          <div className=\"mt-3 flex justify-end gap-2\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => setOpen(false)}\n            >\n              ì·¨ì†Œ\n            </Button>\n            <Button\n              size=\"sm\"\n              onClick={handleConfirm}\n              disabled={!selectedDate || !amount || parseFloat(amount.replace(/,/g, '')) <= 0}\n              className=\"button-base button-action-primary\"\n            >\n              í™•ì¸\n            </Button>\n          </div>\n        </div>\n      </PopoverContent>\n    </Popover>\n  )\n}\n\n","import { useState } from 'react'\nimport { Calendar } from '@/components/ui/calendar'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from '@/components/ui/popover'\nimport { Calendar as CalendarIcon } from 'lucide-react'\nimport { format } from 'date-fns'\nimport { ko } from 'date-fns/locale'\nimport { cn } from '@/lib/utils'\nimport { logger } from '@/lib/logger'\n\ninterface DateQuantityPickerPopoverProps {\n  children: React.ReactNode\n  onConfirm: (date: Date, quantity?: number) => void\n  disabled?: boolean\n  placeholder?: string\n  align?: \"center\" | \"start\" | \"end\"\n  side?: \"top\" | \"right\" | \"bottom\" | \"left\"\n  defaultDate?: Date\n  defaultQuantity?: number\n  maxQuantity?: number\n  hideQuantityInput?: boolean\n  quantityInfoText?: string\n}\n\nexport function DateQuantityPickerPopover({\n  children,\n  onConfirm,\n  disabled = false,\n  placeholder = \"ë‚ ì§œì™€ ì‹¤ì œì…ê³ ìˆ˜ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”\",\n  align = \"center\",\n  side = \"bottom\",\n  defaultDate,\n  defaultQuantity,\n  maxQuantity,\n  hideQuantityInput = false,\n  quantityInfoText = \"ìš”ì²­ì…ê³ ìˆ˜ëŸ‰ê³¼ ë™ì¼í•œ ìˆ˜ëŸ‰ìœ¼ë¡œ ì…ë ¥ë©ë‹ˆë‹¤\"\n}: DateQuantityPickerPopoverProps) {\n  const [open, setOpen] = useState(false)\n  const [selectedDate, setSelectedDate] = useState<Date | undefined>(defaultDate)\n  const [quantity, setQuantity] = useState<string>(defaultQuantity?.toString() || '')\n\n  const handleConfirm = () => {\n    if (!selectedDate) {\n      return\n    }\n    \n    if (hideQuantityInput) {\n      // ìˆ˜ëŸ‰ ì…ë ¥ì´ ìˆ¨ê²¨ì§„ ê²½ìš° (ì „ì²´ ì…ê³ ì™„ë£Œ), quantityë¥¼ undefinedë¡œ ì „ë‹¬\n      onConfirm(selectedDate, undefined)\n      setOpen(false)\n      // Reset after close\n      setSelectedDate(defaultDate)\n      setQuantity(defaultQuantity?.toString() || '')\n      return\n    }\n    \n    const quantityNum = parseFloat(quantity.replace(/,/g, ''))\n    if (isNaN(quantityNum) || quantityNum < 0) {\n      return\n    }\n\n    if (maxQuantity && quantityNum > maxQuantity) {\n      return\n    }\n\n    onConfirm(selectedDate, quantityNum)\n    setOpen(false)\n    // Reset after close\n    setSelectedDate(defaultDate)\n    setQuantity(defaultQuantity?.toString() || '')\n  }\n\n  const handleQuantityChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const value = e.target.value.replace(/[^0-9]/g, '')\n    setQuantity(value)\n  }\n\n  return (\n    <Popover open={open} onOpenChange={setOpen}>\n      <PopoverTrigger asChild disabled={disabled}>\n        {children}\n      </PopoverTrigger>\n      <PopoverContent \n        className=\"w-auto p-0 border-gray-200 shadow-lg\" \n        align={align}\n        side={side}\n        sideOffset={8}\n      >\n        <div className=\"bg-white business-radius-card p-3\">\n          <div className=\"mb-2 px-1\">\n            <div className=\"modal-label text-gray-600 text-center\">\n              {placeholder}\n            </div>\n          </div>\n          {hideQuantityInput && (\n            <div className=\"mb-2 px-1\">\n              <div className=\"text-[10px] text-gray-500 text-center leading-tight\">\n                <div>ìš”ì²­ì…ê³ ìˆ˜ëŸ‰ê³¼ ë™ì¼í•œ</div>\n                <div>ìˆ˜ëŸ‰ìœ¼ë¡œ ì…ë ¥ë©ë‹ˆë‹¤</div>\n              </div>\n            </div>\n          )}\n          <Calendar\n            mode=\"single\"\n            selected={selectedDate}\n            onSelect={setSelectedDate}\n            locale={ko}\n            initialFocus\n            className=\"compact-calendar\"\n            disabled={false}\n            fromDate={new Date('2020-01-01')}\n            toDate={new Date('2030-12-31')}\n            defaultMonth={selectedDate || new Date()}\n            modifiers={{\n              today: new Date()\n            }}\n            modifiersClassNames={{\n              today: \"bg-blue-500 text-white font-semibold cursor-pointer hover:bg-blue-600 rounded-md\"\n            }}\n          />\n          {!hideQuantityInput && (\n            <div className=\"mt-3 px-1\">\n              <label className=\"block text-xs font-medium text-gray-700 mb-1\">\n                ì‹¤ì œì…ê³ ìˆ˜ëŸ‰\n              </label>\n              <Input\n                type=\"number\"\n                value={quantity}\n                onChange={handleQuantityChange}\n                placeholder=\"ìˆ˜ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”\"\n                className=\"border-gray-200 rounded-lg text-center w-full !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400\"\n                min=\"0\"\n                max={maxQuantity}\n              />\n              {maxQuantity && (\n                <p className=\"text-xs text-gray-500 mt-1\">ìµœëŒ€: {maxQuantity.toLocaleString()}</p>\n              )}\n            </div>\n          )}\n          <div className=\"mt-3 flex justify-end gap-2\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => setOpen(false)}\n              className=\"button-base\"\n            >\n              ì·¨ì†Œ\n            </Button>\n            <Button\n              size=\"sm\"\n              onClick={handleConfirm}\n              disabled={!selectedDate || (!hideQuantityInput && (!quantity || parseFloat(quantity.replace(/,/g, '')) < 0 || (maxQuantity !== undefined && parseFloat(quantity.replace(/,/g, '')) > maxQuantity)))}\n              className=\"button-base button-action-primary\"\n            >\n              í™•ì¸\n            </Button>\n          </div>\n        </div>\n      </PopoverContent>\n    </Popover>\n  )\n}\n\n","import { useCallback } from 'react'\nimport { createClient } from '@/lib/supabase/client'\nimport { toast } from 'sonner'\nimport { logger } from '@/lib/logger'\nimport { markItemAsReceived, markItemAsReceiptCanceled, markItemAsStatementReceived, markItemAsStatementCanceled } from '@/stores/purchaseMemoryStore'\n\nexport interface ConfirmDateActionConfig {\n  field: 'statement_received' | 'actual_received'\n  confirmMessage: {\n    confirm: string\n    cancel: string\n  }\n  successMessage: {\n    confirm: string\n    cancel: string\n  }\n  completedText: string\n  waitingText: string\n}\n\nexport interface UseConfirmDateActionProps {\n  config: ConfirmDateActionConfig\n  currentUserName: string | null\n  canPerformAction: boolean\n  purchaseId?: number | string  // ë©”ëª¨ë¦¬ ìºì‹œ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•œ purchase ID\n  onUpdate?: () => void\n  onOptimisticUpdate?: (params: {\n    itemId: number\n    selectedDate?: Date\n    action: 'confirm' | 'cancel'\n    receivedQuantity?: number\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n      received_quantity?: number\n    }\n  }) => void\n}\n\nexport function useConfirmDateAction({\n  config,\n  currentUserName,\n  canPerformAction,\n  purchaseId,\n  onUpdate,\n  onOptimisticUpdate\n}: UseConfirmDateActionProps) {\n  const supabase = createClient()\n\n  const handleConfirm = useCallback(async (\n    itemId: number | string,\n    selectedDate: Date,\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n      received_quantity?: number\n    },\n    receivedQuantity?: number\n  ) => {\n    \n    if (!canPerformAction) {\n      logger.warn(`âŒ ê¶Œí•œ ì—†ìŒ`, { canPerformAction, currentUserName })\n      toast.error(`${config.field === 'statement_received' ? 'ê±°ë˜ëª…ì„¸ì„œ' : 'ì…ê³ '} í™•ì¸ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.`)\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      logger.error('âŒ ì˜ëª»ëœ ID', { itemId, numericId })\n      toast.error('ìœ íš¨í•˜ì§€ ì•Šì€ í•­ëª© ID ì…ë‹ˆë‹¤.')\n      return\n    }\n\n    // í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ\n    if (itemInfo) {\n      const confirmMessage = `í’ˆëª©ëª…: ${itemInfo.item_name || '-'}\nê·œê²©: ${itemInfo.specification || '-'}\nìˆ˜ëŸ‰: ${itemInfo.quantity?.toLocaleString() || 0}\në‹¨ê°€: â‚©${itemInfo.unit_price_value?.toLocaleString() || 0}\ní•©ê³„: â‚©${itemInfo.amount_value?.toLocaleString() || 0}\në¹„ê³ : ${itemInfo.remark || '-'}\n\n${config.confirmMessage.confirm}`\n      \n      if (!window.confirm(confirmMessage)) {\n        return\n      }\n    }\n\n    try {\n      let updateData: any\n\n      if (config.field === 'statement_received') {\n        updateData = {\n          is_statement_received: true,\n          statement_received_date: selectedDate.toISOString(),\n          statement_received_by_name: currentUserName\n        }\n      } else if (config.field === 'actual_received') {\n        updateData = {\n          actual_received_date: selectedDate.toISOString(),\n          is_received: true,\n          received_quantity: receivedQuantity !== undefined ? receivedQuantity : (itemInfo?.received_quantity !== undefined ? itemInfo.received_quantity : null)\n        }\n      }\n\n      logger.debug('ğŸ“ ì—…ë°ì´íŠ¸í•  ë°ì´í„°:', updateData)\n\n      const { data, error } = await supabase\n        .from('purchase_request_items')\n        .update(updateData)\n        .eq('id', numericId)\n        .select()\n\n      logger.debug('ğŸ“ DB ì—…ë°ì´íŠ¸ ê²°ê³¼:', { data, error })\n\n      if (error) {\n        logger.error('âŒ DB ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', error)\n        throw error\n      }\n\n      logger.info('âœ… DB ì—…ë°ì´íŠ¸ ì„±ê³µ', data)\n\n      // ğŸš€ ë©”ëª¨ë¦¬ ìºì‹œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸\n      if (purchaseId) {\n        if (config.field === 'actual_received') {\n          const memoryUpdated = markItemAsReceived(purchaseId, numericId, selectedDate.toISOString(), receivedQuantity)\n          if (!memoryUpdated) {\n            logger.warn('[useConfirmDateAction] ë©”ëª¨ë¦¬ ìºì‹œ ì…ê³ ì™„ë£Œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { \n              purchaseId, \n              itemId: numericId \n            })\n          }\n        } else if (config.field === 'statement_received') {\n          const memoryUpdated = markItemAsStatementReceived(purchaseId, numericId, selectedDate.toISOString(), currentUserName || undefined)\n          if (!memoryUpdated) {\n            logger.warn('[useConfirmDateAction] ë©”ëª¨ë¦¬ ìºì‹œ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { \n              purchaseId, \n              itemId: numericId \n            })\n          }\n        }\n      }\n\n      if (onOptimisticUpdate) {\n        onOptimisticUpdate({\n          itemId: numericId,\n          selectedDate,\n          action: 'confirm',\n          receivedQuantity: receivedQuantity !== undefined ? receivedQuantity : itemInfo?.received_quantity,\n          itemInfo\n        })\n      }\n\n      // ê°•ì œ ìƒˆë¡œê³ ì¹¨ì„ ìœ„í•´ onUpdate í˜¸ì¶œ\n      if (onUpdate) {\n        onUpdate()\n      }\n      \n      toast.success(config.successMessage.confirm)\n    } catch (error) {\n      logger.error('âŒ ì „ì²´ ì²˜ë¦¬ ì‹¤íŒ¨', error)\n      toast.error(`${config.field === 'statement_received' ? 'ê±°ë˜ëª…ì„¸ì„œ' : 'ì…ê³ '} í™•ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.`)\n    }\n  }, [config, currentUserName, canPerformAction, purchaseId, onUpdate, onOptimisticUpdate, supabase])\n\n  const handleCancel = useCallback(async (\n    itemId: number | string,\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n    }\n  ) => {\n    if (!canPerformAction) {\n      logger.warn(`âŒ ì·¨ì†Œ ê¶Œí•œ ì—†ìŒ`, { canPerformAction, currentUserName })\n      toast.error(`${config.field === 'statement_received' ? 'ê±°ë˜ëª…ì„¸ì„œ' : 'ì…ê³ '} í™•ì¸ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.`)\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      toast.error('ìœ íš¨í•˜ì§€ ì•Šì€ í•­ëª© ID ì…ë‹ˆë‹¤.')\n      return\n    }\n\n    // í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ\n    if (itemInfo) {\n      const confirmMessage = `í’ˆëª©ëª…: ${itemInfo.item_name || '-'}\nê·œê²©: ${itemInfo.specification || '-'}\nìˆ˜ëŸ‰: ${itemInfo.quantity?.toLocaleString() || 0}\në‹¨ê°€: â‚©${itemInfo.unit_price_value?.toLocaleString() || 0}\ní•©ê³„: â‚©${itemInfo.amount_value?.toLocaleString() || 0}\në¹„ê³ : ${itemInfo.remark || '-'}\n\n${config.confirmMessage.cancel}`\n      \n      if (!window.confirm(confirmMessage)) {\n        return\n      }\n    }\n\n    try {\n      logger.debug(`ğŸ”„ ${config.field} í™•ì¸ ì·¨ì†Œ ì‹œì‘`, { \n        itemId, \n        itemName: itemInfo?.item_name \n      })\n\n      let updateData: any\n\n      if (config.field === 'statement_received') {\n        updateData = {\n          is_statement_received: false,\n          statement_received_date: null,\n          statement_received_by_name: null\n        }\n      } else if (config.field === 'actual_received') {\n        updateData = {\n          actual_received_date: null,\n          is_received: false\n        }\n      }\n\n      logger.debug('ğŸ”„ ì·¨ì†Œ ì—…ë°ì´íŠ¸í•  ë°ì´í„°:', updateData)\n\n      const { data, error } = await supabase\n        .from('purchase_request_items')\n        .update(updateData)\n        .eq('id', numericId)\n        .select()\n\n      logger.debug('ğŸ”„ ì·¨ì†Œ DB ì—…ë°ì´íŠ¸ ê²°ê³¼:', { data, error })\n\n      if (error) {\n        logger.error('âŒ DB ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', error)\n        throw error\n      }\n\n      logger.info(`âœ… ${config.field} í™•ì¸ ì·¨ì†Œ ì„±ê³µ`, data)\n\n      // ğŸš€ ë©”ëª¨ë¦¬ ìºì‹œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸\n      if (purchaseId) {\n        if (config.field === 'actual_received') {\n          const memoryUpdated = markItemAsReceiptCanceled(purchaseId, numericId)\n          if (!memoryUpdated) {\n            logger.warn('[useConfirmDateAction] ë©”ëª¨ë¦¬ ìºì‹œ ì…ê³ ì·¨ì†Œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { \n              purchaseId, \n              itemId: numericId \n            })\n          }\n        } else if (config.field === 'statement_received') {\n          const memoryUpdated = markItemAsStatementCanceled(purchaseId, numericId)\n          if (!memoryUpdated) {\n            logger.warn('[useConfirmDateAction] ë©”ëª¨ë¦¬ ìºì‹œ ê±°ë˜ëª…ì„¸ì„œ ì·¨ì†Œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { \n              purchaseId, \n              itemId: numericId \n            })\n          }\n        }\n      }\n\n      if (onOptimisticUpdate) {\n        onOptimisticUpdate({\n          itemId: numericId,\n          action: 'cancel',\n          itemInfo\n        })\n      }\n\n      // ê°•ì œ ìƒˆë¡œê³ ì¹¨ì„ ìœ„í•´ onUpdate í˜¸ì¶œ\n      if (onUpdate) {\n        onUpdate()\n      }\n      \n      toast.success(config.successMessage.cancel)\n    } catch (error) {\n      logger.error(`âŒ ${config.field} í™•ì¸ ì·¨ì†Œ ì‹¤íŒ¨`, error)\n      toast.error(`${config.field === 'statement_received' ? 'ê±°ë˜ëª…ì„¸ì„œ' : 'ì…ê³ '} í™•ì¸ ì·¨ì†Œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.`)\n    }\n  }, [config, canPerformAction, purchaseId, onUpdate, onOptimisticUpdate, supabase])\n\n  const isCompleted = useCallback((item: any) => {\n    if (config.field === 'statement_received') {\n      return item.is_statement_received\n    } else if (config.field === 'actual_received') {\n      return item.is_received // actual_received_date ëŒ€ì‹  is_received í•„ë“œ ì‚¬ìš©\n    }\n    return false\n  }, [config.field])\n\n  const getCompletedDate = useCallback((item: any) => {\n    if (config.field === 'statement_received') {\n      return item.statement_received_date\n    } else if (config.field === 'actual_received') {\n      return item.actual_received_date\n    }\n    return null\n  }, [config.field])\n\n  const getCompletedByName = useCallback((item: any) => {\n    if (config.field === 'statement_received') {\n      return item.statement_received_by_name\n    } else if (config.field === 'actual_received') {\n      // ì…ê³ ì™„ë£ŒëŠ” ì²˜ë¦¬ì ì •ë³´ë¥¼ ê¸°ë¡í•˜ì§€ ì•ŠìŒ\n      return null\n    }\n    return null\n  }, [config.field])\n\n  return {\n    config,\n    handleConfirm,\n    handleCancel,\n    isCompleted,\n    getCompletedDate,\n    getCompletedByName\n  }\n}","import { useEffect, useState, useRef, useCallback, useMemo, memo } from 'react'\nimport { createClient } from '@/lib/supabase/client'\nimport { PurchaseRequestWithDetails, Purchase, Vendor } from '@/types/purchase'\nimport { findPurchaseInMemory, markItemAsPaymentCompleted, markPurchaseAsPaymentCompleted, markItemAsReceived, markPurchaseAsReceived, markItemAsPaymentCanceled, markItemAsStatementReceived, markItemAsStatementCanceled, usePurchaseMemory, updatePurchaseInMemory, removeItemFromMemory, markItemAsExpenditureSet } from '@/stores/purchaseMemoryStore'\nimport { formatDate } from '@/utils/helpers'\nimport { DatePickerPopover } from '@/components/ui/date-picker-popover'\nimport { DateAmountPickerPopover } from '@/components/ui/date-amount-picker-popover'\nimport { DateQuantityPickerPopover } from '@/components/ui/date-quantity-picker-popover'\nimport { \n  Calendar, \n  User, \n  Building2, \n  Package, \n  CreditCard,\n  X,\n  FileText,\n  DollarSign,\n  Edit2,\n  Trash2,\n  Save,\n  Plus,\n  CheckCircle,\n  XCircle,\n  Check,\n  Truck\n} from 'lucide-react'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog'\nimport { toast } from 'sonner'\nimport { logger } from '@/lib/logger'\nimport { useConfirmDateAction } from '@/hooks/useConfirmDateAction'\nimport { format as formatDateInput } from 'date-fns'\n\ninterface PurchaseDetailModalProps {\n  purchaseId: number | null\n  isOpen: boolean\n  onClose: () => void\n  embedded?: boolean  // Dialog ì—†ì´ ë‚´ìš©ë§Œ ë Œë”ë§\n  currentUserRoles?: string[]\n  activeTab?: string\n  onRefresh?: (forceRefresh?: boolean, options?: { silent?: boolean }) => void | Promise<void>\n  onOptimisticUpdate?: (purchaseId: number, updater: (prev: Purchase) => Purchase) => void\n  onDelete?: (purchase: PurchaseRequestWithDetails) => void\n}\n\nfunction PurchaseDetailModal({ \n  purchaseId, \n  isOpen, \n  onClose, \n  embedded = false,\n  currentUserRoles = [],\n  activeTab,\n  onRefresh,\n  onOptimisticUpdate,\n  onDelete\n}: PurchaseDetailModalProps) {\n  const { allPurchases, lastFetch } = usePurchaseMemory(); // ğŸš€ ë©”ëª¨ë¦¬ ìºì‹œ ì‹¤ì‹œê°„ ë™ê¸°í™”\n  \n  const [loading, setLoading] = useState(false)\n  const [purchase, setPurchase] = useState<PurchaseRequestWithDetails | null>(null)\n  const [isEditing, setIsEditing] = useState(false)\n  const [editedPurchase, setEditedPurchase] = useState<PurchaseRequestWithDetails | null>(null)\n  const [editedItems, setEditedItems] = useState<any[]>([])\n  const [deletedItemIds, setDeletedItemIds] = useState<number[]>([])\n  const [userRoles, setUserRoles] = useState<string[]>([])\n  const [currentUserName, setCurrentUserName] = useState<string>('')\n  const [columnWidths, setColumnWidths] = useState<number[]>([])\n  const [focusedInput, setFocusedInput] = useState<string | null>(null)\n  \n  // ë©”ëª¨ë¦¬ ìºì‹œ ë™ê¸°í™”ëŠ” useEffectì—ì„œ ì²˜ë¦¬\n\n  // ğŸš€ ì‹¤ì‹œê°„ items ë°ì´í„° (ë¡œì»¬ purchase stateë¥¼ ìš°ì„  ì‚¬ìš©)\n  const currentItems = useMemo(() => {\n    // purchase stateë¥¼ ìš°ì„  ì‚¬ìš© (ë¡œì»¬ ìƒíƒœê°€ ê°€ì¥ ìµœì‹ )\n    if (purchase?.items && purchase.items.length > 0) {\n      return purchase.items;\n    }\n    if (purchase?.purchase_request_items && purchase.purchase_request_items.length > 0) {\n      return purchase.purchase_request_items;\n    }\n    \n    // purchase stateê°€ ì—†ìœ¼ë©´ ë©”ëª¨ë¦¬ ìºì‹œì—ì„œ ê°€ì ¸ì˜¤ê¸°\n    if (purchaseId && allPurchases) {\n      const memoryPurchase = allPurchases.find(p => p.id === purchaseId);\n      if (memoryPurchase) {\n        return (memoryPurchase.items && memoryPurchase.items.length > 0) ? memoryPurchase.items : (memoryPurchase.purchase_request_items || []);\n      }\n    }\n    \n    return [];\n  }, [purchase, purchaseId, allPurchases, lastFetch]); // purchase ê°ì²´ ì „ì²´ë¥¼ ì˜ì¡´ì„±ìœ¼ë¡œ ì‚¬ìš©í•˜ì—¬ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ë³´ì¥\n\n  const tableMinWidth = useMemo(() => {\n    if (columnWidths.length > 0) {\n      const columnGap = columnWidths.length > 1 ? (columnWidths.length - 1) * 12 : 0\n      const padding = 24\n      const total = columnWidths.reduce((sum, width) => sum + width, 0) + columnGap + padding\n      return Math.max(total, 720)\n    }\n\n    const baseColumns: number[] = [120, 200, 70, 90, 100, 150, 80] // í’ˆëª©ëª…, ê·œê²©, ìˆ˜ëŸ‰, ë‹¨ê°€, í•©ê³„, ë¹„ê³ , ìƒíƒœ\n\n    if (activeTab === 'purchase') {\n      baseColumns.push(120)\n    }\n\n    if (activeTab === 'receipt' || activeTab === 'done') {\n      baseColumns.push(120)\n    }\n\n    if (activeTab === 'receipt') {\n      baseColumns.push(140)\n    }\n\n    if (activeTab === 'done') {\n      baseColumns.push(100, 80, 110) // ê±°ë˜ëª…ì„¸ì„œ(100), íšŒê³„ìƒì…ê³ ì¼(80), ì§€ì¶œì •ë³´(110)\n    }\n\n    if (isEditing) {\n      baseColumns.push(110)\n    }\n\n    const columnGap = baseColumns.length > 1 ? (baseColumns.length - 1) * 12 : 0\n    const total = baseColumns.reduce((sum, width) => sum + width, 0) + columnGap + 48\n    return Math.max(total, 720)\n  }, [columnWidths, activeTab, isEditing])\n  const headerRowRef = useRef<HTMLDivElement>(null)\n  const supabase = createClient()\n  \n  // ì‚¬ìš©ì ê¶Œí•œ ë° ì´ë¦„ ì§ì ‘ ë¡œë“œ\n  useEffect(() => {\n    const loadUserRoles = async () => {\n      try {\n        // Supabase í™˜ê²½ ë³€ìˆ˜ í™•ì¸\n        const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\n        const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;\n        \n        if (!supabaseUrl || !supabaseAnonKey || supabaseUrl.includes('placeholder')) {\n          logger.warn('Supabase í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•ŠìŒ - PurchaseDetailModal');\n          return;\n        }\n\n        const { data: { user } } = await supabase.auth.getUser()\n        if (user) {\n          // ë¨¼ì € IDë¡œ ì‹œë„\n          let { data: employeeData } = await supabase\n            .from('employees')\n            .select('*')\n            .eq('id', user.id)\n            .maybeSingle()\n          \n          // IDë¡œ ëª» ì°¾ì•˜ìœ¼ë©´ ì´ë©”ì¼ë¡œ ì‹œë„\n          if (!employeeData && user.email) {\n            const { data: employeeByEmail } = await supabase\n              .from('employees')\n              .select('*')\n              .eq('email', user.email)\n              .maybeSingle()\n            \n            employeeData = employeeByEmail\n          }\n          \n          // ì‚¬ìš©ì ì´ë¦„ ì €ì¥\n          if (employeeData?.name) {\n            setCurrentUserName(employeeData.name)\n          }\n          \n          if (employeeData?.purchase_role) {\n            let roles: string[] = []\n            if (Array.isArray(employeeData.purchase_role)) {\n              roles = employeeData.purchase_role.map((r: any) => String(r).trim())\n            } else {\n              const roleString = String(employeeData.purchase_role)\n              roles = roleString\n                .split(',')\n                .map((r: string) => r.trim())\n                .filter((r: string) => r.length > 0)\n            }\n            setUserRoles(roles)\n          }\n        }\n      } catch (error) {\n      }\n    }\n    \n    if (isOpen) {\n      loadUserRoles()\n    }\n  }, [isOpen])\n  \n  // currentUserRolesê°€ ë°°ì—´ì´ ì•„ë‹ˆë©´ userRoles ì‚¬ìš©\n  const effectiveRoles = Array.isArray(currentUserRoles) && currentUserRoles.length > 0 \n    ? currentUserRoles \n    : userRoles\n  \n  // ê¶Œí•œ ì²´í¬\n  // ì „ì²´ ìˆ˜ì • ê¶Œí•œ (ëª¨ë“  í•„ë“œ ìˆ˜ì • ê°€ëŠ¥)\n  const canEditAll = effectiveRoles.includes('final_approver') || \n                     effectiveRoles.includes('app_admin') || \n                     effectiveRoles.includes('ceo')\n  \n  // lead buyer ì œí•œì  ìˆ˜ì • ê¶Œí•œ (ê¸ˆì•¡/ìˆ˜ëŸ‰ë§Œ ìˆ˜ì • ê°€ëŠ¥)\n  const canEditLimited = effectiveRoles.includes('lead buyer')\n  \n  // í†µí•© ìˆ˜ì • ê¶Œí•œ (ë‘˜ ì¤‘ í•˜ë‚˜ë¼ë„ ìˆìœ¼ë©´ ìˆ˜ì • ëª¨ë“œ í™œì„±í™”)\n  const canEdit = canEditAll || canEditLimited\n  \n  // ì‚­ì œ ê¶Œí•œ: ê´€ë¦¬ì ë˜ëŠ” ìš”ì²­ì ë³¸ì¸ (ë‹¨, ìŠ¹ì¸ëœ ìš”ì²­ì€ ê´€ë¦¬ìë§Œ, lead buyerëŠ” ì‚­ì œ ë¶ˆê°€)\n  const isApproved = purchase?.final_manager_status === 'approved';\n  const canDelete = isApproved \n    ? canEditAll  // ìŠ¹ì¸ëœ ìš”ì²­ì€ ê´€ë¦¬ìë§Œ ì‚­ì œ ê°€ëŠ¥ (lead buyer ì œì™¸)\n    : (canEditAll || (purchase?.requester_name === currentUserName))  // ë¯¸ìŠ¹ì¸ë„ lead buyer ì œì™¸\n  \n  // êµ¬ë§¤ ê¶Œí•œ ì²´í¬: app_admin + lead buyerë§Œ (ìš”ì²­ì ë³¸ì¸ ì œì™¸)\n  const canPurchase = effectiveRoles.includes('app_admin') || \n                     effectiveRoles.includes('lead buyer') || \n                     effectiveRoles.includes('lead buyer')\n  \n  // ì…ê³  ê¶Œí•œ ì²´í¬ \n  // 1. ê´€ë¦¬ìëŠ” ëª¨ë“  ê±´ ì…ê³  ì²˜ë¦¬ ê°€ëŠ¥\n  // 2. ìš”ì²­ìëŠ” ìì‹ ì˜ ìš”ì²­ê±´ë§Œ ì…ê³  ì²˜ë¦¬ ê°€ëŠ¥\n  const canReceiveItems = effectiveRoles.includes('app_admin') || \n                         (purchase?.requester_name === currentUserName)\n  // 2. ì¼ë°˜ ì§ì›ì€ ë³¸ì¸ì´ ìš”ì²­í•œ ê±´ë§Œ ì…ê³  ì²˜ë¦¬ ê°€ëŠ¥\n  const isAdmin = effectiveRoles.includes('final_approver') || \n                  effectiveRoles.includes('app_admin') || \n                  effectiveRoles.includes('ceo')\n  const isRequester = purchase?.requester_name === currentUserName\n  \n  // ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ & UTK í™•ì¸ ê¶Œí•œ: app_adminê³¼ lead buyerë§Œ ê°€ëŠ¥\n  const canReceiptCheck = effectiveRoles.includes('app_admin') || \n                         effectiveRoles.includes('lead buyer')\n  \n  // ì…ê³  ì²˜ë¦¬ ê¶Œí•œ: app_admin ë˜ëŠ” ë³¸ì¸ì´ ìš”ì²­í•œ ê±´\n  const canProcessReceipt = effectiveRoles.includes('app_admin') || isRequester\n  \n\n  // ëª¨ë‹¬ ë‚´ë¶€ ë°ì´í„°ë§Œ ìƒˆë¡œê³ ì¹¨í•˜ëŠ” í•¨ìˆ˜ (ëª¨ë‹¬ ë‹«ì§€ ì•ŠìŒ)\n  const refreshModalData = useCallback(async () => {\n    if (!purchaseId) return\n    \n    try {\n      // ğŸš€ ë©”ëª¨ë¦¬ì—ì„œ ë¨¼ì € ì°¾ê¸° (ì¦‰ì‹œ ìƒˆë¡œê³ ì¹¨)\n      const memoryPurchase = findPurchaseInMemory(purchaseId)\n      if (memoryPurchase) {\n        \n        // items í•„ë“œ ì •ê·œí™”: purchase_request_itemsë¥¼ itemsë¡œ ë³µì‚¬\n        const normalizedItems = (memoryPurchase.items && memoryPurchase.items.length > 0)\n          ? memoryPurchase.items \n          : (memoryPurchase.purchase_request_items || [])\n        \n        // ë©”ëª¨ë¦¬ ë°ì´í„°ë¥¼ PurchaseRequestWithDetails í˜•íƒœë¡œ ë³€í™˜\n        const purchaseData = {\n          ...memoryPurchase,\n          id: String(memoryPurchase.id), // PurchaseRequestëŠ” idê°€ string\n          is_po_generated: false, // Purchase íƒ€ì…ì—ëŠ” ì—†ì§€ë§Œ PurchaseRequestì— í•„ìˆ˜\n          items: normalizedItems, // ì •ê·œí™”ëœ items ì‚¬ìš©\n          purchase_request_items: normalizedItems, // í•˜ìœ„ í˜¸í™˜ì„±ì„ ìœ„í•´ ì–‘ìª½ ëª¨ë‘ ì„¤ì •\n          vendor: {\n            id: memoryPurchase.vendor_id,\n            vendor_name: memoryPurchase.vendor_name || 'ì•Œ ìˆ˜ ì—†ìŒ',\n            is_active: true\n          } as Vendor,\n          vendor_contacts: []\n        } as PurchaseRequestWithDetails\n        \n        setPurchase(purchaseData)\n        setEditedPurchase(purchaseData)\n        setEditedItems(normalizedItems.length > 0 ? normalizedItems : [])\n        return\n      }\n      \n      // ë©”ëª¨ë¦¬ì— ì—†ëŠ” ê²½ìš°ì—ë§Œ DBì—ì„œ ë¡œë“œ (fallback)\n      const supabase = createClient()\n      // ìµœì‹  êµ¬ë§¤ ìš”ì²­ ë°ì´í„° ë¡œë“œ\n      const { data, error } = await supabase\n        .from('purchase_requests')\n        .select(`\n          *,\n          vendors(id, vendor_name),\n          purchase_request_items(*)\n        `)\n        .eq('id', purchaseId)\n        .single()\n      \n      if (error) throw error\n\n      if (data) {\n        // ë¼ì¸ë„˜ë²„ ìˆœì„œëŒ€ë¡œ ì •ë ¬\n        const sortedItems = (data.purchase_request_items || []).sort((a: any, b: any) => {\n          const lineA = a.line_number || 999999;\n          const lineB = b.line_number || 999999;\n          return lineA - lineB;\n        });\n\n        const purchaseData = {\n          ...data,\n          items: sortedItems,\n          vendor: data.vendors || { id: 0, vendor_name: 'ì•Œ ìˆ˜ ì—†ìŒ' },\n          vendor_contacts: []\n        } as PurchaseRequestWithDetails\n\n        setPurchase(purchaseData)\n        setEditedPurchase(purchaseData)\n        setEditedItems(sortedItems)\n      }\n    } catch (error) {\n      logger.error('ëª¨ë‹¬ ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨', error)\n    }\n  }, [purchaseId])\n\n  // ğŸš€ ë©”ëª¨ë¦¬ ìºì‹œ ë³€ê²½ ì‹¤ì‹œê°„ ê°ì§€ ë° ëª¨ë‹¬ ë°ì´í„° ë™ê¸°í™”\n  useEffect(() => {\n    if (!purchaseId || !allPurchases || !purchase) return;\n\n    const memoryPurchase = allPurchases.find(p => p.id === purchaseId);\n    if (memoryPurchase) {\n      // ë©”ëª¨ë¦¬ ë°ì´í„°ë¡œ purchase state ì—…ë°ì´íŠ¸ (ê¹œë¹¡ì„ ì—†ì´ ì‹¤ì‹œê°„ ë°˜ì˜)\n      const normalizedItems = (memoryPurchase.items && memoryPurchase.items.length > 0) \n        ? memoryPurchase.items \n        : (memoryPurchase.purchase_request_items || []);\n      \n      const updatedPurchase = {\n        ...purchase,\n        ...memoryPurchase,\n        id: String(memoryPurchase.id),\n        items: normalizedItems,\n        purchase_request_items: normalizedItems\n      } as PurchaseRequestWithDetails;\n\n      setPurchase(updatedPurchase);\n      setEditedPurchase(updatedPurchase);\n      setEditedItems(normalizedItems.length > 0 ? normalizedItems : []);\n    }\n  }, [allPurchases, lastFetch]); // lastFetch ì¶”ê°€ë¡œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ê°•ì œ ê°ì§€\n\n  // ğŸš€ ëª¨ë‹¬ì´ ì—´ë¦´ ë•Œë§ˆë‹¤ ë©”ëª¨ë¦¬ì—ì„œ ìµœì‹  ë°ì´í„° ê°•ì œ ë™ê¸°í™”\n  useEffect(() => {\n    if (!isOpen || !purchaseId || !allPurchases) return;\n\n    const memoryPurchase = allPurchases.find(p => p.id === purchaseId);\n    if (memoryPurchase) {\n      const normalizedItems = (memoryPurchase.items && memoryPurchase.items.length > 0) \n        ? memoryPurchase.items \n        : (memoryPurchase.purchase_request_items || []);\n      \n      const updatedPurchase = {\n        ...memoryPurchase,\n        id: String(memoryPurchase.id),\n        is_po_generated: false,\n        items: normalizedItems,\n        purchase_request_items: normalizedItems,\n        vendor: {\n          id: memoryPurchase.vendor_id,\n          vendor_name: memoryPurchase.vendor_name || 'ì•Œ ìˆ˜ ì—†ìŒ',\n          is_active: true\n        } as Vendor,\n        vendor_contacts: []\n      } as PurchaseRequestWithDetails;\n\n      setPurchase(updatedPurchase);\n      setEditedPurchase(updatedPurchase);\n      setEditedItems(normalizedItems.length > 0 ? normalizedItems : []);\n    }\n  }, [isOpen, purchaseId, allPurchases]); // ëª¨ë‹¬ì´ ì—´ë¦´ ë•Œë§ˆë‹¤ ì‹¤í–‰\n  \n  // ì»´í¬ë„ŒíŠ¸ê°€ ë§ˆìš´íŠ¸ë  ë•Œ ì™¸ë¶€ ìƒˆë¡œê³ ì¹¨ì„ ë°©ì§€í•˜ëŠ” í”Œë˜ê·¸\n  const [isInitialLoad, setIsInitialLoad] = useState(true)\n  \n  // ì»¤ìŠ¤í…€ í›… ì„¤ì •\n  const purchaseIdNumber = purchaseId ? Number(purchaseId) : (purchase ? Number(purchase.id) : NaN)\n\n  const handleActualReceiptOptimisticUpdate = useCallback(({ itemId, selectedDate, action, receivedQuantity }: {\n    itemId: number\n    selectedDate?: Date\n    action: 'confirm' | 'cancel'\n    receivedQuantity?: number\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n      received_quantity?: number\n    }\n  }) => {\n    const itemIdStr = String(itemId)\n    const nowIso = new Date().toISOString()\n    const selectedDateIso = selectedDate ? selectedDate.toISOString() : undefined\n\n    const updateItems = (items?: any[]) => {\n      if (!items) return items\n      return items.map(item => {\n        if (String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_received: true,\n            actual_received_date: selectedDateIso,\n            received_at: nowIso,\n            received_quantity: receivedQuantity !== undefined ? receivedQuantity : item.received_quantity\n          }\n        }\n\n        return {\n          ...item,\n          is_received: false,\n          actual_received_date: undefined,\n          received_at: undefined,\n          received_quantity: undefined\n        }\n      })\n    }\n\n    setPurchase(prev => {\n      if (!prev) return prev\n      const updatedItems = updateItems(prev.items) || []\n      const updatedRequestItems = updateItems(prev.purchase_request_items) || []\n      const total = updatedItems.length\n      const completed = updatedItems.filter(item => item.is_received).length\n      const allReceived = total > 0 && completed === total\n\n      return {\n        ...prev,\n        items: updatedItems,\n        purchase_request_items: updatedRequestItems,\n        is_received: allReceived,\n        received_at: allReceived ? (prev.received_at || nowIso) : undefined,\n        updated_at: new Date().toISOString()\n      }\n    })\n\n    setEditedPurchase(prev => {\n      if (!prev) return prev\n      const updatedItems = updateItems(prev.items) || []\n      const updatedRequestItems = updateItems(prev.purchase_request_items) || []\n      return {\n        ...prev,\n        items: updatedItems,\n        purchase_request_items: updatedRequestItems\n      }\n    })\n\n    setEditedItems(prevItems => {\n      if (!prevItems || prevItems.length === 0) return prevItems\n      return prevItems.map(item => {\n        if (!item.id || String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_received: true,\n            actual_received_date: selectedDateIso,\n            received_at: nowIso,\n            received_quantity: receivedQuantity !== undefined ? receivedQuantity : item.received_quantity\n          }\n        }\n\n        return {\n          ...item,\n          is_received: false,\n          actual_received_date: undefined,\n          received_at: undefined,\n          received_quantity: undefined\n        }\n      })\n    })\n\n    if (!Number.isNaN(purchaseIdNumber)) {\n      onOptimisticUpdate?.(purchaseIdNumber, prevPurchase => {\n        const updatedItems = updateItems(prevPurchase.items) || prevPurchase.items || []\n        const updatedRequestItems = updateItems(prevPurchase.purchase_request_items) || prevPurchase.purchase_request_items || []\n        const total = updatedItems.length || prevPurchase.items?.length || 0\n        const completed = updatedItems.filter(item => item.is_received).length\n        const allReceived = total > 0 && completed === total\n\n        return {\n          ...prevPurchase,\n          items: updatedItems,\n          purchase_request_items: updatedRequestItems,\n          is_received: allReceived,\n          received_at: allReceived ? (prevPurchase.received_at || nowIso) : undefined,\n          updated_at: new Date().toISOString()\n        }\n      })\n    }\n  }, [onOptimisticUpdate, purchaseIdNumber])\n\n  const handleStatementReceivedOptimisticUpdate = useCallback(({ itemId, selectedDate, action }: {\n    itemId: number\n    selectedDate?: Date\n    action: 'confirm' | 'cancel'\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n    }\n  }) => {\n    const itemIdStr = String(itemId)\n    const selectedDateIso = selectedDate ? selectedDate.toISOString() : undefined\n\n    let nextAllCompleted = false\n    let nextStatementAt: string | null = null\n\n    setPurchase(prev => {\n      if (!prev) return prev\n\n      const updatedItems = (prev.items || []).map(item => {\n        if (String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_statement_received: true,\n            statement_received_date: selectedDateIso,\n            statement_received_by_name: currentUserName\n          }\n        }\n\n        return {\n          ...item,\n          is_statement_received: false,\n          statement_received_date: null,\n          statement_received_by_name: null\n        }\n      })\n\n      nextAllCompleted = updatedItems.length > 0 && updatedItems.every(item => item.is_statement_received)\n      nextStatementAt = nextAllCompleted\n        ? (selectedDateIso || prev.statement_received_at || new Date().toISOString())\n        : null\n\n      return {\n        ...prev,\n        items: updatedItems,\n        is_statement_received: nextAllCompleted,\n        statement_received_at: nextStatementAt\n      }\n    })\n\n    setEditedPurchase(prev => {\n      if (!prev) return prev\n\n      const updatedItems = (prev.items || []).map(item => {\n        if (String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_statement_received: true,\n            statement_received_date: selectedDateIso,\n            statement_received_by_name: currentUserName\n          }\n        }\n\n        return {\n          ...item,\n          is_statement_received: false,\n          statement_received_date: null,\n          statement_received_by_name: null\n        }\n      })\n\n      return {\n        ...prev,\n        items: updatedItems,\n        is_statement_received: nextAllCompleted,\n        statement_received_at: nextStatementAt\n      }\n    })\n\n    setEditedItems(prevItems => {\n      if (!prevItems) return prevItems\n      return prevItems.map(item => {\n        if (String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_statement_received: true,\n            statement_received_date: selectedDateIso,\n            statement_received_by_name: currentUserName\n          }\n        }\n\n        return {\n          ...item,\n          is_statement_received: false,\n          statement_received_date: null,\n          statement_received_by_name: null\n        }\n      })\n    })\n\n    if (!Number.isNaN(purchaseIdNumber)) {\n      onOptimisticUpdate?.(purchaseIdNumber, prevPurchase => {\n        const updatedItems = (prevPurchase.items || []).map(item => {\n          if (String(item.id) !== itemIdStr) return item\n\n          if (action === 'confirm') {\n            return {\n              ...item,\n              is_statement_received: true,\n              statement_received_date: selectedDateIso,\n              statement_received_by_name: currentUserName\n            }\n          }\n\n          return {\n            ...item,\n            is_statement_received: false,\n            statement_received_date: null,\n            statement_received_by_name: null\n          }\n        })\n\n        const allCompleted = updatedItems.length > 0 && updatedItems.every(item => item.is_statement_received)\n\n        return {\n          ...prevPurchase,\n          items: updatedItems,\n          is_statement_received: allCompleted\n        }\n      })\n    }\n\n    // purchase_requests ë ˆë²¨ í”Œë˜ê·¸ë„ ì—…ë°ì´íŠ¸\n    if (purchase && nextAllCompleted !== undefined) {\n      const supabase = createClient()\n      supabase\n        .from('purchase_requests')\n        .update({\n          is_statement_received: nextAllCompleted,\n          statement_received_at: nextStatementAt\n        })\n        .eq('id', purchase.id)\n        .then(({ error }: { error: any }) => {\n          if (error) {\n            logger.error('ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ purchase_requests ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', error)\n          }\n        })\n    }\n  }, [currentUserName, onOptimisticUpdate, purchaseIdNumber, purchase])\n\n  const statementReceivedAction = useConfirmDateAction({\n    config: {\n      field: 'statement_received',\n      confirmMessage: {\n        confirm: 'ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ì„ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?',\n        cancel: 'ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?'\n      },\n      successMessage: {\n        confirm: 'ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.',\n        cancel: 'ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.'\n      },\n      completedText: 'âœ“ ì™„ë£Œ',\n      waitingText: 'ëŒ€ê¸°'\n    },\n    currentUserName,\n    canPerformAction: canReceiptCheck,\n    purchaseId: purchase?.id,\n    onUpdate: refreshModalData,\n    onOptimisticUpdate: handleStatementReceivedOptimisticUpdate\n  })\n\n  const actualReceivedAction = useConfirmDateAction({\n    config: {\n      field: 'actual_received',\n      confirmMessage: {\n        confirm: 'ì‹¤ì œ ì…ê³  ì²˜ë¦¬ë¥¼ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?',\n        cancel: 'ì‹¤ì œ ì…ê³  ì²˜ë¦¬ë¥¼ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?'\n      },\n      successMessage: {\n        confirm: 'ì‹¤ì œ ì…ê³  ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.',\n        cancel: 'ì‹¤ì œ ì…ê³  ì²˜ë¦¬ê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.'\n      },\n      completedText: 'ì…ê³ ì™„ë£Œ',\n      waitingText: 'ì…ê³ ëŒ€ê¸°'\n    },\n    currentUserName,\n    canPerformAction: canProcessReceipt,\n    purchaseId: purchase?.id,\n    onUpdate: refreshModalData,\n    onOptimisticUpdate: handleActualReceiptOptimisticUpdate\n  })\n  \n  // ë‚ ì§œ ì„ íƒ í•¸ë“¤ëŸ¬ë“¤\n  \n  \n  // ìŠ¹ì¸ ê¶Œí•œ ì²´í¬\n const canApproveMiddle = effectiveRoles.includes('middle_manager') || \n                          effectiveRoles.includes('app_admin') || \n                          effectiveRoles.includes('ceo')\n \n const canApproveFinal = effectiveRoles.includes('final_approver') || \n                         effectiveRoles.includes('app_admin') || \n                         effectiveRoles.includes('ceo')\n \n const approvalPillClass = 'inline-flex items-center gap-1 business-radius-badge px-2 py-0.5 badge-text leading-tight'\n const approvalButtonClass = 'inline-flex items-center gap-1 business-radius-badge !h-auto !min-h-0 !px-2.5 !py-0.5 badge-text leading-tight'\n const approvalWaitingPillClass = 'inline-flex items-center gap-1 business-radius-badge px-2.5 py-0.5 badge-text leading-tight'\n \n \n  useEffect(() => {\n    if (purchaseId && isOpen) {\n      // ğŸš€ ë©”ëª¨ë¦¬ì—ì„œ ì¦‰ì‹œ ë°ì´í„° í™•ì¸ í›„ ë¡œë“œ\n      const memoryPurchase = findPurchaseInMemory(purchaseId)\n      if (memoryPurchase) {\n        // ë©”ëª¨ë¦¬ì— ìˆìœ¼ë©´ ì¦‰ì‹œ ë¡œë“œ (loading ìƒíƒœ ì—†ìŒ)\n        const purchaseData = {\n          ...memoryPurchase,\n          id: String(memoryPurchase.id), // PurchaseRequestëŠ” idê°€ string\n          is_po_generated: false, // Purchase íƒ€ì…ì—ëŠ” ì—†ì§€ë§Œ PurchaseRequestì— í•„ìˆ˜\n          vendor: {\n            id: memoryPurchase.vendor_id,\n            vendor_name: memoryPurchase.vendor_name || 'ì•Œ ìˆ˜ ì—†ìŒ',\n            is_active: true\n          } as Vendor,\n          vendor_contacts: []\n        } as PurchaseRequestWithDetails\n        \n        setPurchase(purchaseData)\n        setEditedPurchase(purchaseData)\n        setEditedItems(memoryPurchase.items || [])\n      } else {\n        // ë©”ëª¨ë¦¬ì— ì—†ìœ¼ë©´ ê¸°ì¡´ ë°©ì‹ìœ¼ë¡œ ë¡œë“œ\n        loadPurchaseDetail(purchaseId.toString())\n      }\n      setIsEditing(false) // ëª¨ë‹¬ ì—´ ë•Œë§ˆë‹¤ í¸ì§‘ ëª¨ë“œ ì´ˆê¸°í™”\n    }\n  }, [purchaseId, isOpen])\n\n  // ì¹¼ëŸ¼ ë„ˆë¹„ ê³„ì‚° (í…ìŠ¤íŠ¸ ê¸¸ì´ ê¸°ë°˜)\n  const calculateOptimalColumnWidths = useCallback(() => {\n    // itemsì™€ purchase_request_items ë‘˜ ë‹¤ í™•ì¸\n    const items = (purchase?.items && purchase.items.length > 0) \n      ? purchase.items \n      : (purchase?.purchase_request_items && purchase.purchase_request_items.length > 0)\n      ? purchase.purchase_request_items\n      : []\n    \n    if (items.length === 0) return []\n\n    const columnConfigs = [\n      { key: 'item_name', minWidth: 80, maxWidth: 500, baseWidth: 80 },\n      { key: 'specification', minWidth: 200, maxWidth: 200, baseWidth: 200, isFixed: true }, // ê³ ì • ë„ˆë¹„ 200px\n      { key: 'quantity', minWidth: 70, maxWidth: 120, baseWidth: 70 }, // 100/0 í˜•ì‹ ê³ ë ¤í•˜ì—¬ maxWidth ì¦ê°€\n      { key: 'unit_price', minWidth: 90, maxWidth: 150, baseWidth: 90 },\n      { key: 'total_price', minWidth: 100, maxWidth: 180, baseWidth: 100 },\n      { key: 'remarks', minWidth: 150, maxWidth: 150, baseWidth: 150, isFixed: true }, // ê³ ì • ë„ˆë¹„ 150px\n      { key: 'status', minWidth: 80, maxWidth: 120, baseWidth: 80 }\n    ]\n\n      // ì¶”ê°€ ì¹¼ëŸ¼ë“¤ (íƒ­ë³„)\n      if (activeTab === 'receipt') {\n        columnConfigs.push(\n          { key: 'actual_receipt_date', minWidth: 100, maxWidth: 160, baseWidth: 100, isFixed: false }\n        )\n      }\n      if (activeTab === 'done') {\n        columnConfigs.push(\n          { key: 'transaction_confirm', minWidth: 100, maxWidth: 160, baseWidth: 100, isFixed: false },\n          { key: 'accounting_date', minWidth: 80, maxWidth: 80, baseWidth: 80, isFixed: true },\n          { key: 'expenditure_info', minWidth: 100, maxWidth: 200, baseWidth: 100, isFixed: false }\n        )\n      }\n\n    const calculatedWidths = columnConfigs.map((config, index) => {\n      let maxLength = 4 // ìµœì†Œ 4ì\n\n      // í—¤ë” í…ìŠ¤íŠ¸ ê¸¸ì´ ê³ ë ¤ (íƒ­ë³„)\n      const getHeaders = () => {\n        const statusHeader = activeTab === 'purchase'\n          ? 'êµ¬ë§¤ìƒíƒœ'\n          : (activeTab === 'receipt' || activeTab === 'done')\n          ? 'ì…ê³ ìƒíƒœ'\n          : 'ìƒíƒœ'\n\n        // ìŠ¹ì¸ëŒ€ê¸°íƒ­ì—ì„œëŠ” ìƒíƒœ ì¹¼ëŸ¼ ì œì™¸\n        // receipt, done íƒ­ì—ì„œëŠ” 'ìš”ì²­/ì‹¤ì œ ì…ê³ ìˆ˜ëŸ‰' í˜•ì‹ìœ¼ë¡œ í—¤ë” ê¸¸ì´ ê³„ì‚°\n        const quantityHeader = (activeTab === 'receipt' || activeTab === 'done') \n          ? 'ìš”ì²­/ì‹¤ì œ ì…ê³ ìˆ˜ëŸ‰' \n          : 'ìš”ì²­ìˆ˜ëŸ‰'\n        const baseHeaders = activeTab === 'pending' \n          ? ['í’ˆëª©ëª…', 'ê·œê²©', quantityHeader, 'ë‹¨ê°€', 'í•©ê³„', 'ë¹„ê³ ']\n          : ['í’ˆëª©ëª…', 'ê·œê²©', quantityHeader, 'ë‹¨ê°€', 'í•©ê³„', 'ë¹„ê³ ', statusHeader]\n        if (activeTab === 'receipt') {\n          return [...baseHeaders, 'ì‹¤ì œì…ê³ ì¼']\n        } else if (activeTab === 'done') {\n          return [...baseHeaders, 'ê±°ë˜ëª…ì„¸ì„œ í™•ì¸', 'íšŒê³„ìƒ ì…ê³ ì¼', 'ì§€ì¶œì •ë³´']\n        }\n        return baseHeaders\n      }\n      \n      const headers = getHeaders()\n      if (headers[index]) {\n        maxLength = Math.max(maxLength, headers[index].length)\n      }\n\n      // ì‹¤ì œ ë°ì´í„°ì—ì„œ ìµœëŒ€ ê¸¸ì´ ì°¾ê¸°\n      items.forEach(item => {\n        let cellValue = ''\n        switch (config.key) {\n          case 'item_name':\n            cellValue = item.item_name || ''\n            break\n          case 'specification':\n            cellValue = item.specification || ''\n            break\n          case 'quantity':\n            // receipt, done íƒ­ì—ì„œëŠ” ìš”ì²­ìˆ˜ëŸ‰/ì‹¤ì œì…ê³ ìˆ˜ëŸ‰ í˜•ì‹ìœ¼ë¡œ í‘œì‹œ\n            if (activeTab === 'receipt' || activeTab === 'done') {\n              const quantity = item.quantity || 0\n              const receivedQuantity = item.received_quantity ?? 0\n              // 100 ì´ìƒì´ë©´ 2í–‰ìœ¼ë¡œ í‘œì‹œë˜ë¯€ë¡œ ë” ê¸´ ìˆ«ì ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°\n              // ì²« ë²ˆì§¸ í–‰ì˜ ìˆ«ì ê¸¸ì´ë§Œ ê³ ë ¤ (ë‘ ë²ˆì§¸ í–‰ì€ /ìˆ«ìì´ë¯€ë¡œ ë” ì§§ìŒ)\n              cellValue = quantity >= 100 || receivedQuantity >= 100 \n                ? `${quantity}` // 2í–‰ì¼ ë•ŒëŠ” ì²« ë²ˆì§¸ í–‰ë§Œ ê³ ë ¤\n                : `${quantity}/${receivedQuantity}` // 1í–‰ì¼ ë•ŒëŠ” ì „ì²´ ê³ ë ¤\n            } else {\n              cellValue = item.quantity?.toString() || ''\n            }\n            break\n          case 'unit_price':\n            cellValue = item.unit_price_value != null ? item.unit_price_value.toLocaleString() : ''\n            break\n          case 'total_price':\n            if (item.amount_value != null) {\n              cellValue = item.amount_value.toLocaleString()\n            } else if (item.quantity != null && item.unit_price_value != null) {\n              cellValue = (Number(item.quantity) * Number(item.unit_price_value)).toLocaleString()\n            } else {\n              cellValue = ''\n            }\n            break\n          case 'remarks':\n            cellValue = item.remark || ''\n            break\n          case 'status':\n            cellValue = getStatusDisplay(item) || ''\n            break\n          case 'actual_receipt_date':\n            cellValue = item.actual_received_date ? formatDate(item.actual_received_date) : ''\n            break\n          case 'transaction_confirm':\n            cellValue = item.is_statement_received ? 'í™•ì¸ì™„ë£Œ' : 'ë¯¸í™•ì¸'\n            break\n          case 'accounting_date':\n            cellValue = item.statement_received_date ? formatDate(item.statement_received_date) : ''\n            break\n          case 'expenditure_info':\n            // ì§€ì¶œì •ë³´ëŠ” ë‚ ì§œì™€ ê¸ˆì•¡ì´ 2ì¤„ë¡œ í‘œì‹œë˜ë¯€ë¡œ íŠ¹ë³„ ì²˜ë¦¬\n            if (item.expenditure_date && item.expenditure_amount !== null && item.expenditure_amount !== undefined) {\n              // ì‹¤ì œ í‘œì‹œ í˜•ì‹: \"2025. 11. 25.\" (ì•½ 14ì)\n              cellValue = '2025. 11. 25.' // ë‚ ì§œ í˜•ì‹ ê³ ì • ê¸¸ì´\n            } else {\n              cellValue = 'ì§€ì¶œì…ë ¥' // ë²„íŠ¼ í…ìŠ¤íŠ¸\n            }\n            break\n        }\n        \n        // í•œê¸€/ì˜ë¬¸ í˜¼í•© í…ìŠ¤íŠ¸ ê¸¸ì´ ê³„ì‚° (í•œê¸€ì€ 1.5ë°° ê°€ì¤‘ì¹˜)\n        const adjustedLength = cellValue.split('').reduce((acc, char) => {\n          return acc + (/[ê°€-í£]/.test(char) ? 1.5 : 1)\n        }, 0)\n        \n        maxLength = Math.max(maxLength, Math.ceil(adjustedLength))\n      })\n\n      // ê³ ì • ë„ˆë¹„ ì¹¼ëŸ¼ì€ ë°”ë¡œ ë°˜í™˜\n      if (config.isFixed) {\n        return config.baseWidth\n      }\n      \n      // ê¸¸ì´ë¥¼ í”½ì…€ë¡œ ë³€í™˜ (ê¸€ìë‹¹ ì•½ 7px + ì—¬ë°± 20px)\n      let calculatedWidth = Math.max(\n        config.minWidth,\n        Math.min(config.maxWidth, maxLength * 7 + 20)\n      )\n      \n      // ì§€ì¶œì •ë³´ ì¹¼ëŸ¼ì€ ì‹¤ì œ í‘œì‹œë˜ëŠ” í…ìŠ¤íŠ¸ê°€ 2ì¤„ì´ë¯€ë¡œ ë” ì •í™•í•œ ê³„ì‚°\n      if (config.key === 'expenditure_info') {\n        // ë‚ ì§œ í˜•ì‹ \"2025. 11. 25.\" ê¸°ì¤€ìœ¼ë¡œ ê³ ì •\n        // 2ì¤„ í‘œì‹œì´ë¯€ë¡œ ì¶©ë¶„í•œ ì—¬ë°±ì„ ì£¼ë˜ ìµœì†Œí™”\n        calculatedWidth = 110 // ê³ ì • ë„ˆë¹„ë¡œ ì„¤ì •\n      }\n\n      return calculatedWidth\n    })\n\n    setColumnWidths(calculatedWidths)\n    return calculatedWidths\n  }, [purchase, activeTab])\n\n  // ìƒíƒœ í‘œì‹œ í…ìŠ¤íŠ¸ ë°˜í™˜ í•¨ìˆ˜\n  const getStatusDisplay = (item: any) => {\n    if (activeTab === 'purchase') {\n      return item.is_payment_completed ? 'êµ¬ë§¤ì™„ë£Œ' : 'êµ¬ë§¤ìš”ì²­'\n    } else if (activeTab === 'receipt') {\n      return item.is_received ? 'ì…ê³ ' : 'ì…ê³ ëŒ€ê¸°'\n    }\n    return item.is_payment_completed ? 'êµ¬ë§¤ì™„ë£Œ' : 'êµ¬ë§¤ìš”ì²­'\n  }\n\n  // ë™ì  gridTemplateColumns ìƒì„±\n  const getGridTemplateColumns = () => {\n    // ë™ì  ê³„ì‚°ëœ ë„ˆë¹„ê°€ ìˆìœ¼ë©´ ì‚¬ìš© (ë‹¨, íŠ¹ì • ì»¬ëŸ¼ì€ ê³ ì •ê°’ ê°•ì œ)\n    if (columnWidths.length > 0) {\n      const widths = columnWidths.map(width => `${width}px`)\n      \n      // ë™ì  ê³„ì‚°ëœ ê°’ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš© (ê³ ì •ê°’ ì œê±°)\n      // ëª¨ë“  ì¹¼ëŸ¼ì´ ë‚´ìš©ì— ë§ê²Œ ë™ì ìœ¼ë¡œ ì¡°ì ˆë¨\n      \n      return widths.join(' ')\n    }\n    \n    // ê¸°ë³¸ê°’ (ë°ì´í„° ë¡œë“œ ì „)\n    // [í’ˆëª©ëª…, ê·œê²©, ìˆ˜ëŸ‰, ë‹¨ê°€, í•©ê³„, ë¹„ê³ ]\n    let baseColumns = ['minmax(80px, 1fr)', '200px', '70px', '90px', '100px', '150px']\n    \n    // isEditingì— ë”°ë¼ ìƒíƒœ ë˜ëŠ” ì‚­ì œ ì¹¼ëŸ¼ ì¶”ê°€\n    if (isEditing) {\n      baseColumns.push('80px') // ì‚­ì œ\n    } else {\n      baseColumns.push('80px') // ìƒíƒœ\n    }\n    \n    // íƒ­ë³„ ì¶”ê°€ ì¹¼ëŸ¼\n    if (activeTab === 'receipt') {\n      return [...baseColumns, '100px'].join(' ')\n    } else if (activeTab === 'done') {\n      return [...baseColumns, '100px', '80px', '110px'].join(' ') // ê±°ë˜ëª…ì„¸ì„œ, íšŒê³„ìƒì…ê³ ì¼, ì§€ì¶œì •ë³´\n    }\n    \n    return baseColumns.join(' ')\n  }\n\n  // ë ˆê±°ì‹œ measureColumnWidths í•¨ìˆ˜ (í˜¸í™˜ì„± ìœ ì§€)\n  const measureColumnWidths = () => {\n    calculateOptimalColumnWidths()\n  }\n\n  // View ëª¨ë“œì—ì„œ ì¹¼ëŸ¼ ë„ˆë¹„ ê³„ì‚° (ë°ì´í„° ë¡œë“œ í›„)\n  // ë¹„ë™ê¸°ë¡œ ì²˜ë¦¬í•˜ì—¬ ëª¨ë‹¬ì´ ë¨¼ì € í‘œì‹œë˜ë„ë¡ í•¨\n  useEffect(() => {\n    // itemsì™€ purchase_request_items ë‘˜ ë‹¤ í™•ì¸\n    const hasItems = (purchase?.items && purchase.items.length > 0) || \n                     (purchase?.purchase_request_items && purchase.purchase_request_items.length > 0)\n    \n    if (purchase && hasItems && !isEditing) {\n      // requestAnimationFrameìœ¼ë¡œ ë‹¤ìŒ í”„ë ˆì„ì— ê³„ì‚°í•˜ì—¬ ëª¨ë‹¬ ë Œë”ë§ì„ ë¸”ë¡œí‚¹í•˜ì§€ ì•ŠìŒ\n      requestAnimationFrame(() => {\n        calculateOptimalColumnWidths()\n      })\n    }\n  }, [purchase, isEditing, activeTab, calculateOptimalColumnWidths])\n\n  // Edit ëª¨ë“œ ì „í™˜ ì‹œ ë„ˆë¹„ ê³„ì‚°\n  const handleEditToggle = (editing: boolean) => {\n    if (editing && !isEditing) {\n      // Edit ëª¨ë“œë¡œ ì „í™˜í•  ë•Œ í˜„ì¬ ë°ì´í„°ë¡œ ì´ˆê¸°í™”\n      setEditedPurchase(purchase)\n      setEditedItems(currentItems || [])\n      setDeletedItemIds([])\n      // Edit ëª¨ë“œë¡œ ì „í™˜í•˜ê¸° ì „ì— í˜„ì¬ ë„ˆë¹„ ê³„ì‚°\n      calculateOptimalColumnWidths()\n    }\n    setIsEditing(editing)\n  }\n\n  const loadPurchaseDetail = async (id: string) => {\n    try {\n      // ğŸš€ ë©”ëª¨ë¦¬ì—ì„œ ë¨¼ì € ì°¾ê¸° (ë¡œë”© ìƒíƒœ ì—†ì´ ì¦‰ì‹œ ë¡œë“œ)\n      const memoryPurchase = findPurchaseInMemory(id)\n      if (memoryPurchase) {\n        // ë©”ëª¨ë¦¬ ë°ì´í„°ë¥¼ PurchaseRequestWithDetails í˜•íƒœë¡œ ë³€í™˜\n        const purchaseData = {\n          ...memoryPurchase,\n          id: String(memoryPurchase.id), // PurchaseRequestëŠ” idê°€ string\n          is_po_generated: false, // Purchase íƒ€ì…ì—ëŠ” ì—†ì§€ë§Œ PurchaseRequestì— í•„ìˆ˜\n          vendor: {\n            id: memoryPurchase.vendor_id,\n            vendor_name: memoryPurchase.vendor_name || 'ì•Œ ìˆ˜ ì—†ìŒ',\n            is_active: true\n          } as Vendor,\n          vendor_contacts: []\n        } as PurchaseRequestWithDetails\n        \n        setPurchase(purchaseData)\n        setEditedPurchase(purchaseData)\n        setEditedItems(memoryPurchase.items || [])\n        return\n      }\n      \n      // ë©”ëª¨ë¦¬ì— ì—†ëŠ” ê²½ìš°ì—ë§Œ ë¡œë”© ìƒíƒœ í‘œì‹œ í›„ DBì—ì„œ ë¡œë“œ (fallback)\n      setLoading(true)\n      const supabase = createClient()\n      \n      const { data, error } = await supabase\n        .from('purchase_requests')\n        .select(`\n          *,\n          vendors(id, vendor_name),\n          purchase_request_items(*)\n        `)\n        .eq('id', id)\n        .single()\n\n      if (error) throw error\n\n      if (data) {\n        // ë¼ì¸ë„˜ë²„ ìˆœì„œëŒ€ë¡œ ì •ë ¬\n        const sortedItems = (data.purchase_request_items || []).sort((a: any, b: any) => {\n          const lineA = a.line_number || 999999;\n          const lineB = b.line_number || 999999;\n          return lineA - lineB;\n        });\n\n        const purchaseData = {\n          ...data,\n          items: sortedItems,\n          vendor: data.vendors || { id: 0, vendor_name: 'ì•Œ ìˆ˜ ì—†ìŒ' },\n          vendor_contacts: []\n        } as PurchaseRequestWithDetails\n        setPurchase(purchaseData)\n        setEditedPurchase(purchaseData)\n        setEditedItems(sortedItems)\n      }\n    } catch (error) {\n      logger.error('[PurchaseDetailModal] ë°œì£¼ ìƒì„¸ ë¡œë“œ ì‹¤íŒ¨:', error)\n      toast.error('ë°œì£¼ ìƒì„¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const getStatusBadge = () => {\n    if (!purchase) return null\n    \n    // payment_category ìš°ì„  í™•ì¸\n    if (purchase.payment_category) {\n      const category = purchase.payment_category.trim()\n      \n      if (category === 'ë°œì£¼') {\n        return <span className=\"badge-stats bg-green-500 text-white\">ë°œì£¼</span>\n      } else if (category === 'êµ¬ë§¤ìš”ì²­') {\n        return <span className=\"badge-stats bg-blue-500 text-white\">êµ¬ë§¤ìš”ì²­</span>\n      } else if (category === 'í˜„ì¥ê²°ì œ') {\n        return <span className=\"badge-stats bg-gray-500 text-white\">í˜„ì¥ê²°ì œ</span>\n      } else {\n        // payment_category ê°’ì´ ìˆì§€ë§Œ ì•Œë ¤ì§„ ê°’ì´ ì•„ë‹Œ ê²½ìš°\n        return <span className=\"badge-stats bg-blue-500 text-white\">{category}</span>\n      }\n    }\n    \n    // payment_categoryê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’\n    return <span className=\"badge-stats bg-blue-500 text-white\">êµ¬ë§¤ìš”ì²­</span>\n  }\n\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat('ko-KR').format(amount)\n  }\n\n  const handleSave = async () => {\n    if (!purchase || !editedPurchase) {\n      toast.error('ì €ì¥í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.')\n      return\n    }\n    \n    try {\n      \n      // ë°œì£¼ ê¸°ë³¸ ì •ë³´ ì—…ë°ì´íŠ¸\n      const totalAmount = editedItems.reduce((sum, item) => sum + (item.amount_value || 0), 0)\n      \n      const { error: updateError } = await supabase\n        .from('purchase_requests')\n        .update({\n          purchase_order_number: editedPurchase.purchase_order_number || null,\n          requester_name: editedPurchase.requester_name || null,\n          delivery_request_date: editedPurchase.delivery_request_date || null,\n          revised_delivery_request_date: editedPurchase.revised_delivery_request_date || null,\n          payment_category: editedPurchase.payment_category || null,\n          project_vendor: editedPurchase.project_vendor || null,\n          total_amount: Number(totalAmount),\n          updated_at: new Date().toISOString()\n        })\n        .eq('id', purchase.id)\n\n      if (updateError) throw updateError\n\n      // ì‚­ì œëœ í•­ëª©ë“¤ ì²˜ë¦¬\n      if (deletedItemIds.length > 0) {\n        const { error: deleteError } = await supabase\n          .from('purchase_request_items')\n          .delete()\n          .in('id', deletedItemIds)\n\n        if (deleteError) throw deleteError\n      }\n\n      // ê° ì•„ì´í…œ ì—…ë°ì´íŠ¸ ë˜ëŠ” ìƒì„±\n      \n      for (const item of editedItems) {\n        \n        // í•„ìˆ˜ í•„ë“œ ê²€ì¦\n        if (!item.item_name || !item.item_name.trim()) {\n          throw new Error('í’ˆëª©ëª…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.');\n        }\n        if (!item.quantity || item.quantity <= 0) {\n          throw new Error('ìˆ˜ëŸ‰ì€ 0ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤.');\n        }\n        if (item.unit_price_value !== null && item.unit_price_value !== undefined && item.unit_price_value < 0) {\n          throw new Error('ë‹¨ê°€ëŠ” 0 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');\n        }\n        if (item.amount_value !== null && item.amount_value !== undefined && item.amount_value < 0) {\n          throw new Error('í•©ê³„ëŠ” 0 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');\n        }\n        \n        if (item.id) {\n          // ê¸°ì¡´ í•­ëª© ì—…ë°ì´íŠ¸\n          const { error } = await supabase\n            .from('purchase_request_items')\n            .update({\n              item_name: item.item_name.trim(),\n              specification: item.specification || null,\n              quantity: Number(item.quantity),\n              received_quantity: item.received_quantity !== null && item.received_quantity !== undefined ? Number(item.received_quantity) : null,\n              unit_price_value: Number(item.unit_price_value),\n              unit_price_currency: purchase.currency || 'KRW',\n              amount_value: Number(item.amount_value),\n              amount_currency: purchase.currency || 'KRW',\n              remark: item.remark || null,\n              updated_at: new Date().toISOString()\n            })\n            .eq('id', item.id)\n\n          if (error) {\n            logger.error('ê¸°ì¡´ í•­ëª© ì—…ë°ì´íŠ¸ ì˜¤ë¥˜', error);\n            throw error;\n          }\n        } else {\n          // ìƒˆ í•­ëª© ìƒì„±\n          const insertData = {\n            purchase_request_id: purchase.id,\n            item_name: item.item_name.trim(),\n            specification: item.specification || null,\n            quantity: Number(item.quantity),\n            received_quantity: item.received_quantity !== null && item.received_quantity !== undefined ? Number(item.received_quantity) : null,\n            unit_price_value: Number(item.unit_price_value),\n            unit_price_currency: purchase.currency || 'KRW',\n            amount_value: Number(item.amount_value),\n            amount_currency: purchase.currency || 'KRW',\n            remark: item.remark || null,\n            line_number: item.line_number || editedItems.indexOf(item) + 1,\n            created_at: new Date().toISOString()\n          };\n          \n          const { error } = await supabase\n            .from('purchase_request_items')\n            .insert(insertData)\n\n          if (error) {\n            logger.error('ìƒˆ í•­ëª© ìƒì„± ì˜¤ë¥˜', error);\n            throw error;\n          }\n        }\n      }\n\n      // ğŸš€ ì „ì²´ì™„ë£Œ í•¨ìˆ˜ì™€ ì •í™•íˆ ë™ì¼í•œ íŒ¨í„´ ì ìš© (ë©”ëª¨ë¦¬ ìºì‹œ í¬í•¨)\n      const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n      const sourceData = editedPurchase || purchase\n      \n      // 1. ğŸš€ ì‚­ì œëœ í’ˆëª©ë“¤ì— ëŒ€í•´ ê°œë³„ ë©”ëª¨ë¦¬ ìºì‹œ ì²˜ë¦¬ (êµ¬ë§¤ì™„ë£Œì™€ ë™ì¼í•œ ë°©ì‹)\n      if (!Number.isNaN(purchaseIdNumber) && deletedItemIds.length > 0) {\n        logger.info('ğŸš€ [ë©”ëª¨ë¦¬ ìºì‹œ] ê°œë³„ í’ˆëª© ì‚­ì œ ì²˜ë¦¬ ì‹œì‘', {\n          purchaseId: purchaseIdNumber,\n          deletedItemIds: deletedItemIds,\n          deletedCount: deletedItemIds.length\n        })\n        \n        // ê° ì‚­ì œëœ í’ˆëª©ì— ëŒ€í•´ ê°œë³„ ë©”ëª¨ë¦¬ ìºì‹œ ì—…ë°ì´íŠ¸ (êµ¬ë§¤ì™„ë£Œì™€ ì •í™•íˆ ë™ì¼í•œ íŒ¨í„´)\n        deletedItemIds.forEach(itemId => {\n          const memoryUpdated = removeItemFromMemory(purchaseIdNumber, itemId)\n          if (!memoryUpdated) {\n            logger.warn('[handleSave] ê°œë³„ í’ˆëª© ì‚­ì œ ë©”ëª¨ë¦¬ ìºì‹œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { \n              purchaseId: purchaseIdNumber, \n              itemId: itemId \n            })\n          } else {\n            logger.info('âœ… [handleSave] ê°œë³„ í’ˆëª© ì‚­ì œ ë©”ëª¨ë¦¬ ìºì‹œ ì—…ë°ì´íŠ¸ ì„±ê³µ', { \n              purchaseId: purchaseIdNumber, \n              itemId: itemId \n            })\n          }\n        })\n      }\n      \n      // 2. ë°œì£¼ ê¸°ë³¸ ì •ë³´ ë©”ëª¨ë¦¬ ìºì‹œ ì—…ë°ì´íŠ¸ (ìˆ˜ì •ëœ í•„ë“œë“¤ë§Œ)\n      if (!Number.isNaN(purchaseIdNumber)) {\n        const memoryUpdated = updatePurchaseInMemory(purchaseIdNumber, (prev) => {\n          const totalAmount = editedItems.reduce((sum, item) => sum + (item.amount_value || 0), 0)\n          \n          logger.info('ğŸš€ [ë©”ëª¨ë¦¬ ìºì‹œ] ë°œì£¼ ê¸°ë³¸ ì •ë³´ ì—…ë°ì´íŠ¸', {\n            purchaseId: purchaseIdNumber,\n            newTotalAmount: totalAmount,\n            itemsCount: editedItems.length\n          })\n          \n          return {\n            ...prev,\n            // ë°œì£¼ ê¸°ë³¸ ì •ë³´ ì—…ë°ì´íŠ¸\n            purchase_order_number: sourceData?.purchase_order_number || prev.purchase_order_number,\n            requester_name: sourceData?.requester_name || prev.requester_name,\n            delivery_request_date: sourceData?.delivery_request_date || prev.delivery_request_date,\n            revised_delivery_request_date: sourceData?.revised_delivery_request_date || prev.revised_delivery_request_date,\n            payment_category: sourceData?.payment_category || prev.payment_category,\n            project_vendor: sourceData?.project_vendor || prev.project_vendor,\n            total_amount: totalAmount,\n            updated_at: new Date().toISOString()\n          } as Purchase\n        })\n        \n        logger.info('ğŸš€ [ë©”ëª¨ë¦¬ ìºì‹œ] ê¸°ë³¸ ì •ë³´ ì—…ë°ì´íŠ¸ ê²°ê³¼:', { memoryUpdated })\n      }\n      \n      // 3. applyOptimisticUpdate í•¨ìˆ˜ ì •ì˜ (ì „ì²´ì™„ë£Œ í•¨ìˆ˜ íŒ¨í„´)\n      const applyOptimisticUpdate = () => {\n        if (!Number.isNaN(purchaseIdNumber) && onOptimisticUpdate) {\n          onOptimisticUpdate(purchaseIdNumber, prev => {\n            const finalItems = editedItems // ì‚­ì œëœ í•­ëª©ì´ ì´ë¯¸ ì œì™¸ë¨\n            const totalAmount = finalItems.reduce((sum, item) => sum + (item.amount_value || 0), 0)\n            \n            logger.info('ğŸš€ [onOptimisticUpdate] ì¦‰ì‹œ UI ì—…ë°ì´íŠ¸', {\n              originalItemsCount: prev.items?.length || prev.purchase_request_items?.length || 0,\n              finalItemsCount: finalItems.length,\n              deletedItemsCount: deletedItemIds.length\n            })\n            \n            return {\n              ...prev,\n              // ë°œì£¼ ê¸°ë³¸ ì •ë³´ ì—…ë°ì´íŠ¸\n              purchase_order_number: sourceData?.purchase_order_number || prev.purchase_order_number,\n              requester_name: sourceData?.requester_name || prev.requester_name,\n              delivery_request_date: sourceData?.delivery_request_date || prev.delivery_request_date,\n              revised_delivery_request_date: sourceData?.revised_delivery_request_date || prev.revised_delivery_request_date,\n              payment_category: sourceData?.payment_category || prev.payment_category,\n              project_vendor: sourceData?.project_vendor || prev.project_vendor,\n              total_amount: totalAmount,\n              // í’ˆëª© ë°ì´í„° ì—…ë°ì´íŠ¸ - ì‚­ì œëœ í•­ëª© ì œì™¸\n              items: finalItems,\n              purchase_request_items: finalItems,\n              updated_at: new Date().toISOString()\n            } as Purchase\n          })\n        }\n      }\n      \n      // 4. ì¦‰ì‹œ UI ì—…ë°ì´íŠ¸ ì‹¤í–‰ (ì „ì²´ì™„ë£Œ í•¨ìˆ˜ íŒ¨í„´)\n      applyOptimisticUpdate()\n\n      toast.success('ë°œì£¼ ë‚´ì—­ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.')\n      handleEditToggle(false)\n      setDeletedItemIds([])\n      \n      // 5. ì „ì²´ì™„ë£Œ í•¨ìˆ˜ íŒ¨í„´: refreshModalData ë¨¼ì €, ê·¸ ë‹¤ìŒ onRefresh\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      logger.error('ì €ì¥ ì¤‘ ì „ì²´ ì˜¤ë¥˜', error);\n      const errorMessage = error instanceof Error ? error.message : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤'\n      toast.error(`ì €ì¥ ì‹¤íŒ¨: ${errorMessage}`)\n    }\n  }\n\n  const handleItemChange = (index: number, field: string, value: any) => {\n    const newItems = [...editedItems]\n    \n    if (field === 'quantity' || field === 'unit_price_value') {\n      // ìˆ˜ëŸ‰ì´ë‚˜ ë‹¨ê°€ë¥¼ ìˆ˜ì •í•œ ê²½ìš° ê¸ˆì•¡ ìë™ ê³„ì‚°\n      const quantity = field === 'quantity' ? value : newItems[index].quantity\n      const unitPrice = field === 'unit_price_value' ? value : newItems[index].unit_price_value\n      newItems[index] = {\n        ...newItems[index],\n        [field]: value,\n        amount_value: (quantity || 0) * (unitPrice || 0)  // null ì²´í¬ ì¶”ê°€\n      }\n    } else {\n      // ê¸°íƒ€ í•„ë“œ ìˆ˜ì • (amount_value ì§ì ‘ ìˆ˜ì •ì€ ì œê±°ë¨)\n      newItems[index] = {\n        ...newItems[index],\n        [field]: value\n      }\n    }\n    \n    setEditedItems(newItems)\n  }\n\n  const handleAddItem = () => {\n    // í˜„ì¬ ìµœëŒ€ ë¼ì¸ë„˜ë²„ ì°¾ê¸°\n    const maxLineNumber = editedItems.reduce((max, item) => {\n      const lineNum = item.line_number || 0;\n      return lineNum > max ? lineNum : max;\n    }, 0);\n\n    const newItem = {\n      item_name: '',\n      specification: '',\n      quantity: 1,\n      unit_price_value: 0,\n      amount_value: 0,\n      remark: '',\n      line_number: maxLineNumber + 1\n    }\n    \n    // ìƒˆ ì•„ì´í…œ ì¶”ê°€ í›„ ë¼ì¸ë„˜ë²„ ìˆœì„œëŒ€ë¡œ ì •ë ¬\n    const newItems = [...editedItems, newItem].sort((a, b) => {\n      const lineA = a.line_number || 999999;\n      const lineB = b.line_number || 999999;\n      return lineA - lineB;\n    });\n    \n    setEditedItems(newItems)\n  }\n\n  const handleRemoveItem = (index: number) => {\n    const item = editedItems[index]\n    if (item.id) {\n      setDeletedItemIds([...deletedItemIds, item.id])\n    }\n    const newItems = editedItems.filter((_, i) => i !== index).sort((a, b) => {\n      const lineA = a.line_number || 999999;\n      const lineB = b.line_number || 999999;\n      return lineA - lineB;\n    });\n    setEditedItems(newItems)\n  }\n\n  // êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ í•¨ìˆ˜\n  const handlePaymentToggle = async (itemId: number | string, isCompleted: boolean) => {\n    \n    if (!canPurchase) {\n      logger.warn('[handlePaymentToggle] ê¶Œí•œ ì—†ìŒ', { canPurchase, currentUserRoles })\n      toast.error('êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.')\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n\n    if (Number.isNaN(numericId)) {\n      logger.error('[handlePaymentToggle] ì˜ëª»ëœ ID', { itemId, numericId })\n      toast.error('ìœ íš¨í•˜ì§€ ì•Šì€ í•­ëª© ID ì…ë‹ˆë‹¤.')\n      return\n    }\n\n    // í•´ë‹¹ í’ˆëª© ì •ë³´ ì°¾ê¸° - ë°ì´í„° êµ¬ì¡° ë””ë²„ê¹…\n    \n    // itemsì™€ purchase_request_items ë‘˜ ë‹¤ í™•ì¸ - lengthë¡œ ì‹¤ì œ ë°ì´í„° ìœ ë¬´ íŒë‹¨\n    if (!purchase) return\n    \n    const purchaseItems = (purchase.items && purchase.items.length > 0) ? purchase.items : []\n    const requestItems = (purchase.purchase_request_items && purchase.purchase_request_items.length > 0) ? purchase.purchase_request_items : []\n    const items = purchaseItems.length > 0 ? purchaseItems : requestItems\n    \n    \n    const targetItem = items.find(item => String(item.id) === itemIdStr)\n    \n    \n    if (!targetItem) {\n      return\n    }\n\n    const itemInfo = `í’ˆëª…: ${targetItem.item_name}\nê·œê²©: ${targetItem.specification || 'ë¯¸ì…ë ¥'}\nìˆ˜ëŸ‰: ${targetItem.quantity?.toLocaleString() || 0}${targetItem.unit || ''}\në‹¨ê°€: â‚©${targetItem.unit_price_value?.toLocaleString() || 0}\ní•©ê³„: â‚©${targetItem.amount_value?.toLocaleString() || 0}`\n\n    const confirmMessage = isCompleted \n      ? `ë‹¤ìŒ í’ˆëª©ì„ êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\\n\\n${itemInfo}` \n      : `ë‹¤ìŒ í’ˆëª©ì˜ êµ¬ë§¤ì™„ë£Œë¥¼ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\\n\\n${itemInfo}`\n    \n    const confirm = window.confirm(confirmMessage)\n    \n    if (!confirm) {\n      return\n    }\n\n    try {\n      \n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_payment_completed: isCompleted,\n          payment_completed_at: isCompleted ? new Date().toISOString() : null\n        })\n        .eq('id', numericId)\n\n      if (error) {\n        throw error\n      }\n      \n\n      // ğŸš€ ë©”ëª¨ë¦¬ ìºì‹œ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (êµ¬ë§¤ì™„ë£Œ/ì·¨ì†Œ ëª¨ë‘ ì²˜ë¦¬)\n      if (purchase) {\n        \n        const memoryUpdated = isCompleted \n          ? markItemAsPaymentCompleted(purchase.id, numericId)\n          : markItemAsPaymentCanceled(purchase.id, numericId);\n          \n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal] ë©”ëª¨ë¦¬ ìºì‹œ í’ˆëª© ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { \n            purchaseId: purchase.id, \n            itemId: numericId,\n            isCompleted\n          });\n        }\n      }\n\n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (UI ì¦‰ì‹œ ë°˜ì˜)\n      setPurchase(prev => {\n        if (!prev) {\n          return null\n        }\n        \n        // itemsì™€ purchase_request_items ë‘˜ ë‹¤ í™•ì¸í•˜ì—¬ ì—…ë°ì´íŠ¸ - lengthë¡œ ì‹¤ì œ ë°ì´í„° ìœ ë¬´ íŒë‹¨\n        const prevItems = (prev.items && prev.items.length > 0) ? prev.items : []\n        const prevRequestItems = (prev.purchase_request_items && prev.purchase_request_items.length > 0) ? prev.purchase_request_items : []\n        const currentItems = prevItems.length > 0 ? prevItems : prevRequestItems\n        const updatedItems = currentItems.map(item => \n          String(item.id) === itemIdStr \n            ? { ...item, is_payment_completed: isCompleted, payment_completed_at: isCompleted ? new Date().toISOString() : null }\n            : item\n        )\n        \n        \n        // ë°ì´í„° êµ¬ì¡°ì— ë§ê²Œ ì—…ë°ì´íŠ¸\n        const result = {\n          ...prev,\n          items: prev.items ? updatedItems : prev.items,\n          purchase_request_items: prev.purchase_request_items ? updatedItems : prev.purchase_request_items\n        }\n        \n        return result\n      })\n\n      if (purchase) {\n        const purchaseIdNumber = Number(purchase.id)\n        if (!Number.isNaN(purchaseIdNumber)) {\n          onOptimisticUpdate?.(purchaseIdNumber, prev => {\n            const updatedItems = (prev.items || []).map(item =>\n              String(item.id) === itemIdStr\n                ? { ...item, is_payment_completed: isCompleted }\n                : item\n            )\n            const total = updatedItems.length || prev.items?.length || 0\n            const completed = updatedItems.filter(item => item.is_payment_completed).length\n            const allCompleted = total > 0 && completed === total\n            return {\n              ...prev,\n              items: updatedItems,\n              is_payment_completed: allCompleted,\n              payment_completed_at: allCompleted ? new Date().toISOString() : null,\n              payment_completed_by_name: allCompleted ? (currentUserName || prev.payment_completed_by_name) : prev.payment_completed_by_name\n            }\n          })\n        }\n      }\n      \n      toast.success(isCompleted ? 'êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'êµ¬ë§¤ì™„ë£Œê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.')\n\n      // ìƒì„¸ ëª¨ë‹¬ ë° ìƒìœ„ ë¦¬ìŠ¤íŠ¸ ëª¨ë‘ ìµœì‹  ìƒíƒœë¡œ ë™ê¸°í™”\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      toast.error('êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n\n  // ê°œë³„ í’ˆëª© ì…ê³ ì™„ë£Œ ì²˜ë¦¬ (ë‚ ì§œ ì„ íƒ + ì‹¤ì œì…ê³ ìˆ˜ëŸ‰)\n  const handleItemReceiptToggle = async (itemId: number | string, selectedDate: Date, receivedQuantity?: number) => {\n    if (!canReceiveItems) {\n      toast.error('ì…ê³  ì²˜ë¦¬ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.')\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      toast.error('ìœ íš¨í•˜ì§€ ì•Šì€ í•­ëª© ID ì…ë‹ˆë‹¤.')\n      return\n    }\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item =>\n            String(item.id) === itemIdStr\n              ? {\n                  ...item,\n                  is_received: true,\n                  actual_received_date: selectedDate.toISOString(),\n                  received_quantity: receivedQuantity !== undefined ? receivedQuantity : item.received_quantity\n                }\n              : item\n          )\n          const total = updatedItems.length || prev.items?.length || 0\n          const completed = updatedItems.filter(item => item.is_received).length\n          const allReceived = total > 0 && completed === total\n\n          return {\n            ...prev,\n            items: updatedItems,\n            is_received: allReceived,\n            received_at: allReceived ? new Date().toISOString() : prev.received_at\n          }\n        })\n      }\n    }\n\n    try {\n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_received: true,\n          received_at: new Date().toISOString(),\n          actual_received_date: selectedDate.toISOString(),\n          received_quantity: receivedQuantity !== undefined ? receivedQuantity : null\n        })\n        .eq('id', numericId)\n\n      if (error) throw error\n\n      // ğŸš€ ë©”ëª¨ë¦¬ ìºì‹œ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (ê°œë³„ í’ˆëª© ì…ê³ ì™„ë£Œ)\n      if (purchase) {\n        const memoryUpdated = markItemAsReceived(purchase.id, numericId, selectedDate.toISOString(), receivedQuantity);\n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal] ë©”ëª¨ë¦¬ ìºì‹œ ê°œë³„ í’ˆëª© ì…ê³ ì™„ë£Œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { \n            purchaseId: purchase.id, \n            itemId: numericId \n          });\n        }\n      }\n\n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          String(item.id) === itemIdStr \n            ? { \n                ...item, \n                is_received: true, \n                received_at: new Date().toISOString(),\n                actual_received_date: selectedDate.toISOString(),\n                received_quantity: receivedQuantity !== undefined ? receivedQuantity : item.received_quantity\n              }\n            : item\n        )\n        const updatedRequestItems = prev.purchase_request_items?.map(item => \n          String(item.id) === itemIdStr \n            ? { \n                ...item, \n                is_received: true, \n                received_at: new Date().toISOString(),\n                actual_received_date: selectedDate.toISOString(),\n                received_quantity: receivedQuantity !== undefined ? receivedQuantity : item.received_quantity\n              }\n            : item\n        )\n        return { \n          ...prev, \n          items: updatedItems,\n          purchase_request_items: updatedRequestItems,\n          updated_at: new Date().toISOString()\n        }\n      })\n\n      applyOptimisticUpdate()\n      \n      const targetItem = purchase?.items?.find(item => String(item.id) === itemIdStr)\n      toast.success(`\"${targetItem?.item_name}\" í’ˆëª©ì´ ì…ê³ ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.`)\n\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      toast.error('ì…ê³ ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n\n  // ì…ê³ ì™„ë£Œ ì·¨ì†Œ ì²˜ë¦¬\n  const handleReceiptCancel = async (itemId: number | string) => {\n    if (!canProcessReceipt) {\n      toast.error('ì…ê³  ì²˜ë¦¬ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.')\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      toast.error('ìœ íš¨í•˜ì§€ ì•Šì€ í•­ëª© ID ì…ë‹ˆë‹¤.')\n      return\n    }\n\n    const targetItem = purchase?.items?.find(item => String(item.id) === itemIdStr)\n    if (!targetItem) return\n\n    const confirm = window.confirm(`\"${targetItem.item_name}\" í’ˆëª©ì˜ ì…ê³ ì™„ë£Œë¥¼ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)\n    if (!confirm) return\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item =>\n            String(item.id) === itemIdStr\n              ? {\n                  ...item,\n                  is_received: false,\n                  actual_received_date: undefined\n                }\n              : item\n          )\n          const total = updatedItems.length || prev.items?.length || 0\n          const completed = updatedItems.filter(item => item.is_received).length\n          const allReceived = total > 0 && completed === total\n\n          return {\n            ...prev,\n            items: updatedItems,\n            is_received: allReceived,\n            received_at: allReceived ? prev.received_at : null\n          }\n        })\n      }\n    }\n\n    try {\n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_received: false,\n          received_at: null,\n          actual_received_date: null,\n          actual_received_by_name: null\n        })\n        .eq('id', numericId)\n\n      if (error) throw error\n\n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          String(item.id) === itemIdStr \n            ? { ...item, is_received: false, received_at: null, actual_received_date: undefined, actual_received_by_name: undefined }\n            : item\n        )\n        return { ...prev, items: updatedItems }\n      })\n      \n      applyOptimisticUpdate()\n\n      toast.success('ì…ê³ ì™„ë£Œê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.')\n\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      toast.error('ì…ê³ ì™„ë£Œ ì·¨ì†Œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n\n\n  // ìŠ¹ì¸ ì²˜ë¦¬\n  const handleApprove = async (type: 'middle' | 'final') => {\n    if (!purchase) return\n    \n    const approvalType = type === 'middle' ? '1ì°¨ ìŠ¹ì¸' : 'ìµœì¢… ìŠ¹ì¸'\n    const confirmMessage = `ë°œì£¼ë²ˆí˜¸: ${purchase.purchase_order_number}\\n\\n${approvalType}ì„ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`\n    const confirm = window.confirm(confirmMessage)\n    if (!confirm) return\n    \n    try {\n      const updateData = type === 'middle' \n        ? { \n            middle_manager_status: 'approved'\n          }\n        : { \n            final_manager_status: 'approved'\n          }\n\n      const { error } = await supabase\n        .from('purchase_requests')\n        .update(updateData)\n        .eq('id', purchase.id)\n      \n      if (error) {\n        throw error\n      }\n\n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (UI ì¦‰ì‹œ ë°˜ì˜)\n      if (type === 'middle') {\n        setPurchase(prev => prev ? { ...prev, middle_manager_status: 'approved' } : null)\n      } else {\n        setPurchase(prev => prev ? { ...prev, final_manager_status: 'approved' } : null)\n      }\n\n      // Optimistic Updateë¡œ ë¦¬ìŠ¤íŠ¸ ì¦‰ì‹œ ë°˜ì˜ (êµ¬ë§¤ì™„ë£Œ/ì…ê³ ì™„ë£Œì™€ ë™ì¼í•œ íŒ¨í„´)\n      if (purchase && onOptimisticUpdate) {\n        const purchaseIdNumber = Number(purchase.id)\n        if (!Number.isNaN(purchaseIdNumber)) {\n          onOptimisticUpdate(purchaseIdNumber, prev => {\n            if (type === 'middle') {\n              return {\n                ...prev,\n                middle_manager_status: 'approved' as any\n              }\n            } else {\n              return {\n                ...prev,\n                final_manager_status: 'approved' as any\n              }\n            }\n          })\n        }\n      }\n      \n      toast.success(`${type === 'middle' ? 'ì¤‘ê°„' : 'ìµœì¢…'} ìŠ¹ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`)\n\n      // ìƒì„¸ ëª¨ë‹¬ ë° ë¦¬ìŠ¤íŠ¸ ëª¨ë‘ ìƒˆë¡œê³ ì¹¨\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      toast.error('ìŠ¹ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n  \n  // ì „ì²´ êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ (ê°œë³„ í’ˆëª©ë³„ ì²˜ë¦¬ ë°©ì‹)\n  const handleCompleteAllPayment = async () => {\n    \n    if (!purchase || !canPurchase) {\n      return\n    }\n    \n    const confirmMessage = `ë°œì£¼ë²ˆí˜¸: ${purchase.purchase_order_number}\\n\\nì „ì²´ êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`\n    const confirm = window.confirm(confirmMessage)\n    if (!confirm) {\n      return\n    }\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const allItems = prev.purchase_request_items || [];\n          const pendingItems = allItems.filter(item => !item.is_payment_completed);\n          \n          const updatedItems = allItems.map(item => \n            !item.is_payment_completed \n              ? { ...item, is_payment_completed: true, payment_completed_at: new Date().toISOString() }\n              : item\n          );\n          \n          return {\n            ...prev,\n            purchase_request_items: updatedItems,\n            items: prev.items ? updatedItems : prev.items,\n            is_payment_completed: updatedItems.every(item => item.is_payment_completed)\n          }\n        })\n      }\n    }\n    \n    try {\n      // ğŸš€ ë¯¸ì™„ë£Œ í’ˆëª©ë§Œ í•„í„°ë§ (ì´ë¯¸ êµ¬ë§¤ì™„ë£Œëœ í’ˆëª© ì œì™¸)\n      const allItems = purchase.purchase_request_items || [];\n      const pendingItems = allItems.filter(item => !item.is_payment_completed);\n      \n      if (pendingItems.length === 0) {\n        toast.info('ëª¨ë“  í’ˆëª©ì´ ì´ë¯¸ êµ¬ë§¤ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');\n        return;\n      }\n\n      logger.info(`ì „ì²´ êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬: ${pendingItems.length}ê°œ í’ˆëª© (ì´ ${allItems.length}ê°œ ì¤‘)`);\n      \n      for (const item of pendingItems) {\n        // ê° í’ˆëª©ë³„ë¡œ DB ì—…ë°ì´íŠ¸ (ê°œë³„ í’ˆëª©ê³¼ ë™ì¼í•œ ë°©ì‹)\n        const updateData = {\n          is_payment_completed: true,\n          payment_completed_at: new Date().toISOString()\n        };\n\n        const { error } = await supabase\n          .from('purchase_request_items')\n          .update(updateData)\n          .eq('id', item.id);\n\n        if (error) throw error;\n\n        // ğŸš€ ê°œë³„ í’ˆëª© ë©”ëª¨ë¦¬ ìºì‹œ ì—…ë°ì´íŠ¸ (ê°œë³„ ì²˜ë¦¬ì™€ ë™ì¼)\n        const memoryUpdated = markItemAsPaymentCompleted(purchase.id, item.id);\n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal] ë©”ëª¨ë¦¬ ìºì‹œ ê°œë³„ í’ˆëª© êµ¬ë§¤ì™„ë£Œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { \n            purchaseId: purchase.id, \n            itemId: item.id \n          });\n        }\n      }\n\n      toast.success(`${pendingItems.length}ê°œ í’ˆëª©ì´ êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.`);\n\n      // ğŸš€ ìƒˆë¡œê³ ì¹¨ (ê°œë³„ í’ˆëª©ê³¼ ë™ì¼)\n      await refreshModalData();\n      const refreshResult = onRefresh?.(true, { silent: true });\n      if (refreshResult instanceof Promise) {\n        await refreshResult;\n      }\n    } catch (error) {\n      logger.error('ì „ì²´ êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ ì˜¤ë¥˜', error);\n      toast.error('êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n\n  // ê°œë³„ ì§€ì¶œ ì •ë³´ ì…ë ¥ ì²˜ë¦¬\n  const handleItemExpenditure = async (itemId: number | string, date: Date, amount: number) => {\n    if (!purchase || !canReceiptCheck) {\n      toast.error('ì§€ì¶œ ì •ë³´ ì…ë ¥ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.')\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      logger.error('ìœ íš¨í•˜ì§€ ì•Šì€ itemId', { itemId })\n      return\n    }\n\n    const targetItem = purchase.items?.find(item => String(item.id) === itemIdStr)\n    if (!targetItem) return\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item =>\n            String(item.id) === itemIdStr\n              ? {\n                  ...item,\n                  expenditure_date: date.toISOString(),\n                  expenditure_amount: amount\n                }\n              : item\n          )\n          return { ...prev, items: updatedItems }\n        })\n      }\n    }\n\n    try {\n      applyOptimisticUpdate()\n\n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (itemsì™€ purchase_request_items ëª¨ë‘ ì—…ë°ì´íŠ¸) - ë‹¤ë¥¸ í•¨ìˆ˜ë“¤ê³¼ ë™ì¼í•œ íŒ¨í„´\n      setPurchase(prev => {\n        if (!prev) return null\n        const currentItems = prev.items || prev.purchase_request_items || []\n        const updatedItems = currentItems.map(item => \n          String(item.id) === itemIdStr\n            ? {\n                ...item,\n                expenditure_date: date.toISOString(),\n                expenditure_amount: amount\n              }\n            : item\n        )\n        const totalExpenditure = updatedItems.reduce((sum, item) => sum + (item.expenditure_amount || 0), 0)\n        // ìƒˆ ê°ì²´ë¥¼ ë°˜í™˜í•˜ì—¬ Reactê°€ ë³€ê²½ì„ ê°ì§€í•˜ë„ë¡ í•¨\n        return { \n          ...prev, \n          items: updatedItems,\n          purchase_request_items: updatedItems,\n          total_expenditure_amount: totalExpenditure,\n          updated_at: new Date().toISOString() // ê°•ì œë¡œ ê°ì²´ ì°¸ì¡° ë³€ê²½\n        }\n      })\n\n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          expenditure_date: date.toISOString(),\n          expenditure_amount: amount\n        })\n        .eq('id', numericId)\n\n      if (error) {\n        logger.error('ì§€ì¶œ ì •ë³´ DB ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { error, itemId: numericId })\n        throw error\n      }\n\n      // purchase_requestsì˜ total_expenditure_amount ì—…ë°ì´íŠ¸\n      const allItemsForTotal = purchase.items || purchase.purchase_request_items || []\n      const totalExpenditure = allItemsForTotal.reduce((sum, item) => {\n        if (String(item.id) === itemIdStr) {\n          return sum + amount\n        }\n        return sum + (item.expenditure_amount || 0)\n      }, 0)\n\n      await supabase\n        .from('purchase_requests')\n        .update({ total_expenditure_amount: totalExpenditure })\n        .eq('id', purchaseIdNumber)\n\n      // ğŸš€ ë©”ëª¨ë¦¬ ìºì‹œ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (ì‹¤ì‹œê°„ UI ë°˜ì˜) - DB ì—…ë°ì´íŠ¸ í›„ì— í˜¸ì¶œ\n      if (purchase?.id) {\n        const memoryUpdated = markItemAsExpenditureSet(purchase.id, numericId, date.toISOString(), amount)\n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal] ë©”ëª¨ë¦¬ ìºì‹œ ì§€ì¶œ ì •ë³´ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { \n            purchaseId: purchase.id, \n            itemId: numericId \n          })\n        }\n      }\n\n      toast.success(`\"${targetItem.item_name}\" í’ˆëª©ì˜ ì§€ì¶œ ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`)\n\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      logger.error('ì§€ì¶œ ì •ë³´ ì…ë ¥ ì¤‘ ì˜¤ë¥˜', error)\n      toast.error('ì§€ì¶œ ì •ë³´ ì…ë ¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n\n  // ì¼ê´„ ì§€ì¶œ ì •ë³´ ì…ë ¥ ì²˜ë¦¬\n  const handleBulkExpenditure = async (date: Date, amount: number) => {\n    if (!purchase || !canReceiptCheck) {\n      toast.error('ì§€ì¶œ ì •ë³´ ì…ë ¥ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.')\n      return\n    }\n\n    const confirmMessage = `ë°œì£¼ë²ˆí˜¸: ${purchase.purchase_order_number}\\n\\nì¼ê´„ ì§€ì¶œ ì •ë³´ë¥¼ ì…ë ¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\\në‚ ì§œ: ${date.toLocaleDateString('ko-KR')}\\nê¸ˆì•¡: ${amount.toLocaleString()}ì›`\n    \n    if (!window.confirm(confirmMessage)) {\n      return\n    }\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item =>\n            // ì´ë¯¸ ê°œë³„ ì…ë ¥ëœ í•­ëª©ì€ ì œì™¸\n            item.expenditure_date && item.expenditure_amount\n              ? item\n              : {\n                  ...item,\n                  expenditure_date: date.toISOString(),\n                  expenditure_amount: amount\n                }\n          )\n          return { ...prev, items: updatedItems }\n        })\n      }\n    }\n\n    try {\n      applyOptimisticUpdate()\n\n      // ì´ë¯¸ ê°œë³„ ì…ë ¥ëœ í•­ëª© ì œì™¸í•˜ê³  ì¼ê´„ ì—…ë°ì´íŠ¸\n      const allItems = purchase.items || purchase.purchase_request_items || []\n      const pendingItems = allItems.filter(item => !item.expenditure_date || !item.expenditure_amount)\n      \n      if (pendingItems.length === 0) {\n        toast.info('ëª¨ë“  í’ˆëª©ì— ì´ë¯¸ ì§€ì¶œ ì •ë³´ê°€ ì…ë ¥ë˜ì–´ ìˆìŠµë‹ˆë‹¤.')\n        return\n      }\n\n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (itemsì™€ purchase_request_items ëª¨ë‘ ì—…ë°ì´íŠ¸)\n      setPurchase(prev => {\n        if (!prev) return null\n        const allItems = prev.items || prev.purchase_request_items || []\n        const updatedItems = allItems.map(item =>\n          // ì´ë¯¸ ê°œë³„ ì…ë ¥ëœ í•­ëª©ì€ ì œì™¸\n          item.expenditure_date && item.expenditure_amount\n            ? item\n            : {\n                ...item,\n                expenditure_date: date.toISOString(),\n                expenditure_amount: amount\n              }\n        )\n        const totalExpenditure = updatedItems.reduce((sum, item) => sum + (item.expenditure_amount || 0), 0)\n        // ìƒˆ ê°ì²´ë¥¼ ë°˜í™˜í•˜ì—¬ Reactê°€ ë³€ê²½ì„ ê°ì§€í•˜ë„ë¡ í•¨\n        return { \n          ...prev, \n          items: updatedItems,\n          purchase_request_items: updatedItems,\n          total_expenditure_amount: totalExpenditure,\n          updated_at: new Date().toISOString() // ê°•ì œë¡œ ê°ì²´ ì°¸ì¡° ë³€ê²½\n        }\n      })\n\n      for (const item of pendingItems) {\n        const { error } = await supabase\n          .from('purchase_request_items')\n          .update({\n            expenditure_date: date.toISOString(),\n            expenditure_amount: amount\n          })\n          .eq('id', item.id)\n\n        if (error) {\n          logger.error('ì¼ê´„ ì§€ì¶œ ì •ë³´ DB ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { error, itemId: item.id })\n          throw error\n        }\n      }\n\n      // purchase_requestsì˜ total_expenditure_amount ì—…ë°ì´íŠ¸\n      const totalExpenditure = allItems.reduce((sum, item) => {\n        if (pendingItems.find(pi => pi.id === item.id)) {\n          return sum + amount\n        }\n        return sum + (item.expenditure_amount || 0)\n      }, 0)\n\n      await supabase\n        .from('purchase_requests')\n        .update({ total_expenditure_amount: totalExpenditure })\n        .eq('id', purchaseIdNumber)\n\n      // ğŸš€ ë©”ëª¨ë¦¬ ìºì‹œ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (ì‹¤ì‹œê°„ UI ë°˜ì˜) - DB ì—…ë°ì´íŠ¸ í›„ì— í˜¸ì¶œ\n      for (const item of pendingItems) {\n        const memoryUpdated = markItemAsExpenditureSet(purchase.id, item.id, date.toISOString(), amount)\n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal] ë©”ëª¨ë¦¬ ìºì‹œ ì¼ê´„ ì§€ì¶œ ì •ë³´ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { \n            purchaseId: purchase.id, \n            itemId: item.id \n          })\n        }\n      }\n\n      // ë©”ëª¨ë¦¬ ìºì‹œ ì—…ë°ì´íŠ¸ í›„ ì¦‰ì‹œ ë¡œì»¬ ìƒíƒœë„ ë™ê¸°í™” (ì‹¤ì‹œê°„ ë°˜ì˜)\n      const memoryPurchase = findPurchaseInMemory(purchase.id)\n      if (memoryPurchase) {\n        const normalizedItems = (memoryPurchase.items && memoryPurchase.items.length > 0) \n          ? memoryPurchase.items \n          : (memoryPurchase.purchase_request_items || [])\n        const totalExpenditure = normalizedItems.reduce((sum, item) => sum + (item.expenditure_amount || 0), 0)\n        setPurchase(prev => ({\n          ...prev!,\n          items: normalizedItems,\n          purchase_request_items: normalizedItems,\n          total_expenditure_amount: totalExpenditure\n        }))\n      }\n\n      toast.success(`${pendingItems.length}ê°œ í’ˆëª©ì˜ ì§€ì¶œ ì •ë³´ê°€ ì¼ê´„ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤.`)\n\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      logger.error('ì¼ê´„ ì§€ì¶œ ì •ë³´ ì…ë ¥ ì¤‘ ì˜¤ë¥˜', error)\n      toast.error('ì¼ê´„ ì§€ì¶œ ì •ë³´ ì…ë ¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n\n  // ì „ì²´ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ì²˜ë¦¬ (ê°œë³„ í’ˆëª©ë³„ ì²˜ë¦¬ ë°©ì‹)\n  const handleCompleteAllStatement = async (selectedDate: Date) => {\n    if (!purchase || !canReceiptCheck) {\n      return\n    }\n\n    const formattedDate = selectedDate.toLocaleDateString('ko-KR', {\n      year: 'numeric',\n      month: '2-digit',\n      day: '2-digit'\n    })\n\n    const confirmMessage = `ë°œì£¼ë²ˆí˜¸: ${purchase.purchase_order_number}\n\nì „ì²´ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`\n    \n    if (!window.confirm(confirmMessage)) {\n      return\n    }\n\n    const selectedDateIso = selectedDate.toISOString()\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const allItems = prev.purchase_request_items || [];\n          const pendingItems = allItems.filter(item => !item.is_statement_received);\n          \n          const updatedItems = allItems.map(item => \n            !item.is_statement_received \n              ? { \n                  ...item, \n                  is_statement_received: true, \n                  statement_received_date: selectedDateIso,\n                  statement_received_by_name: currentUserName || null\n                }\n              : item\n          );\n          \n          return {\n            ...prev,\n            purchase_request_items: updatedItems,\n            items: prev.items ? updatedItems : prev.items,\n            is_statement_received: updatedItems.every(item => item.is_statement_received),\n            statement_received_at: selectedDateIso\n          }\n        })\n      }\n    }\n\n    try {\n      // ğŸš€ ë¯¸ì™„ë£Œ í’ˆëª©ë§Œ í•„í„°ë§ (ì´ë¯¸ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ëœ í’ˆëª© ì œì™¸)\n      const allItems = purchase.purchase_request_items || [];\n      const pendingItems = allItems.filter(item => !item.is_statement_received);\n      \n      if (pendingItems.length === 0) {\n        toast.info('ëª¨ë“  í’ˆëª©ì˜ ê±°ë˜ëª…ì„¸ì„œê°€ ì´ë¯¸ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.');\n        return;\n      }\n\n      logger.info(`ì „ì²´ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ì²˜ë¦¬: ${pendingItems.length}ê°œ í’ˆëª© (ì´ ${allItems.length}ê°œ ì¤‘)`);\n      \n      for (const item of pendingItems) {\n        // ê° í’ˆëª©ë³„ë¡œ DB ì—…ë°ì´íŠ¸ (ê°œë³„ í’ˆëª©ê³¼ ë™ì¼í•œ ë°©ì‹)\n        const updateData = {\n          is_statement_received: true,\n          statement_received_date: selectedDateIso,\n          statement_received_by_name: currentUserName || null\n        };\n\n        const { error } = await supabase\n          .from('purchase_request_items')\n          .update(updateData)\n          .eq('id', item.id);\n\n        if (error) throw error;\n\n        // ğŸš€ ê°œë³„ í’ˆëª© ë©”ëª¨ë¦¬ ìºì‹œ ì—…ë°ì´íŠ¸ (ê°œë³„ ì²˜ë¦¬ì™€ ë™ì¼)\n        const memoryUpdated = markItemAsStatementReceived(purchase.id, item.id, selectedDateIso, currentUserName || undefined);\n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal] ë©”ëª¨ë¦¬ ìºì‹œ ê°œë³„ í’ˆëª© ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { \n            purchaseId: purchase.id, \n            itemId: item.id \n          });\n        }\n      }\n\n      toast.success(`${pendingItems.length}ê°œ í’ˆëª©ì˜ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`);\n\n      // ğŸš€ ìƒˆë¡œê³ ì¹¨ (ê°œë³„ í’ˆëª©ê³¼ ë™ì¼)\n      await refreshModalData();\n      const refreshResult = onRefresh?.(true, { silent: true });\n      if (refreshResult instanceof Promise) {\n        await refreshResult;\n      }\n    } catch (error) {\n      logger.error('ì „ì²´ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ì²˜ë¦¬ ì˜¤ë¥˜', error)\n      toast.error('ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n\n  // ì „ì²´ ì…ê³ ì™„ë£Œ ì²˜ë¦¬ (ë‚ ì§œ ì„ íƒ + ì‹¤ì œì…ê³ ìˆ˜ëŸ‰)\n  const handleCompleteAllReceipt = async (selectedDate: Date, receivedQuantity?: number) => {\n    if (!purchase || !canReceiveItems) {\n      return\n    }\n\n    // í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ\n    const confirmMessage = `ë°œì£¼ë²ˆí˜¸: ${purchase.purchase_order_number}\n\nì „ì²´ ì…ê³ ì™„ë£Œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`\n    \n    if (!window.confirm(confirmMessage)) {\n      return\n    }\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    try {\n      // ğŸš€ ë¯¸ì™„ë£Œ í’ˆëª©ë§Œ í•„í„°ë§ (ì´ë¯¸ ì…ê³ ì™„ë£Œëœ í’ˆëª© ì œì™¸)\n      const allItems = purchase.purchase_request_items || [];\n      const pendingItems = allItems.filter(item => !item.is_received);\n      \n      const applyOptimisticUpdate = () => {\n        if (!Number.isNaN(purchaseIdNumber)) {\n          onOptimisticUpdate?.(purchaseIdNumber, prev => {\n            const updatedItems = (prev.items || []).map(item => {\n              const pendingItem = pendingItems.find((p: any) => String(p.id) === String(item.id))\n              if (pendingItem) {\n                // ë¯¸ì™„ë£Œ í’ˆëª©ë§Œ ì—…ë°ì´íŠ¸, receivedQuantityê°€ ì—†ìœ¼ë©´ ìš”ì²­ìˆ˜ëŸ‰(quantity)ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©\n                return {\n                  ...item,\n                  is_received: true,\n                  actual_received_date: item.actual_received_date || selectedDate.toISOString(),\n                  received_quantity: receivedQuantity !== undefined ? receivedQuantity : item.quantity\n                }\n              }\n              return item\n            })\n            const updatedRequestItems = (prev.purchase_request_items || []).map(item => {\n              const pendingItem = pendingItems.find((p: any) => String(p.id) === String(item.id))\n              if (pendingItem) {\n                // ë¯¸ì™„ë£Œ í’ˆëª©ë§Œ ì—…ë°ì´íŠ¸, receivedQuantityê°€ ì—†ìœ¼ë©´ ìš”ì²­ìˆ˜ëŸ‰(quantity)ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©\n                return {\n                  ...item,\n                  is_received: true,\n                  actual_received_date: item.actual_received_date || selectedDate.toISOString(),\n                  received_quantity: receivedQuantity !== undefined ? receivedQuantity : item.quantity\n                }\n              }\n              return item\n            })\n\n            return {\n              ...prev,\n              items: updatedItems,\n              purchase_request_items: updatedRequestItems,\n              is_received: true,\n              received_at: new Date().toISOString(),\n              updated_at: new Date().toISOString()\n            }\n          })\n        }\n      }\n      \n      if (pendingItems.length === 0) {\n        toast.info('ëª¨ë“  í’ˆëª©ì´ ì´ë¯¸ ì…ê³ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');\n        return;\n      }\n\n      logger.info(`ì „ì²´ ì…ê³ ì™„ë£Œ ì²˜ë¦¬: ${pendingItems.length}ê°œ í’ˆëª© (ì´ ${allItems.length}ê°œ ì¤‘)`);\n      \n      // Optimistic Update ë¨¼ì € ì‹¤í–‰\n      applyOptimisticUpdate()\n      \n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => {\n          const pendingItem = pendingItems.find(p => String(p.id) === String(item.id))\n          if (pendingItem) {\n            // receivedQuantityê°€ ì—†ìœ¼ë©´ ìš”ì²­ìˆ˜ëŸ‰(quantity)ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©\n            return {\n              ...item,\n              is_received: true,\n              received_at: new Date().toISOString(),\n              actual_received_date: selectedDate.toISOString(),\n              received_quantity: receivedQuantity !== undefined ? receivedQuantity : item.quantity\n            }\n          }\n          return item\n        }) || []\n        const updatedRequestItems = prev.purchase_request_items?.map(item => {\n          const pendingItem = pendingItems.find(p => String(p.id) === String(item.id))\n          if (pendingItem) {\n            // receivedQuantityê°€ ì—†ìœ¼ë©´ ìš”ì²­ìˆ˜ëŸ‰(quantity)ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©\n            return {\n              ...item,\n              is_received: true,\n              received_at: new Date().toISOString(),\n              actual_received_date: selectedDate.toISOString(),\n              received_quantity: receivedQuantity !== undefined ? receivedQuantity : item.quantity\n            }\n          }\n          return item\n        }) || []\n        const total = updatedItems.length\n        const completed = updatedItems.filter(item => item.is_received).length\n        const allReceived = total > 0 && completed === total\n        \n        return {\n          ...prev,\n          items: updatedItems,\n          purchase_request_items: updatedRequestItems,\n          is_received: allReceived,\n          received_at: allReceived ? new Date().toISOString() : prev.received_at,\n          updated_at: new Date().toISOString()\n        }\n      })\n      \n      for (const item of pendingItems) {\n        // ê° í’ˆëª©ë³„ë¡œ DB ì—…ë°ì´íŠ¸ (ê°œë³„ í’ˆëª©ê³¼ ë™ì¼í•œ ë°©ì‹)\n        // receivedQuantityê°€ ì—†ìœ¼ë©´ ìš”ì²­ìˆ˜ëŸ‰(quantity)ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©\n        const updateData = {\n          actual_received_date: selectedDate.toISOString(),\n          is_received: true,\n          received_quantity: receivedQuantity !== undefined ? receivedQuantity : item.quantity // ì „ì²´ ì…ê³ ì‹œ ìš”ì²­ìˆ˜ëŸ‰ê³¼ ë™ì¼í•˜ê²Œ ì„¤ì •\n        };\n\n        const { error } = await supabase\n          .from('purchase_request_items')\n          .update(updateData)\n          .eq('id', item.id);\n\n        if (error) throw error;\n\n        // ğŸš€ ê°œë³„ í’ˆëª© ë©”ëª¨ë¦¬ ìºì‹œ ì—…ë°ì´íŠ¸ (ê°œë³„ ì²˜ë¦¬ì™€ ë™ì¼)\n        // receivedQuantityê°€ ì—†ìœ¼ë©´ ìš”ì²­ìˆ˜ëŸ‰(quantity)ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©\n        const itemReceivedQuantity = receivedQuantity !== undefined ? receivedQuantity : item.quantity\n        const memoryUpdated = markItemAsReceived(purchase.id, item.id, selectedDate.toISOString(), itemReceivedQuantity);\n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal] ë©”ëª¨ë¦¬ ìºì‹œ ê°œë³„ í’ˆëª© ì…ê³ ì™„ë£Œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { \n            purchaseId: purchase.id, \n            itemId: item.id \n          });\n        }\n      }\n\n      toast.success(`${pendingItems.length}ê°œ í’ˆëª©ì´ ì…ê³ ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.`);\n\n      // ğŸš€ ìƒˆë¡œê³ ì¹¨ (ê°œë³„ í’ˆëª©ê³¼ ë™ì¼)\n      await refreshModalData();\n      const refreshResult = onRefresh?.(true, { silent: true });\n      if (refreshResult instanceof Promise) {\n        await refreshResult;\n      }\n    } catch (error) {\n      logger.error('ì „ì²´ ì…ê³ ì™„ë£Œ ì²˜ë¦¬ ì˜¤ë¥˜', error)\n      toast.error('ì…ê³ ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n  \n\n  // ë°˜ë ¤ ì²˜ë¦¬\n  const handleReject = async (type: 'middle' | 'final') => {\n    if (!purchase) return\n    \n    const reason = window.prompt('ë°˜ë ¤ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”:')\n    if (!reason) return\n    \n    try {\n      const updateData = type === 'middle'\n        ? {\n            middle_manager_status: 'rejected'\n          }\n        : {\n            final_manager_status: 'rejected'\n          }\n      \n      const { error } = await supabase\n        .from('purchase_requests')\n        .update(updateData)\n        .eq('id', purchase.id)\n      \n      if (error) {\n        throw error\n      }\n      \n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (UI ì¦‰ì‹œ ë°˜ì˜)\n      if (type === 'middle') {\n        setPurchase(prev => prev ? { ...prev, middle_manager_status: 'rejected' } : null)\n      } else {\n        setPurchase(prev => prev ? { ...prev, final_manager_status: 'rejected' } : null)\n      }\n      \n      toast.success(`${type === 'middle' ? 'ì¤‘ê°„' : 'ìµœì¢…'} ë°˜ë ¤ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`)\n    } catch (error) {\n      toast.error('ë°˜ë ¤ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n\n  const content = (\n    <div className=\"space-y-1 sm:space-y-4\">\n      {loading ? (\n        <div className=\"flex items-center justify-center py-12\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-hansl-600\"></div>\n        </div>\n      ) : purchase ? (\n        <div>\n          {/* Compact Info Header */}\n          <div className=\"bg-gray-50 rounded-lg p-2 sm:p-3 mb-1 sm:mb-2 border border-gray-100\">\n            <div className=\"grid grid-cols-1 sm:grid-cols-3 items-center gap-3 sm:gap-0\">\n              <div className=\"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-4\">\n                <div className=\"flex items-center gap-3\">\n                  {getStatusBadge()}\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"modal-label\">ìš”ì²­ì:</span>\n                    <span className=\"modal-value\">{purchase.requester_name}</span>\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Calendar className=\"w-3 h-3 text-gray-500\" />\n                  <span className=\"modal-subtitle\">ì²­êµ¬ì¼: {formatDate(purchase.request_date)}</span>\n                </div>\n              </div>\n              \n              {/* ìŠ¹ì¸ ë²„íŠ¼ë“¤ì„ ì¤‘ì•™ì— ë°°ì¹˜ */}\n              <div className=\"flex items-center justify-center gap-2 sm:gap-3 flex-wrap\">\n                {/* 1ì°¨ ìŠ¹ì¸ ë²„íŠ¼ */}\n                {(() => {\n                  const shouldShow = canApproveMiddle && purchase.middle_manager_status === 'pending';\n                  return shouldShow;\n                })() && (\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => handleApprove('middle')}\n                    className={`${approvalButtonClass} border border-gray-400 bg-white hover:bg-gray-50 hover:border-gray-500`}\n                  >\n                    1ì°¨ ìŠ¹ì¸ ëŒ€ê¸°\n                  </Button>\n                )}\n                {purchase.middle_manager_status === 'approved' && (\n                  <div className=\"button-approved badge-text shadow-sm\">\n                    <Check className=\"w-3 h-3\" />\n                    1ì°¨ ìŠ¹ì¸ì™„ë£Œ\n                  </div>\n                )}\n                {purchase.middle_manager_status === 'rejected' && (\n                  <div className=\"button-rejected badge-text\">\n                    <X className=\"w-3 h-3\" />\n                    1ì°¨ ë°˜ë ¤\n                  </div>\n                )}\n                {purchase.middle_manager_status === 'pending' && !canApproveMiddle && (\n                  <div className={`${approvalWaitingPillClass} border border-gray-300 text-gray-600 bg-white`}>\n                    1ì°¨ ìŠ¹ì¸ëŒ€ê¸°\n                  </div>\n                )}\n\n                {/* ìµœì¢… ìŠ¹ì¸ ë²„íŠ¼ */}\n                {(() => {\n                  const shouldShow = canApproveFinal && purchase.middle_manager_status === 'approved' && purchase.final_manager_status === 'pending';\n                  return shouldShow;\n                })() && (\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => handleApprove('final')}\n                    className={`${approvalButtonClass} border border-gray-400 bg-white hover:bg-gray-50 hover:border-gray-500`}\n                  >\n                    <Check className=\"w-3 h-3\" />\n                    ìµœì¢… ìŠ¹ì¸\n                  </Button>\n                )}\n                {purchase.final_manager_status === 'approved' && (\n                  <div className=\"button-approved badge-text\">\n                    <Check className=\"w-3 h-3\" />\n                    ìµœì¢… ìŠ¹ì¸ì™„ë£Œ\n                  </div>\n                )}\n                {purchase.final_manager_status === 'rejected' && (\n                  <div className=\"button-rejected badge-text\">\n                    <X className=\"w-3 h-3\" />\n                    ìµœì¢… ë°˜ë ¤\n                  </div>\n                )}\n                {purchase.middle_manager_status !== 'approved' && purchase.final_manager_status === 'pending' && (\n                  <div className={`${approvalWaitingPillClass} border border-gray-300 text-gray-600 bg-white`}>\n                    ìµœì¢… ìŠ¹ì¸ëŒ€ê¸°\n                  </div>\n                )}\n              </div>\n              \n              {/* ìš°ì¸¡ ë¹ˆ ì˜ì—­ */}\n              <div></div>\n            </div>\n          </div>\n\n          {/* Main 2-Column Layout */}\n          <div className=\"flex flex-col lg:flex-row gap-3 sm:gap-6\">\n            {/* Left Column - Basic Info (Fixed Width) */}\n            <div className=\"lg:w-80 lg:flex-shrink-0 space-y-1 sm:space-y-4 relative\">\n              \n              {/* ë°œì£¼ ê¸°ë³¸ì •ë³´ */}\n              <div className=\"bg-white rounded-lg p-2 sm:p-3 border border-gray-100 shadow-sm\">\n                <div className=\"mb-3\">\n                  <div className=\"flex items-center justify-between\">\n                    <h3 className=\"modal-section-title flex items-center\">\n                      <FileText className=\"w-4 h-4 mr-2 text-gray-600\" />\n                      {purchase?.purchase_order_number || 'POë²ˆí˜¸ ì—†ìŒ'}\n                    </h3>\n                    {canReceiptCheck && activeTab === 'done' && (\n                      <button\n                        onClick={async () => {\n                          if (!purchase) return\n                          const isCurrentlyChecked = purchase.is_utk_checked || false\n                          const newStatus = !isCurrentlyChecked\n                          \n                          const confirmMessage = newStatus\n                            ? `ë°œì£¼ë²ˆí˜¸: ${purchase.purchase_order_number}\\n\\nUTK í™•ì¸ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`\n                            : `ë°œì£¼ë²ˆí˜¸: ${purchase.purchase_order_number}\\n\\nUTK í™•ì¸ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`\n                          \n                          if (!window.confirm(confirmMessage)) return\n                          \n                          try {\n                            const supabase = createClient()\n                            const { error } = await supabase\n                              .from('purchase_requests')\n                              .update({ is_utk_checked: newStatus })\n                              .eq('id', purchase.id)\n                            \n                            if (error) {\n                              logger.error('UTK í™•ì¸ DB ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { error, purchaseId: purchase.id })\n                              toast.error('UTK í™•ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n                              return\n                            }\n                            \n                            // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (ê°ì²´ ì°¸ì¡° ë³€ê²½ìœ¼ë¡œ React ì¬ë Œë”ë§ ë³´ì¥)\n                            setPurchase(prev => prev ? { \n                              ...prev, \n                              is_utk_checked: newStatus,\n                              updated_at: new Date().toISOString() // ê°•ì œë¡œ ê°ì²´ ì°¸ì¡° ë³€ê²½\n                            } : null)\n                            \n                            // ë©”ëª¨ë¦¬ ìºì‹œ ì—…ë°ì´íŠ¸\n                            if (purchase.id) {\n                              updatePurchaseInMemory(purchase.id, (prev) => ({\n                                ...prev,\n                                is_utk_checked: newStatus\n                              }))\n                            }\n                            \n                            toast.success(newStatus ? 'UTK í™•ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.' : 'UTK í™•ì¸ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.')\n                            \n                            await refreshModalData()\n                            const refreshResult = onRefresh?.(true, { silent: true })\n                            if (refreshResult instanceof Promise) {\n                              await refreshResult\n                            }\n                          } catch (error) {\n                            logger.error('UTK í™•ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜', error)\n                            toast.error('UTK í™•ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n                          }\n                        }}\n                        className={`button-base text-xs px-2 py-1 flex items-center ${\n                          purchase?.is_utk_checked\n                            ? 'button-toggle-active bg-orange-500 hover:bg-orange-600 text-white'\n                            : 'button-toggle-inactive'\n                        }`}\n                        title={purchase?.is_utk_checked ? 'UTK í™•ì¸ ì·¨ì†Œ' : 'UTK í™•ì¸'}\n                      >\n                        <CheckCircle className=\"w-3 h-3 mr-1\" />\n                        UTK {purchase?.is_utk_checked ? 'ì™„ë£Œ' : 'í™•ì¸'}\n                      </button>\n                    )}\n                  </div>\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">ë°œì£¼ì„œ ì¢…ë¥˜</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.request_type || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, request_type: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"ì¼ë°˜\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.request_type || 'ì¼ë°˜'}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">ê²°ì œ ì¢…ë¥˜</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.payment_category || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, payment_category: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"ë°œì£¼/êµ¬ë§¤ìš”ì²­/í˜„ì¥ê²°ì œ\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.payment_category || '-'}</p>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">ì…ê³  ìš”ì²­ì¼</span>\n                      {isEditing ? (\n                        <DatePickerPopover\n                          onDateSelect={(date) => {\n                            setEditedPurchase(prev => prev ? {\n                              ...prev,\n                              delivery_request_date: formatDateInput(date, 'yyyy-MM-dd')\n                            } : null)\n                          }}\n                          placeholder=\"ì…ê³  ìš”ì²­ì¼ì„ ì„ íƒí•˜ì„¸ìš”\"\n                          align=\"start\"\n                          side=\"bottom\"\n                        >\n                          <Button\n                            variant=\"outline\"\n                            className=\"mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] justify-start text-left font-normal business-radius-input\"\n                          >\n                            <Calendar className=\"mr-1 h-3 w-3\" />\n                            {editedPurchase?.delivery_request_date ? \n                              formatDate(editedPurchase.delivery_request_date) : \n                              'ë‚ ì§œ ì„ íƒ'\n                            }\n                          </Button>\n                        </DatePickerPopover>\n                      ) : (\n                        <p className=\"modal-subtitle\">{formatDate(purchase.delivery_request_date)}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label text-orange-500\">ë³€ê²½ ì…ê³ ì¼</span>\n                      {isEditing ? (\n                        <DatePickerPopover\n                          onDateSelect={(date) => {\n                            setEditedPurchase(prev => prev ? {\n                              ...prev,\n                              revised_delivery_request_date: formatDateInput(date, 'yyyy-MM-dd')\n                            } : null)\n                          }}\n                          placeholder=\"ë³€ê²½ ì…ê³ ì¼ì„ ì„ íƒí•˜ì„¸ìš”\"\n                          align=\"start\"\n                          side=\"bottom\"\n                        >\n                          <Button\n                            variant=\"outline\"\n                            className=\"mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] justify-start text-left font-normal business-radius-input\"\n                          >\n                            <Calendar className=\"mr-1 h-3 w-3\" />\n                            {editedPurchase?.revised_delivery_request_date ? \n                              formatDate(editedPurchase.revised_delivery_request_date) : \n                              'ë‚ ì§œ ì„ íƒ'\n                            }\n                          </Button>\n                        </DatePickerPopover>\n                      ) : (\n                        <p className=\"modal-subtitle text-orange-700\">\n                          {purchase.revised_delivery_request_date ? formatDate(purchase.revised_delivery_request_date) : 'ë¯¸ì„¤ì •'}\n                        </p>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/* ì—…ì²´ ì •ë³´ */}\n              <div className=\"bg-white rounded-lg p-2 sm:p-3 border border-gray-100 shadow-sm\">\n                <h3 className=\"modal-section-title mb-3 flex items-center\">\n                  <Building2 className=\"w-4 h-4 mr-2 text-gray-600\" />\n                  ì—…ì²´ ì •ë³´\n                </h3>\n                \n                <div className=\"space-y-2\">\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">ì—…ì²´ëª…</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.vendor?.vendor_name || editedPurchase?.vendor_name || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, vendor_name: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"ì—…ì²´ ì„ íƒ\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.vendor?.vendor_name || '-'}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">ì—…ì²´ ë‹´ë‹¹ì</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.vendor_contacts?.[0]?.contact_name || ''}\n                          onChange={(e) => {\n                            setEditedPurchase(prev => {\n                              if (!prev) return null;\n                              const contacts = prev.vendor_contacts || [];\n                              const updatedContacts = [...contacts];\n                              if (updatedContacts[0]) {\n                                updatedContacts[0] = { ...updatedContacts[0], contact_name: e.target.value };\n                              } else {\n                                updatedContacts[0] = { contact_name: e.target.value } as any;\n                              }\n                              return { ...prev, vendor_contacts: updatedContacts };\n                            })\n                          }}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"ë‹´ë‹¹ì ì„ íƒ\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.vendor_contacts?.[0]?.contact_name || '-'}</p>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">PJì—…ì²´</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.project_vendor || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, project_vendor: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"ì…ë ¥\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.project_vendor || '-'}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">Item</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.project_item || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, project_item: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"ì…ë ¥\"\n                        />\n                      ) : (\n                        <p className=\"modal-subtitle\">{purchase.project_item || '-'}</p>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">ìˆ˜ì£¼ë²ˆí˜¸</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.order_number || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, order_number: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"ì…ë ¥\"\n                        />\n                      ) : (\n                        <p className=\"modal-subtitle\">{purchase.order_number || '-'}</p>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n            </div>\n\n            {/* Right Column - Items List (Fit Width) */}\n            <div className=\"lg:w-fit lg:min-w-0 relative overflow-visible\">\n              \n              <div className=\"bg-white rounded-lg border border-gray-100 shadow-sm\">\n                <div className=\"p-2 sm:p-3 bg-gray-50 border-b border-gray-100 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-0\">\n                  <h3 className=\"modal-section-title flex items-center\">\n                    <Package className=\"w-4 h-4 mr-2 text-gray-600\" />\n                    í’ˆëª© ë¦¬ìŠ¤íŠ¸\n                    <span className=\"ml-2 badge-stats bg-gray-500 text-white\">\n                      {currentItems?.length || 0}ê°œ\n                    </span>\n                  </h3>\n                  {!isEditing && (\n                    <>\n                      {activeTab === 'purchase' && canPurchase && (\n                        <Button\n                          size=\"sm\"\n                          onClick={handleCompleteAllPayment}\n                          className=\"button-base bg-orange-500 hover:bg-orange-600 text-white\"\n                        >\n                          <CreditCard className=\"w-3 h-3 mr-1\" />\n                          ì „ì²´ êµ¬ë§¤ì™„ë£Œ\n                        </Button>\n                      )}\n                      {activeTab === 'receipt' && canReceiveItems && (\n                        <DateQuantityPickerPopover\n                          onConfirm={handleCompleteAllReceipt}\n                          placeholder=\"ì…ê³ ì¼ì„ ì„ íƒí•˜ì„¸ìš”\"\n                          align=\"end\"\n                          side=\"bottom\"\n                          hideQuantityInput={true}\n                          quantityInfoText=\"ìš”ì²­ì…ê³ ìˆ˜ëŸ‰ê³¼ ë™ì¼í•œ ìˆ˜ëŸ‰ìœ¼ë¡œ ì…ë ¥ë©ë‹ˆë‹¤\"\n                        >\n                          <Button\n                            size=\"sm\"\n                            className=\"button-base button-action-primary\"\n                          >\n                            <Truck className=\"w-3 h-3 mr-1\" />\n                            ì „ì²´ ì…ê³ ì™„ë£Œ\n                          </Button>\n                        </DateQuantityPickerPopover>\n                      )}\n                      {activeTab === 'done' && canReceiptCheck && (\n                        <div className=\"flex items-center gap-2\">\n                          <DatePickerPopover\n                            onDateSelect={handleCompleteAllStatement}\n                            placeholder=\"ì „ì²´ íšŒê³„ìƒ ì…ê³ ì¼ì„ ì„ íƒí•˜ì„¸ìš”\"\n                            align=\"end\"\n                            side=\"bottom\"\n                          >\n                            <Button\n                              size=\"sm\"\n                              className=\"button-base button-action-primary\"\n                            >\n                              <FileText className=\"w-3 h-3 mr-1\" />\n                              ê±°ë˜ëª…ì„¸ì„œ í™•ì¸\n                            </Button>\n                          </DatePickerPopover>\n                          <DateAmountPickerPopover\n                            onConfirm={handleBulkExpenditure}\n                            placeholder=\"ì¼ê´„ ì§€ì¶œ ë‚ ì§œì™€ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”\"\n                            align=\"end\"\n                            side=\"bottom\"\n                          >\n                            <Button\n                              size=\"sm\"\n                              className=\"button-base button-action-primary\"\n                            >\n                              <DollarSign className=\"w-3 h-3 mr-1\" />\n                              ì¼ê´„ì§€ì¶œ\n                            </Button>\n                          </DateAmountPickerPopover>\n                        </div>\n                      )}\n                    </>\n                  )}\n                </div>\n                \n                {/* Mobile Table Header */}\n                <div className=\"block sm:hidden bg-gray-50 px-2 py-1 border-b border-gray-100\">\n                  <div className=\"text-xs font-medium text-gray-600\">í’ˆëª© ëª©ë¡ (í„°ì¹˜í•˜ì—¬ ìŠ¤í¬ë¡¤)</div>\n                </div>\n                \n                {/* Items List with Header Inside Scrollable Container */}\n                <div className=\"max-h-[50vh] sm:max-h-[40vh] overflow-auto\">\n                  <div className=\"w-fit\">\n                    {/* Items Table Header - Sticky inside scroll container */}\n                    <div className=\"bg-gray-50 px-2 sm:px-3 py-1 border-b border-gray-100 sticky top-0 z-10 w-fit\">\n                      <div \n                        ref={headerRowRef}\n                         className=\"hidden sm:grid gap-2 modal-label w-fit\"\n                        style={{\n                          gridTemplateColumns: getGridTemplateColumns()\n                        }}\n                      >\n                        <div>í’ˆëª©ëª…</div>\n                        <div>ê·œê²©</div>\n                        <div className=\"text-center\">\n                          {(activeTab === 'receipt' || activeTab === 'done') && !isEditing ? (\n                            <div className=\"flex flex-col items-center leading-tight\">\n                              <div className=\"text-[9px]\">ìš”ì²­/ì‹¤ì œ</div>\n                              <div className=\"text-[10px]\">ì…ê³ ìˆ˜ëŸ‰</div>\n                            </div>\n                          ) : (\n                            'ìš”ì²­ìˆ˜ëŸ‰'\n                          )}\n                        </div>\n                        <div className=\"text-right\">ë‹¨ê°€</div>\n                        <div className=\"text-right\">í•©ê³„</div>\n                        <div className=\"text-center\">ë¹„ê³ </div>\n                        {isEditing ? (\n                          <>\n                            <div className=\"text-center\">ì‚­ì œ</div>\n                            {activeTab === 'receipt' && (\n                              <>\n                                <div className=\"text-center\">ì‹¤ì œì…ê³ ì¼</div>\n                              </>\n                            )}\n                            {activeTab === 'done' && (\n                              <>\n                                <div className=\"text-center\">ê±°ë˜ëª…ì„¸ì„œ í™•ì¸</div>\n                                <div className=\"text-center\">íšŒê³„ìƒ ì…ê³ ì¼</div>\n                                <div className=\"text-center\">ì§€ì¶œì •ë³´</div>\n                              </>\n                            )}\n                          </>\n                        ) : (\n                          <>\n                            <div className=\"text-center\">\n                              {activeTab === 'purchase'\n                                ? 'êµ¬ë§¤ìƒíƒœ'\n                                : (activeTab === 'receipt' || activeTab === 'done')\n                                ? 'ì…ê³ ìƒíƒœ'\n                                : 'ìƒíƒœ'}\n                            </div>\n                            {activeTab === 'done' && (\n                              <>\n                                <div className=\"text-center\">ê±°ë˜ëª…ì„¸ì„œ í™•ì¸</div>\n                                <div className=\"text-center\">íšŒê³„ìƒ ì…ê³ ì¼</div>\n                                <div className=\"text-center\">ì§€ì¶œì •ë³´</div>\n                              </>\n                            )}\n                            {activeTab === 'receipt' && (\n                              <>\n                                <div className=\"text-center\">ì‹¤ì œì…ê³ ì¼</div>\n                              </>\n                            )}\n                          </>\n                        )}\n                      </div>\n                    </div>\n                    <div className=\"divide-y divide-gray-100 overflow-visible w-fit\">\n                      {(isEditing ? editedItems : currentItems)?.map((item, index) => (\n                        <div key={index} className=\"px-2 sm:px-3 py-1 border-b border-gray-50 hover:bg-gray-50/50 relative overflow-visible\">\n                          {/* Desktop Layout */}\n                          <div className={`hidden sm:grid items-center gap-2 overflow-visible w-fit`} style={{\n                            gridTemplateColumns: getGridTemplateColumns()\n                          }}>\n                            {/* í’ˆëª©ëª… */}\n                            <div className=\"min-w-0 relative overflow-visible flex items-center\">\n                              {isEditing ? (\n                                <Input\n                                  value={item.item_name}\n                                  onChange={(e) => handleItemChange(index, 'item_name', e.target.value)}\n                                  onFocus={() => setFocusedInput(`item_name_${index}`)}\n                                  onBlur={() => setFocusedInput(null)}\n                                  className={`modal-label border-gray-200 rounded-lg w-full !px-1.5 !py-0.5 !text-[10px] focus:border-blue-400 transition-all duration-200 ${\n                                    focusedInput === `item_name_${index}` \n                                      ? '!h-auto !min-h-[20px] !absolute !z-[9999] !bg-white !shadow-lg !left-0 !right-0 !-translate-y-1/2 !top-1/2 !whitespace-normal' \n                                      : '!h-5 !truncate'\n                                  }`}\n                                  placeholder=\"í’ˆëª©ëª…\"\n                                  disabled={canEditLimited && !canEditAll}  // lead buyerëŠ” í’ˆëª©ëª… ìˆ˜ì • ë¶ˆê°€\n                                />\n                              ) : (\n                                <div \n                                  className=\"modal-value\" \n                                  style={{\n                                    whiteSpace: 'normal',\n                                    wordBreak: 'break-all', // ì–´ë””ì„œë“  ì¤„ë°”ê¿ˆ ê°€ëŠ¥ (í•˜ì´í”ˆ ë¬´ì‹œ)\n                                    overflowWrap: 'break-word',\n                                    hyphens: 'none', // í•˜ì´í”ˆì—ì„œ ìë™ ì¤„ë°”ê¿ˆ ë°©ì§€\n                                    WebkitHyphens: 'none',\n                                    MozHyphens: 'none',\n                                    msHyphens: 'none',\n                                    lineHeight: '1.4',\n                                    maxHeight: '2.8em', // ìµœëŒ€ 2í–‰ ë†’ì´\n                                    overflow: 'hidden',\n                                    display: '-webkit-box',\n                                    WebkitLineClamp: 2,\n                                    WebkitBoxOrient: 'vertical'\n                                  }}\n                                  title={item.item_name || 'í’ˆëª©ëª… ì—†ìŒ'}\n                                >\n                                  {item.item_name || 'í’ˆëª©ëª… ì—†ìŒ'}\n                                </div>\n                              )}\n                            </div>\n                            \n                            {/* ê·œê²© */}\n                            <div className=\"min-w-0 relative overflow-visible flex items-center\" style={{ width: '200px', maxWidth: '200px', minWidth: '200px' }}>\n                              {isEditing ? (\n                                <Input\n                                  value={item.specification}\n                                  onChange={(e) => handleItemChange(index, 'specification', e.target.value)}\n                                  onFocus={() => setFocusedInput(`specification_${index}`)}\n                                  onBlur={() => setFocusedInput(null)}\n                                  className={`modal-label border-gray-200 rounded-lg w-full !px-1.5 !py-0.5 !text-[10px] focus:border-blue-400 transition-all duration-200 ${\n                                    focusedInput === `specification_${index}` \n                                      ? '!h-auto !min-h-[20px] !absolute !z-[9999] !bg-white !shadow-lg !left-1/2 !-translate-x-1/2 !-translate-y-1/2 !top-1/2 !whitespace-normal !w-[300px]' \n                                      : '!h-5 !truncate'\n                                  }`}\n                                  placeholder=\"ê·œê²©\"\n                                  disabled={canEditLimited && !canEditAll}  // lead buyerëŠ” ê·œê²© ìˆ˜ì • ë¶ˆê°€\n                                />\n                              ) : (\n                                <div \n                                  className=\"text-[11px] text-gray-600 font-medium\" \n                                  style={{\n                                    whiteSpace: 'normal',\n                                    wordBreak: 'break-all', // ì–´ë””ì„œë“  ì¤„ë°”ê¿ˆ ê°€ëŠ¥ (í•˜ì´í”ˆ ë¬´ì‹œ)\n                                    overflowWrap: 'break-word',\n                                    hyphens: 'none', // í•˜ì´í”ˆì—ì„œ ìë™ ì¤„ë°”ê¿ˆ ë°©ì§€\n                                    WebkitHyphens: 'none', // Safari ì§€ì›\n                                    MozHyphens: 'none', // Firefox ì§€ì›\n                                    msHyphens: 'none', // IE ì§€ì›\n                                    lineHeight: '1.4',\n                                    maxHeight: '2.8em', // ìµœëŒ€ 2í–‰ ë†’ì´\n                                    overflow: 'hidden',\n                                    display: '-webkit-box',\n                                    WebkitLineClamp: 2, // ìµœëŒ€ 2í–‰ê¹Œì§€ë§Œ í‘œì‹œ\n                                    WebkitBoxOrient: 'vertical'\n                                  }}\n                                  title={item.specification || '-'}\n                                >\n                                  {item.specification || '-'}\n                                </div>\n                              )}\n                            </div>\n                            \n                            {/* ìˆ˜ëŸ‰ */}\n                            <div className=\"text-center min-w-0 flex items-center justify-center\">\n                              {isEditing ? (\n                                (activeTab === 'receipt' || activeTab === 'done') ? (\n                                  <div className=\"flex flex-col items-center gap-0.5 w-full\">\n                                    <Input\n                                      type=\"number\"\n                                      value={item.quantity}\n                                      onChange={(e) => handleItemChange(index, 'quantity', Number(e.target.value))}\n                                      className=\"border-gray-200 rounded-lg text-center w-full !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400\"\n                                      placeholder=\"ìš”ì²­ìˆ˜ëŸ‰\"\n                                      max=\"99999\"\n                                    />\n                                    <div className=\"flex items-center gap-0.5 w-full\">\n                                      <span className=\"text-[9px] text-gray-500\">/</span>\n                                      <Input\n                                        type=\"number\"\n                                        value={item.received_quantity ?? ''}\n                                        onChange={(e) => handleItemChange(index, 'received_quantity', e.target.value ? Number(e.target.value) : null)}\n                                        className=\"border-gray-200 rounded-lg text-center flex-1 !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400\"\n                                        placeholder=\"ì‹¤ì œì…ê³ \"\n                                        max=\"99999\"\n                                      />\n                                    </div>\n                                  </div>\n                                ) : (\n                                  <Input\n                                    type=\"number\"\n                                    value={item.quantity}\n                                    onChange={(e) => handleItemChange(index, 'quantity', Number(e.target.value))}\n                                    className=\"border-gray-200 rounded-lg text-center w-full !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400\"\n                                    placeholder=\"ìˆ˜ëŸ‰\"\n                                    max=\"99999\"\n                                  />\n                                )\n                              ) : (\n                                (activeTab === 'receipt' || activeTab === 'done') ? (\n                                  (() => {\n                                    const quantity = item.quantity || 0\n                                    const receivedQuantity = item.received_quantity ?? 0\n                                    const shouldWrap = quantity >= 100 || receivedQuantity >= 100\n                                    const hasReceived = receivedQuantity > 0\n                                    \n                                    if (shouldWrap) {\n                                      return (\n                                        <div className=\"flex flex-col items-center leading-tight\">\n                                          <div className={`modal-subtitle ${hasReceived ? 'text-gray-400' : ''}`}>{quantity}</div>\n                                          <div className={`modal-subtitle ${hasReceived ? '' : 'text-gray-400'}`}>/{receivedQuantity}</div>\n                                        </div>\n                                      )\n                                    } else {\n                                      return (\n                                        <span className=\"modal-subtitle\">\n                                          <span className={hasReceived ? 'text-gray-400' : ''}>{quantity}</span>\n                                          <span className={hasReceived ? '' : 'text-gray-400'}>/{receivedQuantity}</span>\n                                        </span>\n                                      )\n                                    }\n                                  })()\n                                ) : (\n                                  <span className=\"modal-subtitle\">{item.quantity || 0}</span>\n                                )\n                              )}\n                            </div>\n                            \n                            {/* ë‹¨ê°€ */}\n                            <div className=\"text-right min-w-0 flex items-center justify-end\">\n                              {isEditing ? (\n                                <Input\n                                  type=\"number\"\n                                  value={item.unit_price_value}\n                                  onChange={(e) => handleItemChange(index, 'unit_price_value', Number(e.target.value))}\n                                  className=\"border-gray-200 rounded-lg text-right w-full !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400\"\n                                  placeholder=\"ë‹¨ê°€\"\n                                  max=\"100000000000\"\n                                />\n                              ) : (\n                                <span className=\"modal-subtitle\">â‚©{formatCurrency(item.unit_price_value)}</span>\n                              )}\n                            </div>\n                            \n                            {/* í•©ê³„ (ìë™ê³„ì‚°, ìˆ˜ì • ë¶ˆê°€) */}\n                            <div className=\"text-right min-w-0 flex items-center justify-end\">\n                              <span className={isEditing ? \"modal-subtitle\" : \"modal-value\"}>â‚©{formatCurrency(item.amount_value || 0)}</span>\n                            </div>\n                            \n                            {/* ë¹„ê³  */}\n                            <div className=\"min-w-0 flex justify-center items-center text-center relative overflow-visible\" style={{ width: '150px', maxWidth: '150px', minWidth: '150px' }}>\n                              {isEditing ? (\n                                <Input\n                                  value={item.remark || ''}\n                                  disabled={canEditLimited && !canEditAll}  // lead buyerëŠ” ë¹„ê³  ìˆ˜ì • ë¶ˆê°€\n                                  onChange={(e) => handleItemChange(index, 'remark', e.target.value)}\n                                  onFocus={() => setFocusedInput(`remark_${index}`)}\n                                  onBlur={() => setFocusedInput(null)}\n                                  className={`modal-label border-gray-200 rounded-lg text-center w-full !px-1.5 !py-0.5 !text-[10px] focus:border-blue-400 transition-all duration-200 ${\n                                    focusedInput === `remark_${index}` \n                                      ? '!h-auto !min-h-[20px] !absolute !z-[9999] !bg-white !shadow-lg !left-0 !right-0 !-translate-y-1/2 !top-1/2 !whitespace-normal !text-left' \n                                      : '!h-5 !truncate'\n                                  }`}\n                                  placeholder=\"ë¹„ê³ \"\n                                />\n                              ) : (\n                                <div \n                                  className=\"text-[11px] text-gray-600 font-medium\"\n                                  style={{\n                                    width: '150px',\n                                    maxWidth: '150px',\n                                    minWidth: '150px',\n                                    boxSizing: 'border-box',\n                                    whiteSpace: 'normal',\n                                    wordBreak: 'break-all',\n                                    overflowWrap: 'break-word',\n                                    hyphens: 'none',\n                                    WebkitHyphens: 'none',\n                                    MozHyphens: 'none',\n                                    msHyphens: 'none',\n                                    lineHeight: '1.4',\n                                    maxHeight: '2.8em',\n                                    overflow: 'hidden',\n                                    display: '-webkit-box',\n                                    WebkitLineClamp: 2,\n                                    WebkitBoxOrient: 'vertical'\n                                  }}\n                                  title={item.remark || '-'}\n                                >\n                                  {item.remark || '-'}\n                                </div>\n                              )}\n                            </div>\n                            \n                            {/* ìƒíƒœ/ì•¡ì…˜ - ìŠ¹ì¸ëŒ€ê¸°íƒ­ì—ì„œëŠ” ì œì™¸ */}\n                            {activeTab !== 'pending' && (\n                              <div className=\"text-center flex justify-center items-center\">\n                                {isEditing ? (\n                                  <Button\n                                    size=\"sm\"\n                                    variant=\"ghost\"\n                                    onClick={() => handleRemoveItem(index)}\n                                    className=\"text-red-600 hover:bg-red-50 rounded-lg p-1 h-6 w-6\"\n                                  >\n                                    <Trash2 className=\"w-3 h-3\" />\n                                  </Button>\n                                ) : (\n                                  <>\n                                    {/* êµ¬ë§¤ íƒ­ì—ì„œì˜ êµ¬ë§¤ì™„ë£Œ ìƒíƒœ */}\n                                    {activeTab === 'purchase' && (\n                                    <div className=\"flex justify-center\">\n                                      {canPurchase ? (\n                                        <button\n                                          onClick={() => handlePaymentToggle(item.id, !item.is_payment_completed)}\n                                          className={`${\n                                            item.is_payment_completed\n                                              ? 'button-toggle-active bg-orange-500 hover:bg-orange-600 text-white'\n                                              : 'button-toggle-inactive'\n                                          }`}\n                                        >\n                                          {item.is_payment_completed ? 'êµ¬ë§¤ì™„ë£Œ' : 'êµ¬ë§¤ëŒ€ê¸°'}\n                                        </button>\n                                      ) : (\n                                        <span className={`${\n                                          item.is_payment_completed \n                                            ? 'button-toggle-active bg-orange-500 text-white' \n                                            : 'button-waiting-inactive'\n                                        }`}>\n                                          {item.is_payment_completed ? 'êµ¬ë§¤ì™„ë£Œ' : 'êµ¬ë§¤ëŒ€ê¸°'}\n                                        </span>\n                                      )}\n                                    </div>\n                                  )}\n                                  \n                                  {/* ì…ê³  íƒ­ì—ì„œì˜ ì…ê³ ì™„ë£Œ ìƒíƒœ */}\n                                  {activeTab === 'receipt' && (\n                                    <div className=\"flex justify-center\">\n                                      {canReceiveItems ? (\n                                        actualReceivedAction.isCompleted(item) ? (\n                                          <button\n                                            onClick={() => {\n                                              actualReceivedAction.handleCancel(item.id, {\n                                                item_name: item.item_name,\n                                                specification: item.specification,\n                                                quantity: item.quantity,\n                                                unit_price_value: item.unit_price_value,\n                                                amount_value: item.amount_value,\n                                                remark: item.remark\n                                              })\n                                            }}\n                                            className=\"button-action-primary\"\n                                          >\n                                            {actualReceivedAction.config.completedText}\n                                          </button>\n                                        ) : (\n                                          <DateQuantityPickerPopover\n                                            onConfirm={(date, quantity) => {\n                                              handleItemReceiptToggle(item.id, date, quantity)\n                                            }}\n                                            placeholder=\"ë‚ ì§œì™€ ì‹¤ì œì…ê³ ìˆ˜ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”\"\n                                            align=\"center\"\n                                            side=\"bottom\"\n                                            defaultQuantity={item.received_quantity ?? undefined}\n                                            maxQuantity={item.quantity}\n                                          >\n                                            <button className=\"button-toggle-inactive\">\n                                              {actualReceivedAction.config.waitingText}\n                                            </button>\n                                          </DateQuantityPickerPopover>\n                                        )\n                                      ) : (\n                                        <span className={`${\n                                          actualReceivedAction.isCompleted(item)\n                                            ? 'button-action-primary' \n                                            : 'button-waiting-inactive'\n                                        }`}>\n                                          {actualReceivedAction.isCompleted(item) ? actualReceivedAction.config.completedText : actualReceivedAction.config.waitingText}\n                                        </span>\n                                      )}\n                                    </div>\n                                  )}\n                                  \n                                  {/* ì „ì²´ í•­ëª© íƒ­ì—ì„œëŠ” ì…ê³  ìƒíƒœë§Œ í‘œì‹œ (í´ë¦­ ë¶ˆê°€) */}\n                                  {activeTab === 'done' && (\n                                    <div className=\"flex justify-center\">\n                                      <span className={`button-base ${\n                                        actualReceivedAction.isCompleted(item)\n                                          ? 'bg-green-500 hover:bg-green-600 text-white' \n                                          : 'border border-gray-300 text-gray-600 bg-white hover:bg-gray-50'\n                                      }`}>\n                                        {actualReceivedAction.isCompleted(item) ? 'ì…ê³ ì™„ë£Œ' : 'ì…ê³ ëŒ€ê¸°'}\n                                      </span>\n                                    </div>\n                                  )}\n                                  \n                                  {/* ê¸°íƒ€ íƒ­ì—ì„œëŠ” ê¸°ë³¸ ìƒíƒœ í‘œì‹œ */}\n                                  {activeTab !== 'purchase' && activeTab !== 'receipt' && activeTab !== 'done' && (\n                                    <div className=\"flex justify-center\">\n                                      <span className=\"badge-text\">-</span>\n                                    </div>\n                                  )}\n                                </>\n                              )}\n                              </div>\n                            )}\n                            \n                            {/* ì‹¤ì œ ì…ê³  ë‚ ì§œ - ì…ê³  íƒ­ì—ì„œë§Œ í‘œì‹œ (ìƒíƒœ ì»¬ëŸ¼ ì˜¤ë¥¸ìª½) */}\n                            {activeTab === 'receipt' && (\n                              <div className=\"text-center flex justify-center items-center pl-2\">\n                                {actualReceivedAction.getCompletedDate(item) ? (\n                                  <div className=\"modal-subtitle text-green-700\">\n                                    {new Date(actualReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                                      year: 'numeric',\n                                      month: '2-digit',\n                                      day: '2-digit'\n                                    })}\n                                  </div>\n                                ) : (\n                                  <span className=\"modal-subtitle text-gray-400\">-</span>\n                                )}\n                              </div>\n                            )}\n\n                            {/* ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ - ì „ì²´í•­ëª© íƒ­ì—ì„œë§Œ í‘œì‹œ */}\n                            {activeTab === 'done' && (\n                              <div className=\"text-center flex justify-center items-center\">\n                                {canReceiptCheck ? (\n                                  statementReceivedAction.isCompleted(item) ? (\n                                    <button\n                                      onClick={() => {\n                                        statementReceivedAction.handleCancel(item.id, {\n                                          item_name: item.item_name,\n                                          specification: item.specification,\n                                          quantity: item.quantity,\n                                          unit_price_value: item.unit_price_value,\n                                          amount_value: item.amount_value,\n                                          remark: item.remark\n                                        })\n                                      }}\n                                      className=\"button-action-primary hover:bg-green-600\"\n                                      title=\"í´ë¦­í•˜ì—¬ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ì·¨ì†Œ\"\n                                    >\n                                      {statementReceivedAction.config.completedText}\n                                    </button>\n                                  ) : (\n                                    <DatePickerPopover\n                                      onDateSelect={(date) => {\n                                        statementReceivedAction.handleConfirm(item.id, date, {\n                                          item_name: item.item_name,\n                                          specification: item.specification,\n                                          quantity: item.quantity,\n                                          unit_price_value: item.unit_price_value,\n                                          amount_value: item.amount_value,\n                                          remark: item.remark\n                                        })\n                                      }}\n                                      placeholder=\"íšŒê³„ìƒ ì…ê³ ì¼ì„ ì„ íƒí•˜ì„¸ìš”\"\n                                      align=\"center\"\n                                      side=\"bottom\"\n                                    >\n                                      <button \n                                        className=\"button-toggle-inactive\"\n                                        onClick={() => {}}\n                                      >\n                                        {statementReceivedAction.config.waitingText}\n                                      </button>\n                                    </DatePickerPopover>\n                                  )\n                                ) : (\n                                  <span className={`${\n                                    statementReceivedAction.isCompleted(item)\n                                      ? 'button-action-primary' \n                                      : 'button-waiting-inactive'\n                                  }`}>\n                                    {statementReceivedAction.isCompleted(item) ? statementReceivedAction.config.completedText : statementReceivedAction.config.waitingText}\n                                  </span>\n                                )}\n                              </div>\n                            )}\n\n                            {/* íšŒê³„ìƒ ì…ê³ ì¼ - ì „ì²´í•­ëª© íƒ­ì—ì„œë§Œ í‘œì‹œ */}\n                            {activeTab === 'done' && (\n                              <div className=\"text-center flex justify-center items-center\">\n                                {statementReceivedAction.getCompletedDate(item) ? (\n                                  <div className=\"modal-subtitle text-blue-700\">\n                                    {new Date(statementReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                                      year: 'numeric',\n                                      month: '2-digit',\n                                      day: '2-digit'\n                                    })}\n                                  </div>\n                                ) : (\n                                  <span className=\"modal-subtitle text-gray-400\">-</span>\n                                )}\n                              </div>\n                            )}\n\n                            {/* ì§€ì¶œì •ë³´ - ì „ì²´í•­ëª© íƒ­ì—ì„œë§Œ í‘œì‹œ */}\n                            {activeTab === 'done' && (\n                              <div className=\"text-center flex justify-center items-center\">\n                                {(() => {\n                                  const hasExpenditure = item.expenditure_date && \n                                                        item.expenditure_amount !== null && \n                                                        item.expenditure_amount !== undefined\n                                  \n                                  if (canReceiptCheck) {\n                                    return hasExpenditure ? (\n                                      <div className=\"w-full px-1 leading-none\">\n                                        <div className=\"text-blue-700 text-[9px] leading-[1.1] font-normal\">\n                                          {new Date(item.expenditure_date).toLocaleDateString('ko-KR', {\n                                            year: 'numeric',\n                                            month: '2-digit',\n                                            day: '2-digit'\n                                          })}\n                                        </div>\n                                        <div className=\"text-gray-700 text-[9px] leading-[1.1] font-normal\">\n                                          â‚©{Number(item.expenditure_amount).toLocaleString()}\n                                        </div>\n                                      </div>\n                                    ) : (\n                                      <DateAmountPickerPopover\n                                        onConfirm={(date, amount) => handleItemExpenditure(item.id, date, amount)}\n                                        placeholder=\"ì§€ì¶œ ë‚ ì§œì™€ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”\"\n                                        align=\"center\"\n                                        side=\"bottom\"\n                                      >\n                                        <button className=\"button-toggle-inactive\">\n                                          ì§€ì¶œì…ë ¥\n                                        </button>\n                                      </DateAmountPickerPopover>\n                                    )\n                                  } else {\n                                    return hasExpenditure ? (\n                                      <div className=\"w-full px-1 leading-none\">\n                                        <div className=\"text-blue-700 text-[9px] leading-[1.1] font-normal\">\n                                          {new Date(item.expenditure_date).toLocaleDateString('ko-KR', {\n                                            year: 'numeric',\n                                            month: '2-digit',\n                                            day: '2-digit'\n                                          })}\n                                        </div>\n                                        <div className=\"text-gray-700 text-[9px] leading-[1.1] font-normal\">\n                                          â‚©{Number(item.expenditure_amount).toLocaleString()}\n                                        </div>\n                                      </div>\n                                    ) : (\n                                      <span className=\"modal-subtitle text-gray-400\">-</span>\n                                    )\n                                  }\n                                })()}\n                              </div>\n                            )}\n\n                          </div>\n                          \n                          {/* Mobile Layout */}\n                          <div className=\"block sm:hidden space-y-2\">\n                            <div className=\"flex justify-between items-start\">\n                              <div className=\"flex-1 min-w-0 relative\">\n                                {isEditing ? (\n                                  <Input\n                                    value={item.item_name}\n                                    onChange={(e) => handleItemChange(index, 'item_name', e.target.value)}\n                                    onFocus={() => setFocusedInput(`m_item_name_${index}`)}\n                                    onBlur={() => setFocusedInput(null)}\n                                    className={`modal-label border-gray-200 rounded-lg w-full !px-1.5 !py-0.5 !text-[10px] focus:border-blue-400 transition-all duration-200 ${\n                                      focusedInput === `m_item_name_${index}` \n                                        ? '!h-auto !min-h-[20px] !absolute !z-[9999] !bg-white !shadow-lg !left-0 !right-0 !-translate-y-1/2 !top-1/2 !whitespace-normal' \n                                        : '!h-5 !truncate'\n                                    }`}\n                                    placeholder=\"í’ˆëª©ëª…\"\n                                    disabled={canEditLimited && !canEditAll}  // lead buyerëŠ” í’ˆëª©ëª… ìˆ˜ì • ë¶ˆê°€\n                                  />\n                                ) : (\n                                  <div className=\"modal-value font-medium\">{item.item_name || 'í’ˆëª©ëª… ì—†ìŒ'}</div>\n                                )}\n                                {isEditing ? (\n                                  <Input\n                                    value={item.specification}\n                                    onChange={(e) => handleItemChange(index, 'specification', e.target.value)}\n                                    onFocus={() => setFocusedInput(`m_specification_${index}`)}\n                                    onBlur={() => setFocusedInput(null)}\n                                    className={`modal-label border-gray-200 rounded-lg mt-1 w-full !px-1.5 !py-0.5 !text-[10px] focus:border-blue-400 transition-all duration-200 ${\n                                      focusedInput === `m_specification_${index}` \n                                        ? '!h-auto !min-h-[20px] !absolute !z-[9999] !bg-white !shadow-lg !left-0 !right-0 !-translate-y-1/2 !top-1/2 !whitespace-normal !w-full' \n                                        : '!h-5 !truncate'\n                                    }`}\n                                    placeholder=\"ê·œê²©\"\n                                    disabled={canEditLimited && !canEditAll}  // lead buyerëŠ” ê·œê²© ìˆ˜ì • ë¶ˆê°€\n                                  />\n                                ) : (\n                                  <div className=\"modal-subtitle text-gray-500\">{item.specification || '-'}</div>\n                                )}\n                              </div>\n                              <div className=\"ml-3 text-right flex-shrink-0\">\n                                <div className={`${isEditing ? \"modal-subtitle\" : \"modal-value\"} font-semibold`}>â‚©{formatCurrency(item.amount_value || 0)}</div>\n                              </div>\n                            </div>\n                            \n                            <div className=\"grid grid-cols-3 gap-2 text-sm\">\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">ìˆ˜ëŸ‰:</span>\n                                {isEditing ? (\n                                  <Input\n                                    type=\"number\"\n                                    value={item.quantity}\n                                    onChange={(e) => handleItemChange(index, 'quantity', Number(e.target.value))}\n                                    className=\"border-gray-200 rounded-lg mt-1 w-full !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400\"\n                                    placeholder=\"ìˆ˜ëŸ‰\"\n                                  />\n                                ) : (\n                                  <div className=\"modal-subtitle\">{item.quantity || 0}</div>\n                                )}\n                              </div>\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">ë‹¨ê°€:</span>\n                                {isEditing ? (\n                                  <Input\n                                    type=\"number\"\n                                    value={item.unit_price_value}\n                                    onChange={(e) => handleItemChange(index, 'unit_price_value', Number(e.target.value))}\n                                    className=\"border-gray-200 rounded-lg mt-1 w-full !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400\"\n                                    placeholder=\"ë‹¨ê°€\"\n                                  />\n                                ) : (\n                                  <div className=\"modal-subtitle\">â‚©{formatCurrency(item.unit_price_value)}</div>\n                                )}\n                              </div>\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">ìƒíƒœ:</span>\n                                <div className=\"mt-1\">\n                                  {isEditing ? (\n                                    <Button\n                                      size=\"sm\"\n                                      variant=\"ghost\"\n                                      onClick={() => handleRemoveItem(index)}\n                                      className=\"text-red-600 hover:bg-red-50 rounded-lg p-1 h-6 w-6\"\n                                    >\n                                      <Trash2 className=\"w-3 h-3\" />\n                                    </Button>\n                                  ) : (\n                                    <>\n                                      {activeTab === 'purchase' && (\n                                        <>\n                                          {canPurchase ? (\n                                            <button\n                                              onClick={() => handlePaymentToggle(item.id, !item.is_payment_completed)}\n                                              className={`text-xs px-2 py-1 rounded ${\n                                                item.is_payment_completed\n                                                  ? 'bg-orange-500 text-white hover:bg-orange-600'\n                                                  : 'bg-gray-100 text-gray-600'\n                                              }`}\n                                            >\n                                              {item.is_payment_completed ? 'êµ¬ë§¤ì™„ë£Œ' : 'êµ¬ë§¤ëŒ€ê¸°'}\n                                            </button>\n                                          ) : (\n                                            <span className={`text-xs px-2 py-1 rounded ${\n                                              item.is_payment_completed \n                                                ? 'bg-orange-500 text-white' \n                                                : 'bg-gray-100 text-gray-400'\n                                            }`}>\n                                              {item.is_payment_completed ? 'êµ¬ë§¤ì™„ë£Œ' : 'êµ¬ë§¤ëŒ€ê¸°'}\n                                            </span>\n                                          )}\n                                        </>\n                                      )}\n                                      \n                                      {activeTab === 'receipt' && (\n                                        <>\n                                          {canProcessReceipt ? (\n                                            actualReceivedAction.isCompleted(item) ? (\n                                              <button\n                                                onClick={() => {\n                                                  actualReceivedAction.handleCancel(item.id, {\n                                                    item_name: item.item_name,\n                                                    specification: item.specification,\n                                                    quantity: item.quantity,\n                                                    unit_price_value: item.unit_price_value,\n                                                    amount_value: item.amount_value,\n                                                    remark: item.remark\n                                                  })\n                                                }}\n                                                className=\"text-xs px-2 py-1 rounded button-action-primary\"\n                                              >\n                                                {actualReceivedAction.config.completedText}\n                                              </button>\n                                            ) : (\n                                              <DatePickerPopover\n                                                onDateSelect={(date) => {\n                                                  actualReceivedAction.handleConfirm(item.id, date, {\n                                                    item_name: item.item_name,\n                                                    specification: item.specification,\n                                                    quantity: item.quantity,\n                                                    unit_price_value: item.unit_price_value,\n                                                    amount_value: item.amount_value,\n                                                    remark: item.remark\n                                                  })\n                                                }}\n                                                placeholder=\"ì‹¤ì œ ì…ê³ ëœ ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”\"\n                                                align=\"center\"\n                                                side=\"bottom\"\n                                              >\n                                                <button className=\"text-xs px-2 py-1 rounded bg-gray-100 text-gray-600\">\n                                                  {actualReceivedAction.config.waitingText}\n                                                </button>\n                                              </DatePickerPopover>\n                                            )\n                                          ) : (\n                                            <span className={`text-xs px-2 py-1 rounded ${\n                                              actualReceivedAction.isCompleted(item)\n                                                ? 'button-action-primary' \n                                                : 'bg-gray-100 text-gray-400'\n                                            }`}>\n                                              {actualReceivedAction.isCompleted(item) ? actualReceivedAction.config.completedText : actualReceivedAction.config.waitingText}\n                                            </span>\n                                          )}\n                                        </>\n                                      )}\n                                      \n                                      {activeTab === 'done' && (\n                                        <>\n                                          {/* ì „ì²´ í•­ëª© íƒ­ì—ì„œëŠ” ì…ê³  ìƒíƒœë§Œ í‘œì‹œ (í´ë¦­ ë¶ˆê°€) */}\n                                          <span className={`button-base ${\n                                            actualReceivedAction.isCompleted(item)\n                                              ? 'bg-green-500 text-white' \n                                              : 'border border-gray-300 text-gray-600 bg-white'\n                                          }`}>\n                                            {actualReceivedAction.isCompleted(item) ? 'ì…ê³ ì™„ë£Œ' : 'ì…ê³ ëŒ€ê¸°'}\n                                          </span>\n                                        </>\n                                      )}\n                                      \n                                      {activeTab !== 'purchase' && activeTab !== 'receipt' && activeTab !== 'done' && (\n                                        <span className=\"text-xs text-gray-400\">-</span>\n                                      )}\n                                    </>\n                                  )}\n                                </div>\n                              </div>\n                            </div>\n                            \n                            {(item.remark || isEditing) && (\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">ë¹„ê³ :</span>\n                                {isEditing ? (\n                                  <Input\n                                    value={item.remark || ''}\n                                    onChange={(e) => handleItemChange(index, 'remark', e.target.value)}\n                                    className=\"modal-label border-gray-200 rounded-lg mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                    placeholder=\"ë¹„ê³ \"\n                                  />\n                                ) : (\n                                  <div className=\"modal-subtitle text-gray-500 mt-1\">{item.remark || '-'}</div>\n                                )}\n                              </div>\n                            )}\n                            \n                            {/* ëª¨ë°”ì¼ì—ì„œ ì‹¤ì œ ì…ê³  ë‚ ì§œ í‘œì‹œ */}\n                            {!isEditing && activeTab === 'receipt' && actualReceivedAction.getCompletedDate(item) && (\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">ì‹¤ì œì…ê³ ì¼:</span>\n                                <div className=\"mt-1\">\n                                  <div className=\"modal-subtitle text-green-700\">\n                                    {new Date(actualReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                                      year: 'numeric',\n                                      month: '2-digit',\n                                      day: '2-digit'\n                                    })}\n                                  </div>\n                                  <div className=\"text-[9px] text-gray-500\">\n                                    {new Date(actualReceivedAction.getCompletedDate(item)).toLocaleTimeString('ko-KR', {\n                                      hour: '2-digit',\n                                      minute: '2-digit'\n                                    })}\n                                  </div>\n                                </div>\n                              </div>\n                            )}\n\n                            {/* ëª¨ë°”ì¼ì—ì„œ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ í‘œì‹œ - ì „ì²´í•­ëª© íƒ­ì—ì„œë§Œ */}\n                            {!isEditing && activeTab === 'done' && (\n                              <div className=\"flex items-center justify-between\">\n                                <span className=\"text-gray-500 text-xs\">ê±°ë˜ëª…ì„¸ì„œ í™•ì¸:</span>\n                                <div className=\"flex items-center gap-2\">\n                                  {canReceiptCheck ? (\n                                    statementReceivedAction.isCompleted(item) ? (\n                                      <button\n                                        onClick={() => {\n                                          statementReceivedAction.handleCancel(item.id, {\n                                            item_name: item.item_name,\n                                            specification: item.specification,\n                                            quantity: item.quantity,\n                                            unit_price_value: item.unit_price_value,\n                                            amount_value: item.amount_value,\n                                            remark: item.remark\n                                          })\n                                        }}\n                                        className=\"text-xs px-2 py-1 rounded button-action-primary hover:bg-green-600\"\n                                        title=\"í´ë¦­í•˜ì—¬ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ì·¨ì†Œ\"\n                                      >\n                                        {statementReceivedAction.config.completedText}\n                                      </button>\n                                    ) : (\n                                      <DatePickerPopover\n                                        onDateSelect={(date) => {\n                                          statementReceivedAction.handleConfirm(item.id, date, {\n                                            item_name: item.item_name,\n                                            specification: item.specification,\n                                            quantity: item.quantity,\n                                            unit_price_value: item.unit_price_value,\n                                            amount_value: item.amount_value,\n                                            remark: item.remark\n                                          })\n                                        }}\n                                        placeholder=\"íšŒê³„ìƒ ì…ê³ ì¼ì„ ì„ íƒí•˜ì„¸ìš”\"\n                                        align=\"end\"\n                                        side=\"bottom\"\n                                      >\n                                        <button \n                                          className=\"text-xs px-2 py-1 rounded bg-gray-100 text-gray-600\"\n                                          onClick={() => {}}\n                                        >\n                                          {statementReceivedAction.config.waitingText}\n                                        </button>\n                                      </DatePickerPopover>\n                                    )\n                                  ) : (\n                                    <span className={`text-xs px-2 py-1 rounded ${\n                                      statementReceivedAction.isCompleted(item)\n                                        ? 'button-action-primary' \n                                        : 'bg-gray-100 text-gray-400'\n                                    }`}>\n                                      {statementReceivedAction.isCompleted(item) ? statementReceivedAction.config.completedText : statementReceivedAction.config.waitingText}\n                                    </span>\n                                  )}\n                                </div>\n                              </div>\n                            )}\n\n                            {/* ëª¨ë°”ì¼ì—ì„œ íšŒê³„ìƒ ì…ê³ ì¼ í‘œì‹œ - ì „ì²´í•­ëª© íƒ­ì—ì„œë§Œ */}\n                            {!isEditing && activeTab === 'done' && statementReceivedAction.getCompletedDate(item) && (\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">íšŒê³„ìƒ ì…ê³ ì¼:</span>\n                                <div className=\"mt-1\">\n                                  <div className=\"modal-subtitle text-blue-700\">\n                                    {new Date(statementReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                                      year: 'numeric',\n                                      month: '2-digit',\n                                      day: '2-digit'\n                                    })}\n                                  </div>\n                                </div>\n                              </div>\n                            )}\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                </div>\n                \n                {/* í•©ê³„ */}\n                <div className=\"bg-gray-50 px-2 sm:px-3 border-t border-gray-100\">\n                  <div className=\"hidden sm:grid items-center gap-2 py-0.5 w-fit\" style={{\n                    gridTemplateColumns: getGridTemplateColumns()\n                  }}>\n                    {/* í’ˆëª©ëª… */}\n                    <div></div>\n                    {/* ê·œê²© */}\n                    <div></div>\n                    {/* ìˆ˜ëŸ‰ */}\n                    <div></div>\n                    {/* ë‹¨ê°€ */}\n                    <div className=\"text-right\">\n                      <span className=\"text-[12px] font-bold text-gray-900\">ì´ì•¡</span>\n                    </div>\n                    {/* í•©ê³„ */}\n                    <div className=\"text-right\">\n                      <span className=\"text-[12px] font-bold text-gray-600\">\n                        â‚©{formatCurrency(\n                          (isEditing ? editedItems : currentItems)?.reduce((sum, item) => sum + (item.amount_value || 0), 0) || 0\n                        )}\n                      </span>\n                    </div>\n                    {/* ë‚˜ë¨¸ì§€ ì¹¼ëŸ¼ë“¤ì€ ë¹„ì›Œë‘  */}\n                    <div></div>\n                    {isEditing ? (\n                      <div></div>\n                    ) : (\n                      <div></div>\n                    )}\n                    {activeTab === 'receipt' && <div></div>}\n                    {activeTab === 'done' && (\n                      <>\n                        <div></div>\n                        <div></div>\n                        <div className=\"text-center\">\n                          <div className=\"text-[10px] font-medium text-gray-500 mb-0.5\">ì§€ì¶œ ì´í•©</div>\n                          <div className=\"text-[12px] font-bold text-gray-600\">\n                            â‚©{formatCurrency(\n                              (isEditing ? editedItems : currentItems)?.reduce((sum: number, item: any) => {\n                                return sum + (Number(item.expenditure_amount) || 0)\n                              }, 0) || 0\n                            )}\n                          </div>\n                        </div>\n                      </>\n                    )}\n                  </div>\n                  \n                  {/* Mobile ì´ì•¡ */}\n                  <div className=\"block sm:hidden py-0.5\">\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-[13px] font-bold text-gray-900\">ì´ì•¡</span>\n                      <span className=\"text-[13px] font-bold text-gray-600\">\n                        â‚©{formatCurrency(\n                          (isEditing ? editedItems : currentItems)?.reduce((sum, item) => sum + (item.amount_value || 0), 0) || 0\n                        )}\n                      </span>\n                    </div>\n                    {/* Mobile ì§€ì¶œ ì´í•© - ì „ì²´í•­ëª© íƒ­ì—ì„œë§Œ í‘œì‹œ */}\n                    {activeTab === 'done' && (\n                      <div className=\"flex justify-between items-center mt-1\">\n                        <span className=\"text-[13px] font-bold text-gray-900\">ì§€ì¶œ ì´í•©</span>\n                        <span className=\"text-[13px] font-bold text-gray-600\">\n                          â‚©{formatCurrency(\n                            (isEditing ? editedItems : currentItems)?.reduce((sum: number, item: any) => {\n                              return sum + (Number(item.expenditure_amount) || 0)\n                            }, 0) || 0\n                          )}\n                        </span>\n                      </div>\n                    )}\n                  </div>\n                </div>\n                \n                {/* í•­ëª© ì¶”ê°€ ë²„íŠ¼ */}\n                {isEditing && (\n                  <div className=\"p-2 sm:p-3 border-t border-gray-100\">\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={handleAddItem}\n                      className=\"w-full rounded-lg border-dashed border-2 border-gray-300 hover:border-gray-400 py-2 badge-text\"\n                    >\n                      <Plus className=\"w-4 h-4 mr-1\" />\n                      í•­ëª© ì¶”ê°€\n                    </Button>\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n      ) : (\n        <div className=\"text-center py-12\">\n          <span className=\"modal-subtitle\">\n            ë°œì£¼ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n          </span>\n        </div>\n      )}\n    </div>\n  )\n\n  // embeddedê°€ trueë©´ Dialog ì—†ì´ ë‚´ìš©ë§Œ ë°˜í™˜\n  if (embedded) {\n    return content\n  }\n\n  // embeddedê°€ falseë©´ Dialogë¡œ ê°ì‹¸ì„œ ë°˜í™˜\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent \n        className=\"overflow-hidden bg-white rounded-lg shadow-sm border-0 w-full sm:w-auto max-w-[calc(100vw-48px)] sm:max-w-[calc(100vw-80px)] lg:max-w-[90vw] xl:max-w-[85vw] h-[95vh] sm:h-auto sm:max-h-[90vh] lg:max-h-[85vh] sm:rounded-lg flex flex-col\" \n        showCloseButton={false}\n      >\n        <DialogHeader className=\"sr-only\">\n          <DialogTitle>ë°œì£¼ ìƒì„¸ ì •ë³´</DialogTitle>\n        </DialogHeader>\n        {/* Apple-style Header */}\n        <div className=\"relative px-3 sm:px-6 pt-0 sm:pt-3 lg:pt-4 pb-0 sm:pb-2 lg:pb-3 flex-shrink-0\">\n          <button\n            onClick={onClose}\n            className=\"button-base button-action-secondary absolute right-3 sm:right-6 top-0 sm:top-3 lg:top-4 w-6 h-6 sm:w-8 sm:h-8 rounded-full\"\n          >\n            <X className=\"w-4 h-4 text-gray-500\" />\n          </button>\n          \n          <div className=\"pr-8 sm:pr-16\">\n            <div className=\"flex items-start gap-4 mb-0 sm:mb-3\">\n              <div className=\"min-w-0 flex-1\">\n                <h1 className=\"page-title mb-0 sm:mb-1\">\n                  ë°œì£¼ ê¸°ë³¸ì •ë³´\n                </h1>\n              </div>\n              <div className=\"flex items-center gap-3\">\n                {!isEditing && canEdit && (\n                  <>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => handleEditToggle(true)}\n                      className=\"button-base button-action-secondary\"\n                    >\n                      <Edit2 className=\"w-4 h-4 mr-2\" />\n                      ìˆ˜ì •\n                    </Button>\n                    {canDelete && onDelete && (\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={async () => {\n                          if (purchase) {\n                            try {\n                              await onDelete(purchase);\n                              \n                              // ì‚­ì œ í›„ ëª¨ë‹¬ ë‹«ê¸° ë° ìƒˆë¡œê³ ì¹¨\n                              onClose();\n                              if (onRefresh) {\n                                await onRefresh(true); // ê°•ì œ ìƒˆë¡œê³ ì¹¨\n                              }\n                            } catch (error) {\n                              logger.error('ë°œì£¼ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ', error);\n                              toast.error('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');\n                            }\n                          }\n                        }}\n                        className=\"button-base button-action-danger\"\n                      >\n                        <Trash2 className=\"w-4 h-4 mr-2\" />\n                        ì‚­ì œ\n                      </Button>\n                    )}\n                  </>\n                )}\n                {isEditing && (\n                  <>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => {\n                        handleEditToggle(false)\n                        setEditedPurchase(purchase)\n                        setEditedItems(purchase?.items || [])\n                        setDeletedItemIds([])\n                      }}\n                      className=\"button-base button-action-secondary\"\n                    >\n                      <X className=\"w-4 h-4 mr-2\" />\n                      ì·¨ì†Œ\n                    </Button>\n                    <Button\n                      size=\"sm\"\n                      onClick={handleSave}\n                      className=\"button-base button-action-primary\"\n                    >\n                      <Save className=\"w-4 h-4 mr-2\" />\n                      ì €ì¥\n                    </Button>\n                  </>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Apple-style Content */}\n        <div className=\"overflow-y-auto flex-1 px-3 sm:px-6 pb-1 sm:pb-6 mt-0\">\n          {content}\n        </div>\n      </DialogContent>\n      \n    </Dialog>\n  )\n}\n\nexport default memo(PurchaseDetailModal)"],"names":["DollarSign","createLucideIcon","x1","x2","y1","y2","key","d","Truck","cx","cy","r","DatePickerPopover","children","onDateSelect","disabled","placeholder","align","side","open","setOpen","useState","jsxs","Popover","onOpenChange","jsx","PopoverTrigger","asChild","PopoverContent","className","sideOffset","Calendar","mode","selected","onSelect","date","logger","debug","isToday","Date","toDateString","dateValue","getTime","todayValue","dateString","todayString","handleDateSelect","locale","ko","initialFocus","fromDate","toDate","defaultMonth","modifiers","today","modifiersClassNames","DateAmountPickerPopover","onConfirm","defaultDate","defaultAmount","selectedDate","setSelectedDate","amount","setAmount","toString","Input","type","value","onChange","e","target","replace","numValue","parseInt","toLocaleString","Button","variant","size","onClick","amountNum","parseFloat","isNaN","DateQuantityPickerPopover","defaultQuantity","maxQuantity","hideQuantityInput","quantityInfoText","quantity","setQuantity","min","max","quantityNum","useConfirmDateAction","config","currentUserName","canPerformAction","purchaseId","onUpdate","onOptimisticUpdate","supabase","createClient","handleConfirm","useCallback","async","itemId","itemInfo","receivedQuantity","warn","toast","error","field","numericId","Number","confirmMessage","item_name","specification","unit_price_value","amount_value","remark","confirm","window","updateData","is_statement_received","statement_received_date","toISOString","statement_received_by_name","actual_received_date","is_received","received_quantity","data","from","update","eq","select","info","markItemAsReceived","markItemAsStatementReceived","action","success","successMessage","handleCancel","cancel","itemName","markItemAsReceiptCanceled","markItemAsStatementCanceled","isCompleted","item","getCompletedDate","getCompletedByName","PurchaseDetailModal$1","memo","isOpen","onClose","embedded","currentUserRoles","activeTab","onRefresh","onDelete","allPurchases","lastFetch","usePurchaseMemory","loading","setLoading","purchase","setPurchase","isEditing","setIsEditing","editedPurchase","setEditedPurchase","editedItems","setEditedItems","deletedItemIds","setDeletedItemIds","userRoles","setUserRoles","setCurrentUserName","columnWidths","setColumnWidths","focusedInput","setFocusedInput","currentItems","useMemo","items","length","purchase_request_items","memoryPurchase","find","p","id","columnGap","padding","total","reduce","sum","width","Math","baseColumns","push","headerRowRef","useRef","useEffect","supabaseUrl","includes","user","auth","getUser","employeeData","maybeSingle","email","employeeByEmail","name","purchase_role","roles","Array","isArray","map","String","trim","split","filter","loadUserRoles","effectiveRoles","canEditAll","canEditLimited","canEdit","canDelete","final_manager_status","requester_name","canPurchase","canReceiveItems","isRequester","canReceiptCheck","canProcessReceipt","refreshModalData","findPurchaseInMemory","normalizedItems","purchaseData","is_po_generated","vendor","vendor_id","vendor_name","is_active","vendor_contacts","single","sortedItems","sort","a","b","line_number","vendors","updatedPurchase","isInitialLoad","setIsInitialLoad","purchaseIdNumber","NaN","handleActualReceiptOptimisticUpdate","itemIdStr","nowIso","selectedDateIso","updateItems","received_at","prev","updatedItems","updatedRequestItems","completed","allReceived","updated_at","prevItems","prevPurchase","handleStatementReceivedOptimisticUpdate","nextAllCompleted","nextStatementAt","every","statement_received_at","allCompleted","then","statementReceivedAction","completedText","waitingText","actualReceivedAction","canApproveMiddle","canApproveFinal","approvalButtonClass","approvalWaitingPillClass","loadPurchaseDetail","calculateOptimalColumnWidths","columnConfigs","minWidth","maxWidth","baseWidth","isFixed","calculatedWidths","index","maxLength","headers","quantityHeader","baseHeaders","getHeaders","forEach","cellValue","getStatusDisplay","formatDate","expenditure_date","expenditure_amount","adjustedLength","acc","char","test","ceil","calculatedWidth","is_payment_completed","getGridTemplateColumns","join","hasItems","requestAnimationFrame","handleEditToggle","editing","formatCurrency","Intl","NumberFormat","format","handleItemChange","newItems","unitPrice","handleRemoveItem","_","i","handlePaymentToggle","purchaseItems","requestItems","targetItem","unit","payment_completed_at","markItemAsPaymentCompleted","markItemAsPaymentCanceled","prevRequestItems","payment_completed_by_name","refreshResult","silent","Promise","handleItemReceiptToggle","handleApprove","approvalType","purchase_order_number","middle_manager_status","handleItemExpenditure","totalExpenditure","total_expenditure_amount","markItemAsExpenditureSet","content","payment_category","category","getStatusBadge","request_date","Check","X","FileText","newStatus","is_utk_checked","updatePurchaseInMemory","title","CheckCircle","request_type","delivery_request_date","formatDateInput","revised_delivery_request_date","Building2","contact_name","updatedContacts","project_vendor","project_item","order_number","Package","Fragment","allItems","pendingItems","CreditCard","applyOptimisticUpdate","itemReceivedQuantity","toLocaleDateString","year","month","day","pi","ref","style","gridTemplateColumns","onFocus","onBlur","whiteSpace","wordBreak","overflowWrap","hyphens","WebkitHyphens","MozHyphens","msHyphens","lineHeight","maxHeight","overflow","display","WebkitLineClamp","WebkitBoxOrient","hasReceived","boxSizing","Trash2","hasExpenditure","toLocaleTimeString","hour","minute","newItem","lineNum","Plus","Dialog","DialogContent","showCloseButton","DialogHeader","DialogTitle","Edit2","totalAmount","updateError","total_amount","deleteError","delete","in","Error","unit_price_currency","currency","amount_currency","insertData","purchase_request_id","indexOf","created_at","insert","sourceData","deletedCount","removeItemFromMemory","memoryUpdated","newTotalAmount","itemsCount","finalItems","originalItemsCount","finalItemsCount","deletedItemsCount","errorMessage","message","Save"],"mappings":";;;;;;GASA,MAIMA,EAAaC,EAAiB,cAJjB,CACjB,CAAC,OAAQ,CAAEC,GAAI,KAAMC,GAAI,KAAMC,GAAI,IAAKC,GAAI,KAAMC,IAAK,WACvD,CAAC,OAAQ,CAAEC,EAAG,oDAAqDD,IAAK,aCWpEE,EAAQP,EAAiB,QAbZ,CACjB,CAAC,OAAQ,CAAEM,EAAG,4DAA6DD,IAAK,WAChF,CAAC,OAAQ,CAAEC,EAAG,WAAYD,IAAK,WAC/B,CACE,OACA,CACEC,EAAG,kFACHD,IAAK,WAGT,CAAC,SAAU,CAAEG,GAAI,KAAMC,GAAI,KAAMC,EAAG,IAAKL,IAAK,WAC9C,CAAC,SAAU,CAAEG,GAAI,IAAKC,GAAI,KAAMC,EAAG,IAAKL,IAAK,aCGxC,SAASM,GAAkBC,SAChCA,EAAAC,aACAA,EAAAC,SACAA,GAAW,EAAAC,YACXA,EAAc,YAAAC,MACdA,EAAQ,SAAAC,KACRA,EAAO,WAEP,MAAOC,EAAMC,GAAWC,EAAAA,UAAS,GAmBjC,SACEC,KAACC,EAAA,CAAQJ,OAAYK,aAAcJ,EACjCP,SAAA,CAAAY,EAAAA,IAACC,EAAA,CAAeC,SAAO,EAACZ,WACrBF,aAEHY,EAAAA,IAACG,EAAA,CACCC,UAAU,uCACVZ,QACAC,OACAY,WAAY,EAEZjB,SAAAS,EAAAA,KAAC,MAAA,CAAIO,UAAU,oCACbhB,SAAA,GAAAY,IAAC,MAAA,CAAII,UAAU,YACbhB,SAAAY,EAAAA,IAAC,OAAII,UAAU,wCACZhB,eAGLY,EAAAA,IAACM,EAAA,CACCC,KAAK,SACLC,cAAU,EACVC,SAAWC,IACTC,EAAOC,MAAM,+BAAgC,CAC3CF,OACAG,QAASH,QAAYI,MAAOC,iBAAmBL,EAAKK,eACpDC,UAAWN,GAAMO,UACjBC,YAAA,IAAgBJ,MAAOG,YA1CZ,CAACP,IACxBC,EAAOC,MAAM,4CAA6C,CACxDF,OACAG,QAASH,QAAYI,MAAOC,iBAAmBL,EAAKK,eACpDI,WAAYT,GAAMK,eAClBK,aAAA,IAAiBN,MAAOC,iBAEtBL,GACFC,EAAOC,MAAM,gCACbvB,EAAaqB,GACbf,GAAQ,GACRgB,EAAOC,MAAM,+BAEbD,EAAOC,MAAM,qBA+BLS,CAAiBX,IAEnBY,OAAQC,EACRC,cAAY,EACZpB,UAAU,mBACVd,UAAU,EACVmC,SAAU,IAAIX,KAAK,cACnBY,OAAQ,IAAIZ,KAAK,cACjBa,iBAAkBb,KAClBc,UAAW,CACTC,UAAWf,MAEbgB,oBAAqB,CACnBD,MAAO,6FAOrB,CCvEO,SAASE,GAAwB3C,SACtCA,EAAA4C,UACAA,EAAA1C,SACAA,GAAW,EAAAC,YACXA,EAAc,gBAAAC,MACdA,EAAQ,SAAAC,KACRA,EAAO,SAAAwC,YACPA,EAAAC,cACAA,IAEA,MAAOxC,EAAMC,GAAWC,EAAAA,UAAS,IAC1BuC,EAAcC,GAAmBxC,EAAAA,SAA2BqC,IAC5DI,EAAQC,GAAa1C,EAAAA,SAAiBsC,GAAeK,YAAc,IA6B1E,SACE1C,KAACC,EAAA,CAAQJ,OAAYK,aAAcJ,EACjCP,SAAA,CAAAY,EAAAA,IAACC,EAAA,CAAeC,SAAO,EAACZ,WACrBF,aAEHY,EAAAA,IAACG,EAAA,CACCC,UAAU,uCACVZ,QACAC,OACAY,WAAY,EAEZjB,SAAAS,EAAAA,KAAC,MAAA,CAAIO,UAAU,oCACbhB,SAAA,GAAAY,IAAC,MAAA,CAAII,UAAU,YACbhB,SAAAY,EAAAA,IAAC,OAAII,UAAU,wCACZhB,eAGLY,EAAAA,IAACM,EAAA,CACCC,KAAK,SACLC,SAAU2B,EACV1B,SAAU2B,EACVd,OAAQC,EACRC,cAAY,EACZpB,UAAU,mBACVd,UAAU,EACVmC,SAAU,IAAIX,KAAK,cACnBY,OAAQ,IAAIZ,KAAK,cACjBa,aAAcQ,GAAgB,IAAIrB,KAClCc,UAAW,CACTC,UAAWf,MAEbgB,oBAAqB,CACnBD,MAAO,wFAGXhC,KAAC,MAAA,CAAIO,UAAU,YACbhB,SAAA,CAAAY,EAAAA,IAAC,QAAA,CAAMI,UAAU,+CAA+ChB,SAAA,SAGhEY,EAAAA,IAACwC,EAAA,CACCC,KAAK,OACLC,MAAOL,EACPM,SApDgBC,IAC1B,MAAMF,EAAQE,EAAEC,OAAOH,MAAMI,QAAQ,UAAW,IAChD,GAAIJ,EAAO,CACT,MAAMK,EAAWC,SAASN,EAAO,IACjCJ,EAAUS,EAASE,iBACrB,MACEX,EAAU,KA+CF/C,YAAY,YACZa,UAAU,gBAGdP,KAAC,MAAA,CAAIO,UAAU,8BACbhB,SAAA,CAAAY,EAAAA,IAACkD,EAAA,CACCC,QAAQ,UACRC,KAAK,KACLC,QAAS,IAAM1D,GAAQ,GACxBP,SAAA,OAGDY,EAAAA,IAACkD,EAAA,CACCE,KAAK,KACLC,QApFU,KACpB,IAAKlB,EACH,OAGF,MAAMmB,EAAYC,WAAWlB,EAAOS,QAAQ,KAAM,KAC9CU,MAAMF,IAAcA,GAAa,IAIrCtB,EAAUG,EAAcmB,GACxB3D,GAAQ,GAERyC,EAAgBH,GAChBK,EAAUJ,GAAeK,YAAc,MAuE7BjD,UAAW6C,IAAiBE,GAAUkB,WAAWlB,EAAOS,QAAQ,KAAM,MAAQ,EAC9E1C,UAAU,oCACXhB,SAAA,iBAQb,CC1GO,SAASqE,GAA0BrE,SACxCA,EAAA4C,UACAA,EAAA1C,SACAA,GAAW,EAAAC,YACXA,EAAc,oBAAAC,MACdA,EAAQ,SAAAC,KACRA,EAAO,SAAAwC,YACPA,EAAAyB,gBACAA,EAAAC,YACAA,EAAAC,kBACAA,GAAoB,EAAAC,iBACpBA,EAAmB,2BAEnB,MAAOnE,EAAMC,GAAWC,EAAAA,UAAS,IAC1BuC,EAAcC,GAAmBxC,EAAAA,SAA2BqC,IAC5D6B,EAAUC,GAAenE,EAAAA,SAAiB8D,GAAiBnB,YAAc,IAsChF,SACE1C,KAACC,EAAA,CAAQJ,OAAYK,aAAcJ,EACjCP,SAAA,CAAAY,EAAAA,IAACC,EAAA,CAAeC,SAAO,EAACZ,WACrBF,aAEHY,EAAAA,IAACG,EAAA,CACCC,UAAU,uCACVZ,QACAC,OACAY,WAAY,EAEZjB,SAAAS,EAAAA,KAAC,MAAA,CAAIO,UAAU,oCACbhB,SAAA,GAAAY,IAAC,MAAA,CAAII,UAAU,YACbhB,SAAAY,EAAAA,IAAC,OAAII,UAAU,wCACZhB,eAGJwE,SACE,MAAA,CAAIxD,UAAU,YACbhB,SAAAS,EAAAA,KAAC,MAAA,CAAIO,UAAU,sDACbhB,SAAA,GAAAY,IAAC,OAAIZ,SAAA,kBACLY,IAAC,OAAIZ,SAAA,oBAIXY,EAAAA,IAACM,EAAA,CACCC,KAAK,SACLC,SAAU2B,EACV1B,SAAU2B,EACVd,OAAQC,EACRC,cAAY,EACZpB,UAAU,mBACVd,UAAU,EACVmC,SAAU,IAAIX,KAAK,cACnBY,OAAQ,IAAIZ,KAAK,cACjBa,aAAcQ,GAAgB,IAAIrB,KAClCc,UAAW,CACTC,UAAWf,MAEbgB,oBAAqB,CACnBD,MAAO,uFAGT+B,GACA/D,EAAAA,KAAC,MAAA,CAAIO,UAAU,YACbhB,SAAA,CAAAY,EAAAA,IAAC,QAAA,CAAMI,UAAU,+CAA+ChB,SAAA,WAGhEY,EAAAA,IAACwC,EAAA,CACCC,KAAK,SACLC,MAAOoB,EACPnB,SAxDgBC,IAC5B,MAAMF,EAAQE,EAAEC,OAAOH,MAAMI,QAAQ,UAAW,IAChDiB,EAAYrB,IAuDAnD,YAAY,YACZa,UAAU,iIACV4D,IAAI,IACJC,IAAKN,IAENA,GACC9D,EAAAA,KAAC,IAAA,CAAEO,UAAU,6BAA6BhB,SAAA,CAAA,OAAKuE,EAAYV,yBAIjEpD,KAAC,MAAA,CAAIO,UAAU,8BACbhB,SAAA,CAAAY,EAAAA,IAACkD,EAAA,CACCC,QAAQ,UACRC,KAAK,KACLC,QAAS,IAAM1D,GAAQ,GACvBS,UAAU,cACXhB,SAAA,OAGDY,EAAAA,IAACkD,EAAA,CACCE,KAAK,KACLC,QA7GU,KACpB,IAAKlB,EACH,OAGF,GAAIyB,EAOF,OALA5B,EAAUG,OAAc,GACxBxC,GAAQ,GAERyC,EAAgBH,QAChB8B,EAAYL,GAAiBnB,YAAc,IAI7C,MAAM2B,EAAcX,WAAWO,EAAShB,QAAQ,KAAM,KAClDU,MAAMU,IAAgBA,EAAc,GAIpCP,GAAeO,EAAcP,IAIjC3B,EAAUG,EAAc+B,GACxBvE,GAAQ,GAERyC,EAAgBH,GAChB8B,EAAYL,GAAiBnB,YAAc,MAkFjCjD,UAAW6C,IAAkByB,KAAuBE,GAAYP,WAAWO,EAAShB,QAAQ,KAAM,KAAO,QAAsB,IAAhBa,GAA6BJ,WAAWO,EAAShB,QAAQ,KAAM,KAAOa,GACrLvD,UAAU,oCACXhB,SAAA,iBAQb,CC3HO,SAAS+E,GAAqBC,OACnCA,EAAAC,gBACAA,EAAAC,iBACAA,EAAAC,WACAA,EAAAC,SACAA,EAAAC,mBACAA,IAEA,MAAMC,EAAWC,IAEXC,EAAgBC,EAAAA,YAAYC,MAChCC,EACA5C,EACA6C,EASAC,KAGA,IAAKX,EAGH,OAFA3D,EAAOuE,KAAK,UAAW,CAAEZ,mBAAkBD,yBAC3Cc,EAAMC,OAA0B,uBAAjBhB,EAAOiB,MAAiC,QAAU,MAArD,iBAKd,MAAMC,EAA8B,iBAAXP,EAAsBA,EAASQ,OAAOR,GAE/D,GAAIQ,OAAO/B,MAAM8B,GAGf,OAFA3E,EAAOyE,MAAM,WAAY,CAAEL,SAAQO,mBACnCH,EAAMC,MAAM,sBAKd,GAAIJ,EAAU,CACZ,MAAMQ,EAAiB,QAAQR,EAASS,WAAa,YACrDT,EAASU,eAAiB,YAC1BV,EAASlB,UAAUb,kBAAoB,WACtC+B,EAASW,kBAAkB1C,kBAAoB,WAC/C+B,EAASY,cAAc3C,kBAAoB,UAC5C+B,EAASa,QAAU,UAEvBzB,EAAOoB,eAAeM,UAElB,IAAKC,OAAOD,QAAQN,GAClB,MAEJ,CAEA,IACE,IAAIQ,EAEiB,uBAAjB5B,EAAOiB,MACTW,EAAa,CACXC,uBAAuB,EACvBC,wBAAyB/D,EAAagE,cACtCC,2BAA4B/B,GAEJ,oBAAjBD,EAAOiB,QAChBW,EAAa,CACXK,qBAAsBlE,EAAagE,cACnCG,aAAa,EACbC,uBAAwC,IAArBtB,EAAiCA,OAAoD,IAAhCD,GAAUuB,kBAAkCvB,EAASuB,kBAAoB,OAIrJ5F,EAAOC,MAAM,gBAAiBoF,GAE9B,MAAMQ,KAAEA,EAAApB,MAAMA,SAAgBV,EAC3B+B,KAAK,0BACLC,OAAOV,GACPW,GAAG,KAAMrB,GACTsB,SAIH,GAFAjG,EAAOC,MAAM,iBAAkB,CAAE4F,OAAMpB,UAEnCA,EAEF,MADAzE,EAAOyE,MAAM,eAAgBA,GACvBA,EAMR,GAHAzE,EAAOkG,KAAK,eAAgBL,GAGxBjC,EACF,GAAqB,oBAAjBH,EAAOiB,MAA6B,CAChByB,EAAmBvC,EAAYe,EAAWnD,EAAagE,cAAelB,IAE1FtE,EAAOuE,KAAK,6CAA8C,CACxDX,aACAQ,OAAQO,GAGd,MAAA,GAA4B,uBAAjBlB,EAAOiB,MAAgC,CAC1B0B,EAA4BxC,EAAYe,EAAWnD,EAAagE,cAAe9B,QAAmB,IAEtH1D,EAAOuE,KAAK,iDAAkD,CAC5DX,aACAQ,OAAQO,GAGd,CAGEb,GACFA,EAAmB,CACjBM,OAAQO,EACRnD,eACA6E,OAAQ,UACR/B,sBAAuC,IAArBA,EAAiCA,EAAmBD,GAAUuB,kBAChFvB,aAKAR,GACFA,IAGFW,EAAM8B,QAAQ7C,EAAO8C,eAAepB,QACtC,OAASV,GACPzE,EAAOyE,MAAM,aAAcA,GAC3BD,EAAMC,OAA0B,uBAAjBhB,EAAOiB,MAAiC,QAAU,MAArD,uBACd,GACC,CAACjB,EAAQC,EAAiBC,EAAkBC,EAAYC,EAAUC,EAAoBC,IAEnFyC,EAAetC,EAAAA,YAAYC,MAC/BC,EACAC,KASA,IAAKV,EAGH,OAFA3D,EAAOuE,KAAK,aAAc,CAAEZ,mBAAkBD,yBAC9Cc,EAAMC,OAA0B,uBAAjBhB,EAAOiB,MAAiC,QAAU,MAArD,iBAKd,MAAMC,EAA8B,iBAAXP,EAAsBA,EAASQ,OAAOR,GAE/D,GAAIQ,OAAO/B,MAAM8B,GACfH,EAAMC,MAAM,0BADd,CAMA,GAAIJ,EAAU,CACZ,MAAMQ,EAAiB,QAAQR,EAASS,WAAa,YACrDT,EAASU,eAAiB,YAC1BV,EAASlB,UAAUb,kBAAoB,WACtC+B,EAASW,kBAAkB1C,kBAAoB,WAC/C+B,EAASY,cAAc3C,kBAAoB,UAC5C+B,EAASa,QAAU,UAEvBzB,EAAOoB,eAAe4B,SAElB,IAAKrB,OAAOD,QAAQN,GAClB,MAEJ,CAEA,IAME,IAAIQ,EALJrF,EAAOC,MAAM,MAAMwD,EAAOiB,iBAAkB,CAC1CN,SACAsC,SAAUrC,GAAUS,YAKD,uBAAjBrB,EAAOiB,MACTW,EAAa,CACXC,uBAAuB,EACvBC,wBAAyB,KACzBE,2BAA4B,MAEJ,oBAAjBhC,EAAOiB,QAChBW,EAAa,CACXK,qBAAsB,KACtBC,aAAa,IAIjB3F,EAAOC,MAAM,mBAAoBoF,GAEjC,MAAMQ,KAAEA,EAAApB,MAAMA,SAAgBV,EAC3B+B,KAAK,0BACLC,OAAOV,GACPW,GAAG,KAAMrB,GACTsB,SAIH,GAFAjG,EAAOC,MAAM,oBAAqB,CAAE4F,OAAMpB,UAEtCA,EAEF,MADAzE,EAAOyE,MAAM,eAAgBA,GACvBA,EAMR,GAHAzE,EAAOkG,KAAK,KAAKzC,EAAOiB,iBAAkBmB,GAGtCjC,EACF,GAAqB,oBAAjBH,EAAOiB,MAA6B,CAChBiC,EAA0B/C,EAAYe,IAE1D3E,EAAOuE,KAAK,6CAA8C,CACxDX,aACAQ,OAAQO,GAGd,MAAA,GAA4B,uBAAjBlB,EAAOiB,MAAgC,CAC1BkC,EAA4BhD,EAAYe,IAE5D3E,EAAOuE,KAAK,iDAAkD,CAC5DX,aACAQ,OAAQO,GAGd,CAGEb,GACFA,EAAmB,CACjBM,OAAQO,EACR0B,OAAQ,SACRhC,aAKAR,GACFA,IAGFW,EAAM8B,QAAQ7C,EAAO8C,eAAeE,OACtC,OAAShC,GACPzE,EAAOyE,MAAM,KAAKhB,EAAOiB,iBAAkBD,GAC3CD,EAAMC,OAA0B,uBAAjBhB,EAAOiB,MAAiC,QAAU,MAArD,uBACd,CA9FA,GA+FC,CAACjB,EAAQE,EAAkBC,EAAYC,EAAUC,EAAoBC,IAElE8C,EAAc3C,cAAa4C,GACV,uBAAjBrD,EAAOiB,MACFoC,EAAKxB,sBACc,oBAAjB7B,EAAOiB,OACToC,EAAKnB,YAGb,CAAClC,EAAOiB,QAELqC,EAAmB7C,cAAa4C,GACf,uBAAjBrD,EAAOiB,MACFoC,EAAKvB,wBACc,oBAAjB9B,EAAOiB,MACToC,EAAKpB,qBAEP,KACN,CAACjC,EAAOiB,QAELsC,EAAqB9C,cAAa4C,GACjB,uBAAjBrD,EAAOiB,MACFoC,EAAKrB,4BACHhC,EAAOiB,MAET,MAGR,CAACjB,EAAOiB,QAEX,MAAO,CACLjB,SACAQ,gBACAuC,eACAK,cACAE,mBACAC,qBAEJ,CC6gHA,MAAAC,EAAeC,EAAAA,KA3yHf,UAA6BtD,WAC3BA,EAAAuD,OACAA,EAAAC,QACAA,EAAAC,SACAA,GAAW,EAAAC,iBACXA,EAAmB,GAAAC,UACnBA,EAAAC,UACAA,EAAA1D,mBACAA,EAAA2D,SACAA,IAEA,MAAMC,aAAEA,EAAAC,UAAcA,GAAcC,KAE7BC,EAASC,GAAc7I,EAAAA,UAAS,IAChC8I,EAAUC,IAAe/I,EAAAA,SAA4C,OACrEgJ,GAAWC,IAAgBjJ,EAAAA,UAAS,IACpCkJ,GAAgBC,IAAqBnJ,EAAAA,SAA4C,OACjFoJ,GAAaC,IAAkBrJ,EAAAA,SAAgB,KAC/CsJ,GAAgBC,IAAqBvJ,EAAAA,SAAmB,KACxDwJ,GAAWC,IAAgBzJ,EAAAA,SAAmB,KAC9CyE,GAAiBiF,IAAsB1J,EAAAA,SAAiB,KACxD2J,GAAcC,IAAmB5J,EAAAA,SAAmB,KACpD6J,GAAcC,IAAmB9J,EAAAA,SAAwB,MAK1D+J,GAAeC,EAAAA,QAAQ,KAE3B,GAAIlB,GAAUmB,OAASnB,EAASmB,MAAMC,OAAS,EAC7C,OAAOpB,EAASmB,MAElB,GAAInB,GAAUqB,wBAA0BrB,EAASqB,uBAAuBD,OAAS,EAC/E,OAAOpB,EAASqB,uBAIlB,GAAIxF,GAAc8D,EAAc,CAC9B,MAAM2B,EAAiB3B,EAAa4B,KAAKC,GAAKA,EAAEC,KAAO5F,GACvD,GAAIyF,EACF,OAAQA,EAAeH,OAASG,EAAeH,MAAMC,OAAS,EAAKE,EAAeH,MAASG,EAAeD,wBAA0B,EAExI,CAEA,MAAO,IACN,CAACrB,EAAUnE,EAAY8D,EAAcC,IAElBsB,EAAAA,QAAQ,KAC5B,GAAIL,GAAaO,OAAS,EAAG,CAC3B,MAAMM,EAAYb,GAAaO,OAAS,EAAgC,IAA3BP,GAAaO,OAAS,GAAU,EACvEO,EAAU,GACVC,EAAQf,GAAagB,OAAO,CAACC,EAAKC,IAAUD,EAAMC,EAAO,GAAKL,EAAYC,EAChF,OAAOK,KAAKzG,IAAIqG,EAAO,IACzB,CAEA,MAAMK,EAAwB,CAAC,IAAK,IAAK,GAAI,GAAI,IAAK,IAAK,IAEzC,aAAdzC,GACFyC,EAAYC,KAAK,KAGD,YAAd1C,GAAyC,SAAdA,GAC7ByC,EAAYC,KAAK,KAGD,YAAd1C,GACFyC,EAAYC,KAAK,KAGD,SAAd1C,GACFyC,EAAYC,KAAK,IAAK,GAAI,KAGxBhC,IACF+B,EAAYC,KAAK,KAGnB,MAAMR,EAAYO,EAAYb,OAAS,EAA+B,IAA1Ba,EAAYb,OAAS,GAAU,EACrEQ,EAAQK,EAAYJ,OAAO,CAACC,EAAKC,IAAUD,EAAMC,EAAO,GAAKL,EAAY,GAC/E,OAAOM,KAAKzG,IAAIqG,EAAO,MACtB,CAACf,GAAcrB,EAAWU,KAC7B,MAAMiC,GAAeC,EAAAA,OAAuB,MACtCpG,GAAWC,IAGjBoG,EAAAA,UAAU,KAuDJjD,GAtDkBhD,WACpB,IAEE,MAAMkG,EAAc,2CAGpB,IAAKA,GAAmCA,EAAYC,SAAS,eAE3D,YADAtK,EAAOuE,KAAK,iDAId,MAAQsB,MAAM0E,KAAEA,UAAiBxG,GAASyG,KAAKC,UAC/C,GAAIF,EAAM,CAER,IAAM1E,KAAM6E,SAAuB3G,GAChC+B,KAAK,aACLG,OAAO,KACPD,GAAG,KAAMuE,EAAKf,IACdmB,cAGH,IAAKD,GAAgBH,EAAKK,MAAO,CAC/B,MAAQ/E,KAAMgF,SAA0B9G,GACrC+B,KAAK,aACLG,OAAO,KACPD,GAAG,QAASuE,EAAKK,OACjBD,cAEHD,EAAeG,CACjB,CAOA,GAJIH,GAAcI,MAChBnC,GAAmB+B,EAAaI,MAG9BJ,GAAcK,cAAe,CAC/B,IAAIC,EAAkB,GAEpBA,EADEC,MAAMC,QAAQR,EAAaK,eACrBL,EAAaK,cAAcI,IAAK5M,GAAW6M,OAAO7M,GAAG8M,QAE1CD,OAAOV,EAAaK,eAEpCO,MAAM,KACNH,IAAK5M,GAAcA,EAAE8M,QACrBE,OAAQhN,GAAcA,EAAE4K,OAAS,GAEtCT,GAAasC,EACf,CACF,CACF,OAASvG,GACT,GAIA+G,IAED,CAACrE,IAGJ,MAAMsE,GAAiBR,MAAMC,QAAQ5D,IAAqBA,EAAiB6B,OAAS,EAChF7B,EACAmB,GAIEiD,GAAaD,GAAenB,SAAS,mBACxBmB,GAAenB,SAAS,cACxBmB,GAAenB,SAAS,OAGrCqB,GAAiBF,GAAenB,SAAS,cAGzCsB,GAAUF,IAAcC,GAIxBE,GADgD,aAAnC9D,GAAU+D,qBAEzBJ,GACCA,IAAe3D,GAAUgE,iBAAmBrI,GAG3CsI,GAAcP,GAAenB,SAAS,cACzBmB,GAAenB,SAAS,eACxBmB,GAAenB,SAAS,cAKrC2B,GAAkBR,GAAenB,SAAS,cACxBvC,GAAUgE,iBAAmBrI,GAErC+H,GAAenB,SAAS,mBACxBmB,GAAenB,SAAS,cACxBmB,GAAenB,SAAS,OACxC,MAAM4B,GAAcnE,GAAUgE,iBAAmBrI,GAG3CyI,GAAkBV,GAAenB,SAAS,cACzBmB,GAAenB,SAAS,cAGzC8B,GAAoBX,GAAenB,SAAS,cAAgB4B,GAI5DG,GAAmBnI,EAAAA,YAAYC,UACnC,GAAKP,EAEL,IAEE,MAAMyF,EAAiBiD,EAAqB1I,GAC5C,GAAIyF,EAAgB,CAGlB,MAAMkD,EAAmBlD,EAAeH,OAASG,EAAeH,MAAMC,OAAS,EAC3EE,EAAeH,MACdG,EAAeD,wBAA0B,GAGxCoD,EAAe,IAChBnD,EACHG,GAAI4B,OAAO/B,EAAeG,IAC1BiD,iBAAiB,EACjBvD,MAAOqD,EACPnD,uBAAwBmD,EACxBG,OAAQ,CACNlD,GAAIH,EAAesD,UACnBC,YAAavD,EAAeuD,aAAe,SAC3CC,WAAW,GAEbC,gBAAiB,IAMnB,OAHA9E,GAAYwE,GACZpE,GAAkBoE,QAClBlE,GAAeiE,EAAgBpD,OAAS,EAAIoD,EAAkB,GAEhE,CAGA,MAAMxI,EAAWC,KAEX6B,KAAEA,QAAMpB,SAAgBV,EAC3B+B,KAAK,qBACLG,OAAO,sGAKPD,GAAG,KAAMpC,GACTmJ,SAEH,GAAItI,EAAO,MAAMA,EAEjB,GAAIoB,EAAM,CAER,MAAMmH,GAAenH,EAAKuD,wBAA0B,IAAI6D,KAAK,CAACC,EAAQC,KACtDD,EAAEE,aAAe,SACjBD,EAAEC,aAAe,SAI3BZ,EAAe,IAChB3G,EACHqD,MAAO8D,EACPN,OAAQ7G,EAAKwH,SAAW,CAAE7D,GAAI,EAAGoD,YAAa,UAC9CE,gBAAiB,IAGnB9E,GAAYwE,GACZpE,GAAkBoE,GAClBlE,GAAe0E,EACjB,CACF,OAASvI,GACPzE,EAAOyE,MAAM,iBAAkBA,EACjC,GACC,CAACb,IAGJwG,EAAAA,UAAU,KACR,IAAKxG,IAAe8D,IAAiBK,EAAU,OAE/C,MAAMsB,EAAiB3B,EAAa4B,KAAKC,GAAKA,EAAEC,KAAO5F,GACvD,GAAIyF,EAAgB,CAElB,MAAMkD,EAAmBlD,EAAeH,OAASG,EAAeH,MAAMC,OAAS,EAC3EE,EAAeH,MACdG,EAAeD,wBAA0B,GAExCkE,EAAkB,IACnBvF,KACAsB,EACHG,GAAI4B,OAAO/B,EAAeG,IAC1BN,MAAOqD,EACPnD,uBAAwBmD,GAG1BvE,GAAYsF,GACZlF,GAAkBkF,GAClBhF,GAAeiE,EAAgBpD,OAAS,EAAIoD,EAAkB,GAChE,GACC,CAAC7E,EAAcC,IAGlByC,EAAAA,UAAU,KACR,IAAKjD,IAAWvD,IAAe8D,EAAc,OAE7C,MAAM2B,EAAiB3B,EAAa4B,KAAKC,GAAKA,EAAEC,KAAO5F,GACvD,GAAIyF,EAAgB,CAClB,MAAMkD,EAAmBlD,EAAeH,OAASG,EAAeH,MAAMC,OAAS,EAC3EE,EAAeH,MACdG,EAAeD,wBAA0B,GAExCkE,EAAkB,IACnBjE,EACHG,GAAI4B,OAAO/B,EAAeG,IAC1BiD,iBAAiB,EACjBvD,MAAOqD,EACPnD,uBAAwBmD,EACxBG,OAAQ,CACNlD,GAAIH,EAAesD,UACnBC,YAAavD,EAAeuD,aAAe,SAC3CC,WAAW,GAEbC,gBAAiB,IAGnB9E,GAAYsF,GACZlF,GAAkBkF,GAClBhF,GAAeiE,EAAgBpD,OAAS,EAAIoD,EAAkB,GAChE,GACC,CAACpF,EAAQvD,EAAY8D,IAGxB,MAAO6F,GAAeC,IAAoBvO,EAAAA,UAAS,GAG7CwO,GAAmB7J,EAAagB,OAAOhB,GAAemE,EAAWnD,OAAOmD,EAASyB,IAAMkE,IAEvFC,GAAsCzJ,EAAAA,YAAY,EAAGE,SAAQ5C,eAAc6E,SAAQ/B,uBAevF,MAAMsJ,EAAYxC,OAAOhH,GACnByJ,GAAA,IAAa1N,MAAOqF,cACpBsI,EAAkBtM,EAAeA,EAAagE,mBAAgB,EAE9DuI,EAAe7E,GACdA,EACEA,EAAMiC,IAAIrE,GACXsE,OAAOtE,EAAK0C,MAAQoE,EAAkB9G,EAE3B,YAAXT,EACK,IACFS,EACHnB,aAAa,EACbD,qBAAsBoI,EACtBE,YAAaH,EACbjI,uBAAwC,IAArBtB,EAAiCA,EAAmBwC,EAAKlB,mBAIzE,IACFkB,EACHnB,aAAa,EACbD,0BAAsB,EACtBsI,iBAAa,EACbpI,uBAAmB,IAnBJsD,EAwBrBlB,GAAYiG,IACV,IAAKA,EAAM,OAAOA,EAClB,MAAMC,EAAeH,EAAYE,EAAK/E,QAAU,GAC1CiF,EAAsBJ,EAAYE,EAAK7E,yBAA2B,GAClEO,EAAQuE,EAAa/E,OACrBiF,EAAYF,EAAa3C,OAAOzE,GAAQA,EAAKnB,aAAawD,OAC1DkF,EAAc1E,EAAQ,GAAKyE,IAAczE,EAE/C,MAAO,IACFsE,EACH/E,MAAOgF,EACP9E,uBAAwB+E,EACxBxI,YAAa0I,EACbL,YAAaK,EAAeJ,EAAKD,aAAeH,OAAU,EAC1DS,YAAA,IAAgBnO,MAAOqF,iBAI3B4C,GAAkB6F,IAChB,IAAKA,EAAM,OAAOA,EAClB,MAAMC,EAAeH,EAAYE,EAAK/E,QAAU,GAC1CiF,EAAsBJ,EAAYE,EAAK7E,yBAA2B,GACxE,MAAO,IACF6E,EACH/E,MAAOgF,EACP9E,uBAAwB+E,KAI5B7F,GAAeiG,GACRA,GAAkC,IAArBA,EAAUpF,OACrBoF,EAAUpD,IAAIrE,GACdA,EAAK0C,IAAM4B,OAAOtE,EAAK0C,MAAQoE,EAErB,YAAXvH,EACK,IACFS,EACHnB,aAAa,EACbD,qBAAsBoI,EACtBE,YAAaH,EACbjI,uBAAwC,IAArBtB,EAAiCA,EAAmBwC,EAAKlB,mBAIzE,IACFkB,EACHnB,aAAa,EACbD,0BAAsB,EACtBsI,iBAAa,EACbpI,uBAAmB,GAjBiCkB,GAFPyH,GAwB9C3J,OAAO/B,MAAM4K,KAChB3J,IAAqB2J,GAAkBe,IACrC,MAAMN,EAAeH,EAAYS,EAAatF,QAAUsF,EAAatF,OAAS,GACxEiF,EAAsBJ,EAAYS,EAAapF,yBAA2BoF,EAAapF,wBAA0B,GACjHO,EAAQuE,EAAa/E,QAAUqF,EAAatF,OAAOC,QAAU,EAC7DiF,EAAYF,EAAa3C,OAAOzE,GAAQA,EAAKnB,aAAawD,OAC1DkF,EAAc1E,EAAQ,GAAKyE,IAAczE,EAE/C,MAAO,IACF6E,EACHtF,MAAOgF,EACP9E,uBAAwB+E,EACxBxI,YAAa0I,EACbL,YAAaK,EAAeG,EAAaR,aAAeH,OAAU,EAClES,YAAA,IAAgBnO,MAAOqF,kBAI5B,CAAC1B,EAAoB2J,KAElBgB,GAA0CvK,EAAAA,YAAY,EAAGE,SAAQ5C,eAAc6E,aAanF,MAAMuH,EAAYxC,OAAOhH,GACnB0J,EAAkBtM,EAAeA,EAAagE,mBAAgB,EAEpE,IAAIkJ,GAAmB,EACnBC,EAAiC,KA6HrC,GA3HA3G,GAAYiG,IACV,IAAKA,EAAM,OAAOA,EAElB,MAAMC,GAAgBD,EAAK/E,OAAS,IAAIiC,IAAIrE,GACtCsE,OAAOtE,EAAK0C,MAAQoE,EAAkB9G,EAE3B,YAAXT,EACK,IACFS,EACHxB,uBAAuB,EACvBC,wBAAyBuI,EACzBrI,2BAA4B/B,IAIzB,IACFoD,EACHxB,uBAAuB,EACvBC,wBAAyB,KACzBE,2BAA4B,OAShC,OALAiJ,EAAmBR,EAAa/E,OAAS,GAAK+E,EAAaU,MAAM9H,GAAQA,EAAKxB,uBAC9EqJ,EAAkBD,EACbZ,GAAmBG,EAAKY,wBAAA,IAA6B1O,MAAOqF,cAC7D,KAEG,IACFyI,EACH/E,MAAOgF,EACP5I,sBAAuBoJ,EACvBG,sBAAuBF,KAI3BvG,GAAkB6F,IAChB,IAAKA,EAAM,OAAOA,EAElB,MAAMC,GAAgBD,EAAK/E,OAAS,IAAIiC,IAAIrE,GACtCsE,OAAOtE,EAAK0C,MAAQoE,EAAkB9G,EAE3B,YAAXT,EACK,IACFS,EACHxB,uBAAuB,EACvBC,wBAAyBuI,EACzBrI,2BAA4B/B,IAIzB,IACFoD,EACHxB,uBAAuB,EACvBC,wBAAyB,KACzBE,2BAA4B,OAIhC,MAAO,IACFwI,EACH/E,MAAOgF,EACP5I,sBAAuBoJ,EACvBG,sBAAuBF,KAI3BrG,GAAeiG,GACRA,EACEA,EAAUpD,IAAIrE,GACfsE,OAAOtE,EAAK0C,MAAQoE,EAAkB9G,EAE3B,YAAXT,EACK,IACFS,EACHxB,uBAAuB,EACvBC,wBAAyBuI,EACzBrI,2BAA4B/B,IAIzB,IACFoD,EACHxB,uBAAuB,EACvBC,wBAAyB,KACzBE,2BAA4B,OAjBT8I,GAsBpB3J,OAAO/B,MAAM4K,KAChB3J,IAAqB2J,GAAkBe,IACrC,MAAMN,GAAgBM,EAAatF,OAAS,IAAIiC,IAAIrE,GAC9CsE,OAAOtE,EAAK0C,MAAQoE,EAAkB9G,EAE3B,YAAXT,EACK,IACFS,EACHxB,uBAAuB,EACvBC,wBAAyBuI,EACzBrI,2BAA4B/B,IAIzB,IACFoD,EACHxB,uBAAuB,EACvBC,wBAAyB,KACzBE,2BAA4B,OAI1BqJ,EAAeZ,EAAa/E,OAAS,GAAK+E,EAAaU,MAAM9H,GAAQA,EAAKxB,uBAEhF,MAAO,IACFkJ,EACHtF,MAAOgF,EACP5I,sBAAuBwJ,KAMzB/G,QAAiC,IAArB2G,EAAgC,CAC7B1K,IAEd8B,KAAK,qBACLC,OAAO,CACNT,sBAAuBoJ,EACvBG,sBAAuBF,IAExB3I,GAAG,KAAM+B,EAASyB,IAClBuF,KAAK,EAAGtK,YACHA,GACFzE,EAAOyE,MAAM,qCAAsCA,IAG3D,GACC,CAACf,GAAiBI,EAAoB2J,GAAkB1F,IAErDiH,GAA0BxL,EAAqB,CACnDC,OAAQ,CACNiB,MAAO,qBACPG,eAAgB,CACdM,QAAS,sBACTsB,OAAQ,uBAEVF,eAAgB,CACdpB,QAAS,qBACTsB,OAAQ,sBAEVwI,cAAe,OACfC,YAAa,MAEfxL,mBACAC,iBAAkBwI,GAClBvI,WAAYmE,GAAUyB,GACtB3F,SAAUwI,GACVvI,mBAAoB2K,KAGhBU,GAAuB3L,EAAqB,CAChDC,OAAQ,CACNiB,MAAO,kBACPG,eAAgB,CACdM,QAAS,sBACTsB,OAAQ,uBAEVF,eAAgB,CACdpB,QAAS,qBACTsB,OAAQ,sBAEVwI,cAAe,OACfC,YAAa,QAEfxL,mBACAC,iBAAkByI,GAClBxI,WAAYmE,GAAUyB,GACtB3F,SAAUwI,GACVvI,mBAAoB6J,KAOjByB,GAAmB3D,GAAenB,SAAS,mBACxBmB,GAAenB,SAAS,cACxBmB,GAAenB,SAAS,OAE3C+E,GAAkB5D,GAAenB,SAAS,mBACxBmB,GAAenB,SAAS,cACxBmB,GAAenB,SAAS,OAG1CgF,GAAsB,iHACtBC,GAA2B,8FAGhCnF,EAAAA,UAAU,KACR,GAAIxG,GAAcuD,EAAQ,CAExB,MAAMkC,EAAiBiD,EAAqB1I,GAC5C,GAAIyF,EAAgB,CAElB,MAAMmD,EAAe,IAChBnD,EACHG,GAAI4B,OAAO/B,EAAeG,IAC1BiD,iBAAiB,EACjBC,OAAQ,CACNlD,GAAIH,EAAesD,UACnBC,YAAavD,EAAeuD,aAAe,SAC3CC,WAAW,GAEbC,gBAAiB,IAGnB9E,GAAYwE,GACZpE,GAAkBoE,GAClBlE,GAAee,EAAeH,OAAS,GACzC,MAEEsG,GAAmB5L,EAAWhC,YAEhCsG,IAAa,EACf,GACC,CAACtE,EAAYuD,IAGhB,MAAMsI,GAA+BvL,EAAAA,YAAY,KAE/C,MAAMgF,EAASnB,GAAUmB,OAASnB,EAASmB,MAAMC,OAAS,EACtDpB,EAASmB,MACRnB,GAAUqB,wBAA0BrB,EAASqB,uBAAuBD,OAAS,EAC9EpB,EAASqB,uBACT,GAEJ,GAAqB,IAAjBF,EAAMC,OAAc,MAAO,GAE/B,MAAMuG,EAAgB,CACpB,CAAExR,IAAK,YAAayR,SAAU,GAAIC,SAAU,IAAKC,UAAW,IAC5D,CAAE3R,IAAK,gBAAiByR,SAAU,IAAKC,SAAU,IAAKC,UAAW,IAAKC,SAAS,GAC/E,CAAE5R,IAAK,WAAYyR,SAAU,GAAIC,SAAU,IAAKC,UAAW,IAC3D,CAAE3R,IAAK,aAAcyR,SAAU,GAAIC,SAAU,IAAKC,UAAW,IAC7D,CAAE3R,IAAK,cAAeyR,SAAU,IAAKC,SAAU,IAAKC,UAAW,KAC/D,CAAE3R,IAAK,UAAWyR,SAAU,IAAKC,SAAU,IAAKC,UAAW,IAAKC,SAAS,GACzE,CAAE5R,IAAK,SAAUyR,SAAU,GAAIC,SAAU,IAAKC,UAAW,KAIvC,YAAdtI,GACFmI,EAAczF,KACZ,CAAE/L,IAAK,sBAAuByR,SAAU,IAAKC,SAAU,IAAKC,UAAW,IAAKC,SAAS,IAGvE,SAAdvI,GACFmI,EAAczF,KACZ,CAAE/L,IAAK,sBAAuByR,SAAU,IAAKC,SAAU,IAAKC,UAAW,IAAKC,SAAS,GACrF,CAAE5R,IAAK,kBAAmByR,SAAU,GAAIC,SAAU,GAAIC,UAAW,GAAIC,SAAS,GAC9E,CAAE5R,IAAK,mBAAoByR,SAAU,IAAKC,SAAU,IAAKC,UAAW,IAAKC,SAAS,IAIxF,MAAMC,EAAmBL,EAAcvE,IAAI,CAAC1H,EAAQuM,KAClD,IAAIC,EAAY,EAGhB,MAuBMC,EAvBa,MACjB,MAQMC,EAAgC,YAAd5I,GAAyC,SAAdA,EAC/C,aACA,OACE6I,EAA4B,YAAd7I,EAChB,CAAC,MAAO,KAAM4I,EAAgB,KAAM,KAAM,MAC1C,CAAC,MAAO,KAAMA,EAAgB,KAAM,KAAM,KAbX,aAAd5I,EACjB,OACe,YAAdA,GAAyC,SAAdA,EAC5B,OACA,MAUJ,MAAkB,YAAdA,EACK,IAAI6I,EAAa,SACD,SAAd7I,EACF,IAAI6I,EAAa,WAAY,UAAW,QAE1CA,GAGOC,GA4EhB,GA3EIH,EAAQF,KACVC,EAAYlG,KAAKzG,IAAI2M,EAAWC,EAAQF,GAAO7G,SAIjDD,EAAMoH,QAAQxJ,IACZ,IAAIyJ,EAAY,GAChB,OAAQ9M,EAAOvF,KACb,IAAK,YACHqS,EAAYzJ,EAAKhC,WAAa,GAC9B,MACF,IAAK,gBACHyL,EAAYzJ,EAAK/B,eAAiB,GAClC,MACF,IAAK,WAEH,GAAkB,YAAdwC,GAAyC,SAAdA,EAAsB,CACnD,MAAMpE,EAAW2D,EAAK3D,UAAY,EAC5BmB,EAAmBwC,EAAKlB,mBAAqB,EAGnD2K,EAAYpN,GAAY,KAAOmB,GAAoB,IAC/C,GAAGnB,IACH,GAAGA,KAAYmB,GACrB,MACEiM,EAAYzJ,EAAK3D,UAAUvB,YAAc,GAE3C,MACF,IAAK,aACH2O,EAAqC,MAAzBzJ,EAAK9B,iBAA2B8B,EAAK9B,iBAAiB1C,iBAAmB,GACrF,MACF,IAAK,cAEDiO,EADuB,MAArBzJ,EAAK7B,aACK6B,EAAK7B,aAAa3C,iBACJ,MAAjBwE,EAAK3D,UAA6C,MAAzB2D,EAAK9B,kBAC1BJ,OAAOkC,EAAK3D,UAAYyB,OAAOkC,EAAK9B,mBAAmB1C,iBAExD,GAEd,MACF,IAAK,UACHiO,EAAYzJ,EAAK5B,QAAU,GAC3B,MACF,IAAK,SACHqL,EAAYC,GAAiB1J,IAAS,GACtC,MACF,IAAK,sBACHyJ,EAAYzJ,EAAKpB,qBAAuB+K,EAAW3J,EAAKpB,sBAAwB,GAChF,MACF,IAAK,sBACH6K,EAAYzJ,EAAKxB,sBAAwB,OAAS,MAClD,MACF,IAAK,kBACHiL,EAAYzJ,EAAKvB,wBAA0BkL,EAAW3J,EAAKvB,yBAA2B,GACtF,MACF,IAAK,mBAIDgL,EAFEzJ,EAAK4J,kBAAgD,OAA5B5J,EAAK6J,yBAA2D,IAA5B7J,EAAK6J,mBAExD,gBAEA,OAMlB,MAAMC,EAAiBL,EAAUjF,MAAM,IAAI1B,OAAO,CAACiH,EAAKC,IAC/CD,GAAO,QAAQE,KAAKD,GAAQ,IAAM,GACxC,GAEHb,EAAYlG,KAAKzG,IAAI2M,EAAWlG,KAAKiH,KAAKJ,MAIxCnN,EAAOqM,QACT,OAAOrM,EAAOoM,UAIhB,IAAIoB,EAAkBlH,KAAKzG,IACzBG,EAAOkM,SACP5F,KAAK1G,IAAII,EAAOmM,SAAsB,EAAZK,EAAgB,KAU5C,MANmB,qBAAfxM,EAAOvF,MAGT+S,EAAkB,KAGbA,IAIT,OADApI,GAAgBkH,GACTA,GACN,CAAChI,EAAUR,IAGRiJ,GAAoB1J,GACN,aAAdS,EACKT,EAAKoK,qBAAuB,OAAS,OACrB,YAAd3J,EACFT,EAAKnB,YAAc,KAAO,OAE5BmB,EAAKoK,qBAAuB,OAAS,OAIxCC,GAAyB,KAE7B,GAAIvI,GAAaO,OAAS,EAAG,CAM3B,OALeP,GAAauC,IAAIrB,GAAS,GAAGA,OAK9BsH,KAAK,IACrB,CAIA,IAAIpH,EAAc,CAAC,oBAAqB,QAAS,OAAQ,OAAQ,QAAS,SAU1E,OANEA,EAAYC,KAAK,QAMD,YAAd1C,EACK,IAAIyC,EAAa,SAASoH,KAAK,KACf,SAAd7J,EACF,IAAIyC,EAAa,QAAS,OAAQ,SAASoH,KAAK,KAGlDpH,EAAYoH,KAAK,MAU1BhH,EAAAA,UAAU,KAER,MAAMiH,EAAYtJ,GAAUmB,OAASnB,EAASmB,MAAMC,OAAS,GAC3CpB,GAAUqB,wBAA0BrB,EAASqB,uBAAuBD,OAAS,EAE3FpB,GAAYsJ,IAAapJ,IAE3BqJ,sBAAsB,KACpB7B,QAGH,CAAC1H,EAAUE,GAAWV,EAAWkI,KAGpC,MAAM8B,GAAoBC,IACpBA,IAAYvJ,KAEdG,GAAkBL,GAClBO,GAAeU,IAAgB,IAC/BR,GAAkB,IAElBiH,MAEFvH,GAAasJ,IAGThC,GAAqBrL,MAAOqF,IAChC,IAEE,MAAMH,EAAiBiD,EAAqB9C,GAC5C,GAAIH,EAAgB,CAElB,MAAMmD,EAAe,IAChBnD,EACHG,GAAI4B,OAAO/B,EAAeG,IAC1BiD,iBAAiB,EACjBC,OAAQ,CACNlD,GAAIH,EAAesD,UACnBC,YAAavD,EAAeuD,aAAe,SAC3CC,WAAW,GAEbC,gBAAiB,IAMnB,OAHA9E,GAAYwE,GACZpE,GAAkBoE,QAClBlE,GAAee,EAAeH,OAAS,GAEzC,CAGApB,GAAW,GACX,MAAM/D,EAAWC,KAEX6B,KAAEA,QAAMpB,SAAgBV,EAC3B+B,KAAK,qBACLG,OAAO,sGAKPD,GAAG,KAAMwD,GACTuD,SAEH,GAAItI,EAAO,MAAMA,EAEjB,GAAIoB,EAAM,CAER,MAAMmH,GAAenH,EAAKuD,wBAA0B,IAAI6D,KAAK,CAACC,EAAQC,KACtDD,EAAEE,aAAe,SACjBD,EAAEC,aAAe,SAI3BZ,EAAe,IAChB3G,EACHqD,MAAO8D,EACPN,OAAQ7G,EAAKwH,SAAW,CAAE7D,GAAI,EAAGoD,YAAa,UAC9CE,gBAAiB,IAEnB9E,GAAYwE,GACZpE,GAAkBoE,GAClBlE,GAAe0E,EACjB,CACF,OAASvI,GACPzE,EAAOyE,MAAM,qCAAsCA,GACnDD,EAAMC,MAAM,0BACd,CAAA,QACEqD,GAAW,EACb,GA2BI2J,GAAkB/P,GACf,IAAIgQ,KAAKC,aAAa,SAASC,OAAOlQ,GAyNzCmQ,GAAmB,CAAC7B,EAAetL,EAAe3C,KACtD,MAAM+P,EAAW,IAAIzJ,IAErB,GAAc,aAAV3D,GAAkC,qBAAVA,EAA8B,CAExD,MAAMvB,EAAqB,aAAVuB,EAAuB3C,EAAQ+P,EAAS9B,GAAO7M,SAC1D4O,EAAsB,qBAAVrN,EAA+B3C,EAAQ+P,EAAS9B,GAAOhL,iBACzE8M,EAAS9B,GAAS,IACb8B,EAAS9B,GACZtL,CAACA,GAAQ3C,EACTkD,cAAe9B,GAAY,IAAM4O,GAAa,GAElD,MAEED,EAAS9B,GAAS,IACb8B,EAAS9B,GACZtL,CAACA,GAAQ3C,GAIbuG,GAAewJ,IA8BXE,GAAoBhC,IACxB,MAAMlJ,EAAOuB,GAAY2H,GACrBlJ,EAAK0C,IACPhB,GAAkB,IAAID,GAAgBzB,EAAK0C,KAE7C,MAAMsI,EAAWzJ,GAAYkD,OAAO,CAAC0G,EAAGC,IAAMA,IAAMlC,GAAO/C,KAAK,CAACC,EAAGC,KACpDD,EAAEE,aAAe,SACjBD,EAAEC,aAAe,SAGjC9E,GAAewJ,IAIXK,GAAsBhO,MAAOC,EAAyByC,KAE1D,IAAKmF,GAGH,OAFAhM,EAAOuE,KAAK,8BAA+B,CAAEyH,eAAa1E,0BAC1D9C,EAAMC,MAAM,qBAId,MAAMmJ,EAAYxC,OAAOhH,GACnBO,EAA8B,iBAAXP,EAAsBA,EAASQ,OAAOR,GAG/D,GAAIQ,OAAO/B,MAAM8B,GAGf,OAFA3E,EAAOyE,MAAM,+BAAgC,CAAEL,SAAQO,mBACvDH,EAAMC,MAAM,sBAOd,IAAKsD,EAAU,OAEf,MAAMqK,EAAiBrK,EAASmB,OAASnB,EAASmB,MAAMC,OAAS,EAAKpB,EAASmB,MAAQ,GACjFmJ,EAAgBtK,EAASqB,wBAA0BrB,EAASqB,uBAAuBD,OAAS,EAAKpB,EAASqB,uBAAyB,GAInIkJ,GAHQF,EAAcjJ,OAAS,EAAIiJ,EAAgBC,GAGhC/I,KAAKxC,GAAQsE,OAAOtE,EAAK0C,MAAQoE,GAG1D,IAAK0E,EACH,OAGF,MAAMjO,EAAW,OAAOiO,EAAWxN,kBACjCwN,EAAWvN,eAAiB,cAC5BuN,EAAWnP,UAAUb,kBAAoB,IAAIgQ,EAAWC,MAAQ,YAC/DD,EAAWtN,kBAAkB1C,kBAAoB,WACjDgQ,EAAWrN,cAAc3C,kBAAoB,IAE1CuC,EAAiBgC,EACnB,4BAA4BxC,IAC5B,6BAA6BA,IAIjC,GAFgBe,OAAOD,QAAQN,GAM/B,IAEE,MAAMJ,MAAEA,SAAgBV,GACrB+B,KAAK,0BACLC,OAAO,CACNmL,qBAAsBrK,EACtB2L,qBAAsB3L,GAAA,IAAkB1G,MAAOqF,cAAgB,OAEhEQ,GAAG,KAAMrB,GAEZ,GAAIF,EACF,MAAMA,EAKR,GAAIsD,EAAU,EAEUlB,EAClB4L,EAA2B1K,EAASyB,GAAI7E,GACxC+N,EAA0B3K,EAASyB,GAAI7E,KAGzC3E,EAAOuE,KAAK,0CAA2C,CACrDX,WAAYmE,EAASyB,GACrBpF,OAAQO,EACRkC,eAGN,CA6BA,GA1BAmB,GAAYiG,IACV,IAAKA,EACH,OAAO,KAIT,MAAMM,EAAaN,EAAK/E,OAAS+E,EAAK/E,MAAMC,OAAS,EAAK8E,EAAK/E,MAAQ,GACjEyJ,EAAoB1E,EAAK7E,wBAA0B6E,EAAK7E,uBAAuBD,OAAS,EAAK8E,EAAK7E,uBAAyB,GAE3H8E,GADeK,EAAUpF,OAAS,EAAIoF,EAAYoE,GACtBxH,OAChCC,OAAOtE,EAAK0C,MAAQoE,EAChB,IAAK9G,EAAMoK,qBAAsBrK,EAAa2L,qBAAsB3L,OAAkB1G,MAAOqF,cAAgB,MAC7GsB,GAWN,MANe,IACVmH,EACH/E,MAAO+E,EAAK/E,MAAQgF,EAAeD,EAAK/E,MACxCE,uBAAwB6E,EAAK7E,uBAAyB8E,EAAeD,EAAK7E,0BAM1ErB,EAAU,CACZ,MAAM0F,EAAmB7I,OAAOmD,EAASyB,IACpC5E,OAAO/B,MAAM4K,IAChB3J,IAAqB2J,EAAkBQ,IACrC,MAAMC,GAAgBD,EAAK/E,OAAS,IAAIiC,IAAIrE,GAC1CsE,OAAOtE,EAAK0C,MAAQoE,EAChB,IAAK9G,EAAMoK,qBAAsBrK,GACjCC,GAEA6C,EAAQuE,EAAa/E,QAAU8E,EAAK/E,OAAOC,QAAU,EACrDiF,EAAYF,EAAa3C,OAAOzE,GAAQA,EAAKoK,sBAAsB/H,OACnE2F,EAAenF,EAAQ,GAAKyE,IAAczE,EAChD,MAAO,IACFsE,EACH/E,MAAOgF,EACPgD,qBAAsBpC,EACtB0D,qBAAsB1D,GAAA,IAAmB3O,MAAOqF,cAAgB,KAChEoN,0BAA2B9D,GAAgBpL,IAAqDuK,EAAK2E,4BAI7G,CAEApO,EAAM8B,QAAQO,EAAc,gBAAkB,wBAGxCwF,KACN,MAAMwG,EAAgBrL,KAAY,EAAM,CAAEsL,QAAQ,IAC9CD,aAAyBE,eACrBF,CAEV,OAASpO,GACPD,EAAMC,MAAM,wBACd,GAIIuO,GAA0B7O,MAAOC,EAAyB5C,EAAoB8C,KAClF,IAAK2H,GAEH,YADAzH,EAAMC,MAAM,mBAId,MAAMmJ,EAAYxC,OAAOhH,GACnBO,EAA8B,iBAAXP,EAAsBA,EAASQ,OAAOR,GAE/D,GAAIQ,OAAO/B,MAAM8B,GAEf,YADAH,EAAMC,MAAM,sBAId,MAAMgJ,EAAmB1F,EAAWnD,OAAOmD,EAASyB,IAAMkE,IA6B1D,IACE,MAAMjJ,MAAEA,SAAgBV,GACrB+B,KAAK,0BACLC,OAAO,CACNJ,aAAa,EACbqI,aAAA,IAAiB7N,MAAOqF,cACxBE,qBAAsBlE,EAAagE,cACnCI,uBAAwC,IAArBtB,EAAiCA,EAAmB,OAExE0B,GAAG,KAAMrB,GAEZ,GAAIF,EAAO,MAAMA,EAGjB,GAAIsD,EAAU,CACU5B,EAAmB4B,EAASyB,GAAI7E,EAAWnD,EAAagE,cAAelB,IAE3FtE,EAAOuE,KAAK,kDAAmD,CAC7DX,WAAYmE,EAASyB,GACrBpF,OAAQO,GAGd,CAGAqD,GAAYiG,IACV,IAAKA,EAAM,OAAO,KAClB,MAAMC,EAAeD,EAAK/E,OAAOiC,IAAIrE,GACnCsE,OAAOtE,EAAK0C,MAAQoE,EAChB,IACK9G,EACHnB,aAAa,EACbqI,aAAA,IAAiB7N,MAAOqF,cACxBE,qBAAsBlE,EAAagE,cACnCI,uBAAwC,IAArBtB,EAAiCA,EAAmBwC,EAAKlB,mBAE9EkB,GAEAqH,EAAsBF,EAAK7E,wBAAwB+B,IAAIrE,GAC3DsE,OAAOtE,EAAK0C,MAAQoE,EAChB,IACK9G,EACHnB,aAAa,EACbqI,aAAA,IAAiB7N,MAAOqF,cACxBE,qBAAsBlE,EAAagE,cACnCI,uBAAwC,IAArBtB,EAAiCA,EAAmBwC,EAAKlB,mBAE9EkB,GAEN,MAAO,IACFmH,EACH/E,MAAOgF,EACP9E,uBAAwB+E,EACxBG,YAAA,IAAgBnO,MAAOqF,iBA/EtBZ,OAAO/B,MAAM4K,IAChB3J,IAAqB2J,EAAkBQ,IACrC,MAAMC,GAAgBD,EAAK/E,OAAS,IAAIiC,IAAIrE,GAC1CsE,OAAOtE,EAAK0C,MAAQoE,EAChB,IACK9G,EACHnB,aAAa,EACbD,qBAAsBlE,EAAagE,cACnCI,uBAAwC,IAArBtB,EAAiCA,EAAmBwC,EAAKlB,mBAE9EkB,GAEA6C,EAAQuE,EAAa/E,QAAU8E,EAAK/E,OAAOC,QAAU,EACrDiF,EAAYF,EAAa3C,OAAOzE,GAAQA,EAAKnB,aAAawD,OAC1DkF,EAAc1E,EAAQ,GAAKyE,IAAczE,EAE/C,MAAO,IACFsE,EACH/E,MAAOgF,EACPvI,YAAa0I,EACbL,YAAaK,GAAA,IAAkBlO,MAAOqF,cAAgByI,EAAKD,eAiEjE,MAAMsE,EAAavK,GAAUmB,OAAOI,QAAa8B,OAAOtE,EAAK0C,MAAQoE,GACrEpJ,EAAM8B,QAAQ,IAAIgM,GAAYxN,sCAExBuH,KACN,MAAMwG,EAAgBrL,KAAY,EAAM,CAAEsL,QAAQ,IAC9CD,aAAyBE,eACrBF,CAEV,OAASpO,GACPD,EAAMC,MAAM,wBACd,GA4FIwO,GAAgB9O,MAAOrC,IAC3B,IAAKiG,EAAU,OAEf,MAAMmL,EAAwB,WAATpR,EAAoB,QAAU,QAC7C+C,EAAiB,SAASkD,EAASoL,4BAA4BD,eAErE,GADgB9N,OAAOD,QAAQN,GAG/B,IACE,MAAMQ,EAAsB,WAATvD,EACf,CACEsR,sBAAuB,YAEzB,CACEtH,qBAAsB,aAGtBrH,MAAEA,SAAgBV,GACrB+B,KAAK,qBACLC,OAAOV,GACPW,GAAG,KAAM+B,EAASyB,IAErB,GAAI/E,EACF,MAAMA,EAWR,GANEuD,GADW,WAATlG,EACUmM,GAAQA,EAAO,IAAKA,EAAMmF,sBAAuB,YAAe,KAEhEnF,GAAQA,EAAO,IAAKA,EAAMnC,qBAAsB,YAAe,MAIzE/D,GAAYjE,EAAoB,CAClC,MAAM2J,EAAmB7I,OAAOmD,EAASyB,IACpC5E,OAAO/B,MAAM4K,IAChB3J,EAAmB2J,EAAkBQ,GACtB,WAATnM,EACK,IACFmM,EACHmF,sBAAuB,YAGlB,IACFnF,EACHnC,qBAAsB,YAKhC,CAEAtH,EAAM8B,SAAoB,WAATxE,EAAoB,KAAO,MAA9B,uBAGRuK,KACN,MAAMwG,EAAgBrL,KAAY,EAAM,CAAEsL,QAAQ,IAC9CD,aAAyBE,eACrBF,CAEV,OAASpO,GACPD,EAAMC,MAAM,sBACd,GA2FI4O,GAAwBlP,MAAOC,EAAyBrE,EAAY2B,KACxE,IAAKqG,IAAaoE,GAEhB,YADA3H,EAAMC,MAAM,sBAId,MAAMmJ,EAAYxC,OAAOhH,GACnBO,EAA8B,iBAAXP,EAAsBA,EAASQ,OAAOR,GAE/D,GAAIQ,OAAO/B,MAAM8B,GAEf,YADA3E,EAAOyE,MAAM,iBAAkB,CAAEL,WAInC,MAAMkO,EAAavK,EAASmB,OAAOI,QAAa8B,OAAOtE,EAAK0C,MAAQoE,GACpE,IAAK0E,EAAY,OAEjB,MAAM7E,EAAmB1F,EAAWnD,OAAOmD,EAASyB,IAAMkE,IAmB1D,IAhBO9I,OAAO/B,MAAM4K,IAChB3J,IAAqB2J,EAAkBQ,IACrC,MAAMC,GAAgBD,EAAK/E,OAAS,IAAIiC,IAAIrE,GAC1CsE,OAAOtE,EAAK0C,MAAQoE,EAChB,IACK9G,EACH4J,iBAAkB3Q,EAAKyF,cACvBmL,mBAAoBjP,GAEtBoF,GAEN,MAAO,IAAKmH,EAAM/E,MAAOgF,KAS7BlG,GAAYiG,IACV,IAAKA,EAAM,OAAO,KAClB,MACMC,GADeD,EAAK/E,OAAS+E,EAAK7E,wBAA0B,IAChC+B,IAAIrE,GACpCsE,OAAOtE,EAAK0C,MAAQoE,EAChB,IACK9G,EACH4J,iBAAkB3Q,EAAKyF,cACvBmL,mBAAoBjP,GAEtBoF,GAEAwM,EAAmBpF,EAAatE,OAAO,CAACC,EAAK/C,IAAS+C,GAAO/C,EAAK6J,oBAAsB,GAAI,GAElG,MAAO,IACF1C,EACH/E,MAAOgF,EACP9E,uBAAwB8E,EACxBqF,yBAA0BD,EAC1BhF,YAAA,IAAgBnO,MAAOqF,iBAI3B,MAAMf,MAAEA,SAAgBV,GACrB+B,KAAK,0BACLC,OAAO,CACN2K,iBAAkB3Q,EAAKyF,cACvBmL,mBAAoBjP,IAErBsE,GAAG,KAAMrB,GAEZ,GAAIF,EAEF,MADAzE,EAAOyE,MAAM,mBAAoB,CAAEA,QAAOL,OAAQO,IAC5CF,EAIR,MACM6O,GADmBvL,EAASmB,OAASnB,EAASqB,wBAA0B,IACpCQ,OAAO,CAACC,EAAK/C,IACjDsE,OAAOtE,EAAK0C,MAAQoE,EACf/D,EAAMnI,EAERmI,GAAO/C,EAAK6J,oBAAsB,GACxC,GAQH,SANM5M,GACH+B,KAAK,qBACLC,OAAO,CAAEwN,yBAA0BD,IACnCtN,GAAG,KAAMyH,GAGR1F,GAAUyB,GAAI,CACMgK,EAAyBzL,EAASyB,GAAI7E,EAAW5E,EAAKyF,cAAe9D,IAEzF1B,EAAOuE,KAAK,6CAA8C,CACxDX,WAAYmE,EAASyB,GACrBpF,OAAQO,GAGd,CAEAH,EAAM8B,QAAQ,IAAIgM,EAAWxN,wCAEvBuH,KACN,MAAMwG,EAAgBrL,KAAY,EAAM,CAAEsL,QAAQ,IAC9CD,aAAyBE,eACrBF,CAEV,OAASpO,GACPzE,EAAOyE,MAAM,gBAAiBA,GAC9BD,EAAMC,MAAM,yBACd,GA0bIgP,GACJpU,EAAAA,IAAC,MAAA,CAAII,UAAU,yBACZhB,SAAAoJ,QACE,MAAA,CAAIpI,UAAU,yCACbhB,SAAAY,MAAC,OAAII,UAAU,oEAEfsI,SACD,MAAA,CAECtJ,SAAA,CAAAY,EAAAA,IAAC,OAAII,UAAU,uEACbhB,SAAAS,EAAAA,KAAC,MAAA,CAAIO,UAAU,8DACbhB,SAAA,GAAAS,KAAC,MAAA,CAAIO,UAAU,uEACbhB,SAAA,GAAAS,KAAC,MAAA,CAAIO,UAAU,0BACZhB,SAAA,CAh2CM,MACrB,IAAKsJ,EAAU,OAAO,KAGtB,GAAIA,EAAS2L,iBAAkB,CAC7B,MAAMC,EAAW5L,EAAS2L,iBAAiBrI,OAE3C,MAAiB,OAAbsI,QACM,OAAA,CAAKlU,UAAU,sCAAsChB,SAAA,OACvC,SAAbkV,QACD,OAAA,CAAKlU,UAAU,qCAAqChB,SAAA,SACtC,SAAbkV,QACD,OAAA,CAAKlU,UAAU,qCAAqChB,SAAA,eAGpD,OAAA,CAAKgB,UAAU,qCAAsChB,SAAAkV,GAEjE,CAGA,aAAQ,OAAA,CAAKlU,UAAU,qCAAqChB,SAAA,UA40C7CmV,KACD1U,KAAC,MAAA,CAAIO,UAAU,0BACbhB,SAAA,OAAC,OAAA,CAAKgB,UAAU,cAAchB,SAAA,SAC9BY,EAAAA,IAAC,OAAA,CAAKI,UAAU,cAAehB,WAASsN,yBAG5C7M,KAAC,MAAA,CAAIO,UAAU,0BACbhB,SAAA,GAAAY,IAACM,EAAA,CAASF,UAAU,4BACpBP,KAAC,OAAA,CAAKO,UAAU,iBAAiBhB,SAAA,CAAA,QAAMgS,EAAW1I,EAAS8L,yBAK/D3U,KAAC,MAAA,CAAIO,UAAU,4DAEXhB,SAAA,CACmB2Q,IAAuD,YAAnCrH,EAASqL,uBAGhD/T,EAAAA,IAACkD,EAAA,CACCE,KAAK,KACLD,QAAQ,UACRE,QAAS,IAAMuQ,GAAc,UAC7BxT,UAAW,GAAG6P,4EACf7Q,SAAA,aAIiC,aAAnCsJ,EAASqL,uBACRlU,EAAAA,KAAC,MAAA,CAAIO,UAAU,uCACbhB,SAAA,GAAAY,IAACyU,EAAA,CAAMrU,UAAU,YAAY,aAIG,aAAnCsI,EAASqL,uBACRlU,EAAAA,KAAC,MAAA,CAAIO,UAAU,6BACbhB,SAAA,GAAAY,IAAC0U,EAAA,CAAEtU,UAAU,YAAY,WAIO,YAAnCsI,EAASqL,wBAAwChE,IAChD/P,EAAAA,IAAC,MAAA,CAAII,UAAW,GAAG8P,mDAA0E9Q,SAAA,YAO1E4Q,IAAsD,aAAnCtH,EAASqL,uBAA0E,YAAlCrL,EAAS+D,sBAGhG5M,EAAAA,KAACqD,EAAA,CACCE,KAAK,KACLD,QAAQ,UACRE,QAAS,IAAMuQ,GAAc,SAC7BxT,UAAW,GAAG6P,4EAEd7Q,SAAA,GAAAY,IAACyU,EAAA,CAAMrU,UAAU,YAAY,WAIE,aAAlCsI,EAAS+D,sBACR5M,EAAAA,KAAC,MAAA,CAAIO,UAAU,6BACbhB,SAAA,GAAAY,IAACyU,EAAA,CAAMrU,UAAU,YAAY,aAIE,aAAlCsI,EAAS+D,sBACR5M,EAAAA,KAAC,MAAA,CAAIO,UAAU,6BACbhB,SAAA,GAAAY,IAAC0U,EAAA,CAAEtU,UAAU,YAAY,WAIO,aAAnCsI,EAASqL,uBAA0E,YAAlCrL,EAAS+D,sBACzDzM,EAAAA,IAAC,MAAA,CAAII,UAAW,GAAG8P,mDAA0E9Q,SAAA,qBAOhG,MAAA,CAAA,UAKLS,KAAC,MAAA,CAAIO,UAAU,2CAEbhB,SAAA,GAAAS,KAAC,MAAA,CAAIO,UAAU,2DAGbhB,SAAA,GAAAS,KAAC,MAAA,CAAIO,UAAU,kEACbhB,SAAA,CAAAY,EAAAA,IAAC,OAAII,UAAU,OACbhB,SAAAS,EAAAA,KAAC,MAAA,CAAIO,UAAU,oCACbhB,SAAA,GAAAS,KAAC,KAAA,CAAGO,UAAU,wCACZhB,SAAA,GAAAY,IAAC2U,EAAA,CAASvU,UAAU,+BACnBsI,GAAUoL,uBAAyB,aAErChH,IAAiC,SAAd5E,GAClBrI,EAAAA,KAAC,SAAA,CACCwD,QAASyB,UACP,IAAK4D,EAAU,OACf,MACMkM,IADqBlM,EAASmM,iBAAkB,GAGhDrP,EAAiBoP,EACnB,SAASlM,EAASoL,4CAClB,SAASpL,EAASoL,6CAEtB,GAAK/N,OAAOD,QAAQN,GAEpB,IACE,MAAMd,EAAWC,KACXS,MAAEA,SAAgBV,EACrB+B,KAAK,qBACLC,OAAO,CAAEmO,eAAgBD,IACzBjO,GAAG,KAAM+B,EAASyB,IAErB,GAAI/E,EAGF,OAFAzE,EAAOyE,MAAM,oBAAqB,CAAEA,QAAOb,WAAYmE,EAASyB,UAChEhF,EAAMC,MAAM,2BAKduD,MAAoBiG,EAAO,IACtBA,EACHiG,eAAgBD,EAChB3F,YAAA,IAAgBnO,MAAOqF,eACrB,MAGAuC,EAASyB,IACX2K,EAAuBpM,EAASyB,GAAKyE,IAAA,IAChCA,EACHiG,eAAgBD,KAIpBzP,EAAM8B,QAAQ2N,EAAY,mBAAqB,0BAEzC5H,KACN,MAAMwG,EAAgBrL,KAAY,EAAM,CAAEsL,QAAQ,IAC9CD,aAAyBE,eACrBF,CAEV,OAASpO,GACPzE,EAAOyE,MAAM,iBAAkBA,GAC/BD,EAAMC,MAAM,0BACd,GAEFhF,UAAW,oDACTsI,GAAUmM,eACN,oEACA,0BAENE,MAAOrM,GAAUmM,eAAiB,YAAc,SAEhDzV,SAAA,GAAAY,IAACgV,EAAA,CAAY5U,UAAU,iBAAiB,OACnCsI,GAAUmM,eAAiB,KAAO,eAM/ChV,KAAC,MAAA,CAAIO,UAAU,YACbhB,SAAA,GAAAS,KAAC,MAAA,CAAIO,UAAU,oCACbhB,SAAA,GAAAS,KAAC,MAAA,CAAIO,UAAU,OACbhB,SAAA,OAAC,OAAA,CAAKgB,UAAU,cAAchB,SAAA,WAC7BwJ,GACC5I,EAAAA,IAACwC,EAAA,CACCE,MAAOoG,IAAgBmM,cAAgB,GACvCtS,SAAWC,GAAMmG,MAA0B6F,EAAO,IAAKA,EAAMqG,aAAcrS,EAAEC,OAAOH,OAAU,MAC9FtC,UAAU,6FACVb,YAAY,OAGdS,EAAAA,IAAC,IAAA,CAAEI,UAAU,cAAehB,SAAAsJ,EAASuM,cAAgB,YAGzDpV,KAAC,MAAA,CAAIO,UAAU,OACbhB,SAAA,OAAC,OAAA,CAAKgB,UAAU,cAAchB,SAAA,UAC7BwJ,GACC5I,EAAAA,IAACwC,EAAA,CACCE,MAAOoG,IAAgBuL,kBAAoB,GAC3C1R,SAAWC,GAAMmG,MAA0B6F,EAAO,IAAKA,EAAMyF,iBAAkBzR,EAAEC,OAAOH,OAAU,MAClGtC,UAAU,6FACVb,YAAY,iBAGdS,EAAAA,IAAC,IAAA,CAAEI,UAAU,cAAehB,SAAAsJ,EAAS2L,kBAAoB,cAK/DxU,KAAC,MAAA,CAAIO,UAAU,oCACbhB,SAAA,GAAAS,KAAC,MAAA,CAAIO,UAAU,OACbhB,SAAA,OAAC,OAAA,CAAKgB,UAAU,cAAchB,SAAA,WAC7BwJ,GACC5I,EAAAA,IAACb,EAAA,CACCE,aAAeqB,IACbqI,MAA0B6F,EAAO,IAC5BA,EACHsG,sBAAuBC,EAAgBzU,EAAM,eAC3C,OAENnB,YAAY,gBACZC,MAAM,QACNC,KAAK,SAELL,SAAAS,EAAAA,KAACqD,EAAA,CACCC,QAAQ,UACR/C,UAAU,sGAEVhB,SAAA,GAAAY,IAACM,EAAA,CAASF,UAAU,iBACnB0I,IAAgBoM,sBACf9D,EAAWtI,GAAeoM,uBAC1B,mBAKL,IAAA,CAAE9U,UAAU,iBAAkBhB,SAAAgS,EAAW1I,EAASwM,8BAGvDrV,KAAC,MAAA,CAAIO,UAAU,OACbhB,SAAA,OAAC,OAAA,CAAKgB,UAAU,8BAA8BhB,SAAA,WAC7CwJ,GACC5I,EAAAA,IAACb,EAAA,CACCE,aAAeqB,IACbqI,MAA0B6F,EAAO,IAC5BA,EACHwG,8BAA+BD,EAAgBzU,EAAM,eACnD,OAENnB,YAAY,gBACZC,MAAM,QACNC,KAAK,SAELL,SAAAS,EAAAA,KAACqD,EAAA,CACCC,QAAQ,UACR/C,UAAU,sGAEVhB,SAAA,GAAAY,IAACM,EAAA,CAASF,UAAU,iBACnB0I,IAAgBsM,8BACfhE,EAAWtI,GAAesM,+BAC1B,aAKNpV,EAAAA,IAAC,IAAA,CAAEI,UAAU,iCACVhB,SAAAsJ,EAAS0M,8BAAgChE,EAAW1I,EAAS0M,+BAAiC,sBAS3GvV,KAAC,MAAA,CAAIO,UAAU,kEACbhB,SAAA,GAAAS,KAAC,KAAA,CAAGO,UAAU,6CACZhB,SAAA,GAAAY,IAACqV,EAAA,CAAUjV,UAAU,+BAA+B,aAItDP,KAAC,MAAA,CAAIO,UAAU,YACbhB,SAAA,GAAAS,KAAC,MAAA,CAAIO,UAAU,oCACbhB,SAAA,GAAAS,KAAC,MAAA,CAAIO,UAAU,OACbhB,SAAA,OAAC,OAAA,CAAKgB,UAAU,cAAchB,SAAA,QAC7BwJ,GACC5I,EAAAA,IAACwC,EAAA,CACCE,MAAOoG,IAAgBuE,QAAQE,aAAezE,IAAgByE,aAAe,GAC7E5K,SAAWC,GAAMmG,MAA0B6F,EAAO,IAAKA,EAAMrB,YAAa3K,EAAEC,OAAOH,OAAU,MAC7FtC,UAAU,6FACVb,YAAY,gBAGb,IAAA,CAAEa,UAAU,cAAehB,SAAAsJ,EAAS2E,QAAQE,aAAe,WAGhE1N,KAAC,MAAA,CAAIO,UAAU,OACbhB,SAAA,OAAC,OAAA,CAAKgB,UAAU,cAAchB,SAAA,WAC7BwJ,GACC5I,EAAAA,IAACwC,EAAA,CACCE,MAAOoG,IAAgB2E,kBAAkB,IAAI6H,cAAgB,GAC7D3S,SAAWC,IACTmG,GAAkB6F,IAChB,IAAKA,EAAM,OAAO,KAClB,MACM2G,EAAkB,IADP3G,EAAKnB,iBAAmB,IAOzC,OALI8H,EAAgB,GAClBA,EAAgB,GAAK,IAAKA,EAAgB,GAAID,aAAc1S,EAAEC,OAAOH,OAErE6S,EAAgB,GAAK,CAAED,aAAc1S,EAAEC,OAAOH,OAEzC,IAAKkM,EAAMnB,gBAAiB8H,MAGvCnV,UAAU,6FACVb,YAAY,WAGdS,MAAC,IAAA,CAAEI,UAAU,cAAehB,WAASqO,kBAAkB,IAAI6H,cAAgB,cAKjFzV,KAAC,MAAA,CAAIO,UAAU,oCACbhB,SAAA,GAAAS,KAAC,MAAA,CAAIO,UAAU,OACbhB,SAAA,OAAC,OAAA,CAAKgB,UAAU,cAAchB,SAAA,SAC7BwJ,GACC5I,EAAAA,IAACwC,EAAA,CACCE,MAAOoG,IAAgB0M,gBAAkB,GACzC7S,SAAWC,GAAMmG,MAA0B6F,EAAO,IAAKA,EAAM4G,eAAgB5S,EAAEC,OAAOH,OAAU,MAChGtC,UAAU,6FACVb,YAAY,OAGdS,EAAAA,IAAC,IAAA,CAAEI,UAAU,cAAehB,SAAAsJ,EAAS8M,gBAAkB,WAG3D3V,KAAC,MAAA,CAAIO,UAAU,OACbhB,SAAA,OAAC,OAAA,CAAKgB,UAAU,cAAchB,SAAA,SAC7BwJ,GACC5I,EAAAA,IAACwC,EAAA,CACCE,MAAOoG,IAAgB2M,cAAgB,GACvC9S,SAAWC,GAAMmG,MAA0B6F,EAAO,IAAKA,EAAM6G,aAAc7S,EAAEC,OAAOH,OAAU,MAC9FtC,UAAU,6FACVb,YAAY,OAGdS,EAAAA,IAAC,IAAA,CAAEI,UAAU,iBAAkBhB,SAAAsJ,EAAS+M,cAAgB,kBAK7D,MAAA,CAAIrV,UAAU,oCACbhB,SAAAS,EAAAA,KAAC,MAAA,CAAIO,UAAU,OACbhB,SAAA,OAAC,OAAA,CAAKgB,UAAU,cAAchB,SAAA,SAC7BwJ,GACC5I,EAAAA,IAACwC,EAAA,CACCE,MAAOoG,IAAgB4M,cAAgB,GACvC/S,SAAWC,GAAMmG,MAA0B6F,EAAO,IAAKA,EAAM8G,aAAc9S,EAAEC,OAAOH,OAAU,MAC9FtC,UAAU,6FACVb,YAAY,OAGdS,EAAAA,IAAC,IAAA,CAAEI,UAAU,iBAAkBhB,SAAAsJ,EAASgN,cAAgB,0BAUnE,MAAA,CAAItV,UAAU,gDAEbhB,SAAAS,EAAAA,KAAC,MAAA,CAAIO,UAAU,uDACbhB,SAAA,GAAAS,KAAC,MAAA,CAAIO,UAAU,sIACbhB,SAAA,GAAAS,KAAC,KAAA,CAAGO,UAAU,wCACZhB,SAAA,GAAAY,IAAC2V,EAAA,CAAQvV,UAAU,+BAA+B,WAElDP,KAAC,OAAA,CAAKO,UAAU,0CACbhB,SAAA,CAAAuK,IAAcG,QAAU,EAAE,WAG7BlB,IACA/I,EAAAA,KAAA+V,EAAAA,SAAA,CACGxW,SAAA,CAAc,aAAd8I,GAA4ByE,IAC3B9M,EAAAA,KAACqD,EAAA,CACCE,KAAK,KACLC,QApgCSyB,UAE/B,IAAK4D,IAAaiE,GAChB,OAGF,MAAMnH,EAAiB,SAASkD,EAASoL,6CAEzC,GADgB/N,OAAOD,QAAQN,GAC/B,CAIyBkD,GAAWnD,OAAOmD,EAASyB,IAwBpD,IAEE,MAAM0L,EAAWnN,EAASqB,wBAA0B,GAC9C+L,EAAeD,EAAS3J,OAAOzE,IAASA,EAAKoK,sBAEnD,GAA4B,IAAxBiE,EAAahM,OAEf,YADA3E,EAAM0B,KAAK,wBAIblG,EAAOkG,KAAK,eAAeiP,EAAahM,iBAAiB+L,EAAS/L,cAElE,IAAA,MAAWrC,KAAQqO,EAAc,CAE/B,MAAM9P,EAAa,CACjB6L,sBAAsB,EACtBsB,sBAAA,IAA0BrS,MAAOqF,gBAG7Bf,MAAEA,SAAgBV,GACrB+B,KAAK,0BACLC,OAAOV,GACPW,GAAG,KAAMc,EAAK0C,IAEjB,GAAI/E,EAAO,MAAMA,EAGKgO,EAA2B1K,EAASyB,GAAI1C,EAAK0C,KAEjExJ,EAAOuE,KAAK,kDAAmD,CAC7DX,WAAYmE,EAASyB,GACrBpF,OAAQ0C,EAAK0C,IAGnB,CAEAhF,EAAM8B,QAAQ,GAAG6O,EAAahM,mCAGxBkD,KACN,MAAMwG,EAAgBrL,KAAY,EAAM,CAAEsL,QAAQ,IAC9CD,aAAyBE,eACrBF,CAEV,OAASpO,GACPzE,EAAOyE,MAAM,gBAAiBA,GAC9BD,EAAMC,MAAM,wBACd,CAzEA,GA2/BsBhF,UAAU,2DAEVhB,SAAA,GAAAY,IAAC+V,EAAA,CAAW3V,UAAU,iBAAiB,aAI5B,YAAd8H,GAA2B0E,IAC1B5M,EAAAA,IAACyD,EAAA,CACCzB,UAplBS8C,MAAO3C,EAAoB8C,KAC1D,IAAKyD,IAAakE,GAChB,OAIF,MAAMpH,EAAiB,SAASkD,EAASoL,6CAIzC,IAAK/N,OAAOD,QAAQN,GAClB,OAGF,MAAM4I,EAAmB1F,EAAWnD,OAAOmD,EAASyB,IAAMkE,IAE1D,IAEE,MAAMwH,EAAWnN,EAASqB,wBAA0B,GAC9C+L,EAAeD,EAAS3J,OAAOzE,IAASA,EAAKnB,aAE7C0P,EAAwB,KACvBzQ,OAAO/B,MAAM4K,IAChB3J,IAAqB2J,EAAkBQ,IACrC,MAAMC,GAAgBD,EAAK/E,OAAS,IAAIiC,IAAIrE,GACtBqO,EAAa7L,KAAMC,GAAW6B,OAAO7B,EAAEC,MAAQ4B,OAAOtE,EAAK0C,KAGtE,IACF1C,EACHnB,aAAa,EACbD,qBAAsBoB,EAAKpB,sBAAwBlE,EAAagE,cAChEI,uBAAwC,IAArBtB,EAAiCA,EAAmBwC,EAAK3D,UAGzE2D,GAEHqH,GAAuBF,EAAK7E,wBAA0B,IAAI+B,IAAIrE,GAC9CqO,EAAa7L,KAAMC,GAAW6B,OAAO7B,EAAEC,MAAQ4B,OAAOtE,EAAK0C,KAGtE,IACF1C,EACHnB,aAAa,EACbD,qBAAsBoB,EAAKpB,sBAAwBlE,EAAagE,cAChEI,uBAAwC,IAArBtB,EAAiCA,EAAmBwC,EAAK3D,UAGzE2D,GAGT,MAAO,IACFmH,EACH/E,MAAOgF,EACP9E,uBAAwB+E,EACxBxI,aAAa,EACbqI,aAAA,IAAiB7N,MAAOqF,cACxB8I,YAAA,IAAgBnO,MAAOqF,kBAM/B,GAA4B,IAAxB2P,EAAahM,OAEf,YADA3E,EAAM0B,KAAK,wBAIblG,EAAOkG,KAAK,eAAeiP,EAAahM,iBAAiB+L,EAAS/L,cAGlEkM,IAGArN,GAAYiG,IACV,IAAKA,EAAM,OAAO,KAClB,MAAMC,EAAeD,EAAK/E,OAAOiC,IAAIrE,GACfqO,EAAa7L,KAAKC,GAAK6B,OAAO7B,EAAEC,MAAQ4B,OAAOtE,EAAK0C,KAG/D,IACF1C,EACHnB,aAAa,EACbqI,aAAA,IAAiB7N,MAAOqF,cACxBE,qBAAsBlE,EAAagE,cACnCI,uBAAwC,IAArBtB,EAAiCA,EAAmBwC,EAAK3D,UAGzE2D,IACH,GACAqH,EAAsBF,EAAK7E,wBAAwB+B,IAAIrE,GACvCqO,EAAa7L,KAAKC,GAAK6B,OAAO7B,EAAEC,MAAQ4B,OAAOtE,EAAK0C,KAG/D,IACF1C,EACHnB,aAAa,EACbqI,aAAA,IAAiB7N,MAAOqF,cACxBE,qBAAsBlE,EAAagE,cACnCI,uBAAwC,IAArBtB,EAAiCA,EAAmBwC,EAAK3D,UAGzE2D,IACH,GACA6C,EAAQuE,EAAa/E,OACrBiF,EAAYF,EAAa3C,OAAOzE,GAAQA,EAAKnB,aAAawD,OAC1DkF,EAAc1E,EAAQ,GAAKyE,IAAczE,EAE/C,MAAO,IACFsE,EACH/E,MAAOgF,EACP9E,uBAAwB+E,EACxBxI,YAAa0I,EACbL,YAAaK,GAAA,IAAkBlO,MAAOqF,cAAgByI,EAAKD,YAC3DM,YAAA,IAAgBnO,MAAOqF,iBAI3B,IAAA,MAAWsB,KAAQqO,EAAc,CAG/B,MAAM9P,EAAa,CACjBK,qBAAsBlE,EAAagE,cACnCG,aAAa,EACbC,uBAAwC,IAArBtB,EAAiCA,EAAmBwC,EAAK3D,WAGxEsB,MAAEA,SAAgBV,GACrB+B,KAAK,0BACLC,OAAOV,GACPW,GAAG,KAAMc,EAAK0C,IAEjB,GAAI/E,EAAO,MAAMA,EAIjB,MAAM6Q,OAA4C,IAArBhR,EAAiCA,EAAmBwC,EAAK3D,SAChEgD,EAAmB4B,EAASyB,GAAI1C,EAAK0C,GAAIhI,EAAagE,cAAe8P,IAEzFtV,EAAOuE,KAAK,kDAAmD,CAC7DX,WAAYmE,EAASyB,GACrBpF,OAAQ0C,EAAK0C,IAGnB,CAEAhF,EAAM8B,QAAQ,GAAG6O,EAAahM,mCAGxBkD,KACN,MAAMwG,EAAgBrL,KAAY,EAAM,CAAEsL,QAAQ,IAC9CD,aAAyBE,eACrBF,CAEV,OAASpO,GACPzE,EAAOyE,MAAM,gBAAiBA,GAC9BD,EAAMC,MAAM,wBACd,GAwbsB7F,YAAY,aACZC,MAAM,MACNC,KAAK,SACLmE,mBAAmB,EACnBC,iBAAiB,yBAEjBzE,SAAAS,EAAAA,KAACqD,EAAA,CACCE,KAAK,KACLhD,UAAU,oCAEVhB,SAAA,GAAAY,IAACjB,EAAA,CAAMqB,UAAU,iBAAiB,eAKzB,SAAd8H,GAAwB4E,IACvBjN,EAAAA,KAAC,MAAA,CAAIO,UAAU,0BACbhB,SAAA,CAAAY,EAAAA,IAACb,EAAA,CACCE,aA7sBSyF,MAAO3C,IACxC,IAAKuG,IAAaoE,GAChB,OAGoB3K,EAAa+T,mBAAmB,QAAS,CAC7DC,KAAM,UACNC,MAAO,UACPC,IAAK,YAGP,MAAM7Q,EAAiB,SAASkD,EAASoL,iDAIzC,IAAK/N,OAAOD,QAAQN,GAClB,OAGF,MAAMiJ,EAAkBtM,EAAagE,cACZuC,GAAWnD,OAAOmD,EAASyB,IA8BpD,IAEE,MAAM0L,EAAWnN,EAASqB,wBAA0B,GAC9C+L,EAAeD,EAAS3J,OAAOzE,IAASA,EAAKxB,uBAEnD,GAA4B,IAAxB6P,EAAahM,OAEf,YADA3E,EAAM0B,KAAK,6BAIblG,EAAOkG,KAAK,mBAAmBiP,EAAahM,iBAAiB+L,EAAS/L,cAEtE,IAAA,MAAWrC,KAAQqO,EAAc,CAE/B,MAAM9P,EAAa,CACjBC,uBAAuB,EACvBC,wBAAyBuI,EACzBrI,2BAA4B/B,IAAmB,OAG3Ce,MAAEA,SAAgBV,GACrB+B,KAAK,0BACLC,OAAOV,GACPW,GAAG,KAAMc,EAAK0C,IAEjB,GAAI/E,EAAO,MAAMA,EAGK2B,EAA4B2B,EAASyB,GAAI1C,EAAK0C,GAAIsE,EAAiBpK,SAAmB,IAE1G1D,EAAOuE,KAAK,sDAAuD,CACjEX,WAAYmE,EAASyB,GACrBpF,OAAQ0C,EAAK0C,IAGnB,CAEAhF,EAAM8B,QAAQ,GAAG6O,EAAahM,wCAGxBkD,KACN,MAAMwG,EAAgBrL,KAAY,EAAM,CAAEsL,QAAQ,IAC9CD,aAAyBE,eACrBF,CAEV,OAASpO,GACPzE,EAAOyE,MAAM,oBAAqBA,GAClCD,EAAMC,MAAM,4BACd,GA4mBwB7F,YAAY,oBACZC,MAAM,MACNC,KAAK,SAELL,SAAAS,EAAAA,KAACqD,EAAA,CACCE,KAAK,KACLhD,UAAU,oCAEVhB,SAAA,GAAAY,IAAC2U,EAAA,CAASvU,UAAU,iBAAiB,gBAIzCJ,EAAAA,IAAC+B,EAAA,CACCC,UAp2BI8C,MAAOpE,EAAY2B,KAC/C,IAAKqG,IAAaoE,GAEhB,YADA3H,EAAMC,MAAM,sBAId,MAAMI,EAAiB,SAASkD,EAASoL,qDAAqDpT,EAAKwV,mBAAmB,iBAAiB7T,EAAOY,oBAE9I,IAAK8C,OAAOD,QAAQN,GAClB,OAGF,MAAM4I,EAAmB1F,EAAWnD,OAAOmD,EAASyB,IAAMkE,IAoB1D,IAjBO9I,OAAO/B,MAAM4K,IAChB3J,IAAqB2J,EAAkBQ,IACrC,MAAMC,GAAgBD,EAAK/E,OAAS,IAAIiC,IAAIrE,GAE1CA,EAAK4J,kBAAoB5J,EAAK6J,mBAC1B7J,EACA,IACKA,EACH4J,iBAAkB3Q,EAAKyF,cACvBmL,mBAAoBjP,IAG5B,MAAO,IAAKuM,EAAM/E,MAAOgF,KAS7B,MAAMgH,EAAWnN,EAASmB,OAASnB,EAASqB,wBAA0B,GAChE+L,EAAeD,EAAS3J,OAAOzE,IAASA,EAAK4J,mBAAqB5J,EAAK6J,oBAE7E,GAA4B,IAAxBwE,EAAahM,OAEf,YADA3E,EAAM0B,KAAK,+BAKb8B,GAAYiG,IACV,IAAKA,EAAM,OAAO,KAClB,MACMC,GADWD,EAAK/E,OAAS+E,EAAK7E,wBAA0B,IAChC+B,IAAIrE,GAEhCA,EAAK4J,kBAAoB5J,EAAK6J,mBAC1B7J,EACA,IACKA,EACH4J,iBAAkB3Q,EAAKyF,cACvBmL,mBAAoBjP,IAGtB4R,EAAmBpF,EAAatE,OAAO,CAACC,EAAK/C,IAAS+C,GAAO/C,EAAK6J,oBAAsB,GAAI,GAElG,MAAO,IACF1C,EACH/E,MAAOgF,EACP9E,uBAAwB8E,EACxBqF,yBAA0BD,EAC1BhF,YAAA,IAAgBnO,MAAOqF,iBAI3B,IAAA,MAAWsB,KAAQqO,EAAc,CAC/B,MAAM1Q,MAAEA,SAAgBV,GACrB+B,KAAK,0BACLC,OAAO,CACN2K,iBAAkB3Q,EAAKyF,cACvBmL,mBAAoBjP,IAErBsE,GAAG,KAAMc,EAAK0C,IAEjB,GAAI/E,EAEF,MADAzE,EAAOyE,MAAM,sBAAuB,CAAEA,QAAOL,OAAQ0C,EAAK0C,KACpD/E,CAEV,CAGA,MAAM6O,EAAmB4B,EAAStL,OAAO,CAACC,EAAK/C,IACzCqO,EAAa7L,KAAKqM,GAAMA,EAAGnM,KAAO1C,EAAK0C,IAClCK,EAAMnI,EAERmI,GAAO/C,EAAK6J,oBAAsB,GACxC,SAEG5M,GACH+B,KAAK,qBACLC,OAAO,CAAEwN,yBAA0BD,IACnCtN,GAAG,KAAMyH,GAGZ,IAAA,MAAW3G,KAAQqO,EAAc,CACT3B,EAAyBzL,EAASyB,GAAI1C,EAAK0C,GAAIzJ,EAAKyF,cAAe9D,IAEvF1B,EAAOuE,KAAK,gDAAiD,CAC3DX,WAAYmE,EAASyB,GACrBpF,OAAQ0C,EAAK0C,IAGnB,CAGA,MAAMH,EAAiBiD,EAAqBvE,EAASyB,IACrD,GAAIH,EAAgB,CAClB,MAAMkD,EAAmBlD,EAAeH,OAASG,EAAeH,MAAMC,OAAS,EAC3EE,EAAeH,MACdG,EAAeD,wBAA0B,GACxCkK,EAAmB/G,EAAgB3C,OAAO,CAACC,EAAK/C,IAAS+C,GAAO/C,EAAK6J,oBAAsB,GAAI,GACrG3I,GAAYiG,IAAA,IACPA,EACH/E,MAAOqD,EACPnD,uBAAwBmD,EACxBgH,yBAA0BD,IAE9B,CAEA9O,EAAM8B,QAAQ,GAAG6O,EAAahM,wCAExBkD,KACN,MAAMwG,EAAgBrL,KAAY,EAAM,CAAEsL,QAAQ,IAC9CD,aAAyBE,eACrBF,CAEV,OAASpO,GACPzE,EAAOyE,MAAM,mBAAoBA,GACjCD,EAAMC,MAAM,4BACd,GAguBwB7F,YAAY,sBACZC,MAAM,MACNC,KAAK,SAELL,SAAAS,EAAAA,KAACqD,EAAA,CACCE,KAAK,KACLhD,UAAU,oCAEVhB,SAAA,GAAAY,IAACzB,EAAA,CAAW6B,UAAU,iBAAiB,uBAWrDJ,IAAC,OAAII,UAAU,gEACbhB,eAAC,MAAA,CAAIgB,UAAU,oCAAoChB,SAAA,6BAIpD,MAAA,CAAIgB,UAAU,6CACbhB,SAAAS,EAAAA,KAAC,MAAA,CAAIO,UAAU,QAEbhB,SAAA,GAAAY,IAAC,MAAA,CAAII,UAAU,gFACbhB,SAAAS,EAAAA,KAAC,MAAA,CACC0W,IAAK1L,GACJzK,UAAU,yCACXoW,MAAO,CACLC,oBAAqB3E,MAGvB1S,SAAA,GAAAY,IAAC,OAAIZ,SAAA,UACLY,IAAC,OAAIZ,SAAA,aACJ,MAAA,CAAIgB,UAAU,cACXhB,SAAc,YAAd8I,GAAyC,SAAdA,GAA0BU,GAMrD,OALA/I,EAAAA,KAAC,MAAA,CAAIO,UAAU,2CACbhB,SAAA,OAAC,MAAA,CAAIgB,UAAU,aAAahB,SAAA,gBAC3B,MAAA,CAAIgB,UAAU,cAAchB,SAAA,oBAMlC,MAAA,CAAIgB,UAAU,aAAahB,SAAA,aAC3B,MAAA,CAAIgB,UAAU,aAAahB,SAAA,aAC3B,MAAA,CAAIgB,UAAU,cAAchB,SAAA,OAC5BwJ,GACC/I,EAAAA,KAAA+V,WAAA,CACExW,SAAA,OAAC,MAAA,CAAIgB,UAAU,cAAchB,SAAA,OACd,YAAd8I,GACClI,EAAAA,IAAA4V,EAAAA,SAAA,CACExW,SAAAY,EAAAA,IAAC,OAAII,UAAU,cAAchB,qBAGlB,SAAd8I,GACCrI,EAAAA,KAAA+V,EAAAA,SAAA,CACExW,SAAA,OAAC,MAAA,CAAIgB,UAAU,cAAchB,SAAA,mBAC5B,MAAA,CAAIgB,UAAU,cAAchB,SAAA,kBAC5B,MAAA,CAAIgB,UAAU,cAAchB,SAAA,eAKnCS,EAAAA,KAAA+V,EAAAA,SAAA,CACExW,SAAA,GAAAY,IAAC,MAAA,CAAII,UAAU,cACZhB,SAAc,aAAd8I,EACG,OACe,YAAdA,GAAyC,SAAdA,EAC5B,OACA,OAES,SAAdA,GACCrI,EAAAA,KAAA+V,EAAAA,SAAA,CACExW,SAAA,OAAC,MAAA,CAAIgB,UAAU,cAAchB,SAAA,mBAC5B,MAAA,CAAIgB,UAAU,cAAchB,SAAA,kBAC5B,MAAA,CAAIgB,UAAU,cAAchB,SAAA,YAGlB,YAAd8I,GACClI,EAAAA,IAAA4V,EAAAA,SAAA,CACExW,SAAAY,EAAAA,IAAC,OAAII,UAAU,cAAchB,mCAOxC,MAAA,CAAIgB,UAAU,kDACXhB,aAAY4J,GAAcW,KAAemC,IAAI,CAACrE,EAAMkJ,IACpD9Q,EAAAA,KAAC,MAAA,CAAgBO,UAAU,0FAEzBhB,SAAA,GAAAS,KAAC,MAAA,CAAIO,UAAW,2DAA4DoW,MAAO,CACjFC,oBAAqB3E,MAGrB1S,SAAA,OAAC,MAAA,CAAIgB,UAAU,sDACZhB,SAAAwJ,GACC5I,EAAAA,IAACwC,EAAA,CACCE,MAAO+E,EAAKhC,UACZ9C,SAAWC,GAAM4P,GAAiB7B,EAAO,YAAa/N,EAAEC,OAAOH,OAC/DgU,QAAS,IAAMhN,GAAgB,aAAaiH,KAC5CgG,OAAQ,IAAMjN,GAAgB,MAC9BtJ,UAAW,iIACTqJ,KAAiB,aAAakH,IAC1B,gIACA,kBAENpR,YAAY,MACZD,SAAUgN,KAAmBD,KAG/BrM,EAAAA,IAAC,MAAA,CACCI,UAAU,cACVoW,MAAO,CACLI,WAAY,SACZC,UAAW,YACXC,aAAc,aACdC,QAAS,OACTC,cAAe,OACfC,WAAY,OACZC,UAAW,OACXC,WAAY,MACZC,UAAW,QACXC,SAAU,SACVC,QAAS,cACTC,gBAAiB,EACjBC,gBAAiB,YAEnBzC,MAAOtN,EAAKhC,WAAa,SAExBrG,WAAKqG,WAAa,eAMzBzF,IAAC,MAAA,CAAII,UAAU,sDAAsDoW,MAAO,CAAE/L,MAAO,QAAS8F,SAAU,QAASD,SAAU,SACxHlR,SAAAwJ,GACC5I,EAAAA,IAACwC,EAAA,CACCE,MAAO+E,EAAK/B,cACZ/C,SAAWC,GAAM4P,GAAiB7B,EAAO,gBAAiB/N,EAAEC,OAAOH,OACnEgU,QAAS,IAAMhN,GAAgB,iBAAiBiH,KAChDgG,OAAQ,IAAMjN,GAAgB,MAC9BtJ,UAAW,iIACTqJ,KAAiB,iBAAiBkH,IAC9B,sJACA,kBAENpR,YAAY,KACZD,SAAUgN,KAAmBD,KAG/BrM,EAAAA,IAAC,MAAA,CACCI,UAAU,wCACVoW,MAAO,CACLI,WAAY,SACZC,UAAW,YACXC,aAAc,aACdC,QAAS,OACTC,cAAe,OACfC,WAAY,OACZC,UAAW,OACXC,WAAY,MACZC,UAAW,QACXC,SAAU,SACVC,QAAS,cACTC,gBAAiB,EACjBC,gBAAiB,YAEnBzC,MAAOtN,EAAK/B,eAAiB,IAE5BtG,WAAKsG,eAAiB,cAM5B,MAAA,CAAItF,UAAU,uDACZhB,SAAAwJ,GACgB,YAAdV,GAAyC,SAAdA,EAC1BrI,OAAC,MAAA,CAAIO,UAAU,4CACbhB,SAAA,CAAAY,EAAAA,IAACwC,EAAA,CACCC,KAAK,SACLC,MAAO+E,EAAK3D,SACZnB,SAAWC,GAAM4P,GAAiB7B,EAAO,WAAYpL,OAAO3C,EAAEC,OAAOH,QACrEtC,UAAU,iIACVb,YAAY,OACZ0E,IAAI,YAENpE,KAAC,MAAA,CAAIO,UAAU,mCACbhB,SAAA,OAAC,OAAA,CAAKgB,UAAU,2BAA2BhB,SAAA,MAC3CY,EAAAA,IAACwC,EAAA,CACCC,KAAK,SACLC,MAAO+E,EAAKlB,mBAAqB,GACjC5D,SAAWC,GAAM4P,GAAiB7B,EAAO,oBAAqB/N,EAAEC,OAAOH,MAAQ6C,OAAO3C,EAAEC,OAAOH,OAAS,MACxGtC,UAAU,iIACVb,YAAY,OACZ0E,IAAI,gBAKVjE,EAAAA,IAACwC,EAAA,CACCC,KAAK,SACLC,MAAO+E,EAAK3D,SACZnB,SAAWC,GAAM4P,GAAiB7B,EAAO,WAAYpL,OAAO3C,EAAEC,OAAOH,QACrEtC,UAAU,iIACVb,YAAY,KACZ0E,IAAI,UAIO,YAAdiE,GAAyC,SAAdA,QAExB,MAAMpE,EAAW2D,EAAK3D,UAAY,EAC5BmB,EAAmBwC,EAAKlB,mBAAqB,EAE7CkR,EAAcxS,EAAmB,EAEvC,OAHmBnB,GAAY,KAAOmB,GAAoB,MAKtDpF,KAAC,MAAA,CAAIO,UAAU,2CACbhB,SAAA,CAAAY,EAAAA,IAAC,OAAII,UAAW,mBAAkBqX,EAAc,gBAAkB,IAAOrY,SAAA0E,WACxE,MAAA,CAAI1D,UAAW,mBAAkBqX,EAAc,GAAK,iBAAmBrY,SAAA,CAAA,IAAE6F,UAK5EpF,KAAC,OAAA,CAAKO,UAAU,iBACdhB,SAAA,CAAAY,MAAC,OAAA,CAAKI,UAAWqX,EAAc,gBAAkB,GAAKrY,SAAA0E,WACrD,OAAA,CAAK1D,UAAWqX,EAAc,GAAK,gBAAiBrY,SAAA,CAAA,IAAE6F,OAI/D,KAEAjF,EAAAA,IAAC,OAAA,CAAKI,UAAU,iBAAkBhB,SAAAqI,EAAK3D,UAAY,YAMxD,MAAA,CAAI1D,UAAU,mDACZhB,SAAAwJ,GACC5I,EAAAA,IAACwC,EAAA,CACCC,KAAK,SACLC,MAAO+E,EAAK9B,iBACZhD,SAAWC,GAAM4P,GAAiB7B,EAAO,mBAAoBpL,OAAO3C,EAAEC,OAAOH,QAC7EtC,UAAU,gIACVb,YAAY,KACZ0E,IAAI,iBAGNpE,EAAAA,KAAC,OAAA,CAAKO,UAAU,iBAAiBhB,SAAA,CAAA,IAAEgT,GAAe3K,EAAK9B,uBAK3D3F,EAAAA,IAAC,OAAII,UAAU,mDACbhB,gBAAC,OAAA,CAAKgB,UAAWwI,GAAY,iBAAmB,cAAexJ,SAAA,CAAA,IAAEgT,GAAe3K,EAAK7B,cAAgB,UAIvG5F,IAAC,MAAA,CAAII,UAAU,iFAAiFoW,MAAO,CAAE/L,MAAO,QAAS8F,SAAU,QAASD,SAAU,SACnJlR,SAAAwJ,GACC5I,EAAAA,IAACwC,EAAA,CACCE,MAAO+E,EAAK5B,QAAU,GACtBvG,SAAUgN,KAAmBD,GAC7B1J,SAAWC,GAAM4P,GAAiB7B,EAAO,SAAU/N,EAAEC,OAAOH,OAC5DgU,QAAS,IAAMhN,GAAgB,UAAUiH,KACzCgG,OAAQ,IAAMjN,GAAgB,MAC9BtJ,UAAW,6IACTqJ,KAAiB,UAAUkH,IACvB,2IACA,kBAENpR,YAAY,OAGdS,EAAAA,IAAC,MAAA,CACCI,UAAU,wCACVoW,MAAO,CACL/L,MAAO,QACP8F,SAAU,QACVD,SAAU,QACVoH,UAAW,aACXd,WAAY,SACZC,UAAW,YACXC,aAAc,aACdC,QAAS,OACTC,cAAe,OACfC,WAAY,OACZC,UAAW,OACXC,WAAY,MACZC,UAAW,QACXC,SAAU,SACVC,QAAS,cACTC,gBAAiB,EACjBC,gBAAiB,YAEnBzC,MAAOtN,EAAK5B,QAAU,IAErBzG,WAAKyG,QAAU,QAMP,YAAdqC,GACClI,EAAAA,IAAC,MAAA,CAAII,UAAU,+CACZhB,SAAAwJ,GACC5I,EAAAA,IAACkD,EAAA,CACCE,KAAK,KACLD,QAAQ,QACRE,QAAS,IAAMsP,GAAiBhC,GAChCvQ,UAAU,sDAEVhB,SAAAY,EAAAA,IAAC2X,EAAA,CAAOvX,UAAU,cAGpBP,EAAAA,KAAA+V,WAAA,CAEGxW,SAAA,CAAc,aAAd8I,GACDlI,EAAAA,IAAC,MAAA,CAAII,UAAU,sBACZhB,SAAAuN,GACC3M,EAAAA,IAAC,SAAA,CACCqD,QAAS,IAAMyP,GAAoBrL,EAAK0C,IAAK1C,EAAKoK,sBAClDzR,UAAW,IACTqH,EAAKoK,qBACD,oEACA,0BAGLzS,SAAAqI,EAAKoK,qBAAuB,OAAS,SAGxC7R,EAAAA,IAAC,OAAA,CAAKI,UAAW,IACfqH,EAAKoK,qBACD,gDACA,2BAEHzS,SAAAqI,EAAKoK,qBAAuB,OAAS,WAO/B,YAAd3J,GACClI,EAAAA,IAAC,MAAA,CAAII,UAAU,sBACZhB,SAAAwN,GACCkD,GAAqBtI,YAAYC,GAC/BzH,EAAAA,IAAC,SAAA,CACCqD,QAAS,KACPyM,GAAqB3I,aAAaM,EAAK0C,GAAI,CACzC1E,UAAWgC,EAAKhC,UAChBC,cAAe+B,EAAK/B,cACpB5B,SAAU2D,EAAK3D,SACf6B,iBAAkB8B,EAAK9B,iBACvBC,aAAc6B,EAAK7B,aACnBC,OAAQ4B,EAAK5B,UAGjBzF,UAAU,wBAEThB,YAAqBgF,OAAOwL,gBAG/B5P,EAAAA,IAACyD,EAAA,CACCzB,UAAW,CAACtB,EAAMoD,KAChB6P,GAAwBlM,EAAK0C,GAAIzJ,EAAMoD,IAEzCvE,YAAY,oBACZC,MAAM,SACNC,KAAK,SACLiE,gBAAiB+D,EAAKlB,wBAAqB,EAC3C5C,YAAa8D,EAAK3D,SAElB1E,eAAC,SAAA,CAAOgB,UAAU,yBACfhB,SAAA0Q,GAAqB1L,OAAOyL,sBAKlC,OAAA,CAAKzP,UAAW,IACf0P,GAAqBtI,YAAYC,GAC7B,wBACA,2BAEHrI,SAAA0Q,GAAqBtI,YAAYC,GAAQqI,GAAqB1L,OAAOwL,cAAgBE,GAAqB1L,OAAOyL,gBAO3G,SAAd3H,GACClI,EAAAA,IAAC,MAAA,CAAII,UAAU,sBACbhB,SAAAY,EAAAA,IAAC,OAAA,CAAKI,UAAW,gBACf0P,GAAqBtI,YAAYC,GAC7B,6CACA,kEAEHrI,SAAA0Q,GAAqBtI,YAAYC,GAAQ,OAAS,WAM1C,aAAdS,GAA0C,YAAdA,GAAyC,SAAdA,GACtDlI,EAAAA,IAAC,MAAA,CAAII,UAAU,sBACbhB,SAAAY,EAAAA,IAAC,OAAA,CAAKI,UAAU,aAAahB,sBASxB,YAAd8I,GACClI,MAAC,MAAA,CAAII,UAAU,oDACZhB,SAAA0Q,GAAqBpI,iBAAiBD,GACrCzH,EAAAA,IAAC,OAAII,UAAU,gCACZhB,aAAI0B,KAAKgP,GAAqBpI,iBAAiBD,IAAOyO,mBAAmB,QAAS,CACjFC,KAAM,UACNC,MAAO,UACPC,IAAK,gBAITrW,IAAC,QAAKI,UAAU,+BAA+BhB,iBAMtC,SAAd8I,GACClI,EAAAA,IAAC,MAAA,CAAII,UAAU,+CACZhB,SAAA0N,GACC6C,GAAwBnI,YAAYC,GAClCzH,EAAAA,IAAC,SAAA,CACCqD,QAAS,KACPsM,GAAwBxI,aAAaM,EAAK0C,GAAI,CAC5C1E,UAAWgC,EAAKhC,UAChBC,cAAe+B,EAAK/B,cACpB5B,SAAU2D,EAAK3D,SACf6B,iBAAkB8B,EAAK9B,iBACvBC,aAAc6B,EAAK7B,aACnBC,OAAQ4B,EAAK5B,UAGjBzF,UAAU,2CACV2U,MAAM,mBAEL3V,YAAwBgF,OAAOwL,gBAGlC5P,EAAAA,IAACb,EAAA,CACCE,aAAeqB,IACbiP,GAAwB/K,cAAc6C,EAAK0C,GAAIzJ,EAAM,CACnD+E,UAAWgC,EAAKhC,UAChBC,cAAe+B,EAAK/B,cACpB5B,SAAU2D,EAAK3D,SACf6B,iBAAkB8B,EAAK9B,iBACvBC,aAAc6B,EAAK7B,aACnBC,OAAQ4B,EAAK5B,UAGjBtG,YAAY,iBACZC,MAAM,SACNC,KAAK,SAELL,SAAAY,EAAAA,IAAC,SAAA,CACCI,UAAU,yBACViD,QAAS,OAERjE,YAAwBgF,OAAOyL,sBAKrC,OAAA,CAAKzP,UAAW,IACfuP,GAAwBnI,YAAYC,GAChC,wBACA,2BAEHrI,SAAAuQ,GAAwBnI,YAAYC,GAAQkI,GAAwBvL,OAAOwL,cAAgBD,GAAwBvL,OAAOyL,gBAOpH,SAAd3H,GACClI,MAAC,MAAA,CAAII,UAAU,+CACZhB,SAAAuQ,GAAwBjI,iBAAiBD,GACxCzH,EAAAA,IAAC,OAAII,UAAU,+BACZhB,aAAI0B,KAAK6O,GAAwBjI,iBAAiBD,IAAOyO,mBAAmB,QAAS,CACpFC,KAAM,UACNC,MAAO,UACPC,IAAK,gBAITrW,IAAC,QAAKI,UAAU,+BAA+BhB,iBAMtC,SAAd8I,GACClI,EAAAA,IAAC,MAAA,CAAII,UAAU,+CACXhB,SAAA,MACA,MAAMwY,EAAiBnQ,EAAK4J,kBACsB,OAA5B5J,EAAK6J,yBACuB,IAA5B7J,EAAK6J,mBAE3B,OAAIxE,GACK8K,EACL/X,EAAAA,KAAC,MAAA,CAAIO,UAAU,2BACbhB,SAAA,CAAAY,EAAAA,IAAC,MAAA,CAAII,UAAU,qDACZhB,SAAA,IAAI0B,KAAK2G,EAAK4J,kBAAkB6E,mBAAmB,QAAS,CAC3DC,KAAM,UACNC,MAAO,UACPC,IAAK,gBAGTxW,KAAC,MAAA,CAAIO,UAAU,qDAAqDhB,SAAA,CAAA,IAChEmG,OAAOkC,EAAK6J,oBAAoBrO,uBAItCjD,EAAAA,IAAC+B,EAAA,CACCC,UAAW,CAACtB,EAAM2B,IAAW2R,GAAsBvM,EAAK0C,GAAIzJ,EAAM2B,GAClE9C,YAAY,mBACZC,MAAM,SACNC,KAAK,SAELL,eAAC,SAAA,CAAOgB,UAAU,yBAAyBhB,SAAA,WAMxCwY,EACL/X,EAAAA,KAAC,MAAA,CAAIO,UAAU,2BACbhB,SAAA,CAAAY,EAAAA,IAAC,MAAA,CAAII,UAAU,qDACZhB,SAAA,IAAI0B,KAAK2G,EAAK4J,kBAAkB6E,mBAAmB,QAAS,CAC3DC,KAAM,UACNC,MAAO,UACPC,IAAK,gBAGTxW,KAAC,MAAA,CAAIO,UAAU,qDAAqDhB,SAAA,CAAA,IAChEmG,OAAOkC,EAAK6J,oBAAoBrO,uBAItCjD,EAAAA,IAAC,OAAA,CAAKI,UAAU,+BAA+BhB,SAAA,KAGrD,EAjDE,UAwDRS,KAAC,MAAA,CAAIO,UAAU,4BACbhB,SAAA,GAAAS,KAAC,MAAA,CAAIO,UAAU,mCACbhB,SAAA,GAAAS,KAAC,MAAA,CAAIO,UAAU,0BACZhB,SAAA,CAAAwJ,GACC5I,EAAAA,IAACwC,EAAA,CACCE,MAAO+E,EAAKhC,UACZ9C,SAAWC,GAAM4P,GAAiB7B,EAAO,YAAa/N,EAAEC,OAAOH,OAC/DgU,QAAS,IAAMhN,GAAgB,eAAeiH,KAC9CgG,OAAQ,IAAMjN,GAAgB,MAC9BtJ,UAAW,iIACTqJ,KAAiB,eAAekH,IAC5B,gIACA,kBAENpR,YAAY,MACZD,SAAUgN,KAAmBD,KAG/BrM,EAAAA,IAAC,MAAA,CAAII,UAAU,0BAA2BhB,SAAAqI,EAAKhC,WAAa,WAE7DmD,GACC5I,EAAAA,IAACwC,EAAA,CACCE,MAAO+E,EAAK/B,cACZ/C,SAAWC,GAAM4P,GAAiB7B,EAAO,gBAAiB/N,EAAEC,OAAOH,OACnEgU,QAAS,IAAMhN,GAAgB,mBAAmBiH,KAClDgG,OAAQ,IAAMjN,GAAgB,MAC9BtJ,UAAW,sIACTqJ,KAAiB,mBAAmBkH,IAChC,wIACA,kBAENpR,YAAY,KACZD,SAAUgN,KAAmBD,KAG/BrM,EAAAA,IAAC,MAAA,CAAII,UAAU,+BAAgChB,SAAAqI,EAAK/B,eAAiB,WAGzE1F,IAAC,MAAA,CAAII,UAAU,gCACbhB,SAAAS,EAAAA,KAAC,MAAA,CAAIO,WAAcwI,GAAY,iBAAmB,eAAlC,iBAAiExJ,SAAA,CAAA,IAAEgT,GAAe3K,EAAK7B,cAAgB,aAI3H/F,KAAC,MAAA,CAAIO,UAAU,iCACbhB,SAAA,CAAAS,OAAC,MAAA,CACCT,SAAA,OAAC,OAAA,CAAKgB,UAAU,wBAAwBhB,SAAA,QACvCwJ,GACC5I,EAAAA,IAACwC,EAAA,CACCC,KAAK,SACLC,MAAO+E,EAAK3D,SACZnB,SAAWC,GAAM4P,GAAiB7B,EAAO,WAAYpL,OAAO3C,EAAEC,OAAOH,QACrEtC,UAAU,0HACVb,YAAY,OAGdS,EAAAA,IAAC,MAAA,CAAII,UAAU,iBAAkBhB,SAAAqI,EAAK3D,UAAY,cAGrD,MAAA,CACC1E,SAAA,OAAC,OAAA,CAAKgB,UAAU,wBAAwBhB,SAAA,QACvCwJ,GACC5I,EAAAA,IAACwC,EAAA,CACCC,KAAK,SACLC,MAAO+E,EAAK9B,iBACZhD,SAAWC,GAAM4P,GAAiB7B,EAAO,mBAAoBpL,OAAO3C,EAAEC,OAAOH,QAC7EtC,UAAU,0HACVb,YAAY,OAGdM,EAAAA,KAAC,MAAA,CAAIO,UAAU,iBAAiBhB,SAAA,CAAA,IAAEgT,GAAe3K,EAAK9B,+BAGzD,MAAA,CACCvG,SAAA,OAAC,OAAA,CAAKgB,UAAU,wBAAwBhB,SAAA,cACvC,MAAA,CAAIgB,UAAU,OACZhB,SAAAwJ,GACC5I,EAAAA,IAACkD,EAAA,CACCE,KAAK,KACLD,QAAQ,QACRE,QAAS,IAAMsP,GAAiBhC,GAChCvQ,UAAU,sDAEVhB,SAAAY,EAAAA,IAAC2X,EAAA,CAAOvX,UAAU,cAGpBP,EAAAA,KAAA+V,WAAA,CACGxW,SAAA,CAAc,aAAd8I,qBAEI9I,SAAAuN,GACC3M,EAAAA,IAAC,SAAA,CACCqD,QAAS,IAAMyP,GAAoBrL,EAAK0C,IAAK1C,EAAKoK,sBAClDzR,UAAW,8BACTqH,EAAKoK,qBACD,+CACA,6BAGLzS,SAAAqI,EAAKoK,qBAAuB,OAAS,SAGxC7R,EAAAA,IAAC,OAAA,CAAKI,UAAW,8BACfqH,EAAKoK,qBACD,2BACA,6BAEHzS,SAAAqI,EAAKoK,qBAAuB,OAAS,WAM/B,YAAd3J,GACClI,MAAA4V,EAAAA,SAAA,CACGxW,YACC0Q,GAAqBtI,YAAYC,GAC/BzH,EAAAA,IAAC,SAAA,CACCqD,QAAS,KACPyM,GAAqB3I,aAAaM,EAAK0C,GAAI,CACzC1E,UAAWgC,EAAKhC,UAChBC,cAAe+B,EAAK/B,cACpB5B,SAAU2D,EAAK3D,SACf6B,iBAAkB8B,EAAK9B,iBACvBC,aAAc6B,EAAK7B,aACnBC,OAAQ4B,EAAK5B,UAGjBzF,UAAU,kDAEThB,YAAqBgF,OAAOwL,gBAG/B5P,EAAAA,IAACb,EAAA,CACCE,aAAeqB,IACboP,GAAqBlL,cAAc6C,EAAK0C,GAAIzJ,EAAM,CAChD+E,UAAWgC,EAAKhC,UAChBC,cAAe+B,EAAK/B,cACpB5B,SAAU2D,EAAK3D,SACf6B,iBAAkB8B,EAAK9B,iBACvBC,aAAc6B,EAAK7B,aACnBC,OAAQ4B,EAAK5B,UAGjBtG,YAAY,mBACZC,MAAM,SACNC,KAAK,SAELL,eAAC,SAAA,CAAOgB,UAAU,sDACfhB,SAAA0Q,GAAqB1L,OAAOyL,sBAKlC,OAAA,CAAKzP,UAAW,8BACf0P,GAAqBtI,YAAYC,GAC7B,wBACA,6BAEHrI,SAAA0Q,GAAqBtI,YAAYC,GAAQqI,GAAqB1L,OAAOwL,cAAgBE,GAAqB1L,OAAOyL,gBAM3G,SAAd3H,GACClI,MAAA4V,EAAAA,SAAA,CAEExW,SAAAY,MAAC,QAAKI,UAAW,gBACf0P,GAAqBtI,YAAYC,GAC7B,0BACA,iDAEHrI,SAAA0Q,GAAqBtI,YAAYC,GAAQ,OAAS,WAK1C,aAAdS,GAA0C,YAAdA,GAAyC,SAAdA,GACtDlI,MAAC,OAAA,CAAKI,UAAU,wBAAwBhB,SAAA,kBAQlDqI,EAAK5B,QAAU+C,OACf/I,KAAC,MAAA,CACCT,SAAA,OAAC,OAAA,CAAKgB,UAAU,wBAAwBhB,SAAA,QACvCwJ,GACC5I,EAAAA,IAACwC,EAAA,CACCE,MAAO+E,EAAK5B,QAAU,GACtBlD,SAAWC,GAAM4P,GAAiB7B,EAAO,SAAU/N,EAAEC,OAAOH,OAC5DtC,UAAU,yGACVb,YAAY,OAGdS,EAAAA,IAAC,MAAA,CAAII,UAAU,oCAAqChB,SAAAqI,EAAK5B,QAAU,UAMvE+C,IAA2B,YAAdV,GAA2B4H,GAAqBpI,iBAAiBD,IAC9E5H,EAAAA,KAAC,MAAA,CACCT,SAAA,OAAC,OAAA,CAAKgB,UAAU,wBAAwBhB,SAAA,aACxCS,KAAC,MAAA,CAAIO,UAAU,OACbhB,SAAA,CAAAY,EAAAA,IAAC,MAAA,CAAII,UAAU,gCACZhB,SAAA,IAAI0B,KAAKgP,GAAqBpI,iBAAiBD,IAAOyO,mBAAmB,QAAS,CACjFC,KAAM,UACNC,MAAO,UACPC,IAAK,cAGTrW,EAAAA,IAAC,MAAA,CAAII,UAAU,2BACZhB,SAAA,IAAI0B,KAAKgP,GAAqBpI,iBAAiBD,IAAOoQ,mBAAmB,QAAS,CACjFC,KAAM,UACNC,OAAQ,qBAQhBnP,IAA2B,SAAdV,UACZ,MAAA,CAAI9H,UAAU,oCACbhB,SAAA,OAAC,OAAA,CAAKgB,UAAU,wBAAwBhB,SAAA,cACxCY,EAAAA,IAAC,OAAII,UAAU,0BACZhB,YACCuQ,GAAwBnI,YAAYC,GAClCzH,EAAAA,IAAC,SAAA,CACCqD,QAAS,KACPsM,GAAwBxI,aAAaM,EAAK0C,GAAI,CAC5C1E,UAAWgC,EAAKhC,UAChBC,cAAe+B,EAAK/B,cACpB5B,SAAU2D,EAAK3D,SACf6B,iBAAkB8B,EAAK9B,iBACvBC,aAAc6B,EAAK7B,aACnBC,OAAQ4B,EAAK5B,UAGjBzF,UAAU,qEACV2U,MAAM,mBAEL3V,YAAwBgF,OAAOwL,gBAGlC5P,EAAAA,IAACb,EAAA,CACCE,aAAeqB,IACbiP,GAAwB/K,cAAc6C,EAAK0C,GAAIzJ,EAAM,CACnD+E,UAAWgC,EAAKhC,UAChBC,cAAe+B,EAAK/B,cACpB5B,SAAU2D,EAAK3D,SACf6B,iBAAkB8B,EAAK9B,iBACvBC,aAAc6B,EAAK7B,aACnBC,OAAQ4B,EAAK5B,UAGjBtG,YAAY,iBACZC,MAAM,MACNC,KAAK,SAELL,SAAAY,EAAAA,IAAC,SAAA,CACCI,UAAU,sDACViD,QAAS,OAERjE,YAAwBgF,OAAOyL,sBAKrC,OAAA,CAAKzP,UAAW,8BACfuP,GAAwBnI,YAAYC,GAChC,wBACA,6BAEHrI,SAAAuQ,GAAwBnI,YAAYC,GAAQkI,GAAwBvL,OAAOwL,cAAgBD,GAAwBvL,OAAOyL,oBAQnIjH,IAA2B,SAAdV,GAAwByH,GAAwBjI,iBAAiBD,IAC9E5H,EAAAA,KAAC,MAAA,CACCT,SAAA,OAAC,OAAA,CAAKgB,UAAU,wBAAwBhB,SAAA,mBACvC,MAAA,CAAIgB,UAAU,OACbhB,SAAAY,EAAAA,IAAC,OAAII,UAAU,+BACZhB,SAAA,IAAI0B,KAAK6O,GAAwBjI,iBAAiBD,IAAOyO,mBAAmB,QAAS,CACpFC,KAAM,UACNC,MAAO,UACPC,IAAK,wBApwBT1F,aAkxBlB9Q,KAAC,MAAA,CAAIO,UAAU,mDACbhB,SAAA,GAAAS,KAAC,MAAA,CAAIO,UAAU,iDAAiDoW,MAAO,CACrEC,oBAAqB3E,MAGrB1S,SAAA,CAAAY,EAAAA,IAAC,MAAA,UAEA,MAAA,UAEA,MAAA,MAEDA,IAAC,OAAII,UAAU,aACbhB,eAAC,OAAA,CAAKgB,UAAU,sCAAsChB,SAAA,eAGvD,MAAA,CAAIgB,UAAU,aACbhB,SAAAS,EAAAA,KAAC,OAAA,CAAKO,UAAU,sCAAsChB,SAAA,CAAA,IAClDgT,IACCxJ,GAAYI,GAAcW,KAAeY,OAAO,CAACC,EAAK/C,IAAS+C,GAAO/C,EAAK7B,cAAgB,GAAI,IAAM,cAK3G,MAAA,UAEE,MAAA,CAAA,GAIY,YAAdsC,GAA2BlI,MAAC,MAAA,CAAA,GACd,SAAdkI,GACCrI,EAAAA,KAAA+V,EAAAA,SAAA,CACExW,SAAA,CAAAY,EAAAA,IAAC,MAAA,UACA,MAAA,MACDH,KAAC,MAAA,CAAIO,UAAU,cACbhB,SAAA,OAAC,MAAA,CAAIgB,UAAU,+CAA+ChB,SAAA,YAC9DS,KAAC,MAAA,CAAIO,UAAU,sCAAsChB,SAAA,CAAA,IACjDgT,IACCxJ,GAAYI,GAAcW,KAAeY,OAAO,CAACC,EAAa/C,IACtD+C,GAAOjF,OAAOkC,EAAK6J,qBAAuB,GAChD,IAAM,iBASrBzR,KAAC,MAAA,CAAIO,UAAU,yBACbhB,SAAA,GAAAS,KAAC,MAAA,CAAIO,UAAU,oCACbhB,SAAA,OAAC,OAAA,CAAKgB,UAAU,sCAAsChB,SAAA,SACtDS,KAAC,OAAA,CAAKO,UAAU,sCAAsChB,SAAA,CAAA,IAClDgT,IACCxJ,GAAYI,GAAcW,KAAeY,OAAO,CAACC,EAAK/C,IAAS+C,GAAO/C,EAAK7B,cAAgB,GAAI,IAAM,SAK7F,SAAdsC,GACCrI,OAAC,MAAA,CAAIO,UAAU,yCACbhB,SAAA,OAAC,OAAA,CAAKgB,UAAU,sCAAsChB,SAAA,YACtDS,KAAC,OAAA,CAAKO,UAAU,sCAAsChB,SAAA,CAAA,IAClDgT,IACCxJ,GAAYI,GAAcW,KAAeY,OAAO,CAACC,EAAa/C,IACtD+C,GAAOjF,OAAOkC,EAAK6J,qBAAuB,GAChD,IAAM,eASpB1I,MACC5I,IAAC,MAAA,CAAII,UAAU,sCACbhB,SAAAS,EAAAA,KAACqD,EAAA,CACCE,KAAK,KACLD,QAAQ,UACRE,QAx7EE,KAEpB,MAKM2U,EAAU,CACdvS,UAAW,GACXC,cAAe,GACf5B,SAAU,EACV6B,iBAAkB,EAClBC,aAAc,EACdC,OAAQ,GACRkI,YAZoB/E,GAAYuB,OAAO,CAACtG,EAAKwD,KAC7C,MAAMwQ,EAAUxQ,EAAKsG,aAAe,EACpC,OAAOkK,EAAUhU,EAAMgU,EAAUhU,GAChC,GAS4B,GAIzBwO,EAAW,IAAIzJ,GAAagP,GAASpK,KAAK,CAACC,EAAGC,KACpCD,EAAEE,aAAe,SACjBD,EAAEC,aAAe,SAIjC9E,GAAewJ,IAi6EGrS,UAAU,iGAEVhB,SAAA,GAAAY,IAACkY,EAAA,CAAK9X,UAAU,iBAAiB,wBAU/CJ,EAAAA,IAAC,MAAA,CAAII,UAAU,oBACbhB,SAAAY,EAAAA,IAAC,OAAA,CAAKI,UAAU,iBAAiBhB,SAAA,2BASzC,OAAI4I,EACKoM,SAKN+D,EAAA,CAAOzY,KAAMoI,EAAQ/H,aAAcgI,EAClC3I,SAAAS,EAAAA,KAACuY,EAAA,CACChY,UAAU,8OACViY,iBAAiB,EAEjBjZ,SAAA,CAAAY,EAAAA,IAACsY,GAAalY,UAAU,UACtBhB,SAAAY,MAACuY,EAAA,CAAYnZ,0BAGfS,KAAC,MAAA,CAAIO,UAAU,gFACbhB,SAAA,CAAAY,EAAAA,IAAC,SAAA,CACCqD,QAAS0E,EACT3H,UAAU,6HAEVhB,SAAAY,EAAAA,IAAC0U,EAAA,CAAEtU,UAAU,kCAGd,MAAA,CAAIA,UAAU,gBACbhB,SAAAS,EAAAA,KAAC,MAAA,CAAIO,UAAU,sCACbhB,SAAA,GAAAY,IAAC,MAAA,CAAII,UAAU,iBACbhB,SAAAY,EAAAA,IAAC,MAAGI,UAAU,0BAA0BhB,yBAI1CS,KAAC,MAAA,CAAIO,UAAU,0BACZhB,SAAA,EAACwJ,IAAa2D,IACb1M,EAAAA,KAAA+V,EAAAA,SAAA,CACExW,SAAA,CAAAS,EAAAA,KAACqD,EAAA,CACCE,KAAK,KACLD,QAAQ,UACRE,QAAS,IAAM6O,IAAiB,GAChC9R,UAAU,sCAEVhB,SAAA,GAAAY,IAACwY,EAAA,CAAMpY,UAAU,iBAAiB,QAGnCoM,IAAapE,GACZvI,EAAAA,KAACqD,EAAA,CACCE,KAAK,KACLD,QAAQ,UACRE,QAASyB,UACP,GAAI4D,EACF,UACQN,EAASM,GAGfX,IACII,SACIA,GAAU,EAEpB,OAAS/C,GACPzE,EAAOyE,MAAM,gBAAiBA,GAC9BD,EAAMC,MAAM,mBACd,GAGJhF,UAAU,mCAEVhB,SAAA,GAAAY,IAAC2X,EAAA,CAAOvX,UAAU,iBAAiB,WAM1CwI,IACC/I,EAAAA,KAAA+V,WAAA,CACExW,SAAA,CAAAS,EAAAA,KAACqD,EAAA,CACCE,KAAK,KACLD,QAAQ,UACRE,QAAS,KACP6O,IAAiB,GACjBnJ,GAAkBL,GAClBO,GAAeP,GAAUmB,OAAS,IAClCV,GAAkB,KAEpB/I,UAAU,sCAEVhB,SAAA,GAAAY,IAAC0U,EAAA,CAAEtU,UAAU,iBAAiB,QAGhCP,EAAAA,KAACqD,EAAA,CACCE,KAAK,KACLC,QApxFDyB,UACjB,GAAK4D,GAAaI,GAKlB,IAGE,MAAM2P,EAAczP,GAAYuB,OAAO,CAACC,EAAK/C,IAAS+C,GAAO/C,EAAK7B,cAAgB,GAAI,IAE9ER,MAAOsT,SAAsBhU,GAClC+B,KAAK,qBACLC,OAAO,CACNoN,sBAAuBhL,GAAegL,uBAAyB,KAC/DpH,eAAgB5D,GAAe4D,gBAAkB,KACjDwI,sBAAuBpM,GAAeoM,uBAAyB,KAC/DE,8BAA+BtM,GAAesM,+BAAiC,KAC/Ef,iBAAkBvL,GAAeuL,kBAAoB,KACrDmB,eAAgB1M,GAAe0M,gBAAkB,KACjDmD,aAAcpT,OAAOkT,GACrBxJ,YAAA,IAAgBnO,MAAOqF,gBAExBQ,GAAG,KAAM+B,EAASyB,IAErB,GAAIuO,EAAa,MAAMA,EAGvB,GAAIxP,GAAeY,OAAS,EAAG,CAC7B,MAAQ1E,MAAOwT,SAAsBlU,GAClC+B,KAAK,0BACLoS,SACAC,GAAG,KAAM5P,IAEZ,GAAI0P,EAAa,MAAMA,CACzB,CAIA,IAAA,MAAWnR,KAAQuB,GAAa,CAG9B,IAAKvB,EAAKhC,YAAcgC,EAAKhC,UAAUuG,OACrC,MAAM,IAAI+M,MAAM,eAElB,IAAKtR,EAAK3D,UAAY2D,EAAK3D,UAAY,EACrC,MAAM,IAAIiV,MAAM,mBAElB,GAA8B,OAA1BtR,EAAK9B,uBAAuD,IAA1B8B,EAAK9B,kBAAkC8B,EAAK9B,iBAAmB,EACnG,MAAM,IAAIoT,MAAM,oBAElB,GAA0B,OAAtBtR,EAAK7B,mBAA+C,IAAtB6B,EAAK7B,cAA8B6B,EAAK7B,aAAe,EACvF,MAAM,IAAImT,MAAM,oBAGlB,GAAItR,EAAK0C,GAAI,CAEX,MAAM/E,MAAEA,SAAgBV,GACrB+B,KAAK,0BACLC,OAAO,CACNjB,UAAWgC,EAAKhC,UAAUuG,OAC1BtG,cAAe+B,EAAK/B,eAAiB,KACrC5B,SAAUyB,OAAOkC,EAAK3D,UACtByC,kBAA8C,OAA3BkB,EAAKlB,wBAAyD,IAA3BkB,EAAKlB,kBAAkChB,OAAOkC,EAAKlB,mBAAqB,KAC9HZ,iBAAkBJ,OAAOkC,EAAK9B,kBAC9BqT,oBAAqBtQ,EAASuQ,UAAY,MAC1CrT,aAAcL,OAAOkC,EAAK7B,cAC1BsT,gBAAiBxQ,EAASuQ,UAAY,MACtCpT,OAAQ4B,EAAK5B,QAAU,KACvBoJ,YAAA,IAAgBnO,MAAOqF,gBAExBQ,GAAG,KAAMc,EAAK0C,IAEjB,GAAI/E,EAEF,MADAzE,EAAOyE,MAAM,gBAAiBA,GACxBA,CAEV,KAAO,CAEL,MAAM+T,EAAa,CACjBC,oBAAqB1Q,EAASyB,GAC9B1E,UAAWgC,EAAKhC,UAAUuG,OAC1BtG,cAAe+B,EAAK/B,eAAiB,KACrC5B,SAAUyB,OAAOkC,EAAK3D,UACtByC,kBAA8C,OAA3BkB,EAAKlB,wBAAyD,IAA3BkB,EAAKlB,kBAAkChB,OAAOkC,EAAKlB,mBAAqB,KAC9HZ,iBAAkBJ,OAAOkC,EAAK9B,kBAC9BqT,oBAAqBtQ,EAASuQ,UAAY,MAC1CrT,aAAcL,OAAOkC,EAAK7B,cAC1BsT,gBAAiBxQ,EAASuQ,UAAY,MACtCpT,OAAQ4B,EAAK5B,QAAU,KACvBkI,YAAatG,EAAKsG,aAAe/E,GAAYqQ,QAAQ5R,GAAQ,EAC7D6R,YAAA,IAAgBxY,MAAOqF,gBAGnBf,MAAEA,SAAgBV,GACrB+B,KAAK,0BACL8S,OAAOJ,GAEV,GAAI/T,EAEF,MADAzE,EAAOyE,MAAM,aAAcA,GACrBA,CAEV,CACF,CAGA,MAAMgJ,EAAmB1F,EAAWnD,OAAOmD,EAASyB,IAAMkE,IACpDmL,EAAa1Q,IAAkBJ,EA4BrC,IAzBKnD,OAAO/B,MAAM4K,IAAqBlF,GAAeY,OAAS,IAC7DnJ,EAAOkG,KAAK,6BAA8B,CACxCtC,WAAY6J,EACZlF,kBACAuQ,aAAcvQ,GAAeY,SAI/BZ,GAAe+H,QAAQlM,IACC2U,EAAqBtL,EAAkBrJ,GAO3DpE,EAAOkG,KAAK,yCAA0C,CACpDtC,WAAY6J,EACZrJ,WAPFpE,EAAOuE,KAAK,uCAAwC,CAClDX,WAAY6J,EACZrJ,eAYHQ,OAAO/B,MAAM4K,GAAmB,CACnC,MAAMuL,EAAgB7E,EAAuB1G,EAAmBQ,IAC9D,MAAM6J,EAAczP,GAAYuB,OAAO,CAACC,EAAK/C,IAAS+C,GAAO/C,EAAK7B,cAAgB,GAAI,GAQtF,OANAjF,EAAOkG,KAAK,4BAA6B,CACvCtC,WAAY6J,EACZwL,eAAgBnB,EAChBoB,WAAY7Q,GAAYc,SAGnB,IACF8E,EAEHkF,sBAAuB0F,GAAY1F,uBAAyBlF,EAAKkF,sBACjEpH,eAAgB8M,GAAY9M,gBAAkBkC,EAAKlC,eACnDwI,sBAAuBsE,GAAYtE,uBAAyBtG,EAAKsG,sBACjEE,8BAA+BoE,GAAYpE,+BAAiCxG,EAAKwG,8BACjFf,iBAAkBmF,GAAYnF,kBAAoBzF,EAAKyF,iBACvDmB,eAAgBgE,GAAYhE,gBAAkB5G,EAAK4G,eACnDmD,aAAcF,EACdxJ,YAAA,IAAgBnO,MAAOqF,iBAI3BxF,EAAOkG,KAAK,6BAA8B,CAAE8S,iBAC9C,CAG8B,OACvBpU,OAAO/B,MAAM4K,IAAqB3J,GACrCA,EAAmB2J,EAAkBQ,IACnC,MAAMkL,EAAa9Q,GACbyP,EAAcqB,EAAWvP,OAAO,CAACC,EAAK/C,IAAS+C,GAAO/C,EAAK7B,cAAgB,GAAI,GAQrF,OANAjF,EAAOkG,KAAK,qCAAsC,CAChDkT,mBAAoBnL,EAAK/E,OAAOC,QAAU8E,EAAK7E,wBAAwBD,QAAU,EACjFkQ,gBAAiBF,EAAWhQ,OAC5BmQ,kBAAmB/Q,GAAeY,SAG7B,IACF8E,EAEHkF,sBAAuB0F,GAAY1F,uBAAyBlF,EAAKkF,sBACjEpH,eAAgB8M,GAAY9M,gBAAkBkC,EAAKlC,eACnDwI,sBAAuBsE,GAAYtE,uBAAyBtG,EAAKsG,sBACjEE,8BAA+BoE,GAAYpE,+BAAiCxG,EAAKwG,8BACjFf,iBAAkBmF,GAAYnF,kBAAoBzF,EAAKyF,iBACvDmB,eAAgBgE,GAAYhE,gBAAkB5G,EAAK4G,eACnDmD,aAAcF,EAEd5O,MAAOiQ,EACP/P,uBAAwB+P,EACxB7K,YAAA,IAAgBnO,MAAOqF,kBAO/B6P,GAEA7Q,EAAM8B,QAAQ,yBACdiL,IAAiB,GACjB/I,GAAkB,UAGZ6D,KACN,MAAMwG,EAAgBrL,KAAY,EAAM,CAAEsL,QAAQ,IAC9CD,aAAyBE,eACrBF,CAEV,OAASpO,GACPzE,EAAOyE,MAAM,aAAcA,GAC3B,MAAM8U,EAAe9U,aAAiB2T,MAAQ3T,EAAM+U,QAAU,oBAC9DhV,EAAMC,MAAM,UAAU8U,IACxB,MAjNE/U,EAAMC,MAAM,mBAmxFIhF,UAAU,oCAEVhB,SAAA,GAAAY,IAACoa,EAAA,CAAKha,UAAU,iBAAiB,4BAW9C,MAAA,CAAIA,UAAU,wDACZhB,SAAAgV,SAMX","x_google_ignoreList":[0,1]}