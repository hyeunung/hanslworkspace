import{c as e,a as t,l as a,p as s,C as r,r as n,u as i,b as l,d,j as o,P as c,B as u,S as m,m as p,e as g}from"./index-BBqlRFcp.js";import{C as h,a as _,b as y,c as f,S as v}from"./card-BnaOJBOj.js";import{I as x}from"./dialog-CUL_r7q0.js";import{d as b}from"./excelDownload-CTQVGsiz.js";import{C as w,T as j,P as N}from"./PurchaseDetailModal-DFSq3uwl.js";import{t as q}from"./index-BwPoDD6m.js";import{D as S}from"./download-Bwb1fd2c.js";import"./helpers-CsHcdtkA.js";import"./chevron-right-C4qk5A-c.js";import"./chevron-down-CJqBJprP.js";import"./popover-Dtg6OeLr.js";import"./textarea-DxEeqYlW.js";import"./react-select.esm-Dql5RJUW.js";import"./calendar-5LoKqPi-.js";import"./check-DrHAfXhs.js";import"./credit-card-D1QBxTV5.js";import"./loader-circle-yVa5C846.js";import"./save-uKwyxrbO.js";
/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=e("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),D={data:null,lastFetch:0,CACHE_DURATION:3e4,employeeId:null};const M=new class{constructor(){this.supabase=t()}hasValidPurchaseMemory(e){if(!s.allPurchases||0===s.allPurchases.length)return!1;if(!e?.id)return!1;const t=Date.now()-(s.lastFetch||0)<r,a=s.currentUser?.id===String(e.id);return t&&a}getPurchaseMemory(){return s.allPurchases||[]}parseRoles(e){let t=[];if(e)if(Array.isArray(e))t=e.map(e=>String(e).trim());else{t=String(e).split(",").map(e=>e.trim()).filter(e=>e.length>0)}return t}async getDashboardData(e,t=!1){const s=Date.now();if(!t&&D.data&&D.employeeId===e.id&&s-D.lastFetch<D.CACHE_DURATION&&D.data)return D.data;const r=this.hasValidPurchaseMemory(e),n=await Promise.allSettled([r?this.getDashboardStatsFromMemory(e):this.getDashboardStats(e),r?this.getMyRecentRequestsFromMemory(e):this.getMyRecentRequests(e),r?this.getPendingApprovalsFromMemory(e):this.getPendingApprovals(e),r?this.getQuickActionsFromMemory(e):this.getQuickActions(e),r?this.getTodaySummaryFromMemory(e):this.getTodaySummary(e),r?this.getMyPurchaseStatusFromMemory(e):this.getMyPurchaseStatus(e)]),i=n[0],l=n[1],d=n[2],o=n[3],c=n[4],u=n[5],m="fulfilled"===i.status?i.value:{total:0,myRequests:0,pending:0,completed:0,urgent:0,todayActions:0},p="fulfilled"===l.status?l.value:[],g="fulfilled"===d.status?d.value:[],h="fulfilled"===o.status?o.value:[],_="fulfilled"===c.status?c.value:{approved:0,requested:0,received:0},y="fulfilled"===u.status?u.value:{waitingPurchase:[],waitingDelivery:[],recentCompleted:[]};"rejected"===i.status&&a.error("[DashboardService] getDashboardStats ì‹¤íŒ¨:",i.reason),"rejected"===l.status&&a.error("[DashboardService] getMyRecentRequests ì‹¤íŒ¨:",l.reason),"rejected"===d.status&&a.error("[DashboardService] getPendingApprovals ì‹¤íŒ¨:",d.reason),"rejected"===o.status&&a.error("[DashboardService] getQuickActions ì‹¤íŒ¨:",o.reason),"rejected"===c.status&&a.error("[DashboardService] getTodaySummary ì‹¤íŒ¨:",c.reason),"rejected"===u.status&&a.error("[DashboardService] getMyPurchaseStatus ì‹¤íŒ¨:",u.reason);const f={employee:e,stats:m,urgentRequests:[],myRecentRequests:p,pendingApprovals:g,quickActions:h,todaySummary:_,myPurchaseStatus:y};return D.data=f,D.lastFetch=s,D.employeeId=e.id,f}isPendingStatus(e){return"pending"===e||"ëŒ€ê¸°"===e||""===e||null==e}toTime(e){if(!e)return 0;const t=new Date(e).getTime();return Number.isFinite(t)?t:0}async getDashboardStatsFromMemory(e){const t=this.getPurchaseMemory(),a=(new Date).toISOString().split("T")[0],s=this.parseRoles(e.purchase_role);e.name||e.email;const r=new Date((new Date).getFullYear(),(new Date).getMonth(),1).toISOString(),n=new Date(Date.now()-2592e5).toISOString();return{total:t.length,myRequests:t.filter(t=>(t.requester_name||"")===e.name).length,pending:await this.getPendingCountFromMemory(e,s),completed:t.filter(e=>!0===e.is_received&&this.toTime(e.received_at)>=this.toTime(r)).length,urgent:this.getUrgentCountFromMemory(e,s,n),todayActions:this.getTodayActionsCountFromMemory(e,a)}}async getMyRecentRequestsFromMemory(e){const t=this.getPurchaseMemory(),a=e.name||e.email;return t.filter(e=>(e.requester_name||"")===a).filter(e=>{const t="approved"===e.middle_manager_status,a=this.isPendingStatus(e.final_manager_status),s="approved"===e.final_manager_status,r=!e.is_payment_completed;return t&&a||s&&r}).sort((e,t)=>this.toTime(t.created_at)-this.toTime(e.created_at)).slice(0,5).map(e=>({...e,vendor_name:e.vendor_name,total_items:(e.purchase_request_items||[]).length,progress_percentage:this.calculateProgress(e),current_step:this.getCurrentStep(e),next_action:this.getNextAction(e),estimated_completion:this.estimateCompletion(e)}))}async getPendingApprovalsFromMemory(e){const t=this.parseRoles(e.purchase_role);if(0===t.length)return[];const a=[...this.getPurchaseMemory()].sort((e,t)=>this.toTime(t.request_date)-this.toTime(e.request_date)).filter(e=>{const t=this.isPendingStatus(e.middle_manager_status),a=this.isPendingStatus(e.final_manager_status),s="rejected"===e.middle_manager_status,r="rejected"===e.final_manager_status;return!s&&!r&&(t||a)});let s=a;t.includes("app_admin")||(s=t.includes("middle_manager")?a.filter(e=>this.isPendingStatus(e.middle_manager_status)):t.includes("final_approver")||t.includes("ceo")||t.includes("raw_material_manager")||t.includes("consumable_manager")?a.filter(e=>"approved"===e.middle_manager_status&&this.isPendingStatus(e.final_manager_status)):t.includes("lead buyer")?a.filter(e=>"approved"===e.final_manager_status&&!e.is_payment_completed):[]);return s.slice(0,100).map(e=>{const t=e.purchase_request_items||e.items||[],a=Number(e.total_amount)||t.reduce((e,t)=>e+(Number(t?.amount_value)||(Number(t?.quantity)||0)*(Number(t?.unit_price_value)||0)),0);return{...e,purchase_request_items:t,items:t,total_amount:a,vendor_name:e.vendor_name||e.project_vendor||e.vendor?.vendor_name}})}async getQuickActionsFromMemory(e){const t=this.parseRoles(e.purchase_role),a=[];if(t.includes("app_admin")||t.includes("middle_manager")||t.includes("final_approver")||t.includes("ceo")){const s=await this.getPendingCountFromMemory(e,t);s>0&&a.push({id:"approve",type:"approve",label:"ìŠ¹ì¸ ëŒ€ê¸°",description:`${s}ê±´ì˜ ìŠ¹ì¸ ëŒ€ê¸° ì¤‘`,count:s,color:"red"})}if(t.includes("lead buyer")||t.includes("lead buyer")){const e=this.getPurchaseMemory().filter(e=>"approved"===e.final_manager_status&&!1===e.is_payment_completed).length;e>0&&a.push({id:"purchase",type:"purchase",label:"êµ¬ë§¤ ì²˜ë¦¬",description:`${e}ê±´ì˜ êµ¬ë§¤ ëŒ€ê¸° ì¤‘`,count:e,color:"yellow"})}return a}async getTodaySummaryFromMemory(e){const t=this.getPurchaseMemory(),a=(new Date).toISOString().split("T")[0],s=new Date(Date.now()+864e5).toISOString().split("T")[0],r=e=>{const t=this.toTime(e);return t>=this.toTime(a)&&t<this.toTime(s)};return{approved:t.filter(e=>r(e.updated_at)&&("approved"===e.middle_manager_status||"approved"===e.final_manager_status)).length,requested:t.filter(t=>(t.requester_name||"")===e.name&&r(t.created_at)).length,received:t.filter(e=>!0===e.is_received&&r(e.received_at)).length}}async getMyPurchaseStatusFromMemory(e){const t=this.parseRoles(e.purchase_role),a=t.includes("lead buyer")||t.includes("app_admin"),s=e.name||e.email,r=this.getPurchaseMemory(),n=new Date(Date.now()-6048e5).toISOString(),i=(a?r:r.filter(e=>(e.requester_name||"")===s)).filter(e=>{const t="êµ¬ë§¤ ìš”ì²­"===(e.payment_category||"").trim(),a=!e.is_payment_completed;if(!t||!a)return!1;if((e.progress_type||"").includes("ì„ ì§„í–‰"))return!0;const s=(e.progress_type||"").includes("ì¼ë°˜")||!e.progress_type||""===e.progress_type,r="approved"===e.final_manager_status;return s&&r}),l=r.filter(e=>{const t=!e.is_received,a=(e.progress_type||"").includes("ì„ ì§„í–‰");if((e.requester_name||"")!==s)return!1;if(t&&a)return!0;const r="approved"===e.final_manager_status;return t&&r}),d=r.filter(e=>!0===e.is_received&&(!!e.received_at&&((e.requester_name||"")===s&&this.toTime(e.received_at)>=this.toTime(n)))),o=(e,t)=>this.toTime(t.created_at)-this.toTime(e.created_at);return{waitingPurchase:[...i].sort(o),waitingDelivery:[...l].sort(o),recentCompleted:[...d].sort(o)}}async getPendingCountFromMemory(e,t){const a=this.getPurchaseMemory();if(t.includes("app_admin")){return a.filter(e=>this.isPendingStatus(e.middle_manager_status)).length+a.filter(e=>"approved"===e.middle_manager_status&&this.isPendingStatus(e.final_manager_status)).length+a.filter(e=>"approved"===e.final_manager_status&&!1===e.is_payment_completed).length}return t.includes("middle_manager")?a.filter(e=>this.isPendingStatus(e.middle_manager_status)).length:t.includes("final_approver")||t.includes("ceo")?a.filter(e=>"approved"===e.middle_manager_status&&this.isPendingStatus(e.final_manager_status)).length:t.includes("lead buyer")?a.filter(e=>"approved"===e.final_manager_status&&!1===e.is_payment_completed).length:0}getUrgentCountFromMemory(e,t,a){const s=this.getPurchaseMemory(),r=this.toTime(a),n=s.filter(e=>this.toTime(e.created_at)>0&&this.toTime(e.created_at)<r);return t.includes("app_admin")?n.filter(e=>"pending"===e.middle_manager_status||"pending"===e.final_manager_status||!1===e.is_payment_completed).length:t.includes("middle_manager")?n.filter(e=>"pending"===e.middle_manager_status).length:t.includes("final_approver")||t.includes("ceo")?n.filter(e=>"approved"===e.middle_manager_status&&"pending"===e.final_manager_status).length:t.includes("lead buyer")?n.filter(e=>"approved"===e.final_manager_status&&!1===e.is_payment_completed).length:0}getTodayActionsCountFromMemory(e,t){const a=this.getPurchaseMemory(),s=new Date(Date.now()+864e5).toISOString().split("T")[0],r=e=>{const a=this.toTime(e);return a>=this.toTime(t)&&a<this.toTime(s)};return a.filter(t=>r(t.updated_at)&&(t.requester_name||"")===e.name).length}async getDashboardStats(e){const t=(new Date).toISOString().split("T")[0],a=this.parseRoles(e.purchase_role),[s,r,n,i,l,d]=await Promise.all([this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}),this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).eq("requester_name",e.name),this.getPendingCount(e,a),this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).eq("is_received",!0).gte("received_at",new Date((new Date).getFullYear(),(new Date).getMonth(),1).toISOString()),this.getUrgentCount(e,a),this.getTodayActionsCount(e,t)]);return{total:s.count||0,myRequests:r.count||0,pending:n,completed:i.count||0,urgent:l,todayActions:d}}async getMyRecentRequests(e){const{data:t}=await this.supabase.from("purchase_requests").select("*,vendors(vendor_name),purchase_request_items(id)").eq("requester_name",e.name).or("and(middle_manager_status.eq.approved,final_manager_status.eq.pending),and(final_manager_status.eq.approved,is_payment_completed.eq.false)").order("created_at",{ascending:!1}).limit(5);return(t||[]).map(e=>({...e,vendor_name:e.vendors?.vendor_name,total_items:e.purchase_request_items?.length||0,progress_percentage:this.calculateProgress(e),current_step:this.getCurrentStep(e),next_action:this.getNextAction(e),estimated_completion:this.estimateCompletion(e)}))}async getPendingApprovals(e){const t=this.parseRoles(e.purchase_role);if(0===t.length)return[];a.debug("ðŸš€ ìŠ¹ì¸ ëŒ€ê¸° í•­ëª© ì¡°íšŒ ì‹œìž‘",{employeeName:e.name,employeeRoles:t});const{data:s,error:r}=await this.supabase.from("purchase_requests").select("\n        *,\n        vendors(vendor_name),\n        purchase_request_items(\n          id,\n          item_name,\n          specification,\n          quantity,\n          unit_price_value,\n          amount_value\n        )\n      ").order("request_date",{ascending:!1}).limit(100);if(r)return a.error("âŒ ìŠ¹ì¸ ëŒ€ê¸° í•­ëª© ì¡°íšŒ ì‹¤íŒ¨",r),[];let n=s||[];const i=e=>"pending"===e||"ëŒ€ê¸°"===e||""===e||null==e;a.debug("ðŸ” ìŠ¹ì¸ ëŒ€ê¸° í•„í„°ë§ ì „ ë°ì´í„°",{totalRequests:s?.length||0}),n=n.filter(e=>{const t=i(e.middle_manager_status),a=i(e.final_manager_status),s="rejected"===e.middle_manager_status,r="rejected"===e.final_manager_status;return!s&&!r&&(t||a)});let l=n;t.includes("app_admin")?a.debug("ðŸ”‘ app_admin ê¶Œí•œìœ¼ë¡œ ëª¨ë“  ìŠ¹ì¸ëŒ€ê¸° í•­ëª© í‘œì‹œ",{totalItems:l.length}):t.includes("middle_manager")?(l=n.filter(e=>i(e.middle_manager_status)),a.debug("ðŸ”‘ middle_manager ê¶Œí•œìœ¼ë¡œ ì¤‘ê°„ìŠ¹ì¸ ëŒ€ê¸° í•­ëª©ë§Œ í‘œì‹œ",{beforeFilter:n.length,afterFilter:l.length})):t.includes("final_approver")||t.includes("ceo")?(l=n.filter(e=>{const t="approved"===e.middle_manager_status,a=i(e.final_manager_status);return t&&a}),a.debug("ðŸ”‘ final_approver/ceo ê¶Œí•œìœ¼ë¡œ ìµœì¢…ìŠ¹ì¸ ëŒ€ê¸° í•­ëª©ë§Œ í‘œì‹œ",{beforeFilter:n.length,afterFilter:l.length})):t.includes("raw_material_manager")||t.includes("consumable_manager")?(l=n.filter(e=>{const t="approved"===e.middle_manager_status,a=i(e.final_manager_status);return t&&a}),a.debug("ðŸ”‘ material_manager ê¶Œí•œìœ¼ë¡œ ìµœì¢…ìŠ¹ì¸ ëŒ€ê¸° í•­ëª©ë§Œ í‘œì‹œ",{beforeFilter:n.length,afterFilter:l.length})):t.includes("lead buyer")?(l=n.filter(e=>{const t="approved"===e.final_manager_status,a=!e.is_payment_completed;return t&&a}),a.debug("ðŸ”‘ lead buyer ê¶Œí•œìœ¼ë¡œ êµ¬ë§¤ ëŒ€ê¸° í•­ëª©ë§Œ í‘œì‹œ",{beforeFilter:n.length,afterFilter:l.length})):(l=[],a.debug("ðŸ”‘ ìŠ¹ì¸ ê¶Œí•œ ì—†ëŠ” ì—­í• ",{roles:t,result:"empty"}));const d=l.map(e=>{const t=e.vendors?.vendor_name||e.vendor_name||"ì—…ì²´ ì •ë³´ ì—†ìŒ",a=e.purchase_request_items||[],s=a.reduce((e,t)=>e+(Number(t?.amount_value)||(Number(t?.quantity)||0)*(Number(t?.unit_price_value)||0)),0);return{...e,vendor_name:t,purchase_request_items:a,total_amount:s}});return a.debug("âœ… ìŠ¹ì¸ ëŒ€ê¸° í•­ëª© ì¡°íšŒ ì™„ë£Œ (ìµœì í™”ë¨)",{finalCount:d.length,performanceNote:"N+1 ë¬¸ì œ í•´ê²° - ë‹¨ì¼ JOIN ì¿¼ë¦¬ ì‚¬ìš©"}),d}async getQuickActions(e){const t=this.parseRoles(e.purchase_role),a=[];if(t.includes("app_admin")||t.includes("middle_manager")||t.includes("final_approver")||t.includes("ceo")){const s=await this.getPendingCount(e,t);s>0&&a.push({id:"approve",type:"approve",label:"ìŠ¹ì¸ ëŒ€ê¸°",description:`${s}ê±´ì˜ ìŠ¹ì¸ ëŒ€ê¸° ì¤‘`,count:s,color:"red"})}if(t.includes("lead buyer")||t.includes("lead buyer")){const{count:e}=await this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).eq("final_manager_status","approved").eq("is_payment_completed",!1);e&&e>0&&a.push({id:"purchase",type:"purchase",label:"êµ¬ë§¤ ì²˜ë¦¬",description:`${e}ê±´ì˜ êµ¬ë§¤ ëŒ€ê¸° ì¤‘`,count:e,color:"yellow"})}return a}async getTodaySummary(e){const t=(new Date).toISOString().split("T")[0],a=new Date(Date.now()+864e5).toISOString().split("T")[0],[s,r,n]=await Promise.all([this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).gte("updated_at",t).lt("updated_at",a).or("middle_manager_status.eq.approved,final_manager_status.eq.approved"),this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).eq("requester_name",e.name).gte("created_at",t).lt("created_at",a),this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).eq("is_received",!0).gte("received_at",t).lt("received_at",a)]);return{approved:s.count||0,requested:r.count||0,received:n.count||0}}async getMyPurchaseStatus(e){const t=this.parseRoles(e.purchase_role),s=t.includes("lead buyer")||t.includes("app_admin"),r=e.name||e.email,n=new Date(Date.now()-6048e5).toISOString();let i=this.supabase.from("purchase_requests").select("*,vendors(vendor_name),purchase_request_items(*)").order("created_at",{ascending:!1}).limit(500);s||(i=i.eq("requester_name",r));const l=await i;if(l.error)return a.error("getMyPurchaseStatus ì—ëŸ¬",l.error),{waitingPurchase:[],waitingDelivery:[],recentCompleted:[]};const d=l.data||[];return{waitingPurchase:d.filter(e=>{const t="êµ¬ë§¤ ìš”ì²­"===(e.payment_category||"").trim(),a=!e.is_payment_completed;if(!t||!a)return!1;if((e.progress_type||"").includes("ì„ ì§„í–‰"))return!0;const s=(e.progress_type||"").includes("ì¼ë°˜")||!e.progress_type||""===e.progress_type,r="approved"===e.final_manager_status;return s&&r}),waitingDelivery:d.filter(e=>{const t=!e.is_received,a=(e.progress_type||"").includes("ì„ ì§„í–‰");if(e.requester_name!==r)return!1;if(t&&a)return!0;const s="approved"===e.final_manager_status;return t&&s}),recentCompleted:d.filter(e=>{if(!0!==e.is_received)return!1;if(!e.received_at)return!1;if(e.requester_name!==r)return!1;return new Date(e.received_at)>=new Date(n)})}}async quickApprove(e,t){try{const a=this.parseRoles(t.purchase_role),{data:s}=await this.supabase.from("purchase_requests").select("middle_manager_status, final_manager_status").eq("id",e).single();if(!s)return{success:!1,error:"ìš”ì²­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."};let r={};const n=e=>"pending"===e||"ëŒ€ê¸°"===e||""===e||null==e;if(a.includes("app_admin")?n(s.middle_manager_status)?r={middle_manager_status:"approved"}:"approved"===s.middle_manager_status&&n(s.final_manager_status)&&(r={final_manager_status:"approved"}):a.includes("middle_manager")?n(s.middle_manager_status)&&(r={middle_manager_status:"approved"}):a.includes("final_approver")||a.includes("ceo")?"approved"===s.middle_manager_status&&n(s.final_manager_status)&&(r={final_manager_status:"approved"}):(a.includes("raw_material_manager")||a.includes("consumable_manager"))&&"approved"===s.middle_manager_status&&n(s.final_manager_status)&&(r={final_manager_status:"approved"}),0===Object.keys(r).length)return{success:!1,error:"ìŠ¹ì¸í•  ìˆ˜ ìžˆëŠ” ìƒíƒœê°€ ì•„ë‹™ë‹ˆë‹¤."};const{data:i,error:l}=await this.supabase.from("purchase_requests").update(r).eq("id",e).select().single();if(l)throw l;return{success:!0}}catch(a){return{success:!1,error:a.message}}}async getPendingCount(e,t){if(t.includes("app_admin")){const[e,t,a]=await Promise.all([this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).or("middle_manager_status.in.(pending,ëŒ€ê¸°),middle_manager_status.is.null"),this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).eq("middle_manager_status","approved").or("final_manager_status.in.(pending,ëŒ€ê¸°),final_manager_status.is.null"),this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).eq("final_manager_status","approved").eq("is_payment_completed",!1)]);return(e.count||0)+(t.count||0)+(a.count||0)}if(t.includes("middle_manager")){const{count:e,error:t}=await this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).or("middle_manager_status.in.(pending,ëŒ€ê¸°),middle_manager_status.is.null");return t?0:e||0}if(t.includes("final_approver")||t.includes("ceo")){const{count:e,error:t}=await this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).eq("middle_manager_status","approved").or("final_manager_status.in.(pending,ëŒ€ê¸°),final_manager_status.is.null");return t?0:e||0}if(t.includes("lead buyer")){const{count:e,error:t}=await this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).eq("final_manager_status","approved").eq("is_payment_completed",!1);return t?0:e||0}return 0}async getUrgentCount(e,t){if(0===t.length)return 0;const a=new Date(Date.now()-2592e5).toISOString();let s=this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).lt("created_at",a);if(t.includes("app_admin"))s=s.or("middle_manager_status.eq.pending,final_manager_status.eq.pending,is_payment_completed.eq.false");else if(t.includes("middle_manager"))s=s.eq("middle_manager_status","pending");else if(t.includes("final_approver")||t.includes("ceo"))s=s.eq("middle_manager_status","approved").eq("final_manager_status","pending");else{if(!t.includes("lead buyer"))return 0;s=s.eq("final_manager_status","approved").eq("is_payment_completed",!1)}const{count:r}=await s;return r||0}async getTodayActionsCount(e,t){const a=new Date(Date.now()+864e5).toISOString().split("T")[0],{count:s}=await this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).gte("updated_at",t).lt("updated_at",a).eq("requester_name",e.name);return s||0}async getTotalDeliveryWaitingCount(){const{count:e}=await this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).eq("is_received",!1).or("is_payment_completed.eq.true,progress_type.ilike.%ì„ ì§„í–‰%");return e||0}calculateProgress(e){let t=0;return"approved"===e.middle_manager_status&&(t+=25),"approved"===e.final_manager_status&&(t+=25),e.is_payment_completed&&(t+=25),e.is_received&&(t+=25),t}getCurrentStep(e){return e.is_received?"completed":e.is_payment_completed?"delivery":"approved"===e.final_manager_status?"purchase":"approval"}getNextAction(e){return"pending"===e.middle_manager_status?"ì¤‘ê°„ ìŠ¹ì¸ ëŒ€ê¸° ì¤‘":"pending"===e.final_manager_status?"ìµœì¢… ìŠ¹ì¸ ëŒ€ê¸° ì¤‘":e.is_payment_completed?e.is_received?"ì™„ë£Œ":"ìž…ê³  ëŒ€ê¸° ì¤‘":"êµ¬ë§¤ ì²˜ë¦¬ ëŒ€ê¸° ì¤‘"}estimateCompletion(e){const t=new Date(e.created_at),a=new Date;Math.floor((a.getTime()-t.getTime())/864e5);let s=7;"ê¸´ê¸‰"===e.progress_type&&(s=3);return new Date(t.getTime()+24*s*60*60*1e3).toLocaleDateString("ko-KR")}async getUndownloadedOrders(e){const t=this.parseRoles(e.purchase_role);if(!t.includes("lead buyer")&&!t.includes("app_admin"))return a.info("[DashboardService] ë¯¸ë‹¤ìš´ë¡œë“œ ë°œì£¼ì„œ ì¡°íšŒ ê¶Œí•œ ì—†ìŒ:",{roles:t}),[];if(this.hasValidPurchaseMemory(e)){return this.getPurchaseMemory().filter(e=>!0!==e.is_po_download).sort((e,t)=>this.toTime(t.created_at)-this.toTime(e.created_at)).slice(0,500).filter(e=>!0!==e.is_po_download&&("ì„ ì§„í–‰"===e.progress_type||"approved"===e.final_manager_status))}try{const{data:e,error:t}=await this.supabase.from("purchase_requests").select("\n          *,\n          purchase_request_items(\n            id,\n            item_name,\n            specification,\n            quantity,\n            unit_price_value,\n            amount_value\n          )\n        ").or("is_po_download.is.null,is_po_download.eq.false").order("created_at",{ascending:!1}).limit(500);if(t)throw a.error("[DashboardService] ë¯¸ë‹¤ìš´ë¡œë“œ ë°œì£¼ì„œ ì¡°íšŒ ì¿¼ë¦¬ ì—ëŸ¬:",t),t;return(e||[]).filter(e=>!0!==e.is_po_download&&("ì„ ì§„í–‰"===e.progress_type||"approved"===e.final_manager_status))}catch(s){throw a.error("[DashboardService] getUndownloadedOrders ì—ëŸ¬:",s),s}}};function T(){const[e,s]=n.useState(null),[r,D]=n.useState(!0),[T,C]=n.useState(null),[A,R]=n.useState([]),[F,k]=n.useState([]),[O,I]=n.useState(new Set),U=t(),[$,E]=n.useState(null),[H,L]=n.useState(!1),[Q,V]=n.useState("pending"),[B,K]=n.useState({undownloaded:"",pending:"",purchase:"",delivery:""});i();const{employee:Y,currentUserRoles:J}=l(),W=n.useCallback(async(t=!0,r=!1)=>{if(!Y)return a.error("[DashboardMain] No employee data available"),void(t&&D(!1));try{!t||r||e||D(!0);const i=await M.getDashboardData(Y,r);if(s(i),R(J),J.includes("lead buyer")||J.includes("app_admin"))try{const e=await M.getUndownloadedOrders(Y);a.info("[DashboardMain] ë¯¸ë‹¤ìš´ë¡œë“œ ë°œì£¼ì„œ ì¡°íšŒ ê²°ê³¼:",{count:e.length,userRoles:J,employeeName:Y.name,sampleItems:e.slice(0,3).map(e=>({purchase_order_number:e.purchase_order_number,requester_name:e.requester_name,vendor_name:e.vendor_name}))}),k(e)}catch(n){a.error("[DashboardMain] ë¯¸ë‹¤ìš´ë¡œë“œ ë°œì£¼ì„œ ì¡°íšŒ ì‹¤íŒ¨:",n),q.error("ë¯¸ë‹¤ìš´ë¡œë“œ ë°œì£¼ì„œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}}catch(i){a.error("[DashboardMain] Failed to load dashboard data:",i),q.error("ëŒ€ì‹œë³´ë“œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."),D(!1),s(null)}finally{t&&D(!1)}},[Y,J,e]);n.useEffect(()=>{W()},[W]);const z=n.useRef(!0);n.useEffect(()=>{const e=d(()=>{z.current?z.current=!1:W(!1,!0)});return()=>e()},[W]);const G=(e,t="pending")=>{E(Number(e.id)),V(t),L(!0)},X=n.useCallback((e,t)=>t.trim()?e.filter(e=>[e.purchase_order_number||"",e.vendor_name||"",(e.purchase_request_items||[]).map(e=>e.item_name||"").join(" ")].join(" ").toLowerCase().includes(t.toLowerCase())):e,[]),Z=n.useMemo(()=>X(F,B.undownloaded),[F,B.undownloaded,X]),ee=n.useMemo(()=>X(e?.pendingApprovals||[],B.pending),[e?.pendingApprovals,B.pending,X]),te=n.useMemo(()=>X(e?.myPurchaseStatus?.waitingPurchase||[],B.purchase),[e?.myPurchaseStatus?.waitingPurchase,B.purchase,X]),ae=n.useMemo(()=>X(e?.myPurchaseStatus?.waitingDelivery||[],B.delivery),[e?.myPurchaseStatus?.waitingDelivery,B.delivery,X]);if(r)return o.jsx("div",{className:"flex items-center justify-center",style:{minHeight:"400px",backgroundColor:"#f9fafb"},children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"w-12 h-12 border-3 border-hansl-500 border-t-transparent rounded-full animate-spin mx-auto"}),o.jsx("p",{className:"mt-4 card-subtitle",children:"ëŒ€ì‹œë³´ë“œë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìžˆìŠµë‹ˆë‹¤..."}),o.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:["Employee: ",Y?.name||"ì—†ìŒ"]})]})});if(!e?.employee)return a.warn("[DashboardMain] ë°ì´í„° ì—†ìŒ",{hasData:!!e,hasEmployee:!!Y,employeeName:Y?.name,loading:r}),o.jsx("div",{className:"flex items-center justify-center",style:{minHeight:"400px",backgroundColor:"#f9fafb"},children:o.jsxs("div",{className:"text-center bg-white p-8 rounded-lg border border-gray-200 shadow-sm",children:[o.jsx("h3",{className:"modal-subtitle mb-2",children:"ì‚¬ìš©ìž ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"}),o.jsx("p",{className:"card-subtitle mb-4",children:"ë¡œê·¸ì¸ì„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."}),o.jsxs("div",{className:"text-xs text-gray-400 space-y-1",children:[o.jsxs("p",{children:["Employee: ",Y?.name||"ì—†ìŒ"]}),o.jsxs("p",{children:["Loading: ",r?"true":"false"]}),o.jsxs("p",{children:["Has Data: ",e?"true":"false"]})]})]})});const se=(Array.isArray(e.employee.purchase_role)?e.employee.purchase_role.map(e=>String(e).trim()):e.employee.purchase_role?String(e.employee.purchase_role).split(",").map(e=>e.trim()).filter(e=>e.length>0):[]).some(e=>["middle_manager","final_approver","app_admin","raw_material_manager","consumable_manager"].includes(e));return o.jsxs("div",{className:"min-h-screen bg-gray-50",children:[o.jsxs("div",{className:"w-full px-4 lg:px-6",children:[o.jsx("div",{className:"mb-3",children:o.jsxs("div",{children:[o.jsx("h1",{className:"page-title",children:"ëŒ€ì‹œë³´ë“œ"}),o.jsx("p",{className:"page-subtitle",style:{marginTop:"-2px",marginBottom:"-4px"},children:"Dashboard"})]})}),o.jsx("div",{className:"mb-2",children:o.jsxs("h2",{className:"section-title mb-2 flex items-center gap-1.5",children:[o.jsx(c,{className:"w-3.5 h-3.5 text-gray-600"}),"ì „ì²´ í˜„í™©",o.jsx("span",{className:"badge-stats border border-gray-300 bg-white text-gray-600 ml-2",children:(new Date).toLocaleDateString("ko-KR",{month:"long",day:"numeric",weekday:"short"})})]})}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3",children:[(A.includes("lead buyer")||A.includes("app_admin"))&&o.jsxs(h,{className:"w-full col-span-1 row-span-2 border-gray-200 shadow-sm hover:shadow-md transition-shadow",children:[o.jsx(_,{className:"h-12 px-4 bg-gray-50 border-b flex items-center",children:o.jsxs(y,{className:"section-title flex items-center justify-between w-full",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(S,{className:"w-4 h-4 text-orange-600"}),o.jsx("span",{children:"ë¯¸ë‹¤ìš´ë¡œë“œ ë°œì£¼ì„œ"})]}),o.jsx("span",{className:"badge-stats bg-gray-200 text-gray-700",children:F.length})]})}),o.jsx(f,{className:"p-4",children:o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"relative",children:[o.jsx(v,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),o.jsx(x,{placeholder:"ë°œì£¼ë²ˆí˜¸, ì—…ì²´ëª…, í’ˆëª©ìœ¼ë¡œ ê²€ìƒ‰...",value:B.undownloaded,onChange:e=>K(t=>({...t,undownloaded:e.target.value})),className:"pl-10 h-8 text-xs"})]}),o.jsxs("div",{className:"space-y-2 h-[36rem] overflow-y-auto",children:[0===Z.length?o.jsxs("div",{className:"text-center py-12 text-gray-400",children:[o.jsx(S,{className:"w-10 h-10 mx-auto mb-3 text-gray-300"}),o.jsx("p",{className:"card-subtitle",children:"ë¯¸ë‹¤ìš´ë¡œë“œ ë°œì£¼ì„œê°€ ì—†ìŠµë‹ˆë‹¤"})]}):Z.map((e,t)=>{const s=e.purchase_request_items||[],r=s[0]||{},n="ì„ ì§„í–‰"===e.progress_type;return o.jsx("div",{className:"border rounded-lg p-2 hover:shadow-sm transition-all cursor-pointer mb-2 "+(n?"bg-red-50 border-red-200":"hover:bg-orange-50/30"),onClick:t=>{t.target.closest("button")||G(e,"pending")},children:o.jsxs("div",{className:"flex items-center justify-between gap-2",children:[o.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[o.jsx("span",{className:"card-title",children:e.purchase_order_number||`PO-${e.id.slice(0,8)}`}),o.jsx("span",{className:"card-subtitle truncate",children:e.vendor_name||"ì—…ì²´ëª… ì—†ìŒ"}),o.jsxs("span",{className:"card-description truncate",children:[r.item_name||"í’ˆëª©",s.length>1&&o.jsxs("span",{className:"text-gray-400",children:[" ì™¸ ",s.length-1,"ê±´"]})]})]}),o.jsx(u,{className:"button-base bg-gray-500 hover:bg-gray-600 text-white",onClick:async t=>{t.stopPropagation(),await(async e=>{try{I(t=>new Set(t).add(e.id)),await new Promise(e=>setTimeout(e,0)),await b({id:e.id,purchase_order_number:e.purchase_order_number,vendor_name:e.vendor_name,vendor_id:e.vendor_id,contact_id:e.contact_id},A,()=>{k(t=>t.filter(t=>t.id!==e.id))})}catch(t){a.error("Excel ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ",t)}finally{I(t=>{const a=new Set(t);return a.delete(e.id),a})}})(e)},disabled:O.has(e.id),children:O.has(e.id)?o.jsx("div",{className:"w-3 h-3 border border-white border-t-transparent rounded-full animate-spin"}):"ë‹¤ìš´ë¡œë“œ"})]})},`undownloaded-${e.id}`)}),Z.length>=100&&o.jsxs("div",{className:"text-center text-xs text-gray-500 mt-3 pb-2",children:["í‘œì‹œëœ í•­ëª©: ",Z.length,"ê°œ",o.jsx("br",{}),"ë” ë§Žì€ í•­ëª©ì´ ìžˆì„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ê²€ìƒ‰ìœ¼ë¡œ í•„í„°ë§í•˜ì„¸ìš”."]}),Z.length>0&&o.jsxs("div",{className:"text-center text-xs text-gray-400 mt-2 pb-2",children:["ì´ ",Z.length,"ê°œ ë¯¸ë‹¤ìš´ë¡œë“œ ë°œì£¼ì„œ"]})]})]})})]}),se&&o.jsxs(h,{className:"w-full col-span-1 row-span-2",children:[o.jsx(_,{className:"h-12 px-4 bg-gray-50 border-b flex items-center",children:o.jsxs(y,{className:"section-title flex items-center justify-between w-full",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(P,{className:"w-3.5 h-3.5 text-orange-500"}),o.jsx("span",{children:"ìŠ¹ì¸ ëŒ€ê¸°"})]}),e.pendingApprovals.length>0&&o.jsx("span",{className:"badge-stats bg-gray-200 text-gray-700",children:e.pendingApprovals.length})]})}),o.jsx(f,{className:"p-4",children:0===e.pendingApprovals.length?o.jsxs("div",{className:"text-center py-4 text-gray-400",children:[o.jsx(w,{className:"w-6 h-6 mx-auto mb-1"}),o.jsx("p",{className:"card-description",children:"ëŒ€ê¸° í•­ëª© ì—†ìŒ"})]}):o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"relative",children:[o.jsx(v,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),o.jsx(x,{placeholder:"ë°œì£¼ë²ˆí˜¸, ì—…ì²´ëª…, í’ˆëª©ìœ¼ë¡œ ê²€ìƒ‰...",value:B.pending,onChange:e=>K(t=>({...t,pending:e.target.value})),className:"pl-10 h-8 text-xs"})]}),o.jsx("div",{className:"space-y-2 h-[36rem] overflow-y-auto",children:ee.slice(0,10).map((t,a)=>{const r=t.purchase_request_items||[],n=r[0]||{};t.total_amount||r.reduce((e,t)=>e+(Number(t.amount_value)||0),0);const i="ì„ ì§„í–‰"===t.progress_type;return o.jsx("div",{className:"border rounded-lg p-2 hover:shadow-sm transition-all cursor-pointer mb-2 "+(i?"bg-red-50 border-red-200":"hover:bg-orange-50/30"),onClick:e=>{e.target.closest("button")||G(t,"pending")},children:o.jsxs("div",{className:"flex items-center justify-between gap-2",children:[o.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[o.jsx("span",{className:"card-title",children:t.purchase_order_number}),o.jsx("span",{className:"card-subtitle truncate",children:t.vendor_name||"ì—…ì²´"}),o.jsxs("span",{className:"card-description truncate",children:[n.item_name||"í’ˆëª©"," ",r.length>1&&`ì™¸ ${r.length-1}ê±´`]})]}),o.jsx(u,{onClick:async a=>{a.stopPropagation(),await(async t=>{if(!e?.employee)return void q.error("ì‚¬ìš©ìž ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");if(!confirm("ì •ë§ë¡œ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?"))return;C(t),await new Promise(e=>setTimeout(e,0));const a=e;s(e=>e?{...e,pendingApprovals:e.pendingApprovals.filter(e=>e.id!==t),stats:{...e.stats,pending:Math.max(0,e.stats.pending-1)}}:e);try{const r=await M.quickApprove(t,e.employee);r.success?(q.success("ìŠ¹ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."),setTimeout(()=>{W(!1)},1e3)):(s(a),q.error(r.error||"ìŠ¹ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."))}catch(r){s(a),q.error("ìŠ¹ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}finally{C(null)}})(t.id)},disabled:T===t.id,className:"button-base text-white "+("approved"===t.middle_manager_status?"bg-blue-600 hover:bg-blue-700":"bg-green-600 hover:bg-green-700"),children:T===t.id?o.jsx("div",{className:"w-3 h-3 border border-white border-t-transparent rounded-full animate-spin"}):o.jsxs(o.Fragment,{children:["approved"===t.middle_manager_status?"ìµœì¢…":"1ì°¨"," ìŠ¹ì¸"]})})]})},`approval-${t.id}`)})})]})})]}),(A.includes("lead buyer")||A.includes("app_admin"))&&o.jsxs(h,{className:"w-full col-span-1 border-gray-200 shadow-sm hover:shadow-md transition-shadow",children:[o.jsx(_,{className:"h-12 px-4 bg-gray-50 border-b flex items-center",children:o.jsxs(y,{className:"section-title flex items-center justify-between w-full",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(m,{className:"w-4 h-4 text-yellow-600"}),o.jsx("span",{children:"êµ¬ë§¤ ëŒ€ê¸°"})]}),e.myPurchaseStatus&&e.myPurchaseStatus.waitingPurchase&&e.myPurchaseStatus.waitingPurchase.length>0&&o.jsx("span",{className:"badge-stats bg-gray-200 text-gray-700",children:e.myPurchaseStatus.waitingPurchase.length})]})}),o.jsx(f,{className:"p-4",children:e.myPurchaseStatus&&e.myPurchaseStatus.waitingPurchase&&0!==e.myPurchaseStatus.waitingPurchase.length?o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"relative",children:[o.jsx(v,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),o.jsx(x,{placeholder:"ë°œì£¼ë²ˆí˜¸, ì—…ì²´ëª…, í’ˆëª©ìœ¼ë¡œ ê²€ìƒ‰...",value:B.purchase,onChange:e=>K(t=>({...t,purchase:e.target.value})),className:"pl-10 h-8 text-xs"})]}),o.jsx("div",{className:"space-y-2 h-[36rem] overflow-y-auto",children:te.map(e=>{const t=e.purchase_request_items||[],a=t[0];t.reduce((e,t)=>e+(Number(t.amount_value)||0),0);const s=(e.progress_type||"").includes("ì„ ì§„í–‰");return o.jsx("div",{className:"border rounded-lg p-2 transition-all hover:shadow-sm mb-2 "+(s?"bg-red-50 hover:bg-red-100 border-red-200":"bg-white hover:bg-gray-50 border-gray-200"),children:o.jsxs("div",{className:"flex items-center justify-between gap-2",children:[o.jsxs("div",{className:"flex items-center gap-2 flex-1 cursor-pointer",onClick:t=>{t.target.closest("button")||G(e,"purchase")},children:[o.jsx("span",{className:"card-title",children:e.purchase_order_number||`PO-${e.id.slice(0,8)}`}),o.jsx("span",{className:"card-subtitle truncate",children:e.vendor_name||"ì—…ì²´ëª… ì—†ìŒ"}),o.jsxs("span",{className:"card-description truncate",children:[a?.item_name||"í’ˆëª©",t.length>1&&o.jsxs("span",{className:"text-gray-400",children:[" ì™¸ ",t.length-1,"ê±´"]})]})]}),(A.includes("lead buyer")||A.includes("app_admin"))&&!e.is_payment_completed&&o.jsx(u,{onClick:async t=>{if(t.stopPropagation(),confirm("ì´ ë°œì£¼ë¥¼ êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")){await new Promise(e=>setTimeout(e,0));try{const{error:t}=await U.from("purchase_requests").update({is_payment_completed:!0,payment_completed_at:(new Date).toISOString()}).eq("id",e.id);if(t)throw t;p(e.id),q.success("êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.")}catch(a){q.error("ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}}},className:"button-base bg-orange-500 hover:bg-orange-600 text-white",children:"êµ¬ë§¤ì™„ë£Œ"}),e.is_payment_completed&&o.jsx("div",{className:"bg-green-100 text-green-700 px-2 py-1 business-radius-badge badge-text shrink-0",children:"ì™„ë£Œë¨"})]})},e.id)})})]}):o.jsxs("div",{className:"text-center py-12 text-gray-400",children:[o.jsx(m,{className:"w-10 h-10 mx-auto mb-3 text-gray-300"}),o.jsx("p",{className:"card-subtitle",children:"êµ¬ë§¤ ëŒ€ê¸° í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤"})]})})]}),o.jsxs(h,{className:"w-full col-span-1 border-gray-200 shadow-sm hover:shadow-md transition-shadow",children:[o.jsx(_,{className:"h-12 px-4 bg-gray-50 border-b flex items-center",children:o.jsxs(y,{className:"section-title flex items-center justify-between w-full",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(j,{className:"w-4 h-4 text-blue-600"}),o.jsx("span",{children:"ìž…ê³  ëŒ€ê¸°"})]}),e.myPurchaseStatus.waitingDelivery.length>0&&o.jsx("span",{className:"badge-stats bg-gray-200 text-gray-700",children:e.myPurchaseStatus.waitingDelivery.length})]})}),o.jsx(f,{className:"p-4",children:0===e.myPurchaseStatus.waitingDelivery.length?o.jsxs("div",{className:"text-center py-12 text-gray-400",children:[o.jsx(j,{className:"w-10 h-10 mx-auto mb-3 text-gray-300"}),o.jsx("p",{className:"card-subtitle",children:"ìž…ê³  ëŒ€ê¸° í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤"})]}):o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"relative",children:[o.jsx(v,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),o.jsx(x,{placeholder:"ë°œì£¼ë²ˆí˜¸, ì—…ì²´ëª…, í’ˆëª©ìœ¼ë¡œ ê²€ìƒ‰...",value:B.delivery,onChange:e=>K(t=>({...t,delivery:e.target.value})),className:"pl-10 h-8 text-xs"})]}),o.jsx("div",{className:"space-y-2 h-[36rem] overflow-y-auto",children:ae.slice(0,10).map(e=>{const t=e.purchase_request_items||[],a=t[0],s=t.length;t.filter(e=>e.is_received).length,t.reduce((e,t)=>e+(Number(t.amount_value)||0),0);const r=(e.progress_type||"").includes("ì„ ì§„í–‰");return o.jsx("div",{className:"border rounded-lg p-2 transition-all cursor-pointer hover:shadow-sm mb-2 "+(r?"bg-red-50 hover:bg-red-100 border-red-200":"bg-white hover:bg-gray-50 border-gray-200"),onClick:t=>{t.target.closest("button")||G(e,"receipt")},children:o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"card-title",children:e.purchase_order_number||`PO-${e.id.slice(0,8)}`}),o.jsx("span",{className:"card-subtitle truncate",children:e.vendor_name||"ì—…ì²´ëª… ì—†ìŒ"}),o.jsxs("span",{className:"card-description truncate",children:[a?.item_name||"í’ˆëª©",s>1&&o.jsxs("span",{className:"text-gray-400",children:[" ì™¸ ",s-1,"ê±´"]})]})]})},e.id)})})]})})]})]})]}),o.jsx(N,{purchaseId:$,isOpen:H,onClose:()=>{L(!1),E(null),V("pending")},currentUserRoles:A,activeTab:Q,onRefresh:()=>{W(!1),L(!1),E(null),V("pending")},onOptimisticUpdate:(e,t)=>{g(e,t),W(!1)}})]})}export{T as default};
//# sourceMappingURL=DashboardMain-CN_ZeuBr.js.map
