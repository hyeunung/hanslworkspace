{"version":3,"file":"PurchaseItemsModal-CWMJSaDw.js","sources":["../../src/components/purchase/PurchaseItemsModal.tsx"],"sourcesContent":["\nimport { useState, useCallback, useEffect, useMemo } from \"react\";\nimport { X, Edit2, Save, Trash2, Plus } from \"lucide-react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { format } from \"date-fns\";\nimport { createClient } from \"@/lib/supabase/client\";\nimport { toast } from \"sonner\";\nimport { ReceiptDownloadButton } from \"./ReceiptDownloadButton\";\nimport { DatePickerPopover } from \"@/components/ui/date-picker-popover\";\nimport { useConfirmDateAction } from '@/hooks/useConfirmDateAction';\nimport { logger } from '@/lib/logger';\n\ninterface PurchaseItem {\n  id?: number | string;\n  line_number?: number;\n  item_name: string;\n  specification?: string;\n  quantity: number;\n  unit_price_value?: number;\n  amount_value?: number;\n  remark?: string;\n  link?: string;\n  is_received?: boolean;\n  delivery_status?: string;\n  is_payment_completed?: boolean;\n  receipt_image_url?: string | null;\n  receipt_uploaded_at?: string | null;\n  receipt_uploaded_by?: string | null;\n  // 거래명세서 확인 관련 필드\n  is_statement_received?: boolean;\n  statement_received_date?: string | null;\n  statement_received_by_name?: string | null;\n}\n\ninterface PurchaseItemsModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  purchase: {\n    id: number;\n    purchase_order_number?: string;\n    vendor_name: string;\n    requester_name: string;\n    project_vendor: string;\n    sales_order_number: string;\n    project_item: string;\n    request_date: string;\n    delivery_request_date?: string | null;\n    revised_delivery_request_date?: string | null;\n    currency: string;\n    payment_category?: string;\n    items?: PurchaseItem[];\n    purchase_request_items?: PurchaseItem[];\n    total_amount: number;\n  };\n  isAdmin: boolean;\n  onUpdate: () => void;\n  activeTab?: string; // 활성 탭 정보 추가\n}\n\nexport default function PurchaseItemsModal({ isOpen, onClose, purchase, isAdmin, onUpdate, activeTab = 'done' }: PurchaseItemsModalProps) {\n  const [editingItems, setEditingItems] = useState<PurchaseItem[]>(purchase.purchase_request_items || []);\n  const [isEditing, setIsEditing] = useState(false);\n  const [currentUserName, setCurrentUserName] = useState<string>('');\n  const supabase = createClient();\n  \n  // 사용자 정보 및 최신 데이터 로드\n  useEffect(() => {\n    const loadData = async () => {\n      try {\n        const { data: { user } } = await supabase.auth.getUser();\n        if (user?.email) {\n          const { data: employeeData } = await supabase\n            .from('employees')\n            .select('name')\n            .eq('email', user.email)\n            .single();\n          \n          if (employeeData?.name) {\n            setCurrentUserName(employeeData.name);\n          } else {\n            setCurrentUserName(user.email);\n          }\n        }\n\n        // 최신 구매 요청 아이템 데이터 로드 (거래명세서 확인 필드 포함)\n        if (purchase.id) {\n          const { data: freshItems } = await supabase\n            .from('purchase_request_items')\n            .select('*')\n            .eq('purchase_request_id', purchase.id)\n            .order('line_number');\n          \n          if (freshItems) {\n            setEditingItems(freshItems);\n          }\n        }\n      } catch (error) {\n        logger.error('데이터 로드 실패', error);\n        setCurrentUserName('사용자');\n      }\n    };\n\n    if (isOpen) {\n      loadData();\n    }\n  }, [isOpen, supabase, purchase.id]);\n\n  // 권한 체크\n  const isRequester = purchase?.requester_name === currentUserName\n  const canReceiptCheck = isAdmin || isRequester\n  \n\n\n  // 모달 내부 데이터만 새로고침하는 함수 (모달 닫지 않음)\n  const refreshModalData = useCallback(async () => {\n    if (!purchase.id) return\n    \n    try {\n      // 최신 구매 요청 아이템 데이터 로드\n      const { data: freshItems } = await supabase\n        .from('purchase_request_items')\n        .select('*')\n        .eq('purchase_request_id', purchase.id)\n        .order('line_number')\n      \n      if (freshItems) {\n        setEditingItems(freshItems)\n        \n        // 모달 상태 유지를 위해 외부 onUpdate 호출 제거\n        // 외부 진행률 업데이트는 부모 컴포넌트에서 별도 처리\n      }\n    } catch (error) {\n      logger.error('모달 데이터 새로고침 실패', error)\n    }\n  }, [purchase.id, supabase])\n\n  // 커스텀 훅 설정\n  const statementReceivedAction = useConfirmDateAction({\n    config: {\n      field: 'statement_received',\n      confirmMessage: {\n        confirm: '거래명세서 확인을 처리하시겠습니까?',\n        cancel: '거래명세서 확인을 취소하시겠습니까?'\n      },\n      successMessage: {\n        confirm: '거래명세서 확인이 완료되었습니다.',\n        cancel: '거래명세서 확인이 취소되었습니다.'\n      },\n      completedText: '✓ 완료',\n      waitingText: '대기'\n    },\n    currentUserName,\n    canPerformAction: canReceiptCheck,\n    purchaseId: purchase.id,\n    onUpdate: refreshModalData\n  })\n\n  // 실제 입고 날짜 커스텀 훅 설정\n  const actualReceivedAction = useConfirmDateAction({\n    config: {\n      field: 'actual_received',\n      confirmMessage: {\n        confirm: '실제 입고 처리를 진행하시겠습니까?',\n        cancel: '실제 입고 처리를 취소하시겠습니까?'\n      },\n      successMessage: {\n        confirm: '실제 입고 처리가 완료되었습니다.',\n        cancel: '실제 입고 처리가 취소되었습니다.'\n      },\n      completedText: '입고완료',\n      waitingText: '입고대기'\n    },\n    currentUserName,\n    canPerformAction: canReceiptCheck,\n    purchaseId: purchase?.id,\n    onUpdate: refreshModalData\n  })\n  \n  // 품목 수정 시작\n  const handleEditStart = () => {\n    setIsEditing(true);\n    setEditingItems([...purchase.purchase_request_items || []]);\n  };\n\n  // 품목 수정 취소\n  const handleEditCancel = () => {\n    setIsEditing(false);\n    setEditingItems(purchase.purchase_request_items || []);\n  };\n\n  // 품목 값 변경\n  const handleItemChange = (index: number, field: keyof PurchaseItem, value: any) => {\n    const newItems = [...editingItems];\n    newItems[index] = {\n      ...newItems[index],\n      [field]: field === 'quantity' || field === 'unit_price_value' || field === 'amount_value' ? Number(value) : value\n    };\n    \n    // 금액 자동 계산 (amount_value를 직접 수정하는 경우가 아닐 때만)\n    if (field === 'quantity' || field === 'unit_price_value') {\n      const quantity = newItems[index].quantity || 0;\n      const unitPrice = newItems[index].unit_price_value || 0;\n      // 단가가 입력된 경우에만 자동 계산, 아니면 0 유지\n      newItems[index].amount_value = unitPrice > 0 ? quantity * unitPrice : 0;\n    }\n    \n    setEditingItems(newItems);\n  };\n\n  // 새 품목 추가\n  const handleAddItem = () => {\n    // 현재 최대 라인넘버 찾기\n    const maxLineNumber = editingItems.reduce((max, item) => {\n      const lineNum = item.line_number || 0;\n      return lineNum > max ? lineNum : max;\n    }, 0);\n\n    const newItem: PurchaseItem = {\n      line_number: maxLineNumber + 1,\n      item_name: '',\n      specification: '',\n      quantity: 1,\n      unit_price_value: undefined, // 단가 비워두기\n      amount_value: 0,\n      remark: '',\n      is_received: false\n    };\n    \n    // 새 아이템 추가 후 라인넘버 순서대로 정렬\n    const newItems = [...editingItems, newItem].sort((a, b) => {\n      const lineA = a.line_number || 999999;\n      const lineB = b.line_number || 999999;\n      return lineA - lineB;\n    });\n    \n    setEditingItems(newItems);\n  };\n\n  // 품목 삭제\n  const handleDeleteItem = (index: number) => {\n    const newItems = editingItems.filter((_, i) => i !== index).sort((a, b) => {\n      const lineA = a.line_number || 999999;\n      const lineB = b.line_number || 999999;\n      return lineA - lineB;\n    });\n    setEditingItems(newItems);\n  };\n\n  // 품목 저장\n  const handleSave = async () => {\n    try {\n\n      // 유효성 검사 - 품목명만 필수\n      const invalidItems = editingItems.filter(item => \n        !item.item_name || !item.item_name.trim()\n      );\n      \n      if (invalidItems.length > 0) {\n        toast.error('품목명은 필수 입력 항목입니다.');\n        return;\n      }\n\n      // 기존 품목 삭제\n      const { error: deleteError } = await supabase\n        .from('purchase_request_items')\n        .delete()\n        .eq('purchase_request_id', purchase.id);\n\n      if (deleteError) {\n        logger.error('기존 품목 삭제 실패', deleteError);\n        throw deleteError;\n      }\n\n      // 새 품목 추가\n      const itemsToInsert = editingItems.map(item => ({\n        purchase_request_id: purchase.id,\n        purchase_order_number: purchase.purchase_order_number,\n        line_number: item.line_number,\n        item_name: item.item_name.trim(),\n        specification: item.specification || '',\n        quantity: Number(item.quantity) || 0,\n        unit_price_value: item.unit_price_value !== null && item.unit_price_value !== undefined ? Number(item.unit_price_value) : null,\n        amount_value: Number(item.amount_value) || 0,\n        remark: item.remark || '',\n        link: item.link || null,\n        is_received: item.is_received || false,\n        delivery_status: item.delivery_status || 'pending'\n      }));\n\n\n      const { error: insertError } = await supabase\n        .from('purchase_request_items')\n        .insert(itemsToInsert);\n\n      if (insertError) {\n        logger.error('품목 삽입 실패', insertError);\n        throw insertError;\n      }\n\n      // 총금액 업데이트\n      const totalAmount = editingItems.reduce((sum, item) => sum + (Number(item.amount_value) || 0), 0);\n      const { error: updateError } = await supabase\n        .from('purchase_requests')\n        .update({ total_amount: totalAmount })\n        .eq('id', purchase.id);\n\n      if (updateError) {\n        logger.error('총금액 업데이트 실패', updateError);\n        throw updateError;\n      }\n\n      toast.success('품목이 수정되었습니다.');\n      setIsEditing(false);\n      onUpdate();\n      onClose();\n    } catch (error) {\n      logger.error('품목 저장 중 오류', error);\n      toast.error(`저장 중 오류가 발생했습니다: ${error instanceof Error ? error.message : error}`);\n    }\n  };\n  \n  const baseItems = editingItems.length > 0 ? editingItems : (purchase.purchase_request_items || []);\n  const items = isEditing ? editingItems : baseItems;\n\n  const tableMinWidth = useMemo(() => {\n    const data = items.length > 0 ? items : baseItems;\n    if (!data || data.length === 0) {\n      return 960;\n    }\n\n    const columnDefs = [\n      { key: 'index', base: 64, header: 'No.', accessor: (_item: PurchaseItem, index: number) => `${index + 1}` },\n      { key: 'item_name', base: 150, max: 320, header: '품목', accessor: (item: PurchaseItem) => item.item_name },\n      { key: 'specification', base: 150, max: 320, header: '규격', accessor: (item: PurchaseItem) => item.specification },\n      { key: 'quantity', base: 90, header: '수량', accessor: (item: PurchaseItem) => item.quantity != null ? item.quantity.toLocaleString() : '' },\n      { key: 'unit_price_value', base: 120, header: '단가', accessor: (item: PurchaseItem) => item.unit_price_value != null ? item.unit_price_value.toLocaleString() : '' },\n      { key: 'amount_value', base: 140, header: '금액', accessor: (item: PurchaseItem) => item.amount_value != null ? item.amount_value.toLocaleString() : '' },\n      { key: 'remark', base: 140, max: 320, header: '비고', accessor: (item: PurchaseItem) => item.remark }\n    ];\n\n    const widths = columnDefs.map((col, index) => {\n      const values = data.map((item: any, rowIndex: number) => {\n        if (col.accessor) {\n          return col.accessor(item, rowIndex) ?? '';\n        }\n        return '';\n      });\n      const headerLength = col.header ? col.header.length : 0;\n      const maxLen = Math.max(headerLength, ...values.map((value: any) => (value ? String(value).length : 0)));\n      const computed = maxLen * 8 + 32;\n      const limited = col.max ? Math.min(col.max, computed) : computed;\n      return Math.max(col.base, limited);\n    });\n\n    if (activeTab === 'purchase') {\n      widths.push(120);\n    }\n\n    if (activeTab === 'receipt' || activeTab === 'done') {\n      widths.push(120);\n    }\n\n    if (activeTab === 'receipt') {\n      widths.push(140);\n    }\n\n    if (activeTab === 'done') {\n      widths.push(140, 140, 110);\n    }\n\n    if (isEditing) {\n      widths.push(100);\n    }\n\n    const gap = widths.length > 1 ? (widths.length - 1) * 16 : 0;\n    const padding = 48;\n    const total = widths.reduce((sum, width) => sum + width, 0) + gap + padding;\n    return Math.max(total, 960);\n  }, [items, baseItems, activeTab, isEditing]);\n\n  const totalAmount = items.reduce((sum: number, item: any) => sum + (item.amount_value || 0), 0);\n  \n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent \n        className=\"w-full sm:w-auto max-w-[92vw] sm:max-w-[88vw] lg:max-w-[90vw] xl:max-w-[85vw] h-[95vh] sm:h-auto max-h-[90vh] flex flex-col bg-white p-3 sm:p-6\"\n        maxWidth=\"max-w-none\"\n        showCloseButton={false}\n      >\n        <DialogHeader className=\"flex-shrink-0\">\n          <div className=\"flex items-center justify-between\">\n            <DialogTitle className=\"modal-title\">\n              발주 상세 항목 - {purchase.purchase_order_number}\n            </DialogTitle>\n            <div className=\"flex items-center gap-2\">\n              {isAdmin && !isEditing && (\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={handleEditStart}\n                >\n                  <Edit2 className=\"h-4 w-4 mr-1\" />\n                  편집\n                </Button>\n              )}\n              {isEditing && (\n                <>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={handleAddItem}\n                  >\n                    <Plus className=\"h-4 w-4 mr-1\" />\n                    품목 추가\n                  </Button>\n                  <Button\n                    variant=\"default\"\n                    size=\"sm\"\n                    onClick={handleSave}\n                  >\n                    <Save className=\"h-4 w-4 mr-1\" />\n                    저장\n                  </Button>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={handleEditCancel}\n                  >\n                    취소\n                  </Button>\n                </>\n              )}\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                onClick={onClose}\n                className=\"h-6 w-6\"\n              >\n                <X className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </div>\n        </DialogHeader>\n        \n        <div className=\"flex-shrink-0 grid grid-cols-2 md:grid-cols-4 gap-3 py-3 border-b\">\n          <div>\n            <p className=\"modal-label\">업체명</p>\n            <p className=\"modal-value\">{purchase.vendor_name}</p>\n          </div>\n          <div>\n            <p className=\"modal-label\">요청자</p>\n            <p className=\"modal-value\">{purchase.requester_name}</p>\n          </div>\n          <div>\n            <p className=\"modal-label\">프로젝트</p>\n            <p className=\"modal-value truncate\" title={purchase.project_vendor}>\n              {purchase.project_vendor}\n            </p>\n          </div>\n          <div>\n            <p className=\"modal-label\">납기일</p>\n            <p className=\"modal-value\">\n              {purchase.delivery_request_date && \n                format(new Date(purchase.delivery_request_date), 'yyyy-MM-dd')}\n            </p>\n          </div>\n        </div>\n        \n        <div className=\"flex-1 min-h-0\">\n          <div className=\"h-full overflow-x-auto\">\n            <div className=\"inline-block align-top\" style={{ minWidth: `${tableMinWidth}px` }}>\n              <div className=\"max-h-[60vh] overflow-y-auto\">\n                <table className=\"w-full text-[13px] leading-[1.6] border-collapse\" style={{ minWidth: `${tableMinWidth}px` }}>\n              <thead className=\"sticky top-0 bg-white z-10 shadow-sm\">\n                <tr>\n                  <th className=\"px-3 py-2 text-left font-medium text-gray-600 w-16 min-w-[64px]\">No.</th>\n                  <th className=\"px-3 py-2 text-left font-medium text-gray-600 min-w-[140px]\">품목</th>\n                  <th className=\"px-3 py-2 text-left font-medium text-gray-600 min-w-[120px]\">규격</th>\n                  <th className=\"px-3 py-2 text-right font-medium text-gray-600 min-w-[80px]\">수량</th>\n                  <th className=\"px-3 py-2 text-right font-medium text-gray-600 min-w-[110px]\">단가</th>\n                  <th className=\"px-3 py-2 text-right font-medium text-gray-600 min-w-[130px]\">금액</th>\n                {activeTab === 'purchase' && (\n                    <th className=\"px-3 py-2 text-left font-medium text-gray-600 min-w-[110px]\">구매상태</th>\n                )}\n                {(activeTab === 'receipt' || activeTab === 'done') && (\n                    <th className=\"px-3 py-2 text-left font-medium text-gray-600 min-w-[110px]\">입고상태</th>\n                )}\n                {activeTab === 'done' && (\n                  <>\n                      <th className=\"px-3 py-2 text-center font-medium text-gray-600 min-w-[130px]\">거래명세서 확인</th>\n                      <th className=\"px-3 py-2 text-center font-medium text-gray-600 min-w-[130px]\">회계상 입고일</th>\n                      <th className=\"px-3 py-2 text-center font-medium text-gray-600 min-w-[90px]\">처리자</th>\n                  </>\n                )}\n                {activeTab === 'receipt' && (\n                    <th className=\"px-3 py-2 text-center font-medium text-gray-600 min-w-[130px]\">실제 입고일</th>\n                )}\n                  <th className=\"px-3 py-2 text-left font-medium text-gray-600 min-w-[110px]\">비고</th>\n                  {isEditing && <th className=\"px-3 py-2 text-left font-medium text-gray-600 w-20 min-w-[90px]\">삭제</th>}\n                </tr>\n              </thead>\n              <tbody>\n              {(isEditing ? editingItems : items).map((item: any, index: number) => (\n                  <tr key={item.id || index} className=\"border-b last:border-b-0\">\n                    <td className=\"px-3 py-2 text-center align-top modal-value\">{item.line_number || index + 1}</td>\n                    <td className=\"px-3 py-2 align-top min-w-[140px]\">\n                    {isEditing ? (\n                      <Input\n                        value={item.item_name}\n                        onChange={(e) => handleItemChange(index, 'item_name', e.target.value)}\n                        className=\"h-7 modal-label w-full\"\n                      />\n                    ) : (\n                      <div className=\"max-w-[200px]\">\n                        <p className=\"modal-value truncate\" title={item.item_name}>\n                          {item.item_name}\n                        </p>\n                      </div>\n                    )}\n                  </td>\n                  <td className=\"px-3 py-2 align-top min-w-[120px]\">\n                    {isEditing ? (\n                      <Input\n                        value={item.specification}\n                        onChange={(e) => handleItemChange(index, 'specification', e.target.value)}\n                        className=\"h-7 modal-label w-full\"\n                      />\n                    ) : (\n                      <div className=\"max-w-[150px] truncate\" title={item.specification}>\n                        {item.specification}\n                      </div>\n                    )}\n                  </td>\n                  <td className=\"px-3 py-2 text-right align-top min-w-[80px]\">\n                    {isEditing ? (\n                      <Input\n                        type=\"number\"\n                        value={item.quantity}\n                        onChange={(e) => handleItemChange(index, 'quantity', e.target.value)}\n                        className=\"h-7 text-xs text-right w-full\"\n                      />\n                    ) : (\n                      <div className=\"text-right\">\n                        <span className=\"modal-value\" style={{display: 'block', textAlign: 'right'}}>{item.quantity.toLocaleString()}</span>\n                      </div>\n                    )}\n                  </td>\n                  <td className=\"px-3 py-2 text-right align-top min-w-[110px]\">\n                    {isEditing ? (\n                      <Input\n                        type=\"number\"\n                        value={item.unit_price_value}\n                        onChange={(e) => handleItemChange(index, 'unit_price_value', e.target.value)}\n                        className=\"h-7 text-xs text-right w-full\"\n                      />\n                    ) : (\n                      <div className=\"text-right\">\n                        <span className=\"modal-subtitle\" style={{display: 'block', textAlign: 'right'}}>{(item.unit_price_value || 0).toLocaleString()} {purchase.currency}</span>\n                      </div>\n                    )}\n                  </td>\n                  <td className=\"px-3 py-2 text-right align-top min-w-[130px]\">\n                    {isEditing ? (\n                      <Input\n                        type=\"number\"\n                        value={item.amount_value}\n                        onChange={(e) => handleItemChange(index, 'amount_value', e.target.value)}\n                        className=\"h-7 modal-label text-right w-full\"\n                      />\n                    ) : (\n                      <div className=\"text-right\">\n                        <span className=\"modal-value\" style={{display: 'block', textAlign: 'right'}}>{(item.amount_value || 0).toLocaleString()} {purchase.currency}</span>\n                      </div>\n                    )}\n                  </td>\n                  {activeTab === 'purchase' && (\n                    <td className=\"px-3 py-2 align-top min-w-[110px]\">\n                      {/* 구매상태 - 구매완료/취소 버튼 */}\n                      {canReceiptCheck ? (\n                        item.is_payment_completed ? (\n                          <button\n                            onClick={async () => {\n                              try {\n\n                                if (!item.id) {\n                                  throw new Error('품목 ID가 없습니다.');\n                                }\n\n                                const { error, data } = await supabase\n                                  .from('purchase_request_items')\n                                  .update({ is_payment_completed: false })\n                                  .eq('id', item.id)\n                                  .select();\n                                \n                                if (error) {\n                                  logger.error('구매취소 업데이트 실패', error);\n                                  throw error;\n                                }\n\n                                toast.success('구매 취소 처리되었습니다.');\n                                await refreshModalData();\n                              } catch (error) {\n                                logger.error('구매취소 처리 중 오류', error);\n                                toast.error(`처리 중 오류가 발생했습니다: ${error instanceof Error ? error.message : error}`);\n                              }\n                            }}\n                            className=\"button-base bg-green-500 hover:bg-green-600 text-white transition-colors\"\n                            title=\"클릭하여 구매 취소\"\n                          >\n                            구매완료\n                          </button>\n                        ) : (\n                          <button\n                            onClick={async () => {\n                              try {\n\n                                if (!item.id) {\n                                  throw new Error('품목 ID가 없습니다.');\n                                }\n\n                                const { error, data } = await supabase\n                                  .from('purchase_request_items')\n                                  .update({ is_payment_completed: true })\n                                  .eq('id', item.id)\n                                  .select();\n                                \n                                if (error) {\n                                  logger.error('구매완료 업데이트 실패', error);\n                                  throw error;\n                                }\n\n                                toast.success('구매완료 처리되었습니다.');\n                                await refreshModalData();\n                              } catch (error) {\n                                logger.error('구매완료 처리 중 오류', error);\n                                toast.error(`처리 중 오류가 발생했습니다: ${error instanceof Error ? error.message : error}`);\n                              }\n                            }}\n                            className=\"button-base border border-gray-300 text-gray-600 bg-white hover:bg-gray-50\"\n                          >\n                            구매대기\n                          </button>\n                        )\n                      ) : (\n                        <span className={`button-base ${\n                          item.is_payment_completed\n                            ? 'bg-green-500 text-white' \n                            : 'border border-gray-300 text-gray-400 bg-white'\n                        }`}>\n                          {item.is_payment_completed ? '구매완료' : '구매대기'}\n                        </span>\n                      )}\n                    </td>\n                  )}\n                  {(activeTab === 'receipt' || activeTab === 'done') && (\n                    <td className=\"px-3 py-2 align-top min-w-[110px]\">\n                      {/* 입고현황 탭에서는 실제 입고 날짜 기능 사용 */}\n                      {activeTab === 'receipt' ? (\n                        canReceiptCheck ? (\n                          actualReceivedAction.isCompleted(item) ? (\n                            <button\n                              onClick={() => {\n                                actualReceivedAction.handleCancel(item.id!, {\n                                  item_name: item.item_name,\n                                  specification: item.specification,\n                                  quantity: item.quantity,\n                                  unit_price_value: item.unit_price_value,\n                                  amount_value: item.amount_value,\n                                  remark: item.remark\n                                })\n                              }}\n                              className=\"button-base bg-green-500 hover:bg-green-600 text-white transition-colors\"\n                              title=\"클릭하여 실제 입고 처리 취소\"\n                            >\n                              {actualReceivedAction.config.completedText}\n                            </button>\n                          ) : (\n                            <DatePickerPopover\n                              onDateSelect={(date) => {\n                                actualReceivedAction.handleConfirm(item.id!, date, {\n                                  item_name: item.item_name,\n                                  specification: item.specification,\n                                  quantity: item.quantity,\n                                  unit_price_value: item.unit_price_value,\n                                  amount_value: item.amount_value,\n                                  remark: item.remark\n                                })\n                              }}\n                              placeholder=\"실제 입고 날짜 선택\"\n                            >\n                              <Button \n                                variant=\"outline\" \n                                size=\"sm\"\n                                className=\"button-base border border-gray-300 text-gray-600 bg-white hover:bg-gray-50\"\n                              >\n                                {actualReceivedAction.config.waitingText}\n                              </Button>\n                            </DatePickerPopover>\n                          )\n                        ) : (\n                          <span className={`button-base ${\n                            actualReceivedAction.isCompleted(item)\n                              ? 'bg-green-500 text-white' \n                              : 'border border-gray-300 text-gray-400 bg-white'\n                          }`}>\n                            {actualReceivedAction.isCompleted(item) ? actualReceivedAction.config.completedText : actualReceivedAction.config.waitingText}\n                          </span>\n                        )\n                      ) : (\n                        /* 전체항목 탭에서는 상태 표시만 */\n                        <span className={`button-base ${\n                          actualReceivedAction.isCompleted(item)\n                            ? 'bg-green-500 text-white' \n                            : 'border border-gray-300 text-gray-600 bg-white'\n                        }`}>\n                          {actualReceivedAction.isCompleted(item) ? actualReceivedAction.config.completedText : actualReceivedAction.config.waitingText}\n                        </span>\n                      )}\n                    </td>\n                  )}\n                  {activeTab === 'receipt' && (\n                    <td className=\"px-3 py-2 text-center align-top min-w-[130px]\">\n                      {actualReceivedAction.getCompletedDate(item) ? (\n                        <span className=\"modal-subtitle text-green-600\">\n                          {format(new Date(actualReceivedAction.getCompletedDate(item)), 'yyyy-MM-dd HH:mm')}\n                        </span>\n                      ) : (\n                        <span className=\"modal-subtitle\">-</span>\n                      )}\n                    </td>\n                  )}\n                  {activeTab === 'done' && (\n                    <>\n                      <td className=\"px-3 py-2 text-center align-top min-w-[130px]\">\n                        {canReceiptCheck ? (\n                          statementReceivedAction.isCompleted(item) ? (\n                            <button\n                              onClick={() => {\n                                statementReceivedAction.handleCancel(item.id!, {\n                                  item_name: item.item_name,\n                                  specification: item.specification,\n                                  quantity: item.quantity,\n                                  unit_price_value: item.unit_price_value,\n                                  amount_value: item.amount_value,\n                                  remark: item.remark\n                                })\n                              }}\n                              className=\"button-base bg-green-500 hover:bg-green-600 text-white transition-colors\"\n                              title=\"클릭하여 거래명세서 확인 취소\"\n                            >\n                              {statementReceivedAction.config.completedText}\n                            </button>\n                          ) : (\n                            <DatePickerPopover\n                              onDateSelect={(date) => {\n                                statementReceivedAction.handleConfirm(item.id!, date, {\n                                  item_name: item.item_name,\n                                  specification: item.specification,\n                                  quantity: item.quantity,\n                                  unit_price_value: item.unit_price_value,\n                                  amount_value: item.amount_value,\n                                  remark: item.remark\n                                })\n                              }}\n                              placeholder=\"날짜 선택\"\n                            >\n                              <Button \n                                variant=\"outline\" \n                                size=\"sm\"\n                                className=\"button-base border border-gray-300 text-gray-600 bg-white hover:bg-gray-50\"\n                              >\n                                {statementReceivedAction.config.waitingText}\n                              </Button>\n                            </DatePickerPopover>\n                          )\n                        ) : (\n                          <span className={`button-base ${\n                            statementReceivedAction.isCompleted(item)\n                              ? 'bg-green-500 text-white' \n                              : 'border border-gray-300 text-gray-400 bg-white'\n                          }`}>\n                            {statementReceivedAction.isCompleted(item) ? statementReceivedAction.config.completedText : statementReceivedAction.config.waitingText}\n                          </span>\n                        )}\n                      </td>\n                      <td className=\"px-3 py-2 text-center align-top min-w-[130px]\">\n                        {statementReceivedAction.getCompletedDate(item) ? (\n                          <span className=\"modal-subtitle\">\n                            {format(new Date(statementReceivedAction.getCompletedDate(item)), 'yyyy-MM-dd')}\n                          </span>\n                        ) : (\n                          <span className=\"modal-subtitle\">-</span>\n                        )}\n                      </td>\n                      <td className=\"px-3 py-2 text-center align-top min-w-[90px]\">\n                        {statementReceivedAction.getCompletedByName(item) ? (\n                          <span className=\"modal-subtitle\">\n                            {statementReceivedAction.getCompletedByName(item)}\n                          </span>\n                        ) : (\n                          <span className=\"modal-subtitle\">-</span>\n                        )}\n                      </td>\n                    </>\n                  )}\n                  <td className=\"px-3 py-2 align-top min-w-[110px]\">\n                    {isEditing ? (\n                      <Input\n                        value={item.remark || ''}\n                        onChange={(e) => handleItemChange(index, 'remark', e.target.value)}\n                        className=\"h-7 modal-label w-full\"\n                        placeholder=\"비고\"\n                      />\n                    ) : (\n                      <div className=\"max-w-[150px]\">\n                        <span className=\"modal-subtitle truncate block\" title={item.remark}>\n                          {item.remark || '-'}\n                        </span>\n                      </div>\n                    )}\n                  </td>\n                  {isEditing && (\n                    <td className=\"px-3 py-2 align-top min-w-[90px]\">\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        onClick={() => handleDeleteItem(index)}\n                        className=\"h-7 w-7 text-red-500 hover:text-red-700\"\n                      >\n                        <Trash2 className=\"h-4 w-4\" />\n                      </Button>\n                    </td>\n                  )}\n                </tr>\n              ))}\n              </tbody>\n            </table>\n              </div>\n            </div>\n          </div>\n        </div>\n        \n        <div className=\"flex-shrink-0 border-t pt-4 flex justify-between items-center\">\n          <div className=\"modal-subtitle\">\n            총 {items.length}개 품목\n          </div>\n          <div className=\"modal-value-large\">\n            총 금액: {totalAmount.toLocaleString()} {purchase.currency}\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}"],"names":["PurchaseItemsModal","isOpen","onClose","purchase","isAdmin","onUpdate","activeTab","editingItems","setEditingItems","useState","purchase_request_items","isEditing","setIsEditing","currentUserName","setCurrentUserName","supabase","createClient","useEffect","async","data","user","auth","getUser","email","employeeData","from","select","eq","single","name","id","freshItems","order","error","logger","loadData","canReceiptCheck","requester_name","refreshModalData","useCallback","statementReceivedAction","useConfirmDateAction","config","field","confirmMessage","confirm","cancel","successMessage","completedText","waitingText","canPerformAction","purchaseId","actualReceivedAction","handleItemChange","index","value","newItems","Number","quantity","unitPrice","unit_price_value","amount_value","baseItems","length","items","tableMinWidth","useMemo","widths","key","base","header","accessor","_item","max","item","item_name","specification","toLocaleString","remark","map","col","values","rowIndex","headerLength","computed","Math","String","limited","min","push","gap","total","reduce","sum","width","totalAmount","jsx","Dialog","open","onOpenChange","children","jsxs","DialogContent","className","maxWidth","showCloseButton","DialogHeader","DialogTitle","purchase_order_number","Button","variant","size","onClick","Edit2","Fragment","newItem","line_number","lineNum","is_received","sort","a","b","Plus","filter","trim","toast","deleteError","delete","itemsToInsert","purchase_request_id","link","delivery_status","insertError","insert","updateError","update","total_amount","success","Error","message","Save","X","vendor_name","title","project_vendor","delivery_request_date","format","Date","style","minWidth","Input","onChange","e","target","type","display","textAlign","currency","is_payment_completed","isCompleted","handleCancel","DatePickerPopover","onDateSelect","date","handleConfirm","placeholder","getCompletedDate","getCompletedByName","_","i","handleDeleteItem","Trash2"],"mappings":"wnBA6DA,SAAwBA,GAAmBC,OAAEA,EAAAC,QAAQA,EAAAC,SAASA,UAAUC,EAAAC,SAASA,EAAAC,UAAUA,EAAY,SACrG,MAAOC,EAAcC,GAAmBC,EAAAA,SAAyBN,EAASO,wBAA0B,KAC7FC,EAAWC,GAAgBH,EAAAA,UAAS,IACpCI,EAAiBC,GAAsBL,EAAAA,SAAiB,IACzDM,EAAWC,IAGjBC,EAAAA,UAAU,KAoCJhB,GAnCaiB,WACf,IACE,MAAQC,MAAMC,KAAEA,UAAiBL,EAASM,KAAKC,UAC/C,GAAIF,GAAMG,MAAO,CACf,MAAQJ,KAAMK,SAAuBT,EAClCU,KAAK,aACLC,OAAO,QACPC,GAAG,QAASP,EAAKG,OACjBK,SAGDd,EADEU,GAAcK,KACGL,EAAaK,KAEbT,EAAKG,MAE5B,CAGA,GAAIpB,EAAS2B,GAAI,CACf,MAAQX,KAAMY,SAAqBhB,EAChCU,KAAK,0BACLC,OAAO,KACPC,GAAG,sBAAuBxB,EAAS2B,IACnCE,MAAM,eAELD,GACFvB,EAAgBuB,EAEpB,CACF,OAASE,GACPC,EAAOD,MAAM,YAAaA,GAC1BnB,EAAmB,MACrB,GAIAqB,IAED,CAAClC,EAAQc,EAAUZ,EAAS2B,KAG/B,MACMM,EAAkBhC,GADJD,GAAUkC,iBAAmBxB,EAM3CyB,EAAmBC,EAAAA,YAAYrB,UACnC,GAAKf,EAAS2B,GAEd,IAEE,MAAQX,KAAMY,SAAqBhB,EAChCU,KAAK,0BACLC,OAAO,KACPC,GAAG,sBAAuBxB,EAAS2B,IACnCE,MAAM,eAELD,GACFvB,EAAgBuB,EAKpB,OAASE,GACPC,EAAOD,MAAM,iBAAkBA,EACjC,GACC,CAAC9B,EAAS2B,GAAIf,IAGXyB,EAA0BC,EAAqB,CACnDC,OAAQ,CACNC,MAAO,qBACPC,eAAgB,CACdC,QAAS,sBACTC,OAAQ,uBAEVC,eAAgB,CACdF,QAAS,qBACTC,OAAQ,sBAEVE,cAAe,OACfC,YAAa,MAEfpC,kBACAqC,iBAAkBd,EAClBe,WAAYhD,EAAS2B,GACrBzB,SAAUiC,IAINc,EAAuBX,EAAqB,CAChDC,OAAQ,CACNC,MAAO,kBACPC,eAAgB,CACdC,QAAS,sBACTC,OAAQ,uBAEVC,eAAgB,CACdF,QAAS,qBACTC,OAAQ,sBAEVE,cAAe,OACfC,YAAa,QAEfpC,kBACAqC,iBAAkBd,EAClBe,WAAYhD,GAAU2B,GACtBzB,SAAUiC,IAgBNe,EAAmB,CAACC,EAAeX,EAA2BY,KAClE,MAAMC,EAAW,IAAIjD,GAOrB,GANAiD,EAASF,GAAS,IACbE,EAASF,GACZX,CAACA,GAAkB,aAAVA,GAAkC,qBAAVA,GAA0C,iBAAVA,EAA2Bc,OAAOF,GAASA,GAIhG,aAAVZ,GAAkC,qBAAVA,EAA8B,CACxD,MAAMe,EAAWF,EAASF,GAAOI,UAAY,EACvCC,EAAYH,EAASF,GAAOM,kBAAoB,EAEtDJ,EAASF,GAAOO,aAAeF,EAAY,EAAID,EAAWC,EAAY,CACxE,CAEAnD,EAAgBgD,IAmHZM,EAAYvD,EAAawD,OAAS,EAAIxD,EAAgBJ,EAASO,wBAA0B,GACzFsD,EAAQrD,EAAYJ,EAAeuD,EAEnCG,EAAgBC,EAAAA,QAAQ,KAC5B,MAAM/C,EAAO6C,EAAMD,OAAS,EAAIC,EAAQF,EACxC,IAAK3C,GAAwB,IAAhBA,EAAK4C,OAChB,OAAO,IAGT,MAUMI,EAVa,CACjB,CAAEC,IAAK,QAASC,KAAM,GAAIC,OAAQ,MAAOC,SAAU,CAACC,EAAqBlB,IAAkB,GAAGA,EAAQ,KACtG,CAAEc,IAAK,YAAaC,KAAM,IAAKI,IAAK,IAAKH,OAAQ,KAAMC,SAAWG,GAAuBA,EAAKC,WAC9F,CAAEP,IAAK,gBAAiBC,KAAM,IAAKI,IAAK,IAAKH,OAAQ,KAAMC,SAAWG,GAAuBA,EAAKE,eAClG,CAAER,IAAK,WAAYC,KAAM,GAAIC,OAAQ,KAAMC,SAAWG,GAAwC,MAAjBA,EAAKhB,SAAmBgB,EAAKhB,SAASmB,iBAAmB,IACtI,CAAET,IAAK,mBAAoBC,KAAM,IAAKC,OAAQ,KAAMC,SAAWG,GAAgD,MAAzBA,EAAKd,iBAA2Bc,EAAKd,iBAAiBiB,iBAAmB,IAC/J,CAAET,IAAK,eAAgBC,KAAM,IAAKC,OAAQ,KAAMC,SAAWG,GAA4C,MAArBA,EAAKb,aAAuBa,EAAKb,aAAagB,iBAAmB,IACnJ,CAAET,IAAK,SAAUC,KAAM,IAAKI,IAAK,IAAKH,OAAQ,KAAMC,SAAWG,GAAuBA,EAAKI,SAGnEC,IAAI,CAACC,EAAK1B,KAClC,MAAM2B,EAAS9D,EAAK4D,IAAI,CAACL,EAAWQ,IAC9BF,EAAIT,SACCS,EAAIT,SAASG,EAAMQ,IAAa,GAElC,IAEHC,EAAeH,EAAIV,OAASU,EAAIV,OAAOP,OAAS,EAEhDqB,EAAoB,EADXC,KAAKZ,IAAIU,KAAiBF,EAAOF,IAAKxB,GAAgBA,EAAQ+B,OAAO/B,GAAOQ,OAAS,IACtE,GACxBwB,EAAUP,EAAIP,IAAMY,KAAKG,IAAIR,EAAIP,IAAKW,GAAYA,EACxD,OAAOC,KAAKZ,IAAIO,EAAIX,KAAMkB,KAGV,aAAdjF,GACF6D,EAAOsB,KAAK,KAGI,YAAdnF,GAAyC,SAAdA,GAC7B6D,EAAOsB,KAAK,KAGI,YAAdnF,GACF6D,EAAOsB,KAAK,KAGI,SAAdnF,GACF6D,EAAOsB,KAAK,IAAK,IAAK,KAGpB9E,GACFwD,EAAOsB,KAAK,KAGd,MAAMC,EAAMvB,EAAOJ,OAAS,EAA0B,IAArBI,EAAOJ,OAAS,GAAU,EAErD4B,EAAQxB,EAAOyB,OAAO,CAACC,EAAKC,IAAUD,EAAMC,EAAO,GAAKJ,EAD9C,GAEhB,OAAOL,KAAKZ,IAAIkB,EAAO,MACtB,CAAC3B,EAAOF,EAAWxD,EAAWK,IAE3BoF,EAAc/B,EAAM4B,OAAO,CAACC,EAAanB,IAAcmB,GAAOnB,EAAKb,cAAgB,GAAI,GAE7F,OACEmC,EAAAA,IAACC,EAAA,CAAOC,KAAMjG,EAAQkG,aAAcjG,EAClCkG,SAAAC,EAAAA,KAACC,EAAA,CACCC,UAAU,kJACVC,SAAS,aACTC,iBAAiB,EAEjBL,SAAA,CAAAJ,EAAAA,IAACU,GAAaH,UAAU,gBACtBH,SAAAC,EAAAA,KAAC,MAAA,CAAIE,UAAU,oCACbH,SAAA,GAAAC,KAACM,EAAA,CAAYJ,UAAU,cAAcH,SAAA,CAAA,cACvBjG,EAASyG,2BAEvBP,KAAC,MAAA,CAAIE,UAAU,0BACZH,SAAA,CAAAhG,IAAYO,GACX0F,EAAAA,KAACQ,EAAA,CACCC,QAAQ,UACRC,KAAK,KACLC,QA5NQ,KACtBpG,GAAa,GACbJ,EAAgB,IAAIL,EAASO,wBAA0B,MA4NzC0F,SAAA,GAAAJ,IAACiB,EAAA,CAAMV,UAAU,iBAAiB,QAIrC5F,GACC0F,EAAAA,KAAAa,WAAA,CACEd,SAAA,CAAAC,EAAAA,KAACQ,EAAA,CACCC,QAAQ,UACRC,KAAK,KACLC,QAxMI,KAEpB,MAKMG,EAAwB,CAC5BC,YANoB7G,EAAaqF,OAAO,CAACnB,EAAKC,KAC9C,MAAM2C,EAAU3C,EAAK0C,aAAe,EACpC,OAAOC,EAAU5C,EAAM4C,EAAU5C,GAChC,GAG4B,EAC7BE,UAAW,GACXC,cAAe,GACflB,SAAU,EACVE,sBAAkB,EAClBC,aAAc,EACdiB,OAAQ,GACRwC,aAAa,GAIT9D,EAAW,IAAIjD,EAAc4G,GAASI,KAAK,CAACC,EAAGC,KACrCD,EAAEJ,aAAe,SACjBK,EAAEL,aAAe,SAIjC5G,EAAgBgD,IAiLA4C,SAAA,GAAAJ,IAAC0B,EAAA,CAAKnB,UAAU,iBAAiB,WAGnCF,EAAAA,KAACQ,EAAA,CACCC,QAAQ,UACRC,KAAK,KACLC,QAzKC9F,UACjB,IAOE,GAJqBX,EAAaoH,WAC/BjD,EAAKC,YAAcD,EAAKC,UAAUiD,QAGpB7D,OAAS,EAExB,YADA8D,EAAM5F,MAAM,qBAKd,MAAQA,MAAO6F,SAAsB/G,EAClCU,KAAK,0BACLsG,SACApG,GAAG,sBAAuBxB,EAAS2B,IAEtC,GAAIgG,EAEF,MADA5F,EAAOD,MAAM,cAAe6F,GACtBA,EAIR,MAAME,EAAgBzH,EAAawE,IAAIL,IAAA,CACrCuD,oBAAqB9H,EAAS2B,GAC9B8E,sBAAuBzG,EAASyG,sBAChCQ,YAAa1C,EAAK0C,YAClBzC,UAAWD,EAAKC,UAAUiD,OAC1BhD,cAAeF,EAAKE,eAAiB,GACrClB,SAAUD,OAAOiB,EAAKhB,WAAa,EACnCE,iBAA4C,OAA1Bc,EAAKd,uBAAuD,IAA1Bc,EAAKd,iBAAiCH,OAAOiB,EAAKd,kBAAoB,KAC1HC,aAAcJ,OAAOiB,EAAKb,eAAiB,EAC3CiB,OAAQJ,EAAKI,QAAU,GACvBoD,KAAMxD,EAAKwD,MAAQ,KACnBZ,YAAa5C,EAAK4C,cAAe,EACjCa,gBAAiBzD,EAAKyD,iBAAmB,cAInClG,MAAOmG,SAAsBrH,EAClCU,KAAK,0BACL4G,OAAOL,GAEV,GAAII,EAEF,MADAlG,EAAOD,MAAM,WAAYmG,GACnBA,EAIR,MAAMrC,EAAcxF,EAAaqF,OAAO,CAACC,EAAKnB,IAASmB,GAAOpC,OAAOiB,EAAKb,eAAiB,GAAI,IACvF5B,MAAOqG,SAAsBvH,EAClCU,KAAK,qBACL8G,OAAO,CAAEC,aAAczC,IACvBpE,GAAG,KAAMxB,EAAS2B,IAErB,GAAIwG,EAEF,MADApG,EAAOD,MAAM,cAAeqG,GACtBA,EAGRT,EAAMY,QAAQ,gBACd7H,GAAa,GACbP,IACAH,GACF,OAAS+B,GACPC,EAAOD,MAAM,aAAcA,GAC3B4F,EAAM5F,MAAM,oBAAoBA,aAAiByG,MAAQzG,EAAM0G,QAAU1G,IAC3E,GAsGgBmE,SAAA,GAAAJ,IAAC4C,EAAA,CAAKrC,UAAU,iBAAiB,QAGnCP,EAAAA,IAACa,EAAA,CACCC,QAAQ,QACRC,KAAK,KACLC,QAjPO,KACvBpG,GAAa,GACbJ,EAAgBL,EAASO,wBAA0B,KAgPpC0F,SAAA,UAKLJ,EAAAA,IAACa,EAAA,CACCC,QAAQ,QACRC,KAAK,OACLC,QAAS9G,EACTqG,UAAU,UAEVH,SAAAJ,EAAAA,IAAC6C,EAAA,CAAEtC,UAAU,wBAMrBF,KAAC,MAAA,CAAIE,UAAU,oEACbH,SAAA,CAAAC,OAAC,MAAA,CACCD,SAAA,CAAAJ,EAAAA,IAAC,IAAA,CAAEO,UAAU,cAAcH,SAAA,QAC3BJ,EAAAA,IAAC,IAAA,CAAEO,UAAU,cAAeH,WAAS0C,wBAEtC,MAAA,CACC1C,SAAA,CAAAJ,EAAAA,IAAC,IAAA,CAAEO,UAAU,cAAcH,SAAA,QAC3BJ,EAAAA,IAAC,IAAA,CAAEO,UAAU,cAAeH,WAAS/D,2BAEtC,MAAA,CACC+D,SAAA,CAAAJ,EAAAA,IAAC,IAAA,CAAEO,UAAU,cAAcH,SAAA,SAC3BJ,EAAAA,IAAC,KAAEO,UAAU,uBAAuBwC,MAAO5I,EAAS6I,eACjD5C,WAAS4C,2BAGb,MAAA,CACC5C,SAAA,CAAAJ,EAAAA,IAAC,IAAA,CAAEO,UAAU,cAAcH,SAAA,UAC3BJ,IAAC,IAAA,CAAEO,UAAU,cACVH,SAAAjG,EAAS8I,uBACRC,EAAO,IAAIC,KAAKhJ,EAAS8I,uBAAwB,sBAKzDjD,MAAC,MAAA,CAAIO,UAAU,iBACbH,eAAC,MAAA,CAAIG,UAAU,yBACbH,WAAAJ,IAAC,MAAA,CAAIO,UAAU,yBAAyB6C,MAAO,CAAEC,SAAU,GAAGpF,OAC5DmC,SAAAJ,EAAAA,IAAC,MAAA,CAAIO,UAAU,+BACbH,SAAAC,EAAAA,KAAC,QAAA,CAAME,UAAU,mDAAmD6C,MAAO,CAAEC,SAAU,GAAGpF,OAC5FmC,SAAA,CAAAJ,MAAC,QAAA,CAAMO,UAAU,uCACfH,SAAAC,EAAAA,KAAC,KAAA,CACCD,SAAA,CAAAJ,EAAAA,IAAC,KAAA,CAAGO,UAAU,kEAAkEH,SAAA,QAChFJ,EAAAA,IAAC,KAAA,CAAGO,UAAU,8DAA8DH,SAAA,OAC5EJ,EAAAA,IAAC,KAAA,CAAGO,UAAU,8DAA8DH,SAAA,OAC5EJ,EAAAA,IAAC,KAAA,CAAGO,UAAU,8DAA8DH,SAAA,OAC5EJ,EAAAA,IAAC,KAAA,CAAGO,UAAU,+DAA+DH,SAAA,OAC7EJ,EAAAA,IAAC,KAAA,CAAGO,UAAU,+DAA+DH,SAAA,OAChE,aAAd9F,GACG0F,EAAAA,IAAC,KAAA,CAAGO,UAAU,8DAA8DH,SAAA,UAEhE,YAAd9F,GAAyC,SAAdA,UACxB,KAAA,CAAGiG,UAAU,8DAA8DH,SAAA,SAEjE,SAAd9F,GACC+F,EAAAA,KAAAa,EAAAA,SAAA,CACId,SAAA,CAAAJ,EAAAA,IAAC,KAAA,CAAGO,UAAU,gEAAgEH,SAAA,aAC9EJ,EAAAA,IAAC,KAAA,CAAGO,UAAU,gEAAgEH,SAAA,YAC9EJ,EAAAA,IAAC,KAAA,CAAGO,UAAU,+DAA+DH,SAAA,WAGpE,YAAd9F,GACG0F,EAAAA,IAAC,KAAA,CAAGO,UAAU,gEAAgEH,SAAA,WAEhFJ,EAAAA,IAAC,KAAA,CAAGO,UAAU,8DAA8DH,SAAA,OAC3EzF,KAAaqF,IAAC,KAAA,CAAGO,UAAU,kEAAkEH,SAAA,cAGlGJ,IAAC,QAAA,CACCI,UAAAzF,EAAYJ,EAAeyD,GAAOe,IAAI,CAACL,EAAWpB,IAChD+C,OAAC,KAAA,CAA0BE,UAAU,2BACnCH,SAAA,CAAAJ,MAAC,MAAGO,UAAU,8CAA+CH,SAAA1B,EAAK0C,aAAe9D,EAAQ,IACzF0C,EAAAA,IAAC,KAAA,CAAGO,UAAU,oCACbH,SAAAzF,EACCqF,EAAAA,IAACsD,EAAA,CACC/F,MAAOmB,EAAKC,UACZ4E,SAAWC,GAAMnG,EAAiBC,EAAO,YAAakG,EAAEC,OAAOlG,OAC/DgD,UAAU,2BAGZP,EAAAA,IAAC,MAAA,CAAIO,UAAU,gBACbH,SAAAJ,EAAAA,IAAC,IAAA,CAAEO,UAAU,uBAAuBwC,MAAOrE,EAAKC,UAC7CyB,SAAA1B,EAAKC,gBAKdqB,EAAAA,IAAC,KAAA,CAAGO,UAAU,oCACXH,SAAAzF,EACCqF,EAAAA,IAACsD,EAAA,CACC/F,MAAOmB,EAAKE,cACZ2E,SAAWC,GAAMnG,EAAiBC,EAAO,gBAAiBkG,EAAEC,OAAOlG,OACnEgD,UAAU,2BAGZP,EAAAA,IAAC,MAAA,CAAIO,UAAU,yBAAyBwC,MAAOrE,EAAKE,cACjDwB,SAAA1B,EAAKE,kBAIZoB,EAAAA,IAAC,KAAA,CAAGO,UAAU,8CACXH,SAAAzF,EACCqF,EAAAA,IAACsD,EAAA,CACCI,KAAK,SACLnG,MAAOmB,EAAKhB,SACZ6F,SAAWC,GAAMnG,EAAiBC,EAAO,WAAYkG,EAAEC,OAAOlG,OAC9DgD,UAAU,wCAGX,MAAA,CAAIA,UAAU,aACbH,SAAAJ,EAAAA,IAAC,OAAA,CAAKO,UAAU,cAAc6C,MAAO,CAACO,QAAS,QAASC,UAAW,SAAWxD,WAAK1C,SAASmB,uBAIlGmB,EAAAA,IAAC,KAAA,CAAGO,UAAU,+CACXH,SAAAzF,EACCqF,EAAAA,IAACsD,EAAA,CACCI,KAAK,SACLnG,MAAOmB,EAAKd,iBACZ2F,SAAWC,GAAMnG,EAAiBC,EAAO,mBAAoBkG,EAAEC,OAAOlG,OACtEgD,UAAU,oCAGZP,IAAC,MAAA,CAAIO,UAAU,aACbH,SAAAC,EAAAA,KAAC,OAAA,CAAKE,UAAU,iBAAiB6C,MAAO,CAACO,QAAS,QAASC,UAAW,SAAYxD,SAAA,EAAA1B,EAAKd,kBAAoB,GAAGiB,iBAAiB,IAAE1E,EAAS0J,gBAIhJ7D,EAAAA,IAAC,KAAA,CAAGO,UAAU,+CACXH,SAAAzF,EACCqF,EAAAA,IAACsD,EAAA,CACCI,KAAK,SACLnG,MAAOmB,EAAKb,aACZ0F,SAAWC,GAAMnG,EAAiBC,EAAO,eAAgBkG,EAAEC,OAAOlG,OAClEgD,UAAU,wCAGZP,IAAC,MAAA,CAAIO,UAAU,aACbH,SAAAC,EAAAA,KAAC,OAAA,CAAKE,UAAU,cAAc6C,MAAO,CAACO,QAAS,QAASC,UAAW,SAAYxD,SAAA,EAAA1B,EAAKb,cAAgB,GAAGgB,iBAAiB,IAAE1E,EAAS0J,gBAI1H,aAAdvJ,GACC0F,MAAC,KAAA,CAAGO,UAAU,oCAEXH,SAAAhE,EACCsC,EAAKoF,qBACH9D,EAAAA,IAAC,SAAA,CACCgB,QAAS9F,UACP,IAEE,IAAKwD,EAAK5C,GACR,MAAM,IAAI4G,MAAM,gBAGlB,MAAMzG,MAAEA,OAAOd,SAAeJ,EAC3BU,KAAK,0BACL8G,OAAO,CAAEuB,sBAAsB,IAC/BnI,GAAG,KAAM+C,EAAK5C,IACdJ,SAEH,GAAIO,EAEF,MADAC,EAAOD,MAAM,eAAgBA,GACvBA,EAGR4F,EAAMY,QAAQ,wBACRnG,GACR,OAASL,GACPC,EAAOD,MAAM,eAAgBA,GAC7B4F,EAAM5F,MAAM,oBAAoBA,aAAiByG,MAAQzG,EAAM0G,QAAU1G,IAC3E,GAEFsE,UAAU,2EACVwC,MAAM,aACP3C,SAAA,SAIDJ,EAAAA,IAAC,SAAA,CACCgB,QAAS9F,UACP,IAEE,IAAKwD,EAAK5C,GACR,MAAM,IAAI4G,MAAM,gBAGlB,MAAMzG,MAAEA,OAAOd,SAAeJ,EAC3BU,KAAK,0BACL8G,OAAO,CAAEuB,sBAAsB,IAC/BnI,GAAG,KAAM+C,EAAK5C,IACdJ,SAEH,GAAIO,EAEF,MADAC,EAAOD,MAAM,eAAgBA,GACvBA,EAGR4F,EAAMY,QAAQ,uBACRnG,GACR,OAASL,GACPC,EAAOD,MAAM,eAAgBA,GAC7B4F,EAAM5F,MAAM,oBAAoBA,aAAiByG,MAAQzG,EAAM0G,QAAU1G,IAC3E,GAEFsE,UAAU,6EACXH,SAAA,SAKHJ,EAAAA,IAAC,OAAA,CAAKO,UAAW,gBACf7B,EAAKoF,qBACD,0BACA,iDAEH1D,SAAA1B,EAAKoF,qBAAuB,OAAS,YAK9B,YAAdxJ,GAAyC,SAAdA,UAC1B,KAAA,CAAGiG,UAAU,oCAEXH,SAAc,YAAd9F,EACC8B,EACEgB,EAAqB2G,YAAYrF,GAC/BsB,EAAAA,IAAC,SAAA,CACCgB,QAAS,KACP5D,EAAqB4G,aAAatF,EAAK5C,GAAK,CAC1C6C,UAAWD,EAAKC,UAChBC,cAAeF,EAAKE,cACpBlB,SAAUgB,EAAKhB,SACfE,iBAAkBc,EAAKd,iBACvBC,aAAca,EAAKb,aACnBiB,OAAQJ,EAAKI,UAGjByB,UAAU,2EACVwC,MAAM,mBAEL3C,WAAqB1D,OAAOM,gBAG/BgD,EAAAA,IAACiE,EAAA,CACCC,aAAeC,IACb/G,EAAqBgH,cAAc1F,EAAK5C,GAAKqI,EAAM,CACjDxF,UAAWD,EAAKC,UAChBC,cAAeF,EAAKE,cACpBlB,SAAUgB,EAAKhB,SACfE,iBAAkBc,EAAKd,iBACvBC,aAAca,EAAKb,aACnBiB,OAAQJ,EAAKI,UAGjBuF,YAAY,cAEZjE,SAAAJ,EAAAA,IAACa,EAAA,CACCC,QAAQ,UACRC,KAAK,KACLR,UAAU,6EAETH,WAAqB1D,OAAOO,sBAKlC,OAAA,CAAKsD,UAAW,gBACfnD,EAAqB2G,YAAYrF,GAC7B,0BACA,iDAEH0B,SAAAhD,EAAqB2G,YAAYrF,GAAQtB,EAAqBV,OAAOM,cAAgBI,EAAqBV,OAAOO,cAKtH+C,MAAC,QAAKO,UAAW,gBACfnD,EAAqB2G,YAAYrF,GAC7B,0BACA,iDAEH0B,SAAAhD,EAAqB2G,YAAYrF,GAAQtB,EAAqBV,OAAOM,cAAgBI,EAAqBV,OAAOO,gBAK3G,YAAd3C,GACC0F,EAAAA,IAAC,KAAA,CAAGO,UAAU,gDACXH,SAAAhD,EAAqBkH,iBAAiB5F,GACrCsB,EAAAA,IAAC,OAAA,CAAKO,UAAU,gCACbH,SAAA8C,EAAO,IAAIC,KAAK/F,EAAqBkH,iBAAiB5F,IAAQ,wBAGjEsB,IAAC,OAAA,CAAKO,UAAU,iBAAiBH,iBAIxB,SAAd9F,GACC+F,EAAAA,KAAAa,EAAAA,SAAA,CACEd,SAAA,CAAAJ,EAAAA,IAAC,MAAGO,UAAU,gDACXH,WACC5D,EAAwBuH,YAAYrF,GAClCsB,EAAAA,IAAC,SAAA,CACCgB,QAAS,KACPxE,EAAwBwH,aAAatF,EAAK5C,GAAK,CAC7C6C,UAAWD,EAAKC,UAChBC,cAAeF,EAAKE,cACpBlB,SAAUgB,EAAKhB,SACfE,iBAAkBc,EAAKd,iBACvBC,aAAca,EAAKb,aACnBiB,OAAQJ,EAAKI,UAGjByB,UAAU,2EACVwC,MAAM,mBAEL3C,WAAwB1D,OAAOM,gBAGlCgD,EAAAA,IAACiE,EAAA,CACCC,aAAeC,IACb3H,EAAwB4H,cAAc1F,EAAK5C,GAAKqI,EAAM,CACpDxF,UAAWD,EAAKC,UAChBC,cAAeF,EAAKE,cACpBlB,SAAUgB,EAAKhB,SACfE,iBAAkBc,EAAKd,iBACvBC,aAAca,EAAKb,aACnBiB,OAAQJ,EAAKI,UAGjBuF,YAAY,QAEZjE,SAAAJ,EAAAA,IAACa,EAAA,CACCC,QAAQ,UACRC,KAAK,KACLR,UAAU,6EAETH,WAAwB1D,OAAOO,sBAKrC,OAAA,CAAKsD,UAAW,gBACf/D,EAAwBuH,YAAYrF,GAChC,0BACA,iDAEH0B,SAAA5D,EAAwBuH,YAAYrF,GAAQlC,EAAwBE,OAAOM,cAAgBR,EAAwBE,OAAOO,kBAIjI+C,IAAC,KAAA,CAAGO,UAAU,gDACXH,SAAA5D,EAAwB8H,iBAAiB5F,KACxCsB,IAAC,OAAA,CAAKO,UAAU,iBACbH,SAAA8C,EAAO,IAAIC,KAAK3G,EAAwB8H,iBAAiB5F,IAAQ,gBAGpEsB,EAAAA,IAAC,OAAA,CAAKO,UAAU,iBAAiBH,SAAA,QAGrCJ,EAAAA,IAAC,MAAGO,UAAU,+CACXH,WAAwBmE,mBAAmB7F,GAC1CsB,EAAAA,IAAC,OAAA,CAAKO,UAAU,iBACbH,SAAA5D,EAAwB+H,mBAAmB7F,WAG7C,OAAA,CAAK6B,UAAU,iBAAiBH,SAAA,WAKzCJ,EAAAA,IAAC,KAAA,CAAGO,UAAU,oCACXH,SAAAzF,EACCqF,EAAAA,IAACsD,EAAA,CACC/F,MAAOmB,EAAKI,QAAU,GACtByE,SAAWC,GAAMnG,EAAiBC,EAAO,SAAUkG,EAAEC,OAAOlG,OAC5DgD,UAAU,yBACV8D,YAAY,OAGdrE,EAAAA,IAAC,MAAA,CAAIO,UAAU,gBACbH,eAAC,OAAA,CAAKG,UAAU,gCAAgCwC,MAAOrE,EAAKI,OACzDsB,SAAA1B,EAAKI,QAAU,UAKvBnE,KACCqF,IAAC,KAAA,CAAGO,UAAU,mCACZH,SAAAJ,EAAAA,IAACa,EAAA,CACCC,QAAQ,QACRC,KAAK,OACLC,QAAS,IA3kBN,CAAC1D,IACxB,MAAME,EAAWjD,EAAaoH,OAAO,CAAC6C,EAAGC,IAAMA,IAAMnH,GAAOiE,KAAK,CAACC,EAAGC,KACrDD,EAAEJ,aAAe,SACjBK,EAAEL,aAAe,SAGjC5G,EAAgBgD,IAqkBmBkH,CAAiBpH,GAChCiD,UAAU,0CAEVH,SAAAJ,EAAAA,IAAC2E,EAAA,CAAOpE,UAAU,kBAtUf7B,EAAK5C,IAAMwB,mBAmV9B+C,KAAC,MAAA,CAAIE,UAAU,gEACbH,SAAA,GAAAC,KAAC,MAAA,CAAIE,UAAU,iBAAiBH,SAAA,CAAA,KAC3BpC,EAAMD,OAAO,YAElBsC,KAAC,MAAA,CAAIE,UAAU,oBAAoBH,SAAA,CAAA,SAC1BL,EAAYlB,iBAAiB,IAAE1E,EAAS0J,mBAM3D"}