import{c as W,a as F,u as ne,r as w,j as e,F as le,B as ie,b as S,S as Z}from"./index-DxigY9lH.js";import{B as N,t as C}from"./index-DG8d4qaU.js";import{C as T,a as $,b as E,c as U}from"./card-kHKyqKVs.js";import{D as ce,a as de,b as oe,c as me,d as ue}from"./input-BweYqCwA.js";import{E as ye}from"./exceljs.min-D4O139RG.js";import{P as V,T as X,a as _e}from"./PurchaseDetailModal-n8W5wcgu.js";import{C as K}from"./format-DkP3LzQz.js";import{C as fe}from"./credit-card-DSSXizp3.js";import{E as je}from"./eye-C-xB0TkI.js";import{D as G}from"./download-CUNciLzX.js";import"./helpers-BMiTuHMe.js";import"./chevron-down-D-MqSx39.js";import"./popover-CmtQ8Ab3.js";import"./calendar-ynpwGueC.js";import"./plus-B0KyNyZk.js";import"./save-CvTGi6nm.js";/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],ee=W("arrow-right",be);/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Y=W("clock",ve);/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]],we=W("thumbs-up",Ne);/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Se=W("triangle-alert",qe);class De{constructor(){this.supabase=F()}parseRoles(a){let n=[];return a&&(Array.isArray(a)?n=a.map(r=>String(r).trim()):n=String(a).split(",").map(t=>t.trim()).filter(t=>t.length>0)),n}async getDashboardData(a){const[n,r,t,o,c,g,h]=await Promise.all([this.getDashboardStats(a),this.getUrgentRequests(a),this.getMyRecentRequests(a),this.getPendingApprovals(a),this.getQuickActions(a),this.getTodaySummary(a),this.getMyPurchaseStatus(a)]);return{employee:a,stats:n,urgentRequests:r,myRecentRequests:t,pendingApprovals:o,quickActions:c,todaySummary:g,myPurchaseStatus:h}}async getDashboardStats(a){const n=new Date().toISOString().split("T")[0],r=this.parseRoles(a.purchase_role),[t,o,c,g,h,u]=await Promise.all([this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}),this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).eq("requester_name",a.name),this.getPendingCount(a,r),this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).eq("is_received",!0).gte("received_at",new Date(new Date().getFullYear(),new Date().getMonth(),1).toISOString()),this.getUrgentCount(a,r),this.getTodayActionsCount(a,n)]);return{total:t.count||0,myRequests:o.count||0,pending:c,completed:g.count||0,urgent:h,todayActions:u}}async getUrgentRequests(a){const n=new Date(Date.now()-2592e5).toISOString(),r=this.parseRoles(a.purchase_role);if(r.length===0)return[];let t=this.supabase.from("purchase_requests").select("*,vendors(vendor_name),purchase_request_items(id)").lt("created_at",n);if(r.includes("app_admin"))t=t.or("middle_manager_status.eq.pending,final_manager_status.eq.pending,purchase_status.eq.pending");else if(r.includes("middle_manager"))t=t.eq("middle_manager_status","pending");else if(r.includes("final_approver")||r.includes("ceo"))t=t.eq("middle_manager_status","approved").eq("final_manager_status","pending");else if(r.includes("lead buyer"))t=t.eq("final_manager_status","approved").eq("purchase_status","pending");else return[];const{data:o}=await t.order("created_at",{ascending:!0}).limit(5);return(o||[]).map(c=>({...c,vendor_name:c.vendors?.vendor_name,total_items:c.purchase_request_items?.length||0,daysOverdue:Math.floor((Date.now()-new Date(c.created_at).getTime())/(1e3*60*60*24)),priority:this.calculatePriority(c),urgentReason:this.getUrgentReason(c,r)}))}async getMyRecentRequests(a){const{data:n}=await this.supabase.from("purchase_requests").select("*,vendors(vendor_name),purchase_request_items(id)").eq("requester_name",a.name).or("and(middle_manager_status.eq.approved,final_manager_status.eq.pending),and(final_manager_status.eq.approved,purchase_status.eq.pending)").order("created_at",{ascending:!1}).limit(5);return(n||[]).map(r=>({...r,vendor_name:r.vendors?.vendor_name,total_items:r.purchase_request_items?.length||0,progress_percentage:this.calculateProgress(r),current_step:this.getCurrentStep(r),next_action:this.getNextAction(r),estimated_completion:this.estimateCompletion(r)}))}async getPendingApprovals(a){const n=this.parseRoles(a.purchase_role);let r=null;const t=await this.supabase.from("purchase_requests").select("*").order("request_date",{ascending:!1}).limit(100);if(t.error){t.error;const h=await this.supabase.from("purchase_requests").select("*").order("request_date",{ascending:!1}).limit(100);if(h.error)return[];r=h.data||[]}else r=t.data||[];let o=r||[];const c=h=>h==="pending"||h==="ëŒ€ê¸°"||h===""||h===null||h===void 0;return o=o.filter(h=>c(h.final_manager_status)),n.length===0?[]:await Promise.all(o.map(async h=>{const{data:u}=await this.supabase.from("purchase_request_items").select("*").eq("purchase_request_id",h.id);let y=h.vendor_name;if(!y&&h.vendor_id){const{data:k}=await this.supabase.from("vendors").select("vendor_name").eq("id",h.vendor_id).single();y=k?.vendor_name}const d=u||[],D=d.reduce((k,A)=>{const M=Number(A?.amount_value)||(Number(A?.quantity)||0)*(Number(A?.unit_price_value)||0);return k+M},0);return{...h,vendor_name:y,purchase_request_items:d,total_amount:D}}))}async getQuickActions(a){const n=this.parseRoles(a.purchase_role),r=[];if(n.includes("app_admin")||n.includes("middle_manager")||n.includes("final_approver")||n.includes("ceo")){const t=await this.getPendingCount(a,n);t>0&&r.push({id:"approve",type:"approve",label:"ìŠ¹ì¸ ëŒ€ê¸°",description:`${t}ê±´ì˜ ìŠ¹ì¸ ëŒ€ê¸° ì¤‘`,count:t,color:"red"})}if(n.includes("lead buyer")||n.includes("lead buyer")){const{count:t}=await this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).eq("final_manager_status","approved").eq("purchase_status","pending");t&&t>0&&r.push({id:"purchase",type:"purchase",label:"êµ¬ë§¤ ì²˜ë¦¬",description:`${t}ê±´ì˜ êµ¬ë§¤ ëŒ€ê¸° ì¤‘`,count:t,color:"yellow"})}return r}async getTodaySummary(a){const n=new Date().toISOString().split("T")[0],r=new Date(Date.now()+1440*60*1e3).toISOString().split("T")[0],[t,o,c]=await Promise.all([this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).gte("updated_at",n).lt("updated_at",r).or("middle_manager_status.eq.approved,final_manager_status.eq.approved"),this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).eq("requester_name",a.name).gte("created_at",n).lt("created_at",r),this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).eq("is_received",!0).gte("received_at",n).lt("received_at",r)]);return{approved:t.count||0,requested:o.count||0,received:c.count||0}}async getMyPurchaseStatus(a){const n=a.name||a.email,r=new Date(Date.now()-10080*60*1e3).toISOString(),t=await this.supabase.from("purchase_requests").select("*,vendors(vendor_name),purchase_request_items(item_name,quantity,specification,amount_value)").eq("requester_name",n).order("created_at",{ascending:!1}).limit(100);if(t.error)return console.error("getMyPurchaseStatus ì—ëŸ¬:",t.error),{waitingPurchase:[],waitingDelivery:[],recentCompleted:[]};const o=t.data||[],c=o.filter(u=>{const y=(u.payment_category||"").trim().replace(/\s+/g,""),d=["êµ¬ë§¤ìš”ì²­","ë°œì£¼ìš”ì²­"].includes(y),D=!u.is_payment_completed,k=(u.progress_type||"").includes("ì„ ì§„í–‰");if(d&&D&&k)return!0;const A=(u.progress_type||"").includes("ì¼ë°˜")||!u.progress_type||u.progress_type==="",M=u.final_manager_status==="approved";return d&&D&&A&&M}).slice(0,10),g=o.filter(u=>{const y=!u.is_received,d=(u.progress_type||"").includes("ì„ ì§„í–‰");if(y&&d)return!0;const D=u.final_manager_status==="approved";return y&&D}).slice(0,10),h=o.filter(u=>{if(u.is_received!==!0||!u.received_at)return!1;const y=new Date(u.received_at),d=new Date(r);return y>=d}).slice(0,10);return{waitingPurchase:c,waitingDelivery:g,recentCompleted:h}}async quickApprove(a,n){try{const r=this.parseRoles(n.purchase_role),{data:t}=await this.supabase.from("purchase_requests").select("middle_manager_status, final_manager_status").eq("id",a).single();if(!t)return{success:!1,error:"ìš”ì²­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."};let o={};const c=u=>u==="pending"||u==="ëŒ€ê¸°"||u===""||u===null||u===void 0;if(r.includes("app_admin")?c(t.middle_manager_status)?o={middle_manager_status:"approved"}:t.middle_manager_status==="approved"&&c(t.final_manager_status)&&(o={final_manager_status:"approved"}):r.includes("middle_manager")?c(t.middle_manager_status)&&(o={middle_manager_status:"approved"}):r.includes("final_approver")||r.includes("ceo")?t.middle_manager_status==="approved"&&c(t.final_manager_status)&&(o={final_manager_status:"approved"}):(r.includes("raw_material_manager")||r.includes("consumable_manager"))&&t.middle_manager_status==="approved"&&c(t.final_manager_status)&&(o={final_manager_status:"approved"}),Object.keys(o).length===0)return{success:!1,error:"ìŠ¹ì¸í•  ìˆ˜ ìžˆëŠ” ìƒíƒœê°€ ì•„ë‹™ë‹ˆë‹¤."};const{data:g,error:h}=await this.supabase.from("purchase_requests").update(o).eq("id",a).select().single();if(h)throw h;return{success:!0}}catch(r){return{success:!1,error:r.message}}}async getPendingCount(a,n){if(n.includes("app_admin")){const[r,t,o]=await Promise.all([this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).or("middle_manager_status.in.(pending,ëŒ€ê¸°),middle_manager_status.is.null"),this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).eq("middle_manager_status","approved").or("final_manager_status.in.(pending,ëŒ€ê¸°),final_manager_status.is.null"),this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).eq("final_manager_status","approved").or("purchase_status.in.(pending,ëŒ€ê¸°),purchase_status.is.null")]);return(r.count||0)+(t.count||0)+(o.count||0)}if(n.includes("middle_manager")){const{count:r,error:t}=await this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).or("middle_manager_status.in.(pending,ëŒ€ê¸°),middle_manager_status.is.null");return t?0:r||0}if(n.includes("final_approver")||n.includes("ceo")){const{count:r,error:t}=await this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).eq("middle_manager_status","approved").or("final_manager_status.in.(pending,ëŒ€ê¸°),final_manager_status.is.null");return t?0:r||0}if(n.includes("lead buyer")){const{count:r,error:t}=await this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).eq("final_manager_status","approved").or("purchase_status.in.(pending,ëŒ€ê¸°),purchase_status.is.null");return t?0:r||0}return 0}async getUrgentCount(a,n){if(n.length===0)return 0;const r=new Date(Date.now()-4320*60*1e3).toISOString();let t=this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).lt("created_at",r);if(n.includes("app_admin"))t=t.or("middle_manager_status.eq.pending,final_manager_status.eq.pending,purchase_status.eq.pending");else if(n.includes("middle_manager"))t=t.eq("middle_manager_status","pending");else if(n.includes("final_approver")||n.includes("ceo"))t=t.eq("middle_manager_status","approved").eq("final_manager_status","pending");else if(n.includes("lead buyer"))t=t.eq("final_manager_status","approved").eq("purchase_status","pending");else return 0;const{count:o}=await t;return o||0}async getTodayActionsCount(a,n){const r=new Date(Date.now()+864e5).toISOString().split("T")[0],{count:t}=await this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).gte("updated_at",n).lt("updated_at",r).or(`middle_manager_id.eq.${a.id},final_manager_id.eq.${a.id}`);return t||0}async getTotalDeliveryWaitingCount(){const{count:a}=await this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).eq("is_received",!1).or("is_payment_completed.eq.true,progress_type.ilike.%ì„ ì§„í–‰%");return a||0}calculatePriority(a){const n=Math.floor((Date.now()-new Date(a.created_at).getTime())/864e5);return n>=7?"high":n>=5?"medium":"low"}getUrgentReason(a,n){return n.includes("middle_manager")&&a.middle_manager_status==="pending"||(n.includes("final_approver")||n.includes("ceo"))&&a.final_manager_status==="pending"?"overdue_approval":a.is_received?"payment_pending":"delivery_delay"}calculateProgress(a){let n=0;return a.middle_manager_status==="approved"&&(n+=25),a.final_manager_status==="approved"&&(n+=25),a.is_payment_completed&&(n+=25),a.is_received&&(n+=25),n}getCurrentStep(a){return a.is_received?"completed":a.is_payment_completed?"delivery":a.final_manager_status==="approved"?"purchase":"approval"}getNextAction(a){return a.middle_manager_status==="pending"?"ì¤‘ê°„ ìŠ¹ì¸ ëŒ€ê¸° ì¤‘":a.final_manager_status==="pending"?"ìµœì¢… ìŠ¹ì¸ ëŒ€ê¸° ì¤‘":a.is_payment_completed?a.is_received?"ì™„ë£Œ":"ìž…ê³  ëŒ€ê¸° ì¤‘":"êµ¬ë§¤ ì²˜ë¦¬ ëŒ€ê¸° ì¤‘"}estimateCompletion(a){const n=new Date(a.created_at);Math.floor((new Date().getTime()-n.getTime())/(1e3*60*60*24));let t=7;return a.progress_type==="ê¸´ê¸‰"&&(t=3),new Date(n.getTime()+t*24*60*60*1e3).toLocaleDateString("ko-KR")}async getUndownloadedOrders(a){const n=this.parseRoles(a.purchase_role);if(!n.includes("lead buyer")&&!n.includes("lead buyer"))return[];const{data:r,error:t}=await this.supabase.from("purchase_requests").select("*,purchase_request_items(id,item_name,specification,quantity,unit_price_value,amount_value)").order("created_at",{ascending:!1}).limit(100);if(t)return console.error("Failed to fetch undownloaded orders:",t),[];const o=(r||[]).filter(c=>{const g=c.progress_type==="ì„ ì§„í–‰"||c.middle_manager_status==="approved"&&c.final_manager_status==="approved",h=!c.is_po_download||c.is_po_download===!1||c.is_po_download===null;return g&&h});return o.sort((c,g)=>new Date(c.created_at).getTime()-new Date(g.created_at).getTime()),o.slice(0,10)}}const B=new De;function ke({isOpen:l,onClose:a,item:n,type:r,onRefresh:t}){const o=ne(),c=F(),[g,h]=w.useState([]),[u,y]=w.useState(!1),[d,D]=w.useState(n);if(w.useEffect(()=>{D(n)},[n]),w.useEffect(()=>{(async()=>{const{data:{user:b}}=await c.auth.getUser();if(console.log("Fetching roles for user:",b?.email),b?.email){const{data:P}=await c.from("employees").select("purchase_role").eq("email",b.email).single();if(console.log("Employee data:",P),P?.purchase_role){const L=Array.isArray(P.purchase_role)?P.purchase_role:P.purchase_role.split(",").map(Q=>Q.trim());console.log("Parsed roles:",L),h(L)}else console.log("No purchase_role found for employee")}})()},[r]),!d)return null;const k=d.purchase_request_items||[],A=k.reduce((p,b)=>p+(Number(b.amount_value)||0),0),M=k.reduce((p,b)=>p+(Number(b.quantity)||0),0);console.log("ðŸ” PurchaseStatusModal Debug:",{type:r,currentUserRoles:g,item:d.purchase_order_number,showPurchaseButton:r==="purchase",showDeliveryButton:r==="delivery",hasAdminPermission:g.includes("app_admin"),hasLeadBuyerPermission:g.includes("lead buyer"),hasReceiverPermission:g.includes("receiver"),itemData:{is_payment_completed:d.is_payment_completed,is_received:d.is_received}});const z=(()=>{switch(r){case"purchase":return{icon:e.jsx(Z,{className:"w-6 h-6 text-yellow-600"}),title:"êµ¬ë§¤ ëŒ€ê¸°",status:"êµ¬ë§¤ ì²˜ë¦¬ ëŒ€ê¸°ì¤‘",color:"bg-yellow-50 text-yellow-700 border-yellow-200"};case"delivery":return{icon:e.jsx(X,{className:"w-6 h-6 text-blue-600"}),title:"ìž…ê³  ëŒ€ê¸°",status:"ìž…ê³  ì²˜ë¦¬ ëŒ€ê¸°ì¤‘",color:"bg-blue-50 text-blue-700 border-blue-200"};case"completed":return{icon:e.jsx(K,{className:"w-6 h-6 text-green-600"}),title:"ì²˜ë¦¬ ì™„ë£Œ",status:"ëª¨ë“  ì²˜ë¦¬ ì™„ë£Œ",color:"bg-green-50 text-green-700 border-green-200"}}})();return e.jsx(ce,{open:l,onOpenChange:a,children:e.jsxs(de,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(oe,{children:[e.jsxs(me,{className:"text-xl font-bold",children:[d.purchase_order_number||"POë²ˆí˜¸ ì—†ìŒ"," ìƒì„¸ë³´ê¸°"]}),e.jsx(ue,{children:d.vendor_name||"ì—…ì²´ëª… ì—†ìŒ"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center text-gray-900",children:[e.jsx(le,{className:"w-5 h-5 mr-2 text-gray-700"}),"ê¸°ë³¸ ì •ë³´"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"ìš”ì²­ìž"}),e.jsx("p",{className:"font-medium text-gray-900",children:d.requester_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"ìš”ì²­ì¼"}),e.jsx("p",{className:"font-medium text-gray-900",children:new Date(d.request_date||d.created_at).toLocaleDateString("ko-KR")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"ë‚©ê¸°ìš”ì²­ì¼"}),e.jsx("p",{className:"font-medium text-gray-900",children:d.delivery_request_date?new Date(d.delivery_request_date).toLocaleDateString("ko-KR"):"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"ê²°ì œìœ í˜•"}),e.jsx("p",{className:"font-medium text-gray-900",children:d.payment_category||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"ì§„í–‰êµ¬ë¶„"}),e.jsx("p",{className:"font-medium text-gray-900",children:d.progress_type||"ì¼ë°˜"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"ìƒíƒœ"}),e.jsx("p",{className:"font-medium",children:e.jsx(N,{className:z.color,children:z.title})})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center text-gray-900",children:[e.jsx(ie,{className:"w-5 h-5 mr-2 text-gray-700"}),"ì—…ì²´ ì •ë³´"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"ì—…ì²´ëª…"}),e.jsx("p",{className:"font-medium text-gray-900",children:d.vendor_name||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"í”„ë¡œì íŠ¸ ì—…ì²´"}),e.jsx("p",{className:"font-medium text-gray-900",children:d.project_vendor||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"íŒë§¤ì£¼ë¬¸ë²ˆí˜¸"}),e.jsx("p",{className:"font-medium text-gray-900",children:d.sales_order_number||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"í”„ë¡œì íŠ¸ í’ˆëª©"}),e.jsx("p",{className:"font-medium text-gray-900",children:d.project_item||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"ë°œì£¼ì„œ í…œí”Œë¦¿"}),e.jsx("p",{className:"font-medium text-gray-900",children:d.po_template_type||"ì¼ë°˜"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"í†µí™”"}),e.jsx("p",{className:"font-medium text-gray-900",children:d.currency||"KRW"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center text-gray-900",children:[e.jsx(V,{className:"w-5 h-5 mr-2 text-gray-700"}),"í’ˆëª© ë¦¬ìŠ¤íŠ¸"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white rounded-lg overflow-hidden shadow-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[r==="purchase"&&e.jsx("th",{className:"px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"êµ¬ë§¤"}),r==="delivery"&&e.jsx("th",{className:"px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"ìž…ê³ "}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"í’ˆëª…"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"ê·œê²©"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"ìˆ˜ëŸ‰"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"ë‹¨ê°€"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"ê¸ˆì•¡"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"ë¹„ê³ "})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:k.map((p,b)=>{const P=p.quantity>0?(Number(p.amount_value)||0)/p.quantity:0;return e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[r==="purchase"&&e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("div",{className:"flex items-center justify-center",children:d.is_payment_completed?e.jsx(N,{className:"bg-yellow-100 text-yellow-800 text-xs",children:"êµ¬ë§¤ì™„ë£Œ"}):e.jsx(N,{variant:"outline",className:"text-gray-600 text-xs",children:"êµ¬ë§¤ëŒ€ê¸°"})})}),r==="delivery"&&e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("div",{className:"flex items-center justify-center",children:p.is_received?e.jsx(N,{className:"bg-green-100 text-green-800 text-xs",children:"ìž…ê³ ì™„ë£Œ"}):e.jsx(N,{variant:"outline",className:"text-gray-600 text-xs",children:"ë¯¸ìž…ê³ "})})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm font-medium text-gray-900",children:p.item_name||"í’ˆëª©ëª… ì—†ìŒ"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm text-gray-600",children:p.specification||"-"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:"text-sm font-medium text-gray-900",children:p.quantity||0})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("span",{className:"text-sm text-gray-900",children:["â‚©",P.toLocaleString()]})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:["â‚©",(Number(p.amount_value)||0).toLocaleString()]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm text-gray-600",children:p.remark||"-"})})]},b)})})]})}),e.jsx("div",{className:"mt-6 bg-white rounded-lg p-4 shadow-sm",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"ì´"}),e.jsxs("span",{className:"ml-1 font-semibold text-gray-900",children:[M,"ê°œ"]}),e.jsx("span",{className:"text-sm text-gray-600 ml-1",children:"í•­ëª©"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-sm text-gray-600 block",children:"ì´ì•¡"}),e.jsxs("span",{className:"font-bold text-xl text-gray-900",children:["â‚©",A.toLocaleString()]})]})]})})]}),r==="delivery"&&k.length>1&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"ìž…ê³  ì§„í–‰ í˜„í™©"}),(()=>{const p=k.filter(L=>L.is_received).length,b=k.length,P=p/b*100;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"ìž…ê³  ì™„ë£Œ"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[p,"/",b,"ê°œ (",P.toFixed(0),"%)"]})]}),e.jsx("div",{className:"w-full bg-blue-200 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${P}%`}})})]})})()]}),e.jsxs("div",{className:"flex justify-between gap-3 mt-6",children:[e.jsxs("div",{className:"flex gap-2",children:[r==="delivery"&&(g.includes("app_admin")||g.includes("lead buyer")||g.includes("receiver"))&&e.jsxs(S,{onClick:async()=>{y(!0);try{const{error:p}=await c.from("purchase_requests").update({is_received:!0,received_at:new Date().toISOString()}).eq("id",d.id);if(p)throw p;await c.from("purchase_request_items").update({is_received:!0,delivery_status:"received"}).eq("purchase_request_id",d.id),D(b=>({...b,is_received:!0,received_at:new Date().toISOString(),purchase_request_items:b.purchase_request_items?.map(P=>({...P,is_received:!0,delivery_status:"received"}))})),C.success("ìž…ê³ ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤."),t?.()}catch{C.error("ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}finally{y(!1)}},disabled:u,className:"bg-blue-600 hover:bg-blue-700",size:"sm",children:[u?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}):e.jsx(K,{className:"w-4 h-4 mr-2"}),"ìž…ê³  ì™„ë£Œ ì²˜ë¦¬"]}),r==="purchase"&&(g.includes("app_admin")||g.includes("lead buyer")||g.includes("receiver"))&&e.jsxs(S,{onClick:async()=>{y(!0);try{const{error:p}=await c.from("purchase_requests").update({is_payment_completed:!0,payment_completed_at:new Date().toISOString()}).eq("id",d.id);if(p)throw p;D(b=>({...b,is_payment_completed:!0,payment_completed_at:new Date().toISOString()})),C.success("êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤."),t?.()}catch{C.error("ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}finally{y(!1)}},disabled:u,className:"bg-yellow-600 hover:bg-yellow-700",size:"sm",children:[u?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}):e.jsx(fe,{className:"w-4 h-4 mr-2"}),"êµ¬ë§¤ ì™„ë£Œ ì²˜ë¦¬"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(S,{variant:"outline",onClick:()=>{o(`/purchase?highlight=${d.id}`),a()},size:"sm",children:["ë°œì£¼ ëª©ë¡ì—ì„œ ë³´ê¸°",e.jsx(ee,{className:"w-4 h-4 ml-2"})]}),e.jsx(S,{variant:"ghost",onClick:a,size:"sm",children:"ë‹«ê¸°"})]})]})]})]})})}function Qe(){const[l,a]=w.useState(null),[n,r]=w.useState(!0),[t,o]=w.useState(null),[c,g]=w.useState(null),[h,u]=w.useState(!1),[y,d]=w.useState([]),[D,k]=w.useState([]),[A,M]=w.useState(new Set),[f,z]=w.useState(null),[p,b]=w.useState(!1),[P,L]=w.useState(null),[Q,se]=w.useState(null),[xe,te]=w.useState(!1),O=ne(),he=F(),I=w.useCallback(async(s=!0)=>{try{s&&r(!0);const i=F(),{data:{user:m},error:q}=await i.auth.getUser();if(q){console.error("Auth error:",q),C.error("ì¸ì¦ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");return}if(!m){console.error("No user found in auth"),C.error("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");return}const{data:x,error:v}=await i.from("employees").select("*").eq("email",m.email).single();if(v||!x){console.error("Employee fetch error:",v);const _={id:m.id,name:m.email?.split("@")[0]||"Guest User",email:m.email||"",purchase_role:null};try{const j=await B.getDashboardData(_);a(j)}catch(j){console.error("âŒ ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë”© ì—ëŸ¬:",j)}r(!1);return}console.log("ðŸ” ì¡°íšŒëœ Employee ë°ì´í„°:",{id:x.id,name:x.name,email:x.email,employee_number:x.employee_number,employeeID:x.employeeID,purchase_role:x.purchase_role}),console.log("========== ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë”© ì‹œìž‘ =========="),console.log("1ï¸âƒ£ í˜„ìž¬ ì‚¬ìš©ìž:",x.name,"/ Email:",x.email),console.log("2ï¸âƒ£ Purchase Role:",x.purchase_role);try{const _=await B.getDashboardData(x),j=await B.getTotalDeliveryWaitingCount();a(_)}catch(_){console.error("âŒ ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë”© ì—ëŸ¬:",_),C.error("ëŒ€ì‹œë³´ë“œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}if(x.purchase_role){const _=Array.isArray(x.purchase_role)?x.purchase_role.map(j=>String(j).trim()):String(x.purchase_role).split(",").map(j=>j.trim()).filter(j=>j.length>0);if(d(_),_.includes("lead buyer")||_.includes("lead buyer")){const j=await B.getUndownloadedOrders(x);k(j)}}}catch{}finally{s&&r(!1)}},[]);w.useEffect(()=>{I()},[I]);const ae=async s=>{if(console.log("handleQuickApprove í˜¸ì¶œ:",{requestId:s,hasData:!!l,hasEmployee:!!l?.employee,employee:l?.employee}),!l?.employee){console.error("handleQuickApprove ì—ëŸ¬: data.employeeê°€ ì—†ìŒ",{data:l}),C.error("ì‚¬ìš©ìž ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");return}if(!confirm("ì •ë§ë¡œ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?"))return;o(s);const i=l;a(m=>m&&{...m,pendingApprovals:m.pendingApprovals.filter(q=>q.id!==s),stats:{...m.stats,pending:Math.max(0,m.stats.pending-1)}});try{const m=await B.quickApprove(s,l.employee);m.success?(C.success("ìŠ¹ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."),setTimeout(()=>{I(!1)},1e3)):(a(i),C.error(m.error||"ìŠ¹ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."))}catch{a(i),C.error("ìŠ¹ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}finally{o(null)}},J=(s,i)=>{L(s),se(i),te(!0)},re=async s=>{try{M(R=>new Set(R).add(s.id));const i=new ye.Workbook,m=i.addWorksheet("ë°œì£¼ì„œ");m.columns=[{header:"ë°œì£¼ë²ˆí˜¸",key:"purchase_order_number",width:20},{header:"ì—…ì²´ëª…",key:"vendor_name",width:30},{header:"í’ˆëª©ëª…",key:"item_name",width:40},{header:"ê·œê²©",key:"specification",width:30},{header:"ìˆ˜ëŸ‰",key:"quantity",width:15},{header:"ë‹¨ê°€",key:"unit_price",width:20},{header:"ê¸ˆì•¡",key:"amount",width:20},{header:"ìš”ì²­ì¼",key:"request_date",width:15},{header:"ì§„í–‰ìƒíƒœ",key:"progress_type",width:15}],(s.purchase_request_items||[]).forEach(R=>{m.addRow({purchase_order_number:s.purchase_order_number,vendor_name:s.vendor_name||s.vendors?.vendor_name||"",item_name:R.item_name||"",specification:R.specification||"",quantity:R.quantity||0,unit_price:R.unit_price_value||0,amount:R.amount_value||0,request_date:s.request_date||"",progress_type:s.progress_type||""})}),m.getRow(1).font={bold:!0},m.getRow(1).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE0E0E0"}};const x=await i.xlsx.writeBuffer(),v=new Blob([x],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),_=window.URL.createObjectURL(v),j=document.createElement("a");j.href=_,j.download=`ë°œì£¼ì„œ_${s.purchase_order_number}_${new Date().toISOString().slice(0,10)}.xlsx`,j.click(),window.URL.revokeObjectURL(_),(y.includes("lead buyer")||y.includes("lead buyer"))&&(await he.from("purchase_requests").update({is_po_download:!0}).eq("id",s.id),k(R=>R.filter(H=>H.id!==s.id))),C.success("ë°œì£¼ì„œê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.")}catch(i){console.error("Excel download error:",i),C.error("ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}finally{M(i=>{const m=new Set(i);return m.delete(s.id),m})}},pe=s=>{switch(s){case"high":return"bg-red-100 text-red-800 border-red-200";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"low":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}};if(n)return e.jsx("div",{className:"flex items-center justify-center h-screen bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-3 border-hansl-500 border-t-transparent rounded-full animate-spin mx-auto"}),e.jsx("p",{className:"mt-4 text-sm text-gray-600",children:"ëŒ€ì‹œë³´ë“œë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìžˆìŠµë‹ˆë‹¤..."})]})});if(!l?.employee)return e.jsx("div",{className:"flex items-center justify-center h-screen bg-gray-50",children:e.jsxs("div",{className:"text-center bg-white p-8 rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"ì‚¬ìš©ìž ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"}),e.jsx("p",{className:"text-sm text-gray-600",children:"ë¡œê·¸ì¸ì„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."})]})});const ge=(Array.isArray(l.employee.purchase_role)?l.employee.purchase_role.map(s=>String(s).trim()):l.employee.purchase_role?String(l.employee.purchase_role).split(",").map(s=>s.trim()).filter(s=>s.length>0):[]).some(s=>["middle_manager","final_approver","app_admin","raw_material_manager","consumable_manager"].includes(s));return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"w-full px-4 lg:px-6",children:[e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"ëŒ€ì‹œë³´ë“œ"}),e.jsxs("p",{className:"text-xs text-gray-600 mt-0.5",children:[l.employee.name,"ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤. ðŸ“Š"]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(N,{variant:"outline",className:"text-xs",children:new Date().toLocaleDateString("ko-KR",{month:"long",day:"numeric",weekday:"short"})})})]})}),l.urgentRequests.length>0&&e.jsxs(T,{className:"mb-3 border-red-200 bg-red-50",children:[e.jsx($,{className:"pb-2 pt-3",children:e.jsxs(E,{className:"flex items-center gap-2 text-red-800 text-sm",children:[e.jsx(Se,{className:"w-4 h-4"}),"ê¸´ê¸‰ ì²˜ë¦¬ í•„ìš” (",l.urgentRequests.length,"ê±´)"]})}),e.jsx(U,{className:"p-3",children:e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:l.urgentRequests.slice(0,5).map(s=>e.jsx("div",{className:"bg-white rounded-lg p-2 border border-red-200 min-w-[280px] flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-1 mb-1",children:[e.jsx(N,{className:`${pe(s.priority)} text-[10px] h-4 px-1`,children:s.priority==="high"?"ë†’ìŒ":s.priority==="medium"?"ë³´í†µ":"ë‚®ìŒ"}),e.jsx("span",{className:"text-xs font-medium text-gray-900 truncate max-w-[120px]",children:s.vendor_name||"ì—…ì²´ëª… ì—†ìŒ"}),e.jsxs("span",{className:"text-[10px] text-gray-500",children:[s.daysOverdue,"ì¼ ì§€ì—°"]})]}),e.jsxs("div",{className:"text-[10px] text-gray-600",children:[e.jsxs("span",{children:["ë°œì£¼: ",s.purchase_order_number||s.id.slice(0,8)]}),e.jsxs("span",{className:"ml-1",children:["â€¢ ",s.total_items,"ê°œ"]})]})]}),e.jsxs("div",{className:"flex gap-1 shrink-0",children:[e.jsxs(S,{size:"sm",variant:"outline",onClick:()=>O(`/purchase?highlight=${s.id}`),className:"h-6 px-2 text-[10px]",children:[e.jsx(je,{className:"w-3 h-3 mr-0.5"}),"ë³´ê¸°"]}),e.jsxs(S,{size:"sm",onClick:()=>ae(s.id),disabled:t===s.id,className:"bg-red-600 hover:bg-red-700 h-6 px-2 text-[10px]",children:[e.jsx(we,{className:"w-3 h-3 mr-0.5"}),t===s.id?"ì²˜ë¦¬ì¤‘":"ìŠ¹ì¸"]})]})]})},s.id))})})]}),e.jsx("div",{className:"mb-2",children:e.jsxs("h2",{className:"text-sm font-semibold text-gray-900 mb-2 flex items-center gap-1.5",children:[e.jsx(V,{className:"w-3.5 h-3.5 text-gray-600"}),"ì „ì²´ í˜„í™©"]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3",children:[(y.includes("lead buyer")||y.includes("lead buyer"))&&D.length>0&&e.jsxs(T,{className:"w-full col-span-1 row-span-2 border-gray-200 shadow-sm hover:shadow-md transition-shadow",children:[e.jsx($,{className:"py-3 px-4 bg-gray-50 border-b",children:e.jsxs(E,{className:"text-sm font-semibold flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-orange-600"}),e.jsx("span",{className:"text-gray-900",children:"ë¯¸ë‹¤ìš´ë¡œë“œ ë°œì£¼ì„œ"})]}),e.jsx(N,{className:"bg-orange-100 text-orange-700 border-orange-200 px-2 py-0.5",children:D.length})]})}),e.jsx(U,{className:"p-4",children:e.jsxs("div",{className:"space-y-2",children:[D.slice(0,5).map(s=>{const i=s.purchase_request_items||[],m=i[0]||{},q=i.reduce((_,j)=>_+(Number(j.amount_value)||0),0);i.reduce((_,j)=>_+(Number(j.quantity)||0),0);const x=Math.floor((Date.now()-new Date(s.created_at).getTime())/(1e3*60*60*24)),v=s.progress_type==="ì„ ì§„í–‰";return e.jsx("div",{className:`border rounded-lg p-3 transition-all cursor-pointer hover:shadow-sm ${v?"bg-red-50 hover:bg-red-100 border-red-200":"bg-white hover:bg-gray-50 border-gray-200"}`,onClick:()=>{z(s),b(!0)},children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold text-sm text-gray-900",children:s.purchase_order_number||`PO-${s.id.slice(0,8)}`}),v&&e.jsx(N,{className:"text-[10px] bg-red-100 text-red-700 border-red-200 px-1.5 py-0",children:"ì„ ì§„í–‰"}),x>3&&e.jsxs(N,{variant:"outline",className:"text-[10px] px-1.5 py-0",children:[x,"ì¼ ê²½ê³¼"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs text-gray-600",children:s.vendor_name||"ì—…ì²´ëª… ì—†ìŒ"}),e.jsxs("div",{className:"text-xs text-gray-500",children:[m.item_name||"í’ˆëª©",i.length>1&&e.jsxs("span",{className:"text-gray-400",children:[" ì™¸ ",i.length-1,"ê±´"]})]})]})]}),e.jsxs("div",{className:"text-right space-y-1",children:[e.jsxs("div",{className:"text-sm font-bold text-gray-900",children:["â‚©",q.toLocaleString()]}),e.jsx(S,{size:"sm",variant:"outline",className:"h-7 px-2 text-[10px] border-orange-200 hover:bg-orange-50",onClick:_=>{_.stopPropagation(),re(s)},disabled:A.has(s.id),children:A.has(s.id)?e.jsx("div",{className:"w-3 h-3 border border-orange-600 border-t-transparent rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-3 h-3 mr-1"}),"ë‹¤ìš´ë¡œë“œ"]})})]})]})},s.id)}),D.length>5&&e.jsxs(S,{variant:"outline",size:"sm",className:"w-full text-xs h-8 border-gray-200 hover:bg-gray-50",onClick:()=>O("/purchase/list?tab=purchase"),children:["ì „ì²´ë³´ê¸° (",D.length,"ê±´) â†’"]})]})})]}),e.jsxs(T,{className:"w-full col-span-1 border-gray-200 shadow-sm hover:shadow-md transition-shadow",children:[e.jsx($,{className:"py-3 px-4 bg-gray-50 border-b",children:e.jsxs(E,{className:"text-sm font-semibold flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{className:"text-gray-900",children:"ë‚´ ìŠ¹ì¸ ì§„í–‰ì¤‘"})]}),l.myRecentRequests.length>0&&e.jsx(N,{className:"bg-purple-100 text-purple-700 border-purple-200 px-2 py-0.5",children:l.myRecentRequests.length})]})}),e.jsx(U,{className:"p-4",children:l.myRecentRequests.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-400",children:[e.jsx(Y,{className:"w-10 h-10 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-sm font-medium",children:"ìŠ¹ì¸ ì§„í–‰ì¤‘ì¸ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤"}),e.jsx(S,{size:"sm",variant:"outline",className:"mt-3 h-8 text-xs px-4 border-gray-200",onClick:()=>O("/purchase/new"),children:"ìƒˆ ìš”ì²­ ìž‘ì„±"})]}):e.jsxs("div",{className:"space-y-2",children:[l.myRecentRequests.slice(0,3).map(s=>{const i=s.middle_manager_status==="pending"?25:50;return e.jsx("div",{className:"border border-gray-200 rounded-lg p-3 bg-white hover:bg-gray-50 transition-all cursor-pointer hover:shadow-sm",onClick:()=>O(`/purchase?highlight=${s.id}`),children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold text-sm text-gray-900",children:s.purchase_order_number||`PO-${s.id.slice(0,8)}`}),e.jsxs(N,{className:"text-[10px] bg-purple-100 text-purple-700 border-purple-200 px-1.5 py-0",children:[i,"% ì§„í–‰"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs text-gray-600",children:s.vendor_name||"ì—…ì²´ëª… ì—†ìŒ"}),e.jsxs("div",{className:"text-xs text-gray-500",children:[s.total_items,"ê°œ í’ˆëª©"]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-purple-600 h-2 rounded-full transition-all",style:{width:`${i}%`}})}),e.jsxs("span",{className:"text-[10px] text-gray-600",children:[i,"%"]})]})]})]}),e.jsxs("div",{className:"text-right space-y-1",children:[e.jsxs("div",{className:"text-sm font-bold text-gray-900",children:["â‚©",(s.total_amount||0).toLocaleString()]}),e.jsx("div",{className:"text-[10px] text-gray-500",children:s.current_step==="approval"?"ìŠ¹ì¸ ëŒ€ê¸°":s.current_step==="purchase"?"êµ¬ë§¤ ëŒ€ê¸°":"ì§„í–‰ì¤‘"})]})]})},s.id)}),l.myRecentRequests.length>3&&e.jsxs(S,{variant:"outline",size:"sm",className:"w-full text-xs h-8 border-gray-200 hover:bg-gray-50",onClick:()=>O("/purchase"),children:["ì „ì²´ë³´ê¸° (",l.myRecentRequests.length,"ê±´) â†’"]})]})})]}),ge&&e.jsxs(T,{className:"w-full col-span-1 row-span-2",children:[e.jsx($,{className:"pb-2 pt-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(E,{className:"text-xs sm:text-sm font-semibold flex items-center gap-1.5",children:[e.jsx(Y,{className:"w-3.5 h-3.5 text-orange-500"}),"ìŠ¹ì¸ ëŒ€ê¸°",l.pendingApprovals.length>0&&e.jsx(N,{variant:"destructive",className:"text-[10px] h-4 px-1",children:l.pendingApprovals.length})]}),l.pendingApprovals.length>0&&e.jsx(S,{size:"sm",variant:"ghost",onClick:()=>O("/purchase"),className:"h-6 px-2",children:e.jsx(ee,{className:"w-3 h-3"})})]})}),e.jsx(U,{className:"p-3",children:l.pendingApprovals.length===0?e.jsxs("div",{className:"text-center py-4 text-gray-400",children:[e.jsx(K,{className:"w-6 h-6 mx-auto mb-1"}),e.jsx("p",{className:"text-xs",children:"ëŒ€ê¸° í•­ëª© ì—†ìŒ"})]}):e.jsx("div",{className:"space-y-1.5",children:l.pendingApprovals.slice(0,5).map(s=>{const i=s.purchase_request_items||[],m=i[0]||{},q=s.total_amount||i.reduce((v,_)=>v+(Number(_.amount_value)||0),0),x=s.progress_type==="ì„ ì§„í–‰";return e.jsx("div",{className:`border rounded-lg p-2 hover:shadow-sm transition-all cursor-pointer ${x?"bg-red-50 border-red-200":"hover:bg-orange-50/30"}`,onClick:v=>{v.target.closest("button")||(g(Number(s.id)),u(!0))},children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx("span",{className:"font-medium text-[11px]",children:s.purchase_order_number}),x&&e.jsx(N,{className:"text-[8px] bg-red-100 text-red-800 px-1 h-3.5",children:"ì„ ì§„í–‰"})]}),e.jsxs("div",{className:"text-[10px] text-gray-600 space-y-0.5",children:[e.jsxs("div",{className:"truncate",children:[m.item_name||"í’ˆëª©"," ",i.length>1&&`ì™¸ ${i.length-1}ê±´`]}),e.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[e.jsx("span",{className:"truncate max-w-[100px]",children:s.vendor_name||"ì—…ì²´"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:["â‚©",(q/1e6).toFixed(1),"M"]})]})]})]}),e.jsx(S,{size:"sm",onClick:v=>{v.stopPropagation(),ae(s.id)},disabled:t===s.id,className:`h-7 px-2 text-white text-[10px] shrink-0 ${s.middle_manager_status==="approved"?"bg-blue-600 hover:bg-blue-700":"bg-green-600 hover:bg-green-700"}`,children:t===s.id?e.jsx("div",{className:"w-3 h-3 border border-white border-t-transparent rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[s.middle_manager_status==="approved"?"ìµœì¢…":"1ì°¨"," ìŠ¹ì¸"]})})]})},s.id)})})})]}),e.jsxs(T,{className:"w-full col-span-1 border-gray-200 shadow-sm hover:shadow-md transition-shadow",children:[e.jsx($,{className:"py-3 px-4 bg-gray-50 border-b",children:e.jsxs(E,{className:"text-sm font-semibold flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4 text-yellow-600"}),e.jsx("span",{className:"text-gray-900",children:"êµ¬ë§¤ ëŒ€ê¸°"})]}),l.myPurchaseStatus&&l.myPurchaseStatus.waitingPurchase&&l.myPurchaseStatus.waitingPurchase.length>0&&e.jsx(N,{className:"bg-yellow-100 text-yellow-700 border-yellow-200 px-2 py-0.5",children:l.myPurchaseStatus.waitingPurchase.length})]})}),e.jsx(U,{className:"p-4",children:!l.myPurchaseStatus||!l.myPurchaseStatus.waitingPurchase||l.myPurchaseStatus.waitingPurchase.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-400",children:[e.jsx(Z,{className:"w-10 h-10 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-sm font-medium",children:"êµ¬ë§¤ ëŒ€ê¸° í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤"})]}):e.jsxs("div",{className:"space-y-2",children:[l.myPurchaseStatus.waitingPurchase.slice(0,3).map(s=>{const i=s.purchase_request_items||[],m=i[0],q=i.reduce((v,_)=>v+(Number(_.amount_value)||0),0),x=(s.progress_type||"").includes("ì„ ì§„í–‰");return e.jsx("div",{className:`border rounded-lg p-3 transition-all cursor-pointer hover:shadow-sm ${x?"bg-red-50 hover:bg-red-100 border-red-200":"bg-white hover:bg-gray-50 border-gray-200"}`,onClick:()=>J(s,"purchase"),children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold text-sm text-gray-900",children:s.purchase_order_number||`PO-${s.id.slice(0,8)}`}),x&&e.jsx(N,{className:"text-[10px] bg-red-100 text-red-700 border-red-200 px-1.5 py-0",children:"ì„ ì§„í–‰"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs text-gray-600",children:s.vendor_name||"ì—…ì²´ëª… ì—†ìŒ"}),e.jsxs("div",{className:"text-xs text-gray-500",children:[m?.item_name||"í’ˆëª©",i.length>1&&e.jsxs("span",{className:"text-gray-400",children:[" ì™¸ ",i.length-1,"ê±´"]})]})]})]}),e.jsxs("div",{className:"text-right space-y-1",children:[e.jsxs("div",{className:"text-sm font-bold text-gray-900",children:["â‚©",q.toLocaleString()]}),e.jsx("div",{className:"text-[10px] text-gray-500",children:new Date(s.request_date).toLocaleDateString("ko-KR")})]})]})},s.id)}),(y.includes("lead_buyer")||y.includes("lead buyer"))&&e.jsx(S,{className:"w-full bg-yellow-600 hover:bg-yellow-700 text-xs h-8",onClick:()=>O("/purchase/list"),children:"êµ¬ë§¤ ì²˜ë¦¬í•˜ê¸°"}),l.myPurchaseStatus.waitingPurchase.length>3&&e.jsxs(S,{variant:"outline",size:"sm",className:"w-full text-xs h-8 border-gray-200 hover:bg-gray-50",onClick:()=>O("/purchase?tab=purchase"),children:["ì „ì²´ë³´ê¸° (",l.myPurchaseStatus.waitingPurchase.length,"ê±´) â†’"]})]})})]}),e.jsxs(T,{className:"w-full col-span-1 border-gray-200 shadow-sm hover:shadow-md transition-shadow",children:[e.jsx($,{className:"py-3 px-4 bg-gray-50 border-b",children:e.jsxs(E,{className:"text-sm font-semibold flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-gray-900",children:"ìž…ê³  ëŒ€ê¸°"})]}),l.myPurchaseStatus.waitingDelivery.length>0&&e.jsx(N,{className:"bg-blue-100 text-blue-700 border-blue-200 px-2 py-0.5",children:l.myPurchaseStatus.waitingDelivery.length})]})}),e.jsx(U,{className:"p-4",children:l.myPurchaseStatus.waitingDelivery.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-400",children:[e.jsx(X,{className:"w-10 h-10 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-sm font-medium",children:"ìž…ê³  ëŒ€ê¸° í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤"})]}):e.jsxs("div",{className:"space-y-2",children:[l.myPurchaseStatus.waitingDelivery.slice(0,3).map(s=>{const i=s.purchase_request_items||[],m=i[0],q=i.length,x=i.filter(R=>R.is_received).length,v=q>0?Math.round(x/q*100):0,_=i.reduce((R,H)=>R+(Number(H.amount_value)||0),0),j=(s.progress_type||"").includes("ì„ ì§„í–‰");return e.jsx("div",{className:`border rounded-lg p-3 transition-all cursor-pointer hover:shadow-sm ${j?"bg-red-50 hover:bg-red-100 border-red-200":"bg-white hover:bg-gray-50 border-gray-200"}`,onClick:()=>J(s,"delivery"),children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold text-sm text-gray-900",children:s.purchase_order_number||`PO-${s.id.slice(0,8)}`}),j&&e.jsx(N,{className:"text-[10px] bg-red-100 text-red-700 border-red-200 px-1.5 py-0",children:"ì„ ì§„í–‰"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs text-gray-600",children:s.vendor_name||"ì—…ì²´ëª… ì—†ìŒ"}),e.jsxs("div",{className:"text-xs text-gray-500",children:[m?.item_name||"í’ˆëª©",q>1&&e.jsxs("span",{className:"text-gray-400",children:[" ì™¸ ",q-1,"ê±´"]})]}),s.delivery_request_date&&e.jsxs("div",{className:"text-xs text-blue-600 font-medium",children:["ë‚©ê¸°: ",new Date(s.delivery_request_date).toLocaleDateString("ko-KR")]})]})]}),e.jsxs("div",{className:"text-right space-y-1",children:[e.jsxs("div",{className:"text-sm font-bold text-gray-900",children:["â‚©",_.toLocaleString()]}),v>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"text-[10px] text-gray-600",children:[x,"/",q," ìž…ê³  (",v,"%)"]}),e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:"bg-blue-600 h-1.5 rounded-full",style:{width:`${v}%`}})})]})]})]})},s.id)}),l.myPurchaseStatus.waitingDelivery.length>3&&e.jsxs(S,{variant:"outline",size:"sm",className:"w-full text-xs h-8 border-gray-200 hover:bg-gray-50",onClick:()=>O("/purchase?tab=receipt"),children:["ì „ì²´ë³´ê¸° (",l.myPurchaseStatus.waitingDelivery.length,"ê±´) â†’"]})]})})]}),e.jsxs(T,{className:"w-full col-span-1 border-gray-200 shadow-sm hover:shadow-md transition-shadow",children:[e.jsx($,{className:"py-3 px-4 bg-gray-50 border-b",children:e.jsxs(E,{className:"text-sm font-semibold flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-gray-900",children:"ìµœê·¼ ì™„ë£Œ"})]}),l.myPurchaseStatus.recentCompleted.length>0&&e.jsx(N,{className:"bg-green-100 text-green-700 border-green-200 px-2 py-0.5",children:l.myPurchaseStatus.recentCompleted.length})]})}),e.jsx(U,{className:"p-4",children:l.myPurchaseStatus.recentCompleted.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-400",children:[e.jsx(K,{className:"w-10 h-10 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-sm font-medium",children:"ìµœê·¼ ì™„ë£Œ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤"})]}):e.jsxs("div",{className:"space-y-2",children:[l.myPurchaseStatus.recentCompleted.slice(0,3).map(s=>{const i=s.purchase_request_items||[],m=i[0],q=i.reduce((x,v)=>x+(Number(v.amount_value)||0),0);return e.jsx("div",{className:"border border-green-200 rounded-lg p-3 bg-green-50 hover:bg-green-100 transition-all cursor-pointer hover:shadow-sm",onClick:()=>J(s,"completed"),children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold text-sm text-gray-900",children:s.purchase_order_number||`PO-${s.id.slice(0,8)}`}),e.jsx(N,{className:"text-[10px] bg-green-100 text-green-700 border-green-200 px-1.5 py-0",children:"ì™„ë£Œ"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs text-gray-600",children:s.vendor_name||"ì—…ì²´ëª… ì—†ìŒ"}),e.jsxs("div",{className:"text-xs text-gray-500",children:[m?.item_name||"í’ˆëª©",i.length>1&&e.jsxs("span",{className:"text-gray-400",children:[" ì™¸ ",i.length-1,"ê±´"]})]}),s.received_at&&e.jsxs("div",{className:"text-xs text-green-600 font-medium",children:["ìž…ê³ ì™„ë£Œ: ",new Date(s.received_at).toLocaleDateString("ko-KR")]})]})]}),e.jsxs("div",{className:"text-right space-y-1",children:[e.jsxs("div",{className:"text-sm font-bold text-gray-900",children:["â‚©",q.toLocaleString()]}),e.jsx("div",{className:"text-[10px] text-gray-500",children:new Date(s.received_at||s.created_at).toLocaleDateString("ko-KR")})]})]})},s.id)}),l.myPurchaseStatus.recentCompleted.length>3&&e.jsxs(S,{variant:"outline",size:"sm",className:"w-full text-xs h-8 border-gray-200 hover:bg-gray-50",onClick:()=>O("/purchase?tab=done"),children:["ì „ì²´ë³´ê¸° (",l.myPurchaseStatus.recentCompleted.length,"ê±´) â†’"]})]})})]})]})]}),e.jsx(_e,{purchaseId:c,isOpen:h,onClose:()=>{u(!1),g(null)},currentUserRoles:y,onRefresh:()=>{I(),u(!1),g(null)}}),e.jsx(ke,{isOpen:xe,onClose:()=>{te(!1),L(null),se(null)},item:P,type:Q,onRefresh:()=>I(!1)}),p&&f&&e.jsx(ce,{open:p,onOpenChange:()=>{b(!1),z(null)},children:e.jsxs(de,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(oe,{children:[e.jsxs(me,{className:"text-xl font-bold",children:[f.purchase_order_number," ìƒì„¸ë³´ê¸°"]}),e.jsx(ue,{children:f.vendor_name||"ì—…ì²´ëª… ì—†ìŒ"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center text-gray-900",children:[e.jsx(le,{className:"w-5 h-5 mr-2 text-gray-700"}),"ê¸°ë³¸ ì •ë³´"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"ìš”ì²­ìž"}),e.jsx("p",{className:"font-medium text-gray-900",children:f.requester_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"ìš”ì²­ì¼"}),e.jsx("p",{className:"font-medium text-gray-900",children:new Date(f.request_date||f.created_at).toLocaleDateString("ko-KR")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"ë‚©ê¸°ìš”ì²­ì¼"}),e.jsx("p",{className:"font-medium text-gray-900",children:f.delivery_request_date?new Date(f.delivery_request_date).toLocaleDateString("ko-KR"):"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"ê²°ì œìœ í˜•"}),e.jsx("p",{className:"font-medium text-gray-900",children:f.payment_category||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"ì§„í–‰êµ¬ë¶„"}),e.jsx("p",{className:"font-medium text-gray-900",children:f.progress_type||"ì¼ë°˜"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"ìƒíƒœ"}),e.jsx("p",{className:"font-medium",children:e.jsx(N,{className:"bg-orange-50 text-orange-700 border-orange-200",children:"ë¯¸ë‹¤ìš´ë¡œë“œ"})})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center text-gray-900",children:[e.jsx(ie,{className:"w-5 h-5 mr-2 text-gray-700"}),"ì—…ì²´ ì •ë³´"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"ì—…ì²´ëª…"}),e.jsx("p",{className:"font-medium text-gray-900",children:f.vendor_name||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"í”„ë¡œì íŠ¸ ì—…ì²´"}),e.jsx("p",{className:"font-medium text-gray-900",children:f.project_vendor||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"íŒë§¤ì£¼ë¬¸ë²ˆí˜¸"}),e.jsx("p",{className:"font-medium text-gray-900",children:f.sales_order_number||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"í”„ë¡œì íŠ¸ í’ˆëª©"}),e.jsx("p",{className:"font-medium text-gray-900",children:f.project_item||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"ë°œì£¼ì„œ í…œí”Œë¦¿"}),e.jsx("p",{className:"font-medium text-gray-900",children:f.po_template_type||"ì¼ë°˜"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"í†µí™”"}),e.jsx("p",{className:"font-medium text-gray-900",children:f.currency||"KRW"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center text-gray-900",children:[e.jsx(V,{className:"w-5 h-5 mr-2 text-gray-700"}),"í’ˆëª© ë¦¬ìŠ¤íŠ¸"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white rounded-lg overflow-hidden shadow-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"í’ˆëª…"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"ê·œê²©"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"ìˆ˜ëŸ‰"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"ë‹¨ê°€"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"ê¸ˆì•¡"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"ë¹„ê³ "})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:(f.purchase_request_items||[]).map((s,i)=>{const m=s.quantity>0?(Number(s.amount_value)||0)/s.quantity:0;return e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm font-medium text-gray-900",children:s.item_name||"í’ˆëª©ëª… ì—†ìŒ"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm text-gray-600",children:s.specification||"-"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:"text-sm font-medium text-gray-900",children:s.quantity||0})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("span",{className:"text-sm text-gray-900",children:["â‚©",m.toLocaleString()]})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:["â‚©",(Number(s.amount_value)||0).toLocaleString()]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-sm text-gray-600",children:s.remark||"-"})})]},i)})})]})}),e.jsx("div",{className:"mt-6 bg-white rounded-lg p-4 shadow-sm",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"ì´"}),e.jsxs("span",{className:"ml-1 font-semibold text-gray-900",children:[(f.purchase_request_items||[]).reduce((s,i)=>s+(Number(i.quantity)||0),0),"ê°œ"]}),e.jsx("span",{className:"text-sm text-gray-600 ml-1",children:"í•­ëª©"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-sm text-gray-600 block",children:"ì´ì•¡"}),e.jsxs("span",{className:"font-bold text-xl text-gray-900",children:["â‚©",(f.purchase_request_items||[]).reduce((s,i)=>s+(Number(i.amount_value)||0),0).toLocaleString()]})]})]})})]}),e.jsxs("div",{className:"flex justify-between gap-3 mt-6",children:[e.jsx("div",{className:"flex gap-2",children:e.jsxs(S,{onClick:()=>re(f),disabled:A.has(f.id),className:"bg-orange-600 hover:bg-orange-700",size:"sm",children:[A.has(f.id)?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}):e.jsx(G,{className:"w-4 h-4 mr-2"}),"Excel ë‹¤ìš´ë¡œë“œ"]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(S,{variant:"outline",onClick:()=>O("/purchase/list?tab=purchase"),size:"sm",children:["ë°œì£¼ ëª©ë¡ì—ì„œ ë³´ê¸°",e.jsx(ee,{className:"w-4 h-4 ml-2"})]}),e.jsx(S,{variant:"ghost",onClick:()=>{b(!1),z(null)},size:"sm",children:"ë‹«ê¸°"})]})]})]})]})})]})}export{Qe as default};
//# sourceMappingURL=DashboardMain-CS608qVu.js.map
