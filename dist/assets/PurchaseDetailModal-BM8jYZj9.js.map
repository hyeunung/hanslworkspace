{"version":3,"file":"PurchaseDetailModal-BM8jYZj9.js","sources":["../../node_modules/lucide-react/dist/esm/icons/truck.js","../../src/components/ui/date-picker-dialog.tsx","../../src/components/purchase/PurchaseDetailModal.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2\", key: \"wrbu53\" }],\n  [\"path\", { d: \"M15 18H9\", key: \"1lyqi6\" }],\n  [\n    \"path\",\n    {\n      d: \"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14\",\n      key: \"lysw3i\"\n    }\n  ],\n  [\"circle\", { cx: \"17\", cy: \"18\", r: \"2\", key: \"332jqn\" }],\n  [\"circle\", { cx: \"7\", cy: \"18\", r: \"2\", key: \"19iecd\" }]\n];\nconst Truck = createLucideIcon(\"truck\", __iconNode);\n\nexport { __iconNode, Truck as default };\n//# sourceMappingURL=truck.js.map\n","import { useState } from 'react'\nimport { Calendar } from '@/components/ui/calendar'\nimport { Button } from '@/components/ui/button'\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from '@/components/ui/dialog'\nimport { CalendarIcon } from 'lucide-react'\nimport { format } from 'date-fns'\nimport { ko } from 'date-fns/locale'\n\ninterface DatePickerDialogProps {\n  isOpen: boolean\n  onClose: () => void\n  onDateSelect: (date: Date) => void\n  title?: string\n  description?: string\n  defaultDate?: Date\n}\n\nexport function DatePickerDialog({\n  isOpen,\n  onClose,\n  onDateSelect,\n  title = \"ë‚ ì§œ ì„ íƒ\",\n  description = \"ì‹¤ì œ ì…ê³ ëœ ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”\",\n  defaultDate = new Date()\n}: DatePickerDialogProps) {\n  const [selectedDate, setSelectedDate] = useState<Date>(defaultDate)\n\n  const handleConfirm = () => {\n    onDateSelect(selectedDate)\n    onClose()\n  }\n\n  const handleCancel = () => {\n    setSelectedDate(defaultDate)\n    onClose()\n  }\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"sm:max-w-[425px]\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <CalendarIcon className=\"w-5 h-5\" />\n            {title}\n          </DialogTitle>\n          {description && (\n            <p className=\"text-sm text-gray-600 mt-2\">{description}</p>\n          )}\n        </DialogHeader>\n        \n        <div className=\"flex justify-center py-4\">\n          <Calendar\n            mode=\"single\"\n            selected={selectedDate}\n            onSelect={(date) => date && setSelectedDate(date)}\n            locale={ko}\n            className=\"rounded-md border\"\n          />\n        </div>\n\n        <div className=\"text-center text-sm text-gray-600 mb-4\">\n          ì„ íƒí•œ ë‚ ì§œ: {format(selectedDate, 'yyyyë…„ MMì›” ddì¼ (E)', { locale: ko })}\n        </div>\n\n        <DialogFooter className=\"gap-2\">\n          <Button \n            variant=\"outline\" \n            onClick={handleCancel}\n            className=\"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50\"\n          >\n            ì·¨ì†Œ\n          </Button>\n          <Button \n            onClick={handleConfirm}\n            className=\"button-base bg-blue-500 hover:bg-blue-600 text-white\"\n          >\n            í™•ì¸\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  )\n}","import { useEffect, useState, useRef, useCallback } from 'react'\nimport { createClient } from '@/lib/supabase/client'\nimport { PurchaseRequestWithDetails, Purchase } from '@/types/purchase'\nimport { formatDate } from '@/utils/helpers'\nimport { DatePickerPopover } from '@/components/ui/date-picker-popover'\nimport { DatePicker } from '@/components/ui/datepicker'\nimport { DatePickerDialog } from '@/components/ui/date-picker-dialog'\nimport { \n  Calendar, \n  User, \n  Building2, \n  Package, \n  CreditCard,\n  X,\n  FileText,\n  DollarSign,\n  Edit2,\n  Trash2,\n  Save,\n  Plus,\n  CheckCircle,\n  XCircle,\n  Check,\n  Truck\n} from 'lucide-react'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport { Input } from '@/components/ui/input'\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog'\nimport { toast } from 'sonner'\nimport { logger } from '@/lib/logger'\nimport { useConfirmDateAction } from '@/hooks/useConfirmDateAction'\n\ninterface PurchaseDetailModalProps {\n  purchaseId: number | null\n  isOpen: boolean\n  onClose: () => void\n  embedded?: boolean  // Dialog ì—†ì´ ë‚´ìš©ë§Œ ë Œë”ë§\n  currentUserRoles?: string[]\n  activeTab?: string\n  onRefresh?: (forceRefresh?: boolean, options?: { silent?: boolean }) => void | Promise<void>\n  onOptimisticUpdate?: (purchaseId: number, updater: (prev: Purchase) => Purchase) => void\n  onDelete?: (purchase: PurchaseRequestWithDetails) => void\n}\n\nexport default function PurchaseDetailModal({ \n  purchaseId, \n  isOpen, \n  onClose, \n  embedded = false,\n  currentUserRoles = [],\n  activeTab,\n  onRefresh,\n  onOptimisticUpdate,\n  onDelete\n}: PurchaseDetailModalProps) {\n  const [loading, setLoading] = useState(false)\n  const [purchase, setPurchase] = useState<PurchaseRequestWithDetails | null>(null)\n  const [isEditing, setIsEditing] = useState(false)\n  const [editedPurchase, setEditedPurchase] = useState<PurchaseRequestWithDetails | null>(null)\n  const [editedItems, setEditedItems] = useState<any[]>([])\n  const [deletedItemIds, setDeletedItemIds] = useState<number[]>([])\n  const [userRoles, setUserRoles] = useState<string[]>([])\n  const [currentUserName, setCurrentUserName] = useState<string>('')\n  const [columnWidths, setColumnWidths] = useState<number[]>([])\n  const headerRowRef = useRef<HTMLDivElement>(null)\n  const supabase = createClient()\n  \n  // ë‚ ì§œ ë‹¤ì´ì–¼ë¡œê·¸ ìƒíƒœ\n  const [showDeliveryDateDialog, setShowDeliveryDateDialog] = useState(false)\n  const [showRevisedDateDialog, setShowRevisedDateDialog] = useState(false)\n  \n  // ì‚¬ìš©ì ê¶Œí•œ ë° ì´ë¦„ ì§ì ‘ ë¡œë“œ\n  useEffect(() => {\n    const loadUserRoles = async () => {\n      try {\n        const { data: { user } } = await supabase.auth.getUser()\n        if (user) {\n          // ë¨¼ì € IDë¡œ ì‹œë„\n          let { data: employeeData } = await supabase\n            .from('employees')\n            .select('*')\n            .eq('id', user.id)\n            .maybeSingle()\n          \n          // IDë¡œ ëª» ì°¾ì•˜ìœ¼ë©´ ì´ë©”ì¼ë¡œ ì‹œë„\n          if (!employeeData && user.email) {\n            const { data: employeeByEmail } = await supabase\n              .from('employees')\n              .select('*')\n              .eq('email', user.email)\n              .maybeSingle()\n            \n            employeeData = employeeByEmail\n          }\n          \n          // ì‚¬ìš©ì ì´ë¦„ ì €ì¥\n          if (employeeData?.name) {\n            setCurrentUserName(employeeData.name)\n          }\n          \n          if (employeeData?.purchase_role) {\n            let roles: string[] = []\n            if (Array.isArray(employeeData.purchase_role)) {\n              roles = employeeData.purchase_role.map((r: any) => String(r).trim())\n            } else {\n              const roleString = String(employeeData.purchase_role)\n              roles = roleString\n                .split(',')\n                .map((r: string) => r.trim())\n                .filter((r: string) => r.length > 0)\n            }\n            setUserRoles(roles)\n          }\n        }\n      } catch (error) {\n      }\n    }\n    \n    if (isOpen) {\n      loadUserRoles()\n    }\n  }, [isOpen])\n  \n  // currentUserRolesê°€ ë°°ì—´ì´ ì•„ë‹ˆë©´ userRoles ì‚¬ìš©\n  const effectiveRoles = Array.isArray(currentUserRoles) && currentUserRoles.length > 0 \n    ? currentUserRoles \n    : userRoles\n  \n  // ê¶Œí•œ ì²´í¬\n  const canEdit = effectiveRoles.includes('final_approver') || \n                  effectiveRoles.includes('app_admin') || \n                  effectiveRoles.includes('ceo')\n  \n  // ì‚­ì œ ê¶Œí•œ: ê´€ë¦¬ì ë˜ëŠ” ìš”ì²­ì ë³¸ì¸ (ë‹¨, ìŠ¹ì¸ëœ ìš”ì²­ì€ ê´€ë¦¬ìë§Œ)\n  const isApproved = purchase?.final_manager_status === 'approved';\n  const canDelete = isApproved \n    ? canEdit  // ìŠ¹ì¸ëœ ìš”ì²­ì€ ê´€ë¦¬ìë§Œ ì‚­ì œ ê°€ëŠ¥\n    : (canEdit || (purchase?.requester_name === currentUserName))  // ë¯¸ìŠ¹ì¸ ìš”ì²­ì€ ìš”ì²­ìë„ ì‚­ì œ ê°€ëŠ¥\n  \n  // êµ¬ë§¤ ê¶Œí•œ ì²´í¬: app_admin + lead buyerë§Œ (ìš”ì²­ì ë³¸ì¸ ì œì™¸)\n  const canPurchase = effectiveRoles.includes('app_admin') || \n                     effectiveRoles.includes('lead_buyer') || \n                     effectiveRoles.includes('lead buyer')\n  \n  // ì…ê³  ê¶Œí•œ ì²´í¬ \n  // 1. ê´€ë¦¬ìëŠ” ëª¨ë“  ê±´ ì…ê³  ì²˜ë¦¬ ê°€ëŠ¥\n  // 2. ìš”ì²­ìëŠ” ìì‹ ì˜ ìš”ì²­ê±´ë§Œ ì…ê³  ì²˜ë¦¬ ê°€ëŠ¥\n  const canReceiveItems = effectiveRoles.includes('app_admin') || \n                         (purchase?.requester_name === currentUserName)\n  // 2. ì¼ë°˜ ì§ì›ì€ ë³¸ì¸ì´ ìš”ì²­í•œ ê±´ë§Œ ì…ê³  ì²˜ë¦¬ ê°€ëŠ¥\n  const isAdmin = effectiveRoles.includes('final_approver') || \n                  effectiveRoles.includes('app_admin') || \n                  effectiveRoles.includes('ceo')\n  const isRequester = purchase?.requester_name === currentUserName\n  const canReceiptCheck = isAdmin || isRequester\n  \n  console.log('ğŸ” ê¶Œí•œ ì²´í¬ ì •ë³´:', {\n    currentUserName,\n    effectiveRoles,\n    isAdmin,\n    isRequester,\n    canReceiptCheck,\n    purchaseRequesterName: purchase?.requester_name\n  })\n\n  // ëª¨ë‹¬ ë‚´ë¶€ ë°ì´í„°ë§Œ ìƒˆë¡œê³ ì¹¨í•˜ëŠ” í•¨ìˆ˜ (ëª¨ë‹¬ ë‹«ì§€ ì•ŠìŒ)\n  const refreshModalData = useCallback(async () => {\n    if (!purchaseId) return\n    \n    try {\n      // ìµœì‹  êµ¬ë§¤ ìš”ì²­ ë°ì´í„° ë¡œë“œ\n      const { data: freshPurchase } = await supabase\n        .from('purchase_requests')\n        .select(`\n          *,\n          items:purchase_request_items (\n            *\n          )\n        `)\n        .eq('id', purchaseId)\n        .single()\n      \n      if (freshPurchase) {\n          setPurchase(freshPurchase as PurchaseRequestWithDetails)\n          setEditedPurchase(freshPurchase as PurchaseRequestWithDetails)\n          setEditedItems((freshPurchase as PurchaseRequestWithDetails).items || [])\n          \n          // ì™¸ë¶€ ì§„í–‰ë¥  ì—…ë°ì´íŠ¸ëŠ” ë³„ë„ì˜ ì´ë²¤íŠ¸ë¡œ ì²˜ë¦¬ (ëª¨ë‹¬ ìƒíƒœì— ì˜í–¥ ì£¼ì§€ ì•ŠìŒ)\n          // í•„ìš”ì‹œ ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‹¤ì‹œê°„ ë°ì´í„° í´ë§ ë“±ìœ¼ë¡œ ì²˜ë¦¬\n          logger.debug('ëª¨ë‹¬ ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ - ëª¨ë‹¬ ìƒíƒœ ìœ ì§€')\n        }\n    } catch (error) {\n      logger.error('ëª¨ë‹¬ ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨', error)\n    }\n  }, [purchaseId, supabase])\n  \n  // ì»´í¬ë„ŒíŠ¸ê°€ ë§ˆìš´íŠ¸ë  ë•Œ ì™¸ë¶€ ìƒˆë¡œê³ ì¹¨ì„ ë°©ì§€í•˜ëŠ” í”Œë˜ê·¸\n  const [isInitialLoad, setIsInitialLoad] = useState(true)\n  \n  // ì»¤ìŠ¤í…€ í›… ì„¤ì •\n  const purchaseIdNumber = purchaseId ? Number(purchaseId) : (purchase ? Number(purchase.id) : NaN)\n\n  const handleActualReceiptOptimisticUpdate = useCallback(({ itemId, selectedDate, action }: {\n    itemId: number\n    selectedDate?: Date\n    action: 'confirm' | 'cancel'\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n    }\n  }) => {\n    const itemIdStr = String(itemId)\n    const nowIso = new Date().toISOString()\n    const selectedDateIso = selectedDate ? selectedDate.toISOString() : undefined\n\n    const updateItems = (items?: any[]) => {\n      if (!items) return items\n      return items.map(item => {\n        if (String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_received: true,\n            actual_received_date: selectedDateIso,\n            received_at: nowIso\n          }\n        }\n\n        return {\n          ...item,\n          is_received: false,\n          actual_received_date: undefined,\n          received_at: undefined\n        }\n      })\n    }\n\n    setPurchase(prev => {\n      if (!prev) return prev\n      const updatedItems = updateItems(prev.items) || []\n      const total = updatedItems.length\n      const completed = updatedItems.filter(item => item.is_received).length\n      const allReceived = total > 0 && completed === total\n\n      return {\n        ...prev,\n        items: updatedItems,\n        is_received: allReceived,\n        received_at: allReceived ? (prev.received_at || nowIso) : undefined\n      }\n    })\n\n    setEditedPurchase(prev => {\n      if (!prev) return prev\n      const updatedItems = updateItems(prev.items) || []\n      return {\n        ...prev,\n        items: updatedItems\n      }\n    })\n\n    setEditedItems(prevItems => {\n      if (!prevItems || prevItems.length === 0) return prevItems\n      return prevItems.map(item => {\n        if (!item.id || String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_received: true,\n            actual_received_date: selectedDateIso,\n            received_at: nowIso\n          }\n        }\n\n        return {\n          ...item,\n          is_received: false,\n          actual_received_date: undefined,\n          received_at: undefined\n        }\n      })\n    })\n\n    if (!Number.isNaN(purchaseIdNumber)) {\n      onOptimisticUpdate?.(purchaseIdNumber, prevPurchase => {\n        const updatedItems = updateItems(prevPurchase.items) || prevPurchase.items || []\n        const total = updatedItems.length || prevPurchase.items?.length || 0\n        const completed = updatedItems.filter(item => item.is_received).length\n        const allReceived = total > 0 && completed === total\n\n        return {\n          ...prevPurchase,\n          items: updatedItems,\n          is_received: allReceived,\n          received_at: allReceived ? (prevPurchase.received_at || nowIso) : undefined\n        }\n      })\n    }\n  }, [onOptimisticUpdate, purchaseIdNumber])\n\n  const statementReceivedAction = useConfirmDateAction({\n    config: {\n      field: 'statement_received',\n      confirmMessage: {\n        confirm: 'ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ì„ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?',\n        cancel: 'ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?'\n      },\n      successMessage: {\n        confirm: 'ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.',\n        cancel: 'ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.'\n      },\n      completedText: 'âœ“ ì™„ë£Œ',\n      waitingText: 'ëŒ€ê¸°'\n    },\n    currentUserName,\n    canPerformAction: canReceiptCheck,\n    onUpdate: refreshModalData\n  })\n\n  const actualReceivedAction = useConfirmDateAction({\n    config: {\n      field: 'actual_received',\n      confirmMessage: {\n        confirm: 'ì‹¤ì œ ì…ê³  ì²˜ë¦¬ë¥¼ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?',\n        cancel: 'ì‹¤ì œ ì…ê³  ì²˜ë¦¬ë¥¼ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?'\n      },\n      successMessage: {\n        confirm: 'ì‹¤ì œ ì…ê³  ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.',\n        cancel: 'ì‹¤ì œ ì…ê³  ì²˜ë¦¬ê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.'\n      },\n      completedText: 'ì…ê³ ì™„ë£Œ',\n      waitingText: 'ì…ê³ ëŒ€ê¸°'\n    },\n    currentUserName,\n    canPerformAction: canReceiptCheck,\n    onUpdate: refreshModalData,\n    onOptimisticUpdate: handleActualReceiptOptimisticUpdate\n  })\n  \n  // ë‚ ì§œ ì„ íƒ í•¸ë“¤ëŸ¬ë“¤\n  const handleDeliveryDateSelect = (date: Date) => {\n    setEditedPurchase(prev => prev ? { \n      ...prev, \n      delivery_request_date: date.toISOString().split('T')[0] \n    } : null)\n  }\n  \n  const handleRevisedDateSelect = (date: Date) => {\n    setEditedPurchase(prev => prev ? { \n      ...prev, \n      revised_delivery_request_date: date.toISOString().split('T')[0] \n    } : null)\n  }\n  \n  // ê¶Œí•œ ë””ë²„ê¹… ë¡œê·¸\n  console.log('ğŸ” ê¶Œí•œ ì²´í¬:', {\n    currentUserName,\n    requesterName: purchase?.requester_name,\n    effectiveRoles,\n    isAdmin,\n    isRequester,\n    canReceiptCheck\n  })\n  \n  // ë””ë²„ê¹…ìš© ë¡œê·¸\n  logger.debug('Receipt Check', {\n    activeTab,\n    canReceiptCheck,\n    isAdmin,\n    isRequester,\n    currentUserName,\n    requesterName: purchase?.requester_name,\n    effectiveRoles\n  });\n  \n  // ìŠ¹ì¸ ê¶Œí•œ ì²´í¬\n const canApproveMiddle = effectiveRoles.includes('middle_manager') || \n                          effectiveRoles.includes('app_admin') || \n                          effectiveRoles.includes('ceo')\n \n const canApproveFinal = effectiveRoles.includes('final_approver') || \n                         effectiveRoles.includes('app_admin') || \n                         effectiveRoles.includes('ceo')\n \n const approvalPillClass = 'inline-flex items-center gap-1 business-radius-badge px-2 py-0.5 badge-text leading-tight'\n const approvalButtonClass = 'inline-flex items-center gap-1 business-radius-badge !h-auto !min-h-0 !px-2.5 !py-0.5 badge-text leading-tight'\n const approvalWaitingPillClass = 'inline-flex items-center gap-1 business-radius-badge px-2.5 py-0.5 badge-text leading-tight'\n \n   // ë””ë²„ê¹… ë¡œê·¸\n   logger.debug('PurchaseDetailModal ê¶Œí•œ ì²´í¬', {\n     currentUserRoles,\n     userRoles,\n     effectiveRoles,\n     canApproveMiddle,\n     canApproveFinal,\n     isEditing,\n     middleManagerStatus: purchase?.middle_manager_status,\n     finalManagerStatus: purchase?.final_manager_status\n   });\n \n  useEffect(() => {\n    if (purchaseId && isOpen) {\n      loadPurchaseDetail(purchaseId.toString())\n      setIsEditing(false) // ëª¨ë‹¬ ì—´ ë•Œë§ˆë‹¤ í¸ì§‘ ëª¨ë“œ ì´ˆê¸°í™”\n    }\n  }, [purchaseId, isOpen])\n\n  // ì¹¼ëŸ¼ ë„ˆë¹„ ê³„ì‚° (í…ìŠ¤íŠ¸ ê¸¸ì´ ê¸°ë°˜)\n  const calculateOptimalColumnWidths = useCallback(() => {\n    if (!purchase?.items || purchase.items.length === 0) return []\n\n    const items = purchase.items ?? []\n\n    const columnConfigs = [\n      { key: 'item_name', minWidth: 80, maxWidth: 500, baseWidth: 80 },\n      { key: 'specification', minWidth: 120, maxWidth: 700, baseWidth: 120 },\n      { key: 'quantity', minWidth: 70, maxWidth: 100, baseWidth: 70 },\n      { key: 'unit_price', minWidth: 90, maxWidth: 150, baseWidth: 90 },\n      { key: 'total_price', minWidth: 100, maxWidth: 180, baseWidth: 100 },\n      { key: 'remarks', minWidth: 80, maxWidth: 240, baseWidth: 80 },\n      { key: 'status', minWidth: 80, maxWidth: 120, baseWidth: 80 }\n    ]\n\n    // ì¶”ê°€ ì¹¼ëŸ¼ë“¤ (íƒ­ë³„)\n    if (activeTab === 'receipt') {\n      columnConfigs.push({ key: 'actual_receipt_date', minWidth: 100, maxWidth: 160, baseWidth: 100 })\n    }\n    if (activeTab === 'done') {\n      columnConfigs.push(\n        { key: 'transaction_confirm', minWidth: 100, maxWidth: 160, baseWidth: 100 },\n        { key: 'accounting_date', minWidth: 100, maxWidth: 160, baseWidth: 100 },\n        { key: 'processor', minWidth: 80, maxWidth: 120, baseWidth: 80 }\n      )\n    }\n\n    const calculatedWidths = columnConfigs.map((config, index) => {\n      let maxLength = 4 // ìµœì†Œ 4ì\n\n      // í—¤ë” í…ìŠ¤íŠ¸ ê¸¸ì´ ê³ ë ¤ (íƒ­ë³„)\n      const getHeaders = () => {\n        const statusHeader = activeTab === 'purchase'\n          ? 'êµ¬ë§¤ìƒíƒœ'\n          : (activeTab === 'receipt' || activeTab === 'done')\n          ? 'ì…ê³ ìƒíƒœ'\n          : 'ìƒíƒœ'\n\n        const baseHeaders = ['í’ˆëª©ëª…', 'ê·œê²©', 'ìˆ˜ëŸ‰', 'ë‹¨ê°€', 'í•©ê³„', 'ë¹„ê³ ', statusHeader]\n        if (activeTab === 'receipt') {\n          return [...baseHeaders, 'ì‹¤ì œì…ê³ ì¼']\n        } else if (activeTab === 'done') {\n          return [...baseHeaders, 'ê±°ë˜ëª…ì„¸ì„œ í™•ì¸', 'íšŒê³„ìƒ ì…ê³ ì¼', 'ì²˜ë¦¬ì']\n        }\n        return baseHeaders\n      }\n      \n      const headers = getHeaders()\n      if (headers[index]) {\n        maxLength = Math.max(maxLength, headers[index].length)\n      }\n\n      // ì‹¤ì œ ë°ì´í„°ì—ì„œ ìµœëŒ€ ê¸¸ì´ ì°¾ê¸°\n      items.forEach(item => {\n        let cellValue = ''\n        switch (config.key) {\n          case 'item_name':\n            cellValue = item.item_name || ''\n            break\n          case 'specification':\n            cellValue = item.specification || ''\n            break\n          case 'quantity':\n            cellValue = item.quantity?.toString() || ''\n            break\n          case 'unit_price':\n            cellValue = item.unit_price_value != null ? item.unit_price_value.toLocaleString() : ''\n            break\n          case 'total_price':\n            if (item.amount_value != null) {\n              cellValue = item.amount_value.toLocaleString()\n            } else if (item.quantity != null && item.unit_price_value != null) {\n              cellValue = (Number(item.quantity) * Number(item.unit_price_value)).toLocaleString()\n            } else {\n              cellValue = ''\n            }\n            break\n          case 'remarks':\n            cellValue = item.remark || ''\n            break\n          case 'status':\n            cellValue = getStatusDisplay(item) || ''\n            break\n          case 'actual_receipt_date':\n            cellValue = item.actual_received_date ? formatDate(item.actual_received_date) : ''\n            break\n          case 'transaction_confirm':\n            cellValue = item.is_statement_received ? 'í™•ì¸ì™„ë£Œ' : 'ë¯¸í™•ì¸'\n            break\n          case 'accounting_date':\n            cellValue = item.statement_received_date ? formatDate(item.statement_received_date) : ''\n            break\n          case 'processor':\n            cellValue = item.statement_received_by_name || ''\n            break\n        }\n        \n        // í•œê¸€/ì˜ë¬¸ í˜¼í•© í…ìŠ¤íŠ¸ ê¸¸ì´ ê³„ì‚° (í•œê¸€ì€ 1.5ë°° ê°€ì¤‘ì¹˜)\n        const adjustedLength = cellValue.split('').reduce((acc, char) => {\n          return acc + (/[ê°€-í£]/.test(char) ? 1.5 : 1)\n        }, 0)\n        \n        maxLength = Math.max(maxLength, Math.ceil(adjustedLength))\n      })\n\n      // ê¸¸ì´ë¥¼ í”½ì…€ë¡œ ë³€í™˜ (ê¸€ìë‹¹ ì•½ 7px + ì—¬ë°± 20px)\n      const calculatedWidth = Math.max(\n        config.minWidth,\n        Math.min(config.maxWidth, maxLength * 7 + 20)\n      )\n\n      logger.debug(`Column ${config.key} calculated:`, { \n        maxLength, \n        calculatedWidth, \n        range: `${config.minWidth}-${config.maxWidth}px` \n      })\n\n      return calculatedWidth\n    })\n\n    setColumnWidths(calculatedWidths)\n    logger.debug('Optimal column widths calculated', { calculatedWidths })\n    return calculatedWidths\n  }, [purchase, activeTab])\n\n  // ìƒíƒœ í‘œì‹œ í…ìŠ¤íŠ¸ ë°˜í™˜ í•¨ìˆ˜\n  const getStatusDisplay = (item: any) => {\n    if (activeTab === 'purchase') {\n      return item.purchase_status === 'ordered' ? 'ë°œì£¼' : 'êµ¬ë§¤ìš”ì²­'\n    } else if (activeTab === 'receipt') {\n      return item.receipt_status === 'received' ? 'ì…ê³ ' : 'ì…ê³ ëŒ€ê¸°'\n    }\n    return item.purchase_status === 'ordered' ? 'ë°œì£¼' : 'êµ¬ë§¤ìš”ì²­'\n  }\n\n  // ë™ì  gridTemplateColumns ìƒì„±\n  const getGridTemplateColumns = () => {\n    if (columnWidths.length > 0) {\n      return columnWidths.map(width => `${width}px`).join(' ')\n    }\n    \n    // ê¸°ë³¸ê°’ (ë°ì´í„° ë¡œë“œ ì „)\n    const baseColumns = ['80px', '120px', '70px', '90px', '100px', '80px', '80px']\n    \n    // íƒ­ë³„ ì¶”ê°€ ì¹¼ëŸ¼\n    if (activeTab === 'receipt') {\n      return [...baseColumns, '100px'].join(' ')\n    } else if (activeTab === 'done') {\n      return [...baseColumns, '100px', '100px', '80px'].join(' ')\n    }\n    \n    return baseColumns.join(' ')\n  }\n\n  // ë ˆê±°ì‹œ measureColumnWidths í•¨ìˆ˜ (í˜¸í™˜ì„± ìœ ì§€)\n  const measureColumnWidths = () => {\n    calculateOptimalColumnWidths()\n  }\n\n  // View ëª¨ë“œì—ì„œ ì¹¼ëŸ¼ ë„ˆë¹„ ê³„ì‚° (ë°ì´í„° ë¡œë“œ í›„)\n  useEffect(() => {\n    if (purchase && purchase.items && purchase.items.length > 0 && !isEditing) {\n      // ì¦‰ì‹œ ê³„ì‚° (DOM ì¸¡ì • ë¶ˆí•„ìš”)\n      calculateOptimalColumnWidths()\n    }\n  }, [purchase, isEditing, activeTab, calculateOptimalColumnWidths])\n\n  // Edit ëª¨ë“œ ì „í™˜ ì‹œ ë„ˆë¹„ ê³„ì‚°\n  const handleEditToggle = (editing: boolean) => {\n    if (editing && !isEditing) {\n      // Edit ëª¨ë“œë¡œ ì „í™˜í•˜ê¸° ì „ì— í˜„ì¬ ë„ˆë¹„ ê³„ì‚°\n      calculateOptimalColumnWidths()\n    }\n    setIsEditing(editing)\n  }\n\n  const loadPurchaseDetail = async (id: string) => {\n    try {\n      setLoading(true)\n      const supabase = createClient()\n      \n      const { data, error } = await supabase\n        .from('purchase_requests')\n        .select(`\n          *,\n          vendors(id, vendor_name),\n          purchase_request_items(*)\n        `)\n        .eq('id', id)\n        .single()\n\n      if (error) throw error\n\n      if (data) {\n        // ë¼ì¸ë„˜ë²„ ìˆœì„œëŒ€ë¡œ ì •ë ¬\n        const sortedItems = (data.purchase_request_items || []).sort((a: any, b: any) => {\n          const lineA = a.line_number || 999999;\n          const lineB = b.line_number || 999999;\n          return lineA - lineB;\n        });\n\n        const purchaseData = {\n          ...data,\n          items: sortedItems,\n          vendor: data.vendors || { id: 0, vendor_name: 'ì•Œ ìˆ˜ ì—†ìŒ' },\n          vendor_contacts: []\n        } as PurchaseRequestWithDetails\n        setPurchase(purchaseData)\n        setEditedPurchase(purchaseData)\n        setEditedItems(sortedItems)\n      }\n    } catch (error) {\n      toast.error('ë°œì£¼ ìƒì„¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const getStatusBadge = () => {\n    if (!purchase) return null\n    \n    // payment_category ìš°ì„  í™•ì¸\n    if (purchase.payment_category) {\n      const category = purchase.payment_category.trim()\n      \n      if (category === 'ë°œì£¼') {\n        return <Badge variant={null} className=\"badge-success\">ë°œì£¼</Badge>\n      } else if (category === 'êµ¬ë§¤ìš”ì²­') {\n        return <Badge variant={null} className=\"badge-primary\">êµ¬ë§¤ìš”ì²­</Badge>\n      } else if (category === 'í˜„ì¥ê²°ì œ') {\n        return <Badge variant={null} className=\"badge-secondary\">í˜„ì¥ê²°ì œ</Badge>\n      } else {\n        // payment_category ê°’ì´ ìˆì§€ë§Œ ì•Œë ¤ì§„ ê°’ì´ ì•„ë‹Œ ê²½ìš°\n        return <Badge variant={null} className=\"badge-primary\">{category}</Badge>\n      }\n    }\n    \n    // payment_categoryê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’\n    return <Badge variant={null} className=\"badge-primary\">êµ¬ë§¤ìš”ì²­</Badge>\n  }\n\n  // formatDateëŠ” utils/helpers.tsì—ì„œ import\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat('ko-KR').format(amount)\n  }\n\n  const handleSave = async () => {\n    if (!purchase || !editedPurchase) {\n      toast.error('ì €ì¥í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.')\n      return\n    }\n    \n    try {\n      logger.debug('ì €ì¥ ì‹œì‘', { \n        purchaseId: purchase.id, \n        editedItemsCount: editedItems.length,\n        deletedItemsCount: deletedItemIds.length \n      });\n      \n      // ë°œì£¼ ê¸°ë³¸ ì •ë³´ ì—…ë°ì´íŠ¸\n      const totalAmount = editedItems.reduce((sum, item) => sum + (item.amount_value || 0), 0)\n      logger.debug('ê³„ì‚°ëœ ì´ì•¡', { totalAmount });\n      \n      const { error: updateError } = await supabase\n        .from('purchase_requests')\n        .update({\n          purchase_order_number: editedPurchase.purchase_order_number || null,\n          requester_name: editedPurchase.requester_name || null,\n          delivery_request_date: editedPurchase.delivery_request_date || null,\n          revised_delivery_request_date: editedPurchase.revised_delivery_request_date || null,\n          payment_category: editedPurchase.payment_category || null,\n          project_vendor: editedPurchase.project_vendor || null,\n          total_amount: Number(totalAmount),\n          updated_at: new Date().toISOString()\n        })\n        .eq('id', purchase.id)\n\n      if (updateError) throw updateError\n\n      // ì‚­ì œëœ í•­ëª©ë“¤ ì²˜ë¦¬\n      if (deletedItemIds.length > 0) {\n        const { error: deleteError } = await supabase\n          .from('purchase_request_items')\n          .delete()\n          .in('id', deletedItemIds)\n\n        if (deleteError) throw deleteError\n      }\n\n      // ê° ì•„ì´í…œ ì—…ë°ì´íŠ¸ ë˜ëŠ” ìƒì„±\n      logger.debug('ì €ì¥í•  editedItems', { count: editedItems.length });\n      \n      for (const item of editedItems) {\n        logger.debug('ì²˜ë¦¬ ì¤‘ì¸ item', { \n          itemId: item.id, \n          itemName: item.item_name,\n          quantity: item.quantity,\n          unitPrice: item.unit_price_value,\n          amount: item.amount_value\n        });\n        \n        // í•„ìˆ˜ í•„ë“œ ê²€ì¦\n        if (!item.item_name || !item.item_name.trim()) {\n          throw new Error('í’ˆëª©ëª…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.');\n        }\n        if (!item.quantity || item.quantity <= 0) {\n          throw new Error('ìˆ˜ëŸ‰ì€ 0ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤.');\n        }\n        if (item.unit_price_value !== null && item.unit_price_value !== undefined && item.unit_price_value < 0) {\n          throw new Error('ë‹¨ê°€ëŠ” 0 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');\n        }\n        if (item.amount_value !== null && item.amount_value !== undefined && item.amount_value < 0) {\n          throw new Error('í•©ê³„ëŠ” 0 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');\n        }\n        \n        if (item.id) {\n          // ê¸°ì¡´ í•­ëª© ì—…ë°ì´íŠ¸\n          logger.debug('ê¸°ì¡´ í•­ëª© ì—…ë°ì´íŠ¸', { itemId: item.id });\n          const { error } = await supabase\n            .from('purchase_request_items')\n            .update({\n              item_name: item.item_name.trim(),\n              specification: item.specification || null,\n              quantity: Number(item.quantity),\n              unit_price_value: Number(item.unit_price_value),\n              unit_price_currency: purchase.currency || 'KRW',\n              amount_value: Number(item.amount_value),\n              amount_currency: purchase.currency || 'KRW',\n              remark: item.remark || null,\n              updated_at: new Date().toISOString()\n            })\n            .eq('id', item.id)\n\n          if (error) {\n            logger.error('ê¸°ì¡´ í•­ëª© ì—…ë°ì´íŠ¸ ì˜¤ë¥˜', error);\n            throw error;\n          }\n        } else {\n          // ìƒˆ í•­ëª© ìƒì„±\n          logger.debug('ìƒˆ í•­ëª© ìƒì„±', { itemName: item.item_name });\n          const insertData = {\n            purchase_request_id: purchase.id,\n            item_name: item.item_name.trim(),\n            specification: item.specification || null,\n            quantity: Number(item.quantity),\n            unit_price_value: Number(item.unit_price_value),\n            unit_price_currency: purchase.currency || 'KRW',\n            amount_value: Number(item.amount_value),\n            amount_currency: purchase.currency || 'KRW',\n            remark: item.remark || null,\n            line_number: item.line_number || editedItems.indexOf(item) + 1,\n            created_at: new Date().toISOString()\n          };\n          logger.debug('ì‚½ì…í•  ë°ì´í„°', { itemName: insertData.item_name });\n          \n          const { error } = await supabase\n            .from('purchase_request_items')\n            .insert(insertData)\n\n          if (error) {\n            logger.error('ìƒˆ í•­ëª© ìƒì„± ì˜¤ë¥˜', error);\n            throw error;\n          } else {\n            logger.debug('ìƒˆ í•­ëª© ìƒì„± ì„±ê³µ');\n          }\n        }\n      }\n\n      logger.debug('ì €ì¥ ì™„ë£Œ');\n      toast.success('ë°œì£¼ ë‚´ì—­ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.')\n      handleEditToggle(false)\n      setDeletedItemIds([])\n      \n      // ìˆ˜ì •ëœ ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ (ëª¨ë‹¬ì€ ì—´ë¦° ìƒíƒœ ìœ ì§€)\n      await loadPurchaseDetail(purchaseId?.toString() || '')\n    } catch (error) {\n      logger.error('ì €ì¥ ì¤‘ ì „ì²´ ì˜¤ë¥˜', error);\n      const errorMessage = error instanceof Error ? error.message : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤'\n      toast.error(`ì €ì¥ ì‹¤íŒ¨: ${errorMessage}`)\n    }\n  }\n\n  const handleItemChange = (index: number, field: string, value: any) => {\n    const newItems = [...editedItems]\n    \n    if (field === 'amount_value') {\n      // ê¸ˆì•¡ì„ ì§ì ‘ ìˆ˜ì •í•œ ê²½ìš°\n      newItems[index] = {\n        ...newItems[index],\n        amount_value: value\n      }\n    } else if (field === 'quantity' || field === 'unit_price_value') {\n      // ìˆ˜ëŸ‰ì´ë‚˜ ë‹¨ê°€ë¥¼ ìˆ˜ì •í•œ ê²½ìš° ê¸ˆì•¡ ìë™ ê³„ì‚°\n      const quantity = field === 'quantity' ? value : newItems[index].quantity\n      const unitPrice = field === 'unit_price_value' ? value : newItems[index].unit_price_value\n      newItems[index] = {\n        ...newItems[index],\n        [field]: value,\n        amount_value: quantity * unitPrice\n      }\n    } else {\n      // ê¸°íƒ€ í•„ë“œ ìˆ˜ì •\n      newItems[index] = {\n        ...newItems[index],\n        [field]: value\n      }\n    }\n    \n    setEditedItems(newItems)\n  }\n\n  const handleAddItem = () => {\n    // í˜„ì¬ ìµœëŒ€ ë¼ì¸ë„˜ë²„ ì°¾ê¸°\n    const maxLineNumber = editedItems.reduce((max, item) => {\n      const lineNum = item.line_number || 0;\n      return lineNum > max ? lineNum : max;\n    }, 0);\n\n    const newItem = {\n      item_name: '',\n      specification: '',\n      quantity: 1,\n      unit_price_value: 0,\n      amount_value: 0,\n      remark: '',\n      line_number: maxLineNumber + 1\n    }\n    \n    // ìƒˆ ì•„ì´í…œ ì¶”ê°€ í›„ ë¼ì¸ë„˜ë²„ ìˆœì„œëŒ€ë¡œ ì •ë ¬\n    const newItems = [...editedItems, newItem].sort((a, b) => {\n      const lineA = a.line_number || 999999;\n      const lineB = b.line_number || 999999;\n      return lineA - lineB;\n    });\n    \n    setEditedItems(newItems)\n  }\n\n  const handleRemoveItem = (index: number) => {\n    const item = editedItems[index]\n    if (item.id) {\n      setDeletedItemIds([...deletedItemIds, item.id])\n    }\n    const newItems = editedItems.filter((_, i) => i !== index).sort((a, b) => {\n      const lineA = a.line_number || 999999;\n      const lineB = b.line_number || 999999;\n      return lineA - lineB;\n    });\n    setEditedItems(newItems)\n  }\n\n  // êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ í•¨ìˆ˜\n  const handlePaymentToggle = async (itemId: number | string, isCompleted: boolean) => {\n    if (!canPurchase) {\n      toast.error('êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.')\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      toast.error('ìœ íš¨í•˜ì§€ ì•Šì€ í•­ëª© ID ì…ë‹ˆë‹¤.')\n      return\n    }\n\n    // í•´ë‹¹ í’ˆëª© ì •ë³´ ì°¾ê¸°\n    const targetItem = purchase?.items?.find(item => String(item.id) === itemIdStr)\n    if (!targetItem) return\n\n    const itemInfo = `í’ˆëª…: ${targetItem.item_name}\nê·œê²©: ${targetItem.specification || 'ë¯¸ì…ë ¥'}\nìˆ˜ëŸ‰: ${targetItem.quantity?.toLocaleString() || 0}${targetItem.unit || ''}\në‹¨ê°€: â‚©${targetItem.unit_price_value?.toLocaleString() || 0}\ní•©ê³„: â‚©${targetItem.amount_value?.toLocaleString() || 0}`\n\n    const confirmMessage = isCompleted \n      ? `ë‹¤ìŒ í’ˆëª©ì„ êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\\n\\n${itemInfo}` \n      : `ë‹¤ìŒ í’ˆëª©ì˜ êµ¬ë§¤ì™„ë£Œë¥¼ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\\n\\n${itemInfo}`\n    \n    const confirm = window.confirm(confirmMessage)\n    if (!confirm) return\n\n    try {\n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_payment_completed: isCompleted,\n          payment_completed_at: isCompleted ? new Date().toISOString() : null\n        })\n        .eq('id', numericId)\n\n      if (error) throw error\n\n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (UI ì¦‰ì‹œ ë°˜ì˜)\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          String(item.id) === itemIdStr \n            ? { ...item, is_payment_completed: isCompleted, payment_completed_at: isCompleted ? new Date().toISOString() : null }\n            : item\n        )\n        return { ...prev, items: updatedItems }\n      })\n\n      if (purchase) {\n        const purchaseIdNumber = Number(purchase.id)\n        if (!Number.isNaN(purchaseIdNumber)) {\n          onOptimisticUpdate?.(purchaseIdNumber, prev => {\n            const updatedItems = (prev.items || []).map(item =>\n              String(item.id) === itemIdStr\n                ? { ...item, is_payment_completed: isCompleted }\n                : item\n            )\n            const total = updatedItems.length || prev.items?.length || 0\n            const completed = updatedItems.filter(item => item.is_payment_completed).length\n            const allCompleted = total > 0 && completed === total\n            return {\n              ...prev,\n              items: updatedItems,\n              is_payment_completed: allCompleted,\n              payment_completed_at: allCompleted ? new Date().toISOString() : null,\n              payment_completed_by_name: allCompleted ? (currentUserName || prev.payment_completed_by_name) : prev.payment_completed_by_name\n            }\n          })\n        }\n      }\n      \n      toast.success(isCompleted ? 'êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'êµ¬ë§¤ì™„ë£Œê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.')\n\n      // ìƒì„¸ ëª¨ë‹¬ ë° ìƒìœ„ ë¦¬ìŠ¤íŠ¸ ëª¨ë‘ ìµœì‹  ìƒíƒœë¡œ ë™ê¸°í™”\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      toast.error('êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n\n  // ê°œë³„ í’ˆëª© ì…ê³ ì™„ë£Œ ì²˜ë¦¬ (ë‚ ì§œ ì„ íƒ)\n  const handleItemReceiptToggle = async (itemId: number | string, selectedDate: Date) => {\n    if (!canReceiptCheck) {\n      toast.error('ì…ê³  ì²˜ë¦¬ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.')\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      toast.error('ìœ íš¨í•˜ì§€ ì•Šì€ í•­ëª© ID ì…ë‹ˆë‹¤.')\n      return\n    }\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item =>\n            String(item.id) === itemIdStr\n              ? {\n                  ...item,\n                  is_received: true,\n                  actual_received_date: selectedDate.toISOString()\n                }\n              : item\n          )\n          const total = updatedItems.length || prev.items?.length || 0\n          const completed = updatedItems.filter(item => item.is_received).length\n          const allReceived = total > 0 && completed === total\n\n          return {\n            ...prev,\n            items: updatedItems,\n            is_received: allReceived,\n            received_at: allReceived ? new Date().toISOString() : prev.received_at\n          }\n        })\n      }\n    }\n\n    try {\n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_received: true,\n          received_at: new Date().toISOString(),\n          actual_received_date: selectedDate.toISOString()\n        })\n        .eq('id', numericId)\n\n      if (error) throw error\n\n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          String(item.id) === itemIdStr \n            ? { \n                ...item, \n                is_received: true, \n                received_at: new Date().toISOString(),\n                actual_received_date: selectedDate.toISOString()\n              }\n            : item\n        )\n        return { ...prev, items: updatedItems }\n      })\n\n      applyOptimisticUpdate()\n      \n      const targetItem = purchase?.items?.find(item => String(item.id) === itemIdStr)\n      toast.success(`\"${targetItem?.item_name}\" í’ˆëª©ì´ ì…ê³ ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.`)\n\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n\n      applyOptimisticUpdate()\n    } catch (error) {\n      toast.error('ì…ê³ ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n\n  // ì…ê³ ì™„ë£Œ ì·¨ì†Œ ì²˜ë¦¬\n  const handleReceiptCancel = async (itemId: number | string) => {\n    if (!canReceiptCheck) {\n      toast.error('ì…ê³  ì²˜ë¦¬ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.')\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      toast.error('ìœ íš¨í•˜ì§€ ì•Šì€ í•­ëª© ID ì…ë‹ˆë‹¤.')\n      return\n    }\n\n    const targetItem = purchase?.items?.find(item => String(item.id) === itemIdStr)\n    if (!targetItem) return\n\n    const confirm = window.confirm(`\"${targetItem.item_name}\" í’ˆëª©ì˜ ì…ê³ ì™„ë£Œë¥¼ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)\n    if (!confirm) return\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item =>\n            String(item.id) === itemIdStr\n              ? {\n                  ...item,\n                  is_received: false,\n                  actual_received_date: undefined\n                }\n              : item\n          )\n          const total = updatedItems.length || prev.items?.length || 0\n          const completed = updatedItems.filter(item => item.is_received).length\n          const allReceived = total > 0 && completed === total\n\n          return {\n            ...prev,\n            items: updatedItems,\n            is_received: allReceived,\n            received_at: allReceived ? prev.received_at : null\n          }\n        })\n      }\n    }\n\n    try {\n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_received: false,\n          received_at: null,\n          actual_received_date: null,\n          actual_received_by_name: null\n        })\n        .eq('id', numericId)\n\n      if (error) throw error\n\n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          String(item.id) === itemIdStr \n            ? { ...item, is_received: false, received_at: null, actual_received_date: undefined, actual_received_by_name: undefined }\n            : item\n        )\n        return { ...prev, items: updatedItems }\n      })\n      \n      applyOptimisticUpdate()\n\n      toast.success('ì…ê³ ì™„ë£Œê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.')\n\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n\n      applyOptimisticUpdate()\n    } catch (error) {\n      toast.error('ì…ê³ ì™„ë£Œ ì·¨ì†Œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n\n\n  // ìŠ¹ì¸ ì²˜ë¦¬\n  const handleApprove = async (type: 'middle' | 'final') => {\n    if (!purchase) return\n    \n    const approvalType = type === 'middle' ? '1ì°¨ ìŠ¹ì¸' : 'ìµœì¢… ìŠ¹ì¸'\n    const confirmMessage = `ë°œì£¼ë²ˆí˜¸: ${purchase.purchase_order_number}\\n\\n${approvalType}ì„ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`\n    const confirm = window.confirm(confirmMessage)\n    if (!confirm) return\n    \n    try {\n      const updateData = type === 'middle' \n        ? { \n            middle_manager_status: 'approved'\n          }\n        : { \n            final_manager_status: 'approved'\n          }\n      \n      const { error } = await supabase\n        .from('purchase_requests')\n        .update(updateData)\n        .eq('id', purchase.id)\n      \n      if (error) {\n        throw error\n      }\n      \n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (UI ì¦‰ì‹œ ë°˜ì˜)\n      if (type === 'middle') {\n        setPurchase(prev => prev ? { ...prev, middle_manager_status: 'approved' } : null)\n      } else {\n        setPurchase(prev => prev ? { ...prev, final_manager_status: 'approved' } : null)\n      }\n      \n      toast.success(`${type === 'middle' ? 'ì¤‘ê°„' : 'ìµœì¢…'} ìŠ¹ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`)\n    } catch (error) {\n      toast.error('ìŠ¹ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n  \n  // ì „ì²´ êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬\n  const handleCompleteAllPayment = async () => {\n    if (!purchase || !canPurchase) return\n    \n    const confirmMessage = `ë°œì£¼ë²ˆí˜¸: ${purchase.purchase_order_number}\\n\\nëª¨ë“  í’ˆëª©ì„ êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`\n    const confirm = window.confirm(confirmMessage)\n    if (!confirm) return\n    \n    try {\n      const updateData = {\n        is_payment_completed: true,\n        payment_completed_at: new Date().toISOString()\n      }\n      \n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update(updateData)\n        .eq('purchase_request_id', purchase.id)\n        .eq('is_payment_completed', false) // ì•„ì§ êµ¬ë§¤ì™„ë£Œë˜ì§€ ì•Šì€ í•­ëª©ë§Œ\n      \n      if (error) throw error\n      \n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (UI ì¦‰ì‹œ ë°˜ì˜)\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          !item.is_payment_completed \n            ? { ...item, is_payment_completed: true, payment_completed_at: new Date().toISOString() }\n            : item\n        )\n        return { ...prev, items: updatedItems }\n      })\n\n      if (purchase) {\n        const purchaseIdNumber = Number(purchase.id)\n        if (!Number.isNaN(purchaseIdNumber)) {\n          onOptimisticUpdate?.(purchaseIdNumber, prev => {\n            const updatedItems = (prev.items || []).map(item => ({\n              ...item,\n              is_payment_completed: true\n            }))\n            return {\n              ...prev,\n              items: updatedItems,\n              is_payment_completed: true,\n              payment_completed_at: new Date().toISOString(),\n              payment_completed_by_name: currentUserName || prev.payment_completed_by_name\n            }\n          })\n        }\n      }\n      \n      toast.success('ëª¨ë“  í’ˆëª©ì´ êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.')\n\n      // ìƒì„¸ ëª¨ë‹¬ ë° ë¦¬ìŠ¤íŠ¸ ëª¨ë‘ ìƒˆë¡œê³ ì¹¨\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      logger.error('ì „ì²´ êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ ì˜¤ë¥˜', error);\n      toast.error('êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n\n  // ì „ì²´ ì…ê³ ì™„ë£Œ ì²˜ë¦¬ (ë‚ ì§œ ì„ íƒ)\n  const handleCompleteAllReceipt = async (selectedDate: Date) => {\n    console.log('ğŸ”¥ ì „ì²´ ì…ê³ ì™„ë£Œ ì²˜ë¦¬ ì‹œì‘', { purchase: purchase?.id, canReceiveItems, currentUserName })\n    if (!purchase || !canReceiveItems) {\n      console.log('âŒ ì „ì²´ ì…ê³ ì™„ë£Œ ì²˜ë¦¬ ì¡°ê±´ ë¯¸ì¶©ì¡±', { purchase: !!purchase, canReceiveItems })\n      return\n    }\n\n    // í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ\n    const confirmMessage = `ë°œì£¼ë²ˆí˜¸: ${purchase.purchase_order_number}\n\nì „ì²´ ì…ê³ ì™„ë£Œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`\n    \n    if (!window.confirm(confirmMessage)) {\n      return\n    }\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item => ({\n            ...item,\n            is_received: true,\n            actual_received_date: item.actual_received_date || selectedDate.toISOString()\n          }))\n\n          return {\n            ...prev,\n            items: updatedItems,\n            is_received: true,\n            received_at: new Date().toISOString()\n          }\n        })\n      }\n    }\n\n    try {\n      const updateData = {\n        is_received: true,\n        received_at: new Date().toISOString(),\n        actual_received_date: selectedDate.toISOString()\n      }\n      \n      console.log('ğŸ”¥ ì „ì²´ ì…ê³ ì™„ë£Œ ì—…ë°ì´íŠ¸ ë°ì´í„°:', updateData)\n\n      const { data, error } = await supabase\n        .from('purchase_request_items')\n        .update(updateData)\n        .eq('purchase_request_id', purchase.id)\n        .is('actual_received_date', null) // ì•„ì§ ì‹¤ì œ ì…ê³ ë˜ì§€ ì•Šì€ í•­ëª©ë§Œ\n        .select()\n\n      console.log('ğŸ”¥ ì „ì²´ ì…ê³ ì™„ë£Œ DB ê²°ê³¼:', { data, error })\n\n      if (error) throw error\n\n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          !item.actual_received_date \n            ? { \n                ...item, \n                is_received: true, \n                received_at: new Date().toISOString(),\n                actual_received_date: selectedDate.toISOString()\n              }\n            : item\n        )\n        return { ...prev, items: updatedItems }\n      })\n\n      applyOptimisticUpdate()\n\n      toast.success('ëª¨ë“  í’ˆëª©ì´ ì…ê³ ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.')\n\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n\n      applyOptimisticUpdate()\n    } catch (error) {\n      logger.error('ì „ì²´ ì…ê³ ì™„ë£Œ ì²˜ë¦¬ ì˜¤ë¥˜', error)\n      toast.error('ì…ê³ ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n  \n\n  // ë°˜ë ¤ ì²˜ë¦¬\n  const handleReject = async (type: 'middle' | 'final') => {\n    if (!purchase) return\n    \n    const reason = window.prompt('ë°˜ë ¤ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”:')\n    if (!reason) return\n    \n    try {\n      const updateData = type === 'middle'\n        ? {\n            middle_manager_status: 'rejected'\n          }\n        : {\n            final_manager_status: 'rejected'\n          }\n      \n      const { error } = await supabase\n        .from('purchase_requests')\n        .update(updateData)\n        .eq('id', purchase.id)\n      \n      if (error) {\n        throw error\n      }\n      \n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (UI ì¦‰ì‹œ ë°˜ì˜)\n      if (type === 'middle') {\n        setPurchase(prev => prev ? { ...prev, middle_manager_status: 'rejected' } : null)\n      } else {\n        setPurchase(prev => prev ? { ...prev, final_manager_status: 'rejected' } : null)\n      }\n      \n      toast.success(`${type === 'middle' ? 'ì¤‘ê°„' : 'ìµœì¢…'} ë°˜ë ¤ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`)\n    } catch (error) {\n      toast.error('ë°˜ë ¤ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n\n  const content = (\n    <div className=\"space-y-1 sm:space-y-4\">\n      {loading ? (\n        <div className=\"flex items-center justify-center py-12\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-hansl-600\"></div>\n        </div>\n      ) : purchase ? (\n        <div>\n          {/* Compact Info Header */}\n          <div className=\"bg-gray-50 rounded-lg p-2 sm:p-3 mb-1 sm:mb-2 border border-gray-100\">\n            <div className=\"grid grid-cols-1 sm:grid-cols-3 items-center gap-3 sm:gap-0\">\n              <div className=\"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-4\">\n                <div className=\"flex items-center gap-3\">\n                  {getStatusBadge()}\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"modal-label\">ìš”ì²­ì:</span>\n                    <span className=\"modal-value\">{purchase.requester_name}</span>\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Calendar className=\"w-3 h-3 text-gray-500\" />\n                  <span className=\"modal-subtitle\">ì²­êµ¬ì¼: {formatDate(purchase.request_date)}</span>\n                </div>\n              </div>\n              \n              {/* ìŠ¹ì¸ ë²„íŠ¼ë“¤ì„ ì¤‘ì•™ì— ë°°ì¹˜ */}\n              <div className=\"flex items-center justify-center gap-2 sm:gap-3 flex-wrap\">\n                {/* 1ì°¨ ìŠ¹ì¸ ë²„íŠ¼ */}\n                {canApproveMiddle && purchase.middle_manager_status === 'pending' && (\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => handleApprove('middle')}\n                    className={`${approvalButtonClass} border border-gray-400 bg-white hover:bg-gray-50 hover:border-gray-500`}\n                  >\n                    1ì°¨ ìŠ¹ì¸ ëŒ€ê¸°\n                  </Button>\n                )}\n                {purchase.middle_manager_status === 'approved' && (\n                  <div className=\"button-approved badge-text shadow-sm\">\n                    <Check className=\"w-3 h-3\" />\n                    1ì°¨ ìŠ¹ì¸ì™„ë£Œ\n                  </div>\n                )}\n                {purchase.middle_manager_status === 'rejected' && (\n                  <div className=\"button-rejected badge-text\">\n                    <X className=\"w-3 h-3\" />\n                    1ì°¨ ë°˜ë ¤\n                  </div>\n                )}\n                {purchase.middle_manager_status === 'pending' && !canApproveMiddle && (\n                  <div className={`${approvalWaitingPillClass} border border-gray-300 text-gray-600 bg-white`}>\n                    1ì°¨ ìŠ¹ì¸ëŒ€ê¸°\n                  </div>\n                )}\n\n                {/* ìµœì¢… ìŠ¹ì¸ ë²„íŠ¼ */}\n                {canApproveFinal && purchase.middle_manager_status === 'approved' && purchase.final_manager_status === 'pending' && (\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => handleApprove('final')}\n                    className={`${approvalButtonClass} border border-gray-400 bg-white hover:bg-gray-50 hover:border-gray-500`}\n                  >\n                    <Check className=\"w-3 h-3\" />\n                    ìµœì¢… ìŠ¹ì¸\n                  </Button>\n                )}\n                {purchase.final_manager_status === 'approved' && (\n                  <div className=\"button-approved badge-text\">\n                    <Check className=\"w-3 h-3\" />\n                    ìµœì¢… ìŠ¹ì¸ì™„ë£Œ\n                  </div>\n                )}\n                {purchase.final_manager_status === 'rejected' && (\n                  <div className=\"button-rejected badge-text\">\n                    <X className=\"w-3 h-3\" />\n                    ìµœì¢… ë°˜ë ¤\n                  </div>\n                )}\n                {purchase.middle_manager_status !== 'approved' && purchase.final_manager_status === 'pending' && (\n                  <div className={`${approvalWaitingPillClass} border border-gray-300 text-gray-600 bg-white`}>\n                    ìµœì¢… ìŠ¹ì¸ëŒ€ê¸°\n                  </div>\n                )}\n              </div>\n              \n              {/* ìš°ì¸¡ ë¹ˆ ì˜ì—­ */}\n              <div></div>\n            </div>\n          </div>\n\n          {/* Main 2-Column Layout */}\n          <div className=\"flex flex-col lg:flex-row gap-3 sm:gap-6\">\n            {/* Left Column - Basic Info (Fixed Width) */}\n            <div className=\"lg:w-80 lg:flex-shrink-0 space-y-1 sm:space-y-4 relative\">\n              \n              {/* ë°œì£¼ ê¸°ë³¸ì •ë³´ */}\n              <div className=\"bg-white rounded-lg p-2 sm:p-3 border border-gray-100 shadow-sm\">\n                <div className=\"mb-3\">\n                  <h3 className=\"modal-section-title flex items-center\">\n                    <FileText className=\"w-4 h-4 mr-2 text-gray-600\" />\n                    {purchase?.purchase_order_number || 'POë²ˆí˜¸ ì—†ìŒ'}\n                  </h3>\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">ë°œì£¼ì„œ ì¢…ë¥˜</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.request_type || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, request_type: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"ì¼ë°˜\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.request_type || 'ì¼ë°˜'}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">ê²°ì œ ì¢…ë¥˜</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.payment_category || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, payment_category: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"ë°œì£¼/êµ¬ë§¤ìš”ì²­/í˜„ì¥ê²°ì œ\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.payment_category || '-'}</p>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">ì…ê³  ìš”ì²­ì¼</span>\n                      {isEditing ? (\n                        <Button\n                          variant=\"outline\"\n                          onClick={() => setShowDeliveryDateDialog(true)}\n                          className=\"mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] justify-start text-left font-normal business-radius-input\"\n                        >\n                          <Calendar className=\"mr-1 h-3 w-3\" />\n                          {editedPurchase?.delivery_request_date ? \n                            formatDate(editedPurchase.delivery_request_date) : \n                            'ë‚ ì§œ ì„ íƒ'\n                          }\n                        </Button>\n                      ) : (\n                        <p className=\"modal-subtitle\">{formatDate(purchase.delivery_request_date)}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label text-orange-500\">ë³€ê²½ ì…ê³ ì¼</span>\n                      {isEditing ? (\n                        <Button\n                          variant=\"outline\"\n                          onClick={() => setShowRevisedDateDialog(true)}\n                          className=\"mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] justify-start text-left font-normal business-radius-input\"\n                        >\n                          <Calendar className=\"mr-1 h-3 w-3\" />\n                          {editedPurchase?.revised_delivery_request_date ? \n                            formatDate(editedPurchase.revised_delivery_request_date) : \n                            'ë‚ ì§œ ì„ íƒ'\n                          }\n                        </Button>\n                      ) : (\n                        <p className=\"modal-subtitle text-orange-700\">\n                          {purchase.revised_delivery_request_date ? formatDate(purchase.revised_delivery_request_date) : 'ë¯¸ì„¤ì •'}\n                        </p>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/* ì—…ì²´ ì •ë³´ */}\n              <div className=\"bg-white rounded-lg p-2 sm:p-3 border border-gray-100 shadow-sm\">\n                <h3 className=\"modal-section-title mb-3 flex items-center\">\n                  <Building2 className=\"w-4 h-4 mr-2 text-gray-600\" />\n                  ì—…ì²´ ì •ë³´\n                </h3>\n                \n                <div className=\"space-y-2\">\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">ì—…ì²´ëª…</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.vendor?.vendor_name || editedPurchase?.vendor_name || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, vendor_name: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"ì—…ì²´ ì„ íƒ\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.vendor?.vendor_name || '-'}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">ì—…ì²´ ë‹´ë‹¹ì</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.vendor_contacts?.[0]?.contact_name || ''}\n                          onChange={(e) => {\n                            setEditedPurchase(prev => {\n                              if (!prev) return null;\n                              const contacts = prev.vendor_contacts || [];\n                              const updatedContacts = [...contacts];\n                              if (updatedContacts[0]) {\n                                updatedContacts[0] = { ...updatedContacts[0], contact_name: e.target.value };\n                              } else {\n                                updatedContacts[0] = { contact_name: e.target.value } as any;\n                              }\n                              return { ...prev, vendor_contacts: updatedContacts };\n                            })\n                          }}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"ë‹´ë‹¹ì ì„ íƒ\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.vendor_contacts?.[0]?.contact_name || '-'}</p>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">PJì—…ì²´</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.project_vendor || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, project_vendor: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"ì…ë ¥\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.project_vendor || '-'}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">Item</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.project_item || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, project_item: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"ì…ë ¥\"\n                        />\n                      ) : (\n                        <p className=\"modal-subtitle\">{purchase.project_item || '-'}</p>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">ìˆ˜ì£¼ë²ˆí˜¸</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.order_number || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, order_number: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"ì…ë ¥\"\n                        />\n                      ) : (\n                        <p className=\"modal-subtitle\">{purchase.order_number || '-'}</p>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n            </div>\n\n            {/* Right Column - Items List (Flexible Width) */}\n            <div className=\"lg:flex-1 lg:min-w-0 relative overflow-visible\">\n              \n              <div className=\"bg-white rounded-lg border border-gray-100 overflow-hidden shadow-sm\">\n                <div className=\"p-2 sm:p-3 bg-gray-50 border-b border-gray-100 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-0\">\n                  <h3 className=\"modal-section-title flex items-center\">\n                    <Package className=\"w-4 h-4 mr-2 text-gray-600\" />\n                    í’ˆëª© ë¦¬ìŠ¤íŠ¸\n                    <span className=\"ml-2 badge-secondary\">\n                      {purchase.items?.length || 0}ê°œ\n                    </span>\n                  </h3>\n                  {!isEditing && (\n                    <>\n                      {activeTab === 'purchase' && canPurchase && (\n                        <Button\n                          size=\"sm\"\n                          onClick={handleCompleteAllPayment}\n                          className=\"button-base bg-orange-500 hover:bg-orange-600 text-white\"\n                        >\n                          <CreditCard className=\"w-3 h-3 mr-1\" />\n                          ì „ì²´ êµ¬ë§¤ì™„ë£Œ\n                        </Button>\n                      )}\n                      {activeTab === 'receipt' && canReceiveItems && (\n                        <DatePickerPopover\n                          onDateSelect={handleCompleteAllReceipt}\n                          placeholder=\"ì „ì²´ ì…ê³ ì™„ë£Œ ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”\"\n                          align=\"end\"\n                          side=\"bottom\"\n                        >\n                          <Button\n                            size=\"sm\"\n                            className=\"button-base button-action-primary\"\n                          >\n                            <Truck className=\"w-3 h-3 mr-1\" />\n                            ì „ì²´ ì…ê³ ì™„ë£Œ\n                          </Button>\n                        </DatePickerPopover>\n                      )}\n                    </>\n                  )}\n                </div>\n                \n                {/* Mobile Table Header */}\n                <div className=\"block sm:hidden bg-gray-50 px-2 py-1 border-b border-gray-100\">\n                  <div className=\"text-xs font-medium text-gray-600\">í’ˆëª© ëª©ë¡ (í„°ì¹˜í•˜ì—¬ ìŠ¤í¬ë¡¤)</div>\n                </div>\n                \n                {/* Items List with Header Inside Scrollable Container */}\n                <div className=\"max-h-[50vh] sm:max-h-[40vh] overflow-y-auto overflow-x-auto min-w-fit\">\n                  {/* Items Table Header - Sticky inside scroll container */}\n                  <div className=\"bg-gray-50 px-2 sm:px-3 py-1 border-b border-gray-100 sticky top-0 z-10\">\n                    <div \n                      ref={headerRowRef}\n                      className=\"hidden sm:grid gap-3 modal-label\" \n                      style={{\n                        gridTemplateColumns: getGridTemplateColumns()\n                      }}\n                    >\n                      <div>í’ˆëª©ëª…</div>\n                      <div>ê·œê²©</div>\n                      <div className=\"text-center\">ìˆ˜ëŸ‰</div>\n                      <div className=\"text-right\">ë‹¨ê°€</div>\n                      <div className=\"text-right\">í•©ê³„</div>\n                      <div className=\"text-center\">ë¹„ê³ </div>\n                      {isEditing ? (\n                        <>\n                          <div className=\"text-center\">ì‚­ì œ</div>\n                          {activeTab === 'receipt' && (\n                            <>\n                              <div className=\"text-center\">ì‹¤ì œì…ê³ ì¼</div>\n                            </>\n                          )}\n                          {activeTab === 'done' && (\n                            <>\n                              <div className=\"text-center\">ê±°ë˜ëª…ì„¸ì„œ í™•ì¸</div>\n                              <div className=\"text-center\">íšŒê³„ìƒ ì…ê³ ì¼</div>\n                              <div className=\"text-center\">ì²˜ë¦¬ì</div>\n                            </>\n                          )}\n                        </>\n                      ) : (\n                        <>\n                          <div className=\"text-center\">\n                            {activeTab === 'purchase'\n                              ? 'êµ¬ë§¤ìƒíƒœ'\n                              : (activeTab === 'receipt' || activeTab === 'done')\n                              ? 'ì…ê³ ìƒíƒœ'\n                              : 'ìƒíƒœ'}\n                          </div>\n                          {activeTab === 'done' && (\n                            <>\n                              <div className=\"text-center\">ê±°ë˜ëª…ì„¸ì„œ í™•ì¸</div>\n                              <div className=\"text-center\">íšŒê³„ìƒ ì…ê³ ì¼</div>\n                              <div className=\"text-center\">ì²˜ë¦¬ì</div>\n                            </>\n                          )}\n                          {activeTab === 'receipt' && (\n                            <>\n                              <div className=\"text-center\">ì‹¤ì œì…ê³ ì¼</div>\n                            </>\n                          )}\n                        </>\n                      )}\n                    </div>\n                  </div>\n                  {(isEditing ? editedItems : purchase.items)?.map((item, index) => (\n                    <div key={index} className=\"px-2 sm:px-3 py-1.5 border-b border-gray-50 hover:bg-gray-50/50 transition-colors\">\n                      {/* Desktop Layout */}\n                      <div className={`hidden sm:grid items-center gap-3`} style={{\n                        gridTemplateColumns: getGridTemplateColumns()\n                      }}>\n                        {/* í’ˆëª©ëª… */}\n                        <div className=\"min-w-0\">\n                          {isEditing ? (\n                            <Input\n                              value={item.item_name}\n                              onChange={(e) => handleItemChange(index, 'item_name', e.target.value)}\n                              className=\"modal-label border-gray-200 rounded-lg w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                              placeholder=\"í’ˆëª©ëª…\"\n                            />\n                          ) : (\n                            <span className=\"modal-value\">{item.item_name || 'í’ˆëª©ëª… ì—†ìŒ'}</span>\n                          )}\n                        </div>\n                        \n                        {/* ê·œê²© */}\n                        <div className=\"min-w-0\">\n                          {isEditing ? (\n                            <Input\n                              value={item.specification}\n                              onChange={(e) => handleItemChange(index, 'specification', e.target.value)}\n                              className=\"modal-label border-gray-200 rounded-lg w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                              placeholder=\"ê·œê²©\"\n                            />\n                          ) : (\n                            <span className=\"modal-subtitle\">{item.specification || '-'}</span>\n                          )}\n                        </div>\n                        \n                        {/* ìˆ˜ëŸ‰ */}\n                        <div className=\"text-center min-w-0\">\n                          {isEditing ? (\n                            <Input\n                              type=\"number\"\n                              value={item.quantity}\n                              onChange={(e) => handleItemChange(index, 'quantity', Number(e.target.value))}\n                              className=\"modal-label border-gray-200 rounded-lg text-center w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                              placeholder=\"ìˆ˜ëŸ‰\"\n                              max=\"99999\"\n                            />\n                          ) : (\n                            <span className=\"modal-subtitle\">{item.quantity || 0}</span>\n                          )}\n                        </div>\n                        \n                        {/* ë‹¨ê°€ */}\n                        <div className=\"text-right min-w-0\">\n                          {isEditing ? (\n                            <Input\n                              type=\"number\"\n                              value={item.unit_price_value}\n                              onChange={(e) => handleItemChange(index, 'unit_price_value', Number(e.target.value))}\n                              className=\"modal-label border-gray-200 rounded-lg text-right w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                              placeholder=\"ë‹¨ê°€\"\n                              max=\"100000000000\"\n                            />\n                          ) : (\n                            <span className=\"modal-subtitle\">â‚©{formatCurrency(item.unit_price_value)}</span>\n                          )}\n                        </div>\n                        \n                        {/* í•©ê³„ */}\n                        <div className=\"text-right min-w-0\">\n                          {isEditing ? (\n                            <Input\n                              type=\"number\"\n                              value={item.amount_value}\n                              onChange={(e) => handleItemChange(index, 'amount_value', Number(e.target.value))}\n                              className=\"modal-label border-gray-200 rounded-lg text-right w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                              placeholder=\"í•©ê³„\"\n                              max=\"10000000000\"\n                            />\n                          ) : (\n                            <span className=\"modal-value\">â‚©{formatCurrency(item.amount_value || 0)}</span>\n                          )}\n                        </div>\n                        \n                        {/* ë¹„ê³  */}\n                        <div className=\"min-w-0 flex justify-center items-start pt-1 text-center\">\n                          {isEditing ? (\n                            <Input\n                              value={item.remark || ''}\n                              onChange={(e) => handleItemChange(index, 'remark', e.target.value)}\n                              className=\"modal-label border-gray-200 rounded-lg text-center w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                              placeholder=\"ë¹„ê³ \"\n                            />\n                          ) : (\n                            <span className=\"modal-subtitle text-center\">{item.remark || '-'}</span>\n                          )}\n                        </div>\n                        \n                        {/* ìƒíƒœ/ì•¡ì…˜ */}\n                        <div className=\"text-center flex justify-center items-start pt-1\">\n                          {isEditing ? (\n                            <Button\n                              size=\"sm\"\n                              variant=\"ghost\"\n                              onClick={() => handleRemoveItem(index)}\n                              className=\"text-red-600 hover:bg-red-50 rounded-lg p-1 h-6 w-6\"\n                            >\n                              <Trash2 className=\"w-3 h-3\" />\n                            </Button>\n                          ) : (\n                            <>\n                              {/* êµ¬ë§¤ íƒ­ì—ì„œì˜ êµ¬ë§¤ì™„ë£Œ ìƒíƒœ */}\n                              {activeTab === 'purchase' && (\n                                <div className=\"flex justify-center\">\n                                  {canPurchase ? (\n                                    <button\n                                      onClick={() => handlePaymentToggle(item.id, !item.is_payment_completed)}\n                                      className={`transition-colors ${\n                                        item.is_payment_completed\n                                          ? 'button-toggle-active bg-orange-500 hover:bg-orange-600 text-white'\n                                          : 'button-toggle-inactive'\n                                      }`}\n                                    >\n                                      {item.is_payment_completed ? 'êµ¬ë§¤ì™„ë£Œ' : 'êµ¬ë§¤ëŒ€ê¸°'}\n                                    </button>\n                                  ) : (\n                                    <span className={`${\n                                      item.is_payment_completed \n                                        ? 'button-toggle-active bg-orange-500 text-white' \n                                        : 'button-waiting-inactive'\n                                    }`}>\n                                      {item.is_payment_completed ? 'êµ¬ë§¤ì™„ë£Œ' : 'êµ¬ë§¤ëŒ€ê¸°'}\n                                    </span>\n                                  )}\n                                </div>\n                              )}\n                              \n                              {/* ì…ê³  íƒ­ì—ì„œì˜ ì…ê³ ì™„ë£Œ ìƒíƒœ */}\n                              {activeTab === 'receipt' && (\n                                <div className=\"flex justify-center\">\n                                  {canReceiptCheck ? (\n                                    actualReceivedAction.isCompleted(item) ? (\n                                      <button\n                                        onClick={() => {\n                                          actualReceivedAction.handleCancel(item.id, {\n                                            item_name: item.item_name,\n                                            specification: item.specification,\n                                            quantity: item.quantity,\n                                            unit_price_value: item.unit_price_value,\n                                            amount_value: item.amount_value,\n                                            remark: item.remark\n                                          })\n                                        }}\n                                        className=\"button-action-primary\"\n                                      >\n                                        {actualReceivedAction.config.completedText}\n                                      </button>\n                                    ) : (\n                                      <DatePickerPopover\n                                        onDateSelect={(date) => {\n                                          actualReceivedAction.handleConfirm(item.id, date, {\n                                            item_name: item.item_name,\n                                            specification: item.specification,\n                                            quantity: item.quantity,\n                                            unit_price_value: item.unit_price_value,\n                                            amount_value: item.amount_value,\n                                            remark: item.remark\n                                          })\n                                        }}\n                                        placeholder=\"ì‹¤ì œ ì…ê³ ëœ ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”\"\n                                        align=\"center\"\n                                        side=\"bottom\"\n                                      >\n                                        <button className=\"button-toggle-inactive\">\n                                          {actualReceivedAction.config.waitingText}\n                                        </button>\n                                      </DatePickerPopover>\n                                    )\n                                  ) : (\n                                    <span className={`${\n                                      actualReceivedAction.isCompleted(item)\n                                        ? 'button-action-primary' \n                                        : 'button-waiting-inactive'\n                                    }`}>\n                                      {actualReceivedAction.isCompleted(item) ? actualReceivedAction.config.completedText : actualReceivedAction.config.waitingText}\n                                    </span>\n                                  )}\n                                </div>\n                              )}\n                              \n                              {/* ì „ì²´ í•­ëª© íƒ­ì—ì„œëŠ” ì…ê³  ìƒíƒœë§Œ í‘œì‹œ (í´ë¦­ ë¶ˆê°€) */}\n                              {activeTab === 'done' && (\n                                <div className=\"flex justify-center\">\n                                  <span className={`button-base ${\n                                    actualReceivedAction.isCompleted(item)\n                                      ? 'bg-green-500 hover:bg-green-600 text-white' \n                                      : 'border border-gray-300 text-gray-600 bg-white hover:bg-gray-50'\n                                  }`}>\n                                    {actualReceivedAction.isCompleted(item) ? 'ì…ê³ ì™„ë£Œ' : 'ì…ê³ ëŒ€ê¸°'}\n                                  </span>\n                                </div>\n                              )}\n                              \n                              {/* ê¸°íƒ€ íƒ­ì—ì„œëŠ” ê¸°ë³¸ ìƒíƒœ í‘œì‹œ */}\n                              {activeTab !== 'purchase' && activeTab !== 'receipt' && activeTab !== 'done' && (\n                                <div className=\"flex justify-center\">\n                                  <span className=\"badge-text\">-</span>\n                                </div>\n                              )}\n                            </>\n                          )}\n                        </div>\n                        \n                        {/* ì‹¤ì œ ì…ê³  ë‚ ì§œ - ì…ê³  íƒ­ì—ì„œë§Œ í‘œì‹œ (ìƒíƒœ ì»¬ëŸ¼ ì˜¤ë¥¸ìª½) */}\n                        {activeTab === 'receipt' && (\n                          <div className=\"text-center flex justify-center items-start pt-1 pl-2\">\n                            {actualReceivedAction.getCompletedDate(item) ? (\n                              <div className=\"modal-subtitle text-green-700\">\n                                {new Date(actualReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                                  year: 'numeric',\n                                  month: '2-digit',\n                                  day: '2-digit'\n                                })}\n                              </div>\n                            ) : (\n                              <span className=\"modal-subtitle text-gray-400\">-</span>\n                            )}\n                          </div>\n                        )}\n\n                        {/* ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ - ì „ì²´í•­ëª© íƒ­ì—ì„œë§Œ í‘œì‹œ */}\n                        {activeTab === 'done' && (\n                          <div className=\"text-center flex justify-center items-start pt-1\">\n                            {canReceiptCheck ? (\n                              statementReceivedAction.isCompleted(item) ? (\n                                <button\n                                  onClick={() => {\n                                    statementReceivedAction.handleCancel(item.id, {\n                                      item_name: item.item_name,\n                                      specification: item.specification,\n                                      quantity: item.quantity,\n                                      unit_price_value: item.unit_price_value,\n                                      amount_value: item.amount_value,\n                                      remark: item.remark\n                                    })\n                                  }}\n                                  className=\"button-action-primary hover:bg-green-600 transition-colors\"\n                                  title=\"í´ë¦­í•˜ì—¬ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ì·¨ì†Œ\"\n                                >\n                                  {statementReceivedAction.config.completedText}\n                                </button>\n                              ) : (\n                                <DatePickerPopover\n                                  onDateSelect={(date) => {\n                                    statementReceivedAction.handleConfirm(item.id, date, {\n                                      item_name: item.item_name,\n                                      specification: item.specification,\n                                      quantity: item.quantity,\n                                      unit_price_value: item.unit_price_value,\n                                      amount_value: item.amount_value,\n                                      remark: item.remark\n                                    })\n                                  }}\n                                  placeholder=\"íšŒê³„ìƒ ì…ê³ ì¼ì„ ì„ íƒí•˜ì„¸ìš”\"\n                                  align=\"center\"\n                                  side=\"bottom\"\n                                >\n                                  <button \n                                    className=\"button-toggle-inactive\"\n                                    onClick={() => console.log('ğŸ–±ï¸ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ë²„íŠ¼ í´ë¦­:', { itemId: item.id, itemName: item.item_name })}\n                                  >\n                                    {statementReceivedAction.config.waitingText}\n                                  </button>\n                                </DatePickerPopover>\n                              )\n                            ) : (\n                              <span className={`${\n                                statementReceivedAction.isCompleted(item)\n                                  ? 'button-action-primary' \n                                  : 'button-waiting-inactive'\n                              }`}>\n                                {statementReceivedAction.isCompleted(item) ? statementReceivedAction.config.completedText : statementReceivedAction.config.waitingText}\n                              </span>\n                            )}\n                          </div>\n                        )}\n\n                        {/* íšŒê³„ìƒ ì…ê³ ì¼ - ì „ì²´í•­ëª© íƒ­ì—ì„œë§Œ í‘œì‹œ */}\n                        {activeTab === 'done' && (\n                          <div className=\"text-center flex justify-center items-start pt-1\">\n                            {statementReceivedAction.getCompletedDate(item) ? (\n                              <div className=\"modal-subtitle text-blue-700\">\n                                {new Date(statementReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                                  year: 'numeric',\n                                  month: '2-digit',\n                                  day: '2-digit'\n                                })}\n                              </div>\n                            ) : (\n                              <span className=\"modal-subtitle text-gray-400\">-</span>\n                            )}\n                          </div>\n                        )}\n                        {/* ì²˜ë¦¬ì - ì „ì²´í•­ëª© íƒ­ì—ì„œë§Œ í‘œì‹œ */}\n                        {activeTab === 'done' && (\n                          <div className=\"text-center flex justify-center items-start pt-1\">\n                            {statementReceivedAction.getCompletedByName(item) ? (\n                              <span className=\"modal-subtitle text-gray-600\">\n                                {statementReceivedAction.getCompletedByName(item)}\n                              </span>\n                            ) : (\n                              <span className=\"modal-subtitle text-gray-400\">-</span>\n                            )}\n                          </div>\n                        )}\n                      </div>\n                      \n                      {/* Mobile Layout */}\n                      <div className=\"block sm:hidden space-y-2\">\n                        <div className=\"flex justify-between items-start\">\n                          <div className=\"flex-1 min-w-0\">\n                            {isEditing ? (\n                              <Input\n                                value={item.item_name}\n                                onChange={(e) => handleItemChange(index, 'item_name', e.target.value)}\n                                className=\"modal-label border-gray-200 rounded-lg w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                placeholder=\"í’ˆëª©ëª…\"\n                              />\n                            ) : (\n                              <div className=\"modal-value font-medium\">{item.item_name || 'í’ˆëª©ëª… ì—†ìŒ'}</div>\n                            )}\n                            {isEditing ? (\n                              <Input\n                                value={item.specification}\n                                onChange={(e) => handleItemChange(index, 'specification', e.target.value)}\n                                className=\"modal-label border-gray-200 rounded-lg mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                placeholder=\"ê·œê²©\"\n                              />\n                            ) : (\n                              <div className=\"modal-subtitle text-gray-500\">{item.specification || '-'}</div>\n                            )}\n                          </div>\n                          <div className=\"ml-3 text-right flex-shrink-0\">\n                            {isEditing ? (\n                              <Input\n                                type=\"number\"\n                                value={item.amount_value}\n                                onChange={(e) => handleItemChange(index, 'amount_value', Number(e.target.value))}\n                                className=\"modal-label border-gray-200 rounded-lg text-right w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                placeholder=\"í•©ê³„\"\n                              />\n                            ) : (\n                              <div className=\"modal-value font-semibold\">â‚©{formatCurrency(item.amount_value || 0)}</div>\n                            )}\n                          </div>\n                        </div>\n                        \n                        <div className=\"grid grid-cols-3 gap-2 text-sm\">\n                          <div>\n                            <span className=\"text-gray-500 text-xs\">ìˆ˜ëŸ‰:</span>\n                            {isEditing ? (\n                              <Input\n                                type=\"number\"\n                                value={item.quantity}\n                                onChange={(e) => handleItemChange(index, 'quantity', Number(e.target.value))}\n                                className=\"modal-label border-gray-200 rounded-lg mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                placeholder=\"ìˆ˜ëŸ‰\"\n                              />\n                            ) : (\n                              <div className=\"modal-subtitle\">{item.quantity || 0}</div>\n                            )}\n                          </div>\n                          <div>\n                            <span className=\"text-gray-500 text-xs\">ë‹¨ê°€:</span>\n                            {isEditing ? (\n                              <Input\n                                type=\"number\"\n                                value={item.unit_price_value}\n                                onChange={(e) => handleItemChange(index, 'unit_price_value', Number(e.target.value))}\n                                className=\"modal-label border-gray-200 rounded-lg mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                placeholder=\"ë‹¨ê°€\"\n                              />\n                            ) : (\n                              <div className=\"modal-subtitle\">â‚©{formatCurrency(item.unit_price_value)}</div>\n                            )}\n                          </div>\n                          <div>\n                            <span className=\"text-gray-500 text-xs\">ìƒíƒœ:</span>\n                            <div className=\"mt-1\">\n                              {isEditing ? (\n                                <Button\n                                  size=\"sm\"\n                                  variant=\"ghost\"\n                                  onClick={() => handleRemoveItem(index)}\n                                  className=\"text-red-600 hover:bg-red-50 rounded-lg p-1 h-6 w-6\"\n                                >\n                                  <Trash2 className=\"w-3 h-3\" />\n                                </Button>\n                              ) : (\n                                <>\n                                  {activeTab === 'purchase' && (\n                                    <>\n                                      {canPurchase ? (\n                                        <button\n                                          onClick={() => handlePaymentToggle(item.id, !item.is_payment_completed)}\n                                          className={`text-xs px-2 py-1 rounded transition-colors ${\n                                            item.is_payment_completed\n                                              ? 'bg-orange-500 text-white hover:bg-orange-600'\n                                              : 'bg-gray-100 text-gray-600'\n                                          }`}\n                                        >\n                                          {item.is_payment_completed ? 'êµ¬ë§¤ì™„ë£Œ' : 'êµ¬ë§¤ëŒ€ê¸°'}\n                                        </button>\n                                      ) : (\n                                        <span className={`text-xs px-2 py-1 rounded ${\n                                          item.is_payment_completed \n                                            ? 'bg-orange-500 text-white' \n                                            : 'bg-gray-100 text-gray-400'\n                                        }`}>\n                                          {item.is_payment_completed ? 'êµ¬ë§¤ì™„ë£Œ' : 'êµ¬ë§¤ëŒ€ê¸°'}\n                                        </span>\n                                      )}\n                                    </>\n                                  )}\n                                  \n                                  {activeTab === 'receipt' && (\n                                    <>\n                                      {canReceiptCheck ? (\n                                        actualReceivedAction.isCompleted(item) ? (\n                                          <button\n                                            onClick={() => {\n                                              actualReceivedAction.handleCancel(item.id, {\n                                                item_name: item.item_name,\n                                                specification: item.specification,\n                                                quantity: item.quantity,\n                                                unit_price_value: item.unit_price_value,\n                                                amount_value: item.amount_value,\n                                                remark: item.remark\n                                              })\n                                            }}\n                                            className=\"text-xs px-2 py-1 rounded button-action-primary\"\n                                          >\n                                            {actualReceivedAction.config.completedText}\n                                          </button>\n                                        ) : (\n                                          <DatePickerPopover\n                                            onDateSelect={(date) => {\n                                              actualReceivedAction.handleConfirm(item.id, date, {\n                                                item_name: item.item_name,\n                                                specification: item.specification,\n                                                quantity: item.quantity,\n                                                unit_price_value: item.unit_price_value,\n                                                amount_value: item.amount_value,\n                                                remark: item.remark\n                                              })\n                                            }}\n                                            placeholder=\"ì‹¤ì œ ì…ê³ ëœ ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”\"\n                                            align=\"center\"\n                                            side=\"bottom\"\n                                          >\n                                            <button className=\"text-xs px-2 py-1 rounded bg-gray-100 text-gray-600\">\n                                              {actualReceivedAction.config.waitingText}\n                                            </button>\n                                          </DatePickerPopover>\n                                        )\n                                      ) : (\n                                        <span className={`text-xs px-2 py-1 rounded ${\n                                          actualReceivedAction.isCompleted(item)\n                                            ? 'button-action-primary' \n                                            : 'bg-gray-100 text-gray-400'\n                                        }`}>\n                                          {actualReceivedAction.isCompleted(item) ? actualReceivedAction.config.completedText : actualReceivedAction.config.waitingText}\n                                        </span>\n                                      )}\n                                    </>\n                                  )}\n                                  \n                                  {activeTab === 'done' && (\n                                    <>\n                                      {/* ì „ì²´ í•­ëª© íƒ­ì—ì„œëŠ” ì…ê³  ìƒíƒœë§Œ í‘œì‹œ (í´ë¦­ ë¶ˆê°€) */}\n                                      <span className={`button-base ${\n                                        actualReceivedAction.isCompleted(item)\n                                          ? 'bg-green-500 text-white' \n                                          : 'border border-gray-300 text-gray-600 bg-white'\n                                      }`}>\n                                        {actualReceivedAction.isCompleted(item) ? 'ì…ê³ ì™„ë£Œ' : 'ì…ê³ ëŒ€ê¸°'}\n                                      </span>\n                                    </>\n                                  )}\n                                  \n                                  {activeTab !== 'purchase' && activeTab !== 'receipt' && activeTab !== 'done' && (\n                                    <span className=\"text-xs text-gray-400\">-</span>\n                                  )}\n                                </>\n                              )}\n                            </div>\n                          </div>\n                        </div>\n                        \n                        {(item.remark || isEditing) && (\n                          <div>\n                            <span className=\"text-gray-500 text-xs\">ë¹„ê³ :</span>\n                            {isEditing ? (\n                              <Input\n                                value={item.remark || ''}\n                                onChange={(e) => handleItemChange(index, 'remark', e.target.value)}\n                                className=\"modal-label border-gray-200 rounded-lg mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                placeholder=\"ë¹„ê³ \"\n                              />\n                            ) : (\n                              <div className=\"modal-subtitle text-gray-500 mt-1\">{item.remark || '-'}</div>\n                            )}\n                          </div>\n                        )}\n                        \n                        {/* ëª¨ë°”ì¼ì—ì„œ ì‹¤ì œ ì…ê³  ë‚ ì§œ í‘œì‹œ */}\n                        {!isEditing && activeTab === 'receipt' && actualReceivedAction.getCompletedDate(item) && (\n                          <div>\n                            <span className=\"text-gray-500 text-xs\">ì‹¤ì œì…ê³ ì¼:</span>\n                            <div className=\"mt-1\">\n                              <div className=\"modal-subtitle text-green-700\">\n                                {new Date(actualReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                                  year: 'numeric',\n                                  month: '2-digit',\n                                  day: '2-digit'\n                                })}\n                              </div>\n                              <div className=\"text-[9px] text-gray-500\">\n                                {new Date(actualReceivedAction.getCompletedDate(item)).toLocaleTimeString('ko-KR', {\n                                  hour: '2-digit',\n                                  minute: '2-digit'\n                                })}\n                              </div>\n                            </div>\n                          </div>\n                        )}\n\n                        {/* ëª¨ë°”ì¼ì—ì„œ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ í‘œì‹œ - ì „ì²´í•­ëª© íƒ­ì—ì„œë§Œ */}\n                        {!isEditing && activeTab === 'done' && (\n                          <div className=\"flex items-center justify-between\">\n                            <span className=\"text-gray-500 text-xs\">ê±°ë˜ëª…ì„¸ì„œ í™•ì¸:</span>\n                            <div className=\"flex items-center gap-2\">\n                              {canReceiptCheck ? (\n                                statementReceivedAction.isCompleted(item) ? (\n                                  <button\n                                    onClick={() => {\n                                      statementReceivedAction.handleCancel(item.id, {\n                                        item_name: item.item_name,\n                                        specification: item.specification,\n                                        quantity: item.quantity,\n                                        unit_price_value: item.unit_price_value,\n                                        amount_value: item.amount_value,\n                                        remark: item.remark\n                                      })\n                                    }}\n                                    className=\"text-xs px-2 py-1 rounded button-action-primary hover:bg-green-600 transition-colors\"\n                                    title=\"í´ë¦­í•˜ì—¬ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ì·¨ì†Œ\"\n                                  >\n                                    {statementReceivedAction.config.completedText}\n                                  </button>\n                                ) : (\n                                  <DatePickerPopover\n                                    onDateSelect={(date) => {\n                                      statementReceivedAction.handleConfirm(item.id, date, {\n                                        item_name: item.item_name,\n                                        specification: item.specification,\n                                        quantity: item.quantity,\n                                        unit_price_value: item.unit_price_value,\n                                        amount_value: item.amount_value,\n                                        remark: item.remark\n                                      })\n                                    }}\n                                    placeholder=\"íšŒê³„ìƒ ì…ê³ ì¼ì„ ì„ íƒí•˜ì„¸ìš”\"\n                                    align=\"end\"\n                                    side=\"bottom\"\n                                  >\n                                    <button \n                                      className=\"text-xs px-2 py-1 rounded bg-gray-100 text-gray-600\"\n                                      onClick={() => console.log('ğŸ–±ï¸ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ë²„íŠ¼ í´ë¦­ (ëª¨ë°”ì¼):', { itemId: item.id, itemName: item.item_name })}\n                                    >\n                                      {statementReceivedAction.config.waitingText}\n                                    </button>\n                                  </DatePickerPopover>\n                                )\n                              ) : (\n                                <span className={`text-xs px-2 py-1 rounded ${\n                                  statementReceivedAction.isCompleted(item)\n                                    ? 'button-action-primary' \n                                    : 'bg-gray-100 text-gray-400'\n                                }`}>\n                                  {statementReceivedAction.isCompleted(item) ? statementReceivedAction.config.completedText : statementReceivedAction.config.waitingText}\n                                </span>\n                              )}\n                            </div>\n                          </div>\n                        )}\n\n                        {/* ëª¨ë°”ì¼ì—ì„œ íšŒê³„ìƒ ì…ê³ ì¼ í‘œì‹œ - ì „ì²´í•­ëª© íƒ­ì—ì„œë§Œ */}\n                        {!isEditing && activeTab === 'done' && statementReceivedAction.getCompletedDate(item) && (\n                          <div>\n                            <span className=\"text-gray-500 text-xs\">íšŒê³„ìƒ ì…ê³ ì¼:</span>\n                            <div className=\"mt-1\">\n                              <div className=\"modal-subtitle text-blue-700\">\n                                {new Date(statementReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                                  year: 'numeric',\n                                  month: '2-digit',\n                                  day: '2-digit'\n                                })}\n                              </div>\n                            </div>\n                          </div>\n                        )}\n                        {/* ëª¨ë°”ì¼ì—ì„œ ì²˜ë¦¬ì í‘œì‹œ - ì „ì²´í•­ëª© íƒ­ì—ì„œë§Œ */}\n                        {!isEditing && activeTab === 'done' && statementReceivedAction.getCompletedByName(item) && (\n                          <div>\n                            <span className=\"text-gray-500 text-xs\">ì²˜ë¦¬ì:</span>\n                            <div className=\"mt-1\">\n                              <div className=\"modal-subtitle text-gray-600\">\n                                {statementReceivedAction.getCompletedByName(item)}\n                              </div>\n                            </div>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  ))}\n                </div>\n                \n                {/* í•©ê³„ */}\n                <div className=\"bg-gray-50 px-2 sm:px-3 border-t border-gray-100\">\n                  <div className=\"hidden sm:grid items-center gap-3 py-0.5\" style={{\n                    gridTemplateColumns: getGridTemplateColumns()\n                  }}>\n                    {/* í’ˆëª©ëª… */}\n                    <div></div>\n                    {/* ê·œê²© */}\n                    <div></div>\n                    {/* ìˆ˜ëŸ‰ */}\n                    <div></div>\n                    {/* ë‹¨ê°€ */}\n                    <div className=\"text-right\">\n                      <span className=\"text-[12px] font-bold text-gray-900\">ì´ì•¡</span>\n                    </div>\n                    {/* í•©ê³„ */}\n                    <div className=\"text-right\">\n                      <span className=\"text-[12px] font-bold text-gray-900\">\n                        â‚©{formatCurrency(\n                          (isEditing ? editedItems : purchase.items)?.reduce((sum, item) => sum + (item.amount_value || 0), 0) || 0\n                        )}\n                      </span>\n                    </div>\n                    {/* ë‚˜ë¨¸ì§€ ì¹¼ëŸ¼ë“¤ */}\n                    <div></div>\n                    <div></div>\n                    {activeTab === 'receipt' && <div></div>}\n                  </div>\n                  \n                  {/* Mobile ì´ì•¡ */}\n                  <div className=\"block sm:hidden py-0.5\">\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-[13px] font-bold text-gray-900\">ì´ì•¡</span>\n                      <span className=\"text-[13px] font-bold text-gray-900\">\n                        â‚©{formatCurrency(\n                          (isEditing ? editedItems : purchase.items)?.reduce((sum, item) => sum + (item.amount_value || 0), 0) || 0\n                        )}\n                      </span>\n                    </div>\n                  </div>\n                </div>\n                \n                {/* í•­ëª© ì¶”ê°€ ë²„íŠ¼ */}\n                {isEditing && (\n                  <div className=\"p-2 sm:p-3 border-t border-gray-100\">\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={handleAddItem}\n                      className=\"w-full rounded-lg border-dashed border-2 border-gray-300 hover:border-gray-400 py-2 badge-text\"\n                    >\n                      <Plus className=\"w-4 h-4 mr-1\" />\n                      í•­ëª© ì¶”ê°€\n                    </Button>\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n      ) : (\n        <div className=\"text-center py-12\">\n          <span className=\"modal-subtitle\">\n            ë°œì£¼ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n          </span>\n        </div>\n      )}\n    </div>\n  )\n\n  // embeddedê°€ trueë©´ Dialog ì—†ì´ ë‚´ìš©ë§Œ ë°˜í™˜\n  if (embedded) {\n    return content\n  }\n\n  // embeddedê°€ falseë©´ Dialogë¡œ ê°ì‹¸ì„œ ë°˜í™˜\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent \n        className=\"overflow-hidden bg-white rounded-lg shadow-sm border-0 w-[100vw] h-[100vh] sm:w-auto sm:min-w-[1000px] sm:max-w-none sm:max-h-[90vh] lg:max-h-[85vh] sm:rounded-lg flex flex-col\" \n        showCloseButton={false}\n      >\n        {/* Apple-style Header */}\n        <div className=\"relative px-3 sm:px-6 pt-0 sm:pt-3 lg:pt-4 pb-0 sm:pb-2 lg:pb-3 flex-shrink-0\">\n          <button\n            onClick={onClose}\n            className=\"button-base button-action-secondary absolute right-3 sm:right-6 top-0 sm:top-3 lg:top-4 w-6 h-6 sm:w-8 sm:h-8 rounded-full\"\n          >\n            <X className=\"w-4 h-4 text-gray-500\" />\n          </button>\n          \n          <div className=\"pr-8 sm:pr-16\">\n            <div className=\"flex items-start gap-4 mb-0 sm:mb-3\">\n              <div className=\"min-w-0 flex-1\">\n                <h1 className=\"page-title mb-0 sm:mb-1\">\n                  ë°œì£¼ ê¸°ë³¸ì •ë³´\n                </h1>\n              </div>\n              <div className=\"flex items-center gap-3\">\n                {!isEditing && canEdit && (\n                  <>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => handleEditToggle(true)}\n                      className=\"button-base button-action-secondary\"\n                    >\n                      <Edit2 className=\"w-4 h-4 mr-2\" />\n                      ìˆ˜ì •\n                    </Button>\n                    {canDelete && onDelete && (\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={() => purchase && onDelete(purchase)}\n                        className=\"button-base button-action-danger\"\n                      >\n                        <Trash2 className=\"w-4 h-4 mr-2\" />\n                        ì‚­ì œ\n                      </Button>\n                    )}\n                  </>\n                )}\n                {isEditing && (\n                  <>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => {\n                        handleEditToggle(false)\n                        setEditedPurchase(purchase)\n                        setEditedItems(purchase?.items || [])\n                        setDeletedItemIds([])\n                      }}\n                      className=\"button-base button-action-secondary\"\n                    >\n                      <X className=\"w-4 h-4 mr-2\" />\n                      ì·¨ì†Œ\n                    </Button>\n                    <Button\n                      size=\"sm\"\n                      onClick={handleSave}\n                      className=\"button-base button-action-primary\"\n                    >\n                      <Save className=\"w-4 h-4 mr-2\" />\n                      ì €ì¥\n                    </Button>\n                  </>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Apple-style Content */}\n        <div className=\"overflow-y-auto flex-1 px-3 sm:px-6 pb-1 sm:pb-6 mt-0\">\n          {content}\n        </div>\n      </DialogContent>\n      \n      {/* ì…ê³  ìš”ì²­ì¼ ë‚ ì§œ ì„ íƒ ë‹¤ì´ì–¼ë¡œê·¸ */}\n      <DatePickerDialog\n        isOpen={showDeliveryDateDialog}\n        onClose={() => setShowDeliveryDateDialog(false)}\n        onDateSelect={handleDeliveryDateSelect}\n        title=\"ì…ê³  ìš”ì²­ì¼ ì„ íƒ\"\n        description=\"ì…ê³  ìš”ì²­ ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”\"\n        defaultDate={editedPurchase?.delivery_request_date ? new Date(editedPurchase.delivery_request_date) : new Date()}\n      />\n      \n      {/* ë³€ê²½ ì…ê³ ì¼ ë‚ ì§œ ì„ íƒ ë‹¤ì´ì–¼ë¡œê·¸ */}\n      <DatePickerDialog\n        isOpen={showRevisedDateDialog}\n        onClose={() => setShowRevisedDateDialog(false)}\n        onDateSelect={handleRevisedDateSelect}\n        title=\"ë³€ê²½ ì…ê³ ì¼ ì„ íƒ\"\n        description=\"ë³€ê²½ëœ ì…ê³  ìš”ì²­ ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”\"\n        defaultDate={editedPurchase?.revised_delivery_request_date ? new Date(editedPurchase.revised_delivery_request_date) : new Date()}\n      />\n      \n    </Dialog>\n  )\n}"],"names":["Truck","createLucideIcon","d","key","cx","cy","r","DatePickerDialog","isOpen","onClose","onDateSelect","title","description","defaultDate","Date","selectedDate","setSelectedDate","useState","jsx","Dialog","open","onOpenChange","children","jsxs","DialogContent","className","DialogHeader","DialogTitle","CalendarIcon","Calendar","mode","selected","onSelect","date","locale","ko","format","DialogFooter","Button","variant","onClick","PurchaseDetailModal","purchaseId","embedded","currentUserRoles","activeTab","onRefresh","onOptimisticUpdate","onDelete","loading","setLoading","purchase","setPurchase","isEditing","setIsEditing","editedPurchase","setEditedPurchase","editedItems","setEditedItems","deletedItemIds","setDeletedItemIds","userRoles","setUserRoles","currentUserName","setCurrentUserName","columnWidths","setColumnWidths","headerRowRef","useRef","supabase","createClient","showDeliveryDateDialog","setShowDeliveryDateDialog","showRevisedDateDialog","setShowRevisedDateDialog","useEffect","async","data","user","auth","getUser","employeeData","from","select","eq","id","maybeSingle","email","employeeByEmail","name","purchase_role","roles","Array","isArray","map","String","trim","split","filter","length","error","loadUserRoles","effectiveRoles","canEdit","includes","canDelete","final_manager_status","requester_name","canPurchase","canReceiveItems","isAdmin","isRequester","canReceiptCheck","refreshModalData","useCallback","freshPurchase","single","items","logger","debug","isInitialLoad","setIsInitialLoad","purchaseIdNumber","Number","NaN","handleActualReceiptOptimisticUpdate","itemId","action","itemIdStr","nowIso","toISOString","selectedDateIso","updateItems","item","is_received","actual_received_date","received_at","prev","updatedItems","total","completed","allReceived","prevItems","isNaN","prevPurchase","statementReceivedAction","useConfirmDateAction","config","field","confirmMessage","confirm","cancel","successMessage","completedText","waitingText","canPerformAction","onUpdate","actualReceivedAction","requesterName","canApproveMiddle","canApproveFinal","approvalButtonClass","approvalWaitingPillClass","middleManagerStatus","middle_manager_status","finalManagerStatus","loadPurchaseDetail","toString","calculateOptimalColumnWidths","columnConfigs","minWidth","maxWidth","baseWidth","push","calculatedWidths","index","maxLength","headers","baseHeaders","getHeaders","Math","max","forEach","cellValue","item_name","specification","quantity","unit_price_value","toLocaleString","amount_value","remark","getStatusDisplay","formatDate","is_statement_received","statement_received_date","statement_received_by_name","adjustedLength","reduce","acc","char","test","ceil","calculatedWidth","min","range","purchase_status","receipt_status","getGridTemplateColumns","width","join","baseColumns","handleEditToggle","editing","sortedItems","purchase_request_items","sort","a","b","line_number","purchaseData","vendor","vendors","vendor_name","vendor_contacts","toast","formatCurrency","amount","Intl","NumberFormat","handleItemChange","value","newItems","unitPrice","handleRemoveItem","_","i","handlePaymentToggle","isCompleted","numericId","targetItem","find","itemInfo","unit","window","update","is_payment_completed","payment_completed_at","allCompleted","payment_completed_by_name","success","refreshResult","silent","Promise","handleApprove","type","approvalType","purchase_order_number","updateData","content","payment_category","category","Badge","getStatusBadge","request_date","size","Check","X","FileText","Input","request_type","onChange","e","target","placeholder","delivery_request_date","revised_delivery_request_date","Building2","contact_name","updatedContacts","project_vendor","project_item","order_number","Package","Fragment","CreditCard","DatePickerPopover","applyOptimisticUpdate","is","align","side","ref","style","gridTemplateColumns","Trash2","handleCancel","handleConfirm","getCompletedDate","toLocaleDateString","year","month","day","getCompletedByName","toLocaleTimeString","hour","minute","sum","newItem","lineNum","Plus","showCloseButton","Edit2","editedItemsCount","deletedItemsCount","totalAmount","updateError","total_amount","updated_at","deleteError","delete","in","count","itemName","Error","unit_price_currency","currency","amount_currency","insertData","purchase_request_id","indexOf","created_at","insert","errorMessage","message","Save"],"mappings":"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","x_google_ignoreList":[0]}