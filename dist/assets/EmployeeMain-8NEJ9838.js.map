{"version":3,"mappings":"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","names":["ToggleLeft","createLucideIcon","cx","cy","r","key","width","height","x","y","rx","ToggleRight","employeeService","constructor","this","supabase","createClient","getEmployees","filters","query","from","select","order","search","or","department","eq","position","purchase_role","is","contains","is_active","data","error","success","logger","Error","message","getEmployee","id","single","createEmployee","employeeData","existingEmployee","email","employeeId","crypto","randomUUID","isActive","insert","length","terminated_at","Date","toISOString","String","updateEmployee","neq","updateData","update","deleteEmployee","purchaseRequests","limit","delete","toggleEmployeeStatus","currentEmployee","selectError","nextIsActive","updateEmployeeRole","role","getDepartments","Set","map","emp","filter","dept","sort","getPositions","pos","getEmployeesForExport","employee","name","phone","adress","getRoleDisplayName","created_at","toLocaleDateString","roleNames","app_admin","hr","accounting","ceo","final_approver","middle_manager","buyer","roles","normalizeRoles","value","join","Array","isArray","trim","split","Boolean","checkPermission","userId","requiredRoles","hasPermission","some","includes","PURCHASE_ROLES","label","EmployeeFilters","onFiltersChange","onExport","onCreateNew","onAttendanceDownload","onAnnualLeaveUsageDownload","canManageEmployees","localSearch","setLocalSearch","useState","departments","setDepartments","positions","setPositions","useEffect","async","deptResult","posResult","Promise","all","loadOptions","timeoutId","setTimeout","nextSearch","clearTimeout","hasFilters","jsxs","className","children","jsx","style","marginTop","marginBottom","Button","onClick","Calendar","Download","Plus","Search","Input","type","placeholder","onChange","e","target","Select","onValueChange","SelectTrigger","SelectValue","SelectContent","SelectItem","X","NEW_ROW_ID","toInputDate","slice","EmployeeTable","employees","onRefresh","currentUserRoles","createRequestToken","loadingId","setLoadingId","sortedData","sortConfig","handleSort","useTableSort","editingRowId","setEditingRowId","isCreating","setIsCreating","draft","setDraft","availableEmployeeColumns","setAvailableEmployeeColumns","handleToggleStatus","result","toast","handleDelete","confirm","getPrimaryRole","primaryRole","getRoleBadgeColor","sample","Object","keys","employeeID","personal_email","annual_leave_granted_current_year","used_annual_leave","remaining_annual_leave","join_date","birthday","bank_account","startCreate","startEdit","employee_number","cancelEdit","toNullableTrimmed","trimmed","toNullableNumber","numberValue","Number","isFinite","handleSave","rawPayload","allowedColumns","payload","fromEntries","entries","has","updateDraft","prev","displayRows","useMemo","updated_at","isEditingRow","Fragment","Table","TableHeader","TableRow","TableHead","SortableHeader","sortKey","currentSortKey","sortDirection","direction","onSort","TableBody","TableCell","colSpan","formatDate","disabled","Save","DropdownMenu","DropdownMenuTrigger","asChild","MoreHorizontal","DropdownMenuContent","align","DropdownMenuItem","Edit","Trash2","MobileCard","MobileCardHeader","MobileCardItem","MobileCardActions","Combobox","options","searchPlaceholder","emptyText","open","setOpen","React.useState","Popover","onOpenChange","PopoverTrigger","variant","cn","find","option","ChevronsUpDown","PopoverContent","Command","CommandInput","CommandEmpty","CommandGroup","CommandItem","onSelect","Check","generateAttendanceExcel","workbook","ExcelJS","Workbook","worksheet","addWorksheet","pageSetup","paperSize","orientation","margins","left","right","top","bottom","header","footer","columns","addRow","mergeCells","titleCell","getCell","font","size","bold","alignment","horizontal","vertical","employeeName","employeeCell","startDate","endDate","periodCell","headerRow","eachCell","cell","_colNumber","border","fill","pattern","fgColor","argb","records","forEach","record","workStatus","remarks","isWeekendOrHoliday","dateString","date","dayOfWeek","getDay","year","getFullYear","month","getMonth","day","getDate","holidays","dateStr","toString","padStart","isWeekendOrHolidayFunc","dataRow","workType","clockIn","clockOut","status","isSpecialDay","isLeaveDay","colNumber","buffer","xlsx","writeBuffer","Blob","formatDateWithDay","getDayOfWeek","AttendanceDownload","isOpen","onClose","selectedEmployee","setSelectedEmployee","setStartDate","setEndDate","isDownloading","setIsDownloading","handleClose","Dialog","DialogContent","DialogHeader","DialogTitle","User","a","b","localeCompare","now","start","end","selectedEmp","attendanceRecords","gte","lte","ascending","allDates","setDate","push","recordMap","Map","set","excelRecords","get","dateWithDay","dateObj","isWeekend","clock_in","clock_out","excelData","blob","url","window","URL","createObjectURL","document","createElement","href","download","body","appendChild","click","removeChild","revokeObjectURL","KOREAN_DAYS","toDateOnly","d","setHours","formatYmd","classifyLeaveForAnnualUsage","leave","toLowerCase","ok","reason","unit","typeRaw","reasonRaw","getLeaveUnit","daysNum","days","NaN","isNaN","sp","start_period","ep","end_period","start_date","end_date","AnnualLeaveUsageDownload","setYear","min","max","yearNum","effectiveStart","effectiveEnd","leaveRows","leaveError","leaves","includedLeaves","l","cls","user_email","excludedLeaves","excludeReason","summaries","details","params","rangeStart","rangeEnd","usedByEmail","leaveStart","leaveEnd","cursor","dow","ymd","dayUnit","leave_id","leave_start_date","leave_end_date","used_days","calcAnnualLeaveUsageByWorkdays","employeesResult","empByEmail","targetEmails","s","targetEmployeeIds","employeeIdByEmail","monthlyMap","m","dayStr","byMonth","formatMonthCell","items","it","summaryRows","months","grantedDays","joinDateStr","targetYear","joinDate","getTime","joinYear","joinMonth","serviceYears","remainingMonths","Math","floor","calcGrantedAnnualLeaveForYear","usedDays","debug","wsSummary","getRow","nameA","nameB","cmp","row","m1","m2","m3","m4","m5","m6","m7","m8","m9","m10","m11","m12","wsIncluded","wsExcluded","generateAnnualLeaveUsageExcel","err","msg","EmployeeMain","useAuth","setEmployees","filteredEmployees","setFilteredEmployees","loading","setLoading","setFilters","setCreateRequestToken","isAttendanceModalOpen","setIsAttendanceModalOpen","isAnnualLeaveUsageModalOpen","setIsAnnualLeaveUsageModalOpen","loadEmployees","XLSX","__vitePreload","import","__VITE_PRELOAD__","ws","utils","json_to_sheet","wb","book_new","book_append_sheet","filename","writeFile"],"ignoreList":[0,1],"sources":["../../node_modules/lucide-react/dist/esm/icons/toggle-left.js","../../node_modules/lucide-react/dist/esm/icons/toggle-right.js","../../src/services/employeeService.ts","../../src/components/employee/EmployeeFilters.tsx","../../src/components/employee/EmployeeTable.tsx","../../src/components/ui/combobox.tsx","../../src/utils/exceljs/generateAttendanceExcel.ts","../../src/components/employee/AttendanceDownload.tsx","../../src/utils/leave/calcAnnualLeaveWorkdays.ts","../../src/components/employee/AnnualLeaveUsageDownload.tsx","../../src/utils/exceljs/generateAnnualLeaveUsageExcel.ts","../../src/components/employee/EmployeeMain.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"circle\", { cx: \"9\", cy: \"12\", r: \"3\", key: \"u3jwor\" }],\n  [\"rect\", { width: \"20\", height: \"14\", x: \"2\", y: \"5\", rx: \"7\", key: \"g7kal2\" }]\n];\nconst ToggleLeft = createLucideIcon(\"toggle-left\", __iconNode);\n\nexport { __iconNode, ToggleLeft as default };\n//# sourceMappingURL=toggle-left.js.map\n","/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"circle\", { cx: \"15\", cy: \"12\", r: \"3\", key: \"1afu0r\" }],\n  [\"rect\", { width: \"20\", height: \"14\", x: \"2\", y: \"5\", rx: \"7\", key: \"g7kal2\" }]\n];\nconst ToggleRight = createLucideIcon(\"toggle-right\", __iconNode);\n\nexport { __iconNode, ToggleRight as default };\n//# sourceMappingURL=toggle-right.js.map\n","import { createClient } from \"@/lib/supabase/client\";\nimport { Employee, EmployeeFilters, EmployeeUpsertData, PurchaseRole } from \"@/types/purchase\";\nimport { logger } from \"@/lib/logger\";\n\nclass EmployeeService {\n  private supabase;\n\n  constructor() {\n    this.supabase = createClient();\n  }\n\n  //   \n  async getEmployees(filters?: EmployeeFilters): Promise<{ success: boolean; data?: Employee[]; error?: string }> {\n    try {\n      let query = this.supabase\n        .from('employees')\n        .select('*')\n        .order('name');\n\n      //   \n      if (filters?.search) {\n        query = query.or(`\n          name.ilike.%${filters.search}%,\n          email.ilike.%${filters.search}%,\n          phone.ilike.%${filters.search}%,\n          position.ilike.%${filters.search}%,\n          department.ilike.%${filters.search}%\n        `);\n      }\n\n      //   \n      if (filters?.department) {\n        query = query.eq('department', filters.department);\n      }\n\n      //   \n      if (filters?.position) {\n        query = query.eq('position', filters.position);\n      }\n\n      //   \n      if (filters?.purchase_role === 'none') {\n        query = query.is('purchase_role', null);\n      } else if (filters?.purchase_role) {\n        query = query.contains('purchase_role', [filters.purchase_role]);\n      }\n\n      //    \n      if (filters?.is_active !== undefined) {\n        query = query.eq('is_active', filters.is_active);\n      }\n\n      const { data, error } = await query;\n\n      if (error) throw error;\n\n      return { success: true, data: data || [] };\n    } catch (error) {\n      logger.error('   ', error);\n      return { \n        success: false, \n        error: error instanceof Error ? error.message : '    .' \n      };\n    }\n  }\n\n  //   \n  async getEmployee(id: string): Promise<{ success: boolean; data?: Employee; error?: string }> {\n    try {\n      const { data, error } = await this.supabase\n        .from('employees')\n        .select('*')\n        .eq('id', id)\n        .single();\n\n      if (error) throw error;\n\n      return { success: true, data };\n    } catch (error) {\n      logger.error('  ', error);\n      return { \n        success: false, \n        error: error instanceof Error ? error.message : '    .' \n      };\n    }\n  }\n\n  //  \n  async createEmployee(employeeData: EmployeeUpsertData): Promise<{ success: boolean; data?: Employee; error?: string }> {\n    try {\n      //   \n      const { data: existingEmployee } = await this.supabase\n        .from('employees')\n        .select('id')\n        .eq('email', employeeData.email)\n        .single();\n\n      if (existingEmployee) {\n        return { success: false, error: '  .' };\n      }\n\n      // ID  (UUID )\n      const employeeId = crypto.randomUUID();\n      const isActive = employeeData.is_active ?? true\n\n      const { data, error } = await this.supabase\n        .from('employees')\n        .insert({\n          id: employeeId,\n          ...employeeData,\n          purchase_role: employeeData.purchase_role && employeeData.purchase_role.length > 0 ? employeeData.purchase_role : null,\n          is_active: isActive,\n          terminated_at: isActive ? null : new Date().toISOString()\n        })\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      return { success: true, data };\n    } catch (error) {\n      logger.error('  ', error);\n      const msg =\n        error instanceof Error\n          ? error.message\n          : typeof error === 'object' && error && 'message' in (error as any)\n            ? String((error as any).message)\n            : '    .'\n      return { \n        success: false, \n        error: msg \n      };\n    }\n  }\n\n  //  \n  async updateEmployee(id: string, employeeData: Partial<EmployeeUpsertData>): Promise<{ success: boolean; data?: Employee; error?: string }> {\n    try {\n      //    ( )\n      if (employeeData.email) {\n        const { data: existingEmployee } = await this.supabase\n          .from('employees')\n          .select('id')\n          .eq('email', employeeData.email)\n          .neq('id', id)\n          .single();\n\n        if (existingEmployee) {\n          return { success: false, error: '  .' };\n        }\n      }\n\n      const updateData: Record<string, any> = {\n        ...employeeData\n      };\n\n      if (employeeData.purchase_role === undefined) {\n        delete updateData.purchase_role;\n      } else {\n        updateData.purchase_role = employeeData.purchase_role.length > 0 ? employeeData.purchase_role : null;\n      }\n\n      // is_active    terminated_at  \n      if (employeeData.is_active !== undefined && employeeData.is_active !== null) {\n        updateData.terminated_at = employeeData.is_active ? null : new Date().toISOString()\n      }\n      \n      const { data, error } = await this.supabase\n        .from('employees')\n        .update(updateData)\n        .eq('id', id)\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      return { success: true, data };\n    } catch (error) {\n      logger.error('  ', error);\n      const msg =\n        error instanceof Error\n          ? error.message\n          : typeof error === 'object' && error && 'message' in (error as any)\n            ? String((error as any).message)\n            : '    .'\n      return { \n        success: false, \n        error: msg \n      };\n    }\n  }\n\n  //   ( )\n  async deleteEmployee(id: string): Promise<{ success: boolean; error?: string }> {\n    try {\n      //     \n      const { data: purchaseRequests } = await this.supabase\n        .from('purchase_requests')\n        .select('id')\n        .eq('requester_id', id)\n        .limit(1);\n\n      if (purchaseRequests && purchaseRequests.length > 0) {\n        //      \n        const { error } = await this.supabase\n          .from('employees')\n          .update({ \n            is_active: false,\n            terminated_at: new Date().toISOString()\n          })\n          .eq('id', id);\n\n        if (error) throw error;\n\n        return { success: true };\n      } else {\n        //     \n        const { error } = await this.supabase\n          .from('employees')\n          .delete()\n          .eq('id', id);\n\n        if (error) throw error;\n\n        return { success: true };\n      }\n    } catch (error) {\n      logger.error('  ', error);\n      return { \n        success: false, \n        error: error instanceof Error ? error.message : '    .' \n      };\n    }\n  }\n\n  //  / \n  async toggleEmployeeStatus(id: string): Promise<{ success: boolean; data?: Employee; error?: string }> {\n    try {\n      //   \n      const { data: currentEmployee, error: selectError } = await this.supabase\n        .from('employees')\n        .select('is_active')\n        .eq('id', id)\n        .single();\n\n      if (selectError) throw selectError;\n\n      //  \n      const nextIsActive = !currentEmployee.is_active\n      const { data, error } = await this.supabase\n        .from('employees')\n        .update({ \n          is_active: nextIsActive,\n          terminated_at: nextIsActive ? null : new Date().toISOString()\n        })\n        .eq('id', id)\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      return { success: true, data };\n    } catch (error) {\n      logger.error('   ', error);\n      return { \n        success: false, \n        error: error instanceof Error ? error.message : '    .' \n      };\n    }\n  }\n\n\n\n  //  \n  async updateEmployeeRole(id: string, role: PurchaseRole | null): Promise<{ success: boolean; data?: Employee; error?: string }> {\n    try {\n      const { data, error } = await this.supabase\n        .from('employees')\n        .update({ purchase_role: role ? [role] : null })\n        .eq('id', id)\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      return { success: true, data };\n    } catch (error) {\n      logger.error('   ', error);\n      return { \n        success: false, \n        error: error instanceof Error ? error.message : '    .' \n      };\n    }\n  }\n\n  //   \n  async getDepartments(): Promise<{ success: boolean; data?: string[]; error?: string }> {\n    try {\n      const { data, error } = await this.supabase\n        .from('employees')\n        .select('department');\n\n      if (error) throw error;\n\n      //   null       \n      const departments = [...new Set((data || [])\n        .map((emp: any) => emp.department)\n        .filter((dept: any) => dept != null && dept !== '')\n      )].sort() as string[];\n\n      return { success: true, data: departments };\n    } catch (error) {\n      logger.error('   ', error);\n      return { \n        success: false, \n        error: error instanceof Error ? error.message : '    .' \n      };\n    }\n  }\n\n  //   \n  async getPositions(): Promise<{ success: boolean; data?: string[]; error?: string }> {\n    try {\n      const { data, error } = await this.supabase\n        .from('employees')\n        .select('position');\n\n      if (error) throw error;\n\n      //   null       \n      const positions = [...new Set((data || [])\n        .map((emp: any) => emp.position)\n        .filter((pos: any) => pos != null && pos !== '')\n      )].sort() as string[];\n\n      return { success: true, data: positions };\n    } catch (error) {\n      logger.error('   ', error);\n      return { \n        success: false, \n        error: error instanceof Error ? error.message : '    .' \n      };\n    }\n  }\n\n  // Excel   \n  async getEmployeesForExport(): Promise<{ success: boolean; data?: Array<Record<string, string>>; error?: string }> {\n    try {\n      const { data, error } = await this.supabase\n        .from('employees')\n        .select('*')\n        .order('name');\n\n      if (error) throw error;\n\n      // Excel    \n      const exportData = (data || []).map((employee: any) => ({\n        '': employee.name,\n        '': employee.email || '',\n        '': employee.phone || '',\n        '': employee.adress || '',\n        '': employee.department || '',\n        '': employee.position || '',\n        '': this.getRoleDisplayName(employee.purchase_role),\n        '': employee.is_active ? '' : '',\n        '': employee.created_at ? new Date(employee.created_at).toLocaleDateString('ko-KR') : ''\n      }));\n\n      return { success: true, data: exportData };\n    } catch (error) {\n      logger.error(' Excel  ', error);\n      return { \n        success: false, \n        error: error instanceof Error ? error.message : '    .' \n      };\n    }\n  }\n\n  //   \n  private getRoleDisplayName(role?: string | string[] | null): string {\n    const roleNames: Record<string, string> = {\n      'app_admin': ' ',\n      'hr': 'HR',\n      'accounting': '',\n      'ceo': 'CEO',\n      'final_approver': ' ',\n      'middle_manager': ' ',\n      'lead buyer': ' ',\n      'buyer': ''\n    };\n    \n    const roles = this.normalizeRoles(role)\n    if (roles.length === 0) {\n      return ' '\n    }\n\n    return roles.map((value) => roleNames[value] || value).join(', ')\n  }\n\n  private normalizeRoles(role?: string | string[] | null): string[] {\n    if (!role) return []\n\n    if (Array.isArray(role)) {\n      return role.filter((value) => value && value.trim())\n    }\n\n    if (typeof role === 'string') {\n      return role.split(',').map((value) => value.trim()).filter(Boolean)\n    }\n\n    return []\n  }\n\n  //   \n  async checkPermission(userId: string, requiredRoles: string[]): Promise<{ success: boolean; hasPermission?: boolean; error?: string }> {\n    try {\n      const { data: employee } = await this.supabase\n        .from('employees')\n        .select('purchase_role, is_active')\n        .eq('id', userId)\n        .single();\n\n      if (!employee || !employee.is_active) {\n        return { success: true, hasPermission: false };\n      }\n\n      const roles = this.normalizeRoles(employee.purchase_role)\n      const hasPermission = roles.some((role) => requiredRoles.includes(role));\n      return { success: true, hasPermission };\n    } catch (error) {\n      return { \n        success: false, \n        error: error instanceof Error ? error.message : '    .' \n      };\n    }\n  }\n}\n\nexport const employeeService = new EmployeeService();","\nimport { useState, useEffect } from 'react'\nimport { EmployeeFilters as EmployeeFiltersType, PurchaseRole } from '@/types/purchase'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select'\nimport { Search, X, Download, Plus, Calendar } from 'lucide-react'\nimport { employeeService } from '@/services/employeeService'\n\ninterface EmployeeFiltersProps {\n  filters: EmployeeFiltersType\n  onFiltersChange: (filters: EmployeeFiltersType) => void\n  onExport: () => void\n  onCreateNew: () => void\n  onAttendanceDownload: () => void\n  onAnnualLeaveUsageDownload: () => void\n  canManageEmployees?: boolean\n}\n\nconst PURCHASE_ROLES: { value: PurchaseRole; label: string }[] = [\n  { value: 'app_admin', label: ' ' },\n  { value: 'ceo', label: 'CEO' },\n  { value: 'final_approver', label: ' ' },\n  { value: 'middle_manager', label: ' ' },\n  { value: 'lead buyer', label: ' ' },\n  { value: 'buyer', label: '' },\n]\n\nexport default function EmployeeFilters({ \n  filters, \n  onFiltersChange, \n  onExport,\n  onCreateNew,\n  onAttendanceDownload,\n  onAnnualLeaveUsageDownload\n  ,\n  canManageEmployees = false\n}: EmployeeFiltersProps) {\n  const [localSearch, setLocalSearch] = useState(filters.search || '')\n  const [departments, setDepartments] = useState<string[]>([])\n  const [positions, setPositions] = useState<string[]>([])\n\n  useEffect(() => {\n    //    \n    const loadOptions = async () => {\n      const [deptResult, posResult] = await Promise.all([\n        employeeService.getDepartments(),\n        employeeService.getPositions()\n      ])\n      \n      if (deptResult.success) {\n        setDepartments(deptResult.data || [])\n      }\n      \n      if (posResult.success) {\n        setPositions(posResult.data || [])\n      }\n    }\n    \n    loadOptions()\n  }, [])\n\n  useEffect(() => {\n    setLocalSearch(filters.search || '')\n  }, [filters.search])\n\n  useEffect(() => {\n    const timeoutId = setTimeout(() => {\n      const nextSearch = localSearch.trim()\n      if (nextSearch === (filters.search || '')) {\n        return\n      }\n      onFiltersChange({\n        ...filters,\n        search: nextSearch || undefined\n      })\n    }, 300)\n\n    return () => clearTimeout(timeoutId)\n  }, [localSearch, filters, onFiltersChange])\n\n  const handleDepartmentChange = (value: string) => {\n    onFiltersChange({\n      ...filters,\n      department: value === 'all' ? undefined : value\n    })\n  }\n\n  const handlePositionChange = (value: string) => {\n    onFiltersChange({\n      ...filters,\n      position: value === 'all' ? undefined : value\n    })\n  }\n\n  const handleRoleChange = (value: string) => {\n    onFiltersChange({\n      ...filters,\n      purchase_role: value === 'all' ? undefined : value\n    })\n  }\n\n  const handleStatusChange = (value: string) => {\n    onFiltersChange({\n      ...filters,\n      is_active: value === 'all' ? undefined : value === 'active'\n    })\n  }\n\n  const clearFilters = () => {\n    setLocalSearch('')\n    onFiltersChange({})\n  }\n\n  const hasFilters = filters.search || \n                     filters.department || \n                     filters.position || \n                     filters.purchase_role || \n                     filters.is_active !== undefined\n\n  return (\n    <div className=\"space-y-4\">\n      {/*    */}\n      <div className=\"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4\">\n        <div>\n          <h2 className=\"page-title\"> </h2>\n          <p className=\"page-subtitle\" style={{marginTop:'-2px',marginBottom:'-4px'}}>Employee Management</p>\n        </div>\n        {canManageEmployees && (\n        <div className=\"flex flex-wrap gap-2\">\n          <Button\n            onClick={onAnnualLeaveUsageDownload}\n            className=\"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 flex items-center gap-1\"\n          >\n            <Calendar className=\"w-4 h-4\" />\n            <span className=\"hidden sm:inline\"></span>\n            <span className=\"sm:hidden\"></span>\n          </Button>\n          <Button\n            onClick={onAttendanceDownload}\n            className=\"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 flex items-center gap-1\"\n          >\n            <Calendar className=\"w-4 h-4\" />\n            <span className=\"hidden sm:inline\"></span>\n            <span className=\"sm:hidden\"></span>\n          </Button>\n          <Button\n            onClick={onExport}\n            className=\"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 flex items-center gap-1\"\n          >\n            <Download className=\"w-4 h-4\" />\n            <span className=\"hidden sm:inline\">Excel </span>\n            <span className=\"sm:hidden\">Excel</span>\n          </Button>\n          <Button \n            onClick={onCreateNew}\n            className=\"button-base bg-blue-500 hover:bg-blue-600 text-white flex items-center gap-1\"\n          >\n            <Plus className=\"w-4 h-4\" />\n             \n          </Button>\n        </div>\n        )}\n      </div>\n\n      {/*   */}\n      <div className=\"flex flex-wrap items-center gap-2\">\n        {/*  */}\n        <div className=\"relative min-w-[180px] flex-1 max-w-[260px]\">\n          <Search className=\"absolute left-1.5 top-1/2 -translate-y-1/2 w-2.5 h-2.5 text-gray-400\" />\n          <Input\n            type=\"text\"\n            placeholder=\", ,  \"\n            value={localSearch}\n            onChange={(e) => setLocalSearch(e.target.value)}\n            className=\"!h-auto !py-px !pr-1.5 !pl-5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700\"\n          />\n        </div>\n\n        {/*   */}\n        <div className=\"min-w-[120px]\">\n          <Select\n            value={filters.department || 'all'}\n            onValueChange={handleDepartmentChange}\n          >\n            <SelectTrigger className=\"!h-auto !min-h-[20px] !py-px !px-2 !text-[11px] business-radius-input border border-gray-300 bg-white text-gray-700\">\n              <SelectValue placeholder=\"\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\"> </SelectItem>\n              {departments.map((dept) => (\n                <SelectItem key={dept} value={dept}>\n                  {dept}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n\n        {/*   */}\n        <div className=\"min-w-[120px]\">\n          <Select\n            value={filters.position || 'all'}\n            onValueChange={handlePositionChange}\n          >\n            <SelectTrigger className=\"!h-auto !min-h-[20px] !py-px !px-2 !text-[11px] business-radius-input border border-gray-300 bg-white text-gray-700\">\n              <SelectValue placeholder=\"\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\"> </SelectItem>\n              {positions.map((pos) => (\n                <SelectItem key={pos} value={pos}>\n                  {pos}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n\n        {/*   */}\n        <div className=\"min-w-[140px]\">\n          <Select\n            value={filters.purchase_role || 'all'}\n            onValueChange={handleRoleChange}\n          >\n            <SelectTrigger className=\"!h-auto !min-h-[20px] !py-px !px-2 !text-[11px] business-radius-input border border-gray-300 bg-white text-gray-700\">\n              <SelectValue placeholder=\"\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\"> </SelectItem>\n              <SelectItem value=\"none\"> </SelectItem>\n              {PURCHASE_ROLES.map((role) => (\n                <SelectItem key={role.value} value={role.value}>\n                  {role.label}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n\n        {/*   */}\n        <div className=\"min-w-[100px]\">\n          <Select\n            value={\n              filters.is_active === undefined \n                ? 'all' \n                : filters.is_active \n                  ? 'active' \n                  : 'inactive'\n            }\n            onValueChange={handleStatusChange}\n          >\n            <SelectTrigger className=\"!h-auto !min-h-[20px] !py-px !px-2 !text-[11px] business-radius-input border border-gray-300 bg-white text-gray-700\">\n              <SelectValue placeholder=\"\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\"></SelectItem>\n              <SelectItem value=\"active\"></SelectItem>\n              <SelectItem value=\"inactive\"></SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n\n        {/*   */}\n        {hasFilters && (\n          <Button \n            type=\"button\" \n            onClick={clearFilters}\n            className=\"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 flex items-center gap-1\"\n          >\n            <X className=\"w-4 h-4\" />\n            <span className=\"hidden sm:inline\"></span>\n            <span className=\"sm:hidden\"></span>\n          </Button>\n        )}\n      </div>\n    </div>\n  )\n}","\nimport { useEffect, useMemo, useState } from 'react'\nimport { Employee, PurchaseRole } from '@/types/purchase'\nimport { formatDate } from '@/utils/helpers'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select'\nimport { \n  Table, \n  TableBody, \n  TableCell, \n  TableHead, \n  TableHeader, \n  TableRow \n} from '@/components/ui/table'\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu'\nimport { \n  MoreHorizontal, \n  Edit, \n  Trash2, \n  Save,\n  X,\n  ToggleLeft, \n  ToggleRight,\n} from 'lucide-react'\nimport { employeeService } from '@/services/employeeService'\nimport { toast } from 'sonner'\nimport { useTableSort } from '@/hooks/useTableSort'\nimport { SortableHeader } from '@/components/ui/sortable-header'\nimport { MobileCard, MobileCardItem, MobileCardHeader, MobileCardActions } from '@/components/ui/mobile-card'\n\ninterface EmployeeTableProps {\n  employees: Employee[]\n  onRefresh: () => void\n  currentUserRoles?: string[]\n  createRequestToken?: number\n}\n\ntype EmployeeDraft = {\n  employeeID: string\n  name: string\n  position: string\n  department: string\n  phone: string\n  email: string\n  personal_email: string\n  annual_leave_granted_current_year: string\n  used_annual_leave: string\n  remaining_annual_leave: string\n  join_date: string\n  birthday: string\n  bank_account: string\n  adress: string\n  purchase_role: string\n  is_active: 'true' | 'false'\n}\n\nconst NEW_ROW_ID = '__new_employee__'\n\nconst PURCHASE_ROLES: { value: PurchaseRole; label: string }[] = [\n  { value: 'app_admin', label: ' ' },\n  { value: 'hr', label: 'HR' },\n  { value: 'accounting', label: '' },\n  { value: 'ceo', label: 'CEO' },\n  { value: 'final_approver', label: ' ' },\n  { value: 'middle_manager', label: ' ' },\n  { value: 'lead buyer', label: ' ' },\n  { value: 'buyer', label: '' },\n]\n\nconst toInputDate = (value?: string | null) => {\n  if (!value) return ''\n  // ISO  YYYY-MM-DD \n  return value.includes('T') ? value.slice(0, 10) : value\n}\n\nconst defaultDraft = (): EmployeeDraft => ({\n  employeeID: '',\n  name: '',\n  position: '',\n  department: '',\n  phone: '',\n  email: '',\n  personal_email: '',\n  annual_leave_granted_current_year: '',\n  used_annual_leave: '',\n  remaining_annual_leave: '',\n  join_date: '',\n  birthday: '',\n  bank_account: '',\n  adress: '',\n  purchase_role: '',\n  is_active: 'true',\n})\n\nexport default function EmployeeTable({\n  employees,\n  onRefresh,\n  currentUserRoles = [],\n  createRequestToken = 0,\n}: EmployeeTableProps) {\n  const [loadingId, setLoadingId] = useState<string | null>(null)\n  const { sortedData, sortConfig, handleSort } = useTableSort(employees, 'name', 'asc')\n  const canManageEmployees = currentUserRoles.includes('app_admin') || currentUserRoles.includes('hr')\n  const [editingRowId, setEditingRowId] = useState<string | null>(null)\n  const [isCreating, setIsCreating] = useState(false)\n  const [draft, setDraft] = useState<EmployeeDraft | null>(null)\n  const [availableEmployeeColumns, setAvailableEmployeeColumns] = useState<Set<string> | null>(null)\n\n  const handleToggleStatus = async (employee: Employee) => {\n    if (!canManageEmployees) {\n      toast.error('   .')\n      return\n    }\n    setLoadingId(employee.id)\n    try {\n      const result = await employeeService.toggleEmployeeStatus(employee.id)\n      \n      if (result.success) {\n        toast.success(` ${employee.is_active ? '' : ''}.`)\n        onRefresh()\n      } else {\n        toast.error(result.error || '  .')\n      }\n    } catch (error) {\n      toast.error('    .')\n    } finally {\n      setLoadingId(null)\n    }\n  }\n\n  const handleDelete = async (employee: Employee) => {\n    if (!canManageEmployees) {\n      toast.error('  .')\n      return\n    }\n    if (!confirm(` '${employee.name}'  ?`)) {\n      return\n    }\n\n    setLoadingId(employee.id)\n    try {\n      const result = await employeeService.deleteEmployee(employee.id)\n      \n      if (result.success) {\n        toast.success(' .')\n        onRefresh()\n      } else {\n        toast.error(result.error || ' .')\n      }\n    } catch (error) {\n      toast.error('   .')\n    } finally {\n      setLoadingId(null)\n    }\n  }\n\n  const normalizeRoles = (role?: string | string[] | null) => {\n    if (!role) return []\n    if (Array.isArray(role)) {\n      return role.filter((value) => value && value.trim())\n    }\n    if (typeof role === 'string') {\n      return role.split(',').map((value) => value.trim()).filter(Boolean)\n    }\n    return []\n  }\n\n  const getPrimaryRole = (role?: string | string[] | null) => {\n    const roles = normalizeRoles(role)\n    return roles[0]\n  }\n\n  const getRoleDisplayName = (role?: string | string[] | null) => {\n    const roleNames: Record<string, string> = {\n      'app_admin': ' ',\n      'hr': 'HR',\n      'accounting': '',\n      'ceo': 'CEO',\n      'final_approver': ' ',\n      'middle_manager': ' ',\n      'lead buyer': ' ',\n      'buyer': ''\n    }\n    \n    const primaryRole = getPrimaryRole(role)\n    if (!primaryRole) {\n      return ' '\n    }\n    return roleNames[primaryRole] || primaryRole\n  }\n\n  const getRoleBadgeColor = (role?: string | string[] | null) => {\n    const colorMap: Record<string, string> = {\n      'app_admin': 'bg-purple-100 text-purple-800',\n      'hr': 'bg-blue-100 text-blue-800',\n      'accounting': 'bg-sky-100 text-sky-800',\n      'ceo': 'bg-red-100 text-red-800',\n      'final_approver': 'bg-hansl-100 text-hansl-800',\n      'middle_manager': 'bg-green-100 text-green-800',\n      'lead buyer': 'bg-yellow-100 text-yellow-800',\n      'buyer': 'bg-gray-100 text-gray-800'\n    }\n    \n    const primaryRole = getPrimaryRole(role)\n    return colorMap[primaryRole || ''] || 'bg-gray-100 text-gray-600'\n  }\n\n  const startCreate = () => {\n    if (!canManageEmployees) {\n      toast.error('   .')\n      return\n    }\n    //         payload \n    const sample = employees[0]\n    if (sample) {\n      setAvailableEmployeeColumns(new Set(Object.keys(sample)))\n    }\n    setIsCreating(true)\n    setEditingRowId(NEW_ROW_ID)\n    setDraft(defaultDraft())\n  }\n\n  useEffect(() => {\n    if (!createRequestToken) return\n    startCreate()\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [createRequestToken])\n\n  const startEdit = (employee: Employee) => {\n    if (!canManageEmployees) {\n      toast.error('   .')\n      return\n    }\n\n    const primaryRole = getPrimaryRole(employee.purchase_role) || ''\n    setIsCreating(false)\n    setEditingRowId(employee.id)\n    setAvailableEmployeeColumns(new Set(Object.keys(employee || {})))\n    setDraft({\n      employeeID: employee.employeeID || employee.employee_number || '',\n      name: employee.name || '',\n      position: employee.position || '',\n      department: employee.department || '',\n      phone: employee.phone || '',\n      email: employee.email || '',\n      personal_email: employee.personal_email || '',\n      annual_leave_granted_current_year:\n        employee.annual_leave_granted_current_year === undefined || employee.annual_leave_granted_current_year === null\n          ? ''\n          : String(employee.annual_leave_granted_current_year),\n      used_annual_leave:\n        employee.used_annual_leave === undefined || employee.used_annual_leave === null ? '' : String(employee.used_annual_leave),\n      remaining_annual_leave:\n        employee.remaining_annual_leave === undefined || employee.remaining_annual_leave === null\n          ? ''\n          : String(employee.remaining_annual_leave),\n      join_date: toInputDate(employee.join_date),\n      birthday: toInputDate(employee.birthday),\n      bank_account: employee.bank_account || '',\n      adress: employee.adress || '',\n      purchase_role: primaryRole,\n      is_active: employee.is_active ? 'true' : 'false',\n    })\n  }\n\n  const cancelEdit = () => {\n    setEditingRowId(null)\n    setIsCreating(false)\n    setDraft(null)\n  }\n\n  const toNullableTrimmed = (value: string) => {\n    const trimmed = value.trim()\n    return trimmed === '' ? null : trimmed\n  }\n\n  const toNullableNumber = (value: string) => {\n    const trimmed = value.trim()\n    if (trimmed === '') return null\n    const numberValue = Number(trimmed)\n    return Number.isFinite(numberValue) ? numberValue : null\n  }\n\n  const handleSave = async () => {\n    if (!canManageEmployees) {\n      toast.error('   .')\n      return\n    }\n    if (!draft || !editingRowId) return\n\n    const name = draft.name.trim()\n    const email = draft.email.trim()\n    if (!name) {\n      toast.error(' .')\n      return\n    }\n    if (!email) {\n      toast.error(' .')\n      return\n    }\n\n    const rawPayload: any = {\n      //  1  ,     \n      employeeID: toNullableTrimmed(draft.employeeID),\n      employee_number: toNullableTrimmed(draft.employeeID),\n      name,\n      position: toNullableTrimmed(draft.position),\n      department: toNullableTrimmed(draft.department),\n      phone: toNullableTrimmed(draft.phone),\n      email,\n      personal_email: toNullableTrimmed(draft.personal_email),\n      annual_leave_granted_current_year: toNullableNumber(draft.annual_leave_granted_current_year),\n      used_annual_leave: toNullableNumber(draft.used_annual_leave),\n      remaining_annual_leave: toNullableNumber(draft.remaining_annual_leave),\n      join_date: toNullableTrimmed(draft.join_date),\n      birthday: toNullableTrimmed(draft.birthday),\n      bank_account: toNullableTrimmed(draft.bank_account),\n      adress: toNullableTrimmed(draft.adress),\n      purchase_role: draft.purchase_role ? [draft.purchase_role] : [],\n      is_active: draft.is_active === 'true',\n    }\n\n    const allowedColumns =\n      availableEmployeeColumns ?? (employees[0] ? new Set(Object.keys(employees[0])) : null)\n    const payload =\n      allowedColumns === null\n        ? rawPayload\n        : Object.fromEntries(Object.entries(rawPayload).filter(([key]) => allowedColumns.has(key)))\n\n    setLoadingId(editingRowId)\n    try {\n      const result =\n        editingRowId === NEW_ROW_ID\n          ? await employeeService.createEmployee(payload)\n          : await employeeService.updateEmployee(editingRowId, payload)\n\n      if (result.success) {\n        toast.success(editingRowId === NEW_ROW_ID ? ' .' : '  .')\n        cancelEdit()\n        onRefresh()\n      } else {\n        toast.error(result.error || ' .')\n      }\n    } catch (error) {\n      toast.error('   .')\n    } finally {\n      setLoadingId(null)\n    }\n  }\n\n  const updateDraft = <K extends keyof EmployeeDraft>(key: K, value: EmployeeDraft[K]) => {\n    setDraft((prev) => {\n      if (!prev) return prev\n      return { ...prev, [key]: value }\n    })\n  }\n\n  const displayRows: Employee[] = useMemo(() => {\n    if (!isCreating || editingRowId !== NEW_ROW_ID) return sortedData\n\n    const pseudo: Employee = {\n      id: NEW_ROW_ID,\n      employeeID: draft?.employeeID || '',\n      employee_number: draft?.employeeID || '',\n      name: draft?.name || '',\n      email: draft?.email || '',\n      personal_email: draft?.personal_email || '',\n      department: draft?.department || '',\n      position: draft?.position || '',\n      phone: draft?.phone || '',\n      purchase_role: draft?.purchase_role ? [draft.purchase_role] : null,\n      is_active: draft?.is_active === 'true',\n      terminated_at: null,\n      created_at: new Date().toISOString(),\n      updated_at: new Date().toISOString(),\n      bank_account: draft?.bank_account || '',\n      adress: draft?.adress || '',\n      join_date: draft?.join_date || '',\n      birthday: draft?.birthday || '',\n      annual_leave_granted_current_year: draft?.annual_leave_granted_current_year ? Number(draft.annual_leave_granted_current_year) : 0,\n      used_annual_leave: draft?.used_annual_leave ? Number(draft.used_annual_leave) : 0,\n      remaining_annual_leave: draft?.remaining_annual_leave ? Number(draft.remaining_annual_leave) : 0,\n    }\n\n    return [pseudo, ...sortedData]\n  }, [draft, editingRowId, isCreating, sortedData])\n\n  const isEditingRow = (employeeId: string) => canManageEmployees && editingRowId === employeeId && !!draft\n\n  return (\n    <>\n      {/* Table View (md+) */}\n      <div className=\"hidden md:block border rounded-lg overflow-hidden\">\n        <div className=\"overflow-x-auto\">\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead className=\"w-16 min-w-[50px]\">\n              <SortableHeader\n                sortKey=\"employeeID\"\n                currentSortKey={sortConfig.key as string | null}\n                sortDirection={sortConfig.direction}\n                onSort={() => handleSort('employeeID' as keyof Employee)}\n              >\n                \n              </SortableHeader>\n            </TableHead>\n            <TableHead className=\"w-14 min-w-[45px]\">\n              <SortableHeader\n                sortKey=\"name\"\n                currentSortKey={sortConfig.key as string | null}\n                sortDirection={sortConfig.direction}\n                onSort={() => handleSort('name' as keyof Employee)}\n              >\n                \n              </SortableHeader>\n            </TableHead>\n            <TableHead className=\"w-12 min-w-[40px]\">\n              <SortableHeader\n                sortKey=\"position\"\n                currentSortKey={sortConfig.key as string | null}\n                sortDirection={sortConfig.direction}\n                onSort={() => handleSort('position' as keyof Employee)}\n              >\n                \n              </SortableHeader>\n            </TableHead>\n            <TableHead className=\"w-16 min-w-[50px]\">\n              <SortableHeader\n                sortKey=\"department\"\n                currentSortKey={sortConfig.key as string | null}\n                sortDirection={sortConfig.direction}\n                onSort={() => handleSort('department' as keyof Employee)}\n              >\n                \n              </SortableHeader>\n            </TableHead>\n            <TableHead className=\"w-20 min-w-[70px]\">\n              <SortableHeader\n                sortKey=\"phone\"\n                currentSortKey={sortConfig.key as string | null}\n                sortDirection={sortConfig.direction}\n                onSort={() => handleSort('phone' as keyof Employee)}\n              >\n                \n              </SortableHeader>\n            </TableHead>\n            <TableHead className=\"w-32 min-w-[100px]\">\n              <SortableHeader\n                sortKey=\"email\"\n                currentSortKey={sortConfig.key as string | null}\n                sortDirection={sortConfig.direction}\n                onSort={() => handleSort('email' as keyof Employee)}\n              >\n                 \n              </SortableHeader>\n            </TableHead>\n            {canManageEmployees && (\n              <TableHead className=\"w-40 min-w-[140px]\"> </TableHead>\n            )}\n            {canManageEmployees && (\n              <>\n                {/*   */}\n                <TableHead className=\"w-11 min-w-[40px] text-center\"></TableHead>\n                <TableHead className=\"w-11 min-w-[40px] text-center\"></TableHead>\n                <TableHead className=\"w-11 min-w-[40px] text-center\"></TableHead>\n                <TableHead className=\"w-18 min-w-[60px]\">\n                  <SortableHeader\n                    sortKey=\"join_date\"\n                    currentSortKey={sortConfig.key as string | null}\n                    sortDirection={sortConfig.direction}\n                    onSort={() => handleSort('join_date' as keyof Employee)}\n                  >\n                    \n                  </SortableHeader>\n                </TableHead>\n                <TableHead className=\"w-20 min-w-[70px]\">\n                  <SortableHeader\n                    sortKey=\"birthday\"\n                    currentSortKey={sortConfig.key as string | null}\n                    sortDirection={sortConfig.direction}\n                    onSort={() => handleSort('birthday' as keyof Employee)}\n                  >\n                    \n                  </SortableHeader>\n                </TableHead>\n                {/*   */}\n                <TableHead className=\"w-24 min-w-[80px]\"></TableHead>\n                <TableHead className=\"min-w-[120px]\"></TableHead>\n                <TableHead>\n                  <SortableHeader\n                    sortKey=\"purchase_role\"\n                    currentSortKey={sortConfig.key as string | null}\n                    sortDirection={sortConfig.direction}\n                    onSort={() => handleSort('purchase_role' as keyof Employee)}\n                  >\n                    \n                  </SortableHeader>\n                </TableHead>\n                <TableHead>\n                  <SortableHeader\n                    sortKey=\"is_active\"\n                    currentSortKey={sortConfig.key as string | null}\n                    sortDirection={sortConfig.direction}\n                    onSort={() => handleSort('is_active' as keyof Employee)}\n                  >\n                    \n                  </SortableHeader>\n                </TableHead>\n                <TableHead className=\"w-16 min-w-[50px]\"></TableHead>\n              </>\n            )}\n              </TableRow>\n            </TableHeader>\n        <TableBody>\n          {displayRows.length === 0 ? (\n            <TableRow>\n              <TableCell colSpan={canManageEmployees ? 16 : 6} className=\"text-center py-8 text-gray-500\">\n                  .\n              </TableCell>\n            </TableRow>\n          ) : (\n            displayRows.map((employee) => (\n              <TableRow key={employee.id}>\n                <TableCell className=\"text-[11px] px-2 py-1.5\">\n                  {isEditingRow(employee.id) ? (\n                    <Input\n                      value={draft?.employeeID || ''}\n                      onChange={(e) => updateDraft('employeeID', e.target.value)}\n                      placeholder=\"\"\n                      className=\"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700\"\n                    />\n                  ) : (\n                    employee.employeeID || employee.employee_number || employee.id.slice(0, 8)\n                  )}\n                </TableCell>\n                <TableCell className=\"text-[11px] px-2 py-1.5\">\n                  {isEditingRow(employee.id) ? (\n                    <Input\n                      value={draft?.name || ''}\n                      onChange={(e) => updateDraft('name', e.target.value)}\n                      className=\"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700\"\n                    />\n                  ) : (\n                    employee.name\n                  )}\n                </TableCell>\n                <TableCell className=\"text-[11px] px-2 py-1.5\">\n                  {isEditingRow(employee.id) ? (\n                    <Input\n                      value={draft?.position || ''}\n                      onChange={(e) => updateDraft('position', e.target.value)}\n                      className=\"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700\"\n                    />\n                  ) : (\n                    employee.position || '-'\n                  )}\n                </TableCell>\n                <TableCell className=\"text-[11px] px-2 py-1.5\">\n                  {isEditingRow(employee.id) ? (\n                    <Input\n                      value={draft?.department || ''}\n                      onChange={(e) => updateDraft('department', e.target.value)}\n                      className=\"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700\"\n                    />\n                  ) : (\n                    employee.department || '-'\n                  )}\n                </TableCell>\n                <TableCell className=\"text-[11px] px-2 py-1.5\">\n                  {isEditingRow(employee.id) ? (\n                    <Input\n                      value={draft?.phone || ''}\n                      onChange={(e) => updateDraft('phone', e.target.value)}\n                      className=\"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700\"\n                    />\n                  ) : (\n                    employee.phone || '-'\n                  )}\n                </TableCell>\n                <TableCell className=\"text-[11px] px-2 py-1.5\">\n                  {isEditingRow(employee.id) ? (\n                    <Input\n                      value={draft?.email || ''}\n                      onChange={(e) => updateDraft('email', e.target.value)}\n                      className=\"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700\"\n                    />\n                  ) : (\n                    employee.email || '-'\n                  )}\n                </TableCell>\n                {canManageEmployees && (\n                  <TableCell className=\"px-2 py-1.5\">\n                    {isEditingRow(employee.id) ? (\n                      <Input\n                        value={draft?.personal_email || ''}\n                        onChange={(e) => updateDraft('personal_email', e.target.value)}\n                        placeholder=\"personal@example.com\"\n                        className=\"!h-auto !py-px !px-1 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700\"\n                      />\n                    ) : (\n                      employee.personal_email || '-'\n                    )}\n                  </TableCell>\n                )}\n                {canManageEmployees && (\n                  <>\n                    {/*   */}\n                    <TableCell className=\"text-center text-[11px] px-1 py-1.5\">\n                      {isEditingRow(employee.id) ? (\n                        <Input\n                          type=\"number\"\n                          value={draft?.annual_leave_granted_current_year || ''}\n                          onChange={(e) => updateDraft('annual_leave_granted_current_year', e.target.value)}\n                          className=\"!h-auto !py-px !px-1 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700 text-center\"\n                        />\n                      ) : (\n                        employee.annual_leave_granted_current_year || 0\n                      )}\n                    </TableCell>\n                    <TableCell className=\"text-center text-[11px] px-1 py-1.5\">\n                      {isEditingRow(employee.id) ? (\n                        <Input\n                          type=\"number\"\n                          value={draft?.used_annual_leave || ''}\n                          onChange={(e) => updateDraft('used_annual_leave', e.target.value)}\n                          className=\"!h-auto !py-px !px-1 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700 text-center\"\n                        />\n                      ) : (\n                        employee.used_annual_leave || 0\n                      )}\n                    </TableCell>\n                    <TableCell className=\"text-center text-[11px] px-1 py-1.5\">\n                      {isEditingRow(employee.id) ? (\n                        <Input\n                          type=\"number\"\n                          value={draft?.remaining_annual_leave || ''}\n                          onChange={(e) => updateDraft('remaining_annual_leave', e.target.value)}\n                          className=\"!h-auto !py-px !px-1 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700 text-center\"\n                        />\n                      ) : employee.remaining_annual_leave !== undefined ? (\n                        employee.remaining_annual_leave\n                      ) : (\n                        '-'\n                      )}\n                    </TableCell>\n                    <TableCell className=\"text-[11px] px-2 py-1.5\">\n                      {isEditingRow(employee.id) ? (\n                        <Input\n                          type=\"date\"\n                          value={draft?.join_date || ''}\n                          onChange={(e) => updateDraft('join_date', e.target.value)}\n                          className=\"!h-auto !py-px !px-1 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700\"\n                        />\n                      ) : (\n                        formatDate(employee.join_date)\n                      )}\n                    </TableCell>\n                    <TableCell className=\"text-[11px] px-2 py-1.5\">\n                      {isEditingRow(employee.id) ? (\n                        <Input\n                          type=\"date\"\n                          value={draft?.birthday || ''}\n                          onChange={(e) => updateDraft('birthday', e.target.value)}\n                          className=\"!h-auto !py-px !px-1 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700\"\n                        />\n                      ) : (\n                        formatDate(employee.birthday)\n                      )}\n                    </TableCell>\n                    {/*   */}\n                    <TableCell className=\"px-2 py-1.5\">\n                      {isEditingRow(employee.id) ? (\n                        <Input\n                          value={draft?.bank_account || ''}\n                          onChange={(e) => updateDraft('bank_account', e.target.value)}\n                          className=\"!h-auto !py-px !px-1 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700\"\n                        />\n                      ) : (\n                        employee.bank_account || '-'\n                      )}\n                    </TableCell>\n                    <TableCell className=\"px-1 py-1.5\">\n                      {isEditingRow(employee.id) ? (\n                        <Input\n                          value={draft?.adress || ''}\n                          onChange={(e) => updateDraft('adress', e.target.value)}\n                          className=\"!h-auto !py-px !px-1 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700\"\n                        />\n                      ) : (\n                        employee.adress || '-'\n                      )}\n                    </TableCell>\n                    <TableCell className=\"px-2 py-1.5\">\n                      {isEditingRow(employee.id) ? (\n                        <Select\n                          value={draft?.purchase_role || 'none'}\n                          onValueChange={(value) => updateDraft('purchase_role', value === 'none' ? '' : value)}\n                        >\n                          <SelectTrigger className=\"!h-auto !min-h-[20px] !py-px !px-2 !text-[11px] business-radius-input border border-gray-300 bg-white text-gray-700\">\n                            <SelectValue placeholder=\"\" />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"none\"> </SelectItem>\n                            {PURCHASE_ROLES.map((role) => (\n                              <SelectItem key={role.value} value={role.value}>\n                                {role.label}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      ) : (\n                        <span className={`badge-stats text-[10px] px-1.5 py-0.5 ${getRoleBadgeColor(employee.purchase_role)}`}>\n                          {getRoleDisplayName(employee.purchase_role)}\n                        </span>\n                      )}\n                    </TableCell>\n                    <TableCell className=\"px-2 py-1.5\">\n                      {isEditingRow(employee.id) ? (\n                        <Select\n                          value={draft?.is_active || 'true'}\n                          onValueChange={(value) => updateDraft('is_active', value as 'true' | 'false')}\n                        >\n                          <SelectTrigger className=\"!h-auto !min-h-[20px] !py-px !px-2 !text-[11px] business-radius-input border border-gray-300 bg-white text-gray-700\">\n                            <SelectValue placeholder=\"\" />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"true\"></SelectItem>\n                            <SelectItem value=\"false\"></SelectItem>\n                          </SelectContent>\n                        </Select>\n                      ) : (\n                        <span\n                          className={`badge-stats text-[10px] px-1.5 py-0.5 ${\n                            employee.is_active ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-600'\n                          }`}\n                        >\n                          {employee.is_active ? '' : ''}\n                        </span>\n                      )}\n                    </TableCell>\n                    <TableCell className=\"px-1 py-1.5\">\n                      {isEditingRow(employee.id) ? (\n                        <div className=\"flex gap-1\">\n                          <Button\n                            className=\"button-base bg-blue-500 hover:bg-blue-600 text-white flex items-center gap-1\"\n                            onClick={handleSave}\n                            disabled={loadingId === employee.id}\n                          >\n                            <Save className=\"w-4 h-4\" />\n                            \n                          </Button>\n                          <Button\n                            className=\"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 flex items-center gap-1\"\n                            onClick={cancelEdit}\n                            disabled={loadingId === employee.id}\n                          >\n                            <X className=\"w-4 h-4\" />\n                            \n                          </Button>\n                        </div>\n                      ) : (\n                        <DropdownMenu>\n                          <DropdownMenuTrigger asChild>\n                            <Button\n                              className=\"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50\"\n                              disabled={loadingId === employee.id}\n                            >\n                              <MoreHorizontal className=\"h-4 w-4\" />\n                            </Button>\n                          </DropdownMenuTrigger>\n                          <DropdownMenuContent align=\"end\">\n                            <DropdownMenuItem onClick={() => startEdit(employee)}>\n                              <Edit className=\"mr-2 h-4 w-4\" />\n                              \n                            </DropdownMenuItem>\n                            <DropdownMenuItem onClick={() => handleToggleStatus(employee)}>\n                              {employee.is_active ? (\n                                <>\n                                  <ToggleLeft className=\"mr-2 h-4 w-4\" />\n                                  \n                                </>\n                              ) : (\n                                <>\n                                  <ToggleRight className=\"mr-2 h-4 w-4\" />\n                                  \n                                </>\n                              )}\n                            </DropdownMenuItem>\n                            <DropdownMenuItem onClick={() => handleDelete(employee)} className=\"text-red-600\">\n                              <Trash2 className=\"mr-2 h-4 w-4\" />\n                              \n                            </DropdownMenuItem>\n                          </DropdownMenuContent>\n                        </DropdownMenu>\n                      )}\n                    </TableCell>\n                  </>\n                )}\n              </TableRow>\n            ))\n          )}\n        </TableBody>\n          </Table>\n        </div>\n      </div>\n\n      {/* Mobile Card View */}\n      <div className=\"block md:hidden space-y-3\">\n        {displayRows.length === 0 ? (\n          <div className=\"text-center py-8 text-gray-500\">\n              .\n          </div>\n        ) : (\n          displayRows.map((employee) => (\n            <MobileCard key={employee.id}>\n              <MobileCardHeader>\n                <div className=\"flex justify-between items-center\">\n                  <span>{employee.name}</span>\n                  {canManageEmployees && (\n                    <span\n                      className={`badge-stats ${employee.is_active ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-600'}`}\n                    >\n                      {employee.is_active ? '' : ''}\n                    </span>\n                  )}\n                </div>\n              </MobileCardHeader>\n              \n              <MobileCardItem\n                label=\"\"\n                value={\n                  isEditingRow(employee.id) ? (\n                    <Input\n                      value={draft?.employeeID || ''}\n                      onChange={(e) => updateDraft('employeeID', e.target.value)}\n                      placeholder=\"\"\n                      className=\"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700\"\n                    />\n                  ) : (\n                    employee.employeeID || employee.employee_number || employee.id.slice(0, 8)\n                  )\n                }\n              />\n              <MobileCardItem\n                label=\"\"\n                value={\n                  isEditingRow(employee.id) ? (\n                    <Input\n                      value={draft?.name || ''}\n                      onChange={(e) => updateDraft('name', e.target.value)}\n                      className=\"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700\"\n                    />\n                  ) : (\n                    employee.name\n                  )\n                }\n              />\n              <MobileCardItem\n                label=\"\"\n                value={\n                  isEditingRow(employee.id) ? (\n                    <Input\n                      value={draft?.position || ''}\n                      onChange={(e) => updateDraft('position', e.target.value)}\n                      className=\"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700\"\n                    />\n                  ) : (\n                    employee.position || '-'\n                  )\n                }\n              />\n              <MobileCardItem\n                label=\"\"\n                value={\n                  isEditingRow(employee.id) ? (\n                    <Input\n                      value={draft?.department || ''}\n                      onChange={(e) => updateDraft('department', e.target.value)}\n                      className=\"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700\"\n                    />\n                  ) : (\n                    employee.department || '-'\n                  )\n                }\n              />\n              <MobileCardItem\n                label=\"\"\n                value={\n                  isEditingRow(employee.id) ? (\n                    <Input\n                      value={draft?.phone || ''}\n                      onChange={(e) => updateDraft('phone', e.target.value)}\n                      className=\"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700\"\n                    />\n                  ) : (\n                    employee.phone || '-'\n                  )\n                }\n              />\n              <MobileCardItem\n                label=\" \"\n                value={\n                  isEditingRow(employee.id) ? (\n                    <Input\n                      value={draft?.email || ''}\n                      onChange={(e) => updateDraft('email', e.target.value)}\n                      className=\"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700\"\n                    />\n                  ) : (\n                    employee.email || '-'\n                  )\n                }\n              />\n              {canManageEmployees && (\n                <MobileCardItem\n                  label=\" \"\n                  value={\n                    isEditingRow(employee.id) ? (\n                      <Input\n                        value={draft?.personal_email || ''}\n                        onChange={(e) => updateDraft('personal_email', e.target.value)}\n                        placeholder=\"personal@example.com\"\n                        className=\"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700\"\n                      />\n                    ) : (\n                      employee.personal_email || '-'\n                    )\n                  }\n                />\n              )}\n              {canManageEmployees && (\n                <>\n                  <MobileCardItem\n                    label=\"\" \n                    value={\n                      isEditingRow(employee.id) ? (\n                        <Select\n                          value={draft?.purchase_role || 'none'}\n                          onValueChange={(value) => updateDraft('purchase_role', value === 'none' ? '' : value)}\n                        >\n                          <SelectTrigger className=\"!h-auto !min-h-[20px] !py-px !px-2 !text-[11px] business-radius-input border border-gray-300 bg-white text-gray-700\">\n                            <SelectValue placeholder=\"\" />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"none\"> </SelectItem>\n                            {PURCHASE_ROLES.map((role) => (\n                              <SelectItem key={role.value} value={role.value}>\n                                {role.label}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      ) : (\n                        <span className={`badge-stats ${getRoleBadgeColor(employee.purchase_role)}`}>\n                          {getRoleDisplayName(employee.purchase_role)}\n                        </span>\n                      )\n                    } \n                  />\n                  <MobileCardItem\n                    label=\"\"\n                    value={\n                      isEditingRow(employee.id) ? (\n                        <Select value={draft?.is_active || 'true'} onValueChange={(value) => updateDraft('is_active', value as 'true' | 'false')}>\n                          <SelectTrigger className=\"!h-auto !min-h-[20px] !py-px !px-2 !text-[11px] business-radius-input border border-gray-300 bg-white text-gray-700\">\n                            <SelectValue placeholder=\"\" />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"true\"></SelectItem>\n                            <SelectItem value=\"false\"></SelectItem>\n                          </SelectContent>\n                        </Select>\n                      ) : (\n                        employee.is_active ? '' : ''\n                      )\n                    }\n                  />\n                  <MobileCardItem\n                    label=\"\"\n                    value={\n                      isEditingRow(employee.id) ? (\n                        <Input\n                          type=\"date\"\n                          value={draft?.join_date || ''}\n                          onChange={(e) => updateDraft('join_date', e.target.value)}\n                          className=\"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700\"\n                        />\n                      ) : (\n                        formatDate(employee.join_date)\n                      )\n                    }\n                  />\n                  <MobileCardItem\n                    label=\"\"\n                    value={\n                      isEditingRow(employee.id) ? (\n                        <Input\n                          type=\"date\"\n                          value={draft?.birthday || ''}\n                          onChange={(e) => updateDraft('birthday', e.target.value)}\n                          className=\"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700\"\n                        />\n                      ) : (\n                        formatDate(employee.birthday)\n                      )\n                    }\n                  />\n                  <MobileCardItem\n                    label=\"\"\n                    value={\n                      isEditingRow(employee.id) ? (\n                        <Input\n                          value={draft?.bank_account || ''}\n                          onChange={(e) => updateDraft('bank_account', e.target.value)}\n                          className=\"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700\"\n                        />\n                      ) : (\n                        employee.bank_account || '-'\n                      )\n                    }\n                  />\n                  <MobileCardItem\n                    label=\"\"\n                    value={\n                      isEditingRow(employee.id) ? (\n                        <Input\n                          value={draft?.adress || ''}\n                          onChange={(e) => updateDraft('adress', e.target.value)}\n                          className=\"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700\"\n                        />\n                      ) : (\n                        employee.adress || '-'\n                      )\n                    }\n                  />\n                  <MobileCardItem \n                    label=\"(//)\" \n                    value={\n                      isEditingRow(employee.id) ? (\n                        <div className=\"grid grid-cols-3 gap-1\">\n                          <Input\n                            type=\"number\"\n                            value={draft?.annual_leave_granted_current_year || ''}\n                            onChange={(e) => updateDraft('annual_leave_granted_current_year', e.target.value)}\n                            placeholder=\"\"\n                            className=\"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700\"\n                          />\n                          <Input\n                            type=\"number\"\n                            value={draft?.used_annual_leave || ''}\n                            onChange={(e) => updateDraft('used_annual_leave', e.target.value)}\n                            placeholder=\"\"\n                            className=\"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700\"\n                          />\n                          <Input\n                            type=\"number\"\n                            value={draft?.remaining_annual_leave || ''}\n                            onChange={(e) => updateDraft('remaining_annual_leave', e.target.value)}\n                            placeholder=\"\"\n                            className=\"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700\"\n                          />\n                        </div>\n                      ) : (\n                        `${employee.annual_leave_granted_current_year || 0}/${employee.used_annual_leave || 0}/${\n                          employee.remaining_annual_leave !== undefined ? employee.remaining_annual_leave : '-'\n                        }`\n                      )\n                    }\n                  />\n                  \n                  <MobileCardActions>\n                    {isEditingRow(employee.id) ? (\n                      <>\n                        <Button\n                          className=\"button-base bg-blue-500 hover:bg-blue-600 text-white flex items-center gap-1\"\n                          onClick={handleSave}\n                          disabled={loadingId === employee.id}\n                        >\n                          <Save className=\"w-4 h-4\" />\n                          \n                        </Button>\n                        <Button\n                          className=\"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 flex items-center gap-1\"\n                          onClick={cancelEdit}\n                          disabled={loadingId === employee.id}\n                        >\n                          <X className=\"w-4 h-4\" />\n                          \n                        </Button>\n                      </>\n                    ) : (\n                      <>\n                        <Button\n                          className=\"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 flex items-center gap-1\"\n                          onClick={() => startEdit(employee)}\n                        >\n                          <Edit className=\"w-4 h-4\" />\n                          \n                        </Button>\n                        <Button\n                          className=\"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 flex items-center gap-1\"\n                          onClick={() => handleToggleStatus(employee)}\n                          disabled={loadingId === employee.id}\n                        >\n                          {employee.is_active ? <ToggleLeft className=\"w-4 h-4\" /> : <ToggleRight className=\"w-4 h-4\" />}\n                          \n                        </Button>\n                        <Button\n                          className=\"button-base border border-red-200 bg-white text-red-600 hover:bg-red-50 flex items-center gap-1\"\n                          onClick={() => handleDelete(employee)}\n                          disabled={loadingId === employee.id}\n                        >\n                          <Trash2 className=\"w-4 h-4\" />\n                          \n                        </Button>\n                      </>\n                    )}\n                  </MobileCardActions>\n                </>\n              )}\n            </MobileCard>\n          ))\n        )}\n      </div>\n    </>\n  )\n}","\"use client\"\n\nimport * as React from \"react\"\nimport { Check, ChevronsUpDown } from \"lucide-react\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n} from \"@/components/ui/command\"\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\"\n\nexport interface ComboboxOption {\n  value: string\n  label: string\n}\n\ninterface ComboboxProps {\n  options: ComboboxOption[]\n  value: string\n  onValueChange: (value: string) => void\n  placeholder?: string\n  searchPlaceholder?: string\n  emptyText?: string\n  className?: string\n}\n\nexport function Combobox({\n  options,\n  value,\n  onValueChange,\n  placeholder = \"...\",\n  searchPlaceholder = \"...\",\n  emptyText = \" .\",\n  className,\n}: ComboboxProps) {\n  const [open, setOpen] = React.useState(false)\n\n  return (\n    <Popover open={open} onOpenChange={setOpen}>\n      <PopoverTrigger asChild>\n        <Button\n          variant=\"outline\"\n          role=\"combobox\"\n          aria-expanded={open}\n          className={cn(\n            \"w-full justify-between h-9 text-sm font-normal\",\n            className\n          )}\n        >\n          {value\n            ? options.find((option) => option.value === value)?.label\n            : placeholder}\n          <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n        </Button>\n      </PopoverTrigger>\n      <PopoverContent className=\"w-full p-0\" align=\"start\">\n        <Command>\n          <CommandInput placeholder={searchPlaceholder} className=\"h-9\" />\n          <CommandEmpty>{emptyText}</CommandEmpty>\n          <CommandGroup className=\"max-h-[300px] overflow-auto\">\n            {options.map((option) => (\n              <CommandItem\n                key={option.value}\n                value={option.label}\n                onSelect={() => {\n                  onValueChange(option.value === value ? \"\" : option.value)\n                  setOpen(false)\n                }}\n              >\n                <Check\n                  className={cn(\n                    \"mr-2 h-4 w-4\",\n                    value === option.value ? \"opacity-100\" : \"opacity-0\"\n                  )}\n                />\n                {option.label}\n              </CommandItem>\n            ))}\n          </CommandGroup>\n        </Command>\n      </PopoverContent>\n    </Popover>\n  )\n}","import ExcelJS from 'exceljs';\n\nexport interface AttendanceData {\n  employeeName: string;\n  employeeId: string;\n  department: string;\n  startDate: string;\n  endDate: string;\n  records: AttendanceRecord[];\n}\n\nexport interface AttendanceRecord {\n  date: string;\n  dayOfWeek: string;\n  employeeName: string;\n  employeeId: string;\n  department: string;\n  position: string;\n  workType: string;\n  clockIn?: string;\n  clockOut?: string;\n  status: string;\n  remarks?: string;\n}\n\nexport async function generateAttendanceExcel(data: AttendanceData): Promise<Blob> {\n  const workbook = new ExcelJS.Workbook();\n  const worksheet = workbook.addWorksheet('');\n\n  //   \n  worksheet.pageSetup = {\n    paperSize: 9, // A4\n    orientation: 'portrait',\n    margins: {\n      left: 0.7,\n      right: 0.7,\n      top: 0.75,\n      bottom: 0.75,\n      header: 0.3,\n      footer: 0.3,\n    },\n  };\n\n  //    (   )\n  worksheet.columns = [\n    { width: 12 }, // \n    { width: 8 },  // \n    { width: 12 }, // \n    { width: 8 },  // \n    { width: 6 },  // \n    { width: 8 },  // \n    { width: 12 }, // \n    { width: 12 }, // \n    { width: 8 },  // \n    { width: 8 },  // \n  ];\n\n  //   (1 )\n  const titleRow = worksheet.addRow(['1']);\n  titleRow.height = 25;\n  worksheet.mergeCells('A1:J1');\n  const titleCell = worksheet.getCell('A1');\n  titleCell.value = '1';\n  titleCell.font = { name: ' ', size: 14, bold: true };\n  titleCell.alignment = { horizontal: 'center', vertical: 'middle' };\n\n  //  \n  worksheet.addRow([]);\n\n  //   \n  const employeeRow = worksheet.addRow([`${data.employeeName}  (21)`]);\n  employeeRow.height = 20;\n  worksheet.mergeCells('A3:J3');\n  const employeeCell = worksheet.getCell('A3');\n  employeeCell.font = { name: ' ', size: 12, bold: true };\n  employeeCell.alignment = { horizontal: 'left', vertical: 'middle' };\n\n  const periodRow = worksheet.addRow([`: ${data.startDate} ~ ${data.endDate}`]);\n  periodRow.height = 20;\n  worksheet.mergeCells('A4:J4');\n  const periodCell = worksheet.getCell('A4');\n  periodCell.font = { name: ' ', size: 10 };\n  periodCell.alignment = { horizontal: 'left', vertical: 'middle' };\n\n  //  \n  const headerRow = worksheet.addRow([\n    '',\n    '', \n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    ''\n  ]);\n  \n  headerRow.height = 25;\n  \n  //  \n  headerRow.eachCell((cell, _colNumber) => {\n    cell.font = { name: ' ', size: 10, bold: true };\n    cell.alignment = { horizontal: 'center', vertical: 'middle' };\n    cell.border = {\n      top: { style: 'thin' },\n      left: { style: 'thin' },\n      bottom: { style: 'thin' },\n      right: { style: 'thin' }\n    };\n    cell.fill = {\n      type: 'pattern',\n      pattern: 'solid',\n      fgColor: { argb: 'FFE0E0E0' }\n    };\n  });\n\n  // /  \n  const isWeekendOrHolidayFunc = (dateString: string): boolean => {\n    const date = new Date(dateString.split('(')[0]); //   \n    const dayOfWeek = date.getDay();\n    \n    //  (: 6, : 0)\n    if (dayOfWeek === 0 || dayOfWeek === 6) {\n      return true;\n    }\n    \n    //  (   -  )\n    const year = date.getFullYear();\n    const month = date.getMonth() + 1;\n    const day = date.getDate();\n    \n    //   (  )\n    const holidays = [\n      `${year}-01-01`, // \n      `${year}-03-01`, // \n      `${year}-05-05`, // \n      `${year}-06-06`, // \n      `${year}-08-15`, // \n      `${year}-10-03`, // \n      `${year}-10-09`, // \n      `${year}-12-25`, // \n    ];\n    \n    const dateStr = `${year}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;\n    return holidays.includes(dateStr);\n  };\n\n  //   \n  data.records.forEach(record => {\n    // /    \n    let workStatus = record.remarks || '-';\n    const isWeekendOrHoliday = isWeekendOrHolidayFunc(record.date);\n    \n    //     \n    if (record.remarks && record.remarks.includes('')) {\n      workStatus = '';\n    } else if (isWeekendOrHoliday) {\n      const date = new Date(record.date.split('(')[0]);\n      const dayOfWeek = date.getDay();\n      \n      if (dayOfWeek === 0 || dayOfWeek === 6) {\n        workStatus = '';\n      } else {\n        workStatus = '';\n      }\n    }\n\n    const dataRow = worksheet.addRow([\n      record.date,\n      record.employeeName,\n      record.employeeId,\n      record.department,\n      record.position,\n      record.workType,\n      record.clockIn || '-',\n      record.clockOut || '-',\n      record.status,\n      workStatus\n    ]);\n\n    dataRow.height = 20;\n    \n    const isSpecialDay = isWeekendOrHoliday;\n    const isLeaveDay = record.remarks && record.remarks.includes('');\n    \n    //   \n    dataRow.eachCell((cell, colNumber) => {\n      cell.font = { name: ' ', size: 9 };\n      cell.alignment = { \n        horizontal: colNumber === 1 ? 'center' : 'left', //  ,  \n        vertical: 'middle' \n      };\n      cell.border = {\n        top: { style: 'thin' },\n        left: { style: 'thin' },\n        bottom: { style: 'thin' },\n        right: { style: 'thin' }\n      };\n      \n      //    \n      if (colNumber === 7 || colNumber === 8) {\n        cell.alignment = { horizontal: 'center', vertical: 'middle' };\n      }\n      \n      //  :  > / >  \n      if (isLeaveDay) {\n        //   \n        cell.fill = {\n          type: 'pattern',\n          pattern: 'solid',\n          fgColor: { argb: 'FFE8F5E8' } // \n        };\n      } else if (isSpecialDay) {\n        // /  \n        cell.fill = {\n          type: 'pattern',\n          pattern: 'solid',\n          fgColor: { argb: 'FFFFE8E8' } // \n        };\n      }\n    });\n  });\n\n  //   Blob \n  const buffer = await workbook.xlsx.writeBuffer();\n  return new Blob([buffer], { \n    type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' \n  });\n}\n\n//   \nexport function getDayOfWeek(dateString: string): string {\n  const date = new Date(dateString);\n  const days = ['', '', '', '', '', '', ''];\n  return days[date.getDay()];\n}\n\n//    (YYYY-MM-DD YYYY-MM-DD() )\nexport function formatDateWithDay(dateString: string): string {\n  const dayOfWeek = getDayOfWeek(dateString);\n  return `${dateString}(${dayOfWeek})`;\n}","import { useState } from 'react'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog'\nimport { Combobox, ComboboxOption } from '@/components/ui/combobox'\nimport { Download, Calendar, User, X } from 'lucide-react'\nimport { Employee } from '@/types/purchase'\nimport { toast } from 'sonner'\nimport { createClient } from '@/lib/supabase/client'\nimport { generateAttendanceExcel, formatDateWithDay } from '@/utils/exceljs/generateAttendanceExcel'\n\ninterface AttendanceDownloadProps {\n  employees: Employee[]\n  isOpen: boolean\n  onClose: () => void\n}\n\nexport default function AttendanceDownload({ employees, isOpen, onClose }: AttendanceDownloadProps) {\n  const [selectedEmployee, setSelectedEmployee] = useState<string>('')\n  const [startDate, setStartDate] = useState<string>('')\n  const [endDate, setEndDate] = useState<string>('')\n  const [isDownloading, setIsDownloading] = useState(false)\n  \n  const supabase = createClient()\n\n  //    ( )\n  const setCurrentMonth = () => {\n    const now = new Date()\n    const start = new Date(now.getFullYear(), now.getMonth(), 1)\n    const end = new Date(now.getFullYear(), now.getMonth() + 1, 0)\n    \n    setStartDate(start.toISOString().split('T')[0])\n    setEndDate(end.toISOString().split('T')[0])\n  }\n\n  //   \n  const setLastMonth = () => {\n    const now = new Date()\n    const start = new Date(now.getFullYear(), now.getMonth() - 1, 1)\n    const end = new Date(now.getFullYear(), now.getMonth(), 0)\n    \n    setStartDate(start.toISOString().split('T')[0])\n    setEndDate(end.toISOString().split('T')[0])\n  }\n\n  const handleDownload = async () => {\n    if (!selectedEmployee) {\n      toast.error(' .')\n      return\n    }\n    \n    if (!startDate || !endDate) {\n      toast.error('  .')\n      return\n    }\n    \n    if (new Date(startDate) > new Date(endDate)) {\n      toast.error('    .')\n      return\n    }\n\n    setIsDownloading(true)\n    \n    try {\n      //    \n      const selectedEmp = employees.find(emp => emp.id === selectedEmployee)\n      if (!selectedEmp) {\n        throw new Error('     .')\n      }\n\n      //   \n      const { data: attendanceRecords, error } = await supabase\n        .from('attendance_records')\n        .select('*')\n        .eq('employee_id', selectedEmployee)\n        .gte('date', startDate)\n        .lte('date', endDate)\n        .order('date', { ascending: true })\n\n      if (error) {\n        throw new Error('   .')\n      }\n\n      //       (    )\n      const allDates: string[] = []\n      const start = new Date(startDate)\n      const end = new Date(endDate)\n      \n      for (let date = new Date(start); date <= end; date.setDate(date.getDate() + 1)) {\n        allDates.push(date.toISOString().split('T')[0])\n      }\n\n      //    \n      const recordMap = new Map()\n      attendanceRecords?.forEach((record: any) => {\n        recordMap.set(record.date, record)\n      })\n\n      //   \n      const excelRecords = allDates.map(date => {\n        const record = recordMap.get(date)\n        const dateWithDay = formatDateWithDay(date)\n        const dayOfWeek = dateWithDay.split('(')[1]?.split(')')[0] || ''\n        \n        //   (: 6, : 0)\n        const dateObj = new Date(date)\n        const isWeekend = dateObj.getDay() === 0 || dateObj.getDay() === 6\n        \n        return {\n          date: dateWithDay,\n          dayOfWeek,\n          employeeName: selectedEmp.name || '',\n          employeeId: selectedEmp.employeeID || selectedEmp.employee_number || '',\n          department: selectedEmp.department || '',\n          position: selectedEmp.position || '',\n          workType: '', // ,     \n          clockIn: record?.clock_in || (isWeekend ? '-' : ''),\n          clockOut: record?.clock_out || (isWeekend ? '-' : ''),\n          status: record?.status === ' ' ? ' ' : (record?.status || (isWeekend ? '' : '')),\n          remarks: record?.remarks || ''\n        }\n      })\n\n      //   \n      const excelData = {\n        employeeName: selectedEmp.name || '',\n        employeeId: selectedEmp.employeeID || '',\n        department: selectedEmp.department || '',\n        startDate,\n        endDate,\n        records: excelRecords\n      }\n\n      const blob = await generateAttendanceExcel(excelData)\n      \n      //  \n      const url = window.URL.createObjectURL(blob)\n      const a = document.createElement('a')\n      a.href = url\n      a.download = `_${selectedEmp.name}_${startDate}_${endDate}.xlsx`\n      document.body.appendChild(a)\n      a.click()\n      document.body.removeChild(a)\n      window.URL.revokeObjectURL(url)\n      \n      toast.success(' .')\n      \n      //     \n      onClose()\n      \n    } catch (error) {\n      toast.error(error instanceof Error ? error.message : '   .')\n    } finally {\n      setIsDownloading(false)\n    }\n  }\n\n  //     \n  const handleClose = () => {\n    setSelectedEmployee('')\n    setStartDate('')\n    setEndDate('')\n    setIsDownloading(false)\n    onClose()\n  }\n\n  return (\n    <Dialog open={isOpen} onOpenChange={handleClose}>\n      <DialogContent className=\"sm:max-w-[520px] max-h-[85vh] overflow-y-auto\">\n        {/*  */}\n        <DialogHeader className=\"pb-6 space-y-3\">\n          <DialogTitle className=\"flex items-center text-2xl font-bold text-gray-900\">\n            <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-hansl-400 to-hansl-600 flex items-center justify-center mr-4 shadow-sm\">\n              <Calendar className=\"w-6 h-6 text-white\" />\n            </div>\n             \n          </DialogTitle>\n          <p className=\"text-gray-600 leading-relaxed pl-16\">\n                <br />\n               \n          </p>\n        </DialogHeader>\n        \n        {/*  */}\n        <div className=\"space-y-8 py-2\">\n          {/*    */}\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center space-x-3\">\n              <div className=\"w-8 h-8 rounded-lg bg-blue-50 flex items-center justify-center\">\n                <User className=\"w-4 h-4 text-blue-600\" />\n              </div>\n              <h3 className=\"text-lg font-semibold text-gray-900\"> </h3>\n            </div>\n            <div className=\"pl-11\">\n              <Combobox\n                value={selectedEmployee}\n                onValueChange={setSelectedEmployee}\n                options={employees\n                  .filter(emp => emp.name && emp.name.trim() !== '')\n                  .sort((a, b) => (a.name || '').localeCompare(b.name || ''))\n                  .map((employee): ComboboxOption => ({\n                    value: employee.id,\n                    label: `${employee.name} (${employee.department || ''})`\n                  }))}\n                placeholder=\" ...\"\n                searchPlaceholder=\"  ...\"\n                emptyText=\"  \"\n                className=\"h-10 text-sm border-gray-200 focus:border-hansl-400 focus:ring-1 focus:ring-hansl-100\"\n              />\n            </div>\n          </div>\n\n          {/*    */}\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center space-x-3\">\n              <div className=\"w-8 h-8 rounded-lg bg-green-50 flex items-center justify-center\">\n                <Calendar className=\"w-4 h-4 text-green-600\" />\n              </div>\n              <h3 className=\"text-lg font-semibold text-gray-900\"> </h3>\n            </div>\n            <div className=\"pl-11 space-y-4\">\n              {/*   */}\n              <div className=\"grid grid-cols-2 gap-3\">\n                <div className=\"space-y-2\">\n                  <label className=\"block text-sm font-medium text-gray-700\"></label>\n                  <Input\n                    type=\"date\"\n                    value={startDate}\n                    onChange={(e) => setStartDate(e.target.value)}\n                    className=\"h-9 text-sm border-gray-200 focus:border-hansl-400 focus:ring-1 focus:ring-hansl-100\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <label className=\"block text-sm font-medium text-gray-700\"></label>\n                  <Input\n                    type=\"date\"\n                    value={endDate}\n                    onChange={(e) => setEndDate(e.target.value)}\n                    className=\"h-9 text-sm border-gray-200 focus:border-hansl-400 focus:ring-1 focus:ring-hansl-100\"\n                  />\n                </div>\n              </div>\n              \n              {/*   */}\n              <div className=\"space-y-2\">\n                <p className=\"text-sm font-medium text-gray-700\"> </p>\n                <div className=\"flex gap-2\">\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={setCurrentMonth}\n                    className=\"h-8 px-4 text-sm border-gray-200 hover:bg-hansl-50 hover:border-hansl-300 hover:text-hansl-700 transition-colors\"\n                  >\n                     \n                  </Button>\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={setLastMonth}\n                    className=\"h-8 px-4 text-sm border-gray-200 hover:bg-hansl-50 hover:border-hansl-300 hover:text-hansl-700 transition-colors\"\n                  >\n                     \n                  </Button>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/*    */}\n        <div className=\"flex gap-3 pt-6 mt-2 border-t border-gray-100\">\n          <Button\n            variant=\"outline\"\n            onClick={handleClose}\n            className=\"flex-1 h-10 text-sm font-medium border-gray-200 hover:bg-gray-50 transition-colors\"\n            disabled={isDownloading}\n          >\n            \n          </Button>\n          <Button\n            onClick={handleDownload}\n            disabled={isDownloading || !selectedEmployee || !startDate || !endDate}\n            className=\"flex-1 h-10 text-sm bg-gradient-to-r from-hansl-500 to-hansl-600 hover:from-hansl-600 hover:to-hansl-700 text-white font-medium shadow-sm transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed\"\n          >\n            <Download className=\"w-4 h-4 mr-2\" />\n            {isDownloading ? ' ...' : ' '}\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  )\n}","export interface LeaveRow {\n  id?: number | string\n  user_email: string\n  start_date: string\n  end_date: string\n  days?: number | string | null\n  start_period?: string | null\n  end_period?: string | null\n  type?: string | null\n  status?: string | null\n  reason?: string | null\n}\n\nexport type LeaveMatchReason =\n  | 'included'\n  | 'not_approved'\n  | 'not_annual_or_half'\n\nexport interface AnnualLeaveUsageDetailRow {\n  user_email: string\n  date: string // YYYY-MM-DD\n  dayOfWeek: string // ''...''\n  unit: 1 | 0.5\n  leave_id?: number | string\n  leave_start_date: string\n  leave_end_date: string\n  reason?: string | null\n}\n\nexport interface AnnualLeaveUsageSummary {\n  user_email: string\n  used_days: number\n}\n\nconst KOREAN_DAYS = ['', '', '', '', '', '', ''] as const\n\nfunction toDateOnly(dateStr: string): Date {\n  const d = new Date(dateStr)\n  d.setHours(0, 0, 0, 0)\n  return d\n}\n\nfunction formatYmd(d: Date): string {\n  const y = d.getFullYear()\n  const m = String(d.getMonth() + 1).padStart(2, '0')\n  const day = String(d.getDate()).padStart(2, '0')\n  return `${y}-${m}-${day}`\n}\n\nexport function isApprovedAnnualLeave(leave: LeaveRow): boolean {\n  const typeRaw = (leave.type ?? '').toString()\n  const reasonRaw = (leave.reason ?? '').toString()\n  const statusRaw = (leave.status ?? '').toString()\n\n  const type = typeRaw.toLowerCase()\n  const reason = reasonRaw.toLowerCase()\n  const status = statusRaw.toLowerCase()\n\n  const isApproved =\n    status === 'approved' ||\n    status.includes('approved') ||\n    status.includes('')\n\n  // /   (  )\n  const isAnnualOrHalf =\n    type.includes('annual') ||\n    type.includes('') ||\n    type.includes('half') ||\n    type.includes('') ||\n    reason.includes('half') ||\n    reason.includes('') ||\n    reason.includes('0.5')\n\n  return isApproved && isAnnualOrHalf\n}\n\nexport function classifyLeaveForAnnualUsage(leave: LeaveRow): {\n  ok: boolean\n  reason: LeaveMatchReason\n  unit: 1 | 0.5\n} {\n  const statusRaw = (leave.status ?? '').toString()\n  const status = statusRaw.toLowerCase()\n  const isApproved =\n    status === 'approved' ||\n    status.includes('approved') ||\n    status.includes('')\n\n  if (!isApproved) {\n    return { ok: false, reason: 'not_approved', unit: 1 }\n  }\n\n  const typeRaw = (leave.type ?? '').toString()\n  const reasonRaw = (leave.reason ?? '').toString()\n  const type = typeRaw.toLowerCase()\n  const reason = reasonRaw.toLowerCase()\n\n  const isAnnualOrHalf =\n    type.includes('annual') ||\n    type.includes('') ||\n    type.includes('half') ||\n    type.includes('') ||\n    reason.includes('half') ||\n    reason.includes('') ||\n    reason.includes('0.5')\n\n  if (!isAnnualOrHalf) {\n    return { ok: false, reason: 'not_annual_or_half', unit: 1 }\n  }\n\n  return { ok: true, reason: 'included', unit: getLeaveUnit(leave) }\n}\n\nexport function getLeaveUnit(leave: LeaveRow): 1 | 0.5 {\n  // 1)   days(DECIMAL(3,1))    \n  const daysNum = Number(leave.days ?? NaN)\n  if (!Number.isNaN(daysNum)) {\n    if (daysNum === 0.5) return 0.5\n    return 1\n  }\n\n  // 2) start_period/end_period (half-day) \n  const sp = (leave.start_period ?? '').toString().toLowerCase()\n  const ep = (leave.end_period ?? '').toString().toLowerCase()\n  const hasHalfPeriod = (sp && sp !== 'full') || (ep && ep !== 'full')\n  if (hasHalfPeriod && leave.start_date === leave.end_date) return 0.5\n\n  // 3) fallback: type/reason \n  const type = (leave.type ?? '').toString().toLowerCase()\n  const reason = (leave.reason ?? '').toString().toLowerCase()\n  const isHalfKeyword =\n    type.includes('half') ||\n    type.includes('') ||\n    reason.includes('half') ||\n    reason.includes('') ||\n    reason.includes('0.5')\n  if (isHalfKeyword && leave.start_date === leave.end_date) return 0.5\n  return 1\n}\n\nexport function calcAnnualLeaveUsageByWorkdays(params: {\n  leaves: LeaveRow[]\n  startDate: string // YYYY-MM-DD\n  endDate: string // YYYY-MM-DD\n}): { summaries: AnnualLeaveUsageSummary[]; details: AnnualLeaveUsageDetailRow[] } {\n  const { leaves, startDate, endDate } = params\n\n  const rangeStart = toDateOnly(startDate)\n  const rangeEnd = toDateOnly(endDate)\n\n  const details: AnnualLeaveUsageDetailRow[] = []\n  const usedByEmail = new Map<string, number>()\n\n  leaves.forEach((leave) => {\n    const cls = classifyLeaveForAnnualUsage(leave)\n    if (!cls.ok) return\n    // leave   unit(0.5/1) ,    ( 1,   period 0.5)\n\n    const leaveStart = toDateOnly(leave.start_date)\n    const leaveEnd = toDateOnly(leave.end_date)\n\n    const effectiveStart = leaveStart > rangeStart ? leaveStart : rangeStart\n    const effectiveEnd = leaveEnd < rangeEnd ? leaveEnd : rangeEnd\n\n    if (effectiveStart > effectiveEnd) return\n\n    const cursor = new Date(effectiveStart)\n    for (; cursor <= effectiveEnd; cursor.setDate(cursor.getDate() + 1)) {\n      const dow = cursor.getDay()\n      const ymd = formatYmd(cursor)\n\n      let dayUnit: 1 | 0.5 = 1\n      //    days/period  unit \n      if (leave.start_date === leave.end_date) {\n        dayUnit = cls.unit\n      } else {\n        //   period half / \n        const sp = (leave.start_period ?? '').toString().toLowerCase()\n        const ep = (leave.end_period ?? '').toString().toLowerCase()\n        const isFirst = ymd === leave.start_date\n        const isLast = ymd === leave.end_date\n        if (isFirst && sp && sp !== 'full') dayUnit = 0.5\n        if (isLast && ep && ep !== 'full') dayUnit = 0.5\n      }\n\n      details.push({\n        user_email: leave.user_email,\n        date: ymd,\n        dayOfWeek: KOREAN_DAYS[dow],\n        unit: dayUnit,\n        leave_id: leave.id,\n        leave_start_date: leave.start_date,\n        leave_end_date: leave.end_date,\n        reason: leave.reason ?? null\n      })\n\n      usedByEmail.set(leave.user_email, (usedByEmail.get(leave.user_email) ?? 0) + dayUnit)\n    }\n  })\n\n  const summaries: AnnualLeaveUsageSummary[] = Array.from(usedByEmail.entries())\n    .map(([user_email, used_days]) => ({ user_email, used_days }))\n    .sort((a, b) => b.used_days - a.used_days)\n\n  //  /  \n  details.sort((a, b) => {\n    if (a.user_email !== b.user_email) return a.user_email.localeCompare(b.user_email)\n    return a.date.localeCompare(b.date)\n  })\n\n  return { summaries, details }\n}\n\n\n","import { useState } from 'react'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog'\nimport { Calendar, Download } from 'lucide-react'\nimport { toast } from 'sonner'\nimport { createClient } from '@/lib/supabase/client'\nimport { employeeService } from '@/services/employeeService'\nimport { calcAnnualLeaveUsageByWorkdays, classifyLeaveForAnnualUsage, type LeaveRow } from '@/utils/leave/calcAnnualLeaveWorkdays'\nimport { generateAnnualLeaveUsageExcel } from '@/utils/exceljs/generateAnnualLeaveUsageExcel'\n\ninterface AnnualLeaveUsageDownloadProps {\n  isOpen: boolean\n  onClose: () => void\n}\n\nexport default function AnnualLeaveUsageDownload({ isOpen, onClose }: AnnualLeaveUsageDownloadProps) {\n  const [year, setYear] = useState<string>(String(new Date().getFullYear()))\n  const [isDownloading, setIsDownloading] = useState(false)\n\n  const supabase = createClient()\n\n  const setThisYear = () => setYear(String(new Date().getFullYear()))\n  const setLastYear = () => setYear(String(new Date().getFullYear() - 1))\n\n  // hansl ( /)   \n  const calcGrantedAnnualLeaveForYear = (joinDateStr: string | undefined, targetYear: number): number => {\n    if (!joinDateStr) return 0\n    const joinDate = new Date(joinDateStr)\n    if (Number.isNaN(joinDate.getTime())) return 0\n\n    const joinYear = joinDate.getFullYear()\n    const joinMonth = joinDate.getMonth() + 1 // 1~12\n    const serviceYears = targetYear - joinYear\n\n    if (serviceYears === 0) {\n      const remainingMonths = 13 - joinMonth\n      return Math.floor((15 * remainingMonths) / 12)\n    }\n    if (serviceYears === 1 || serviceYears === 2) return 15\n    if (serviceYears >= 3) return Math.min(25, 15 + Math.floor((serviceYears - 1) / 2))\n    return 0\n  }\n\n  const handleDownload = async () => {\n    const yearNum = Number(year)\n    if (!year || Number.isNaN(yearNum) || yearNum < 2000 || yearNum > 2100) {\n      toast.error('  . (: 2025)')\n      return\n    }\n    const effectiveStart = `${yearNum}-01-01`\n    const effectiveEnd = `${yearNum}-12-31`\n\n    setIsDownloading(true)\n    try {\n      // 1)  overlap  leave  (   )\n      const { data: leaveRows, error: leaveError } = await supabase\n        .from('leave')\n        //  ( )      \n        .select('*')\n        .lte('start_date', effectiveEnd)\n        .gte('end_date', effectiveStart)\n        .order('start_date', { ascending: true })\n\n      if (leaveError) throw leaveError\n\n      const leaves = (leaveRows || []) as LeaveRow[]\n      if (leaves.length === 0) {\n        toast.error('  ()  .')\n        return\n      }\n\n      // 1-1) : / leave  ( )\n      const includedLeaves = leaves\n        .map((l) => {\n          const cls = classifyLeaveForAnnualUsage(l)\n          if (!cls.ok) return null\n          return {\n            id: l.id,\n            user_email: l.user_email,\n            start_date: l.start_date,\n            end_date: l.end_date,\n            unit: cls.unit,\n            type: l.type ?? null,\n            status: l.status ?? null,\n            reason: l.reason ?? null\n          }\n        })\n        .filter(Boolean) as any[]\n\n      const excludedLeaves = leaves\n        .map((l) => {\n          const cls = classifyLeaveForAnnualUsage(l)\n          if (cls.ok) return null\n          return {\n            id: l.id,\n            user_email: l.user_email,\n            start_date: l.start_date,\n            end_date: l.end_date,\n            excludeReason: cls.reason,\n            type: l.type ?? null,\n            status: l.status ?? null,\n            reason: l.reason ?? null\n          }\n        })\n        .filter(Boolean) as any[]\n\n      // 3)  leave(days/period)    +   \n      const { summaries, details } = calcAnnualLeaveUsageByWorkdays({\n        leaves,\n        startDate: effectiveStart,\n        endDate: effectiveEnd\n      })\n\n      if (summaries.length === 0 || details.length === 0) {\n        toast.error('   /( )  .')\n        return\n      }\n\n      // 4)    (    : summaries )\n      const employeesResult = await employeeService.getEmployees({ is_active: undefined })\n      if (!employeesResult.success || !employeesResult.data) {\n        throw new Error(employeesResult.error || '   .')\n      }\n      const employees = employeesResult.data\n      const empByEmail = new Map<string, any>()\n      employees.forEach((e) => {\n        if (e.email) empByEmail.set(e.email, e)\n      })\n\n      const targetEmails = new Set(summaries.map((s) => s.user_email))\n      const targetEmployeeIds: string[] = []\n      const employeeIdByEmail = new Map<string, string>()\n      employees.forEach((e) => {\n        if (!e.email || !targetEmails.has(e.email)) return\n        if (!e.id) return\n        employeeIdByEmail.set(e.email, e.id)\n        targetEmployeeIds.push(e.id)\n      })\n\n      // 4-1)    : \"3(1),19(0.5)\" \n      const monthlyMap = new Map<string, Map<number, { day: number; unit: 1 | 0.5 }[]>>()\n      details.forEach((d) => {\n        const [y, m, dayStr] = d.date.split('-')\n        if (!y || !m || !dayStr) return\n        const month = Number(m)\n        const day = Number(dayStr)\n        if (Number.isNaN(month) || Number.isNaN(day)) return\n\n        if (!monthlyMap.has(d.user_email)) monthlyMap.set(d.user_email, new Map())\n        const byMonth = monthlyMap.get(d.user_email)!\n        if (!byMonth.has(month)) byMonth.set(month, [])\n        byMonth.get(month)!.push({ day, unit: d.unit })\n      })\n\n      const formatMonthCell = (email: string, month: number): string => {\n        const byMonth = monthlyMap.get(email)\n        const items = byMonth?.get(month) || []\n        items.sort((a, b) => a.day - b.day)\n        return items\n          .map((it) => `${it.day}(${it.unit === 1 ? '1' : '0.5'})`)\n          .join(',')\n      }\n\n      const summaryRows = summaries.map((s) => {\n        const emp = empByEmail.get(s.user_email)\n        const months: Record<number, string> = {} as any\n        for (let m = 1; m <= 12; m++) {\n          months[m] = formatMonthCell(s.user_email, m)\n        }\n        const grantedDays = calcGrantedAnnualLeaveForYear(emp?.join_date, yearNum)\n        return {\n          employeeId: emp?.employeeID || emp?.employee_number || '',\n          name: emp?.name || '',\n          // 2025       ( / )\n          grantedDays,\n          usedDays: s.used_days,\n          months\n        }\n      })\n\n      // 5)   + \n      const blob = await generateAnnualLeaveUsageExcel({\n        summaries: summaryRows,\n        debug: {\n          year: yearNum,\n          includedLeaves,\n          excludedLeaves\n        }\n      })\n\n      const url = window.URL.createObjectURL(blob)\n      const a = document.createElement('a')\n      a.href = url\n      a.download = `__${yearNum}.xlsx`\n      document.body.appendChild(a)\n      a.click()\n      document.body.removeChild(a)\n      window.URL.revokeObjectURL(url)\n\n      toast.success('  .')\n      onClose()\n    } catch (err: any) {\n      const msg =\n        err?.message ||\n        (typeof err === 'string' ? err : '') ||\n        '   .'\n      toast.error(msg)\n    } finally {\n      setIsDownloading(false)\n    }\n  }\n\n  const handleClose = () => {\n    setYear(String(new Date().getFullYear()))\n    setIsDownloading(false)\n    onClose()\n  }\n\n  return (\n    <Dialog open={isOpen} onOpenChange={handleClose}>\n      <DialogContent className=\"sm:max-w-[520px] max-h-[85vh] overflow-y-auto\">\n        <DialogHeader className=\"pb-6 space-y-3\">\n          <DialogTitle className=\"flex items-center text-2xl font-bold text-gray-900\">\n            <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-hansl-400 to-hansl-600 flex items-center justify-center mr-4 shadow-sm\">\n              <Calendar className=\"w-6 h-6 text-white\" />\n            </div>\n             \n          </DialogTitle>\n          <p className=\"text-gray-600 leading-relaxed pl-16\">\n                 (/)<br />\n             \n          </p>\n        </DialogHeader>\n\n        <div className=\"space-y-6 py-2\">\n          {/*   */}\n          <div className=\"space-y-3\">\n            <div className=\"space-y-2\">\n              <label className=\"block text-sm font-medium text-gray-700\"></label>\n              <Input\n                type=\"number\"\n                value={year}\n                onChange={(e) => setYear(e.target.value)}\n                min={2000}\n                max={2100}\n                placeholder=\": 2025\"\n                className=\"h-9 text-sm border-gray-200 focus:border-hansl-400 focus:ring-1 focus:ring-hansl-100\"\n              />\n            </div>\n\n            <div className=\"flex gap-2\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={setThisYear}\n                className=\"h-8 px-4 text-sm border-gray-200 hover:bg-hansl-50 hover:border-hansl-300 hover:text-hansl-700 transition-colors\"\n              >\n                \n              </Button>\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={setLastYear}\n                className=\"h-8 px-4 text-sm border-gray-200 hover:bg-hansl-50 hover:border-hansl-300 hover:text-hansl-700 transition-colors\"\n              >\n                \n              </Button>\n            </div>\n          </div>\n\n          <div className=\"pt-2\">\n            <Button\n              onClick={handleDownload}\n              disabled={isDownloading}\n              className=\"w-full h-11 bg-hansl-600 hover:bg-hansl-700 text-white font-semibold shadow-sm\"\n            >\n              {isDownloading ? (\n                ' ...'\n              ) : (\n                <>\n                  <Download className=\"w-4 h-4 mr-2\" />\n                   \n                </>\n              )}\n            </Button>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\n\n","import ExcelJS from 'exceljs'\n\nexport interface AnnualLeaveUsageSummaryExcelRow {\n  employeeId?: string\n  name?: string\n  grantedDays?: number\n  usedDays: number\n  months: Record<number, string> // 1~12\n}\n\nexport interface AnnualLeaveUsageDebugLeaveRow {\n  id?: number | string\n  user_email?: string\n  start_date?: string\n  end_date?: string\n  type?: string | null\n  status?: string | null\n  reason?: string | null\n  unit?: 1 | 0.5\n  excludeReason?: string\n}\n\nexport async function generateAnnualLeaveUsageExcel(params: {\n  summaries: AnnualLeaveUsageSummaryExcelRow[]\n  debug?: {\n    year: number\n    includedLeaves: AnnualLeaveUsageDebugLeaveRow[]\n    excludedLeaves: AnnualLeaveUsageDebugLeaveRow[]\n  }\n}): Promise<Blob> {\n  const { summaries, debug } = params\n\n  const workbook = new ExcelJS.Workbook()\n\n  //  \n  const wsSummary = workbook.addWorksheet('')\n  wsSummary.columns = [\n    { header: '', key: 'employeeId', width: 14 },\n    { header: '', key: 'name', width: 12 },\n    { header: '', key: 'grantedDays', width: 10 },\n    { header: '', key: 'usedDays', width: 10 },\n    { header: '1', key: 'm1', width: 22 },\n    { header: '2', key: 'm2', width: 22 },\n    { header: '3', key: 'm3', width: 22 },\n    { header: '4', key: 'm4', width: 22 },\n    { header: '5', key: 'm5', width: 22 },\n    { header: '6', key: 'm6', width: 22 },\n    { header: '7', key: 'm7', width: 22 },\n    { header: '8', key: 'm8', width: 22 },\n    { header: '9', key: 'm9', width: 22 },\n    { header: '10', key: 'm10', width: 24 },\n    { header: '11', key: 'm11', width: 24 },\n    { header: '12', key: 'm12', width: 24 }\n  ]\n\n  wsSummary.getRow(1).font = { name: ' ', bold: true }\n  wsSummary.getRow(1).alignment = { vertical: 'middle', horizontal: 'center' }\n\n  //   ( )\n  const sorted = [...summaries].sort((a, b) => {\n    const nameA = (a.name ?? '').toString()\n    const nameB = (b.name ?? '').toString()\n    const cmp = nameA.localeCompare(nameB)\n    if (cmp !== 0) return cmp\n    return (a.employeeId ?? '').toString().localeCompare((b.employeeId ?? '').toString())\n  })\n\n  sorted.forEach((row) => {\n    wsSummary.addRow({\n      employeeId: row.employeeId ?? '',\n      name: row.name ?? '',\n      grantedDays: row.grantedDays ?? '',\n      usedDays: row.usedDays,\n      m1: row.months[1] ?? '',\n      m2: row.months[2] ?? '',\n      m3: row.months[3] ?? '',\n      m4: row.months[4] ?? '',\n      m5: row.months[5] ?? '',\n      m6: row.months[6] ?? '',\n      m7: row.months[7] ?? '',\n      m8: row.months[8] ?? '',\n      m9: row.months[9] ?? '',\n      m10: row.months[10] ?? '',\n      m11: row.months[11] ?? '',\n      m12: row.months[12] ?? ''\n    })\n  })\n\n  //  (/ ) -   \n  if (debug) {\n    const wsIncluded = workbook.addWorksheet(`__${debug.year}`)\n    wsIncluded.columns = [\n      { header: 'leave_id', key: 'id', width: 10 },\n      { header: 'user_email', key: 'user_email', width: 26 },\n      { header: 'start_date', key: 'start_date', width: 12 },\n      { header: 'end_date', key: 'end_date', width: 12 },\n      { header: 'unit', key: 'unit', width: 6 },\n      { header: 'type', key: 'type', width: 18 },\n      { header: 'status', key: 'status', width: 12 },\n      { header: 'reason', key: 'reason', width: 30 }\n    ]\n    wsIncluded.getRow(1).font = { name: ' ', bold: true }\n    wsIncluded.getRow(1).alignment = { vertical: 'middle', horizontal: 'center' }\n    debug.includedLeaves.forEach((r) => wsIncluded.addRow(r))\n\n    const wsExcluded = workbook.addWorksheet(`__${debug.year}`)\n    wsExcluded.columns = [\n      { header: 'leave_id', key: 'id', width: 10 },\n      { header: 'user_email', key: 'user_email', width: 26 },\n      { header: 'start_date', key: 'start_date', width: 12 },\n      { header: 'end_date', key: 'end_date', width: 12 },\n      { header: 'excludeReason', key: 'excludeReason', width: 16 },\n      { header: 'type', key: 'type', width: 18 },\n      { header: 'status', key: 'status', width: 12 },\n      { header: 'reason', key: 'reason', width: 30 }\n    ]\n    wsExcluded.getRow(1).font = { name: ' ', bold: true }\n    wsExcluded.getRow(1).alignment = { vertical: 'middle', horizontal: 'center' }\n    debug.excludedLeaves.forEach((r) => wsExcluded.addRow(r))\n  }\n\n  const buffer = await workbook.xlsx.writeBuffer()\n  return new Blob([buffer], {\n    type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'\n  })\n}\n\n\n","\nimport { useState, useEffect } from 'react'\nimport { Employee, EmployeeFilters as EmployeeFiltersType } from '@/types/purchase'\nimport { employeeService } from '@/services/employeeService'\nimport EmployeeFilters from '@/components/employee/EmployeeFilters'\nimport EmployeeTable from '@/components/employee/EmployeeTable'\nimport AttendanceDownload from '@/components/employee/AttendanceDownload'\nimport AnnualLeaveUsageDownload from '@/components/employee/AnnualLeaveUsageDownload'\nimport { toast } from 'sonner'\nimport { useAuth } from '@/contexts/AuthContext'\n// XLSX    import ( )\n\nexport default function EmployeeMain() {\n  const { currentUserRoles } = useAuth()\n  const canManageEmployees = currentUserRoles.includes('app_admin') || currentUserRoles.includes('hr')\n\n  const [employees, setEmployees] = useState<Employee[]>([])\n  const [filteredEmployees, setFilteredEmployees] = useState<Employee[]>([])\n  const [loading, setLoading] = useState(true)\n  const [filters, setFilters] = useState<EmployeeFiltersType>({})\n  const [createRequestToken, setCreateRequestToken] = useState(0)\n  \n  //   \n  const [isAttendanceModalOpen, setIsAttendanceModalOpen] = useState(false)\n  //   \n  const [isAnnualLeaveUsageModalOpen, setIsAnnualLeaveUsageModalOpen] = useState(false)\n\n  //   \n  const loadEmployees = async () => {\n    setLoading(true)\n    try {\n      const result = await employeeService.getEmployees(filters)\n      \n      if (result.success && result.data) {\n        setEmployees(result.data)\n        setFilteredEmployees(result.data)\n      } else {\n        toast.error(result.error || '   .')\n      }\n    } catch (error) {\n      toast.error('     .')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  //  \n  useEffect(() => {\n    loadEmployees()\n  }, [])\n\n  //       \n  useEffect(() => {\n    loadEmployees()\n  }, [filters])\n\n  const handleCreateNew = () => {\n    if (!canManageEmployees) {\n      toast.error('   .')\n      return\n    }\n    setCreateRequestToken((prev) => prev + 1)\n  }\n\n  // Excel  ( import  )\n  const handleExport = async () => {\n    if (!canManageEmployees) {\n      toast.error('Excel   .')\n      return\n    }\n    try {\n      const result = await employeeService.getEmployeesForExport()\n      \n      if (result.success && result.data) {\n        // XLSX    import\n        const XLSX = await import('xlsx')\n        \n        const ws = XLSX.utils.json_to_sheet(result.data)\n        const wb = XLSX.utils.book_new()\n        XLSX.utils.book_append_sheet(wb, ws, ' ')\n        \n        //    \n        const today = new Date().toISOString().slice(0, 10)\n        const filename = `__${today}.xlsx`\n        \n        XLSX.writeFile(wb, filename)\n        toast.success('Excel  .')\n      } else {\n        toast.error(result.error || 'Excel  .')\n      }\n    } catch (error) {\n      toast.error('Excel    .')\n    }\n  }\n\n  if (loading && employees.length === 0) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[400px]\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto\"></div>\n          <p className=\"mt-2 card-subtitle\">   ...</p>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <>\n      <div className=\"space-y-6\">\n      {/*   */}\n      <EmployeeFilters\n        filters={filters}\n        onFiltersChange={setFilters}\n        onExport={handleExport}\n        onCreateNew={handleCreateNew}\n        onAttendanceDownload={() => {\n          if (!canManageEmployees) {\n            toast.error('   .')\n            return\n          }\n          setIsAttendanceModalOpen(true)\n        }}\n        onAnnualLeaveUsageDownload={() => {\n          if (!canManageEmployees) {\n            toast.error('   .')\n            return\n          }\n          setIsAnnualLeaveUsageModalOpen(true)\n        }}\n        canManageEmployees={canManageEmployees}\n      />\n\n      {/*   */}\n      <div className=\"bg-white rounded-lg border\">\n        <div className=\"p-4 border-b\">\n          <div className=\"flex justify-between items-center\">\n            <h3 className=\"modal-title\"> </h3>\n            <div className=\"card-description\">\n              {loading ? ' ...' : ` ${filteredEmployees.length} `}\n            </div>\n          </div>\n        </div>\n        \n        <EmployeeTable\n          employees={filteredEmployees}\n          onRefresh={loadEmployees}\n          currentUserRoles={currentUserRoles}\n          createRequestToken={createRequestToken}\n        />\n      </div>\n\n      {/*    */}\n      <AttendanceDownload\n        employees={employees}\n        isOpen={isAttendanceModalOpen}\n        onClose={() => setIsAttendanceModalOpen(false)}\n      />\n\n      {/*    */}\n      <AnnualLeaveUsageDownload\n        isOpen={isAnnualLeaveUsageModalOpen}\n        onClose={() => setIsAnnualLeaveUsageModalOpen(false)}\n      />\n      </div>\n    </>\n  )\n}"],"file":"assets/EmployeeMain-8NEJ9838.js"}