import{r as g,a as z,j as e,b as d,X as D}from"./index-GROro3Qf.js";import{D as P,a as B,b as L,c as A,I as x}from"./input-rcvvte7h.js";import{T as H,a as M,b as p,c as i,d as R,e as c}from"./table-MrRtop_x.js";import{B as f,t as N}from"./index-gG2dsBXi.js";import{P as F,f as O}from"./format-CBsgHRAV.js";import{P as X}from"./plus-DvIduO0i.js";import{S as G}from"./save-zDs8PfaS.js";import{T as J}from"./card-yWopardK.js";function ee({isOpen:y,onClose:h,purchase:r,isAdmin:b,onUpdate:w}){const[m,u]=g.useState(r.items||[]),[l,j]=g.useState(!1),_=z(),k=()=>{j(!0),u([...r.items||[]])},q=()=>{j(!1),u(r.items||[])},o=(s,a,n)=>{const t=[...m];t[s]={...t[s],[a]:a==="quantity"||a==="unit_price_value"||a==="amount_value"?Number(n):n},(a==="quantity"||a==="unit_price_value")&&(t[s].amount_value=t[s].quantity*(t[s].unit_price_value||0)),u(t)},C=()=>{const s={line_number:m.length+1,item_name:"",specification:"",quantity:0,unit_price_value:0,amount_value:0,remark:"",is_received:!1};u([...m,s])},I=s=>{const a=m.filter((n,t)=>t!==s);a.forEach((n,t)=>{n.line_number=t+1}),u(a)},T=async()=>{try{await _.from("purchase_request_items").delete().eq("purchase_request_id",r.id);const s=m.map(t=>({purchase_request_id:r.id,purchase_order_number:r.purchase_order_number,line_number:t.line_number,item_name:t.item_name,specification:t.specification,quantity:t.quantity,unit_price_value:t.unit_price_value,amount_value:t.amount_value,remark:t.remark,link:t.link,is_received:t.is_received||!1,delivery_status:t.delivery_status||"pending"})),{error:a}=await _.from("purchase_request_items").insert(s);if(a)throw a;const n=m.reduce((t,E)=>t+(E.amount_value||0),0);await _.from("purchase_requests").update({total_amount:n}).eq("id",r.id),N.success("품목이 수정되었습니다."),j(!1),w(),h()}catch{N.error("저장 중 오류가 발생했습니다.")}},v=l?m:r.items||[],S=v.reduce((s,a)=>s+(a.amount_value||0),0);return e.jsx(P,{open:y,onOpenChange:h,children:e.jsxs(B,{className:"w-full max-w-[95vw] sm:max-w-6xl max-h-[80vh] overflow-hidden flex flex-col bg-white",children:[e.jsx(L,{className:"flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(A,{className:"text-xl font-bold",children:["발주 상세 항목 - ",r.purchase_order_number]}),e.jsxs("div",{className:"flex items-center gap-2",children:[b&&!l&&e.jsxs(d,{variant:"outline",size:"sm",onClick:k,children:[e.jsx(F,{className:"h-4 w-4 mr-1"}),"편집"]}),l&&e.jsxs(e.Fragment,{children:[e.jsxs(d,{variant:"outline",size:"sm",onClick:C,children:[e.jsx(X,{className:"h-4 w-4 mr-1"}),"품목 추가"]}),e.jsxs(d,{variant:"default",size:"sm",onClick:T,children:[e.jsx(G,{className:"h-4 w-4 mr-1"}),"저장"]}),e.jsx(d,{variant:"ghost",size:"sm",onClick:q,children:"취소"})]}),e.jsx(d,{variant:"ghost",size:"icon",onClick:h,className:"h-6 w-6",children:e.jsx(D,{className:"h-4 w-4"})})]})]})}),e.jsxs("div",{className:"flex-shrink-0 grid grid-cols-2 md:grid-cols-4 gap-4 py-4 border-b",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"업체명"}),e.jsx("p",{className:"font-medium",children:r.vendor_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"요청자"}),e.jsx("p",{className:"font-medium",children:r.requester_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"프로젝트"}),e.jsx("p",{className:"font-medium truncate",title:r.project_vendor,children:r.project_vendor})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"납기일"}),e.jsx("p",{className:"font-medium",children:r.delivery_request_date&&O(new Date(r.delivery_request_date),"yyyy-MM-dd")})]})]}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsxs(H,{children:[e.jsx(M,{className:"sticky top-0 bg-white z-10",children:e.jsxs(p,{children:[e.jsx(i,{className:"w-12",children:"No."}),e.jsx(i,{children:"품목"}),e.jsx(i,{children:"규격"}),e.jsx(i,{className:"text-right",children:"수량"}),e.jsx(i,{className:"text-right",children:"단가"}),e.jsx(i,{className:"text-right",children:"금액"}),e.jsx(i,{children:"입고상태"}),e.jsx(i,{children:"비고"}),l&&e.jsx(i,{className:"w-20",children:"삭제"})]})}),e.jsx(R,{children:v.map((s,a)=>e.jsxs(p,{children:[e.jsx(c,{className:"font-medium",children:s.line_number||a+1}),e.jsx(c,{children:l?e.jsx(x,{value:s.item_name,onChange:n=>o(a,"item_name",n.target.value),className:"h-8 text-sm"}):e.jsx("div",{className:"sm:max-w-[200px]",children:e.jsx("p",{className:"font-medium truncate",title:s.item_name,children:s.item_name})})}),e.jsx(c,{children:l?e.jsx(x,{value:s.specification,onChange:n=>o(a,"specification",n.target.value),className:"h-8 text-sm"}):e.jsx("div",{className:"sm:max-w-[150px] truncate",title:s.specification,children:s.specification})}),e.jsx(c,{className:"text-right",children:l?e.jsx(x,{type:"number",value:s.quantity,onChange:n=>o(a,"quantity",n.target.value),className:"h-8 text-sm text-right"}):e.jsx("span",{className:"font-medium",children:s.quantity.toLocaleString()})}),e.jsx(c,{className:"text-right",children:l?e.jsx(x,{type:"number",value:s.unit_price_value,onChange:n=>o(a,"unit_price_value",n.target.value),className:"h-8 text-sm text-right"}):e.jsxs("span",{children:[(s.unit_price_value||0).toLocaleString()," ",r.currency]})}),e.jsx(c,{className:"text-right",children:l?e.jsx(x,{type:"number",value:s.amount_value,onChange:n=>o(a,"amount_value",n.target.value),className:"h-8 text-sm text-right font-medium"}):e.jsxs("span",{className:"font-medium",children:[(s.amount_value||0).toLocaleString()," ",r.currency]})}),e.jsx(c,{children:s.is_received?e.jsx(f,{className:"bg-green-100 text-green-800",children:"입고완료"}):e.jsx(f,{variant:"outline",children:"대기"})}),e.jsx(c,{children:l?e.jsx(x,{value:s.remark||"",onChange:n=>o(a,"remark",n.target.value),className:"h-8 text-sm",placeholder:"비고"}):e.jsx("div",{className:"sm:max-w-[150px]",children:e.jsx("span",{className:"text-sm text-gray-500 truncate block",title:s.remark,children:s.remark||"-"})})}),l&&e.jsx(c,{children:e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>I(a),className:"h-8 w-8 text-red-500 hover:text-red-700",children:e.jsx(J,{className:"h-4 w-4"})})})]},s.id||a))})]})}),e.jsxs("div",{className:"flex-shrink-0 border-t pt-4 flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["총 ",v.length,"개 품목"]}),e.jsxs("div",{className:"text-lg font-bold",children:["총 금액: ",S.toLocaleString()," ",r.currency]})]})]})})}export{ee as default};
//# sourceMappingURL=PurchaseItemsModal-9PwMeFv7.js.map
