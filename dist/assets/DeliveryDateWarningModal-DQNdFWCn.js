const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/exceljs.min-DfVRx8GD.js","assets/index-B10MXRio.js","assets/index-B_w-WtWO.css","assets/PurchaseDetailModal-BFXKDRQv.js","assets/helpers-CmqE03mo.js","assets/react-select.esm-BxbvKx2J.js","assets/chevron-right-1OPWKzlh.js","assets/popover-xpcMj7oI.js","assets/dialog-Cmrbb0S0.js","assets/textarea-G-k_AwYk.js","assets/index-DZIVtcIE.js","assets/calendar-py_FtKCX.js","assets/check-DhkQyFTZ.js","assets/credit-card-5JoV3nOJ.js","assets/card-QP279vC5.js","assets/loader-circle-Cbf0y8en.js","assets/save-DWxtgCsS.js"])))=>i.map(i=>d[i]);
import{_ as e,c as t,r,t as s,l,d as a,u as n,v as i,j as o,w as d,B as u}from"./index-B10MXRio.js";import{a as c,d as m}from"./helpers-CmqE03mo.js";import{t as h}from"./index-DZIVtcIE.js";import{D as _,a as g,b as v,c as p,L as f,I as C}from"./dialog-Cmrbb0S0.js";import{P as x}from"./progress-DO0KiTbE.js";import{T as y}from"./textarea-G-k_AwYk.js";import{P as b,a as j,b as w}from"./popover-xpcMj7oI.js";import{C as q}from"./calendar-py_FtKCX.js";import{C as N}from"./check-DhkQyFTZ.js";import{M as S}from"./PurchaseDetailModal-BFXKDRQv.js";import{L as E}from"./loader-circle-Cbf0y8en.js";const D=c;function A(e){return e?["KRW","ì›","â‚©"].includes(e)?"â‚©":["USD","$","ë‹¬ëŸ¬"].includes(e)?"$":["EUR","â‚¬"].includes(e)?"â‚¬":["JPY","ì—”","Â¥"].includes(e)||["CNY","ìœ„ì•ˆ","å…ƒ"].includes(e)?"Â¥":e:""}async function z(t){const r=new((await e(()=>import("./exceljs.min-DfVRx8GD.js").then(e=>e.e),__vite__mapDeps([0,1,2]))).Workbook),s=r.addWorksheet("ë°œì£¼ì„œ",{pageSetup:{paperSize:9,orientation:"portrait",fitToPage:!0,fitToWidth:1,fitToHeight:1,horizontalCentered:!0,verticalCentered:!0,margins:{left:.3,right:.3,top:.5,bottom:.5,header:.2,footer:.2}}});s.getRow(1).height=29.8;for(let e=2;e<=60;e++)s.getRow(e).height=15.75;s.getRow(1).eachCell(e=>{e.font={...e.font||{},name:"ë§‘ì€ ê³ ë”•",size:20}});for(let e=2;e<=60;e++)s.getRow(e).eachCell(e=>{e.font={...e.font||{},name:"ë§‘ì€ ê³ ë”•",size:11}});s.mergeCells("A1:G1"),s.mergeCells("A2:B2"),s.mergeCells("C2:D2"),s.mergeCells("F2:G2"),s.mergeCells("A3:B3"),s.mergeCells("C3:D3"),s.mergeCells("F3:G3"),s.mergeCells("A4:B4"),s.mergeCells("C4:D4"),s.mergeCells("F4:G4"),s.mergeCells("A5:B5"),s.mergeCells("C5:D5"),s.mergeCells("F5:G5"),s.mergeCells("A6:B6"),s.mergeCells("C6:D6"),s.mergeCells("F6:G6"),s.mergeCells("A7:B7"),s.mergeCells("C7:D7"),s.mergeCells("F7:G7");try{const e=await fetch("/logo_KOR.png"),t=await e.arrayBuffer(),l=r.addImage({buffer:t,extension:"png"}),a=s.getColumn("D").width||22,n=Math.max(1,7.2*a*.58)+4,i=34,o=3,d=.3;s.addImage(l,{tl:{col:o,row:d},ext:{width:n,height:i}})}catch(h){}s.getCell("D1").value="                ë°œ ì£¼ ì„œ",s.getCell("D1").alignment={horizontal:"left",vertical:"middle",indent:1},s.getCell("D1").font={bold:!0,size:20},s.getCell("A2").value="ì—…   ì²´   ëª…",s.getCell("A2").font={bold:!0},s.getCell("A3").value="ë‹´   ë‹¹   ì",s.getCell("A3").font={bold:!0},s.getCell("A4").value="ì²­   êµ¬   ì¼",s.getCell("A4").font={bold:!0},s.getCell("A5").value="TEL.",s.getCell("A5").font={bold:!0},s.getCell("A6").value="FAX.",s.getCell("A6").font={bold:!0},s.getCell("A7").value="ì…ê³ ìš”ì²­ì¼",s.getCell("A7").font={bold:!0},s.getCell("E2").value="êµ¬ë§¤ìš”ì²­ì",s.getCell("E2").font={bold:!0},s.getCell("E3").value="ì£¼         ì†Œ",s.getCell("E3").font={bold:!0},s.getCell("E4").value="ë°œ ì£¼ ë²ˆ í˜¸",s.getCell("E4").font={bold:!0},s.getCell("E5").value="TEL.",s.getCell("E5").font={bold:!0},s.getCell("E6").value="FAX.",s.getCell("E6").font={bold:!0},s.getCell("E7").value="ì§€ì¶œ ì˜ˆì •ì¼",s.getCell("E7").font={bold:!0},s.getCell("F7").value=t.vendor_payment_schedule||"",s.getCell("C2").value=t.vendor_name,s.getCell("C3").value=t.vendor_contact_name||"",s.getCell("C4").value=D(t.request_date),s.getCell("C5").value=t.vendor_phone||"",s.getCell("C6").value=t.vendor_fax||"",s.getCell("C7").value=D(t.delivery_request_date),s.getCell("F2").value=t.requester_name,s.getCell("F3").value="ëŒ€êµ¬ê´‘ì—­ì‹œ ë‹¬ì„œêµ¬ ì„±ì„œê³µë‹¨ë¶ë¡œ305",s.getCell("F4").value=t.purchase_order_number,s.getCell("F5").value="(053) 626-7805",s.getCell("F6").value="(053) 657-7905",s.getCell("F5").alignment={horizontal:"center",vertical:"middle"},s.getCell("F6").alignment={horizontal:"center",vertical:"middle"};const l=["No","í’ˆëª…","ê·œê²©","ìˆ˜ëŸ‰","ë‹¨ê°€","ê¸ˆì•¡","ë¹„ê³ "];for(let e=0;e<l.length;e++)s.getCell(String.fromCharCode(65+e)+"8").value=l[e],s.getCell(String.fromCharCode(65+e)+"8").font={bold:!0},6===e&&(s.getCell("G8").alignment={horizontal:"center",vertical:"middle"});const a=[...t.items].sort((e,t)=>e.line_number-t.line_number),n=a.length,i=9+Math.max(n,45);for(let e=0;e<a.length;e++){const t=a[e],r=9+e;s.getCell("A"+r).value=t.line_number;const l=s.getCell("B"+r);l.value=t.item_name,l.alignment={horizontal:"left",vertical:"middle"},s.getCell("C"+r).value=t.specification,s.getCell("C"+r).alignment={horizontal:"left",vertical:"middle"},s.getCell("D"+r).value=t.quantity;const n=A(t.currency),i=void 0!==t.unit_price_value&&null!==t.unit_price_value?`${t.unit_price_value.toLocaleString()} ${n}`.trim():"";s.getCell("E"+r).value=i,s.getCell("E"+r).alignment={horizontal:"right",vertical:"middle"};const o=A(t.currency),d=void 0!==t.amount_value&&null!==t.amount_value?`${t.amount_value.toLocaleString()} ${o}`.trim():"";s.getCell("F"+r).value=d,s.getCell("F"+r).alignment={horizontal:"right",vertical:"middle"};const u=s.getCell("G"+r);u.value=void 0!==t.remark&&null!==t.remark?String(t.remark):"",u.alignment={horizontal:"left",vertical:"middle",wrapText:!1,shrinkToFit:!0}}for(let e=n;e<45;e++){const t=9+e;for(let e=0;e<7;e++)s.getCell(String.fromCharCode(65+e)+t).value=""}s.mergeCells(`A${i}:E${i}`),s.getCell("A"+i).value="í•©ê³„",s.getCell("A"+i).font={bold:!0};const o=A(t.items[0]?.currency),d=t.items.reduce((e,t)=>e+(t.amount_value||0),0);s.getCell("F"+i).value=`${d.toLocaleString()} ${o}`.trim(),s.getCell("F"+i).alignment={horizontal:"right",vertical:"middle"};const u=i;for(let e=1;e<=u;e++)for(let t=1;t<=7;t++){const r=String.fromCharCode(64+t)+e,l=s.getCell(r),a=e>=9&&e<i;(5===t||6===t)&&(a||e===i)||3===t&&a||(l.alignment={horizontal:"center",vertical:"middle"}),l.border={top:{style:1===e||2===e||8===e||e===i?"medium":"thin"},left:{style:1===t?"medium":"thin"},right:{style:7===t?"medium":"thin"},bottom:{style:8===e||e===i||e===u?"medium":"thin"}}}for(let e=0;e<n;e++){const t=9+e;s.getCell("C"+t).alignment={horizontal:"left",vertical:"middle"}}for(let e=2;e<=7;e++)s.getCell("B"+e).border={...s.getCell("B"+e).border,right:{style:"medium"}},s.getCell("D"+e).border={...s.getCell("D"+e).border,right:{style:"medium"}},e<=6&&(s.getCell("E"+e).border={...s.getCell("E"+e).border,right:{style:"medium"}});s.getCell("E7").border={...s.getCell("E7").border,top:{style:"thin"},right:{style:"medium"}},s.getCell("G7").border={...s.getCell("G7").border,top:{style:"thin"}};for(let e=1;e<=7;e++){const t=s.getCell("A"+e).border||{};s.getCell("A"+e).border={...t,left:{style:"medium"}}}const c=s.getCell("A"+i).border||{};s.getCell("A"+i).border={...c,left:{style:"medium"}};Object.entries({A:4.7,B:23,C:30,D:11,E:15,F:16,G:37}).forEach(([e,t])=>{s.getColumn(e).width=t}),s.getRow(1).height=29.8,s.getRow(1).eachCell(e=>{e.font={...e.font||{},name:"ë§‘ì€ ê³ ë”•",size:20}});for(let e=2;e<=u;e++){const t=s.getRow(e);t.height=15.75,t.eachCell(e=>{e.font={...e.font||{},name:"ë§‘ì€ ê³ ë”•",size:11}})}for(let e=9;e<=u;e++)s.getCell("G"+e).alignment={horizontal:"left",vertical:"middle",wrapText:!1,shrinkToFit:!0},s.getCell("B"+e).alignment={horizontal:"left",vertical:"middle"};const m=await r.xlsx.writeBuffer();return new Blob([m],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})}const k=t(),F=async(e,t,r)=>{try{const{data:a,error:n}=await k.from("purchase_requests").select("*").eq("purchase_order_number",e.purchase_order_number).single();if(n||!a)return void h.error("í•´ë‹¹ ë°œì£¼ìš”ì²­ë²ˆí˜¸ì˜ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");const{data:i,error:o}=await k.from("purchase_request_items").select("*").eq("purchase_order_number",e.purchase_order_number).order("line_number");if(o||!i||0===i.length)return void h.error("í•´ë‹¹ ë°œì£¼ìš”ì²­ë²ˆí˜¸ì˜ í’ˆëª© ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");const d={vendor_name:e.vendor_name,vendor_phone:"",vendor_fax:"",vendor_contact_name:""};try{const t=a.vendor_id||e.vendor_id,r=a.contact_id||e.contact_id;if(t){const{data:e,error:r}=await k.from("vendors").select("vendor_phone, vendor_fax").eq("id",t).single();e&&!r&&(d.vendor_phone=e.vendor_phone||"",d.vendor_fax=e.vendor_fax||"")}if(r){const{data:e,error:t}=await k.from("vendor_contacts").select("contact_name, contact_phone, contact_email").eq("id",r).single();e&&!t&&(d.vendor_contact_name=e.contact_name||"")}}catch(s){}const u={purchase_order_number:a.purchase_order_number||"",request_date:a.request_date,delivery_request_date:a.delivery_request_date,requester_name:a.requester_name,vendor_name:d.vendor_name||"",vendor_contact_name:d.vendor_contact_name,vendor_phone:d.vendor_phone,vendor_fax:d.vendor_fax,project_vendor:a.project_vendor,sales_order_number:a.sales_order_number,project_item:a.project_item,items:i.map(e=>({line_number:e.line_number,item_name:e.item_name,specification:e.specification,quantity:e.quantity,unit_price_value:e.unit_price_value,amount_value:e.amount_value,remark:e.remark,currency:a.currency||"KRW"}))},c=await z(u),m=`ë°œì£¼ì„œ_${u.vendor_name}_${u.purchase_order_number}.xlsx`,_=window.URL.createObjectURL(c),g=document.createElement("a");g.href=_,g.download=m,document.body.appendChild(g),g.click(),document.body.removeChild(g),window.URL.revokeObjectURL(_),h.success("ì—‘ì…€ íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.");try{if(t&&t.includes("lead buyer")){const{error:t}=await k.from("purchase_requests").update({is_po_download:!0}).eq("purchase_order_number",e.purchase_order_number);t||r?.()}}catch(l){}}catch(s){throw h.error("ì—‘ì…€ ë‹¤ìš´ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."),s}},R=r.lazy(()=>e(()=>import("./PurchaseDetailModal-BFXKDRQv.js").then(e=>e.e),__vite__mapDeps([3,1,2,4,5,6,7,8,9,10,11,12,13,14,15,16])));function T({isOpen:e,onClose:c,purchases:m,onRefresh:D,currentUserName:A}){const[z,k]=r.useState(new Set),[F,T]=r.useState([]),O=r.useRef(!1),$=r.useRef(!1),[B,G]=r.useState(null),[L,M]=r.useState(""),[I,P]=r.useState(""),[U,H]=r.useState(!1),[W,K]=r.useState(null),[Y,J]=r.useState(!1),V=r.useRef(null);r.useEffect(()=>{V.current=W},[W]);const X=r.useRef(c);X.current=c;const Q=t(),Z=r.useCallback(()=>{const e=new Date;e.setHours(0,0,0,0);const t=[];return m.forEach(r=>{if(r.is_received||"completed"===r.delivery_status)return;if("approved"!==r.middle_manager_status||"approved"!==r.final_manager_status)return;if(A&&r.requester_name!==A)return;if(!0===r.delivery_revision_requested)return;const s=r.delivery_request_date?new Date(r.delivery_request_date):null,l=r.revised_delivery_request_date?new Date(r.revised_delivery_request_date):null;s&&s.setHours(0,0,0,0),l&&l.setHours(0,0,0,0),l&&l<e?t.push({purchase:r,warningType:"revision_overdue",daysOverdue:Math.floor((e.getTime()-l.getTime())/864e5)}):s&&s<e&&!l&&t.push({purchase:r,warningType:"delivery_overdue",daysOverdue:Math.floor((e.getTime()-s.getTime())/864e5)})}),t.sort((e,t)=>t.daysOverdue-e.daysOverdue)},[m,A]),[ee,te]=r.useState([]);r.useEffect(()=>{if(e&&!O.current){k(new Set),G(null),$.current=!1;const e=Z();T(e),te(e),O.current=!0}e||(O.current=!1)},[e,Z]),r.useEffect(()=>{if(!e||0===F.length)return;const t=F.filter(e=>{const t=s(e.purchase.id);if(t)return!t.is_received&&"completed"!==t.delivery_status;const r=m.find(t=>t.id===e.purchase.id);return r?!r.is_received&&"completed"!==r.delivery_status:!(e.purchase.is_received||"completed"===e.purchase.delivery_status)});t.length!==ee.length&&te(t),0===t.length&&F.length>0&&!$.current&&($.current=!0,setTimeout(()=>{X.current()},300))},[m,e,F,ee.length]),r.useEffect(()=>{if(!e)return;(0===ee.length||ee.every(e=>z.has(e.purchase.id)||e.purchase.is_received||"completed"===e.purchase.delivery_status))&&ee.length>0&&!$.current&&(l.info("ğŸ” [ì…ê³ ì§€ì—°ì•Œë¦¼] ëª¨ë“  í•­ëª© ì™„ë£Œ, ëª¨ë‹¬ ìë™ ë‹«ê¸°"),$.current=!0,setTimeout(()=>{X.current()},300))},[ee,z,e]);const re=r.useMemo(()=>0===ee.length||ee.every(e=>z.has(e.purchase.id)),[ee,z]),se=r.useMemo(()=>0===ee.length?100:Math.round(z.size/ee.length*100),[ee.length,z.size]);r.useEffect(()=>{100===se&&ee.length>0&&!$.current&&($.current=!0,setTimeout(()=>{X.current()},300))},[se,ee.length]);const le=r.useRef(!0);r.useEffect(()=>{if(!e)return;const t=a(()=>{le.current?le.current=!1:D?.()});return()=>t()},[e,D]);const ae=r.useCallback((e,t)=>{G(e),M(`[ì…ê³ ì¼ ìˆ˜ì •ìš”ì²­] ${t}`),P("")},[]),ne=r.useCallback(async e=>{if(L.trim()&&I.trim()){H(!0);try{const{data:{user:t}}=await Q.auth.getUser();if(!t)return void h.error("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");const{data:r,error:s}=await Q.from("support_inquires").insert({user_id:t.id,user_email:t.email,user_name:A,inquiry_type:"modify",subject:L,message:I,status:"open",purchase_request_id:e.id,purchase_order_number:e.purchase_order_number,requester_id:e.requester_id,purchase_info:JSON.stringify({vendor_name:e.vendor_name,delivery_request_date:e.delivery_request_date,revised_delivery_request_date:e.revised_delivery_request_date})}).select("id").single();if(s)throw s;const l=r?.id;if(l){const{error:e}=await Q.from("support_inquiry_messages").insert({inquiry_id:l,sender_role:"user",sender_email:t.email,message:I,attachments:[]});if(e)throw e}const{error:a}=await Q.from("purchase_requests").update({delivery_revision_requested:!0,delivery_revision_requested_at:(new Date).toISOString(),delivery_revision_requested_by:A||"unknown"}).eq("id",e.id);if(a)throw a;n(e.id,e=>({...e,delivery_revision_requested:!0,delivery_revision_requested_at:(new Date).toISOString(),delivery_revision_requested_by:A||"unknown"}))&&i(),k(t=>new Set(t).add(e.id)),G(null),M(""),P(""),h.success("ìˆ˜ì • ìš”ì²­ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.")}catch(t){h.error("ìˆ˜ì • ìš”ì²­ ì „ì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{H(!1)}}else h.error("ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.")},[Q,A,L,I]),ie=r.useCallback(()=>{re?c():h.error(`ëª¨ë“  í•­ëª©(${ee.length}ê±´)ì— ëŒ€í•´ ìˆ˜ì •ìš”ì²­ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.`)},[re,c,ee.length]),oe=e=>{if(!e)return"-";const t=new Date(e);return`${t.getFullYear()}.${String(t.getMonth()+1).padStart(2,"0")}.${String(t.getDate()).padStart(2,"0")}`},de=r.useCallback(e=>{K(e),J(!0)},[]),ue=r.useCallback(()=>{const e=W;if(J(!1),K(null),e){const t=s(e);if(t){(t.is_received||"completed"===t.delivery_status)&&(te(t=>t.filter(t=>t.purchase.id!==e)),T(t=>t.filter(t=>t.purchase.id!==e)),k(t=>new Set(t).add(e)))}else{const t=m.find(t=>t.id===e);if(t){(t.is_received||"completed"===t.delivery_status)&&(te(t=>t.filter(t=>t.purchase.id!==e)),T(t=>t.filter(t=>t.purchase.id!==e)),k(t=>new Set(t).add(e)))}}D?.(!1,{silent:!0})}},[W,m,D]);return 0===ee.length?null:o.jsxs(o.Fragment,{children:[o.jsx(_,{open:e,onOpenChange:e=>!e&&ie(),children:o.jsxs(g,{className:"max-w-2xl max-h-[80vh] flex flex-col p-0 gap-0",showCloseButton:!1,children:[o.jsxs(v,{className:"px-5 py-4 border-b",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(d,{className:"w-5 h-5 text-red-500"}),o.jsx(p,{className:"page-title text-base",children:"ì…ê³  ì¼ì • ì§€ì—° ì•Œë¦¼"})]}),o.jsxs("span",{className:"text-xs text-gray-500",children:[z.size,"/",ee.length," ì™„ë£Œ"]})]}),o.jsx(x,{value:se,className:"h-1 mt-3"})]}),o.jsx("div",{className:"flex-1 overflow-auto p-4 space-y-2",children:ee.map(e=>{const t=z.has(e.purchase.id);return o.jsx("div",{className:"border rounded-lg p-3 transition-all duration-200 cursor-pointer hover:border-hansl-400 "+(t?"bg-gray-50 opacity-60":"bg-white"),onClick:()=>de(e.purchase.id),children:o.jsxs("div",{className:"flex items-center justify-between gap-3",children:[o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[o.jsx("span",{className:"text-sm font-medium text-gray-900",children:e.purchase.purchase_order_number}),o.jsx("span",{className:"text-xs text-gray-500",children:e.purchase.vendor_name})]}),o.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:[o.jsxs("span",{className:"flex items-center gap-1",children:[o.jsx(q,{className:"w-3 h-3"}),"ì…ê³ ìš”ì²­: ",oe(e.purchase.delivery_request_date)]}),e.purchase.revised_delivery_request_date&&o.jsxs("span",{children:["ë³€ê²½: ",oe(e.purchase.revised_delivery_request_date)]}),o.jsxs("span",{className:"text-red-500",children:[e.daysOverdue,"ì¼ ê²½ê³¼"]})]})]}),o.jsx("div",{className:"flex-shrink-0",onClick:e=>e.stopPropagation(),children:t?o.jsxs(u,{size:"sm",disabled:!0,className:"button-base bg-gray-100 text-gray-500 h-7 px-3 text-xs",children:[o.jsx(N,{className:"w-3 h-3 mr-1"}),"ìš”ì²­ ì™„ë£Œ"]}):o.jsxs(b,{open:B===e.purchase.id,onOpenChange:t=>{t?ae(e.purchase.id,e.purchase.purchase_order_number):G(null)},children:[o.jsx(j,{asChild:!0,children:o.jsxs(u,{size:"sm",className:"button-base bg-hansl-600 hover:bg-hansl-700 text-white h-7 px-3 text-xs",children:[o.jsx(S,{className:"w-3 h-3 mr-1"}),"ìˆ˜ì • ìš”ì²­"]})}),o.jsx(w,{className:"w-80 p-4",align:"end",onOpenAutoFocus:e=>e.preventDefault(),children:o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"font-medium text-sm",children:"ì…ê³ ì¼ ìˆ˜ì • ìš”ì²­"}),o.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:e.purchase.vendor_name})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{children:[o.jsx(f,{className:"text-xs",children:"ì œëª©"}),o.jsx(C,{value:L,onChange:e=>M(e.target.value),className:"h-8 text-xs mt-1"})]}),o.jsxs("div",{children:[o.jsx(f,{className:"text-xs",children:"ë‚´ìš©"}),o.jsx(y,{value:I,onChange:e=>P(e.target.value),className:"min-h-[80px] text-xs mt-1",placeholder:"ë³€ê²½ ìš”ì²­ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"})]})]}),o.jsxs("div",{className:"flex justify-end gap-2",children:[o.jsx(u,{variant:"outline",size:"sm",onClick:()=>G(null),className:"button-base h-7 text-xs",children:"ì·¨ì†Œ"}),o.jsxs(u,{size:"sm",onClick:()=>ne(e.purchase),disabled:U,className:"button-base bg-hansl-600 hover:bg-hansl-700 text-white h-7 text-xs",children:[U&&o.jsx(E,{className:"w-3 h-3 animate-spin mr-1"}),"ìš”ì²­ ì „ì†¡"]})]})]})})]})})]})},e.purchase.id)})}),o.jsx("div",{className:"border-t px-5 py-3",children:o.jsx("p",{className:"text-xs text-gray-500 text-center",children:"â„¹ï¸ ëª¨ë“  ìˆ˜ì • ìš”ì²­ì´ ì™„ë£Œë˜ë©´ ì´ ì°½ì´ ìë™ìœ¼ë¡œ ë‹«í™ë‹ˆë‹¤"})})]})}),W&&o.jsx(r.Suspense,{fallback:o.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[100]",children:o.jsx(E,{className:"w-8 h-8 animate-spin text-white"})}),children:o.jsx(R,{purchaseId:W,isOpen:Y,onClose:ue,activeTab:"receipt",onRefresh:async(e,t)=>{if(D){const r=D(e,t);r instanceof Promise&&await r}const r=V.current;r&&setTimeout(()=>{const e=s(r);if(e){(e.is_received||"completed"===e.delivery_status)&&(te(e=>e.filter(e=>e.purchase.id!==r)),T(e=>e.filter(e=>e.purchase.id!==r)),k(e=>new Set(e).add(r)))}},100)}})})]})}function O(e,t){return r.useMemo(()=>{const r=new Date;r.setHours(0,0,0,0);let s=0;const l=[];e.forEach(e=>{const a="F20251226_003"===e.purchase_order_number;if(e.is_received||"completed"===e.delivery_status)return void(a&&l.push({step:"ì…ê³ ì™„ë£Œë¡œ ì œì™¸",purchase:e.purchase_order_number}));if("approved"!==e.middle_manager_status||"approved"!==e.final_manager_status)return void(a&&l.push({step:"ìŠ¹ì¸ ë¯¸ì™„ë£Œë¡œ ì œì™¸",purchase:e.purchase_order_number,middle:e.middle_manager_status,final:e.final_manager_status}));if(t&&e.requester_name!==t)return void(a&&l.push({step:"ë³¸ì¸ ë°œì£¼ ì•„ë‹˜ìœ¼ë¡œ ì œì™¸",purchase:e.purchase_order_number,requester_name:e.requester_name,currentUserName:t}));if(!0===e.delivery_revision_requested)return void(a&&l.push({step:"ìˆ˜ì •ìš”ì²­ ì™„ë£Œë¡œ ì œì™¸",purchase:e.purchase_order_number}));const n=e.delivery_request_date?new Date(e.delivery_request_date):null,i=e.revised_delivery_request_date?new Date(e.revised_delivery_request_date):null;return n&&n.setHours(0,0,0,0),i&&i.setHours(0,0,0,0),i&&i<r?(s++,void(a&&l.push({step:"ë³€ê²½ìš”ì²­ì¼ ì§€ì—°ìœ¼ë¡œ í¬í•¨",purchase:e.purchase_order_number,revisedDate:m(i),today:r.toISOString()}))):n&&n<r&&!i?(s++,void(a&&l.push({step:"ì…ê³ ìš”ì²­ì¼ ì§€ì—°ìœ¼ë¡œ í¬í•¨",purchase:e.purchase_order_number,deliveryDate:m(n),today:r.toISOString()}))):void(a&&l.push({step:"ë‚ ì§œ ì¡°ê±´ ë¶ˆë§Œì¡±",purchase:e.purchase_order_number,deliveryDate:n?m(n):null,revisedDate:i?m(i):null,today:r.toISOString()}))}),l.length;e.find(e=>"F20251226_003"===e.purchase_order_number);return s},[e,t])}export{T as D,F as d,z as g,O as u};
//# sourceMappingURL=DeliveryDateWarningModal-DQNdFWCn.js.map
