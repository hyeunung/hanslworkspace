{"version":3,"mappings":"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","names":["globalCache","purchases","vendors","employees","lastFetch","userInfo","CACHE_DURATION","filteredData","Map","FILTER_CACHE_DURATION","invalidateFilterCache","tabKey","clear","HIDDEN_EMPLOYEES","FastPurchaseTable","lazy","__vitePreload","import","__VITE_PRELOAD__","TableSkeleton","memo","jsx","className","children","Array","map","_","i","jsxs","displayName","LazyPurchaseTable","activeTab","currentUserRoles","onRefresh","onOptimisticUpdate","onPaymentComplete","onReceiptComplete","Suspense","fallback","PerformanceMonitor","constructor","this","measurements","SLOW_THRESHOLD","getInstance","instance","startMeasure","key","set","performance","now","endMeasure","context","startTime","get","logger","warn","duration","delete","isSlowAction","toFixed","isSlow","threshold","measureAsync","fn","result","error","measureSync","performanceMonitor","PurchaseItemsModal","NAV_TABS","label","PurchaseListMain","onEmailToggle","showEmailButton","navigate","useNavigate","location","useLocation","supabase","createClient","editingId","setEditingId","useState","editingData","setEditingData","selectedPurchase","setSelectedPurchase","isModalOpen","setIsModalOpen","loading","currentUserName","refreshPurchases","loadPurchases","updatePurchaseOptimistic","setPurchases","setVendors","setEmployees","setLoading","setCurrentUserRoles","setCurrentUserName","currentUserEmail","setCurrentUserEmail","currentUserId","setCurrentUserId","initializationRef","useRef","useEffect","async","current","Date","cacheValid","employeeData","roles","purchase_role","isArray","r","String","trim","split","filter","length","name","full_name","email","id","vendorResult","employeeResult","userResult","Promise","all","from","select","auth","getUser","vendorData","data","user","eq","maybeSingle","loadInitialData","useCallback","forceRefresh","options","showSpinner","silent","employeeList","empData","vendorList","authError","toast","order","ascending","limit","today","toISOString","processedData","d","request_date","startsWith","request","firstItem","purchase_request_items","requesterEmployee","find","emp","requester_id","vendorInfo","vendor","vendor_id","Number","purchase_order_number","delivery_request_date","revised_delivery_request_date","progress_type","payment_completed_at","payment_completed_by_name","payment_category","currency","request_type","vendor_name","vendor_payment_schedule","vendor_contacts","requester_name","requester_full_name","item_name","specification","quantity","unit_price_value","amount_value","remark","project_vendor","sales_order_number","project_item","line_number","contact_name","middle_manager_status","final_manager_status","is_received","received_at","is_payment_completed","is_po_download","link","items","sort","a","b","total_amount","reduce","sum","item","purchase_status","purchaseId","updater","prev","next","purchase","usePurchaseData","isAdmin","includes","setActiveTab","filteredPurchases","tabCounts","selectedEmployee","setSelectedEmployee","isPurchaseManager","isLeadBuyer","isHr","roleCase","useMemo","some","computeDefaultEmployee","defaultEmployee","visiblePurchases","p","tabFilteredPurchases","matches","middlePending","finalPending","middleRejected","finalRejected","middleApproved","finalApproved","isRequest","isSeonJin","isIlban","employeeFilteredPurchases","dateA","getTime","countPurchases","getUniqueOrderCount","filtered","Set","size","getFilteredDataForTab","pendingData","purchaseData","receiptData","doneData","pendingFiltered","purchaseFiltered","receiptFiltered","pending","receipt","done","useFastPurchaseFilters","URLSearchParams","search","Badge","variant","handleReceiptComplete","currentTime","requestResult","itemsResult","update","delivery_status","success","handlePaymentComplete","modalName","loadFn","measureModalLoad","modalPurchaseData","style","marginTop","marginBottom","Button","onClick","Plus","tab","tabName","switchFn","measureTabSwitch","Card","CardContent","Package","isOpen","onClose","onUpdate"],"ignoreList":[],"sources":["../../src/hooks/usePurchaseData.ts","../../src/hooks/useFastPurchaseFilters.ts","../../src/components/purchase/LazyPurchaseTable.tsx","../../src/utils/performance.ts","../../src/components/purchase/PurchaseListMain.tsx"],"sourcesContent":["import { useState, useEffect, useCallback, useRef } from 'react';\nimport { createClient } from '@/lib/supabase/client';\nimport { logger } from '@/lib/logger';\nimport { toast } from 'sonner';\n\nexport interface Purchase {\n  id: number;\n  purchase_order_number?: string;\n  request_date: string;\n  delivery_request_date?: string | null;\n  revised_delivery_request_date?: string | null;\n  progress_type: string;\n  is_payment_completed: boolean;\n  payment_category: string;\n  payment_completed_at?: string;\n  payment_completed_by_name?: string;\n  currency: string;\n  request_type: string;\n  vendor?: {\n    vendor_name: string;\n    vendor_payment_schedule?: string;\n  };\n  vendor_name: string;\n  vendor_payment_schedule?: string;\n  vendor_id?: number;\n  contact_id?: number;\n  vendor_contacts?: {\n    contact_name: string;\n  } | Array<{\n    contact_name: string;\n  }>;\n  contact_name?: string;\n  requester_id: string;\n  requester_name: string;\n  requester_full_name: string;\n  project_vendor: string;\n  sales_order_number: string;\n  project_item: string;\n  middle_manager_status?: string;\n  final_manager_status?: string;\n  total_amount: number;\n  is_received: boolean;\n  received_at?: string;\n\n  is_po_download?: boolean;\n  items?: any[];\n  purchase_request_items?: any[];\n  item_name?: string;\n  specification?: string;\n  quantity?: number;\n  unit_price_value?: number;\n  amount_value?: number;\n  remark?: string;\n  line_number?: number;\n  link?: string;\n  purchase_status?: string;\n}\n\nexport interface Vendor {\n  id: number;\n  vendor_name: string;\n  vendor_contacts?: any[];\n}\n\nexport interface Employee {\n  id: string;\n  name: string;\n  email: string;\n  full_name?: string;\n}\n\n// 향상된 캐시 관리\nconst globalCache = {\n  purchases: null as Purchase[] | null,\n  vendors: null as Vendor[] | null,\n  employees: null as Employee[] | null,\n  lastFetch: 0,\n  userInfo: null as any,\n  CACHE_DURATION: 5 * 60 * 1000, // 5분 캐싱으로 연장\n  // 탭별 필터링 결과 캐시\n  filteredData: new Map<string, { data: Purchase[]; timestamp: number }>(),\n  FILTER_CACHE_DURATION: 30 * 1000 // 30초 필터 캐시\n};\n\n// 향상된 캐시 관리 함수들\nexport const clearPurchaseCache = () => {\n  globalCache.purchases = null;\n  globalCache.vendors = null;\n  globalCache.employees = null;\n  globalCache.userInfo = null;\n  globalCache.lastFetch = 0;\n  globalCache.filteredData.clear();\n};\n\n// 부분 캐시 무효화 (탭별)\nexport const invalidateFilterCache = (tabKey?: string) => {\n  if (tabKey) {\n    for (const [key] of globalCache.filteredData.entries()) {\n      if (key.includes(tabKey)) {\n        globalCache.filteredData.delete(key);\n      }\n    }\n  } else {\n    globalCache.filteredData.clear();\n  }\n};\n\nexport const usePurchaseData = () => {\n  const [purchases, setPurchases] = useState<Purchase[]>([]);\n  const [vendors, setVendors] = useState<Vendor[]>([]);\n  const [employees, setEmployees] = useState<Employee[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [currentUserRoles, setCurrentUserRoles] = useState<string[]>([]);\n  const [currentUserName, setCurrentUserName] = useState<string>('');\n  const [currentUserEmail, setCurrentUserEmail] = useState<string>('');\n  const [currentUserId, setCurrentUserId] = useState<string>('');\n  \n  const supabase = createClient();\n  const initializationRef = useRef(false);\n\n  // 초기 데이터 로드 (업체 목록, 사용자 권한) - 캐싱 적용\n  useEffect(() => {\n    const loadInitialData = async () => {\n      if (initializationRef.current) return;\n      initializationRef.current = true;\n      \n      const now = Date.now();\n      const cacheValid = globalCache.lastFetch && (now - globalCache.lastFetch) < globalCache.CACHE_DURATION;\n      \n      try {\n        // 캐시된 데이터가 유효한 경우 사용\n        if (cacheValid && globalCache.vendors && globalCache.employees && globalCache.userInfo) {\n          try {\n            setVendors(globalCache.vendors);\n            setEmployees(globalCache.employees);\n            \n            const employeeData = globalCache.userInfo;\n            if (employeeData) {\n              let roles: string[] = [];\n              if (employeeData.purchase_role) {\n                if (Array.isArray(employeeData.purchase_role)) {\n                  roles = employeeData.purchase_role.map((r: any) => String(r).trim());\n                } else {\n                  const roleString = String(employeeData.purchase_role);\n                  roles = roleString\n                    .split(',')\n                    .map((r: string) => r.trim())\n                    .filter((r: string) => r.length > 0);\n                }\n              }\n              \n              setCurrentUserRoles(roles);\n              setCurrentUserName(employeeData.name || employeeData.full_name || '');\n              setCurrentUserEmail(employeeData.email || '');\n              setCurrentUserId(employeeData.id || '');\n            }\n            return;\n          } catch (error) {\n            logger.error('캐시 데이터 사용 중 오류', error);\n            // 캐시 초기화\n            globalCache.purchases = null;\n            globalCache.vendors = null;\n            globalCache.employees = null;\n            globalCache.userInfo = null;\n            globalCache.lastFetch = 0;\n          }\n        }\n        \n        // 캐시가 없거나 만료된 경우 새로 로드\n        const [vendorResult, employeeResult, userResult] = await Promise.all([\n          supabase.from('vendors').select('*'),\n          supabase.from('employees').select('*'),\n          supabase.auth.getUser()\n        ]);\n\n        if (vendorResult.error) {\n          throw vendorResult.error;\n        }\n        const vendorData = vendorResult.data || [];\n        setVendors(vendorData);\n        globalCache.vendors = vendorData;\n        \n        if (employeeResult.error) {\n          throw employeeResult.error;\n        }\n        const employeeData = employeeResult.data || [];\n        setEmployees(employeeData);\n        globalCache.employees = employeeData;\n\n        // 사용자 권한 및 이름 로드\n        if (userResult.data.user && !userResult.error) {\n          // email로 직원 정보 찾기 (올바른 방법)\n          let employeeData = null;\n          if (userResult.data.user.email) {\n            const emailResult = await supabase\n              .from('employees')\n              .select('*')\n              .eq('email', userResult.data.user.email)\n              .maybeSingle();\n            \n            employeeData = emailResult.data;\n          }\n          \n          if (employeeData) {\n            globalCache.userInfo = employeeData;\n            \n            let roles: string[] = [];\n            if (employeeData.purchase_role) {\n              if (Array.isArray(employeeData.purchase_role)) {\n                roles = employeeData.purchase_role.map((r: any) => String(r).trim());\n              } else {\n                const roleString = String(employeeData.purchase_role);\n                roles = roleString\n                  .split(',')\n                  .map((r: string) => r.trim())\n                  .filter((r: string) => r.length > 0);\n              }\n            }\n            \n            \n            setCurrentUserRoles(roles);\n            setCurrentUserName(employeeData.name || employeeData.full_name || '');\n            setCurrentUserEmail(employeeData.email || '');\n            setCurrentUserId(employeeData.id || '');\n          }\n          \n          globalCache.lastFetch = now;\n        }\n      } catch (error) {\n        logger.error('초기 데이터 로드 실패', error);\n      }\n    };\n\n    loadInitialData();\n  }, []);\n\n  // 발주 목록 로드 - 향상된 캐싱 및 최적화\n  const loadPurchases = useCallback(async (forceRefresh?: boolean, options?: { silent?: boolean }) => {\n    const showSpinner = !options?.silent;\n\n    if (showSpinner) {\n      setLoading(true);\n    }\n    \n    try {\n      // 캐시 확인\n      const now = Date.now();\n      const cacheValid = globalCache.lastFetch && (now - globalCache.lastFetch) < globalCache.CACHE_DURATION;\n      \n      // 강제 새로고침 시 필터 캐시도 무효화\n      if (forceRefresh) {\n        invalidateFilterCache();\n        globalCache.purchases = null;\n        globalCache.lastFetch = 0;\n      }\n      \n      if (!forceRefresh && cacheValid && globalCache.purchases) {\n        try {\n          setPurchases(globalCache.purchases);\n          if (showSpinner) {\n            setLoading(false);\n          }\n          return;\n        } catch (error) {\n          logger.error('발주 데이터 캐시 사용 중 오류', error);\n          // 캐시 초기화\n          globalCache.purchases = null;\n          globalCache.lastFetch = 0;\n          invalidateFilterCache();\n        }\n      }\n      \n      // employees 데이터 준비\n      let employeeList = employees;\n      if (employeeList.length === 0) {\n        employeeList = globalCache.employees || [];\n        if (employeeList.length === 0) {\n          const { data: empData } = await supabase\n            .from('employees')\n            .select('*');\n          employeeList = empData || [];\n        }\n      }\n      \n      // vendors 데이터 준비\n      let vendorList = vendors;\n      if (vendorList.length === 0) {\n        vendorList = globalCache.vendors || [];\n        if (vendorList.length === 0) {\n          const { data: vendorData } = await supabase\n            .from('vendors')\n            .select('*');\n          vendorList = vendorData || [];\n        }\n      }\n      \n      const { data: { user }, error: authError } = await supabase.auth.getUser();\n      \n      if (authError || !user) {\n        logger.error('사용자 인증 실패', authError);\n        toast.error('로그인이 필요합니다.');\n        if (showSpinner) {\n          setLoading(false);\n        }\n        return;\n      }\n\n      // 승인대기 항목을 놓치지 않기 위해 시간 제한 제거\n      \n      // 먼저 purchase_requests만 가져오기 (vendors JOIN 제거)\n      const { data, error } = await supabase\n        .from('purchase_requests')\n        .select(`\n          *,\n          purchase_request_items(*)\n        `)\n        .order('request_date', { ascending: false })\n        .limit(1000); // 성능 최적화: 최대 1000건\n\n      if (error) {\n        throw error;\n      }\n\n      \n      // 오늘 발주 항목 확인\n      const today = new Date().toISOString().split('T')[0];\n      const todayItems = (data || []).filter((d: any) => d.request_date?.startsWith(today));\n\n      // 데이터 변환 (hanslwebapp과 동일)\n      const processedData = (data || []).map((request: any) => {\n        // 첫 번째 품목 정보 (기존 방식과 호환성 유지)\n        const firstItem = request.purchase_request_items?.[0] || {};\n        \n        // requester_id로 employee 찾기\n        const requesterEmployee = employeeList.find(emp => emp.id === request.requester_id);\n        \n        // vendor_id로 vendor 찾기\n        const vendorInfo = vendorList.find(vendor => vendor.id === request.vendor_id);\n        \n        return {\n          id: Number(request.id),\n          purchase_order_number: request.purchase_order_number as string,\n          request_date: request.request_date as string,\n          delivery_request_date: request.delivery_request_date ?? null,\n          revised_delivery_request_date: request.revised_delivery_request_date ?? null,\n          progress_type: request.progress_type as string,\n          payment_completed_at: request.payment_completed_at as string,\n          payment_completed_by_name: request.payment_completed_by_name as string,\n          payment_category: request.payment_category as string,\n          currency: request.currency as string,\n          request_type: request.request_type as string,\n          vendor: undefined, // vendors JOIN 제거됨\n          vendor_name: request.vendor_name || '', // purchase_requests 테이블의 vendor_name 사용\n          vendor_payment_schedule: vendorInfo?.vendor_payment_schedule || '', // vendors 테이블에서 조회\n          vendor_contacts: [], // vendors JOIN 없으므로 빈배열\n          requester_id: request.requester_id as string,\n          requester_name: request.requester_name as string,\n          requester_full_name: requesterEmployee?.full_name || requesterEmployee?.name || request.requester_name || '',\n          item_name: firstItem.item_name as string || '',\n          specification: firstItem.specification as string || '',\n          quantity: Number(firstItem.quantity) || 0,\n          unit_price_value: Number(firstItem.unit_price_value) || 0,\n          amount_value: Number(firstItem.amount_value) || 0,\n          remark: firstItem.remark as string || '',\n          project_vendor: request.project_vendor as string,\n          sales_order_number: request.sales_order_number as string,\n          project_item: request.project_item as string,\n          line_number: Number(firstItem.line_number) || 1,\n          contact_name: '', // vendor_contacts JOIN 없으므로 빈값\n          middle_manager_status: request.middle_manager_status,\n          final_manager_status: request.final_manager_status,\n          is_received: !!request.is_received,\n          received_at: request.received_at as string,\n          is_payment_completed: !!request.is_payment_completed,\n          is_po_download: !!request.is_po_download,\n          link: firstItem.link as string | undefined,\n          // 전체 품목 리스트 추가 (hanslwebapp과 동일하게 items로 통일) - line_number로 정렬\n          items: (request.purchase_request_items || []).sort((a: any, b: any) => \n            (a.line_number || 0) - (b.line_number || 0)),\n          // 총 금액 계산\n          total_amount: request.purchase_request_items?.reduce((sum: number, item: any) => \n            sum + (Number(item.amount_value) || 0), 0) || 0,\n          purchase_status: request.purchase_status || 'pending'\n        };\n      });\n\n\n      // 데이터 로드 완료 및 캐싱\n      setPurchases(processedData);\n      globalCache.purchases = processedData;\n      globalCache.lastFetch = now;\n    } catch (error) {\n      logger.error('발주 목록 로드 실패', error);\n      toast.error('발주 목록을 불러올 수 없습니다.');\n    } finally {\n      if (showSpinner) {\n        setLoading(false);\n      }\n    }\n  }, [employees]);\n\n  const updatePurchaseOptimistic = useCallback((purchaseId: number, updater: (prev: Purchase) => Purchase) => {\n    setPurchases(prev => {\n      const next = prev.map(purchase => (purchase.id === purchaseId ? updater(purchase) : purchase));\n      globalCache.purchases = next;\n      return next;\n    });\n  }, []);\n\n  useEffect(() => {\n    loadPurchases();\n  }, [loadPurchases]);\n\n  return {\n    purchases,\n    vendors,\n    employees,\n    loading,\n    currentUserRoles,\n    currentUserName,\n    currentUserEmail,\n    currentUserId,\n    refreshPurchases: loadPurchases,\n    updatePurchaseOptimistic\n  };\n};\n","import { useState, useMemo, useEffect, useCallback } from 'react';\nimport { createClient } from '@/lib/supabase/client';\nimport { Purchase } from './usePurchaseData';\n\n// 상수 정의 - 특정 직원의 발주요청 숨김 (본인이 아닌 경우에만)\nconst HIDDEN_EMPLOYEES = ['정희웅'];  // 정현웅 제거\n\nexport const useFastPurchaseFilters = (purchases: Purchase[], currentUserRoles: string[], currentUserName: string, currentUserId?: string, currentUserEmail?: string) => {\n  const supabase = createClient();\n  const [activeTab, setActiveTab] = useState('pending');\n  // 초기값 설정 - hanslwebapp과 동일하게 빈 문자열로 시작\n  const [selectedEmployee, setSelectedEmployee] = useState<string>('');\n\n  // 권한별 로직 계산\n  const isAdmin = currentUserRoles?.includes('app_admin');\n  const isFinalApprover = currentUserRoles?.includes('final_approver');\n  const isMiddleManager = currentUserRoles?.includes('middle_manager');\n  const isPurchaseManager = currentUserRoles?.includes('purchase_manager');\n  const hasApprovalRole = isAdmin || isFinalApprover || isMiddleManager;\n  \n  // lead buyer 권한 체크 추가\n  const isLeadBuyer = currentUserRoles?.includes('raw_material_manager') || \n                      currentUserRoles?.includes('consumable_manager') || \n                      currentUserRoles?.includes('purchase_manager');\n                      \n  // HR 권한 체크 추가\n  const isHr = currentUserRoles?.includes('hr');\n\n  // hanslwebapp과 동일한 로직 - roleCase 계산 (lead buyer 추가)\n  const roleCase = useMemo(() => {\n    if (!currentUserRoles || currentUserRoles.length === 0) return 1; // null\n    if (isPurchaseManager) return 2; // purchase_manager\n    if (currentUserRoles.some(r => ['middle_manager', 'final_approver', 'app_admin', 'ceo'].includes(r))) return 3;\n    return 1;\n  }, [currentUserRoles, isPurchaseManager]);\n  \n  // 탭별 기본 직원 필터 계산 (구매현황, 입고현황은 lead buyer, HR, app_admin만 전체 보기)\n  const computeDefaultEmployee = useCallback(\n    (tabKey: string): string => {\n      if (!currentUserName) return 'all';\n      \n      // 구매현황 탭은 lead buyer, HR, app_admin만 전체 보기\n      if (tabKey === 'purchase') {\n        if (isLeadBuyer || isHr || isAdmin) {\n          return 'all';\n        }\n        return currentUserName;\n      }\n      \n      // 입고현황 탭은 lead buyer, HR, app_admin만 전체 보기\n      if (tabKey === 'receipt') {\n        if (isLeadBuyer || isHr || isAdmin) {\n          return 'all';\n        }\n        return currentUserName;\n      }\n      \n      switch (roleCase) {\n        case 1: // role null\n          if (tabKey === 'done') return 'all';\n          return currentUserName;\n        case 2: // purchase_manager\n          if (tabKey === 'done') return 'all';\n          return currentUserName; // pending & receipt\n        case 3: // 관리자 권한\n          return 'all';\n        default:\n          return currentUserName;\n      }\n    },\n    [currentUserName, roleCase, isLeadBuyer, isHr, isAdmin]\n  );\n  \n  // 탭 변경 또는 사용자/역할 로딩 시 기본값 설정 (hanslwebapp과 동일)\n  useEffect(() => {\n    if (!currentUserName) return;\n    const defaultEmployee = computeDefaultEmployee(activeTab);\n    setSelectedEmployee(defaultEmployee);\n  }, [activeTab, currentUserName, roleCase, computeDefaultEmployee]);\n  \n  // 1단계: 권한별 필터링 (실시간 반영)\n  const visiblePurchases = useMemo(() => {\n    // 권한 체크 최적화 - 한 번만 계산\n    const hasManagerRole = currentUserRoles.includes('purchase_manager') || currentUserRoles.includes('app_admin');\n    \n    const result = hasManagerRole \n      ? purchases \n      : purchases.filter(p => !HIDDEN_EMPLOYEES.includes(p.requester_name));\n    return result;\n  }, [purchases, currentUserRoles]);\n\n\n  // 2단계: 탭별 필터링\n  const tabFilteredPurchases = useMemo(() => {\n    // 오늘 날짜 계산 (한국 시간 기준)\n    const today = new Date().toISOString().split('T')[0];\n    \n    const result = visiblePurchases.filter((purchase: Purchase) => {\n      let matches = false;\n      \n      switch (activeTab) {\n        case 'pending':\n          // 중간승인자나 최종승인자 중 하나라도 pending이면 승인대기\n          const middlePending = ['pending', '대기', '', null, undefined].includes(purchase.middle_manager_status as any);\n          const finalPending = ['pending', '대기', '', null, undefined].includes(purchase.final_manager_status as any);\n          \n          // 반려된 경우는 제외\n          const middleRejected = purchase.middle_manager_status === 'rejected';\n          const finalRejected = purchase.final_manager_status === 'rejected';\n          \n          if (middleRejected || finalRejected) return false;\n          \n          // 승인 완료된 경우 즉시 제거\n          const middleApproved = purchase.middle_manager_status === 'approved';\n          const finalApproved = purchase.final_manager_status === 'approved';\n          \n          if (middleApproved && finalApproved) {\n            return false; // 최종 승인 완료된 항목은 즉시 제거\n          }\n          \n          // 중간승인 대기 또는 최종승인 대기\n          matches = middlePending || finalPending;\n          \n          return matches;\n          \n        case 'purchase': {\n          // DB 확인 결과: '구매 요청' (띄어쓰기 있음) 또는 '발주'\n          const isRequest = purchase.payment_category === '구매 요청';\n          const isSeonJin = (purchase.progress_type || '').includes('선진행');\n          const isIlban = (purchase.progress_type || '').includes('일반');\n          const finalApproved = purchase.final_manager_status === 'approved';\n          \n          // 구매 완료된 경우 즉시 제거\n          if (purchase.is_payment_completed) {\n            return false; // 구매완료된 항목은 즉시 제거\n          }\n          \n          // 기본 구매현황 조건: 요청 유형이고 아직 결제되지 않음\n          if (!isRequest) {\n            matches = false;\n          } else {\n            matches = (isSeonJin) || (isIlban && finalApproved);\n          }\n          \n          return matches;\n        }\n        \n        case 'receipt': {\n          // 입고현황: 미입고 & (선진행 or 최종승인)\n          const isSeonJin = (purchase.progress_type || '').includes('선진행');\n          const finalApproved = purchase.final_manager_status === 'approved';\n          \n          // 입고 완료된 경우 즉시 제거\n          if (purchase.is_received) {\n            return false; // 입고완료된 항목은 즉시 제거\n          }\n          \n          // 기본 입고현황 조건: (선진행 or 최종승인)\n          matches = (isSeonJin || finalApproved);\n          return matches;\n        }\n        \n        case 'done':\n          matches = true;\n          return matches;\n          \n        default:\n          return true;\n      }\n    });\n    return result;\n  }, [visiblePurchases, activeTab]);\n\n  // 3단계: 직원 필터링\n  const employeeFilteredPurchases = useMemo(() => {\n    let result;\n    if (selectedEmployee && selectedEmployee !== 'all' && selectedEmployee !== '전체') {\n      result = tabFilteredPurchases.filter((purchase: Purchase) => purchase.requester_name === selectedEmployee);\n    } else {\n      result = tabFilteredPurchases;\n    }\n    return result;\n  }, [tabFilteredPurchases, selectedEmployee]);\n\n  // 4단계: 최종 정렬 및 결과 캐싱 - 최신순 (내림차순)\n  const filteredPurchases = useMemo(() => {\n    return [...employeeFilteredPurchases].sort((a, b) => {\n      const dateA = a.request_date ? new Date(a.request_date).getTime() : 0\n      const dateB = b.request_date ? new Date(b.request_date).getTime() : 0\n      return dateB - dateA\n    })\n  }, [employeeFilteredPurchases]);\n\n  // 탭 카운트 (hanslwebapp과 동일한 조건)\n  const tabCounts = useMemo(() => {\n    // 특정 직원 발주요청 숨김 처리\n    const countPurchases = visiblePurchases;\n    \n    // 날짜 필터 제거 - 전체 데이터 사용\n    const dateFilteredForCount = countPurchases;\n    \n    // 각 탭의 고유 발주요청번호 카운트 (중복 제거)\n    const getUniqueOrderCount = (filtered: Purchase[]) => {\n      return new Set(filtered.map(p => p.purchase_order_number)).size;\n    };\n    \n    // 각 탭별로 기본 직원 필터 계산 (카운트용)\n    const getFilteredDataForTab = (tabKey: string) => {\n      // 구매현황 탭은 특별 처리\n      if (tabKey === 'purchase') {\n        if (isLeadBuyer || isHr || isAdmin) {\n          return countPurchases;\n        } else {\n          return countPurchases.filter((p: Purchase) => p.requester_name === currentUserName);\n        }\n      }\n      \n      // 입고현황 탭은 특별 처리\n      if (tabKey === 'receipt') {\n        if (isLeadBuyer || isHr || isAdmin) {\n          return countPurchases;\n        } else {\n          return countPurchases.filter((p: Purchase) => p.requester_name === currentUserName);\n        }\n      }\n      \n      const defaultEmployee = computeDefaultEmployee(tabKey);\n      \n      if (defaultEmployee === 'all' || defaultEmployee === '전체') {\n        return countPurchases;\n      } else {\n        return countPurchases.filter((p: Purchase) => p.requester_name === defaultEmployee);\n      }\n    };\n    \n    // 각 탭별 데이터 필터링\n    const pendingData = getFilteredDataForTab('pending');\n    const purchaseData = getFilteredDataForTab('purchase');\n    const receiptData = getFilteredDataForTab('receipt');\n    const doneData = getFilteredDataForTab('done');\n    \n    const pendingFiltered = pendingData.filter((p: Purchase) => {\n      // 오늘 날짜\n      const today = new Date().toISOString().split('T')[0];\n      \n      // 중간승인자나 최종승인자 중 하나라도 pending이면 승인대기\n      const middlePending = ['pending', '대기', '', null, undefined].includes(p.middle_manager_status as any);\n      const finalPending = ['pending', '대기', '', null, undefined].includes(p.final_manager_status as any);\n      \n      // 반려된 경우는 제외\n      const middleRejected = p.middle_manager_status === 'rejected';\n      const finalRejected = p.final_manager_status === 'rejected';\n      \n      if (middleRejected || finalRejected) return false;\n      \n      // 승인 완료된 경우 즉시 제거\n      const middleApproved = p.middle_manager_status === 'approved';\n      const finalApproved = p.final_manager_status === 'approved';\n      \n      if (middleApproved && finalApproved) {\n        return false; // 최종 승인 완료된 항목은 즉시 제거\n      }\n      \n      // 중간승인 대기 또는 최종승인 대기\n      return middlePending || finalPending;\n    });\n    \n    const purchaseFiltered = purchaseData.filter((p: Purchase) => {\n      // 오늘 날짜\n      const today = new Date().toISOString().split('T')[0];\n      \n      const isRequest = p.payment_category === '구매 요청';\n      const isSeonJin = (p.progress_type || '').includes('선진행');\n      const isIlban = (p.progress_type || '').includes('일반');\n      const finalApproved = p.final_manager_status === 'approved';\n      \n      // 구매 완료된 경우 즉시 제거\n      if (p.is_payment_completed) {\n        return false; // 구매완료된 항목은 즉시 제거\n      }\n      \n      if (!isRequest) return false;\n      return (isSeonJin) || (isIlban && finalApproved);\n    });\n    \n    const receiptFiltered = receiptData.filter((p: Purchase) => {\n      // 오늘 날짜\n      const today = new Date().toISOString().split('T')[0];\n      \n      const isSeonJin = (p.progress_type || '').includes('선진행');\n      const finalApproved = p.final_manager_status === 'approved';\n      \n      // 입고 완료된 경우 즉시 제거\n      if (p.is_received) {\n        return false; // 입고완료된 항목은 즉시 제거\n      }\n      \n      return (isSeonJin || finalApproved);\n    });\n    \n    const counts = {\n      pending: getUniqueOrderCount(pendingFiltered),\n      purchase: getUniqueOrderCount(purchaseFiltered),\n      receipt: getUniqueOrderCount(receiptFiltered),\n      done: getUniqueOrderCount(doneData)  // 전체 항목\n    };\n    \n    return counts;\n  }, [visiblePurchases, roleCase, currentUserName, computeDefaultEmployee, isLeadBuyer, isHr, isAdmin]);\n\n\n  return {\n    // States\n    activeTab,\n    selectedEmployee,\n    \n    // Setters\n    setActiveTab,\n    setSelectedEmployee,\n    \n    // Computed values\n    filteredPurchases,\n    tabCounts\n  };\n};","import { memo, lazy, Suspense } from 'react';\nimport { Purchase } from '@/hooks/usePurchaseData';\n\n// Lazy load the heavy table component\nconst FastPurchaseTable = lazy(() => import('./FastPurchaseTable'));\n\ninterface LazyPurchaseTableProps {\n  purchases: Purchase[];\n  activeTab: string;\n  currentUserRoles: string[];\n  onRefresh: (forceRefresh?: boolean, options?: { silent?: boolean }) => Promise<void> | void;\n  onOptimisticUpdate: (purchaseId: number, updater: (prev: Purchase) => Purchase) => void;\n  onPaymentComplete: (id: number) => Promise<void>;\n  onReceiptComplete: (id: number) => Promise<void>;\n}\n\n// Memoized loading component\nconst TableSkeleton = memo(() => (\n  <div className=\"p-4 space-y-4\">\n    {[...Array(5)].map((_, i) => (\n      <div key={i} className=\"flex space-x-4 animate-pulse\">\n        <div className=\"h-4 bg-gray-200 rounded w-1/4\"></div>\n        <div className=\"h-4 bg-gray-200 rounded w-1/4\"></div>\n        <div className=\"h-4 bg-gray-200 rounded w-1/4\"></div>\n        <div className=\"h-4 bg-gray-200 rounded w-1/4\"></div>\n      </div>\n    ))}\n  </div>\n));\nTableSkeleton.displayName = 'TableSkeleton';\n\n// Main component with memoization\nconst LazyPurchaseTable = memo<LazyPurchaseTableProps>(({\n  purchases,\n  activeTab,\n  currentUserRoles,\n  onRefresh,\n  onOptimisticUpdate,\n  onPaymentComplete,\n  onReceiptComplete\n}) => (\n  <Suspense fallback={<TableSkeleton />}>\n    <FastPurchaseTable\n      purchases={purchases}\n      activeTab={activeTab}\n      currentUserRoles={currentUserRoles}\n      onRefresh={onRefresh}\n      onOptimisticUpdate={onOptimisticUpdate}\n      onPaymentComplete={onPaymentComplete}\n      onReceiptComplete={onReceiptComplete}\n    />\n  </Suspense>\n));\n\nLazyPurchaseTable.displayName = 'LazyPurchaseTable';\n\nexport default LazyPurchaseTable;","// 성능 모니터링 유틸리티\nimport { logger } from '@/lib/logger';\n\nclass PerformanceMonitor {\n  private static instance: PerformanceMonitor;\n  private measurements: Map<string, number> = new Map();\n  private readonly SLOW_THRESHOLD = 1000; // 1초 이상이면 느림\n\n  static getInstance(): PerformanceMonitor {\n    if (!PerformanceMonitor.instance) {\n      PerformanceMonitor.instance = new PerformanceMonitor();\n    }\n    return PerformanceMonitor.instance;\n  }\n\n  // 측정 시작\n  startMeasure(key: string): void {\n    this.measurements.set(key, performance.now());\n  }\n\n  // 측정 종료 및 로깅\n  endMeasure(key: string, context?: string): number {\n    const startTime = this.measurements.get(key);\n    if (!startTime) {\n      logger.warn('성능 측정 시작 시간을 찾을 수 없습니다', { key });\n      return 0;\n    }\n\n    const duration = performance.now() - startTime;\n    this.measurements.delete(key);\n\n    const isSlowAction = duration > this.SLOW_THRESHOLD;\n    const logLevel = isSlowAction ? 'warn' : 'debug';\n    \n    logger[logLevel](`⚡ 성능 측정: ${key}`, {\n      duration: `${duration.toFixed(2)}ms`,\n      context,\n      isSlow: isSlowAction,\n      threshold: `${this.SLOW_THRESHOLD}ms`\n    });\n\n    return duration;\n  }\n\n  // 비동기 함수 성능 측정\n  async measureAsync<T>(key: string, fn: () => Promise<T>, context?: string): Promise<T> {\n    this.startMeasure(key);\n    try {\n      const result = await fn();\n      this.endMeasure(key, context);\n      return result;\n    } catch (error) {\n      this.endMeasure(key, `Error: ${context}`);\n      throw error;\n    }\n  }\n\n  // 동기 함수 성능 측정\n  measureSync<T>(key: string, fn: () => T, context?: string): T {\n    this.startMeasure(key);\n    try {\n      const result = fn();\n      this.endMeasure(key, context);\n      return result;\n    } catch (error) {\n      this.endMeasure(key, `Error: ${context}`);\n      throw error;\n    }\n  }\n}\n\n// 전역 인스턴스 생성\nexport const performanceMonitor = PerformanceMonitor.getInstance();\n\n// Hook for measuring component render times\nexport const useRenderPerformance = (componentName: string) => {\n  const measureRender = () => {\n    performanceMonitor.startMeasure(`render-${componentName}`);\n    // Use requestAnimationFrame to measure after render completion\n    requestAnimationFrame(() => {\n      performanceMonitor.endMeasure(`render-${componentName}`, 'Component render');\n    });\n  };\n\n  return { measureRender };\n};\n\n// 탭 전환 성능 측정 헬퍼\nexport const measureTabSwitch = async (tabName: string, switchFn: () => Promise<void> | void) => {\n  return performanceMonitor.measureAsync(\n    `tab-switch-${tabName}`,\n    async () => {\n      const result = switchFn();\n      if (result instanceof Promise) {\n        await result;\n      }\n    },\n    `Tab switch to ${tabName}`\n  );\n};\n\n// 모달 로딩 성능 측정 헬퍼\nexport const measureModalLoad = async (modalName: string, loadFn: () => Promise<void> | void) => {\n  return performanceMonitor.measureAsync(\n    `modal-load-${modalName}`,\n    async () => {\n      const result = loadFn();\n      if (result instanceof Promise) {\n        await result;\n      }\n    },\n    `Modal load: ${modalName}`\n  );\n};","\nimport { useState, lazy, Suspense, useEffect, useCallback, useMemo } from \"react\";\nimport { useNavigate, useLocation } from \"react-router-dom\";\nimport { usePurchaseData, clearPurchaseCache } from \"@/hooks/usePurchaseData\";\nimport { useFastPurchaseFilters } from \"@/hooks/useFastPurchaseFilters\";\nimport LazyPurchaseTable from \"@/components/purchase/LazyPurchaseTable\";\n\nimport { Plus, Package } from \"lucide-react\";\nimport { generatePurchaseOrderExcelJS, PurchaseOrderData } from \"@/utils/exceljs/generatePurchaseOrderExcel\";\n\n// Lazy load modal for better performance\nconst PurchaseItemsModal = lazy(() => import(\"@/components/purchase/PurchaseItemsModal\"));\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\n// Tabs 컴포넌트를 제거하고 직접 구현 (hanslwebapp 방식)\nimport { Button } from \"@/components/ui/button\";\nimport { createClient } from \"@/lib/supabase/client\";\nimport { toast } from \"sonner\";\nimport { Purchase } from \"@/hooks/usePurchaseData\";\nimport { measureTabSwitch, measureModalLoad, useRenderPerformance } from \"@/utils/performance\";\n\ninterface PurchaseListMainProps {\n  onEmailToggle?: () => void;\n  showEmailButton?: boolean;\n}\n\n// 화면 상단의 탭(진행상태별) 목록\nconst NAV_TABS: { key: string; label: string }[] = [\n  { key: 'pending', label: '승인대기' },\n  { key: 'purchase', label: '구매 현황' },\n  { key: 'receipt', label: '입고 현황' },\n  { key: 'done', label: '전체 항목' },\n];\n\n// 발주 목록 메인 컴포넌트\nexport default function PurchaseListMain({ onEmailToggle, showEmailButton = true }: PurchaseListMainProps) {\n  const navigate = useNavigate();\n  const location = useLocation();\n  const supabase = createClient();\n  const [editingId, setEditingId] = useState<number | null>(null);\n  const [editingData, setEditingData] = useState<any>({});\n  const [selectedPurchase, setSelectedPurchase] = useState<Purchase | null>(null);\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  \n  // 성능 모니터링\n  const { measureRender } = useRenderPerformance('PurchaseListMain');\n  \n  // 발주 데이터 및 사용자 정보\n  const {\n    purchases,\n    vendors,\n    employees,\n    loading,\n    currentUserRoles,\n    currentUserName,\n    currentUserEmail,\n    currentUserId,\n    refreshPurchases: loadPurchases,\n    updatePurchaseOptimistic\n  } = usePurchaseData();\n  \n  const isAdmin = currentUserRoles?.includes('app_admin');\n  \n\n  // 필터링 및 탭 관리\n  const {\n    activeTab,\n    selectedEmployee,\n    setActiveTab,\n    setSelectedEmployee,\n    filteredPurchases,\n    tabCounts\n  } = useFastPurchaseFilters(purchases, currentUserRoles, currentUserName, currentUserId, currentUserEmail);\n  \n  // URL 쿼리 파라미터에서 탭 설정\n  useEffect(() => {\n    const searchParams = new URLSearchParams(location.search);\n    const tab = searchParams.get('tab');\n    if (tab === 'purchase') {\n      setActiveTab('purchase');\n    }\n  }, [location.search, setActiveTab]);\n  \n\n  // 상태에 따른 배지 생성 - 메모이제이션 적용\n  const getStatusBadge = useCallback((purchase: Purchase) => {\n    if (purchase.is_received) {\n      return <Badge variant={null} className=\"badge-success\">입고완료</Badge>;\n    } else if (purchase.middle_manager_status === 'approved' && purchase.final_manager_status === 'approved') {\n      return <Badge variant={null} className=\"badge-primary\">구매진행</Badge>;\n    } else if (purchase.middle_manager_status === 'rejected' || purchase.final_manager_status === 'rejected') {\n      return <Badge variant={null} className=\"badge-danger\">반려</Badge>;\n    } else {\n      return <Badge variant={null} className=\"badge-warning\">승인대기</Badge>;\n    }\n  }, []);\n\n  // 입고 현황 계산\n  const getReceiptProgress = (purchase: Purchase) => {\n    if (!purchase.items || purchase.items.length === 0) return { received: 0, total: 0, percentage: 0 };\n    \n    const total = purchase.items.length;\n    const received = purchase.items.filter(item => \n      item.actual_received_date !== null && item.actual_received_date !== undefined\n    ).length;\n    const percentage = total > 0 ? Math.round((received / total) * 100) : 0;\n    \n    return { received, total, percentage };\n  };\n\n  // 선진행 체크 함수\n  const isAdvancePayment = (progress_type?: string) => {\n    return progress_type === '선진행' || progress_type?.trim() === '선진행' || progress_type?.includes('선진행');\n  };\n\n  // 편집 시작\n  const handleEditStart = (purchase: Purchase) => {\n    if (!currentUserRoles || !currentUserRoles.includes('app_admin')) return;\n    setEditingId(purchase.id);\n    setEditingData({\n      vendor_name: purchase.vendor_name,\n      project_vendor: purchase.project_vendor,\n      sales_order_number: purchase.sales_order_number,\n      project_item: purchase.project_item,\n      delivery_request_date: purchase.delivery_request_date ? \n        purchase.delivery_request_date.split('T')[0] : '',\n      total_amount: purchase.total_amount,\n    });\n  };\n\n  // 편집 저장\n  const handleEditSave = async () => {\n    if (!currentUserRoles || !currentUserRoles.includes('app_admin') || !editingId) return;\n    \n    try {\n      const { error } = await supabase\n        .from('purchase_requests')\n        .update(editingData)\n        .eq('id', editingId);\n\n      if (error) throw error;\n\n      toast.success('수정이 완료되었습니다.');\n      setEditingId(null);\n      setEditingData({});\n      await loadPurchases();\n    } catch (error) {\n      toast.error('수정 중 오류가 발생했습니다.');\n    }\n  };\n\n  // 편집 취소\n  const handleEditCancel = () => {\n    setEditingId(null);\n    setEditingData({});\n  };\n\n  // 엑셀 다운로드\n  const handleExcelDownload = async (purchase: Purchase) => {\n    try {\n      // DB에서 직접 모든 품목 조회\n      const { data: purchaseRequest, error: requestError } = await supabase\n        .from('purchase_requests')\n        .select('*')\n        .eq('purchase_order_number', purchase.purchase_order_number)\n        .single();\n\n      if (requestError || !purchaseRequest) {\n        toast.error('해당 발주요청번호의 데이터를 찾을 수 없습니다.');\n        return;\n      }\n\n      // 품목 데이터 조회\n      const { data: orderItems, error: itemsError } = await supabase\n        .from('purchase_request_items')\n        .select('*')\n        .eq('purchase_order_number', purchase.purchase_order_number)\n        .order('line_number');\n\n      if (itemsError || !orderItems || orderItems.length === 0) {\n        toast.error('해당 발주요청번호의 품목 데이터를 찾을 수 없습니다.');\n        return;\n      }\n\n      // 업체 상세 정보 및 담당자 정보 조회\n      const vendorInfo = {\n        vendor_name: purchase.vendor_name,\n        vendor_phone: '',\n        vendor_fax: '',\n        vendor_contact_name: ''\n      };\n\n      try {\n        const vendorId = purchaseRequest.vendor_id || purchase.vendor_id;\n        const contactId = purchaseRequest.contact_id || purchase.contact_id;\n        \n        // vendor 정보 조회\n        if (vendorId) {\n          const { data: vendorData, error: vendorError } = await supabase\n            .from('vendors')\n            .select('vendor_phone, vendor_fax')\n            .eq('id', vendorId)\n            .single();\n\n          if (vendorData && !vendorError) {\n            vendorInfo.vendor_phone = vendorData.vendor_phone || '';\n            vendorInfo.vendor_fax = vendorData.vendor_fax || '';\n          }\n        }\n\n        // vendor_contacts에서 contact_id로 담당자 정보 조회\n        if (contactId) {\n          const { data: contactData, error: contactError } = await supabase\n            .from('vendor_contacts')\n            .select('contact_name, contact_phone, contact_email')\n            .eq('id', contactId)\n            .single();\n          if (contactData && !contactError) {\n            vendorInfo.vendor_contact_name = contactData.contact_name || '';\n          }\n        }\n      } catch (error) {\n      }\n\n      const excelData: PurchaseOrderData = {\n        purchase_order_number: purchaseRequest.purchase_order_number || '',\n        request_date: purchaseRequest.request_date,\n        delivery_request_date: purchaseRequest.delivery_request_date,\n        requester_name: purchaseRequest.requester_name,\n        vendor_name: vendorInfo.vendor_name || '',\n        vendor_contact_name: vendorInfo.vendor_contact_name,\n        vendor_phone: vendorInfo.vendor_phone,\n        vendor_fax: vendorInfo.vendor_fax,\n        project_vendor: purchaseRequest.project_vendor,\n        sales_order_number: purchaseRequest.sales_order_number,\n        project_item: purchaseRequest.project_item,\n        items: orderItems.map((item: any) => ({\n          line_number: item.line_number,\n          item_name: item.item_name,\n          specification: item.specification,\n          quantity: item.quantity,\n          unit_price_value: item.unit_price_value,\n          amount_value: item.amount_value,\n          remark: item.remark,\n          currency: purchaseRequest.currency || 'KRW'\n        }))\n      };\n\n      // 코드 기반 ExcelJS 생성 (템플릿 없이 서식 직접 정의)\n      const blob = await generatePurchaseOrderExcelJS(excelData);\n      \n      // 다운로드용 파일명: 발주서_{업체명}_발주요청번호\n      const downloadFilename = `발주서_${excelData.vendor_name}_${excelData.purchase_order_number}.xlsx`;\n\n      // 사용자에게 즉시 다운로드 제공\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = downloadFilename;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      window.URL.revokeObjectURL(url);\n      \n      toast.success('엑셀 파일이 다운로드되었습니다.');\n      \n      // DB에 다운로드 완료 플래그(is_po_download) 업데이트 - lead buyer만 해당\n      try {\n        const isLeadBuyer = currentUserRoles && currentUserRoles.includes('lead buyer');\n\n        if (isLeadBuyer) {\n          const { error: downloadFlagErr } = await supabase\n            .from('purchase_requests')\n            .update({ is_po_download: true })\n            .eq('purchase_order_number', purchase.purchase_order_number);\n          if (downloadFlagErr) {\n          } else {\n            // 화면 업데이트\n            await loadPurchases();\n          }\n        }\n      } catch (flagErr) {\n      }\n    } catch (error) {\n      toast.error('엑셀 다운로드에 실패했습니다.');\n    }\n  };\n\n  // 최적화된 핸들러들 - 메모이제이션 및 배치 처리\n  const handleReceiptComplete = useCallback(async (purchaseId: number) => {\n    try {\n      const currentTime = new Date().toISOString();\n      \n      // 병렬 처리로 성능 개선\n      const [requestResult, itemsResult] = await Promise.all([\n        supabase\n          .from('purchase_requests')\n          .update({ \n            is_received: true,\n            received_at: currentTime\n          })\n          .eq('id', purchaseId),\n        supabase\n          .from('purchase_request_items')\n          .update({ \n            is_received: true,\n            delivery_status: 'received'\n          })\n          .eq('purchase_request_id', purchaseId)\n      ]);\n\n      if (requestResult.error) throw requestResult.error;\n      if (itemsResult.error) throw itemsResult.error;\n      \n      toast.success('입고완료 처리되었습니다.');\n      await loadPurchases();\n    } catch (error) {\n      toast.error('처리 중 오류가 발생했습니다.');\n    }\n  }, [supabase, loadPurchases]);\n\n  const handlePaymentComplete = useCallback(async (purchaseId: number) => {\n    try {\n      const currentTime = new Date().toISOString();\n      \n      // 병렬 처리로 성능 개선\n      const [requestResult, itemsResult] = await Promise.all([\n        supabase\n          .from('purchase_requests')\n          .update({ \n            is_payment_completed: true,\n            payment_completed_at: currentTime\n          })\n          .eq('id', purchaseId),\n        supabase\n          .from('purchase_request_items')\n          .update({ \n            is_payment_completed: true\n          })\n          .eq('purchase_request_id', purchaseId)\n      ]);\n\n      if (requestResult.error) throw requestResult.error;\n      if (itemsResult.error) throw itemsResult.error;\n      \n      toast.success('구매완료 처리되었습니다.');\n      await loadPurchases();\n    } catch (error) {\n      toast.error('처리 중 오류가 발생했습니다.');\n    }\n  }, [supabase, loadPurchases]);\n\n  const handleItemsClick = useCallback((purchase: Purchase) => {\n    measureModalLoad('PurchaseItems', () => {\n      setSelectedPurchase(purchase);\n      setIsModalOpen(true);\n    });\n  }, []);\n  \n  // 모달 데이터 메모이제이션 - 불필요한 재계산 방지\n  const modalPurchaseData = useMemo(() => {\n    if (!selectedPurchase) return null;\n    return {\n      ...selectedPurchase,\n      vendor_name: selectedPurchase.vendor_name || '',\n      project_vendor: selectedPurchase.project_vendor || '',\n      sales_order_number: selectedPurchase.sales_order_number || '',\n      project_item: selectedPurchase.project_item || ''\n    };\n  }, [selectedPurchase]);\n\n  return (\n    <div className=\"w-full\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4\">\n        <div>\n          <h1 className=\"page-title\">발주요청 관리</h1>\n          <p className=\"page-subtitle\" style={{marginTop:'-2px',marginBottom:'-4px'}}>Purchase Management</p>\n        </div>\n        <Button \n          onClick={() => navigate('/purchase/new')}\n          className=\"mt-4 sm:mt-0 bg-hansl-500 hover:bg-hansl-600\"\n        >\n          <Plus className=\"w-4 h-4 mr-2\" />\n          새 발주요청 작성\n        </Button>\n      </div>\n\n\n      {/* 직접 구현한 탭 (hanslwebapp 방식) - 빠른 성능 */}\n      <div className=\"space-y-3\">\n        {/* 탭 버튼들 - 모바일 반응형 개선 */}\n        <div className=\"flex flex-col sm:flex-row sm:space-x-1 space-y-1 sm:space-y-0 bg-gray-50 p-1 business-radius-card border border-gray-200\">\n          {NAV_TABS.map((tab) => (\n            <button\n              key={tab.key}\n              onClick={() => measureTabSwitch(tab.key, () => {\n                setActiveTab(tab.key);\n                // 탭 변경 시 조용히 최신 데이터 로드 (silent: true로 로딩 스피너 방지)\n                loadPurchases(false, { silent: true });\n              })}\n              className={`flex-1 flex items-center justify-center space-x-2 py-1.5 px-3 sm:px-4 business-radius-button button-text font-medium transition-colors ${\n                activeTab === tab.key\n                  ? 'text-hansl-600 bg-white shadow-sm border border-gray-200'\n                  : 'text-gray-600 bg-transparent hover:text-gray-900 hover:bg-white/50'\n              }`}\n            >\n              <span className=\"whitespace-nowrap\">{tab.label}</span>\n              <Badge \n                variant=\"secondary\" \n                className={\n                  activeTab === tab.key \n                    ? 'badge-stats-active' \n                    : 'badge-stats-secondary'\n                }\n              >\n                {tabCounts[tab.key as keyof typeof tabCounts]}\n              </Badge>\n            </button>\n          ))}\n        </div>\n\n        {/* 탭 콘텐츠 */}\n        <Card className=\"overflow-hidden border border-gray-200\">\n          <CardContent className=\"p-0\">\n            {loading ? (\n              <div className=\"flex items-center justify-center py-12\">\n                <div className=\"w-8 h-8 border-2 border-hansl-500 border-t-transparent rounded-full animate-spin\" />\n                <span className=\"ml-3 card-subtitle\">로딩 중...</span>\n              </div>\n            ) : filteredPurchases.length === 0 ? (\n              <div className=\"text-center py-12\">\n                <Package className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" />\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">발주요청서가 없습니다</h3>\n                <p className=\"card-subtitle\">새로운 발주요청서를 작성해보세요.</p>\n              </div>\n            ) : (\n              <LazyPurchaseTable \n                purchases={filteredPurchases} \n                activeTab={activeTab}\n                currentUserRoles={currentUserRoles}\n                onRefresh={loadPurchases}\n                onOptimisticUpdate={updatePurchaseOptimistic}\n                onPaymentComplete={handlePaymentComplete}\n                onReceiptComplete={handleReceiptComplete}\n              />\n            )}\n          </CardContent>\n        </Card>\n      </div>\n      \n      {/* 세부항목 모달 - 성능 최적화된 데이터 사용 */}\n      {modalPurchaseData && (\n        <Suspense fallback={<div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\"><div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-white\"></div></div>}>\n          <PurchaseItemsModal\n            isOpen={isModalOpen}\n            onClose={() => {\n              setIsModalOpen(false);\n              setSelectedPurchase(null);\n            }}\n            purchase={modalPurchaseData}\n            isAdmin={isAdmin || false}\n            onUpdate={loadPurchases}\n            activeTab={activeTab}\n          />\n        </Suspense>\n      )}\n    </div>\n  );\n}"],"file":"PurchaseListMain-Cz537uJM.js"}