import{c as e,j as t,O as s,k as a,ac as r,r as l,B as n,a as i,P as o,a8 as c,X as d}from"./index-CNRi0fa-.js";import{t as m}from"./index-BN3EsZpb.js";import{C as x,c as h}from"./card-BZLpR7tU.js";import{I as p}from"./index-CQIOmfy_.js";import{P as u,L as g}from"./label-CWTZ56uz.js";import{C as f,a as b,b as w,f as y,c as j,d as N,e as v}from"./command-xmkHMwAO.js";import{P as _,a as C,b as k}from"./popover-D7zMeslD.js";import{T as S,a as T,b as O,c as F,d as M,e as E}from"./table-BQJO4wY3.js";import{E as B}from"./exceljs.min-7cFO-Ls5.js";import{R as D}from"./rotate-ccw-DXz0jAPk.js";import{S as I}from"./save-BkmGCXDu.js";import{D as R}from"./download-UHQ_52Wl.js";import{read as L,utils as U}from"./xlsx-ByDo_lG2.js";import{E as A}from"./eye-BmBRNiO3.js";import{C as Q}from"./check-BEYEu3Qd.js";
/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=e("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),$=r("inline-flex items-center justify-center rounded-full px-2.5 py-0.5 text-[11px] font-semibold w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none transition-all duration-150 overflow-hidden uppercase tracking-wider",{variants:{variant:{default:"bg-hansl-100 text-hansl-700 border border-hansl-200/50",secondary:"bg-gray-100 text-gray-700 border border-gray-200/50",success:"bg-green-100 text-green-700 border border-green-200/50",warning:"bg-amber-100 text-amber-700 border border-amber-200/50",destructive:"bg-red-100 text-red-700 border border-red-200/50",info:"bg-blue-100 text-blue-700 border border-blue-200/50",outline:"border border-gray-300 text-gray-600 bg-white",pending:"bg-yellow-50 text-yellow-700 border border-yellow-200/50",approved:"bg-green-50 text-green-700 border border-green-200/50",rejected:"bg-red-50 text-red-700 border border-red-200/50"}},defaultVariants:{variant:"default"}});function z({className:e,variant:r,asChild:l=!1,...n}){const i=l?s:"span";return t.jsx(i,{"data-slot":"badge",className:a($({variant:r}),e),...n})}const q=l.forwardRef(({className:e,value:s,...r},l)=>t.jsx("div",{ref:l,className:a("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",e),...r,children:t.jsx("div",{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})}));async function W(e,t,s,a){const r=new B.Workbook;try{const e=await fetch("/templates/BOM_Template.xlsx");if(e.ok){const t=await e.arrayBuffer();await r.xlsx.load(t)}else{const e=r.addWorksheet("BOM");e.getRow(1).values=["No","종류","품명","SET","수량","재고","CHECK","REF","대체가능품목","비고"],e.getRow(1).font={bold:!0}}}catch(u){const e=r.addWorksheet("BOM");e.getRow(1).values=["No","종류","품명","SET","수량","재고","CHECK","REF","대체가능품목","비고"],e.getRow(1).font={bold:!0}}r.creator="HANSL AI System",r.modified=new Date;let l=r.getWorksheet("BOM");l||(l=r.worksheets[0]),l||(l=r.addWorksheet("BOM"));let n=6,i=!1;if(l.eachRow((e,t)=>{if(i)return;const s=e.values;Array.isArray(s)&&(s.some(e=>e&&e.toString().includes("번호"))||s.some(e=>e&&e.toString().includes("No")))&&(n=t+1,i=!0)}),s){let e=!1;for(let t=1;t<n;t++){if(l.getRow(t).eachCell(t=>{t.value&&t.value.toString().includes("부품리스트")&&(t.value=`${s} 부품리스트`,e=!0)}),e)break}}const o=n,c=n+1,d=l.getRow(o);let m=a||0;0===m&&e.length>0&&e[0].setCount>0&&(m=Math.round(e[0].totalQuantity/e[0].setCount)),d.getCell(3).value=`** ${s}   ${m} SET`,d.getCell(3).font={bold:!0,name:"맑은 고딕",size:10},d.getCell(3).alignment={horizontal:"left",vertical:"middle"},e.forEach((e,t)=>{const s=c+t;let a=l.getRow(s);a.getCell(1).value=t+1,a.getCell(2).value=e.itemType||"",a.getCell(3).value=e.itemName,a.getCell(4).value=e.setCount,a.getCell(5).value=e.totalQuantity,a.getCell(6).value=e.stockQuantity||"",a.getCell(7).value=e.checkStatus||"□양호",a.getCell(8).value=Array.isArray(e.refList)?e.refList.join(", "):e.refList,a.getCell(9).value=e.alternativeItem||"",a.getCell(10).value=e.remark||"",a.eachCell({includeEmpty:!0},(e,t)=>{t<=10&&(e.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},e.alignment={vertical:"middle",wrapText:!0},[1,2,4,5,6,7,10].includes(t)?e.alignment={...e.alignment,horizontal:"center"}:e.alignment={...e.alignment,horizontal:"left"})}),a.commit()});const x=t.filter(e=>e.side?.toUpperCase().includes("TOP")||e.layer?.toUpperCase().includes("TOP")),h=t.filter(e=>e.side?.toUpperCase().includes("BOT")||e.layer?.toUpperCase().includes("BOT"));await V(r,"TOP",x),await V(r,"BOTTOM",h);const p=await r.xlsx.writeBuffer();return new Blob([p],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})}async function V(e,t,s){if(0===s.length)return;let a=e.getWorksheet(t);a?0===a.rowCount&&(a.getRow(1).values=["Type","RefDes","Layer","LocationX","LocationY","Rotation"]):(a=e.addWorksheet(t),a.getRow(1).values=["Type","RefDes","Layer","LocationX","LocationY","Rotation"],a.getRow(1).font={bold:!0});s.forEach((e,t)=>{const s=a.getRow(2+t);s.values=[e.partType||"SMD",e.ref||"",e.side||e.layer||"",e.x,e.y,e.angle||e.rotation||0],s.eachCell({includeEmpty:!0},e=>{e.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},e.alignment={horizontal:"center",vertical:"middle"}})}),a.columns.forEach(e=>{e.width=15})}function K({bomItems:e,coordinates:s,boardName:a,productionQuantity:r,onSave:i}){const[o,c]=l.useState(e),[d,x]=l.useState(null),h=(e,t,s)=>{const a=[...o],r={...a[e]};r[t]="setCount"===t||"totalQuantity"===t||"stockQuantity"===t?Number(s)||0:s,a[e]=r,c(a)};return t.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 sm:gap-4",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"text-base sm:text-lg font-semibold",children:"정리된 BOM 미리보기"}),t.jsx("p",{className:"text-xs sm:text-sm text-gray-500 mt-1",children:"데이터를 클릭하여 직접 수정할 수 있습니다. 확인 후 엑셀로 다운로드하세요."})]}),t.jsxs("div",{className:"flex flex-wrap gap-2 w-full sm:w-auto",children:[t.jsxs(n,{onClick:()=>{confirm("모든 수정사항을 초기화하시겠습니까?")&&c(e)},className:"flex-1 sm:flex-initial button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 text-xs sm:text-sm",children:[t.jsx(D,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"}),"초기화"]}),t.jsxs(n,{onClick:()=>{i(o),m.success("수정사항이 저장되었습니다.")},className:"flex-1 sm:flex-initial button-base bg-blue-500 hover:bg-blue-600 text-white text-xs sm:text-sm",children:[t.jsx(I,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"}),"저장"]}),t.jsxs(n,{onClick:async()=>{try{if(!o||0===o.length)throw new Error("BOM 데이터가 없습니다. 데이터를 확인해주세요.");if(!a||""===a.trim())throw new Error("보드 이름이 설정되지 않았습니다.");const e=o.filter((e,t)=>!e.itemName||void 0===e.setCount||void 0===e.totalQuantity);if(e.length>0)throw new Error(`${e.length}개 항목에 필수 데이터가 누락되었습니다. (품명, SET, 수량 확인 필요)`);const t=await W(o,s,a,r);if(!t||0===t.size)throw new Error("엑셀 파일 생성에 실패했습니다. (빈 파일)");const l=window.URL.createObjectURL(t),n=document.createElement("a");n.href=l,n.download=`${a}.xlsx`,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(l),m.success("엑셀 파일이 다운로드되었습니다.")}catch(e){let t="알 수 없는 오류";e instanceof Error&&(t=e.message,t.includes("Template")||t.includes("템플릿")?t="템플릿 파일을 불러오는데 실패했습니다. 관리자에게 문의하세요.":t.includes("parse")||t.includes("파싱")?t="데이터 형식이 올바르지 않습니다. 데이터를 확인해주세요.":(t.includes("memory")||t.includes("메모리"))&&(t="파일이 너무 커서 처리할 수 없습니다. 데이터를 줄여주세요.")),m.error(`다운로드 중 오류가 발생했습니다: ${t}`)}},className:"flex-1 sm:flex-initial button-base bg-green-500 hover:bg-green-600 text-white text-xs sm:text-sm",children:[t.jsx(R,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"}),"Excel"]})]})]}),t.jsxs("div",{className:"border rounded-lg overflow-hidden bg-white shadow-sm",children:[t.jsx("div",{className:"overflow-x-auto max-h-[400px] sm:max-h-[500px] lg:max-h-[600px]",children:t.jsxs(S,{children:[t.jsx(T,{className:"bg-gray-50 sticky top-0 z-10",children:t.jsxs(O,{children:[t.jsx(F,{className:"w-[40px] sm:w-[50px] text-center text-xs",children:"No"}),t.jsx(F,{className:"w-[60px] sm:w-[80px] text-center text-xs",children:"종류"}),t.jsx(F,{className:"min-w-[120px] sm:min-w-[200px] text-xs",children:"품명"}),t.jsx(F,{className:"w-[50px] sm:w-[60px] text-center text-xs",children:"SET"}),t.jsx(F,{className:"w-[60px] sm:w-[80px] text-center text-xs",children:"수량"}),t.jsx(F,{className:"w-[50px] sm:w-[60px] text-center text-xs hidden sm:table-cell",children:"재고"}),t.jsx(F,{className:"w-[70px] sm:w-[80px] text-center text-xs",children:"CHECK"}),t.jsx(F,{className:"min-w-[120px] sm:min-w-[200px] text-xs",children:"REF"}),t.jsx(F,{className:"w-[100px] sm:w-[150px] text-xs hidden md:table-cell",children:"대체품"}),t.jsx(F,{className:"w-[100px] sm:w-[150px] text-xs",children:"비고"})]})}),t.jsx(M,{children:o.map((e,s)=>t.jsxs(O,{className:"hover:bg-gray-50",children:[t.jsx(E,{className:"text-center text-gray-500",children:s+1}),t.jsx(E,{className:"p-1",children:t.jsx(p,{className:"h-7 sm:h-8 text-center border-transparent hover:border-gray-200 focus:border-primary text-xs",value:e.itemType||"",onChange:e=>h(s,"itemType",e.target.value)})}),t.jsx(E,{className:"p-1",children:t.jsx(p,{className:"h-7 sm:h-8 border-transparent hover:border-gray-200 focus:border-primary font-medium text-xs",value:e.itemName,onChange:e=>h(s,"itemName",e.target.value)})}),t.jsx(E,{className:"p-1",children:t.jsx(p,{type:"number",className:"h-7 sm:h-8 text-center border-transparent hover:border-gray-200 focus:border-primary text-xs",value:e.setCount,onChange:e=>h(s,"setCount",e.target.value)})}),t.jsx(E,{className:"p-1",children:t.jsx(p,{type:"number",className:"h-7 sm:h-8 text-center border-transparent hover:border-gray-200 focus:border-primary bg-gray-50 text-xs",value:e.totalQuantity,readOnly:!0,onChange:e=>h(s,"totalQuantity",e.target.value)})}),t.jsx(E,{className:"p-1 hidden sm:table-cell",children:t.jsx(p,{type:"number",className:"h-8 text-center border-transparent hover:border-gray-200 focus:border-primary text-xs",value:e.stockQuantity||"",placeholder:"0",onChange:e=>h(s,"stockQuantity",e.target.value)})}),t.jsx(E,{className:"p-1",children:t.jsxs("select",{className:"w-full h-7 sm:h-8 text-center text-xs border-transparent hover:border-gray-200 focus:border-primary bg-transparent rounded outline-none cursor-pointer",value:e.checkStatus||"□양호",onChange:e=>h(s,"checkStatus",e.target.value),children:[t.jsx("option",{value:"□양호",children:"□양호"}),t.jsx("option",{value:"□불량",children:"□불량"}),t.jsx("option",{value:"□확인필요",children:"□확인필요"})]})}),t.jsx(E,{className:"p-1",children:t.jsx("textarea",{className:"w-full min-h-[28px] sm:min-h-[32px] p-1 text-xs border border-transparent hover:border-gray-200 focus:border-primary rounded resize-y bg-transparent outline-none",value:e.refList||"",onChange:e=>h(s,"refList",e.target.value),rows:1})}),t.jsx(E,{className:"p-1 hidden md:table-cell",children:t.jsx(p,{className:"h-8 border-transparent hover:border-gray-200 focus:border-primary text-xs",value:e.alternativeItem||"",onChange:e=>h(s,"alternativeItem",e.target.value)})}),t.jsx(E,{className:"p-1",children:t.jsx(p,{className:"h-7 sm:h-8 border-transparent hover:border-gray-200 focus:border-primary text-xs "+("미삽"===e.remark?"text-red-500 font-bold":""),value:e.remark||"",onChange:e=>h(s,"remark",e.target.value)})})]},s))})]})}),t.jsxs("div",{className:"bg-gray-50 p-2 sm:p-3 border-t text-xs text-gray-500 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2",children:[t.jsxs("span",{children:["총 ",o.length,"개 항목"]}),t.jsx("span",{className:"text-[10px] sm:text-xs",children:"* 셀을 클릭하여 직접 수정할 수 있습니다. 수정 후 '변경사항 저장'을 눌러주세요."})]})]})]})}q.displayName="Progress";const H=l.createContext(null),X=l.forwardRef(({className:e,defaultValue:s,value:r,onValueChange:n,...i},o)=>{const[c,d]=l.useState(s||""),m=void 0!==r?r:c,x=l.useCallback(e=>{n?n(e):d(e)},[n]);return t.jsx(H.Provider,{value:{value:m,onValueChange:x},children:t.jsx("div",{ref:o,className:a("",e),...i})})});X.displayName="Tabs";const Y=l.forwardRef(({className:e,...s},r)=>t.jsx("div",{ref:r,className:a("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...s}));Y.displayName="TabsList";const G=l.forwardRef(({className:e,value:s,onClick:r,...n},i)=>{const o=l.useContext(H);if(!o)throw new Error("TabsTrigger must be used within a Tabs component");const c=o.value===s;return t.jsx("button",{ref:i,type:"button",role:"tab","aria-selected":c,"data-state":c?"active":"inactive",className:a("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),onClick:e=>{o.onValueChange(s),r?.(e)},...n})});G.displayName="TabsTrigger";const Z=l.forwardRef(({className:e,value:s,...r},n)=>{const i=l.useContext(H);if(!i)throw new Error("TabsContent must be used within a Tabs component");return i.value!==s?null:t.jsx("div",{ref:n,role:"tabpanel",className:a("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...r})});function J({coordinates:e}){const s=e.filter(e=>e.side?.toUpperCase().includes("TOP")),a=e.filter(e=>e.side?.toUpperCase().includes("BOT"));return t.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2 sm:gap-4",children:[t.jsx("h3",{className:"text-base sm:text-lg font-semibold",children:"좌표 데이터 미리보기"}),t.jsxs("div",{className:"flex gap-2 text-xs sm:text-sm text-gray-500",children:[t.jsxs(z,{variant:"outline",className:"text-[10px] sm:text-xs",children:["TOP: ",s.length,"개"]}),t.jsxs(z,{variant:"outline",className:"text-[10px] sm:text-xs",children:["BOTTOM: ",a.length,"개"]})]})]}),t.jsx("div",{className:"border rounded-lg bg-white shadow-sm p-3 sm:p-4",children:t.jsxs(X,{defaultValue:"all",className:"w-full",children:[t.jsxs(Y,{className:"mb-3 sm:mb-4 w-full grid grid-cols-3",children:[t.jsxs(G,{value:"all",className:"text-xs sm:text-sm",children:["전체 (",e.length,")"]}),t.jsxs(G,{value:"top",className:"text-xs sm:text-sm",children:["TOP (",s.length,")"]}),t.jsxs(G,{value:"bottom",className:"text-xs sm:text-sm",children:["BOTTOM (",a.length,")"]})]}),t.jsx(Z,{value:"all",className:"mt-0",children:t.jsx(ee,{data:e})}),t.jsx(Z,{value:"top",className:"mt-0",children:t.jsx(ee,{data:s})}),t.jsx(Z,{value:"bottom",className:"mt-0",children:t.jsx(ee,{data:a})})]})})]})}function ee({data:e}){return t.jsx("div",{className:"overflow-x-auto max-h-[300px] sm:max-h-[400px] border rounded",children:t.jsxs(S,{children:[t.jsx(T,{className:"bg-gray-50 sticky top-0 z-10",children:t.jsxs(O,{children:[t.jsx(F,{className:"w-[60px] sm:w-[80px] text-center text-xs",children:"Ref"}),t.jsx(F,{className:"min-w-[100px] sm:min-w-[150px] text-xs",children:"Part Name"}),t.jsx(F,{className:"w-[60px] sm:w-[80px] text-center text-xs hidden sm:table-cell",children:"Type"}),t.jsx(F,{className:"w-[60px] sm:w-[80px] text-center text-xs",children:"Side"}),t.jsx(F,{className:"w-[60px] sm:w-[80px] text-center text-xs",children:"X"}),t.jsx(F,{className:"w-[60px] sm:w-[80px] text-center text-xs",children:"Y"}),t.jsx(F,{className:"w-[60px] sm:w-[80px] text-center text-xs hidden md:table-cell",children:"Angle"})]})}),t.jsx(M,{children:0===e.length?t.jsx(O,{children:t.jsx(E,{colSpan:7,className:"text-center py-6 sm:py-8 text-gray-500 text-xs sm:text-sm",children:"데이터가 없습니다."})}):e.map((e,s)=>t.jsxs(O,{className:"hover:bg-gray-50 text-[10px] sm:text-xs",children:[t.jsx(E,{className:"text-center font-medium",children:e.ref}),t.jsx(E,{className:"truncate max-w-[100px] sm:max-w-[150px]",title:e.partName,children:e.partName}),t.jsx(E,{className:"text-center hidden sm:table-cell",children:e.partType||"SMD"}),t.jsx(E,{className:"text-center",children:t.jsx(z,{variant:"TOP"===e.side?"default":"secondary",className:"text-[9px] sm:text-[10px] px-1 py-0 h-4 sm:h-5",children:e.side})}),t.jsx(E,{className:"text-center font-mono text-gray-600",children:e.x}),t.jsx(E,{className:"text-center font-mono text-gray-600",children:e.y}),t.jsx(E,{className:"text-center font-mono text-gray-600 hidden md:table-cell",children:e.angle})]},s))})]})})}async function te(e){return new Promise((t,s)=>{const a=new FileReader;a.onload=a=>{const r=a.target?.result;if(r)if(e.name.match(/\.(xlsx|xls)$/i))try{const e=L(r,{type:"array"}),s=e.SheetNames[0],a=e.Sheets[s],l=[],n=U.decode_range(a["!ref"]||"A1:A1");for(let t=n.s.r;t<=n.e.r;++t){const e=[];for(let s=n.s.c;s<=Math.min(n.e.c,10);++s){const r={c:s,r:t},l=a[U.encode_cell(r)];l&&void 0!==l.v?e.push(String(l.v).trim()):e.push("")}e.some(e=>""!==e)&&l.push(e.join("\t"))}t(l.join("\n"))}catch(l){s(new Error("엑셀 파일 파싱에 실패했습니다."))}else{const e=new TextDecoder("utf-8");r instanceof ArrayBuffer?t(e.decode(r)):t(r)}else s(new Error("파일을 읽을 수 없습니다."))},a.onerror=e=>s(e),e.name.match(/\.(xlsx|xls)$/i),a.readAsArrayBuffer(e)})}function se(){const[e,s]=l.useState("create"),[r,S]=l.useState("input"),[T,O]=l.useState({bomFile:null,coordFile:null}),[F,M]=l.useState({boardName:"",artworkManager:"",productionManager:"",productionQuantity:0}),[E,B]=l.useState([]),[D,I]=l.useState(null),[L,U]=l.useState(!1),[$,V]=l.useState(!1),[H,X]=l.useState(!1),[Y,G]=l.useState(null),[Z,ee]=l.useState(null),[se,ae]=l.useState([]),[re,le]=l.useState(!1),[ne,ie]=l.useState(null),[oe,ce]=l.useState(null),[de,me]=l.useState(null),[xe,he]=l.useState(0),[pe,ue]=l.useState(""),ge=i();l.useEffect(()=>{(async()=>{try{const{data:e}=await ge.from("employees").select("id, name").order("name");e&&B(e);const{data:{user:t}}=await ge.auth.getUser();if(t&&t.email){const{data:e}=await ge.from("employees").select("name").eq("email",t.email).single();I({email:t.email,name:e?.name||t.email.split("@")[0]}),M(s=>({...s,artworkManager:e?.name||t.email.split("@")[0]}))}}catch(e){}})()},[ge]),l.useEffect(()=>{(async()=>{if("list"===e)try{le(!0);const{data:e,error:t}=await ge.from("cad_drawings").select("id, board_name, created_at").order("created_at",{ascending:!1});if(t)throw t;const s=await Promise.all((e||[]).map(async e=>{const{count:t}=await ge.from("bom_items").select("*",{count:"exact",head:!0}).eq("cad_drawing_id",e.id);return{...e,item_count:t||0}}));ae(s)}catch(t){m.error("저장된 BOM 목록을 불러오는데 실패했습니다.")}finally{le(!1)}})()},[e,ge]),l.useEffect(()=>{if(T.bomFile){let e=T.bomFile.name;e=e.replace(/\.(xlsx|xls|csv)$/i,""),e=e.replace(/(\.|_|\s)?(part)?(\.|_|\s)?bom$/i,""),e=e.replace(/^\d+_bom_/,"");const t=new Date,s=t.getFullYear().toString().slice(2)+(t.getMonth()+1).toString().padStart(2,"0")+t.getDate().toString().padStart(2,"0");e=`${e}_${s}_정리본`,M(t=>({...t,boardName:e}))}},[T.bomFile]);const fe=l.useCallback((e,t)=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?ee(t):"dragleave"===e.type&&ee(null)},[]),be=l.useCallback((e,t)=>{if(e.preventDefault(),e.stopPropagation(),ee(null),e.dataTransfer.files&&e.dataTransfer.files[0]){const s=e.dataTransfer.files[0];O("bom"===t?e=>({...e,bomFile:s}):e=>({...e,coordFile:s}))}},[]),we=l.useCallback((e,t)=>{if(e.target.files&&e.target.files[0]){const s=e.target.files[0];O("bom"===t?e=>({...e,bomFile:s}):e=>({...e,coordFile:s}))}},[]),ye=l.useCallback(e=>{O("bom"===e?e=>({...e,bomFile:null,bomUrl:void 0}):e=>({...e,coordFile:null,coordUrl:void 0}))},[]),je=()=>{S("input"),O({bomFile:null,coordFile:null}),M(e=>({...e,boardName:"",productionManager:"",productionQuantity:0})),G(null),ce(null)};return t.jsxs("div",{className:"w-full",children:[t.jsx("div",{className:"mb-4",children:t.jsxs("div",{children:[t.jsx("h1",{className:"page-title",children:"BOM/좌표 정리"}),t.jsxs("div",{className:"flex justify-between items-center",style:{marginTop:"-2px",marginBottom:"-4px"},children:[t.jsx("p",{className:"page-subtitle mb-0",children:"BOM & Coordinate Management"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(n,{onClick:()=>{s("create"),S("input"),ie(null),je()},className:"button-base "+("create"===e?"bg-hansl-600 hover:bg-hansl-700 text-white":"border border-gray-300 bg-white text-gray-700 hover:bg-gray-50"),children:[t.jsx(u,{className:"w-4 h-4 mr-2"}),"새로 만들기"]}),t.jsxs(n,{onClick:()=>{s("list"),S("input"),ie(null)},className:"button-base "+("list"===e?"bg-hansl-600 hover:bg-hansl-700 text-white":"border border-gray-300 bg-white text-gray-700 hover:bg-gray-50"),children:[t.jsx(A,{className:"w-4 h-4 mr-2"}),"저장된 목록"]})]})]})]})}),"list"===e&&t.jsx("div",{className:"space-y-4",children:t.jsx(x,{children:t.jsx(h,{className:"p-4 sm:p-6",children:re?t.jsxs("div",{className:"flex items-center justify-center py-12",children:[t.jsx(P,{className:"w-6 h-6 text-hansl-600 animate-spin mr-2"}),t.jsx("span",{className:"text-sm text-gray-600",children:"목록을 불러오는 중..."})]}):0===se.length?t.jsxs("div",{className:"text-center py-12",children:[t.jsx(o,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),t.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"저장된 BOM이 없습니다."}),t.jsxs(n,{onClick:()=>s("create"),className:"button-base bg-hansl-600 hover:bg-hansl-700 text-white",children:[t.jsx(u,{className:"w-4 h-4 mr-2"}),"새 BOM 만들기"]})]}):t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h3",{className:"text-base sm:text-lg font-semibold",children:"저장된 BOM 목록"}),t.jsxs("span",{className:"text-xs sm:text-sm text-gray-500",children:["총 ",se.length,"개"]})]}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4",children:se.map(e=>t.jsx(x,{className:"hover:shadow-md transition-shadow",children:t.jsxs(h,{className:"p-4",children:[t.jsxs("div",{className:"flex justify-between items-start mb-3",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h4",{className:"font-semibold text-sm sm:text-base truncate",title:e.board_name,children:e.board_name}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:new Date(e.created_at).toLocaleDateString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit"})})]}),t.jsxs(z,{variant:"outline",className:"text-[10px] sm:text-xs ml-2 flex-shrink-0",children:[e.item_count||0,"개"]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(n,{onClick:()=>(async e=>{try{const{data:t,error:a}=await ge.from("bom_items").select("*").eq("cad_drawing_id",e).order("line_number");if(a)throw a;const{data:r,error:l}=await ge.from("part_placements").select("*").eq("cad_drawing_id",e);if(l)throw l;const{data:n}=await ge.from("cad_drawings").select("board_name").eq("id",e).single(),i=(t||[]).map(e=>({lineNumber:e.line_number,itemType:e.item_type||"",itemName:e.item_name,specification:e.specification||"",setCount:e.set_count,totalQuantity:e.total_quantity||0,stockQuantity:e.stock_quantity||0,checkStatus:e.check_status||"□양호",refList:Array.isArray(e.ref_list)?e.ref_list.join(","):e.ref_list||"",alternativeItem:e.alternative_item||"",remark:e.remark||""})),o=(r||[]).map(e=>({ref:e.ref,partName:e.part_name,partType:e.part_type||"SMD",side:e.side,x:e.x_coordinate.toString(),y:e.y_coordinate.toString(),angle:e.angle?.toString()||"0"}));G({cadDrawingId:e,processedData:{bomItems:i,coordinates:o}}),M(e=>({...e,boardName:n?.board_name||""})),ie(e),s("create"),S("preview"),m.success("저장된 BOM을 불러왔습니다.")}catch(t){m.error(`BOM을 불러오는데 실패했습니다: ${t.message}`)}})(e.id),variant:"outline",size:"sm",className:"flex-1 text-xs",children:[t.jsx(A,{className:"w-3 h-3 mr-1"}),"보기"]}),t.jsxs(n,{onClick:()=>(async(e,t)=>{try{const{data:s,error:a}=await ge.from("bom_items").select("*").eq("cad_drawing_id",e).order("line_number");if(a)throw a;const{data:r,error:l}=await ge.from("part_placements").select("*").eq("cad_drawing_id",e);if(l)throw l;const n=(s||[]).map(e=>({lineNumber:e.line_number,itemType:e.item_type||"",itemName:e.item_name,specification:e.specification||"",setCount:e.set_count,totalQuantity:e.total_quantity||0,stockQuantity:e.stock_quantity||0,checkStatus:e.check_status||"□양호",refList:Array.isArray(e.ref_list)?e.ref_list.join(","):e.ref_list||"",alternativeItem:e.alternative_item||"",remark:e.remark||""})),i=(r||[]).map(e=>({ref:e.ref,partName:e.part_name,partType:e.part_type||"SMD",side:e.side,x:e.x_coordinate.toString(),y:e.y_coordinate.toString(),angle:e.angle?.toString()||"0"})),o=await W(n,i,t),c=window.URL.createObjectURL(o),d=document.createElement("a");d.href=c,d.download=`${t}.xlsx`,document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(c),m.success("엑셀 파일이 다운로드되었습니다.")}catch(s){m.error(`다운로드 중 오류가 발생했습니다: ${s.message}`)}})(e.id,e.board_name),variant:"outline",size:"sm",className:"flex-1 text-xs",children:[t.jsx(R,{className:"w-3 h-3 mr-1"}),"다운로드"]})]})]})},e.id))})]})})})}),"create"===e&&t.jsxs(t.Fragment,{children:["input"===r&&t.jsxs("div",{className:"space-y-4",children:[de&&t.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-6 py-4 rounded-lg text-sm flex flex-col gap-2 shadow-sm animate-in fade-in slide-in-from-top-2",children:[t.jsxs("div",{className:"flex items-center gap-2 font-semibold",children:[t.jsx(c,{className:"w-5 h-5 flex-shrink-0 text-red-600"}),t.jsx("span",{children:"오류가 발생했습니다"})]}),t.jsx("p",{className:"pl-7",children:de}),de.includes("quota")&&t.jsx("p",{className:"pl-7 text-xs text-red-600 mt-1",children:"* OpenAI 결제 정보가 반영되기까지 최대 10~20분이 소요될 수 있습니다. 잠시 후 다시 시도해주세요."})]}),t.jsx(x,{children:t.jsx(h,{className:"py-4",children:t.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 lg:gap-6 items-stretch",children:[t.jsxs("div",{className:"w-full lg:w-[50%] grid grid-cols-1 sm:grid-cols-2 gap-3",children:[t.jsxs("div",{className:a("border-2 border-dashed rounded-lg p-2 text-center transition-colors cursor-pointer relative flex flex-col items-center justify-center h-full","bom"===Z?"border-primary bg-primary/5":"border-gray-200 hover:border-gray-300",T.bomFile?"bg-green-50 border-green-200":""),onDragEnter:e=>fe(e,"bom"),onDragLeave:e=>fe(e,"bom"),onDragOver:e=>fe(e,"bom"),onDrop:e=>be(e,"bom"),onClick:()=>document.getElementById("bom-upload")?.click(),children:[t.jsx("input",{id:"bom-upload",type:"file",className:"hidden",accept:".xlsx,.xls",onChange:e=>we(e,"bom")}),T.bomFile?t.jsxs("div",{className:"flex flex-col items-center gap-1 w-full px-1",children:[t.jsx("span",{className:"text-xs font-bold text-green-600",children:"BOM"}),t.jsx("p",{className:"text-[10px] font-medium text-green-700 w-full text-center break-all line-clamp-2",title:T.bomFile.name,children:T.bomFile.name}),t.jsx(n,{variant:"ghost",size:"sm",className:"absolute top-1 right-1 p-0 w-4 h-4 min-w-0",onClick:e=>{e.stopPropagation(),ye("bom")},children:t.jsx(d,{size:12})})]}):t.jsxs("div",{className:"flex flex-col items-center gap-1",children:[t.jsx("span",{className:"text-xs font-bold text-gray-400",children:"BOM"}),t.jsx("p",{className:"text-[10px] font-medium text-gray-700",children:"파일 업로드"})]})]}),t.jsxs("div",{className:a("border-2 border-dashed rounded-lg p-2 text-center transition-colors cursor-pointer relative flex flex-col items-center justify-center h-full","coord"===Z?"border-primary bg-primary/5":"border-gray-200 hover:border-gray-300",T.coordFile?"bg-blue-50 border-blue-200":""),onDragEnter:e=>fe(e,"coord"),onDragLeave:e=>fe(e,"coord"),onDragOver:e=>fe(e,"coord"),onDrop:e=>be(e,"coord"),onClick:()=>document.getElementById("coord-upload")?.click(),children:[t.jsx("input",{id:"coord-upload",type:"file",className:"hidden",accept:".xlsx,.xls,.txt,.csv",onChange:e=>we(e,"coord")}),T.coordFile?t.jsxs("div",{className:"flex flex-col items-center gap-1 w-full px-1",children:[t.jsx("span",{className:"text-xs font-bold text-blue-600",children:"좌표"}),t.jsx("p",{className:"text-[10px] font-medium text-blue-700 w-full text-center break-all line-clamp-2",title:T.coordFile.name,children:T.coordFile.name}),t.jsx(n,{variant:"ghost",size:"sm",className:"absolute top-1 right-1 p-0 w-4 h-4 min-w-0",onClick:e=>{e.stopPropagation(),ye("coord")},children:t.jsx(d,{size:12})})]}):t.jsxs("div",{className:"flex flex-col items-center gap-1",children:[t.jsx("span",{className:"text-xs font-bold text-gray-400",children:"좌표"}),t.jsx("p",{className:"text-[10px] font-medium text-gray-700",children:"파일 업로드"})]})]})]}),t.jsxs("div",{className:"w-full lg:w-[50%] space-y-1",children:[t.jsxs("div",{className:"space-y-1 mb-3.5",children:[t.jsx(g,{className:"text-[10px] text-gray-500",children:"보드 이름 (자동)"}),t.jsx(p,{value:F.boardName||"BOM 파일 업로드 시 자동",disabled:!0,className:"w-full bg-gray-50 border border-[#d2d2d7] rounded-md text-xs shadow-sm",style:{height:"32px"}})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-2",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsx(g,{className:"text-[10px] text-gray-500",children:"Artwork 담당자"}),t.jsx(p,{value:D?.name||"로딩",disabled:!0,className:"w-full bg-gray-50 border border-[#d2d2d7] rounded-md text-xs shadow-sm",style:{height:"32px"}})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs(g,{className:"text-[10px] text-gray-500",children:["생산 담당자 ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs(_,{open:H,onOpenChange:X,children:[t.jsx(C,{asChild:!0,children:t.jsxs(n,{variant:"outline",role:"combobox","aria-expanded":H,className:"w-full justify-between text-xs h-8 min-h-[32px] px-2 bg-white border-[#d2d2d7] shadow-sm hover:bg-gray-50",children:[F.productionManager?E.find(e=>e.id===F.productionManager)?.name:"담당자 선택",t.jsx(f,{className:"ml-2 h-3 w-3 shrink-0 opacity-50"})]})}),t.jsx(k,{className:"w-[200px] p-0",children:t.jsxs(b,{children:[t.jsx(w,{placeholder:"이름 검색...",className:"h-8 text-xs"}),t.jsxs(y,{children:[t.jsx(j,{children:"검색 결과 없음"}),t.jsx(N,{children:E.map(e=>t.jsxs(v,{value:e.name,onSelect:()=>{M(t=>({...t,productionManager:e.id})),X(!1)},className:"text-xs",children:[t.jsx(Q,{className:a("mr-2 h-3 w-3",F.productionManager===e.id?"opacity-100":"opacity-0")}),e.name]},e.id))})]})]})})]})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs(g,{className:"text-[10px] text-gray-500",children:["생산 수량 ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs("div",{className:"relative",children:[t.jsx(p,{type:"number",min:"0",value:0===F.productionQuantity?"":F.productionQuantity,onChange:e=>M(t=>({...t,productionQuantity:parseInt(e.target.value)||0})),className:"w-full bg-white border border-[#d2d2d7] rounded-md text-xs shadow-sm hover:shadow-md transition-shadow duration-200 pr-8",style:{height:"32px"},placeholder:"0"}),t.jsx("span",{className:"absolute right-2.5 top-1/2 -translate-y-1/2 text-[10px] text-gray-500 font-medium pointer-events-none",children:"SET"})]})]}),t.jsx("div",{className:"flex items-end",children:t.jsx(n,{onClick:async()=>{if(!T.bomFile||!T.coordFile)return void m.error("BOM 파일과 좌표 파일을 모두 선택해주세요.");if(!F.boardName.trim())return void m.error("보드 이름을 입력해주세요.");if(!F.productionManager||"none"===F.productionManager)return void m.error("생산 담당자를 선택해주세요.");if(F.productionQuantity<=0)return void m.error("생산 수량을 입력해주세요 (1 이상).");let e=null,t=null;try{V(!0),S("processing"),me(null),he(0),ue("파일 업로드 준비 중...");const s=15e3+((T.bomFile?.size||0)+(T.coordFile?.size||0))/1024*50,a=500,r=90/(s/a);e=setInterval(()=>{he(e=>{if(e>=95)return e;const t=.5*Math.random()+.8;return Math.min(e+r*t,95)})},a),t=setInterval(()=>{ue(e=>"파일 업로드 준비 중..."===e?"BOM 파일 읽는 중...":"BOM 파일 읽는 중..."===e?"데이터 구조 분석 중...":"데이터 구조 분석 중..."===e?"좌표 데이터 매칭 중...":"좌표 데이터 매칭 중..."===e?"AI가 최종 정리 중입니다...":"AI가 최종 정리 중입니다..."===e?"거의 다 되었습니다. 잠시만요!":e)},s/5);const{data:{user:l}}=await ge.auth.getUser();if(!l)throw new Error("로그인이 필요합니다.");const n=Date.now(),i=e=>{const t=e.lastIndexOf("."),s=t>-1?e.slice(t):"";return((t>-1?e.slice(0,t):e).replace(/[^a-zA-Z0-9\-_]/g,"_").replace(/_+/g,"_").replace(/^_|_$/g,"")||"file")+s},o=i(T.bomFile.name),c=i(T.coordFile.name),d=`raw/${n}_bom_${o}`,x=`raw/${n}_coord_${c}`,h=await ge.storage.from("bom-files").upload(d,T.bomFile,{cacheControl:"3600",upsert:!0});if(h.error)throw h.error;const p=await ge.storage.from("bom-files").upload(x,T.coordFile,{cacheControl:"3600",upsert:!0});if(p.error)throw await ge.storage.from("bom-files").remove([d]),p.error;const{data:u}=await ge.storage.from("bom-files").createSignedUrl(d,3600),{data:g}=await ge.storage.from("bom-files").createSignedUrl(x,3600);if(!u?.signedUrl||!g?.signedUrl)throw new Error("파일 URL 생성 실패");ce({bomPath:d,coordPath:x});const f=await async function(e,t){throw await te(e),await te(t),new Error("OpenAI API Key가 설정되지 않았습니다. .env 파일을 확인해주세요.")}(T.bomFile,T.coordFile,F.productionQuantity);if(e&&clearInterval(e),t&&clearInterval(t),he(100),ue("완료!"),!f||!f.bomItems)throw new Error("AI 처리 결과가 올바르지 않습니다.");const b={cadDrawingId:`cad_${Date.now()}`,processedData:{bomItems:f.bomItems,coordinates:f.coordinates}};G(b),m.success("BOM 분석 및 정리가 완료되었습니다."),S("preview")}catch(s){const a=`처리 중 오류가 발생했습니다: ${s.message||s}`;me(a),e&&clearInterval(e),t&&clearInterval(t),V(!1),S("input"),window.scrollTo({top:0,behavior:"smooth"})}finally{"processing"===r&&de&&V(!1)}},disabled:!T.bomFile||!T.coordFile||!F.boardName||$,className:"w-full bg-hansl-600 hover:bg-hansl-700 text-white shadow-sm text-xs",style:{height:"32px"},children:"정리 및 생성"})})]})]})]})})}),!T.bomFile&&!T.coordFile&&t.jsxs("div",{className:"text-center py-6 sm:py-8 text-gray-500",children:[t.jsx(o,{className:"w-10 h-10 sm:w-12 sm:h-12 mx-auto mb-3 text-gray-300"}),t.jsx("p",{className:"text-xs sm:text-sm px-4",children:"BOM 파일과 좌표 파일을 업로드하여 시작하세요"})]})]}),"processing"===r&&t.jsx(x,{children:t.jsx(h,{className:"py-12 sm:py-16 lg:py-20",children:t.jsxs("div",{className:"flex flex-col items-center justify-center max-w-md mx-auto",children:[t.jsx(P,{className:"w-8 h-8 sm:w-10 sm:h-10 text-hansl-600 animate-spin mb-6"}),t.jsx("h3",{className:"text-base sm:text-lg lg:text-xl font-semibold text-center mb-2",children:pe||"AI가 BOM을 분석하고 있습니다"}),t.jsx("p",{className:"text-xs sm:text-sm text-gray-600 mb-6 text-center px-4",children:"잠시만 기다려주세요... (약 30초 ~ 1분 소요)"}),t.jsxs("div",{className:"w-full px-4",children:[t.jsx(q,{value:xe,className:"h-2"}),t.jsxs("p",{className:"text-right text-xs text-gray-500 mt-1",children:[Math.round(xe),"%"]})]})]})})}),"preview"===r&&Y&&t.jsxs("div",{className:"space-y-4",children:[t.jsx(x,{className:"border-green-200 bg-green-50",children:t.jsx(h,{className:"p-3 sm:p-4",children:t.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3",children:[t.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[t.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0",children:t.jsx(o,{className:"w-4 h-4 sm:w-5 sm:h-5 text-green-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm sm:text-base lg:text-lg font-semibold text-green-900",children:"분석 완료"}),t.jsxs("p",{className:"text-xs sm:text-sm text-green-700 mt-0.5",children:["보드명: ",F.boardName," / 생산수량: ",F.productionQuantity," SET"]})]})]}),t.jsx(n,{onClick:je,className:"w-full sm:w-auto button-base border border-green-200 bg-white text-green-700 hover:bg-green-100 text-xs sm:text-sm",children:"처음부터 다시 하기"})]})})}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[t.jsx("div",{className:"lg:col-span-2",children:t.jsx(K,{bomItems:Y.processedData?.bomItems||[],coordinates:Y.processedData?.coordinates||[],boardName:F.boardName||"Board",productionQuantity:F.productionQuantity,onSave:async e=>{if(Y?.cadDrawingId)try{const{data:{user:t}}=await ge.auth.getUser();if(!t)throw new Error("로그인이 필요합니다.");let a=Y.cadDrawingId;if(a.startsWith("cad_")){const{data:e,error:t}=await ge.from("cad_drawings").select("id").eq("board_name",F.boardName).single();if(t&&"PGRST116"!==t.code)throw t;if(e)a=e.id;else{const{data:e,error:t}=await ge.from("cad_drawings").insert({board_name:F.boardName}).select("id").single();if(t)throw t;a=e.id}}if(T.bomFile&&T.coordFile&&oe){let e="",s="";const{data:r}=await ge.storage.from("bom-files").createSignedUrl(oe.bomPath,31536e3),{data:l}=await ge.storage.from("bom-files").createSignedUrl(oe.coordPath,31536e3);r?.signedUrl&&(e=r.signedUrl),l?.signedUrl&&(s=l.signedUrl);const{data:n}=await ge.from("bom_raw_files").select("id").eq("cad_drawing_id",a).single();if(n){const{error:a}=await ge.from("bom_raw_files").update({bom_file_url:e,coordinate_file_url:s,bom_file_name:T.bomFile.name,coordinate_file_name:T.coordFile.name,uploaded_by:t.email||t.id}).eq("id",n.id);if(a)throw a}else{const{error:r}=await ge.from("bom_raw_files").insert({cad_drawing_id:a,bom_file_url:e,coordinate_file_url:s,bom_file_name:T.bomFile.name,coordinate_file_name:T.coordFile.name,uploaded_by:t.email||t.id});if(r)throw r}}const{error:r}=await ge.from("bom_items").delete().eq("cad_drawing_id",a);if(r)throw r;const{error:l}=await ge.from("bom_items").insert(e.map(e=>({cad_drawing_id:a,line_number:e.lineNumber,item_type:e.itemType,item_name:e.itemName,specification:e.specification,set_count:e.setCount,total_quantity:e.totalQuantity,stock_quantity:e.stockQuantity,check_status:e.checkStatus,ref_list:Array.isArray(e.refList)?e.refList:e.refList?e.refList.split(","):[],alternative_item:e.alternativeItem,remark:e.remark})));if(l)throw l;if(Y.processedData?.coordinates){const{error:e}=await ge.from("part_placements").delete().eq("cad_drawing_id",a);if(e)throw e;const{error:t}=await ge.from("part_placements").insert(Y.processedData.coordinates.map(e=>({cad_drawing_id:a,ref:e.ref,part_name:e.partName,part_type:e.partType,side:e.side,x_coordinate:parseFloat(e.x?.toString()||"0"),y_coordinate:parseFloat(e.y?.toString()||"0"),angle:e.angle?parseFloat(e.angle.toString()):null})));if(t)throw t}if(oe){const{error:t}=await ge.from("ai_learning_records").insert({cad_drawing_id:a,processed_bom_data:e,processed_coordinate_data:Y.processedData?.coordinates,cad_program_type:"unknown",created_at:(new Date).toISOString()})}G(t=>({...t,cadDrawingId:a,processedData:{...t.processedData,bomItems:e}})),m.success("수정사항이 저장되었습니다."),setTimeout(()=>{s("list")},1e3)}catch(t){m.error(`저장에 실패했습니다: ${t.message}`)}}})}),t.jsx("div",{className:"lg:col-span-1",children:t.jsx(J,{coordinates:Y.processedData?.coordinates||[]})})]})]})]})]})}Z.displayName="TabsContent";export{se as default};
//# sourceMappingURL=BomCoordinateIntegrated-BtkJjJwX.js.map
