{"version":3,"file":"TransactionStatementMain-jJZ2kXvK.js","sources":["../../node_modules/lucide-react/dist/esm/icons/circle-x.js","../../node_modules/lucide-react/dist/esm/icons/external-link.js","../../node_modules/lucide-react/dist/esm/icons/file-spreadsheet.js","../../node_modules/lucide-react/dist/esm/icons/refresh-cw.js","../../node_modules/lucide-react/dist/esm/icons/rotate-cw.js","../../node_modules/lucide-react/dist/esm/icons/sliders-horizontal.js","../../src/components/transaction-statement/StatementUploadModal.tsx","../../src/components/transaction-statement/ReceiptQuantityUploadModal.tsx","../../src/components/transaction-statement/MonthlyStatementUploadModal.tsx","../../src/components/transaction-statement/StatementImageViewer.tsx","../../src/components/transaction-statement/StatementConfirmModal.tsx","../../src/components/transaction-statement/TransactionStatementMain.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }],\n  [\"path\", { d: \"m15 9-6 6\", key: \"1uzhvr\" }],\n  [\"path\", { d: \"m9 9 6 6\", key: \"z0biqf\" }]\n];\nconst CircleX = createLucideIcon(\"circle-x\", __iconNode);\n\nexport { __iconNode, CircleX as default };\n//# sourceMappingURL=circle-x.js.map\n","/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M15 3h6v6\", key: \"1q9fwt\" }],\n  [\"path\", { d: \"M10 14 21 3\", key: \"gplh6r\" }],\n  [\"path\", { d: \"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6\", key: \"a6xqqp\" }]\n];\nconst ExternalLink = createLucideIcon(\"external-link\", __iconNode);\n\nexport { __iconNode, ExternalLink as default };\n//# sourceMappingURL=external-link.js.map\n","/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z\", key: \"1rqfz7\" }],\n  [\"path\", { d: \"M14 2v4a2 2 0 0 0 2 2h4\", key: \"tnqrlb\" }],\n  [\"path\", { d: \"M8 13h2\", key: \"yr2amv\" }],\n  [\"path\", { d: \"M14 13h2\", key: \"un5t4a\" }],\n  [\"path\", { d: \"M8 17h2\", key: \"2yhykz\" }],\n  [\"path\", { d: \"M14 17h2\", key: \"10kma7\" }]\n];\nconst FileSpreadsheet = createLucideIcon(\"file-spreadsheet\", __iconNode);\n\nexport { __iconNode, FileSpreadsheet as default };\n//# sourceMappingURL=file-spreadsheet.js.map\n","/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8\", key: \"v9h5vc\" }],\n  [\"path\", { d: \"M21 3v5h-5\", key: \"1q7to0\" }],\n  [\"path\", { d: \"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16\", key: \"3uifl3\" }],\n  [\"path\", { d: \"M8 16H3v5\", key: \"1cv678\" }]\n];\nconst RefreshCw = createLucideIcon(\"refresh-cw\", __iconNode);\n\nexport { __iconNode, RefreshCw as default };\n//# sourceMappingURL=refresh-cw.js.map\n","/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8\", key: \"1p45f6\" }],\n  [\"path\", { d: \"M21 3v5h-5\", key: \"1q7to0\" }]\n];\nconst RotateCw = createLucideIcon(\"rotate-cw\", __iconNode);\n\nexport { __iconNode, RotateCw as default };\n//# sourceMappingURL=rotate-cw.js.map\n","/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"line\", { x1: \"21\", x2: \"14\", y1: \"4\", y2: \"4\", key: \"obuewd\" }],\n  [\"line\", { x1: \"10\", x2: \"3\", y1: \"4\", y2: \"4\", key: \"1q6298\" }],\n  [\"line\", { x1: \"21\", x2: \"12\", y1: \"12\", y2: \"12\", key: \"1iu8h1\" }],\n  [\"line\", { x1: \"8\", x2: \"3\", y1: \"12\", y2: \"12\", key: \"ntss68\" }],\n  [\"line\", { x1: \"21\", x2: \"16\", y1: \"20\", y2: \"20\", key: \"14d8ph\" }],\n  [\"line\", { x1: \"12\", x2: \"3\", y1: \"20\", y2: \"20\", key: \"m0wm8r\" }],\n  [\"line\", { x1: \"14\", x2: \"14\", y1: \"2\", y2: \"6\", key: \"14e1ph\" }],\n  [\"line\", { x1: \"8\", x2: \"8\", y1: \"10\", y2: \"14\", key: \"1i6ji0\" }],\n  [\"line\", { x1: \"16\", x2: \"16\", y1: \"18\", y2: \"22\", key: \"1lctlv\" }]\n];\nconst SlidersHorizontal = createLucideIcon(\"sliders-horizontal\", __iconNode);\n\nexport { __iconNode, SlidersHorizontal as default };\n//# sourceMappingURL=sliders-horizontal.js.map\n","import { useState, useRef, useEffect } from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Upload, X, Image as ImageIcon, Loader2 } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { createClient } from \"@/lib/supabase/client\";\nimport transactionStatementService from \"@/services/transactionStatementService\";\nimport { DateQuantityPickerPopover } from \"@/components/ui/date-quantity-picker-popover\";\nimport { format } from \"date-fns\";\n\ninterface StatementUploadModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSuccess: (statementId: string, imageUrl: string) => void;\n}\n\n/**\n * ê±°ë˜ëª…ì„¸ì„œ ì´ë¯¸ì§€ ì—…ë¡œë“œ ëª¨ë‹¬\n */\nexport default function StatementUploadModal({\n  isOpen,\n  onClose,\n  onSuccess,\n}: StatementUploadModalProps) {\n  const [file, setFile] = useState<File | null>(null);\n  const [preview, setPreview] = useState<string | null>(null);\n  const [uploading, setUploading] = useState(false);\n  const [uploaderName, setUploaderName] = useState<string>(\"\");\n  const [actualReceiptDate, setActualReceiptDate] = useState<Date | null>(null);\n  const [poScope, setPoScope] = useState<\"single\" | \"multi\" | \"\">(\"\");\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const supabase = createClient();\n\n  // í˜„ì¬ ì‚¬ìš©ì ì´ë¦„ ê°€ì ¸ì˜¤ê¸°\n  const loadUserName = async () => {\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (user?.email) {\n        const { data: employee } = await supabase\n          .from('employees')\n          .select('name')\n          .eq('email', user.email)\n          .single();\n        \n        if (employee?.name) {\n          setUploaderName(employee.name);\n        }\n      }\n    } catch (e) {\n      console.warn('Failed to load user name:', e);\n    }\n  };\n\n  // ëª¨ë‹¬ ì—´ë¦´ ë•Œ ì‚¬ìš©ì ì´ë¦„ ë¡œë“œ\n  useEffect(() => {\n    if (isOpen) {\n      loadUserName();\n    }\n  }, [isOpen]);\n\n  // íŒŒì¼ ì„ íƒ ì²˜ë¦¬\n  const handleFileSelect = (selectedFile: File) => {\n    if (!selectedFile.type.startsWith('image/')) {\n      toast.error('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');\n      return;\n    }\n\n    if (selectedFile.size > 10 * 1024 * 1024) {\n      toast.error('íŒŒì¼ í¬ê¸°ëŠ” 10MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.');\n      return;\n    }\n\n    setFile(selectedFile);\n\n    // EXIF íšŒì „ ì ìš©ëœ ë¯¸ë¦¬ë³´ê¸° ìƒì„±\n    createImageBitmap(selectedFile).then(bitmap => {\n      const canvas = document.createElement('canvas');\n      canvas.width = bitmap.width;\n      canvas.height = bitmap.height;\n      const ctx = canvas.getContext('2d');\n      if (ctx) {\n        ctx.drawImage(bitmap, 0, 0);\n        setPreview(canvas.toDataURL('image/jpeg', 0.8));\n      }\n    }).catch(() => {\n      // fallback: ì›ë³¸ ê·¸ëŒ€ë¡œ\n      const reader = new FileReader();\n      reader.onloadend = () => setPreview(reader.result as string);\n      reader.readAsDataURL(selectedFile);\n    });\n  };\n\n  // ë“œë˜ê·¸ì•¤ë“œë¡­ ì²˜ë¦¬\n  const handleDrop = (e: React.DragEvent<HTMLDivElement>) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const droppedFile = e.dataTransfer.files[0];\n    if (droppedFile) {\n      handleFileSelect(droppedFile);\n    }\n  };\n\n  const handleDragOver = (e: React.DragEvent<HTMLDivElement>) => {\n    e.preventDefault();\n    e.stopPropagation();\n  };\n\n  const handleClick = () => {\n    fileInputRef.current?.click();\n  };\n\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const selectedFile = e.target.files?.[0];\n    if (selectedFile) {\n      handleFileSelect(selectedFile);\n    }\n  };\n\n  const handleRemoveFile = () => {\n    setFile(null);\n    setPreview(null);\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n  };\n\n  const handleUpload = async () => {\n    if (!file) {\n      toast.error('íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');\n      return;\n    }\n\n    if (!actualReceiptDate) {\n      toast.error('ì‹¤ì…ê³ ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');\n      return;\n    }\n    if (!poScope) {\n      toast.error('ë‹¨ì¼/ë‹¤ì¤‘ ì—¬ë¶€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');\n      return;\n    }\n\n\n    try {\n      setUploading(true);\n\n      const result = await transactionStatementService.uploadStatement(\n        file,\n        uploaderName || 'ì•Œ ìˆ˜ ì—†ìŒ',\n        actualReceiptDate,\n        poScope\n      );\n\n      if (result.success && result.data) {\n        toast.success('ì—…ë¡œë“œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');\n        onSuccess(result.data.statementId, result.data.imageUrl);\n        handleClose();\n      } else {\n        toast.error(result.error || 'ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n      }\n    } catch (error) {\n      toast.error('ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');\n    } finally {\n      setUploading(false);\n    }\n  };\n\n  const handleClose = () => {\n    if (uploading) return;\n    \n    setFile(null);\n    setPreview(null);\n    setActualReceiptDate(null);\n    setPoScope(\"\");\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n    onClose();\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={handleClose}>\n      <DialogContent className=\"sm:max-w-[480px] business-radius-modal\">\n        <DialogHeader className=\"border-b border-gray-100 pb-3\">\n          <DialogTitle className=\"flex items-center gap-2 text-[13px] font-bold text-gray-900\">\n            <Upload className=\"w-4 h-4 text-hansl-600\" />\n            ê±°ë˜ëª…ì„¸ì„œ ì—…ë¡œë“œ\n          </DialogTitle>\n        </DialogHeader>\n\n        <div className=\"py-4 px-1\">\n          {/* ë“œë˜ê·¸ì•¤ë“œë¡­ ì˜ì—­ */}\n          <div\n            className={`\n              border-2 border-dashed business-radius-card p-6 text-center cursor-pointer transition-colors\n              ${preview \n                ? 'border-hansl-300 bg-hansl-50' \n                : 'border-gray-200 hover:border-hansl-300 hover:bg-gray-50'\n              }\n            `}\n            onDrop={handleDrop}\n            onDragOver={handleDragOver}\n            onClick={handleClick}\n          >\n            <input\n              ref={fileInputRef}\n              type=\"file\"\n              accept=\"image/*\"\n              onChange={handleInputChange}\n              className=\"hidden\"\n            />\n\n            {preview ? (\n              <div className=\"relative\">\n                <img\n                  src={preview}\n                  alt=\"ë¯¸ë¦¬ë³´ê¸°\"\n                  className=\"max-h-52 mx-auto business-radius-card shadow-sm\"\n                />\n                <button\n                  className=\"absolute top-2 right-2 p-1.5 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors\"\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    handleRemoveFile();\n                  }}\n                >\n                  <X className=\"w-3.5 h-3.5\" />\n                </button>\n                <p className=\"mt-3 text-[11px] text-gray-600 truncate px-4\">\n                  {file?.name}\n                </p>\n              </div>\n            ) : (\n              <>\n                <ImageIcon className=\"w-10 h-10 text-gray-300 mx-auto mb-3\" />\n                <p className=\"text-[11px] text-gray-600 mb-1\">\n                  ê±°ë˜ëª…ì„¸ì„œ ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”\n                </p>\n                <p className=\"text-[10px] text-gray-400\">\n                  ì§€ì› í˜•ì‹: JPG, PNG, GIF, WEBP (ìµœëŒ€ 10MB)\n                </p>\n              </>\n            )}\n          </div>\n\n          <div className=\"mt-4 space-y-3 rounded-lg border border-gray-200 bg-gray-50/50 p-3\">\n            <div className=\"flex items-start justify-between gap-4\">\n              <div className=\"modal-label text-gray-600\">ë°œì£¼/ìˆ˜ì£¼ êµ¬ë¶„</div>\n              <div className=\"flex flex-col items-end gap-1\">\n                <Select\n                  value={poScope}\n                  onValueChange={(value) => setPoScope(value as \"single\" | \"multi\")}\n                  disabled={uploading}\n                >\n                  <SelectTrigger className=\"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50\">\n                    <SelectValue placeholder=\"ë‹¨ì¼/ë‹¤ì¤‘ ì„ íƒ\" />\n                  </SelectTrigger>\n                  <SelectContent className=\"border border-gray-200 business-radius-card shadow-md\">\n                    <SelectItem value=\"single\" className=\"text-[11px]\">ë‹¨ì¼ ë°œì£¼</SelectItem>\n                    <SelectItem value=\"multi\" className=\"text-[11px]\">ë‹¤ì¤‘ ë°œì£¼</SelectItem>\n                  </SelectContent>\n                </Select>\n                {!poScope && (\n                  <span className=\"text-[10px] text-red-500 font-medium\">ë‹¨ì¼/ë‹¤ì¤‘ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</span>\n                )}\n              </div>\n            </div>\n\n            <div className=\"flex items-start justify-between gap-4\">\n              <div className=\"modal-label text-gray-600\">ì‹¤ì…ê³ ì¼</div>\n              <div className=\"flex flex-col items-end gap-1\">\n                <DateQuantityPickerPopover\n                  onConfirm={(date) => setActualReceiptDate(date)}\n                  placeholder=\"ì…ê³ ì¼ì„ ì„ íƒí•˜ì„¸ìš”\"\n                  align=\"end\"\n                  side=\"bottom\"\n                  hideQuantityInput={true}\n                  disabled={uploading}\n                >\n                  <button className=\"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50\">\n                    {actualReceiptDate ? format(actualReceiptDate, 'yyyy-MM-dd') : 'ì‹¤ì…ê³ ì¼ ì„ íƒ'}\n                  </button>\n                </DateQuantityPickerPopover>\n                {!actualReceiptDate && (\n                  <span className=\"text-[10px] text-red-500 font-medium\">ì‹¤ì…ê³ ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>\n                )}\n              </div>\n            </div>\n          </div>\n\n          {/* ì•ˆë‚´ ë¬¸êµ¬ */}\n          <div className=\"mt-4 p-3 bg-blue-50 business-radius-card border border-blue-100\">\n            <p className=\"text-[10px] text-blue-700 leading-relaxed\">\n              ğŸ’¡ ê±°ë˜ëª…ì„¸ì„œë¥¼ ì´¬ì˜í•˜ê±°ë‚˜ ìŠ¤ìº”í•œ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”.\n              ì—…ë¡œë“œ í›„ OCRë¡œ í’ˆëª©, ìˆ˜ëŸ‰, ê¸ˆì•¡, ë°œì£¼ë²ˆí˜¸ ë“±ì„ ìë™ìœ¼ë¡œ ì¶”ì¶œí•©ë‹ˆë‹¤.\n            </p>\n          </div>\n        </div>\n\n        <DialogFooter className=\"border-t border-gray-100 pt-3 gap-2\">\n          <Button\n            variant=\"outline\"\n            onClick={handleClose}\n            disabled={uploading}\n            className=\"button-base h-8 text-[11px]\"\n          >\n            ì·¨ì†Œ\n          </Button>\n          <Button\n            onClick={handleUpload}\n            disabled={!file || !actualReceiptDate || !poScope || uploading}\n            className=\"button-base h-8 text-[11px] bg-hansl-600 hover:bg-hansl-700 text-white\"\n          >\n            {uploading ? (\n              <>\n                <Loader2 className=\"w-3.5 h-3.5 mr-1.5 animate-spin\" />\n                ì—…ë¡œë“œ ì¤‘...\n              </>\n            ) : (\n              <>\n                <Upload className=\"w-3.5 h-3.5 mr-1.5\" />\n                ì—…ë¡œë“œ\n              </>\n            )}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","import { useState, useRef, useEffect } from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Upload, X, Image as ImageIcon, Loader2 } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { createClient } from \"@/lib/supabase/client\";\nimport transactionStatementService from \"@/services/transactionStatementService\";\nimport { DateQuantityPickerPopover } from \"@/components/ui/date-quantity-picker-popover\";\nimport { format } from \"date-fns\";\n\ninterface ReceiptQuantityUploadModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSuccess: (statementId: string, imageUrl: string) => void;\n}\n\n/**\n * ì…ê³ ìˆ˜ëŸ‰ ì—…ë¡œë“œ ëª¨ë‹¬ (ì›”ë§ê²°ì œìš© - ìˆ˜ëŸ‰ë§Œ ì¶”ì¶œ)\n */\nexport default function ReceiptQuantityUploadModal({\n  isOpen,\n  onClose,\n  onSuccess,\n}: ReceiptQuantityUploadModalProps) {\n  const [file, setFile] = useState<File | null>(null);\n  const [preview, setPreview] = useState<string | null>(null);\n  const [uploading, setUploading] = useState(false);\n  const [uploaderName, setUploaderName] = useState<string>(\"\");\n  const [actualReceiptDate, setActualReceiptDate] = useState<Date | null>(null);\n  const [poScope, setPoScope] = useState<\"single\" | \"multi\" | \"\">(\"\");\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const supabase = createClient();\n\n  // í˜„ì¬ ì‚¬ìš©ì ì´ë¦„ ê°€ì ¸ì˜¤ê¸°\n  const loadUserName = async () => {\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (user?.email) {\n        const { data: employee } = await supabase\n          .from('employees')\n          .select('name')\n          .eq('email', user.email)\n          .single();\n        \n        if (employee?.name) {\n          setUploaderName(employee.name);\n        }\n      }\n    } catch (e) {\n      console.warn('Failed to load user name:', e);\n    }\n  };\n\n  // ëª¨ë‹¬ ì—´ë¦´ ë•Œ ì‚¬ìš©ì ì´ë¦„ ë¡œë“œ\n  useEffect(() => {\n    if (isOpen) {\n      loadUserName();\n    }\n  }, [isOpen]);\n\n  // íŒŒì¼ ì„ íƒ ì²˜ë¦¬\n  const handleFileSelect = (selectedFile: File) => {\n    if (!selectedFile.type.startsWith('image/')) {\n      toast.error('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');\n      return;\n    }\n\n    if (selectedFile.size > 10 * 1024 * 1024) {\n      toast.error('íŒŒì¼ í¬ê¸°ëŠ” 10MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.');\n      return;\n    }\n\n    setFile(selectedFile);\n\n    // EXIF íšŒì „ ì ìš©ëœ ë¯¸ë¦¬ë³´ê¸° ìƒì„±\n    createImageBitmap(selectedFile).then(bitmap => {\n      const canvas = document.createElement('canvas');\n      canvas.width = bitmap.width;\n      canvas.height = bitmap.height;\n      const ctx = canvas.getContext('2d');\n      if (ctx) {\n        ctx.drawImage(bitmap, 0, 0);\n        setPreview(canvas.toDataURL('image/jpeg', 0.8));\n      }\n    }).catch(() => {\n      const reader = new FileReader();\n      reader.onloadend = () => setPreview(reader.result as string);\n      reader.readAsDataURL(selectedFile);\n    });\n  };\n\n  // ë“œë˜ê·¸ì•¤ë“œë¡­ ì²˜ë¦¬\n  const handleDrop = (e: React.DragEvent<HTMLDivElement>) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const droppedFile = e.dataTransfer.files[0];\n    if (droppedFile) {\n      handleFileSelect(droppedFile);\n    }\n  };\n\n  const handleDragOver = (e: React.DragEvent<HTMLDivElement>) => {\n    e.preventDefault();\n    e.stopPropagation();\n  };\n\n  const handleClick = () => {\n    fileInputRef.current?.click();\n  };\n\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const selectedFile = e.target.files?.[0];\n    if (selectedFile) {\n      handleFileSelect(selectedFile);\n    }\n  };\n\n  const handleRemoveFile = () => {\n    setFile(null);\n    setPreview(null);\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n  };\n\n  const handleUpload = async () => {\n    if (!file) {\n      toast.error('íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');\n      return;\n    }\n\n    if (!actualReceiptDate) {\n      toast.error('ì‹¤ì…ê³ ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');\n      return;\n    }\n    if (!poScope) {\n      toast.error('ë‹¨ì¼/ë‹¤ì¤‘ ì—¬ë¶€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');\n      return;\n    }\n\n    try {\n      setUploading(true);\n\n      // ì…ê³ ìˆ˜ëŸ‰ ì—…ë¡œë“œìš© ì„œë¹„ìŠ¤ í˜¸ì¶œ (statement_mode: 'receipt')\n      const result = await transactionStatementService.uploadReceiptQuantity(\n        file,\n        uploaderName || 'ì•Œ ìˆ˜ ì—†ìŒ',\n        actualReceiptDate,\n        poScope\n      );\n\n      if (result.success && result.data) {\n        toast.success('ì…ê³ ìˆ˜ëŸ‰ ì—…ë¡œë“œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');\n        onSuccess(result.data.statementId, result.data.imageUrl);\n        handleClose();\n      } else {\n        toast.error(result.error || 'ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n      }\n    } catch (error) {\n      toast.error('ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');\n    } finally {\n      setUploading(false);\n    }\n  };\n\n  const handleClose = () => {\n    if (uploading) return;\n    \n    setFile(null);\n    setPreview(null);\n    setActualReceiptDate(null);\n    setPoScope(\"\");\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n    onClose();\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={handleClose}>\n      <DialogContent className=\"sm:max-w-[480px] business-radius-modal\">\n        <DialogHeader className=\"border-b border-gray-100 pb-3\">\n          <DialogTitle className=\"flex items-center gap-2 text-[13px] font-bold text-gray-900\">\n            <Upload className=\"w-4 h-4 text-orange-600\" />\n            ì…ê³ ìˆ˜ëŸ‰ ì—…ë¡œë“œ\n          </DialogTitle>\n        </DialogHeader>\n\n        <div className=\"py-4 px-1\">\n          {/* ë“œë˜ê·¸ì•¤ë“œë¡­ ì˜ì—­ */}\n          <div\n            className={`\n              border-2 border-dashed business-radius-card p-6 text-center cursor-pointer transition-colors\n              ${preview \n                ? 'border-orange-300 bg-orange-50' \n                : 'border-gray-200 hover:border-orange-300 hover:bg-gray-50'\n              }\n            `}\n            onDrop={handleDrop}\n            onDragOver={handleDragOver}\n            onClick={handleClick}\n          >\n            <input\n              ref={fileInputRef}\n              type=\"file\"\n              accept=\"image/*\"\n              onChange={handleInputChange}\n              className=\"hidden\"\n            />\n\n            {preview ? (\n              <div className=\"relative\">\n                <img\n                  src={preview}\n                  alt=\"ë¯¸ë¦¬ë³´ê¸°\"\n                  className=\"max-h-52 mx-auto business-radius-card shadow-sm\"\n                />\n                <button\n                  className=\"absolute top-2 right-2 p-1.5 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors\"\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    handleRemoveFile();\n                  }}\n                >\n                  <X className=\"w-3.5 h-3.5\" />\n                </button>\n                <p className=\"mt-3 text-[11px] text-gray-600 truncate px-4\">\n                  {file?.name}\n                </p>\n              </div>\n            ) : (\n              <>\n                <ImageIcon className=\"w-10 h-10 text-gray-300 mx-auto mb-3\" />\n                <p className=\"text-[11px] text-gray-600 mb-1\">\n                  ê±°ë˜ëª…ì„¸ì„œ ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”\n                </p>\n                <p className=\"text-[10px] text-gray-400\">\n                  ì§€ì› í˜•ì‹: JPG, PNG, GIF, WEBP (ìµœëŒ€ 10MB)\n                </p>\n              </>\n            )}\n          </div>\n\n          <div className=\"mt-4 space-y-3 rounded-lg border border-gray-200 bg-gray-50/50 p-3\">\n            <div className=\"flex items-start justify-between gap-4\">\n              <div className=\"modal-label text-gray-600\">ë°œì£¼/ìˆ˜ì£¼ êµ¬ë¶„</div>\n              <div className=\"flex flex-col items-end gap-1\">\n                <Select\n                  value={poScope}\n                  onValueChange={(value) => setPoScope(value as \"single\" | \"multi\")}\n                  disabled={uploading}\n                >\n                  <SelectTrigger className=\"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50\">\n                    <SelectValue placeholder=\"ë‹¨ì¼/ë‹¤ì¤‘ ì„ íƒ\" />\n                  </SelectTrigger>\n                  <SelectContent className=\"border border-gray-200 business-radius-card shadow-md\">\n                    <SelectItem value=\"single\" className=\"text-[11px]\">ë‹¨ì¼ ë°œì£¼</SelectItem>\n                    <SelectItem value=\"multi\" className=\"text-[11px]\">ë‹¤ì¤‘ ë°œì£¼</SelectItem>\n                  </SelectContent>\n                </Select>\n                {!poScope && (\n                  <span className=\"text-[10px] text-red-500 font-medium\">ë‹¨ì¼/ë‹¤ì¤‘ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</span>\n                )}\n              </div>\n            </div>\n\n            <div className=\"flex items-start justify-between gap-4\">\n              <div className=\"modal-label text-gray-600\">ì‹¤ì…ê³ ì¼</div>\n              <div className=\"flex flex-col items-end gap-1\">\n                <DateQuantityPickerPopover\n                  onConfirm={(date) => setActualReceiptDate(date)}\n                  placeholder=\"ì…ê³ ì¼ì„ ì„ íƒí•˜ì„¸ìš”\"\n                  align=\"end\"\n                  side=\"bottom\"\n                  hideQuantityInput={true}\n                  disabled={uploading}\n                >\n                  <button className=\"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50\">\n                    {actualReceiptDate ? format(actualReceiptDate, 'yyyy-MM-dd') : 'ì‹¤ì…ê³ ì¼ ì„ íƒ'}\n                  </button>\n                </DateQuantityPickerPopover>\n                {!actualReceiptDate && (\n                  <span className=\"text-[10px] text-red-500 font-medium\">ì‹¤ì…ê³ ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>\n                )}\n              </div>\n            </div>\n          </div>\n\n          {/* ì•ˆë‚´ ë¬¸êµ¬ - ì…ê³ ìˆ˜ëŸ‰ ì „ìš© */}\n          <div className=\"mt-4 p-3 bg-orange-50 business-radius-card border border-orange-100\">\n            <p className=\"text-[10px] text-orange-700 leading-relaxed\">\n              ğŸ“¦ ì›”ë§ê²°ì œ ì—…ì²´ìš© ì…ê³ ìˆ˜ëŸ‰ í™•ì¸ ê¸°ëŠ¥ì…ë‹ˆë‹¤.\n              ê±°ë˜ëª…ì„¸ì„œì—ì„œ ìˆ˜ëŸ‰ë§Œ ì¶”ì¶œí•˜ì—¬ ì‹¤ì…ê³ ìˆ˜ëŸ‰ì„ ê¸°ë¡í•©ë‹ˆë‹¤.\n              (ê¸ˆì•¡ ì •ë³´ëŠ” ì¶”ì¶œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤)\n            </p>\n          </div>\n        </div>\n\n        <DialogFooter className=\"border-t border-gray-100 pt-3 gap-2\">\n          <Button\n            variant=\"outline\"\n            onClick={handleClose}\n            disabled={uploading}\n            className=\"button-base h-8 text-[11px]\"\n          >\n            ì·¨ì†Œ\n          </Button>\n          <Button\n            onClick={handleUpload}\n            disabled={!file || !actualReceiptDate || !poScope || uploading}\n            className=\"button-base h-8 text-[11px] bg-orange-600 hover:bg-orange-700 text-white\"\n          >\n            {uploading ? (\n              <>\n                <Loader2 className=\"w-3.5 h-3.5 mr-1.5 animate-spin\" />\n                ì—…ë¡œë“œ ì¤‘...\n              </>\n            ) : (\n              <>\n                <Upload className=\"w-3.5 h-3.5 mr-1.5\" />\n                ì—…ë¡œë“œ\n              </>\n            )}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","import { useState, useRef, useEffect } from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Upload, X, FileSpreadsheet, Loader2 } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { createClient } from \"@/lib/supabase/client\";\nimport transactionStatementService from \"@/services/transactionStatementService\";\n\ninterface MonthlyStatementUploadModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSuccess: (statementId: string, fileUrl: string) => void;\n}\n\nconst ACCEPTED_TYPES = [\n  'application/vnd.ms-excel',                                                    // .xls\n  'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',           // .xlsx\n  'application/pdf',                                                              // .pdf\n  'image/jpeg', 'image/png', 'image/gif', 'image/webp'                          // ì´ë¯¸ì§€\n];\n\nconst ACCEPTED_EXTENSIONS = ['.xls', '.xlsx', '.pdf', '.jpg', '.jpeg', '.png', '.gif', '.webp'];\n\nfunction getFileType(file: File): 'excel' | 'pdf' | 'image' {\n  const ext = file.name.split('.').pop()?.toLowerCase() || '';\n  if (['xls', 'xlsx'].includes(ext)) return 'excel';\n  if (ext === 'pdf') return 'pdf';\n  return 'image';\n}\n\n/**\n * ê±°ë˜ëª…ì„¸ì„œ(ì›”ë§ê²°ì œ) ì—…ë¡œë“œ ëª¨ë‹¬\n * ì—‘ì…€, PDF, ì´ë¯¸ì§€ íŒŒì¼ ëª¨ë‘ ì§€ì›\n */\nexport default function MonthlyStatementUploadModal({\n  isOpen,\n  onClose,\n  onSuccess,\n}: MonthlyStatementUploadModalProps) {\n  const [file, setFile] = useState<File | null>(null);\n  const [preview, setPreview] = useState<string | null>(null);\n  const [uploading, setUploading] = useState(false);\n  const [uploaderName, setUploaderName] = useState<string>(\"\");\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const supabase = createClient();\n\n  const loadUserName = async () => {\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (user?.email) {\n        const { data: employee } = await supabase\n          .from('employees')\n          .select('name')\n          .eq('email', user.email)\n          .single();\n        \n        if (employee?.name) {\n          setUploaderName(employee.name);\n        }\n      }\n    } catch (e) {\n      // ignore\n    }\n  };\n\n  useEffect(() => {\n    if (isOpen) {\n      loadUserName();\n    }\n  }, [isOpen]);\n\n  const handleFileSelect = (selectedFile: File) => {\n    const ext = '.' + (selectedFile.name.split('.').pop()?.toLowerCase() || '');\n    if (!ACCEPTED_EXTENSIONS.includes(ext)) {\n      toast.error('ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤. (ì—‘ì…€, PDF, ì´ë¯¸ì§€)');\n      return;\n    }\n\n    if (selectedFile.size > 20 * 1024 * 1024) {\n      toast.error('íŒŒì¼ í¬ê¸°ëŠ” 20MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.');\n      return;\n    }\n\n    setFile(selectedFile);\n\n    // ì´ë¯¸ì§€ì¸ ê²½ìš° EXIF íšŒì „ ì ìš©ëœ ë¯¸ë¦¬ë³´ê¸° ìƒì„±\n    if (selectedFile.type.startsWith('image/')) {\n      createImageBitmap(selectedFile).then(bitmap => {\n        const canvas = document.createElement('canvas');\n        canvas.width = bitmap.width;\n        canvas.height = bitmap.height;\n        const ctx = canvas.getContext('2d');\n        if (ctx) {\n          ctx.drawImage(bitmap, 0, 0);\n          setPreview(canvas.toDataURL('image/jpeg', 0.8));\n        }\n      }).catch(() => {\n        const reader = new FileReader();\n        reader.onloadend = () => setPreview(reader.result as string);\n        reader.readAsDataURL(selectedFile);\n      });\n    } else {\n      setPreview(null);\n    }\n  };\n\n  const handleDrop = (e: React.DragEvent<HTMLDivElement>) => {\n    e.preventDefault();\n    e.stopPropagation();\n    const droppedFile = e.dataTransfer.files[0];\n    if (droppedFile) handleFileSelect(droppedFile);\n  };\n\n  const handleDragOver = (e: React.DragEvent<HTMLDivElement>) => {\n    e.preventDefault();\n    e.stopPropagation();\n  };\n\n  const handleClick = () => {\n    fileInputRef.current?.click();\n  };\n\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const selectedFile = e.target.files?.[0];\n    if (selectedFile) handleFileSelect(selectedFile);\n  };\n\n  const handleRemoveFile = () => {\n    setFile(null);\n    setPreview(null);\n    if (fileInputRef.current) fileInputRef.current.value = '';\n  };\n\n  const handleUpload = async () => {\n    if (!file) {\n      toast.error('íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');\n      return;\n    }\n\n    try {\n      setUploading(true);\n      const fileType = getFileType(file);\n\n      const result = await transactionStatementService.uploadMonthlyStatement(\n        file,\n        uploaderName || 'ì•Œ ìˆ˜ ì—†ìŒ',\n        undefined,\n        undefined,\n        fileType\n      );\n\n      if (result.success && result.data) {\n        toast.success('ì›”ë§ê²°ì œ ê±°ë˜ëª…ì„¸ì„œ ì—…ë¡œë“œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');\n        onSuccess(result.data.statementId, result.data.fileUrl);\n        handleClose();\n      } else {\n        toast.error(result.error || 'ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n      }\n    } catch (error) {\n      toast.error('ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');\n    } finally {\n      setUploading(false);\n    }\n  };\n\n  const handleClose = () => {\n    if (uploading) return;\n    setFile(null);\n    setPreview(null);\n    if (fileInputRef.current) fileInputRef.current.value = '';\n    onClose();\n  };\n\n  const fileType = file ? getFileType(file) : null;\n\n  return (\n    <Dialog open={isOpen} onOpenChange={handleClose}>\n      <DialogContent className=\"sm:max-w-[480px] business-radius-modal\">\n        <DialogHeader className=\"border-b border-gray-100 pb-3\">\n          <DialogTitle className=\"flex items-center gap-2 text-[13px] font-bold text-gray-900\">\n            <FileSpreadsheet className=\"w-4 h-4 text-emerald-600\" />\n            ê±°ë˜ëª…ì„¸ì„œ(ì›”ë§ê²°ì œ) ì—…ë¡œë“œ\n          </DialogTitle>\n        </DialogHeader>\n\n        <div className=\"py-4 px-1\">\n          {/* ë“œë˜ê·¸ì•¤ë“œë¡­ ì˜ì—­ */}\n          <div\n            className={`\n              border-2 border-dashed business-radius-card p-6 text-center cursor-pointer transition-colors\n              ${file \n                ? 'border-emerald-300 bg-emerald-50' \n                : 'border-gray-200 hover:border-emerald-300 hover:bg-gray-50'\n              }\n            `}\n            onDrop={handleDrop}\n            onDragOver={handleDragOver}\n            onClick={handleClick}\n          >\n            <input\n              ref={fileInputRef}\n              type=\"file\"\n              accept=\".xls,.xlsx,.pdf,image/*\"\n              onChange={handleInputChange}\n              className=\"hidden\"\n            />\n\n            {file ? (\n              <div className=\"relative\">\n                {preview ? (\n                  <img\n                    src={preview}\n                    alt=\"ë¯¸ë¦¬ë³´ê¸°\"\n                    className=\"max-h-52 mx-auto business-radius-card shadow-sm\"\n                  />\n                ) : (\n                  <div className=\"flex flex-col items-center gap-2\">\n                    <FileSpreadsheet className=\"w-12 h-12 text-emerald-500\" />\n                    <span className=\"text-[11px] font-medium text-emerald-700\">\n                      {fileType === 'excel' ? 'ì—‘ì…€ íŒŒì¼' : fileType === 'pdf' ? 'PDF íŒŒì¼' : 'ì´ë¯¸ì§€ íŒŒì¼'}\n                    </span>\n                  </div>\n                )}\n                <button\n                  className=\"absolute top-2 right-2 p-1.5 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors\"\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    handleRemoveFile();\n                  }}\n                >\n                  <X className=\"w-3.5 h-3.5\" />\n                </button>\n                <p className=\"mt-3 text-[11px] text-gray-600 truncate px-4\">\n                  {file.name}\n                </p>\n              </div>\n            ) : (\n              <>\n                <FileSpreadsheet className=\"w-10 h-10 text-gray-300 mx-auto mb-3\" />\n                <p className=\"text-[11px] text-gray-600 mb-1\">\n                  ì›”ë§ê²°ì œ ê±°ë˜ëª…ì„¸ì„œë¥¼ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”\n                </p>\n                <p className=\"text-[10px] text-gray-400\">\n                  ì§€ì› í˜•ì‹: XLS, XLSX, PDF, JPG, PNG (ìµœëŒ€ 20MB)\n                </p>\n              </>\n            )}\n          </div>\n\n\n          {/* ì•ˆë‚´ ë¬¸êµ¬ */}\n          <div className=\"mt-4 p-3 bg-emerald-50 business-radius-card border border-emerald-100\">\n            <p className=\"text-[10px] text-emerald-700 leading-relaxed\">\n              ì›”ë§ê²°ì œ ì—…ì²´ì˜ ê±°ë˜ëª…ì„¸ì„œë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”.\n              ì—‘ì…€/PDFëŠ” íŒŒì‹±ìœ¼ë¡œ ì •í™•í•˜ê²Œ, ì´ë¯¸ì§€ëŠ” OCRë¡œ ìë™ ì¶”ì¶œí•©ë‹ˆë‹¤.\n              í’ˆëª©ëª…ìœ¼ë¡œ ì‹œìŠ¤í…œ ë°œì£¼ë¥¼ ë§¤ì¹­í•˜ì—¬ ë‹¨ê°€/í•©ê³„ë¥¼ ìë™ ê¸°ì…í•©ë‹ˆë‹¤.\n            </p>\n          </div>\n        </div>\n\n        <DialogFooter className=\"border-t border-gray-100 pt-3 gap-2\">\n          <Button\n            variant=\"outline\"\n            onClick={handleClose}\n            disabled={uploading}\n            className=\"button-base h-8 text-[11px]\"\n          >\n            ì·¨ì†Œ\n          </Button>\n          <Button\n            onClick={handleUpload}\n            disabled={!file || uploading}\n            className=\"button-base h-8 text-[11px] bg-emerald-600 hover:bg-emerald-700 text-white\"\n          >\n            {uploading ? (\n              <>\n                <Loader2 className=\"w-3.5 h-3.5 mr-1.5 animate-spin\" />\n                ì—…ë¡œë“œ ì¤‘...\n              </>\n            ) : (\n              <>\n                <Upload className=\"w-3.5 h-3.5 mr-1.5\" />\n                ì—…ë¡œë“œ\n              </>\n            )}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","import {\n  Dialog,\n  DialogContent,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { X, ZoomIn, ZoomOut, RotateCw, Download } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { toast } from \"sonner\";\n\ninterface StatementImageViewerProps {\n  isOpen: boolean;\n  imageUrl: string;\n  onClose: () => void;\n}\n\n/**\n * ê±°ë˜ëª…ì„¸ì„œ ì´ë¯¸ì§€ ë·°ì–´ (ë¼ì´íŠ¸ë°•ìŠ¤)\n */\nexport default function StatementImageViewer({\n  isOpen,\n  imageUrl,\n  onClose,\n}: StatementImageViewerProps) {\n  const [scale, setScale] = useState(1);\n  const [rotation, setRotation] = useState(0);\n\n  const handleZoomIn = () => {\n    setScale((prev) => Math.min(prev + 0.25, 3));\n  };\n\n  const handleZoomOut = () => {\n    setScale((prev) => Math.max(prev - 0.25, 0.5));\n  };\n\n  const handleRotate = () => {\n    setRotation((prev) => (prev + 90) % 360);\n  };\n\n  const handleDownload = async () => {\n    try {\n      const response = await fetch(imageUrl);\n      const blob = await response.blob();\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `ê±°ë˜ëª…ì„¸ì„œ_${new Date().toISOString().split('T')[0]}.jpg`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      window.URL.revokeObjectURL(url);\n      toast.success('ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');\n    } catch (error) {\n      toast.error('ë‹¤ìš´ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n    }\n  };\n\n  const handleClose = () => {\n    setScale(1);\n    setRotation(0);\n    onClose();\n  };\n\n  if (!imageUrl) return null;\n\n  return (\n    <Dialog open={isOpen} onOpenChange={handleClose}>\n      <DialogContent className=\"max-w-[90vw] max-h-[90vh] p-0 bg-black/95 border-none\">\n        {/* ì»¨íŠ¸ë¡¤ ë°” */}\n        <div className=\"absolute top-0 left-0 right-0 z-50 flex items-center justify-between px-4 py-3 bg-gradient-to-b from-black/80 to-transparent\">\n          <div className=\"flex items-center gap-1.5\">\n            <button\n              onClick={handleZoomOut}\n              disabled={scale <= 0.5}\n              className=\"p-2 rounded-lg bg-white/10 hover:bg-white/20 text-white disabled:opacity-40 transition-colors\"\n            >\n              <ZoomOut className=\"w-4 h-4\" />\n            </button>\n            <span className=\"text-[11px] text-white min-w-[50px] text-center font-medium\">\n              {Math.round(scale * 100)}%\n            </span>\n            <button\n              onClick={handleZoomIn}\n              disabled={scale >= 3}\n              className=\"p-2 rounded-lg bg-white/10 hover:bg-white/20 text-white disabled:opacity-40 transition-colors\"\n            >\n              <ZoomIn className=\"w-4 h-4\" />\n            </button>\n            <div className=\"w-px h-5 bg-white/30 mx-1.5\" />\n            <button\n              onClick={handleRotate}\n              className=\"p-2 rounded-lg bg-white/10 hover:bg-white/20 text-white transition-colors\"\n            >\n              <RotateCw className=\"w-4 h-4\" />\n            </button>\n            <button\n              onClick={handleDownload}\n              className=\"p-2 rounded-lg bg-white/10 hover:bg-white/20 text-white transition-colors\"\n            >\n              <Download className=\"w-4 h-4\" />\n            </button>\n          </div>\n          <button\n            onClick={handleClose}\n            className=\"p-2 rounded-lg bg-white/10 hover:bg-white/20 text-white transition-colors\"\n          >\n            <X className=\"w-4 h-4\" />\n          </button>\n        </div>\n\n        {/* ì´ë¯¸ì§€ */}\n        <div className=\"flex items-center justify-center w-full h-[80vh] overflow-auto p-4 pt-16\">\n          <img\n            src={imageUrl}\n            alt=\"ê±°ë˜ëª…ì„¸ì„œ\"\n            className=\"max-w-full max-h-full object-contain transition-transform duration-200\"\n            style={{\n              transform: `scale(${scale}) rotate(${rotation}deg)`,\n            }}\n          />\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","import { useState, useEffect, useCallback, useMemo, useRef } from \"react\";\nimport { createPortal } from \"react-dom\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  CheckCircle,\n  XCircle,\n  Image as ImageIcon,\n  Loader2,\n  ChevronDown,\n  Check,\n  ExternalLink,\n  Search,\n  RefreshCw\n} from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { createClient } from \"@/lib/supabase/client\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport transactionStatementService from \"@/services/transactionStatementService\";\nimport type { \n  TransactionStatement, \n  TransactionStatementWithItems,\n  TransactionStatementItemWithMatch,\n  ConfirmItemRequest,\n  MatchCandidate,\n  OCRFieldType,\n  StatementMode\n} from \"@/types/transactionStatement\";\nimport { normalizeOrderNumber } from \"@/types/transactionStatement\";\nimport { logger } from \"@/lib/logger\";\nimport StatementImageViewer from \"./StatementImageViewer\";\nimport PurchaseDetailModal from \"@/components/purchase/PurchaseDetailModal\";\n\ninterface StatementConfirmModalProps {\n  isOpen: boolean;\n  statement: TransactionStatement;\n  onClose: () => void;\n  onConfirm: () => void;\n  onReextractStart?: (statementId: string) => void;\n  onReextractFinish?: (statementId: string) => void;\n}\n\n// ì‹œìŠ¤í…œ ë°œì£¼ í’ˆëª© íƒ€ì…\ninterface SystemPurchaseItem {\n  purchase_id: number;\n  item_id: number;\n  purchase_order_number: string;\n  sales_order_number?: string;\n  item_name: string;\n  specification?: string;  // ê·œê²© ì¶”ê°€ - êµì°¨ ë¹„êµìš©\n  quantity?: number;\n  received_quantity?: number;\n  unit_price?: number;\n  amount?: number;\n  vendor_name?: string;\n}\n\n// Levenshtein ê±°ë¦¬ ê³„ì‚° í•¨ìˆ˜\nfunction levenshteinDistance(str1: string, str2: string): number {\n  const s1 = str1.toLowerCase().replace(/\\s+/g, '');\n  const s2 = str2.toLowerCase().replace(/\\s+/g, '');\n  \n  if (s1 === s2) return 0;\n  if (s1.length === 0) return s2.length;\n  if (s2.length === 0) return s1.length;\n\n  const matrix: number[][] = [];\n\n  for (let i = 0; i <= s1.length; i++) {\n    matrix[i] = [i];\n  }\n  for (let j = 0; j <= s2.length; j++) {\n    matrix[0][j] = j;\n  }\n\n  for (let i = 1; i <= s1.length; i++) {\n    for (let j = 1; j <= s2.length; j++) {\n      const cost = s1[i - 1] === s2[j - 1] ? 0 : 1;\n      matrix[i][j] = Math.min(\n        matrix[i - 1][j] + 1,\n        matrix[i][j - 1] + 1,\n        matrix[i - 1][j - 1] + cost\n      );\n    }\n  }\n\n  return matrix[s1.length][s2.length];\n}\n\n// ë‹¨ì¼ ë¬¸ìì—´ ìœ ì‚¬ë„ ê³„ì‚° (ë‚´ë¶€ í—¬í¼) - ë” ì—„ê²©í•œ ë²„ì „\nfunction calculateStringSimilarity(ocrName: string, targetName: string): number {\n  const ocr = ocrName?.toLowerCase().replace(/\\s+/g, '') || '';\n  const target = targetName?.toLowerCase().replace(/\\s+/g, '') || '';\n  \n  if (!ocr || !target) return 0;\n  \n  // ì™„ì „ ì¼ì¹˜\n  if (ocr === target) return 100;\n  \n  // ë¶€ë¶„ í¬í•¨ - ê¸¸ì´ ë¹„ìœ¨ ì²´í¬ (ìµœì†Œ 50% ì´ìƒ ê²¹ì³ì•¼ ë†’ì€ ì ìˆ˜)\n  const minLen = Math.min(ocr.length, target.length);\n  const maxLen = Math.max(ocr.length, target.length);\n  const lengthRatio = minLen / maxLen;\n  \n  if (ocr.includes(target) || target.includes(ocr)) {\n    // ê¸¸ì´ ë¹„ìœ¨ì´ ë‚®ìœ¼ë©´ ì ìˆ˜ ê°ì†Œ (ì˜ˆ: \"A\"ê°€ \"ABCDEFG\"ì— í¬í•¨ë˜ë©´ ë‚®ì€ ì ìˆ˜)\n    if (lengthRatio >= 0.7) return 90; // 70% ì´ìƒ ê²¹ì¹¨\n    if (lengthRatio >= 0.5) return 70; // 50% ì´ìƒ ê²¹ì¹¨\n    if (lengthRatio >= 0.3) return 50; // 30% ì´ìƒ ê²¹ì¹¨\n    return 30; // ê·¸ ì™¸ (ë„ˆë¬´ ì§§ì€ ë¬¸ìì—´ì´ í¬í•¨ëœ ê²½ìš°)\n  }\n  \n  // Levenshtein ê±°ë¦¬ ê¸°ë°˜\n  const distance = levenshteinDistance(ocr, target);\n  const similarity = ((maxLen - distance) / maxLen) * 100;\n  \n  // ë‹¨ì–´ ì¼ë¶€ ì¼ì¹˜ ì²´í¬ - ë³´ë„ˆìŠ¤ ì¶•ì†Œ (30 â†’ 15)\n  const ocrWords = ocrName?.split(/\\s+/).filter(w => w.length >= 2) || [];\n  const targetWords = targetName?.split(/\\s+/).filter(w => w.length >= 2) || [];\n  \n  if (ocrWords.length === 0 || targetWords.length === 0) {\n    return similarity;\n  }\n  \n  const commonWords = ocrWords.filter(w => \n    targetWords.some(tw => {\n      const wLower = w.toLowerCase();\n      const twLower = tw.toLowerCase();\n      // ìµœì†Œ 3ê¸€ì ì´ìƒ ì¼ì¹˜í•´ì•¼ ë‹¨ì–´ ì¼ì¹˜ë¡œ ì¸ì •\n      return wLower === twLower || \n        (wLower.length >= 3 && twLower.includes(wLower)) || \n        (twLower.length >= 3 && wLower.includes(twLower));\n    })\n  );\n  const wordMatchBonus = (commonWords.length / Math.max(ocrWords.length, targetWords.length)) * 15;\n  \n  return Math.min(100, similarity + wordMatchBonus);\n}\n\n// í’ˆëª©ëª… ìœ ì‚¬ë„ ì ìˆ˜ ê³„ì‚° - í’ˆëª©ëª… ìš°ì„ , ê·œê²©ì€ ë³´ì¡°\nfunction calculateItemSimilarity(ocrName: string, systemItemName: string, systemSpec?: string): number {\n  // 1. item_nameê³¼ ë¹„êµ (ê¸°ë³¸)\n  const itemNameScore = calculateStringSimilarity(ocrName, systemItemName);\n  \n  // 2. specificationê³¼ë„ ë¹„êµ (ìˆìœ¼ë©´)\n  const specScore = systemSpec ? calculateStringSimilarity(ocrName, systemSpec) : 0;\n  \n  // 3. í’ˆëª©ëª…ì´ ì–´ëŠ ì •ë„ ì¼ì¹˜í•˜ë©´ (30% ì´ìƒ) ê·¸ ì ìˆ˜ ì‚¬ìš©\n  if (itemNameScore >= 30) {\n    return itemNameScore;\n  }\n  \n  // 4. í’ˆëª©ëª…ì´ ì „í˜€ ì•ˆ ë§ëŠ”ë° (30% ë¯¸ë§Œ) ê·œê²©ë§Œ ì¼ì¹˜í•˜ëŠ” ê²½ìš°\n  //    â†’ ê·œê²© ì¼ì¹˜ëŠ” ë³´ì¡° ì •ë³´ì´ë¯€ë¡œ ì ìˆ˜ì— í° íŒ¨ë„í‹° ë¶€ì—¬\n  if (specScore >= 60 && itemNameScore < 30) {\n    // ê·œê²©ì´ ì¼ì¹˜í•´ë„ í’ˆëª©ëª…ì´ ì „í˜€ ë‹¤ë¥´ë©´ ìµœëŒ€ 35%ë§Œ ì¸ì •\n    // (ì‚¬ìš©ìê°€ \"í’ˆëª©ëª…ì´ ë‹¤ë¥¸ë° ì™œ ì¼ì¹˜?\"ë¼ê³  í˜¼ë€ìŠ¤ëŸ¬ì›Œí•¨)\n    return Math.min(35, specScore * 0.4);\n  }\n  \n  // 5. ë‘˜ ë‹¤ ë‚®ìœ¼ë©´ ë‚®ì€ ì ìˆ˜ ë°˜í™˜\n  return Math.max(itemNameScore, specScore * 0.3);\n}\n\n// ìˆ˜ëŸ‰ ì¼ì¹˜ ì—¬ë¶€ í™•ì¸ (ì •í™•íˆ ì¼ì¹˜í•˜ë©´ true)\nfunction isQuantityMatched(ocrQuantity: number | undefined | null, systemQuantity: number | undefined | null): boolean {\n  if (ocrQuantity === undefined || ocrQuantity === null) return false;\n  if (systemQuantity === undefined || systemQuantity === null) return false;\n  return ocrQuantity === systemQuantity;\n}\n\n// ìˆ˜ëŸ‰ ì¼ì¹˜ìœ¨ ê³„ì‚° (ë¶€ë¶„ ì…ê³  ê³ ë ¤ - 10% ì´ë‚´ ì˜¤ì°¨ í—ˆìš©)\nfunction getQuantityMatchLevel(ocrQuantity: number | undefined | null, systemQuantity: number | undefined | null): 'exact' | 'partial' | 'mismatch' {\n  if (ocrQuantity === undefined || ocrQuantity === null) return 'mismatch';\n  if (systemQuantity === undefined || systemQuantity === null) return 'mismatch';\n  \n  if (ocrQuantity === systemQuantity) return 'exact';\n  \n  // ë¶€ë¶„ ì…ê³ : OCR ìˆ˜ëŸ‰ì´ ì‹œìŠ¤í…œ ìˆ˜ëŸ‰ë³´ë‹¤ ì‘ê±°ë‚˜ ê°™ìœ¼ë©´ partial\n  if (ocrQuantity <= systemQuantity) return 'partial';\n  \n  return 'mismatch';\n}\n\n/**\n * ê±°ë˜ëª…ì„¸ì„œ í™•ì¸/ìˆ˜ì •/í™•ì • ëª¨ë‹¬ - 3ë‹¨ ë¹„êµ ë ˆì´ì•„ì›ƒ\n */\nexport default function StatementConfirmModal({\n  isOpen,\n  statement,\n  onClose,\n  onConfirm,\n  onReextractStart,\n  onReextractFinish,\n}: StatementConfirmModalProps) {\n  const [loading, setLoading] = useState(true);\n  const [saving, setSaving] = useState(false);\n  const [savingAction, setSavingAction] = useState<'confirm' | 'quantity-match' | 'reject' | null>(null);\n  const [statementWithItems, setStatementWithItems] = useState<TransactionStatementWithItems | null>(null);\n  const [isImageViewerOpen, setIsImageViewerOpen] = useState(false);\n  const [confirmerName, setConfirmerName] = useState(\"\");\n  const dialogDebugId = \"statement-confirm-dialog\";\n  const { currentUserRoles, currentUserId, currentUserName } = useAuth();\n  const supabase = createClient();\n  \n  // ì„ íƒëœ ë°œì£¼/ìˆ˜ì£¼ë²ˆí˜¸ (Case 1: ì „ì²´ ì ìš©ìš©)\n  const [selectedPONumber, setSelectedPONumber] = useState<string>(\"\");\n  \n  // ê° OCR í’ˆëª©ë³„ ì„ íƒëœ ë°œì£¼/ìˆ˜ì£¼ë²ˆí˜¸ (Case 2: ê°œë³„ ì ìš©ìš©)\n  const [itemPONumbers, setItemPONumbers] = useState<Map<string, string>>(new Map());\n  \n  // ê° OCR í’ˆëª©ë³„ ë§¤ì¹­ëœ ì‹œìŠ¤í…œ í’ˆëª©\n  const [itemMatches, setItemMatches] = useState<Map<string, SystemPurchaseItem | null>>(new Map());\n  \n  // ë“œë¡­ë‹¤ìš´ ì—´ë¦¼ ìƒíƒœ\n  const [openDropdowns, setOpenDropdowns] = useState<Set<string>>(new Set());\n  \n  // ë“œë¡­ë‹¤ìš´ ìœ„ì¹˜ (fixed positionìš©)\n  const [dropdownPosition, setDropdownPosition] = useState<{ top: number; left: number }>({ top: 0, left: 0 });\n  \n  // ë°œì£¼ ìƒì„¸ ëª¨ë‹¬ ìƒíƒœ\n  const [isPurchaseDetailModalOpen, setIsPurchaseDetailModalOpen] = useState(false);\n  const [selectedPurchaseIdForDetail, setSelectedPurchaseIdForDetail] = useState<number | null>(null);\n  \n  // OCR í’ˆëª© í¸ì§‘ ìƒíƒœ (í•™ìŠµìš©)\n  // key: itemId, value: ìˆ˜ì •ëœ ê°’ë“¤\n  interface EditedOCRItem {\n    item_name?: string;\n    quantity?: number;\n    unit_price?: number;\n    amount?: number;\n    po_number?: string;\n  }\n  const [editedOCRItems, setEditedOCRItems] = useState<Map<string, EditedOCRItem>>(new Map());\n  \n  // ë””ë°”ìš´ìŠ¤ íƒ€ì´ë¨¸ (OCR ìˆ˜ì • ìë™ ì €ì¥ìš©)\n  const editDebounceTimerRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n  \n  // ë§¤ì¹­ ìƒì„¸ ì •ë³´ íŒì—…\n  const [matchDetailPopup, setMatchDetailPopup] = useState<{\n    isOpen: boolean;\n    ocrItemId: string;\n    ocrItemName: string;\n    systemItemName: string;\n    systemSpec: string;\n    similarity: number;\n    status: 'high' | 'med' | 'low' | 'unmatched';\n    reasons: string[];\n  } | null>(null);\n  const [purchaseCurrencyMap, setPurchaseCurrencyMap] = useState<Map<number, string>>(new Map());\n\n  const isReceiptMode =\n    (statementWithItems?.statement_mode ?? statement.statement_mode) === \"receipt\";\n  const isMonthlyMode =\n    (statementWithItems?.statement_mode ?? statement.statement_mode) === \"monthly\";\n\n  useEffect(() => {\n    if (!statementWithItems) return;\n    const sample = statementWithItems.items.slice(0, 5).map(item => {\n      const matchedSystem = itemMatches.get(item.id);\n      return {\n        itemId: item.id,\n        matched: Boolean(matchedSystem),\n        sysUnitPrice: matchedSystem?.unit_price ?? null,\n        sysAmount: matchedSystem?.amount ?? null,\n        sysKeys: matchedSystem ? Object.keys(matchedSystem) : []\n      };\n    });\n  }, [statementWithItems, itemMatches, isReceiptMode, statement.id]);\n\n  useEffect(() => {\n    if (!statementWithItems) return;\n    const matchedSample = Array.from(itemMatches.values()).find(Boolean) as any;\n  }, [statementWithItems, itemMatches, statement.id]);\n\n  useEffect(() => {\n    if (!statementWithItems) return;\n    const purchaseIds = Array.from(itemMatches.values())\n      .filter(Boolean)\n      .map(item => (item as SystemPurchaseItem).purchase_id)\n      .filter((id): id is number => typeof id === 'number');\n    const uniqueIds = Array.from(new Set(purchaseIds));\n    if (uniqueIds.length === 0) return;\n\n    const loadCurrencies = async () => {\n      const { data, error } = await supabase\n        .from('purchase_requests')\n        .select('id, currency')\n        .in('id', uniqueIds);\n      if (error || !data) return;\n      const map = new Map<number, string>();\n      data.forEach((row: { id: number | null; currency: string | null }) => {\n        if (row?.id) map.set(row.id, row.currency || 'KRW');\n      });\n      setPurchaseCurrencyMap(map);\n    };\n    loadCurrencies();\n  }, [statementWithItems, itemMatches, supabase, statement.id]);\n  \n  // í†µí•© ë§¤ì¹­ ìƒì„¸ íŒì—… (ë°œì£¼ë²ˆí˜¸ ì „ì²´ ë§¤ì¹­ ë‚´ì—­)\n  const [isIntegratedMatchDetailOpen, setIsIntegratedMatchDetailOpen] = useState(false);\n  \n  // ê±°ë˜ì²˜ ì¸ë¼ì¸ ê²€ìƒ‰ ìƒíƒœ\n  const [vendorInputValue, setVendorInputValue] = useState('');\n  const [vendorSearchResults, setVendorSearchResults] = useState<Array<{ id: number; name: string; english_name?: string }>>([]);\n  const [vendorSearchLoading, setVendorSearchLoading] = useState(false);\n  const [vendorDropdownOpen, setVendorDropdownOpen] = useState(false);\n  const [overrideVendorName, setOverrideVendorName] = useState<string | null>(null);\n  type VendorSearchRow = { id: number; vendor_name: string; english_name?: string | null };\n  const [poItemsMap, setPoItemsMap] = useState<Map<string, SystemPurchaseItem[]>>(new Map());\n  const autoVendorSelectionRef = useRef(false);\n  const systemCandidateLogKeyRef = useRef<string | null>(null);\n  \n  // ë°œì£¼ë²ˆí˜¸ ì¸ë¼ì¸ ê²€ìƒ‰ ìƒíƒœ\n  const [poSearchInputOpen, setPOSearchInputOpen] = useState(false);\n  const [poSearchInput, setPOSearchInput] = useState('');\n  const [poSearchResults, setPOSearchResults] = useState<Array<{ id: number; poNumber: string; soNumber?: string; vendorName?: string }>>([]);\n  const [poSearchLoading, setPOSearchLoading] = useState(false);\n  const [poDropdownOpen, setPODropdownOpen] = useState(false);\n  const [manuallySelectedPO, setManuallySelectedPO] = useState(false); // ìˆ˜ë™ ì„ íƒ ì—¬ë¶€\n  const keepPODropdownOpenRef = useRef(false);\n  const [itemPOSearchInputs, setItemPOSearchInputs] = useState<Record<string, string>>({});\n  const [itemPOSearchResults, setItemPOSearchResults] = useState<Record<string, Array<{ id: number; poNumber: string; soNumber?: string; vendorName?: string }>>>({});\n  const [itemPOSearchLoading, setItemPOSearchLoading] = useState<Record<string, boolean>>({});\n  const lastSelectedSystemItemRef = useRef<string | null>(null);\n  const [statementDateInput, setStatementDateInput] = useState('');\n\n  // OCR ë°œì£¼/ìˆ˜ì£¼ë²ˆí˜¸ í˜ì–´ ìºì‹œ (ì‹¤ì‹œê°„ ì…ë ¥ìš©)\n  const [poPairOverrides, setPoPairOverrides] = useState<Map<string, string | null>>(new Map());\n  const pendingPairLookupsRef = useRef<Set<string>>(new Set());\n\n  // ëª¨ë‹¬ ë‹«í ë•Œ ë””ë°”ìš´ìŠ¤ íƒ€ì´ë¨¸ ì •ë¦¬\n  useEffect(() => {\n    return () => {\n      if (editDebounceTimerRef.current) {\n        clearTimeout(editDebounceTimerRef.current);\n      }\n    };\n  }, []);\n\n  useEffect(() => {\n    if (!isOpen) return;\n\n    const logMetrics = (reason: string) => {\n      const el = document.querySelector(`[data-debug=\"${dialogDebugId}\"]`) as HTMLElement | null;\n      const viewport = {\n        innerWidth: window.innerWidth,\n        innerHeight: window.innerHeight,\n        clientWidth: document.documentElement?.clientWidth,\n        clientHeight: document.documentElement?.clientHeight\n      };\n\n      if (!el) {\n        return;\n      }\n\n      const rect = el.getBoundingClientRect();\n      const styles = window.getComputedStyle(el);\n    };\n\n    const rafId = requestAnimationFrame(() => logMetrics(\"open\"));\n    const handleResize = () => logMetrics(\"resize\");\n    window.addEventListener(\"resize\", handleResize);\n\n    return () => {\n      cancelAnimationFrame(rafId);\n      window.removeEventListener(\"resize\", handleResize);\n    };\n  }, [isOpen, dialogDebugId]);\n  \n  // ì„¸íŠ¸ ë§¤ì¹­ ê²°ê³¼ (Case 1ìš©)\n  const [setMatchResult, setSetMatchResult] = useState<{\n    bestMatch: {\n      purchase_id: number;\n      purchase_order_number: string;\n      sales_order_number?: string;\n      vendor_name?: string;\n      matchScore: number;\n      matchedItemCount: number;\n      totalItemCount: number;\n      confidence: 'high' | 'medium' | 'low';\n      itemMatches: Array<{\n        ocrItemId: string;\n        systemItemId: number;\n        systemItemName: string;\n        similarity: number;\n      }>;\n    } | null;\n    candidates: Array<{\n      purchase_id: number;\n      purchase_order_number: string;\n      sales_order_number?: string;\n      vendor_name?: string;\n      matchScore: number;\n      matchedItemCount: number;\n    }>;\n  } | null>(null);\n  \n  // ëª¨ë“  í’ˆëª©ì˜ ë°œì£¼/ìˆ˜ì£¼ë²ˆí˜¸ê°€ ë™ì¼í•œì§€ í™•ì¸\n  const isSamePONumber = useMemo(() => {\n    if (!statementWithItems?.items.length) return true;\n    if (statementWithItems?.po_scope === 'single') return true;\n    \n    const poNumbers = statementWithItems.items\n      .map(item => item.extracted_po_number ? normalizeOrderNumber(item.extracted_po_number) : null)\n      .filter(Boolean);\n    \n    if (poNumbers.length === 0) return true;\n    \n    return poNumbers.every(po => po === poNumbers[0]);\n  }, [statementWithItems]);\n\n  // ê³µí†µ ë°œì£¼/ìˆ˜ì£¼ë²ˆí˜¸ (Case 1ìš©)\n  const commonPONumber = useMemo(() => {\n    if (!statementWithItems?.items.length) return null;\n    \n    const poNumber = statementWithItems.items.find(item => item.extracted_po_number)?.extracted_po_number;\n    return poNumber ? normalizeOrderNumber(poNumber) : null;\n  }, [statementWithItems]);\n\n  // ê±°ë˜ì²˜ëª… ì´ˆê¸°ê°’ ì„¤ì •\n  useEffect(() => {\n    if (!statementWithItems) return;\n    const initialVendor = statementWithItems.vendor_name || '';\n    if (initialVendor && !vendorInputValue) {\n      setVendorInputValue(initialVendor);\n    }\n    if (initialVendor && !autoVendorSelectionRef.current) {\n      autoVendorSelectionRef.current = true;\n      handleSelectVendor(initialVendor, { silent: true });\n    }\n  }, [statementWithItems, vendorInputValue]);\n\n  const normalizeStatementDate = (value?: string | null) => {\n    if (!value) return '';\n    const trimmed = value.trim();\n    if (!trimmed) return '';\n    if (/^\\d{4}-\\d{2}-\\d{2}$/.test(trimmed)) return trimmed;\n    const parsed = new Date(trimmed);\n    if (!Number.isNaN(parsed.getTime())) {\n      return parsed.toISOString().slice(0, 10);\n    }\n    return trimmed.slice(0, 10);\n  };\n\n  // ê±°ë˜ì¼ ì´ˆê¸°ê°’ ì„¤ì •\n  useEffect(() => {\n    if (!statementWithItems) return;\n    setStatementDateInput(normalizeStatementDate(statementWithItems.statement_date));\n  }, [statementWithItems]);\n\n  // ë°ì´í„° ë¡œë“œ\n  const loadData = useCallback(async () => {\n    try {\n      setLoading(true);\n      \n      const { data: { user } } = await supabase.auth.getUser();\n      if (user?.email) {\n        const { data: employee } = await supabase\n          .from('employees')\n          .select('name')\n          .eq('email', user.email)\n          .single();\n        \n        if (employee?.name) {\n          setConfirmerName(employee.name);\n        }\n      }\n\n      const result = await transactionStatementService.getStatementWithItems(statement.id);\n      \n      if (result.success && result.data) {\n        // #region agent log\n        fetch('http://127.0.0.1:7244/ingest/d1bfd845-9c34-4c24-9ef7-fd981ce7dd8e',{method:'POST',headers:{'Content-Type':'application/json','X-Debug-Session-Id':'9f46d9'},body:JSON.stringify({sessionId:'9f46d9',runId:'ocr-regression-debug',hypothesisId:'H3',location:'StatementConfirmModal.tsx:loadData:ocrItemsSnapshot',message:'modal received ocr items snapshot',data:{statementId:statement.id,itemCount:result.data.items.length,sample:result.data.items.slice(0,5).map((item:any)=>({id:item?.id ?? null,line:item?.line_number ?? null,itemName:item?.extracted_item_name ?? null,specification:item?.extracted_specification ?? null,quantity:item?.extracted_quantity ?? null,unitPrice:item?.extracted_unit_price ?? null,amount:item?.extracted_amount ?? null,po:item?.extracted_po_number ?? null,matchedPurchaseId:item?.matched_purchase_id ?? null,matchedItemId:item?.matched_item_id ?? null}))},timestamp:Date.now()})}).catch(()=>{});\n        // #endregion\n        setStatementWithItems(result.data);\n        \n        // ì´ˆê¸° ë°œì£¼ë²ˆí˜¸ ì„¤ì • ë° ìë™ ë§¤ì¹­\n        const initialPONumbers = new Map<string, string>();\n        const initialMatches = new Map<string, SystemPurchaseItem | null>();\n        \n        result.data.items.forEach(item => {\n          // ì¶”ì¶œëœ ë°œì£¼ë²ˆí˜¸ ì„¤ì • (ì‹œìŠ¤í…œ í˜•ì‹ìœ¼ë¡œ ì •ê·œí™”)\n          let poNumber = '';\n          if (item.extracted_po_number) {\n            poNumber = normalizeOrderNumber(item.extracted_po_number);\n            const hasCandidateMatch = item.match_candidates?.some(c =>\n              c.purchase_order_number === poNumber || c.sales_order_number === poNumber\n            );\n            if (hasCandidateMatch) {\n              initialPONumbers.set(item.id, poNumber);\n            }\n          }\n          \n          // ê¸°ì¡´ ë§¤ì¹­ ì •ë³´ê°€ ìˆìœ¼ë©´ ì„¤ì •\n          if (item.matched_purchase && item.matched_item_id) {\n            const matchedPO = item.matched_purchase.purchase_order_number ||\n              item.matched_purchase.sales_order_number ||\n              '';\n            if (matchedPO) {\n              initialPONumbers.set(item.id, matchedPO);\n            }\n            initialMatches.set(item.id, {\n              purchase_id: item.matched_purchase_id!,\n              item_id: item.matched_item_id!,\n              purchase_order_number: item.matched_purchase.purchase_order_number || '',\n              sales_order_number: item.matched_purchase.sales_order_number,\n              item_name: (item as any).matched_item?.item_name || (item as any).matched_item_name || '',\n              specification: (item as any).matched_item?.specification,\n              quantity: (item as any).matched_item?.quantity ?? (item as any).matched_item_quantity,\n              unit_price: (item as any).matched_item?.unit_price_value ?? (item as any).matched_item_unit_price,\n              amount: (item as any).matched_item?.amount_value ?? (item as any).matched_item_amount,\n              received_quantity: (item as any).matched_item?.received_quantity,\n              vendor_name: item.matched_purchase.vendor_name\n            });\n          } else {\n            // ìë™ ë§¤ì¹­: í•´ë‹¹ ë°œì£¼ë²ˆí˜¸ì˜ í›„ë³´ ì¤‘ì—ì„œ ê°€ì¥ ìœ ì‚¬í•œ í’ˆëª© ì°¾ê¸°\n            let bestMatch: SystemPurchaseItem | null = null;\n            let bestScore = -1;\n            \n            // 1. í•´ë‹¹ ë°œì£¼ë²ˆí˜¸ì™€ ì¼ì¹˜í•˜ëŠ” í›„ë³´ ê²€ìƒ‰\n            const matchingCandidates = item.match_candidates?.filter(c => \n              c.purchase_order_number === poNumber || c.sales_order_number === poNumber\n            ) || [];\n            \n            for (const c of matchingCandidates) {\n              const score = calculateItemSimilarity(item.extracted_item_name || '', c.item_name, c.specification);\n              if (score > bestScore) {\n                bestScore = score;\n                bestMatch = {\n                  purchase_id: c.purchase_id,\n                  item_id: c.item_id,\n                  purchase_order_number: c.purchase_order_number || '',\n                  sales_order_number: c.sales_order_number,\n                  item_name: c.item_name,\n                  specification: c.specification,\n                  quantity: c.quantity,\n                  received_quantity: c.received_quantity,\n                  unit_price: c.unit_price,\n                  amount: (c as any).amount,\n                  vendor_name: c.vendor_name\n                };\n              }\n            }\n            \n            // 2. ë°œì£¼ë²ˆí˜¸ë¡œ ëª» ì°¾ìœ¼ë©´ ëª¨ë“  í›„ë³´ì—ì„œ ìµœê³  ìœ ì‚¬ë„ë¡œ ê²€ìƒ‰ (fallback)\n            if (!bestMatch && item.match_candidates && item.match_candidates.length > 0) {\n              for (const c of item.match_candidates) {\n                const score = calculateItemSimilarity(item.extracted_item_name || '', c.item_name, c.specification);\n                if (score > bestScore && score >= 40) { // ìµœì†Œ 40ì  ì´ìƒ (ë” ì—„ê²©)\n                  bestScore = score;\n                  bestMatch = {\n                    purchase_id: c.purchase_id,\n                    item_id: c.item_id,\n                    purchase_order_number: c.purchase_order_number || '',\n                    sales_order_number: c.sales_order_number,\n                    item_name: c.item_name,\n                    specification: c.specification,\n                    quantity: c.quantity,\n                    received_quantity: c.received_quantity,\n                    unit_price: c.unit_price,\n                    amount: (c as any).amount,\n                    vendor_name: c.vendor_name\n                  };\n                }\n              }\n              \n              // fallbackìœ¼ë¡œ ì°¾ì•˜ìœ¼ë©´ ë°œì£¼ë²ˆí˜¸ë„ ì‹œìŠ¤í…œ ê²ƒìœ¼ë¡œ ì—…ë°ì´íŠ¸ (OCR ì˜¤ë¥˜ ìˆ˜ì •)\n              if (bestMatch) {\n                const matchedPO = bestMatch.purchase_order_number || bestMatch.sales_order_number || '';\n                if (matchedPO) {\n                  initialPONumbers.set(item.id, matchedPO);\n                }\n              }\n            }\n\n            if (!initialPONumbers.has(item.id) && item.match_candidates && item.match_candidates.length > 0) {\n              const bestCandidate = item.match_candidates.reduce((best, current) => {\n                if (!best) return current;\n                return (current.score ?? -1) > (best.score ?? -1) ? current : best;\n              }, item.match_candidates[0]);\n              const recommendedPO = bestCandidate.purchase_order_number || bestCandidate.sales_order_number || '';\n              if (recommendedPO) {\n                initialPONumbers.set(item.id, recommendedPO);\n              }\n\n              if (!bestMatch && recommendedPO) {\n                const candidatesForPO = item.match_candidates.filter(c =>\n                  c.purchase_order_number === recommendedPO || c.sales_order_number === recommendedPO\n                );\n                let bestItem: SystemPurchaseItem | null = null;\n                let bestItemScore = -1;\n                for (const c of candidatesForPO) {\n                  const score = calculateItemSimilarity(item.extracted_item_name || '', c.item_name, c.specification);\n                  if (score > bestItemScore) {\n                    bestItemScore = score;\n                    bestItem = {\n                      purchase_id: c.purchase_id,\n                      item_id: c.item_id,\n                      purchase_order_number: c.purchase_order_number || '',\n                      sales_order_number: c.sales_order_number,\n                      item_name: c.item_name,\n                      specification: c.specification,\n                      quantity: c.quantity,\n                      received_quantity: c.received_quantity,\n                      unit_price: c.unit_price,\n                      amount: (c as any).amount,\n                      vendor_name: c.vendor_name\n                    };\n                  }\n                }\n                if (bestItem) {\n                  initialMatches.set(item.id, bestItem);\n                }\n              }\n            }\n            \n            if (!initialMatches.has(item.id)) {\n              initialMatches.set(item.id, bestMatch);\n            }\n          }\n        });\n        \n        // ë°œì£¼ë²ˆí˜¸ëŠ” ì„¸íŒ…ëëŠ”ë° ë§¤ì¹­ì´ ì—†ëŠ” í’ˆëª©: í•´ë‹¹ ë°œì£¼ë²ˆí˜¸ í›„ë³´ì—ì„œ ìë™ ë§¤ì¹­\n        result.data.items.forEach(item => {\n          const itemPO = initialPONumbers.get(item.id);\n          if (itemPO && !initialMatches.get(item.id)) {\n            const candidates = item.match_candidates?.filter(c =>\n              c.purchase_order_number === itemPO || c.sales_order_number === itemPO\n            ) || [];\n            if (candidates.length > 0) {\n              let best: SystemPurchaseItem | null = null;\n              let bestScore = -1;\n              for (const c of candidates) {\n                const score = calculateItemSimilarity(item.extracted_item_name || '', c.item_name, c.specification);\n                if (score > bestScore) {\n                  bestScore = score;\n                  best = {\n                    purchase_id: c.purchase_id,\n                    item_id: c.item_id,\n                    purchase_order_number: c.purchase_order_number || '',\n                    sales_order_number: c.sales_order_number,\n                    item_name: c.item_name,\n                    specification: c.specification,\n                    quantity: c.quantity,\n                    received_quantity: c.received_quantity,\n                    unit_price: c.unit_price,\n                    amount: (c as any).amount,\n                    vendor_name: c.vendor_name\n                  };\n                }\n              }\n              if (best) initialMatches.set(item.id, best);\n            }\n          }\n        });\n\n        const initialMatchedValues = Array.from(initialMatches.values()).filter(Boolean) as SystemPurchaseItem[];\n        // #region agent log\n        fetch('http://127.0.0.1:7244/ingest/d1bfd845-9c34-4c24-9ef7-fd981ce7dd8e',{method:'POST',headers:{'Content-Type':'application/json','X-Debug-Session-Id':'9f46d9'},body:JSON.stringify({sessionId:'9f46d9',runId:'system-total-debug',hypothesisId:'H1',location:'StatementConfirmModal.tsx:loadData:initialMatches',message:'initial matches amount snapshot',data:{statementId:statement.id,matchCount:initialMatches.size,missingAmountCount:initialMatchedValues.filter((m)=>m.amount==null).length,zeroUnitPriceCount:initialMatchedValues.filter((m)=>(m.unit_price ?? null)===0).length,sample:initialMatchedValues.slice(0,4).map((m)=>({itemId:m.item_id,quantity:m.quantity ?? null,unitPrice:m.unit_price ?? null,amount:m.amount ?? null,po:m.purchase_order_number || m.sales_order_number || null}))},timestamp:Date.now()})}).catch(()=>{});\n        // #endregion\n        setItemPONumbers(initialPONumbers);\n        setItemMatches(initialMatches);\n        \n        // Case 1: ê³µí†µ ë°œì£¼ë²ˆí˜¸ ì„¤ì •\n        const firstPO = result.data.items.find(i => i.extracted_po_number)?.extracted_po_number;\n        if (firstPO) {\n          setSelectedPONumber(normalizeOrderNumber(firstPO));\n        }\n        \n        // ì„¸íŠ¸ ë§¤ì¹­ ì‹¤í–‰ (Case 1: ëª¨ë“  í’ˆëª©ì´ ê°™ì€ ë°œì£¼ë²ˆí˜¸ì¼ ë•Œ)\n        // ë°œì£¼ë²ˆí˜¸ê°€ ë™ì¼í•œì§€ í™•ì¸\n        const poNumbers = result.data.items\n          .map(item => item.extracted_po_number ? normalizeOrderNumber(item.extracted_po_number) : null)\n          .filter(Boolean);\n        const isSingleScope = result.data.po_scope === 'single';\n        const allSamePO = isSingleScope || poNumbers.length === 0 || poNumbers.every(po => po === poNumbers[0]);\n        \n        if (allSamePO) {\n          // ì„¸íŠ¸ ë§¤ì¹­ í˜¸ì¶œ - ì „ì²´ í’ˆëª© ë¹„êµ (ê±°ë˜ì²˜ í•„í„°ë§ í¬í•¨)\n          const setMatchResponse = await transactionStatementService.findBestMatchingPurchaseOrderSet(\n            result.data.items,\n            firstPO,\n            result.data.vendor_name // ê±°ë˜ì²˜ëª… ì „ë‹¬\n          );\n          \n          if (setMatchResponse.success && setMatchResponse.data) {\n            setSetMatchResult(setMatchResponse.data);\n            \n            // ì„¸íŠ¸ ë§¤ì¹­ ê²°ê³¼ë¡œ ìµœì  ë°œì£¼ë²ˆí˜¸ ìë™ ì„ íƒ\n            if (setMatchResponse.data.bestMatch) {\n              const bestPO = setMatchResponse.data.bestMatch.purchase_order_number || \n                            setMatchResponse.data.bestMatch.sales_order_number || '';\n              setSelectedPONumber(bestPO);\n              \n              // ì„¸íŠ¸ ë§¤ì¹­ ê²°ê³¼ë¡œ í’ˆëª©ë“¤ ìë™ ë§¤ì¹­\n              const autoMatchedItems = new Map<string, SystemPurchaseItem | null>();\n              \n              setMatchResponse.data.bestMatch.itemMatches.forEach(match => {\n                // í•´ë‹¹ ì‹œìŠ¤í…œ í’ˆëª© ì •ë³´ ì°¾ê¸°\n                for (const item of result.data!.items) {\n                  const candidate = item.match_candidates?.find(c => c.item_id === match.systemItemId);\n                  if (candidate) {\n                    autoMatchedItems.set(match.ocrItemId, {\n                      purchase_id: candidate.purchase_id,\n                      item_id: candidate.item_id,\n                      purchase_order_number: candidate.purchase_order_number || '',\n                      sales_order_number: candidate.sales_order_number,\n                      item_name: candidate.item_name,\n                      specification: candidate.specification,\n                      quantity: candidate.quantity,\n                      received_quantity: candidate.received_quantity,\n                      unit_price: candidate.unit_price,\n                      amount: (candidate as any).amount,\n                      vendor_name: candidate.vendor_name\n                    });\n                    break;\n                  }\n                }\n              });\n              \n              // ê¸°ì¡´ ë§¤ì¹­ì— ì„¸íŠ¸ ë§¤ì¹­ ê²°ê³¼ ë³‘í•© (ì„¸íŠ¸ ë§¤ì¹­ ìš°ì„ )\n              const mergedMatches = new Map(initialMatches);\n              autoMatchedItems.forEach((value, key) => {\n                if (value) mergedMatches.set(key, value);\n              });\n              const mergedValues = Array.from(mergedMatches.values()).filter(Boolean) as SystemPurchaseItem[];\n              // #region agent log\n              fetch('http://127.0.0.1:7244/ingest/d1bfd845-9c34-4c24-9ef7-fd981ce7dd8e',{method:'POST',headers:{'Content-Type':'application/json','X-Debug-Session-Id':'9f46d9'},body:JSON.stringify({sessionId:'9f46d9',runId:'system-total-debug',hypothesisId:'H2',location:'StatementConfirmModal.tsx:loadData:setMatchMerge',message:'set-match merged matches snapshot',data:{statementId:statement.id,selectedPO:bestPO,mergedCount:mergedMatches.size,missingAmountCount:mergedValues.filter((m)=>m.amount==null).length,zeroUnitPriceCount:mergedValues.filter((m)=>(m.unit_price ?? null)===0).length,sample:mergedValues.slice(0,4).map((m)=>({itemId:m.item_id,quantity:m.quantity ?? null,unitPrice:m.unit_price ?? null,amount:m.amount ?? null,po:m.purchase_order_number || m.sales_order_number || null}))},timestamp:Date.now()})}).catch(()=>{});\n              // #endregion\n              setItemMatches(mergedMatches);\n              \n              // ì„¸íŠ¸ ë§¤ì¹­ ì„±ê³µ ì•Œë¦¼\n              const confidence = setMatchResponse.data.bestMatch.confidence;\n              const confText = confidence === 'high' ? 'ë†’ìŒ' : confidence === 'medium' ? 'ë³´í†µ' : 'ë‚®ìŒ';\n              toast.success(\n                `ì„¸íŠ¸ ë§¤ì¹­ ì™„ë£Œ! ${setMatchResponse.data.bestMatch.matchedItemCount}/${result.data.items.length}ê°œ í’ˆëª© ë§¤ì¹­ (ì‹ ë¢°ë„: ${confText})`\n              );\n            }\n            if (isSingleScope && !setMatchResponse.data.bestMatch && !firstPO) {\n              const fallbackCandidate = result.data.items[0]?.match_candidates?.[0];\n              const fallbackPO = fallbackCandidate?.purchase_order_number || fallbackCandidate?.sales_order_number || '';\n              if (fallbackPO) {\n                setSelectedPONumber(fallbackPO);\n              }\n            }\n          }\n        }\n      } else {\n        toast.error(result.error || 'ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n      }\n    } catch (error) {\n      toast.error('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n    } finally {\n      setLoading(false);\n    }\n  }, [statement.id, supabase]);\n\n  useEffect(() => {\n    if (isOpen && statement) {\n      setManuallySelectedPO(false); // ëª¨ë‹¬ ì—´ë¦´ ë•Œ ìˆ˜ë™ ì„ íƒ í”Œë˜ê·¸ ë¦¬ì…‹\n      loadData();\n    }\n  }, [isOpen, statement, loadData]);\n\n  // ë°œì£¼ë²ˆí˜¸ ë³€ê²½ ì‹œ itemMatches ìë™ ë™ê¸°í™” + ë§¤ì¹­ëœ ì‹œìŠ¤í…œ ë°œì£¼ë²ˆí˜¸ë¡œ ì—…ë°ì´íŠ¸\n  useEffect(() => {\n    if (!statementWithItems || !isOpen) return;\n    \n    // ì•„ì§ ì´ˆê¸° ë¡œë“œ ì¤‘ì´ë©´ ìŠ¤í‚µ\n    if (loading) return;\n    \n    const newMatches = new Map<string, SystemPurchaseItem | null>();\n    const newPONumbers = new Map<string, string>(itemPONumbers);\n    let hasMatchChanges = false;\n    let hasPOChanges = false;\n    \n    statementWithItems.items.forEach(ocrItem => {\n      const currentMatch = itemMatches.get(ocrItem.id);\n      \n      // í˜„ì¬ ì ìš©í•´ì•¼ í•  ë°œì£¼ë²ˆí˜¸\n      const poNumber = isSamePONumber \n        ? selectedPONumber \n        : (itemPONumbers.get(ocrItem.id) || (ocrItem.extracted_po_number ? normalizeOrderNumber(ocrItem.extracted_po_number) : ''));\n      \n      // í˜„ì¬ ë§¤ì¹­ì´ ìˆê³  (ë°œì£¼ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ê±°ë‚˜, ì›”ë§ê²°ì œ ë“± DBì—ì„œ ì§ì ‘ ë§¤ì¹­ëœ ê²½ìš°) ìœ ì§€\n      if (currentMatch && (\n        currentMatch.purchase_order_number === poNumber || \n        currentMatch.sales_order_number === poNumber ||\n        currentMatch.purchase_id // DBì—ì„œ ë¡œë“œí•œ ë§¤ì¹­ì´ë©´ ìœ ì§€ (OCR ë°œì£¼ë²ˆí˜¸ ì˜¤ë… ë°©ì§€)\n      )) {\n        newMatches.set(ocrItem.id, currentMatch);\n        return;\n      }\n      \n      // ìƒˆë¡œìš´ ë§¤ì¹­ ì°¾ê¸°\n      let bestMatch: SystemPurchaseItem | null = null;\n      let bestScore = -1;\n      \n      // í•´ë‹¹ ë°œì£¼ë²ˆí˜¸ í›„ë³´ì—ì„œ ê²€ìƒ‰\n      const matchingCandidates = poNumber \n        ? ocrItem.match_candidates?.filter(c => \n            c.purchase_order_number === poNumber || c.sales_order_number === poNumber\n          ) || []\n        : [];\n      \n      for (const c of matchingCandidates) {\n        const score = calculateItemSimilarity(ocrItem.extracted_item_name || '', c.item_name, c.specification);\n        if (score > bestScore) {\n          bestScore = score;\n          bestMatch = {\n            purchase_id: c.purchase_id,\n            item_id: c.item_id,\n            purchase_order_number: c.purchase_order_number || '',\n            sales_order_number: c.sales_order_number,\n            item_name: c.item_name,\n            specification: c.specification,\n            quantity: c.quantity,\n            received_quantity: c.received_quantity,\n            unit_price: c.unit_price,\n            amount: (c as any).amount,\n            vendor_name: c.vendor_name\n          };\n        }\n      }\n      \n      // ëª» ì°¾ìœ¼ë©´ ì „ì²´ í›„ë³´ì—ì„œ ê²€ìƒ‰ (fallback)\n      if (!bestMatch && ocrItem.match_candidates) {\n        for (const c of ocrItem.match_candidates) {\n          const score = calculateItemSimilarity(ocrItem.extracted_item_name || '', c.item_name, c.specification);\n          if (score > bestScore && score >= 40) { // ìµœì†Œ 40ì  ì´ìƒ\n            bestScore = score;\n            bestMatch = {\n              purchase_id: c.purchase_id,\n              item_id: c.item_id,\n              purchase_order_number: c.purchase_order_number || '',\n              sales_order_number: c.sales_order_number,\n              item_name: c.item_name,\n              specification: c.specification,\n              quantity: c.quantity,\n              received_quantity: c.received_quantity,\n              unit_price: c.unit_price,\n              amount: (c as any).amount,\n              vendor_name: c.vendor_name\n            };\n          }\n        }\n      }\n      \n      newMatches.set(ocrItem.id, bestMatch);\n      \n      // ë§¤ì¹­ëœ ì‹œìŠ¤í…œ í’ˆëª©ì˜ ë°œì£¼ë²ˆí˜¸ë¡œ í‘œì‹œ ë²ˆí˜¸ ì—…ë°ì´íŠ¸ (OCR ì˜¤ë¥˜ ìˆ˜ì •)\n      if (bestMatch) {\n        const matchedPO = bestMatch.purchase_order_number || bestMatch.sales_order_number || '';\n        const currentDisplayPO = itemPONumbers.get(ocrItem.id) || '';\n        \n        // í˜„ì¬ í‘œì‹œ ë²ˆí˜¸ì™€ ë‹¤ë¥´ë©´ ì‹œìŠ¤í…œ ë²ˆí˜¸ë¡œ ì—…ë°ì´íŠ¸\n        if (matchedPO && matchedPO !== currentDisplayPO) {\n          newPONumbers.set(ocrItem.id, matchedPO);\n          hasPOChanges = true;\n        }\n      }\n      \n      // ë³€ê²½ ê°ì§€\n      if (currentMatch !== bestMatch) {\n        hasMatchChanges = true;\n      }\n    });\n    \n    const newMatchValues = Array.from(newMatches.values()).filter(Boolean) as SystemPurchaseItem[];\n    // #region agent log\n    fetch('http://127.0.0.1:7244/ingest/d1bfd845-9c34-4c24-9ef7-fd981ce7dd8e',{method:'POST',headers:{'Content-Type':'application/json','X-Debug-Session-Id':'9f46d9'},body:JSON.stringify({sessionId:'9f46d9',runId:'system-total-debug',hypothesisId:'H2',location:'StatementConfirmModal.tsx:selectedPOEffect:beforeSet',message:'selected-po effect computed matches',data:{statementId:statement.id,selectedPONumber,isSamePONumber,totalComputed:newMatches.size,hasMatchChanges,hasPOChanges,missingAmountCount:newMatchValues.filter((m)=>m.amount==null).length,zeroUnitPriceCount:newMatchValues.filter((m)=>(m.unit_price ?? null)===0).length,sample:newMatchValues.slice(0,4).map((m)=>({itemId:m.item_id,quantity:m.quantity ?? null,unitPrice:m.unit_price ?? null,amount:m.amount ?? null,po:m.purchase_order_number || m.sales_order_number || null}))},timestamp:Date.now()})}).catch(()=>{});\n    // #endregion\n    // ë³€ê²½ì´ ìˆì„ ë•Œë§Œ ìƒíƒœ ì—…ë°ì´íŠ¸ (ë¬´í•œ ë£¨í”„ ë°©ì§€)\n    if (hasMatchChanges) {\n      setItemMatches(newMatches);\n    }\n    \n    // ë°œì£¼ë²ˆí˜¸ í‘œì‹œë„ ì‹œìŠ¤í…œ ê²ƒìœ¼ë¡œ ì—…ë°ì´íŠ¸\n    if (hasPOChanges) {\n      setItemPONumbers(newPONumbers);\n    }\n  }, [selectedPONumber, isSamePONumber, statementWithItems, isOpen, loading]);\n\n  // ë°œì£¼/ìˆ˜ì£¼ë²ˆí˜¸ í›„ë³´ ëª©ë¡ (ì„¸íŠ¸ ë§¤ì¹­ ê²°ê³¼ + ê¸°ì¡´ í›„ë³´)\n  // - ì„¸íŠ¸ ë§¤ì¹­ ê²°ê³¼ê°€ ìˆìœ¼ë©´ ì ìˆ˜ í¬í•¨í•˜ì—¬ ì •ë ¬\n  // - OCRì—ì„œ Fë¡œ ì‹œì‘í•˜ëŠ” ë²ˆí˜¸ ì¶”ì¶œ â†’ ë°œì£¼ë²ˆí˜¸ë§Œ í‘œì‹œ\n  // - OCRì—ì„œ HSë¡œ ì‹œì‘í•˜ëŠ” ë²ˆí˜¸ ì¶”ì¶œ â†’ ìˆ˜ì£¼ë²ˆí˜¸ë§Œ í‘œì‹œ\n  // - OCRì—ì„œ ë²ˆí˜¸ ì—†ìŒ â†’ ë°œì£¼ë²ˆí˜¸ ê¸°ë³¸ê°’\n  const allPONumberCandidates = useMemo(() => {\n    if (!statementWithItems) return [];\n    \n    // ì²« ë²ˆì§¸ OCR ì¶”ì¶œ ë²ˆí˜¸ë¡œ íƒ€ì… ê²°ì • (F vs HS)\n    const firstExtracted = statementWithItems.items.find(i => i.extracted_po_number)?.extracted_po_number || '';\n    const normalizedFirst = firstExtracted ? normalizeOrderNumber(firstExtracted).toUpperCase() : '';\n    const useSONumber = normalizedFirst.startsWith('HS');\n    \n    type CandidateMapValue = {\n      poNumber: string;\n      salesOrderNumber?: string;\n      itemCount: number;\n      items: MatchCandidate[];\n      vendorName?: string;\n      setMatchScore?: number; // ì„¸íŠ¸ ë§¤ì¹­ ì ìˆ˜ (ì •ë ¬ìš©, ë°œì£¼ë²ˆí˜¸ ë³´ë„ˆìŠ¤ í¬í•¨)\n      displayScore?: number; // í‘œì‹œìš© ì ìˆ˜ (ì‹¤ì œ í’ˆëª© ìœ ì‚¬ë„, ìµœëŒ€ 100%)\n      matchedItemCount?: number;\n      purchaseId?: number; // ë°œì£¼ ìƒì„¸ ëª¨ë‹¬ìš©\n      quantityMatchedCount?: number; // ìˆ˜ëŸ‰ ì¼ì¹˜ í’ˆëª© ìˆ˜\n      quantityMismatchedCount?: number; // ìˆ˜ëŸ‰ ë¶ˆì¼ì¹˜ í’ˆëª© ìˆ˜\n    };\n    \n    const candidateMap = new Map<string, CandidateMapValue>();\n    \n    // 1. ì„¸íŠ¸ ë§¤ì¹­ ê²°ê³¼ê°€ ìˆìœ¼ë©´ ë¨¼ì € ì¶”ê°€ (ì ìˆ˜ í¬í•¨)\n    if (setMatchResult?.candidates) {\n      setMatchResult.candidates.forEach(candidate => {\n        const key = useSONumber \n          ? (candidate.sales_order_number || candidate.purchase_order_number)\n          : candidate.purchase_order_number;\n        \n        if (key) {\n          candidateMap.set(key, {\n            poNumber: candidate.purchase_order_number || '',\n            salesOrderNumber: candidate.sales_order_number,\n            itemCount: candidate.matchedItemCount,\n            items: [] as MatchCandidate[],\n            vendorName: candidate.vendor_name,\n            setMatchScore: candidate.matchScore,\n            matchedItemCount: candidate.matchedItemCount,\n            purchaseId: candidate.purchase_id\n          });\n        }\n      });\n    }\n    \n    // 2. ê¸°ì¡´ ê°œë³„ ë§¤ì¹­ í›„ë³´ë„ ì¶”ê°€ (ì„¸íŠ¸ ë§¤ì¹­ì— ì—†ëŠ” ê²ƒë§Œ)\n    statementWithItems.items.forEach(item => {\n      item.match_candidates?.forEach(candidate => {\n        const key = useSONumber \n          ? (candidate.sales_order_number || '') \n          : (candidate.purchase_order_number || '');\n        \n        if (key && !candidateMap.has(key)) {\n          candidateMap.set(key, {\n            poNumber: candidate.purchase_order_number || '',\n            salesOrderNumber: candidate.sales_order_number,\n            itemCount: 0,\n            items: [] as MatchCandidate[],\n            vendorName: candidate.vendor_name,\n            purchaseId: candidate.purchase_id\n          });\n        }\n        \n        if (key && candidateMap.has(key)) {\n          const existing = candidateMap.get(key)!;\n          existing.items.push(candidate);\n          if (!existing.setMatchScore) {\n            existing.itemCount = existing.items.length;\n          }\n        }\n      });\n    });\n    \n    // 2.6. PO ì•„ì´í…œ ë§µ ê¸°ë°˜ í›„ë³´ ì¶”ê°€ (ë§¤ì¹­ í›„ë³´ê°€ ë¹„ì–´ìˆì–´ë„ í‘œì‹œ)\n    if (poItemsMap.size > 0) {\n      poItemsMap.forEach((items, key) => {\n        const normalizedKey = normalizeOrderNumber(key);\n        const isSO = normalizedKey.startsWith('HS');\n        if (useSONumber && !isSO) return;\n        if (!useSONumber && isSO) return;\n        \n        if (!candidateMap.has(normalizedKey)) {\n          candidateMap.set(normalizedKey, {\n            poNumber: isSO ? '' : normalizedKey,\n            salesOrderNumber: isSO ? normalizedKey : undefined,\n            itemCount: items.length,\n            items: items.map((item): MatchCandidate => ({\n              purchase_id: item.purchase_id,\n              purchase_order_number: item.purchase_order_number || '',\n              sales_order_number: item.sales_order_number,\n              item_id: item.item_id,\n              item_name: item.item_name,\n              specification: item.specification,\n              quantity: item.quantity ?? 0,\n              unit_price: item.unit_price,\n              vendor_name: item.vendor_name,\n              score: 0,\n              match_reasons: ['po_items_map']\n            })),\n            vendorName: items[0]?.vendor_name,\n            purchaseId: items[0]?.purchase_id\n          });\n        }\n      });\n    }\n    \n    // 2.5. ì„¸íŠ¸ ë§¤ì¹­ ì ìˆ˜ê°€ ì—†ëŠ” í›„ë³´ë“¤ì— ëŒ€í•´ ê°œë³„ í’ˆëª© ìœ ì‚¬ë„ í‰ê·  ê³„ì‚° + ìˆ˜ëŸ‰ ì¼ì¹˜ ì—¬ë¶€\n    candidateMap.forEach((candidate: CandidateMapValue, key) => {\n      // ê° OCR í’ˆëª©ê³¼ í•´ë‹¹ ë°œì£¼ì˜ í’ˆëª© ê°„ ìµœëŒ€ ìœ ì‚¬ë„ ê³„ì‚° + ìˆ˜ëŸ‰ ì¼ì¹˜ í™•ì¸\n      let totalScore = 0;\n      let matchedCount = 0;\n      let quantityMatchedCount = 0;\n      let quantityMismatchedCount = 0;\n      const normalizedKey = normalizeOrderNumber(key).toUpperCase();\n      const extractedOrderNumbers = statementWithItems.items\n        .map(item => {\n          const value = getOCRItemValue(item, 'po_number') as string;\n          return value ? normalizeOrderNumber(value).toUpperCase() : null;\n        })\n        .filter(Boolean) as string[];\n      const hasOrderNumberMatch = extractedOrderNumbers.some(num => num === normalizedKey);\n      \n      const candidateItems = candidate.items as MatchCandidate[];\n      \n      statementWithItems.items.forEach(ocrItem => {\n        // í•´ë‹¹ ë°œì£¼ì˜ í’ˆëª©ë“¤ ì¤‘ ê°€ì¥ ìœ ì‚¬í•œ ê²ƒ ì°¾ê¸°\n        let bestScore = 0;\n        let bestMatchItem: MatchCandidate | null = null;\n        const ocrItemName = getOCRItemValue(ocrItem, 'item_name') as string;\n        \n        for (const sysItem of candidateItems) {\n          const item: MatchCandidate = sysItem;\n          const score = calculateItemSimilarity(\n            ocrItemName || '', \n            item.item_name, \n            item.specification\n          );\n          if (score > bestScore) {\n            bestScore = score;\n            bestMatchItem = item;\n          }\n        }\n        \n        if (bestScore >= 40 && bestMatchItem !== null) {\n          matchedCount++;\n          \n          // ìˆ˜ëŸ‰ ì¼ì¹˜ ì—¬ë¶€ í™•ì¸\n          const ocrQtyRaw = getOCRItemValue(ocrItem, 'quantity');\n          const ocrQty = typeof ocrQtyRaw === 'number'\n            ? ocrQtyRaw\n            : (ocrQtyRaw !== '' ? Number(ocrQtyRaw) : undefined);\n          const matchItem: MatchCandidate = bestMatchItem as MatchCandidate;\n          const sysQty: number = matchItem.quantity;\n          if (ocrQty !== undefined && !Number.isNaN(ocrQty) && isQuantityMatched(ocrQty, sysQty)) {\n            quantityMatchedCount++;\n          } else {\n            quantityMismatchedCount++;\n          }\n        }\n        totalScore += bestScore;\n      });\n      \n      // í‰ê·  ì ìˆ˜ ê³„ì‚° (ìˆ˜ëŸ‰ ì¼ì¹˜ ë³´ë„ˆìŠ¤ í¬í•¨)\n      const baseScore = statementWithItems.items.length > 0 \n        ? Math.round(totalScore / statementWithItems.items.length)\n        : 0;\n      \n      // ìˆ˜ëŸ‰ ì¼ì¹˜ ë³´ë„ˆìŠ¤: ëª¨ë“  ë§¤ì¹­ í’ˆëª©ì˜ ìˆ˜ëŸ‰ì´ ì¼ì¹˜í•˜ë©´ +10ì \n      const quantityBonus = (matchedCount > 0 && quantityMatchedCount === matchedCount) ? 10 : 0;\n      \n      // ì‹¤ì œ í’ˆëª© ìœ ì‚¬ë„ ì ìˆ˜ (ìµœëŒ€ 100%)\n      const actualScore = Math.min(100, baseScore + quantityBonus);\n      \n      // ë°œì£¼ë²ˆí˜¸ ì¼ì¹˜ëŠ” ê°€ì¥ ë†’ì€ ìš°ì„ ìˆœìœ„ (ì •ë ¬ìš© ë³´ë„ˆìŠ¤)\n      const orderNumberBonus = hasOrderNumberMatch ? 100 : 0;\n      \n      if (candidate.setMatchScore === undefined) {\n        candidate.setMatchScore = actualScore + orderNumberBonus; // ì •ë ¬ìš©\n        candidate.displayScore = actualScore; // í‘œì‹œìš© (ì‹¤ì œ ìœ ì‚¬ë„)\n        candidate.matchedItemCount = matchedCount;\n      } else if (hasOrderNumberMatch) {\n        // ì„¸íŠ¸ ë§¤ì¹­ ê²°ê³¼ê°€ ìˆì–´ë„ ë°œì£¼ë²ˆí˜¸ ì¼ì¹˜ ë³´ë„ˆìŠ¤ ì¶”ê°€\n        candidate.setMatchScore = (candidate.setMatchScore ?? 0) + orderNumberBonus;\n        // displayScoreëŠ” ì›ë˜ ê°’ ìœ ì§€ (ì—†ìœ¼ë©´ setMatchScore ì‚¬ìš©)\n        if (candidate.displayScore === undefined) {\n          candidate.displayScore = candidate.setMatchScore - orderNumberBonus;\n        }\n      }\n      \n      candidate.quantityMatchedCount = quantityMatchedCount;\n      candidate.quantityMismatchedCount = quantityMismatchedCount;\n      (candidate as any).hasOrderNumberMatch = hasOrderNumberMatch;\n    });\n    \n    // 3. ì •ë ¬: ë°œì£¼ë²ˆí˜¸ ì¼ì¹˜ ì—¬ë¶€ ë¨¼ì €, ê·¸ ë‹¤ìŒ ì ìˆ˜ìˆœ\n    const result = Array.from(candidateMap.values());\n    \n    \n    result.sort((a, b) => {\n      // ë¨¼ì € ë°œì£¼ë²ˆí˜¸ ì¼ì¹˜ ì—¬ë¶€ë¡œ ì •ë ¬ (ì¼ì¹˜í•˜ëŠ” ê²ƒì´ ë§¨ ìœ„)\n      const aHasMatch = (a as any).hasOrderNumberMatch ? 1 : 0;\n      const bHasMatch = (b as any).hasOrderNumberMatch ? 1 : 0;\n      if (aHasMatch !== bHasMatch) {\n        return bHasMatch - aHasMatch;\n      }\n      \n      // ê·¸ ë‹¤ìŒ ì ìˆ˜ìˆœ\n      const scoreA = a.setMatchScore ?? 0;\n      const scoreB = b.setMatchScore ?? 0;\n      if (scoreA !== scoreB) {\n        return scoreB - scoreA;\n      }\n      return b.itemCount - a.itemCount;\n    });\n    \n    return result;\n  }, [statementWithItems, setMatchResult, poItemsMap, editedOCRItems]);\n\n  const getPairedOrderNumber = useCallback((value?: string | null): string | undefined => {\n    if (!value) return undefined;\n    const normalizedValue = normalizeOrderNumber(value);\n    const candidate = allPONumberCandidates.find(\n      c =>\n        c.poNumber === normalizedValue ||\n        c.salesOrderNumber === normalizedValue ||\n        c.poNumber === value ||\n        c.salesOrderNumber === value\n    );\n    if (candidate) {\n      if (normalizedValue.startsWith('F')) return candidate.salesOrderNumber;\n      if (normalizedValue.startsWith('HS')) return candidate.poNumber;\n      return candidate.salesOrderNumber || candidate.poNumber;\n    }\n    const items = poItemsMap.get(normalizedValue) || poItemsMap.get(value) || [];\n    if (items.length > 0) {\n      const item = items[0];\n      if (normalizedValue.startsWith('F')) return item.sales_order_number;\n      if (normalizedValue.startsWith('HS')) return item.purchase_order_number || item.purchase_order_number;\n      return item.sales_order_number || item.purchase_order_number;\n    }\n    return undefined;\n  }, [allPONumberCandidates, poItemsMap]);\n\n  const getPairedOrderNumberWithOverrides = (value?: string | null): string | undefined => {\n    if (!value) return undefined;\n    const normalized = normalizeOrderNumber(value);\n    const override = poPairOverrides.get(normalized);\n    if (override !== undefined) {\n      return override || undefined;\n    }\n    return getPairedOrderNumber(value);\n  };\n\n  // ë°œì£¼ë²ˆí˜¸ ì¼ì¹˜í•˜ëŠ” í›„ë³´ë¥¼ ìµœìš°ì„  ì„ íƒ, ì—†ìœ¼ë©´ ì²« ë²ˆì§¸ í›„ë³´ë¡œ ìë™ ë³€ê²½\n  // (ë‹¨, ì‚¬ìš©ìê°€ ìˆ˜ë™ìœ¼ë¡œ ì„ íƒí•œ ê²½ìš°ëŠ” ê±´ë„ˆëœ€)\n  useEffect(() => {\n    if (!allPONumberCandidates.length || !isSamePONumber) return;\n\n    // ì‚¬ìš©ìê°€ ìˆ˜ë™ìœ¼ë¡œ ë°œì£¼ë²ˆí˜¸ë¥¼ ì„ íƒí•œ ê²½ìš° ìë™ êµì • ê±´ë„ˆëœ€\n    if (manuallySelectedPO) return;\n\n    // ë°œì£¼ë²ˆí˜¸ ì¼ì¹˜í•˜ëŠ” í›„ë³´ ì°¾ê¸° (hasOrderNumberMatchê°€ trueì¸ ê²ƒ)\n    const matchingCandidate = allPONumberCandidates.find(\n      c => (c as any).hasOrderNumberMatch === true\n    );\n\n    if (matchingCandidate) {\n      const matchingPO = matchingCandidate.poNumber || matchingCandidate.salesOrderNumber || '';\n      // í˜„ì¬ ì„ íƒëœ ê²ƒê³¼ ë‹¤ë¥´ë©´ ë³€ê²½\n      if (matchingPO && matchingPO !== selectedPONumber) {\n        console.log(`[ìë™ ì„ íƒ] ë°œì£¼ë²ˆí˜¸ ì¼ì¹˜ í›„ë³´ \"${matchingPO}\"ë¡œ ìë™ ì„ íƒ`);\n        setSelectedPONumber(matchingPO);\n        return;\n      }\n    }\n\n    // ë°œì£¼ë²ˆí˜¸ ì¼ì¹˜ í›„ë³´ê°€ ì—†ìœ¼ë©´, í˜„ì¬ ì„ íƒì´ í›„ë³´ ëª©ë¡ì— ìˆëŠ”ì§€ í™•ì¸\n    const isInCandidates = allPONumberCandidates.some(\n      c => c.poNumber === selectedPONumber || c.salesOrderNumber === selectedPONumber\n    );\n\n    // í›„ë³´ ëª©ë¡ì— ì—†ìœ¼ë©´ ì²« ë²ˆì§¸ í›„ë³´ë¡œ ìë™ ë³€ê²½\n    if (!isInCandidates && allPONumberCandidates[0]) {\n      const firstCandidate = allPONumberCandidates[0];\n      const newPO = firstCandidate.poNumber || firstCandidate.salesOrderNumber || '';\n      if (newPO) {\n        console.log(`[ìë™ ìˆ˜ì •] OCR ë°œì£¼ë²ˆí˜¸ \"${selectedPONumber}\"ê°€ DBì— ì—†ìŒ â†’ ì¶”ì²œ ë°œì£¼ \"${newPO}\"ë¡œ ë³€ê²½`);\n        setSelectedPONumber(newPO);\n      }\n    }\n  }, [allPONumberCandidates, selectedPONumber, isSamePONumber, manuallySelectedPO]);\n\n  // íŠ¹ì • ë°œì£¼ë²ˆí˜¸ì— í•´ë‹¹í•˜ëŠ” ì‹œìŠ¤í…œ í’ˆëª©ë“¤\n  const getSystemItemsForPO = useCallback((poNumber: string): SystemPurchaseItem[] => {\n    if (!statementWithItems || !poNumber) return [];\n    const mappedItems = poItemsMap.get(poNumber) || [];\n    if (mappedItems.length > 0) {\n      const deduped = mappedItems.filter((item, index, self) => \n        index === self.findIndex(t => t.item_id === item.item_id)\n      );\n      return deduped;\n    }\n    \n    const items: SystemPurchaseItem[] = [];\n    \n    statementWithItems.items.forEach(item => {\n      item.match_candidates?.forEach(candidate => {\n        if (candidate.purchase_order_number === poNumber || \n            candidate.sales_order_number === poNumber) {\n          items.push({\n            purchase_id: candidate.purchase_id,\n            item_id: candidate.item_id,\n            purchase_order_number: candidate.purchase_order_number || '',\n            sales_order_number: candidate.sales_order_number,\n            item_name: candidate.item_name,\n            specification: candidate.specification,\n            quantity: candidate.quantity,\n            received_quantity: candidate.received_quantity,\n            unit_price: candidate.unit_price,\n            amount: (candidate as any).amount, // amountëŠ” ì¼ë¶€ í›„ë³´ì—ë§Œ ì¡´ì¬\n            vendor_name: candidate.vendor_name\n          });\n        }\n      });\n    });\n    \n    // ì¤‘ë³µ ì œê±°\n    const deduped = items.filter((item, index, self) => \n      index === self.findIndex(t => t.item_id === item.item_id)\n    );\n    return deduped;\n  }, [statementWithItems, poItemsMap]);\n\n  // íŠ¹ì • OCR í’ˆëª©ì— ëŒ€í•œ ë°œì£¼ë²ˆí˜¸ í›„ë³´ ëª©ë¡ (ì‹œìŠ¤í…œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ê°€ì ¸ì˜¨ ê²ƒë§Œ)\n  // - OCRì—ì„œ Fë¡œ ì‹œì‘í•˜ëŠ” ë²ˆí˜¸ ì¶”ì¶œ â†’ ë°œì£¼ë²ˆí˜¸(purchase_order_number)ë§Œ í‘œì‹œ\n  // - OCRì—ì„œ HSë¡œ ì‹œì‘í•˜ëŠ” ë²ˆí˜¸ ì¶”ì¶œ â†’ ìˆ˜ì£¼ë²ˆí˜¸(sales_order_number)ë§Œ í‘œì‹œ\n  // - OCRì—ì„œ ë²ˆí˜¸ ì—†ìŒ â†’ ë°œì£¼ë²ˆí˜¸(purchase_order_number) ê¸°ë³¸ê°’\n  const getPOCandidatesForItem = useCallback((ocrItemId: string): string[] => {\n    if (!statementWithItems) return [];\n    \n    const item = statementWithItems.items.find(i => i.id === ocrItemId);\n    if (!item) return [];\n    \n    const poNumbers = new Set<string>();\n    \n    // OCR ì¶”ì¶œ ë²ˆí˜¸ ì •ê·œí™”\n    const extractedNumber = item.extracted_po_number \n      ? normalizeOrderNumber(item.extracted_po_number).toUpperCase() \n      : '';\n    \n    // ì¶”ì¶œëœ ë²ˆí˜¸ê°€ HSë¡œ ì‹œì‘í•˜ë©´ ìˆ˜ì£¼ë²ˆí˜¸, ê·¸ ì™¸(F ë˜ëŠ” ì—†ìŒ)ëŠ” ë°œì£¼ë²ˆí˜¸\n    const useSONumber = extractedNumber.startsWith('HS');\n    \n    // ë§¤ì¹­ í›„ë³´ë“¤ì—ì„œ ì ì ˆí•œ ë²ˆí˜¸ë§Œ ì¶”ê°€\n    item.match_candidates?.forEach(c => {\n      if (useSONumber) {\n        // ìˆ˜ì£¼ë²ˆí˜¸ë§Œ ì¶”ê°€\n        if (c.sales_order_number) poNumbers.add(c.sales_order_number);\n      } else {\n        // ë°œì£¼ë²ˆí˜¸ë§Œ ì¶”ê°€ (ê¸°ë³¸ê°’)\n        if (c.purchase_order_number) poNumbers.add(c.purchase_order_number);\n      }\n    });\n    const result = Array.from(poNumbers);\n    return result;\n  }, [statementWithItems]);\n\n  // ë‹¨ì¼ OCR í’ˆëª© ìˆ˜ì •ê°’ ì¦‰ì‹œ DB ì €ì¥\n  const persistSingleOCRItem = useCallback(async (itemId: string, field: keyof EditedOCRItem, value: string | number) => {\n    const fieldMap: Record<string, string> = {\n      item_name: 'extracted_item_name',\n      quantity: 'extracted_quantity',\n      unit_price: 'extracted_unit_price',\n      amount: 'extracted_amount',\n      po_number: 'extracted_po_number',\n    };\n    const dbField = fieldMap[field];\n    if (!dbField) return;\n\n    const dbValue = field === 'item_name' || field === 'po_number' ? value : Number(value);\n    const { error } = await supabase\n      .from('transaction_statement_items')\n      .update({ [dbField]: dbValue })\n      .eq('id', itemId);\n\n    if (error) {\n      logger.warn('OCR ìˆ˜ì •ê°’ ìë™ ì €ì¥ ì‹¤íŒ¨:', error);\n    }\n  }, [supabase]);\n\n  // OCR í’ˆëª© í¸ì§‘ í•¨ìˆ˜ (ìˆ˜ì • ì¦‰ì‹œ ë””ë°”ìš´ìŠ¤ 500ms í›„ DB ì €ì¥)\n  const handleEditOCRItem = (itemId: string, field: keyof EditedOCRItem, value: string | number) => {\n    setEditedOCRItems(prev => {\n      const newMap = new Map(prev);\n      const existing = newMap.get(itemId) || {};\n      newMap.set(itemId, { ...existing, [field]: value });\n      return newMap;\n    });\n\n    // ë””ë°”ìš´ìŠ¤: 500ms í›„ ìë™ ì €ì¥\n    if (editDebounceTimerRef.current) {\n      clearTimeout(editDebounceTimerRef.current);\n    }\n    editDebounceTimerRef.current = setTimeout(() => {\n      persistSingleOCRItem(itemId, field, value);\n    }, 500);\n  };\n\n  // ìˆ˜ë™ ìˆ˜ì •ê°’ì„ DBì— ì¼ê´„ ë°˜ì˜ (í™•ì •/ìˆ˜ëŸ‰ì¼ì¹˜ ì‹œ í˜¸ì¶œ)\n  const persistEditedOCRItems = async () => {\n    if (!statementWithItems || editedOCRItems.size === 0) return;\n\n    const updates = Array.from(editedOCRItems.entries())\n      .map(([itemId, edited]) => {\n        const updateData: {\n          extracted_item_name?: string;\n          extracted_quantity?: number;\n          extracted_unit_price?: number;\n          extracted_amount?: number;\n          extracted_po_number?: string;\n        } = {};\n\n        if (edited.item_name !== undefined) updateData.extracted_item_name = edited.item_name;\n        if (edited.quantity !== undefined) updateData.extracted_quantity = Number(edited.quantity);\n        if (edited.unit_price !== undefined) updateData.extracted_unit_price = Number(edited.unit_price);\n        if (edited.amount !== undefined) updateData.extracted_amount = Number(edited.amount);\n        if (edited.po_number !== undefined) updateData.extracted_po_number = edited.po_number;\n\n        return Object.keys(updateData).length > 0 ? { itemId, updateData } : null;\n      })\n      .filter((item): item is { itemId: string; updateData: Record<string, unknown> } => Boolean(item));\n\n    if (updates.length === 0) return;\n\n    const results = await Promise.all(\n      updates.map(({ itemId, updateData }) =>\n        supabase\n          .from('transaction_statement_items')\n          .update(updateData)\n          .eq('id', itemId)\n      )\n    );\n\n    const hasError = results.some(({ error }) => error);\n    if (hasError) {\n      toast.error('ìˆ˜ì •ê°’ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n      return;\n    }\n\n    // ë¡œì»¬ ìƒíƒœë„ ìµœì‹  ê°’ìœ¼ë¡œ ë°˜ì˜\n    setStatementWithItems(prev => {\n      if (!prev) return prev;\n      const updatedItems = prev.items.map(item => {\n        const update = updates.find(u => u.itemId === item.id);\n        return update ? { ...item, ...update.updateData } : item;\n      });\n      return { ...prev, items: updatedItems };\n    });\n  };\n\n  // OCR í’ˆëª©ì˜ í˜„ì¬ ê°’ ê°€ì ¸ì˜¤ê¸° (ìˆ˜ì •ëœ ê°’ ìš°ì„ )\n  function getOCRItemValue(\n    ocrItem: TransactionStatementItemWithMatch,\n    field: 'item_name' | 'quantity' | 'unit_price' | 'amount' | 'po_number'\n  ) {\n    const edited = editedOCRItems.get(ocrItem.id);\n    if (edited && edited[field] !== undefined) {\n      return edited[field];\n    }\n\n    switch (field) {\n      case 'item_name':\n        return ocrItem.extracted_item_name || '';\n      case 'quantity':\n        return ocrItem.extracted_quantity ?? '';\n      case 'unit_price':\n        return ocrItem.extracted_unit_price ?? '';\n      case 'amount':\n        return ocrItem.extracted_amount ?? '';\n      case 'po_number':\n        return itemPONumbers.get(ocrItem.id) ||\n          (ocrItem.extracted_po_number ? normalizeOrderNumber(ocrItem.extracted_po_number) : '');\n      default:\n        return '';\n    }\n  }\n\n  // ìˆ˜ì • ì—¬ë¶€ í™•ì¸ (ì›ë³¸ê³¼ ë‹¤ë¥¸ì§€)\n  const isOCRItemEdited = (ocrItem: TransactionStatementItemWithMatch, field: 'item_name' | 'quantity' | 'unit_price' | 'amount' | 'po_number'): boolean => {\n    const edited = editedOCRItems.get(ocrItem.id);\n    if (!edited || edited[field] === undefined) return false;\n    \n    switch (field) {\n      case 'item_name': return edited.item_name !== ocrItem.extracted_item_name;\n      case 'quantity': return edited.quantity !== ocrItem.extracted_quantity;\n      case 'unit_price': return edited.unit_price !== ocrItem.extracted_unit_price;\n      case 'amount': return edited.amount !== ocrItem.extracted_amount;\n      case 'po_number': {\n        const original = ocrItem.extracted_po_number ? normalizeOrderNumber(ocrItem.extracted_po_number) : '';\n        return edited.po_number !== original;\n      }\n      default: return false;\n    }\n  };\n\n  // í•™ìŠµ ë°ì´í„° ì €ì¥ (í™•ì • ì‹œ í˜¸ì¶œ)\n  const saveOCRCorrections = async () => {\n    if (!statementWithItems) return;\n    \n    const corrections: Array<{\n      statement_id: string;\n      statement_item_id: string;\n      original_text: string;\n      corrected_text: string;\n      field_type: OCRFieldType;\n    }> = [];\n    \n    statementWithItems.items.forEach(ocrItem => {\n      const edited = editedOCRItems.get(ocrItem.id);\n      if (!edited) return;\n      \n      // ê° í•„ë“œë³„ë¡œ ìˆ˜ì • ì‚¬í•­ í™•ì¸\n      if (edited.item_name !== undefined && edited.item_name !== ocrItem.extracted_item_name) {\n        corrections.push({\n          statement_id: statementWithItems.id,\n          statement_item_id: ocrItem.id,\n          original_text: ocrItem.extracted_item_name || '',\n          corrected_text: edited.item_name,\n          field_type: 'item_name'\n        });\n      }\n      \n      if (edited.quantity !== undefined && edited.quantity !== ocrItem.extracted_quantity) {\n        corrections.push({\n          statement_id: statementWithItems.id,\n          statement_item_id: ocrItem.id,\n          original_text: String(ocrItem.extracted_quantity ?? ''),\n          corrected_text: String(edited.quantity),\n          field_type: 'quantity'\n        });\n      }\n      \n      if (edited.unit_price !== undefined && edited.unit_price !== ocrItem.extracted_unit_price) {\n        corrections.push({\n          statement_id: statementWithItems.id,\n          statement_item_id: ocrItem.id,\n          original_text: String(ocrItem.extracted_unit_price ?? ''),\n          corrected_text: String(edited.unit_price),\n          field_type: 'unit_price'\n        });\n      }\n      \n      if (edited.amount !== undefined && edited.amount !== ocrItem.extracted_amount) {\n        corrections.push({\n          statement_id: statementWithItems.id,\n          statement_item_id: ocrItem.id,\n          original_text: String(ocrItem.extracted_amount ?? ''),\n          corrected_text: String(edited.amount),\n          field_type: 'amount'\n        });\n      }\n      \n      if (edited.po_number !== undefined) {\n        const original = ocrItem.extracted_po_number ? normalizeOrderNumber(ocrItem.extracted_po_number) : '';\n        if (edited.po_number !== original) {\n          corrections.push({\n            statement_id: statementWithItems.id,\n            statement_item_id: ocrItem.id,\n            original_text: original,\n            corrected_text: edited.po_number,\n            field_type: 'po_number'\n          });\n        }\n      }\n    });\n    \n    // í•™ìŠµ ë°ì´í„° ì €ì¥\n    if (corrections.length > 0) {\n      console.log(`ğŸ“š í•™ìŠµ ë°ì´í„° ì €ì¥: ${corrections.length}ê±´ì˜ ìˆ˜ì •ì‚¬í•­`);\n      for (const correction of corrections) {\n        await transactionStatementService.saveCorrection(correction);\n      }\n      toast.success(`${corrections.length}ê±´ì˜ OCR ìˆ˜ì •ì‚¬í•­ì´ í•™ìŠµ ë°ì´í„°ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);\n    }\n  };\n\n  // ë§¤ì¹­ ìƒíƒœ ê³„ì‚° (item_nameê³¼ specification êµì°¨ ë¹„êµ)\n  // itemMatchesì— ì—†ì–´ë„ í˜„ì¬ í‘œì‹œëœ ì‹œìŠ¤í…œ í’ˆëª©ìœ¼ë¡œ fallback\n  const getMatchStatus = (ocrItem: TransactionStatementItemWithMatch): 'high' | 'med' | 'low' | 'unmatched' => {\n    // 1. ë¨¼ì € itemMatchesì—ì„œ í™•ì¸\n    const matched = itemMatches.get(ocrItem.id);\n    \n    // 2. itemMatchesì— ì—†ìœ¼ë©´ í˜„ì¬ í‘œì‹œëœ ì‹œìŠ¤í…œ í’ˆëª©ì—ì„œ ì°¾ê¸°\n    let effectiveMatch: SystemPurchaseItem | null = matched || null;\n    let hasSystemItems = false;\n    \n    if (!effectiveMatch) {\n      const poNumber = isSamePONumber \n        ? selectedPONumber \n        : (itemPONumbers.get(ocrItem.id) || (ocrItem.extracted_po_number ? normalizeOrderNumber(ocrItem.extracted_po_number) : ''));\n      \n      if (poNumber) {\n        const systemItems = getSystemItemsForPO(poNumber);\n        hasSystemItems = systemItems.length > 0;\n        \n        // ê°€ì¥ ìœ ì‚¬í•œ í’ˆëª© ì°¾ê¸°\n        let bestScore = 0;\n        systemItems.forEach(sysItem => {\n          const score = calculateItemSimilarity(ocrItem.extracted_item_name || '', sysItem.item_name, sysItem.specification);\n          if (score > bestScore) {\n            bestScore = score;\n            effectiveMatch = sysItem;\n          }\n        });\n      }\n    }\n    \n    if (!effectiveMatch) return 'unmatched';\n    \n    const similarity = calculateItemSimilarity(ocrItem.extracted_item_name || '', effectiveMatch.item_name || '', effectiveMatch.specification);\n    \n    // ë” ì—„ê²©í•œ ì„ê³„ê°’ ì ìš©\n    if (similarity >= 85) return 'high';   // ë†’ìŒ: 85% ì´ìƒ (ê¸°ì¡´ 80%)\n    if (similarity >= 60) return 'med';    // ë³´í†µ: 60% ì´ìƒ (ê¸°ì¡´ 50%)\n    if (similarity >= 40) return 'low';    // ë‚®ìŒ: 40% ì´ìƒ (ê¸°ì¡´ 30%)\n    \n    // 40% ë¯¸ë§Œì´ë©´ ë§¤ì¹­ ì•ˆë¨ìœ¼ë¡œ í‘œì‹œ (ê¸°ì¡´: ì‹œìŠ¤í…œ í’ˆëª© ìˆìœ¼ë©´ ë¬´ì¡°ê±´ 'low')\n    return 'unmatched';\n  };\n\n  // ë°œì£¼ë²ˆí˜¸ ì„ íƒ ì‹œ (Case 1: ì „ì²´ ì ìš©)\n  const handleSelectGlobalPO = async (poNumber: string, vendorNameFromSearch?: string, soNumberFromSearch?: string) => {\n    setSelectedPONumber(poNumber);\n\n    // ê²€ìƒ‰ì—ì„œ ìˆ˜ì£¼ë²ˆí˜¸ê°€ ì „ë‹¬ëœ ê²½ìš° í˜ì–´ ìºì‹œì— ì €ì¥\n    if (soNumberFromSearch) {\n      const normalizedPO = normalizeOrderNumber(poNumber);\n      setPoPairOverrides(prev => {\n        const next = new Map(prev);\n        next.set(normalizedPO, soNumberFromSearch);\n        return next;\n      });\n    }\n\n    // í•´ë‹¹ ë°œì£¼ë²ˆí˜¸ì˜ ì‹œìŠ¤í…œ í’ˆëª©ë“¤ ê°€ì ¸ì˜¤ê¸°\n    // 1. allPONumberCandidatesì—ì„œ í•´ë‹¹ ë°œì£¼ì˜ itemsì™€ purchaseId ì°¾ê¸°\n    const poCandidate = allPONumberCandidates.find(\n      c => c.poNumber === poNumber || c.salesOrderNumber === poNumber\n    );\n\n    // 2. items ë°°ì—´ì„ SystemPurchaseItem í˜•íƒœë¡œ ë³€í™˜\n    let systemItems: SystemPurchaseItem[] = [];\n    let vendorName = vendorNameFromSearch || '';\n\n    if (poCandidate && poCandidate.items.length > 0) {\n      systemItems = poCandidate.items.map(item => ({\n        purchase_id: item.purchase_id,\n        item_id: item.item_id,\n        purchase_order_number: item.purchase_order_number || '',\n        sales_order_number: item.sales_order_number,\n        item_name: item.item_name,\n        specification: item.specification,\n        quantity: item.quantity,\n        unit_price: item.unit_price,\n        amount: (item as any).amount,\n        vendor_name: item.vendor_name\n      }));\n\n      // ì¤‘ë³µ ì œê±°\n      systemItems = systemItems.filter((item, index, self) =>\n        index === self.findIndex(t => t.item_id === item.item_id)\n      );\n\n      // ê±°ë˜ì²˜ëª… ì¶”ì¶œ\n      if (!vendorName && systemItems[0]?.vendor_name) {\n        vendorName = systemItems[0].vendor_name;\n      }\n    }\n\n    // 3. ì—†ìœ¼ë©´ ê¸°ì¡´ ë°©ì‹ìœ¼ë¡œ fallback\n    if (systemItems.length === 0) {\n      systemItems = getSystemItemsForPO(poNumber);\n      if (!vendorName && systemItems[0]?.vendor_name) {\n        vendorName = systemItems[0].vendor_name;\n      }\n    }\n\n    // 4. ì—¬ì „íˆ ì—†ìœ¼ë©´ DBì—ì„œ ì§ì ‘ ì¡°íšŒ (ê²€ìƒ‰ì—ì„œ ì„ íƒí•œ ê²½ìš° í¬í•¨)\n    if (systemItems.length === 0) {\n      try {\n        // ë°œì£¼ë²ˆí˜¸ë¡œ purchase_request ë¨¼ì € ì°¾ê¸°\n        const { data: purchaseRequest } = await supabase\n          .from('purchase_requests')\n          .select(`\n            id,\n            purchase_order_number,\n            sales_order_number,\n            vendor:vendors(vendor_name)\n          `)\n          .or(`purchase_order_number.eq.${poNumber},sales_order_number.eq.${poNumber}`)\n          .limit(1)\n          .single();\n\n        if (purchaseRequest) {\n          // ê±°ë˜ì²˜ëª… ì„¤ì •\n          if (!vendorName && (purchaseRequest.vendor as any)?.vendor_name) {\n            vendorName = (purchaseRequest.vendor as any).vendor_name;\n          }\n\n          // ìˆ˜ì£¼ë²ˆí˜¸/ë°œì£¼ë²ˆí˜¸ í˜ì–´ ì €ì¥\n          const normalizedPO = normalizeOrderNumber(poNumber);\n          const pairedNumber = poNumber.startsWith('F')\n            ? purchaseRequest.sales_order_number\n            : purchaseRequest.purchase_order_number;\n          if (pairedNumber) {\n            setPoPairOverrides(prev => {\n              const next = new Map(prev);\n              next.set(normalizedPO, pairedNumber);\n              return next;\n            });\n          }\n\n          // í’ˆëª© ì¡°íšŒ\n          const { data: purchaseItems } = await supabase\n            .from('purchase_request_items')\n            .select(`\n              id,\n              item_name,\n              specification,\n              quantity,\n              received_quantity,\n              unit_price_value,\n              amount_value\n            `)\n            .eq('purchase_request_id', purchaseRequest.id);\n\n          if (purchaseItems && purchaseItems.length > 0) {\n            systemItems = purchaseItems.map((item: any) => ({\n              purchase_id: purchaseRequest.id,\n              item_id: item.id,\n              purchase_order_number: purchaseRequest.purchase_order_number || '',\n              sales_order_number: purchaseRequest.sales_order_number,\n              item_name: item.item_name || '',\n              specification: item.specification,\n              quantity: item.quantity,\n              received_quantity: item.received_quantity,\n              unit_price: item.unit_price_value,\n              amount: item.amount_value,\n              vendor_name: vendorName\n            }));\n            console.log('[handleSelectGlobalPO] DBì—ì„œ í’ˆëª© ì¡°íšŒ ì„±ê³µ:', systemItems.length);\n          }\n        }\n      } catch (error) {\n        console.error('[handleSelectGlobalPO] DB ì¡°íšŒ ì‹¤íŒ¨:', error);\n      }\n    }\n\n    console.log('[handleSelectGlobalPO] poNumber:', poNumber, 'systemItems:', systemItems.length, 'vendor:', vendorName);\n\n    // poItemsMapì— í’ˆëª© ì¶”ê°€ (UIì—ì„œ í›„ë³´ í‘œì‹œìš©)\n    if (systemItems.length > 0) {\n      setPoItemsMap(prev => {\n        const next = new Map(prev);\n        next.set(poNumber, systemItems);\n        // ìˆ˜ì£¼ë²ˆí˜¸ë¡œë„ ì €ì¥ (ì–‘ë°©í–¥ ì¡°íšŒ ê°€ëŠ¥í•˜ë„ë¡)\n        const salesOrderNumber = systemItems[0]?.sales_order_number;\n        if (salesOrderNumber && salesOrderNumber !== poNumber) {\n          next.set(salesOrderNumber, systemItems);\n        }\n        return next;\n      });\n    }\n\n    // ê±°ë˜ì²˜ëª… ì—…ë°ì´íŠ¸\n    if (vendorName) {\n      setVendorInputValue(vendorName);\n    }\n\n    // ìë™ ë§¤ì¹­ ìˆ˜í–‰\n    if (statementWithItems) {\n      const newMatches = new Map<string, SystemPurchaseItem | null>();\n\n      statementWithItems.items.forEach(ocrItem => {\n        // ê°€ì¥ ìœ ì‚¬í•œ ì‹œìŠ¤í…œ í’ˆëª© ì°¾ê¸° (item_nameê³¼ specification êµì°¨ ë¹„êµ)\n        let bestMatch: SystemPurchaseItem | null = null;\n        let bestScore = 0;\n\n        systemItems.forEach(sysItem => {\n          const score = calculateItemSimilarity(ocrItem.extracted_item_name || '', sysItem.item_name, sysItem.specification);\n          if (score > bestScore && score >= 40) { // ìµœì†Œ 40ì  ì´ìƒ\n            bestScore = score;\n            bestMatch = sysItem;\n          }\n        });\n\n        newMatches.set(ocrItem.id, bestMatch);\n      });\n      setItemMatches(newMatches);\n      \n      // ë¡œì»¬ stateì— ë°œì£¼ë²ˆí˜¸ ë°˜ì˜ (OCR inputì´ ì¦‰ì‹œ ë³€ê²½ë˜ë„ë¡)\n      const newEditedItems = new Map(editedOCRItems);\n      const newItemPONumbers = new Map(itemPONumbers);\n      statementWithItems.items.forEach(ocrItem => {\n        // editedOCRItems ì—…ë°ì´íŠ¸\n        const existing = newEditedItems.get(ocrItem.id) || {};\n        newEditedItems.set(ocrItem.id, { ...existing, po_number: poNumber });\n        // itemPONumbers ì—…ë°ì´íŠ¸\n        newItemPONumbers.set(ocrItem.id, poNumber);\n      });\n      setEditedOCRItems(newEditedItems);\n      setItemPONumbers(newItemPONumbers);\n\n      // ì „ì²´ í’ˆëª©ì˜ ë°œì£¼ë²ˆí˜¸ + ë§¤ì¹­ ê²°ê³¼ ì¦‰ì‹œ DB ì €ì¥\n      statementWithItems.items.forEach(ocrItem => {\n        const matched = newMatches.get(ocrItem.id);\n        supabase\n          .from('transaction_statement_items')\n          .update({\n            extracted_po_number: poNumber,\n            matched_purchase_id: matched?.purchase_id ?? null,\n            matched_item_id: matched?.item_id ?? null,\n          })\n          .eq('id', ocrItem.id)\n          .then(({ error }: { error: any }) => {\n            if (error) logger.warn('ì „ì²´ ë°œì£¼ë²ˆí˜¸ ì„ íƒ ìë™ ì €ì¥ ì‹¤íŒ¨:', error);\n          });\n      });\n\n    }\n  };\n\n  // ê±°ë˜ì²˜ ì¸ë¼ì¸ ê²€ìƒ‰ (debounce ì²˜ë¦¬ìš©)\n  const handleVendorSearch = async (searchValue: string) => {\n    if (!searchValue.trim()) {\n      setVendorSearchResults([]);\n      setVendorDropdownOpen(false);\n      return;\n    }\n    \n    setVendorSearchLoading(true);\n    setVendorDropdownOpen(true);\n    \n    try {\n      const { data: vendors, error } = await supabase\n        .from('vendors')\n        .select('id, vendor_name')\n        .ilike('vendor_name', `%${searchValue}%`)\n        .limit(10);\n      \n      if (error) throw error;\n      \n      setVendorSearchResults((vendors || []).map((vendor: VendorSearchRow) => ({\n        id: vendor.id,\n        name: vendor.vendor_name\n      })));\n    } catch (err) {\n      console.error('ê±°ë˜ì²˜ ê²€ìƒ‰ ì˜¤ë¥˜:', err);\n      setVendorSearchResults([]);\n    } finally {\n      setVendorSearchLoading(false);\n    }\n  };\n  \n  // ë°œì£¼ë²ˆí˜¸ ì¸ë¼ì¸ ê²€ìƒ‰\n  const handlePOSearch = async (searchValue: string) => {\n    if (!searchValue.trim()) {\n      setPOSearchResults([]);\n      setPODropdownOpen(false);\n      return;\n    }\n    \n    setPOSearchLoading(true);\n    setPODropdownOpen(true);\n    \n    try {\n      const normalized = normalizeOrderNumber(searchValue.trim());\n      \n      const { data: purchases, error } = await supabase\n        .from('purchase_requests')\n        .select(`\n          id,\n          purchase_order_number,\n          sales_order_number,\n          vendor:vendors(vendor_name)\n        `)\n        .or(`purchase_order_number.ilike.%${normalized}%,sales_order_number.ilike.%${normalized}%`)\n        .order('created_at', { ascending: false })\n        .limit(10);\n      \n      if (error) throw error;\n      \n      setPOSearchResults((purchases || []).map((p: any) => ({\n        id: p.id,\n        poNumber: p.purchase_order_number || '',\n        soNumber: p.sales_order_number,\n        vendorName: p.vendor?.vendor_name\n      })));\n    } catch (err) {\n      console.error('ë°œì£¼ë²ˆí˜¸ ê²€ìƒ‰ ì˜¤ë¥˜:', err);\n      setPOSearchResults([]);\n    } finally {\n      setPOSearchLoading(false);\n    }\n  };\n\n  // OCR ë°œì£¼/ìˆ˜ì£¼ë²ˆí˜¸ ì…ë ¥ ì‹œ ì‹¤ì‹œê°„ í˜ì–´ ì¡°íšŒ\n  const lookupPairedOrderNumber = useCallback(async (rawValue: string) => {\n    const trimmed = rawValue.trim();\n    if (!trimmed) return;\n    const normalized = normalizeOrderNumber(trimmed);\n    if (!normalized) return;\n    if (poPairOverrides.has(normalized)) return;\n    if (pendingPairLookupsRef.current.has(normalized)) return;\n    pendingPairLookupsRef.current.add(normalized);\n    try {\n      const { data, error } = await supabase\n        .from('purchase_requests')\n        .select('purchase_order_number,sales_order_number')\n        .or(`purchase_order_number.eq.${normalized},sales_order_number.eq.${normalized}`)\n        .limit(1);\n      if (error) throw error;\n      const match = data?.[0];\n      const pairedNumber = match\n        ? (normalized.startsWith('F')\n            ? match.sales_order_number\n            : normalized.startsWith('HS')\n              ? match.purchase_order_number\n              : (match.sales_order_number || match.purchase_order_number))\n        : null;\n      setPoPairOverrides(prev => {\n        const next = new Map(prev);\n        next.set(normalized, pairedNumber ?? null);\n        return next;\n      });\n    } catch (err) {\n      setPoPairOverrides(prev => {\n        const next = new Map(prev);\n        next.set(normalized, null);\n        return next;\n      });\n    } finally {\n      pendingPairLookupsRef.current.delete(normalized);\n    }\n  }, [poPairOverrides, supabase]);\n\n  // OCR ë°œì£¼ë²ˆí˜¸ ìˆ˜ì • ì‹œ ì‹œìŠ¤í…œ ë°œì£¼í’ˆëª©ì—ë„ ë°˜ì˜\n  const handleOCRPONumberChange = useCallback(async (newValue: string) => {\n    lookupPairedOrderNumber(newValue);\n    \n    // ì „ì²´ OCR í’ˆëª©ì— ìƒˆ ë°œì£¼ë²ˆí˜¸ ì ìš©\n    if (statementWithItems) {\n      statementWithItems.items.forEach(item => {\n        handleEditOCRItem(item.id, 'po_number', newValue);\n      });\n    }\n    \n    // ì‹œìŠ¤í…œ ë°œì£¼í’ˆëª©ì—ë„ ìë™ ë°˜ì˜\n    const normalizedValue = normalizeOrderNumber(newValue);\n    if (!normalizedValue) return;\n    \n    \n    // í›„ë³´ ëª©ë¡ì—ì„œ í•´ë‹¹ ë°œì£¼ë²ˆí˜¸ ì°¾ê¸°\n    const matchingCandidate = allPONumberCandidates.find(\n      c => c.poNumber === normalizedValue || c.salesOrderNumber === normalizedValue\n    );\n    \n    if (matchingCandidate) {\n      const newPO = matchingCandidate.poNumber || matchingCandidate.salesOrderNumber || '';\n      if (newPO && newPO !== selectedPONumber) {\n        setSelectedPONumber(newPO);\n      }\n      if (matchingCandidate.vendorName) {\n        setVendorInputValue(matchingCandidate.vendorName);\n        setOverrideVendorName(matchingCandidate.vendorName);\n      }\n    } else {\n      // í›„ë³´ ëª©ë¡ì— ì—†ìœ¼ë©´ DBì—ì„œ ì§ì ‘ ì¡°íšŒí•˜ì—¬ í’ˆëª© ë¡œë“œ\n      setSelectedPONumber(normalizedValue);\n      \n      try {\n        const { data: purchaseData } = await supabase\n          .from('purchase_requests')\n          .select(`\n            id,\n            purchase_order_number,\n            sales_order_number,\n            vendor:vendors(vendor_name),\n            purchase_request_items (\n              id,\n              item_name,\n              specification,\n              quantity,\n              received_quantity,\n              unit_price_value,\n              amount_value\n            )\n          `)\n          .or(`purchase_order_number.eq.${normalizedValue},sales_order_number.eq.${normalizedValue}`)\n          .limit(1);\n        \n        if (purchaseData && purchaseData.length > 0) {\n          const purchase = purchaseData[0];\n          const items = purchase.purchase_request_items || [];\n          const vendorName = (purchase.vendor as { vendor_name?: string } | null)?.vendor_name || '';\n          \n          // poItemsMapì— ì¶”ê°€\n          const newItems = items.map((item: any) => ({\n            purchase_id: purchase.id,\n            item_id: item.id,\n            purchase_order_number: purchase.purchase_order_number || '',\n            sales_order_number: purchase.sales_order_number,\n            item_name: item.item_name,\n            specification: item.specification,\n            quantity: item.quantity ?? 0,\n            received_quantity: item.received_quantity,\n            unit_price: item.unit_price_value,\n            amount: item.amount_value,\n            vendor_name: vendorName\n          }));\n          \n          setPoItemsMap(prev => {\n            const next = new Map(prev);\n            next.set(normalizedValue, newItems);\n            // ë°œì£¼ë²ˆí˜¸ì™€ ìˆ˜ì£¼ë²ˆí˜¸ ëª¨ë‘ë¡œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡\n            if (purchase.purchase_order_number) {\n              next.set(purchase.purchase_order_number, newItems);\n            }\n            if (purchase.sales_order_number) {\n              next.set(purchase.sales_order_number, newItems);\n            }\n            return next;\n          });\n\n          if (vendorName) {\n            setVendorInputValue(vendorName);\n            setOverrideVendorName(vendorName);\n          }\n          \n        }\n      } catch (err) {\n        console.error('ë°œì£¼ í’ˆëª© ì¡°íšŒ ì˜¤ë¥˜:', err);\n      }\n    }\n  }, [statementWithItems, allPONumberCandidates, selectedPONumber, lookupPairedOrderNumber, handleEditOCRItem, supabase]);\n\n  // ê±°ë˜ì²˜ ì„ íƒ ì‹œ - ë°œì£¼ í›„ë³´ ì¬ê²€ìƒ‰ ë° ë§¤ì¹­ ì¬ì‹¤í–‰\n  const handleSelectVendor = async (vendorName: string, options?: { silent?: boolean }) => {\n    const shouldNotify = !options?.silent;\n    setOverrideVendorName(vendorName);\n    setVendorInputValue(vendorName);\n    setVendorDropdownOpen(false);\n    setVendorSearchResults([]);\n    \n    // ê±°ë˜ì²˜ëª… ì¦‰ì‹œ DB ì €ì¥\n    supabase\n      .from('transaction_statements')\n      .update({ vendor_name: vendorName })\n      .eq('id', statement.id)\n      .then(() => {});\n\n    if (shouldNotify) {\n      toast.success(`ê±°ë˜ì²˜ê°€ \"${vendorName}\"(ìœ¼)ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤. ë°œì£¼ í›„ë³´ë¥¼ ë‹¤ì‹œ ê²€ìƒ‰í•©ë‹ˆë‹¤.`);\n    }\n    \n    // ìƒˆ ê±°ë˜ì²˜ë¡œ ë°œì£¼ í›„ë³´ ì¬ê²€ìƒ‰\n    try {\n      const { data: purchases, error } = await supabase\n        .from('purchase_requests')\n        .select(`\n          id,\n          purchase_order_number,\n          sales_order_number,\n          vendor:vendors!inner(vendor_name),\n          items:purchase_request_items(\n            id,\n            item_name,\n            specification,\n            quantity,\n            received_quantity,\n            unit_price_value,\n            amount_value\n          )\n        `)\n        .eq('vendor.vendor_name', vendorName)\n        .order('created_at', { ascending: false })\n        .limit(50);\n      \n      if (error) throw error;\n      \n      if (!purchases || purchases.length === 0) {\n        if (shouldNotify) {\n          toast.error(`\"${vendorName}\" ê±°ë˜ì²˜ì˜ ë°œì£¼ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.`);\n        }\n        return;\n      }\n      \n      const itemsMap = new Map<string, SystemPurchaseItem[]>();\n      let totalMapItems = 0;\n      purchases.forEach((purchase: any) => {\n        const mappedItems: SystemPurchaseItem[] = (purchase.items || []).map((item: any) => ({\n          purchase_id: purchase.id,\n          item_id: item.id,\n          purchase_order_number: purchase.purchase_order_number || '',\n          sales_order_number: purchase.sales_order_number,\n          item_name: item.item_name || '',\n          specification: item.specification,\n          quantity: item.quantity,\n          received_quantity: item.received_quantity,\n          unit_price: item.unit_price_value,\n          amount: item.amount_value,\n          vendor_name: vendorName\n        }));\n        if (mappedItems.length === 0) return;\n        totalMapItems += mappedItems.length;\n        if (purchase.purchase_order_number) {\n          itemsMap.set(purchase.purchase_order_number, mappedItems);\n        }\n        if (purchase.sales_order_number) {\n          itemsMap.set(purchase.sales_order_number, mappedItems);\n        }\n      });\n      setPoItemsMap(itemsMap);\n      \n      // ìƒˆ ë°œì£¼ í›„ë³´ë¡œ ì¬ë§¤ì¹­\n      const newCandidates = new Map<string, MatchCandidate[]>();\n      const firstPO = purchases[0]?.purchase_order_number || purchases[0]?.sales_order_number || '';\n      \n      // í’ˆëª©ë³„ í›„ë³´ ì—…ë°ì´íŠ¸\n      if (statementWithItems) {\n        statementWithItems.items.forEach((ocrItem, index) => {\n          const candidates: MatchCandidate[] = [];\n          let maxSimilarity = 0;\n          let comparedCount = 0;\n          \n          purchases.forEach((purchase: any) => {\n            (purchase.items || []).forEach((item: any) => {\n              const similarity = calculateItemSimilarity(ocrItem.extracted_item_name || '', item.item_name, item.specification);\n              comparedCount += 1;\n              if (similarity > maxSimilarity) {\n                maxSimilarity = similarity;\n              }\n              if (similarity >= 40) { // ìµœì†Œ 40ì  ì´ìƒ\n                candidates.push({\n                  purchase_id: purchase.id,\n                  item_id: item.id,\n                  purchase_order_number: purchase.purchase_order_number || '',\n                  sales_order_number: purchase.sales_order_number,\n                  item_name: item.item_name || '',\n                  specification: item.specification,\n                  quantity: item.quantity,\n                  unit_price: item.unit_price_value,\n                  score: similarity,\n                  match_reasons: ['ê±°ë˜ì²˜ ë§¤ì¹­'],\n                  vendor_name: vendorName\n                });\n              }\n            });\n          });\n          \n          if (index === 0) {\n          }\n          \n          candidates.sort((a, b) => b.score - a.score);\n          newCandidates.set(ocrItem.id, candidates.slice(0, 5));\n        });\n        \n        // ì²« ë²ˆì§¸ ë°œì£¼ë¡œ ìë™ ë§¤ì¹­\n        setSelectedPONumber(firstPO);\n        \n        const newMatches = new Map<string, SystemPurchaseItem | null>();\n        const systemItems: SystemPurchaseItem[] = (purchases[0]?.items || []).map((item: any) => ({\n          purchase_id: purchases[0].id,\n          item_id: item.id,\n          purchase_order_number: purchases[0].purchase_order_number || '',\n          sales_order_number: purchases[0].sales_order_number,\n          item_name: item.item_name || '',\n          specification: item.specification,\n          quantity: item.quantity,\n          unit_price: item.unit_price_value,\n          amount: item.amount_value,\n          vendor_name: vendorName\n        }));\n        \n        statementWithItems.items.forEach(ocrItem => {\n          // ê¸°ì¡´ ë§¤ì¹­ì´ ìˆìœ¼ë©´ ìœ ì§€\n          const existingMatch = itemMatches.get(ocrItem.id);\n          if (existingMatch && existingMatch.purchase_id) {\n            newMatches.set(ocrItem.id, existingMatch);\n            return;\n          }\n          \n          let bestMatch: SystemPurchaseItem | null = null;\n          let bestScore = 0;\n          \n          systemItems.forEach(sysItem => {\n            const score = calculateItemSimilarity(ocrItem.extracted_item_name || '', sysItem.item_name, sysItem.specification);\n            if (score > bestScore && score >= 30) {\n              bestScore = score;\n              bestMatch = sysItem;\n            }\n          });\n          \n          newMatches.set(ocrItem.id, bestMatch);\n        });\n        setItemMatches(newMatches);\n        \n        // ì„¸íŠ¸ ë§¤ì¹­ ê²°ê³¼ ì—…ë°ì´íŠ¸ (allPONumberCandidates ê°±ì‹ ìš©)\n        setSetMatchResult({\n          bestMatch: {\n            purchase_id: purchases[0].id,\n            purchase_order_number: purchases[0].purchase_order_number || '',\n            sales_order_number: purchases[0].sales_order_number,\n            vendor_name: vendorName,\n            matchScore: 100,\n            matchedItemCount: newMatches.size,\n            totalItemCount: statementWithItems.items.length,\n            confidence: 'high',\n            itemMatches: []\n          },\n          candidates: purchases.map((p: any) => ({\n            purchase_id: p.id,\n            purchase_order_number: p.purchase_order_number || '',\n            sales_order_number: p.sales_order_number,\n            vendor_name: vendorName,\n            matchScore: p.id === purchases[0].id ? 100 : 50,\n            matchedItemCount: (p.items || []).length\n          }))\n        });\n        \n        if (shouldNotify) {\n          toast.success(`${purchases.length}ê°œ ë°œì£¼ í›„ë³´ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤. ìë™ ë§¤ì¹­ ì™„ë£Œ.`);\n        }\n      }\n      \n    } catch (err) {\n      console.error('ê±°ë˜ì²˜ ë°œì£¼ ê²€ìƒ‰ ì˜¤ë¥˜:', err);\n      toast.error('ë°œì£¼ í›„ë³´ ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');\n    }\n  };\n\n  // ë°œì£¼ë²ˆí˜¸ ì„ íƒ ì‹œ (Case 2: ê°œë³„ í’ˆëª©ìš©)\n  const handleSelectItemPO = (ocrItemId: string, poNumber: string) => {\n    setItemPONumbers(prev => {\n      const newMap = new Map(prev);\n      newMap.set(ocrItemId, poNumber);\n      return newMap;\n    });\n    \n    const ocrItem = statementWithItems?.items.find(i => i.id === ocrItemId);\n    \n    if (ocrItem) {\n      // 1. match_candidatesì—ì„œ í•´ë‹¹ ë°œì£¼ë²ˆí˜¸ í›„ë³´ ì°¾ê¸°\n      const matchingCandidates = ocrItem.match_candidates?.filter(c => \n        c.purchase_order_number === poNumber || c.sales_order_number === poNumber\n      ) || [];\n      \n      let bestMatch: SystemPurchaseItem | null = null;\n      let bestScore = -1;\n      \n      if (matchingCandidates.length > 0) {\n        // match_candidatesì—ì„œ ê°€ì¥ ìœ ì‚¬í•œ ê²ƒ ì„ íƒ\n        matchingCandidates.forEach(c => {\n          const score = calculateItemSimilarity(ocrItem.extracted_item_name || '', c.item_name, c.specification);\n          if (score > bestScore) {\n            bestScore = score;\n            bestMatch = {\n              purchase_id: c.purchase_id,\n              item_id: c.item_id,\n              purchase_order_number: c.purchase_order_number || '',\n              sales_order_number: c.sales_order_number,\n              item_name: c.item_name,\n              specification: c.specification,\n              quantity: c.quantity,\n              received_quantity: c.received_quantity,\n              unit_price: c.unit_price,\n              amount: (c as any).amount,\n              vendor_name: c.vendor_name\n            };\n          }\n        });\n      }\n      \n      // 2. match_candidatesì—ì„œ ëª» ì°¾ìœ¼ë©´ getSystemItemsForPOë¡œ ì§ì ‘ ê²€ìƒ‰\n      if (!bestMatch) {\n        const systemItems = getSystemItemsForPO(poNumber);\n        systemItems.forEach(sysItem => {\n          const score = calculateItemSimilarity(ocrItem.extracted_item_name || '', sysItem.item_name, sysItem.specification);\n          if (score > bestScore) {\n            bestScore = score;\n            bestMatch = sysItem;\n          }\n        });\n      }\n      \n      // íƒ€ì… ì²´í¬ë¥¼ ìœ„í•´ final ë³€ìˆ˜ ì‚¬ìš©\n      const finalMatch = bestMatch as SystemPurchaseItem | null;\n      const matchedName = finalMatch?.item_name || 'ì—†ìŒ';\n      console.log(`ğŸ”„ ë°œì£¼ë²ˆí˜¸ ì„ íƒ: ${poNumber} â†’ ë§¤ì¹­: ${matchedName} (ì ìˆ˜: ${bestScore})`);\n      // #region agent log\n      fetch('http://127.0.0.1:7244/ingest/d1bfd845-9c34-4c24-9ef7-fd981ce7dd8e',{method:'POST',headers:{'Content-Type':'application/json','X-Debug-Session-Id':'9f46d9'},body:JSON.stringify({sessionId:'9f46d9',runId:'system-total-debug',hypothesisId:'H4',location:'StatementConfirmModal.tsx:handleSelectItemPO:selectedMatch',message:'item po selection matched system item',data:{statementId:statement.id,ocrItemId,poNumber,bestScore,matchFound:Boolean(finalMatch),matchedItemId:finalMatch?.item_id ?? null,unitPrice:finalMatch?.unit_price ?? null,quantity:finalMatch?.quantity ?? null,amount:finalMatch?.amount ?? null,candidateCount:matchingCandidates.length},timestamp:Date.now()})}).catch(()=>{});\n      // #endregion\n      \n      setItemMatches(prev => {\n        const newMap = new Map(prev);\n        newMap.set(ocrItemId, bestMatch);\n        return newMap;\n      });\n      \n      // ì¦‰ì‹œ DB ì €ì¥ (ë§¤ì¹­ + ë°œì£¼ë²ˆí˜¸)\n      persistMatchChange(ocrItemId, bestMatch);\n      persistSingleOCRItem(ocrItemId, 'po_number', poNumber);\n    }\n    \n    setOpenDropdowns(prev => {\n      const newSet = new Set(prev);\n      newSet.delete(`po-${ocrItemId}`);\n      return newSet;\n    });\n  };\n\n  const getPurchaseIdByNumber = useCallback((poNumber: string) => {\n    const candidate = allPONumberCandidates.find(\n      c => c.poNumber === poNumber || c.salesOrderNumber === poNumber\n    );\n    return candidate?.purchaseId || candidate?.items?.[0]?.purchase_id;\n  }, [allPONumberCandidates]);\n\n  const handleOpenPurchaseDetail = useCallback((purchaseId: number) => {\n    setSelectedPurchaseIdForDetail(purchaseId);\n    setIsPurchaseDetailModalOpen(true);\n  }, []);\n\n  const handleItemPOSearch = useCallback(async (ocrItemId: string, searchValue: string) => {\n    setItemPOSearchInputs(prev => ({ ...prev, [ocrItemId]: searchValue }));\n\n    if (!searchValue || searchValue.trim().length < 2) {\n      setItemPOSearchResults(prev => ({ ...prev, [ocrItemId]: [] }));\n      return;\n    }\n\n    setItemPOSearchLoading(prev => ({ ...prev, [ocrItemId]: true }));\n\n    try {\n      const { data, error } = await supabase\n        .from('purchase_requests')\n        .select(`\n          id,\n          purchase_order_number,\n          sales_order_number,\n          vendor:vendors(vendor_name)\n        `)\n        .or(`purchase_order_number.ilike.%${searchValue}%,sales_order_number.ilike.%${searchValue}%`)\n        .order('created_at', { ascending: false })\n        .limit(20);\n\n      if (error) throw error;\n\n      const results = (data || []).map((row: any) => ({\n        id: row.id,\n        poNumber: row.purchase_order_number || '',\n        soNumber: row.sales_order_number || undefined,\n        vendorName: row.vendor?.vendor_name\n      }));\n      setItemPOSearchResults(prev => ({ ...prev, [ocrItemId]: results }));\n    } catch (err) {\n      setItemPOSearchResults(prev => ({ ...prev, [ocrItemId]: [] }));\n    } finally {\n      setItemPOSearchLoading(prev => ({ ...prev, [ocrItemId]: false }));\n    }\n  }, [supabase]);\n\n  // ë§¤ì¹­ ë³€ê²½ ì¦‰ì‹œ DB ì €ì¥\n  const persistMatchChange = useCallback(async (ocrItemId: string, systemItem: SystemPurchaseItem | null) => {\n    const { error } = await supabase\n      .from('transaction_statement_items')\n      .update({\n        matched_purchase_id: systemItem?.purchase_id ?? null,\n        matched_item_id: systemItem?.item_id ?? null,\n      })\n      .eq('id', ocrItemId);\n\n    if (error) {\n      logger.warn('ë§¤ì¹­ ë³€ê²½ ìë™ ì €ì¥ ì‹¤íŒ¨:', error);\n    }\n  }, [supabase]);\n\n  // ì‹œìŠ¤í…œ í’ˆëª© ì§ì ‘ ì„ íƒ\n  const handleSelectSystemItem = (ocrItemId: string, systemItem: SystemPurchaseItem | null) => {\n    lastSelectedSystemItemRef.current = ocrItemId;\n    setItemMatches(prev => {\n      const newMap = new Map(prev);\n      newMap.set(ocrItemId, systemItem);\n      return newMap;\n    });\n    \n    // ì¦‰ì‹œ DB ì €ì¥\n    persistMatchChange(ocrItemId, systemItem);\n    \n    setOpenDropdowns(prev => {\n      const newSet = new Set(prev);\n      newSet.delete(`item-${ocrItemId}`);\n      return newSet;\n    });\n  };\n\n  useEffect(() => {\n    if (!lastSelectedSystemItemRef.current) return;\n    const itemId = lastSelectedSystemItemRef.current;\n    const matched = itemMatches.get(itemId);\n  }, [itemMatches]);\n\n  useEffect(() => {\n    if (!statementWithItems || itemMatches.size === 0) return;\n\n    let didUpdate = false;\n    const nextMap = new Map(itemMatches);\n\n    statementWithItems.items.forEach((ocrItem) => {\n      const current = itemMatches.get(ocrItem.id);\n      if (!current || current.received_quantity != null) return;\n\n      const itemPO = isSamePONumber\n        ? selectedPONumber\n        : (itemPONumbers.get(ocrItem.id) || (ocrItem.extracted_po_number ? normalizeOrderNumber(ocrItem.extracted_po_number) : ''));\n      const systemItems = itemPO ? getSystemItemsForPO(itemPO) : [];\n      if (systemItems.length === 0) return;\n\n      const enriched = systemItems.find((sys) => sys.item_id === current.item_id);\n      if (enriched && enriched.received_quantity != null) {\n        nextMap.set(ocrItem.id, { ...current, received_quantity: enriched.received_quantity });\n        didUpdate = true;\n      }\n    });\n\n    if (didUpdate) {\n      setItemMatches(nextMap);\n    }\n  }, [statementWithItems, itemMatches, isSamePONumber, selectedPONumber, itemPONumbers, getSystemItemsForPO]);\n\n  const effectiveConfirmerName = confirmerName || currentUserName || 'ì•Œìˆ˜ì—†ìŒ';\n  const uploaderId = statementWithItems?.uploaded_by ?? statement.uploaded_by;\n  const isAppAdmin = currentUserRoles.includes('app_admin');\n  const isLeadBuyer = currentUserRoles.includes('lead buyer');\n  const isUploader = Boolean(currentUserId && uploaderId && currentUserId === uploaderId);\n  const isManagerConfirmed = Boolean(statementWithItems?.manager_confirmed_at);\n  const isQuantityMatchConfirmed = Boolean(statementWithItems?.quantity_match_confirmed_at);\n  const isStatementConfirmed = statementWithItems?.status === 'confirmed';\n  \n  // ê¶Œí•œ ì²´í¬: app_adminì€ ëª¨ë“  ì‘ì—… ê°€ëŠ¥\n  const canConfirm = isLeadBuyer || isAppAdmin;\n  const canQuantityMatch = isUploader || isAppAdmin;\n  \n  // ì…ê³ ìˆ˜ëŸ‰ ëª¨ë“œì—ì„œëŠ” í™•ì • ë²„íŠ¼ ë¹„í™œì„±í™” (lead_buyer ìŠ¹ì¸ ë¶ˆí•„ìš”)\n  const isConfirmDisabled = saving || !statementWithItems || !canConfirm || isManagerConfirmed || isStatementConfirmed || isReceiptMode;\n  const isQuantityMatchDisabled = saving || !statementWithItems || !canQuantityMatch || isQuantityMatchConfirmed || isStatementConfirmed;\n  const confirmButtonLabel = isManagerConfirmed || isStatementConfirmed ? 'í™•ì • ì™„ë£Œ' : 'í™•ì •';\n  const quantityMatchButtonLabel = isQuantityMatchConfirmed || isStatementConfirmed ? (isReceiptMode ? 'ì™„ë£Œ' : 'ìˆ˜ëŸ‰ì¼ì¹˜ ì™„ë£Œ') : 'ìˆ˜ëŸ‰ì¼ì¹˜';\n\n  // í™•ì •\n  const handleConfirm = async () => {\n    if (!statementWithItems) return;\n\n    try {\n      setSaving(true);\n      setSavingAction('confirm');\n\n      // 1. OCR ìˆ˜ì •ì‚¬í•­ í•™ìŠµ ë°ì´í„°ë¡œ ì €ì¥\n      await saveOCRCorrections();\n      // 1.2 ìˆ˜ë™ ìˆ˜ì •ê°’ DB ë°˜ì˜ (ëª¨ë‹¬ ì¬ì˜¤í”ˆ ì‹œ ìœ ì§€)\n      await persistEditedOCRItems();\n\n      // 1.5 ê±°ë˜ì¼ ìˆ˜ì • ë°˜ì˜\n      const normalizedOriginalDate = normalizeStatementDate(statementWithItems.statement_date);\n      const normalizedInputDate = normalizeStatementDate(statementDateInput);\n      if (normalizedInputDate !== normalizedOriginalDate) {\n        const { error: dateError } = await supabase\n          .from('transaction_statements')\n          .update({ statement_date: normalizedInputDate || null })\n          .eq('id', statement.id);\n\n        if (dateError) {\n          throw new Error(dateError.message);\n        }\n      }\n\n      // 2. í™•ì • ë°ì´í„° ìƒì„± (ìˆ˜ì •ëœ ê°’ ìš°ì„  ì‚¬ìš©)\n      const confirmItems: ConfirmItemRequest[] = statementWithItems.items.map(item => {\n        const matched = itemMatches.get(item.id);\n        const edited = editedOCRItems.get(item.id);\n        \n        // ìˆ˜ì •ëœ ê°’ì´ ìˆìœ¼ë©´ ìˆ˜ì •ëœ ê°’ ì‚¬ìš©, ì—†ìœ¼ë©´ ì›ë³¸ ì‚¬ìš©\n        const confirmedQuantity = edited?.quantity !== undefined \n          ? edited.quantity \n          : item.extracted_quantity;\n        const confirmedUnitPrice = edited?.unit_price !== undefined \n          ? edited.unit_price \n          : item.extracted_unit_price;\n        const confirmedAmount = edited?.amount !== undefined \n          ? edited.amount \n          : item.extracted_amount;\n        \n        \n        return {\n          itemId: item.id,\n          matched_purchase_id: matched?.purchase_id,\n          matched_item_id: matched?.item_id,\n          confirmed_quantity: confirmedQuantity,\n          confirmed_unit_price: confirmedUnitPrice,\n          confirmed_amount: confirmedAmount\n        };\n      });\n\n      const result = await transactionStatementService.confirmStatement(\n        {\n          statementId: statement.id,\n          items: confirmItems,\n          actual_received_date: statementWithItems.extracted_data?.actual_received_date,\n          accounting_received_date: normalizeStatementDate(statementDateInput)\n        },\n        effectiveConfirmerName\n      );\n\n      if (result.success) {\n        if (result.updatedStatement) {\n          setStatementWithItems(prev => (prev ? { ...prev, ...result.updatedStatement } : prev));\n        }\n        if (result.finalized) {\n          toast.success('ê±°ë˜ëª…ì„¸ì„œê°€ í™•ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');\n        } else {\n          toast.success('í™•ì • ì²˜ë¦¬ ì™„ë£Œ (ìˆ˜ëŸ‰ì¼ì¹˜ ëŒ€ê¸°)');\n        }\n        onConfirm();\n      } else {\n        toast.error(result.error || 'í™•ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n      }\n    } catch (error) {\n      toast.error('í™•ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');\n    } finally {\n      setSaving(false);\n      setSavingAction(null);\n    }\n  };\n\n  // ìˆ˜ëŸ‰ì¼ì¹˜ í™•ì¸\n  const handleQuantityMatch = async () => {\n    if (!statementWithItems) return;\n\n    try {\n      setSaving(true);\n      setSavingAction('quantity-match');\n\n      // ìˆ˜ë™ ìˆ˜ì •ê°’ í•™ìŠµ/ì €ì¥\n      await saveOCRCorrections();\n      await persistEditedOCRItems();\n\n      const confirmItems: ConfirmItemRequest[] = statementWithItems.items.map(item => {\n        const matched = itemMatches.get(item.id);\n        const edited = editedOCRItems.get(item.id);\n\n        const confirmedQuantity = edited?.quantity !== undefined\n          ? edited.quantity\n          : item.extracted_quantity;\n\n        return {\n          itemId: item.id,\n          matched_purchase_id: matched?.purchase_id,\n          matched_item_id: matched?.item_id,\n          confirmed_quantity: confirmedQuantity\n        };\n      });\n\n      const result = await transactionStatementService.confirmQuantityMatch(\n        {\n          statementId: statement.id,\n          items: confirmItems,\n          actual_received_date: statementWithItems.extracted_data?.actual_received_date\n        },\n        effectiveConfirmerName\n      );\n\n      if (result.success) {\n        if (result.updatedStatement) {\n          setStatementWithItems(prev => (prev ? { ...prev, ...result.updatedStatement } : prev));\n        }\n        if (result.finalized) {\n          toast.success('ê±°ë˜ëª…ì„¸ì„œê°€ í™•ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');\n        } else {\n          toast.success('ìˆ˜ëŸ‰ì¼ì¹˜ í™•ì¸ ì™„ë£Œ (í™•ì • ëŒ€ê¸°)');\n        }\n        onConfirm();\n      } else {\n        toast.error(result.error || 'ìˆ˜ëŸ‰ì¼ì¹˜ í™•ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n      }\n    } catch (error) {\n      toast.error('ìˆ˜ëŸ‰ì¼ì¹˜ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');\n    } finally {\n      setSaving(false);\n      setSavingAction(null);\n    }\n  };\n\n  // ê±°ë¶€\n  const handleReject = async () => {\n    if (!confirm('ì´ ê±°ë˜ëª…ì„¸ì„œë¥¼ ê±°ë¶€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;\n\n    try {\n      setSaving(true);\n      setSavingAction('reject');\n      \n      const result = await transactionStatementService.rejectStatement(statement.id);\n      \n      if (result.success) {\n        toast.success('ê±°ë˜ëª…ì„¸ì„œê°€ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.');\n        onClose();\n      } else {\n        toast.error(result.error || 'ê±°ë¶€ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n      }\n    } catch (error) {\n      toast.error('ê±°ë¶€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');\n    } finally {\n      setSaving(false);\n      setSavingAction(null);\n    }\n  };\n\n  const formatAmount = (amount?: number) => {\n    if (amount === undefined || amount === null) return '-';\n    return amount.toLocaleString('ko-KR');\n  };\n\n  const getCurrencySymbol = (currency?: string | null) => {\n    if (!currency) return 'â‚©';\n    if (currency === 'USD') return '$';\n    if (currency === 'KRW' || currency === 'ì›' || currency === 'â‚©') return 'â‚©';\n    return currency;\n  };\n\n  const getTotalsCurrencySymbol = () => {\n    const currencies = Array.from(purchaseCurrencyMap.values()).filter(Boolean);\n    if (currencies.length === 0) return 'â‚©';\n    const unique = Array.from(new Set(currencies));\n    if (unique.length === 1) return getCurrencySymbol(unique[0]);\n    return 'â‚©';\n  };\n\n  const getSystemAmount = (item?: SystemPurchaseItem | null) => {\n    if (!item) return null;\n    if (item.amount !== undefined && item.amount !== null) return item.amount;\n    if (item.unit_price !== undefined && item.unit_price !== null && item.quantity !== undefined && item.quantity !== null) {\n      return item.unit_price * item.quantity;\n    }\n    return null;\n  };\n\n  useEffect(() => {\n    if (!statementWithItems) return;\n    const matchedValues = Array.from(itemMatches.values()).filter(Boolean) as SystemPurchaseItem[];\n    const totalFromUI = matchedValues.reduce((sum, item) => sum + (getSystemAmount(item) || 0), 0);\n    const totalFromUnitPriceQty = matchedValues.reduce((sum, item) => {\n      const qty = item.quantity ?? 0;\n      const unitPrice = item.unit_price ?? 0;\n      return sum + (qty * unitPrice);\n    }, 0);\n    // #region agent log\n    fetch('http://127.0.0.1:7244/ingest/d1bfd845-9c34-4c24-9ef7-fd981ce7dd8e',{method:'POST',headers:{'Content-Type':'application/json','X-Debug-Session-Id':'9f46d9'},body:JSON.stringify({sessionId:'9f46d9',runId:'system-total-debug',hypothesisId:'H3',location:'StatementConfirmModal.tsx:itemMatchesEffect:totals',message:'system total calculation snapshot',data:{statementId:statement.id,matchedCount:matchedValues.length,totalFromUI,totalFromUnitPriceQty,amountFieldCount:matchedValues.filter((m)=>m.amount!=null).length,derivedOnlyCount:matchedValues.filter((m)=>m.amount==null && m.unit_price!=null && m.quantity!=null).length,nullAmountAndCannotDeriveCount:matchedValues.filter((m)=>m.amount==null && (m.unit_price==null || m.quantity==null)).length,sample:matchedValues.slice(0,4).map((m)=>({itemId:m.item_id,quantity:m.quantity ?? null,unitPrice:m.unit_price ?? null,amount:m.amount ?? null,resolvedAmount:getSystemAmount(m)}))},timestamp:Date.now()})}).catch(()=>{});\n    // #endregion\n  }, [statementWithItems, itemMatches, isReceiptMode, statement.id]);\n\n\n  const getSystemItemLabel = (item?: SystemPurchaseItem | null) => {\n    if (!item) return '';\n    const name = item.item_name?.trim() || '';\n    const spec = item.specification?.trim() || '';\n    // specificationì´ ìˆê³  item_nameë³´ë‹¤ êµ¬ì²´ì (ê¸¸ë©´) â†’ specification í‘œì‹œ\n    // (ëª¨ë¸ëª…/ê·œê²©ì´ ë³´í†µ PCB, METAL MASK ê°™ì€ í’ˆëª©ëª…ë³´ë‹¤ ê¸¸ê³  êµ¬ì²´ì )\n    if (spec && spec.length > name.length) return spec;\n    if (name) return name;\n    if (spec) return spec;\n    return `í’ˆëª© #${item.item_id}`;\n  };\n\n  const handleOpenOriginalImage = () => {\n    const imageUrl = statementWithItems?.image_url || statement.image_url;\n    if (!imageUrl) return;\n\n    const width = 1000;\n    const height = 800;\n    const left = Math.max(0, window.screenX + (window.outerWidth - width) / 2);\n    const top = Math.max(0, window.screenY + (window.outerHeight - height) / 2);\n    window.open(imageUrl, 'transaction-statement-image', `width=${width},height=${height},left=${left},top=${top}`);\n  };\n\n  const resetReextractState = () => {\n    setEditedOCRItems(new Map());\n    setItemPONumbers(new Map());\n    setItemMatches(new Map());\n    setSelectedPONumber('');\n    setSetMatchResult(null);\n    setManuallySelectedPO(false);\n    setPoPairOverrides(new Map());\n    setItemPOSearchInputs({});\n    setItemPOSearchResults({});\n    setItemPOSearchLoading({});\n    setPOSearchInput('');\n    setPOSearchInputOpen(false);\n    setPODropdownOpen(false);\n    setVendorInputValue('');\n    setVendorSearchResults([]);\n    setVendorDropdownOpen(false);\n    setOverrideVendorName(null);\n    setMatchDetailPopup(null);\n    setIsIntegratedMatchDetailOpen(false);\n    setOpenDropdowns(new Set());\n    autoVendorSelectionRef.current = false;\n    systemCandidateLogKeyRef.current = null;\n  };\n\n  const handleReextract = async () => {\n    if (loading) return;\n    const imageUrl = statementWithItems?.image_url || statement.image_url;\n    if (!imageUrl) {\n      toast.error('ì´ë¯¸ì§€ URLì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');\n      return;\n    }\n\n    resetReextractState();\n    onReextractStart?.(statement.id);\n    onClose();\n    toast.loading('OCR ì¬ì¶”ì¶œ ì¤‘... (ì•½ 10~30ì´ˆ ì†Œìš”)', { id: `reextract-${statement.id}` });\n\n    try {\n      const result = await transactionStatementService.extractStatementData(statement.id, imageUrl, true);\n      if (result.success) {\n        if (result.queued) {\n          toast.info('ì¬ì¶”ì¶œì´ ëŒ€ê¸°ì—´ì— ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.', { id: `reextract-${statement.id}` });\n        } else {\n          toast.success('OCR ì¬ì¶”ì¶œì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.', { id: `reextract-${statement.id}` });\n        }\n      } else {\n        toast.error(result.error || 'OCR ì¬ì¶”ì¶œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', { id: `reextract-${statement.id}` });\n      }\n    } catch (error) {\n      toast.error('OCR ì¬ì¶”ì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', { id: `reextract-${statement.id}` });\n    } finally {\n      onReextractFinish?.(statement.id);\n    }\n  };\n\n  // ë§¤ì¹­ ìƒì„¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°\n  const getMatchDetails = (ocrItem: TransactionStatementItemWithMatch) => {\n    const matched = itemMatches.get(ocrItem.id);\n    let effectiveMatch: SystemPurchaseItem | null = matched || null;\n    let hasSystemItems = false;\n    \n    if (!effectiveMatch) {\n      const poNumber = isSamePONumber \n        ? selectedPONumber \n        : (itemPONumbers.get(ocrItem.id) || (ocrItem.extracted_po_number ? normalizeOrderNumber(ocrItem.extracted_po_number) : ''));\n      \n      if (poNumber) {\n        const systemItems = getSystemItemsForPO(poNumber);\n        hasSystemItems = systemItems.length > 0;\n        \n        let bestScore = 0;\n        systemItems.forEach(sysItem => {\n          const score = calculateItemSimilarity(ocrItem.extracted_item_name || '', sysItem.item_name, sysItem.specification);\n          if (score > bestScore) {\n            bestScore = score;\n            effectiveMatch = sysItem;\n          }\n        });\n      }\n    }\n    \n    if (!effectiveMatch) {\n      return {\n        ocrItemName: ocrItem.extracted_item_name || '-',\n        systemItemName: '-',\n        systemSpec: '-',\n        similarity: 0,\n        status: 'unmatched' as const,\n        reasons: ['ì‹œìŠ¤í…œì—ì„œ ë§¤ì¹­í•  ë°œì£¼ í’ˆëª©ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.']\n      };\n    }\n    \n    const similarity = calculateItemSimilarity(ocrItem.extracted_item_name || '', effectiveMatch.item_name || '', effectiveMatch.specification);\n    \n    // ë” ì—„ê²©í•œ ì„ê³„ê°’ ì ìš© (getMatchStatusì™€ ë™ì¼)\n    let status: 'high' | 'med' | 'low' | 'unmatched' = 'unmatched';\n    if (similarity >= 85) status = 'high';       // ë†’ìŒ: 85% ì´ìƒ\n    else if (similarity >= 60) status = 'med';   // ë³´í†µ: 60% ì´ìƒ\n    else if (similarity >= 40) status = 'low';   // ë‚®ìŒ: 40% ì´ìƒ\n    // 40% ë¯¸ë§Œì´ë©´ unmatched ìœ ì§€\n    \n    const reasons: string[] = [];\n    \n    // ìœ ì‚¬ë„ ì„¤ëª… (ì„ê³„ê°’ì— ë§ê²Œ ì¡°ì •)\n    if (similarity >= 85) {\n      reasons.push(`âœ… í’ˆëª©ëª…/ê·œê²© ìœ ì‚¬ë„ ${similarity.toFixed(0)}% (ë†’ìŒ)`);\n    } else if (similarity >= 60) {\n      reasons.push(`âš ï¸ í’ˆëª©ëª…/ê·œê²© ìœ ì‚¬ë„ ${similarity.toFixed(0)}% (ë³´í†µ)`);\n    } else if (similarity >= 40) {\n      reasons.push(`âš ï¸ í’ˆëª©ëª…/ê·œê²© ìœ ì‚¬ë„ ${similarity.toFixed(0)}% (ë‚®ìŒ)`);\n    } else {\n      reasons.push(`âŒ í’ˆëª©ëª…/ê·œê²© ìœ ì‚¬ë„ ${similarity.toFixed(0)}% (ë§¤ìš° ë‚®ìŒ - ë¶ˆì¼ì¹˜)`);\n    }\n    \n    // í’ˆëª©ëª… vs ê·œê²© ìƒì„¸ ë¹„êµ (ìœ ì‚¬ë„ì™€ ì¼ê´€ë˜ê²Œ)\n    const ocrName = (ocrItem.extracted_item_name || '').toLowerCase().replace(/\\s+/g, '');\n    const sysName = (effectiveMatch.item_name || '').toLowerCase().replace(/\\s+/g, '');\n    const sysSpec = (effectiveMatch.specification || '').toLowerCase().replace(/\\s+/g, '');\n    \n    // ê·œê²© ì¼ì¹˜ ì—¬ë¶€ ë¨¼ì € í™•ì¸\n    const specMatch = sysSpec && (ocrName === sysSpec || ocrName.includes(sysSpec) || sysSpec.includes(ocrName));\n    const nameMatch = ocrName === sysName || ocrName.includes(sysName) || sysName.includes(ocrName);\n    \n    if (similarity >= 85) {\n      // ìœ ì‚¬ë„ ë†’ìœ¼ë©´ ë¬´ì—‡ì´ ì¼ì¹˜í–ˆëŠ”ì§€ ì„¤ëª…\n      if (nameMatch && specMatch) {\n        reasons.push('âœ… í’ˆëª©ëª…ê³¼ ê·œê²© ëª¨ë‘ ì¼ì¹˜');\n      } else if (specMatch) {\n        reasons.push('âœ… ê·œê²©ìœ¼ë¡œ ë§¤ì¹­ë¨');\n      } else if (nameMatch) {\n        reasons.push('âœ… í’ˆëª©ëª…ìœ¼ë¡œ ë§¤ì¹­ë¨');\n      } else {\n        reasons.push('âœ… ë¬¸ìì—´ ìœ ì‚¬ë„ë¡œ ë§¤ì¹­ë¨');\n      }\n    } else if (similarity >= 60) {\n      if (specMatch) {\n        reasons.push('âš ï¸ ê·œê²© ë¶€ë¶„ ì¼ì¹˜');\n      } else if (nameMatch) {\n        reasons.push('âš ï¸ í’ˆëª©ëª… ë¶€ë¶„ ì¼ì¹˜');\n      } else {\n        reasons.push('âš ï¸ ë¶€ë¶„ì ìœ¼ë¡œ ìœ ì‚¬');\n      }\n    } else {\n      // ìœ ì‚¬ë„ ë‚®ì€ ê²½ìš° ë¶ˆì¼ì¹˜ í‘œì‹œ\n      reasons.push('âŒ í’ˆëª©ëª…/ê·œê²© ë¶ˆì¼ì¹˜ - ë‹¤ë¥¸ í’ˆëª©ì¼ ê°€ëŠ¥ì„± ë†’ìŒ');\n    }\n    \n    // ë°œì£¼ë²ˆí˜¸ ì„¤ëª…\n    reasons.push(`ğŸ“¦ ë°œì£¼ë²ˆí˜¸: ${effectiveMatch.purchase_order_number || effectiveMatch.sales_order_number || '-'}`);\n    \n    // ì‹œìŠ¤í…œ í’ˆëª© ìƒì„¸\n    if (effectiveMatch.specification) {\n      reasons.push(`ğŸ“‹ ì‹œìŠ¤í…œ ê·œê²©: ${effectiveMatch.specification}`);\n    }\n    \n    return {\n      ocrItemName: ocrItem.extracted_item_name || '-',\n      systemItemName: effectiveMatch.item_name || '-',\n      systemSpec: effectiveMatch.specification || '-',\n      similarity,\n      status,\n      reasons\n    };\n  };\n  \n  // ë§¤ì¹­ ìƒíƒœ ë±ƒì§€ í´ë¦­ í•¸ë“¤ëŸ¬\n  const handleMatchStatusClick = (ocrItem: TransactionStatementItemWithMatch) => {\n    const details = getMatchDetails(ocrItem);\n    setMatchDetailPopup({\n      isOpen: true,\n      ocrItemId: ocrItem.id,\n      ...details\n    });\n  };\n\n  const renderMatchStatusBadge = (status: 'high' | 'med' | 'low' | 'unmatched', ocrItem?: TransactionStatementItemWithMatch) => {\n    const onClick = ocrItem ? () => handleMatchStatusClick(ocrItem) : undefined;\n    const clickableClass = ocrItem ? \"cursor-pointer hover:opacity-80 transition-opacity\" : \"\";\n    \n    switch (status) {\n      case 'high':\n        return <span className={`badge-stats bg-green-500 text-white ${clickableClass}`} onClick={onClick} title=\"í´ë¦­í•˜ì—¬ ìƒì„¸ ë³´ê¸°\"><Check className=\"w-3 h-3\" />ë†’ìŒ</span>;\n      case 'med':\n        return <span className={`badge-stats bg-yellow-500 text-white ${clickableClass}`} onClick={onClick} title=\"í´ë¦­í•˜ì—¬ ìƒì„¸ ë³´ê¸°\">ë³´í†µ</span>;\n      case 'low':\n        return <span className={`badge-stats bg-orange-500 text-white ${clickableClass}`} onClick={onClick} title=\"í´ë¦­í•˜ì—¬ ìƒì„¸ ë³´ê¸°\">ë‚®ìŒ</span>;\n      case 'unmatched':\n        return <span className={`badge-stats bg-gray-500 text-white ${clickableClass}`} onClick={onClick} title=\"í´ë¦­í•˜ì—¬ ìƒì„¸ ë³´ê¸°\">ë¯¸ë§¤ì¹­</span>;\n    }\n  };\n\n  const getDropdownWidth = (key: string) => (key === 'global-po' ? 320 : 280);\n\n  const toggleDropdown = (key: string, event?: React.MouseEvent<HTMLElement>) => {\n    if (event) {\n      const rect = event.currentTarget.getBoundingClientRect();\n      const dropdownWidth = getDropdownWidth(key);\n      const viewportPadding = 8;\n      const maxLeft = Math.max(viewportPadding, window.innerWidth - dropdownWidth - viewportPadding);\n      const nextLeft = Math.min(Math.max(rect.left, viewportPadding), maxLeft);\n\n      setDropdownPosition({\n        top: rect.bottom + 4,\n        left: nextLeft\n      });\n    }\n    \n    setOpenDropdowns(prev => {\n      const newSet = new Set(prev);\n      if (newSet.has(key)) {\n        newSet.delete(key);\n      } else {\n        newSet.clear(); // ë‹¤ë¥¸ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°\n        newSet.add(key);\n      }\n      return newSet;\n    });\n  };\n\n  const handleGlobalPODropdownWheel = useCallback((event: React.WheelEvent<HTMLDivElement>) => {\n    const el = event.currentTarget;\n    const beforeScrollTop = el.scrollTop;\n    const maxScrollTop = Math.max(0, el.scrollHeight - el.clientHeight);\n    const nextScrollTop = Math.min(maxScrollTop, Math.max(0, beforeScrollTop + event.deltaY));\n\n    event.preventDefault();\n    event.stopPropagation();\n\n    if (nextScrollTop !== beforeScrollTop) {\n      el.scrollTop = nextScrollTop;\n    }\n  }, []);\n\n  if (!statement) return null;\n\n  return (\n    <>\n      <Dialog open={isOpen} onOpenChange={onClose}>\n        <DialogContent \n          maxWidth=\"max-w-[85vw] sm:max-w-[85vw]\"\n          className=\"max-h-[90vh] overflow-hidden flex flex-col business-radius-modal\" \n          data-debug={dialogDebugId}\n          showCloseButton={false}\n          onInteractOutside={(e) => {\n            // ë“œë¡­ë‹¤ìš´ì´ ì—´ë ¤ìˆì„ ë•ŒëŠ” ì™¸ë¶€ í´ë¦­ìœ¼ë¡œ ëª¨ë‹¬ ë‹«ê¸° ë°©ì§€\n            if (openDropdowns.size > 0) {\n              e.preventDefault();\n            }\n          }}\n        >\n          <DialogHeader className=\"border-b border-gray-100 pb-3 px-4\">\n            <DialogTitle className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-2 modal-title\">\n                <CheckCircle className=\"w-4 h-4 text-hansl-600\" />\n                ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ë° í™•ì •\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={handleReextract}\n                  disabled={loading}\n                  className=\"button-base h-7 text-[10px]\"\n                >\n                  <RefreshCw className=\"w-3.5 h-3.5 mr-1\" />\n                  ì¬ì¶”ì¶œ\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={handleOpenOriginalImage}\n                  className=\"button-base h-7 text-[10px]\"\n                >\n                  <ImageIcon className=\"w-3.5 h-3.5 mr-1\" />\n                  ì›ë³¸ ë³´ê¸°\n                </Button>\n              </div>\n            </DialogTitle>\n          </DialogHeader>\n\n          {loading ? (\n            <div className=\"flex items-center justify-center py-12\">\n              <Loader2 className=\"w-6 h-6 animate-spin text-hansl-600\" />\n              <span className=\"ml-3 modal-subtitle\">ë¡œë”© ì¤‘...</span>\n            </div>\n          ) : statementWithItems ? (\n            <div className=\"flex-1 overflow-hidden flex flex-col py-3 px-4\">\n              {/* ìš”ì•½ ì •ë³´ */}\n              <div className=\"flex items-center gap-6 p-3 bg-gray-50 business-radius-card mb-4\">\n                <div className=\"relative\">\n                  <p className=\"modal-label\">ê±°ë˜ì²˜</p>\n                  <div className=\"relative\">\n                    <input\n                      type=\"text\"\n                      value={vendorInputValue}\n                      onChange={(e) => {\n                        setVendorInputValue(e.target.value);\n                        handleVendorSearch(e.target.value);\n                      }}\n                      onFocus={() => {\n                        if (vendorSearchResults.length > 0) setVendorDropdownOpen(true);\n                      }}\n                      onBlur={() => {\n                        // delay to allow click on dropdown\n                        setTimeout(() => {\n                          setVendorDropdownOpen(false);\n                          // ê±°ë˜ì²˜ëª… ì¦‰ì‹œ DB ì €ì¥\n                          if (vendorInputValue.trim()) {\n                            supabase\n                              .from('transaction_statements')\n                              .update({ vendor_name: vendorInputValue.trim() })\n                              .eq('id', statement.id)\n                              .then(() => {});\n                          }\n                        }, 200);\n                      }}\n                      placeholder=\"ê±°ë˜ì²˜ ê²€ìƒ‰...\"\n                      className={`w-[120px] h-5 px-1.5 bg-white border business-radius focus:outline-none focus:ring-1 focus:ring-hansl-400 ${\n                        overrideVendorName ? 'border-green-400 text-green-700' : 'border-gray-300 text-gray-900'\n                      }`}\n                      style={{ fontSize: '11px', fontWeight: 700 }}\n                    />\n                    {vendorSearchLoading && (\n                      <Loader2 className=\"absolute right-2 top-1/2 -translate-y-1/2 w-3 h-3 animate-spin text-gray-400\" />\n                    )}\n                    {/* ì¸ë¼ì¸ ë“œë¡­ë‹¤ìš´ */}\n                    {vendorDropdownOpen && vendorSearchResults.length > 0 && (\n                      <div className=\"absolute top-full left-0 mt-1 w-[200px] bg-white border border-gray-200 rounded-lg shadow-lg z-50 max-h-[180px] overflow-y-auto\">\n                        {vendorSearchResults.map((vendor) => (\n                          <button\n                            key={vendor.id}\n                            onMouseDown={(e) => e.preventDefault()}\n                            onClick={() => {\n                              setVendorInputValue(vendor.name);\n                              setVendorDropdownOpen(false);\n                              handleSelectVendor(vendor.name);\n                            }}\n                            className=\"w-full px-2 py-1.5 text-left hover:bg-gray-50 border-b border-gray-100 last:border-b-0\"\n                          >\n                            <div className=\"text-[10px] font-medium text-gray-900\">{vendor.name}</div>\n                          </button>\n                        ))}\n                      </div>\n                    )}\n                  </div>\n                </div>\n                <div>\n                  <p className=\"modal-label\">ê±°ë˜ì¼</p>\n                  <input\n                    type=\"date\"\n                    value={statementDateInput}\n                    onChange={(e) => {\n                      const newDate = e.target.value;\n                      setStatementDateInput(newDate);\n                      // ì¦‰ì‹œ DB ì €ì¥\n                      const normalized = normalizeStatementDate(newDate);\n                      if (normalized) {\n                        supabase\n                          .from('transaction_statements')\n                          .update({ statement_date: normalized })\n                          .eq('id', statement.id)\n                          .then(() => {});\n                      }\n                    }}\n                    className=\"w-[120px] h-5 px-1.5 bg-white border border-gray-300 business-radius-input focus:outline-none focus:ring-1 focus:ring-hansl-400 text-gray-900\"\n                    style={{ fontSize: '11px', fontWeight: 600 }}\n                  />\n                </div>\n                <div>\n                  <p className=\"modal-label\">í•©ê³„ê¸ˆì•¡</p>\n                  <p className=\"modal-value-large\">\n                    {formatAmount(statementWithItems.grand_total ?? statementWithItems.total_amount)}ì›\n                  </p>\n                </div>\n                <div>\n                  <p className=\"modal-label\">í’ˆëª© ìˆ˜</p>\n                  <p className=\"modal-value\">{statementWithItems.items.length}ê±´</p>\n                </div>\n              </div>\n\n              {/* 3ë‹¨ ë¹„êµ í…Œì´ë¸” */}\n              <div className=\"flex-1 overflow-auto border border-gray-200 business-radius-card\">\n                <table className=\"modal-value table-auto min-w-full border-collapse\">\n                  <thead className=\"bg-gray-100 sticky top-0 z-10\">\n                    <tr className=\"border-b border-gray-200\">\n                      {/* ì¢Œì¸¡: ì‹œìŠ¤í…œ ë°œì£¼í’ˆëª© í—¤ë” */}\n                      <th colSpan={isReceiptMode ? (isSamePONumber ? 3 : 4) : (isSamePONumber ? 4 : 5)} className=\"border-r-2 border-gray-300 p-2 text-left w-[45%]\">\n                        <div className=\"flex items-center gap-2 flex-wrap\">\n                          <span className=\"modal-section-title text-gray-700\">ì‹œìŠ¤í…œ ë°œì£¼í’ˆëª©</span>\n                          {isSamePONumber && allPONumberCandidates.length > 0 && (\n                            <div className=\"relative flex items-center gap-1\">\n                              <button\n                                onClick={(e) => toggleDropdown('global-po', e)}\n                                className=\"inline-flex items-center gap-1 px-1.5 h-5 text-[10px] font-medium bg-white border border-gray-300 rounded-md hover:bg-gray-50 text-gray-700\"\n                              >\n                                {(() => {\n                                  if (!selectedPONumber) return 'ë°œì£¼ë²ˆí˜¸ ì„ íƒ';\n                                  const candidate = allPONumberCandidates.find(c => c.poNumber === selectedPONumber || c.salesOrderNumber === selectedPONumber);\n                                  if (candidate?.poNumber && candidate?.salesOrderNumber) {\n                                    return <>{candidate.poNumber} <span className=\"text-gray-400\">({candidate.salesOrderNumber})</span></>;\n                                  }\n                                  // ì„ íƒëœ ë°œì£¼ë²ˆí˜¸ë¥¼ ê·¸ëŒ€ë¡œ í‘œì‹œ (ìˆ˜ë™ ê²€ìƒ‰ìœ¼ë¡œ ì„ íƒí•œ ê²½ìš° í¬í•¨)\n                                  const pairedNumber = getPairedOrderNumber(selectedPONumber);\n                                  if (pairedNumber) {\n                                    return <>{selectedPONumber} <span className=\"text-gray-400\">({pairedNumber})</span></>;\n                                  }\n                                  return selectedPONumber;\n                                })()}\n                                <ChevronDown className=\"w-3 h-3\" />\n                              </button>\n                              {/* OCR ì¶”ì¶œ ë°œì£¼ë²ˆí˜¸ì™€ ë‹¤ë¥´ë©´ ê²½ê³  */}\n                              {commonPONumber && selectedPONumber && commonPONumber !== selectedPONumber && (\n                                <span className=\"text-[9px] text-orange-500\" title=\"OCR ì¶”ì¶œ ë°œì£¼ë²ˆí˜¸ì™€ ë‹¤ë¥¸ ë°œì£¼ê°€ ë§¤ì¹­ë¨\">\n                                  âš ï¸\n                                </span>\n                              )}\n                              {/* ìˆ˜ë™ ê²€ìƒ‰ - ì¸ë¼ì¸ input */}\n                              <div className=\"relative flex items-center\">\n                                {poSearchInputOpen ? (\n                                  <>\n                                    <input\n                                      type=\"text\"\n                                      value={poSearchInput}\n                                      onChange={(e) => {\n                                        setPOSearchInput(e.target.value);\n                                        handlePOSearch(e.target.value);\n                                      }}\n                                      onBlur={() => {\n                                        if (keepPODropdownOpenRef.current) {\n                                          keepPODropdownOpenRef.current = false;\n                                          return;\n                                        }\n                                        setTimeout(() => {\n                                          setPOSearchInputOpen(false);\n                                          setPODropdownOpen(false);\n                                        }, 200);\n                                      }}\n                                      placeholder=\"F... ë˜ëŠ” HS...\"\n                                      className=\"w-[150px] h-5 px-1.5 bg-white border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-hansl-400\"\n                                      style={{ fontSize: '10px', fontWeight: 500 }}\n                                      autoFocus\n                                      onClick={(e) => e.stopPropagation()}\n                                    />\n                                    {poSearchLoading && (\n                                      <Loader2 className=\"absolute right-1 w-3 h-3 animate-spin text-gray-400\" />\n                                    )}\n                                    {/* ì¸ë¼ì¸ ë“œë¡­ë‹¤ìš´ */}\n                                    {poDropdownOpen && poSearchResults.length > 0 && (\n                                      <div className=\"absolute top-full left-0 mt-1 w-[280px] bg-white border border-gray-200 rounded-lg shadow-lg z-50 max-h-[180px] overflow-y-auto\">\n                                        {poSearchResults.map((po) => (\n                                          <div\n                                            key={po.id}\n                                            className=\"w-full px-2 py-1.5 hover:bg-gray-50 border-b border-gray-100 last:border-b-0\"\n                                          >\n                                            <button\n                                              onMouseDown={(e) => e.preventDefault()}\n                                              onClick={(e) => {\n                                                e.stopPropagation();\n                                                keepPODropdownOpenRef.current = false;\n                                                // ê²€ìƒ‰ì–´ì— ë§ëŠ” ë²ˆí˜¸ ì„ íƒ: HSë¡œ ê²€ìƒ‰í–ˆìœ¼ë©´ soNumber, Fë¡œ ê²€ìƒ‰í–ˆìœ¼ë©´ poNumber\n                                                const searchUpper = poSearchInput.trim().toUpperCase();\n                                                let selectedNumber: string;\n                                                if (searchUpper.startsWith('HS') && po.soNumber) {\n                                                  selectedNumber = po.soNumber;\n                                                } else if (searchUpper.startsWith('F') && po.poNumber) {\n                                                  selectedNumber = po.poNumber;\n                                                } else {\n                                                  selectedNumber = po.poNumber || po.soNumber || '';\n                                                }\n                                                setPOSearchInput('');\n                                                setPOSearchInputOpen(false);\n                                                setPODropdownOpen(false);\n                                                // ìˆ˜ë™ ì„ íƒ í”Œë˜ê·¸ ì„¤ì • (ìë™ êµì • ë°©ì§€)\n                                                setManuallySelectedPO(true);\n                                                // ë°œì£¼ë²ˆí˜¸ ì„ íƒ ë° í’ˆëª© ë§¤ì¹­ ì—…ë°ì´íŠ¸ (ê±°ë˜ì²˜ëª…, ìˆ˜ì£¼ë²ˆí˜¸ í¬í•¨)\n                                                handleSelectGlobalPO(selectedNumber, po.vendorName, po.soNumber);\n                                                toast.success(`${selectedNumber} ë°œì£¼ê°€ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤`);\n                                              }}\n                                              className=\"w-full text-left\"\n                                            >\n                                              <div className=\"flex items-center justify-between gap-2\">\n                                                <div className=\"text-[10px] font-medium text-gray-900\">\n                                                  {po.poNumber}\n                                                  {po.soNumber && <span className=\"text-gray-400 ml-1\">({po.soNumber})</span>}\n                                                </div>\n                                                <button\n                                                  type=\"button\"\n                                                  onMouseDown={(e) => {\n                                                    keepPODropdownOpenRef.current = true;\n                                                    e.preventDefault();\n                                                  }}\n                                                  onClick={(e) => {\n                                                    e.stopPropagation();\n                                                    handleOpenPurchaseDetail(po.id);\n                                                  }}\n                                                  className=\"text-[9px] font-medium text-blue-600 hover:text-blue-800\"\n                                                >\n                                                  ìƒì„¸\n                                                </button>\n                                              </div>\n                                            </button>\n                                            {po.vendorName && (\n                                              <div className=\"text-[9px] text-gray-500\">{po.vendorName}</div>\n                                            )}\n                                          </div>\n                                        ))}\n                                      </div>\n                                    )}\n                                  </>\n                                ) : (\n                                  <button\n                                    onClick={(e) => {\n                                      e.stopPropagation();\n                                      setPOSearchInputOpen(true);\n                                    }}\n                                    className=\"inline-flex items-center gap-0.5 px-1 h-5 text-[9px] font-medium text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded\"\n                                    title=\"ë°œì£¼/ìˆ˜ì£¼ë²ˆí˜¸ ì§ì ‘ ê²€ìƒ‰\"\n                                  >\n                                    <Search className=\"w-3 h-3\" />\n                                  </button>\n                                )}\n                              </div>\n                              {/* ë°œì£¼ ìƒì„¸ë³´ê¸° ë²„íŠ¼ */}\n                              {selectedPONumber && (() => {\n                                const selectedCandidate = allPONumberCandidates.find(\n                                  c => c.poNumber === selectedPONumber || c.salesOrderNumber === selectedPONumber\n                                );\n                                const purchaseId = selectedCandidate?.purchaseId || selectedCandidate?.items[0]?.purchase_id;\n                                if (!purchaseId) return null;\n                                return (\n                                  <button\n                                    onClick={(e) => {\n                                      e.stopPropagation();\n                                      handleOpenPurchaseDetail(purchaseId);\n                                    }}\n                                    className=\"inline-flex items-center gap-0.5 px-1 h-5 text-[9px] font-medium text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded\"\n                                    title=\"ë°œì£¼ ìƒì„¸ ë³´ê¸°\"\n                                  >\n                                    <ExternalLink className=\"w-3 h-3\" />\n                                  </button>\n                                );\n                              })()}\n                              {/* ë“œë¡­ë‹¤ìš´ì€ fixed positionìœ¼ë¡œ ëª¨ë‹¬ ë°”ê¹¥ì— ë Œë”ë§ */}\n                            </div>\n                          )}\n                        </div>\n                      </th>\n                      \n                      {/* ì¤‘ì•™: ë§¤ì¹­ ìƒíƒœ (ë¹ˆ ì…€) */}\n                      <th className=\"border-r-2 border-gray-300 p-2 text-center bg-blue-50/30 w-[10%]\">\n                      </th>\n                      \n                      {/* ìš°ì¸¡: OCR ì¶”ì¶œ í’ˆëª© í—¤ë” */}\n                      <th colSpan={isReceiptMode ? (isSamePONumber ? 3 : 4) : (isSamePONumber ? 4 : 5)} className=\"p-2 text-left w-[45%]\">\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"modal-section-title text-gray-700\">\n                            OCR ì¶”ì¶œ í’ˆëª©\n                          </span>\n                          {isSamePONumber && commonPONumber && (\n                            <div className=\"flex items-center gap-1\">\n                              <input\n                                type=\"text\"\n                                value={(() => {\n                                  // í¸ì§‘ëœ ê°’ì´ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ì›ë³¸ ì‚¬ìš©\n                                  const firstItem = statementWithItems?.items[0];\n                                  if (firstItem) {\n                                    return getOCRItemValue(firstItem, 'po_number') as string;\n                                  }\n                                  return commonPONumber;\n                                })()}\n                                onChange={(e) => handleOCRPONumberChange(e.target.value)}\n                                className=\"px-1.5 h-5 bg-white border border-gray-300 text-gray-700 text-[10px] font-medium business-radius focus:outline-none focus:ring-1 focus:ring-gray-400\"\n                                style={{ fontSize: '11px', fontWeight: 500 }}\n                                title=\"OCR ì¶”ì¶œ ë°œì£¼ë²ˆí˜¸ (ìˆ˜ì • ê°€ëŠ¥)\"\n                              />\n                              {(() => {\n                                // í˜„ì¬ ì…ë ¥ëœ ê°’ ê°€ì ¸ì˜¤ê¸°\n                                const firstItem = statementWithItems?.items[0];\n                                const currentValue = firstItem ? (getOCRItemValue(firstItem, 'po_number') as string) : commonPONumber;\n                                const pairedNumber = getPairedOrderNumberWithOverrides(currentValue);\n                                if (pairedNumber) {\n                                  return <span className=\"text-gray-400 text-[10px] font-normal\" style={{ fontSize: '11px' }}>{pairedNumber}</span>;\n                                }\n                                return null;\n                              })()}\n                            </div>\n                          )}\n                          {isSamePONumber && !commonPONumber && (\n                            <div className=\"flex items-center gap-1\">\n                              <input\n                                type=\"text\"\n                                placeholder=\"ë°œì£¼/ìˆ˜ì£¼ë²ˆí˜¸ ì…ë ¥\"\n                                onChange={(e) => handleOCRPONumberChange(e.target.value)}\n                                className=\"px-1.5 h-5 bg-white border border-gray-300 text-gray-700 text-[10px] font-medium business-radius focus:outline-none focus:ring-1 focus:ring-gray-400\"\n                                style={{ fontSize: '11px', fontWeight: 500 }}\n                                title=\"ë°œì£¼ë²ˆí˜¸ ì§ì ‘ ì…ë ¥\"\n                              />\n                              {(() => {\n                                const firstItem = statementWithItems?.items[0];\n                                const currentValue = firstItem\n                                  ? (getOCRItemValue(firstItem, 'po_number') as string)\n                                  : '';\n                                const pairedNumber = getPairedOrderNumberWithOverrides(currentValue);\n                                if (!pairedNumber) return null;\n                                return (\n                                  <span className=\"text-gray-400 text-[10px] font-normal\" style={{ fontSize: '11px' }}>\n                                    {pairedNumber}\n                                  </span>\n                                );\n                              })()}\n                            </div>\n                          )}\n                        </div>\n                      </th>\n                    </tr>\n                    <tr className=\"modal-label\">\n                      {/* ì¢Œì¸¡ ì»¬ëŸ¼ */}\n                      {!isSamePONumber && (\n                        <th className=\"p-1 text-left whitespace-nowrap modal-label\">ë°œì£¼/ìˆ˜ì£¼ë²ˆí˜¸</th>\n                      )}\n                      <th className=\"p-1 text-left modal-label\">í’ˆëª©ëª…</th>\n                      <th className=\"p-1 text-right modal-label\">ìˆ˜ëŸ‰</th>\n                      {/* ì…ê³ ìˆ˜ëŸ‰ ëª¨ë“œì—ì„œëŠ” ë‹¨ê°€/í•©ê³„ ìˆ¨ê¹€ */}\n                      {!isReceiptMode && (\n                        <>\n                          <th className=\"p-1 text-right modal-label\">ë‹¨ê°€</th>\n                          <th className=\"border-r-2 border-gray-300 p-1 text-right modal-label\">í•©ê³„</th>\n                        </>\n                      )}\n                      {isReceiptMode && (\n                        <th className=\"border-r-2 border-gray-300 p-1\"></th>\n                      )}\n                      \n                      {/* ì¤‘ì•™ */}\n                      <th className=\"border-r-2 border-gray-300 p-1 text-center bg-blue-50/30\">\n                        <span className=\"text-gray-400 text-sm\">â‡„</span>\n                      </th>\n                      \n                      {/* ìš°ì¸¡ ì»¬ëŸ¼ */}\n                      <th className=\"p-1 text-left whitespace-nowrap modal-label\">í’ˆëª©ëª…</th>\n                      <th className=\"p-1 text-right whitespace-nowrap w-16 modal-label\">ìˆ˜ëŸ‰</th>\n                      {/* ì…ê³ ìˆ˜ëŸ‰ ëª¨ë“œì—ì„œëŠ” ë‹¨ê°€/í•©ê³„ ìˆ¨ê¹€ */}\n                      {!isReceiptMode && (\n                        <>\n                          <th className=\"p-1 text-right whitespace-nowrap w-20 modal-label\">ë‹¨ê°€</th>\n                          <th className=\"p-1 text-right whitespace-nowrap w-24 modal-label\">í•©ê³„</th>\n                        </>\n                      )}\n                      {isReceiptMode && (\n                        <th className=\"p-1\"></th>\n                      )}\n                      {!isSamePONumber && (\n                        <th className=\"p-1 text-left whitespace-nowrap modal-label\">ë°œì£¼/ìˆ˜ì£¼ë²ˆí˜¸</th>\n                      )}\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {statementWithItems.items.map((ocrItem, rowIndex) => {\n                      const getDisplayPOForItem = (item: TransactionStatementItemWithMatch) => {\n                        const normalizedExtracted = item.extracted_po_number\n                          ? normalizeOrderNumber(item.extracted_po_number)\n                          : undefined;\n                        const candidates = getPOCandidatesForItem(item.id);\n                        const candidateSet = new Set(candidates.map(candidate => normalizeOrderNumber(candidate)));\n                        const selected = itemPONumbers.get(item.id);\n                        const normalizedSelected = selected ? normalizeOrderNumber(selected) : '';\n                        const extractedInDb = normalizedExtracted && candidateSet.has(normalizedExtracted)\n                          ? normalizedExtracted\n                          : '';\n                        if (normalizedSelected && candidateSet.has(normalizedSelected)) return normalizedSelected;\n                        if (extractedInDb) return extractedInDb;\n                        // ì›”ë§ê²°ì œ ë“±: í›„ë³´ì— ì—†ì–´ë„ ë§¤ì¹­ëœ ë°œì£¼ë²ˆí˜¸ê°€ ìˆìœ¼ë©´ ê·¸ëŒ€ë¡œ í‘œì‹œ\n                        if (normalizedSelected) return normalizedSelected;\n                        return '';\n                      };\n                      const matchedSystem = itemMatches.get(ocrItem.id);\n                      const matchStatus = getMatchStatus(ocrItem);\n                      // OCR ì¶”ì¶œ ë²ˆí˜¸ë¥¼ ì‹œìŠ¤í…œ í˜•ì‹ìœ¼ë¡œ ì •ê·œí™” (ì˜ˆ: _01 â†’ _001, -1 â†’ -01)\n                      const normalizedExtractedPO = ocrItem.extracted_po_number \n                        ? normalizeOrderNumber(ocrItem.extracted_po_number) \n                        : undefined;\n                      const poCandidates = getPOCandidatesForItem(ocrItem.id);\n                      const normalizedCandidates = poCandidates.map(candidate => normalizeOrderNumber(candidate));\n                      const candidateSet = new Set(normalizedCandidates);\n                      const selectedPO = itemPONumbers.get(ocrItem.id);\n                      const normalizedSelectedPO = selectedPO ? normalizeOrderNumber(selectedPO) : '';\n                      const extractedInDb = normalizedExtractedPO && candidateSet.has(normalizedExtractedPO)\n                        ? normalizedExtractedPO\n                        : '';\n                      const itemPO = normalizedSelectedPO && candidateSet.has(normalizedSelectedPO)\n                        ? normalizedSelectedPO\n                        : extractedInDb || (normalizedSelectedPO || '');\n                      if (rowIndex < 5) {\n                      }\n                      // ë§¤ì¹­ëœ ë°œì£¼ë²ˆí˜¸ë¥¼ ë§¨ ì•ì— ì¶”ê°€ (ì¶”ì²œ í‘œì‹œìš©)\n                      const matchedPONumber = matchedSystem?.purchase_order_number || matchedSystem?.sales_order_number || '';\n                      const rawOrderedPOs = Array.from(new Set(poCandidates));\n                      const orderedPOs = matchedPONumber && !rawOrderedPOs.includes(matchedPONumber)\n                        ? [matchedPONumber, ...rawOrderedPOs]\n                        : matchedPONumber\n                          ? [matchedPONumber, ...rawOrderedPOs.filter(po => po !== matchedPONumber)]\n                          : rawOrderedPOs;\n                      const nextItem = statementWithItems.items[rowIndex + 1];\n                      const nextItemPO = nextItem ? getDisplayPOForItem(nextItem) : '';\n                      const isGroupEnd = rowIndex < statementWithItems.items.length - 1 && itemPO !== nextItemPO;\n                      const rowClassName = isGroupEnd\n                        ? 'hover:bg-gray-50 border-b-2 border-gray-500'\n                        : 'hover:bg-gray-50';\n                      const itemSearchValue = itemPOSearchInputs[ocrItem.id] || '';\n                      const itemSearchResults = itemPOSearchResults[ocrItem.id] || [];\n                      const itemSearchLoading = itemPOSearchLoading[ocrItem.id] || false;\n                      const activePONumber = isSamePONumber ? selectedPONumber : (itemPO || '');\n                      const systemCandidates = getSystemItemsForPO(activePONumber);\n                      const fallbackCandidates = systemCandidates.length === 0 && activePONumber\n                        ? (ocrItem.match_candidates || [])\n                          .filter(candidate =>\n                            candidate.purchase_order_number === activePONumber ||\n                            candidate.sales_order_number === activePONumber\n                          )\n                          .map((candidate): SystemPurchaseItem => ({\n                            purchase_id: candidate.purchase_id,\n                            item_id: candidate.item_id,\n                            purchase_order_number: candidate.purchase_order_number || '',\n                            sales_order_number: candidate.sales_order_number,\n                            item_name: candidate.item_name || 'í’ˆëª©ëª… ì—†ìŒ',\n                            specification: candidate.specification,\n                            quantity: candidate.quantity,\n                            received_quantity: candidate.received_quantity,\n                            unit_price: candidate.unit_price,\n                            amount: (candidate as any).amount,\n                            vendor_name: candidate.vendor_name\n                          }))\n                        : [];\n                      // ë§¤ì¹­ëœ ì‹œìŠ¤í…œ í’ˆëª©ì´ ìˆìœ¼ë©´ í›„ë³´ì— ì¶”ê°€ (ì›”ë§ê²°ì œ ë“±ì—ì„œ í›„ë³´ê°€ ë¹„ì–´ìˆì–´ë„ í‘œì‹œ)\n                      let displaySystemCandidates = systemCandidates.length > 0 ? systemCandidates : fallbackCandidates;\n                      if (displaySystemCandidates.length === 0 && matchedSystem) {\n                        displaySystemCandidates = [matchedSystem];\n                      }\n                      const scoredSystemCandidates = displaySystemCandidates\n                        .map((candidate) => ({\n                          candidate,\n                          score: calculateItemSimilarity(ocrItem.extracted_item_name || '', candidate.item_name, candidate.specification)\n                        }))\n                        .sort((a, b) => b.score - a.score);\n                      if (rowIndex === 0) {\n                        const logKey = `${ocrItem.id}|${isSamePONumber ? 'same' : 'multi'}|${activePONumber}|${systemCandidates.length}`;\n                        if (systemCandidateLogKeyRef.current !== logKey) {\n                          systemCandidateLogKeyRef.current = logKey;\n                          const firstCandidate = systemCandidates[0];\n                          if (firstCandidate) {\n                          }\n                        }\n                      }\n                      \n                      // ë°œì£¼/ìˆ˜ì£¼ ë²ˆí˜¸ ì¼ì¹˜ ì—¬ë¶€ ê³„ì‚° (ì²« í–‰ì—ì„œë§Œ ì‚¬ìš©)\n                      const normalizedSelectedPONumber = selectedPONumber\n                        ? normalizeOrderNumber(selectedPONumber)\n                        : '';\n                      const pairedOrderNumber = selectedPONumber\n                        ? getPairedOrderNumber(selectedPONumber)\n                        : undefined;\n                      const normalizedPairedOrderNumber = pairedOrderNumber\n                        ? normalizeOrderNumber(pairedOrderNumber)\n                        : '';\n                      const totalItemCount = statementWithItems.items.length;\n                      const extractedOrderNumbers = statementWithItems.items\n                        .map(item => getOCRItemValue(item, 'po_number') as string)\n                        .filter(Boolean)\n                        .map(value => normalizeOrderNumber(value));\n                      const hasOrderNumberMatch =\n                        !!normalizedSelectedPONumber &&\n                        extractedOrderNumbers.some(\n                          value =>\n                            value === normalizedSelectedPONumber ||\n                            (normalizedPairedOrderNumber && value === normalizedPairedOrderNumber)\n                        );\n                      const isFirstRow = rowIndex === 0;\n                      \n                      return (\n                        <tr key={ocrItem.id} className={rowClassName}>\n                          {/* Case 2: ë°œì£¼ë²ˆí˜¸ ì»¬ëŸ¼ */}\n                          {!isSamePONumber && (\n                            <td className=\"p-1 whitespace-nowrap\">\n                              <div className=\"relative\">\n                                <button\n                                  onClick={(e) => toggleDropdown(`po-${ocrItem.id}`, e)}\n                                  className=\"inline-flex items-center gap-1 px-1.5 h-5 text-[10px] font-medium bg-white border border-gray-300 business-radius hover:bg-gray-50 text-gray-700 whitespace-nowrap\"\n                                  style={{ fontSize: '11px' }}\n                                >\n                                  <span>{itemPO || 'ì„ íƒ'}</span>\n                                  <ChevronDown className=\"w-3 h-3 flex-shrink-0\" />\n                                </button>\n                                {openDropdowns.has(`po-${ocrItem.id}`) && createPortal(\n                                  <>\n                                    <div\n                                      className=\"fixed inset-0 z-[110]\"\n                                      onClick={() => toggleDropdown(`po-${ocrItem.id}`)}\n                                    />\n                                    <div\n                                      className=\"fixed z-[111] bg-white border border-gray-200 rounded-lg shadow-xl w-[280px] max-h-[360px] overflow-y-auto\"\n                                      style={{\n                                        top: dropdownPosition.top,\n                                        left: dropdownPosition.left\n                                      }}\n                                      onClick={(e) => e.stopPropagation()}\n                                    >\n                                      <div className=\"p-2 border-b border-gray-100\">\n                                        <div className=\"relative\">\n                                          <input\n                                            type=\"text\"\n                                            value={itemSearchValue}\n                                            onChange={(e) => handleItemPOSearch(ocrItem.id, e.target.value)}\n                                            placeholder=\"ë°œì£¼/ìˆ˜ì£¼ë²ˆí˜¸ ê²€ìƒ‰...\"\n                                            className=\"w-full h-6 px-2 pr-6 text-[10px] bg-white border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-hansl-400\"\n                                          />\n                                          {itemSearchLoading && (\n                                            <Loader2 className=\"absolute right-2 top-1/2 -translate-y-1/2 w-3 h-3 animate-spin text-gray-400\" />\n                                          )}\n                                        </div>\n                                      </div>\n                                      {itemSearchValue && itemSearchResults.length > 0 && (\n                                        <div className=\"border-b border-gray-100\">\n                                          {itemSearchResults.map((po) => {\n                                            const searchUpper = itemSearchValue.trim().toUpperCase();\n                                            let selectedNumber: string;\n                                            if (searchUpper.startsWith('HS') && po.soNumber) {\n                                              selectedNumber = po.soNumber;\n                                            } else if (searchUpper.startsWith('F') && po.poNumber) {\n                                              selectedNumber = po.poNumber;\n                                            } else {\n                                              selectedNumber = po.poNumber || po.soNumber || '';\n                                            }\n                                            return (\n                                              <div\n                                                key={po.id}\n                                                className=\"px-2 py-1.5 hover:bg-gray-50 cursor-pointer text-[11px]\"\n                                                onClick={() => handleSelectItemPO(ocrItem.id, selectedNumber)}\n                                              >\n                                                <div className=\"flex items-center justify-between gap-2\">\n                                                  <div className=\"font-medium text-gray-900\">\n                                                    {po.poNumber}\n                                                    {po.soNumber && <span className=\"text-gray-400 ml-1\">({po.soNumber})</span>}\n                                                  </div>\n                                                  <button\n                                                    type=\"button\"\n                                                    onMouseDown={(e) => e.preventDefault()}\n                                                    onClick={(e) => {\n                                                      e.stopPropagation();\n                                                      handleOpenPurchaseDetail(po.id);\n                                                    }}\n                                                    className=\"text-[9px] font-medium text-blue-600 hover:text-blue-800\"\n                                                  >\n                                                    ìƒì„¸\n                                                  </button>\n                                                </div>\n                                                {po.vendorName && (\n                                                  <div className=\"text-[9px] text-gray-500\">{po.vendorName}</div>\n                                                )}\n                                              </div>\n                                            );\n                                          })}\n                                        </div>\n                                      )}\n                                      {orderedPOs.length > 0 && (\n                                        <div>\n                                          {orderedPOs.map((po, idx) => {\n                                            const paired = getPairedOrderNumber(po);\n                                            const purchaseId = getPurchaseIdByNumber(po);\n                                            const isPreferred = po === itemPO;\n                                            const isRecommended = po === matchedPONumber;\n                                            return (\n                                              <div\n                                                key={`${po}-${idx}`}\n                                                onClick={() => handleSelectItemPO(ocrItem.id, po)}\n                                                className={`px-2 py-1.5 hover:bg-gray-100 cursor-pointer text-[11px] font-medium ${isPreferred ? 'bg-blue-50 text-blue-900 font-semibold' : isRecommended ? 'bg-green-50 text-green-900' : 'text-gray-700'}`}\n                                                style={{ fontSize: '11px' }}\n                                              >\n                                                <div className=\"flex items-center justify-between gap-2\">\n                                                  <div>\n                                                    {po}\n                                                    {paired && <span className=\"text-gray-400 ml-1\">({paired})</span>}\n                                                    {isRecommended && <span className=\"text-green-600 ml-1 text-[9px] font-bold\">ì¶”ì²œ</span>}\n                                                  </div>\n                                                  {purchaseId && (\n                                                    <button\n                                                      type=\"button\"\n                                                      onMouseDown={(e) => e.preventDefault()}\n                                                      onClick={(e) => {\n                                                        e.stopPropagation();\n                                                        handleOpenPurchaseDetail(purchaseId);\n                                                      }}\n                                                      className=\"text-[9px] font-medium text-blue-600 hover:text-blue-800\"\n                                                    >\n                                                      ìƒì„¸\n                                                    </button>\n                                                  )}\n                                                </div>\n                                              </div>\n                                            );\n                                          })}\n                                        </div>\n                                      )}\n                                    </div>\n                                  </>,\n                                  document.body\n                                )}\n                              </div>\n                            </td>\n                          )}\n                          \n                          {/* ì¢Œì¸¡: ì‹œìŠ¤í…œ í’ˆëª© */}\n                          <td className=\"p-1\">\n                            {displaySystemCandidates.length > 0 ? (\n                              <div className=\"relative\">\n                                <div className=\"flex items-center gap-1\">\n                                  <button\n                                    onClick={(e) => {\n                                      toggleDropdown(`item-${ocrItem.id}`, e);\n                                    }}\n                                    className=\"inline-flex items-center gap-1 px-1.5 h-5 text-[10px] font-normal bg-white border border-gray-300 business-radius hover:bg-gray-50 text-gray-700 whitespace-nowrap\"\n                                    style={{ fontSize: '11px' }}\n                                  >\n                                    <span>{getSystemItemLabel(matchedSystem) || 'ì„ íƒ'}</span>\n                                    <ChevronDown className=\"w-3 h-3 flex-shrink-0\" />\n                                  </button>\n                                  {matchedSystem && (\n                                    <button\n                                      onClick={() => handleSelectSystemItem(ocrItem.id, null)}\n                                      className=\"text-gray-400 hover:text-red-500 flex-shrink-0\"\n                                      title=\"ë§¤ì¹­ í•´ì œ\"\n                                    >\n                                      <XCircle className=\"w-3 h-3\" />\n                                    </button>\n                                  )}\n                                </div>\n                                {openDropdowns.has(`item-${ocrItem.id}`) && createPortal(\n                                  <>\n                                    <div\n                                      className=\"fixed inset-0 z-[110]\"\n                                      onClick={() => toggleDropdown(`item-${ocrItem.id}`)}\n                                    />\n                                    <div\n                                      className=\"fixed z-[111] bg-white border border-gray-200 rounded-lg shadow-xl w-[280px] max-h-[360px] overflow-y-auto\"\n                                      style={{\n                                        top: dropdownPosition.top,\n                                        left: dropdownPosition.left\n                                      }}\n                                      onClick={(e) => e.stopPropagation()}\n                                    >\n                                      {scoredSystemCandidates.map(({ candidate, score }, cidx) => {\n                                        return (\n                                          <div\n                                            key={cidx}\n                                            onClick={() => {\n                                              handleSelectSystemItem(ocrItem.id, candidate);\n                                            }}\n                                            className=\"px-2 py-1.5 hover:bg-gray-100 cursor-pointer\"\n                                          >\n                                            <div className=\"flex items-center justify-between\">\n                                              <p className=\"text-[11px] font-normal text-gray-900\" style={{ fontSize: '11px' }}>{getSystemItemLabel(candidate)}</p>\n                                              <span className={`text-[10px] px-1.5 py-0.5 rounded ${\n                                                score >= 80 ? 'bg-green-100 text-green-700' :\n                                                score >= 50 ? 'bg-yellow-100 text-yellow-700' :\n                                                'bg-gray-100 text-gray-600'\n                                              }`}>\n                                                {Math.round(score)}%\n                                              </span>\n                                            </div>\n                                            <p className=\"text-[10px] text-gray-500\">\n                                              ìš”ì²­/ì‹¤ì œ: {candidate.quantity ?? '-'} / {candidate.received_quantity ?? '-'}\n                                            </p>\n                                          </div>\n                                        );\n                                      })}\n                                    </div>\n                                  </>,\n                                  document.body\n                                )}\n                              </div>\n                            ) : (\n                              <span className=\"text-[11px] text-gray-400\" style={{ fontSize: '11px' }}>í›„ë³´ ì—†ìŒ</span>\n                            )}\n                          </td>\n                          <td className=\"p-1 text-right\">\n                            <span className=\"text-[11px] text-gray-700\" style={{ fontSize: '11px' }}>\n                              {matchedSystem?.quantity ?? '-'} / {matchedSystem?.received_quantity ?? '-'}\n                            </span>\n                          </td>\n                          {/* ì…ê³ ìˆ˜ëŸ‰ ëª¨ë“œì—ì„œëŠ” ë‹¨ê°€/í•©ê³„ ìˆ¨ê¹€ */}\n                          {!isReceiptMode && (\n                            <>\n                              <td className=\"p-1 text-right\">\n                                <span className=\"text-[11px] text-gray-700\" style={{ fontSize: '11px' }}>{matchedSystem ? formatAmount(matchedSystem.unit_price) : '-'}</span>\n                              </td>\n                              <td className=\"border-r-2 border-gray-300 p-1 text-right\">\n                                <span className=\"text-[11px] font-bold text-gray-900\" style={{ fontSize: '11px', fontWeight: 700 }}>{matchedSystem ? formatAmount(getSystemAmount(matchedSystem) ?? undefined) : '-'}</span>\n                              </td>\n                            </>\n                          )}\n                          {isReceiptMode && (\n                            <td className=\"border-r-2 border-gray-300 p-1\"></td>\n                          )}\n                          \n                          {/* ì¤‘ì•™: ë°œì£¼/ìˆ˜ì£¼ ë²ˆí˜¸ ì¼ì¹˜ ìƒíƒœ (ì²« í–‰ì—ë§Œ rowSpanìœ¼ë¡œ ì„¸ë¡œ ì¤‘ì•™ í‘œì‹œ) */}\n                          {isFirstRow && (\n                            <td \n                              className=\"border-r-2 border-gray-300 px-2 py-1 text-center bg-blue-50/30 cursor-pointer hover:bg-blue-100/50 transition-colors\"\n                              rowSpan={totalItemCount}\n                              style={{ verticalAlign: 'middle' }}\n                              onClick={() => setIsIntegratedMatchDetailOpen(true)}\n                              title=\"í´ë¦­í•˜ì—¬ ìƒì„¸ ë‚´ì—­ ë³´ê¸°\"\n                            >\n                              <div className=\"flex flex-col items-center justify-center\">\n                                <span className={`text-[11px] font-bold ${\n                                  hasOrderNumberMatch ? 'text-green-600' : 'text-gray-500'\n                                }`}>\n                                  {hasOrderNumberMatch ? 'ë°œì£¼/ìˆ˜ì£¼ ë²ˆí˜¸ ì¼ì¹˜' : 'ë°œì£¼/ìˆ˜ì£¼ ë²ˆí˜¸ ë¶ˆì¼ì¹˜'}\n                                </span>\n                                <span className=\"text-[8px] text-blue-500 underline mt-0.5\">\n                                  ìƒì„¸ë³´ê¸°\n                                </span>\n                              </div>\n                            </td>\n                          )}\n                          \n                          {/* ìš°ì¸¡: OCR í’ˆëª© (í¸ì§‘ ê°€ëŠ¥) */}\n                          <td className=\"p-1 whitespace-nowrap\">\n                            <input\n                              type=\"text\"\n                              value={getOCRItemValue(ocrItem, 'item_name') as string}\n                              onChange={(e) => handleEditOCRItem(ocrItem.id, 'item_name', e.target.value)}\n                              className={`min-w-[180px] w-auto px-1 h-5 !text-[10px] !font-medium text-gray-900 border business-radius focus:outline-none focus:ring-1 focus:ring-blue-400 ${\n                                isOCRItemEdited(ocrItem, 'item_name') \n                                  ? 'border-orange-400 bg-orange-50' \n                                  : 'border-gray-200 bg-white'\n                              }`}\n                              style={{ fontSize: '11px', fontWeight: 500, width: `${Math.max(180, (getOCRItemValue(ocrItem, 'item_name') as string).length * 8)}px` }}\n                              title={isOCRItemEdited(ocrItem, 'item_name') ? `ì›ë³¸: ${ocrItem.extracted_item_name}` : undefined}\n                            />\n                          </td>\n                          <td className=\"p-1 text-right w-16\">\n                            <input\n                              type=\"number\"\n                              value={getOCRItemValue(ocrItem, 'quantity') as number}\n                              onChange={(e) => handleEditOCRItem(ocrItem.id, 'quantity', e.target.value ? Number(e.target.value) : 0)}\n                              className={`w-14 px-1 h-5 !text-[10px] !font-medium text-gray-900 text-right border business-radius focus:outline-none focus:ring-1 focus:ring-blue-400 ${\n                                isOCRItemEdited(ocrItem, 'quantity') \n                                  ? 'border-orange-400 bg-orange-50' \n                                  : 'border-gray-200 bg-white'\n                              }`}\n                              style={{ fontSize: '11px', fontWeight: 500 }}\n                              title={isOCRItemEdited(ocrItem, 'quantity') ? `ì›ë³¸: ${ocrItem.extracted_quantity}` : undefined}\n                            />\n                          </td>\n                          {/* ì…ê³ ìˆ˜ëŸ‰ ëª¨ë“œì—ì„œëŠ” ë‹¨ê°€/í•©ê³„ ì…€ ìˆ¨ê¹€ */}\n                          {!isReceiptMode && (\n                            <>\n                              <td className=\"p-1 text-right w-20\">\n                                <input\n                                  type=\"number\"\n                                  value={getOCRItemValue(ocrItem, 'unit_price') as number}\n                                  onChange={(e) => handleEditOCRItem(ocrItem.id, 'unit_price', e.target.value ? Number(e.target.value) : 0)}\n                                  className={`w-16 px-1 h-5 !text-[10px] !font-medium text-gray-900 text-right border business-radius focus:outline-none focus:ring-1 focus:ring-blue-400 ${\n                                    isOCRItemEdited(ocrItem, 'unit_price') \n                                      ? 'border-orange-400 bg-orange-50' \n                                      : 'border-gray-200 bg-white'\n                                  }`}\n                                  style={{ fontSize: '11px', fontWeight: 500 }}\n                                  title={isOCRItemEdited(ocrItem, 'unit_price') ? `ì›ë³¸: ${ocrItem.extracted_unit_price}` : undefined}\n                                />\n                              </td>\n                              <td className=\"p-1 text-right w-24\">\n                                <input\n                                  type=\"number\"\n                                  value={getOCRItemValue(ocrItem, 'amount') as number}\n                                  onChange={(e) => handleEditOCRItem(ocrItem.id, 'amount', e.target.value ? Number(e.target.value) : 0)}\n                                  className={`w-20 px-1 h-5 !text-[10px] !font-bold text-gray-900 text-right border business-radius focus:outline-none focus:ring-1 focus:ring-blue-400 ${\n                                    isOCRItemEdited(ocrItem, 'amount') \n                                      ? 'border-orange-400 bg-orange-50' \n                                      : 'border-gray-200 bg-white'\n                                  }`}\n                                  style={{ fontSize: '11px', fontWeight: 700 }}\n                                  title={isOCRItemEdited(ocrItem, 'amount') ? `ì›ë³¸: ${ocrItem.extracted_amount}` : undefined}\n                                />\n                              </td>\n                            </>\n                          )}\n                          {isReceiptMode && (\n                            <td className=\"p-1\"></td>\n                          )}\n                          \n                          {/* Case 2: OCR ë°œì£¼ë²ˆí˜¸ í‘œì‹œ (í¸ì§‘ ê°€ëŠ¥) */}\n                          {!isSamePONumber && (\n                            <td className=\"p-1 whitespace-nowrap\">\n                              <div className=\"flex items-center gap-1\">\n                                <input\n                                  type=\"text\"\n                                  value={getOCRItemValue(ocrItem, 'po_number') as string}\n                                  onChange={(e) => {\n                                    const newValue = e.target.value;\n                                    lookupPairedOrderNumber(newValue);\n                                    handleEditOCRItem(ocrItem.id, 'po_number', newValue);\n                                  }}\n                                  className={`px-1.5 h-5 text-[10px] font-medium bg-white border business-radius focus:outline-none focus:ring-1 focus:ring-gray-400 text-gray-700 ${\n                                    isOCRItemEdited(ocrItem, 'po_number') \n                                      ? 'border-orange-400 bg-orange-50' \n                                      : 'border-gray-300'\n                                  }`}\n                                  style={{ fontSize: '11px', fontWeight: 500 }}\n                                  title={isOCRItemEdited(ocrItem, 'po_number') ? `ì›ë³¸: ${ocrItem.extracted_po_number}` : undefined}\n                                />\n                                {(() => {\n                                  const currentValue = getOCRItemValue(ocrItem, 'po_number') as string;\n                                  const pairedNumber = getPairedOrderNumberWithOverrides(currentValue);\n                                  if (!pairedNumber) return null;\n                                  return (\n                                    <span className=\"text-gray-400 text-[10px] font-normal\" style={{ fontSize: '11px' }}>\n                                      {pairedNumber}\n                                    </span>\n                                  );\n                                })()}\n                              </div>\n                            </td>\n                          )}\n                        </tr>\n                      );\n                    })}\n                    \n                    {/* í•©ê³„ í–‰ - ì…ê³ ìˆ˜ëŸ‰ ëª¨ë“œì—ì„œëŠ” ìˆ¨ê¹€ */}\n                    {!isReceiptMode && (\n                      <tr className=\"bg-gray-50 font-medium border-t border-gray-100\">\n                        <td colSpan={isSamePONumber ? 3 : 4} className=\"p-1 text-right text-gray-600\">\n                          ì‹œìŠ¤í…œ í•©ê³„\n                        </td>\n                        <td className=\"border-r-2 border-gray-300 p-1 text-right text-gray-900\">\n                        {`${getTotalsCurrencySymbol()}${formatAmount(\n                          Array.from(itemMatches.values())\n                            .filter(Boolean)\n                            .reduce((sum, item) => sum + (getSystemAmount(item) || 0), 0)\n                        )}`}\n                        </td>\n                        <td className=\"border-r-2 border-gray-300 p-1 bg-blue-50/50\"></td>\n                        <td colSpan={isSamePONumber ? 3 : 4} className=\"p-1 text-right text-gray-600\">\n                          OCR í•©ê³„\n                          {editedOCRItems.size > 0 && (\n                            <span className=\"ml-1 text-[9px] text-orange-600\">(ìˆ˜ì •ë¨)</span>\n                          )}\n                        </td>\n                        <td className=\"p-1 text-right text-gray-900\">\n                        {`${getTotalsCurrencySymbol()}${formatAmount(\n                          statementWithItems.items.reduce((sum, item) => {\n                            const edited = editedOCRItems.get(item.id);\n                            const amount = edited?.amount !== undefined ? edited.amount : (item.extracted_amount || 0);\n                            return sum + amount;\n                          }, 0)\n                        )}`}\n                        </td>\n                        {!isSamePONumber && <td className=\"p-1\"></td>}\n                      </tr>\n                    )}\n                  </tbody>\n                </table>\n              </div>\n            </div>\n          ) : (\n            <div className=\"text-center py-12\">\n              <p className=\"modal-subtitle\">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>\n            </div>\n          )}\n\n          <DialogFooter className=\"border-t border-gray-100 pt-3 px-4 gap-2\">\n            <Button\n              variant=\"outline\"\n              onClick={handleReject}\n              disabled={saving}\n              className=\"button-base h-8 text-[11px] text-red-500 border-red-200 hover:bg-red-50\"\n            >\n              <XCircle className=\"w-3.5 h-3.5 mr-1\" />\n              ê±°ë¶€\n            </Button>\n            <Button\n              variant=\"outline\"\n              onClick={onClose}\n              disabled={saving}\n              className=\"button-base h-8 text-[11px]\"\n            >\n              ë‹«ê¸°\n            </Button>\n            <Button\n              onClick={handleQuantityMatch}\n              disabled={isQuantityMatchDisabled}\n              className={`button-base h-8 text-[11px] ${\n                isQuantityMatchDisabled\n                  ? 'border border-gray-300 bg-white text-gray-400'\n                  : 'bg-hansl-600 hover:bg-hansl-700 text-white'\n              }`}\n            >\n              {savingAction === 'quantity-match' ? (\n                <>\n                  <Loader2 className=\"w-3.5 h-3.5 mr-1 animate-spin\" />\n                  ì²˜ë¦¬ ì¤‘...\n                </>\n              ) : (\n                <>\n                  <CheckCircle className=\"w-3.5 h-3.5 mr-1\" />\n                  {quantityMatchButtonLabel}\n                </>\n              )}\n            </Button>\n            {/* ì…ê³ ìˆ˜ëŸ‰ ëª¨ë“œì—ì„œëŠ” í™•ì • ë²„íŠ¼ ìˆ¨ê¹€ (lead_buyer ìŠ¹ì¸ ë¶ˆí•„ìš”) */}\n            {!isReceiptMode && (\n              <Button\n                onClick={handleConfirm}\n                disabled={isConfirmDisabled}\n                className={`button-base h-8 text-[11px] ${\n                  isConfirmDisabled\n                    ? 'border border-gray-300 bg-white text-gray-400'\n                    : 'bg-hansl-600 hover:bg-hansl-700 text-white'\n                }`}\n              >\n                {savingAction === 'confirm' ? (\n                  <>\n                    <Loader2 className=\"w-3.5 h-3.5 mr-1 animate-spin\" />\n                    ì²˜ë¦¬ ì¤‘...\n                  </>\n                ) : (\n                  <>\n                    <CheckCircle className=\"w-3.5 h-3.5 mr-1\" />\n                    {confirmButtonLabel}\n                  </>\n                )}\n              </Button>\n            )}\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* ë§¤ì¹­ ìƒì„¸ ì •ë³´ íŒì—… */}\n      {matchDetailPopup && (\n        <Dialog open={matchDetailPopup.isOpen} onOpenChange={() => setMatchDetailPopup(null)}>\n          <DialogContent className=\"max-w-md\">\n            <DialogHeader>\n              <DialogTitle className=\"text-[14px] font-semibold text-gray-800\">\n                ë§¤ì¹­ ìƒì„¸ ì •ë³´\n              </DialogTitle>\n            </DialogHeader>\n            \n            <div className=\"space-y-4 py-2\">\n              {/* ë§¤ì¹­ ìƒíƒœ ë±ƒì§€ */}\n              <div className=\"flex items-center justify-center\">\n                {renderMatchStatusBadge(matchDetailPopup.status)}\n                <span className=\"ml-2 text-[12px] text-gray-600\">\n                  ìœ ì‚¬ë„: {matchDetailPopup.similarity.toFixed(1)}%\n                </span>\n              </div>\n              \n              {/* ë¹„êµ í…Œì´ë¸” */}\n              <div className=\"bg-gray-50 rounded-lg p-3 space-y-2\">\n                <div className=\"flex items-start gap-2\">\n                  <span className=\"text-[11px] font-medium text-gray-500 w-20 shrink-0\">OCR í’ˆëª©:</span>\n                  <span className=\"text-[11px] text-gray-800 break-all\">{matchDetailPopup.ocrItemName}</span>\n                </div>\n                <div className=\"flex items-start gap-2\">\n                  <span className=\"text-[11px] font-medium text-gray-500 w-20 shrink-0\">ì‹œìŠ¤í…œ í’ˆëª©:</span>\n                  <span className=\"text-[11px] text-gray-800 break-all\">{matchDetailPopup.systemItemName}</span>\n                </div>\n                {matchDetailPopup.systemSpec && matchDetailPopup.systemSpec !== '-' && (\n                  <div className=\"flex items-start gap-2\">\n                    <span className=\"text-[11px] font-medium text-gray-500 w-20 shrink-0\">ì‹œìŠ¤í…œ ê·œê²©:</span>\n                    <span className=\"text-[11px] text-gray-800 break-all\">{matchDetailPopup.systemSpec}</span>\n                  </div>\n                )}\n              </div>\n              \n              {/* ë§¤ì¹­ ì´ìœ  */}\n              <div className=\"space-y-1\">\n                <span className=\"text-[11px] font-medium text-gray-600\">ë§¤ì¹­ íŒì • ì´ìœ :</span>\n                <ul className=\"space-y-1\">\n                  {matchDetailPopup.reasons.map((reason, idx) => (\n                    <li key={idx} className=\"text-[11px] text-gray-700 pl-2\">\n                      {reason}\n                    </li>\n                  ))}\n                </ul>\n              </div>\n            </div>\n            \n            <DialogFooter>\n              <Button \n                variant=\"outline\" \n                size=\"sm\" \n                onClick={() => setMatchDetailPopup(null)}\n                className=\"text-[11px]\"\n              >\n                ë‹«ê¸°\n              </Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n      )}\n\n      {/* í†µí•© ë§¤ì¹­ ìƒì„¸ íŒì—… (ë°œì£¼ë²ˆí˜¸ ì „ì²´ ë§¤ì¹­ ë‚´ì—­) */}\n      <Dialog open={isIntegratedMatchDetailOpen} onOpenChange={setIsIntegratedMatchDetailOpen}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle className=\"text-[14px] font-semibold text-gray-800\">\n              ë§¤ì¹­ ìƒì„¸ ë‚´ì—­\n            </DialogTitle>\n          </DialogHeader>\n          \n          <div className=\"space-y-4 py-2\">\n            {/* í†µí•© ë§¤ì¹­ë¥  í‘œì‹œ */}\n            {(() => {\n              const selectedCandidate = allPONumberCandidates.find(\n                c => c.poNumber === selectedPONumber || c.salesOrderNumber === selectedPONumber\n              );\n              // í‘œì‹œìš© ì ìˆ˜ ì‚¬ìš© (ì‹¤ì œ í’ˆëª© ìœ ì‚¬ë„, ìµœëŒ€ 100%)\n              const totalMatchScore = Math.min(100, selectedCandidate?.displayScore ?? selectedCandidate?.setMatchScore ?? 0);\n              const matchedCount = selectedCandidate?.matchedItemCount ?? 0;\n              const totalCount = statementWithItems?.items.length ?? 0;\n              const normalizedSelectedPONumber = selectedPONumber\n                ? normalizeOrderNumber(selectedPONumber)\n                : '';\n              const pairedOrderNumber = selectedPONumber\n                ? getPairedOrderNumber(selectedPONumber)\n                : undefined;\n              const normalizedPairedOrderNumber = pairedOrderNumber\n                ? normalizeOrderNumber(pairedOrderNumber)\n                : '';\n              const extractedOrderNumbers = (statementWithItems?.items ?? [])\n                .map(item => getOCRItemValue(item, 'po_number') as string)\n                .filter(Boolean)\n                .map(value => normalizeOrderNumber(value));\n              const isOrderNumberMatched =\n                !!normalizedSelectedPONumber &&\n                extractedOrderNumbers.some(\n                  value =>\n                    value === normalizedSelectedPONumber ||\n                    (normalizedPairedOrderNumber && value === normalizedPairedOrderNumber)\n                );\n              const matchedNameCount = (statementWithItems?.items ?? []).filter(ocrItem => {\n                const matchedSystem = itemMatches.get(ocrItem.id);\n                if (!matchedSystem) return false;\n                const similarity = calculateItemSimilarity(\n                  (getOCRItemValue(ocrItem, 'item_name') as string) || '',\n                  matchedSystem.item_name,\n                  matchedSystem.specification\n                );\n                return similarity >= 40; // ìµœì†Œ 40ì  ì´ìƒ\n              }).length;\n              const quantityMatchedCount = (statementWithItems?.items ?? []).filter(ocrItem => {\n                const matchedSystem = itemMatches.get(ocrItem.id);\n                if (!matchedSystem) return false;\n                const ocrQty = getOCRItemValue(ocrItem, 'quantity') as number | string;\n                const normalizedQty = typeof ocrQty === 'number'\n                  ? ocrQty\n                  : (ocrQty !== '' ? Number(ocrQty) : undefined);\n                return isQuantityMatched(normalizedQty, matchedSystem.quantity);\n              }).length;\n              const isItemNameAllMatched = totalCount > 0 && matchedNameCount === totalCount;\n              const isQuantityAllMatched = totalCount > 0 && quantityMatchedCount === totalCount;\n              \n              return (\n                <>\n                  <div className=\"flex items-center justify-center gap-3 p-4 bg-gray-50 rounded-lg\">\n                    <span className={`text-3xl font-bold ${\n                      totalMatchScore >= 80 ? 'text-green-600' :\n                      totalMatchScore >= 50 ? 'text-yellow-600' :\n                      'text-gray-500'\n                    }`}>\n                      {totalMatchScore}%\n                    </span>\n                    <div className=\"text-left\">\n                      <p className=\"text-[12px] font-medium text-gray-700\">\n                        ë°œì£¼ë²ˆí˜¸: {selectedPONumber || 'ë¯¸ì„ íƒ'}\n                      </p>\n                      <p className=\"text-[11px] text-gray-500\">\n                        {matchedCount}/{totalCount}ê°œ í’ˆëª© ë§¤ì¹­ë¨\n                      </p>\n                    </div>\n                  </div>\n\n                  {/* ë§¤ì¹­ ì²´í¬ ìš”ì•½ */}\n                  <div className=\"grid grid-cols-1 gap-2 rounded-lg border border-gray-200 p-3\">\n                    <div className=\"flex items-center justify-between text-[11px]\">\n                      <span className=\"text-gray-600\">ë°œì£¼/ìˆ˜ì£¼ë²ˆí˜¸ ë§¤ì¹­</span>\n                      <span className={`font-medium ${isOrderNumberMatched ? 'text-green-600' : 'text-red-600'}`}>\n                        {isOrderNumberMatched ? 'âœ… ì¼ì¹˜' : 'âŒ ë¶ˆì¼ì¹˜'}\n                      </span>\n                    </div>\n                    <div className=\"flex items-center justify-between text-[11px]\">\n                      <span className=\"text-gray-600\">í’ˆëª©ëª… ë§¤ì¹­</span>\n                      <span className={`font-medium ${isItemNameAllMatched ? 'text-green-600' : 'text-red-600'}`}>\n                        {isItemNameAllMatched ? `âœ… ëª¨ë‘ ì¼ì¹˜ (${matchedNameCount}/${totalCount})` : `âŒ ë¶ˆì¼ì¹˜ (${matchedNameCount}/${totalCount})`}\n                      </span>\n                    </div>\n                    <div className=\"flex items-center justify-between text-[11px]\">\n                      <span className=\"text-gray-600\">ìˆ˜ëŸ‰ ë§¤ì¹­</span>\n                      <span className={`font-medium ${isQuantityAllMatched ? 'text-green-600' : 'text-red-600'}`}>\n                        {isQuantityAllMatched ? `âœ… ëª¨ë‘ ì¼ì¹˜ (${quantityMatchedCount}/${totalCount})` : `âŒ ë¶ˆì¼ì¹˜ (${quantityMatchedCount}/${totalCount})`}\n                      </span>\n                    </div>\n                  </div>\n\n                  {/* í’ˆëª©ë³„ ë§¤ì¹­ ìƒì„¸ */}\n                  <div className=\"space-y-2\">\n                    <p className=\"text-[11px] font-semibold text-gray-600\">í’ˆëª©ë³„ ë§¤ì¹­ ìƒì„¸:</p>\n                    <div className=\"max-h-[250px] overflow-y-auto space-y-2\">\n                      {statementWithItems?.items.map((ocrItem) => {\n                        const matchedSystem = itemMatches.get(ocrItem.id);\n                        const similarity = matchedSystem \n                          ? calculateItemSimilarity(\n                              (getOCRItemValue(ocrItem, 'item_name') as string) || '', \n                              matchedSystem.item_name, \n                              matchedSystem.specification\n                            )\n                          : 0;\n                        const isMatched = similarity >= 40; // ìµœì†Œ 40ì  ì´ìƒ\n                        \n                        // ìˆ˜ëŸ‰ ì¼ì¹˜ ì—¬ë¶€\n                        const ocrQtyRaw = getOCRItemValue(ocrItem, 'quantity') as number | string;\n                        const ocrQty = typeof ocrQtyRaw === 'number'\n                          ? ocrQtyRaw\n                          : (ocrQtyRaw !== '' ? Number(ocrQtyRaw) : undefined);\n                        const sysQty = matchedSystem?.quantity;\n                        const qtyMatched = isQuantityMatched(ocrQty, sysQty);\n                        const qtyLevel = getQuantityMatchLevel(ocrQty, sysQty);\n                        \n                        return (\n                          <div \n                            key={ocrItem.id} \n                            className={`p-2 rounded-lg border ${\n                              isMatched && qtyMatched ? 'bg-green-50 border-green-200' : \n                              isMatched ? 'bg-yellow-50 border-yellow-200' :\n                              'bg-gray-50 border-gray-200'\n                            }`}\n                          >\n                            <div className=\"flex items-center justify-between\">\n                              <div className=\"flex-1 min-w-0\">\n                                <p className=\"text-[11px] font-medium text-gray-800 truncate\">\n                                  {ocrItem.extracted_item_name || '-'}\n                                </p>\n                                <p className=\"text-[10px] text-gray-500\">\n                                  â†’ {matchedSystem?.item_name || 'ë¯¸ë§¤ì¹­'}\n                                </p>\n                              </div>\n                              <span className={`text-[10px] px-2 py-0.5 rounded font-medium ml-2 ${\n                                similarity >= 85 ? 'bg-green-100 text-green-700' :\n                                similarity >= 60 ? 'bg-yellow-100 text-yellow-700' :\n                                similarity >= 40 ? 'bg-orange-100 text-orange-700' :\n                                'bg-red-100 text-red-600'\n                              }`}>\n                                {isMatched ? `${Math.round(similarity)}%` : 'ë¯¸ë§¤ì¹­'}\n                              </span>\n                            </div>\n                            {/* ìˆ˜ëŸ‰ ë¹„êµ */}\n                            {isMatched && (\n                              <div className=\"flex items-center gap-2 mt-1.5 pt-1.5 border-t border-gray-100\">\n                                <span className=\"text-[10px] text-gray-500\">ìˆ˜ëŸ‰:</span>\n                                <span className=\"text-[10px] font-medium text-gray-700\">\n                                  OCR {ocrQty ?? '-'}ê°œ\n                                </span>\n                                <span className=\"text-[10px] text-gray-400\">vs</span>\n                                <span className=\"text-[10px] font-medium text-gray-700\">\n                                  ì‹œìŠ¤í…œ {sysQty ?? '-'}ê°œ\n                                </span>\n                                <span className={`text-[9px] px-1.5 py-0.5 rounded ${\n                                  qtyMatched ? 'bg-green-100 text-green-700' :\n                                  qtyLevel === 'partial' ? 'bg-yellow-100 text-yellow-700' :\n                                  'bg-red-100 text-red-700'\n                                }`}>\n                                  {qtyMatched ? 'âœ… ì¼ì¹˜' : \n                                   qtyLevel === 'partial' ? 'âš ï¸ ë¶€ë¶„ì…ê³ ' : \n                                   'âŒ ë¶ˆì¼ì¹˜'}\n                                </span>\n                              </div>\n                            )}\n                          </div>\n                        );\n                      })}\n                    </div>\n                  </div>\n                </>\n              );\n            })()}\n          </div>\n          \n          <DialogFooter>\n            <Button \n              variant=\"outline\" \n              size=\"sm\" \n              onClick={() => setIsIntegratedMatchDetailOpen(false)}\n              className=\"text-[11px]\"\n            >\n              ë‹«ê¸°\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* ì´ë¯¸ì§€ ë·°ì–´ */}\n      <StatementImageViewer\n        isOpen={isImageViewerOpen}\n        imageUrl={statement.image_url}\n        onClose={() => setIsImageViewerOpen(false)}\n      />\n\n      {/* ë°œì£¼ë²ˆí˜¸ ì„ íƒ ë“œë¡­ë‹¤ìš´ (Portalë¡œ document.bodyì— ë Œë”ë§í•˜ì—¬ Dialog ì´ë²¤íŠ¸ ì°¨ë‹¨ ìš°íšŒ) */}\n      {openDropdowns.has('global-po') && createPortal(\n        <>\n          {/* ì˜¤ë²„ë ˆì´ */}\n          <div \n            className=\"fixed inset-0 z-[100]\" \n            style={{ pointerEvents: 'auto' }}\n            onClick={() => toggleDropdown('global-po')}\n          />\n          {/* ë“œë¡­ë‹¤ìš´ */}\n          <div \n            className=\"fixed z-[101] bg-white border border-gray-200 rounded-lg shadow-xl min-w-[280px] max-h-[350px] overflow-y-auto\"\n            style={{\n              top: dropdownPosition.top,\n              left: dropdownPosition.left,\n              pointerEvents: 'auto'\n            }}\n            onClick={(e) => e.stopPropagation()}\n            onWheel={handleGlobalPODropdownWheel}\n          >\n            <div className=\"sticky top-0 bg-gray-50 px-3 py-2 border-b border-gray-100 rounded-t-lg\">\n              <span className=\"text-[10px] font-semibold text-gray-600\">ë°œì£¼ë²ˆí˜¸ ì„ íƒ</span>\n            </div>\n            {/* allPONumberCandidatesëŠ” ì´ë¯¸ ë°œì£¼ë²ˆí˜¸ ì¼ì¹˜ â†’ ì ìˆ˜ìˆœìœ¼ë¡œ ì •ë ¬ë¨ */}\n            {allPONumberCandidates.map((c, idx) => {\n              const displayNumber = c.poNumber || c.salesOrderNumber || '';\n              const isSelected = selectedPONumber === displayNumber;\n              const isBestMatch = setMatchResult?.bestMatch?.purchase_order_number === c.poNumber ||\n                                 setMatchResult?.bestMatch?.sales_order_number === c.salesOrderNumber;\n              \n              return (\n                <div\n                  key={idx}\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    handleSelectGlobalPO(displayNumber);\n                    toggleDropdown('global-po');\n                  }}\n                  className={`p-2.5 cursor-pointer border-b border-gray-50 last:border-0 transition-colors ${\n                    isSelected ? 'bg-blue-50' : 'hover:bg-gray-50'\n                  } ${isBestMatch ? 'ring-1 ring-inset ring-green-400' : ''}`}\n                >\n                  <div className=\"flex items-center justify-between\">\n                    <p className=\"text-[12px] font-medium text-gray-900\">\n                      {c.poNumber || c.salesOrderNumber}\n                      {c.poNumber && c.salesOrderNumber && (\n                        <span className=\"text-gray-500 font-normal\"> ({c.salesOrderNumber})</span>\n                      )}\n                    </p>\n                    {(c.displayScore !== undefined || c.setMatchScore !== undefined) && (\n                      <span className={`text-[10px] px-1.5 py-0.5 rounded font-medium ${\n                        (c.displayScore ?? c.setMatchScore ?? 0) >= 80 ? 'bg-green-100 text-green-700' :\n                        (c.displayScore ?? c.setMatchScore ?? 0) >= 50 ? 'bg-yellow-100 text-yellow-700' :\n                        'bg-gray-100 text-gray-600'\n                      }`}>\n                        {Math.min(100, c.displayScore ?? c.setMatchScore ?? 0)}%\n                      </span>\n                    )}\n                  </div>\n                  <p className=\"text-[10px] text-gray-500 mt-0.5\">\n                    {c.matchedItemCount !== undefined \n                      ? `${c.matchedItemCount}/${statementWithItems?.items.length || 0}ê°œ ë§¤ì¹­`\n                      : `${c.itemCount}ê°œ í’ˆëª©`\n                    } Â· {c.vendorName || 'ê±°ë˜ì²˜ ë¯¸ìƒ'}\n                  </p>\n                  {/* ìˆ˜ëŸ‰ ì¼ì¹˜ ì •ë³´ */}\n                  {c.quantityMatchedCount !== undefined && c.matchedItemCount !== undefined && c.matchedItemCount > 0 && (\n                    <p className={`text-[9px] mt-0.5 ${\n                      c.quantityMismatchedCount === 0 ? 'text-green-600' : 'text-orange-600'\n                    }`}>\n                      {c.quantityMismatchedCount === 0 \n                        ? `âœ… ìˆ˜ëŸ‰ ëª¨ë‘ ì¼ì¹˜`\n                        : `âš ï¸ ìˆ˜ëŸ‰ ${c.quantityMismatchedCount}ê°œ ë¶ˆì¼ì¹˜`\n                      }\n                    </p>\n                  )}\n                  {isBestMatch && (\n                    <p className=\"text-[9px] text-green-600 font-medium mt-0.5\">\n                      âœ… ì„¸íŠ¸ ë§¤ì¹­ ì¶”ì²œ\n                    </p>\n                  )}\n                </div>\n              );\n            })}\n          </div>\n        </>,\n        document.body\n      )}\n\n      {/* ë°œì£¼ ìƒì„¸ ëª¨ë‹¬ */}\n      {selectedPurchaseIdForDetail && (\n        <PurchaseDetailModal\n          purchaseId={selectedPurchaseIdForDetail}\n          isOpen={isPurchaseDetailModalOpen}\n          onClose={() => {\n            setIsPurchaseDetailModalOpen(false);\n            setSelectedPurchaseIdForDetail(null);\n          }}\n          activeTab=\"done\"\n          forceShowStatementColumns={true}\n        />\n      )}\n    </>\n  );\n}\n","import { useState, useEffect, useCallback, useRef, useMemo } from \"react\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { createClient } from \"@/lib/supabase/client\";\nimport { \n  Search, \n  FileCheck, \n  Plus, \n  Trash2, \n  Eye,\n  CheckCircle,\n  Clock,\n  AlertCircle,\n  XCircle,\n  Loader2,\n  RefreshCw,\n  Image as ImageIcon,\n  SlidersHorizontal,\n  ChevronRight,\n  ExternalLink,\n  X,\n  ChevronDown,\n  Package,\n  ChevronsUpDown,\n  Check\n} from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n} from \"@/components/ui/command\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport transactionStatementService from \"@/services/transactionStatementService\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport type { \n  TransactionStatement, \n  TransactionStatementStatus,\n  StatementMode\n} from \"@/types/transactionStatement\";\nimport StatementUploadModal from \"./StatementUploadModal\";\nimport ReceiptQuantityUploadModal from \"./ReceiptQuantityUploadModal\";\nimport MonthlyStatementUploadModal from \"./MonthlyStatementUploadModal\";\nimport StatementConfirmModal from \"./StatementConfirmModal\";\nimport StatementImageViewer from \"./StatementImageViewer\";\nimport PurchaseDetailModal from \"@/components/purchase/PurchaseDetailModal\";\n\n/**\n * ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ë©”ì¸ í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸\n * \n * ê±°ë˜ëª…ì„¸ì„œ ëª©ë¡ ì¡°íšŒ, ì—…ë¡œë“œ, OCR ì¶”ì¶œ, ë°œì£¼ ë§¤ì¹­, í™•ì • ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.\n */\n// ì§ì› ëª©ë¡ íƒ€ì… (ë“±ë¡ì ë³€ê²½ìš©)\ninterface EmployeeOption {\n  id: string;\n  name: string;\n}\n\nexport default function TransactionStatementMain() {\n  const { currentUserRoles } = useAuth();\n  const supabase = createClient();\n  \n  // app_admin ê¶Œí•œ í™•ì¸\n  const isAppAdmin = currentUserRoles.includes('app_admin');\n  \n  const [statements, setStatements] = useState<TransactionStatement[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState<string>(\"all\");\n  const [dateFilter, setDateFilter] = useState(\"\");\n  const [totalCount, setTotalCount] = useState(0);\n  const [showFilters, setShowFilters] = useState(false);\n  \n  // ì„œë¸Œ íƒ­ ìƒíƒœ (ê±°ë˜ëª…ì„¸ì„œ / ì…ê³ ìˆ˜ëŸ‰)\n  const [activeTab, setActiveTab] = useState<'default' | 'receipt'>('default');\n  \n  // ì§ì› ëª©ë¡ (ë“±ë¡ì ë³€ê²½ìš© - app_adminë§Œ)\n  const [employees, setEmployees] = useState<EmployeeOption[]>([]);\n  const [editingUploaderId, setEditingUploaderId] = useState<string | null>(null);\n  \n  // ëª¨ë‹¬ ìƒíƒœ\n  const [isUploadModalOpen, setIsUploadModalOpen] = useState(false);\n  const [isReceiptUploadModalOpen, setIsReceiptUploadModalOpen] = useState(false); // ì…ê³ ìˆ˜ëŸ‰ ì—…ë¡œë“œ ëª¨ë‹¬\n  const [isMonthlyUploadModalOpen, setIsMonthlyUploadModalOpen] = useState(false); // ì›”ë§ê²°ì œ ì—…ë¡œë“œ ëª¨ë‹¬\n  const [selectedStatement, setSelectedStatement] = useState<TransactionStatement | null>(null);\n  const [isConfirmModalOpen, setIsConfirmModalOpen] = useState(false);\n  const [isImageViewerOpen, setIsImageViewerOpen] = useState(false);\n  const [viewerImageUrl, setViewerImageUrl] = useState<string>(\"\");\n  \n  // OCR ì¶”ì¶œ ì§„í–‰ ì¤‘ì¸ IDë“¤\n  const [extractingIds, setExtractingIds] = useState<Set<string>>(new Set());\n  \n  // ë°œì£¼ ìƒì„¸ ëª¨ë‹¬ ìƒíƒœ\n  const [isPurchaseModalOpen, setIsPurchaseModalOpen] = useState(false);\n  const [selectedPurchaseId, setSelectedPurchaseId] = useState<number | null>(null);\n  \n  // ë°œì£¼ ëª©ë¡ ë“œë¡­ë‹¤ìš´ ìƒíƒœ\n  const [purchaseDropdown, setPurchaseDropdown] = useState<{\n    isOpen: boolean;\n    statement: TransactionStatement | null;\n    position: { top: number; left: number };\n  }>({ isOpen: false, statement: null, position: { top: 0, left: 0 } });\n\n  // íƒ­ë³„ í•„í„°ë§ëœ ëª©ë¡ ë° ì¹´ìš´íŠ¸\n  const { filteredStatements, defaultCount, receiptCount } = useMemo(() => {\n    const defaultItems = statements.filter(s => (s.statement_mode ?? 'default') === 'default' || s.statement_mode === 'monthly');\n    const receiptItems = statements.filter(s => s.statement_mode === 'receipt');\n    \n    return {\n      filteredStatements: activeTab === 'default' ? defaultItems : receiptItems,\n      defaultCount: defaultItems.length,\n      receiptCount: receiptItems.length\n    };\n  }, [statements, activeTab]);\n\n  // ì§ì› ëª©ë¡ ë¡œë“œ (app_adminë§Œ)\n  useEffect(() => {\n    if (!isAppAdmin) return;\n    \n    const loadEmployees = async () => {\n      const { data, error } = await supabase\n        .from('employees')\n        .select('id, name')\n        .order('name');\n      \n      if (!error && data) {\n        setEmployees(data.map((e: { id: string; name: string }) => ({ id: e.id, name: e.name })));\n      }\n    };\n    \n    loadEmployees();\n  }, [isAppAdmin, supabase]);\n\n  // ë“±ë¡ì ë³€ê²½ í•¸ë“¤ëŸ¬ (app_adminë§Œ)\n  const handleUploaderChange = async (statementId: string, newUploaderId: string) => {\n    if (!isAppAdmin) return;\n    \n    const selectedEmployee = employees.find(e => e.id === newUploaderId);\n    if (!selectedEmployee) return;\n    \n    const { error } = await supabase\n      .from('transaction_statements')\n      .update({ \n        uploaded_by: newUploaderId,\n        uploaded_by_name: selectedEmployee.name\n      })\n      .eq('id', statementId);\n    \n    if (error) {\n      if (error.message?.includes('transaction_statements_uploaded_by_fkey')) {\n        const { error: fallbackError } = await supabase\n          .from('transaction_statements')\n          .update({\n            uploaded_by: null,\n            uploaded_by_name: selectedEmployee.name\n          })\n          .eq('id', statementId);\n        if (fallbackError) {\n          toast.error('ë“±ë¡ì ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n          return;\n        }\n        setStatements(prev => prev.map(s => \n          s.id === statementId \n            ? { ...s, uploaded_by: undefined, uploaded_by_name: selectedEmployee.name }\n            : s\n        ));\n        setEditingUploaderId(null);\n        return;\n      }\n      toast.error('ë“±ë¡ì ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n      return;\n    }\n    \n    // ë¡œì»¬ ìƒíƒœ ì—…ë°ì´íŠ¸\n    setStatements(prev => prev.map(s => \n      s.id === statementId \n        ? { ...s, uploaded_by: newUploaderId, uploaded_by_name: selectedEmployee.name }\n        : s\n    ));\n    setEditingUploaderId(null);\n    toast.success('ë“±ë¡ìê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');\n  };\n\n  // ë°ì´í„° ë¡œë“œ\n  const loadStatements = useCallback(async () => {\n    try {\n      setLoading(true);\n      const result = await transactionStatementService.getStatements({\n        status: statusFilter !== 'all' ? statusFilter : undefined,\n        dateFrom: dateFilter || undefined,\n        search: searchTerm || undefined,\n        limit: 50\n      });\n\n      if (result.success) {\n        setStatements(result.data || []);\n        setTotalCount(result.count || 0);\n        const processingIds = (result.data || [])\n          .filter((item) => item.status === 'processing')\n          .map((item) => item.id);\n\n      } else {\n        toast.error(result.error || 'ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n      }\n    } catch (error) {\n      toast.error('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n    } finally {\n      setLoading(false);\n    }\n  }, [statusFilter, dateFilter, searchTerm]);\n\n  useEffect(() => {\n    loadStatements();\n  }, [loadStatements]);\n\n  useEffect(() => {\n    transactionStatementService.kickQueue();\n  }, []);\n\n  // Supabase Realtime êµ¬ë… - ìƒíƒœ ë³€ê²½ ì‹œ ìë™ ê°±ì‹ \n  const supabaseRef = useRef(createClient());\n  const realtimeChannelRef = useRef<ReturnType<typeof createClient>['channel'] | null>(null);\n  const realtimeReconnectAttemptsRef = useRef(0);\n  const shouldReconnectRef = useRef(true);\n  const realtimeIsSubscribingRef = useRef(false);\n  const realtimeIsSubscribedRef = useRef(false);\n  const realtimeInstanceIdRef = useRef(Math.random().toString(36).slice(2, 8));\n  \n  useEffect(() => {\n    const supabase = supabaseRef.current;\n\n    const setupRealtimeAuth = async () => {\n      try {\n        const { data } = await supabase.auth.getSession();\n        const token = data?.session?.access_token;\n        if (token) {\n          supabase.realtime.setAuth(token);\n        }\n        supabase.realtime.connect();\n      } catch (_) {\n        // ignore auth setup errors; fallback to anon\n      }\n    };\n\n    const subscribeRealtime = () => {\n      if (!shouldReconnectRef.current) return;\n      if (realtimeIsSubscribingRef.current || realtimeIsSubscribedRef.current) {\n        return;\n      }\n      realtimeIsSubscribingRef.current = true;\n      if (realtimeChannelRef.current) {\n        supabase.removeChannel(realtimeChannelRef.current);\n        realtimeChannelRef.current = null;\n      }\n\n      realtimeChannelRef.current = supabase\n        .channel('transaction-statements-changes')\n        .on(\n          'postgres_changes',\n          {\n            event: '*', // INSERT, UPDATE, DELETE ëª¨ë‘ êµ¬ë…\n            schema: 'public',\n            table: 'transaction_statements'\n          },\n          (payload: any) => {\n            console.log('[Realtime] Statement changed:', payload);\n            \n            // ìƒíƒœê°€ ë³€ê²½ë˜ë©´ ëª©ë¡ ê°±ì‹ \n            if (payload.eventType === 'UPDATE') {\n              const newStatus = payload.new?.status;\n              const oldStatus = payload.old?.status;\n              \n              // ìƒíƒœê°€ processing â†’ extracted ë˜ëŠ” ë‹¤ë¥¸ ìƒíƒœë¡œ ë³€ê²½ëì„ ë•Œ\n              if (newStatus !== oldStatus) {\n                console.log(`[Realtime] Status changed: ${oldStatus} â†’ ${newStatus}`);\n                loadStatements();\n\n                if (\n                  oldStatus === 'processing' &&\n                  ['extracted', 'failed', 'confirmed', 'rejected'].includes(newStatus)\n                ) {\n                  transactionStatementService.kickQueue();\n                }\n              }\n            } else if (payload.eventType === 'INSERT' || payload.eventType === 'DELETE') {\n              loadStatements();\n            }\n          }\n        )\n        .subscribe((status: string, err?: Error) => {\n          if (err) {\n          }\n          if (status === 'SUBSCRIBED') {\n            realtimeReconnectAttemptsRef.current = 0;\n            realtimeIsSubscribingRef.current = false;\n            realtimeIsSubscribedRef.current = true;\n            loadStatements();\n          }\n          if (status === 'CHANNEL_ERROR' || status === 'CLOSED' || status === 'TIMED_OUT') {\n            realtimeIsSubscribingRef.current = false;\n            realtimeIsSubscribedRef.current = false;\n            if (shouldReconnectRef.current && realtimeReconnectAttemptsRef.current < 3) {\n              realtimeReconnectAttemptsRef.current += 1;\n              subscribeRealtime();\n            }\n          }\n        });\n    };\n\n    shouldReconnectRef.current = true;\n    setupRealtimeAuth().finally(() => {\n      subscribeRealtime();\n    });\n\n    return () => {\n      shouldReconnectRef.current = false;\n      if (realtimeChannelRef.current) {\n        supabase.removeChannel(realtimeChannelRef.current);\n        realtimeChannelRef.current = null;\n      }\n    };\n  }, [loadStatements]);\n\n  // ìƒíƒœ ë°°ì§€ ë Œë”ë§\n  const renderStatusBadge = (status: TransactionStatementStatus, errorMessage?: string | null, statementMode?: StatementMode, statement?: TransactionStatement) => {\n    const baseClass = \"inline-flex items-center gap-1 business-radius-badge px-2 py-0.5 text-[10px] font-medium leading-tight\";\n    const miniClass = \"inline-flex items-center gap-0.5 business-radius-badge px-1.5 py-0.5 text-[9px] font-medium leading-tight\";\n    \n    switch (status) {\n      case 'pending':\n        return (\n          <span className={`${baseClass} bg-gray-100 text-gray-600 border border-gray-200`}>\n            <Clock className=\"w-3 h-3\" />\n            ëŒ€ê¸°ì¤‘\n          </span>\n        );\n      case 'queued':\n        return (\n          <span className={`${baseClass} bg-slate-100 text-slate-600 border border-slate-200`}>\n            <Clock className=\"w-3 h-3\" />\n            ëŒ€ê¸°ì—´\n          </span>\n        );\n      case 'processing':\n        return (\n          <span className={`${baseClass} bg-blue-50 text-blue-600 border border-blue-200`}>\n            <Loader2 className=\"w-3 h-3 animate-spin\" />\n            ì²˜ë¦¬ì¤‘\n          </span>\n        );\n      case 'extracted':\n        return (\n          <span className={`${baseClass} bg-yellow-50 text-yellow-600 border border-yellow-200`}>\n            <AlertCircle className=\"w-3 h-3\" />\n            í™•ì¸í•„ìš”\n          </span>\n        );\n      case 'confirmed':\n        return (\n          <span className={`${baseClass} bg-green-50 text-green-600 border border-green-200`}>\n            <CheckCircle className=\"w-3 h-3\" />\n            {statementMode === 'receipt' ? 'ì™„ë£Œ' : 'í™•ì •ë¨'}\n          </span>\n        );\n      case 'rejected':\n        return (\n          <span className={`${baseClass} bg-red-50 text-red-600 border border-red-200`}>\n            <XCircle className=\"w-3 h-3\" />\n            ê±°ë¶€ë¨\n          </span>\n        );\n      case 'failed':\n        return (\n          <span\n            className={`${baseClass} bg-red-50 text-red-700 border border-red-200`}\n            title={errorMessage || 'ì²˜ë¦¬ ì‹¤íŒ¨'}\n          >\n            <XCircle className=\"w-3 h-3\" />\n            ì‹¤íŒ¨\n          </span>\n        );\n      default:\n        return <span className={`${baseClass} bg-gray-100 text-gray-600`}>{status}</span>;\n    }\n  };\n\n  // ìƒì„¸ ëª¨ë‹¬ ì—´ê¸°\n  const handleViewStatement = (statement: TransactionStatement, event?: React.MouseEvent) => {\n    const target = event?.target as HTMLElement | undefined;\n    const isUploaderInteraction = Boolean(target?.closest?.('[data-uploader-control=\"true\"]'));\n    if (isUploaderInteraction) return;\n    setSelectedStatement(statement);\n    \n    if (statement.status === 'extracted') {\n      // í™•ì¸í•„ìš” ìƒíƒœ - í™•ì¸ ëª¨ë‹¬ ì—´ê¸°\n      setIsConfirmModalOpen(true);\n    } else if (statement.status === 'confirmed' && statement.matched_purchases && statement.matched_purchases.length > 0) {\n      // í™•ì •ë¨ + ë°œì£¼ ë§¤ì¹­ë¨\n      if (statement.matched_purchases.length === 1) {\n        // ë°œì£¼ê°€ 1ê°œë©´ ë°”ë¡œ ìƒì„¸ ëª¨ë‹¬ ì—´ê¸°\n        setSelectedPurchaseId(statement.matched_purchases[0].purchase_id);\n        setIsPurchaseModalOpen(true);\n      } else {\n        // ë°œì£¼ê°€ ì—¬ëŸ¬ ê°œë©´ ë“œë¡­ë‹¤ìš´ í‘œì‹œ\n        const rect = (event?.currentTarget as HTMLElement)?.getBoundingClientRect();\n        setPurchaseDropdown({\n          isOpen: true,\n          statement,\n          position: {\n            top: rect ? rect.bottom + window.scrollY : 0,\n            left: rect ? rect.left + window.scrollX : 0\n          }\n        });\n      }\n    } else if (\n      statement.status === 'confirmed' ||\n      statement.status === 'pending' ||\n      statement.status === 'queued' ||\n      statement.status === 'failed'\n    ) {\n      // ê·¸ ì™¸ - ì´ë¯¸ì§€ ë·°ì–´ ì—´ê¸°\n      setViewerImageUrl(statement.image_url);\n      setIsImageViewerOpen(true);\n    }\n  };\n  \n  // ë°œì£¼ ì„ íƒí•˜ì—¬ ìƒì„¸ ëª¨ë‹¬ ì—´ê¸°\n  const handleSelectPurchase = (purchaseId: number) => {\n    setPurchaseDropdown({ isOpen: false, statement: null, position: { top: 0, left: 0 } });\n    setSelectedPurchaseId(purchaseId);\n    setIsPurchaseModalOpen(true);\n  };\n  \n  // ë“œë¡­ë‹¤ìš´ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°\n  const handleClosePurchaseDropdown = () => {\n    setPurchaseDropdown({ isOpen: false, statement: null, position: { top: 0, left: 0 } });\n  };\n\n  // ì´ë¯¸ì§€ ë·°ì–´ ì—´ê¸°\n  const handleViewImage = (e: React.MouseEvent, imageUrl: string) => {\n    e.stopPropagation();\n    setViewerImageUrl(imageUrl);\n    setIsImageViewerOpen(true);\n  };\n\n  // OCR ì¶”ì¶œ ì‹œì‘\n  const handleStartExtraction = async (e: React.MouseEvent, statement: TransactionStatement) => {\n    e.stopPropagation();\n    console.log('[OCR] Button clicked, statement:', statement);\n    \n    const canExtract = ['pending', 'queued', 'failed'].includes(statement.status);\n    if (!canExtract || extractingIds.has(statement.id)) {\n      console.log('[OCR] Status is not eligible or already extracting:', statement.status);\n      toast.info('ì´ë¯¸ ì²˜ë¦¬ ì¤‘ì´ê±°ë‚˜ ì™„ë£Œëœ ê±´ì…ë‹ˆë‹¤.');\n      return;\n    }\n\n    // ì¶”ì¶œ ì‹œì‘ - ID ì¶”ê°€\n    setExtractingIds(prev => new Set(prev).add(statement.id));\n\n    try {\n      console.log('[OCR] Starting extraction...');\n      toast.loading('OCR ì¶”ì¶œ ì¤‘... (ì•½ 10~30ì´ˆ ì†Œìš”)', { id: `extraction-${statement.id}` });\n      \n      const result = await transactionStatementService.extractStatementData(\n        statement.id,\n        statement.image_url\n      );\n      console.log('[OCR] Result:', result);\n\n      if (result.success) {\n        if (result.queued) {\n          toast.info('ì²˜ë¦¬ ëŒ€ê¸°ì—´ì— ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.', { id: `extraction-${statement.id}` });\n          loadStatements();\n          return;\n        }\n\n        toast.success('OCR ì¶”ì¶œì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!', { id: `extraction-${statement.id}` });\n        loadStatements();\n        \n        if (result.data) {\n          setSelectedStatement(result.data);\n          setIsConfirmModalOpen(true);\n        }\n      } else {\n        console.error('[OCR] Failed:', result.error);\n        toast.error(result.error || 'OCR ì¶”ì¶œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', { id: `extraction-${statement.id}` });\n      }\n    } catch (error) {\n      console.error('[OCR] Error:', error);\n      toast.error('OCR ì¶”ì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', { id: `extraction-${statement.id}` });\n    } finally {\n      // ì¶”ì¶œ ì™„ë£Œ - ID ì œê±°\n      setExtractingIds(prev => {\n        const next = new Set(prev);\n        next.delete(statement.id);\n        return next;\n      });\n    }\n  };\n\n  // ì‚­ì œ\n  const handleDelete = async (e: React.MouseEvent, statement: TransactionStatement) => {\n    e.stopPropagation();\n    \n    if (!confirm(`\"${statement.file_name || 'ì´ ê±°ë˜ëª…ì„¸ì„œ'}\"ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {\n      return;\n    }\n\n    try {\n      const result = await transactionStatementService.deleteStatement(statement.id);\n      \n      if (result.success) {\n        toast.success('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');\n        loadStatements();\n      } else {\n        toast.error(result.error || 'ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n      }\n    } catch (error) {\n      toast.error('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');\n    }\n  };\n\n  // ì—…ë¡œë“œ ì„±ê³µ í›„ ì²˜ë¦¬ - ìë™ìœ¼ë¡œ OCR ì‹œì‘\n  const handleUploadSuccess = async (statementId: string, imageUrl: string) => {\n    setIsUploadModalOpen(false);\n    \n    // 1. ì—…ë¡œë“œ ì§í›„ ë°”ë¡œ ëª©ë¡ ê°±ì‹  (ëª©ë¡ì— ì¦‰ì‹œ í‘œì‹œ)\n    await loadStatements();\n    \n    // 2. ì²˜ë¦¬ì¤‘ í‘œì‹œë¥¼ ìœ„í•´ extractingIdsì— ì¶”ê°€\n    setExtractingIds(prev => new Set(prev).add(statementId));\n    \n    // 3. OCR ì¶”ì¶œ ì‹œì‘\n    try {\n      toast.loading('OCR ì¶”ì¶œ ì¤‘... (ì•½ 10~30ì´ˆ ì†Œìš”)', { id: `extraction-${statementId}` });\n      \n      const result = await transactionStatementService.extractStatementData(statementId, imageUrl);\n      \n      if (result.success) {\n        if (result.queued) {\n          toast.info('ì²˜ë¦¬ ëŒ€ê¸°ì—´ì— ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.', { id: `extraction-${statementId}` });\n          loadStatements();\n        } else {\n          toast.success('OCR ì¶”ì¶œì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê²°ê³¼ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.', { id: `extraction-${statementId}` });\n          loadStatements();\n          \n          // ì¶”ì¶œ ì™„ë£Œ í›„ ë°”ë¡œ í™•ì¸ ëª¨ë‹¬ ì—´ê¸°\n          if (result.data) {\n            setSelectedStatement(result.data);\n            setIsConfirmModalOpen(true);\n          }\n        }\n      } else {\n        toast.error(result.error || 'OCR ì¶”ì¶œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', { id: `extraction-${statementId}` });\n        loadStatements();\n      }\n    } catch (error) {\n      toast.error('OCR ì¶”ì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', { id: `extraction-${statementId}` });\n      loadStatements();\n    } finally {\n      // ì¶”ì¶œ ì™„ë£Œ - extractingIdsì—ì„œ ì œê±°\n      setExtractingIds(prev => {\n        const next = new Set(prev);\n        next.delete(statementId);\n        return next;\n      });\n    }\n  };\n\n  // í™•ì • ëª¨ë‹¬ ë‹«ê¸°\n  const handleConfirmModalClose = () => {\n    setIsConfirmModalOpen(false);\n    setSelectedStatement(null);\n    loadStatements();\n  };\n\n  // ì¬ì¶”ì¶œ ì‹œì‘: ëª¨ë‹¬ì´ ë‹«íŒ ë’¤ì—ë„ ìƒíƒœ ì¹¼ëŸ¼ì„ ì¦‰ì‹œ ì²˜ë¦¬ì¤‘ìœ¼ë¡œ í‘œì‹œ\n  const handleReextractStartFromModal = (statementId: string) => {\n    setExtractingIds(prev => {\n      const next = new Set(prev);\n      next.add(statementId);\n      return next;\n    });\n  };\n\n  // ì¬ì¶”ì¶œ ì¢…ë£Œ: ì²˜ë¦¬ì¤‘ í‘œì‹œ í•´ì œ í›„ ì„œë²„ ìƒíƒœ ë™ê¸°í™”\n  const handleReextractFinishFromModal = (statementId: string) => {\n    setExtractingIds(prev => {\n      const next = new Set(prev);\n      next.delete(statementId);\n      return next;\n    });\n    loadStatements();\n  };\n\n  // ë‚ ì§œ í¬ë§·\n  const formatDate = (dateString: string) => {\n    if (!dateString) return '-';\n    return new Date(dateString).toLocaleDateString('ko-KR', {\n      year: 'numeric',\n      month: '2-digit',\n      day: '2-digit'\n    });\n  };\n\n  // ê¸ˆì•¡ í¬ë§·\n  const formatAmount = (amount?: number) => {\n    if (amount === undefined || amount === null) return '-';\n    return amount.toLocaleString('ko-KR') + 'ì›';\n  };\n\n  return (\n    <div className=\"w-full\">\n      {/* Header - ë°œì£¼ìš”ì²­ ê´€ë¦¬ì™€ ë™ì¼ */}\n      <div className=\"mb-4\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"page-title\">ê±°ë˜ëª…ì„¸ì„œ í™•ì¸</h1>\n            <p className=\"page-subtitle\" style={{ marginTop: '-2px', marginBottom: '-4px' }}>\n              Transaction Statement Verification\n            </p>\n          </div>\n          \n          <div className=\"flex items-center gap-2\">\n            {/* ì—…ë¡œë“œ ë“œë¡­ë‹¤ìš´ ë©”ë‰´ */}\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button className=\"!h-auto button-base bg-hansl-600 hover:bg-hansl-700 text-white\">\n                  <Plus className=\"w-3.5 h-3.5\" />\n                  <span className=\"hidden sm:inline ml-1\">ì—…ë¡œë“œ</span>\n                  <ChevronDown className=\"w-3 h-3 ml-1\" />\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent align=\"end\" className=\"w-48\">\n                <DropdownMenuItem \n                  onClick={() => setIsUploadModalOpen(true)}\n                  className=\"text-[12px] py-2 cursor-pointer\"\n                >\n                  <FileCheck className=\"w-4 h-4 mr-2 text-hansl-600\" />\n                  ê±°ë˜ëª…ì„¸ì„œ ì—…ë¡œë“œ\n                </DropdownMenuItem>\n                <DropdownMenuItem \n                  onClick={() => setIsReceiptUploadModalOpen(true)}\n                  className=\"text-[12px] py-2 cursor-pointer\"\n                >\n                  <Package className=\"w-4 h-4 mr-2 text-orange-600\" />\n                  ì…ê³ ìˆ˜ëŸ‰ ì—…ë¡œë“œ\n                </DropdownMenuItem>\n                <DropdownMenuItem \n                  onClick={() => setIsMonthlyUploadModalOpen(true)}\n                  className=\"text-[12px] py-2 cursor-pointer\"\n                >\n                  <FileCheck className=\"w-4 h-4 mr-2 text-emerald-600\" />\n                  ê±°ë˜ëª…ì„¸ì„œ(ì›”ë§ê²°ì œ)\n                </DropdownMenuItem>\n              </DropdownMenuContent>\n            </DropdownMenu>\n            <Button\n              variant=\"outline\"\n              onClick={loadStatements}\n              disabled={loading}\n              className=\"!h-auto button-base\"\n            >\n              <RefreshCw className={`w-3.5 h-3.5 ${loading ? 'animate-spin' : ''}`} />\n            </Button>\n          </div>\n        </div>\n      </div>\n\n      {/* í•„í„° íˆ´ë°” - ë°œì£¼ìš”ì²­ ê´€ë¦¬ì™€ ë™ì¼í•œ ìŠ¤íƒ€ì¼ */}\n      <div className=\"mb-3\">\n        <div className=\"flex flex-wrap items-center gap-2\">\n          {/* ê²€ìƒ‰ */}\n          <div className=\"relative min-w-[140px] max-w-[200px]\">\n            <Search className=\"absolute left-1.5 top-1/2 transform -translate-y-1/2 w-2.5 h-2.5 text-gray-400\" />\n            <Input\n              placeholder=\"ê±°ë˜ì²˜ëª…, íŒŒì¼ëª… ê²€ìƒ‰...\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              className=\"!h-auto !py-px !pr-1.5 !pl-5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700\"\n            />\n          </div>\n          \n          {/* ìƒíƒœ í•„í„° */}\n          <Select value={statusFilter} onValueChange={setStatusFilter}>\n            <SelectTrigger className=\"!h-auto !py-[1px] !px-2 !text-[12px] !min-h-[22px] w-[100px] business-radius-input border border-gray-300 bg-white text-gray-700 [&>svg]:h-3 [&>svg]:w-3\">\n              <SelectValue placeholder=\"ìƒíƒœ\" />\n            </SelectTrigger>\n            <SelectContent className=\"min-w-[100px]\">\n              <SelectItem value=\"all\" className=\"text-[12px] py-1.5\">ì „ì²´ ìƒíƒœ</SelectItem>\n              <SelectItem value=\"pending\" className=\"text-[12px] py-1.5\">ëŒ€ê¸°ì¤‘</SelectItem>\n              <SelectItem value=\"queued\" className=\"text-[12px] py-1.5\">ëŒ€ê¸°ì—´</SelectItem>\n              <SelectItem value=\"extracted\" className=\"text-[12px] py-1.5\">í™•ì¸í•„ìš”</SelectItem>\n              <SelectItem value=\"confirmed\" className=\"text-[12px] py-1.5\">í™•ì •ë¨</SelectItem>\n              <SelectItem value=\"rejected\" className=\"text-[12px] py-1.5\">ê±°ë¶€ë¨</SelectItem>\n              <SelectItem value=\"failed\" className=\"text-[12px] py-1.5\">ì‹¤íŒ¨</SelectItem>\n            </SelectContent>\n          </Select>\n          \n          {/* ë‚ ì§œ í•„í„° í† ê¸€ */}\n          <Button\n            variant=\"outline\"\n            onClick={() => setShowFilters(!showFilters)}\n            className={`!h-auto button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 ${showFilters ? 'bg-hansl-50 border-hansl-300 text-hansl-700' : ''}`}\n          >\n            <SlidersHorizontal className=\"w-3.5 h-3.5 mr-1\" />\n            <span className=\"button-text\">í•„í„°</span>\n          </Button>\n          \n          {/* ê±´ìˆ˜ í‘œì‹œ */}\n          <span className=\"badge-stats bg-gray-100 text-gray-600\">\n            ì´ {totalCount}ê±´\n          </span>\n        </div>\n        \n        {/* í™•ì¥ í•„í„° */}\n        {showFilters && (\n          <div className=\"mt-2 p-3 bg-gray-50 business-radius-card border border-gray-200\">\n            <div className=\"flex flex-wrap items-center gap-3\">\n              <div className=\"flex items-center gap-2\">\n                <label className=\"text-[12px] font-medium text-gray-500\">ì—…ë¡œë“œ ë‚ ì§œ</label>\n                <Input\n                  type=\"date\"\n                  value={dateFilter}\n                  onChange={(e) => setDateFilter(e.target.value)}\n                  className=\"!h-auto !py-[2px] !px-2.5 !text-[12px] !min-h-[24px] w-[140px] business-radius-input border border-gray-300 bg-white text-gray-700\"\n                />\n              </div>\n              <Button\n                variant=\"outline\"\n                onClick={() => {\n                  setSearchTerm(\"\");\n                  setStatusFilter(\"all\");\n                  setDateFilter(\"\");\n                }}\n                className=\"!h-auto button-base border border-gray-300 bg-white text-blue-600 hover:bg-blue-50 hover:border-blue-300\"\n              >\n                â†» <span className=\"button-text text-blue-600\">ì´ˆê¸°í™”</span>\n              </Button>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* ëª©ë¡ ì¹´ë“œ */}\n      <Card className=\"overflow-hidden border border-gray-200 business-radius-card\">\n        <CardContent className=\"p-0\">\n          {/* ì„œë¸Œ íƒ­ */}\n          <div className=\"flex border-b border-gray-200\">\n            <button\n              onClick={() => setActiveTab('default')}\n              className={`flex items-center gap-2 px-4 py-2.5 text-[11px] font-medium transition-colors ${\n                activeTab === 'default'\n                  ? 'text-hansl-600 border-b-2 border-hansl-600 bg-hansl-50/50'\n                  : 'text-gray-500 hover:text-gray-700 hover:bg-gray-50'\n              }`}\n            >\n              <FileCheck className=\"w-3.5 h-3.5\" />\n              ê±°ë˜ëª…ì„¸ì„œ\n              <span className={`px-1.5 py-0.5 text-[10px] rounded-full ${\n                activeTab === 'default' ? 'bg-hansl-100 text-hansl-700' : 'bg-gray-100 text-gray-600'\n              }`}>\n                {defaultCount}\n              </span>\n            </button>\n            <button\n              onClick={() => setActiveTab('receipt')}\n              className={`flex items-center gap-2 px-4 py-2.5 text-[11px] font-medium transition-colors ${\n                activeTab === 'receipt'\n                  ? 'text-orange-600 border-b-2 border-orange-600 bg-orange-50/50'\n                  : 'text-gray-500 hover:text-gray-700 hover:bg-gray-50'\n              }`}\n            >\n              <Package className=\"w-3.5 h-3.5\" />\n              ì…ê³ ìˆ˜ëŸ‰\n              <span className={`px-1.5 py-0.5 text-[10px] rounded-full ${\n                activeTab === 'receipt' ? 'bg-orange-100 text-orange-700' : 'bg-gray-100 text-gray-600'\n              }`}>\n                {receiptCount}\n              </span>\n            </button>\n          </div>\n\n          {loading ? (\n            <div className=\"flex items-center justify-center py-12\">\n              <div className=\"w-6 h-6 border-2 border-hansl-500 border-t-transparent rounded-full animate-spin\" />\n              <span className=\"ml-3 text-[11px] text-gray-500\">ë¡œë”© ì¤‘...</span>\n            </div>\n          ) : filteredStatements.length === 0 ? (\n            <div className=\"text-center py-12\">\n              <FileCheck className=\"w-10 h-10 text-gray-300 mx-auto mb-3\" />\n              <h3 className=\"text-[12px] font-medium text-gray-700 mb-1\">\n                {activeTab === 'default' ? 'ê±°ë˜ëª…ì„¸ì„œê°€ ì—†ìŠµë‹ˆë‹¤' : 'ì…ê³ ìˆ˜ëŸ‰ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤'}\n              </h3>\n              <p className=\"text-[11px] text-gray-500\">\n                {activeTab === 'default' \n                  ? 'ì—…ë¡œë“œëœ ê±°ë˜ëª…ì„¸ì„œê°€ ì—†ê±°ë‚˜ ê²€ìƒ‰ ì¡°ê±´ì— ë§ëŠ” ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.'\n                  : 'ì—…ë¡œë“œëœ ì…ê³ ìˆ˜ëŸ‰ ë°ì´í„°ê°€ ì—†ê±°ë‚˜ ê²€ìƒ‰ ì¡°ê±´ì— ë§ëŠ” ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.'}\n              </p>\n            </div>\n          ) : (\n            <>\n              {/* ë°ìŠ¤í¬í†± í…Œì´ë¸” ë·° */}\n              <div className=\"hidden md:block overflow-x-auto\">\n                <table className=\"w-full min-w-fit\">\n                  <thead className=\"bg-gray-50 border-b border-gray-200\">\n                    <tr>\n                      <th className=\"px-3 py-2.5 text-center text-[10px] font-semibold text-gray-500 uppercase tracking-wider\">ì¢…ë¥˜</th>\n                      <th className=\"px-3 py-2.5 text-center text-[10px] font-semibold text-gray-500 uppercase tracking-wider\">ìƒíƒœ</th>\n                      <th className=\"px-3 py-2.5 text-center text-[10px] font-semibold text-gray-500 uppercase tracking-wider\">ìˆ˜ëŸ‰/ê¸ˆì•¡</th>\n                      <th className=\"px-3 py-2.5 text-center text-[10px] font-semibold text-gray-500 uppercase tracking-wider\">ì—…ë¡œë“œì¼</th>\n                      <th className=\"px-3 py-2.5 text-center text-[10px] font-semibold text-gray-500 uppercase tracking-wider\">ëª…ì„¸ì„œì¼</th>\n                      <th className=\"px-3 py-2.5 text-left text-[10px] font-semibold text-gray-500 uppercase tracking-wider\">ê±°ë˜ì²˜ëª…</th>\n                      <th className=\"px-3 py-2.5 text-right text-[10px] font-semibold text-gray-500 uppercase tracking-wider\">í•©ê³„ê¸ˆì•¡</th>\n                      <th className=\"px-3 py-2.5 text-center text-[10px] font-semibold text-gray-500 uppercase tracking-wider\">ë“±ë¡ì</th>\n                      <th className=\"px-3 py-2.5 text-center text-[10px] font-semibold text-gray-500 uppercase tracking-wider\">ìˆ˜ëŸ‰í™•ì¸</th>\n                      <th className=\"px-3 py-2.5 text-center text-[10px] font-semibold text-gray-500 uppercase tracking-wider\">ê¸ˆì•¡í™•ì •</th>\n                      <th className=\"px-3 py-2.5 text-center text-[10px] font-semibold text-gray-500 uppercase tracking-wider\">ì•¡ì…˜</th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"bg-white divide-y divide-gray-100\">\n                    {filteredStatements.map((statement) => (\n                      <tr\n                        key={statement.id}\n                        className=\"hover:bg-gray-50 transition-colors cursor-pointer [&>td]:align-middle\"\n                        onClick={(e) => handleViewStatement(statement, e)}\n                      >\n                        <td className=\"px-3 py-2.5\">\n                          <div className=\"flex items-center justify-center h-full\">\n                            <span className={`inline-flex items-center gap-1 business-radius-badge px-2 py-0.5 text-[10px] font-medium leading-tight ${\n                              statement.statement_mode === 'monthly' ? 'bg-emerald-100 text-emerald-700' :\n                              statement.statement_mode === 'receipt' ? 'bg-orange-100 text-orange-700' :\n                              'bg-blue-100 text-blue-700'\n                            }`}>\n                              {statement.statement_mode === 'monthly' ? 'ì›”ë§ê²°ì œ' :\n                               statement.statement_mode === 'receipt' ? 'ì…ê³ ìˆ˜ëŸ‰' :\n                               'ì¼ë°˜'}\n                            </span>\n                          </div>\n                        </td>\n                        <td className=\"px-3 py-2.5 text-center\">\n                          {extractingIds.has(statement.id) \n                            ? renderStatusBadge('processing') \n                            : renderStatusBadge(statement.status, statement.extraction_error, statement.statement_mode, statement)}\n                        </td>\n                        <td className=\"px-3 py-2.5 text-center\">\n                          {(statement.status === 'extracted' || statement.status === 'confirmed') ? (\n                            <div className=\"flex items-center justify-center gap-1 text-[11px] font-medium\">\n                              <span className={statement.quantity_match_confirmed_at ? 'text-green-600' : 'text-gray-400'}>\n                                ìˆ˜ëŸ‰{statement.quantity_match_confirmed_at ? 'âœ“' : ''}\n                              </span>\n                              <span className=\"text-gray-300\">|</span>\n                              <span className={statement.manager_confirmed_at ? 'text-green-600' : 'text-gray-400'}>\n                                ê¸ˆì•¡{statement.manager_confirmed_at ? 'âœ“' : ''}\n                              </span>\n                            </div>\n                          ) : (\n                            <span className=\"text-[11px] text-gray-300\">-</span>\n                          )}\n                        </td>\n                        <td className=\"px-3 py-2.5 text-[11px] text-center text-gray-600\">\n                          {formatDate(statement.uploaded_at)}\n                        </td>\n                        <td className=\"px-3 py-2.5 text-[11px] text-center text-gray-600\">\n                          {statement.statement_date ? formatDate(statement.statement_date) : '-'}\n                        </td>\n                        <td className=\"px-3 py-2.5 text-[11px] font-medium text-gray-900\">\n                          {statement.vendor_name || '-'}\n                        </td>\n                        <td className=\"px-3 py-2.5 text-[11px] font-medium text-right text-gray-900\">\n                          {formatAmount(statement.grand_total ?? statement.total_amount)}\n                        </td>\n                        <td className=\"px-3 py-2.5 text-[11px] text-center text-gray-600\">\n                          {isAppAdmin ? (\n                            <div className=\"flex justify-center\" data-uploader-control=\"true\">\n                              <Popover \n                                open={editingUploaderId === statement.id} \n                                onOpenChange={(open) => setEditingUploaderId(open ? statement.id : null)}\n                              >\n                                <PopoverTrigger asChild>\n                                  <Button\n                                    variant=\"outline\"\n                                    role=\"combobox\"\n                                    className=\"h-6 w-20 justify-between text-[10px] px-2 border-gray-200\"\n                                    onClick={(e) => e.stopPropagation()}\n                                  >\n                                    <span className=\"truncate\">\n                                      {statement.uploaded_by_name || '-'}\n                                    </span>\n                                    <ChevronsUpDown className=\"ml-1 h-3 w-3 shrink-0 opacity-50\" />\n                                  </Button>\n                                </PopoverTrigger>\n                                <PopoverContent className=\"w-[180px] p-0\" align=\"center\" data-uploader-control=\"true\" onClick={(e) => e.stopPropagation()}>\n                                  <Command>\n                                    <CommandInput placeholder=\"ì´ë¦„ ê²€ìƒ‰...\" className=\"h-8 text-xs\" onKeyDown={(e) => e.stopPropagation()} />\n                                    <CommandList>\n                                      <CommandEmpty>ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ</CommandEmpty>\n                                      <CommandGroup className=\"max-h-[200px] overflow-auto\">\n                                        {employees.map((emp) => (\n                                          <CommandItem\n                                            key={emp.id}\n                                            value={emp.name}\n                                            onMouseDown={(e) => e.stopPropagation()}\n                                            onClick={(e) => e.stopPropagation()}\n                                            onSelect={() => {\n                                              handleUploaderChange(statement.id, emp.id);\n                                            }}\n                                            className=\"text-[11px]\"\n                                          >\n                                            <Check\n                                              className={`mr-2 h-3 w-3 ${\n                                                statement.uploaded_by === emp.id ? \"opacity-100\" : \"opacity-0\"\n                                              }`}\n                                            />\n                                            {emp.name}\n                                          </CommandItem>\n                                        ))}\n                                      </CommandGroup>\n                                    </CommandList>\n                                  </Command>\n                                </PopoverContent>\n                              </Popover>\n                            </div>\n                          ) : (\n                            statement.uploaded_by_name || '-'\n                          )}\n                        </td>\n                        <td className=\"px-3 py-2.5 text-[11px] text-center text-gray-600\">\n                          {statement.quantity_match_confirmed_by_name || '-'}\n                        </td>\n                        <td className=\"px-3 py-2.5 text-[11px] text-center text-gray-600\">\n                          {statement.manager_confirmed_by_name || '-'}\n                        </td>\n                        <td className=\"px-3 py-2.5 text-center\">\n                          <div className=\"flex items-center justify-center gap-1\">\n                {statement.status === 'failed' && (\n                              <Button\n                                type=\"button\"\n                                onClick={(e) => handleStartExtraction(e, statement)}\n                                className=\"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50\"\n                              >\n                                {statement.status === 'failed' ? 'ì¬ì‹œë„' : 'ì¶”ì¶œ ì‹œì‘'}\n                              </Button>\n                            )}\n                            <button\n                              onClick={(e) => handleViewImage(e, statement.image_url)}\n                              className=\"p-1.5 rounded-md hover:bg-gray-100 text-gray-500 hover:text-gray-700 transition-colors\"\n                              title=\"ì´ë¯¸ì§€ ë³´ê¸°\"\n                            >\n                              <ImageIcon className=\"w-3.5 h-3.5\" />\n                            </button>\n                            <button\n                              onClick={(e) => handleDelete(e, statement)}\n                              className=\"p-1.5 rounded-md hover:bg-red-50 text-red-400 hover:text-red-600 transition-colors\"\n                              title=\"ì‚­ì œ\"\n                            >\n                              <Trash2 className=\"w-3.5 h-3.5\" />\n                            </button>\n                          </div>\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n\n              {/* ëª¨ë°”ì¼ ì¹´ë“œ ë·° */}\n              <div className=\"md:hidden divide-y divide-gray-100\">\n                {filteredStatements.map((statement) => (\n                  <div\n                    key={statement.id}\n                    className=\"p-3 hover:bg-gray-50 transition-colors cursor-pointer\"\n                    onClick={(e) => handleViewStatement(statement, e)}\n                  >\n                    <div className=\"flex items-start justify-between mb-2\">\n                      <div className=\"flex items-center gap-1.5\">\n                        <span className={`inline-flex items-center gap-1 business-radius-badge px-2 py-0.5 text-[10px] font-medium leading-tight ${\n                          statement.statement_mode === 'monthly' ? 'bg-emerald-100 text-emerald-700' :\n                          statement.statement_mode === 'receipt' ? 'bg-orange-100 text-orange-700' :\n                          'bg-blue-100 text-blue-700'\n                        }`}>\n                          {statement.statement_mode === 'monthly' ? 'ì›”ë§ê²°ì œ' :\n                           statement.statement_mode === 'receipt' ? 'ì…ê³ ìˆ˜ëŸ‰' :\n                           'ì¼ë°˜'}\n                        </span>\n                        {extractingIds.has(statement.id) \n                          ? renderStatusBadge('processing') \n                          : renderStatusBadge(statement.status, statement.extraction_error, statement.statement_mode, statement)}\n                    </div>\n                      <span className=\"text-[10px] text-gray-400\">\n                        {formatDate(statement.uploaded_at)}\n                      </span>\n                    </div>\n                    <div className=\"mb-2\">\n                      <p className=\"text-[11px] font-medium text-gray-900\">\n                        {statement.vendor_name || 'ê±°ë˜ì²˜ ë¯¸í™•ì¸'}\n                      </p>\n                    </div>\n                    {(statement.grand_total || statement.total_amount) && (\n                      <p className=\"text-[12px] font-bold text-gray-900\">\n                        {formatAmount(statement.grand_total ?? statement.total_amount)}\n                      </p>\n                    )}\n                    <div className=\"flex items-center justify-end gap-2 mt-2 pt-2 border-t border-gray-100\">\n                  {statement.status === 'failed' && (\n                        <Button\n                          type=\"button\"\n                          onClick={(e) => handleStartExtraction(e, statement)}\n                          className=\"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50\"\n                        >\n                          {statement.status === 'failed' ? 'ì¬ì‹œë„' : 'ì¶”ì¶œ ì‹œì‘'}\n                        </Button>\n                      )}\n                      <button\n                        onClick={(e) => handleViewImage(e, statement.image_url)}\n                        className=\"button-base px-2 py-1 text-[10px] border border-gray-200 text-gray-600 hover:bg-gray-50\"\n                      >\n                        <ImageIcon className=\"w-3 h-3 mr-1\" />\n                        ë³´ê¸°\n                      </button>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* ì—…ë¡œë“œ ëª¨ë‹¬ */}\n      <StatementUploadModal\n        isOpen={isUploadModalOpen}\n        onClose={() => setIsUploadModalOpen(false)}\n        onSuccess={handleUploadSuccess}\n      />\n\n      {/* ì…ê³ ìˆ˜ëŸ‰ ì—…ë¡œë“œ ëª¨ë‹¬ */}\n      <ReceiptQuantityUploadModal\n        isOpen={isReceiptUploadModalOpen}\n        onClose={() => setIsReceiptUploadModalOpen(false)}\n        onSuccess={handleUploadSuccess}\n      />\n\n      {/* ì›”ë§ê²°ì œ ì—…ë¡œë“œ ëª¨ë‹¬ */}\n      <MonthlyStatementUploadModal\n        isOpen={isMonthlyUploadModalOpen}\n        onClose={() => setIsMonthlyUploadModalOpen(false)}\n        onSuccess={async (statementId: string) => {\n          setIsMonthlyUploadModalOpen(false);\n          toast.success('ì›”ë§ê²°ì œ ê±°ë˜ëª…ì„¸ì„œ ì—…ë¡œë“œ ì™„ë£Œ. íŒŒì‹± ì²˜ë¦¬ ì¤‘...');\n          await loadStatements();\n        }}\n      />\n\n      {/* í™•ì¸/ìˆ˜ì •/í™•ì • ëª¨ë‹¬ */}\n      {selectedStatement && (\n        <StatementConfirmModal\n          isOpen={isConfirmModalOpen}\n          statement={selectedStatement}\n          onClose={handleConfirmModalClose}\n          onConfirm={handleConfirmModalClose}\n          onReextractStart={handleReextractStartFromModal}\n          onReextractFinish={handleReextractFinishFromModal}\n        />\n      )}\n\n      {/* ì´ë¯¸ì§€ ë·°ì–´ */}\n      <StatementImageViewer\n        isOpen={isImageViewerOpen}\n        imageUrl={viewerImageUrl}\n        onClose={() => {\n          setIsImageViewerOpen(false);\n          setViewerImageUrl(\"\");\n        }}\n      />\n\n      {/* ë°œì£¼ ëª©ë¡ ë“œë¡­ë‹¤ìš´ */}\n      {purchaseDropdown.isOpen && purchaseDropdown.statement && (\n        <>\n          {/* ì˜¤ë²„ë ˆì´ */}\n          <div \n            className=\"fixed inset-0 z-40\" \n            onClick={handleClosePurchaseDropdown}\n          />\n          {/* ë“œë¡­ë‹¤ìš´ */}\n          <div \n            className=\"fixed z-50 bg-white border border-gray-200 rounded-lg shadow-lg min-w-[280px] max-w-[360px]\"\n            style={{\n              top: purchaseDropdown.position.top + 4,\n              left: purchaseDropdown.position.left\n            }}\n          >\n            <div className=\"flex items-center justify-between px-3 py-2 border-b border-gray-100 bg-gray-50 rounded-t-lg\">\n              <span className=\"text-[11px] font-semibold text-gray-700\">\n                ì—°ê²°ëœ ë°œì£¼ ({purchaseDropdown.statement.matched_purchases?.length || 0}ê±´)\n              </span>\n              <button\n                onClick={handleClosePurchaseDropdown}\n                className=\"p-0.5 hover:bg-gray-200 rounded\"\n              >\n                <X className=\"w-3.5 h-3.5 text-gray-500\" />\n              </button>\n            </div>\n            <div className=\"max-h-[300px] overflow-auto\">\n              {purchaseDropdown.statement.matched_purchases?.map((purchase, idx) => (\n                <div\n                  key={purchase.purchase_id}\n                  onClick={() => handleSelectPurchase(purchase.purchase_id)}\n                  className=\"flex items-center justify-between px-3 py-2.5 hover:bg-blue-50 cursor-pointer border-b border-gray-50 last:border-0 transition-colors\"\n                >\n                  <div className=\"flex-1\">\n                    <p className=\"text-[12px] font-medium text-gray-900\">\n                      {purchase.purchase_order_number || purchase.sales_order_number || `ë°œì£¼ #${purchase.purchase_id}`}\n                    </p>\n                    {purchase.sales_order_number && purchase.purchase_order_number && (\n                      <p className=\"text-[10px] text-gray-500\">\n                        ìˆ˜ì£¼: {purchase.sales_order_number}\n                      </p>\n                    )}\n                  </div>\n                  <div className=\"flex items-center gap-1 text-blue-600\">\n                    <span className=\"text-[10px]\">ìƒì„¸ë³´ê¸°</span>\n                    <ChevronRight className=\"w-3.5 h-3.5\" />\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        </>\n      )}\n\n      {/* ë°œì£¼ ìƒì„¸ ëª¨ë‹¬ */}\n      {selectedPurchaseId && (\n        <PurchaseDetailModal\n          purchaseId={selectedPurchaseId}\n          isOpen={isPurchaseModalOpen}\n          onClose={() => {\n            setIsPurchaseModalOpen(false);\n            setSelectedPurchaseId(null);\n          }}\n          activeTab=\"done\"\n          forceShowStatementColumns={true}\n        />\n      )}\n    </div>\n  );\n}\n"],"names":["CircleX","createLucideIcon","cx","cy","r","key","d","ExternalLink","FileSpreadsheet","RefreshCw","RotateCw","SlidersHorizontal","x1","x2","y1","y2","StatementUploadModal","isOpen","onClose","onSuccess","file","setFile","useState","preview","setPreview","uploading","setUploading","uploaderName","setUploaderName","actualReceiptDate","setActualReceiptDate","poScope","setPoScope","fileInputRef","useRef","supabase","createClient","useEffect","async","data","user","auth","getUser","email","employee","from","select","eq","single","name","e","loadUserName","handleFileSelect","selectedFile","type","startsWith","size","toast","error","createImageBitmap","then","bitmap","canvas","document","createElement","width","height","ctx","getContext","drawImage","toDataURL","catch","reader","FileReader","onloadend","result","readAsDataURL","handleClose","current","value","jsx","Dialog","open","onOpenChange","children","jsxs","DialogContent","className","DialogHeader","DialogTitle","Upload","onDrop","preventDefault","stopPropagation","droppedFile","dataTransfer","files","onDragOver","onClick","click","ref","accept","onChange","target","src","alt","X","Fragment","ImageIcon","Select","onValueChange","disabled","SelectTrigger","SelectValue","placeholder","SelectContent","SelectItem","DateQuantityPickerPopover","onConfirm","date","align","side","hideQuantityInput","format","DialogFooter","Button","variant","transactionStatementService","uploadStatement","success","statementId","imageUrl","Loader2","ReceiptQuantityUploadModal","uploadReceiptQuantity","ACCEPTED_EXTENSIONS","getFileType","ext","split","pop","toLowerCase","includes","MonthlyStatementUploadModal","fileType","uploadMonthlyStatement","fileUrl","StatementImageViewer","scale","setScale","rotation","setRotation","prev","Math","max","ZoomOut","round","min","ZoomIn","response","fetch","blob","url","window","URL","createObjectURL","a","href","download","Date","toISOString","body","appendChild","removeChild","revokeObjectURL","Download","style","transform","calculateStringSimilarity","ocrName","targetName","ocr","replace","minLen","length","maxLen","lengthRatio","similarity","str1","str2","s1","s2","matrix","i","j","cost","levenshteinDistance","ocrWords","filter","w","targetWords","wordMatchBonus","some","tw","wLower","twLower","calculateItemSimilarity","systemItemName","systemSpec","itemNameScore","specScore","isQuantityMatched","ocrQuantity","systemQuantity","StatementConfirmModal","statement","onReextractStart","onReextractFinish","loading","setLoading","saving","setSaving","savingAction","setSavingAction","statementWithItems","setStatementWithItems","isImageViewerOpen","setIsImageViewerOpen","confirmerName","setConfirmerName","dialogDebugId","currentUserRoles","currentUserId","currentUserName","useAuth","selectedPONumber","setSelectedPONumber","itemPONumbers","setItemPONumbers","Map","itemMatches","setItemMatches","openDropdowns","setOpenDropdowns","Set","dropdownPosition","setDropdownPosition","top","left","isPurchaseDetailModalOpen","setIsPurchaseDetailModalOpen","selectedPurchaseIdForDetail","setSelectedPurchaseIdForDetail","editedOCRItems","setEditedOCRItems","editDebounceTimerRef","matchDetailPopup","setMatchDetailPopup","purchaseCurrencyMap","setPurchaseCurrencyMap","isReceiptMode","statement_mode","items","slice","map","item","matchedSystem","get","id","itemId","matched","Boolean","sysUnitPrice","unit_price","sysAmount","amount","sysKeys","Object","keys","Array","values","find","purchaseIds","purchase_id","uniqueIds","in","forEach","row","set","currency","loadCurrencies","isIntegratedMatchDetailOpen","setIsIntegratedMatchDetailOpen","vendorInputValue","setVendorInputValue","vendorSearchResults","setVendorSearchResults","vendorSearchLoading","setVendorSearchLoading","vendorDropdownOpen","setVendorDropdownOpen","overrideVendorName","setOverrideVendorName","poItemsMap","setPoItemsMap","autoVendorSelectionRef","systemCandidateLogKeyRef","poSearchInputOpen","setPOSearchInputOpen","poSearchInput","setPOSearchInput","poSearchResults","setPOSearchResults","poSearchLoading","setPOSearchLoading","poDropdownOpen","setPODropdownOpen","manuallySelectedPO","setManuallySelectedPO","keepPODropdownOpenRef","itemPOSearchInputs","setItemPOSearchInputs","itemPOSearchResults","setItemPOSearchResults","itemPOSearchLoading","setItemPOSearchLoading","lastSelectedSystemItemRef","statementDateInput","setStatementDateInput","poPairOverrides","setPoPairOverrides","pendingPairLookupsRef","clearTimeout","logMetrics","reason","el","querySelector","documentElement","getBoundingClientRect","getComputedStyle","rafId","requestAnimationFrame","handleResize","addEventListener","cancelAnimationFrame","removeEventListener","setMatchResult","setSetMatchResult","isSamePONumber","useMemo","po_scope","poNumbers","extracted_po_number","normalizeOrderNumber","every","po","commonPONumber","poNumber","initialVendor","vendor_name","handleSelectVendor","silent","normalizeStatementDate","trimmed","trim","test","parsed","Number","isNaN","getTime","statement_date","loadData","useCallback","getStatementWithItems","method","headers","JSON","stringify","sessionId","runId","hypothesisId","location","message","itemCount","sample","line","line_number","itemName","extracted_item_name","specification","extracted_specification","quantity","extracted_quantity","unitPrice","extracted_unit_price","extracted_amount","matchedPurchaseId","matched_purchase_id","matchedItemId","matched_item_id","timestamp","now","initialPONumbers","initialMatches","hasCandidateMatch","match_candidates","c","purchase_order_number","sales_order_number","matched_purchase","matchedPO","item_id","item_name","matched_item","matched_item_name","matched_item_quantity","unit_price_value","matched_item_unit_price","amount_value","matched_item_amount","received_quantity","bestMatch","bestScore","matchingCandidates","score","has","bestCandidate","reduce","best","recommendedPO","candidatesForPO","bestItem","bestItemScore","itemPO","candidates","initialMatchedValues","matchCount","missingAmountCount","m","zeroUnitPriceCount","firstPO","isSingleScope","setMatchResponse","findBestMatchingPurchaseOrderSet","bestPO","autoMatchedItems","match","candidate","systemItemId","ocrItemId","mergedMatches","mergedValues","selectedPO","mergedCount","confidence","confText","matchedItemCount","fallbackCandidate","fallbackPO","newMatches","newPONumbers","hasMatchChanges","hasPOChanges","ocrItem","currentMatch","currentDisplayPO","newMatchValues","totalComputed","allPONumberCandidates","firstExtracted","useSONumber","toUpperCase","candidateMap","salesOrderNumber","vendorName","setMatchScore","matchScore","purchaseId","existing","push","normalizedKey","isSO","match_reasons","totalScore","matchedCount","quantityMatchedCount","quantityMismatchedCount","hasOrderNumberMatch","getOCRItemValue","num","candidateItems","bestMatchItem","ocrItemName","sysItem","ocrQtyRaw","ocrQty","sysQty","baseScore","quantityBonus","actualScore","orderNumberBonus","displayScore","sort","b","aHasMatch","bHasMatch","scoreA","scoreB","getPairedOrderNumber","normalizedValue","getPairedOrderNumberWithOverrides","normalized","override","matchingCandidate","matchingPO","firstCandidate","newPO","getSystemItemsForPO","mappedItems","index","self","findIndex","t","getPOCandidatesForItem","add","persistSingleOCRItem","field","dbField","po_number","dbValue","update","logger","warn","handleEditOCRItem","newMap","setTimeout","persistEditedOCRItems","updates","entries","edited","updateData","Promise","all","updatedItems","u","isOCRItemEdited","original","saveOCRCorrections","corrections","statement_id","statement_item_id","original_text","corrected_text","field_type","String","correction","saveCorrection","handleSelectGlobalPO","vendorNameFromSearch","soNumberFromSearch","normalizedPO","next","poCandidate","systemItems","purchaseRequest","or","limit","vendor","pairedNumber","purchaseItems","newEditedItems","newItemPONumbers","lookupPairedOrderNumber","rawValue","err","delete","handleOCRPONumberChange","newValue","purchaseData","purchase","purchase_request_items","newItems","options","shouldNotify","purchases","order","ascending","itemsMap","totalMapItems","newCandidates","maxSimilarity","comparedCount","existingMatch","totalItemCount","p","handleSelectItemPO","finalMatch","matchFound","candidateCount","persistMatchChange","newSet","getPurchaseIdByNumber","handleOpenPurchaseDetail","handleItemPOSearch","searchValue","results","soNumber","systemItem","handleSelectSystemItem","didUpdate","nextMap","enriched","sys","effectiveConfirmerName","uploaderId","uploaded_by","isAppAdmin","isLeadBuyer","isUploader","isManagerConfirmed","manager_confirmed_at","isQuantityMatchConfirmed","quantity_match_confirmed_at","isStatementConfirmed","status","isConfirmDisabled","isQuantityMatchDisabled","confirmButtonLabel","quantityMatchButtonLabel","formatAmount","toLocaleString","getTotalsCurrencySymbol","currencies","unique","getSystemAmount","matchedValues","totalFromUI","sum","totalFromUnitPriceQty","amountFieldCount","derivedOnlyCount","nullAmountAndCannotDeriveCount","resolvedAmount","getSystemItemLabel","spec","toggleDropdown","event","rect","currentTarget","dropdownWidth","getDropdownWidth","viewportPadding","maxLeft","innerWidth","nextLeft","bottom","clear","handleGlobalPODropdownWheel","beforeScrollTop","scrollTop","maxScrollTop","scrollHeight","clientHeight","nextScrollTop","deltaY","maxWidth","showCloseButton","onInteractOutside","CheckCircle","image_url","extractStatementData","queued","info","screenX","outerWidth","screenY","outerHeight","vendors","ilike","handleVendorSearch","onFocus","onBlur","fontSize","fontWeight","onMouseDown","newDate","grand_total","total_amount","colSpan","ChevronDown","title","handlePOSearch","autoFocus","searchUpper","selectedNumber","Search","selectedCandidate","firstItem","currentValue","rowIndex","effectiveMatch","getMatchStatus","normalizedExtractedPO","poCandidates","normalizedCandidates","candidateSet","normalizedSelectedPO","extractedInDb","matchedPONumber","rawOrderedPOs","orderedPOs","nextItem","nextItemPO","normalizedExtracted","selected","normalizedSelected","getDisplayPOForItem","rowClassName","itemSearchValue","itemSearchResults","itemSearchLoading","activePONumber","systemCandidates","fallbackCandidates","displaySystemCandidates","scoredSystemCandidates","logKey","normalizedSelectedPONumber","pairedOrderNumber","normalizedPairedOrderNumber","extractedOrderNumbers","isFirstRow","createPortal","idx","paired","isPreferred","isRecommended","XCircle","cidx","rowSpan","verticalAlign","confirm","rejectStatement","confirmItems","confirmedQuantity","confirmed_quantity","confirmQuantityMatch","actual_received_date","extracted_data","updatedStatement","finalized","normalizedOriginalDate","normalizedInputDate","dateError","Error","confirmedUnitPrice","confirmedAmount","confirmed_unit_price","confirmed_amount","confirmStatement","accounting_received_date","Check","renderMatchStatusBadge","toFixed","reasons","totalMatchScore","totalCount","isOrderNumberMatched","matchedNameCount","isItemNameAllMatched","isQuantityAllMatched","isMatched","qtyMatched","qtyLevel","pointerEvents","onWheel","displayNumber","isSelected","isBestMatch","PurchaseDetailModal","activeTab","forceShowStatementColumns","TransactionStatementMain","statements","setStatements","searchTerm","setSearchTerm","statusFilter","setStatusFilter","dateFilter","setDateFilter","setTotalCount","showFilters","setShowFilters","setActiveTab","employees","setEmployees","editingUploaderId","setEditingUploaderId","isUploadModalOpen","setIsUploadModalOpen","isReceiptUploadModalOpen","setIsReceiptUploadModalOpen","isMonthlyUploadModalOpen","setIsMonthlyUploadModalOpen","selectedStatement","setSelectedStatement","isConfirmModalOpen","setIsConfirmModalOpen","viewerImageUrl","setViewerImageUrl","extractingIds","setExtractingIds","isPurchaseModalOpen","setIsPurchaseModalOpen","selectedPurchaseId","setSelectedPurchaseId","purchaseDropdown","setPurchaseDropdown","position","filteredStatements","defaultCount","receiptCount","defaultItems","s","receiptItems","loadEmployees","loadStatements","getStatements","dateFrom","search","count","kickQueue","supabaseRef","realtimeChannelRef","realtimeReconnectAttemptsRef","shouldReconnectRef","realtimeIsSubscribingRef","realtimeIsSubscribedRef","random","toString","subscribeRealtime","removeChannel","channel","on","schema","table","payload","eventType","newStatus","new","oldStatus","old","subscribe","getSession","token","session","access_token","realtime","setAuth","connect","_","setupRealtimeAuth","finally","renderStatusBadge","errorMessage","statementMode","baseClass","Clock","AlertCircle","handleViewStatement","closest","matched_purchases","scrollY","scrollX","handleClosePurchaseDropdown","handleViewImage","handleStartExtraction","handleUploadSuccess","handleConfirmModalClose","formatDate","dateString","toLocaleDateString","year","month","day","marginTop","marginBottom","DropdownMenu","DropdownMenuTrigger","asChild","Plus","DropdownMenuContent","DropdownMenuItem","FileCheck","Package","Input","Card","CardContent","extraction_error","uploaded_at","Popover","PopoverTrigger","role","uploaded_by_name","ChevronsUpDown","PopoverContent","Command","CommandInput","onKeyDown","CommandList","CommandEmpty","CommandGroup","emp","CommandItem","onSelect","newUploaderId","selectedEmployee","fallbackError","handleUploaderChange","quantity_match_confirmed_by_name","manager_confirmed_by_name","file_name","deleteStatement","handleDelete","Trash2","handleSelectPurchase","ChevronRight"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5]}