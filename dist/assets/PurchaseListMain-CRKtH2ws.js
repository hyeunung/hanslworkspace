const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FastPurchaseTable-BKKjsFi5.js","assets/index-Brwo9CUA.js","assets/index-CRgX5jue.css","assets/index-Ch4C4NOD.js","assets/PurchaseDetailModal-B1aNeDm0.js","assets/helpers-C_CnFjYT.js","assets/input-D3R-eHKn.js","assets/dialog-VIbEMdHP.js","assets/format-qOGJcsD7.js","assets/circle-check-big-CVbpQGTU.js","assets/eye-BIercPw3.js","assets/chevron-down-D4hjz2oT.js","assets/popover-bm0UzC7Z.js","assets/calendar-ht1s7tch.js","assets/package-BMX4ZGvS.js","assets/credit-card-BtoRGPUg.js","assets/trash-2-D1LWORAj.js","assets/plus-Butu8xAr.js","assets/save-oymwhYL7.js","assets/PurchaseItemsModal-YDD9nM7w.js","assets/table-CsSmzmig.js"])))=>i.map(i=>d[i]);
import{r as e,a as t,l as s,j as r,_ as a,u as n,e as l,B as i}from"./index-Brwo9CUA.js";import{t as c,B as o}from"./index-Ch4C4NOD.js";import{I as u}from"./input-D3R-eHKn.js";import{S as m,a as d,b as p,c as _,d as h}from"./select-CREcSSR4.js";import{C as f}from"./combobox-RsWtFTNC.js";import{C as x,a as g,b as y,c as v,S as b}from"./card-CzmATjQt.js";import{P as j}from"./plus-Butu8xAr.js";import{F as w}from"./funnel-Bs7clSzj.js";import{P as N}from"./package-BMX4ZGvS.js";import"./chevron-down-D4hjz2oT.js";import"./popover-bm0UzC7Z.js";const S={purchases:null,vendors:null,employees:null,lastFetch:0,userInfo:null,CACHE_DURATION:12e4};const q=["정희웅"],C=new Map,F=100,k=(s,r,a,n,l)=>{const i=t(),[c,o]=e.useState("pending"),[u,m]=e.useState(""),[d,p]=e.useState(""),[_,h]=e.useState(""),[f,x]=e.useState(""),[g,y]=e.useState(""),[v,b]=e.useState(""),[j,w]=e.useState(""),[N,S]=e.useState(""),[k,T]=e.useState(""),[E,I]=e.useState(""),R=function(t,s=500){const[r,a]=e.useState(t);return e.useEffect(()=>{const e=setTimeout(()=>{a(t)},s);return()=>{clearTimeout(e)}},[t,s]),r}(u,300),D=r?.includes("app_admin");r?.includes("final_approver"),r?.includes("middle_manager");const L=r?.includes("purchase_manager"),P=r?.includes("raw_material_manager")||r?.includes("consumable_manager")||r?.includes("purchase_manager"),A=e.useMemo(()=>r&&0!==r.length?L?2:r.some(e=>["middle_manager","final_approver","app_admin","ceo"].includes(e))?3:1:1,[r,L]),U=e.useCallback(e=>{if(!a)return"all";if("purchase"===e)return P||D?"all":a;switch(A){case 1:case 2:return"done"===e?"all":a;case 3:return"all";default:return a}},[a,A,P,D]);e.useEffect(()=>{if(!a)return;const e=U(c);h(e)},[c,a,A,U]);const M=e.useMemo(()=>{try{const e=`visible_${s.length}_${r.join(",")}`;if(C.has(e))return C.get(e);let t;if(t=r.includes("purchase_manager")||r.includes("app_admin")?s:s.filter(e=>!q.includes(e.requester_name)),C.size>=F){const e=C.keys().next().value;C.delete(e)}return C.set(e,t),t}catch(e){return C.clear(),r.includes("purchase_manager")||r.includes("app_admin")?s:s.filter(e=>!q.includes(e.requester_name))}},[s,r]),O=e.useMemo(()=>{const e=`date_${M.length}_${k}_${E}`;if(C.has(e))return C.get(e);const t=M.filter(e=>{const t=e.request_date?e.request_date.split("T")[0]:"";return(!k||t>=k)&&(!E||t<=E)});if(C.size>=F){const e=C.keys().next().value;C.delete(e)}return C.set(e,t),t},[M,k,E]),$=e.useMemo(()=>{const e=`tab_${O.length}_${c}`;if(C.has(e))return C.get(e);const t=O.filter(e=>{let t=!1;switch(c){case"pending":const s=["pending","대기","",null,void 0].includes(e.middle_manager_status),r=["pending","대기","",null,void 0].includes(e.final_manager_status),a="rejected"===e.middle_manager_status,n="rejected"===e.final_manager_status;return!a&&!n&&(t=s||r,t);case"purchase":{const s="구매 요청"===e.payment_category,r=!e.is_payment_completed,a=(e.progress_type||"").includes("선진행"),n=(e.progress_type||"").includes("일반"),l="approved"===e.final_manager_status;return t=!(!s||!r)&&(a||n&&l),t}case"receipt":{const s=!e.is_received,r=(e.progress_type||"").includes("선진행"),a="approved"===e.final_manager_status;return t=s&&(r||a),t}case"done":return t=!0,t;default:return!0}});if(C.size>=F){const e=C.keys().next().value;C.delete(e)}return C.set(e,t),t},[O,c]),z=e.useMemo(()=>{const e=`employee_${$.length}_${_}`;if(C.has(e))return C.get(e);let t;if(t=_&&"all"!==_&&"전체"!==_?$.filter(e=>e.requester_name===_):$,C.size>=F){const e=C.keys().next().value;C.delete(e)}return C.set(e,t),t},[$,_]),V=e.useMemo(()=>d?z.filter(e=>e.vendor_name===d):z,[z,d]),B=e.useMemo(()=>{let e=V;if(f){const t=f.trim().toLowerCase();e=e.filter(e=>e.purchase_order_number?.toLowerCase().includes(t))}if(g){const t=g.trim().toLowerCase();e=e.filter(e=>!!(e.items&&e.items.length>0)&&e.items.some(e=>e.item_name?.toLowerCase().includes(t)))}if(v){const t=v.trim().toLowerCase();e=e.filter(e=>!!(e.items&&e.items.length>0)&&e.items.some(e=>e.specification?.toLowerCase().includes(t)))}if(j&&"all"!==j&&(e=e.filter(e=>{switch(j){case"pending":return!e.final_manager_status||"pending"===e.final_manager_status||"대기"===e.final_manager_status;case"approved":return"approved"===e.final_manager_status;case"rejected":return"rejected"===e.final_manager_status||"rejected"===e.middle_manager_status;default:return!0}})),N){const t=N.trim().toLowerCase();e=e.filter(e=>!!(e.items&&e.items.length>0)&&e.items.some(e=>e.remark?.toLowerCase().includes(t)))}return e},[V,f,g,v,j,N]),H=e.useMemo(()=>{if(!R)return B;const e=R.trim().toLowerCase();return B.filter(t=>!!(t.purchase_order_number?.toLowerCase().includes(e)||t.vendor_name?.toLowerCase().includes(e)||t.requester_name?.toLowerCase().includes(e)||t.project_vendor?.toLowerCase().includes(e))||!!(t.items&&t.items.length>0)&&t.items.some(t=>t.item_name&&t.item_name.toLowerCase().includes(e)||t.specification&&t.specification.toLowerCase().includes(e)))},[B,R]),W=e.useMemo(()=>[...H].sort((e,t)=>{const s=e.request_date?new Date(e.request_date).getTime():0;return(t.request_date?new Date(t.request_date).getTime():0)-s}),[H,c]),G=e.useMemo(()=>{const e=M.filter(e=>{const t=e.request_date?e.request_date.split("T")[0]:"";return(!k||t>=k)&&(!E||t<=E)}),t=e=>new Set(e.map(e=>e.purchase_order_number)).size,s=t=>{if("purchase"===t)return P||D?e:e.filter(e=>e.requester_name===a);const s=U(t);return"all"===s||"전체"===s?e:e.filter(e=>e.requester_name===s)},r=s("pending"),n=s("purchase"),l=s("receipt"),i=s("done"),c=r.filter(e=>{const t=["pending","대기","",null,void 0].includes(e.middle_manager_status),s=["pending","대기","",null,void 0].includes(e.final_manager_status),r="rejected"===e.middle_manager_status,a="rejected"===e.final_manager_status;return!r&&!a&&(t||s)}),o=n.filter(e=>{const t="구매 요청"===e.payment_category,s=!e.is_payment_completed;if(!t||!s)return!1;const r=(e.progress_type||"").includes("선진행"),a=(e.progress_type||"").includes("일반"),n="approved"===e.final_manager_status;return r||a&&n}),u=l.filter(e=>{const t=!e.is_received,s=(e.progress_type||"").includes("선진행"),r="approved"===e.final_manager_status;return t&&(s||r)});return{pending:t(c),purchase:t(o),receipt:t(u),done:t(i)}},[M,k,E,A,a,U,P,D]),J=e.useRef(!1);e.useEffect(()=>{J.current||(J.current=!0,(async()=>{const{data:{user:e}}=await i.auth.getUser();if(!e)return;const{data:t}=await i.from("user_preferences").select("period_start, period_end").eq("user_id",e.id).single();if(t){const e=t.period_start?new Date(t.period_start).toISOString().split("T")[0]:"",s=t.period_end?new Date(t.period_end).toISOString().split("T")[0]:"";T(e),I(s)}})())},[]);const K=e.useRef(void 0);return e.useEffect(()=>{if(J.current)return K.current&&clearTimeout(K.current),K.current=setTimeout(async()=>{const{data:{user:e}}=await i.auth.getUser();e&&k&&E&&await i.from("user_preferences").upsert({user_id:e.id,period_start:k,period_end:E,updated_at:(new Date).toISOString()})},1e3),()=>{K.current&&clearTimeout(K.current)}},[k,E]),{activeTab:c,searchTerm:u,vendorFilter:d,dateFromFilter:k,dateToFilter:E,selectedEmployee:_,purchaseNumberFilter:f,itemNameFilter:g,specificationFilter:v,approvalStatusFilter:j,remarkFilter:N,setActiveTab:o,setSearchTerm:m,setVendorFilter:p,setDateFromFilter:T,setDateToFilter:I,setSelectedEmployee:h,setPurchaseNumberFilter:x,setItemNameFilter:y,setSpecificationFilter:b,setApprovalStatusFilter:w,setRemarkFilter:S,filteredPurchases:W,tabCounts:G}},T=e.lazy(()=>a(()=>import("./FastPurchaseTable-BKKjsFi5.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]))),E=e.memo(()=>r.jsx("div",{className:"p-4 space-y-4",children:[...Array(5)].map((e,t)=>r.jsxs("div",{className:"flex space-x-4 animate-pulse",children:[r.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),r.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),r.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),r.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"})]},t))}));E.displayName="TableSkeleton";const I=e.memo(({purchases:t,activeTab:s,currentUserRoles:a,onRefresh:n,onPaymentComplete:l,onReceiptComplete:i})=>r.jsx(e.Suspense,{fallback:r.jsx(E,{}),children:r.jsx(T,{purchases:t,activeTab:s,currentUserRoles:a,onRefresh:n,onPaymentComplete:l,onReceiptComplete:i})}));I.displayName="LazyPurchaseTable";const R=e.lazy(()=>a(()=>import("./PurchaseItemsModal-YDD9nM7w.js"),__vite__mapDeps([19,1,2,7,6,20,3,8,17,18,16]))),D=[{key:"pending",label:"승인대기"},{key:"purchase",label:"구매 현황"},{key:"receipt",label:"입고 현황"},{key:"done",label:"전체 항목"}];function L({onEmailToggle:a,showEmailButton:q=!0}){const C=n(),F=l(),T=t(),[E,L]=e.useState(null),[P,A]=e.useState({}),[U,M]=e.useState(null),[O,$]=e.useState(!1),{purchases:z,vendors:V,employees:B,loading:H,currentUserRoles:W,currentUserName:G,refreshPurchases:J}=(()=>{const[r,a]=e.useState([]),[n,l]=e.useState([]),[i,o]=e.useState([]),[u,m]=e.useState(!0),[d,p]=e.useState([]),[_,h]=e.useState(""),[f,x]=e.useState(""),[g,y]=e.useState(""),v=t(),b=e.useRef(!1);e.useEffect(()=>{(async()=>{if(b.current)return;b.current=!0;const e=Date.now(),t=S.lastFetch&&e-S.lastFetch<S.CACHE_DURATION;try{if(t&&S.vendors&&S.employees&&S.userInfo)try{l(S.vendors),o(S.employees);const e=S.userInfo;if(e){let t=[];e.purchase_role&&(t=Array.isArray(e.purchase_role)?e.purchase_role.map(e=>String(e).trim()):String(e.purchase_role).split(",").map(e=>e.trim()).filter(e=>e.length>0)),p(t),h(e.name||e.full_name||""),x(e.email||""),y(e.id||"")}return}catch(r){s.error("캐시 데이터 사용 중 오류",r),S.purchases=null,S.vendors=null,S.employees=null,S.userInfo=null,S.lastFetch=0}const[a,n,i]=await Promise.all([v.from("vendors").select("*"),v.from("employees").select("*"),v.auth.getUser()]);if(a.error)throw a.error;const c=a.data||[];if(l(c),S.vendors=c,n.error)throw n.error;const u=n.data||[];if(o(u),S.employees=u,i.data.user&&!i.error){let t=null;if(i.data.user.email&&(t=(await v.from("employees").select("*").eq("email",i.data.user.email).maybeSingle()).data),t){S.userInfo=t;let e=[];t.purchase_role&&(e=Array.isArray(t.purchase_role)?t.purchase_role.map(e=>String(e).trim()):String(t.purchase_role).split(",").map(e=>e.trim()).filter(e=>e.length>0)),p(e),h(t.name||t.full_name||""),x(t.email||""),y(t.id||"")}S.lastFetch=e}}catch(r){s.error("초기 데이터 로드 실패",r)}})()},[]);const j=e.useCallback(async e=>{m(!0);try{const r=Date.now(),n=S.lastFetch&&r-S.lastFetch<S.CACHE_DURATION;if(!e&&n&&S.purchases)try{return a(S.purchases),void m(!1)}catch(t){s.error("발주 데이터 캐시 사용 중 오류",t),S.purchases=null,S.lastFetch=0}let l=i;if(0===l.length&&(l=S.employees||[],0===l.length)){const{data:e}=await v.from("employees").select("*");l=e||[]}const{data:{user:o},error:u}=await v.auth.getUser();if(u||!o)return s.error("사용자 인증 실패",u),c.error("로그인이 필요합니다."),void m(!1);const{data:d,error:p}=await v.from("purchase_requests").select("\n          *,\n          purchase_request_items(*)\n        ").order("request_date",{ascending:!1}).limit(1e3);if(p)throw p;const _=(new Date).toISOString().split("T")[0],h=((d||[]).filter(e=>e.request_date?.startsWith(_)),(d||[]).map(e=>{const t=e.purchase_request_items?.[0]||{},s=l.find(t=>t.id===e.requester_id);return{id:Number(e.id),purchase_order_number:e.purchase_order_number,request_date:e.request_date,delivery_request_date:e.delivery_request_date,progress_type:e.progress_type,payment_completed_at:e.payment_completed_at,payment_category:e.payment_category,currency:e.currency,request_type:e.request_type,vendor:void 0,vendor_name:e.vendor_name||"",vendor_payment_schedule:"",vendor_contacts:[],requester_id:e.requester_id,requester_name:e.requester_name,requester_full_name:s?.full_name||s?.name||e.requester_name||"",item_name:t.item_name||"",specification:t.specification||"",quantity:Number(t.quantity)||0,unit_price_value:Number(t.unit_price_value)||0,amount_value:Number(t.amount_value)||0,remark:t.remark||"",project_vendor:e.project_vendor,sales_order_number:e.sales_order_number,project_item:e.project_item,line_number:Number(t.line_number)||1,contact_name:"",middle_manager_status:e.middle_manager_status,final_manager_status:e.final_manager_status,is_received:!!e.is_received,received_at:e.received_at,is_payment_completed:!!e.is_payment_completed,is_po_download:!!e.is_po_download,link:t.link,items:(e.purchase_request_items||[]).sort((e,t)=>(e.line_number||0)-(t.line_number||0)),total_amount:e.purchase_request_items?.reduce((e,t)=>e+(Number(t.amount_value)||0),0)||0,purchase_status:e.purchase_status||"pending"}}));a(h),S.purchases=h,S.lastFetch=r}catch(r){s.error("발주 목록 로드 실패",r),c.error("발주 목록을 불러올 수 없습니다.")}finally{m(!1)}},[i]);return e.useEffect(()=>{j()},[j]),{purchases:r,vendors:n,employees:i,loading:u,currentUserRoles:d,currentUserName:_,currentUserEmail:f,currentUserId:g,refreshPurchases:j}})(),K=W?.includes("app_admin"),{activeTab:Q,searchTerm:X,vendorFilter:Y,dateFromFilter:Z,dateToFilter:ee,selectedEmployee:te,purchaseNumberFilter:se,itemNameFilter:re,approvalStatusFilter:ae,setActiveTab:ne,setSearchTerm:le,setVendorFilter:ie,setDateFromFilter:ce,setDateToFilter:oe,setSelectedEmployee:ue,setPurchaseNumberFilter:me,setItemNameFilter:de,setApprovalStatusFilter:pe,filteredPurchases:_e,tabCounts:he}=k(z,W,G);e.useEffect(()=>{"purchase"===new URLSearchParams(F.search).get("tab")&&ne("purchase")},[F.search,ne]);return r.jsxs("div",{className:"w-full",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"발주요청 관리"}),r.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"발주요청서를 관리하고 승인 처리를 할 수 있습니다"})]}),r.jsxs(i,{onClick:()=>C("/purchase/new"),className:"mt-4 sm:mt-0 bg-hansl-500 hover:bg-hansl-600",children:[r.jsx(j,{className:"w-4 h-4 mr-2"}),"새 발주요청 작성"]})]}),r.jsxs(x,{className:"mb-4 border border-gray-200",children:[r.jsx(g,{className:"bg-white border-b border-gray-200 py-3",children:r.jsxs(y,{className:"flex items-center text-gray-900 text-sm font-medium",children:[r.jsx(w,{className:"w-4 h-4 mr-2"}),"검색 필터"]})}),r.jsx(v,{className:"py-3",children:r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-2",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"시작일"}),r.jsx(u,{type:"date",value:Z,onChange:e=>ce(e.target.value),className:"text-sm h-9"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"종료일"}),r.jsx(u,{type:"date",value:ee,onChange:e=>oe(e.target.value),className:"text-sm h-9"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"요청자"}),r.jsx(f,{value:te||"all",onValueChange:e=>{ue(e)},options:[{value:"all",label:"전체"},...B.filter(e=>e.name&&""!==e.name.trim()).sort((e,t)=>(e.name||"").localeCompare(t.name||"")).map(e=>({value:e.name||"",label:`${e.name}${e.name===G?" (나)":""}`}))],placeholder:"all"===te?"전체":te||"선택",searchPlaceholder:"직원 이름 검색...",emptyText:"일치하는 직원이 없습니다",className:"text-sm"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"업체"}),r.jsxs(m,{value:Y||"all",onValueChange:e=>ie("all"===e?"":e),children:[r.jsx(d,{className:"h-9 text-sm",children:r.jsx(p,{placeholder:"전체"})}),r.jsxs(_,{children:[r.jsx(h,{value:"all",children:"전체"}),V.map(e=>r.jsx(h,{value:e.vendor_name,children:e.vendor_name},e.id))]})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"발주번호"}),r.jsx(u,{placeholder:"번호",value:se,onChange:e=>me(e.target.value),className:"text-sm h-9"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"품명"}),r.jsx(u,{placeholder:"품명",value:re,onChange:e=>de(e.target.value),className:"text-sm h-9"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"승인상태"}),r.jsxs(m,{value:ae||"all",onValueChange:e=>pe("all"===e?"":e),children:[r.jsx(d,{className:"h-9 text-sm",children:r.jsx(p,{placeholder:"전체"})}),r.jsxs(_,{children:[r.jsx(h,{value:"all",children:"전체"}),r.jsx(h,{value:"pending",children:"대기"}),r.jsx(h,{value:"approved",children:"승인"}),r.jsx(h,{value:"rejected",children:"반려"})]})]})]}),r.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[r.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"통합검색"}),r.jsxs("div",{className:"relative",children:[r.jsx(b,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 w-3 h-3 text-gray-400"}),r.jsx(u,{placeholder:"검색...",value:X,onChange:e=>le(e.target.value),className:"pl-7 text-sm h-9"})]})]})]})})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsx("div",{className:"flex flex-col sm:flex-row sm:space-x-1 space-y-1 sm:space-y-0 bg-gray-50 p-1 rounded-lg border border-gray-200",children:D.map(e=>r.jsxs("button",{onClick:()=>ne(e.key),className:"flex-1 flex items-center justify-center space-x-2 py-2.5 px-3 sm:px-4 rounded-md text-xs sm:text-sm font-medium transition-colors "+(Q===e.key?"text-hansl-600 bg-white shadow-sm border border-gray-200":"text-gray-600 bg-transparent hover:text-gray-900 hover:bg-white/50"),children:[r.jsx("span",{className:"whitespace-nowrap",children:e.label}),r.jsx(o,{variant:"secondary",className:"text-[10px] sm:text-xs "+(Q===e.key?"bg-hansl-50 text-hansl-700":"bg-gray-100 text-gray-600"),children:he[e.key]})]},e.key))}),r.jsx(x,{className:"overflow-hidden border border-gray-200",children:r.jsx(v,{className:"p-0",children:H?r.jsxs("div",{className:"flex items-center justify-center py-12",children:[r.jsx("div",{className:"w-8 h-8 border-2 border-hansl-500 border-t-transparent rounded-full animate-spin"}),r.jsx("span",{className:"ml-3 text-gray-600",children:"로딩 중..."})]}):0===_e.length?r.jsxs("div",{className:"text-center py-12",children:[r.jsx(N,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"발주요청서가 없습니다"}),r.jsx("p",{className:"text-gray-600",children:"새로운 발주요청서를 작성해보세요."})]}):r.jsx(I,{purchases:_e,activeTab:Q,currentUserRoles:W,onRefresh:J,onPaymentComplete:async e=>{try{const{error:t}=await T.from("purchase_requests").update({is_payment_completed:!0,payment_completed_at:(new Date).toISOString()}).eq("id",e);if(t)throw t;await T.from("purchase_request_items").update({is_payment_completed:!0}).eq("purchase_request_id",e),c.success("구매완료 처리되었습니다."),await J()}catch(t){c.error("처리 중 오류가 발생했습니다.")}},onReceiptComplete:async e=>{try{const{error:t}=await T.from("purchase_requests").update({is_received:!0,received_at:(new Date).toISOString()}).eq("id",e);if(t)throw t;await T.from("purchase_request_items").update({is_received:!0,delivery_status:"received"}).eq("purchase_request_id",e),c.success("입고완료 처리되었습니다."),await J()}catch(t){c.error("처리 중 오류가 발생했습니다.")}}})})})]}),U&&r.jsx(e.Suspense,{fallback:r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"})}),children:r.jsx(R,{isOpen:O,onClose:()=>{$(!1),M(null)},purchase:{...U,vendor_name:U.vendor_name||"",project_vendor:U.project_vendor||"",sales_order_number:U.sales_order_number||"",project_item:U.project_item||""},isAdmin:K||!1,onUpdate:J})})]})}export{L as default};
//# sourceMappingURL=PurchaseListMain-CRKtH2ws.js.map
