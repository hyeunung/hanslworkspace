import{c as e,a as t,l as s,r as a,j as r,B as l,X as n,h as i,P as c,i as o,k as d,U as m,_ as u}from"./index-BQwRJ39C.js";import{I as h,D as x,a as p,b as f,c as j,d as g,R as v,P as y,O as b,C as w}from"./input-C-GHgBpt.js";import{S as N,a as _,b as k,c as E,d as S}from"./select-Bxt2gf88.js";import{C}from"./calendar-BNgXXIKE.js";import{D}from"./download-B6fnssto.js";import{P as I}from"./plus-DhbjqVV0.js";import{S as R}from"./search-CSMYPufY.js";import{f as $}from"./helpers-C_CnFjYT.js";import{B as F,t as A}from"./index-Dnyy7QE1.js";import{T as q,a as K,b as O,c as M,d as P,e as z}from"./table-9FaptC4l.js";import{u as V,S as L,D as T,a as U,E as B,b as Y,c as W,d as G,T as J,e as Z,M as H,f as X,g as Q,h as ee,F as te,i as se,j as ae,k as re,l as le,m as ne}from"./form-ZkX0CiRY.js";import{E as ie}from"./eye-DC2WMEgk.js";import{T as ce}from"./trash-2-DaRRNvbx.js";import{u as oe}from"./index.esm-gSuY-evj.js";import{P as de,a as me,b as ue}from"./popover-CW-7Farr.js";import{C as he}from"./chevron-down-DJW8wVpf.js";import{E as xe}from"./exceljs.min-tuUJOiGq.js";import"./card-3Cdpb4al.js";import"./label-DrbnSmKH.js";
/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=e("chevrons-up-down",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]]);const fe=new class{constructor(){this.supabase=t()}async getEmployees(e){try{let t=this.supabase.from("employees").select("*").order("name");e?.search&&(t=t.or(`\n          name.ilike.%${e.search}%,\n          email.ilike.%${e.search}%,\n          phone.ilike.%${e.search}%,\n          position.ilike.%${e.search}%,\n          department.ilike.%${e.search}%,\n          slack_id.ilike.%${e.search}%\n        `)),e?.department&&(t=t.eq("department",e.department)),e?.position&&(t=t.eq("position",e.position)),e?.purchase_role&&(t=t.eq("purchase_role",e.purchase_role)),void 0!==e?.is_active&&(t=t.eq("is_active",e.is_active));const{data:s,error:a}=await t;if(a)throw a;return{success:!0,data:s||[]}}catch(t){return s.error("직원 목록 조회 실패",t),{success:!1,error:t instanceof Error?t.message:"알 수 없는 오류가 발생했습니다."}}}async getEmployee(e){try{const{data:t,error:s}=await this.supabase.from("employees").select("*").eq("id",e).single();if(s)throw s;return{success:!0,data:t}}catch(t){return s.error("직원 조회 실패",t),{success:!1,error:t instanceof Error?t.message:"알 수 없는 오류가 발생했습니다."}}}async createEmployee(e){try{if(e.email){const{data:t}=await this.supabase.from("employees").select("id").eq("email",e.email).single();if(t)return{success:!1,error:"이미 등록된 이메일입니다."}}if(e.slack_id){const{data:t}=await this.supabase.from("employees").select("id").eq("slack_id",e.slack_id).single();if(t)return{success:!1,error:"이미 등록된 Slack ID입니다."}}const t=crypto.randomUUID(),{data:s,error:a}=await this.supabase.from("employees").insert({id:t,...e,purchase_role:e.purchase_role?.join(",")||null,is_active:!0}).select().single();if(a)throw a;return{success:!0,data:s}}catch(t){return s.error("직원 생성 실패",t),{success:!1,error:t instanceof Error?t.message:"알 수 없는 오류가 발생했습니다."}}}async updateEmployee(e,t){try{if(t.email){const{data:s}=await this.supabase.from("employees").select("id").eq("email",t.email).neq("id",e).single();if(s)return{success:!1,error:"이미 등록된 이메일입니다."}}if(t.slack_id){const{data:s}=await this.supabase.from("employees").select("id").eq("slack_id",t.slack_id).neq("id",e).single();if(s)return{success:!1,error:"이미 등록된 Slack ID입니다."}}const s={...t,purchase_role:t.purchase_role?t.purchase_role.join(","):void 0};void 0===s.purchase_role&&delete s.purchase_role;const{data:a,error:r}=await this.supabase.from("employees").update(s).eq("id",e).select().single();if(r)throw r;return{success:!0,data:a}}catch(a){return s.error("직원 수정 실패",a),{success:!1,error:a instanceof Error?a.message:"알 수 없는 오류가 발생했습니다."}}}async deleteEmployee(e){try{const{data:t}=await this.supabase.from("purchase_requests").select("id").eq("requester_id",e).limit(1);if(t&&t.length>0){const{error:t}=await this.supabase.from("employees").update({is_active:!1}).eq("id",e);if(t)throw t;return{success:!0}}{const{error:t}=await this.supabase.from("employees").delete().eq("id",e);if(t)throw t;return{success:!0}}}catch(t){return s.error("직원 삭제 실패",t),{success:!1,error:t instanceof Error?t.message:"알 수 없는 오류가 발생했습니다."}}}async toggleEmployeeStatus(e){try{const{data:t,error:s}=await this.supabase.from("employees").select("is_active").eq("id",e).single();if(s)throw s;const{data:a,error:r}=await this.supabase.from("employees").update({is_active:!t.is_active}).eq("id",e).select().single();if(r)throw r;return{success:!0,data:a}}catch(t){return s.error("직원 상태 변경 실패",t),{success:!1,error:t instanceof Error?t.message:"알 수 없는 오류가 발생했습니다."}}}async updateEmployeeRole(e,t){try{const{data:s,error:a}=await this.supabase.from("employees").update({purchase_role:t}).eq("id",e).select().single();if(a)throw a;return{success:!0,data:s}}catch(a){return s.error("직원 권한 변경 실패",a),{success:!1,error:a instanceof Error?a.message:"알 수 없는 오류가 발생했습니다."}}}async getDepartments(){try{const{data:e,error:t}=await this.supabase.from("employees").select("department").not("department","is",null).not("department","eq","");if(t)throw t;return{success:!0,data:[...new Set((e||[]).map(e=>e.department))].sort()}}catch(e){return s.error("부서 목록 조회 실패",e),{success:!1,error:e instanceof Error?e.message:"알 수 없는 오류가 발생했습니다."}}}async getPositions(){try{const{data:e,error:t}=await this.supabase.from("employees").select("position").not("position","is",null).not("position","eq","");if(t)throw t;return{success:!0,data:[...new Set((e||[]).map(e=>e.position))].sort()}}catch(e){return s.error("직급 목록 조회 실패",e),{success:!1,error:e instanceof Error?e.message:"알 수 없는 오류가 발생했습니다."}}}async getEmployeesForExport(){try{const{data:e,error:t}=await this.supabase.from("employees").select("*").order("name");if(t)throw t;return{success:!0,data:(e||[]).map(e=>({"이름":e.name,"이메일":e.email||"","전화번호":e.phone||"","주소":e.adress||"","부서":e.department||"","직급":e.position||"","권한":this.getRoleDisplayName(e.purchase_role),"Slack ID":e.slack_id||"","상태":e.is_active?"활성":"비활성","등록일":e.created_at?new Date(e.created_at).toLocaleDateString("ko-KR"):""}))}}catch(e){return s.error("직원 Excel 내보내기 실패",e),{success:!1,error:e instanceof Error?e.message:"알 수 없는 오류가 발생했습니다."}}}getRoleDisplayName(e){return{app_admin:"앱 관리자",ceo:"CEO",final_approver:"최종 승인자",middle_manager:"중간 관리자","lead buyer":"수석 구매자",buyer:"구매자"}[e||""]||e||"권한 없음"}async checkPermission(e,t){try{const{data:s}=await this.supabase.from("employees").select("purchase_role, is_active").eq("id",e).single();if(!s||!s.is_active)return{success:!0,hasPermission:!1};return{success:!0,hasPermission:t.includes(s.purchase_role)}}catch(s){return{success:!1,error:s instanceof Error?s.message:"알 수 없는 오류가 발생했습니다."}}}},je=[{value:"app_admin",label:"앱 관리자"},{value:"ceo",label:"CEO"},{value:"final_approver",label:"최종 승인자"},{value:"middle_manager",label:"중간 관리자"},{value:"lead buyer",label:"수석 구매자"},{value:"buyer",label:"구매자"}];function ge({filters:e,onFiltersChange:t,onExport:s,onCreateNew:i,onAttendanceDownload:c}){const[o,d]=a.useState(e.search||""),[m,u]=a.useState([]),[x,p]=a.useState([]);a.useEffect(()=>{(async()=>{const[e,t]=await Promise.all([fe.getDepartments(),fe.getPositions()]);e.success&&u(e.data||[]),t.success&&p(t.data||[])})()},[]);const f=e.search||e.department||e.position||e.purchase_role||void 0!==e.is_active;return r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"page-title",children:"직원 관리"}),r.jsx("p",{className:"page-subtitle",style:{marginTop:"-2px",marginBottom:"-4px"},children:"Employee Management"})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs(l,{variant:"outline",onClick:c,className:"flex items-center gap-1 sm:gap-2 text-xs sm:text-sm",children:[r.jsx(C,{className:"w-3 h-3 sm:w-4 sm:h-4"}),r.jsx("span",{className:"hidden sm:inline",children:"출근현황표"}),r.jsx("span",{className:"sm:hidden",children:"출근"})]}),r.jsxs(l,{variant:"outline",onClick:s,className:"flex items-center gap-1 sm:gap-2 text-xs sm:text-sm",children:[r.jsx(D,{className:"w-3 h-3 sm:w-4 sm:h-4"}),r.jsx("span",{className:"hidden sm:inline",children:"Excel 내보내기"}),r.jsx("span",{className:"sm:hidden",children:"Excel"})]}),r.jsxs(l,{onClick:i,className:"flex items-center gap-1 sm:gap-2 text-xs sm:text-sm",children:[r.jsx(I,{className:"w-3 h-3 sm:w-4 sm:h-4"}),"직원 등록"]})]})]}),r.jsx("div",{className:"bg-white p-3 sm:p-4 rounded-lg border space-y-4",children:r.jsxs("form",{onSubmit:s=>{s.preventDefault(),t({...e,search:o.trim()||void 0})},className:"flex flex-col sm:flex-row gap-3 sm:gap-4 sm:items-end sm:flex-wrap",children:[r.jsxs("div",{className:"flex-1 sm:min-w-[250px]",children:[r.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1",children:"검색"}),r.jsxs("div",{className:"relative",children:[r.jsx(R,{className:"absolute left-2 sm:left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-3 h-3 sm:w-4 sm:h-4"}),r.jsx(h,{type:"text",placeholder:"이름, 이메일, 전화번호로 검색",value:o,onChange:e=>d(e.target.value),className:"pl-8 sm:pl-10 text-sm h-9"})]})]}),r.jsxs("div",{className:"w-full sm:w-auto sm:min-w-[120px]",children:[r.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1",children:"부서"}),r.jsxs(N,{value:e.department||"all",onValueChange:s=>{t({...e,department:"all"===s?void 0:s})},children:[r.jsx(_,{className:"h-9",children:r.jsx(k,{})}),r.jsxs(E,{children:[r.jsx(S,{value:"all",children:"전체 부서"}),m.map(e=>r.jsx(S,{value:e,children:e},e))]})]})]}),r.jsxs("div",{className:"w-full sm:w-auto sm:min-w-[120px]",children:[r.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1",children:"직급"}),r.jsxs(N,{value:e.position||"all",onValueChange:s=>{t({...e,position:"all"===s?void 0:s})},children:[r.jsx(_,{className:"h-9",children:r.jsx(k,{})}),r.jsxs(E,{children:[r.jsx(S,{value:"all",children:"전체 직급"}),x.map(e=>r.jsx(S,{value:e,children:e},e))]})]})]}),r.jsxs("div",{className:"w-full sm:w-auto sm:min-w-[140px]",children:[r.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1",children:"권한"}),r.jsxs(N,{value:e.purchase_role||"all",onValueChange:s=>{t({...e,purchase_role:"all"===s?void 0:"none"===s?"":s})},children:[r.jsx(_,{className:"h-9",children:r.jsx(k,{})}),r.jsxs(E,{children:[r.jsx(S,{value:"all",children:"전체 권한"}),r.jsx(S,{value:"none",children:"권한 없음"}),je.map(e=>r.jsx(S,{value:e.value,children:e.label},e.value))]})]})]}),r.jsxs("div",{className:"w-full sm:w-auto sm:min-w-[100px]",children:[r.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1",children:"상태"}),r.jsxs(N,{value:void 0===e.is_active?"all":e.is_active?"active":"inactive",onValueChange:s=>{t({...e,is_active:"all"===s?void 0:"active"===s})},children:[r.jsx(_,{className:"h-9",children:r.jsx(k,{})}),r.jsxs(E,{children:[r.jsx(S,{value:"all",children:"전체"}),r.jsx(S,{value:"active",children:"활성"}),r.jsx(S,{value:"inactive",children:"비활성"})]})]})]}),r.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[r.jsx(l,{type:"submit",className:"flex-1 sm:flex-none h-9 text-sm",children:"검색"}),f&&r.jsxs(l,{type:"button",variant:"outline",onClick:()=>{d(""),t({})},className:"flex items-center gap-1 h-9 text-sm",children:[r.jsx(n,{className:"w-3 h-3 sm:w-4 sm:h-4"}),r.jsx("span",{className:"hidden sm:inline",children:"초기화"}),r.jsx("span",{className:"sm:hidden",children:"초기"})]})]})]})})]})}function ve({employees:e,onEdit:s,onView:n,onRefresh:i}){const[c,o]=a.useState(null),[d,m]=a.useState(null),u=t(),{sortedData:h,sortConfig:x,handleSort:p}=V(e,"name","asc");a.useEffect(()=>{(async()=>{const{data:{user:e}}=await u.auth.getUser();if(e){const{data:t}=await u.from("employees").select("role, purchase_role").eq("id",e.id).single();t&&m(t.role||"")}})()},[]);const f="hr"===d||"admin"===d,j=f,g=f,v=async e=>{o(e.id);try{const t=await fe.toggleEmployeeStatus(e.id);t.success?(A.success(`직원이 ${e.is_active?"비활성화":"활성화"}되었습니다.`),i()):A.error(t.error||"상태 변경에 실패했습니다.")}catch(t){A.error("상태 변경 중 오류가 발생했습니다.")}finally{o(null)}},y=async e=>{if(confirm(`정말로 '${e.name}' 직원을 삭제하시겠습니까?`)){o(e.id);try{const t=await fe.deleteEmployee(e.id);t.success?(A.success("직원이 삭제되었습니다."),i()):A.error(t.error||"삭제에 실패했습니다.")}catch(t){A.error("삭제 중 오류가 발생했습니다.")}finally{o(null)}}},b=e=>({app_admin:"앱 관리자",ceo:"CEO",final_approver:"최종 승인자",middle_manager:"중간 관리자","lead buyer":"수석 구매자",buyer:"구매자"}[e||""]||"권한 없음"),w=e=>({app_admin:"bg-purple-100 text-purple-800",ceo:"bg-red-100 text-red-800",final_approver:"bg-hansl-100 text-hansl-800",middle_manager:"bg-green-100 text-green-800","lead buyer":"bg-yellow-100 text-yellow-800",buyer:"bg-gray-100 text-gray-800"}[e||""]||"bg-gray-100 text-gray-600");return r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"hidden lg:block border rounded-lg overflow-hidden",children:r.jsx("div",{className:"overflow-x-auto",children:r.jsxs(q,{children:[r.jsx(K,{children:r.jsxs(O,{children:[r.jsx(M,{className:"w-16 min-w-[50px]",children:r.jsx(L,{sortKey:"employeeID",currentSortKey:x.key,sortDirection:x.direction,onSort:()=>p("employeeID"),children:"사번"})}),r.jsx(M,{className:"w-14 min-w-[45px]",children:r.jsx(L,{sortKey:"name",currentSortKey:x.key,sortDirection:x.direction,onSort:()=>p("name"),children:"이름"})}),r.jsx(M,{className:"w-12 min-w-[40px]",children:r.jsx(L,{sortKey:"position",currentSortKey:x.key,sortDirection:x.direction,onSort:()=>p("position"),children:"직급"})}),r.jsx(M,{className:"w-16 min-w-[50px]",children:r.jsx(L,{sortKey:"department",currentSortKey:x.key,sortDirection:x.direction,onSort:()=>p("department"),children:"부서"})}),r.jsx(M,{className:"w-20 min-w-[70px]",children:r.jsx(L,{sortKey:"phone",currentSortKey:x.key,sortDirection:x.direction,onSort:()=>p("phone"),children:"연락처"})}),r.jsx(M,{className:"w-32 min-w-[100px]",children:r.jsx(L,{sortKey:"email",currentSortKey:x.key,sortDirection:x.direction,onSort:()=>p("email"),children:"이메일"})}),r.jsx(M,{className:"w-11 min-w-[40px] text-center",children:"생성"}),r.jsx(M,{className:"w-11 min-w-[40px] text-center",children:"사용"}),r.jsx(M,{className:"w-11 min-w-[40px] text-center",children:"남은"}),r.jsx(M,{className:"hidden lg:table-cell w-18 min-w-[60px]",children:r.jsx(L,{sortKey:"join_date",currentSortKey:x.key,sortDirection:x.direction,onSort:()=>p("join_date"),children:"입사일"})}),r.jsx(M,{className:"hidden lg:table-cell w-20 min-w-[70px]",children:r.jsx(L,{sortKey:"birthday",currentSortKey:x.key,sortDirection:x.direction,onSort:()=>p("birthday"),children:"생년월일"})}),f&&r.jsxs(r.Fragment,{children:[r.jsx(M,{className:"hidden xl:table-cell w-14 min-w-[45px]",children:"은행"}),r.jsx(M,{className:"hidden xl:table-cell w-24 min-w-[80px]",children:"계좌번호"}),r.jsx(M,{className:"hidden 2xl:table-cell min-w-[120px]",children:"주소"}),r.jsx(M,{children:r.jsx(L,{sortKey:"purchase_role",currentSortKey:x.key,sortDirection:x.direction,onSort:()=>p("purchase_role"),children:"권한"})}),r.jsx(M,{children:r.jsx(L,{sortKey:"slack_id",currentSortKey:x.key,sortDirection:x.direction,onSort:()=>p("slack_id"),children:"Slack ID"})}),r.jsx(M,{children:r.jsx(L,{sortKey:"is_active",currentSortKey:x.key,sortDirection:x.direction,onSort:()=>p("is_active"),children:"상태"})})]}),r.jsx(M,{className:"w-16 min-w-[50px]",children:"작업"})]})}),r.jsx(P,{children:0===e.length?r.jsx(O,{children:r.jsx(z,{colSpan:j?14:7,className:"text-center py-8 text-gray-500",children:"등록된 직원이 없습니다."})}):h.map(e=>r.jsxs(O,{children:[r.jsx(z,{className:"text-[11px] px-2 py-1.5",children:e.employeeID||e.employee_number||e.id.slice(0,8)}),r.jsx(z,{className:"text-[11px] px-2 py-1.5",children:e.name}),r.jsx(z,{className:"text-[11px] px-2 py-1.5",children:e.position||"-"}),r.jsx(z,{className:"text-[11px] px-2 py-1.5",children:e.department||"-"}),r.jsx(z,{className:"text-[11px] px-2 py-1.5",children:e.phone||"-"}),r.jsx(z,{className:"text-[11px] px-2 py-1.5",children:e.email||"-"}),r.jsx(z,{className:"text-center text-[11px] px-1 py-1.5",children:e.annual_leave_granted_current_year||0}),r.jsx(z,{className:"text-center text-[11px] px-1 py-1.5",children:e.used_annual_leave||0}),r.jsx(z,{className:"text-center text-[11px] px-1 py-1.5",children:void 0!==e.remaining_annual_leave?e.remaining_annual_leave:"-"}),r.jsx(z,{className:"hidden lg:table-cell text-[11px] px-2 py-1.5",children:$(e.join_date)}),r.jsx(z,{className:"hidden lg:table-cell text-[11px] px-2 py-1.5",children:$(e.birthday)}),f&&r.jsxs(r.Fragment,{children:[r.jsx(z,{className:"hidden xl:table-cell text-[11px] px-2 py-1.5",children:e.bank||"-"}),r.jsx(z,{className:"hidden xl:table-cell text-[11px] px-2 py-1.5",children:e.bank_account||"-"}),r.jsx(z,{className:"hidden 2xl:table-cell text-[11px] px-2 py-1.5",children:e.adress||"-"}),r.jsx(z,{className:"px-2 py-1.5",children:r.jsx(F,{className:`text-[10px] px-1.5 py-0.5 ${w(e.purchase_role)}`,children:b(e.purchase_role)})}),r.jsx(z,{className:"text-[11px] px-2 py-1.5",children:e.slack_id||"-"}),r.jsx(z,{className:"px-2 py-1.5",children:r.jsx(F,{variant:e.is_active?"default":"secondary",className:"text-[10px] px-1.5 py-0.5 "+(e.is_active?"bg-green-100 text-green-800":""),children:e.is_active?"활성":"비활성"})})]}),r.jsx(z,{className:"px-1 py-1.5",children:r.jsxs(T,{children:[r.jsx(U,{asChild:!0,children:r.jsx(l,{variant:"ghost",className:"h-7 w-7 p-0",disabled:c===e.id,children:r.jsx(B,{className:"h-3 w-3"})})}),r.jsxs(Y,{align:"end",children:[r.jsxs(W,{onClick:()=>n(e),children:[r.jsx(ie,{className:"mr-2 h-4 w-4"}),"상세 보기"]}),g&&r.jsxs(r.Fragment,{children:[r.jsxs(W,{onClick:()=>s(e),children:[r.jsx(G,{className:"mr-2 h-4 w-4"}),"수정"]}),r.jsx(W,{onClick:()=>v(e),children:e.is_active?r.jsxs(r.Fragment,{children:[r.jsx(J,{className:"mr-2 h-4 w-4"}),"비활성화"]}):r.jsxs(r.Fragment,{children:[r.jsx(Z,{className:"mr-2 h-4 w-4"}),"활성화"]})}),r.jsxs(W,{onClick:()=>y(e),className:"text-red-600",children:[r.jsx(ce,{className:"mr-2 h-4 w-4"}),"삭제"]})]})]})]})})]},e.id))})]})})}),r.jsx("div",{className:"hidden md:block lg:hidden",children:r.jsx("div",{className:"overflow-x-auto border rounded-lg",children:r.jsxs("table",{className:"w-full min-w-[700px]",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"text-left p-3 header-title text-gray-900 w-16",children:"사번"}),r.jsx("th",{className:"text-left p-3 header-title text-gray-900 w-20",children:"이름"}),r.jsx("th",{className:"text-left p-3 header-title text-gray-900 w-20",children:"직급"}),r.jsx("th",{className:"text-left p-3 header-title text-gray-900 w-24",children:"부서"}),r.jsx("th",{className:"text-left p-3 header-title text-gray-900",children:"연락처"}),r.jsx("th",{className:"text-left p-3 header-title text-gray-900",children:"이메일"}),f&&r.jsxs(r.Fragment,{children:[r.jsx("th",{className:"text-left p-3 header-title text-gray-900 w-24",children:"권한"}),r.jsx("th",{className:"text-center p-3 header-title text-gray-900 w-16",children:"상태"})]}),r.jsx("th",{className:"text-center p-3 header-title text-gray-900 w-16",children:"작업"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:0===h.length?r.jsx("tr",{children:r.jsx("td",{colSpan:f?9:7,className:"text-center py-8 text-gray-500",children:"등록된 직원이 없습니다."})}):h.map(e=>r.jsxs("tr",{className:"hover:bg-gray-50",children:[r.jsx("td",{className:"p-3 modal-subtitle",children:e.employeeID||e.employee_number||e.id.slice(0,8)}),r.jsx("td",{className:"p-3 modal-value",children:e.name}),r.jsx("td",{className:"p-3 modal-subtitle",children:e.position||"-"}),r.jsx("td",{className:"p-3 modal-subtitle",children:e.department||"-"}),r.jsx("td",{className:"p-3 modal-subtitle",children:e.phone||"-"}),r.jsx("td",{className:"p-3 modal-subtitle",children:e.email||"-"}),f&&r.jsxs(r.Fragment,{children:[r.jsx("td",{className:"p-3",children:r.jsx(F,{className:`text-xs ${w(e.purchase_role)}`,children:b(e.purchase_role)})}),r.jsx("td",{className:"p-3 text-center",children:r.jsx(F,{variant:e.is_active?"default":"secondary",className:"text-xs "+(e.is_active?"bg-green-100 text-green-800":""),children:e.is_active?"활성":"비활성"})})]}),r.jsx("td",{className:"p-3 text-center",children:r.jsxs(T,{children:[r.jsx(U,{asChild:!0,children:r.jsx(l,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:r.jsx(B,{className:"h-4 w-4"})})}),r.jsxs(Y,{align:"end",children:[r.jsxs(W,{onClick:()=>n(e),children:[r.jsx(ie,{className:"mr-2 h-4 w-4"}),"상세 보기"]}),g&&r.jsxs(r.Fragment,{children:[r.jsxs(W,{onClick:()=>s(e),children:[r.jsx(G,{className:"mr-2 h-4 w-4"}),"수정"]}),r.jsx(W,{onClick:()=>v(e),children:e.is_active?r.jsxs(r.Fragment,{children:[r.jsx(J,{className:"mr-2 h-4 w-4"}),"비활성화"]}):r.jsxs(r.Fragment,{children:[r.jsx(Z,{className:"mr-2 h-4 w-4"}),"활성화"]})}),r.jsxs(W,{onClick:()=>y(e),className:"text-red-600",children:[r.jsx(ce,{className:"mr-2 h-4 w-4"}),"삭제"]})]})]})]})})]},e.id))})]})})}),r.jsx("div",{className:"block md:hidden space-y-3",children:0===h.length?r.jsx("div",{className:"text-center py-8 text-gray-500",children:"등록된 직원이 없습니다."}):h.map(e=>r.jsxs(H,{children:[r.jsx(X,{children:r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{children:e.name}),r.jsx(F,{variant:e.is_active?"default":"secondary",className:e.is_active?"bg-green-100 text-green-800":"",children:e.is_active?"활성":"비활성"})]})}),r.jsx(Q,{label:"사번",value:e.employeeID||e.employee_number||e.id.slice(0,8)}),r.jsx(Q,{label:"직급",value:e.position||"-"}),r.jsx(Q,{label:"부서",value:e.department||"-"}),r.jsx(Q,{label:"연락처",value:e.phone||"-"}),r.jsx(Q,{label:"이메일",value:e.email||"-"}),j&&r.jsxs(r.Fragment,{children:[r.jsx(Q,{label:"권한",value:r.jsx(F,{className:w(e.purchase_role),children:b(e.purchase_role)})}),r.jsx(Q,{label:"Slack ID",value:e.slack_id||"-"}),r.jsx(Q,{label:"주소",value:e.adress||"-"}),r.jsx(Q,{label:"은행",value:e.bank||"-"}),r.jsx(Q,{label:"계좌번호",value:e.bank_account||"-"}),r.jsx(Q,{label:"연차",value:void 0!==e.remaining_annual_leave?`${e.remaining_annual_leave}일`:"-"})]}),r.jsxs(ee,{children:[r.jsx(l,{size:"sm",variant:"outline",onClick:()=>n(e),children:r.jsx(ie,{className:"w-4 h-4"})}),g&&r.jsxs(r.Fragment,{children:[r.jsx(l,{size:"sm",variant:"outline",onClick:()=>s(e),children:r.jsx(G,{className:"w-4 h-4"})}),r.jsx(l,{size:"sm",variant:"outline",onClick:()=>v(e),disabled:c===e.id,children:e.is_active?r.jsx(J,{className:"w-4 h-4"}):r.jsx(Z,{className:"w-4 h-4"})}),r.jsx(l,{size:"sm",variant:"outline",className:"text-red-600",onClick:()=>y(e),disabled:c===e.id,children:r.jsx(ce,{className:"w-4 h-4"})})]})]})]},e.id))})]})}const ye=[{value:"app_admin",label:"앱 관리자"},{value:"ceo",label:"CEO"},{value:"final_approver",label:"최종 승인자"},{value:"middle_manager",label:"중간 관리자"},{value:"lead buyer",label:"수석 구매자"},{value:"buyer",label:"구매자"}];function be({isOpen:e,onClose:t,employee:s,onSave:n,mode:i}){const[c,o]=a.useState(!1),[d,m]=a.useState([]),[u,v]=a.useState([]),y=oe({defaultValues:{name:"",email:"",phone:"",position:"",department:"",purchase_role:[],slack_id:""}});a.useEffect(()=>{(async()=>{const[e,t]=await Promise.all([fe.getDepartments(),fe.getPositions()]);e.success&&m(e.data||[]),t.success&&v(t.data||[])})()},[]),a.useEffect(()=>{s&&e?y.reset({name:s.name||"",email:s.email||"",phone:s.phone||"",position:s.position||"",department:s.department||"",purchase_role:s.purchase_role?s.purchase_role.split(","):[],slack_id:s.slack_id||""}):!s&&e&&y.reset({name:"",email:"",phone:"",position:"",department:"",purchase_role:[],slack_id:""})},[s,e,y]);const b="view"===i;return r.jsx(x,{open:e,onOpenChange:t,children:r.jsxs(p,{className:"w-full max-w-[95vw] sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[r.jsx(f,{children:r.jsx(j,{children:(()=>{switch(i){case"create":return"직원 등록";case"edit":return"직원 수정";case"view":return"직원 상세";default:return"직원"}})()})}),r.jsx(te,{...y,children:r.jsxs("form",{onSubmit:y.handleSubmit(async e=>{o(!0);try{let a;"create"===i?a=await fe.createEmployee(e):"edit"===i&&s&&(a=await fe.updateEmployee(s.id,e)),a?.success?(A.success("create"===i?"직원이 등록되었습니다.":"직원 정보가 수정되었습니다."),n(),t()):A.error(a?.error||"처리 중 오류가 발생했습니다.")}catch(a){A.error("처리 중 오류가 발생했습니다.")}finally{o(!1)}}),className:"space-y-4",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsx(se,{control:y.control,name:"name",rules:{required:"이름을 입력해주세요."},render:({field:e})=>r.jsxs(ae,{children:[r.jsx(re,{children:"이름 *"}),r.jsx(le,{children:r.jsx(h,{...e,placeholder:"이름을 입력하세요",disabled:b})}),r.jsx(ne,{})]})}),r.jsx(se,{control:y.control,name:"email",rules:{pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"올바른 이메일 형식을 입력해주세요."}},render:({field:e})=>r.jsxs(ae,{children:[r.jsx(re,{children:"이메일"}),r.jsx(le,{children:r.jsx(h,{...e,type:"email",placeholder:"user@example.com",disabled:b})}),r.jsx(ne,{})]})}),r.jsx(se,{control:y.control,name:"phone",render:({field:e})=>r.jsxs(ae,{children:[r.jsx(re,{children:"전화번호"}),r.jsx(le,{children:r.jsx(h,{...e,placeholder:"010-0000-0000",disabled:b})}),r.jsx(ne,{})]})}),r.jsx(se,{control:y.control,name:"slack_id",render:({field:e})=>r.jsxs(ae,{children:[r.jsx(re,{children:"Slack ID"}),r.jsx(le,{children:r.jsx(h,{...e,placeholder:"U01234567890",disabled:b})}),r.jsx(ne,{})]})}),r.jsx(se,{control:y.control,name:"department",render:({field:e})=>r.jsxs(ae,{children:[r.jsx(re,{children:"부서"}),r.jsx(le,{children:b?r.jsx(h,{...e,disabled:!0}):r.jsxs(N,{onValueChange:e.onChange,defaultValue:e.value,children:[r.jsx(_,{children:r.jsx(k,{placeholder:"부서를 선택하세요"})}),r.jsxs(E,{children:[d.map(e=>r.jsx(S,{value:e,children:e},e)),r.jsx(S,{value:"custom",children:"직접 입력"})]})]})}),r.jsx(ne,{})]})}),r.jsx(se,{control:y.control,name:"position",render:({field:e})=>r.jsxs(ae,{children:[r.jsx(re,{children:"직급"}),r.jsx(le,{children:b?r.jsx(h,{...e,disabled:!0}):r.jsxs(N,{onValueChange:e.onChange,defaultValue:e.value,children:[r.jsx(_,{children:r.jsx(k,{placeholder:"직급을 선택하세요"})}),r.jsxs(E,{children:[u.map(e=>r.jsx(S,{value:e,children:e},e)),r.jsx(S,{value:"custom",children:"직접 입력"})]})]})}),r.jsx(ne,{})]})}),r.jsx(se,{control:y.control,name:"purchase_role",render:({field:e})=>r.jsxs(ae,{children:[r.jsx(re,{children:"권한"}),r.jsx(le,{children:r.jsxs(N,{onValueChange:t=>e.onChange("none"===t?[]:[t]),defaultValue:e.value?.[0]||"none",disabled:b,children:[r.jsx(_,{children:r.jsx(k,{placeholder:"권한을 선택하세요"})}),r.jsxs(E,{children:[r.jsx(S,{value:"none",children:"권한 없음"}),ye.map(e=>r.jsx(S,{value:e.value,children:e.label},e.value))]})]})}),r.jsx(ne,{})]})})]}),"view"===i&&s&&r.jsx("div",{className:"pt-4 border-t",children:r.jsxs("div",{className:"grid grid-cols-2 gap-4 modal-subtitle",children:[r.jsxs("div",{children:[r.jsx("span",{className:"text-gray-500",children:"상태:"}),r.jsx("span",{className:"ml-2 px-2 py-1 business-radius-badge badge-text "+(s.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-600"),children:s.is_active?"활성":"비활성"})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-gray-500",children:"등록일:"}),r.jsx("span",{className:"ml-2",children:s.created_at?new Date(s.created_at).toLocaleDateString("ko-KR"):"-"})]})]})}),r.jsxs(g,{className:"gap-2",children:[r.jsx(l,{type:"button",variant:"outline",onClick:t,children:"view"===i?"닫기":"취소"}),!b&&r.jsx(l,{type:"submit",disabled:c,children:c?"create"===i?"등록 중...":"수정 중...":"create"===i?"등록":"수정"})]})]})})]})})}var we=.999,Ne=/[\\\/_+.#"@\[\(\{&]/,_e=/[\\\/_+.#"@\[\(\{&]/g,ke=/[\s-]/,Ee=/[\s-]/g;function Se(e,t,s,a,r,l,n){if(l===t.length)return r===e.length?1:.99;var i=`${r},${l}`;if(void 0!==n[i])return n[i];for(var c,o,d,m,u=a.charAt(l),h=s.indexOf(u,r),x=0;h>=0;)(c=Se(e,t,s,a,h+1,l+1,n))>x&&(h===r?c*=1:Ne.test(e.charAt(h-1))?(c*=.8,(d=e.slice(r,h-1).match(_e))&&r>0&&(c*=Math.pow(we,d.length))):ke.test(e.charAt(h-1))?(c*=.9,(m=e.slice(r,h-1).match(Ee))&&r>0&&(c*=Math.pow(we,m.length))):(c*=.17,r>0&&(c*=Math.pow(we,h-r))),e.charAt(h)!==t.charAt(l)&&(c*=.9999)),(c<.1&&s.charAt(h-1)===a.charAt(l+1)||a.charAt(l+1)===a.charAt(l)&&s.charAt(h-1)!==a.charAt(l))&&(.1*(o=Se(e,t,s,a,h+1,l+2,n))>c&&(c=.1*o)),c>x&&(x=c),h=s.indexOf(u,h+1);return n[i]=x,x}function Ce(e){return e.toLowerCase().replace(Ee," ")}function De(e,t,s){return Se(e=s&&s.length>0?""+(e+" "+s.join(" ")):e,t,Ce(e),Ce(t),0,0,{})}var Ie='[cmdk-group=""]',Re='[cmdk-group-items=""]',$e='[cmdk-item=""]',Fe=`${$e}:not([aria-disabled="true"])`,Ae="cmdk-item-select",qe="data-value",Ke=(e,t,s)=>De(e,t,s),Oe=a.createContext(void 0),Me=()=>a.useContext(Oe),Pe=a.createContext(void 0),ze=()=>a.useContext(Pe),Ve=a.createContext(void 0),Le=a.forwardRef((e,t)=>{let s=st(()=>{var t,s;return{search:"",value:null!=(s=null!=(t=e.value)?t:e.defaultValue)?s:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),r=st(()=>new Set),l=st(()=>new Map),n=st(()=>new Map),o=st(()=>new Set),d=et(e),{label:m,children:u,value:h,onValueChange:x,filter:p,shouldFilter:f,loop:j,disablePointerSelection:g=!1,vimBindings:v=!0,...y}=e,b=i(),w=i(),N=i(),_=a.useRef(null),k=lt();tt(()=>{if(void 0!==h){let e=h.trim();s.current.value=e,E.emit()}},[h]),tt(()=>{k(6,$)},[]);let E=a.useMemo(()=>({subscribe:e=>(o.current.add(e),()=>o.current.delete(e)),snapshot:()=>s.current,setState:(e,t,a)=>{var r,l,n,i;if(!Object.is(s.current[e],t)){if(s.current[e]=t,"search"===e)R(),D(),k(1,I);else if("value"===e){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let e=document.getElementById(N);e?e.focus():null==(r=document.getElementById(b))||r.focus()}if(k(7,()=>{var e;s.current.selectedItemId=null==(e=F())?void 0:e.id,E.emit()}),a||k(5,$),void 0!==(null==(l=d.current)?void 0:l.value)){let e=null!=t?t:"";return void(null==(i=(n=d.current).onValueChange)||i.call(n,e))}}E.emit()}},emit:()=>{o.current.forEach(e=>e())}}),[]),S=a.useMemo(()=>({value:(e,t,a)=>{var r;t!==(null==(r=n.current.get(e))?void 0:r.value)&&(n.current.set(e,{value:t,keywords:a}),s.current.filtered.items.set(e,C(t,a)),k(2,()=>{D(),E.emit()}))},item:(e,t)=>(r.current.add(e),t&&(l.current.has(t)?l.current.get(t).add(e):l.current.set(t,new Set([e]))),k(3,()=>{R(),D(),s.current.value||I(),E.emit()}),()=>{n.current.delete(e),r.current.delete(e),s.current.filtered.items.delete(e);let t=F();k(4,()=>{R(),(null==t?void 0:t.getAttribute("id"))===e&&I(),E.emit()})}),group:e=>(l.current.has(e)||l.current.set(e,new Set),()=>{n.current.delete(e),l.current.delete(e)}),filter:()=>d.current.shouldFilter,label:m||e["aria-label"],getDisablePointerSelection:()=>d.current.disablePointerSelection,listId:b,inputId:N,labelId:w,listInnerRef:_}),[]);function C(e,t){var a,r;let l=null!=(r=null==(a=d.current)?void 0:a.filter)?r:Ke;return e?l(e,s.current.search,t):0}function D(){if(!s.current.search||!1===d.current.shouldFilter)return;let e=s.current.filtered.items,t=[];s.current.filtered.groups.forEach(s=>{let a=l.current.get(s),r=0;a.forEach(t=>{let s=e.get(t);r=Math.max(s,r)}),t.push([s,r])});let a=_.current;A().sort((t,s)=>{var a,r;let l=t.getAttribute("id"),n=s.getAttribute("id");return(null!=(a=e.get(n))?a:0)-(null!=(r=e.get(l))?r:0)}).forEach(e=>{let t=e.closest(Re);t?t.appendChild(e.parentElement===t?e:e.closest(`${Re} > *`)):a.appendChild(e.parentElement===a?e:e.closest(`${Re} > *`))}),t.sort((e,t)=>t[1]-e[1]).forEach(e=>{var t;let s=null==(t=_.current)?void 0:t.querySelector(`${Ie}[${qe}="${encodeURIComponent(e[0])}"]`);null==s||s.parentElement.appendChild(s)})}function I(){let e=A().find(e=>"true"!==e.getAttribute("aria-disabled")),t=null==e?void 0:e.getAttribute(qe);E.setState("value",t||void 0)}function R(){var e,t,a,i;if(!s.current.search||!1===d.current.shouldFilter)return void(s.current.filtered.count=r.current.size);s.current.filtered.groups=new Set;let c=0;for(let l of r.current){let r=C(null!=(t=null==(e=n.current.get(l))?void 0:e.value)?t:"",null!=(i=null==(a=n.current.get(l))?void 0:a.keywords)?i:[]);s.current.filtered.items.set(l,r),r>0&&c++}for(let[r,n]of l.current)for(let e of n)if(s.current.filtered.items.get(e)>0){s.current.filtered.groups.add(r);break}s.current.filtered.count=c}function $(){var e,t,s;let a=F();a&&((null==(e=a.parentElement)?void 0:e.firstChild)===a&&(null==(s=null==(t=a.closest(Ie))?void 0:t.querySelector('[cmdk-group-heading=""]'))||s.scrollIntoView({block:"nearest"})),a.scrollIntoView({block:"nearest"}))}function F(){var e;return null==(e=_.current)?void 0:e.querySelector(`${$e}[aria-selected="true"]`)}function A(){var e;return Array.from((null==(e=_.current)?void 0:e.querySelectorAll(Fe))||[])}function q(e){let t=A()[e];t&&E.setState("value",t.getAttribute(qe))}function K(e){var t;let s=F(),a=A(),r=a.findIndex(e=>e===s),l=a[r+e];null!=(t=d.current)&&t.loop&&(l=r+e<0?a[a.length-1]:r+e===a.length?a[0]:a[r+e]),l&&E.setState("value",l.getAttribute(qe))}function O(e){let t,s=F(),a=null==s?void 0:s.closest(Ie);for(;a&&!t;)a=e>0?Xe(a,Ie):Qe(a,Ie),t=null==a?void 0:a.querySelector(Fe);t?E.setState("value",t.getAttribute(qe)):K(e)}let M=()=>q(A().length-1),P=e=>{e.preventDefault(),e.metaKey?M():e.altKey?O(1):K(1)},z=e=>{e.preventDefault(),e.metaKey?q(0):e.altKey?O(-1):K(-1)};return a.createElement(c.div,{ref:t,tabIndex:-1,...y,"cmdk-root":"",onKeyDown:e=>{var t;null==(t=y.onKeyDown)||t.call(y,e);let s=e.nativeEvent.isComposing||229===e.keyCode;if(!e.defaultPrevented&&!s)switch(e.key){case"n":case"j":v&&e.ctrlKey&&P(e);break;case"ArrowDown":P(e);break;case"p":case"k":v&&e.ctrlKey&&z(e);break;case"ArrowUp":z(e);break;case"Home":e.preventDefault(),q(0);break;case"End":e.preventDefault(),M();break;case"Enter":{e.preventDefault();let t=F();if(t){let e=new Event(Ae);t.dispatchEvent(e)}}}}},a.createElement("label",{"cmdk-label":"",htmlFor:S.inputId,id:S.labelId,style:it},m),nt(e,e=>a.createElement(Pe.Provider,{value:E},a.createElement(Oe.Provider,{value:S},e))))}),Te=a.forwardRef((e,t)=>{var s,r;let l=i(),n=a.useRef(null),d=a.useContext(Ve),m=Me(),u=et(e),h=null!=(r=null==(s=u.current)?void 0:s.forceMount)?r:null==d?void 0:d.forceMount;tt(()=>{if(!h)return m.item(l,null==d?void 0:d.id)},[h]);let x=rt(l,n,[e.value,e.children,n],e.keywords),p=ze(),f=at(e=>e.value&&e.value===x.current),j=at(e=>!(!h&&!1!==m.filter())||(!e.search||e.filtered.items.get(l)>0));function g(){var e,t;v(),null==(t=(e=u.current).onSelect)||t.call(e,x.current)}function v(){p.setState("value",x.current,!0)}if(a.useEffect(()=>{let t=n.current;if(t&&!e.disabled)return t.addEventListener(Ae,g),()=>t.removeEventListener(Ae,g)},[j,e.onSelect,e.disabled]),!j)return null;let{disabled:y,value:b,onSelect:w,forceMount:N,keywords:_,...k}=e;return a.createElement(c.div,{ref:o(n,t),...k,id:l,"cmdk-item":"",role:"option","aria-disabled":!!y,"aria-selected":!!f,"data-disabled":!!y,"data-selected":!!f,onPointerMove:y||m.getDisablePointerSelection()?void 0:v,onClick:y?void 0:g},e.children)}),Ue=a.forwardRef((e,t)=>{let{heading:s,children:r,forceMount:l,...n}=e,d=i(),m=a.useRef(null),u=a.useRef(null),h=i(),x=Me(),p=at(e=>!(!l&&!1!==x.filter())||(!e.search||e.filtered.groups.has(d)));tt(()=>x.group(d),[]),rt(d,m,[e.value,e.heading,u]);let f=a.useMemo(()=>({id:d,forceMount:l}),[l]);return a.createElement(c.div,{ref:o(m,t),...n,"cmdk-group":"",role:"presentation",hidden:!p||void 0},s&&a.createElement("div",{ref:u,"cmdk-group-heading":"","aria-hidden":!0,id:h},s),nt(e,e=>a.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":s?h:void 0},a.createElement(Ve.Provider,{value:f},e))))}),Be=a.forwardRef((e,t)=>{let{alwaysRender:s,...r}=e,l=a.useRef(null),n=at(e=>!e.search);return s||n?a.createElement(c.div,{ref:o(l,t),...r,"cmdk-separator":"",role:"separator"}):null}),Ye=a.forwardRef((e,t)=>{let{onValueChange:s,...r}=e,l=null!=e.value,n=ze(),i=at(e=>e.search),o=at(e=>e.selectedItemId),d=Me();return a.useEffect(()=>{null!=e.value&&n.setState("search",e.value)},[e.value]),a.createElement(c.input,{ref:t,...r,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":d.listId,"aria-labelledby":d.labelId,"aria-activedescendant":o,id:d.inputId,type:"text",value:l?e.value:i,onChange:e=>{l||n.setState("search",e.target.value),null==s||s(e.target.value)}})}),We=a.forwardRef((e,t)=>{let{children:s,label:r="Suggestions",...l}=e,n=a.useRef(null),i=a.useRef(null),d=at(e=>e.selectedItemId),m=Me();return a.useEffect(()=>{if(i.current&&n.current){let e,t=i.current,s=n.current,a=new ResizeObserver(()=>{e=requestAnimationFrame(()=>{let e=t.offsetHeight;s.style.setProperty("--cmdk-list-height",e.toFixed(1)+"px")})});return a.observe(t),()=>{cancelAnimationFrame(e),a.unobserve(t)}}},[]),a.createElement(c.div,{ref:o(n,t),...l,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":d,"aria-label":r,id:m.listId},nt(e,e=>a.createElement("div",{ref:o(i,m.listInnerRef),"cmdk-list-sizer":""},e)))}),Ge=a.forwardRef((e,t)=>{let{open:s,onOpenChange:r,overlayClassName:l,contentClassName:n,container:i,...c}=e;return a.createElement(v,{open:s,onOpenChange:r},a.createElement(y,{container:i},a.createElement(b,{"cmdk-overlay":"",className:l}),a.createElement(w,{"aria-label":e.label,"cmdk-dialog":"",className:n},a.createElement(Le,{ref:t,...c}))))}),Je=a.forwardRef((e,t)=>at(e=>0===e.filtered.count)?a.createElement(c.div,{ref:t,...e,"cmdk-empty":"",role:"presentation"}):null),Ze=a.forwardRef((e,t)=>{let{progress:s,children:r,label:l="Loading...",...n}=e;return a.createElement(c.div,{ref:t,...n,"cmdk-loading":"",role:"progressbar","aria-valuenow":s,"aria-valuemin":0,"aria-valuemax":100,"aria-label":l},nt(e,e=>a.createElement("div",{"aria-hidden":!0},e)))}),He=Object.assign(Le,{List:We,Item:Te,Input:Ye,Group:Ue,Separator:Be,Dialog:Ge,Empty:Je,Loading:Ze});function Xe(e,t){let s=e.nextElementSibling;for(;s;){if(s.matches(t))return s;s=s.nextElementSibling}}function Qe(e,t){let s=e.previousElementSibling;for(;s;){if(s.matches(t))return s;s=s.previousElementSibling}}function et(e){let t=a.useRef(e);return tt(()=>{t.current=e}),t}var tt="undefined"==typeof window?a.useEffect:a.useLayoutEffect;function st(e){let t=a.useRef();return void 0===t.current&&(t.current=e()),t}function at(e){let t=ze(),s=()=>e(t.snapshot());return a.useSyncExternalStore(t.subscribe,s,s)}function rt(e,t,s,r=[]){let l=a.useRef(),n=Me();return tt(()=>{var a;let i=(()=>{var e;for(let t of s){if("string"==typeof t)return t.trim();if("object"==typeof t&&"current"in t)return t.current?null==(e=t.current.textContent)?void 0:e.trim():l.current}})(),c=r.map(e=>e.trim());n.value(e,i,c),null==(a=t.current)||a.setAttribute(qe,i),l.current=i}),l}var lt=()=>{let[e,t]=a.useState(),s=st(()=>new Map);return tt(()=>{s.current.forEach(e=>e()),s.current=new Map},[e]),(e,a)=>{s.current.set(e,a),t({})}};function nt({asChild:e,children:t},s){return e&&a.isValidElement(t)?a.cloneElement(function(e){let t=e.type;return"function"==typeof t?t(e.props):"render"in t?t.render(e.props):e}(t),{ref:t.ref},s(t.props.children)):s(t)}var it={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const ct=a.forwardRef(({className:e,...t},s)=>r.jsx(He,{ref:s,className:d("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",e),...t}));ct.displayName=He.displayName;const ot=a.forwardRef(({className:e,...t},s)=>r.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[r.jsx(R,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),r.jsx(He.Input,{ref:s,className:d("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",e),...t})]}));ot.displayName=He.Input.displayName;a.forwardRef(({className:e,...t},s)=>r.jsx(He.List,{ref:s,className:d("max-h-[300px] overflow-y-auto overflow-x-hidden",e),...t})).displayName=He.List.displayName;const dt=a.forwardRef((e,t)=>r.jsx(He.Empty,{ref:t,className:"py-6 text-center text-sm",...e}));dt.displayName=He.Empty.displayName;const mt=a.forwardRef(({className:e,...t},s)=>r.jsx(He.Group,{ref:s,className:d("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",e),...t}));mt.displayName=He.Group.displayName;a.forwardRef(({className:e,...t},s)=>r.jsx(He.Separator,{ref:s,className:d("-mx-1 h-px bg-border",e),...t})).displayName=He.Separator.displayName;const ut=a.forwardRef(({className:e,...t},s)=>r.jsx(He.Item,{ref:s,className:d("relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",e),...t}));function ht({options:e,value:t,onValueChange:s,placeholder:n="선택...",searchPlaceholder:i="검색...",emptyText:c="결과가 없습니다.",className:o}){const[m,u]=a.useState(!1);return r.jsxs(de,{open:m,onOpenChange:u,children:[r.jsx(me,{asChild:!0,children:r.jsxs(l,{variant:"outline",role:"combobox","aria-expanded":m,className:d("w-full justify-between h-9 text-sm font-normal",o),children:[t?e.find(e=>e.value===t)?.label:n,r.jsx(pe,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),r.jsx(ue,{className:"w-full p-0",align:"start",children:r.jsxs(ct,{children:[r.jsx(ot,{placeholder:i,className:"h-9"}),r.jsx(dt,{children:c}),r.jsx(mt,{className:"max-h-[300px] overflow-auto",children:e.map(e=>r.jsxs(ut,{value:e.label,onSelect:()=>{s(e.value===t?"":e.value),u(!1)},children:[r.jsx(he,{className:d("mr-2 h-4 w-4",t===e.value?"opacity-100":"opacity-0")}),e.label]},e.value))})]})})]})}async function xt(e){const t=new xe.Workbook,s=t.addWorksheet("출근현황표");s.pageSetup={paperSize:9,orientation:"portrait",margins:{left:.7,right:.7,top:.75,bottom:.75,header:.3,footer:.3}},s.columns=[{width:12},{width:8},{width:12},{width:8},{width:6},{width:8},{width:12},{width:12},{width:8},{width:8}];s.addRow(["1"]).height=25,s.mergeCells("A1:J1");const a=s.getCell("A1");a.value="1",a.font={name:"맑은 고딕",size:14,bold:!0},a.alignment={horizontal:"center",vertical:"middle"},s.addRow([]);s.addRow([`${e.employeeName} 내역 (21)`]).height=20,s.mergeCells("A3:J3");const r=s.getCell("A3");r.font={name:"맑은 고딕",size:12,bold:!0},r.alignment={horizontal:"left",vertical:"middle"};s.addRow([`조회기간: ${e.startDate} ~ ${e.endDate}`]).height=20,s.mergeCells("A4:J4");const l=s.getCell("A4");l.font={name:"맑은 고딕",size:10},l.alignment={horizontal:"left",vertical:"middle"};const n=s.addRow(["날짜","이름","사번","부서","직급","근무형태","출근시간","퇴근시간","출퇴근상태","근무상태"]);n.height=25,n.eachCell((e,t)=>{e.font={name:"맑은 고딕",size:10,bold:!0},e.alignment={horizontal:"center",vertical:"middle"},e.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE0E0E0"}}});e.records.forEach(e=>{let t=e.remarks||"-";const a=(e=>{const t=new Date(e.split("(")[0]),s=t.getDay();if(0===s||6===s)return!0;const a=t.getFullYear(),r=t.getMonth()+1,l=t.getDate(),n=[`${a}-01-01`,`${a}-03-01`,`${a}-05-05`,`${a}-06-06`,`${a}-08-15`,`${a}-10-03`,`${a}-10-09`,`${a}-12-25`],i=`${a}-${r.toString().padStart(2,"0")}-${l.toString().padStart(2,"0")}`;return n.includes(i)})(e.date);if(e.remarks&&e.remarks.includes("연차"))t="연차";else if(a){const s=new Date(e.date.split("(")[0]).getDay();t=0===s||6===s?"주말":"공휴일"}const r=s.addRow([e.date,e.employeeName,e.employeeId,e.department,e.position,e.workType,e.clockIn||"-",e.clockOut||"-",e.status,t]);r.height=20;const l=a,n=e.remarks&&e.remarks.includes("연차");r.eachCell((e,t)=>{e.font={name:"맑은 고딕",size:9},e.alignment={horizontal:1===t?"center":"left",vertical:"middle"},e.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},7!==t&&8!==t||(e.alignment={horizontal:"center",vertical:"middle"}),n?e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE8F5E8"}}:l&&(e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFE8E8"}})})});const i=await t.xlsx.writeBuffer();return new Blob([i],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})}function pt(e){const t=function(e){return["일","월","화","수","목","금","토"][new Date(e).getDay()]}(e);return`${e}(${t})`}function ft({employees:e,isOpen:s,onClose:n}){const[i,c]=a.useState(""),[o,d]=a.useState(""),[u,g]=a.useState(""),[v,y]=a.useState(!1),b=t(),w=()=>{c(""),d(""),g(""),y(!1),n()};return r.jsx(x,{open:s,onOpenChange:w,children:r.jsxs(p,{className:"sm:max-w-[520px] max-h-[85vh] overflow-y-auto",children:[r.jsxs(f,{className:"pb-6 space-y-3",children:[r.jsxs(j,{className:"flex items-center text-2xl font-bold text-gray-900",children:[r.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-hansl-400 to-hansl-600 flex items-center justify-center mr-4 shadow-sm",children:r.jsx(C,{className:"w-6 h-6 text-white"})}),"출근현황표 다운로드"]}),r.jsxs("p",{className:"text-gray-600 leading-relaxed pl-16",children:["직원과 조회 기간을 선택하여 출근현황을",r.jsx("br",{}),"엑셀 파일로 간편하게 다운로드하세요"]})]}),r.jsxs("div",{className:"space-y-8 py-2",children:[r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"w-8 h-8 rounded-lg bg-blue-50 flex items-center justify-center",children:r.jsx(m,{className:"w-4 h-4 text-blue-600"})}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"직원 선택"})]}),r.jsx("div",{className:"pl-11",children:r.jsx(ht,{value:i,onValueChange:c,options:e.filter(e=>e.name&&""!==e.name.trim()).sort((e,t)=>(e.name||"").localeCompare(t.name||"")).map(e=>({value:e.id,label:`${e.name} (${e.department||"부서없음"})`})),placeholder:"직원명 검색...",searchPlaceholder:"직원 이름 검색...",emptyText:"검색 결과가 없습니다",className:"h-10 text-sm border-gray-200 focus:border-hansl-400 focus:ring-1 focus:ring-hansl-100"})})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"w-8 h-8 rounded-lg bg-green-50 flex items-center justify-center",children:r.jsx(C,{className:"w-4 h-4 text-green-600"})}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"조회 기간"})]}),r.jsxs("div",{className:"pl-11 space-y-4",children:[r.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"시작일"}),r.jsx(h,{type:"date",value:o,onChange:e=>d(e.target.value),className:"h-9 text-sm border-gray-200 focus:border-hansl-400 focus:ring-1 focus:ring-hansl-100"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"종료일"}),r.jsx(h,{type:"date",value:u,onChange:e=>g(e.target.value),className:"h-9 text-sm border-gray-200 focus:border-hansl-400 focus:ring-1 focus:ring-hansl-100"})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("p",{className:"text-sm font-medium text-gray-700",children:"빠른 선택"}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(l,{type:"button",variant:"outline",size:"sm",onClick:()=>{const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1),s=new Date(e.getFullYear(),e.getMonth()+1,0);d(t.toISOString().split("T")[0]),g(s.toISOString().split("T")[0])},className:"h-8 px-4 text-sm border-gray-200 hover:bg-hansl-50 hover:border-hansl-300 hover:text-hansl-700 transition-colors",children:"이번 달"}),r.jsx(l,{type:"button",variant:"outline",size:"sm",onClick:()=>{const e=new Date,t=new Date(e.getFullYear(),e.getMonth()-1,1),s=new Date(e.getFullYear(),e.getMonth(),0);d(t.toISOString().split("T")[0]),g(s.toISOString().split("T")[0])},className:"h-8 px-4 text-sm border-gray-200 hover:bg-hansl-50 hover:border-hansl-300 hover:text-hansl-700 transition-colors",children:"지난 달"})]})]})]})]})]}),r.jsxs("div",{className:"flex gap-3 pt-6 mt-2 border-t border-gray-100",children:[r.jsx(l,{variant:"outline",onClick:w,className:"flex-1 h-10 text-sm font-medium border-gray-200 hover:bg-gray-50 transition-colors",disabled:v,children:"취소"}),r.jsxs(l,{onClick:async()=>{if(i)if(o&&u)if(new Date(o)>new Date(u))A.error("시작일이 종료일보다 늦을 수 없습니다.");else{y(!0);try{const t=e.find(e=>e.id===i);if(!t)throw new Error("선택된 직원 정보를 찾을 수 없습니다.");const{data:s,error:a}=await b.from("attendance_records").select("*").eq("employee_id",i).gte("date",o).lte("date",u).order("date",{ascending:!0});if(a)throw new Error("출근 기록을 조회하는데 실패했습니다.");const r=[],l=new Date(o),c=new Date(u);for(let e=new Date(l);e<=c;e.setDate(e.getDate()+1))r.push(e.toISOString().split("T")[0]);const d=new Map;s?.forEach(e=>{d.set(e.date,e)});const m=r.map(e=>{const s=d.get(e),a=pt(e),r=a.split("(")[1]?.split(")")[0]||"",l=new Date(e),n=0===l.getDay()||6===l.getDay();return{date:a,dayOfWeek:r,employeeName:t.name||"",employeeId:t.employeeID||t.employee_number||"",department:t.department||"",position:t.position||"",workType:"사원",clockIn:s?.clock_in||(n?"-":""),clockOut:s?.clock_out||(n?"-":""),status:"정상 출근"===s?.status?"정상 출근":s?.status||"",remarks:s?.remarks||""}}),h={employeeName:t.name||"",employeeId:t.employeeID||"",department:t.department||"",startDate:o,endDate:u,records:m},x=await xt(h),p=window.URL.createObjectURL(x),f=document.createElement("a");f.href=p,f.download=`출근현황표_${t.name}_${o}_${u}.xlsx`,document.body.appendChild(f),f.click(),document.body.removeChild(f),window.URL.revokeObjectURL(p),A.success("출근현황표가 다운로드되었습니다."),n()}catch(t){A.error(t instanceof Error?t.message:"다운로드 중 오류가 발생했습니다.")}finally{y(!1)}}else A.error("조회 기간을 설정해주세요.");else A.error("직원을 선택해주세요.")},disabled:v||!i||!o||!u,className:"flex-1 h-10 text-sm bg-gradient-to-r from-hansl-500 to-hansl-600 hover:from-hansl-600 hover:to-hansl-700 text-white font-medium shadow-sm transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:[r.jsx(D,{className:"w-4 h-4 mr-2"}),v?"다운로드 중...":"엑셀 다운로드"]})]})]})})}function jt(){const[e,t]=a.useState([]),[s,l]=a.useState([]),[n,i]=a.useState(!0),[c,o]=a.useState({}),[d,m]=a.useState(!1),[h,x]=a.useState(null),[p,f]=a.useState("create"),[j,g]=a.useState(!1),v=async()=>{i(!0);try{const e=await fe.getEmployees(c);e.success&&e.data?(t(e.data),l(e.data)):A.error(e.error||"직원 목록을 불러오는데 실패했습니다.")}catch(e){A.error("직원 목록을 불러오는 중 오류가 발생했습니다.")}finally{i(!1)}};a.useEffect(()=>{v()},[]),a.useEffect(()=>{v()},[c]);return n&&0===e.length?r.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),r.jsx("p",{className:"mt-2 text-gray-600",children:"직원 목록을 불러오는 중..."})]})}):r.jsx(r.Fragment,{children:r.jsxs("div",{className:"space-y-6",children:[r.jsx(ge,{filters:c,onFiltersChange:o,onExport:async()=>{try{const e=await fe.getEmployeesForExport();if(e.success&&e.data){const t=await u(()=>import("./xlsx-ByDo_lG2.js"),[]),s=t.utils.json_to_sheet(e.data),a=t.utils.book_new();t.utils.book_append_sheet(a,s,"직원 목록");const r=`직원_목록_${(new Date).toISOString().slice(0,10)}.xlsx`;t.writeFile(a,r),A.success("Excel 파일이 다운로드되었습니다.")}else A.error(e.error||"Excel 내보내기에 실패했습니다.")}catch(e){A.error("Excel 내보내기 중 오류가 발생했습니다.")}},onCreateNew:()=>{x(null),f("create"),m(!0)},onAttendanceDownload:()=>g(!0)}),r.jsxs("div",{className:"bg-white rounded-lg border",children:[r.jsx("div",{className:"p-4 border-b",children:r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("h3",{className:"text-lg font-medium",children:"직원 목록"}),r.jsx("div",{className:"text-sm text-gray-600",children:n?"로딩 중...":`총 ${s.length}명의 직원`})]})}),r.jsx(ve,{employees:s,onEdit:e=>{x(e),f("edit"),m(!0)},onView:e=>{x(e),f("view"),m(!0)},onRefresh:v})]}),r.jsx(be,{isOpen:d,onClose:()=>{m(!1),x(null)},employee:h,onSave:()=>{v()},mode:p}),r.jsx(ft,{employees:e,isOpen:j,onClose:()=>g(!1)})]})})}ut.displayName=He.Item.displayName;export{jt as default};
//# sourceMappingURL=EmployeeMain-VmY26MM2.js.map
