import{a as X,l as E,r as m,j as e,B as k,X as J,_ as Q}from"./index-BA_gFQ-Z.js";import{P as W,I as O,S as $,a as L,b as U,c as A,d as b,D as Y,e as ee,f as se,g as ae,h as re}from"./dialog-B0amFztA.js";import{D as te,u as le,S as y,M as ne,c as ce,d as w,e as ie,a as oe,T as de,b as ue,F as he,f as F,g as P,h as T,i as M,j as V}from"./form-nRyFi71I.js";import{S as xe,a as me,b as je,c as B,d as j,e as pe,f as p,E as ge,T as be}from"./card-BGBaK9_2.js";import{B as H,t as f}from"./index-CFkfiXwO.js";import{u as ve}from"./index.esm-D8HC7T_W.js";class fe{constructor(){this.supabase=X()}async getEmployees(a){try{let s=this.supabase.from("employees").select("*").order("name");a?.search&&(s=s.or(`
          name.ilike.%${a.search}%,
          email.ilike.%${a.search}%,
          phone.ilike.%${a.search}%,
          position.ilike.%${a.search}%,
          department.ilike.%${a.search}%,
          slack_id.ilike.%${a.search}%
        `)),a?.department&&(s=s.eq("department",a.department)),a?.position&&(s=s.eq("position",a.position)),a?.purchase_role&&(s=s.eq("purchase_role",a.purchase_role)),a?.is_active!==void 0&&(s=s.eq("is_active",a.is_active));const{data:t,error:l}=await s;if(l)throw l;return{success:!0,data:t||[]}}catch(s){return E.error("직원 목록 조회 실패",s),{success:!1,error:s instanceof Error?s.message:"알 수 없는 오류가 발생했습니다."}}}async getEmployee(a){try{const{data:s,error:t}=await this.supabase.from("employees").select("*").eq("id",a).single();if(t)throw t;return{success:!0,data:s}}catch(s){return E.error("직원 조회 실패",s),{success:!1,error:s instanceof Error?s.message:"알 수 없는 오류가 발생했습니다."}}}async createEmployee(a){try{if(a.email){const{data:x}=await this.supabase.from("employees").select("id").eq("email",a.email).single();if(x)return{success:!1,error:"이미 등록된 이메일입니다."}}if(a.slack_id){const{data:x}=await this.supabase.from("employees").select("id").eq("slack_id",a.slack_id).single();if(x)return{success:!1,error:"이미 등록된 Slack ID입니다."}}const s=crypto.randomUUID(),{data:t,error:l}=await this.supabase.from("employees").insert({id:s,...a,purchase_role:a.purchase_role?.join(",")||null,is_active:!0}).select().single();if(l)throw l;return{success:!0,data:t}}catch(s){return E.error("직원 생성 실패",s),{success:!1,error:s instanceof Error?s.message:"알 수 없는 오류가 발생했습니다."}}}async updateEmployee(a,s){try{if(s.email){const{data:v}=await this.supabase.from("employees").select("id").eq("email",s.email).neq("id",a).single();if(v)return{success:!1,error:"이미 등록된 이메일입니다."}}if(s.slack_id){const{data:v}=await this.supabase.from("employees").select("id").eq("slack_id",s.slack_id).neq("id",a).single();if(v)return{success:!1,error:"이미 등록된 Slack ID입니다."}}const t={...s,purchase_role:s.purchase_role?s.purchase_role.join(","):void 0};t.purchase_role===void 0&&delete t.purchase_role;const{data:l,error:x}=await this.supabase.from("employees").update(t).eq("id",a).select().single();if(x)throw x;return{success:!0,data:l}}catch(t){return E.error("직원 수정 실패",t),{success:!1,error:t instanceof Error?t.message:"알 수 없는 오류가 발생했습니다."}}}async deleteEmployee(a){try{const{data:s}=await this.supabase.from("purchase_requests").select("id").eq("requester_id",a).limit(1);if(s&&s.length>0){const{error:t}=await this.supabase.from("employees").update({is_active:!1}).eq("id",a);if(t)throw t;return{success:!0}}else{const{error:t}=await this.supabase.from("employees").delete().eq("id",a);if(t)throw t;return{success:!0}}}catch(s){return E.error("직원 삭제 실패",s),{success:!1,error:s instanceof Error?s.message:"알 수 없는 오류가 발생했습니다."}}}async toggleEmployeeStatus(a){try{const{data:s,error:t}=await this.supabase.from("employees").select("is_active").eq("id",a).single();if(t)throw t;const{data:l,error:x}=await this.supabase.from("employees").update({is_active:!s.is_active}).eq("id",a).select().single();if(x)throw x;return{success:!0,data:l}}catch(s){return E.error("직원 상태 변경 실패",s),{success:!1,error:s instanceof Error?s.message:"알 수 없는 오류가 발생했습니다."}}}async updateEmployeeRole(a,s){try{const{data:t,error:l}=await this.supabase.from("employees").update({purchase_role:s}).eq("id",a).select().single();if(l)throw l;return{success:!0,data:t}}catch(t){return E.error("직원 권한 변경 실패",t),{success:!1,error:t instanceof Error?t.message:"알 수 없는 오류가 발생했습니다."}}}async getDepartments(){try{const{data:a,error:s}=await this.supabase.from("employees").select("department").not("department","is",null).not("department","eq","");if(s)throw s;return{success:!0,data:[...new Set((a||[]).map(l=>l.department))].sort()}}catch(a){return E.error("부서 목록 조회 실패",a),{success:!1,error:a instanceof Error?a.message:"알 수 없는 오류가 발생했습니다."}}}async getPositions(){try{const{data:a,error:s}=await this.supabase.from("employees").select("position").not("position","is",null).not("position","eq","");if(s)throw s;return{success:!0,data:[...new Set((a||[]).map(l=>l.position))].sort()}}catch(a){return E.error("직급 목록 조회 실패",a),{success:!1,error:a instanceof Error?a.message:"알 수 없는 오류가 발생했습니다."}}}async getEmployeesForExport(){try{const{data:a,error:s}=await this.supabase.from("employees").select("*").order("name");if(s)throw s;return{success:!0,data:(a||[]).map(l=>({이름:l.name,이메일:l.email||"",전화번호:l.phone||"",주소:l.adress||"",부서:l.department||"",직급:l.position||"",권한:this.getRoleDisplayName(l.purchase_role),"Slack ID":l.slack_id||"",상태:l.is_active?"활성":"비활성",등록일:l.created_at?new Date(l.created_at).toLocaleDateString("ko-KR"):""}))}}catch(a){return E.error("직원 Excel 내보내기 실패",a),{success:!1,error:a instanceof Error?a.message:"알 수 없는 오류가 발생했습니다."}}}getRoleDisplayName(a){return{app_admin:"앱 관리자",ceo:"CEO",final_approver:"최종 승인자",middle_manager:"중간 관리자",lead_buyer:"수석 구매자",buyer:"구매자"}[a||""]||a||"권한 없음"}async checkPermission(a,s){try{const{data:t}=await this.supabase.from("employees").select("purchase_role, is_active").eq("id",a).single();return!t||!t.is_active?{success:!0,hasPermission:!1}:{success:!0,hasPermission:s.includes(t.purchase_role)}}catch(t){return{success:!1,error:t instanceof Error?t.message:"알 수 없는 오류가 발생했습니다."}}}}const D=new fe,_e=[{value:"app_admin",label:"앱 관리자"},{value:"ceo",label:"CEO"},{value:"final_approver",label:"최종 승인자"},{value:"middle_manager",label:"중간 관리자"},{value:"lead_buyer",label:"수석 구매자"},{value:"buyer",label:"구매자"}];function ye({filters:h,onFiltersChange:a,onExport:s,onCreateNew:t}){const[l,x]=m.useState(h.search||""),[v,q]=m.useState([]),[C,_]=m.useState([]);m.useEffect(()=>{(async()=>{const[R,K]=await Promise.all([D.getDepartments(),D.getPositions()]);R.success&&q(R.data||[]),K.success&&_(K.data||[])})()},[]);const d=n=>{n.preventDefault(),a({...h,search:l.trim()||void 0})},c=n=>{a({...h,department:n==="all"?void 0:n})},S=n=>{a({...h,position:n==="all"?void 0:n})},N=n=>{a({...h,purchase_role:n==="all"?void 0:n==="none"?"":n})},g=n=>{a({...h,is_active:n==="all"?void 0:n==="active"})},u=()=>{x(""),a({})},i=h.search||h.department||h.position||h.purchase_role||h.is_active!==void 0;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"직원 관리"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{variant:"outline",onClick:s,className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4"}),"Excel 내보내기"]}),e.jsxs(k,{onClick:t,className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),"직원 등록"]})]})]}),e.jsx("div",{className:"bg-white p-4 rounded-lg border space-y-4",children:e.jsxs("form",{onSubmit:d,className:"flex gap-4 items-end flex-wrap",children:[e.jsxs("div",{className:"flex-1 sm:min-w-[300px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"검색"}),e.jsxs("div",{className:"relative",children:[e.jsx(xe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(O,{type:"text",placeholder:"이름, 이메일, 전화번호, 직급, 부서, Slack ID로 검색",value:l,onChange:n=>x(n.target.value),className:"pl-10"})]})]}),e.jsxs("div",{className:"sm:min-w-[120px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"부서"}),e.jsxs($,{value:h.department||"all",onValueChange:c,children:[e.jsx(L,{children:e.jsx(U,{})}),e.jsxs(A,{children:[e.jsx(b,{value:"all",children:"전체 부서"}),v.map(n=>e.jsx(b,{value:n,children:n},n))]})]})]}),e.jsxs("div",{className:"sm:min-w-[120px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"직급"}),e.jsxs($,{value:h.position||"all",onValueChange:S,children:[e.jsx(L,{children:e.jsx(U,{})}),e.jsxs(A,{children:[e.jsx(b,{value:"all",children:"전체 직급"}),C.map(n=>e.jsx(b,{value:n,children:n},n))]})]})]}),e.jsxs("div",{className:"sm:min-w-[140px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"권한"}),e.jsxs($,{value:h.purchase_role||"all",onValueChange:N,children:[e.jsx(L,{children:e.jsx(U,{})}),e.jsxs(A,{children:[e.jsx(b,{value:"all",children:"전체 권한"}),e.jsx(b,{value:"none",children:"권한 없음"}),_e.map(n=>e.jsx(b,{value:n.value,children:n.label},n.value))]})]})]}),e.jsxs("div",{className:"sm:min-w-[100px]",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"상태"}),e.jsxs($,{value:h.is_active===void 0?"all":h.is_active?"active":"inactive",onValueChange:g,children:[e.jsx(L,{children:e.jsx(U,{})}),e.jsxs(A,{children:[e.jsx(b,{value:"all",children:"전체"}),e.jsx(b,{value:"active",children:"활성"}),e.jsx(b,{value:"inactive",children:"비활성"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{type:"submit",children:"검색"}),i&&e.jsxs(k,{type:"button",variant:"outline",onClick:u,className:"flex items-center gap-1",children:[e.jsx(J,{className:"w-4 h-4"}),"초기화"]})]})]})})]})}function we({employees:h,onEdit:a,onView:s,onRefresh:t}){const[l,x]=m.useState(null),[v,q]=m.useState(null),C=X(),{sortedData:_,sortConfig:d,handleSort:c}=le(h,"name","asc");m.useEffect(()=>{(async()=>{const{data:{user:o}}=await C.auth.getUser();if(o){const{data:I}=await C.from("employees").select("role, purchase_role").eq("id",o.id).single();I&&q(I.role||"")}})()},[]);const S=v==="hr"||v==="admin",N=S,g=S,u=async r=>{x(r.id);try{const o=await D.toggleEmployeeStatus(r.id);o.success?(f.success(`직원이 ${r.is_active?"비활성화":"활성화"}되었습니다.`),t()):f.error(o.error||"상태 변경에 실패했습니다.")}catch{f.error("상태 변경 중 오류가 발생했습니다.")}finally{x(null)}},i=async r=>{if(confirm(`정말로 '${r.name}' 직원을 삭제하시겠습니까?`)){x(r.id);try{const o=await D.deleteEmployee(r.id);o.success?(f.success("직원이 삭제되었습니다."),t()):f.error(o.error||"삭제에 실패했습니다.")}catch{f.error("삭제 중 오류가 발생했습니다.")}finally{x(null)}}},n=r=>({app_admin:"앱 관리자",ceo:"CEO",final_approver:"최종 승인자",middle_manager:"중간 관리자",lead_buyer:"수석 구매자",buyer:"구매자"})[r||""]||"권한 없음",R=r=>({app_admin:"bg-purple-100 text-purple-800",ceo:"bg-red-100 text-red-800",final_approver:"bg-hansl-100 text-hansl-800",middle_manager:"bg-green-100 text-green-800",lead_buyer:"bg-yellow-100 text-yellow-800",buyer:"bg-gray-100 text-gray-800"})[r||""]||"bg-gray-100 text-gray-600",K=r=>r?new Date(r).toLocaleDateString("ko-KR"):"-";return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden lg:block border rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(me,{children:[e.jsx(je,{children:e.jsxs(B,{children:[e.jsx(j,{className:"whitespace-nowrap",children:e.jsx(y,{sortKey:"employeeID",currentSortKey:d.key,sortDirection:d.direction,onSort:()=>c("employeeID"),children:"사번"})}),e.jsx(j,{children:e.jsx(y,{sortKey:"name",currentSortKey:d.key,sortDirection:d.direction,onSort:()=>c("name"),children:"이름"})}),e.jsx(j,{children:e.jsx(y,{sortKey:"position",currentSortKey:d.key,sortDirection:d.direction,onSort:()=>c("position"),children:"직급"})}),e.jsx(j,{children:e.jsx(y,{sortKey:"department",currentSortKey:d.key,sortDirection:d.direction,onSort:()=>c("department"),children:"부서"})}),e.jsx(j,{children:e.jsx(y,{sortKey:"phone",currentSortKey:d.key,sortDirection:d.direction,onSort:()=>c("phone"),children:"연락처"})}),e.jsx(j,{children:e.jsx(y,{sortKey:"email",currentSortKey:d.key,sortDirection:d.direction,onSort:()=>c("email"),children:"이메일"})}),e.jsx(j,{children:"생성연차"}),e.jsx(j,{children:"사용연차"}),e.jsx(j,{children:"남은연차"}),e.jsx(j,{className:"hidden lg:table-cell",children:e.jsx(y,{sortKey:"join_date",currentSortKey:d.key,sortDirection:d.direction,onSort:()=>c("join_date"),children:"입사일"})}),e.jsx(j,{className:"hidden lg:table-cell",children:e.jsx(y,{sortKey:"birthday",currentSortKey:d.key,sortDirection:d.direction,onSort:()=>c("birthday"),children:"생년월일"})}),S&&e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"hidden xl:table-cell",children:"은행"}),e.jsx(j,{className:"hidden xl:table-cell",children:"계좌번호"}),e.jsx(j,{className:"hidden 2xl:table-cell",children:"주소"}),e.jsx(j,{children:e.jsx(y,{sortKey:"purchase_role",currentSortKey:d.key,sortDirection:d.direction,onSort:()=>c("purchase_role"),children:"권한"})}),e.jsx(j,{children:e.jsx(y,{sortKey:"slack_id",currentSortKey:d.key,sortDirection:d.direction,onSort:()=>c("slack_id"),children:"Slack ID"})}),e.jsx(j,{children:e.jsx(y,{sortKey:"is_active",currentSortKey:d.key,sortDirection:d.direction,onSort:()=>c("is_active"),children:"상태"})})]}),e.jsx(j,{className:"w-[100px]",children:"작업"})]})}),e.jsx(pe,{children:h.length===0?e.jsx(B,{children:e.jsx(p,{colSpan:N?14:7,className:"text-center py-8 text-gray-500",children:"등록된 직원이 없습니다."})}):_.map(r=>e.jsxs(B,{children:[e.jsx(p,{className:"font-medium",children:r.employeeID||r.employee_number||r.id.slice(0,8)}),e.jsx(p,{children:r.name}),e.jsx(p,{children:r.position||"-"}),e.jsx(p,{children:r.department||"-"}),e.jsx(p,{children:r.phone||"-"}),e.jsx(p,{children:r.email||"-"}),e.jsx(p,{className:"text-center",children:r.annual_leave_granted_current_year||0}),e.jsx(p,{className:"text-center",children:r.used_annual_leave||0}),e.jsx(p,{className:"text-center",children:r.remaining_annual_leave!==void 0?r.remaining_annual_leave:"-"}),e.jsx(p,{className:"hidden lg:table-cell",children:K(r.join_date)}),e.jsx(p,{className:"hidden lg:table-cell",children:K(r.birthday)}),S&&e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"hidden xl:table-cell",children:r.bank||"-"}),e.jsx(p,{className:"hidden xl:table-cell",children:r.bank_account||"-"}),e.jsx(p,{className:"hidden 2xl:table-cell",children:r.adress||"-"}),e.jsx(p,{children:e.jsx(H,{className:R(r.purchase_role),children:n(r.purchase_role)})}),e.jsx(p,{children:r.slack_id||"-"}),e.jsx(p,{children:e.jsx(H,{variant:r.is_active?"default":"secondary",className:r.is_active?"bg-green-100 text-green-800":"",children:r.is_active?"활성":"비활성"})})]})]},r.id))})]})})}),e.jsx("div",{className:"block lg:hidden space-y-3",children:_.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"등록된 직원이 없습니다."}):_.map(r=>e.jsxs(ne,{children:[e.jsx(ce,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:r.name}),e.jsx(H,{variant:r.is_active?"default":"secondary",className:r.is_active?"bg-green-100 text-green-800":"",children:r.is_active?"활성":"비활성"})]})}),e.jsx(w,{label:"사번",value:r.employeeID||r.employee_number||r.id.slice(0,8)}),e.jsx(w,{label:"직급",value:r.position||"-"}),e.jsx(w,{label:"부서",value:r.department||"-"}),e.jsx(w,{label:"연락처",value:r.phone||"-"}),e.jsx(w,{label:"이메일",value:r.email||"-"}),N&&e.jsxs(e.Fragment,{children:[e.jsx(w,{label:"권한",value:e.jsx(H,{className:R(r.purchase_role),children:n(r.purchase_role)})}),e.jsx(w,{label:"Slack ID",value:r.slack_id||"-"}),e.jsx(w,{label:"주소",value:r.adress||"-"}),e.jsx(w,{label:"은행",value:r.bank||"-"}),e.jsx(w,{label:"계좌번호",value:r.bank_account||"-"}),e.jsx(w,{label:"연차",value:r.remaining_annual_leave!==void 0?`${r.remaining_annual_leave}일`:"-"})]}),e.jsxs(ie,{children:[e.jsx(k,{size:"sm",variant:"outline",onClick:()=>s(r),children:e.jsx(ge,{className:"w-4 h-4"})}),g&&e.jsxs(e.Fragment,{children:[e.jsx(k,{size:"sm",variant:"outline",onClick:()=>a(r),children:e.jsx(oe,{className:"w-4 h-4"})}),e.jsx(k,{size:"sm",variant:"outline",onClick:()=>u(r),disabled:l===r.id,children:r.is_active?e.jsx(de,{className:"w-4 h-4"}):e.jsx(ue,{className:"w-4 h-4"})}),e.jsx(k,{size:"sm",variant:"outline",className:"text-red-600",onClick:()=>i(r),disabled:l===r.id,children:e.jsx(be,{className:"w-4 h-4"})})]})]})]},r.id))})]})}const Se=[{value:"app_admin",label:"앱 관리자"},{value:"ceo",label:"CEO"},{value:"final_approver",label:"최종 승인자"},{value:"middle_manager",label:"중간 관리자"},{value:"lead_buyer",label:"수석 구매자"},{value:"buyer",label:"구매자"}];function Ne({isOpen:h,onClose:a,employee:s,onSave:t,mode:l}){const[x,v]=m.useState(!1),[q,C]=m.useState([]),[_,d]=m.useState([]),c=ve({defaultValues:{name:"",email:"",phone:"",position:"",department:"",purchase_role:[],slack_id:""}});m.useEffect(()=>{(async()=>{const[i,n]=await Promise.all([D.getDepartments(),D.getPositions()]);i.success&&C(i.data||[]),n.success&&d(n.data||[])})()},[]),m.useEffect(()=>{s&&h?c.reset({name:s.name||"",email:s.email||"",phone:s.phone||"",position:s.position||"",department:s.department||"",purchase_role:s.purchase_role?s.purchase_role.split(","):[],slack_id:s.slack_id||""}):!s&&h&&c.reset({name:"",email:"",phone:"",position:"",department:"",purchase_role:[],slack_id:""})},[s,h,c]);const S=async u=>{v(!0);try{let i;l==="create"?i=await D.createEmployee(u):l==="edit"&&s&&(i=await D.updateEmployee(s.id,u)),i?.success?(f.success(l==="create"?"직원이 등록되었습니다.":"직원 정보가 수정되었습니다."),t(),a()):f.error(i?.error||"처리 중 오류가 발생했습니다.")}catch{f.error("처리 중 오류가 발생했습니다.")}finally{v(!1)}},N=()=>{switch(l){case"create":return"직원 등록";case"edit":return"직원 수정";case"view":return"직원 상세";default:return"직원"}},g=l==="view";return e.jsx(Y,{open:h,onOpenChange:a,children:e.jsxs(ee,{className:"w-full max-w-[95vw] sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(se,{children:e.jsx(ae,{children:N()})}),e.jsx(he,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(S),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(F,{control:c.control,name:"name",rules:{required:"이름을 입력해주세요."},render:({field:u})=>e.jsxs(P,{children:[e.jsx(T,{children:"이름 *"}),e.jsx(M,{children:e.jsx(O,{...u,placeholder:"이름을 입력하세요",disabled:g})}),e.jsx(V,{})]})}),e.jsx(F,{control:c.control,name:"email",rules:{pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"올바른 이메일 형식을 입력해주세요."}},render:({field:u})=>e.jsxs(P,{children:[e.jsx(T,{children:"이메일"}),e.jsx(M,{children:e.jsx(O,{...u,type:"email",placeholder:"user@example.com",disabled:g})}),e.jsx(V,{})]})}),e.jsx(F,{control:c.control,name:"phone",render:({field:u})=>e.jsxs(P,{children:[e.jsx(T,{children:"전화번호"}),e.jsx(M,{children:e.jsx(O,{...u,placeholder:"010-0000-0000",disabled:g})}),e.jsx(V,{})]})}),e.jsx(F,{control:c.control,name:"slack_id",render:({field:u})=>e.jsxs(P,{children:[e.jsx(T,{children:"Slack ID"}),e.jsx(M,{children:e.jsx(O,{...u,placeholder:"U01234567890",disabled:g})}),e.jsx(V,{})]})}),e.jsx(F,{control:c.control,name:"department",render:({field:u})=>e.jsxs(P,{children:[e.jsx(T,{children:"부서"}),e.jsx(M,{children:g?e.jsx(O,{...u,disabled:!0}):e.jsxs($,{onValueChange:u.onChange,defaultValue:u.value,children:[e.jsx(L,{children:e.jsx(U,{placeholder:"부서를 선택하세요"})}),e.jsxs(A,{children:[q.map(i=>e.jsx(b,{value:i,children:i},i)),e.jsx(b,{value:"custom",children:"직접 입력"})]})]})}),e.jsx(V,{})]})}),e.jsx(F,{control:c.control,name:"position",render:({field:u})=>e.jsxs(P,{children:[e.jsx(T,{children:"직급"}),e.jsx(M,{children:g?e.jsx(O,{...u,disabled:!0}):e.jsxs($,{onValueChange:u.onChange,defaultValue:u.value,children:[e.jsx(L,{children:e.jsx(U,{placeholder:"직급을 선택하세요"})}),e.jsxs(A,{children:[_.map(i=>e.jsx(b,{value:i,children:i},i)),e.jsx(b,{value:"custom",children:"직접 입력"})]})]})}),e.jsx(V,{})]})}),e.jsx(F,{control:c.control,name:"purchase_role",render:({field:u})=>e.jsxs(P,{children:[e.jsx(T,{children:"권한"}),e.jsx(M,{children:e.jsxs($,{onValueChange:i=>u.onChange(i==="none"?[]:[i]),defaultValue:u.value?.[0]||"none",disabled:g,children:[e.jsx(L,{children:e.jsx(U,{placeholder:"권한을 선택하세요"})}),e.jsxs(A,{children:[e.jsx(b,{value:"none",children:"권한 없음"}),Se.map(i=>e.jsx(b,{value:i.value,children:i.label},i.value))]})]})}),e.jsx(V,{})]})})]}),l==="view"&&s&&e.jsx("div",{className:"pt-4 border-t",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"상태:"}),e.jsx("span",{className:`ml-2 px-2 py-1 rounded text-xs ${s.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-600"}`,children:s.is_active?"활성":"비활성"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"등록일:"}),e.jsx("span",{className:"ml-2",children:s.created_at?new Date(s.created_at).toLocaleDateString("ko-KR"):"-"})]})]})}),e.jsxs(re,{className:"gap-2",children:[e.jsx(k,{type:"button",variant:"outline",onClick:a,children:l==="view"?"닫기":"취소"}),!g&&e.jsx(k,{type:"submit",disabled:x,children:x?l==="create"?"등록 중...":"수정 중...":l==="create"?"등록":"수정"})]})]})})]})})}function Ie(){const[h,a]=m.useState([]),[s,t]=m.useState([]),[l,x]=m.useState(!0),[v,q]=m.useState({}),[C,_]=m.useState(!1),[d,c]=m.useState(null),[S,N]=m.useState("create"),g=async()=>{x(!0);try{const o=await D.getEmployees(v);o.success&&o.data?(a(o.data),t(o.data)):f.error(o.error||"직원 목록을 불러오는데 실패했습니다.")}catch{f.error("직원 목록을 불러오는 중 오류가 발생했습니다.")}finally{x(!1)}};m.useEffect(()=>{g()},[]),m.useEffect(()=>{g()},[v]);const u=()=>{c(null),N("create"),_(!0)},i=o=>{c(o),N("edit"),_(!0)},n=o=>{c(o),N("view"),_(!0)},R=()=>{_(!1),c(null)},K=()=>{g()},r=async()=>{try{const o=await D.getEmployeesForExport();if(o.success&&o.data){const I=await Q(()=>import("./xlsx-DGuHH-KN.js"),[]),Z=I.utils.json_to_sheet(o.data),z=I.utils.book_new();I.utils.book_append_sheet(z,Z,"직원 목록");const G=`직원_목록_${new Date().toISOString().slice(0,10)}.xlsx`;I.writeFile(z,G),f.success("Excel 파일이 다운로드되었습니다.")}else f.error(o.error||"Excel 내보내기에 실패했습니다.")}catch{f.error("Excel 내보내기 중 오류가 발생했습니다.")}};return l&&h.length===0?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"직원 목록을 불러오는 중..."})]})}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(ye,{filters:v,onFiltersChange:q,onExport:r,onCreateNew:u}),e.jsxs("div",{className:"bg-white rounded-lg border",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium",children:"직원 목록"}),e.jsx("div",{className:"text-sm text-gray-600",children:l?"로딩 중...":`총 ${s.length}명의 직원`})]})}),e.jsx(we,{employees:s,onEdit:i,onView:n,onRefresh:g})]}),e.jsx(Ne,{isOpen:C,onClose:R,employee:d,onSave:K,mode:S})]})})}export{Ie as default};
//# sourceMappingURL=EmployeeMain-CBaw-nO7.js.map
