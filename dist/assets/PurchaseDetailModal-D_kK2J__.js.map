{"version":3,"file":"PurchaseDetailModal-D_kK2J__.js","sources":["../../node_modules/lucide-react/dist/esm/icons/circle-check-big.js","../../node_modules/lucide-react/dist/esm/icons/dollar-sign.js","../../node_modules/lucide-react/dist/esm/icons/grip-vertical.js","../../node_modules/lucide-react/dist/esm/icons/image.js","../../node_modules/lucide-react/dist/esm/icons/message-square-plus.js","../../node_modules/lucide-react/dist/esm/icons/pen.js","../../node_modules/lucide-react/dist/esm/icons/truck.js","../../node_modules/@dnd-kit/utilities/dist/utilities.esm.js","../../node_modules/@dnd-kit/accessibility/dist/accessibility.esm.js","../../node_modules/@dnd-kit/core/dist/core.esm.js","../../node_modules/@dnd-kit/sortable/dist/sortable.esm.js","../../src/components/ui/date-amount-picker-popover.tsx","../../src/components/ui/date-quantity-picker-popover.tsx","../../src/hooks/useConfirmDateAction.ts","../../src/constants/columnSettings.ts","../../src/types/transactionStatement.ts","../../src/services/transactionStatementService.ts","../../src/components/purchase/PurchaseDetailModal.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M21.801 10A10 10 0 1 1 17 3.335\", key: \"yps3ct\" }],\n  [\"path\", { d: \"m9 11 3 3L22 4\", key: \"1pflzl\" }]\n];\nconst CircleCheckBig = createLucideIcon(\"circle-check-big\", __iconNode);\n\nexport { __iconNode, CircleCheckBig as default };\n//# sourceMappingURL=circle-check-big.js.map\n","/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"line\", { x1: \"12\", x2: \"12\", y1: \"2\", y2: \"22\", key: \"7eqyqh\" }],\n  [\"path\", { d: \"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6\", key: \"1b0p4s\" }]\n];\nconst DollarSign = createLucideIcon(\"dollar-sign\", __iconNode);\n\nexport { __iconNode, DollarSign as default };\n//# sourceMappingURL=dollar-sign.js.map\n","/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"circle\", { cx: \"9\", cy: \"12\", r: \"1\", key: \"1vctgf\" }],\n  [\"circle\", { cx: \"9\", cy: \"5\", r: \"1\", key: \"hp0tcf\" }],\n  [\"circle\", { cx: \"9\", cy: \"19\", r: \"1\", key: \"fkjjf6\" }],\n  [\"circle\", { cx: \"15\", cy: \"12\", r: \"1\", key: \"1tmaij\" }],\n  [\"circle\", { cx: \"15\", cy: \"5\", r: \"1\", key: \"19l28e\" }],\n  [\"circle\", { cx: \"15\", cy: \"19\", r: \"1\", key: \"f4zoj3\" }]\n];\nconst GripVertical = createLucideIcon(\"grip-vertical\", __iconNode);\n\nexport { __iconNode, GripVertical as default };\n//# sourceMappingURL=grip-vertical.js.map\n","/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"rect\", { width: \"18\", height: \"18\", x: \"3\", y: \"3\", rx: \"2\", ry: \"2\", key: \"1m3agn\" }],\n  [\"circle\", { cx: \"9\", cy: \"9\", r: \"2\", key: \"af1f0g\" }],\n  [\"path\", { d: \"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21\", key: \"1xmnt7\" }]\n];\nconst Image = createLucideIcon(\"image\", __iconNode);\n\nexport { __iconNode, Image as default };\n//# sourceMappingURL=image.js.map\n","/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z\",\n      key: \"18887p\"\n    }\n  ],\n  [\"path\", { d: \"M12 8v6\", key: \"1ib9pf\" }],\n  [\"path\", { d: \"M9 11h6\", key: \"1fldmi\" }]\n];\nconst MessageSquarePlus = createLucideIcon(\"message-square-plus\", __iconNode);\n\nexport { __iconNode, MessageSquarePlus as default };\n//# sourceMappingURL=message-square-plus.js.map\n","/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z\",\n      key: \"1a8usu\"\n    }\n  ]\n];\nconst Pen = createLucideIcon(\"pen\", __iconNode);\n\nexport { __iconNode, Pen as default };\n//# sourceMappingURL=pen.js.map\n","/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2\", key: \"wrbu53\" }],\n  [\"path\", { d: \"M15 18H9\", key: \"1lyqi6\" }],\n  [\n    \"path\",\n    {\n      d: \"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14\",\n      key: \"lysw3i\"\n    }\n  ],\n  [\"circle\", { cx: \"17\", cy: \"18\", r: \"2\", key: \"332jqn\" }],\n  [\"circle\", { cx: \"7\", cy: \"18\", r: \"2\", key: \"19iecd\" }]\n];\nconst Truck = createLucideIcon(\"truck\", __iconNode);\n\nexport { __iconNode, Truck as default };\n//# sourceMappingURL=truck.js.map\n","import { useMemo, useLayoutEffect, useEffect, useRef, useCallback } from 'react';\n\nfunction useCombinedRefs() {\n  for (var _len = arguments.length, refs = new Array(_len), _key = 0; _key < _len; _key++) {\n    refs[_key] = arguments[_key];\n  }\n\n  return useMemo(() => node => {\n    refs.forEach(ref => ref(node));\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  refs);\n}\n\n// https://github.com/facebook/react/blob/master/packages/shared/ExecutionEnvironment.js\nconst canUseDOM = typeof window !== 'undefined' && typeof window.document !== 'undefined' && typeof window.document.createElement !== 'undefined';\n\nfunction isWindow(element) {\n  const elementString = Object.prototype.toString.call(element);\n  return elementString === '[object Window]' || // In Electron context the Window object serializes to [object global]\n  elementString === '[object global]';\n}\n\nfunction isNode(node) {\n  return 'nodeType' in node;\n}\n\nfunction getWindow(target) {\n  var _target$ownerDocument, _target$ownerDocument2;\n\n  if (!target) {\n    return window;\n  }\n\n  if (isWindow(target)) {\n    return target;\n  }\n\n  if (!isNode(target)) {\n    return window;\n  }\n\n  return (_target$ownerDocument = (_target$ownerDocument2 = target.ownerDocument) == null ? void 0 : _target$ownerDocument2.defaultView) != null ? _target$ownerDocument : window;\n}\n\nfunction isDocument(node) {\n  const {\n    Document\n  } = getWindow(node);\n  return node instanceof Document;\n}\n\nfunction isHTMLElement(node) {\n  if (isWindow(node)) {\n    return false;\n  }\n\n  return node instanceof getWindow(node).HTMLElement;\n}\n\nfunction isSVGElement(node) {\n  return node instanceof getWindow(node).SVGElement;\n}\n\nfunction getOwnerDocument(target) {\n  if (!target) {\n    return document;\n  }\n\n  if (isWindow(target)) {\n    return target.document;\n  }\n\n  if (!isNode(target)) {\n    return document;\n  }\n\n  if (isDocument(target)) {\n    return target;\n  }\n\n  if (isHTMLElement(target) || isSVGElement(target)) {\n    return target.ownerDocument;\n  }\n\n  return document;\n}\n\n/**\r\n * A hook that resolves to useEffect on the server and useLayoutEffect on the client\r\n * @param callback {function} Callback function that is invoked when the dependencies of the hook change\r\n */\n\nconst useIsomorphicLayoutEffect = canUseDOM ? useLayoutEffect : useEffect;\n\nfunction useEvent(handler) {\n  const handlerRef = useRef(handler);\n  useIsomorphicLayoutEffect(() => {\n    handlerRef.current = handler;\n  });\n  return useCallback(function () {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return handlerRef.current == null ? void 0 : handlerRef.current(...args);\n  }, []);\n}\n\nfunction useInterval() {\n  const intervalRef = useRef(null);\n  const set = useCallback((listener, duration) => {\n    intervalRef.current = setInterval(listener, duration);\n  }, []);\n  const clear = useCallback(() => {\n    if (intervalRef.current !== null) {\n      clearInterval(intervalRef.current);\n      intervalRef.current = null;\n    }\n  }, []);\n  return [set, clear];\n}\n\nfunction useLatestValue(value, dependencies) {\n  if (dependencies === void 0) {\n    dependencies = [value];\n  }\n\n  const valueRef = useRef(value);\n  useIsomorphicLayoutEffect(() => {\n    if (valueRef.current !== value) {\n      valueRef.current = value;\n    }\n  }, dependencies);\n  return valueRef;\n}\n\nfunction useLazyMemo(callback, dependencies) {\n  const valueRef = useRef();\n  return useMemo(() => {\n    const newValue = callback(valueRef.current);\n    valueRef.current = newValue;\n    return newValue;\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  [...dependencies]);\n}\n\nfunction useNodeRef(onChange) {\n  const onChangeHandler = useEvent(onChange);\n  const node = useRef(null);\n  const setNodeRef = useCallback(element => {\n    if (element !== node.current) {\n      onChangeHandler == null ? void 0 : onChangeHandler(element, node.current);\n    }\n\n    node.current = element;\n  }, //eslint-disable-next-line\n  []);\n  return [node, setNodeRef];\n}\n\nfunction usePrevious(value) {\n  const ref = useRef();\n  useEffect(() => {\n    ref.current = value;\n  }, [value]);\n  return ref.current;\n}\n\nlet ids = {};\nfunction useUniqueId(prefix, value) {\n  return useMemo(() => {\n    if (value) {\n      return value;\n    }\n\n    const id = ids[prefix] == null ? 0 : ids[prefix] + 1;\n    ids[prefix] = id;\n    return prefix + \"-\" + id;\n  }, [prefix, value]);\n}\n\nfunction createAdjustmentFn(modifier) {\n  return function (object) {\n    for (var _len = arguments.length, adjustments = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      adjustments[_key - 1] = arguments[_key];\n    }\n\n    return adjustments.reduce((accumulator, adjustment) => {\n      const entries = Object.entries(adjustment);\n\n      for (const [key, valueAdjustment] of entries) {\n        const value = accumulator[key];\n\n        if (value != null) {\n          accumulator[key] = value + modifier * valueAdjustment;\n        }\n      }\n\n      return accumulator;\n    }, { ...object\n    });\n  };\n}\n\nconst add = /*#__PURE__*/createAdjustmentFn(1);\nconst subtract = /*#__PURE__*/createAdjustmentFn(-1);\n\nfunction hasViewportRelativeCoordinates(event) {\n  return 'clientX' in event && 'clientY' in event;\n}\n\nfunction isKeyboardEvent(event) {\n  if (!event) {\n    return false;\n  }\n\n  const {\n    KeyboardEvent\n  } = getWindow(event.target);\n  return KeyboardEvent && event instanceof KeyboardEvent;\n}\n\nfunction isTouchEvent(event) {\n  if (!event) {\n    return false;\n  }\n\n  const {\n    TouchEvent\n  } = getWindow(event.target);\n  return TouchEvent && event instanceof TouchEvent;\n}\n\n/**\r\n * Returns the normalized x and y coordinates for mouse and touch events.\r\n */\n\nfunction getEventCoordinates(event) {\n  if (isTouchEvent(event)) {\n    if (event.touches && event.touches.length) {\n      const {\n        clientX: x,\n        clientY: y\n      } = event.touches[0];\n      return {\n        x,\n        y\n      };\n    } else if (event.changedTouches && event.changedTouches.length) {\n      const {\n        clientX: x,\n        clientY: y\n      } = event.changedTouches[0];\n      return {\n        x,\n        y\n      };\n    }\n  }\n\n  if (hasViewportRelativeCoordinates(event)) {\n    return {\n      x: event.clientX,\n      y: event.clientY\n    };\n  }\n\n  return null;\n}\n\nconst CSS = /*#__PURE__*/Object.freeze({\n  Translate: {\n    toString(transform) {\n      if (!transform) {\n        return;\n      }\n\n      const {\n        x,\n        y\n      } = transform;\n      return \"translate3d(\" + (x ? Math.round(x) : 0) + \"px, \" + (y ? Math.round(y) : 0) + \"px, 0)\";\n    }\n\n  },\n  Scale: {\n    toString(transform) {\n      if (!transform) {\n        return;\n      }\n\n      const {\n        scaleX,\n        scaleY\n      } = transform;\n      return \"scaleX(\" + scaleX + \") scaleY(\" + scaleY + \")\";\n    }\n\n  },\n  Transform: {\n    toString(transform) {\n      if (!transform) {\n        return;\n      }\n\n      return [CSS.Translate.toString(transform), CSS.Scale.toString(transform)].join(' ');\n    }\n\n  },\n  Transition: {\n    toString(_ref) {\n      let {\n        property,\n        duration,\n        easing\n      } = _ref;\n      return property + \" \" + duration + \"ms \" + easing;\n    }\n\n  }\n});\n\nconst SELECTOR = 'a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]';\nfunction findFirstFocusableNode(element) {\n  if (element.matches(SELECTOR)) {\n    return element;\n  }\n\n  return element.querySelector(SELECTOR);\n}\n\nexport { CSS, add, canUseDOM, findFirstFocusableNode, getEventCoordinates, getOwnerDocument, getWindow, hasViewportRelativeCoordinates, isDocument, isHTMLElement, isKeyboardEvent, isNode, isSVGElement, isTouchEvent, isWindow, subtract, useCombinedRefs, useEvent, useInterval, useIsomorphicLayoutEffect, useLatestValue, useLazyMemo, useNodeRef, usePrevious, useUniqueId };\n//# sourceMappingURL=utilities.esm.js.map\n","import React, { useState, useCallback } from 'react';\n\nconst hiddenStyles = {\n  display: 'none'\n};\nfunction HiddenText(_ref) {\n  let {\n    id,\n    value\n  } = _ref;\n  return React.createElement(\"div\", {\n    id: id,\n    style: hiddenStyles\n  }, value);\n}\n\nfunction LiveRegion(_ref) {\n  let {\n    id,\n    announcement,\n    ariaLiveType = \"assertive\"\n  } = _ref;\n  // Hide element visually but keep it readable by screen readers\n  const visuallyHidden = {\n    position: 'fixed',\n    top: 0,\n    left: 0,\n    width: 1,\n    height: 1,\n    margin: -1,\n    border: 0,\n    padding: 0,\n    overflow: 'hidden',\n    clip: 'rect(0 0 0 0)',\n    clipPath: 'inset(100%)',\n    whiteSpace: 'nowrap'\n  };\n  return React.createElement(\"div\", {\n    id: id,\n    style: visuallyHidden,\n    role: \"status\",\n    \"aria-live\": ariaLiveType,\n    \"aria-atomic\": true\n  }, announcement);\n}\n\nfunction useAnnouncement() {\n  const [announcement, setAnnouncement] = useState('');\n  const announce = useCallback(value => {\n    if (value != null) {\n      setAnnouncement(value);\n    }\n  }, []);\n  return {\n    announce,\n    announcement\n  };\n}\n\nexport { HiddenText, LiveRegion, useAnnouncement };\n//# sourceMappingURL=accessibility.esm.js.map\n","import React, { createContext, useContext, useEffect, useState, useCallback, useMemo, useRef, memo, useReducer, cloneElement, forwardRef } from 'react';\nimport { createPortal, unstable_batchedUpdates } from 'react-dom';\nimport { useUniqueId, getEventCoordinates, getWindow, isDocument, isHTMLElement, isSVGElement, canUseDOM, isWindow, isNode, getOwnerDocument, add, isKeyboardEvent, subtract, useLazyMemo, useInterval, usePrevious, useLatestValue, useEvent, useIsomorphicLayoutEffect, useNodeRef, findFirstFocusableNode, CSS } from '@dnd-kit/utilities';\nimport { useAnnouncement, HiddenText, LiveRegion } from '@dnd-kit/accessibility';\n\nconst DndMonitorContext = /*#__PURE__*/createContext(null);\n\nfunction useDndMonitor(listener) {\n  const registerListener = useContext(DndMonitorContext);\n  useEffect(() => {\n    if (!registerListener) {\n      throw new Error('useDndMonitor must be used within a children of <DndContext>');\n    }\n\n    const unsubscribe = registerListener(listener);\n    return unsubscribe;\n  }, [listener, registerListener]);\n}\n\nfunction useDndMonitorProvider() {\n  const [listeners] = useState(() => new Set());\n  const registerListener = useCallback(listener => {\n    listeners.add(listener);\n    return () => listeners.delete(listener);\n  }, [listeners]);\n  const dispatch = useCallback(_ref => {\n    let {\n      type,\n      event\n    } = _ref;\n    listeners.forEach(listener => {\n      var _listener$type;\n\n      return (_listener$type = listener[type]) == null ? void 0 : _listener$type.call(listener, event);\n    });\n  }, [listeners]);\n  return [dispatch, registerListener];\n}\n\nconst defaultScreenReaderInstructions = {\n  draggable: \"\\n    To pick up a draggable item, press the space bar.\\n    While dragging, use the arrow keys to move the item.\\n    Press space again to drop the item in its new position, or press escape to cancel.\\n  \"\n};\nconst defaultAnnouncements = {\n  onDragStart(_ref) {\n    let {\n      active\n    } = _ref;\n    return \"Picked up draggable item \" + active.id + \".\";\n  },\n\n  onDragOver(_ref2) {\n    let {\n      active,\n      over\n    } = _ref2;\n\n    if (over) {\n      return \"Draggable item \" + active.id + \" was moved over droppable area \" + over.id + \".\";\n    }\n\n    return \"Draggable item \" + active.id + \" is no longer over a droppable area.\";\n  },\n\n  onDragEnd(_ref3) {\n    let {\n      active,\n      over\n    } = _ref3;\n\n    if (over) {\n      return \"Draggable item \" + active.id + \" was dropped over droppable area \" + over.id;\n    }\n\n    return \"Draggable item \" + active.id + \" was dropped.\";\n  },\n\n  onDragCancel(_ref4) {\n    let {\n      active\n    } = _ref4;\n    return \"Dragging was cancelled. Draggable item \" + active.id + \" was dropped.\";\n  }\n\n};\n\nfunction Accessibility(_ref) {\n  let {\n    announcements = defaultAnnouncements,\n    container,\n    hiddenTextDescribedById,\n    screenReaderInstructions = defaultScreenReaderInstructions\n  } = _ref;\n  const {\n    announce,\n    announcement\n  } = useAnnouncement();\n  const liveRegionId = useUniqueId(\"DndLiveRegion\");\n  const [mounted, setMounted] = useState(false);\n  useEffect(() => {\n    setMounted(true);\n  }, []);\n  useDndMonitor(useMemo(() => ({\n    onDragStart(_ref2) {\n      let {\n        active\n      } = _ref2;\n      announce(announcements.onDragStart({\n        active\n      }));\n    },\n\n    onDragMove(_ref3) {\n      let {\n        active,\n        over\n      } = _ref3;\n\n      if (announcements.onDragMove) {\n        announce(announcements.onDragMove({\n          active,\n          over\n        }));\n      }\n    },\n\n    onDragOver(_ref4) {\n      let {\n        active,\n        over\n      } = _ref4;\n      announce(announcements.onDragOver({\n        active,\n        over\n      }));\n    },\n\n    onDragEnd(_ref5) {\n      let {\n        active,\n        over\n      } = _ref5;\n      announce(announcements.onDragEnd({\n        active,\n        over\n      }));\n    },\n\n    onDragCancel(_ref6) {\n      let {\n        active,\n        over\n      } = _ref6;\n      announce(announcements.onDragCancel({\n        active,\n        over\n      }));\n    }\n\n  }), [announce, announcements]));\n\n  if (!mounted) {\n    return null;\n  }\n\n  const markup = React.createElement(React.Fragment, null, React.createElement(HiddenText, {\n    id: hiddenTextDescribedById,\n    value: screenReaderInstructions.draggable\n  }), React.createElement(LiveRegion, {\n    id: liveRegionId,\n    announcement: announcement\n  }));\n  return container ? createPortal(markup, container) : markup;\n}\n\nvar Action;\n\n(function (Action) {\n  Action[\"DragStart\"] = \"dragStart\";\n  Action[\"DragMove\"] = \"dragMove\";\n  Action[\"DragEnd\"] = \"dragEnd\";\n  Action[\"DragCancel\"] = \"dragCancel\";\n  Action[\"DragOver\"] = \"dragOver\";\n  Action[\"RegisterDroppable\"] = \"registerDroppable\";\n  Action[\"SetDroppableDisabled\"] = \"setDroppableDisabled\";\n  Action[\"UnregisterDroppable\"] = \"unregisterDroppable\";\n})(Action || (Action = {}));\n\nfunction noop() {}\n\nfunction useSensor(sensor, options) {\n  return useMemo(() => ({\n    sensor,\n    options: options != null ? options : {}\n  }), // eslint-disable-next-line react-hooks/exhaustive-deps\n  [sensor, options]);\n}\n\nfunction useSensors() {\n  for (var _len = arguments.length, sensors = new Array(_len), _key = 0; _key < _len; _key++) {\n    sensors[_key] = arguments[_key];\n  }\n\n  return useMemo(() => [...sensors].filter(sensor => sensor != null), // eslint-disable-next-line react-hooks/exhaustive-deps\n  [...sensors]);\n}\n\nconst defaultCoordinates = /*#__PURE__*/Object.freeze({\n  x: 0,\n  y: 0\n});\n\n/**\r\n * Returns the distance between two points\r\n */\nfunction distanceBetween(p1, p2) {\n  return Math.sqrt(Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2));\n}\n\nfunction getRelativeTransformOrigin(event, rect) {\n  const eventCoordinates = getEventCoordinates(event);\n\n  if (!eventCoordinates) {\n    return '0 0';\n  }\n\n  const transformOrigin = {\n    x: (eventCoordinates.x - rect.left) / rect.width * 100,\n    y: (eventCoordinates.y - rect.top) / rect.height * 100\n  };\n  return transformOrigin.x + \"% \" + transformOrigin.y + \"%\";\n}\n\n/**\r\n * Sort collisions from smallest to greatest value\r\n */\nfunction sortCollisionsAsc(_ref, _ref2) {\n  let {\n    data: {\n      value: a\n    }\n  } = _ref;\n  let {\n    data: {\n      value: b\n    }\n  } = _ref2;\n  return a - b;\n}\n/**\r\n * Sort collisions from greatest to smallest value\r\n */\n\nfunction sortCollisionsDesc(_ref3, _ref4) {\n  let {\n    data: {\n      value: a\n    }\n  } = _ref3;\n  let {\n    data: {\n      value: b\n    }\n  } = _ref4;\n  return b - a;\n}\n/**\r\n * Returns the coordinates of the corners of a given rectangle:\r\n * [TopLeft {x, y}, TopRight {x, y}, BottomLeft {x, y}, BottomRight {x, y}]\r\n */\n\nfunction cornersOfRectangle(_ref5) {\n  let {\n    left,\n    top,\n    height,\n    width\n  } = _ref5;\n  return [{\n    x: left,\n    y: top\n  }, {\n    x: left + width,\n    y: top\n  }, {\n    x: left,\n    y: top + height\n  }, {\n    x: left + width,\n    y: top + height\n  }];\n}\nfunction getFirstCollision(collisions, property) {\n  if (!collisions || collisions.length === 0) {\n    return null;\n  }\n\n  const [firstCollision] = collisions;\n  return property ? firstCollision[property] : firstCollision;\n}\n\n/**\r\n * Returns the coordinates of the center of a given ClientRect\r\n */\n\nfunction centerOfRectangle(rect, left, top) {\n  if (left === void 0) {\n    left = rect.left;\n  }\n\n  if (top === void 0) {\n    top = rect.top;\n  }\n\n  return {\n    x: left + rect.width * 0.5,\n    y: top + rect.height * 0.5\n  };\n}\n/**\r\n * Returns the closest rectangles from an array of rectangles to the center of a given\r\n * rectangle.\r\n */\n\n\nconst closestCenter = _ref => {\n  let {\n    collisionRect,\n    droppableRects,\n    droppableContainers\n  } = _ref;\n  const centerRect = centerOfRectangle(collisionRect, collisionRect.left, collisionRect.top);\n  const collisions = [];\n\n  for (const droppableContainer of droppableContainers) {\n    const {\n      id\n    } = droppableContainer;\n    const rect = droppableRects.get(id);\n\n    if (rect) {\n      const distBetween = distanceBetween(centerOfRectangle(rect), centerRect);\n      collisions.push({\n        id,\n        data: {\n          droppableContainer,\n          value: distBetween\n        }\n      });\n    }\n  }\n\n  return collisions.sort(sortCollisionsAsc);\n};\n\n/**\r\n * Returns the closest rectangles from an array of rectangles to the corners of\r\n * another rectangle.\r\n */\n\nconst closestCorners = _ref => {\n  let {\n    collisionRect,\n    droppableRects,\n    droppableContainers\n  } = _ref;\n  const corners = cornersOfRectangle(collisionRect);\n  const collisions = [];\n\n  for (const droppableContainer of droppableContainers) {\n    const {\n      id\n    } = droppableContainer;\n    const rect = droppableRects.get(id);\n\n    if (rect) {\n      const rectCorners = cornersOfRectangle(rect);\n      const distances = corners.reduce((accumulator, corner, index) => {\n        return accumulator + distanceBetween(rectCorners[index], corner);\n      }, 0);\n      const effectiveDistance = Number((distances / 4).toFixed(4));\n      collisions.push({\n        id,\n        data: {\n          droppableContainer,\n          value: effectiveDistance\n        }\n      });\n    }\n  }\n\n  return collisions.sort(sortCollisionsAsc);\n};\n\n/**\r\n * Returns the intersecting rectangle area between two rectangles\r\n */\n\nfunction getIntersectionRatio(entry, target) {\n  const top = Math.max(target.top, entry.top);\n  const left = Math.max(target.left, entry.left);\n  const right = Math.min(target.left + target.width, entry.left + entry.width);\n  const bottom = Math.min(target.top + target.height, entry.top + entry.height);\n  const width = right - left;\n  const height = bottom - top;\n\n  if (left < right && top < bottom) {\n    const targetArea = target.width * target.height;\n    const entryArea = entry.width * entry.height;\n    const intersectionArea = width * height;\n    const intersectionRatio = intersectionArea / (targetArea + entryArea - intersectionArea);\n    return Number(intersectionRatio.toFixed(4));\n  } // Rectangles do not overlap, or overlap has an area of zero (edge/corner overlap)\n\n\n  return 0;\n}\n/**\r\n * Returns the rectangles that has the greatest intersection area with a given\r\n * rectangle in an array of rectangles.\r\n */\n\nconst rectIntersection = _ref => {\n  let {\n    collisionRect,\n    droppableRects,\n    droppableContainers\n  } = _ref;\n  const collisions = [];\n\n  for (const droppableContainer of droppableContainers) {\n    const {\n      id\n    } = droppableContainer;\n    const rect = droppableRects.get(id);\n\n    if (rect) {\n      const intersectionRatio = getIntersectionRatio(rect, collisionRect);\n\n      if (intersectionRatio > 0) {\n        collisions.push({\n          id,\n          data: {\n            droppableContainer,\n            value: intersectionRatio\n          }\n        });\n      }\n    }\n  }\n\n  return collisions.sort(sortCollisionsDesc);\n};\n\n/**\r\n * Check if a given point is contained within a bounding rectangle\r\n */\n\nfunction isPointWithinRect(point, rect) {\n  const {\n    top,\n    left,\n    bottom,\n    right\n  } = rect;\n  return top <= point.y && point.y <= bottom && left <= point.x && point.x <= right;\n}\n/**\r\n * Returns the rectangles that the pointer is hovering over\r\n */\n\n\nconst pointerWithin = _ref => {\n  let {\n    droppableContainers,\n    droppableRects,\n    pointerCoordinates\n  } = _ref;\n\n  if (!pointerCoordinates) {\n    return [];\n  }\n\n  const collisions = [];\n\n  for (const droppableContainer of droppableContainers) {\n    const {\n      id\n    } = droppableContainer;\n    const rect = droppableRects.get(id);\n\n    if (rect && isPointWithinRect(pointerCoordinates, rect)) {\n      /* There may be more than a single rectangle intersecting\r\n       * with the pointer coordinates. In order to sort the\r\n       * colliding rectangles, we measure the distance between\r\n       * the pointer and the corners of the intersecting rectangle\r\n       */\n      const corners = cornersOfRectangle(rect);\n      const distances = corners.reduce((accumulator, corner) => {\n        return accumulator + distanceBetween(pointerCoordinates, corner);\n      }, 0);\n      const effectiveDistance = Number((distances / 4).toFixed(4));\n      collisions.push({\n        id,\n        data: {\n          droppableContainer,\n          value: effectiveDistance\n        }\n      });\n    }\n  }\n\n  return collisions.sort(sortCollisionsAsc);\n};\n\nfunction adjustScale(transform, rect1, rect2) {\n  return { ...transform,\n    scaleX: rect1 && rect2 ? rect1.width / rect2.width : 1,\n    scaleY: rect1 && rect2 ? rect1.height / rect2.height : 1\n  };\n}\n\nfunction getRectDelta(rect1, rect2) {\n  return rect1 && rect2 ? {\n    x: rect1.left - rect2.left,\n    y: rect1.top - rect2.top\n  } : defaultCoordinates;\n}\n\nfunction createRectAdjustmentFn(modifier) {\n  return function adjustClientRect(rect) {\n    for (var _len = arguments.length, adjustments = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      adjustments[_key - 1] = arguments[_key];\n    }\n\n    return adjustments.reduce((acc, adjustment) => ({ ...acc,\n      top: acc.top + modifier * adjustment.y,\n      bottom: acc.bottom + modifier * adjustment.y,\n      left: acc.left + modifier * adjustment.x,\n      right: acc.right + modifier * adjustment.x\n    }), { ...rect\n    });\n  };\n}\nconst getAdjustedRect = /*#__PURE__*/createRectAdjustmentFn(1);\n\nfunction parseTransform(transform) {\n  if (transform.startsWith('matrix3d(')) {\n    const transformArray = transform.slice(9, -1).split(/, /);\n    return {\n      x: +transformArray[12],\n      y: +transformArray[13],\n      scaleX: +transformArray[0],\n      scaleY: +transformArray[5]\n    };\n  } else if (transform.startsWith('matrix(')) {\n    const transformArray = transform.slice(7, -1).split(/, /);\n    return {\n      x: +transformArray[4],\n      y: +transformArray[5],\n      scaleX: +transformArray[0],\n      scaleY: +transformArray[3]\n    };\n  }\n\n  return null;\n}\n\nfunction inverseTransform(rect, transform, transformOrigin) {\n  const parsedTransform = parseTransform(transform);\n\n  if (!parsedTransform) {\n    return rect;\n  }\n\n  const {\n    scaleX,\n    scaleY,\n    x: translateX,\n    y: translateY\n  } = parsedTransform;\n  const x = rect.left - translateX - (1 - scaleX) * parseFloat(transformOrigin);\n  const y = rect.top - translateY - (1 - scaleY) * parseFloat(transformOrigin.slice(transformOrigin.indexOf(' ') + 1));\n  const w = scaleX ? rect.width / scaleX : rect.width;\n  const h = scaleY ? rect.height / scaleY : rect.height;\n  return {\n    width: w,\n    height: h,\n    top: y,\n    right: x + w,\n    bottom: y + h,\n    left: x\n  };\n}\n\nconst defaultOptions = {\n  ignoreTransform: false\n};\n/**\r\n * Returns the bounding client rect of an element relative to the viewport.\r\n */\n\nfunction getClientRect(element, options) {\n  if (options === void 0) {\n    options = defaultOptions;\n  }\n\n  let rect = element.getBoundingClientRect();\n\n  if (options.ignoreTransform) {\n    const {\n      transform,\n      transformOrigin\n    } = getWindow(element).getComputedStyle(element);\n\n    if (transform) {\n      rect = inverseTransform(rect, transform, transformOrigin);\n    }\n  }\n\n  const {\n    top,\n    left,\n    width,\n    height,\n    bottom,\n    right\n  } = rect;\n  return {\n    top,\n    left,\n    width,\n    height,\n    bottom,\n    right\n  };\n}\n/**\r\n * Returns the bounding client rect of an element relative to the viewport.\r\n *\r\n * @remarks\r\n * The ClientRect returned by this method does not take into account transforms\r\n * applied to the element it measures.\r\n *\r\n */\n\nfunction getTransformAgnosticClientRect(element) {\n  return getClientRect(element, {\n    ignoreTransform: true\n  });\n}\n\nfunction getWindowClientRect(element) {\n  const width = element.innerWidth;\n  const height = element.innerHeight;\n  return {\n    top: 0,\n    left: 0,\n    right: width,\n    bottom: height,\n    width,\n    height\n  };\n}\n\nfunction isFixed(node, computedStyle) {\n  if (computedStyle === void 0) {\n    computedStyle = getWindow(node).getComputedStyle(node);\n  }\n\n  return computedStyle.position === 'fixed';\n}\n\nfunction isScrollable(element, computedStyle) {\n  if (computedStyle === void 0) {\n    computedStyle = getWindow(element).getComputedStyle(element);\n  }\n\n  const overflowRegex = /(auto|scroll|overlay)/;\n  const properties = ['overflow', 'overflowX', 'overflowY'];\n  return properties.some(property => {\n    const value = computedStyle[property];\n    return typeof value === 'string' ? overflowRegex.test(value) : false;\n  });\n}\n\nfunction getScrollableAncestors(element, limit) {\n  const scrollParents = [];\n\n  function findScrollableAncestors(node) {\n    if (limit != null && scrollParents.length >= limit) {\n      return scrollParents;\n    }\n\n    if (!node) {\n      return scrollParents;\n    }\n\n    if (isDocument(node) && node.scrollingElement != null && !scrollParents.includes(node.scrollingElement)) {\n      scrollParents.push(node.scrollingElement);\n      return scrollParents;\n    }\n\n    if (!isHTMLElement(node) || isSVGElement(node)) {\n      return scrollParents;\n    }\n\n    if (scrollParents.includes(node)) {\n      return scrollParents;\n    }\n\n    const computedStyle = getWindow(element).getComputedStyle(node);\n\n    if (node !== element) {\n      if (isScrollable(node, computedStyle)) {\n        scrollParents.push(node);\n      }\n    }\n\n    if (isFixed(node, computedStyle)) {\n      return scrollParents;\n    }\n\n    return findScrollableAncestors(node.parentNode);\n  }\n\n  if (!element) {\n    return scrollParents;\n  }\n\n  return findScrollableAncestors(element);\n}\nfunction getFirstScrollableAncestor(node) {\n  const [firstScrollableAncestor] = getScrollableAncestors(node, 1);\n  return firstScrollableAncestor != null ? firstScrollableAncestor : null;\n}\n\nfunction getScrollableElement(element) {\n  if (!canUseDOM || !element) {\n    return null;\n  }\n\n  if (isWindow(element)) {\n    return element;\n  }\n\n  if (!isNode(element)) {\n    return null;\n  }\n\n  if (isDocument(element) || element === getOwnerDocument(element).scrollingElement) {\n    return window;\n  }\n\n  if (isHTMLElement(element)) {\n    return element;\n  }\n\n  return null;\n}\n\nfunction getScrollXCoordinate(element) {\n  if (isWindow(element)) {\n    return element.scrollX;\n  }\n\n  return element.scrollLeft;\n}\nfunction getScrollYCoordinate(element) {\n  if (isWindow(element)) {\n    return element.scrollY;\n  }\n\n  return element.scrollTop;\n}\nfunction getScrollCoordinates(element) {\n  return {\n    x: getScrollXCoordinate(element),\n    y: getScrollYCoordinate(element)\n  };\n}\n\nvar Direction;\n\n(function (Direction) {\n  Direction[Direction[\"Forward\"] = 1] = \"Forward\";\n  Direction[Direction[\"Backward\"] = -1] = \"Backward\";\n})(Direction || (Direction = {}));\n\nfunction isDocumentScrollingElement(element) {\n  if (!canUseDOM || !element) {\n    return false;\n  }\n\n  return element === document.scrollingElement;\n}\n\nfunction getScrollPosition(scrollingContainer) {\n  const minScroll = {\n    x: 0,\n    y: 0\n  };\n  const dimensions = isDocumentScrollingElement(scrollingContainer) ? {\n    height: window.innerHeight,\n    width: window.innerWidth\n  } : {\n    height: scrollingContainer.clientHeight,\n    width: scrollingContainer.clientWidth\n  };\n  const maxScroll = {\n    x: scrollingContainer.scrollWidth - dimensions.width,\n    y: scrollingContainer.scrollHeight - dimensions.height\n  };\n  const isTop = scrollingContainer.scrollTop <= minScroll.y;\n  const isLeft = scrollingContainer.scrollLeft <= minScroll.x;\n  const isBottom = scrollingContainer.scrollTop >= maxScroll.y;\n  const isRight = scrollingContainer.scrollLeft >= maxScroll.x;\n  return {\n    isTop,\n    isLeft,\n    isBottom,\n    isRight,\n    maxScroll,\n    minScroll\n  };\n}\n\nconst defaultThreshold = {\n  x: 0.2,\n  y: 0.2\n};\nfunction getScrollDirectionAndSpeed(scrollContainer, scrollContainerRect, _ref, acceleration, thresholdPercentage) {\n  let {\n    top,\n    left,\n    right,\n    bottom\n  } = _ref;\n\n  if (acceleration === void 0) {\n    acceleration = 10;\n  }\n\n  if (thresholdPercentage === void 0) {\n    thresholdPercentage = defaultThreshold;\n  }\n\n  const {\n    isTop,\n    isBottom,\n    isLeft,\n    isRight\n  } = getScrollPosition(scrollContainer);\n  const direction = {\n    x: 0,\n    y: 0\n  };\n  const speed = {\n    x: 0,\n    y: 0\n  };\n  const threshold = {\n    height: scrollContainerRect.height * thresholdPercentage.y,\n    width: scrollContainerRect.width * thresholdPercentage.x\n  };\n\n  if (!isTop && top <= scrollContainerRect.top + threshold.height) {\n    // Scroll Up\n    direction.y = Direction.Backward;\n    speed.y = acceleration * Math.abs((scrollContainerRect.top + threshold.height - top) / threshold.height);\n  } else if (!isBottom && bottom >= scrollContainerRect.bottom - threshold.height) {\n    // Scroll Down\n    direction.y = Direction.Forward;\n    speed.y = acceleration * Math.abs((scrollContainerRect.bottom - threshold.height - bottom) / threshold.height);\n  }\n\n  if (!isRight && right >= scrollContainerRect.right - threshold.width) {\n    // Scroll Right\n    direction.x = Direction.Forward;\n    speed.x = acceleration * Math.abs((scrollContainerRect.right - threshold.width - right) / threshold.width);\n  } else if (!isLeft && left <= scrollContainerRect.left + threshold.width) {\n    // Scroll Left\n    direction.x = Direction.Backward;\n    speed.x = acceleration * Math.abs((scrollContainerRect.left + threshold.width - left) / threshold.width);\n  }\n\n  return {\n    direction,\n    speed\n  };\n}\n\nfunction getScrollElementRect(element) {\n  if (element === document.scrollingElement) {\n    const {\n      innerWidth,\n      innerHeight\n    } = window;\n    return {\n      top: 0,\n      left: 0,\n      right: innerWidth,\n      bottom: innerHeight,\n      width: innerWidth,\n      height: innerHeight\n    };\n  }\n\n  const {\n    top,\n    left,\n    right,\n    bottom\n  } = element.getBoundingClientRect();\n  return {\n    top,\n    left,\n    right,\n    bottom,\n    width: element.clientWidth,\n    height: element.clientHeight\n  };\n}\n\nfunction getScrollOffsets(scrollableAncestors) {\n  return scrollableAncestors.reduce((acc, node) => {\n    return add(acc, getScrollCoordinates(node));\n  }, defaultCoordinates);\n}\nfunction getScrollXOffset(scrollableAncestors) {\n  return scrollableAncestors.reduce((acc, node) => {\n    return acc + getScrollXCoordinate(node);\n  }, 0);\n}\nfunction getScrollYOffset(scrollableAncestors) {\n  return scrollableAncestors.reduce((acc, node) => {\n    return acc + getScrollYCoordinate(node);\n  }, 0);\n}\n\nfunction scrollIntoViewIfNeeded(element, measure) {\n  if (measure === void 0) {\n    measure = getClientRect;\n  }\n\n  if (!element) {\n    return;\n  }\n\n  const {\n    top,\n    left,\n    bottom,\n    right\n  } = measure(element);\n  const firstScrollableAncestor = getFirstScrollableAncestor(element);\n\n  if (!firstScrollableAncestor) {\n    return;\n  }\n\n  if (bottom <= 0 || right <= 0 || top >= window.innerHeight || left >= window.innerWidth) {\n    element.scrollIntoView({\n      block: 'center',\n      inline: 'center'\n    });\n  }\n}\n\nconst properties = [['x', ['left', 'right'], getScrollXOffset], ['y', ['top', 'bottom'], getScrollYOffset]];\nclass Rect {\n  constructor(rect, element) {\n    this.rect = void 0;\n    this.width = void 0;\n    this.height = void 0;\n    this.top = void 0;\n    this.bottom = void 0;\n    this.right = void 0;\n    this.left = void 0;\n    const scrollableAncestors = getScrollableAncestors(element);\n    const scrollOffsets = getScrollOffsets(scrollableAncestors);\n    this.rect = { ...rect\n    };\n    this.width = rect.width;\n    this.height = rect.height;\n\n    for (const [axis, keys, getScrollOffset] of properties) {\n      for (const key of keys) {\n        Object.defineProperty(this, key, {\n          get: () => {\n            const currentOffsets = getScrollOffset(scrollableAncestors);\n            const scrollOffsetsDeltla = scrollOffsets[axis] - currentOffsets;\n            return this.rect[key] + scrollOffsetsDeltla;\n          },\n          enumerable: true\n        });\n      }\n    }\n\n    Object.defineProperty(this, 'rect', {\n      enumerable: false\n    });\n  }\n\n}\n\nclass Listeners {\n  constructor(target) {\n    this.target = void 0;\n    this.listeners = [];\n\n    this.removeAll = () => {\n      this.listeners.forEach(listener => {\n        var _this$target;\n\n        return (_this$target = this.target) == null ? void 0 : _this$target.removeEventListener(...listener);\n      });\n    };\n\n    this.target = target;\n  }\n\n  add(eventName, handler, options) {\n    var _this$target2;\n\n    (_this$target2 = this.target) == null ? void 0 : _this$target2.addEventListener(eventName, handler, options);\n    this.listeners.push([eventName, handler, options]);\n  }\n\n}\n\nfunction getEventListenerTarget(target) {\n  // If the `event.target` element is removed from the document events will still be targeted\n  // at it, and hence won't always bubble up to the window or document anymore.\n  // If there is any risk of an element being removed while it is being dragged,\n  // the best practice is to attach the event listeners directly to the target.\n  // https://developer.mozilla.org/en-US/docs/Web/API/EventTarget\n  const {\n    EventTarget\n  } = getWindow(target);\n  return target instanceof EventTarget ? target : getOwnerDocument(target);\n}\n\nfunction hasExceededDistance(delta, measurement) {\n  const dx = Math.abs(delta.x);\n  const dy = Math.abs(delta.y);\n\n  if (typeof measurement === 'number') {\n    return Math.sqrt(dx ** 2 + dy ** 2) > measurement;\n  }\n\n  if ('x' in measurement && 'y' in measurement) {\n    return dx > measurement.x && dy > measurement.y;\n  }\n\n  if ('x' in measurement) {\n    return dx > measurement.x;\n  }\n\n  if ('y' in measurement) {\n    return dy > measurement.y;\n  }\n\n  return false;\n}\n\nvar EventName;\n\n(function (EventName) {\n  EventName[\"Click\"] = \"click\";\n  EventName[\"DragStart\"] = \"dragstart\";\n  EventName[\"Keydown\"] = \"keydown\";\n  EventName[\"ContextMenu\"] = \"contextmenu\";\n  EventName[\"Resize\"] = \"resize\";\n  EventName[\"SelectionChange\"] = \"selectionchange\";\n  EventName[\"VisibilityChange\"] = \"visibilitychange\";\n})(EventName || (EventName = {}));\n\nfunction preventDefault(event) {\n  event.preventDefault();\n}\nfunction stopPropagation(event) {\n  event.stopPropagation();\n}\n\nvar KeyboardCode;\n\n(function (KeyboardCode) {\n  KeyboardCode[\"Space\"] = \"Space\";\n  KeyboardCode[\"Down\"] = \"ArrowDown\";\n  KeyboardCode[\"Right\"] = \"ArrowRight\";\n  KeyboardCode[\"Left\"] = \"ArrowLeft\";\n  KeyboardCode[\"Up\"] = \"ArrowUp\";\n  KeyboardCode[\"Esc\"] = \"Escape\";\n  KeyboardCode[\"Enter\"] = \"Enter\";\n  KeyboardCode[\"Tab\"] = \"Tab\";\n})(KeyboardCode || (KeyboardCode = {}));\n\nconst defaultKeyboardCodes = {\n  start: [KeyboardCode.Space, KeyboardCode.Enter],\n  cancel: [KeyboardCode.Esc],\n  end: [KeyboardCode.Space, KeyboardCode.Enter, KeyboardCode.Tab]\n};\nconst defaultKeyboardCoordinateGetter = (event, _ref) => {\n  let {\n    currentCoordinates\n  } = _ref;\n\n  switch (event.code) {\n    case KeyboardCode.Right:\n      return { ...currentCoordinates,\n        x: currentCoordinates.x + 25\n      };\n\n    case KeyboardCode.Left:\n      return { ...currentCoordinates,\n        x: currentCoordinates.x - 25\n      };\n\n    case KeyboardCode.Down:\n      return { ...currentCoordinates,\n        y: currentCoordinates.y + 25\n      };\n\n    case KeyboardCode.Up:\n      return { ...currentCoordinates,\n        y: currentCoordinates.y - 25\n      };\n  }\n\n  return undefined;\n};\n\nclass KeyboardSensor {\n  constructor(props) {\n    this.props = void 0;\n    this.autoScrollEnabled = false;\n    this.referenceCoordinates = void 0;\n    this.listeners = void 0;\n    this.windowListeners = void 0;\n    this.props = props;\n    const {\n      event: {\n        target\n      }\n    } = props;\n    this.props = props;\n    this.listeners = new Listeners(getOwnerDocument(target));\n    this.windowListeners = new Listeners(getWindow(target));\n    this.handleKeyDown = this.handleKeyDown.bind(this);\n    this.handleCancel = this.handleCancel.bind(this);\n    this.attach();\n  }\n\n  attach() {\n    this.handleStart();\n    this.windowListeners.add(EventName.Resize, this.handleCancel);\n    this.windowListeners.add(EventName.VisibilityChange, this.handleCancel);\n    setTimeout(() => this.listeners.add(EventName.Keydown, this.handleKeyDown));\n  }\n\n  handleStart() {\n    const {\n      activeNode,\n      onStart\n    } = this.props;\n    const node = activeNode.node.current;\n\n    if (node) {\n      scrollIntoViewIfNeeded(node);\n    }\n\n    onStart(defaultCoordinates);\n  }\n\n  handleKeyDown(event) {\n    if (isKeyboardEvent(event)) {\n      const {\n        active,\n        context,\n        options\n      } = this.props;\n      const {\n        keyboardCodes = defaultKeyboardCodes,\n        coordinateGetter = defaultKeyboardCoordinateGetter,\n        scrollBehavior = 'smooth'\n      } = options;\n      const {\n        code\n      } = event;\n\n      if (keyboardCodes.end.includes(code)) {\n        this.handleEnd(event);\n        return;\n      }\n\n      if (keyboardCodes.cancel.includes(code)) {\n        this.handleCancel(event);\n        return;\n      }\n\n      const {\n        collisionRect\n      } = context.current;\n      const currentCoordinates = collisionRect ? {\n        x: collisionRect.left,\n        y: collisionRect.top\n      } : defaultCoordinates;\n\n      if (!this.referenceCoordinates) {\n        this.referenceCoordinates = currentCoordinates;\n      }\n\n      const newCoordinates = coordinateGetter(event, {\n        active,\n        context: context.current,\n        currentCoordinates\n      });\n\n      if (newCoordinates) {\n        const coordinatesDelta = subtract(newCoordinates, currentCoordinates);\n        const scrollDelta = {\n          x: 0,\n          y: 0\n        };\n        const {\n          scrollableAncestors\n        } = context.current;\n\n        for (const scrollContainer of scrollableAncestors) {\n          const direction = event.code;\n          const {\n            isTop,\n            isRight,\n            isLeft,\n            isBottom,\n            maxScroll,\n            minScroll\n          } = getScrollPosition(scrollContainer);\n          const scrollElementRect = getScrollElementRect(scrollContainer);\n          const clampedCoordinates = {\n            x: Math.min(direction === KeyboardCode.Right ? scrollElementRect.right - scrollElementRect.width / 2 : scrollElementRect.right, Math.max(direction === KeyboardCode.Right ? scrollElementRect.left : scrollElementRect.left + scrollElementRect.width / 2, newCoordinates.x)),\n            y: Math.min(direction === KeyboardCode.Down ? scrollElementRect.bottom - scrollElementRect.height / 2 : scrollElementRect.bottom, Math.max(direction === KeyboardCode.Down ? scrollElementRect.top : scrollElementRect.top + scrollElementRect.height / 2, newCoordinates.y))\n          };\n          const canScrollX = direction === KeyboardCode.Right && !isRight || direction === KeyboardCode.Left && !isLeft;\n          const canScrollY = direction === KeyboardCode.Down && !isBottom || direction === KeyboardCode.Up && !isTop;\n\n          if (canScrollX && clampedCoordinates.x !== newCoordinates.x) {\n            const newScrollCoordinates = scrollContainer.scrollLeft + coordinatesDelta.x;\n            const canScrollToNewCoordinates = direction === KeyboardCode.Right && newScrollCoordinates <= maxScroll.x || direction === KeyboardCode.Left && newScrollCoordinates >= minScroll.x;\n\n            if (canScrollToNewCoordinates && !coordinatesDelta.y) {\n              // We don't need to update coordinates, the scroll adjustment alone will trigger\n              // logic to auto-detect the new container we are over\n              scrollContainer.scrollTo({\n                left: newScrollCoordinates,\n                behavior: scrollBehavior\n              });\n              return;\n            }\n\n            if (canScrollToNewCoordinates) {\n              scrollDelta.x = scrollContainer.scrollLeft - newScrollCoordinates;\n            } else {\n              scrollDelta.x = direction === KeyboardCode.Right ? scrollContainer.scrollLeft - maxScroll.x : scrollContainer.scrollLeft - minScroll.x;\n            }\n\n            if (scrollDelta.x) {\n              scrollContainer.scrollBy({\n                left: -scrollDelta.x,\n                behavior: scrollBehavior\n              });\n            }\n\n            break;\n          } else if (canScrollY && clampedCoordinates.y !== newCoordinates.y) {\n            const newScrollCoordinates = scrollContainer.scrollTop + coordinatesDelta.y;\n            const canScrollToNewCoordinates = direction === KeyboardCode.Down && newScrollCoordinates <= maxScroll.y || direction === KeyboardCode.Up && newScrollCoordinates >= minScroll.y;\n\n            if (canScrollToNewCoordinates && !coordinatesDelta.x) {\n              // We don't need to update coordinates, the scroll adjustment alone will trigger\n              // logic to auto-detect the new container we are over\n              scrollContainer.scrollTo({\n                top: newScrollCoordinates,\n                behavior: scrollBehavior\n              });\n              return;\n            }\n\n            if (canScrollToNewCoordinates) {\n              scrollDelta.y = scrollContainer.scrollTop - newScrollCoordinates;\n            } else {\n              scrollDelta.y = direction === KeyboardCode.Down ? scrollContainer.scrollTop - maxScroll.y : scrollContainer.scrollTop - minScroll.y;\n            }\n\n            if (scrollDelta.y) {\n              scrollContainer.scrollBy({\n                top: -scrollDelta.y,\n                behavior: scrollBehavior\n              });\n            }\n\n            break;\n          }\n        }\n\n        this.handleMove(event, add(subtract(newCoordinates, this.referenceCoordinates), scrollDelta));\n      }\n    }\n  }\n\n  handleMove(event, coordinates) {\n    const {\n      onMove\n    } = this.props;\n    event.preventDefault();\n    onMove(coordinates);\n  }\n\n  handleEnd(event) {\n    const {\n      onEnd\n    } = this.props;\n    event.preventDefault();\n    this.detach();\n    onEnd();\n  }\n\n  handleCancel(event) {\n    const {\n      onCancel\n    } = this.props;\n    event.preventDefault();\n    this.detach();\n    onCancel();\n  }\n\n  detach() {\n    this.listeners.removeAll();\n    this.windowListeners.removeAll();\n  }\n\n}\nKeyboardSensor.activators = [{\n  eventName: 'onKeyDown',\n  handler: (event, _ref, _ref2) => {\n    let {\n      keyboardCodes = defaultKeyboardCodes,\n      onActivation\n    } = _ref;\n    let {\n      active\n    } = _ref2;\n    const {\n      code\n    } = event.nativeEvent;\n\n    if (keyboardCodes.start.includes(code)) {\n      const activator = active.activatorNode.current;\n\n      if (activator && event.target !== activator) {\n        return false;\n      }\n\n      event.preventDefault();\n      onActivation == null ? void 0 : onActivation({\n        event: event.nativeEvent\n      });\n      return true;\n    }\n\n    return false;\n  }\n}];\n\nfunction isDistanceConstraint(constraint) {\n  return Boolean(constraint && 'distance' in constraint);\n}\n\nfunction isDelayConstraint(constraint) {\n  return Boolean(constraint && 'delay' in constraint);\n}\n\nclass AbstractPointerSensor {\n  constructor(props, events, listenerTarget) {\n    var _getEventCoordinates;\n\n    if (listenerTarget === void 0) {\n      listenerTarget = getEventListenerTarget(props.event.target);\n    }\n\n    this.props = void 0;\n    this.events = void 0;\n    this.autoScrollEnabled = true;\n    this.document = void 0;\n    this.activated = false;\n    this.initialCoordinates = void 0;\n    this.timeoutId = null;\n    this.listeners = void 0;\n    this.documentListeners = void 0;\n    this.windowListeners = void 0;\n    this.props = props;\n    this.events = events;\n    const {\n      event\n    } = props;\n    const {\n      target\n    } = event;\n    this.props = props;\n    this.events = events;\n    this.document = getOwnerDocument(target);\n    this.documentListeners = new Listeners(this.document);\n    this.listeners = new Listeners(listenerTarget);\n    this.windowListeners = new Listeners(getWindow(target));\n    this.initialCoordinates = (_getEventCoordinates = getEventCoordinates(event)) != null ? _getEventCoordinates : defaultCoordinates;\n    this.handleStart = this.handleStart.bind(this);\n    this.handleMove = this.handleMove.bind(this);\n    this.handleEnd = this.handleEnd.bind(this);\n    this.handleCancel = this.handleCancel.bind(this);\n    this.handleKeydown = this.handleKeydown.bind(this);\n    this.removeTextSelection = this.removeTextSelection.bind(this);\n    this.attach();\n  }\n\n  attach() {\n    const {\n      events,\n      props: {\n        options: {\n          activationConstraint,\n          bypassActivationConstraint\n        }\n      }\n    } = this;\n    this.listeners.add(events.move.name, this.handleMove, {\n      passive: false\n    });\n    this.listeners.add(events.end.name, this.handleEnd);\n\n    if (events.cancel) {\n      this.listeners.add(events.cancel.name, this.handleCancel);\n    }\n\n    this.windowListeners.add(EventName.Resize, this.handleCancel);\n    this.windowListeners.add(EventName.DragStart, preventDefault);\n    this.windowListeners.add(EventName.VisibilityChange, this.handleCancel);\n    this.windowListeners.add(EventName.ContextMenu, preventDefault);\n    this.documentListeners.add(EventName.Keydown, this.handleKeydown);\n\n    if (activationConstraint) {\n      if (bypassActivationConstraint != null && bypassActivationConstraint({\n        event: this.props.event,\n        activeNode: this.props.activeNode,\n        options: this.props.options\n      })) {\n        return this.handleStart();\n      }\n\n      if (isDelayConstraint(activationConstraint)) {\n        this.timeoutId = setTimeout(this.handleStart, activationConstraint.delay);\n        this.handlePending(activationConstraint);\n        return;\n      }\n\n      if (isDistanceConstraint(activationConstraint)) {\n        this.handlePending(activationConstraint);\n        return;\n      }\n    }\n\n    this.handleStart();\n  }\n\n  detach() {\n    this.listeners.removeAll();\n    this.windowListeners.removeAll(); // Wait until the next event loop before removing document listeners\n    // This is necessary because we listen for `click` and `selection` events on the document\n\n    setTimeout(this.documentListeners.removeAll, 50);\n\n    if (this.timeoutId !== null) {\n      clearTimeout(this.timeoutId);\n      this.timeoutId = null;\n    }\n  }\n\n  handlePending(constraint, offset) {\n    const {\n      active,\n      onPending\n    } = this.props;\n    onPending(active, constraint, this.initialCoordinates, offset);\n  }\n\n  handleStart() {\n    const {\n      initialCoordinates\n    } = this;\n    const {\n      onStart\n    } = this.props;\n\n    if (initialCoordinates) {\n      this.activated = true; // Stop propagation of click events once activation constraints are met\n\n      this.documentListeners.add(EventName.Click, stopPropagation, {\n        capture: true\n      }); // Remove any text selection from the document\n\n      this.removeTextSelection(); // Prevent further text selection while dragging\n\n      this.documentListeners.add(EventName.SelectionChange, this.removeTextSelection);\n      onStart(initialCoordinates);\n    }\n  }\n\n  handleMove(event) {\n    var _getEventCoordinates2;\n\n    const {\n      activated,\n      initialCoordinates,\n      props\n    } = this;\n    const {\n      onMove,\n      options: {\n        activationConstraint\n      }\n    } = props;\n\n    if (!initialCoordinates) {\n      return;\n    }\n\n    const coordinates = (_getEventCoordinates2 = getEventCoordinates(event)) != null ? _getEventCoordinates2 : defaultCoordinates;\n    const delta = subtract(initialCoordinates, coordinates); // Constraint validation\n\n    if (!activated && activationConstraint) {\n      if (isDistanceConstraint(activationConstraint)) {\n        if (activationConstraint.tolerance != null && hasExceededDistance(delta, activationConstraint.tolerance)) {\n          return this.handleCancel();\n        }\n\n        if (hasExceededDistance(delta, activationConstraint.distance)) {\n          return this.handleStart();\n        }\n      }\n\n      if (isDelayConstraint(activationConstraint)) {\n        if (hasExceededDistance(delta, activationConstraint.tolerance)) {\n          return this.handleCancel();\n        }\n      }\n\n      this.handlePending(activationConstraint, delta);\n      return;\n    }\n\n    if (event.cancelable) {\n      event.preventDefault();\n    }\n\n    onMove(coordinates);\n  }\n\n  handleEnd() {\n    const {\n      onAbort,\n      onEnd\n    } = this.props;\n    this.detach();\n\n    if (!this.activated) {\n      onAbort(this.props.active);\n    }\n\n    onEnd();\n  }\n\n  handleCancel() {\n    const {\n      onAbort,\n      onCancel\n    } = this.props;\n    this.detach();\n\n    if (!this.activated) {\n      onAbort(this.props.active);\n    }\n\n    onCancel();\n  }\n\n  handleKeydown(event) {\n    if (event.code === KeyboardCode.Esc) {\n      this.handleCancel();\n    }\n  }\n\n  removeTextSelection() {\n    var _this$document$getSel;\n\n    (_this$document$getSel = this.document.getSelection()) == null ? void 0 : _this$document$getSel.removeAllRanges();\n  }\n\n}\n\nconst events = {\n  cancel: {\n    name: 'pointercancel'\n  },\n  move: {\n    name: 'pointermove'\n  },\n  end: {\n    name: 'pointerup'\n  }\n};\nclass PointerSensor extends AbstractPointerSensor {\n  constructor(props) {\n    const {\n      event\n    } = props; // Pointer events stop firing if the target is unmounted while dragging\n    // Therefore we attach listeners to the owner document instead\n\n    const listenerTarget = getOwnerDocument(event.target);\n    super(props, events, listenerTarget);\n  }\n\n}\nPointerSensor.activators = [{\n  eventName: 'onPointerDown',\n  handler: (_ref, _ref2) => {\n    let {\n      nativeEvent: event\n    } = _ref;\n    let {\n      onActivation\n    } = _ref2;\n\n    if (!event.isPrimary || event.button !== 0) {\n      return false;\n    }\n\n    onActivation == null ? void 0 : onActivation({\n      event\n    });\n    return true;\n  }\n}];\n\nconst events$1 = {\n  move: {\n    name: 'mousemove'\n  },\n  end: {\n    name: 'mouseup'\n  }\n};\nvar MouseButton;\n\n(function (MouseButton) {\n  MouseButton[MouseButton[\"RightClick\"] = 2] = \"RightClick\";\n})(MouseButton || (MouseButton = {}));\n\nclass MouseSensor extends AbstractPointerSensor {\n  constructor(props) {\n    super(props, events$1, getOwnerDocument(props.event.target));\n  }\n\n}\nMouseSensor.activators = [{\n  eventName: 'onMouseDown',\n  handler: (_ref, _ref2) => {\n    let {\n      nativeEvent: event\n    } = _ref;\n    let {\n      onActivation\n    } = _ref2;\n\n    if (event.button === MouseButton.RightClick) {\n      return false;\n    }\n\n    onActivation == null ? void 0 : onActivation({\n      event\n    });\n    return true;\n  }\n}];\n\nconst events$2 = {\n  cancel: {\n    name: 'touchcancel'\n  },\n  move: {\n    name: 'touchmove'\n  },\n  end: {\n    name: 'touchend'\n  }\n};\nclass TouchSensor extends AbstractPointerSensor {\n  constructor(props) {\n    super(props, events$2);\n  }\n\n  static setup() {\n    // Adding a non-capture and non-passive `touchmove` listener in order\n    // to force `event.preventDefault()` calls to work in dynamically added\n    // touchmove event handlers. This is required for iOS Safari.\n    window.addEventListener(events$2.move.name, noop, {\n      capture: false,\n      passive: false\n    });\n    return function teardown() {\n      window.removeEventListener(events$2.move.name, noop);\n    }; // We create a new handler because the teardown function of another sensor\n    // could remove our event listener if we use a referentially equal listener.\n\n    function noop() {}\n  }\n\n}\nTouchSensor.activators = [{\n  eventName: 'onTouchStart',\n  handler: (_ref, _ref2) => {\n    let {\n      nativeEvent: event\n    } = _ref;\n    let {\n      onActivation\n    } = _ref2;\n    const {\n      touches\n    } = event;\n\n    if (touches.length > 1) {\n      return false;\n    }\n\n    onActivation == null ? void 0 : onActivation({\n      event\n    });\n    return true;\n  }\n}];\n\nvar AutoScrollActivator;\n\n(function (AutoScrollActivator) {\n  AutoScrollActivator[AutoScrollActivator[\"Pointer\"] = 0] = \"Pointer\";\n  AutoScrollActivator[AutoScrollActivator[\"DraggableRect\"] = 1] = \"DraggableRect\";\n})(AutoScrollActivator || (AutoScrollActivator = {}));\n\nvar TraversalOrder;\n\n(function (TraversalOrder) {\n  TraversalOrder[TraversalOrder[\"TreeOrder\"] = 0] = \"TreeOrder\";\n  TraversalOrder[TraversalOrder[\"ReversedTreeOrder\"] = 1] = \"ReversedTreeOrder\";\n})(TraversalOrder || (TraversalOrder = {}));\n\nfunction useAutoScroller(_ref) {\n  let {\n    acceleration,\n    activator = AutoScrollActivator.Pointer,\n    canScroll,\n    draggingRect,\n    enabled,\n    interval = 5,\n    order = TraversalOrder.TreeOrder,\n    pointerCoordinates,\n    scrollableAncestors,\n    scrollableAncestorRects,\n    delta,\n    threshold\n  } = _ref;\n  const scrollIntent = useScrollIntent({\n    delta,\n    disabled: !enabled\n  });\n  const [setAutoScrollInterval, clearAutoScrollInterval] = useInterval();\n  const scrollSpeed = useRef({\n    x: 0,\n    y: 0\n  });\n  const scrollDirection = useRef({\n    x: 0,\n    y: 0\n  });\n  const rect = useMemo(() => {\n    switch (activator) {\n      case AutoScrollActivator.Pointer:\n        return pointerCoordinates ? {\n          top: pointerCoordinates.y,\n          bottom: pointerCoordinates.y,\n          left: pointerCoordinates.x,\n          right: pointerCoordinates.x\n        } : null;\n\n      case AutoScrollActivator.DraggableRect:\n        return draggingRect;\n    }\n  }, [activator, draggingRect, pointerCoordinates]);\n  const scrollContainerRef = useRef(null);\n  const autoScroll = useCallback(() => {\n    const scrollContainer = scrollContainerRef.current;\n\n    if (!scrollContainer) {\n      return;\n    }\n\n    const scrollLeft = scrollSpeed.current.x * scrollDirection.current.x;\n    const scrollTop = scrollSpeed.current.y * scrollDirection.current.y;\n    scrollContainer.scrollBy(scrollLeft, scrollTop);\n  }, []);\n  const sortedScrollableAncestors = useMemo(() => order === TraversalOrder.TreeOrder ? [...scrollableAncestors].reverse() : scrollableAncestors, [order, scrollableAncestors]);\n  useEffect(() => {\n    if (!enabled || !scrollableAncestors.length || !rect) {\n      clearAutoScrollInterval();\n      return;\n    }\n\n    for (const scrollContainer of sortedScrollableAncestors) {\n      if ((canScroll == null ? void 0 : canScroll(scrollContainer)) === false) {\n        continue;\n      }\n\n      const index = scrollableAncestors.indexOf(scrollContainer);\n      const scrollContainerRect = scrollableAncestorRects[index];\n\n      if (!scrollContainerRect) {\n        continue;\n      }\n\n      const {\n        direction,\n        speed\n      } = getScrollDirectionAndSpeed(scrollContainer, scrollContainerRect, rect, acceleration, threshold);\n\n      for (const axis of ['x', 'y']) {\n        if (!scrollIntent[axis][direction[axis]]) {\n          speed[axis] = 0;\n          direction[axis] = 0;\n        }\n      }\n\n      if (speed.x > 0 || speed.y > 0) {\n        clearAutoScrollInterval();\n        scrollContainerRef.current = scrollContainer;\n        setAutoScrollInterval(autoScroll, interval);\n        scrollSpeed.current = speed;\n        scrollDirection.current = direction;\n        return;\n      }\n    }\n\n    scrollSpeed.current = {\n      x: 0,\n      y: 0\n    };\n    scrollDirection.current = {\n      x: 0,\n      y: 0\n    };\n    clearAutoScrollInterval();\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  [acceleration, autoScroll, canScroll, clearAutoScrollInterval, enabled, interval, // eslint-disable-next-line react-hooks/exhaustive-deps\n  JSON.stringify(rect), // eslint-disable-next-line react-hooks/exhaustive-deps\n  JSON.stringify(scrollIntent), setAutoScrollInterval, scrollableAncestors, sortedScrollableAncestors, scrollableAncestorRects, // eslint-disable-next-line react-hooks/exhaustive-deps\n  JSON.stringify(threshold)]);\n}\nconst defaultScrollIntent = {\n  x: {\n    [Direction.Backward]: false,\n    [Direction.Forward]: false\n  },\n  y: {\n    [Direction.Backward]: false,\n    [Direction.Forward]: false\n  }\n};\n\nfunction useScrollIntent(_ref2) {\n  let {\n    delta,\n    disabled\n  } = _ref2;\n  const previousDelta = usePrevious(delta);\n  return useLazyMemo(previousIntent => {\n    if (disabled || !previousDelta || !previousIntent) {\n      // Reset scroll intent tracking when auto-scrolling is disabled\n      return defaultScrollIntent;\n    }\n\n    const direction = {\n      x: Math.sign(delta.x - previousDelta.x),\n      y: Math.sign(delta.y - previousDelta.y)\n    }; // Keep track of the user intent to scroll in each direction for both axis\n\n    return {\n      x: {\n        [Direction.Backward]: previousIntent.x[Direction.Backward] || direction.x === -1,\n        [Direction.Forward]: previousIntent.x[Direction.Forward] || direction.x === 1\n      },\n      y: {\n        [Direction.Backward]: previousIntent.y[Direction.Backward] || direction.y === -1,\n        [Direction.Forward]: previousIntent.y[Direction.Forward] || direction.y === 1\n      }\n    };\n  }, [disabled, delta, previousDelta]);\n}\n\nfunction useCachedNode(draggableNodes, id) {\n  const draggableNode = id != null ? draggableNodes.get(id) : undefined;\n  const node = draggableNode ? draggableNode.node.current : null;\n  return useLazyMemo(cachedNode => {\n    var _ref;\n\n    if (id == null) {\n      return null;\n    } // In some cases, the draggable node can unmount while dragging\n    // This is the case for virtualized lists. In those situations,\n    // we fall back to the last known value for that node.\n\n\n    return (_ref = node != null ? node : cachedNode) != null ? _ref : null;\n  }, [node, id]);\n}\n\nfunction useCombineActivators(sensors, getSyntheticHandler) {\n  return useMemo(() => sensors.reduce((accumulator, sensor) => {\n    const {\n      sensor: Sensor\n    } = sensor;\n    const sensorActivators = Sensor.activators.map(activator => ({\n      eventName: activator.eventName,\n      handler: getSyntheticHandler(activator.handler, sensor)\n    }));\n    return [...accumulator, ...sensorActivators];\n  }, []), [sensors, getSyntheticHandler]);\n}\n\nvar MeasuringStrategy;\n\n(function (MeasuringStrategy) {\n  MeasuringStrategy[MeasuringStrategy[\"Always\"] = 0] = \"Always\";\n  MeasuringStrategy[MeasuringStrategy[\"BeforeDragging\"] = 1] = \"BeforeDragging\";\n  MeasuringStrategy[MeasuringStrategy[\"WhileDragging\"] = 2] = \"WhileDragging\";\n})(MeasuringStrategy || (MeasuringStrategy = {}));\n\nvar MeasuringFrequency;\n\n(function (MeasuringFrequency) {\n  MeasuringFrequency[\"Optimized\"] = \"optimized\";\n})(MeasuringFrequency || (MeasuringFrequency = {}));\n\nconst defaultValue = /*#__PURE__*/new Map();\nfunction useDroppableMeasuring(containers, _ref) {\n  let {\n    dragging,\n    dependencies,\n    config\n  } = _ref;\n  const [queue, setQueue] = useState(null);\n  const {\n    frequency,\n    measure,\n    strategy\n  } = config;\n  const containersRef = useRef(containers);\n  const disabled = isDisabled();\n  const disabledRef = useLatestValue(disabled);\n  const measureDroppableContainers = useCallback(function (ids) {\n    if (ids === void 0) {\n      ids = [];\n    }\n\n    if (disabledRef.current) {\n      return;\n    }\n\n    setQueue(value => {\n      if (value === null) {\n        return ids;\n      }\n\n      return value.concat(ids.filter(id => !value.includes(id)));\n    });\n  }, [disabledRef]);\n  const timeoutId = useRef(null);\n  const droppableRects = useLazyMemo(previousValue => {\n    if (disabled && !dragging) {\n      return defaultValue;\n    }\n\n    if (!previousValue || previousValue === defaultValue || containersRef.current !== containers || queue != null) {\n      const map = new Map();\n\n      for (let container of containers) {\n        if (!container) {\n          continue;\n        }\n\n        if (queue && queue.length > 0 && !queue.includes(container.id) && container.rect.current) {\n          // This container does not need to be re-measured\n          map.set(container.id, container.rect.current);\n          continue;\n        }\n\n        const node = container.node.current;\n        const rect = node ? new Rect(measure(node), node) : null;\n        container.rect.current = rect;\n\n        if (rect) {\n          map.set(container.id, rect);\n        }\n      }\n\n      return map;\n    }\n\n    return previousValue;\n  }, [containers, queue, dragging, disabled, measure]);\n  useEffect(() => {\n    containersRef.current = containers;\n  }, [containers]);\n  useEffect(() => {\n    if (disabled) {\n      return;\n    }\n\n    measureDroppableContainers();\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  [dragging, disabled]);\n  useEffect(() => {\n    if (queue && queue.length > 0) {\n      setQueue(null);\n    }\n  }, //eslint-disable-next-line react-hooks/exhaustive-deps\n  [JSON.stringify(queue)]);\n  useEffect(() => {\n    if (disabled || typeof frequency !== 'number' || timeoutId.current !== null) {\n      return;\n    }\n\n    timeoutId.current = setTimeout(() => {\n      measureDroppableContainers();\n      timeoutId.current = null;\n    }, frequency);\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  [frequency, disabled, measureDroppableContainers, ...dependencies]);\n  return {\n    droppableRects,\n    measureDroppableContainers,\n    measuringScheduled: queue != null\n  };\n\n  function isDisabled() {\n    switch (strategy) {\n      case MeasuringStrategy.Always:\n        return false;\n\n      case MeasuringStrategy.BeforeDragging:\n        return dragging;\n\n      default:\n        return !dragging;\n    }\n  }\n}\n\nfunction useInitialValue(value, computeFn) {\n  return useLazyMemo(previousValue => {\n    if (!value) {\n      return null;\n    }\n\n    if (previousValue) {\n      return previousValue;\n    }\n\n    return typeof computeFn === 'function' ? computeFn(value) : value;\n  }, [computeFn, value]);\n}\n\nfunction useInitialRect(node, measure) {\n  return useInitialValue(node, measure);\n}\n\n/**\r\n * Returns a new MutationObserver instance.\r\n * If `MutationObserver` is undefined in the execution environment, returns `undefined`.\r\n */\n\nfunction useMutationObserver(_ref) {\n  let {\n    callback,\n    disabled\n  } = _ref;\n  const handleMutations = useEvent(callback);\n  const mutationObserver = useMemo(() => {\n    if (disabled || typeof window === 'undefined' || typeof window.MutationObserver === 'undefined') {\n      return undefined;\n    }\n\n    const {\n      MutationObserver\n    } = window;\n    return new MutationObserver(handleMutations);\n  }, [handleMutations, disabled]);\n  useEffect(() => {\n    return () => mutationObserver == null ? void 0 : mutationObserver.disconnect();\n  }, [mutationObserver]);\n  return mutationObserver;\n}\n\n/**\r\n * Returns a new ResizeObserver instance bound to the `onResize` callback.\r\n * If `ResizeObserver` is undefined in the execution environment, returns `undefined`.\r\n */\n\nfunction useResizeObserver(_ref) {\n  let {\n    callback,\n    disabled\n  } = _ref;\n  const handleResize = useEvent(callback);\n  const resizeObserver = useMemo(() => {\n    if (disabled || typeof window === 'undefined' || typeof window.ResizeObserver === 'undefined') {\n      return undefined;\n    }\n\n    const {\n      ResizeObserver\n    } = window;\n    return new ResizeObserver(handleResize);\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  [disabled]);\n  useEffect(() => {\n    return () => resizeObserver == null ? void 0 : resizeObserver.disconnect();\n  }, [resizeObserver]);\n  return resizeObserver;\n}\n\nfunction defaultMeasure(element) {\n  return new Rect(getClientRect(element), element);\n}\n\nfunction useRect(element, measure, fallbackRect) {\n  if (measure === void 0) {\n    measure = defaultMeasure;\n  }\n\n  const [rect, setRect] = useState(null);\n\n  function measureRect() {\n    setRect(currentRect => {\n      if (!element) {\n        return null;\n      }\n\n      if (element.isConnected === false) {\n        var _ref;\n\n        // Fall back to last rect we measured if the element is\n        // no longer connected to the DOM.\n        return (_ref = currentRect != null ? currentRect : fallbackRect) != null ? _ref : null;\n      }\n\n      const newRect = measure(element);\n\n      if (JSON.stringify(currentRect) === JSON.stringify(newRect)) {\n        return currentRect;\n      }\n\n      return newRect;\n    });\n  }\n\n  const mutationObserver = useMutationObserver({\n    callback(records) {\n      if (!element) {\n        return;\n      }\n\n      for (const record of records) {\n        const {\n          type,\n          target\n        } = record;\n\n        if (type === 'childList' && target instanceof HTMLElement && target.contains(element)) {\n          measureRect();\n          break;\n        }\n      }\n    }\n\n  });\n  const resizeObserver = useResizeObserver({\n    callback: measureRect\n  });\n  useIsomorphicLayoutEffect(() => {\n    measureRect();\n\n    if (element) {\n      resizeObserver == null ? void 0 : resizeObserver.observe(element);\n      mutationObserver == null ? void 0 : mutationObserver.observe(document.body, {\n        childList: true,\n        subtree: true\n      });\n    } else {\n      resizeObserver == null ? void 0 : resizeObserver.disconnect();\n      mutationObserver == null ? void 0 : mutationObserver.disconnect();\n    }\n  }, [element]);\n  return rect;\n}\n\nfunction useRectDelta(rect) {\n  const initialRect = useInitialValue(rect);\n  return getRectDelta(rect, initialRect);\n}\n\nconst defaultValue$1 = [];\nfunction useScrollableAncestors(node) {\n  const previousNode = useRef(node);\n  const ancestors = useLazyMemo(previousValue => {\n    if (!node) {\n      return defaultValue$1;\n    }\n\n    if (previousValue && previousValue !== defaultValue$1 && node && previousNode.current && node.parentNode === previousNode.current.parentNode) {\n      return previousValue;\n    }\n\n    return getScrollableAncestors(node);\n  }, [node]);\n  useEffect(() => {\n    previousNode.current = node;\n  }, [node]);\n  return ancestors;\n}\n\nfunction useScrollOffsets(elements) {\n  const [scrollCoordinates, setScrollCoordinates] = useState(null);\n  const prevElements = useRef(elements); // To-do: Throttle the handleScroll callback\n\n  const handleScroll = useCallback(event => {\n    const scrollingElement = getScrollableElement(event.target);\n\n    if (!scrollingElement) {\n      return;\n    }\n\n    setScrollCoordinates(scrollCoordinates => {\n      if (!scrollCoordinates) {\n        return null;\n      }\n\n      scrollCoordinates.set(scrollingElement, getScrollCoordinates(scrollingElement));\n      return new Map(scrollCoordinates);\n    });\n  }, []);\n  useEffect(() => {\n    const previousElements = prevElements.current;\n\n    if (elements !== previousElements) {\n      cleanup(previousElements);\n      const entries = elements.map(element => {\n        const scrollableElement = getScrollableElement(element);\n\n        if (scrollableElement) {\n          scrollableElement.addEventListener('scroll', handleScroll, {\n            passive: true\n          });\n          return [scrollableElement, getScrollCoordinates(scrollableElement)];\n        }\n\n        return null;\n      }).filter(entry => entry != null);\n      setScrollCoordinates(entries.length ? new Map(entries) : null);\n      prevElements.current = elements;\n    }\n\n    return () => {\n      cleanup(elements);\n      cleanup(previousElements);\n    };\n\n    function cleanup(elements) {\n      elements.forEach(element => {\n        const scrollableElement = getScrollableElement(element);\n        scrollableElement == null ? void 0 : scrollableElement.removeEventListener('scroll', handleScroll);\n      });\n    }\n  }, [handleScroll, elements]);\n  return useMemo(() => {\n    if (elements.length) {\n      return scrollCoordinates ? Array.from(scrollCoordinates.values()).reduce((acc, coordinates) => add(acc, coordinates), defaultCoordinates) : getScrollOffsets(elements);\n    }\n\n    return defaultCoordinates;\n  }, [elements, scrollCoordinates]);\n}\n\nfunction useScrollOffsetsDelta(scrollOffsets, dependencies) {\n  if (dependencies === void 0) {\n    dependencies = [];\n  }\n\n  const initialScrollOffsets = useRef(null);\n  useEffect(() => {\n    initialScrollOffsets.current = null;\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  dependencies);\n  useEffect(() => {\n    const hasScrollOffsets = scrollOffsets !== defaultCoordinates;\n\n    if (hasScrollOffsets && !initialScrollOffsets.current) {\n      initialScrollOffsets.current = scrollOffsets;\n    }\n\n    if (!hasScrollOffsets && initialScrollOffsets.current) {\n      initialScrollOffsets.current = null;\n    }\n  }, [scrollOffsets]);\n  return initialScrollOffsets.current ? subtract(scrollOffsets, initialScrollOffsets.current) : defaultCoordinates;\n}\n\nfunction useSensorSetup(sensors) {\n  useEffect(() => {\n    if (!canUseDOM) {\n      return;\n    }\n\n    const teardownFns = sensors.map(_ref => {\n      let {\n        sensor\n      } = _ref;\n      return sensor.setup == null ? void 0 : sensor.setup();\n    });\n    return () => {\n      for (const teardown of teardownFns) {\n        teardown == null ? void 0 : teardown();\n      }\n    };\n  }, // TO-DO: Sensors length could theoretically change which would not be a valid dependency\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  sensors.map(_ref2 => {\n    let {\n      sensor\n    } = _ref2;\n    return sensor;\n  }));\n}\n\nfunction useSyntheticListeners(listeners, id) {\n  return useMemo(() => {\n    return listeners.reduce((acc, _ref) => {\n      let {\n        eventName,\n        handler\n      } = _ref;\n\n      acc[eventName] = event => {\n        handler(event, id);\n      };\n\n      return acc;\n    }, {});\n  }, [listeners, id]);\n}\n\nfunction useWindowRect(element) {\n  return useMemo(() => element ? getWindowClientRect(element) : null, [element]);\n}\n\nconst defaultValue$2 = [];\nfunction useRects(elements, measure) {\n  if (measure === void 0) {\n    measure = getClientRect;\n  }\n\n  const [firstElement] = elements;\n  const windowRect = useWindowRect(firstElement ? getWindow(firstElement) : null);\n  const [rects, setRects] = useState(defaultValue$2);\n\n  function measureRects() {\n    setRects(() => {\n      if (!elements.length) {\n        return defaultValue$2;\n      }\n\n      return elements.map(element => isDocumentScrollingElement(element) ? windowRect : new Rect(measure(element), element));\n    });\n  }\n\n  const resizeObserver = useResizeObserver({\n    callback: measureRects\n  });\n  useIsomorphicLayoutEffect(() => {\n    resizeObserver == null ? void 0 : resizeObserver.disconnect();\n    measureRects();\n    elements.forEach(element => resizeObserver == null ? void 0 : resizeObserver.observe(element));\n  }, [elements]);\n  return rects;\n}\n\nfunction getMeasurableNode(node) {\n  if (!node) {\n    return null;\n  }\n\n  if (node.children.length > 1) {\n    return node;\n  }\n\n  const firstChild = node.children[0];\n  return isHTMLElement(firstChild) ? firstChild : node;\n}\n\nfunction useDragOverlayMeasuring(_ref) {\n  let {\n    measure\n  } = _ref;\n  const [rect, setRect] = useState(null);\n  const handleResize = useCallback(entries => {\n    for (const {\n      target\n    } of entries) {\n      if (isHTMLElement(target)) {\n        setRect(rect => {\n          const newRect = measure(target);\n          return rect ? { ...rect,\n            width: newRect.width,\n            height: newRect.height\n          } : newRect;\n        });\n        break;\n      }\n    }\n  }, [measure]);\n  const resizeObserver = useResizeObserver({\n    callback: handleResize\n  });\n  const handleNodeChange = useCallback(element => {\n    const node = getMeasurableNode(element);\n    resizeObserver == null ? void 0 : resizeObserver.disconnect();\n\n    if (node) {\n      resizeObserver == null ? void 0 : resizeObserver.observe(node);\n    }\n\n    setRect(node ? measure(node) : null);\n  }, [measure, resizeObserver]);\n  const [nodeRef, setRef] = useNodeRef(handleNodeChange);\n  return useMemo(() => ({\n    nodeRef,\n    rect,\n    setRef\n  }), [rect, nodeRef, setRef]);\n}\n\nconst defaultSensors = [{\n  sensor: PointerSensor,\n  options: {}\n}, {\n  sensor: KeyboardSensor,\n  options: {}\n}];\nconst defaultData = {\n  current: {}\n};\nconst defaultMeasuringConfiguration = {\n  draggable: {\n    measure: getTransformAgnosticClientRect\n  },\n  droppable: {\n    measure: getTransformAgnosticClientRect,\n    strategy: MeasuringStrategy.WhileDragging,\n    frequency: MeasuringFrequency.Optimized\n  },\n  dragOverlay: {\n    measure: getClientRect\n  }\n};\n\nclass DroppableContainersMap extends Map {\n  get(id) {\n    var _super$get;\n\n    return id != null ? (_super$get = super.get(id)) != null ? _super$get : undefined : undefined;\n  }\n\n  toArray() {\n    return Array.from(this.values());\n  }\n\n  getEnabled() {\n    return this.toArray().filter(_ref => {\n      let {\n        disabled\n      } = _ref;\n      return !disabled;\n    });\n  }\n\n  getNodeFor(id) {\n    var _this$get$node$curren, _this$get;\n\n    return (_this$get$node$curren = (_this$get = this.get(id)) == null ? void 0 : _this$get.node.current) != null ? _this$get$node$curren : undefined;\n  }\n\n}\n\nconst defaultPublicContext = {\n  activatorEvent: null,\n  active: null,\n  activeNode: null,\n  activeNodeRect: null,\n  collisions: null,\n  containerNodeRect: null,\n  draggableNodes: /*#__PURE__*/new Map(),\n  droppableRects: /*#__PURE__*/new Map(),\n  droppableContainers: /*#__PURE__*/new DroppableContainersMap(),\n  over: null,\n  dragOverlay: {\n    nodeRef: {\n      current: null\n    },\n    rect: null,\n    setRef: noop\n  },\n  scrollableAncestors: [],\n  scrollableAncestorRects: [],\n  measuringConfiguration: defaultMeasuringConfiguration,\n  measureDroppableContainers: noop,\n  windowRect: null,\n  measuringScheduled: false\n};\nconst defaultInternalContext = {\n  activatorEvent: null,\n  activators: [],\n  active: null,\n  activeNodeRect: null,\n  ariaDescribedById: {\n    draggable: ''\n  },\n  dispatch: noop,\n  draggableNodes: /*#__PURE__*/new Map(),\n  over: null,\n  measureDroppableContainers: noop\n};\nconst InternalContext = /*#__PURE__*/createContext(defaultInternalContext);\nconst PublicContext = /*#__PURE__*/createContext(defaultPublicContext);\n\nfunction getInitialState() {\n  return {\n    draggable: {\n      active: null,\n      initialCoordinates: {\n        x: 0,\n        y: 0\n      },\n      nodes: new Map(),\n      translate: {\n        x: 0,\n        y: 0\n      }\n    },\n    droppable: {\n      containers: new DroppableContainersMap()\n    }\n  };\n}\nfunction reducer(state, action) {\n  switch (action.type) {\n    case Action.DragStart:\n      return { ...state,\n        draggable: { ...state.draggable,\n          initialCoordinates: action.initialCoordinates,\n          active: action.active\n        }\n      };\n\n    case Action.DragMove:\n      if (state.draggable.active == null) {\n        return state;\n      }\n\n      return { ...state,\n        draggable: { ...state.draggable,\n          translate: {\n            x: action.coordinates.x - state.draggable.initialCoordinates.x,\n            y: action.coordinates.y - state.draggable.initialCoordinates.y\n          }\n        }\n      };\n\n    case Action.DragEnd:\n    case Action.DragCancel:\n      return { ...state,\n        draggable: { ...state.draggable,\n          active: null,\n          initialCoordinates: {\n            x: 0,\n            y: 0\n          },\n          translate: {\n            x: 0,\n            y: 0\n          }\n        }\n      };\n\n    case Action.RegisterDroppable:\n      {\n        const {\n          element\n        } = action;\n        const {\n          id\n        } = element;\n        const containers = new DroppableContainersMap(state.droppable.containers);\n        containers.set(id, element);\n        return { ...state,\n          droppable: { ...state.droppable,\n            containers\n          }\n        };\n      }\n\n    case Action.SetDroppableDisabled:\n      {\n        const {\n          id,\n          key,\n          disabled\n        } = action;\n        const element = state.droppable.containers.get(id);\n\n        if (!element || key !== element.key) {\n          return state;\n        }\n\n        const containers = new DroppableContainersMap(state.droppable.containers);\n        containers.set(id, { ...element,\n          disabled\n        });\n        return { ...state,\n          droppable: { ...state.droppable,\n            containers\n          }\n        };\n      }\n\n    case Action.UnregisterDroppable:\n      {\n        const {\n          id,\n          key\n        } = action;\n        const element = state.droppable.containers.get(id);\n\n        if (!element || key !== element.key) {\n          return state;\n        }\n\n        const containers = new DroppableContainersMap(state.droppable.containers);\n        containers.delete(id);\n        return { ...state,\n          droppable: { ...state.droppable,\n            containers\n          }\n        };\n      }\n\n    default:\n      {\n        return state;\n      }\n  }\n}\n\nfunction RestoreFocus(_ref) {\n  let {\n    disabled\n  } = _ref;\n  const {\n    active,\n    activatorEvent,\n    draggableNodes\n  } = useContext(InternalContext);\n  const previousActivatorEvent = usePrevious(activatorEvent);\n  const previousActiveId = usePrevious(active == null ? void 0 : active.id); // Restore keyboard focus on the activator node\n\n  useEffect(() => {\n    if (disabled) {\n      return;\n    }\n\n    if (!activatorEvent && previousActivatorEvent && previousActiveId != null) {\n      if (!isKeyboardEvent(previousActivatorEvent)) {\n        return;\n      }\n\n      if (document.activeElement === previousActivatorEvent.target) {\n        // No need to restore focus\n        return;\n      }\n\n      const draggableNode = draggableNodes.get(previousActiveId);\n\n      if (!draggableNode) {\n        return;\n      }\n\n      const {\n        activatorNode,\n        node\n      } = draggableNode;\n\n      if (!activatorNode.current && !node.current) {\n        return;\n      }\n\n      requestAnimationFrame(() => {\n        for (const element of [activatorNode.current, node.current]) {\n          if (!element) {\n            continue;\n          }\n\n          const focusableNode = findFirstFocusableNode(element);\n\n          if (focusableNode) {\n            focusableNode.focus();\n            break;\n          }\n        }\n      });\n    }\n  }, [activatorEvent, disabled, draggableNodes, previousActiveId, previousActivatorEvent]);\n  return null;\n}\n\nfunction applyModifiers(modifiers, _ref) {\n  let {\n    transform,\n    ...args\n  } = _ref;\n  return modifiers != null && modifiers.length ? modifiers.reduce((accumulator, modifier) => {\n    return modifier({\n      transform: accumulator,\n      ...args\n    });\n  }, transform) : transform;\n}\n\nfunction useMeasuringConfiguration(config) {\n  return useMemo(() => ({\n    draggable: { ...defaultMeasuringConfiguration.draggable,\n      ...(config == null ? void 0 : config.draggable)\n    },\n    droppable: { ...defaultMeasuringConfiguration.droppable,\n      ...(config == null ? void 0 : config.droppable)\n    },\n    dragOverlay: { ...defaultMeasuringConfiguration.dragOverlay,\n      ...(config == null ? void 0 : config.dragOverlay)\n    }\n  }), // eslint-disable-next-line react-hooks/exhaustive-deps\n  [config == null ? void 0 : config.draggable, config == null ? void 0 : config.droppable, config == null ? void 0 : config.dragOverlay]);\n}\n\nfunction useLayoutShiftScrollCompensation(_ref) {\n  let {\n    activeNode,\n    measure,\n    initialRect,\n    config = true\n  } = _ref;\n  const initialized = useRef(false);\n  const {\n    x,\n    y\n  } = typeof config === 'boolean' ? {\n    x: config,\n    y: config\n  } : config;\n  useIsomorphicLayoutEffect(() => {\n    const disabled = !x && !y;\n\n    if (disabled || !activeNode) {\n      initialized.current = false;\n      return;\n    }\n\n    if (initialized.current || !initialRect) {\n      // Return early if layout shift scroll compensation was already attempted\n      // or if there is no initialRect to compare to.\n      return;\n    } // Get the most up to date node ref for the active draggable\n\n\n    const node = activeNode == null ? void 0 : activeNode.node.current;\n\n    if (!node || node.isConnected === false) {\n      // Return early if there is no attached node ref or if the node is\n      // disconnected from the document.\n      return;\n    }\n\n    const rect = measure(node);\n    const rectDelta = getRectDelta(rect, initialRect);\n\n    if (!x) {\n      rectDelta.x = 0;\n    }\n\n    if (!y) {\n      rectDelta.y = 0;\n    } // Only perform layout shift scroll compensation once\n\n\n    initialized.current = true;\n\n    if (Math.abs(rectDelta.x) > 0 || Math.abs(rectDelta.y) > 0) {\n      const firstScrollableAncestor = getFirstScrollableAncestor(node);\n\n      if (firstScrollableAncestor) {\n        firstScrollableAncestor.scrollBy({\n          top: rectDelta.y,\n          left: rectDelta.x\n        });\n      }\n    }\n  }, [activeNode, x, y, initialRect, measure]);\n}\n\nconst ActiveDraggableContext = /*#__PURE__*/createContext({ ...defaultCoordinates,\n  scaleX: 1,\n  scaleY: 1\n});\nvar Status;\n\n(function (Status) {\n  Status[Status[\"Uninitialized\"] = 0] = \"Uninitialized\";\n  Status[Status[\"Initializing\"] = 1] = \"Initializing\";\n  Status[Status[\"Initialized\"] = 2] = \"Initialized\";\n})(Status || (Status = {}));\n\nconst DndContext = /*#__PURE__*/memo(function DndContext(_ref) {\n  var _sensorContext$curren, _dragOverlay$nodeRef$, _dragOverlay$rect, _over$rect;\n\n  let {\n    id,\n    accessibility,\n    autoScroll = true,\n    children,\n    sensors = defaultSensors,\n    collisionDetection = rectIntersection,\n    measuring,\n    modifiers,\n    ...props\n  } = _ref;\n  const store = useReducer(reducer, undefined, getInitialState);\n  const [state, dispatch] = store;\n  const [dispatchMonitorEvent, registerMonitorListener] = useDndMonitorProvider();\n  const [status, setStatus] = useState(Status.Uninitialized);\n  const isInitialized = status === Status.Initialized;\n  const {\n    draggable: {\n      active: activeId,\n      nodes: draggableNodes,\n      translate\n    },\n    droppable: {\n      containers: droppableContainers\n    }\n  } = state;\n  const node = activeId != null ? draggableNodes.get(activeId) : null;\n  const activeRects = useRef({\n    initial: null,\n    translated: null\n  });\n  const active = useMemo(() => {\n    var _node$data;\n\n    return activeId != null ? {\n      id: activeId,\n      // It's possible for the active node to unmount while dragging\n      data: (_node$data = node == null ? void 0 : node.data) != null ? _node$data : defaultData,\n      rect: activeRects\n    } : null;\n  }, [activeId, node]);\n  const activeRef = useRef(null);\n  const [activeSensor, setActiveSensor] = useState(null);\n  const [activatorEvent, setActivatorEvent] = useState(null);\n  const latestProps = useLatestValue(props, Object.values(props));\n  const draggableDescribedById = useUniqueId(\"DndDescribedBy\", id);\n  const enabledDroppableContainers = useMemo(() => droppableContainers.getEnabled(), [droppableContainers]);\n  const measuringConfiguration = useMeasuringConfiguration(measuring);\n  const {\n    droppableRects,\n    measureDroppableContainers,\n    measuringScheduled\n  } = useDroppableMeasuring(enabledDroppableContainers, {\n    dragging: isInitialized,\n    dependencies: [translate.x, translate.y],\n    config: measuringConfiguration.droppable\n  });\n  const activeNode = useCachedNode(draggableNodes, activeId);\n  const activationCoordinates = useMemo(() => activatorEvent ? getEventCoordinates(activatorEvent) : null, [activatorEvent]);\n  const autoScrollOptions = getAutoScrollerOptions();\n  const initialActiveNodeRect = useInitialRect(activeNode, measuringConfiguration.draggable.measure);\n  useLayoutShiftScrollCompensation({\n    activeNode: activeId != null ? draggableNodes.get(activeId) : null,\n    config: autoScrollOptions.layoutShiftCompensation,\n    initialRect: initialActiveNodeRect,\n    measure: measuringConfiguration.draggable.measure\n  });\n  const activeNodeRect = useRect(activeNode, measuringConfiguration.draggable.measure, initialActiveNodeRect);\n  const containerNodeRect = useRect(activeNode ? activeNode.parentElement : null);\n  const sensorContext = useRef({\n    activatorEvent: null,\n    active: null,\n    activeNode,\n    collisionRect: null,\n    collisions: null,\n    droppableRects,\n    draggableNodes,\n    draggingNode: null,\n    draggingNodeRect: null,\n    droppableContainers,\n    over: null,\n    scrollableAncestors: [],\n    scrollAdjustedTranslate: null\n  });\n  const overNode = droppableContainers.getNodeFor((_sensorContext$curren = sensorContext.current.over) == null ? void 0 : _sensorContext$curren.id);\n  const dragOverlay = useDragOverlayMeasuring({\n    measure: measuringConfiguration.dragOverlay.measure\n  }); // Use the rect of the drag overlay if it is mounted\n\n  const draggingNode = (_dragOverlay$nodeRef$ = dragOverlay.nodeRef.current) != null ? _dragOverlay$nodeRef$ : activeNode;\n  const draggingNodeRect = isInitialized ? (_dragOverlay$rect = dragOverlay.rect) != null ? _dragOverlay$rect : activeNodeRect : null;\n  const usesDragOverlay = Boolean(dragOverlay.nodeRef.current && dragOverlay.rect); // The delta between the previous and new position of the draggable node\n  // is only relevant when there is no drag overlay\n\n  const nodeRectDelta = useRectDelta(usesDragOverlay ? null : activeNodeRect); // Get the window rect of the dragging node\n\n  const windowRect = useWindowRect(draggingNode ? getWindow(draggingNode) : null); // Get scrollable ancestors of the dragging node\n\n  const scrollableAncestors = useScrollableAncestors(isInitialized ? overNode != null ? overNode : activeNode : null);\n  const scrollableAncestorRects = useRects(scrollableAncestors); // Apply modifiers\n\n  const modifiedTranslate = applyModifiers(modifiers, {\n    transform: {\n      x: translate.x - nodeRectDelta.x,\n      y: translate.y - nodeRectDelta.y,\n      scaleX: 1,\n      scaleY: 1\n    },\n    activatorEvent,\n    active,\n    activeNodeRect,\n    containerNodeRect,\n    draggingNodeRect,\n    over: sensorContext.current.over,\n    overlayNodeRect: dragOverlay.rect,\n    scrollableAncestors,\n    scrollableAncestorRects,\n    windowRect\n  });\n  const pointerCoordinates = activationCoordinates ? add(activationCoordinates, translate) : null;\n  const scrollOffsets = useScrollOffsets(scrollableAncestors); // Represents the scroll delta since dragging was initiated\n\n  const scrollAdjustment = useScrollOffsetsDelta(scrollOffsets); // Represents the scroll delta since the last time the active node rect was measured\n\n  const activeNodeScrollDelta = useScrollOffsetsDelta(scrollOffsets, [activeNodeRect]);\n  const scrollAdjustedTranslate = add(modifiedTranslate, scrollAdjustment);\n  const collisionRect = draggingNodeRect ? getAdjustedRect(draggingNodeRect, modifiedTranslate) : null;\n  const collisions = active && collisionRect ? collisionDetection({\n    active,\n    collisionRect,\n    droppableRects,\n    droppableContainers: enabledDroppableContainers,\n    pointerCoordinates\n  }) : null;\n  const overId = getFirstCollision(collisions, 'id');\n  const [over, setOver] = useState(null); // When there is no drag overlay used, we need to account for the\n  // window scroll delta\n\n  const appliedTranslate = usesDragOverlay ? modifiedTranslate : add(modifiedTranslate, activeNodeScrollDelta);\n  const transform = adjustScale(appliedTranslate, (_over$rect = over == null ? void 0 : over.rect) != null ? _over$rect : null, activeNodeRect);\n  const activeSensorRef = useRef(null);\n  const instantiateSensor = useCallback((event, _ref2) => {\n    let {\n      sensor: Sensor,\n      options\n    } = _ref2;\n\n    if (activeRef.current == null) {\n      return;\n    }\n\n    const activeNode = draggableNodes.get(activeRef.current);\n\n    if (!activeNode) {\n      return;\n    }\n\n    const activatorEvent = event.nativeEvent;\n    const sensorInstance = new Sensor({\n      active: activeRef.current,\n      activeNode,\n      event: activatorEvent,\n      options,\n      // Sensors need to be instantiated with refs for arguments that change over time\n      // otherwise they are frozen in time with the stale arguments\n      context: sensorContext,\n\n      onAbort(id) {\n        const draggableNode = draggableNodes.get(id);\n\n        if (!draggableNode) {\n          return;\n        }\n\n        const {\n          onDragAbort\n        } = latestProps.current;\n        const event = {\n          id\n        };\n        onDragAbort == null ? void 0 : onDragAbort(event);\n        dispatchMonitorEvent({\n          type: 'onDragAbort',\n          event\n        });\n      },\n\n      onPending(id, constraint, initialCoordinates, offset) {\n        const draggableNode = draggableNodes.get(id);\n\n        if (!draggableNode) {\n          return;\n        }\n\n        const {\n          onDragPending\n        } = latestProps.current;\n        const event = {\n          id,\n          constraint,\n          initialCoordinates,\n          offset\n        };\n        onDragPending == null ? void 0 : onDragPending(event);\n        dispatchMonitorEvent({\n          type: 'onDragPending',\n          event\n        });\n      },\n\n      onStart(initialCoordinates) {\n        const id = activeRef.current;\n\n        if (id == null) {\n          return;\n        }\n\n        const draggableNode = draggableNodes.get(id);\n\n        if (!draggableNode) {\n          return;\n        }\n\n        const {\n          onDragStart\n        } = latestProps.current;\n        const event = {\n          activatorEvent,\n          active: {\n            id,\n            data: draggableNode.data,\n            rect: activeRects\n          }\n        };\n        unstable_batchedUpdates(() => {\n          onDragStart == null ? void 0 : onDragStart(event);\n          setStatus(Status.Initializing);\n          dispatch({\n            type: Action.DragStart,\n            initialCoordinates,\n            active: id\n          });\n          dispatchMonitorEvent({\n            type: 'onDragStart',\n            event\n          });\n          setActiveSensor(activeSensorRef.current);\n          setActivatorEvent(activatorEvent);\n        });\n      },\n\n      onMove(coordinates) {\n        dispatch({\n          type: Action.DragMove,\n          coordinates\n        });\n      },\n\n      onEnd: createHandler(Action.DragEnd),\n      onCancel: createHandler(Action.DragCancel)\n    });\n    activeSensorRef.current = sensorInstance;\n\n    function createHandler(type) {\n      return async function handler() {\n        const {\n          active,\n          collisions,\n          over,\n          scrollAdjustedTranslate\n        } = sensorContext.current;\n        let event = null;\n\n        if (active && scrollAdjustedTranslate) {\n          const {\n            cancelDrop\n          } = latestProps.current;\n          event = {\n            activatorEvent,\n            active: active,\n            collisions,\n            delta: scrollAdjustedTranslate,\n            over\n          };\n\n          if (type === Action.DragEnd && typeof cancelDrop === 'function') {\n            const shouldCancel = await Promise.resolve(cancelDrop(event));\n\n            if (shouldCancel) {\n              type = Action.DragCancel;\n            }\n          }\n        }\n\n        activeRef.current = null;\n        unstable_batchedUpdates(() => {\n          dispatch({\n            type\n          });\n          setStatus(Status.Uninitialized);\n          setOver(null);\n          setActiveSensor(null);\n          setActivatorEvent(null);\n          activeSensorRef.current = null;\n          const eventName = type === Action.DragEnd ? 'onDragEnd' : 'onDragCancel';\n\n          if (event) {\n            const handler = latestProps.current[eventName];\n            handler == null ? void 0 : handler(event);\n            dispatchMonitorEvent({\n              type: eventName,\n              event\n            });\n          }\n        });\n      };\n    }\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  [draggableNodes]);\n  const bindActivatorToSensorInstantiator = useCallback((handler, sensor) => {\n    return (event, active) => {\n      const nativeEvent = event.nativeEvent;\n      const activeDraggableNode = draggableNodes.get(active);\n\n      if ( // Another sensor is already instantiating\n      activeRef.current !== null || // No active draggable\n      !activeDraggableNode || // Event has already been captured\n      nativeEvent.dndKit || nativeEvent.defaultPrevented) {\n        return;\n      }\n\n      const activationContext = {\n        active: activeDraggableNode\n      };\n      const shouldActivate = handler(event, sensor.options, activationContext);\n\n      if (shouldActivate === true) {\n        nativeEvent.dndKit = {\n          capturedBy: sensor.sensor\n        };\n        activeRef.current = active;\n        instantiateSensor(event, sensor);\n      }\n    };\n  }, [draggableNodes, instantiateSensor]);\n  const activators = useCombineActivators(sensors, bindActivatorToSensorInstantiator);\n  useSensorSetup(sensors);\n  useIsomorphicLayoutEffect(() => {\n    if (activeNodeRect && status === Status.Initializing) {\n      setStatus(Status.Initialized);\n    }\n  }, [activeNodeRect, status]);\n  useEffect(() => {\n    const {\n      onDragMove\n    } = latestProps.current;\n    const {\n      active,\n      activatorEvent,\n      collisions,\n      over\n    } = sensorContext.current;\n\n    if (!active || !activatorEvent) {\n      return;\n    }\n\n    const event = {\n      active,\n      activatorEvent,\n      collisions,\n      delta: {\n        x: scrollAdjustedTranslate.x,\n        y: scrollAdjustedTranslate.y\n      },\n      over\n    };\n    unstable_batchedUpdates(() => {\n      onDragMove == null ? void 0 : onDragMove(event);\n      dispatchMonitorEvent({\n        type: 'onDragMove',\n        event\n      });\n    });\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  [scrollAdjustedTranslate.x, scrollAdjustedTranslate.y]);\n  useEffect(() => {\n    const {\n      active,\n      activatorEvent,\n      collisions,\n      droppableContainers,\n      scrollAdjustedTranslate\n    } = sensorContext.current;\n\n    if (!active || activeRef.current == null || !activatorEvent || !scrollAdjustedTranslate) {\n      return;\n    }\n\n    const {\n      onDragOver\n    } = latestProps.current;\n    const overContainer = droppableContainers.get(overId);\n    const over = overContainer && overContainer.rect.current ? {\n      id: overContainer.id,\n      rect: overContainer.rect.current,\n      data: overContainer.data,\n      disabled: overContainer.disabled\n    } : null;\n    const event = {\n      active,\n      activatorEvent,\n      collisions,\n      delta: {\n        x: scrollAdjustedTranslate.x,\n        y: scrollAdjustedTranslate.y\n      },\n      over\n    };\n    unstable_batchedUpdates(() => {\n      setOver(over);\n      onDragOver == null ? void 0 : onDragOver(event);\n      dispatchMonitorEvent({\n        type: 'onDragOver',\n        event\n      });\n    });\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  [overId]);\n  useIsomorphicLayoutEffect(() => {\n    sensorContext.current = {\n      activatorEvent,\n      active,\n      activeNode,\n      collisionRect,\n      collisions,\n      droppableRects,\n      draggableNodes,\n      draggingNode,\n      draggingNodeRect,\n      droppableContainers,\n      over,\n      scrollableAncestors,\n      scrollAdjustedTranslate\n    };\n    activeRects.current = {\n      initial: draggingNodeRect,\n      translated: collisionRect\n    };\n  }, [active, activeNode, collisions, collisionRect, draggableNodes, draggingNode, draggingNodeRect, droppableRects, droppableContainers, over, scrollableAncestors, scrollAdjustedTranslate]);\n  useAutoScroller({ ...autoScrollOptions,\n    delta: translate,\n    draggingRect: collisionRect,\n    pointerCoordinates,\n    scrollableAncestors,\n    scrollableAncestorRects\n  });\n  const publicContext = useMemo(() => {\n    const context = {\n      active,\n      activeNode,\n      activeNodeRect,\n      activatorEvent,\n      collisions,\n      containerNodeRect,\n      dragOverlay,\n      draggableNodes,\n      droppableContainers,\n      droppableRects,\n      over,\n      measureDroppableContainers,\n      scrollableAncestors,\n      scrollableAncestorRects,\n      measuringConfiguration,\n      measuringScheduled,\n      windowRect\n    };\n    return context;\n  }, [active, activeNode, activeNodeRect, activatorEvent, collisions, containerNodeRect, dragOverlay, draggableNodes, droppableContainers, droppableRects, over, measureDroppableContainers, scrollableAncestors, scrollableAncestorRects, measuringConfiguration, measuringScheduled, windowRect]);\n  const internalContext = useMemo(() => {\n    const context = {\n      activatorEvent,\n      activators,\n      active,\n      activeNodeRect,\n      ariaDescribedById: {\n        draggable: draggableDescribedById\n      },\n      dispatch,\n      draggableNodes,\n      over,\n      measureDroppableContainers\n    };\n    return context;\n  }, [activatorEvent, activators, active, activeNodeRect, dispatch, draggableDescribedById, draggableNodes, over, measureDroppableContainers]);\n  return React.createElement(DndMonitorContext.Provider, {\n    value: registerMonitorListener\n  }, React.createElement(InternalContext.Provider, {\n    value: internalContext\n  }, React.createElement(PublicContext.Provider, {\n    value: publicContext\n  }, React.createElement(ActiveDraggableContext.Provider, {\n    value: transform\n  }, children)), React.createElement(RestoreFocus, {\n    disabled: (accessibility == null ? void 0 : accessibility.restoreFocus) === false\n  })), React.createElement(Accessibility, { ...accessibility,\n    hiddenTextDescribedById: draggableDescribedById\n  }));\n\n  function getAutoScrollerOptions() {\n    const activeSensorDisablesAutoscroll = (activeSensor == null ? void 0 : activeSensor.autoScrollEnabled) === false;\n    const autoScrollGloballyDisabled = typeof autoScroll === 'object' ? autoScroll.enabled === false : autoScroll === false;\n    const enabled = isInitialized && !activeSensorDisablesAutoscroll && !autoScrollGloballyDisabled;\n\n    if (typeof autoScroll === 'object') {\n      return { ...autoScroll,\n        enabled\n      };\n    }\n\n    return {\n      enabled\n    };\n  }\n});\n\nconst NullContext = /*#__PURE__*/createContext(null);\nconst defaultRole = 'button';\nconst ID_PREFIX = 'Draggable';\nfunction useDraggable(_ref) {\n  let {\n    id,\n    data,\n    disabled = false,\n    attributes\n  } = _ref;\n  const key = useUniqueId(ID_PREFIX);\n  const {\n    activators,\n    activatorEvent,\n    active,\n    activeNodeRect,\n    ariaDescribedById,\n    draggableNodes,\n    over\n  } = useContext(InternalContext);\n  const {\n    role = defaultRole,\n    roleDescription = 'draggable',\n    tabIndex = 0\n  } = attributes != null ? attributes : {};\n  const isDragging = (active == null ? void 0 : active.id) === id;\n  const transform = useContext(isDragging ? ActiveDraggableContext : NullContext);\n  const [node, setNodeRef] = useNodeRef();\n  const [activatorNode, setActivatorNodeRef] = useNodeRef();\n  const listeners = useSyntheticListeners(activators, id);\n  const dataRef = useLatestValue(data);\n  useIsomorphicLayoutEffect(() => {\n    draggableNodes.set(id, {\n      id,\n      key,\n      node,\n      activatorNode,\n      data: dataRef\n    });\n    return () => {\n      const node = draggableNodes.get(id);\n\n      if (node && node.key === key) {\n        draggableNodes.delete(id);\n      }\n    };\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  [draggableNodes, id]);\n  const memoizedAttributes = useMemo(() => ({\n    role,\n    tabIndex,\n    'aria-disabled': disabled,\n    'aria-pressed': isDragging && role === defaultRole ? true : undefined,\n    'aria-roledescription': roleDescription,\n    'aria-describedby': ariaDescribedById.draggable\n  }), [disabled, role, tabIndex, isDragging, roleDescription, ariaDescribedById.draggable]);\n  return {\n    active,\n    activatorEvent,\n    activeNodeRect,\n    attributes: memoizedAttributes,\n    isDragging,\n    listeners: disabled ? undefined : listeners,\n    node,\n    over,\n    setNodeRef,\n    setActivatorNodeRef,\n    transform\n  };\n}\n\nfunction useDndContext() {\n  return useContext(PublicContext);\n}\n\nconst ID_PREFIX$1 = 'Droppable';\nconst defaultResizeObserverConfig = {\n  timeout: 25\n};\nfunction useDroppable(_ref) {\n  let {\n    data,\n    disabled = false,\n    id,\n    resizeObserverConfig\n  } = _ref;\n  const key = useUniqueId(ID_PREFIX$1);\n  const {\n    active,\n    dispatch,\n    over,\n    measureDroppableContainers\n  } = useContext(InternalContext);\n  const previous = useRef({\n    disabled\n  });\n  const resizeObserverConnected = useRef(false);\n  const rect = useRef(null);\n  const callbackId = useRef(null);\n  const {\n    disabled: resizeObserverDisabled,\n    updateMeasurementsFor,\n    timeout: resizeObserverTimeout\n  } = { ...defaultResizeObserverConfig,\n    ...resizeObserverConfig\n  };\n  const ids = useLatestValue(updateMeasurementsFor != null ? updateMeasurementsFor : id);\n  const handleResize = useCallback(() => {\n    if (!resizeObserverConnected.current) {\n      // ResizeObserver invokes the `handleResize` callback as soon as `observe` is called,\n      // assuming the element is rendered and displayed.\n      resizeObserverConnected.current = true;\n      return;\n    }\n\n    if (callbackId.current != null) {\n      clearTimeout(callbackId.current);\n    }\n\n    callbackId.current = setTimeout(() => {\n      measureDroppableContainers(Array.isArray(ids.current) ? ids.current : [ids.current]);\n      callbackId.current = null;\n    }, resizeObserverTimeout);\n  }, //eslint-disable-next-line react-hooks/exhaustive-deps\n  [resizeObserverTimeout]);\n  const resizeObserver = useResizeObserver({\n    callback: handleResize,\n    disabled: resizeObserverDisabled || !active\n  });\n  const handleNodeChange = useCallback((newElement, previousElement) => {\n    if (!resizeObserver) {\n      return;\n    }\n\n    if (previousElement) {\n      resizeObserver.unobserve(previousElement);\n      resizeObserverConnected.current = false;\n    }\n\n    if (newElement) {\n      resizeObserver.observe(newElement);\n    }\n  }, [resizeObserver]);\n  const [nodeRef, setNodeRef] = useNodeRef(handleNodeChange);\n  const dataRef = useLatestValue(data);\n  useEffect(() => {\n    if (!resizeObserver || !nodeRef.current) {\n      return;\n    }\n\n    resizeObserver.disconnect();\n    resizeObserverConnected.current = false;\n    resizeObserver.observe(nodeRef.current);\n  }, [nodeRef, resizeObserver]);\n  useEffect(() => {\n    dispatch({\n      type: Action.RegisterDroppable,\n      element: {\n        id,\n        key,\n        disabled,\n        node: nodeRef,\n        rect,\n        data: dataRef\n      }\n    });\n    return () => dispatch({\n      type: Action.UnregisterDroppable,\n      key,\n      id\n    });\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  [id]);\n  useEffect(() => {\n    if (disabled !== previous.current.disabled) {\n      dispatch({\n        type: Action.SetDroppableDisabled,\n        id,\n        key,\n        disabled\n      });\n      previous.current.disabled = disabled;\n    }\n  }, [id, key, disabled, dispatch]);\n  return {\n    active,\n    rect,\n    isOver: (over == null ? void 0 : over.id) === id,\n    node: nodeRef,\n    over,\n    setNodeRef\n  };\n}\n\nfunction AnimationManager(_ref) {\n  let {\n    animation,\n    children\n  } = _ref;\n  const [clonedChildren, setClonedChildren] = useState(null);\n  const [element, setElement] = useState(null);\n  const previousChildren = usePrevious(children);\n\n  if (!children && !clonedChildren && previousChildren) {\n    setClonedChildren(previousChildren);\n  }\n\n  useIsomorphicLayoutEffect(() => {\n    if (!element) {\n      return;\n    }\n\n    const key = clonedChildren == null ? void 0 : clonedChildren.key;\n    const id = clonedChildren == null ? void 0 : clonedChildren.props.id;\n\n    if (key == null || id == null) {\n      setClonedChildren(null);\n      return;\n    }\n\n    Promise.resolve(animation(id, element)).then(() => {\n      setClonedChildren(null);\n    });\n  }, [animation, clonedChildren, element]);\n  return React.createElement(React.Fragment, null, children, clonedChildren ? cloneElement(clonedChildren, {\n    ref: setElement\n  }) : null);\n}\n\nconst defaultTransform = {\n  x: 0,\n  y: 0,\n  scaleX: 1,\n  scaleY: 1\n};\nfunction NullifiedContextProvider(_ref) {\n  let {\n    children\n  } = _ref;\n  return React.createElement(InternalContext.Provider, {\n    value: defaultInternalContext\n  }, React.createElement(ActiveDraggableContext.Provider, {\n    value: defaultTransform\n  }, children));\n}\n\nconst baseStyles = {\n  position: 'fixed',\n  touchAction: 'none'\n};\n\nconst defaultTransition = activatorEvent => {\n  const isKeyboardActivator = isKeyboardEvent(activatorEvent);\n  return isKeyboardActivator ? 'transform 250ms ease' : undefined;\n};\n\nconst PositionedOverlay = /*#__PURE__*/forwardRef((_ref, ref) => {\n  let {\n    as,\n    activatorEvent,\n    adjustScale,\n    children,\n    className,\n    rect,\n    style,\n    transform,\n    transition = defaultTransition\n  } = _ref;\n\n  if (!rect) {\n    return null;\n  }\n\n  const scaleAdjustedTransform = adjustScale ? transform : { ...transform,\n    scaleX: 1,\n    scaleY: 1\n  };\n  const styles = { ...baseStyles,\n    width: rect.width,\n    height: rect.height,\n    top: rect.top,\n    left: rect.left,\n    transform: CSS.Transform.toString(scaleAdjustedTransform),\n    transformOrigin: adjustScale && activatorEvent ? getRelativeTransformOrigin(activatorEvent, rect) : undefined,\n    transition: typeof transition === 'function' ? transition(activatorEvent) : transition,\n    ...style\n  };\n  return React.createElement(as, {\n    className,\n    style: styles,\n    ref\n  }, children);\n});\n\nconst defaultDropAnimationSideEffects = options => _ref => {\n  let {\n    active,\n    dragOverlay\n  } = _ref;\n  const originalStyles = {};\n  const {\n    styles,\n    className\n  } = options;\n\n  if (styles != null && styles.active) {\n    for (const [key, value] of Object.entries(styles.active)) {\n      if (value === undefined) {\n        continue;\n      }\n\n      originalStyles[key] = active.node.style.getPropertyValue(key);\n      active.node.style.setProperty(key, value);\n    }\n  }\n\n  if (styles != null && styles.dragOverlay) {\n    for (const [key, value] of Object.entries(styles.dragOverlay)) {\n      if (value === undefined) {\n        continue;\n      }\n\n      dragOverlay.node.style.setProperty(key, value);\n    }\n  }\n\n  if (className != null && className.active) {\n    active.node.classList.add(className.active);\n  }\n\n  if (className != null && className.dragOverlay) {\n    dragOverlay.node.classList.add(className.dragOverlay);\n  }\n\n  return function cleanup() {\n    for (const [key, value] of Object.entries(originalStyles)) {\n      active.node.style.setProperty(key, value);\n    }\n\n    if (className != null && className.active) {\n      active.node.classList.remove(className.active);\n    }\n  };\n};\n\nconst defaultKeyframeResolver = _ref2 => {\n  let {\n    transform: {\n      initial,\n      final\n    }\n  } = _ref2;\n  return [{\n    transform: CSS.Transform.toString(initial)\n  }, {\n    transform: CSS.Transform.toString(final)\n  }];\n};\n\nconst defaultDropAnimationConfiguration = {\n  duration: 250,\n  easing: 'ease',\n  keyframes: defaultKeyframeResolver,\n  sideEffects: /*#__PURE__*/defaultDropAnimationSideEffects({\n    styles: {\n      active: {\n        opacity: '0'\n      }\n    }\n  })\n};\nfunction useDropAnimation(_ref3) {\n  let {\n    config,\n    draggableNodes,\n    droppableContainers,\n    measuringConfiguration\n  } = _ref3;\n  return useEvent((id, node) => {\n    if (config === null) {\n      return;\n    }\n\n    const activeDraggable = draggableNodes.get(id);\n\n    if (!activeDraggable) {\n      return;\n    }\n\n    const activeNode = activeDraggable.node.current;\n\n    if (!activeNode) {\n      return;\n    }\n\n    const measurableNode = getMeasurableNode(node);\n\n    if (!measurableNode) {\n      return;\n    }\n\n    const {\n      transform\n    } = getWindow(node).getComputedStyle(node);\n    const parsedTransform = parseTransform(transform);\n\n    if (!parsedTransform) {\n      return;\n    }\n\n    const animation = typeof config === 'function' ? config : createDefaultDropAnimation(config);\n    scrollIntoViewIfNeeded(activeNode, measuringConfiguration.draggable.measure);\n    return animation({\n      active: {\n        id,\n        data: activeDraggable.data,\n        node: activeNode,\n        rect: measuringConfiguration.draggable.measure(activeNode)\n      },\n      draggableNodes,\n      dragOverlay: {\n        node,\n        rect: measuringConfiguration.dragOverlay.measure(measurableNode)\n      },\n      droppableContainers,\n      measuringConfiguration,\n      transform: parsedTransform\n    });\n  });\n}\n\nfunction createDefaultDropAnimation(options) {\n  const {\n    duration,\n    easing,\n    sideEffects,\n    keyframes\n  } = { ...defaultDropAnimationConfiguration,\n    ...options\n  };\n  return _ref4 => {\n    let {\n      active,\n      dragOverlay,\n      transform,\n      ...rest\n    } = _ref4;\n\n    if (!duration) {\n      // Do not animate if animation duration is zero.\n      return;\n    }\n\n    const delta = {\n      x: dragOverlay.rect.left - active.rect.left,\n      y: dragOverlay.rect.top - active.rect.top\n    };\n    const scale = {\n      scaleX: transform.scaleX !== 1 ? active.rect.width * transform.scaleX / dragOverlay.rect.width : 1,\n      scaleY: transform.scaleY !== 1 ? active.rect.height * transform.scaleY / dragOverlay.rect.height : 1\n    };\n    const finalTransform = {\n      x: transform.x - delta.x,\n      y: transform.y - delta.y,\n      ...scale\n    };\n    const animationKeyframes = keyframes({ ...rest,\n      active,\n      dragOverlay,\n      transform: {\n        initial: transform,\n        final: finalTransform\n      }\n    });\n    const [firstKeyframe] = animationKeyframes;\n    const lastKeyframe = animationKeyframes[animationKeyframes.length - 1];\n\n    if (JSON.stringify(firstKeyframe) === JSON.stringify(lastKeyframe)) {\n      // The start and end keyframes are the same, infer that there is no animation needed.\n      return;\n    }\n\n    const cleanup = sideEffects == null ? void 0 : sideEffects({\n      active,\n      dragOverlay,\n      ...rest\n    });\n    const animation = dragOverlay.node.animate(animationKeyframes, {\n      duration,\n      easing,\n      fill: 'forwards'\n    });\n    return new Promise(resolve => {\n      animation.onfinish = () => {\n        cleanup == null ? void 0 : cleanup();\n        resolve();\n      };\n    });\n  };\n}\n\nlet key = 0;\nfunction useKey(id) {\n  return useMemo(() => {\n    if (id == null) {\n      return;\n    }\n\n    key++;\n    return key;\n  }, [id]);\n}\n\nconst DragOverlay = /*#__PURE__*/React.memo(_ref => {\n  let {\n    adjustScale = false,\n    children,\n    dropAnimation: dropAnimationConfig,\n    style,\n    transition,\n    modifiers,\n    wrapperElement = 'div',\n    className,\n    zIndex = 999\n  } = _ref;\n  const {\n    activatorEvent,\n    active,\n    activeNodeRect,\n    containerNodeRect,\n    draggableNodes,\n    droppableContainers,\n    dragOverlay,\n    over,\n    measuringConfiguration,\n    scrollableAncestors,\n    scrollableAncestorRects,\n    windowRect\n  } = useDndContext();\n  const transform = useContext(ActiveDraggableContext);\n  const key = useKey(active == null ? void 0 : active.id);\n  const modifiedTransform = applyModifiers(modifiers, {\n    activatorEvent,\n    active,\n    activeNodeRect,\n    containerNodeRect,\n    draggingNodeRect: dragOverlay.rect,\n    over,\n    overlayNodeRect: dragOverlay.rect,\n    scrollableAncestors,\n    scrollableAncestorRects,\n    transform,\n    windowRect\n  });\n  const initialRect = useInitialValue(activeNodeRect);\n  const dropAnimation = useDropAnimation({\n    config: dropAnimationConfig,\n    draggableNodes,\n    droppableContainers,\n    measuringConfiguration\n  }); // We need to wait for the active node to be measured before connecting the drag overlay ref\n  // otherwise collisions can be computed against a mispositioned drag overlay\n\n  const ref = initialRect ? dragOverlay.setRef : undefined;\n  return React.createElement(NullifiedContextProvider, null, React.createElement(AnimationManager, {\n    animation: dropAnimation\n  }, active && key ? React.createElement(PositionedOverlay, {\n    key: key,\n    id: active.id,\n    ref: ref,\n    as: wrapperElement,\n    activatorEvent: activatorEvent,\n    adjustScale: adjustScale,\n    className: className,\n    transition: transition,\n    rect: initialRect,\n    style: {\n      zIndex,\n      ...style\n    },\n    transform: modifiedTransform\n  }, children) : null));\n});\n\nexport { AutoScrollActivator, DndContext, DragOverlay, KeyboardCode, KeyboardSensor, MeasuringFrequency, MeasuringStrategy, MouseSensor, PointerSensor, TouchSensor, TraversalOrder, applyModifiers, closestCenter, closestCorners, defaultAnnouncements, defaultCoordinates, defaultDropAnimationConfiguration as defaultDropAnimation, defaultDropAnimationSideEffects, defaultKeyboardCoordinateGetter, defaultScreenReaderInstructions, getClientRect, getFirstCollision, getScrollableAncestors, pointerWithin, rectIntersection, useDndContext, useDndMonitor, useDraggable, useDroppable, useSensor, useSensors };\n//# sourceMappingURL=core.esm.js.map\n","import React, { useMemo, useRef, useEffect, useState, useContext } from 'react';\nimport { useDndContext, getClientRect, useDroppable, useDraggable, closestCorners, getFirstCollision, getScrollableAncestors, KeyboardCode } from '@dnd-kit/core';\nimport { useUniqueId, useIsomorphicLayoutEffect, CSS, useCombinedRefs, isKeyboardEvent, subtract } from '@dnd-kit/utilities';\n\n/**\r\n * Move an array item to a different position. Returns a new array with the item moved to the new position.\r\n */\nfunction arrayMove(array, from, to) {\n  const newArray = array.slice();\n  newArray.splice(to < 0 ? newArray.length + to : to, 0, newArray.splice(from, 1)[0]);\n  return newArray;\n}\n\n/**\r\n * Swap an array item to a different position. Returns a new array with the item swapped to the new position.\r\n */\nfunction arraySwap(array, from, to) {\n  const newArray = array.slice();\n  newArray[from] = array[to];\n  newArray[to] = array[from];\n  return newArray;\n}\n\nfunction getSortedRects(items, rects) {\n  return items.reduce((accumulator, id, index) => {\n    const rect = rects.get(id);\n\n    if (rect) {\n      accumulator[index] = rect;\n    }\n\n    return accumulator;\n  }, Array(items.length));\n}\n\nfunction isValidIndex(index) {\n  return index !== null && index >= 0;\n}\n\nfunction itemsEqual(a, b) {\n  if (a === b) {\n    return true;\n  }\n\n  if (a.length !== b.length) {\n    return false;\n  }\n\n  for (let i = 0; i < a.length; i++) {\n    if (a[i] !== b[i]) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nfunction normalizeDisabled(disabled) {\n  if (typeof disabled === 'boolean') {\n    return {\n      draggable: disabled,\n      droppable: disabled\n    };\n  }\n\n  return disabled;\n}\n\n// To-do: We should be calculating scale transformation\nconst defaultScale = {\n  scaleX: 1,\n  scaleY: 1\n};\nconst horizontalListSortingStrategy = _ref => {\n  var _rects$activeIndex;\n\n  let {\n    rects,\n    activeNodeRect: fallbackActiveRect,\n    activeIndex,\n    overIndex,\n    index\n  } = _ref;\n  const activeNodeRect = (_rects$activeIndex = rects[activeIndex]) != null ? _rects$activeIndex : fallbackActiveRect;\n\n  if (!activeNodeRect) {\n    return null;\n  }\n\n  const itemGap = getItemGap(rects, index, activeIndex);\n\n  if (index === activeIndex) {\n    const newIndexRect = rects[overIndex];\n\n    if (!newIndexRect) {\n      return null;\n    }\n\n    return {\n      x: activeIndex < overIndex ? newIndexRect.left + newIndexRect.width - (activeNodeRect.left + activeNodeRect.width) : newIndexRect.left - activeNodeRect.left,\n      y: 0,\n      ...defaultScale\n    };\n  }\n\n  if (index > activeIndex && index <= overIndex) {\n    return {\n      x: -activeNodeRect.width - itemGap,\n      y: 0,\n      ...defaultScale\n    };\n  }\n\n  if (index < activeIndex && index >= overIndex) {\n    return {\n      x: activeNodeRect.width + itemGap,\n      y: 0,\n      ...defaultScale\n    };\n  }\n\n  return {\n    x: 0,\n    y: 0,\n    ...defaultScale\n  };\n};\n\nfunction getItemGap(rects, index, activeIndex) {\n  const currentRect = rects[index];\n  const previousRect = rects[index - 1];\n  const nextRect = rects[index + 1];\n\n  if (!currentRect || !previousRect && !nextRect) {\n    return 0;\n  }\n\n  if (activeIndex < index) {\n    return previousRect ? currentRect.left - (previousRect.left + previousRect.width) : nextRect.left - (currentRect.left + currentRect.width);\n  }\n\n  return nextRect ? nextRect.left - (currentRect.left + currentRect.width) : currentRect.left - (previousRect.left + previousRect.width);\n}\n\nconst rectSortingStrategy = _ref => {\n  let {\n    rects,\n    activeIndex,\n    overIndex,\n    index\n  } = _ref;\n  const newRects = arrayMove(rects, overIndex, activeIndex);\n  const oldRect = rects[index];\n  const newRect = newRects[index];\n\n  if (!newRect || !oldRect) {\n    return null;\n  }\n\n  return {\n    x: newRect.left - oldRect.left,\n    y: newRect.top - oldRect.top,\n    scaleX: newRect.width / oldRect.width,\n    scaleY: newRect.height / oldRect.height\n  };\n};\n\nconst rectSwappingStrategy = _ref => {\n  let {\n    activeIndex,\n    index,\n    rects,\n    overIndex\n  } = _ref;\n  let oldRect;\n  let newRect;\n\n  if (index === activeIndex) {\n    oldRect = rects[index];\n    newRect = rects[overIndex];\n  }\n\n  if (index === overIndex) {\n    oldRect = rects[index];\n    newRect = rects[activeIndex];\n  }\n\n  if (!newRect || !oldRect) {\n    return null;\n  }\n\n  return {\n    x: newRect.left - oldRect.left,\n    y: newRect.top - oldRect.top,\n    scaleX: newRect.width / oldRect.width,\n    scaleY: newRect.height / oldRect.height\n  };\n};\n\n// To-do: We should be calculating scale transformation\nconst defaultScale$1 = {\n  scaleX: 1,\n  scaleY: 1\n};\nconst verticalListSortingStrategy = _ref => {\n  var _rects$activeIndex;\n\n  let {\n    activeIndex,\n    activeNodeRect: fallbackActiveRect,\n    index,\n    rects,\n    overIndex\n  } = _ref;\n  const activeNodeRect = (_rects$activeIndex = rects[activeIndex]) != null ? _rects$activeIndex : fallbackActiveRect;\n\n  if (!activeNodeRect) {\n    return null;\n  }\n\n  if (index === activeIndex) {\n    const overIndexRect = rects[overIndex];\n\n    if (!overIndexRect) {\n      return null;\n    }\n\n    return {\n      x: 0,\n      y: activeIndex < overIndex ? overIndexRect.top + overIndexRect.height - (activeNodeRect.top + activeNodeRect.height) : overIndexRect.top - activeNodeRect.top,\n      ...defaultScale$1\n    };\n  }\n\n  const itemGap = getItemGap$1(rects, index, activeIndex);\n\n  if (index > activeIndex && index <= overIndex) {\n    return {\n      x: 0,\n      y: -activeNodeRect.height - itemGap,\n      ...defaultScale$1\n    };\n  }\n\n  if (index < activeIndex && index >= overIndex) {\n    return {\n      x: 0,\n      y: activeNodeRect.height + itemGap,\n      ...defaultScale$1\n    };\n  }\n\n  return {\n    x: 0,\n    y: 0,\n    ...defaultScale$1\n  };\n};\n\nfunction getItemGap$1(clientRects, index, activeIndex) {\n  const currentRect = clientRects[index];\n  const previousRect = clientRects[index - 1];\n  const nextRect = clientRects[index + 1];\n\n  if (!currentRect) {\n    return 0;\n  }\n\n  if (activeIndex < index) {\n    return previousRect ? currentRect.top - (previousRect.top + previousRect.height) : nextRect ? nextRect.top - (currentRect.top + currentRect.height) : 0;\n  }\n\n  return nextRect ? nextRect.top - (currentRect.top + currentRect.height) : previousRect ? currentRect.top - (previousRect.top + previousRect.height) : 0;\n}\n\nconst ID_PREFIX = 'Sortable';\nconst Context = /*#__PURE__*/React.createContext({\n  activeIndex: -1,\n  containerId: ID_PREFIX,\n  disableTransforms: false,\n  items: [],\n  overIndex: -1,\n  useDragOverlay: false,\n  sortedRects: [],\n  strategy: rectSortingStrategy,\n  disabled: {\n    draggable: false,\n    droppable: false\n  }\n});\nfunction SortableContext(_ref) {\n  let {\n    children,\n    id,\n    items: userDefinedItems,\n    strategy = rectSortingStrategy,\n    disabled: disabledProp = false\n  } = _ref;\n  const {\n    active,\n    dragOverlay,\n    droppableRects,\n    over,\n    measureDroppableContainers\n  } = useDndContext();\n  const containerId = useUniqueId(ID_PREFIX, id);\n  const useDragOverlay = Boolean(dragOverlay.rect !== null);\n  const items = useMemo(() => userDefinedItems.map(item => typeof item === 'object' && 'id' in item ? item.id : item), [userDefinedItems]);\n  const isDragging = active != null;\n  const activeIndex = active ? items.indexOf(active.id) : -1;\n  const overIndex = over ? items.indexOf(over.id) : -1;\n  const previousItemsRef = useRef(items);\n  const itemsHaveChanged = !itemsEqual(items, previousItemsRef.current);\n  const disableTransforms = overIndex !== -1 && activeIndex === -1 || itemsHaveChanged;\n  const disabled = normalizeDisabled(disabledProp);\n  useIsomorphicLayoutEffect(() => {\n    if (itemsHaveChanged && isDragging) {\n      measureDroppableContainers(items);\n    }\n  }, [itemsHaveChanged, items, isDragging, measureDroppableContainers]);\n  useEffect(() => {\n    previousItemsRef.current = items;\n  }, [items]);\n  const contextValue = useMemo(() => ({\n    activeIndex,\n    containerId,\n    disabled,\n    disableTransforms,\n    items,\n    overIndex,\n    useDragOverlay,\n    sortedRects: getSortedRects(items, droppableRects),\n    strategy\n  }), // eslint-disable-next-line react-hooks/exhaustive-deps\n  [activeIndex, containerId, disabled.draggable, disabled.droppable, disableTransforms, items, overIndex, droppableRects, useDragOverlay, strategy]);\n  return React.createElement(Context.Provider, {\n    value: contextValue\n  }, children);\n}\n\nconst defaultNewIndexGetter = _ref => {\n  let {\n    id,\n    items,\n    activeIndex,\n    overIndex\n  } = _ref;\n  return arrayMove(items, activeIndex, overIndex).indexOf(id);\n};\nconst defaultAnimateLayoutChanges = _ref2 => {\n  let {\n    containerId,\n    isSorting,\n    wasDragging,\n    index,\n    items,\n    newIndex,\n    previousItems,\n    previousContainerId,\n    transition\n  } = _ref2;\n\n  if (!transition || !wasDragging) {\n    return false;\n  }\n\n  if (previousItems !== items && index === newIndex) {\n    return false;\n  }\n\n  if (isSorting) {\n    return true;\n  }\n\n  return newIndex !== index && containerId === previousContainerId;\n};\nconst defaultTransition = {\n  duration: 200,\n  easing: 'ease'\n};\nconst transitionProperty = 'transform';\nconst disabledTransition = /*#__PURE__*/CSS.Transition.toString({\n  property: transitionProperty,\n  duration: 0,\n  easing: 'linear'\n});\nconst defaultAttributes = {\n  roleDescription: 'sortable'\n};\n\n/*\r\n * When the index of an item changes while sorting,\r\n * we need to temporarily disable the transforms\r\n */\n\nfunction useDerivedTransform(_ref) {\n  let {\n    disabled,\n    index,\n    node,\n    rect\n  } = _ref;\n  const [derivedTransform, setDerivedtransform] = useState(null);\n  const previousIndex = useRef(index);\n  useIsomorphicLayoutEffect(() => {\n    if (!disabled && index !== previousIndex.current && node.current) {\n      const initial = rect.current;\n\n      if (initial) {\n        const current = getClientRect(node.current, {\n          ignoreTransform: true\n        });\n        const delta = {\n          x: initial.left - current.left,\n          y: initial.top - current.top,\n          scaleX: initial.width / current.width,\n          scaleY: initial.height / current.height\n        };\n\n        if (delta.x || delta.y) {\n          setDerivedtransform(delta);\n        }\n      }\n    }\n\n    if (index !== previousIndex.current) {\n      previousIndex.current = index;\n    }\n  }, [disabled, index, node, rect]);\n  useEffect(() => {\n    if (derivedTransform) {\n      setDerivedtransform(null);\n    }\n  }, [derivedTransform]);\n  return derivedTransform;\n}\n\nfunction useSortable(_ref) {\n  let {\n    animateLayoutChanges = defaultAnimateLayoutChanges,\n    attributes: userDefinedAttributes,\n    disabled: localDisabled,\n    data: customData,\n    getNewIndex = defaultNewIndexGetter,\n    id,\n    strategy: localStrategy,\n    resizeObserverConfig,\n    transition = defaultTransition\n  } = _ref;\n  const {\n    items,\n    containerId,\n    activeIndex,\n    disabled: globalDisabled,\n    disableTransforms,\n    sortedRects,\n    overIndex,\n    useDragOverlay,\n    strategy: globalStrategy\n  } = useContext(Context);\n  const disabled = normalizeLocalDisabled(localDisabled, globalDisabled);\n  const index = items.indexOf(id);\n  const data = useMemo(() => ({\n    sortable: {\n      containerId,\n      index,\n      items\n    },\n    ...customData\n  }), [containerId, customData, index, items]);\n  const itemsAfterCurrentSortable = useMemo(() => items.slice(items.indexOf(id)), [items, id]);\n  const {\n    rect,\n    node,\n    isOver,\n    setNodeRef: setDroppableNodeRef\n  } = useDroppable({\n    id,\n    data,\n    disabled: disabled.droppable,\n    resizeObserverConfig: {\n      updateMeasurementsFor: itemsAfterCurrentSortable,\n      ...resizeObserverConfig\n    }\n  });\n  const {\n    active,\n    activatorEvent,\n    activeNodeRect,\n    attributes,\n    setNodeRef: setDraggableNodeRef,\n    listeners,\n    isDragging,\n    over,\n    setActivatorNodeRef,\n    transform\n  } = useDraggable({\n    id,\n    data,\n    attributes: { ...defaultAttributes,\n      ...userDefinedAttributes\n    },\n    disabled: disabled.draggable\n  });\n  const setNodeRef = useCombinedRefs(setDroppableNodeRef, setDraggableNodeRef);\n  const isSorting = Boolean(active);\n  const displaceItem = isSorting && !disableTransforms && isValidIndex(activeIndex) && isValidIndex(overIndex);\n  const shouldDisplaceDragSource = !useDragOverlay && isDragging;\n  const dragSourceDisplacement = shouldDisplaceDragSource && displaceItem ? transform : null;\n  const strategy = localStrategy != null ? localStrategy : globalStrategy;\n  const finalTransform = displaceItem ? dragSourceDisplacement != null ? dragSourceDisplacement : strategy({\n    rects: sortedRects,\n    activeNodeRect,\n    activeIndex,\n    overIndex,\n    index\n  }) : null;\n  const newIndex = isValidIndex(activeIndex) && isValidIndex(overIndex) ? getNewIndex({\n    id,\n    items,\n    activeIndex,\n    overIndex\n  }) : index;\n  const activeId = active == null ? void 0 : active.id;\n  const previous = useRef({\n    activeId,\n    items,\n    newIndex,\n    containerId\n  });\n  const itemsHaveChanged = items !== previous.current.items;\n  const shouldAnimateLayoutChanges = animateLayoutChanges({\n    active,\n    containerId,\n    isDragging,\n    isSorting,\n    id,\n    index,\n    items,\n    newIndex: previous.current.newIndex,\n    previousItems: previous.current.items,\n    previousContainerId: previous.current.containerId,\n    transition,\n    wasDragging: previous.current.activeId != null\n  });\n  const derivedTransform = useDerivedTransform({\n    disabled: !shouldAnimateLayoutChanges,\n    index,\n    node,\n    rect\n  });\n  useEffect(() => {\n    if (isSorting && previous.current.newIndex !== newIndex) {\n      previous.current.newIndex = newIndex;\n    }\n\n    if (containerId !== previous.current.containerId) {\n      previous.current.containerId = containerId;\n    }\n\n    if (items !== previous.current.items) {\n      previous.current.items = items;\n    }\n  }, [isSorting, newIndex, containerId, items]);\n  useEffect(() => {\n    if (activeId === previous.current.activeId) {\n      return;\n    }\n\n    if (activeId != null && previous.current.activeId == null) {\n      previous.current.activeId = activeId;\n      return;\n    }\n\n    const timeoutId = setTimeout(() => {\n      previous.current.activeId = activeId;\n    }, 50);\n    return () => clearTimeout(timeoutId);\n  }, [activeId]);\n  return {\n    active,\n    activeIndex,\n    attributes,\n    data,\n    rect,\n    index,\n    newIndex,\n    items,\n    isOver,\n    isSorting,\n    isDragging,\n    listeners,\n    node,\n    overIndex,\n    over,\n    setNodeRef,\n    setActivatorNodeRef,\n    setDroppableNodeRef,\n    setDraggableNodeRef,\n    transform: derivedTransform != null ? derivedTransform : finalTransform,\n    transition: getTransition()\n  };\n\n  function getTransition() {\n    if ( // Temporarily disable transitions for a single frame to set up derived transforms\n    derivedTransform || // Or to prevent items jumping to back to their \"new\" position when items change\n    itemsHaveChanged && previous.current.newIndex === index) {\n      return disabledTransition;\n    }\n\n    if (shouldDisplaceDragSource && !isKeyboardEvent(activatorEvent) || !transition) {\n      return undefined;\n    }\n\n    if (isSorting || shouldAnimateLayoutChanges) {\n      return CSS.Transition.toString({ ...transition,\n        property: transitionProperty\n      });\n    }\n\n    return undefined;\n  }\n}\n\nfunction normalizeLocalDisabled(localDisabled, globalDisabled) {\n  var _localDisabled$dragga, _localDisabled$droppa;\n\n  if (typeof localDisabled === 'boolean') {\n    return {\n      draggable: localDisabled,\n      // Backwards compatibility\n      droppable: false\n    };\n  }\n\n  return {\n    draggable: (_localDisabled$dragga = localDisabled == null ? void 0 : localDisabled.draggable) != null ? _localDisabled$dragga : globalDisabled.draggable,\n    droppable: (_localDisabled$droppa = localDisabled == null ? void 0 : localDisabled.droppable) != null ? _localDisabled$droppa : globalDisabled.droppable\n  };\n}\n\nfunction hasSortableData(entry) {\n  if (!entry) {\n    return false;\n  }\n\n  const data = entry.data.current;\n\n  if (data && 'sortable' in data && typeof data.sortable === 'object' && 'containerId' in data.sortable && 'items' in data.sortable && 'index' in data.sortable) {\n    return true;\n  }\n\n  return false;\n}\n\nconst directions = [KeyboardCode.Down, KeyboardCode.Right, KeyboardCode.Up, KeyboardCode.Left];\nconst sortableKeyboardCoordinates = (event, _ref) => {\n  let {\n    context: {\n      active,\n      collisionRect,\n      droppableRects,\n      droppableContainers,\n      over,\n      scrollableAncestors\n    }\n  } = _ref;\n\n  if (directions.includes(event.code)) {\n    event.preventDefault();\n\n    if (!active || !collisionRect) {\n      return;\n    }\n\n    const filteredContainers = [];\n    droppableContainers.getEnabled().forEach(entry => {\n      if (!entry || entry != null && entry.disabled) {\n        return;\n      }\n\n      const rect = droppableRects.get(entry.id);\n\n      if (!rect) {\n        return;\n      }\n\n      switch (event.code) {\n        case KeyboardCode.Down:\n          if (collisionRect.top < rect.top) {\n            filteredContainers.push(entry);\n          }\n\n          break;\n\n        case KeyboardCode.Up:\n          if (collisionRect.top > rect.top) {\n            filteredContainers.push(entry);\n          }\n\n          break;\n\n        case KeyboardCode.Left:\n          if (collisionRect.left > rect.left) {\n            filteredContainers.push(entry);\n          }\n\n          break;\n\n        case KeyboardCode.Right:\n          if (collisionRect.left < rect.left) {\n            filteredContainers.push(entry);\n          }\n\n          break;\n      }\n    });\n    const collisions = closestCorners({\n      active,\n      collisionRect: collisionRect,\n      droppableRects,\n      droppableContainers: filteredContainers,\n      pointerCoordinates: null\n    });\n    let closestId = getFirstCollision(collisions, 'id');\n\n    if (closestId === (over == null ? void 0 : over.id) && collisions.length > 1) {\n      closestId = collisions[1].id;\n    }\n\n    if (closestId != null) {\n      const activeDroppable = droppableContainers.get(active.id);\n      const newDroppable = droppableContainers.get(closestId);\n      const newRect = newDroppable ? droppableRects.get(newDroppable.id) : null;\n      const newNode = newDroppable == null ? void 0 : newDroppable.node.current;\n\n      if (newNode && newRect && activeDroppable && newDroppable) {\n        const newScrollAncestors = getScrollableAncestors(newNode);\n        const hasDifferentScrollAncestors = newScrollAncestors.some((element, index) => scrollableAncestors[index] !== element);\n        const hasSameContainer = isSameContainer(activeDroppable, newDroppable);\n        const isAfterActive = isAfter(activeDroppable, newDroppable);\n        const offset = hasDifferentScrollAncestors || !hasSameContainer ? {\n          x: 0,\n          y: 0\n        } : {\n          x: isAfterActive ? collisionRect.width - newRect.width : 0,\n          y: isAfterActive ? collisionRect.height - newRect.height : 0\n        };\n        const rectCoordinates = {\n          x: newRect.left,\n          y: newRect.top\n        };\n        const newCoordinates = offset.x && offset.y ? rectCoordinates : subtract(rectCoordinates, offset);\n        return newCoordinates;\n      }\n    }\n  }\n\n  return undefined;\n};\n\nfunction isSameContainer(a, b) {\n  if (!hasSortableData(a) || !hasSortableData(b)) {\n    return false;\n  }\n\n  return a.data.current.sortable.containerId === b.data.current.sortable.containerId;\n}\n\nfunction isAfter(a, b) {\n  if (!hasSortableData(a) || !hasSortableData(b)) {\n    return false;\n  }\n\n  if (!isSameContainer(a, b)) {\n    return false;\n  }\n\n  return a.data.current.sortable.index < b.data.current.sortable.index;\n}\n\nexport { SortableContext, arrayMove, arraySwap, defaultAnimateLayoutChanges, defaultNewIndexGetter, hasSortableData, horizontalListSortingStrategy, rectSortingStrategy, rectSwappingStrategy, sortableKeyboardCoordinates, useSortable, verticalListSortingStrategy };\n//# sourceMappingURL=sortable.esm.js.map\n","import { useState } from 'react'\nimport { Calendar } from '@/components/ui/calendar'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from '@/components/ui/popover'\nimport { Calendar as CalendarIcon } from 'lucide-react'\nimport { format } from 'date-fns'\nimport { ko } from 'date-fns/locale'\nimport { cn } from '@/lib/utils'\nimport { logger } from '@/lib/logger'\n\ninterface DateAmountPickerPopoverProps {\n  children: React.ReactNode\n  onConfirm: (date: Date, amount: number) => void\n  disabled?: boolean\n  placeholder?: string\n  align?: \"center\" | \"start\" | \"end\"\n  side?: \"top\" | \"right\" | \"bottom\" | \"left\"\n  defaultDate?: Date\n  defaultAmount?: number\n}\n\nexport function DateAmountPickerPopover({\n  children,\n  onConfirm,\n  disabled = false,\n  placeholder = \"  \",\n  align = \"center\",\n  side = \"bottom\",\n  defaultDate,\n  defaultAmount\n}: DateAmountPickerPopoverProps) {\n  const [open, setOpen] = useState(false)\n  const [selectedDate, setSelectedDate] = useState<Date | undefined>(defaultDate)\n  const [amount, setAmount] = useState<string>(defaultAmount?.toString() || '')\n\n  const handleConfirm = () => {\n    if (!selectedDate) {\n      return\n    }\n    \n    const amountNum = parseFloat(amount.replace(/,/g, ''))\n    if (isNaN(amountNum) || amountNum <= 0) {\n      return\n    }\n\n    onConfirm(selectedDate, amountNum)\n    setOpen(false)\n    // Reset after close\n    setSelectedDate(defaultDate)\n    setAmount(defaultAmount?.toString() || '')\n  }\n\n  const handleAmountChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const value = e.target.value.replace(/[^0-9]/g, '')\n    if (value) {\n      const numValue = parseInt(value, 10)\n      setAmount(numValue.toLocaleString())\n    } else {\n      setAmount('')\n    }\n  }\n\n  return (\n    <Popover open={open} onOpenChange={setOpen}>\n      <PopoverTrigger asChild disabled={disabled}>\n        {children}\n      </PopoverTrigger>\n      <PopoverContent \n        className=\"w-auto p-0 border-gray-200 shadow-lg\" \n        align={align}\n        side={side}\n        sideOffset={8}\n      >\n        <div className=\"bg-white business-radius-card p-3\">\n          <div className=\"mb-2 px-1\">\n            <div className=\"modal-label text-gray-600 text-center\">\n              {placeholder}\n            </div>\n          </div>\n          <Calendar\n            mode=\"single\"\n            selected={selectedDate}\n            onSelect={setSelectedDate}\n            locale={ko}\n            initialFocus\n            className=\"compact-calendar\"\n            disabled={false}\n            fromDate={new Date('2020-01-01')}\n            toDate={new Date('2030-12-31')}\n            defaultMonth={selectedDate || new Date()}\n            modifiers={{\n              today: new Date()\n            }}\n            modifiersClassNames={{\n              today: \"bg-blue-500 text-white font-semibold cursor-pointer hover:bg-blue-600 rounded-md\"\n            }}\n          />\n          <div className=\"mt-3 px-1\">\n            <label className=\"block text-xs font-medium text-gray-700 mb-1\">\n              \n            </label>\n            <Input\n              type=\"text\"\n              value={amount}\n              onChange={handleAmountChange}\n              placeholder=\" \"\n              className=\"w-full\"\n            />\n          </div>\n          <div className=\"mt-3 flex justify-end gap-2\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => setOpen(false)}\n            >\n              \n            </Button>\n            <Button\n              size=\"sm\"\n              onClick={handleConfirm}\n              disabled={!selectedDate || !amount || parseFloat(amount.replace(/,/g, '')) <= 0}\n              className=\"button-base button-action-primary\"\n            >\n              \n            </Button>\n          </div>\n        </div>\n      </PopoverContent>\n    </Popover>\n  )\n}\n\n","import { useState } from 'react'\nimport { Calendar } from '@/components/ui/calendar'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from '@/components/ui/popover'\nimport { Calendar as CalendarIcon } from 'lucide-react'\nimport { format } from 'date-fns'\nimport { ko } from 'date-fns/locale'\nimport { cn } from '@/lib/utils'\nimport { logger } from '@/lib/logger'\n\ninterface DateQuantityPickerPopoverProps {\n  children: React.ReactNode\n  onConfirm: (date: Date, quantity?: number) => void\n  disabled?: boolean\n  placeholder?: string\n  align?: \"center\" | \"start\" | \"end\"\n  side?: \"top\" | \"right\" | \"bottom\" | \"left\"\n  defaultDate?: Date\n  defaultQuantity?: number\n  maxQuantity?: number\n  allowOverMaxQuantity?: boolean\n  hideQuantityInput?: boolean\n  quantityInfoText?: string\n}\n\nexport function DateQuantityPickerPopover({\n  children,\n  onConfirm,\n  disabled = false,\n  placeholder = \"  \",\n  align = \"center\",\n  side = \"bottom\",\n  defaultDate,\n  defaultQuantity,\n  maxQuantity,\n  allowOverMaxQuantity = false,\n  hideQuantityInput = false,\n  quantityInfoText = \"   \"\n}: DateQuantityPickerPopoverProps) {\n  const [open, setOpen] = useState(false)\n  const [selectedDate, setSelectedDate] = useState<Date | undefined>(defaultDate)\n  const [quantity, setQuantity] = useState<string>(defaultQuantity?.toString() || '')\n\n  const handleFillRequestedQuantity = () => {\n    if (maxQuantity !== undefined) {\n      setQuantity(maxQuantity.toString())\n    }\n  }\n\n  const handleConfirm = () => {\n    if (!selectedDate) {\n      return\n    }\n    \n    if (hideQuantityInput) {\n      //     ( ), quantity undefined \n      onConfirm(selectedDate, undefined)\n      setOpen(false)\n      // Reset after close\n      setSelectedDate(defaultDate)\n      setQuantity(defaultQuantity?.toString() || '')\n      return\n    }\n    \n    const quantityNum = parseFloat(quantity.replace(/,/g, ''))\n    if (isNaN(quantityNum) || quantityNum < 0) {\n      return\n    }\n\n    if (maxQuantity !== undefined && !allowOverMaxQuantity && quantityNum > maxQuantity) {\n      return\n    }\n\n    onConfirm(selectedDate, quantityNum)\n    setOpen(false)\n    // Reset after close\n    setSelectedDate(defaultDate)\n    setQuantity(defaultQuantity?.toString() || '')\n  }\n\n  const handleQuantityChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const value = e.target.value.replace(/[^0-9]/g, '')\n    setQuantity(value)\n  }\n\n  return (\n    <Popover open={open} onOpenChange={setOpen}>\n      <PopoverTrigger asChild disabled={disabled}>\n        {children}\n      </PopoverTrigger>\n      <PopoverContent \n        className=\"w-auto p-0 border-gray-200 shadow-lg\" \n        align={align}\n        side={side}\n        sideOffset={8}\n      >\n        <div className=\"bg-white business-radius-card p-3\">\n          <div className=\"mb-2 px-1\">\n            <div className=\"modal-label text-gray-600 text-center\">\n              {placeholder}\n            </div>\n          </div>\n          {hideQuantityInput && (\n            <div className=\"mb-2 px-1\">\n              <div className=\"text-[10px] text-gray-500 text-center leading-tight\">\n                <div> </div>\n                <div> </div>\n              </div>\n            </div>\n          )}\n          <Calendar\n            mode=\"single\"\n            selected={selectedDate}\n            onSelect={setSelectedDate}\n            locale={ko}\n            initialFocus\n            className=\"compact-calendar\"\n            disabled={false}\n            fromDate={new Date('2020-01-01')}\n            toDate={new Date('2030-12-31')}\n            defaultMonth={selectedDate || new Date()}\n            modifiers={{\n              today: new Date()\n            }}\n            modifiersClassNames={{\n              today: \"bg-blue-500 text-white font-semibold cursor-pointer hover:bg-blue-600 rounded-md\"\n            }}\n          />\n          {!hideQuantityInput && (\n            <div className=\"mt-3 px-1\">\n              <div className=\"flex items-center justify-between mb-1 gap-2\">\n                <label className=\"block text-xs font-medium text-gray-700\">\n                  {quantityInfoText?.includes('') ? '' : ''}\n                </label>\n                {maxQuantity !== undefined && (\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={handleFillRequestedQuantity}\n                    className=\"h-6 px-2 text-[10px] border-gray-200 text-hansl-600\"\n                  >\n                    {quantityInfoText?.includes('') ? '  ' : ' '}\n                  </Button>\n                )}\n              </div>\n              <Input\n                type=\"number\"\n                value={quantity}\n                onChange={handleQuantityChange}\n                placeholder=\" \"\n                className=\"border-gray-200 rounded-lg text-center w-full !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400\"\n                min=\"0\"\n                max={allowOverMaxQuantity ? undefined : maxQuantity}\n              />\n              {maxQuantity !== undefined && (\n                <p className=\"text-xs text-gray-500 mt-1\">\n                  {quantityInfoText?.includes('') ? quantityInfoText : `${allowOverMaxQuantity ? '' : ''}: ${maxQuantity.toLocaleString()}`}\n                </p>\n              )}\n            </div>\n          )}\n          <div className=\"mt-3 flex justify-end gap-2\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => setOpen(false)}\n              className=\"button-base\"\n            >\n              \n            </Button>\n            <Button\n              size=\"sm\"\n              onClick={handleConfirm}\n              disabled={!selectedDate || (!hideQuantityInput && (!quantity || parseFloat(quantity.replace(/,/g, '')) < 0 || (!allowOverMaxQuantity && maxQuantity !== undefined && parseFloat(quantity.replace(/,/g, '')) > maxQuantity)))}\n              className=\"button-base button-action-primary\"\n            >\n              \n            </Button>\n          </div>\n        </div>\n      </PopoverContent>\n    </Popover>\n  )\n}\n\n","import { useCallback } from 'react'\nimport { createClient } from '@/lib/supabase/client'\nimport { toast } from 'sonner'\nimport { logger } from '@/lib/logger'\nimport { markItemAsReceived, markItemAsReceiptCanceled, markItemAsStatementReceived, markItemAsStatementCanceled } from '@/stores/purchaseMemoryStore'\nimport { dateToISOString } from '@/utils/helpers'\n\nexport interface ConfirmDateActionConfig {\n  field: 'statement_received' | 'actual_received'\n  confirmMessage: {\n    confirm: string\n    cancel: string\n  }\n  successMessage: {\n    confirm: string\n    cancel: string\n  }\n  completedText: string\n  waitingText: string\n}\n\nexport interface UseConfirmDateActionProps {\n  config: ConfirmDateActionConfig\n  currentUserName: string | null\n  canPerformAction: boolean\n  purchaseId?: number | string  //     purchase ID\n  onUpdate?: () => void\n  onBeforeUpdate?: () => void  //      (Realtime    )\n  onOptimisticUpdate?: (params: {\n    itemId: number\n    selectedDate?: Date\n    action: 'confirm' | 'cancel'\n    receivedQuantity?: number\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n      received_quantity?: number\n    }\n  }) => void\n}\n\nexport function useConfirmDateAction({\n  config,\n  currentUserName,\n  canPerformAction,\n  purchaseId,\n  onUpdate,\n  onBeforeUpdate,\n  onOptimisticUpdate\n}: UseConfirmDateActionProps) {\n  const supabase = createClient()\n\n  const handleConfirm = useCallback(async (\n    itemId: number | string,\n    selectedDate: Date,\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n      received_quantity?: number\n    },\n    receivedQuantity?: number\n  ) => {\n    \n    if (!canPerformAction) {\n      logger.warn(`  `, { canPerformAction, currentUserName })\n      toast.error(`${config.field === 'statement_received' ? '' : ''}   .`)\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      logger.error('  ID', { itemId, numericId })\n      toast.error('   ID .')\n      return\n    }\n\n    //   \n    if (itemInfo) {\n      const confirmMessage = `: ${itemInfo.item_name || '-'}\n: ${itemInfo.specification || '-'}\n: ${itemInfo.quantity?.toLocaleString() || 0}\n: ${itemInfo.unit_price_value?.toLocaleString() || 0}\n: ${itemInfo.amount_value?.toLocaleString() || 0}\n: ${itemInfo.remark || '-'}\n\n${config.confirmMessage.confirm}`\n      \n      if (!window.confirm(confirmMessage)) {\n        return\n      }\n    }\n\n    //       (Realtime    )\n    onBeforeUpdate?.()\n\n    try {\n      let updateData: any\n\n      if (config.field === 'statement_received') {\n        updateData = {\n          is_statement_received: true,\n          statement_received_date: dateToISOString(selectedDate),\n          statement_received_by_name: currentUserName\n        }\n      } else if (config.field === 'actual_received') {\n        //   : receipt_history  \n        const requestedQuantity = itemInfo?.quantity || 0\n        const currentReceivedQuantity = itemInfo?.received_quantity || 0\n        const newReceivedQuantity = receivedQuantity !== undefined ? receivedQuantity : requestedQuantity\n        const totalReceivedQuantity = currentReceivedQuantity + newReceivedQuantity\n        \n        //      \n        const { data: existingItem } = await supabase\n          .from('purchase_request_items')\n          .select('receipt_history')\n          .eq('id', numericId)\n          .single()\n        \n        const existingHistory = (existingItem?.receipt_history as any[]) || []\n        const nextSeq = existingHistory.length + 1\n        \n        //    \n        const newHistoryItem = {\n          seq: nextSeq,\n          qty: newReceivedQuantity,\n          date: dateToISOString(selectedDate),\n          by: currentUserName || ''\n        }\n        \n        const updatedHistory = [...existingHistory, newHistoryItem]\n        \n        //    :   >=  \n        const isFullyReceived = totalReceivedQuantity >= requestedQuantity\n        \n        updateData = {\n          actual_received_date: dateToISOString(selectedDate),\n          is_received: isFullyReceived,\n          received_quantity: totalReceivedQuantity,\n          delivery_status: totalReceivedQuantity === 0 ? 'pending' : (isFullyReceived ? 'received' : 'partial'),\n          receipt_history: updatedHistory\n        }\n        \n        logger.debug('   :', {\n          requestedQuantity,\n          currentReceivedQuantity,\n          newReceivedQuantity,\n          totalReceivedQuantity,\n          isFullyReceived,\n          historyCount: updatedHistory.length\n        })\n      }\n\n      logger.debug('  :', updateData)\n\n      const { data, error } = await supabase\n        .from('purchase_request_items')\n        .update(updateData)\n        .eq('id', numericId)\n        .select()\n\n      logger.debug(' DB  :', { data, error })\n\n      if (error) {\n        logger.error(' DB  ', error)\n        throw error\n      }\n\n      logger.info(' DB  ', data)\n\n      //     \n      if (purchaseId) {\n        if (config.field === 'actual_received') {\n          const memoryUpdated = markItemAsReceived(purchaseId, numericId, dateToISOString(selectedDate), receivedQuantity)\n          if (!memoryUpdated) {\n            logger.warn('[useConfirmDateAction]     ', { \n              purchaseId, \n              itemId: numericId \n            })\n          }\n        } else if (config.field === 'statement_received') {\n          const memoryUpdated = markItemAsStatementReceived(purchaseId, numericId, dateToISOString(selectedDate), currentUserName || undefined)\n          if (!memoryUpdated) {\n            logger.warn('[useConfirmDateAction]      ', { \n              purchaseId, \n              itemId: numericId \n            })\n          }\n        }\n      }\n\n      if (onOptimisticUpdate) {\n        onOptimisticUpdate({\n          itemId: numericId,\n          selectedDate,\n          action: 'confirm',\n          receivedQuantity: receivedQuantity !== undefined ? receivedQuantity : itemInfo?.received_quantity,\n          itemInfo\n        })\n      }\n\n      //    onUpdate \n      if (onUpdate) {\n        onUpdate()\n      }\n      \n      toast.success(config.successMessage.confirm)\n    } catch (error) {\n      logger.error('   ', error)\n      toast.error(`${config.field === 'statement_received' ? '' : ''}     .`)\n    }\n  }, [config, currentUserName, canPerformAction, purchaseId, onUpdate, onBeforeUpdate, onOptimisticUpdate, supabase])\n\n  const handleCancel = useCallback(async (\n    itemId: number | string,\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n    }\n  ) => {\n    if (!canPerformAction) {\n      logger.warn(`   `, { canPerformAction, currentUserName })\n      toast.error(`${config.field === 'statement_received' ? '' : ''}   .`)\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      toast.error('   ID .')\n      return\n    }\n\n    //   \n    if (itemInfo) {\n      const confirmMessage = `: ${itemInfo.item_name || '-'}\n: ${itemInfo.specification || '-'}\n: ${itemInfo.quantity?.toLocaleString() || 0}\n: ${itemInfo.unit_price_value?.toLocaleString() || 0}\n: ${itemInfo.amount_value?.toLocaleString() || 0}\n: ${itemInfo.remark || '-'}\n\n${config.confirmMessage.cancel}`\n      \n      if (!window.confirm(confirmMessage)) {\n        return\n      }\n    }\n\n    //       (Realtime    )\n    onBeforeUpdate?.()\n\n    try {\n      logger.debug(` ${config.field}   `, { \n        itemId, \n        itemName: itemInfo?.item_name \n      })\n\n      let updateData: any\n\n      if (config.field === 'statement_received') {\n        updateData = {\n          is_statement_received: false,\n          statement_received_date: null,\n          statement_received_by_name: null\n        }\n      } else if (config.field === 'actual_received') {\n        //   : receipt_history  \n        updateData = {\n          actual_received_date: null,\n          is_received: false,\n          received_quantity: 0,\n          delivery_status: 'pending',\n          receipt_history: []\n        }\n      }\n\n      logger.debug('   :', updateData)\n\n      const { data, error } = await supabase\n        .from('purchase_request_items')\n        .update(updateData)\n        .eq('id', numericId)\n        .select()\n\n      logger.debug('  DB  :', { data, error })\n\n      if (error) {\n        logger.error(' DB  ', error)\n        throw error\n      }\n\n      logger.info(` ${config.field}   `, data)\n\n      //     \n      if (purchaseId) {\n        if (config.field === 'actual_received') {\n          const memoryUpdated = markItemAsReceiptCanceled(purchaseId, numericId)\n          if (!memoryUpdated) {\n            logger.warn('[useConfirmDateAction]     ', { \n              purchaseId, \n              itemId: numericId \n            })\n          }\n        } else if (config.field === 'statement_received') {\n          const memoryUpdated = markItemAsStatementCanceled(purchaseId, numericId)\n          if (!memoryUpdated) {\n            logger.warn('[useConfirmDateAction]      ', { \n              purchaseId, \n              itemId: numericId \n            })\n          }\n        }\n      }\n\n      if (onOptimisticUpdate) {\n        onOptimisticUpdate({\n          itemId: numericId,\n          action: 'cancel',\n          itemInfo\n        })\n      }\n\n      //    onUpdate \n      if (onUpdate) {\n        onUpdate()\n      }\n      \n      toast.success(config.successMessage.cancel)\n    } catch (error) {\n      logger.error(` ${config.field}   `, error)\n      toast.error(`${config.field === 'statement_received' ? '' : ''}     .`)\n    }\n  }, [config, canPerformAction, purchaseId, onUpdate, onBeforeUpdate, onOptimisticUpdate, supabase])\n\n  const isCompleted = useCallback((item: any) => {\n    if (config.field === 'statement_received') {\n      return item.is_statement_received\n    } else if (config.field === 'actual_received') {\n      return item.is_received // actual_received_date  is_received  \n    }\n    return false\n  }, [config.field])\n\n  //     ( )\n  const isPartiallyReceived = useCallback((item: any) => {\n    if (config.field === 'actual_received') {\n      const receivedQty = item.received_quantity || 0\n      const requestedQty = item.quantity || 0\n      return receivedQty > 0 && receivedQty < requestedQty\n    }\n    return false\n  }, [config.field])\n\n  //   \n  const getRemainingQuantity = useCallback((item: any) => {\n    const receivedQty = item.received_quantity || 0\n    const requestedQty = item.quantity || 0\n    return Math.max(0, requestedQty - receivedQty)\n  }, [])\n\n  const getCompletedDate = useCallback((item: any) => {\n    if (config.field === 'statement_received') {\n      return item.statement_received_date\n    } else if (config.field === 'actual_received') {\n      return item.actual_received_date\n    }\n    return null\n  }, [config.field])\n\n  const getCompletedByName = useCallback((item: any) => {\n    if (config.field === 'statement_received') {\n      return item.statement_received_by_name\n    } else if (config.field === 'actual_received') {\n      //     \n      return null\n    }\n    return null\n  }, [config.field])\n\n  return {\n    config,\n    handleConfirm,\n    handleCancel,\n    isCompleted,\n    isPartiallyReceived,\n    getRemainingQuantity,\n    getCompletedDate,\n    getCompletedByName\n  }\n}","import { ColumnInfo, DoneTabColumnId, ColumnVisibility } from '@/types/columnSettings';\n\n/**\n *     \n * 22     \n */\n\n//     ( )\nexport const DONE_TAB_COLUMNS: ColumnInfo[] = [\n  {\n    id: 'statement_progress',\n    label: '',\n    description: '  ',\n    defaultVisible: true,\n  },\n  {\n    id: 'purchase_order_number',\n    label: '',\n    description: ' ',\n    defaultVisible: true,\n  },\n  {\n    id: 'payment_category',\n    label: '',\n    description: '  (, ,  )',\n    defaultVisible: true,\n  },\n  {\n    id: 'requester_name',\n    label: '',\n    description: '  ',\n    defaultVisible: true,\n  },\n  {\n    id: 'request_date',\n    label: '',\n    description: '  ',\n    defaultVisible: true,\n  },\n  {\n    id: 'utk_status',\n    label: 'UTK',\n    description: 'UTK  ',\n    defaultVisible: true,\n  },\n  {\n    id: 'vendor_name',\n    label: '',\n    description: '',\n    defaultVisible: true,\n  },\n  {\n    id: 'contact_name',\n    label: '',\n    description: ' ',\n    defaultVisible: true,\n  },\n  {\n    id: 'delivery_request_date',\n    label: '',\n    description: '  ',\n    defaultVisible: true,\n  },\n  {\n    id: 'revised_delivery_date',\n    label: '',\n    description: '  ',\n    defaultVisible: true,\n  },\n  {\n    id: 'item_name',\n    label: '',\n    description: ' ',\n    defaultVisible: true,\n  },\n  {\n    id: 'specification',\n    label: '',\n    description: '  ',\n    defaultVisible: true,\n  },\n  {\n    id: 'quantity',\n    label: '',\n    description: ' ',\n    defaultVisible: true,\n  },\n  {\n    id: 'unit_price',\n    label: '',\n    description: ' ',\n    defaultVisible: true,\n  },\n  {\n    id: 'amount',\n    label: '',\n    description: ' ',\n    defaultVisible: true,\n  },\n  {\n    id: 'remark',\n    label: '',\n    description: '  ',\n    defaultVisible: true,\n  },\n  {\n    id: 'link',\n    label: '',\n    description: ' ',\n    defaultVisible: true,\n  },\n  {\n    id: 'project_vendor',\n    label: 'PJ',\n    description: ' ',\n    defaultVisible: true,\n  },\n  {\n    id: 'project_item',\n    label: 'PJ ITEM',\n    description: ' ',\n    defaultVisible: true,\n  },\n  {\n    id: 'sales_order_number',\n    label: '',\n    description: ' ',\n    defaultVisible: true,\n  },\n  {\n    id: 'purchase_progress',\n    label: '',\n    description: ' ',\n    defaultVisible: true,\n  },\n  {\n    id: 'receipt_progress',\n    label: '',\n    description: ' ',\n    defaultVisible: true,\n  },\n];\n\n//     (  )\nexport const DEFAULT_COLUMN_VISIBILITY: ColumnVisibility = DONE_TAB_COLUMNS.reduce(\n  (acc, column) => {\n    acc[column.id] = column.defaultVisible;\n    return acc;\n  },\n  {} as ColumnVisibility\n);\n\n//  ID    \nexport const COLUMN_INFO_MAP: Record<DoneTabColumnId, ColumnInfo> = DONE_TAB_COLUMNS.reduce(\n  (acc, column) => {\n    acc[column.id] = column;\n    return acc;\n  },\n  {} as Record<DoneTabColumnId, ColumnInfo>\n);\n\n//   (   )\nexport const REQUIRED_COLUMNS: DoneTabColumnId[] = [\n  'purchase_order_number',\n  'vendor_name',\n  'item_name',\n  'specification',\n];\n\n//    (     )\nexport const RESTRICTED_COLUMNS: DoneTabColumnId[] = [\n  'statement_progress',  // \n  'utk_status',         // UTK\n  'unit_price',         // \n  'amount',            // ( )\n];\n\n//   \nexport const AUTHORIZED_ROLES = [\n  'app_admin',\n  'ceo',\n  'final_approver',\n  'purchase_manager',\n  'lead buyer',\n  'accounting',\n];\n\n// UTK (/)  - PurchaseDetailModal \nexport const UTK_AUTHORIZED_ROLES = [\n  'app_admin',\n  'lead buyer',\n  'accounting',\n];\n\n//   ( UI )\nexport const COLUMN_GROUPS = [\n  {\n    title: ' ',\n    columns: [\n      'statement_progress',\n      'purchase_order_number',\n      'payment_category',\n      'requester_name',\n      'request_date',\n      'utk_status',\n    ] as DoneTabColumnId[],\n  },\n  {\n    title: ' ',\n    columns: [\n      'vendor_name',\n      'contact_name',\n      'delivery_request_date',\n      'revised_delivery_date',\n    ] as DoneTabColumnId[],\n  },\n  {\n    title: ' ',\n    columns: [\n      'item_name',\n      'specification',\n      'quantity',\n      'unit_price',\n      'amount',\n      'remark',\n      'link',\n    ] as DoneTabColumnId[],\n  },\n  {\n    title: ' ',\n    columns: [\n      'project_vendor',\n      'project_item',\n      'sales_order_number',\n    ] as DoneTabColumnId[],\n  },\n  {\n    title: ' ',\n    columns: [\n      'purchase_progress',\n      'receipt_progress',\n    ] as DoneTabColumnId[],\n  },\n] as const;","/**\n *     \n */\n\n//  \nexport type TransactionStatementStatus = \n  | 'pending'     // ,  \n  | 'processing'  // OCR  \n  | 'extracted'   //  ,  \n  | 'confirmed'   // \n  | 'rejected';   // \n\n//  \nexport type MatchConfidence = 'low' | 'med' | 'high';\n\n//  \nexport type MatchMethod = 'po_number' | 'item_similarity' | 'manual';\n\n//   \nexport interface TransactionStatement {\n  id: string;\n  image_url: string;\n  file_name?: string;\n  uploaded_at: string;\n  uploaded_by?: string;\n  uploaded_by_name?: string;\n  status: TransactionStatementStatus;\n  confirmed_at?: string;\n  confirmed_by?: string;\n  confirmed_by_name?: string;\n  statement_date?: string;\n  vendor_name?: string;\n  total_amount?: number;\n  tax_amount?: number;\n  grand_total?: number;\n  extracted_data?: ExtractedData;\n  extraction_error?: string;\n  created_at: string;\n  updated_at: string;\n  //        ID ( )\n  matched_purchase_id?: number | null;\n  //        (  )\n  matched_purchases?: Array<{\n    purchase_id: number;\n    purchase_order_number: string;\n    sales_order_number?: string;\n  }>;\n}\n\n//   \nexport interface TransactionStatementItem {\n  id: string;\n  statement_id: string;\n  line_number?: number;\n  extracted_item_name?: string;\n  extracted_specification?: string;\n  extracted_quantity?: number;\n  extracted_unit_price?: number;\n  extracted_amount?: number;\n  extracted_tax_amount?: number;\n  extracted_po_number?: string;\n  extracted_remark?: string;\n  \n  //  \n  matched_purchase_id?: number;\n  matched_item_id?: number;\n  match_confidence?: MatchConfidence;\n  match_method?: MatchMethod;\n  \n  //  \n  is_additional_item: boolean;\n  parent_item_id?: string;\n  \n  //  \n  is_confirmed: boolean;\n  confirmed_unit_price?: number;\n  confirmed_amount?: number;\n  confirmed_quantity?: number;\n  \n  created_at: string;\n  updated_at: string;\n}\n\n// OCR   \nexport interface OCRCorrection {\n  id: string;\n  statement_id?: string;\n  statement_item_id?: string;\n  original_text: string;\n  corrected_text: string;\n  field_type: OCRFieldType;\n  corrected_by?: string;\n  corrected_by_name?: string;\n  created_at: string;\n}\n\nexport type OCRFieldType = \n  | 'po_number' \n  | 'item_name' \n  | 'quantity' \n  | 'unit_price' \n  | 'amount' \n  | 'date' \n  | 'vendor_name' \n  | 'remark';\n\n// OCR/LLM   \nexport interface ExtractedItem {\n  line_number: number;\n  item_name: string;\n  specification?: string;\n  quantity: number;\n  unit_price: number;\n  amount: number;\n  tax_amount?: number;\n  po_number?: string;\n  remark?: string;\n  confidence: MatchConfidence;\n}\n\nexport interface ExtractedData {\n  statement_date?: string;\n  vendor_name?: string;\n  total_amount?: number;\n  tax_amount?: number;\n  grand_total?: number;\n  items: ExtractedItem[];\n  raw_vision_text?: string;\n}\n\n//    \nexport interface MatchCandidate {\n  purchase_id: number;\n  purchase_order_number: string;\n  sales_order_number?: string;\n  item_id: number;\n  item_name: string;\n  specification?: string;\n  quantity: number;\n  unit_price?: number;\n  vendor_name?: string;\n  score: number; //   (0-100)\n  match_reasons: string[]; //  \n}\n\n//   ( )\nexport interface TransactionStatementWithItems extends TransactionStatement {\n  items: TransactionStatementItemWithMatch[];\n}\n\n//  +  \nexport interface TransactionStatementItemWithMatch extends TransactionStatementItem {\n  match_candidates?: MatchCandidate[];\n  matched_purchase?: {\n    id: number;\n    purchase_order_number: string;\n    sales_order_number?: string;\n    vendor_name?: string;\n  };\n  matched_item?: {\n    id: number;\n    item_name: string;\n    specification?: string;\n    quantity: number;\n    unit_price_value?: number;\n  };\n}\n\n//   \nexport interface UploadStatementRequest {\n  file: File;\n}\n\n//   \nexport interface UploadStatementResponse {\n  statementId: string;\n  imageUrl: string;\n}\n\n// OCR   \nexport interface ExtractStatementRequest {\n  statementId: string;\n  imageUrl: string;\n}\n\n//   \nexport interface ConfirmStatementRequest {\n  statementId: string;\n  items: ConfirmItemRequest[];\n}\n\nexport interface ConfirmItemRequest {\n  itemId: string;\n  matched_purchase_id?: number;\n  matched_item_id?: number;\n  confirmed_quantity?: number;\n  confirmed_unit_price?: number;\n  confirmed_amount?: number;\n  is_additional_item?: boolean;\n  parent_item_id?: string;\n}\n\n//    \nexport interface SaveCorrectionRequest {\n  statement_id?: string;\n  statement_item_id?: string;\n  original_text: string;\n  corrected_text: string;\n  field_type: OCRFieldType;\n}\n\n// / \n// : F + YYYYMMDD + _ + 3  (: F20251008_001, F20251008_002)\nexport const PO_NUMBER_PATTERN = /^F\\d{8}_\\d{3}$/;\n// : HS + YYMMDD + - + 2  (: HS251201-01, HS251201-11)\nexport const SO_NUMBER_PATTERN = /^HS\\d{6}-\\d{2}$/;\n\n// OCR     \nexport function normalizeOrderNumber(input: string): string {\n  if (!input) return input;\n  \n  const normalized = input.toUpperCase().replace(/\\s+/g, '');\n  \n  //  : F20251008_1  F20251008-01  F20251008_001\n  const poMatch = normalized.match(/^(F\\d{8})[_-](\\d{1,3})$/);\n  if (poMatch) {\n    const [, prefix, num] = poMatch;\n    return `${prefix}_${num.padStart(3, '0')}`;\n  }\n  \n  //  : HS251201-1  HS251201-01\n  const soMatch = normalized.match(/^(HS\\d{6})-(\\d{1,2})$/);\n  if (soMatch) {\n    const [, prefix, num] = soMatch;\n    return `${prefix}-${num.padStart(2, '0')}`;\n  }\n  \n  return normalized;\n}\n\n//   \nexport function isValidPoNumber(value: string): boolean {\n  return PO_NUMBER_PATTERN.test(value.toUpperCase());\n}\n\nexport function isValidSoNumber(value: string): boolean {\n  return SO_NUMBER_PATTERN.test(value.toUpperCase());\n}\n\nexport function isValidOrderNumber(value: string): boolean {\n  return isValidPoNumber(value) || isValidSoNumber(value);\n}\n\n//   \nexport function extractDateFromOrderNumber(orderNumber: string): string | null {\n  const match = orderNumber.match(/\\d{8}/);\n  if (!match) return null;\n  \n  const dateStr = match[0];\n  const year = dateStr.substring(0, 4);\n  const month = dateStr.substring(4, 6);\n  const day = dateStr.substring(6, 8);\n  \n  return `${year}-${month}-${day}`;\n}\n\n","/**\n *    \n * -  \n * - OCR/LLM  (Edge Function )\n * -  \n * -   \n * -   \n */\n\nimport { createClient } from \"@/lib/supabase/client\";\nimport type {\n  TransactionStatement,\n  TransactionStatementItem,\n  TransactionStatementWithItems,\n  TransactionStatementItemWithMatch,\n  MatchCandidate,\n  OCRCorrection,\n  ConfirmStatementRequest,\n  SaveCorrectionRequest\n} from \"@/types/transactionStatement\";\nimport { normalizeOrderNumber } from \"@/types/transactionStatement\";\n\nclass TransactionStatementService {\n  private supabase;\n\n  constructor() {\n    this.supabase = createClient();\n  }\n\n  /**\n   *   \n   */\n  async uploadStatement(\n    file: File,\n    uploaderName: string\n  ): Promise<{ success: boolean; data?: { statementId: string; imageUrl: string }; error?: string }> {\n    try {\n      //   \n      const ext = file.name.split('.').pop()?.toLowerCase() || 'png';\n      const uuid = crypto.randomUUID();\n      const fileName = `${uuid}.${ext}`;\n      const storagePath = `Transaction Statement/${fileName}`;\n\n      // Storage \n      const { data: uploadData, error: uploadError } = await this.supabase\n        .storage\n        .from('receipt-images')\n        .upload(storagePath, file, {\n          contentType: file.type,\n          upsert: false\n        });\n\n      if (uploadError) throw uploadError;\n\n      // Public URL \n      const { data: urlData } = this.supabase\n        .storage\n        .from('receipt-images')\n        .getPublicUrl(storagePath);\n\n      const imageUrl = urlData.publicUrl;\n\n      //   \n      const { data: { user } } = await this.supabase.auth.getUser();\n\n      // DB  \n      console.log('[Upload] DB   :', { imageUrl, fileName: file.name, userId: user?.id, uploaderName });\n      \n      const { data: statement, error: dbError } = await this.supabase\n        .from('transaction_statements')\n        .insert({\n          image_url: imageUrl,\n          file_name: file.name,\n          uploaded_by: user?.id,\n          uploaded_by_name: uploaderName,\n          status: 'pending'\n        })\n        .select()\n        .single();\n      \n\n      if (dbError) {\n        console.error('[Upload] DB insert :', dbError);\n        throw new Error(`DB  : ${dbError.message} (code: ${dbError.code})`);\n      }\n      \n      console.log('[Upload] DB   :', { statementId: statement.id });\n\n      return {\n        success: true,\n        data: {\n          statementId: statement.id,\n          imageUrl\n        }\n      };\n    } catch (error) {\n      console.error('Upload statement error:', error);\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : '   .'\n      };\n    }\n  }\n\n  /**\n   * OCR/LLM   (Edge Function )\n   */\n  async extractStatementData(\n    statementId: string,\n    imageUrl: string\n  ): Promise<{ success: boolean; data?: TransactionStatementWithItems; error?: string }> {\n    try {\n      console.log('[Service] Calling Edge Function with:', { statementId, imageUrl });\n      \n      // OCR    processing \n      await this.supabase\n        .from('transaction_statements')\n        .update({ status: 'processing' })\n        .eq('id', statementId);\n      \n      // Edge Function \n      const { data, error } = await this.supabase.functions.invoke('ocr-transaction-statement', {\n        body: {\n          statementId,\n          imageUrl\n        }\n      });\n\n      console.log('[Service] Edge Function response:', { data, error });\n\n      if (error) throw error;\n\n      if (!data.success) {\n        throw new Error(data.error || 'OCR  ');\n      }\n\n      //   \n      console.log('[Service]   :', { \n        vendor_name: data.vendor_name, \n        vendor_match_source: data.vendor_match_source \n      });\n\n      //   \n      const result = await this.getStatementWithItems(statementId);\n      return result;\n    } catch (error) {\n      console.error('[Service] Extract statement error:', error);\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : 'OCR    .'\n      };\n    }\n  }\n\n  /**\n   *   \n   */\n  async getStatements(filters?: {\n    status?: string;\n    dateFrom?: string;\n    dateTo?: string;\n    search?: string;\n    limit?: number;\n    offset?: number;\n  }): Promise<{ success: boolean; data?: TransactionStatement[]; count?: number; error?: string }> {\n    try {\n      // items  purchase_id  \n      let query = this.supabase\n        .from('transaction_statements')\n        .select(`\n          *,\n          items:transaction_statement_items(matched_purchase_id)\n        `, { count: 'exact' })\n        .order('uploaded_at', { ascending: false });\n\n      if (filters?.status && filters.status !== 'all') {\n        query = query.eq('status', filters.status);\n      }\n\n      if (filters?.dateFrom) {\n        query = query.gte('uploaded_at', filters.dateFrom);\n      }\n\n      if (filters?.dateTo) {\n        query = query.lte('uploaded_at', filters.dateTo + 'T23:59:59');\n      }\n\n      if (filters?.search) {\n        query = query.or(`vendor_name.ilike.%${filters.search}%,file_name.ilike.%${filters.search}%`);\n      }\n\n      if (filters?.limit) {\n        query = query.limit(filters.limit);\n      }\n\n      if (filters?.offset) {\n        query = query.range(filters.offset, filters.offset + (filters.limit || 20) - 1);\n      }\n\n      const { data, count, error } = await query;\n\n      if (error) throw error;\n\n      //  purchase_id \n      const allPurchaseIds = new Set<number>();\n      (data || []).forEach((statement: any) => {\n        statement.items?.forEach((item: any) => {\n          if (item.matched_purchase_id) {\n            allPurchaseIds.add(item.matched_purchase_id);\n          }\n        });\n      });\n\n      //    (, )\n      const purchaseInfoMap = new Map<number, { purchase_order_number: string; sales_order_number?: string }>();\n      if (allPurchaseIds.size > 0) {\n        const { data: purchases } = await this.supabase\n          .from('purchase_requests')\n          .select('id, purchase_order_number, sales_order_number')\n          .in('id', Array.from(allPurchaseIds));\n        \n        purchases?.forEach((p: any) => {\n          purchaseInfoMap.set(p.id, {\n            purchase_order_number: p.purchase_order_number,\n            sales_order_number: p.sales_order_number\n          });\n        });\n      }\n\n      //      \n      const statementsWithPurchases = (data || []).map((statement: any) => {\n        const purchaseIds = new Set<number>();\n        statement.items?.forEach((item: any) => {\n          if (item.matched_purchase_id) {\n            purchaseIds.add(item.matched_purchase_id);\n          }\n        });\n\n        const matchedPurchases = Array.from(purchaseIds).map(purchaseId => {\n          const info = purchaseInfoMap.get(purchaseId);\n          return {\n            purchase_id: purchaseId,\n            purchase_order_number: info?.purchase_order_number || '',\n            sales_order_number: info?.sales_order_number\n          };\n        });\n\n        const { items, ...rest } = statement;\n        return {\n          ...rest,\n          matched_purchase_id: matchedPurchases[0]?.purchase_id || null, //  \n          matched_purchases: matchedPurchases\n        };\n      });\n\n      return { success: true, data: statementsWithPurchases, count: count || 0 };\n    } catch (error) {\n      console.error('Get statements error:', error);\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : '   .'\n      };\n    }\n  }\n\n  /**\n   *    ( )\n   */\n  async getStatementWithItems(\n    statementId: string\n  ): Promise<{ success: boolean; data?: TransactionStatementWithItems; error?: string }> {\n    try {\n      //  \n      const { data: statement, error: stmtError } = await this.supabase\n        .from('transaction_statements')\n        .select('*')\n        .eq('id', statementId)\n        .single();\n\n      if (stmtError) throw stmtError;\n\n      //  \n      const { data: items, error: itemsError } = await this.supabase\n        .from('transaction_statement_items')\n        .select('*')\n        .eq('statement_id', statementId)\n        .order('line_number', { ascending: true });\n\n      if (itemsError) throw itemsError;\n\n      //     (  )\n      const statementVendorName = statement.vendor_name || '';\n      const itemsWithMatch: TransactionStatementItemWithMatch[] = await Promise.all(\n        (items || []).map(async (item: TransactionStatementItem) => {\n          const matchCandidates = await this.findMatchCandidates(item, statementVendorName);\n          \n          //  / \n          let matchedPurchase = undefined;\n          let matchedItem = undefined;\n          \n          if (item.matched_purchase_id) {\n            const { data: purchase } = await this.supabase\n              .from('purchase_requests')\n              .select('id, purchase_order_number, sales_order_number, vendor:vendors(vendor_name)')\n              .eq('id', item.matched_purchase_id)\n              .single();\n            \n            if (purchase) {\n              matchedPurchase = {\n                id: purchase.id,\n                purchase_order_number: purchase.purchase_order_number || '',\n                sales_order_number: purchase.sales_order_number,\n                vendor_name: purchase.vendor?.vendor_name\n              };\n            }\n          }\n\n          if (item.matched_item_id) {\n            const { data: purchaseItem } = await this.supabase\n              .from('purchase_request_items')\n              .select('id, item_name, specification, quantity, unit_price_value')\n              .eq('id', item.matched_item_id)\n              .single();\n            \n            if (purchaseItem) {\n              matchedItem = {\n                id: purchaseItem.id,\n                item_name: purchaseItem.item_name,\n                specification: purchaseItem.specification,\n                quantity: purchaseItem.quantity,\n                unit_price_value: purchaseItem.unit_price_value\n              };\n            }\n          }\n\n          return {\n            ...item,\n            match_candidates: matchCandidates,\n            matched_purchase: matchedPurchase,\n            matched_item: matchedItem\n          };\n        })\n      );\n\n      return {\n        success: true,\n        data: {\n          ...statement,\n          items: itemsWithMatch\n        }\n      };\n    } catch (error) {\n      console.error('Get statement with items error:', error);\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : '   .'\n      };\n    }\n  }\n\n  /**\n   *    \n   * -   :  +  +   \n   * -   +   \n   * -  /   ( )\n   */\n  async findMatchCandidates(item: TransactionStatementItem, statementVendorName?: string): Promise<MatchCandidate[]> {\n    const candidateMap = new Map<string, MatchCandidate>(); //  \n\n    try {\n      const rawNumber = item.extracted_po_number || '';\n      const normalizedNumber = rawNumber ? normalizeOrderNumber(rawNumber) : '';\n      \n      //     (F20251212  HS251212 -   )\n      const partialPOMatch = rawNumber.toUpperCase().match(/^(F)(\\d{8})$/);\n      const partialSOMatch = rawNumber.toUpperCase().match(/^(HS)(\\d{6})$/);\n      const isPartialNumber = !!(partialPOMatch || partialSOMatch);\n      const datePrefix = partialPOMatch ? `F${partialPOMatch[2]}` : (partialSOMatch ? `HS${partialSOMatch[2]}` : '');\n\n      // 1. PO/SO   \n      if (normalizedNumber) {\n        const { data: byNumber } = await this.supabase\n          .from('purchase_requests')\n          .select(`\n            id, \n            purchase_order_number, \n            sales_order_number,\n            vendor:vendors(vendor_name),\n            items:purchase_request_items(id, item_name, specification, quantity, unit_price_value)\n          `)\n          .or(`purchase_order_number.eq.${normalizedNumber},sales_order_number.eq.${normalizedNumber}`)\n          .limit(10);\n\n        if (byNumber) {\n          for (const purchase of byNumber) {\n            //    (     )\n            const sysVendorName = purchase.vendor?.vendor_name || '';\n            const vendorSimilarity = statementVendorName \n              ? this.calculateVendorSimilarity(statementVendorName, sysVendorName)\n              : 100; //    \n            \n            //   70%   (   )\n            if (vendorSimilarity < 50) {\n              console.log(`   : \"${statementVendorName}\" vs \"${sysVendorName}\" (${vendorSimilarity}%)`);\n              continue;\n            }\n\n            for (const purchaseItem of purchase.items || []) {\n              const key = `${purchase.id}-${purchaseItem.id}`;\n              const matchReasons = ['/ '];\n              let score = 50; //    \n              \n              //   \n              if (vendorSimilarity >= 90) {\n                score += 10;\n                matchReasons.push(' ');\n              } else if (vendorSimilarity >= 70) {\n                score += 5;\n                matchReasons.push(' ');\n              }\n              \n              //  OR    \n              if (item.extracted_item_name) {\n                const itemMatch = this.calculateItemMatchScore(\n                  item.extracted_item_name, \n                  purchaseItem.item_name, \n                  purchaseItem.specification\n                );\n                score += itemMatch.score * 0.3; //  +30\n                if (itemMatch.score >= 80) {\n                  matchReasons.push(itemMatch.matchedField === 'specification' ? ' ' : ' ');\n                }\n              }\n              \n              //  :  ,    \n              if (item.extracted_quantity && purchaseItem.quantity) {\n                if (item.extracted_quantity === purchaseItem.quantity) {\n                  score += 15;\n                  matchReasons.push(`  (${item.extracted_quantity})`);\n                } else if (item.extracted_quantity <= purchaseItem.quantity) {\n                  score += 5;\n                  matchReasons.push(` (:${purchaseItem.quantity}, :${item.extracted_quantity})`);\n                }\n              }\n              \n              candidateMap.set(key, {\n                purchase_id: purchase.id,\n                purchase_order_number: purchase.purchase_order_number || '',\n                sales_order_number: purchase.sales_order_number,\n                item_id: purchaseItem.id,\n                item_name: purchaseItem.item_name,\n                specification: purchaseItem.specification,\n                quantity: purchaseItem.quantity,\n                unit_price: purchaseItem.unit_price_value,\n                vendor_name: sysVendorName,\n                score,\n                match_reasons: matchReasons\n              });\n            }\n          }\n        }\n      }\n\n      // 1.5.    (F20251212  HS251212 -      )\n      if (isPartialNumber && datePrefix && candidateMap.size === 0) {\n        console.log(`   : \"${datePrefix}%\" (   )`);\n        \n        const { data: byDatePrefix } = await this.supabase\n          .from('purchase_requests')\n          .select(`\n            id, \n            purchase_order_number, \n            sales_order_number,\n            vendor:vendors(vendor_name),\n            items:purchase_request_items(id, item_name, specification, quantity, unit_price_value)\n          `)\n          .or(`purchase_order_number.ilike.${datePrefix}%,sales_order_number.ilike.${datePrefix}%`)\n          .limit(20);\n\n        if (byDatePrefix) {\n          for (const purchase of byDatePrefix) {\n            const sysVendorName = purchase.vendor?.vendor_name || '';\n            const vendorSimilarity = statementVendorName \n              ? this.calculateVendorSimilarity(statementVendorName, sysVendorName)\n              : 100;\n            \n            //   70%  \n            if (vendorSimilarity < 50) {\n              continue;\n            }\n\n            for (const purchaseItem of purchase.items || []) {\n              const key = `${purchase.id}-${purchaseItem.id}`;\n              if (candidateMap.has(key)) continue;\n\n              const matchReasons = [`  (${datePrefix})`];\n              let score = 30; //    \n              \n              //   \n              if (vendorSimilarity >= 90) {\n                score += 20;\n                matchReasons.push(' ');\n              } else if (vendorSimilarity >= 70) {\n                score += 10;\n                matchReasons.push(' ');\n              }\n              \n              //  OR    \n              if (item.extracted_item_name) {\n                const itemMatch = this.calculateItemMatchScore(\n                  item.extracted_item_name, \n                  purchaseItem.item_name, \n                  purchaseItem.specification\n                );\n                score += itemMatch.score * 0.4; //  +40\n                if (itemMatch.score >= 80) {\n                  matchReasons.push(itemMatch.matchedField === 'specification' ? ' ' : ' ');\n                } else if (itemMatch.score >= 50) {\n                  matchReasons.push(itemMatch.matchedField === 'specification' ? ' ' : ' ');\n                }\n              }\n              \n              //  :  ,    \n              if (item.extracted_quantity && purchaseItem.quantity) {\n                if (item.extracted_quantity === purchaseItem.quantity) {\n                  score += 15;\n                  matchReasons.push(`  (${item.extracted_quantity})`);\n                } else if (item.extracted_quantity <= purchaseItem.quantity) {\n                  score += 5;\n                  matchReasons.push(` (:${purchaseItem.quantity}, :${item.extracted_quantity})`);\n                }\n              }\n              \n              candidateMap.set(key, {\n                purchase_id: purchase.id,\n                purchase_order_number: purchase.purchase_order_number || '',\n                sales_order_number: purchase.sales_order_number,\n                item_id: purchaseItem.id,\n                item_name: purchaseItem.item_name,\n                specification: purchaseItem.specification,\n                quantity: purchaseItem.quantity,\n                unit_price: purchaseItem.unit_price_value,\n                vendor_name: sysVendorName,\n                score,\n                match_reasons: matchReasons\n              });\n            }\n          }\n        }\n      }\n\n      // 2. +   (  ) - item_name AND specification  \n      if (item.extracted_item_name) {\n        const itemName = item.extracted_item_name.trim();\n        \n        //    (  )\n        const searchTermCandidates = [\n          itemName,                                              // \n          itemName.substring(0, Math.min(itemName.length, 12)),  // 12\n          itemName.substring(0, Math.min(itemName.length, 8)),   // 8\n          itemName.split(/\\[|]|\\s|_|-/)[0]                        //   ( )\n        ].filter(t => t && t.length >= 3);\n        \n        //  \n        const uniqueSearchTerms = [...new Set(searchTermCandidates)];\n        console.log(`   : ${uniqueSearchTerms.join(', ')}`);\n        \n        //     (  )\n        for (const searchTerm of uniqueSearchTerms) {\n          const { data: byNameOrSpec } = await this.supabase\n            .from('purchase_request_items')\n            .select(`\n              id, \n              item_name, \n              specification, \n              quantity, \n              unit_price_value,\n              purchase:purchase_requests!inner(\n                id, \n                purchase_order_number, \n                sales_order_number,\n                vendor:vendors(vendor_name)\n              )\n            `)\n            .or(`item_name.ilike.%${searchTerm}%,specification.ilike.%${searchTerm}%`)\n            .limit(50);\n          \n          if (byNameOrSpec && byNameOrSpec.length > 0) {\n            console.log(`  \"${searchTerm}\" ${byNameOrSpec.length}  `);\n            \n            for (const purchaseItem of byNameOrSpec) {\n              const key = `${purchaseItem.purchase?.id}-${purchaseItem.id}`;\n              \n              //      \n              if (candidateMap.has(key)) continue;\n              \n              //    -    \n              const sysVendorName = purchaseItem.purchase?.vendor?.vendor_name || '';\n              const vendorSimilarity = statementVendorName \n                ? this.calculateVendorSimilarity(statementVendorName, sysVendorName)\n                : 100; //    \n              \n              console.log(`  : OCR=\"${statementVendorName}\" vs =\"${sysVendorName}\"  =${vendorSimilarity}%`);\n              \n              //   50%   (  -   )\n              if (vendorSimilarity < 50) {\n                console.log(`   ${vendorSimilarity}% < 50% `);\n                continue;\n              }\n              \n              const matchReasons: string[] = [];\n              let score = 0;\n              \n              //    ( )\n              if (vendorSimilarity >= 90) {\n                score += 20;\n                matchReasons.push(' ');\n              } else if (vendorSimilarity >= 70) {\n                score += 10;\n                matchReasons.push(' ');\n              }\n              \n              //  OR    -   \n              const itemMatch = this.calculateItemMatchScore(\n                item.extracted_item_name, \n                purchaseItem.item_name, \n                purchaseItem.specification\n              );\n              if (itemMatch.score >= 40) { // 40%    ( )\n                score += itemMatch.score * 0.7; //  70 ( )\n                if (itemMatch.score >= 85) {\n                  matchReasons.push(itemMatch.matchedField === 'specification' ? ' ' : ' ');\n                } else if (itemMatch.score >= 50) {\n                  matchReasons.push(itemMatch.matchedField === 'specification' ? ' ' : ' ');\n                } else {\n                  matchReasons.push(' ');\n                }\n              }\n              \n              //  :  ,     (  )\n              if (item.extracted_quantity && purchaseItem.quantity) {\n                if (item.extracted_quantity === purchaseItem.quantity) {\n                  score += 15; //   \n                  matchReasons.push(`  (${item.extracted_quantity})`);\n                } else if (item.extracted_quantity <= purchaseItem.quantity) {\n                  //      -    \n                  score += 5;\n                  matchReasons.push(` (:${purchaseItem.quantity}, :${item.extracted_quantity})`);\n                }\n                //     0 ( )\n              }\n              \n              //    + OCR   \n              const sysPO = purchaseItem.purchase?.purchase_order_number || '';\n              const sysSO = purchaseItem.purchase?.sales_order_number || '';\n              if (normalizedNumber && sysPO !== normalizedNumber && sysSO !== normalizedNumber) {\n                matchReasons.push(` OCR  : ${normalizedNumber}  ${sysPO || sysSO}`);\n              }\n              \n              console.log(`  : score=${score}, =\"${purchaseItem.item_name}\", =\"${purchaseItem.specification}\", =\"${purchaseItem.purchase?.purchase_order_number}\"`);\n              \n              //  15    (   -   )\n              if (score >= 15) {\n                console.log(`  ! score=${score}`);\n                candidateMap.set(key, {\n                  purchase_id: purchaseItem.purchase?.id,\n                  purchase_order_number: sysPO,\n                  sales_order_number: sysSO,\n                  item_id: purchaseItem.id,\n                  item_name: purchaseItem.item_name,\n                  specification: purchaseItem.specification,\n                  quantity: purchaseItem.quantity,\n                  unit_price: purchaseItem.unit_price_value,\n                  vendor_name: purchaseItem.purchase?.vendor?.vendor_name,\n                  score,\n                  match_reasons: matchReasons\n                });\n              }\n            }\n            \n            //       \n            if (candidateMap.size >= 5) break;\n          }\n        }\n      }\n\n      // 3.   60%         (fallback)\n      // :   ,   (40 )  \n      const hasHighQualityCandidate = Array.from(candidateMap.values()).some(c => c.score >= 40);\n      const needsFallback = candidateMap.size === 0 || !hasHighQualityCandidate;\n      \n      if (needsFallback && statementVendorName) {\n        console.log(`    -  \"${statementVendorName}\"     ( : ${candidateMap.size}, : ${Math.max(...Array.from(candidateMap.values()).map(c => c.score), 0)})`);\n        \n        //  vendor_id \n        const { data: vendors } = await this.supabase\n          .from('vendors')\n          .select('id, vendor_name')\n          .limit(100);\n\n        if (vendors) {\n          //    \n          const matchedVendors = vendors.filter((v: { id: number; vendor_name: string }) => \n            this.calculateVendorSimilarity(statementVendorName, v.vendor_name) >= 70\n          );\n\n          if (matchedVendors.length > 0) {\n            const vendorIds = matchedVendors.map((v: { id: number; vendor_name: string }) => v.id);\n            \n            //    3  \n            const threeMonthsAgo = new Date();\n            threeMonthsAgo.setMonth(threeMonthsAgo.getMonth() - 3);\n\n            const { data: recentPurchases } = await this.supabase\n              .from('purchase_requests')\n              .select(`\n                id, \n                purchase_order_number, \n                sales_order_number,\n                vendor:vendors(vendor_name),\n                items:purchase_request_items(id, item_name, specification, quantity, unit_price_value)\n              `)\n              .in('vendor_id', vendorIds)\n              .gte('created_at', threeMonthsAgo.toISOString())\n              .order('created_at', { ascending: false })\n              .limit(30);\n\n            if (recentPurchases) {\n              for (const purchase of recentPurchases) {\n                const sysVendorName = purchase.vendor?.vendor_name || '';\n                \n                for (const purchaseItem of purchase.items || []) {\n                  const key = `${purchase.id}-${purchaseItem.id}`;\n                  if (candidateMap.has(key)) continue;\n\n                  const matchReasons: string[] = [' '];\n                  let score = 20; //   \n                  \n                  //  OR  \n                  if (item.extracted_item_name) {\n                    const itemMatch = this.calculateItemMatchScore(\n                      item.extracted_item_name, \n                      purchaseItem.item_name, \n                      purchaseItem.specification\n                    );\n                    if (itemMatch.score >= 40) { // 40% \n                      score += itemMatch.score * 0.5;\n                      if (itemMatch.score >= 85) {\n                        matchReasons.push(itemMatch.matchedField === 'specification' ? ' ' : ' ');\n                      } else if (itemMatch.score >= 50) {\n                        matchReasons.push(itemMatch.matchedField === 'specification' ? ' ' : ' ');\n                      }\n                    }\n                  }\n                  \n                  //  :  ,    \n                  if (item.extracted_quantity && purchaseItem.quantity) {\n                    if (item.extracted_quantity === purchaseItem.quantity) {\n                      score += 15;\n                      matchReasons.push(`  (${item.extracted_quantity})`);\n                    } else if (item.extracted_quantity <= purchaseItem.quantity) {\n                      score += 5;\n                      matchReasons.push(` (:${purchaseItem.quantity}, :${item.extracted_quantity})`);\n                    }\n                  }\n                  \n                  // OCR   \n                  const sysPO = purchase.purchase_order_number || '';\n                  const sysSO = purchase.sales_order_number || '';\n                  if (normalizedNumber) {\n                    matchReasons.push(` OCR  : ${normalizedNumber}  ${sysPO || sysSO}`);\n                  }\n                  \n                  //  15    ( )\n                  if (score >= 15) {\n                    candidateMap.set(key, {\n                      purchase_id: purchase.id,\n                      purchase_order_number: sysPO,\n                      sales_order_number: sysSO,\n                      item_id: purchaseItem.id,\n                      item_name: purchaseItem.item_name,\n                      specification: purchaseItem.specification,\n                      quantity: purchaseItem.quantity,\n                      unit_price: purchaseItem.unit_price_value,\n                      vendor_name: sysVendorName,\n                      score,\n                      match_reasons: matchReasons\n                    });\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n\n      //  \n      const candidates = Array.from(candidateMap.values());\n      candidates.sort((a, b) => b.score - a.score);\n\n      console.log(` findMatchCandidates : OCR=\"${item.extracted_item_name}\"  ${candidates.length}  `);\n      if (candidates.length > 0) {\n        console.log(`    : \"${candidates[0].item_name}\" (${candidates[0].purchase_order_number}) score=${candidates[0].score}`);\n      }\n\n      return candidates.slice(0, 15); //  15 \n    } catch (error) {\n      console.error('Find match candidates error:', error);\n      return [];\n    }\n  }\n  \n  /**\n   *    (0-100)\n   */\n  private calculateNameSimilarity(name1: string, name2: string): number {\n    const s1 = name1.toLowerCase().replace(/\\s+/g, '');\n    const s2 = name2.toLowerCase().replace(/\\s+/g, '');\n    \n    if (!s1 || !s2) return 0;\n    if (s1 === s2) return 100;\n    \n    //  \n    if (s1.includes(s2) || s2.includes(s1)) {\n      return 80;\n    }\n    \n    // Levenshtein distance  \n    const maxLen = Math.max(s1.length, s2.length);\n    const distance = this.levenshteinDistance(s1, s2);\n    const similarity = ((maxLen - distance) / maxLen) * 100;\n    \n    return Math.round(similarity);\n  }\n\n  /**\n   *     ( OR )\n   * OCR   item_name  specification \n   *     \n   */\n  private calculateItemMatchScore(\n    ocrItemName: string,\n    systemItemName: string,\n    systemSpecification?: string\n  ): { score: number; matchedField: 'item_name' | 'specification' | 'none' } {\n    if (!ocrItemName) {\n      return { score: 0, matchedField: 'none' };\n    }\n\n    //  \n    const itemNameScore = systemItemName \n      ? this.calculateNameSimilarity(ocrItemName, systemItemName) \n      : 0;\n    \n    //  \n    const specScore = systemSpecification \n      ? this.calculateNameSimilarity(ocrItemName, systemSpecification) \n      : 0;\n\n    //     \n    if (itemNameScore >= specScore) {\n      return { \n        score: itemNameScore, \n        matchedField: itemNameScore > 0 ? 'item_name' : 'none' \n      };\n    } else {\n      return { \n        score: specScore, \n        matchedField: specScore > 0 ? 'specification' : 'none' \n      };\n    }\n  }\n\n  /**\n   *    (0-100)\n   * - (), ,     \n   * - ,  \n   * -     \n   */\n  private calculateVendorSimilarity(vendor1: string, vendor2: string): number {\n    if (!vendor1 || !vendor2) return 0;\n    \n    // :  / \n    const normalize = (name: string) => {\n      return name\n        .toLowerCase()\n        .replace(/\\(\\)|||\\)||co\\.|co,|ltd\\.|ltd|inc\\.|inc|corp\\.|corp|company|/gi, '')\n        .replace(/[^a-z0-9-]/g, '') // ,  \n        .trim();\n    };\n\n    const n1 = normalize(vendor1);\n    const n2 = normalize(vendor2);\n\n    if (!n1 || !n2) return 0;\n    if (n1 === n2) return 100;\n\n    //  \n    if (n1.includes(n2) || n2.includes(n1)) {\n      return 90;\n    }\n\n    //     \n    const translitMap: Record<string, string[]> = {\n      'yg': ['', 'yg'],\n      '': ['yg', ''],\n      'tech': ['', '', 'tech'],\n      '': ['tech', '', ''],\n      '': ['tech', '', ''],\n      'high': ['', 'high'],\n      '': ['high', ''],\n      'korea': ['', '', 'korea'],\n      '': ['korea', '', ''],\n      'electric': ['', '', 'electric'],\n      '': ['electric', '', ''],\n      'steel': ['', '', 'steel'],\n      '': ['steel', '', ''],\n      'metal': ['', '', 'metal'],\n      '': ['metal', '', ''],\n      'system': ['', 'system'],\n      '': ['system', ''],\n      'soft': ['', 'soft'],\n      '': ['soft', ''],\n      'net': ['', 'net'],\n      '': ['net', ''],\n      'global': ['', 'global'],\n      '': ['global', ''],\n      'trade': ['', '', 'trade'],\n      '': ['trade', '', ''],\n      'international': ['', 'international'],\n      '': ['international', ''],\n    };\n\n    //    \n    let n1Replaced = n1;\n    let n2Replaced = n2;\n    \n    for (const [key, values] of Object.entries(translitMap)) {\n      if (n1.includes(key)) {\n        for (const val of values) {\n          n1Replaced = n1Replaced.replace(key, val);\n          if (n1Replaced === n2 || n2.includes(n1Replaced) || n1Replaced.includes(n2)) {\n            return 85;\n          }\n        }\n        n1Replaced = n1; // \n      }\n      if (n2.includes(key)) {\n        for (const val of values) {\n          n2Replaced = n2Replaced.replace(key, val);\n          if (n1 === n2Replaced || n1.includes(n2Replaced) || n2Replaced.includes(n1)) {\n            return 85;\n          }\n        }\n        n2Replaced = n2; // \n      }\n    }\n\n    // Levenshtein   \n    const maxLen = Math.max(n1.length, n2.length);\n    const distance = this.levenshteinDistance(n1, n2);\n    const similarity = ((maxLen - distance) / maxLen) * 100;\n\n    return Math.round(similarity);\n  }\n\n  /**\n   *     (70%    )\n   */\n  isVendorMatch(vendor1: string, vendor2: string, threshold: number = 70): boolean {\n    return this.calculateVendorSimilarity(vendor1, vendor2) >= threshold;\n  }\n  \n  /**\n   * Levenshtein  \n   */\n  private levenshteinDistance(s1: string, s2: string): number {\n    const m = s1.length;\n    const n = s2.length;\n    const dp: number[][] = Array(m + 1).fill(null).map(() => Array(n + 1).fill(0));\n    \n    for (let i = 0; i <= m; i++) dp[i][0] = i;\n    for (let j = 0; j <= n; j++) dp[0][j] = j;\n    \n    for (let i = 1; i <= m; i++) {\n      for (let j = 1; j <= n; j++) {\n        if (s1[i - 1] === s2[j - 1]) {\n          dp[i][j] = dp[i - 1][j - 1];\n        } else {\n          dp[i][j] = Math.min(dp[i - 1][j - 1], dp[i - 1][j], dp[i][j - 1]) + 1;\n        }\n      }\n    }\n    \n    return dp[m][n];\n  }\n\n  /**\n   *    - /   \n   */\n  private calculateSimilarityScore(\n    extractedItem: TransactionStatementItem,\n    purchaseItem: any\n  ): number {\n    let score = 0;\n\n    //   ( 40) - item_name specification      \n    if (extractedItem.extracted_item_name) {\n      const itemMatch = this.calculateItemMatchScore(\n        extractedItem.extracted_item_name,\n        purchaseItem.item_name || '',\n        purchaseItem.specification || ''\n      );\n      score += itemMatch.score * 0.4; //  40\n    }\n\n    // OCR     ( 20)\n    if (extractedItem.extracted_specification) {\n      const specMatch = this.calculateItemMatchScore(\n        extractedItem.extracted_specification,\n        purchaseItem.item_name || '',\n        purchaseItem.specification || ''\n      );\n      score += specMatch.score * 0.2; //  20\n    }\n\n    //   ( 20)\n    if (extractedItem.extracted_quantity && purchaseItem.quantity) {\n      const diff = Math.abs(extractedItem.extracted_quantity - purchaseItem.quantity);\n      if (diff === 0) {\n        score += 20;\n      } else if (diff <= purchaseItem.quantity * 0.1) {\n        score += 15;\n      } else if (diff <= purchaseItem.quantity * 0.2) {\n        score += 10;\n      }\n    }\n\n    //   ( 20)\n    if (extractedItem.extracted_unit_price && purchaseItem.unit_price_value) {\n      const diff = Math.abs(extractedItem.extracted_unit_price - purchaseItem.unit_price_value);\n      if (diff === 0) {\n        score += 20;\n      } else if (diff <= purchaseItem.unit_price_value * 0.05) {\n        score += 15;\n      } else if (diff <= purchaseItem.unit_price_value * 0.1) {\n        score += 10;\n      }\n    }\n\n    return score;\n  }\n\n  /**\n   *    - /   \n   */\n  private getMatchReasons(\n    extractedItem: TransactionStatementItem,\n    purchaseItem: any,\n    score: number\n  ): string[] {\n    const reasons: string[] = [];\n\n    //    (item_name specification  )\n    if (extractedItem.extracted_item_name) {\n      const itemMatch = this.calculateItemMatchScore(\n        extractedItem.extracted_item_name,\n        purchaseItem.item_name || '',\n        purchaseItem.specification || ''\n      );\n      \n      if (itemMatch.score >= 90) {\n        reasons.push(itemMatch.matchedField === 'specification' ? '  ' : '  ');\n      } else if (itemMatch.score >= 70) {\n        reasons.push(itemMatch.matchedField === 'specification' ? '  ' : '  ');\n      } else if (itemMatch.score >= 50) {\n        reasons.push(itemMatch.matchedField === 'specification' ? '  ' : '  ');\n      }\n    }\n\n    //   \n    if (extractedItem.extracted_quantity && purchaseItem.quantity) {\n      if (extractedItem.extracted_quantity === purchaseItem.quantity) {\n        reasons.push(`  (${extractedItem.extracted_quantity})`);\n      } else if (extractedItem.extracted_quantity <= purchaseItem.quantity) {\n        reasons.push(` (:${purchaseItem.quantity}, :${extractedItem.extracted_quantity})`);\n      }\n    }\n\n    if (extractedItem.extracted_unit_price === purchaseItem.unit_price_value) {\n      reasons.push(' ');\n    }\n\n    if (score >= 70) {\n      reasons.push(' ');\n    } else if (score >= 50) {\n      reasons.push(' ');\n    }\n\n    return reasons;\n  }\n\n  /**\n   *   \n   */\n  async updateItemMatch(\n    itemId: string,\n    matchedPurchaseId: number | null,\n    matchedItemId: number | null,\n    matchMethod: 'po_number' | 'item_similarity' | 'manual' = 'manual'\n  ): Promise<{ success: boolean; error?: string }> {\n    try {\n      const { error } = await this.supabase\n        .from('transaction_statement_items')\n        .update({\n          matched_purchase_id: matchedPurchaseId,\n          matched_item_id: matchedItemId,\n          match_method: matchMethod\n        })\n        .eq('id', itemId);\n\n      if (error) throw error;\n\n      return { success: true };\n    } catch (error) {\n      console.error('Update item match error:', error);\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : '    .'\n      };\n    }\n  }\n\n  /**\n   *  \n   */\n  async confirmStatement(\n    request: ConfirmStatementRequest,\n    confirmerName: string\n  ): Promise<{ success: boolean; error?: string }> {\n    try {\n      const { data: { user } } = await this.supabase.auth.getUser();\n\n      // 1.   \n      for (const item of request.items) {\n        //    \n        const { error: itemError } = await this.supabase\n          .from('transaction_statement_items')\n          .update({\n            is_confirmed: true,\n            matched_purchase_id: item.matched_purchase_id,\n            matched_item_id: item.matched_item_id,\n            confirmed_quantity: item.confirmed_quantity,\n            confirmed_unit_price: item.confirmed_unit_price,\n            confirmed_amount: item.confirmed_amount,\n            is_additional_item: item.is_additional_item || false,\n            parent_item_id: item.parent_item_id\n          })\n          .eq('id', item.itemId);\n\n        if (itemError) throw itemError;\n\n        // 2.   / \n        //         \n        const hasValidUnitPrice = item.confirmed_unit_price !== undefined && item.confirmed_unit_price !== null;\n        const hasValidAmount = item.confirmed_amount !== undefined && item.confirmed_amount !== null;\n        \n        if (item.matched_item_id && (hasValidUnitPrice || hasValidAmount)) {\n          //    (  )\n          const updateData: { unit_price_value?: number; amount_value?: number } = {};\n          if (hasValidUnitPrice) {\n            updateData.unit_price_value = item.confirmed_unit_price!;\n          }\n          if (hasValidAmount) {\n            updateData.amount_value = item.confirmed_amount!;\n          }\n          \n          const { error: purchaseError } = await this.supabase\n            .from('purchase_request_items')\n            .update(updateData)\n            .eq('id', item.matched_item_id);\n\n          if (purchaseError) {\n            console.warn('Failed to update purchase item:', purchaseError);\n          }\n        }\n\n        // 3.    (  )\n        if (item.is_additional_item && item.matched_purchase_id && !item.matched_item_id) {\n          const statementItem = await this.getStatementItem(item.itemId);\n          if (statementItem) {\n            const { error: insertError } = await this.supabase\n              .from('purchase_request_items')\n              .insert({\n                purchase_request_id: item.matched_purchase_id,\n                item_name: statementItem.extracted_item_name || ' ',\n                specification: statementItem.extracted_specification,\n                quantity: item.confirmed_quantity || statementItem.extracted_quantity || 1,\n                unit_price_value: item.confirmed_unit_price || statementItem.extracted_unit_price,\n                amount_value: item.confirmed_amount || statementItem.extracted_amount,\n                remark: ' '\n              });\n\n            if (insertError) {\n              console.warn('Failed to insert additional item:', insertError);\n            }\n          }\n        }\n      }\n\n      // 4.   confirmed \n      const { error: stmtError } = await this.supabase\n        .from('transaction_statements')\n        .update({\n          status: 'confirmed',\n          confirmed_at: new Date().toISOString(),\n          confirmed_by: user?.id,\n          confirmed_by_name: confirmerName\n        })\n        .eq('id', request.statementId);\n\n      if (stmtError) throw stmtError;\n\n      return { success: true };\n    } catch (error) {\n      console.error('Confirm statement error:', error);\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : '   .'\n      };\n    }\n  }\n\n  /**\n   *   \n   */\n  private async getStatementItem(itemId: string): Promise<TransactionStatementItem | null> {\n    const { data } = await this.supabase\n      .from('transaction_statement_items')\n      .select('*')\n      .eq('id', itemId)\n      .single();\n    \n    return data;\n  }\n\n  /**\n   *  \n   */\n  async rejectStatement(statementId: string): Promise<{ success: boolean; error?: string }> {\n    try {\n      const { error } = await this.supabase\n        .from('transaction_statements')\n        .update({ status: 'rejected' })\n        .eq('id', statementId);\n\n      if (error) throw error;\n\n      return { success: true };\n    } catch (error) {\n      console.error('Reject statement error:', error);\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : '    .'\n      };\n    }\n  }\n\n  /**\n   *  \n   */\n  async deleteStatement(statementId: string): Promise<{ success: boolean; error?: string }> {\n    try {\n      //  URL \n      const { data: statement } = await this.supabase\n        .from('transaction_statements')\n        .select('image_url')\n        .eq('id', statementId)\n        .single();\n\n      // DB  (cascade   )\n      const { error } = await this.supabase\n        .from('transaction_statements')\n        .delete()\n        .eq('id', statementId);\n\n      if (error) throw error;\n\n      // Storage   \n      if (statement?.image_url) {\n        try {\n          const path = statement.image_url.split('/receipt-images/')[1];\n          if (path) {\n            await this.supabase.storage.from('receipt-images').remove([path]);\n          }\n        } catch (e) {\n          console.warn('Failed to delete storage file:', e);\n        }\n      }\n\n      return { success: true };\n    } catch (error) {\n      console.error('Delete statement error:', error);\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : '   .'\n      };\n    }\n  }\n\n  /**\n   *   -        \n   * Case 1:      \n   * \n   * :\n   * 1. OCR  /   ( )\n   * 2.     \n   * 3.       \n   */\n  async findBestMatchingPurchaseOrderSet(\n    extractedItems: TransactionStatementItem[],\n    extractedPONumber?: string,\n    statementVendorName?: string\n  ): Promise<{\n    success: boolean;\n    data?: {\n      bestMatch: {\n        purchase_id: number;\n        purchase_order_number: string;\n        sales_order_number?: string;\n        vendor_name?: string;\n        matchScore: number;        // 0-100   \n        matchedItemCount: number;  //   \n        totalItemCount: number;    //   \n        confidence: 'high' | 'medium' | 'low';\n        itemMatches: Array<{\n          ocrItemId: string;\n          systemItemId: number;\n          systemItemName: string;\n          similarity: number;\n        }>;\n      } | null;\n      candidates: Array<{\n        purchase_id: number;\n        purchase_order_number: string;\n        sales_order_number?: string;\n        vendor_name?: string;\n        matchScore: number;\n        matchedItemCount: number;\n      }>;\n    };\n    error?: string;\n  }> {\n    try {\n      const normalizedNumber = extractedPONumber \n        ? normalizeOrderNumber(extractedPONumber) \n        : '';\n\n      const purchaseScores: Array<{\n        purchase_id: number;\n        purchase_order_number: string;\n        sales_order_number?: string;\n        vendor_name?: string;\n        matchScore: number;\n        matchedItemCount: number;\n        totalItemCount: number;\n        items: any[];\n        itemMatches: Array<{\n          ocrItemId: string;\n          systemItemId: number;\n          systemItemName: string;\n          similarity: number;\n        }>;\n      }> = [];\n\n      // 1. OCR     ( )\n      if (normalizedNumber) {\n        const { data: byNumber } = await this.supabase\n          .from('purchase_requests')\n          .select(`\n            id, \n            purchase_order_number, \n            sales_order_number,\n            vendor:vendors(vendor_name),\n            items:purchase_request_items(id, item_name, specification, quantity, unit_price_value)\n          `)\n          .or(`purchase_order_number.eq.${normalizedNumber},sales_order_number.eq.${normalizedNumber}`)\n          .limit(5);\n\n        if (byNumber && byNumber.length > 0) {\n          for (const purchase of byNumber) {\n            //   \n            const sysVendorName = purchase.vendor?.vendor_name || '';\n            const vendorSimilarity = statementVendorName \n              ? this.calculateVendorSimilarity(statementVendorName, sysVendorName)\n              : 100;\n            \n            //   70%   (   )\n            if (vendorSimilarity < 50) {\n              console.log(`   -   : \"${statementVendorName}\" vs \"${sysVendorName}\" (${vendorSimilarity}%)`);\n              continue;\n            }\n            \n            const setScore = this.calculateSetMatchScore(extractedItems, purchase.items || []);\n            purchaseScores.push({\n              purchase_id: purchase.id,\n              purchase_order_number: purchase.purchase_order_number || '',\n              sales_order_number: purchase.sales_order_number,\n              vendor_name: sysVendorName,\n              matchScore: setScore.score,\n              matchedItemCount: setScore.matchedCount,\n              totalItemCount: extractedItems.length,\n              items: purchase.items || [],\n              itemMatches: setScore.itemMatches\n            });\n          }\n        }\n      }\n\n      // 2.       \n      const bestByNumber = purchaseScores.length > 0 \n        ? purchaseScores.reduce((a, b) => a.matchScore > b.matchScore ? a : b)\n        : null;\n\n      // 3.    80%    ( )\n      if (bestByNumber && bestByNumber.matchScore >= 80) {\n        return {\n          success: true,\n          data: {\n            bestMatch: {\n              ...bestByNumber,\n              confidence: 'high'\n            },\n            candidates: purchaseScores.map(p => ({\n              purchase_id: p.purchase_id,\n              purchase_order_number: p.purchase_order_number,\n              sales_order_number: p.sales_order_number,\n              vendor_name: p.vendor_name,\n              matchScore: p.matchScore,\n              matchedItemCount: p.matchedItemCount\n            }))\n          }\n        };\n      }\n\n      // 4.          \n      //  3       \n      const threeMonthsAgo = new Date();\n      threeMonthsAgo.setMonth(threeMonthsAgo.getMonth() - 3);\n\n      const { data: recentPurchases } = await this.supabase\n        .from('purchase_requests')\n        .select(`\n          id, \n          purchase_order_number, \n          sales_order_number,\n          vendor:vendors(vendor_name),\n          items:purchase_request_items(id, item_name, specification, quantity, unit_price_value)\n        `)\n        .gte('created_at', threeMonthsAgo.toISOString())\n        .order('created_at', { ascending: false })\n        .limit(100);\n\n      if (recentPurchases) {\n        for (const purchase of recentPurchases) {\n          //     \n          if (purchaseScores.some(p => p.purchase_id === purchase.id)) continue;\n\n          //    -    \n          const sysVendorName = purchase.vendor?.vendor_name || '';\n          const vendorSimilarity = statementVendorName \n            ? this.calculateVendorSimilarity(statementVendorName, sysVendorName)\n            : 100;\n          \n          //   70%   (   )\n          if (vendorSimilarity < 50) {\n            continue;\n          }\n\n          const setScore = this.calculateSetMatchScore(extractedItems, purchase.items || []);\n          \n          // 40    ( )\n          if (setScore.score >= 40) {\n            purchaseScores.push({\n              purchase_id: purchase.id,\n              purchase_order_number: purchase.purchase_order_number || '',\n              sales_order_number: purchase.sales_order_number,\n              vendor_name: sysVendorName,\n              matchScore: setScore.score,\n              matchedItemCount: setScore.matchedCount,\n              totalItemCount: extractedItems.length,\n              items: purchase.items || [],\n              itemMatches: setScore.itemMatches\n            });\n          }\n        }\n      }\n\n      // 5.  \n      purchaseScores.sort((a, b) => b.matchScore - a.matchScore);\n\n      const bestMatch = purchaseScores.length > 0 ? purchaseScores[0] : null;\n\n      return {\n        success: true,\n        data: {\n          bestMatch: bestMatch ? {\n            ...bestMatch,\n            confidence: bestMatch.matchScore >= 80 ? 'high' \n              : bestMatch.matchScore >= 50 ? 'medium' \n              : 'low'\n          } : null,\n          candidates: purchaseScores.slice(0, 10).map(p => ({\n            purchase_id: p.purchase_id,\n            purchase_order_number: p.purchase_order_number,\n            sales_order_number: p.sales_order_number,\n            vendor_name: p.vendor_name,\n            matchScore: p.matchScore,\n            matchedItemCount: p.matchedItemCount\n          }))\n        }\n      };\n    } catch (error) {\n      console.error('Find best matching PO set error:', error);\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : '    .'\n      };\n    }\n  }\n\n  /**\n   *    \n   *      1:1   \n   */\n  private calculateSetMatchScore(\n    ocrItems: TransactionStatementItem[],\n    systemItems: any[]\n  ): { \n    score: number; \n    matchedCount: number;\n    itemMatches: Array<{\n      ocrItemId: string;\n      systemItemId: number;\n      systemItemName: string;\n      similarity: number;\n    }>;\n  } {\n    if (ocrItems.length === 0 || systemItems.length === 0) {\n      return { score: 0, matchedCount: 0, itemMatches: [] };\n    }\n\n    const itemMatches: Array<{\n      ocrItemId: string;\n      systemItemId: number;\n      systemItemName: string;\n      similarity: number;\n    }> = [];\n\n    //  OCR       \n    const usedSystemItems = new Set<number>();\n    let totalSimilarity = 0;\n\n    for (const ocrItem of ocrItems) {\n      let bestMatch: { id: number; name: string; similarity: number } | null = null;\n\n      for (const sysItem of systemItems) {\n        //     \n        if (usedSystemItems.has(sysItem.id)) continue;\n\n        //  OR   (  )\n        const itemMatch = this.calculateItemMatchScore(\n          ocrItem.extracted_item_name || '',\n          sysItem.item_name || '',\n          sysItem.specification || ''\n        );\n\n        //  :  ,    \n        let quantityBonus = 0;\n        if (ocrItem.extracted_quantity && sysItem.quantity) {\n          if (ocrItem.extracted_quantity === sysItem.quantity) {\n            quantityBonus = 15; //   \n          } else if (ocrItem.extracted_quantity <= sysItem.quantity) {\n            quantityBonus = 5; //       \n          }\n        }\n        const totalScore = itemMatch.score + quantityBonus;\n\n        if (!bestMatch || totalScore > bestMatch.similarity) {\n          bestMatch = {\n            id: sysItem.id,\n            name: sysItem.item_name,\n            similarity: totalScore\n          };\n        }\n      }\n\n      //  40   \n      if (bestMatch && bestMatch.similarity >= 40) {\n        usedSystemItems.add(bestMatch.id);\n        totalSimilarity += bestMatch.similarity;\n        itemMatches.push({\n          ocrItemId: ocrItem.id,\n          systemItemId: bestMatch.id,\n          systemItemName: bestMatch.name,\n          similarity: bestMatch.similarity\n        });\n      }\n    }\n\n    //    \n    // -    (50%)\n    // -   (50%)\n    const matchRatio = itemMatches.length / ocrItems.length;\n    const avgSimilarity = itemMatches.length > 0 \n      ? totalSimilarity / itemMatches.length \n      : 0;\n    \n    const score = Math.round((matchRatio * 50) + (avgSimilarity * 0.5));\n\n    return {\n      score: Math.min(100, score),\n      matchedCount: itemMatches.length,\n      itemMatches\n    };\n  }\n\n  /**\n   * OCR   \n   */\n  async saveCorrection(request: SaveCorrectionRequest): Promise<{ success: boolean; error?: string }> {\n    try {\n      const { data: { user } } = await this.supabase.auth.getUser();\n      \n      //   \n      const { error } = await this.supabase\n        .from('ocr_corrections')\n        .insert({\n          statement_id: request.statement_id,\n          statement_item_id: request.statement_item_id,\n          original_text: request.original_text,\n          corrected_text: request.corrected_text,\n          field_type: request.field_type,\n          corrected_by: user?.id\n        });\n\n      if (error) throw error;\n\n      return { success: true };\n    } catch (error) {\n      console.error('Save correction error:', error);\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : '     .'\n      };\n    }\n  }\n\n  /**\n   *      \n   */\n  async getStatementsByPurchaseId(purchaseId: number): Promise<{\n    success: boolean;\n    data?: TransactionStatement[];\n    error?: string;\n  }> {\n    try {\n      //       \n      const { data: items } = await this.supabase\n        .from('transaction_statement_items')\n        .select('statement_id')\n        .eq('matched_purchase_id', purchaseId);\n\n      if (!items || items.length === 0) {\n        return { success: true, data: [] };\n      }\n\n      const statementIds = [...new Set(items.map((i: { statement_id: string }) => i.statement_id))];\n\n      const { data: statements, error } = await this.supabase\n        .from('transaction_statements')\n        .select('*')\n        .in('id', statementIds)\n        .order('uploaded_at', { ascending: false });\n\n      if (error) throw error;\n\n      return { success: true, data: statements || [] };\n    } catch (error) {\n      console.error('Get statements by purchase error:', error);\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : '   .'\n      };\n    }\n  }\n}\n\nexport const transactionStatementService = new TransactionStatementService();\nexport default transactionStatementService;\n\n","import { useEffect, useState, useRef, useCallback, useMemo, memo, type CSSProperties } from 'react'\nimport { DndContext, closestCenter, PointerSensor, useSensor, useSensors, type DragEndEvent } from '@dnd-kit/core'\nimport { SortableContext, verticalListSortingStrategy, useSortable, arrayMove } from '@dnd-kit/sortable'\nimport { CSS } from '@dnd-kit/utilities'\nimport { createClient } from '@/lib/supabase/client'\nimport { PurchaseRequestWithDetails, Purchase, Vendor } from '@/types/purchase'\nimport { findPurchaseInMemory, markItemAsPaymentCompleted, markPurchaseAsPaymentCompleted, markItemAsReceived, markPurchaseAsReceived, markItemAsPaymentCanceled, markItemAsStatementReceived, markItemAsStatementCanceled, usePurchaseMemory, updatePurchaseInMemory, removeItemFromMemory, markItemAsExpenditureSet, markBulkExpenditureSet, removePurchaseFromMemory, addCacheListener } from '@/stores/purchaseMemoryStore'\nimport { formatDate, dateToISOString } from '@/utils/helpers'\nimport { DatePickerPopover } from '@/components/ui/date-picker-popover'\nimport { DateAmountPickerPopover } from '@/components/ui/date-amount-picker-popover'\nimport { DateQuantityPickerPopover } from '@/components/ui/date-quantity-picker-popover'\nimport { \n  Calendar, \n  User, \n  Building2, \n  Package, \n  CreditCard,\n  X,\n  FileText,\n  DollarSign,\n  Edit2,\n  Trash2,\n  Save,\n  Plus,\n  CheckCircle,\n  XCircle,\n  Check,\n  Truck,\n  MessageSquarePlus,\n  Loader2,\n  GripVertical,\n  Image as ImageIcon,\n  FileCheck\n} from 'lucide-react'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Textarea } from '@/components/ui/textarea'\nimport { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover'\nimport { Label } from '@/components/ui/label'\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog'\nimport { toast } from 'sonner'\nimport { logger } from '@/lib/logger'\nimport { useConfirmDateAction } from '@/hooks/useConfirmDateAction'\nimport { format as formatDateInput } from 'date-fns'\nimport { AUTHORIZED_ROLES } from '@/constants/columnSettings'\nimport ReactSelect from 'react-select'\nimport transactionStatementService from '@/services/transactionStatementService'\nimport type { TransactionStatement } from '@/types/transactionStatement'\nimport { supportService, type SupportInquiryPayload } from '@/services/supportService'\n\ninterface PurchaseDetailModalProps {\n  purchaseId: number | null\n  isOpen: boolean\n  onClose: () => void\n  embedded?: boolean  // Dialog   \n  currentUserRoles?: string[]\n  activeTab?: string\n  onRefresh?: (forceRefresh?: boolean, options?: { silent?: boolean }) => void | Promise<void>\n  onOptimisticUpdate?: (purchaseId: number, updater: (prev: Purchase) => Purchase) => void\n  onDelete?: (purchase: PurchaseRequestWithDetails) => void\n}\n\ntype QuantityChangeRow = {\n  id: string\n  itemId: string\n  newQuantity: string\n}\n\ntype QuantityChangePayloadItem = {\n  item_id: string\n  line_number?: number | null\n  item_name: string\n  specification?: string | null\n  current_quantity?: number | null\n  new_quantity: number\n}\n\ntype PriceChangeType = 'unit_price' | 'amount'\n\ntype PriceChangeRow = {\n  id: string\n  itemId: string\n  changeType: PriceChangeType\n  newValue: string\n}\n\ntype PriceChangePayloadItem = {\n  item_id: string\n  line_number?: number | null\n  item_name: string\n  specification?: string | null\n  change_type: PriceChangeType\n  current_unit_price?: number | null\n  new_unit_price?: number | null\n  current_amount?: number | null\n  new_amount?: number | null\n}\n\ntype SortableRenderProps = {\n  setNodeRef: (element: HTMLElement | null) => void\n  style: CSSProperties\n  attributes: any\n  listeners: any\n  isDragging: boolean\n}\n\ntype SortableRowProps = {\n  id: string\n  children: (props: SortableRenderProps) => React.ReactNode\n}\n\n//  SortableRow        (  )\nconst SortableRow = ({ id, children }: SortableRowProps) => {\n  const { attributes, listeners, setNodeRef, transform, transition, isDragging } = useSortable({ id })\n  const style: CSSProperties = {\n    transform: CSS.Transform.toString(transform),\n    transition\n  }\n  return <>{children({ setNodeRef, attributes, listeners, isDragging, style })}</>\n}\n\nfunction PurchaseDetailModal({ \n  purchaseId, \n  isOpen, \n  onClose, \n  embedded = false,\n  currentUserRoles = [],\n  activeTab,\n  onRefresh,\n  onOptimisticUpdate,\n  onDelete\n}: PurchaseDetailModalProps) {\n  const { allPurchases, lastFetch } = usePurchaseMemory(); //     \n  \n  const [loading, setLoading] = useState(false)\n  const [purchase, setPurchase] = useState<PurchaseRequestWithDetails | null>(null)\n  const [isEditing, setIsEditing] = useState(false)\n  const [editedPurchase, setEditedPurchase] = useState<PurchaseRequestWithDetails | null>(null)\n  const [editedItems, setEditedItems] = useState<any[]>([])\n  const [deletedItemIds, setDeletedItemIds] = useState<number[]>([])\n  const [userRoles, setUserRoles] = useState<string[]>([])\n  const [currentUserName, setCurrentUserName] = useState<string>('')\n  const [columnWidths, setColumnWidths] = useState<number[]>([])\n  const [focusedInput, setFocusedInput] = useState<string | null>(null)\n  const [vendors, setVendors] = useState<Vendor[]>([])\n  const [vendorSearchTerm, setVendorSearchTerm] = useState('')\n  \n  //   \n  const [isModifyRequestOpen, setIsModifyRequestOpen] = useState(false)\n  const [modifyInquiryType, setModifyInquiryType] = useState('')\n  const [modifyMessage, setModifyMessage] = useState('')\n  const [requestedDeliveryDate, setRequestedDeliveryDate] = useState<Date | undefined>()\n  const [quantityChangeRows, setQuantityChangeRows] = useState<QuantityChangeRow[]>([])\n  const [priceChangeRows, setPriceChangeRows] = useState<PriceChangeRow[]>([])\n  const [isSendingModify, setIsSendingModify] = useState(false)\n  const textMeasureCanvasRef = useRef<HTMLCanvasElement | null>(null)\n  \n  //   \n  const [isSaving, setIsSaving] = useState(false)\n\n  //   \n  const [linkedStatements, setLinkedStatements] = useState<TransactionStatement[]>([])\n\n  const sensors = useSensors(\n    useSensor(PointerSensor, { activationConstraint: { distance: 4 } })\n  )\n\n  const makeStableKey = useCallback((item: any, idx: number) => {\n    // stableKey    \n    if (item?.stableKey) return item.stableKey\n    \n    // id  id   key \n    if (item?.id != null) return `sk-item-${item.id}`\n    \n    // tempId  tempId   key \n    if (item?.tempId) return `sk-tmp-${item.tempId}`\n    \n    // line_number idx   key  ( line_number idx   key)\n    if (item?.line_number != null) return `sk-line-${item.line_number}-${idx}`\n    \n    //  idx  (  )\n    return `sk-idx-${idx}`\n  }, [])\n\n  const normalizeItems = useCallback((items: any[] = []) => {\n    return items.map((item, idx) => {\n      const withTemp = {\n        ...item,\n        tempId: item?.tempId ?? `tmp-${item?.id ?? item?.line_number ?? idx}-${idx}`\n      }\n      return {\n        ...withTemp,\n        stableKey: makeStableKey(withTemp, idx)\n      }\n    })\n  }, [makeStableKey])\n\n  const getSortableId = useCallback((item: any, index: number) => {\n    // stableKey    \n    if (item?.stableKey) return item.stableKey\n    \n    // id  id   key \n    if (item?.id != null) return `item-${item.id}`\n    \n    // tempId  tempId   key \n    if (item?.tempId) return `tmp-${item.tempId}`\n    \n    // line_number index   key  ( line_number index   key)\n    if (item?.line_number != null) return `line-${item.line_number}-${index}`\n    \n    //  index \n    return `temp-${index}`\n  }, [])\n\n  const handleDragEnd = useCallback((event: DragEndEvent) => {\n    const { active, over } = event\n    if (!over || active.id === over.id) return\n\n    setEditedItems(prev => {\n      const oldIndex = prev.findIndex((item, index) => getSortableId(item, index) === active.id)\n      const newIndex = prev.findIndex((item, index) => getSortableId(item, index) === over.id)\n      if (oldIndex === -1 || newIndex === -1) return prev\n\n      const reordered = arrayMove(prev, oldIndex, newIndex).map((item, idx) => ({\n        ...item,\n        line_number: idx + 1,\n        stableKey: item.stableKey ?? makeStableKey(item, idx)\n      }))\n      return reordered\n    })\n  }, [getSortableId, makeStableKey])\n\n  const handleModifyRequestOpenChange = (open: boolean) => {\n    setIsModifyRequestOpen(open)\n  }\n\n  //   \n  useEffect(() => {\n    if (isModifyRequestOpen) {\n      setModifyInquiryType('')\n      setModifyMessage('')\n      setRequestedDeliveryDate(undefined)\n      setQuantityChangeRows([])\n      setPriceChangeRows([])\n    }\n  }, [isModifyRequestOpen])\n\n  useEffect(() => {\n    if (modifyInquiryType === 'quantity_change' && quantityChangeRows.length === 0) {\n      setQuantityChangeRows([{ id: createRowId(), itemId: '', newQuantity: '' }])\n    }\n    if (modifyInquiryType === 'price_change' && priceChangeRows.length === 0) {\n      setPriceChangeRows([{ id: createRowId(), itemId: '', changeType: 'unit_price', newValue: '' }])\n    }\n  }, [modifyInquiryType, quantityChangeRows.length, priceChangeRows.length])\n\n  const handleModifyPopoverWheel = (event: React.WheelEvent<HTMLDivElement>) => {\n    if (event.currentTarget.scrollHeight > event.currentTarget.clientHeight) {\n      event.preventDefault()\n      event.stopPropagation()\n      event.currentTarget.scrollTop += event.deltaY\n    }\n  }\n\n  const createRowId = () => `row-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`\n\n  const selectedPurchaseItems = useMemo(() => {\n    if (!purchase?.purchase_request_items) return []\n    return [...purchase.purchase_request_items].sort((a: any, b: any) => {\n      const aLine = a.line_number ?? Number.MAX_SAFE_INTEGER\n      const bLine = b.line_number ?? Number.MAX_SAFE_INTEGER\n      return aLine - bLine\n    })\n  }, [purchase])\n\n  const itemOptions = useMemo(() => (\n    selectedPurchaseItems.map((item: any) => ({\n      value: String(item.id),\n      label: `${item.line_number ? `${item.line_number}.` : ''} ${item.item_name} (${item.specification || '-'})`.trim()\n    }))\n  ), [selectedPurchaseItems])\n\n  const modifyInquiryTypeOptions = [\n    { value: 'delivery_date_change', label: '  ' },\n    { value: 'quantity_change', label: '  ' },\n    { value: 'price_change', label: '/   ' },\n    { value: 'modify', label: ' ' },\n    { value: 'delete', label: ' ' }\n  ]\n\n  const priceChangeTypeOptions = [\n    { value: 'unit_price', label: '' },\n    { value: 'amount', label: '' }\n  ]\n\n  const getInquiryTypeLabel = (type: string) => {\n    switch (type) {\n      case 'delivery_date_change': return '  '\n      case 'quantity_change': return '  '\n      case 'price_change': return '/   '\n      case 'modify': return ' '\n      case 'delete': return ' '\n      default: return type\n    }\n  }\n\n  const getMeasureFont = () => {\n    if (typeof document === 'undefined') {\n      return '11px Pretendard, -apple-system, BlinkMacSystemFont, \"Segoe UI\", \"Noto Sans KR\", sans-serif'\n    }\n\n    const bodyStyle = window.getComputedStyle(document.body)\n    const fontFamily = bodyStyle.fontFamily || 'Pretendard, -apple-system, BlinkMacSystemFont, \"Segoe UI\", \"Noto Sans KR\", sans-serif'\n    const fontWeight = bodyStyle.fontWeight || '400'\n    return `${fontWeight} 11px ${fontFamily}`\n  }\n\n  const measureTextWidthPx = (text: string) => {\n    if (typeof document === 'undefined') {\n      return text.length * 7\n    }\n\n    if (!textMeasureCanvasRef.current) {\n      textMeasureCanvasRef.current = document.createElement('canvas')\n    }\n\n    const context = textMeasureCanvasRef.current.getContext('2d')\n    if (!context) {\n      return text.length * 7\n    }\n\n    context.font = getMeasureFont()\n    return Math.ceil(context.measureText(text).width)\n  }\n\n  const getLabelWidthEm = (label: string, padding = 4, min = 12) =>\n    Math.max(label.length + padding, min)\n\n  const SELECT_OPTION_PADDING_PX = 24\n  const SELECT_INDICATOR_PX = 30\n  const SELECT_SCROLLBAR_PX = 14\n  const getSelectLabelMaxPx = (options: Array<{ label?: string }>) =>\n    options.reduce((max, option) => {\n      const label = option.label ?? ''\n      return Math.max(max, measureTextWidthPx(label))\n    }, 0)\n  const getSelectControlWidthPx = (options: Array<{ label?: string }>, placeholder: string) => {\n    const maxLabelPx = getSelectLabelMaxPx(options)\n    const base = Math.max(maxLabelPx, measureTextWidthPx(placeholder))\n    return Math.ceil(base + SELECT_OPTION_PADDING_PX + SELECT_INDICATOR_PX)\n  }\n  const getMenuWidthPx = (options: Array<{ label?: string }>, placeholder: string) => {\n    const maxLabelPx = getSelectLabelMaxPx(options)\n    const base = Math.max(maxLabelPx, measureTextWidthPx(placeholder))\n    return Math.ceil(base + SELECT_OPTION_PADDING_PX + SELECT_INDICATOR_PX + SELECT_SCROLLBAR_PX)\n  }\n\n  const inquiryTypePlaceholder = '  '\n  const inquiryTypeControlWidthEm = getLabelWidthEm(inquiryTypePlaceholder, 3, 14)\n  const inquiryTypeMenuWidthEm = getLabelWidthEm(\n    modifyInquiryTypeOptions.reduce((max, option) => {\n      const label = option.label || ''\n      return label.length > max.length ? label : max\n    }, inquiryTypePlaceholder),\n    3,\n    inquiryTypeControlWidthEm\n  )\n\n  const itemSelectPlaceholder = ' /'\n  const itemControlWidthPx = getSelectControlWidthPx(itemOptions, itemSelectPlaceholder) + 16\n  const itemMenuWidthPx = getMenuWidthPx(itemOptions, itemSelectPlaceholder)\n\n  const getCompactSelectStyles = (controlWidthPx?: number, menuWidthPx?: number) => ({\n    control: (base: any) => ({\n      ...base,\n      minHeight: '28px',\n      height: '28px',\n      fontSize: '11px',\n      borderRadius: '8px',\n      borderColor: '#e5e7eb',\n      boxShadow: 'none'\n    }),\n    container: (base: any) => ({\n      ...base,\n      width: controlWidthPx ? `${controlWidthPx}px` : base.width,\n      maxWidth: '100%'\n    }),\n    valueContainer: (base: any) => ({\n      ...base,\n      padding: '0 8px'\n    }),\n    input: (base: any) => ({\n      ...base,\n      margin: 0,\n      padding: 0,\n      fontSize: '11px'\n    }),\n    indicatorsContainer: (base: any) => ({\n      ...base,\n      height: '28px'\n    }),\n    option: (base: any) => ({\n      ...base,\n      fontSize: '11px',\n      whiteSpace: 'nowrap',\n      overflow: 'visible',\n      textOverflow: 'clip'\n    }),\n    placeholder: (base: any) => ({\n      ...base,\n      fontSize: '11px',\n      color: '#9ca3af'\n    }),\n    singleValue: (base: any) => ({\n      ...base,\n      fontSize: '11px',\n      overflow: 'visible',\n      textOverflow: 'clip',\n      maxWidth: 'none'\n    }),\n    menu: (base: any) => ({\n      ...base,\n      width: menuWidthPx ? `${menuWidthPx}px` : base.width,\n      minWidth: menuWidthPx ? `${menuWidthPx}px` : base.minWidth,\n      maxWidth: menuWidthPx ? `${menuWidthPx}px` : '90vw'\n    }),\n    menuList: (base: any) => ({\n      ...base,\n      width: menuWidthPx ? `${menuWidthPx}px` : base.width,\n      minWidth: menuWidthPx ? `${menuWidthPx}px` : base.minWidth,\n      maxWidth: menuWidthPx ? `${menuWidthPx}px` : base.maxWidth\n    })\n  })\n\n  const formatNumericInput = (value: string) => {\n    if (!value) return ''\n    const numericValue = Number(value)\n    return Number.isFinite(numericValue) ? numericValue.toLocaleString('ko-KR') : value\n  }\n\n  const normalizeNumericInput = (value: string) => value.replace(/[^\\d]/g, '')\n\n  //  \n  const handleSendModifyRequest = async () => {\n    if (!modifyInquiryType || !modifyMessage.trim()) {\n      toast.error('  .')\n      return\n    }\n\n    if (!purchase) {\n      toast.error('    .')\n      return\n    }\n\n    setIsSendingModify(true)\n    try {\n      const subjectText = getInquiryTypeLabel(modifyInquiryType) || modifyInquiryType\n      let inquiryPayload: SupportInquiryPayload | null = null\n      const summaryLines: string[] = []\n\n      if (modifyInquiryType === 'delivery_date_change') {\n        if (!requestedDeliveryDate) {\n          toast.error('  .')\n          setIsSendingModify(false)\n          return\n        }\n        const currentDateText = purchase.delivery_request_date\n          ? formatDateInput(new Date(purchase.delivery_request_date), 'yyyy-MM-dd')\n          : '-'\n        const requestedDateText = formatDateInput(requestedDeliveryDate, 'yyyy-MM-dd')\n\n        inquiryPayload = {\n          requested_date: requestedDateText,\n          current_date: purchase.delivery_request_date || null\n        }\n        summaryLines.push(` : ${currentDateText}`)\n        summaryLines.push(` : ${requestedDateText}`)\n      }\n\n      if (modifyInquiryType === 'quantity_change') {\n        const activeRows = quantityChangeRows.filter(row => row.itemId || row.newQuantity.trim())\n        if (activeRows.length === 0) {\n          toast.error('   .')\n          setIsSendingModify(false)\n          return\n        }\n\n        const itemsPayload: QuantityChangePayloadItem[] = []\n        for (const row of activeRows) {\n          if (!row.itemId || !row.newQuantity.trim()) {\n            toast.error('    .')\n            setIsSendingModify(false)\n            return\n          }\n          const newQuantity = Number(row.newQuantity)\n          if (!Number.isFinite(newQuantity)) {\n            toast.error('   .')\n            setIsSendingModify(false)\n            return\n          }\n\n          const targetItem = selectedPurchaseItems.find((item: any) => String(item.id) === row.itemId)\n          if (!targetItem) {\n            toast.error('    .')\n            setIsSendingModify(false)\n            return\n          }\n\n          itemsPayload.push({\n            item_id: String(targetItem.id),\n            line_number: targetItem.line_number ?? null,\n            item_name: targetItem.item_name,\n            specification: targetItem.specification ?? null,\n            current_quantity: targetItem.quantity ?? null,\n            new_quantity: newQuantity\n          })\n          summaryLines.push(\n            `${targetItem.line_number ?? '-'} ${targetItem.item_name} (${targetItem.specification || '-'}) ` +\n            `${targetItem.quantity ?? 0}  ${newQuantity}`\n          )\n        }\n\n        inquiryPayload = { items: itemsPayload }\n      }\n\n      if (modifyInquiryType === 'price_change') {\n        const activeRows = priceChangeRows.filter(row => row.itemId || row.newValue.trim())\n        if (activeRows.length === 0) {\n          toast.error('/    .')\n          setIsSendingModify(false)\n          return\n        }\n\n        const itemsPayload: PriceChangePayloadItem[] = []\n        for (const row of activeRows) {\n          if (!row.itemId || !row.newValue.trim()) {\n            toast.error('/     .')\n            setIsSendingModify(false)\n            return\n          }\n          const newValue = Number(row.newValue)\n          if (!Number.isFinite(newValue)) {\n            toast.error('   .')\n            setIsSendingModify(false)\n            return\n          }\n\n          const targetItem = selectedPurchaseItems.find((item: any) => String(item.id) === row.itemId)\n          if (!targetItem) {\n            toast.error('    .')\n            setIsSendingModify(false)\n            return\n          }\n\n          const currentUnitPrice = Number(targetItem.unit_price_value ?? targetItem.unit_price ?? 0)\n          const currentAmount = Number(targetItem.amount_value ?? (currentUnitPrice * (targetItem.quantity ?? 0)))\n          const quantityValue = Number(targetItem.quantity ?? 0)\n\n          if (row.changeType === 'amount') {\n            const newAmount = newValue\n            const newUnitPrice = quantityValue > 0 ? newAmount / quantityValue : 0\n\n            itemsPayload.push({\n              item_id: String(targetItem.id),\n              line_number: targetItem.line_number ?? null,\n              item_name: targetItem.item_name,\n              specification: targetItem.specification ?? null,\n              change_type: 'amount',\n              current_unit_price: currentUnitPrice,\n              new_unit_price: newUnitPrice,\n              current_amount: currentAmount,\n              new_amount: newAmount\n            })\n            summaryLines.push(\n              `${targetItem.line_number ?? '-'} ${targetItem.item_name} (${targetItem.specification || '-'}) ` +\n              ` ${currentAmount.toLocaleString('ko-KR')}  ${newAmount.toLocaleString('ko-KR')}`\n            )\n          } else {\n            const newUnitPrice = newValue\n            const newAmount = quantityValue * newUnitPrice\n\n            itemsPayload.push({\n              item_id: String(targetItem.id),\n              line_number: targetItem.line_number ?? null,\n              item_name: targetItem.item_name,\n              specification: targetItem.specification ?? null,\n              change_type: 'unit_price',\n              current_unit_price: currentUnitPrice,\n              new_unit_price: newUnitPrice,\n              current_amount: currentAmount,\n              new_amount: newAmount\n            })\n            summaryLines.push(\n              `${targetItem.line_number ?? '-'} ${targetItem.item_name} (${targetItem.specification || '-'}) ` +\n              ` ${currentUnitPrice.toLocaleString('ko-KR')}  ${newUnitPrice.toLocaleString('ko-KR')} ` +\n              ` ${currentAmount.toLocaleString('ko-KR')}  ${newAmount.toLocaleString('ko-KR')}`\n            )\n          }\n        }\n\n        inquiryPayload = { items: itemsPayload }\n      }\n\n      if (modifyInquiryType === 'delete') {\n        inquiryPayload = { reason: modifyMessage.trim() }\n      }\n\n      let purchaseInfo = ''\n      const itemsText = selectedPurchaseItems.map((item: any, index: number) =>\n        `- ${item.line_number ?? index + 1}. ${item.item_name} (${item.specification || '-'}) ${item.quantity}`\n      ).join('\\n')\n      purchaseInfo = `: ${purchase.purchase_order_number || '()'}\n: ${purchase.vendor_name}\n: ${purchase.requester_name}\n: ${purchase.request_date || purchase.created_at || '-'}\n:\n${itemsText}`\n\n      const messageSections = [modifyMessage.trim()]\n      if (summaryLines.length > 0) {\n        messageSections.push(`[ ]\\n${summaryLines.join('\\n')}`)\n      }\n      if (purchaseInfo) {\n        messageSections.push(`[  ]\\n${purchaseInfo}`)\n      }\n      const finalMessage = messageSections.join('\\n\\n')\n\n      const purchaseIdValue = Number(purchase.id)\n      const purchaseRequestId = Number.isFinite(purchaseIdValue) ? purchaseIdValue : undefined\n\n      const result = await supportService.createInquiry({\n        inquiry_type: modifyInquiryType as any,\n        subject: subjectText,\n        message: finalMessage,\n        purchase_request_id: purchaseRequestId,\n        purchase_info: purchaseInfo,\n        purchase_order_number: purchase.purchase_order_number,\n        attachments: [],\n        inquiry_payload: inquiryPayload\n      })\n\n      if (result.success) {\n        toast.success('  .')\n        setIsModifyRequestOpen(false)\n        setModifyInquiryType('')\n        setModifyMessage('')\n        setRequestedDeliveryDate(undefined)\n        setQuantityChangeRows([])\n        setPriceChangeRows([])\n      } else {\n        toast.error(result.error || '     .')\n      }\n    } catch (error) {\n      logger.error('   ', error)\n      toast.error('     .')\n    } finally {\n      setIsSendingModify(false)\n    }\n  }\n\n  const addQuantityRow = () => {\n    setQuantityChangeRows(prev => [\n      ...prev,\n      { id: createRowId(), itemId: '', newQuantity: '' }\n    ])\n  }\n\n  const updateQuantityRow = (rowId: string, updates: Partial<QuantityChangeRow>) => {\n    setQuantityChangeRows(prev =>\n      prev.map(row => row.id === rowId ? { ...row, ...updates } : row)\n    )\n  }\n\n  const removeQuantityRow = (rowId: string) => {\n    setQuantityChangeRows(prev => prev.filter(row => row.id !== rowId))\n  }\n\n  const addPriceRow = () => {\n    setPriceChangeRows(prev => [\n      ...prev,\n      { id: createRowId(), itemId: '', changeType: 'unit_price', newValue: '' }\n    ])\n  }\n\n  const updatePriceRow = (rowId: string, updates: Partial<PriceChangeRow>) => {\n    setPriceChangeRows(prev =>\n      prev.map(row => row.id === rowId ? { ...row, ...updates } : row)\n    )\n  }\n\n  const removePriceRow = (rowId: string) => {\n    setPriceChangeRows(prev => prev.filter(row => row.id !== rowId))\n  }\n\n  //    useEffect \n\n  //  isEditing  ref  (    )\n  const isEditingRef = useRef(isEditing)\n  useEffect(() => {\n    isEditingRef.current = isEditing\n  }, [isEditing])\n  \n  //  isSaving  ref  (  refresh    )\n  const isSavingRef = useRef(isSaving)\n  useEffect(() => {\n    isSavingRef.current = isSaving\n  }, [isSaving])\n  \n  //   (Realtime/   )  \n  const lastSaveAtRef = useRef<number>(0)\n  //     /( 1    ) \n  const lastAddItemAtRef = useRef<number>(0)\n\n  //  Realtime   -         \n  const realtimeFirstMount = useRef(true)\n  const isUpdatingRef = useRef(false)  //     (  )\n  useEffect(() => {\n    if (!isOpen || !purchaseId) return\n\n    const handleCacheUpdate = () => {\n      if (realtimeFirstMount.current) {\n        realtimeFirstMount.current = false\n        return\n      }\n      //        (  )\n      if (isEditingRef.current) {\n        return\n      }\n      //          ( 0   )\n      if (isSavingRef.current) {\n        return\n      }\n      if (lastSaveAtRef.current && Date.now() - lastSaveAtRef.current < 30000) {\n        logger.debug('[PurchaseDetailModal]  (30s) - Realtime   ')\n        return\n      }\n      //      (  )\n      if (isUpdatingRef.current) {\n        logger.debug('[PurchaseDetailModal]    - Realtime  ')\n        return\n      }\n      //       \n      const updatedPurchase = findPurchaseInMemory(purchaseId)\n      if (updatedPurchase) {\n        //   :   items   items \n        const cacheItems = updatedPurchase.items || updatedPurchase.purchase_request_items || []\n        \n        setPurchase(prev => {\n          //  items \n          const currentItems = prev?.items || prev?.purchase_request_items || []\n          \n          //  items   items   items \n          const preservedItems = (cacheItems.length === 0 && currentItems.length > 0) \n            ? currentItems \n            : cacheItems\n          \n          //  items     \n          if (cacheItems.length === 0 && currentItems.length === 0 && prev) {\n            logger.debug('[PurchaseDetailModal] / items   -  ')\n            return prev\n          }\n          \n          return {\n            ...updatedPurchase,\n            id: String(updatedPurchase.id),\n            is_po_generated: false,\n            items: preservedItems,\n            purchase_request_items: preservedItems\n          } as PurchaseRequestWithDetails\n        })\n      }\n    }\n\n    const unsubscribe = addCacheListener(handleCacheUpdate)\n    return () => unsubscribe()\n  }, [isOpen, purchaseId])\n\n  //   items  ( purchase state  )\n  const currentItems = useMemo(() => {\n    // purchase state   (   )\n    if (purchase?.items && purchase.items.length > 0) {\n      return normalizeItems(purchase.items);\n    }\n    if (purchase?.purchase_request_items && purchase.purchase_request_items.length > 0) {\n      return normalizeItems(purchase.purchase_request_items);\n    }\n    \n    // purchase state    \n    if (purchaseId && allPurchases) {\n      const memoryPurchase = allPurchases.find(p => p.id === purchaseId);\n      if (memoryPurchase) {\n        const memoryItems = (memoryPurchase.items && memoryPurchase.items.length > 0)\n          ? memoryPurchase.items\n          : (memoryPurchase.purchase_request_items || []);\n        return normalizeItems(memoryItems);\n      }\n    }\n    \n    return [];\n  }, [purchase, purchaseId, allPurchases, lastFetch, normalizeItems]); // purchase       \n\n  //   :      ,   line_number \n  const displayItems = useMemo(() => {\n    if (isEditing) return editedItems || []\n    const base = currentItems || []\n    return [...base].sort((a, b) => {\n      const la = a?.line_number ?? 999999\n      const lb = b?.line_number ?? 999999\n      if (la !== lb) return la - lb\n      // tie-breakers to keep stable order\n      const ca = a?.created_at ? new Date(a.created_at).getTime() : 0\n      const cb = b?.created_at ? new Date(b.created_at).getTime() : 0\n      if (ca !== cb) return ca - cb\n      const ia = a?.id ?? 0\n      const ib = b?.id ?? 0\n      if (ia !== ib) return ia - ib\n      const ta = a?.tempId ?? ''\n      const tb = b?.tempId ?? ''\n      if (ta < tb) return -1\n      if (ta > tb) return 1\n      return 0\n    })\n  }, [isEditing, editedItems, currentItems])\n\n  //  SortableContext items     (  )\n  const sortableIds = useMemo(() => {\n    return (editedItems || []).map((item, idx) => getSortableId(item, idx))\n  }, [editedItems, getSortableId])\n\n  const tableMinWidth = useMemo(() => {\n    if (columnWidths.length > 0) {\n      const columnGap = columnWidths.length > 1 ? (columnWidths.length - 1) * 12 : 0\n      const padding = 24\n      const total = columnWidths.reduce((sum, width) => sum + width, 0) + columnGap + padding\n      return Math.max(total, 720)\n    }\n\n    const baseColumns: number[] = [120, 200, 70, 90, 100, 150, 80] // , , , , , , \n\n    if (activeTab === 'purchase') {\n      baseColumns.push(120)\n    }\n\n    if (activeTab === 'receipt' || activeTab === 'done') {\n      baseColumns.push(120)\n    }\n\n    if (activeTab === 'receipt') {\n      baseColumns.push(140)\n    }\n\n    if (activeTab === 'done') {\n      baseColumns.push(100, 80, 110) // (100), (80), (110)\n    }\n\n    if (isEditing) {\n      baseColumns.push(110)\n    }\n\n    const columnGap = baseColumns.length > 1 ? (baseColumns.length - 1) * 12 : 0\n    const total = baseColumns.reduce((sum, width) => sum + width, 0) + columnGap + 48\n    return Math.max(total, 720)\n  }, [columnWidths, activeTab, isEditing])\n  const headerRowRef = useRef<HTMLDivElement>(null)\n  const supabase = createClient()\n  \n  //      \n  useEffect(() => {\n    const loadUserRoles = async () => {\n      try {\n        // Supabase   \n        const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\n        const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;\n        \n        if (!supabaseUrl || !supabaseAnonKey || supabaseUrl.includes('placeholder')) {\n          logger.warn('Supabase     - PurchaseDetailModal');\n          return;\n        }\n\n        const { data: { user } } = await supabase.auth.getUser()\n        if (user) {\n          //  ID \n          let { data: employeeData } = await supabase\n            .from('employees')\n            .select('*')\n            .eq('id', user.id)\n            .maybeSingle()\n          \n          // ID    \n          if (!employeeData && user.email) {\n            const { data: employeeByEmail } = await supabase\n              .from('employees')\n              .select('*')\n              .eq('email', user.email)\n              .maybeSingle()\n            \n            employeeData = employeeByEmail\n          }\n          \n          //   \n          if (employeeData?.name) {\n            setCurrentUserName(employeeData.name)\n          }\n          \n          if (employeeData?.purchase_role) {\n            let roles: string[] = []\n            if (Array.isArray(employeeData.purchase_role)) {\n              roles = employeeData.purchase_role.map((r: any) => String(r).trim())\n            } else {\n              const roleString = String(employeeData.purchase_role)\n              roles = roleString\n                .split(',')\n                .map((r: string) => r.trim())\n                .filter((r: string) => r.length > 0)\n            }\n            setUserRoles(roles)\n          }\n        }\n      } catch (error) {\n        logger.error('   :', error)\n      }\n    }\n    \n    if (isOpen) {\n      loadUserRoles()\n    }\n  }, [isOpen])\n\n  //   \n  useEffect(() => {\n    const loadVendors = async () => {\n      try {\n        const { data: vendorsData, error } = await supabase\n          .from('vendors')\n          .select('*')\n          .order('vendor_name', { ascending: true })\n        \n        if (error) throw error\n        if (vendorsData) {\n          setVendors(vendorsData)\n        }\n      } catch (error) {\n        logger.error('   :', error)\n      }\n    }\n    \n    if (isOpen) {\n      loadVendors()\n    }\n  }, [isOpen])\n  \n  // currentUserRoles   userRoles \n  const effectiveRoles = Array.isArray(currentUserRoles) && currentUserRoles.length > 0 \n    ? currentUserRoles \n    : userRoles\n  \n  //  \n  //    (   )\n  const canEditAll = effectiveRoles.includes('final_approver') || \n                     effectiveRoles.includes('app_admin') || \n                     effectiveRoles.includes('ceo')\n  \n  // lead buyer    (/  )\n  const canEditLimited = effectiveRoles.includes('lead buyer')\n  \n  //    (      )\n  const canEdit = canEditAll || canEditLimited\n  \n  //     \n  const canViewFinancialInfo = effectiveRoles.some(role => AUTHORIZED_ROLES.includes(role))\n  \n  const showStatementColumns = purchase?.payment_category === '' && (\n    activeTab === 'done' || (activeTab === 'receipt' && effectiveRoles.includes('lead buyer'))\n  )\n  const showExpenditureColumn = purchase?.payment_category === '' && activeTab === 'done'\n  \n  //  :     (,   , lead buyer  )\n  const isApproved = purchase?.final_manager_status === 'approved';\n  const canDelete = isApproved \n    ? canEditAll  //      (lead buyer )\n    : (canEditAll || (purchase?.requester_name === currentUserName))  //  lead buyer \n  \n  //   : app_admin + lead buyer (  )\n  const canPurchase = effectiveRoles.includes('app_admin') || \n                     effectiveRoles.includes('lead buyer') || \n                     effectiveRoles.includes('lead buyer')\n  \n  //    \n  // 1.      \n  // 2.      \n  const canReceiveItems = effectiveRoles.includes('app_admin') || \n                         (purchase?.requester_name === currentUserName)\n  // 2.        \n  const isAdmin = effectiveRoles.includes('final_approver') || \n                  effectiveRoles.includes('app_admin') || \n                  effectiveRoles.includes('ceo')\n  const isRequester = purchase?.requester_name === currentUserName\n  \n  //   & UTK  : app_admin lead buyer, accounting \n  const canReceiptCheck = effectiveRoles.includes('app_admin') || \n                         effectiveRoles.includes('lead buyer') ||\n                         effectiveRoles.includes('accounting')\n  \n  //   : app_admin    \n  const canProcessReceipt = effectiveRoles.includes('app_admin') || isRequester\n  \n  //      (  )\n  const refreshModalData = useCallback(async () => {\n    if (!purchaseId) return\n    //  /  DB  edited state  \n    if (isEditingRef.current || isSavingRef.current) {\n      logger.debug('[refreshModalData] /  - DB  ', {\n        isEditing: isEditingRef.current,\n        isSaving: isSavingRef.current\n      })\n      return\n    }\n    \n    try {\n      //  DB    vendor_contacts   \n      //   vendor_contacts    \n      const supabase = createClient()\n      //     \n      //  purchase_requests  \n      const { data, error } = await supabase\n        .from('purchase_requests')\n        .select(`\n          *,\n          vendors:vendor_id(id, vendor_name, is_active),\n          purchase_request_items(*),\n          contact:contact_id(id, contact_name, contact_email, contact_phone, position)\n        `)\n        .eq('id', purchaseId)\n        .single()\n      \n      if (error) throw error\n      \n      // vendor_id      ,      \n      let vendorContacts = []\n      if (data && data.vendor_id) {\n        const { data: allContacts } = await supabase\n          .from('vendor_contacts')\n          .select('id, contact_name, contact_email, contact_phone, position')\n          .eq('vendor_id', data.vendor_id)\n          .order('contact_name')\n        \n        if (allContacts && allContacts.length > 0) {\n          // contact_id     \n          if (data.contact_id) {\n            const currentContact = allContacts.find((c: any) => c.id === data.contact_id)\n            const otherContacts = allContacts.filter((c: any) => c.id !== data.contact_id)\n            vendorContacts = currentContact ? [currentContact, ...otherContacts] : allContacts\n          } else {\n            vendorContacts = allContacts\n          }\n          logger.info('    :', {\n            vendor_id: data.vendor_id,\n            contact_id: data.contact_id,\n            allContacts_count: allContacts.length,\n            vendorContacts\n          })\n        }\n      } else if (data && data.contact) {\n        // vendor_id   contact  \n        vendorContacts = [data.contact]\n      }\n\n      if (data) {\n        //   \n        const sortedItems = normalizeItems((data.purchase_request_items || []).sort((a: any, b: any) => {\n          const lineA = a.line_number || 999999;\n          const lineB = b.line_number || 999999;\n          return lineA - lineB;\n        }));\n\n        //  DB     \n        const itemsData = sortedItems.map(item => ({\n          id: item.id,\n          item_name: item.item_name,\n          amount_value: item.amount_value,\n          unit_price_value: item.unit_price_value,\n          quantity: item.quantity\n        }))\n        logger.info(' [refreshModalData] DB   :', { itemsData })\n        \n        //  0     ( null  )\n        itemsData.forEach(item => {\n          if (item.amount_value === 0 && item.unit_price_value != null && item.unit_price_value !== 0) {\n            logger.warn(' [refreshModalData]  0   :', {\n              itemId: item.id,\n              item_name: item.item_name,\n              amount_value: item.amount_value,\n              unit_price_value: item.unit_price_value,\n              quantity: item.quantity,\n              calculated_amount: (item.quantity || 0) * (item.unit_price_value || 0)\n            })\n          }\n        })\n\n        const purchaseData = {\n          ...data,\n          items: sortedItems,\n          vendor: data.vendors || null,\n          vendor_contacts: vendorContacts,\n          contact_id: data.contact_id,  // contact_id \n          contact_name: vendorContacts[0]?.contact_name || data.contact?.contact_name || null  // contact_name \n        } as PurchaseRequestWithDetails\n\n        setPurchase({\n          ...purchaseData,\n          items: sortedItems\n        })\n        setEditedPurchase(purchaseData)\n        setEditedItems(sortedItems)\n        logger.info(' refreshModalData DB  :', { \n          vendor_contacts: purchaseData.vendor_contacts,\n          vendorContacts_from_query: vendorContacts,\n          purchase_updated: true,\n          vendor_id: data.vendor_id,\n          has_vendor_contacts: vendorContacts && vendorContacts.length > 0\n        })\n        logger.debug('refreshModalData - DB  :', {\n          vendor_id: data.vendor_id,\n          vendor_contacts: vendorContacts,\n          purchaseData_full: purchaseData,\n          : vendorContacts?.[0]?.contact_name || ''\n        })\n      }\n    } catch (error) {\n      logger.error('   ', error)\n    }\n  }, [purchaseId])\n\n  //    Realtime    \n  const refreshModalDataWithLock = useCallback(async () => {\n    isUpdatingRef.current = true\n    try {\n      await refreshModalData()\n    } finally {\n      //      (Realtime     )\n      setTimeout(() => {\n        isUpdatingRef.current = false\n      }, 3000)\n    }\n  }, [refreshModalData])\n\n  // UTK    ( : / )\n  const handleToggleUtkCheck = useCallback(async () => {\n    if (!purchase) return\n    if (!canReceiptCheck || !canViewFinancialInfo) return\n\n    const isCurrentlyChecked = purchase.is_utk_checked || false\n    const newStatus = !isCurrentlyChecked\n\n    const confirmMessage = newStatus\n      ? `: ${purchase.purchase_order_number}\\n\\nUTK  ?`\n      : `: ${purchase.purchase_order_number}\\n\\nUTK  ?`\n\n    if (!window.confirm(confirmMessage)) return\n\n    try {\n      const supabase = createClient()\n      const { error } = await supabase\n        .from('purchase_requests')\n        .update({ is_utk_checked: newStatus })\n        .eq('id', purchase.id)\n\n      if (error) {\n        logger.error('UTK  DB  ', { error, purchaseId: purchase.id })\n        toast.error('UTK     .')\n        return\n      }\n\n      //     (   React  )\n      setPurchase(prev => prev ? {\n        ...prev,\n        is_utk_checked: newStatus,\n        updated_at: new Date().toISOString() //    \n      } : null)\n\n      //   \n      if (purchase.id) {\n        updatePurchaseInMemory(purchase.id, (prev) => ({\n          ...prev,\n          is_utk_checked: newStatus\n        }))\n      }\n\n      toast.success(newStatus ? 'UTK  .' : 'UTK  .')\n\n      await refreshModalDataWithLock()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      logger.error('UTK    ', error)\n      toast.error('UTK     .')\n    }\n  }, [purchase, canReceiptCheck, canViewFinancialInfo, onRefresh, refreshModalDataWithLock])\n\n  //          \n  useEffect(() => {\n    if (!purchaseId || !allPurchases || !purchase) return;\n    //          \n    if (isEditing || isSaving) return;\n\n    const memoryPurchase = allPurchases.find(p => p.id === purchaseId);\n    if (memoryPurchase) {\n      //   purchase state  (   )\n      const normalizedItems = normalizeItems((memoryPurchase.items && memoryPurchase.items.length > 0) \n        ? memoryPurchase.items \n        : (memoryPurchase.purchase_request_items || []));\n      \n      const updatedPurchase = {\n        ...purchase,\n        ...memoryPurchase,\n        id: String(memoryPurchase.id),\n        items: normalizedItems,\n        purchase_request_items: normalizedItems\n      } as PurchaseRequestWithDetails;\n\n      setPurchase(updatedPurchase);\n      setEditedPurchase(updatedPurchase);\n      setEditedItems(normalizedItems.length > 0 ? normalizedItems : []);\n    }\n  }, [allPurchases, lastFetch, isEditing, isSaving]); // isEditing, isSaving  \n\n  //         \n  useEffect(() => {\n    if (!isOpen || !purchaseId || !allPurchases) return;\n    //          \n    if (isEditing || isSaving) return;\n\n    const memoryPurchase = allPurchases.find(p => p.id === purchaseId);\n    if (memoryPurchase) {\n      const normalizedItems = normalizeItems((memoryPurchase.items && memoryPurchase.items.length > 0) \n        ? memoryPurchase.items \n        : (memoryPurchase.purchase_request_items || []));\n      \n      const updatedPurchase = {\n        ...memoryPurchase,\n        id: String(memoryPurchase.id),\n        is_po_generated: false,\n        items: normalizedItems,\n        purchase_request_items: normalizedItems,\n        vendor: {\n          id: memoryPurchase.vendor_id,\n          vendor_name: memoryPurchase.vendor_name || '  ',\n          is_active: true,\n          created_at: new Date().toISOString(),\n          updated_at: new Date().toISOString()\n        } as Vendor,\n        vendor_contacts: []\n      } as PurchaseRequestWithDetails;\n\n      setPurchase(updatedPurchase);\n      setEditedPurchase(updatedPurchase);\n      setEditedItems(normalizedItems.length > 0 ? normalizedItems : []);\n    }\n  }, [isOpen, purchaseId, allPurchases, isEditing, isSaving]); // isEditing, isSaving  \n  \n  //       \n  const [isInitialLoad, setIsInitialLoad] = useState(true)\n  \n  //   \n  const purchaseIdNumber = purchaseId ? Number(purchaseId) : (purchase ? Number(purchase.id) : NaN)\n\n  const handleActualReceiptOptimisticUpdate = useCallback(({ itemId, selectedDate, action, receivedQuantity }: {\n    itemId: number\n    selectedDate?: Date\n    action: 'confirm' | 'cancel'\n    receivedQuantity?: number\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n      received_quantity?: number\n    }\n  }) => {\n    const itemIdStr = String(itemId)\n    const nowIso = new Date().toISOString()\n    const selectedDateIso = selectedDate ? dateToISOString(selectedDate) : undefined\n\n    const updateItems = (items?: any[]) => {\n      if (!items) return items\n      return items.map(item => {\n        if (String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_received: true,\n            actual_received_date: selectedDateIso,\n            received_at: nowIso,\n            received_quantity: receivedQuantity !== undefined ? receivedQuantity : item.received_quantity\n          }\n        }\n\n        return {\n          ...item,\n          is_received: false,\n          actual_received_date: undefined,\n          received_at: undefined,\n          received_quantity: undefined\n        }\n      })\n    }\n\n    setPurchase(prev => {\n      if (!prev) return prev\n      const updatedItems = updateItems(prev.items) || []\n      const updatedRequestItems = updateItems(prev.purchase_request_items) || []\n      const total = updatedItems.length\n      const completed = updatedItems.filter(item => item.is_received).length\n      const allReceived = total > 0 && completed === total\n\n      return {\n        ...prev,\n        items: updatedItems,\n        purchase_request_items: updatedRequestItems,\n        is_received: allReceived,\n        received_at: allReceived ? (prev.received_at || nowIso) : undefined,\n        updated_at: new Date().toISOString()\n      }\n    })\n\n    setEditedPurchase(prev => {\n      if (!prev) return prev\n      const updatedItems = updateItems(prev.items) || []\n      const updatedRequestItems = updateItems(prev.purchase_request_items) || []\n      return {\n        ...prev,\n        items: updatedItems,\n        purchase_request_items: updatedRequestItems\n      }\n    })\n\n    setEditedItems(prevItems => {\n      if (!prevItems || prevItems.length === 0) return prevItems\n      return prevItems.map(item => {\n        if (!item.id || String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_received: true,\n            actual_received_date: selectedDateIso,\n            received_at: nowIso,\n            received_quantity: receivedQuantity !== undefined ? receivedQuantity : item.received_quantity\n          }\n        }\n\n        return {\n          ...item,\n          is_received: false,\n          actual_received_date: undefined,\n          received_at: undefined,\n          received_quantity: undefined\n        }\n      })\n    })\n\n    if (!Number.isNaN(purchaseIdNumber)) {\n      onOptimisticUpdate?.(purchaseIdNumber, prevPurchase => {\n        const updatedItems = updateItems(prevPurchase.items) || prevPurchase.items || []\n        const updatedRequestItems = updateItems(prevPurchase.purchase_request_items) || prevPurchase.purchase_request_items || []\n        const total = updatedItems.length || prevPurchase.items?.length || 0\n        const completed = updatedItems.filter(item => item.is_received).length\n        const allReceived = total > 0 && completed === total\n\n        return {\n          ...prevPurchase,\n          items: updatedItems,\n          purchase_request_items: updatedRequestItems,\n          is_received: allReceived,\n          received_at: allReceived ? (prevPurchase.received_at || nowIso) : undefined,\n          updated_at: new Date().toISOString()\n        }\n      })\n    }\n  }, [onOptimisticUpdate, purchaseIdNumber])\n\n  const handleStatementReceivedOptimisticUpdate = useCallback(({ itemId, selectedDate, action }: {\n    itemId: number\n    selectedDate?: Date\n    action: 'confirm' | 'cancel'\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n    }\n  }) => {\n    const itemIdStr = String(itemId)\n    const selectedDateIso = selectedDate ? dateToISOString(selectedDate) : undefined\n\n    let nextAllCompleted = false\n    let nextStatementAt: string | null = null\n\n    setPurchase(prev => {\n      if (!prev) return prev\n\n      const updatedItems = (prev.items || []).map(item => {\n        if (String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_statement_received: true,\n            statement_received_date: selectedDateIso,\n            statement_received_by_name: currentUserName\n          }\n        }\n\n        return {\n          ...item,\n          is_statement_received: false,\n          statement_received_date: null,\n          statement_received_by_name: null\n        }\n      })\n\n      nextAllCompleted = updatedItems.length > 0 && updatedItems.every(item => item.is_statement_received)\n      nextStatementAt = nextAllCompleted\n        ? (selectedDateIso || prev.statement_received_at || new Date().toISOString())\n        : null\n\n      return {\n        ...prev,\n        items: updatedItems,\n        is_statement_received: nextAllCompleted,\n        statement_received_at: nextStatementAt\n      }\n    })\n\n    setEditedPurchase(prev => {\n      if (!prev) return prev\n\n      const updatedItems = (prev.items || []).map(item => {\n        if (String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_statement_received: true,\n            statement_received_date: selectedDateIso,\n            statement_received_by_name: currentUserName\n          }\n        }\n\n        return {\n          ...item,\n          is_statement_received: false,\n          statement_received_date: null,\n          statement_received_by_name: null\n        }\n      })\n\n      return {\n        ...prev,\n        items: updatedItems,\n        is_statement_received: nextAllCompleted,\n        statement_received_at: nextStatementAt\n      }\n    })\n\n    setEditedItems(prevItems => {\n      if (!prevItems) return prevItems\n      return prevItems.map(item => {\n        if (String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_statement_received: true,\n            statement_received_date: selectedDateIso,\n            statement_received_by_name: currentUserName\n          }\n        }\n\n        return {\n          ...item,\n          is_statement_received: false,\n          statement_received_date: null,\n          statement_received_by_name: null\n        }\n      })\n    })\n\n    if (!Number.isNaN(purchaseIdNumber)) {\n      onOptimisticUpdate?.(purchaseIdNumber, prevPurchase => {\n        const updatedItems = (prevPurchase.items || []).map(item => {\n          if (String(item.id) !== itemIdStr) return item\n\n          if (action === 'confirm') {\n            return {\n              ...item,\n              is_statement_received: true,\n              statement_received_date: selectedDateIso,\n              statement_received_by_name: currentUserName\n            }\n          }\n\n          return {\n            ...item,\n            is_statement_received: false,\n            statement_received_date: null,\n            statement_received_by_name: null\n          }\n        })\n\n        const allCompleted = updatedItems.length > 0 && updatedItems.every(item => item.is_statement_received)\n\n        return {\n          ...prevPurchase,\n          items: updatedItems,\n          is_statement_received: allCompleted\n        }\n      })\n    }\n\n    // purchase_requests   \n    if (purchase && nextAllCompleted !== undefined) {\n      const supabase = createClient()\n      supabase\n        .from('purchase_requests')\n        .update({\n          is_statement_received: nextAllCompleted,\n          statement_received_at: nextStatementAt\n        })\n        .eq('id', purchase.id)\n        .then(({ error }: { error: any }) => {\n          if (error) {\n            logger.error('  purchase_requests  ', error)\n          }\n        })\n    }\n  }, [currentUserName, onOptimisticUpdate, purchaseIdNumber, purchase])\n\n  //     Realtime    \n  const handleBeforeUpdate = useCallback(() => {\n    isUpdatingRef.current = true\n    logger.debug('[PurchaseDetailModal]   - Realtime   ')\n  }, [])\n\n  const statementReceivedAction = useConfirmDateAction({\n    config: {\n      field: 'statement_received',\n      confirmMessage: {\n        confirm: '  ?',\n        cancel: '  ?'\n      },\n      successMessage: {\n        confirm: '  .',\n        cancel: '  .'\n      },\n      completedText: ' ',\n      waitingText: ''\n    },\n    currentUserName,\n    canPerformAction: canReceiptCheck,\n    purchaseId: purchase?.id,\n    onBeforeUpdate: handleBeforeUpdate,\n    onUpdate: refreshModalDataWithLock,\n    onOptimisticUpdate: handleStatementReceivedOptimisticUpdate\n  })\n\n  const actualReceivedAction = useConfirmDateAction({\n    config: {\n      field: 'actual_received',\n      confirmMessage: {\n        confirm: '   ?',\n        cancel: '   ?'\n      },\n      successMessage: {\n        confirm: '   .',\n        cancel: '   .'\n      },\n      completedText: '',\n      waitingText: ''\n    },\n    currentUserName,\n    canPerformAction: canProcessReceipt,\n    purchaseId: purchase?.id,\n    onBeforeUpdate: handleBeforeUpdate,\n    onUpdate: refreshModalDataWithLock,\n    onOptimisticUpdate: handleActualReceiptOptimisticUpdate\n  })\n  \n  //   \n  \n  \n  //   \n const canApproveMiddle = effectiveRoles.includes('middle_manager') || \n                          effectiveRoles.includes('app_admin') || \n                          effectiveRoles.includes('ceo')\n \n const canApproveFinal = effectiveRoles.includes('final_approver') || \n                         effectiveRoles.includes('app_admin') || \n                         effectiveRoles.includes('ceo')\n \n const approvalPillClass = 'inline-flex items-center gap-1 business-radius-badge px-2 py-0.5 badge-text leading-tight'\n const approvalButtonClass = 'inline-flex items-center gap-1 business-radius-badge !h-auto !min-h-0 !px-2.5 !py-0.5 badge-text leading-tight'\n const approvalWaitingPillClass = 'inline-flex items-center gap-1 business-radius-badge px-2.5 py-0.5 badge-text leading-tight'\n \n \n  useEffect(() => {\n    if (purchaseId && isOpen) {\n      //       \n      const memoryPurchase = findPurchaseInMemory(purchaseId)\n      if (memoryPurchase) {\n        //     (loading  )\n        const purchaseData = {\n          ...memoryPurchase,\n          id: String(memoryPurchase.id), // PurchaseRequest id string\n          is_po_generated: false, // Purchase   PurchaseRequest \n          vendor: (memoryPurchase as any).vendor || (memoryPurchase.vendor_id ? {\n            id: memoryPurchase.vendor_id,\n            vendor_name: memoryPurchase.vendor_name || '  ',\n            is_active: true,\n            created_at: new Date().toISOString(),\n            updated_at: new Date().toISOString()\n          } as Vendor : null),\n          vendor_contacts: (memoryPurchase as any).vendor_contacts || []\n        } as PurchaseRequestWithDetails\n        \n        setPurchase(purchaseData)\n        setEditedPurchase(purchaseData)\n        setEditedItems(memoryPurchase.items || [])\n      } else {\n        //     \n        loadPurchaseDetail(purchaseId.toString())\n      }\n      setIsEditing(false) //      \n      \n      //   \n      loadLinkedStatements(purchaseId)\n    }\n  }, [purchaseId, isOpen])\n\n  //   \n  const loadLinkedStatements = async (purchaseId: number) => {\n    try {\n      const result = await transactionStatementService.getStatementsByPurchaseId(purchaseId)\n      if (result.success && result.data) {\n        setLinkedStatements(result.data)\n      }\n    } catch (e) {\n      //    (   )\n      setLinkedStatements([])\n    }\n  }\n\n  //    (  )\n  const handleViewStatementImage = (imageUrl: string) => {\n    const width = 1000\n    const height = 800\n    const left = (window.screen.width - width) / 2\n    const top = (window.screen.height - height) / 2\n    window.open(\n      imageUrl, \n      '_blank', \n      `width=${width},height=${height},left=${left},top=${top},scrollbars=yes,resizable=yes`\n    )\n  }\n\n  //    (  )\n  const calculateOptimalColumnWidths = useCallback(() => {\n    // items purchase_request_items   \n    const items = (purchase?.items && purchase.items.length > 0) \n      ? purchase.items \n      : (purchase?.purchase_request_items && purchase.purchase_request_items.length > 0)\n      ? purchase.purchase_request_items\n      : []\n    \n    if (items.length === 0) return []\n\n    const columnConfigs = [\n      { key: 'line_number', minWidth: 32, maxWidth: 32, baseWidth: 32, isFixed: true }, //  \n      { key: 'item_name', minWidth: 80, maxWidth: 500, baseWidth: 80 },\n      { key: 'specification', minWidth: 80, maxWidth: 200, baseWidth: 150, isFixed: false }, //   (80px~200px)\n      { key: 'quantity', minWidth: 70, maxWidth: 120, baseWidth: 70 }, // 100/0   maxWidth \n      { key: 'unit_price', minWidth: 90, maxWidth: 150, baseWidth: 90 },\n      { key: 'total_price', minWidth: 100, maxWidth: 180, baseWidth: 100 },\n    ]\n    \n    //     \n    if (purchase?.payment_category === '') {\n      columnConfigs.push({ key: 'tax_amount', minWidth: 80, maxWidth: 150, baseWidth: 80 })\n    }\n    \n    //    ( ,  )\n    columnConfigs.push({ key: 'link', minWidth: 60, maxWidth: 80, baseWidth: 60, isFixed: true })\n    \n    columnConfigs.push(\n      { key: 'remarks', minWidth: 150, maxWidth: 150, baseWidth: 150, isFixed: true } //   150px\n    )\n    \n    // pending      \n    if (activeTab !== 'pending') {\n      columnConfigs.push(\n        { key: 'status', minWidth: 70, maxWidth: 100, baseWidth: 70 } //    \n      )\n    }\n\n      //   ()\n      if (activeTab === 'receipt') {\n        columnConfigs.push(\n          { key: 'actual_receipt_date', minWidth: 100, maxWidth: 160, baseWidth: 100, isFixed: false }\n        )\n        if (showStatementColumns) {\n          columnConfigs.push(\n            { key: 'transaction_confirm', minWidth: 85, maxWidth: 120, baseWidth: 85, isFixed: false },\n            { key: 'accounting_date', minWidth: 70, maxWidth: 70, baseWidth: 70, isFixed: true }\n          )\n        }\n      }\n      if (activeTab === 'done' && purchase?.payment_category === '') {\n        columnConfigs.push(\n          { key: 'transaction_confirm', minWidth: 85, maxWidth: 120, baseWidth: 85, isFixed: false }, //     \n          { key: 'accounting_date', minWidth: 70, maxWidth: 70, baseWidth: 70, isFixed: true }, //     \n          { key: 'expenditure_info', minWidth: 90, maxWidth: 150, baseWidth: 90, isFixed: false } //    \n        )\n      }\n\n    const calculatedWidths = columnConfigs.map((config, index) => {\n      let maxLength = 4 //  4\n\n      //     ()\n      const getHeaders = () => {\n        const statusHeader = activeTab === 'purchase'\n          ? ''\n          : (activeTab === 'receipt' || activeTab === 'done')\n          ? ''\n          : ''\n\n        //    \n        // receipt, done  '/ '    \n        const quantityHeader = (activeTab === 'receipt' || activeTab === 'done') \n          ? '/ ' \n          : ''\n        const baseHeaders = activeTab === 'pending' \n          ? ['#', '', '', quantityHeader, '', '', purchase?.payment_category === '' ? '' : null, ''].filter(h => h !== null)\n          : ['#', '', '', quantityHeader, '', '', purchase?.payment_category === '' ? '' : null, '', statusHeader].filter(h => h !== null)\n        if (activeTab === 'receipt') {\n          const receiptHeaders = [...baseHeaders, '']\n          if (showStatementColumns) {\n            receiptHeaders.push(' ', ' ')\n          }\n          return receiptHeaders\n        } else if (activeTab === 'done') {\n          const doneHeaders = [...baseHeaders]\n          if (showStatementColumns) {\n            doneHeaders.push(' ', ' ')\n            if (showExpenditureColumn) {\n              doneHeaders.push('')\n            }\n          }\n          return doneHeaders\n        }\n        return baseHeaders\n      }\n      \n      const headers = getHeaders()\n      if (headers[index]) {\n        maxLength = Math.max(maxLength, headers[index].length)\n      }\n\n      //     \n      items.forEach(item => {\n        let cellValue = ''\n        switch (config.key) {\n          case 'line_number':\n            cellValue = item.line_number?.toString() || ''\n            break\n          case 'item_name':\n            cellValue = item.item_name || ''\n            break\n          case 'specification':\n            cellValue = item.specification || ''\n            break\n          case 'quantity':\n            // receipt, done  /  \n            if (activeTab === 'receipt' || activeTab === 'done') {\n              const quantity = item.quantity || 0\n              const receivedQuantity = item.received_quantity ?? 0\n              // 100  2      \n              //       (   /  )\n              cellValue = quantity >= 100 || receivedQuantity >= 100 \n                ? `${quantity}` // 2     \n                : `${quantity}/${receivedQuantity}` // 1   \n            } else {\n              cellValue = item.quantity?.toString() || ''\n            }\n            break\n          case 'unit_price':\n            cellValue = item.unit_price_value != null ? item.unit_price_value.toLocaleString() : ''\n            break\n          case 'total_price':\n            if (item.amount_value != null) {\n              cellValue = item.amount_value.toLocaleString()\n            } else if (item.quantity != null && item.unit_price_value != null) {\n              cellValue = (Number(item.quantity) * Number(item.unit_price_value)).toLocaleString()\n            } else {\n              cellValue = ''\n            }\n            break\n          case 'tax_amount':\n            cellValue = item.tax_amount_value != null ? item.tax_amount_value.toLocaleString() : ''\n            break\n          case 'remarks':\n            cellValue = item.remark || ''\n            break\n          case 'status':\n            cellValue = getStatusDisplay(item) || ''\n            break\n          case 'actual_receipt_date':\n            cellValue = item.actual_received_date ? formatDate(item.actual_received_date) : ''\n            break\n          case 'transaction_confirm':\n            cellValue = item.is_statement_received ? '' : ''\n            break\n          case 'accounting_date':\n            cellValue = item.statement_received_date ? formatDate(item.statement_received_date) : ''\n            break\n          case 'expenditure_info':\n            //    2   \n            if (item.expenditure_date && item.expenditure_amount !== null && item.expenditure_amount !== undefined) {\n              //   : \"2025. 11. 25.\" ( 14)\n              cellValue = '2025. 11. 25.' //    \n            } else {\n              cellValue = '' //  \n            }\n            break\n        }\n        \n        // /     ( 1.5 )\n        const adjustedLength = cellValue.split('').reduce((acc, char) => {\n          return acc + (/[-]/.test(char) ? 1.5 : 1)\n        }, 0)\n        \n        maxLength = Math.max(maxLength, Math.ceil(adjustedLength))\n      })\n\n      //     \n      if (config.isFixed) {\n        return config.baseWidth\n      }\n      \n      //    (  7px +  20px)\n      let calculatedWidth = Math.max(\n        config.minWidth,\n        Math.min(config.maxWidth, maxLength * 7 + 20)\n      )\n      \n      //      2   \n      if (config.key === 'expenditure_info') {\n        //   \"2025. 11. 25.\"  \n        // 2     \n        calculatedWidth = 110 //   \n      }\n\n      return calculatedWidth\n    })\n\n    setColumnWidths(calculatedWidths)\n    return calculatedWidths\n  }, [purchase, activeTab, showStatementColumns, showExpenditureColumn])\n\n  //     \n  const getStatusDisplay = (item: any) => {\n    if (activeTab === 'purchase') {\n      return item.is_payment_completed ? '' : ''\n    } else if (activeTab === 'receipt') {\n      return item.is_received ? '' : ''\n    }\n    return item.is_payment_completed ? '' : ''\n  }\n\n  //  gridTemplateColumns \n  const getGridTemplateColumns = () => {\n    //      (,    )\n    if (columnWidths.length > 0) {\n      const widths = columnWidths.map(width => `${width}px`)\n      \n      //      ( )\n      //      \n      \n      return widths.join(' ')\n    }\n    \n    //  (  )\n    // [, , , , , ]\n    const baseColumns = ['32px', 'minmax(80px, 1fr)', '200px', '70px', '90px', '100px']\n    \n    //     \n    if (purchase?.payment_category === '') {\n      baseColumns.push('100px') // \n    }\n    \n    //   \n    baseColumns.push('60px')\n    \n    //   \n    baseColumns.push('150px')\n    \n    // pending    /  \n    if (activeTab !== 'pending') {\n      if (isEditing) {\n        baseColumns.push('80px') // \n      } else {\n        baseColumns.push('80px') // \n      }\n    }\n    \n    //   \n    if (activeTab === 'receipt') {\n      const receiptColumns = [...baseColumns, '100px'] // \n      if (showStatementColumns) {\n        receiptColumns.push('100px', '80px') //  ,  \n      }\n      return receiptColumns.join(' ')\n    } else if (activeTab === 'done') {\n      const doneColumns = [...baseColumns]\n      if (showStatementColumns) {\n        doneColumns.push('100px', '80px') //  ,  \n        if (showExpenditureColumn) {\n          doneColumns.push('110px') // \n        }\n      }\n      return doneColumns.join(' ')\n    }\n    \n    return baseColumns.join(' ')\n  }\n\n  //  measureColumnWidths  ( )\n  const measureColumnWidths = () => {\n    calculateOptimalColumnWidths()\n  }\n\n  // View     (  )\n  //      \n  useEffect(() => {\n    // items purchase_request_items   \n    const hasItems = (purchase?.items && purchase.items.length > 0) || \n                     (purchase?.purchase_request_items && purchase.purchase_request_items.length > 0)\n    \n    if (purchase && hasItems && !isEditing) {\n      // requestAnimationFrame       \n      requestAnimationFrame(() => {\n        calculateOptimalColumnWidths()\n      })\n    }\n  }, [purchase, isEditing, activeTab, calculateOptimalColumnWidths])\n\n  // Edit     \n  const handleEditToggle = (editing: boolean) => {\n    if (editing && !isEditing) {\n      // Edit       (line_number  )\n      setEditedPurchase(purchase)\n      const sortedItems = [...(currentItems || [])].sort((a, b) => {\n        const la = a?.line_number ?? 999999\n        const lb = b?.line_number ?? 999999\n        return la - lb\n      })\n      setEditedItems(sortedItems)\n      setDeletedItemIds([])\n      // Edit      \n      calculateOptimalColumnWidths()\n    }\n    setIsEditing(editing)\n  }\n\n  const loadPurchaseDetail = async (id: string) => {\n    try {\n      //     (    )\n      const memoryPurchase = findPurchaseInMemory(id)\n      if (memoryPurchase) {\n        //   PurchaseRequestWithDetails  \n        const purchaseData = {\n          ...memoryPurchase,\n          id: String(memoryPurchase.id), // PurchaseRequest id string\n          is_po_generated: false, // Purchase   PurchaseRequest \n          vendor: (memoryPurchase as any).vendor || (memoryPurchase.vendor_id ? {\n            id: memoryPurchase.vendor_id,\n            vendor_name: memoryPurchase.vendor_name || '  ',\n            is_active: true,\n            created_at: new Date().toISOString(),\n            updated_at: new Date().toISOString()\n          } as Vendor : null),\n          vendor_contacts: (memoryPurchase as any).vendor_contacts || []\n        } as PurchaseRequestWithDetails\n        \n        setPurchase({\n          ...purchaseData,\n          items: normalizeItems(memoryPurchase.items || purchaseData.items || [])\n        })\n        setEditedPurchase(purchaseData)\n        setEditedItems(normalizeItems(memoryPurchase.items || []))\n        return\n      }\n      \n      //        DB  (fallback)\n      setLoading(true)\n      const supabase = createClient()\n      \n      //  purchase_requests  \n      const { data, error } = await supabase\n        .from('purchase_requests')\n        .select(`\n          *,\n          vendors:vendor_id(id, vendor_name, is_active),\n          purchase_request_items(*),\n          contact:contact_id(id, contact_name, contact_email, contact_phone, position)\n        `)\n        .eq('id', id)\n        .single()\n\n      if (error) throw error\n      \n      // vendor_id      ,      \n      let vendorContacts = []\n      if (data && data.vendor_id) {\n        const { data: allContacts } = await supabase\n          .from('vendor_contacts')\n          .select('id, contact_name, contact_email, contact_phone, position')\n          .eq('vendor_id', data.vendor_id)\n          .order('contact_name')\n        \n        if (allContacts && allContacts.length > 0) {\n          // contact_id     \n          if (data.contact_id) {\n            const currentContact = allContacts.find((c: any) => c.id === data.contact_id)\n            const otherContacts = allContacts.filter((c: any) => c.id !== data.contact_id)\n            vendorContacts = currentContact ? [currentContact, ...otherContacts] : allContacts\n          } else {\n            vendorContacts = allContacts\n          }\n          logger.info(' loadPurchaseDetail -    :', {\n            vendor_id: data.vendor_id,\n            contact_id: data.contact_id,\n            allContacts_count: allContacts.length,\n            vendorContacts\n          })\n        }\n      } else if (data && data.contact) {\n        // vendor_id   contact  \n        vendorContacts = [data.contact]\n      }\n\n      if (data) {\n        //   \n        const sortedItems = normalizeItems((data.purchase_request_items || []).sort((a: any, b: any) => {\n          const lineA = a.line_number || 999999;\n          const lineB = b.line_number || 999999;\n          return lineA - lineB;\n        }));\n\n        const purchaseData = {\n          ...data,\n          items: sortedItems,\n          vendor: data.vendors || null,\n          vendor_contacts: vendorContacts,\n          contact_id: data.contact_id,  // contact_id \n          contact_name: vendorContacts[0]?.contact_name || data.contact?.contact_name || null  // contact_name \n        } as PurchaseRequestWithDetails\n        setPurchase({\n          ...purchaseData,\n          items: sortedItems\n        })\n        setEditedPurchase(purchaseData)\n        setEditedItems(sortedItems)\n      }\n    } catch (error) {\n      logger.error('[PurchaseDetailModal]    :', error)\n      toast.error('    .')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const getStatusBadge = () => {\n    if (!purchase) return null\n    \n    // payment_category  \n    if (purchase.payment_category) {\n      const category = purchase.payment_category.trim()\n      \n      if (category === '') {\n        return <span className=\"badge-stats bg-green-500 text-white\"></span>\n      } else if (category === '') {\n        return <span className=\"badge-stats bg-blue-500 text-white\"></span>\n      } else if (category === '') {\n        return <span className=\"badge-stats bg-gray-500 text-white\"></span>\n      } else {\n        // payment_category      \n        return <span className=\"badge-stats bg-blue-500 text-white\">{category}</span>\n      }\n    }\n    \n    // payment_category  \n    return <span className=\"badge-stats bg-blue-500 text-white\"></span>\n  }\n\n\n  //      (NaN )\n  const safeNumber = (value: any, defaultValue: number = 0): number => {\n    if (value === null || value === undefined) return defaultValue\n\n    // ( )  \n    if (typeof value === 'string') {\n      const trimmed = value.trim()\n      if (trimmed === '') return defaultValue\n      const normalized = trimmed.replace(/,/g, '')\n      const num = Number(normalized)\n      return Number.isNaN(num) ? defaultValue : num\n    }\n\n    const num = Number(value)\n    return Number.isNaN(num) ? defaultValue : num\n  };\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat('ko-KR').format(amount)\n  }\n\n  type CurrencyCode = 'KRW' | 'USD'\n\n  const normalizeCurrency = (currency: any): CurrencyCode => {\n    return currency === 'USD' ? 'USD' : 'KRW'\n  }\n\n  const getCurrencySymbol = (currency: any) => {\n    const c = normalizeCurrency(currency)\n    return c === 'USD' ? '$' : ''\n  }\n\n  const getPurchaseDisplayCurrency = (): CurrencyCode => {\n    return normalizeCurrency(isEditing ? editedPurchase?.currency : purchase?.currency)\n  }\n\n  const getItemDisplayCurrency = (item: any): CurrencyCode => {\n    return normalizeCurrency(\n      item?.unit_price_currency ??\n        item?.amount_currency ??\n        item?.tax_amount_currency ??\n        getPurchaseDisplayCurrency()\n    )\n  }\n\n  const formatMoney = (amount: number, currency: any) => {\n    return `${getCurrencySymbol(currency)}${formatCurrency(amount)}`\n  }\n\n  //   \n  const withTimeout = <T,>(promise: PromiseLike<T>, timeoutMs: number): Promise<T> => {\n    return Promise.race([\n      Promise.resolve(promise),\n      new Promise<T>((_, reject) =>\n        setTimeout(() => reject(new Error(` ${timeoutMs}ms   .`)), timeoutMs)\n      ),\n    ])\n  }\n\n  const handleSave = async () => {\n    if (!purchase || !editedPurchase) {\n      toast.error('  .')\n      return\n    }\n    \n    //     \n    lastSaveAtRef.current = Date.now()\n    // state   ref   (useEffect   )\n    isSavingRef.current = true\n    setIsSaving(true)\n    logger.debug('[handleSave]  ')\n    \n    try {\n      const supabase = createClient()\n      const STEP_TIMEOUT_MS = 20000\n      logger.debug('[handleSave] Step 1:     ')\n      \n      //    \n      const totalAmount = editedItems.reduce((sum, item) => sum + (item.amount_value || 0), 0)\n      \n      // contact_id :  1. editedPurchase.contact_id 2. vendor_contacts[0].id 3. null\n      let contactId = null\n      if ((editedPurchase as any).contact_id) {\n        contactId = (editedPurchase as any).contact_id\n      } else if (Array.isArray(editedPurchase.vendor_contacts) && editedPurchase.vendor_contacts.length > 0) {\n        contactId = editedPurchase.vendor_contacts[0].id || null\n      }\n      \n      const updateResult = await withTimeout(\n        supabase\n          .from('purchase_requests')\n          .update({\n            purchase_order_number: editedPurchase.purchase_order_number || null,\n            requester_name: editedPurchase.requester_name || null,\n            vendor_id: editedPurchase.vendor_id || null,\n            vendor_name: editedPurchase.vendor_name || null,\n            contact_id: contactId, // contact_id \n            delivery_request_date: editedPurchase.delivery_request_date || null,\n            revised_delivery_request_date: editedPurchase.revised_delivery_request_date || null,\n            payment_category: editedPurchase.payment_category || null,\n            project_vendor: editedPurchase.project_vendor || null,\n            project_item: editedPurchase.project_item || null,\n            sales_order_number: editedPurchase.sales_order_number || null,\n            total_amount: Number(totalAmount),\n            updated_at: new Date().toISOString()\n          })\n          .eq('id', purchase.id),\n        STEP_TIMEOUT_MS\n      ) as any\n      const updateError = updateResult?.error\n\n      if (updateError) {\n        logger.error('Purchase update error:', updateError)\n        throw updateError\n      }\n      logger.debug('[handleSave] Step 1 ')\n\n      //      contact_id \n      logger.debug('[handleSave] Step 2:    ')\n      let finalContactId = null\n      \n      try {\n        if (editedPurchase.vendor_id && Array.isArray(editedPurchase.vendor_contacts) && editedPurchase.vendor_contacts.length > 0) {\n          const contact = editedPurchase.vendor_contacts[0]\n          \n          //    ,  \n          if (contact.id) {\n            finalContactId = contact.id\n            const { error: contactUpdateError } = await supabase\n              .from('vendor_contacts')\n              .update({\n                contact_name: contact.contact_name || '',\n                contact_email: contact.contact_email || '',\n                contact_phone: contact.contact_phone || '',\n                position: contact.position || ''\n              })\n              .eq('id', contact.id)\n            \n            if (contactUpdateError) {\n              logger.error('  :', contactUpdateError)\n            } else {\n              //  UI  \n              setPurchase(prev => {\n                const updated = prev ? {\n                  ...prev,\n                  vendor_contacts: [contact],\n                  contact_id: contact.id,\n                  contact_name: contact.contact_name\n                } : null\n                return updated\n              })\n            }\n          } else if (contact.contact_name) {\n            //   \n            const { data: newContact, error: contactInsertError } = await supabase\n              .from('vendor_contacts')\n              .insert({\n                vendor_id: editedPurchase.vendor_id,\n                contact_name: contact.contact_name,\n                contact_email: contact.contact_email || '',\n                contact_phone: contact.contact_phone || '',\n                position: contact.position || ''\n              })\n              .select()\n              .single()\n            \n            if (contactInsertError) {\n              logger.error('  :', contactInsertError)\n            } else if (newContact) {\n              finalContactId = newContact.id\n              //    editedPurchase \n              editedPurchase.vendor_contacts = [newContact]\n              \n              //  UI  \n              setPurchase(prev => {\n                const updated = prev ? {\n                  ...prev,\n                  vendor_contacts: [newContact],\n                  contact_id: newContact.id,\n                  contact_name: newContact.contact_name\n                } : null\n                return updated\n              })\n              \n              // purchase_requests  contact_id \n              const { error: purchaseUpdateError } = await supabase\n                .from('purchase_requests')\n                .update({\n                  contact_id: newContact.id\n                })\n                .eq('id', purchase.id)\n              \n              if (purchaseUpdateError) {\n                logger.error('purchase_requests contact_id  :', purchaseUpdateError)\n              }\n            }\n          }\n        }\n      } catch (contactError) {\n        //       \n        logger.warn(' [handleSave]     ( )', { error: contactError })\n      }\n      logger.debug('[handleSave] Step 2 ')\n\n      //   \n      logger.debug('[handleSave] Step 3:    ')\n      if (deletedItemIds.length > 0) {\n        const deleteResult = await withTimeout(\n          supabase\n            .from('purchase_request_items')\n            .delete()\n            .in('id', deletedItemIds),\n          STEP_TIMEOUT_MS\n        ) as any\n        const deleteError = deleteResult?.error\n\n        if (deleteError) {\n          logger.error('  :', deleteError)\n          throw deleteError\n        }\n      }\n      logger.debug('[handleSave] Step 3 ')\n\n      //      \n      if (editedItems.length === 0) {\n        logger.info('     ', {\n          purchaseId: purchase.id,\n          deletedItemIds: deletedItemIds\n        })\n\n        //  \n        const { error: requestDeleteError } = await supabase\n          .from('purchase_requests')\n          .delete()\n          .eq('id', purchase.id)\n\n        if (requestDeleteError) {\n          logger.error('  ', requestDeleteError)\n          throw requestDeleteError\n        }\n\n        //   \n        const purchaseIdNumber = Number(purchase.id)\n        if (!Number.isNaN(purchaseIdNumber)) {\n          const memoryUpdated = removePurchaseFromMemory(purchaseIdNumber)\n          if (!memoryUpdated) {\n            logger.warn('[handleSave]      ', { \n              purchaseId: purchaseIdNumber\n            })\n          } else {\n            logger.info(' [handleSave]      ', { \n              purchaseId: purchaseIdNumber\n            })\n          }\n        }\n\n        toast.success('    .')\n        handleEditToggle(false)\n        setDeletedItemIds([])\n        onClose() //  \n        \n        //  \n        const refreshResult = onRefresh?.(true, { silent: false })\n        if (refreshResult instanceof Promise) {\n          await refreshResult\n        }\n        \n        return //   \n      }\n\n      //     \n      logger.debug(`[handleSave] Step 4:   ,  ${editedItems.length}`)\n      \n      //  DB statement timeout/      (Promise.all )\n      for (let index = 0; index < editedItems.length; index++) {\n        const item = editedItems[index]\n        const itemTimeoutMs = 60000\n        //   \n        if (!item.item_name || !item.item_name.trim()) {\n          throw new Error(' .');\n        }\n        //   0 1  \n        if (!item.quantity || item.quantity <= 0) {\n          item.quantity = 1;\n        }\n        const normalizedUnitPriceValue = safeNumber(item.unit_price_value, 0)\n        const normalizedAmountValue = safeNumber(item.amount_value, 0)\n        if (normalizedUnitPriceValue < 0) {\n          throw new Error(' 0  .');\n        }\n        if (normalizedAmountValue < 0) {\n          throw new Error(' 0  .');\n        }\n        \n        // item.id        \n        const numericItemId = item.id ? Number(item.id) : null;\n        const isExistingItem = numericItemId && !Number.isNaN(numericItemId) && numericItemId > 0;\n        \n        //   \n        // :   ,   0  (DB NULL )\n        const unitPriceValue = safeNumber(item.unit_price_value, 0)\n        const finalAmountValue = safeNumber(item.amount_value, 0)\n        \n        if (isExistingItem) {\n          //   \n          const updateItemResult = await withTimeout(\n            supabase\n              .from('purchase_request_items')\n              .update({\n                item_name: item.item_name.trim(),\n                specification: item.specification || null,\n                quantity: safeNumber(item.quantity, 1),\n                received_quantity: item.received_quantity != null ? safeNumber(item.received_quantity) : null,\n                unit_price_value: unitPriceValue,\n                unit_price_currency: purchase.currency || 'KRW',\n                amount_value: finalAmountValue,\n                amount_currency: purchase.currency || 'KRW',\n                remark: item.remark || null,\n                link: item.link && String(item.link).trim() ? String(item.link).trim() : null,\n                updated_at: new Date().toISOString()\n              })\n              .eq('id', numericItemId),\n            itemTimeoutMs\n          ) as any\n          const error = updateItemResult?.error\n\n          if (error) {\n            logger.error('   ', error);\n            throw error;\n          }\n          logger.debug(`[handleSave]  ${index + 1}  `)\n        } else {\n          //   \n          const insertData = {\n            purchase_request_id: purchase.id,\n            item_name: item.item_name.trim(),\n            specification: item.specification || null,\n            quantity: safeNumber(item.quantity, 1),\n            received_quantity: item.received_quantity != null ? safeNumber(item.received_quantity) : null,\n            unit_price_value: unitPriceValue,\n            unit_price_currency: purchase.currency || 'KRW',\n            amount_value: finalAmountValue,\n            amount_currency: purchase.currency || 'KRW',\n            remark: item.remark || null,\n            link: item.link && String(item.link).trim() ? String(item.link).trim() : null,\n            line_number: item.line_number || editedItems.indexOf(item) + 1,\n            created_at: new Date().toISOString()\n          };\n          \n          //  insert (select/single)  (/ )\n          const insertItemResult = await withTimeout(\n            supabase\n              .from('purchase_request_items')\n              .insert(insertData),\n            itemTimeoutMs\n          ) as any\n          const error = insertItemResult?.error\n\n          if (error) {\n            logger.error('   ', error);\n            throw error;\n          }\n          logger.debug(`[handleSave]  ${index + 1}  `)\n        }\n      }\n      logger.debug('[handleSave] Step 4 :   ')\n\n      //        (  )\n      const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n      const sourceData = editedPurchase || purchase\n      \n      // 1.        \n      try {\n        if (!Number.isNaN(purchaseIdNumber) && deletedItemIds.length > 0) {\n          deletedItemIds.forEach(itemId => {\n            try {\n              const memoryUpdated = removeItemFromMemory(purchaseIdNumber, itemId)\n              if (!memoryUpdated) {\n                logger.warn('[handleSave]       ', { \n                  purchaseId: purchaseIdNumber, \n                  itemId: itemId \n                })\n              }\n            } catch (itemError) {\n              logger.warn(' [handleSave]         ()', { error: itemError })\n            }\n          })\n        }\n      } catch (memoryError) {\n        logger.warn(' [handleSave]       ( )', { error: memoryError })\n      }\n      \n      // 2.       ( )\n      try {\n        if (!Number.isNaN(purchaseIdNumber)) {\n          const memoryUpdated = updatePurchaseInMemory(purchaseIdNumber, (prev) => {\n            const totalAmount = editedItems.reduce((sum, item) => sum + (item.amount_value || 0), 0)\n            \n            return {\n              ...prev,\n              //    \n              purchase_order_number: sourceData?.purchase_order_number || prev.purchase_order_number,\n              requester_name: sourceData?.requester_name || prev.requester_name,\n              vendor_id: sourceData?.vendor_id || prev.vendor_id,\n              vendor_name: sourceData?.vendor_name || prev.vendor_name,\n              vendor: sourceData?.vendor || (prev as any).vendor,\n              vendor_contacts: sourceData?.vendor_contacts || (prev as any).vendor_contacts,\n              delivery_request_date: sourceData?.delivery_request_date || prev.delivery_request_date,\n              revised_delivery_request_date: sourceData?.revised_delivery_request_date || prev.revised_delivery_request_date,\n              payment_category: sourceData?.payment_category || prev.payment_category,\n              project_vendor: sourceData?.project_vendor || prev.project_vendor,\n              project_item: sourceData?.project_item || prev.project_item,\n              total_amount: totalAmount,\n              //       (   )\n              items: editedItems,\n              purchase_request_items: editedItems,\n              updated_at: new Date().toISOString()\n            } as Purchase\n          })\n        }\n      } catch (memoryError) {\n        logger.warn(' [handleSave]      ( )', { error: memoryError })\n      }\n      \n      // 3. applyOptimisticUpdate     (  )\n      try {\n        const applyOptimisticUpdate = () => {\n          if (!Number.isNaN(purchaseIdNumber) && onOptimisticUpdate) {\n            onOptimisticUpdate(purchaseIdNumber, prev => {\n              const finalItems = editedItems //    \n              const totalAmount = finalItems.reduce((sum, item) => sum + (item.amount_value || 0), 0)\n              \n              return {\n                ...prev,\n                //    \n                purchase_order_number: sourceData?.purchase_order_number || prev.purchase_order_number,\n                requester_name: sourceData?.requester_name || prev.requester_name,\n                vendor_id: sourceData?.vendor_id || prev.vendor_id,\n                vendor_name: sourceData?.vendor_name || prev.vendor_name,\n                vendor: sourceData?.vendor || (prev as any).vendor,\n                vendor_contacts: sourceData?.vendor_contacts || (prev as any).vendor_contacts,\n                delivery_request_date: sourceData?.delivery_request_date || prev.delivery_request_date,\n                revised_delivery_request_date: sourceData?.revised_delivery_request_date || prev.revised_delivery_request_date,\n                payment_category: sourceData?.payment_category || prev.payment_category,\n                project_vendor: sourceData?.project_vendor || prev.project_vendor,\n                project_item: sourceData?.project_item || prev.project_item,\n                total_amount: totalAmount,\n                //    -   \n                items: finalItems,\n                purchase_request_items: finalItems,\n                updated_at: new Date().toISOString()\n              } as Purchase\n            })\n          }\n        }\n        \n        // 4.  UI   (  )\n        logger.debug('[handleSave] Step 5 - UI  ')\n        applyOptimisticUpdate()\n        logger.debug('[handleSave] Step 5  -  !')\n      } catch (optimisticError) {\n        logger.warn(' [handleSave] OptimisticUpdate   ( )', { error: optimisticError })\n      }\n\n      logger.debug('[handleSave] Step 5 : UI ')\n      toast.success('   .')\n      handleEditToggle(false)\n      setDeletedItemIds([])\n      \n      logger.debug('[handleSave]  !  ')\n      \n      //     (OptimisticUpdate  UI  )\n      setIsSaving(false)\n      \n      //     (await )\n      refreshModalDataWithLock().catch(err => {\n        // refresh      ,     \n        logger.warn(' [handleSave]   ', { error: err })\n        const msg = err instanceof Error ? err.message : String(err)\n        toast.error(`   : ${msg}`, { duration: 5000 })\n      })\n      \n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        refreshResult.catch(err => {\n          logger.warn(' [handleSave]  onRefresh  ()', { error: err })\n        })\n      }\n    } catch (error) {\n      logger.error('[handleSave]  :', error)\n      const errorMessage = error instanceof Error ? error.message : '    '\n      toast.error(` : ${errorMessage}`, { duration: 5000 })\n    } finally {\n      logger.debug('[handleSave] finally   -  ')\n      isSavingRef.current = false\n      setIsSaving(false)\n    }\n  }\n\n  const handleItemChange = (index: number, field: string, value: any) => {\n    const newItems = [...editedItems]\n    \n    if (field === 'quantity' || field === 'unit_price_value') {\n      //          \n      if ((newItems[index] as any)?.is_amount_manual) {\n        newItems[index] = {\n          ...newItems[index],\n          [field]: value\n        }\n        setEditedItems(newItems)\n        return\n      }\n      //         \n      const quantity = field === 'quantity' ? value : newItems[index].quantity\n      const unitPrice = field === 'unit_price_value' ? value : newItems[index].unit_price_value\n      \n      //  null 0     (    )\n      const hasValidUnitPrice = unitPrice != null && unitPrice !== undefined && unitPrice !== '' && unitPrice !== 0\n      const hasValidQuantity = quantity != null && quantity !== undefined && quantity !== 0\n      \n      if (hasValidUnitPrice && hasValidQuantity) {\n        //        \n        const amount = (quantity || 0) * (unitPrice || 0)\n        \n        //    (10%)  \n        const taxAmount = purchase?.payment_category === '' ? Math.round(amount * 0.1) : 0\n        \n        newItems[index] = {\n          ...newItems[index],\n          [field]: value,\n          amount_value: amount,\n          tax_amount_value: taxAmount\n        }\n      } else {\n        //       / \n        newItems[index] = {\n          ...newItems[index],\n          [field]: value\n          // amount_value   \n        }\n      }\n    } else if (field === 'amount_value') {\n      //    \n      //   0  \n      let amount = 0\n      if (value !== '' && value != null && value !== undefined) {\n        const numValue = Number(value)\n        if (!Number.isNaN(numValue)) {\n          amount = numValue  // 0  \n        }\n      }\n      \n      //    (10%)  \n      const taxAmount = purchase?.payment_category === '' ? Math.round(amount * 0.1) : 0\n      \n      newItems[index] = {\n        ...newItems[index],\n        //      ( /   )\n        is_amount_manual: true,\n        amount_value: amount,\n        tax_amount_value: taxAmount\n      }\n    } else {\n      //   \n      newItems[index] = {\n        ...newItems[index],\n        [field]: value\n      }\n    }\n    \n    setEditedItems(newItems)\n  }\n\n  const handleAddItem = (e?: React.MouseEvent) => {\n    //   form  submit   \n    e?.preventDefault?.()\n    e?.stopPropagation?.()\n\n    if (!isEditing) return\n\n    //          (/-  )\n    const now = Date.now()\n    if (now - lastAddItemAtRef.current < 350) {\n      logger.warn('[PurchaseDetailModal] handleAddItem   ', {\n        deltaMs: now - lastAddItemAtRef.current,\n      })\n      return\n    }\n    lastAddItemAtRef.current = now\n\n    setEditedItems(prev => {\n      const base = prev || []\n\n      //    \n      const maxLineNumber = base.reduce((max, item) => {\n        const lineNum = item.line_number || 0\n        return lineNum > max ? lineNum : max\n      }, 0)\n\n      const newItem = {\n        item_name: '',\n        specification: '',\n        quantity: 1,\n        unit_price_value: 0,\n        amount_value: 0,\n        remark: '',\n        line_number: maxLineNumber + 1,\n        tempId: `tmp-new-${now}-${Math.random()}`\n      }\n\n      //       \n      return [...base, newItem]\n        .sort((a, b) => {\n          const lineA = a.line_number || 999999\n          const lineB = b.line_number || 999999\n          return lineA - lineB\n        })\n        .map((item, idx) => ({\n          ...item,\n          line_number: idx + 1,\n          stableKey: item.stableKey ?? makeStableKey(item, idx)\n        }))\n    })\n  }\n\n  const handleRemoveItem = (index: number) => {\n    const item = editedItems[index]\n    if (item.id) {\n      setDeletedItemIds([...deletedItemIds, item.id])\n    }\n    const newItems = editedItems\n      .filter((_, i) => i !== index)\n      .sort((a, b) => {\n        const lineA = a.line_number || 999999;\n        const lineB = b.line_number || 999999;\n        return lineA - lineB;\n      })\n      .map((it, idx) => ({\n        ...it,\n        line_number: idx + 1,\n        stableKey: it.stableKey ?? makeStableKey(it, idx)\n      }))\n    setEditedItems(newItems)\n  }\n\n  //   \n  const handlePaymentToggle = async (itemId: number | string, isCompleted: boolean) => {\n    \n    if (!canPurchase) {\n      logger.warn('[handlePaymentToggle]  ', { canPurchase, currentUserRoles })\n      toast.error('   .')\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n\n    if (Number.isNaN(numericId)) {\n      logger.error('[handlePaymentToggle]  ID', { itemId, numericId })\n      toast.error('   ID .')\n      return\n    }\n\n    //     -   \n    \n    // items purchase_request_items    - length    \n    if (!purchase) return\n    \n    const purchaseItems = (purchase.items && purchase.items.length > 0) ? purchase.items : []\n    const requestItems = (purchase.purchase_request_items && purchase.purchase_request_items.length > 0) ? purchase.purchase_request_items : []\n    const items = purchaseItems.length > 0 ? purchaseItems : requestItems\n    \n    \n    const targetItem = items.find(item => String(item.id) === itemIdStr)\n    \n    \n    if (!targetItem) {\n      return\n    }\n\n    const itemInfo = `: ${targetItem.item_name}\n: ${targetItem.specification || ''}\n: ${targetItem.quantity?.toLocaleString() || 0}${targetItem.unit || ''}\n: ${targetItem.unit_price_value?.toLocaleString() || 0}\n: ${targetItem.amount_value?.toLocaleString() || 0}`\n\n    const confirmMessage = isCompleted \n      ? `   ?\\n\\n${itemInfo}` \n      : `   ?\\n\\n${itemInfo}`\n    \n    const confirm = window.confirm(confirmMessage)\n    \n    if (!confirm) {\n      return\n    }\n\n    try {\n      \n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_payment_completed: isCompleted,\n          payment_completed_at: isCompleted ? new Date().toISOString() : null\n        })\n        .eq('id', numericId)\n\n      if (error) {\n        throw error\n      }\n      \n\n      //      (/  )\n      if (purchase) {\n        \n        const memoryUpdated = isCompleted \n          ? markItemAsPaymentCompleted(purchase.id, numericId)\n          : markItemAsPaymentCanceled(purchase.id, numericId);\n          \n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal]     ', { \n            purchaseId: purchase.id, \n            itemId: numericId,\n            isCompleted\n          });\n        }\n      }\n\n      //     (UI  )\n      setPurchase(prev => {\n        if (!prev) {\n          return null\n        }\n        \n        // items purchase_request_items     - length    \n        const prevItems = (prev.items && prev.items.length > 0) ? prev.items : []\n        const prevRequestItems = (prev.purchase_request_items && prev.purchase_request_items.length > 0) ? prev.purchase_request_items : []\n        const currentItems = prevItems.length > 0 ? prevItems : prevRequestItems\n        const updatedItems = currentItems.map(item => \n          String(item.id) === itemIdStr \n            ? { ...item, is_payment_completed: isCompleted, payment_completed_at: isCompleted ? new Date().toISOString() : null }\n            : item\n        )\n        \n        \n        //    \n        const result = {\n          ...prev,\n          items: prev.items ? updatedItems : prev.items,\n          purchase_request_items: prev.purchase_request_items ? updatedItems : prev.purchase_request_items\n        }\n        \n        return result\n      })\n\n      if (purchase) {\n        const purchaseIdNumber = Number(purchase.id)\n        if (!Number.isNaN(purchaseIdNumber)) {\n          onOptimisticUpdate?.(purchaseIdNumber, prev => {\n            const updatedItems = (prev.items || []).map(item =>\n              String(item.id) === itemIdStr\n                ? { ...item, is_payment_completed: isCompleted }\n                : item\n            )\n            const total = updatedItems.length || prev.items?.length || 0\n            const completed = updatedItems.filter(item => item.is_payment_completed).length\n            const allCompleted = total > 0 && completed === total\n            return {\n              ...prev,\n              items: updatedItems,\n              is_payment_completed: allCompleted,\n              payment_completed_at: allCompleted ? new Date().toISOString() : null,\n              payment_completed_by_name: allCompleted ? (currentUserName || prev.payment_completed_by_name) : prev.payment_completed_by_name\n            }\n          })\n        }\n      }\n      \n      toast.success(isCompleted ? ' .' : ' .')\n\n      //         \n      await refreshModalDataWithLock()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      toast.error('    .')\n    }\n  }\n\n  //     (  + ) -   \n  const handleItemReceiptToggle = async (itemId: number | string, selectedDate: Date, receivedQuantity?: number) => {\n    //    - Realtime   \n    isUpdatingRef.current = true\n    \n    if (!canReceiveItems) {\n      toast.error('   .')\n      isUpdatingRef.current = false\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      toast.error('   ID .')\n      return\n    }\n\n    //    \n    const currentItem = purchase?.items?.find(item => String(item.id) === itemIdStr) \n      || purchase?.purchase_request_items?.find(item => String(item.id) === itemIdStr)\n    \n    const requestedQty = currentItem?.quantity || 0\n    const currentReceivedQty = currentItem?.received_quantity || 0\n    const newReceivedQty = receivedQuantity !== undefined ? receivedQuantity : requestedQty\n    const totalReceivedQty = currentReceivedQty + newReceivedQty\n    const shouldIncreaseRequestedQty = totalReceivedQty > requestedQty\n    const nextRequestedQty = shouldIncreaseRequestedQty ? totalReceivedQty : requestedQty\n    const isFullyReceived = totalReceivedQty >= nextRequestedQty\n    const deliveryStatus: 'pending' | 'partial' | 'received' = totalReceivedQty === 0 ? 'pending' : (isFullyReceived ? 'received' : 'partial')\n\n    //    \n    const existingHistory = (currentItem?.receipt_history as any[]) || []\n    const nextSeq = existingHistory.length + 1\n    const newHistoryItem = {\n      seq: nextSeq,\n      qty: newReceivedQty,\n      date: dateToISOString(selectedDate),\n      by: currentUserName || ''\n    }\n    const updatedHistory = [...existingHistory, newHistoryItem]\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const quantityUpdate = shouldIncreaseRequestedQty ? { quantity: nextRequestedQty } : {}\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item =>\n            String(item.id) === itemIdStr\n              ? {\n                  ...item,\n                  ...quantityUpdate,\n                  is_received: isFullyReceived,\n                  delivery_status: deliveryStatus,\n                  actual_received_date: dateToISOString(selectedDate),\n                  received_quantity: totalReceivedQty,\n                  receipt_history: updatedHistory\n                }\n              : item\n          )\n          const total = updatedItems.length || prev.items?.length || 0\n          const completed = updatedItems.filter(item => item.is_received).length\n          const allReceived = total > 0 && completed === total\n\n          return {\n            ...prev,\n            items: updatedItems,\n            is_received: allReceived,\n            received_at: allReceived ? new Date().toISOString() : prev.received_at\n          }\n        })\n      }\n    }\n\n    try {\n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_received: isFullyReceived,\n          delivery_status: deliveryStatus,\n          received_at: new Date().toISOString(),\n          actual_received_date: dateToISOString(selectedDate),\n          received_quantity: totalReceivedQty,\n          receipt_history: updatedHistory,\n          ...(shouldIncreaseRequestedQty ? { quantity: nextRequestedQty } : {})\n        })\n        .eq('id', numericId)\n\n      if (error) throw error\n\n      //      (  )\n      if (purchase) {\n        const memoryUpdated = markItemAsReceived(purchase.id, numericId, dateToISOString(selectedDate), totalReceivedQty);\n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal]       ', { \n            purchaseId: purchase.id, \n            itemId: numericId \n          });\n        }\n      }\n\n      //     (  )\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          String(item.id) === itemIdStr \n            ? { \n                ...item,\n                ...quantityUpdate,\n                is_received: isFullyReceived, \n                delivery_status: deliveryStatus,\n                received_at: new Date().toISOString(),\n                actual_received_date: dateToISOString(selectedDate),\n                received_quantity: totalReceivedQty,\n                receipt_history: updatedHistory\n              }\n            : item\n        )\n        const updatedRequestItems = prev.purchase_request_items?.map(item => \n          String(item.id) === itemIdStr \n            ? { \n                ...item,\n                ...quantityUpdate,\n                is_received: isFullyReceived, \n                delivery_status: deliveryStatus,\n                received_at: new Date().toISOString(),\n                actual_received_date: dateToISOString(selectedDate),\n                received_quantity: totalReceivedQty,\n                receipt_history: updatedHistory\n              }\n            : item\n        )\n        return { \n          ...prev, \n          items: updatedItems,\n          purchase_request_items: updatedRequestItems,\n          updated_at: new Date().toISOString()\n        }\n      })\n\n      applyOptimisticUpdate()\n      \n      const targetItem = purchase?.items?.find(item => String(item.id) === itemIdStr)\n      toast.success(`\"${targetItem?.item_name}\"   .`)\n\n      await refreshModalDataWithLock()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      toast.error('    .')\n    }\n  }\n\n  //   \n  const handleReceiptCancel = async (itemId: number | string) => {\n    //    - Realtime   \n    isUpdatingRef.current = true\n    \n    if (!canProcessReceipt) {\n      toast.error('   .')\n      isUpdatingRef.current = false\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      toast.error('   ID .')\n      return\n    }\n\n    const targetItem = purchase?.items?.find(item => String(item.id) === itemIdStr)\n    if (!targetItem) return\n\n    const confirm = window.confirm(`\"${targetItem.item_name}\"   ?`)\n    if (!confirm) return\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item =>\n            String(item.id) === itemIdStr\n              ? {\n                  ...item,\n                  is_received: false,\n                  actual_received_date: undefined\n                }\n              : item\n          )\n          const total = updatedItems.length || prev.items?.length || 0\n          const completed = updatedItems.filter(item => item.is_received).length\n          const allReceived = total > 0 && completed === total\n\n          return {\n            ...prev,\n            items: updatedItems,\n            is_received: allReceived,\n            received_at: allReceived ? prev.received_at : null\n          }\n        })\n      }\n    }\n\n    try {\n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_received: false,\n          received_at: null,\n          actual_received_date: null,\n          actual_received_by_name: null\n        })\n        .eq('id', numericId)\n\n      if (error) throw error\n\n      //    \n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          String(item.id) === itemIdStr \n            ? { ...item, is_received: false, received_at: null, actual_received_date: undefined, actual_received_by_name: undefined }\n            : item\n        )\n        return { ...prev, items: updatedItems }\n      })\n      \n      applyOptimisticUpdate()\n\n      toast.success(' .')\n\n      await refreshModalDataWithLock()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      toast.error('    .')\n    }\n  }\n\n\n  //  \n  const handleApprove = async (type: 'middle' | 'final') => {\n    if (!purchase) return\n    \n    const approvalType = type === 'middle' ? '1 ' : ' '\n    const confirmMessage = `: ${purchase.purchase_order_number}\\n\\n${approvalType} ?`\n    const confirm = window.confirm(confirmMessage)\n    if (!confirm) return\n    \n    try {\n      const updateData = type === 'middle' \n        ? { \n            middle_manager_status: 'approved'\n          }\n        : { \n            final_manager_status: 'approved'\n          }\n\n      const { error } = await supabase\n        .from('purchase_requests')\n        .update(updateData)\n        .eq('id', purchase.id)\n      \n      if (error) {\n        throw error\n      }\n\n      //     (UI  )\n      if (type === 'middle') {\n        setPurchase(prev => prev ? { ...prev, middle_manager_status: 'approved' } : null)\n      } else {\n        setPurchase(prev => prev ? { ...prev, final_manager_status: 'approved' } : null)\n      }\n\n      //      ( notifyCacheListeners  ->    )\n      updatePurchaseInMemory(String(purchase.id), (prev) => ({\n        ...prev,\n        ...(type === 'middle' \n          ? { middle_manager_status: 'approved' as any }\n          : { final_manager_status: 'approved' as any }\n        )\n      }))\n\n      // Optimistic Update    (/  )\n      if (purchase && onOptimisticUpdate) {\n        const purchaseIdNumber = Number(purchase.id)\n        if (!Number.isNaN(purchaseIdNumber)) {\n          onOptimisticUpdate(purchaseIdNumber, prev => {\n            if (type === 'middle') {\n              return {\n                ...prev,\n                middle_manager_status: 'approved' as any\n              }\n            } else {\n              return {\n                ...prev,\n                final_manager_status: 'approved' as any\n              }\n            }\n          })\n        }\n      }\n      \n      toast.success(`${type === 'middle' ? '' : ''}  .`)\n\n      //      \n      await refreshModalDataWithLock()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      toast.error('    .')\n    }\n  }\n  \n  //    (   )\n  const handleCompleteAllPayment = async () => {\n    \n    if (!purchase || !canPurchase) {\n      return\n    }\n    \n    const confirmMessage = `: ${purchase.purchase_order_number}\\n\\n  ?`\n    const confirm = window.confirm(confirmMessage)\n    if (!confirm) {\n      return\n    }\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const allItems = prev.purchase_request_items || [];\n          const pendingItems = allItems.filter(item => !item.is_payment_completed);\n          \n          const updatedItems = allItems.map(item => \n            !item.is_payment_completed \n              ? { ...item, is_payment_completed: true, payment_completed_at: new Date().toISOString() }\n              : item\n          );\n          \n          return {\n            ...prev,\n            purchase_request_items: updatedItems,\n            items: prev.items ? updatedItems : prev.items,\n            is_payment_completed: updatedItems.every(item => item.is_payment_completed)\n          }\n        })\n      }\n    }\n    \n    try {\n      //     (   )\n      const allItems = purchase.purchase_request_items || [];\n      const pendingItems = allItems.filter(item => !item.is_payment_completed);\n      \n      if (pendingItems.length === 0) {\n        toast.info('   .');\n        return;\n      }\n\n      logger.info(`  : ${pendingItems.length}  ( ${allItems.length} )`);\n      \n      for (const item of pendingItems) {\n        //   DB  (   )\n        const updateData = {\n          is_payment_completed: true,\n          payment_completed_at: new Date().toISOString()\n        };\n\n        const { error } = await supabase\n          .from('purchase_request_items')\n          .update(updateData)\n          .eq('id', item.id);\n\n        if (error) throw error;\n\n        //       (  )\n        const memoryUpdated = markItemAsPaymentCompleted(purchase.id, item.id);\n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal]       ', { \n            purchaseId: purchase.id, \n            itemId: item.id \n          });\n        }\n      }\n\n      toast.success(`${pendingItems.length}   .`);\n\n      //   (  )\n      await refreshModalDataWithLock();\n      const refreshResult = onRefresh?.(true, { silent: true });\n      if (refreshResult instanceof Promise) {\n        await refreshResult;\n      }\n    } catch (error) {\n      logger.error('   ', error);\n      toast.error('    .')\n    }\n  }\n\n  //     \n  const handleItemExpenditure = async (itemId: number | string, date: Date, amount: number) => {\n    if (!purchase || !canReceiptCheck) {\n      toast.error('    .')\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      logger.error('  itemId', { itemId })\n      return\n    }\n\n    const targetItem = purchase.items?.find(item => String(item.id) === itemIdStr)\n    if (!targetItem) return\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item =>\n            String(item.id) === itemIdStr\n              ? {\n                  ...item,\n                  expenditure_date: dateToISOString(date),\n                  expenditure_amount: amount\n                }\n              : item\n          )\n          return { ...prev, items: updatedItems }\n        })\n      }\n    }\n\n    try {\n      applyOptimisticUpdate()\n\n      //     (items purchase_request_items  ) -    \n      setPurchase(prev => {\n        if (!prev) return null\n        const currentItems = prev.items || prev.purchase_request_items || []\n        const updatedItems = currentItems.map(item => \n          String(item.id) === itemIdStr\n            ? {\n                ...item,\n                expenditure_date: dateToISOString(date),\n                expenditure_amount: amount\n              }\n            : item\n        )\n        const totalExpenditure = updatedItems.reduce((sum, item) => sum + (item.expenditure_amount || 0), 0)\n        //    React   \n        return { \n          ...prev, \n          items: updatedItems,\n          purchase_request_items: updatedItems,\n          total_expenditure_amount: totalExpenditure,\n          updated_at: new Date().toISOString() //    \n        }\n      })\n\n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          expenditure_date: dateToISOString(date),\n          expenditure_amount: amount\n        })\n        .eq('id', numericId)\n\n      if (error) {\n        logger.error('  DB  ', { error, itemId: numericId })\n        throw error\n      }\n\n      // purchase_requests total_expenditure_amount \n      const allItemsForTotal = purchase.items || purchase.purchase_request_items || []\n      const totalExpenditure = allItemsForTotal.reduce((sum, item) => {\n        if (String(item.id) === itemIdStr) {\n          return sum + amount\n        }\n        return sum + (item.expenditure_amount || 0)\n      }, 0)\n\n      await supabase\n        .from('purchase_requests')\n        .update({ total_expenditure_amount: totalExpenditure })\n        .eq('id', purchaseIdNumber)\n\n      //      ( UI ) - DB   \n      if (purchase?.id) {\n        const memoryUpdated = markItemAsExpenditureSet(purchase.id, numericId, dateToISOString(date), amount)\n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal]      ', { \n            purchaseId: purchase.id, \n            itemId: numericId \n          })\n        }\n      }\n\n      toast.success(`\"${targetItem.item_name}\"    .`)\n\n      await refreshModalDataWithLock()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      logger.error('    ', error)\n      toast.error('     .')\n    }\n  }\n\n  //     \n  const handleBulkExpenditure = async (date: Date, amount: number) => {\n    if (!purchase || !canReceiptCheck) {\n      toast.error('    .')\n      return\n    }\n\n    const confirmMessage = `: ${purchase.purchase_order_number}\\n\\n   ?\\n: ${date.toLocaleDateString('ko-KR')}\\n : ${amount.toLocaleString()}\\n\\n* :        ,    .`\n    \n    if (!window.confirm(confirmMessage)) {\n      return\n    }\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item => ({\n            ...item,\n            expenditure_date: dateToISOString(date),\n            expenditure_amount: null\n          }))\n          return { \n            ...prev, \n            items: updatedItems,\n            total_expenditure_amount: amount\n          }\n        })\n      }\n    }\n\n    try {\n      applyOptimisticUpdate()\n\n      const allItems = purchase.items || purchase.purchase_request_items || []\n      \n      if (allItems.length === 0) {\n        toast.error(' .')\n        return\n      }\n\n      //    \n      setPurchase(prev => {\n        if (!prev) return null\n        const allItems = prev.items || prev.purchase_request_items || []\n        const updatedItems = allItems.map(item => ({\n            ...item,\n            expenditure_date: dateToISOString(date),\n            expenditure_amount: null\n        }))\n        \n        return { \n          ...prev, \n          items: updatedItems,\n          purchase_request_items: updatedItems,\n          total_expenditure_amount: amount,\n          updated_at: new Date().toISOString()\n        }\n      })\n\n      // DB  -   ( null)\n      const { error: itemsError } = await supabase\n        .from('purchase_request_items')\n        .update({\n          expenditure_date: dateToISOString(date),\n          expenditure_amount: null\n        })\n        .in('id', allItems.map(item => item.id))\n\n      if (itemsError) {\n        logger.error('    DB  ', { error: itemsError })\n        throw itemsError\n      }\n\n      // DB  -  \n      const { error: requestError } = await supabase\n        .from('purchase_requests')\n        .update({ total_expenditure_amount: amount })\n        .eq('id', purchaseIdNumber)\n\n      if (requestError) {\n        logger.error('    DB  ', { error: requestError })\n        throw requestError\n      }\n\n      //      ( UI )\n      markBulkExpenditureSet(purchase.id, dateToISOString(date), amount)\n\n      toast.success('   .')\n    } catch (error) {\n      logger.error('     ', error)\n      toast.error('      .')\n    }\n  }\n\n  //     (   )\n  const handleCompleteAllStatement = async (selectedDate: Date) => {\n    if (!purchase || !canReceiptCheck) {\n      return\n    }\n\n    const formattedDate = selectedDate.toLocaleDateString('ko-KR', {\n      year: 'numeric',\n      month: '2-digit',\n      day: '2-digit'\n    })\n\n    const confirmMessage = `: ${purchase.purchase_order_number}\n\n   ?`\n    \n    if (!window.confirm(confirmMessage)) {\n      return\n    }\n\n    const selectedDateIso = dateToISOString(selectedDate)\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const allItems = prev.purchase_request_items || [];\n          const pendingItems = allItems.filter(item => !item.is_statement_received);\n          \n          const updatedItems = allItems.map(item => \n            !item.is_statement_received \n              ? { \n                  ...item, \n                  is_statement_received: true, \n                  statement_received_date: selectedDateIso,\n                  statement_received_by_name: currentUserName || null\n                }\n              : item\n          );\n          \n          return {\n            ...prev,\n            purchase_request_items: updatedItems,\n            items: prev.items ? updatedItems : prev.items,\n            is_statement_received: updatedItems.every(item => item.is_statement_received),\n            statement_received_at: selectedDateIso\n          }\n        })\n      }\n    }\n\n    try {\n      //     (    )\n      const allItems = purchase.purchase_request_items || [];\n      const pendingItems = allItems.filter(item => !item.is_statement_received);\n      \n      if (pendingItems.length === 0) {\n        toast.info('    .');\n        return;\n      }\n\n      logger.info(`   : ${pendingItems.length}  ( ${allItems.length} )`);\n      \n      for (const item of pendingItems) {\n        //   DB  (   )\n        const updateData = {\n          is_statement_received: true,\n          statement_received_date: selectedDateIso,\n          statement_received_by_name: currentUserName || null\n        };\n\n        const { error } = await supabase\n          .from('purchase_request_items')\n          .update(updateData)\n          .eq('id', item.id);\n\n        if (error) throw error;\n\n        //       (  )\n        const memoryUpdated = markItemAsStatementReceived(purchase.id, item.id, selectedDateIso, currentUserName || undefined);\n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal]        ', { \n            purchaseId: purchase.id, \n            itemId: item.id \n          });\n        }\n      }\n\n      toast.success(`${pendingItems.length}    .`);\n\n      //   (  )\n      await refreshModalDataWithLock();\n      const refreshResult = onRefresh?.(true, { silent: true });\n      if (refreshResult instanceof Promise) {\n        await refreshResult;\n      }\n    } catch (error) {\n      logger.error('    ', error)\n      toast.error('     .')\n    }\n  }\n\n  //    (  + )\n  const handleCompleteAllReceipt = async (selectedDate: Date, receivedQuantity?: number) => {\n    if (!purchase || !canReceiveItems) {\n      return\n    }\n\n    //   \n    const confirmMessage = `: ${purchase.purchase_order_number}\n\n  ?`\n    \n    if (!window.confirm(confirmMessage)) {\n      return\n    }\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    try {\n      //     (   )\n      const allItems = purchase.purchase_request_items || [];\n      const pendingItems = allItems.filter(item => !item.is_received);\n      \n      const applyOptimisticUpdate = () => {\n        if (!Number.isNaN(purchaseIdNumber)) {\n          onOptimisticUpdate?.(purchaseIdNumber, prev => {\n            const updatedItems = (prev.items || []).map(item => {\n              const pendingItem = pendingItems.find((p: any) => String(p.id) === String(item.id))\n              if (pendingItem) {\n                //   , receivedQuantity  (quantity)  \n                return {\n                  ...item,\n                  is_received: true,\n                  actual_received_date: item.actual_received_date || dateToISOString(selectedDate),\n                  received_quantity: receivedQuantity !== undefined ? receivedQuantity : item.quantity\n                }\n              }\n              return item\n            })\n            const updatedRequestItems = (prev.purchase_request_items || []).map(item => {\n              const pendingItem = pendingItems.find((p: any) => String(p.id) === String(item.id))\n              if (pendingItem) {\n                //   , receivedQuantity  (quantity)  \n                return {\n                  ...item,\n                  is_received: true,\n                  actual_received_date: item.actual_received_date || dateToISOString(selectedDate),\n                  received_quantity: receivedQuantity !== undefined ? receivedQuantity : item.quantity\n                }\n              }\n              return item\n            })\n\n            return {\n              ...prev,\n              items: updatedItems,\n              purchase_request_items: updatedRequestItems,\n              is_received: true,\n              received_at: new Date().toISOString(),\n              updated_at: new Date().toISOString()\n            }\n          })\n        }\n      }\n      \n      if (pendingItems.length === 0) {\n        toast.info('   .');\n        return;\n      }\n\n      logger.info(`  : ${pendingItems.length}  ( ${allItems.length} )`);\n      \n      // Optimistic Update  \n      applyOptimisticUpdate()\n      \n      //    \n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => {\n          const pendingItem = pendingItems.find(p => String(p.id) === String(item.id))\n          if (pendingItem) {\n            // receivedQuantity  (quantity)  \n            return {\n              ...item,\n              is_received: true,\n              received_at: new Date().toISOString(),\n              actual_received_date: dateToISOString(selectedDate),\n              received_quantity: receivedQuantity !== undefined ? receivedQuantity : item.quantity\n            }\n          }\n          return item\n        }) || []\n        const updatedRequestItems = prev.purchase_request_items?.map(item => {\n          const pendingItem = pendingItems.find(p => String(p.id) === String(item.id))\n          if (pendingItem) {\n            // receivedQuantity  (quantity)  \n            return {\n              ...item,\n              is_received: true,\n              received_at: new Date().toISOString(),\n              actual_received_date: dateToISOString(selectedDate),\n              received_quantity: receivedQuantity !== undefined ? receivedQuantity : item.quantity\n            }\n          }\n          return item\n        }) || []\n        const total = updatedItems.length\n        const completed = updatedItems.filter(item => item.is_received).length\n        const allReceived = total > 0 && completed === total\n        \n        return {\n          ...prev,\n          items: updatedItems,\n          purchase_request_items: updatedRequestItems,\n          is_received: allReceived,\n          received_at: allReceived ? new Date().toISOString() : prev.received_at,\n          updated_at: new Date().toISOString()\n        }\n      })\n      \n      for (const item of pendingItems) {\n        //   DB  (   )\n        // receivedQuantity  (quantity)  \n        const updateData = {\n          actual_received_date: dateToISOString(selectedDate),\n          is_received: true,\n          received_quantity: receivedQuantity !== undefined ? receivedQuantity : item.quantity //     \n        };\n\n        const { error } = await supabase\n          .from('purchase_request_items')\n          .update(updateData)\n          .eq('id', item.id);\n\n        if (error) throw error;\n\n        //       (  )\n        // receivedQuantity  (quantity)  \n        const itemReceivedQuantity = receivedQuantity !== undefined ? receivedQuantity : item.quantity\n        const memoryUpdated = markItemAsReceived(purchase.id, item.id, dateToISOString(selectedDate), itemReceivedQuantity);\n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal]       ', { \n            purchaseId: purchase.id, \n            itemId: item.id \n          });\n        }\n      }\n\n      toast.success(`${pendingItems.length}   .`);\n\n      //   (  )\n      await refreshModalDataWithLock();\n      const refreshResult = onRefresh?.(true, { silent: true });\n      if (refreshResult instanceof Promise) {\n        await refreshResult;\n      }\n    } catch (error) {\n      logger.error('   ', error)\n      toast.error('    .')\n    }\n  }\n  \n\n  //  \n  const handleReject = async (type: 'middle' | 'final') => {\n    if (!purchase) return\n    \n    const reason = window.prompt('  :')\n    if (!reason) return\n    \n    try {\n      const updateData = type === 'middle'\n        ? {\n            middle_manager_status: 'rejected'\n          }\n        : {\n            final_manager_status: 'rejected'\n          }\n      \n      const { error } = await supabase\n        .from('purchase_requests')\n        .update(updateData)\n        .eq('id', purchase.id)\n      \n      if (error) {\n        throw error\n      }\n      \n      //     (UI  )\n      if (type === 'middle') {\n        setPurchase(prev => prev ? { ...prev, middle_manager_status: 'rejected' } : null)\n      } else {\n        setPurchase(prev => prev ? { ...prev, final_manager_status: 'rejected' } : null)\n      }\n      \n      toast.success(`${type === 'middle' ? '' : ''}  .`)\n    } catch (error) {\n      toast.error('    .')\n    }\n  }\n\n  const renderItemRow = (item: any, index: number, dragProps?: SortableRenderProps, rowKey?: string) => {\n    const stableKey = rowKey || item?.stableKey || getSortableId(item, index)\n    const rowClass = `px-2 sm:px-3 py-1 border-b border-gray-50 hover:bg-gray-50/50 relative overflow-visible w-fit ${isEditing ? 'pl-7 sm:pl-8' : ''} ${dragProps?.isDragging ? 'shadow-lg ring-2 ring-blue-200 bg-white' : ''}`\n    const rowProps: any = {\n      className: rowClass,\n      key: stableKey\n    }\n    if (dragProps?.setNodeRef) rowProps.ref = dragProps.setNodeRef\n    if (dragProps?.style) rowProps.style = dragProps.style\n\n    return (\n      <div {...rowProps}>\n        {isEditing && dragProps && (\n          <button\n            className=\"absolute left-1 top-2 sm:top-3 text-gray-400 hover:text-gray-600 p-1 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-200\"\n            {...dragProps.attributes}\n            {...dragProps.listeners}\n            aria-label=\"   \"\n          >\n            <GripVertical className=\"w-3.5 h-3.5\" />\n          </button>\n        )}\n        {/* Desktop Layout */}\n        <div className={`hidden sm:grid items-center gap-1 overflow-visible w-fit`} style={{\n          gridTemplateColumns: getGridTemplateColumns()\n        }}>\n          {/*  */}\n          <div className=\"flex justify-center items-center text-[11px] text-gray-500 font-medium -ml-2 sm:-ml-3\">\n            {item.line_number || index + 1}\n          </div>\n          {/*  */}\n          <div className=\"min-w-0 relative overflow-visible flex items-center\">\n            {isEditing ? (\n              <Input\n                value={item.item_name}\n                onChange={(e) => handleItemChange(index, 'item_name', e.target.value)}\n                onFocus={() => setFocusedInput(`item_name_${index}`)}\n                onBlur={() => setFocusedInput(null)}\n                className={`modal-label border-gray-200 rounded-lg w-full !px-1.5 !py-0.5 !text-[10px] focus:border-blue-400 transition-all duration-200 ${\n                  focusedInput === `item_name_${index}` \n                    ? '!h-auto !min-h-[20px] !absolute !z-[9999] !bg-white !shadow-lg !left-0 !right-0 !-translate-y-1/2 !top-1/2 !whitespace-normal' \n                    : '!h-5 !truncate'\n                }`}\n                placeholder=\"\"\n              />\n            ) : (\n              <div \n                className=\"modal-value\" \n                style={{\n                  whiteSpace: 'normal',\n                  wordBreak: 'break-all',\n                  overflowWrap: 'break-word',\n                  hyphens: 'none',\n                  WebkitHyphens: 'none',\n                  MozHyphens: 'none',\n                  msHyphens: 'none',\n                  lineHeight: '1.4',\n                  maxHeight: '2.8em',\n                  overflow: 'hidden',\n                  display: '-webkit-box',\n                  WebkitLineClamp: 2,\n                  WebkitBoxOrient: 'vertical'\n                }}\n                title={item.item_name || ' '}\n              >\n                {item.item_name || ' '}\n              </div>\n            )}\n          </div>\n          \n          {/*  */}\n          <div className=\"min-w-0 relative overflow-visible flex items-center w-full\">\n            {isEditing ? (\n              <Input\n                value={item.specification}\n                onChange={(e) => handleItemChange(index, 'specification', e.target.value)}\n                onFocus={() => setFocusedInput(`specification_${index}`)}\n                onBlur={() => setFocusedInput(null)}\n                className={`modal-label border-gray-200 rounded-lg w-full !px-1.5 !py-0.5 !text-[10px] focus:border-blue-400 transition-all duration-200 ${\n                  focusedInput === `specification_${index}` \n                    ? '!h-auto !min-h-[20px] !absolute !z-[9999] !bg-white !shadow-lg !left-0 !right-0 !-translate-y-1/2 !top-1/2 !whitespace-normal' \n                    : '!h-5 !truncate'\n                }`}\n                placeholder=\"\"\n              />\n            ) : (\n              <div \n                className=\"text-[11px] text-gray-600 font-medium\" \n                style={{\n                  whiteSpace: 'normal',\n                  wordBreak: 'break-all',\n                  overflowWrap: 'break-word',\n                  hyphens: 'none',\n                  WebkitHyphens: 'none',\n                  MozHyphens: 'none',\n                  msHyphens: 'none',\n                  lineHeight: '1.4',\n                  maxHeight: '2.8em',\n                  overflow: 'hidden',\n                  display: '-webkit-box',\n                  WebkitLineClamp: 2,\n                  WebkitBoxOrient: 'vertical'\n                }}\n                title={item.specification || '-'}\n              >\n                {item.specification || '-'}\n              </div>\n            )}\n          </div>\n          \n          {/*  */}\n          <div className=\"text-center min-w-0 flex items-center justify-center\">\n            {isEditing ? (\n              (activeTab === 'receipt' || activeTab === 'done') ? (\n                <div className=\"flex flex-col items-center gap-0.5 w-full\">\n                  <Input\n                    type=\"number\"\n                    value={item.quantity}\n                    onChange={(e) => handleItemChange(index, 'quantity', Number(e.target.value))}\n                    className=\"border-gray-200 rounded-lg text-center w-full !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400\"\n                    placeholder=\"\"\n                    max=\"99999\"\n                    disabled={canEditLimited && !canEditAll}\n                  />\n                  <div className=\"flex items-center gap-0.5 w-full\">\n                    <span className=\"text-[9px] text-gray-500\">/</span>\n                    <Input\n                      type=\"number\"\n                      value={item.received_quantity ?? ''}\n                      onChange={(e) => handleItemChange(index, 'received_quantity', e.target.value ? Number(e.target.value) : null)}\n                      className=\"border-gray-200 rounded-lg text-center flex-1 !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400\"\n                      placeholder=\"\"\n                      max=\"99999\"\n                      disabled={canEditLimited && !canEditAll}\n                    />\n                  </div>\n                </div>\n              ) : (\n                <Input\n                  type=\"number\"\n                  value={item.quantity}\n                  onChange={(e) => handleItemChange(index, 'quantity', Number(e.target.value))}\n                  className=\"border-gray-200 rounded-lg text-center w-full !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400\"\n                  placeholder=\"\"\n                  max=\"99999\"\n                  disabled={canEditLimited && !canEditAll}\n                />\n              )\n            ) : (\n              (activeTab === 'receipt' || activeTab === 'done') ? (\n                (() => {\n                  const quantity = item.quantity || 0\n                  const receivedQuantity = item.received_quantity ?? 0\n                  const shouldWrap = quantity >= 100 || receivedQuantity >= 100\n                  const hasReceived = receivedQuantity > 0\n                  \n                  if (shouldWrap) {\n                    return (\n                      <div className=\"flex flex-col items-center leading-tight\">\n                        <div className={`modal-subtitle ${hasReceived ? 'text-gray-400' : ''}`}>{quantity}</div>\n                        <div className={`modal-subtitle ${hasReceived ? '' : 'text-gray-400'}`}>/{receivedQuantity}</div>\n                      </div>\n                    )\n                  } else {\n                    return (\n                      <span className=\"modal-subtitle\">\n                        <span className={hasReceived ? 'text-gray-400' : ''}>{quantity}</span>\n                        <span className={hasReceived ? '' : 'text-gray-400'}>/{receivedQuantity}</span>\n                      </span>\n                    )\n                  }\n                })()\n              ) : (\n                <span className=\"modal-subtitle\">{item.quantity || 0}</span>\n              )\n            )}\n          </div>\n          \n          {/*  */}\n          <div className=\"text-right min-w-0 flex items-center justify-end\">\n            {isEditing ? (\n              <Input\n                type=\"number\"\n                value={item.unit_price_value ?? 0}\n                onChange={(e) => handleItemChange(index, 'unit_price_value', Number(e.target.value))}\n                onWheel={(e) => e.currentTarget.blur()}\n                className=\"border-gray-200 rounded-lg text-right w-full !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400\"\n                placeholder=\"\"\n                max=\"100000000000\"\n              />\n            ) : (\n              <span className=\"modal-subtitle\">\n                {activeTab === 'done' && !canViewFinancialInfo \n                  ? '-' \n                  : formatMoney(item.unit_price_value ?? 0, getItemDisplayCurrency(item))}\n              </span>\n            )}\n          </div>\n          \n          {/*  (  ) */}\n          <div className=\"text-right min-w-0 flex items-center justify-end\">\n            {isEditing ? (\n              <Input\n                type=\"number\"\n                value={item.amount_value || 0}\n                onChange={(e) => handleItemChange(index, 'amount_value', Number(e.target.value))}\n                onWheel={(e) => e.currentTarget.blur()}\n                className=\"border-gray-200 rounded-lg w-full !h-6 !px-1.5 !py-0.5 !text-[10px] font-normal text-gray-600 focus:border-blue-400 text-right\"\n                placeholder=\"\"\n              />\n            ) : (\n              <span className=\"modal-value\">\n                {activeTab === 'done' && !canViewFinancialInfo \n                  ? '-' \n                  : formatMoney(item.amount_value || 0, getItemDisplayCurrency(item))}\n              </span>\n            )}\n          </div>\n          \n          {/*  -       */}\n          {purchase?.payment_category === '' && (\n            <div className=\"text-right min-w-0 flex items-center justify-end\">\n              <span className={isEditing ? \"modal-subtitle\" : \"modal-value\"}>\n                {activeTab === 'done' && !canViewFinancialInfo \n                  ? '-' \n                  : formatMoney(item.tax_amount_value || 0, getItemDisplayCurrency(item))}\n              </span>\n            </div>\n          )}\n          \n          {/*  */}\n          <div className=\"text-center min-w-0 flex items-center justify-center\">\n            {isEditing ? (\n              <Input\n                value={item.link || ''}\n                onChange={(e) => handleItemChange(index, 'link', e.target.value)}\n                className=\"border-gray-200 rounded-lg text-center w-full !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400\"\n                placeholder=\"(URL)\"\n              />\n            ) : (\n              item.link ? (\n                <a\n                  href={item.link}\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                  className=\"text-blue-600 hover:text-blue-800 underline text-[11px]\"\n                  onClick={(e) => e.stopPropagation()}\n                >\n                  \n                </a>\n              ) : (\n                <span className=\"text-gray-400 text-[11px]\">-</span>\n              )\n            )}\n          </div>\n          \n          {/*  */}\n          <div className=\"min-w-0 flex justify-center items-center text-center relative overflow-visible\" style={{ width: '150px', maxWidth: '150px', minWidth: '150px' }}>\n            {isEditing ? (\n              <Input\n                value={item.remark || ''}\n                disabled={!canEditAll && !canEditLimited}\n                onChange={(e) => handleItemChange(index, 'remark', e.target.value)}\n                onFocus={() => setFocusedInput(`remark_${index}`)}\n                onBlur={() => setFocusedInput(null)}\n                className={`modal-label border-gray-200 rounded-lg text-center w-full !px-1.5 !py-0.5 !text-[10px] focus:border-blue-400 transition-all duration-200 ${\n                  focusedInput === `remark_${index}` \n                    ? '!h-auto !min-h-[20px] !absolute !z-[9999] !bg-white !shadow-lg !left-0 !right-0 !-translate-y-1/2 !top-1/2 !whitespace-normal !text-left' \n                    : '!h-5 !truncate'\n                }`}\n                placeholder=\"\"\n              />\n            ) : (\n              <div \n                className=\"text-[11px] text-gray-600 font-medium\"\n                style={{\n                  width: '150px',\n                  maxWidth: '150px',\n                  minWidth: '150px',\n                  boxSizing: 'border-box',\n                  whiteSpace: 'normal',\n                  wordBreak: 'break-all',\n                  overflowWrap: 'break-word',\n                  hyphens: 'none',\n                  WebkitHyphens: 'none',\n                  MozHyphens: 'none',\n                  msHyphens: 'none',\n                  lineHeight: '1.4',\n                  maxHeight: '2.8em',\n                  overflow: 'hidden',\n                  display: '-webkit-box',\n                  WebkitLineClamp: 2,\n                  WebkitBoxOrient: 'vertical'\n                }}\n                title={item.remark || '-'}\n              >\n                {item.remark || '-'}\n              </div>\n            )}\n          </div>\n          \n          {/* / -   */}\n          {activeTab !== 'pending' && (\n            <div className=\"text-center flex justify-center items-center\">\n              {isEditing ? (\n                <Button\n                  size=\"sm\"\n                  variant=\"ghost\"\n                  onClick={() => handleRemoveItem(index)}\n                  className=\"text-red-600 hover:bg-red-50 rounded-lg p-1 h-6 w-6\"\n                  disabled={canEditLimited && !canEditAll}\n                >\n                  <Trash2 className=\"w-3 h-3\" />\n                </Button>\n              ) : (\n                <>\n                  {activeTab === 'purchase' && (\n                  <div className=\"flex flex-col items-center gap-1\">\n                    {/*   */}\n                    <div className=\"flex justify-center\">\n                      {canPurchase ? (\n                        <button\n                          onClick={() => handlePaymentToggle(item.id, !item.is_payment_completed)}\n                          className={`${\n                            item.is_payment_completed\n                              ? 'button-toggle-active bg-orange-500 hover:bg-orange-600 text-white'\n                              : 'button-toggle-inactive'\n                          }`}\n                        >\n                          {item.is_payment_completed ? '' : ''}\n                        </button>\n                      ) : (\n                        <span className={`${\n                          item.is_payment_completed \n                            ? 'button-toggle-active bg-orange-500 text-white' \n                            : 'button-waiting-inactive'\n                        }`}>\n                          {item.is_payment_completed ? '' : ''}\n                        </span>\n                      )}\n                    </div>\n                  </div>\n                )}\n                \n                {activeTab === 'receipt' && (\n                  <div className=\"flex justify-center\">\n                    {canReceiveItems ? (\n                      actualReceivedAction.isCompleted(item) ? (\n                        //   - \n                        <button\n                          onClick={() => {\n                            actualReceivedAction.handleCancel(item.id, {\n                              item_name: item.item_name,\n                              specification: item.specification,\n                              quantity: item.quantity,\n                              unit_price_value: item.unit_price_value,\n                              amount_value: item.amount_value,\n                              remark: item.remark\n                            })\n                          }}\n                          className=\"button-action-primary\"\n                        >\n                          {actualReceivedAction.config.completedText}\n                        </button>\n                      ) : actualReceivedAction.isPartiallyReceived(item) ? (\n                        //   -  (  )\n                        <DateQuantityPickerPopover\n                          onConfirm={(date, quantity) => {\n                            handleItemReceiptToggle(item.id, date, quantity)\n                          }}\n                          placeholder=\"  \"\n                          align=\"center\"\n                          side=\"bottom\"\n                          maxQuantity={actualReceivedAction.getRemainingQuantity(item)}\n                          quantityInfoText={`: ${actualReceivedAction.getRemainingQuantity(item)}`}\n                          allowOverMaxQuantity\n                        >\n                          <button className=\"button-base bg-blue-300 hover:bg-blue-400 text-white\">\n                            \n                          </button>\n                        </DateQuantityPickerPopover>\n                      ) : (\n                        //   - \n                        <DateQuantityPickerPopover\n                          onConfirm={(date, quantity) => {\n                            handleItemReceiptToggle(item.id, date, quantity)\n                          }}\n                          placeholder=\"  \"\n                          align=\"center\"\n                          side=\"bottom\"\n                          defaultQuantity={item.received_quantity ?? undefined}\n                          maxQuantity={item.quantity}\n                          allowOverMaxQuantity\n                        >\n                          <button className=\"button-toggle-inactive\">\n                            {actualReceivedAction.config.waitingText}\n                          </button>\n                        </DateQuantityPickerPopover>\n                      )\n                    ) : (\n                      <span className={`${\n                        actualReceivedAction.isCompleted(item)\n                          ? 'button-action-primary' \n                          : actualReceivedAction.isPartiallyReceived(item)\n                          ? 'button-base bg-blue-300 text-white'\n                          : 'button-waiting-inactive'\n                      }`}>\n                        {actualReceivedAction.isCompleted(item) \n                          ? actualReceivedAction.config.completedText \n                          : actualReceivedAction.isPartiallyReceived(item)\n                          ? ''\n                          : actualReceivedAction.config.waitingText}\n                      </span>\n                    )}\n                  </div>\n                )}\n                \n                {activeTab === 'done' && (\n                  <div className=\"flex justify-center\">\n                    {canReceiveItems ? (\n                      actualReceivedAction.isCompleted(item) ? (\n                        //   -  \n                        <button\n                          onClick={() => {\n                            actualReceivedAction.handleCancel(item.id, {\n                              item_name: item.item_name,\n                              specification: item.specification,\n                              quantity: item.quantity,\n                              unit_price_value: item.unit_price_value,\n                              amount_value: item.amount_value,\n                              remark: item.remark\n                            })\n                          }}\n                          className=\"button-base bg-blue-500 hover:bg-blue-600 text-white\"\n                        >\n                          {actualReceivedAction.config.completedText}\n                        </button>\n                      ) : actualReceivedAction.isPartiallyReceived(item) ? (\n                        //   -   \n                        <DateQuantityPickerPopover\n                          onConfirm={(date, quantity) => {\n                            handleItemReceiptToggle(item.id, date, quantity)\n                          }}\n                          placeholder=\"  \"\n                          align=\"center\"\n                          side=\"bottom\"\n                          maxQuantity={actualReceivedAction.getRemainingQuantity(item)}\n                          quantityInfoText={`: ${actualReceivedAction.getRemainingQuantity(item)}`}\n                          allowOverMaxQuantity\n                        >\n                          <button className=\"button-base bg-blue-300 hover:bg-blue-400 text-white\">\n                            \n                          </button>\n                        </DateQuantityPickerPopover>\n                      ) : (\n                        //  \n                        <DatePickerPopover\n                          onDateSelect={(date) => {\n                            actualReceivedAction.handleConfirm(item.id, date, {\n                              item_name: item.item_name,\n                              specification: item.specification,\n                              quantity: item.quantity,\n                              unit_price_value: item.unit_price_value,\n                              amount_value: item.amount_value,\n                              remark: item.remark\n                            })\n                          }}\n                          placeholder=\"   \"\n                          align=\"center\"\n                          side=\"bottom\"\n                        >\n                          <button className=\"button-base border border-gray-300 text-gray-600 bg-white hover:bg-gray-50\">\n                            {actualReceivedAction.config.waitingText}\n                          </button>\n                        </DatePickerPopover>\n                      )\n                    ) : (\n                      <span className={`button-base ${\n                        actualReceivedAction.isCompleted(item)\n                          ? 'bg-blue-500 hover:bg-blue-600 text-white' \n                          : actualReceivedAction.isPartiallyReceived(item)\n                          ? 'bg-blue-300 text-white'\n                          : 'border border-gray-300 text-gray-600 bg-white hover:bg-gray-50'\n                      }`}>\n                        {actualReceivedAction.isCompleted(item) \n                          ? '' \n                          : actualReceivedAction.isPartiallyReceived(item)\n                          ? ''\n                          : ''}\n                      </span>\n                    )}\n                  </div>\n                )}\n                \n                {activeTab !== 'purchase' && activeTab !== 'receipt' && activeTab !== 'done' && (\n                  <div className=\"flex justify-center\">\n                    <span className=\"badge-text\">-</span>\n                  </div>\n                )}\n              </>\n            )}\n            </div>\n          )}\n          \n          {/*    -    (  ) */}\n          {activeTab === 'receipt' && (\n            <div className=\"text-center flex justify-center items-center pl-2\">\n              {actualReceivedAction.getCompletedDate(item) ? (\n                <div className=\"modal-subtitle text-green-700\">\n                  {new Date(actualReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                    year: 'numeric',\n                    month: '2-digit',\n                    day: '2-digit'\n                  })}\n                </div>\n              ) : (\n                <span className=\"modal-subtitle text-gray-400\">-</span>\n              )}\n            </div>\n          )}\n\n          {/*   -  +  / */}\n          {showStatementColumns && (\n            <div className=\"text-center flex justify-center items-center\">\n              {canReceiptCheck ? (\n                statementReceivedAction.isCompleted(item) ? (\n                  <button\n                    onClick={() => {\n                      statementReceivedAction.handleCancel(item.id, {\n                        item_name: item.item_name,\n                        specification: item.specification,\n                        quantity: item.quantity,\n                        unit_price_value: item.unit_price_value,\n                        amount_value: item.amount_value,\n                        remark: item.remark\n                      })\n                    }}\n                    className=\"button-action-primary hover:bg-green-600\"\n                    title=\"   \"\n                  >\n                    {statementReceivedAction.config.completedText}\n                  </button>\n                ) : (\n                  <DatePickerPopover\n                    onDateSelect={(date) => {\n                      statementReceivedAction.handleConfirm(item.id, date, {\n                        item_name: item.item_name,\n                        specification: item.specification,\n                        quantity: item.quantity,\n                        unit_price_value: item.unit_price_value,\n                        amount_value: item.amount_value,\n                        remark: item.remark\n                      })\n                    }}\n                    placeholder=\"  \"\n                    align=\"center\"\n                    side=\"bottom\"\n                  >\n                    <button \n                      className=\"button-toggle-inactive\"\n                      onClick={() => {}}\n                    >\n                      {statementReceivedAction.config.waitingText}\n                    </button>\n                  </DatePickerPopover>\n                )\n              ) : (\n                <span className={`${\n                  statementReceivedAction.isCompleted(item)\n                    ? 'button-action-primary' \n                    : 'button-waiting-inactive'\n                }`}>\n                  {statementReceivedAction.isCompleted(item) ? statementReceivedAction.config.completedText : statementReceivedAction.config.waitingText}\n                </span>\n              )}\n            </div>\n          )}\n\n          {/*   -  +  / */}\n          {showStatementColumns && (\n            <div className=\"text-center flex justify-center items-center\">\n              {statementReceivedAction.getCompletedDate(item) ? (\n                <div className=\"modal-subtitle text-blue-700\">\n                  {new Date(statementReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                    year: 'numeric',\n                    month: '2-digit',\n                    day: '2-digit'\n                  })}\n                </div>\n              ) : (\n                <span className=\"modal-subtitle text-gray-400\">-</span>\n              )}\n            </div>\n          )}\n\n          {/*  -      */}\n          {showExpenditureColumn && (\n            <div className=\"text-center flex justify-center items-center\">\n              {(() => {\n                const hasExpenditure = !!item.expenditure_date\n                const hasExpenditureAmount = item.expenditure_amount !== null && item.expenditure_amount !== undefined\n                \n                if (canReceiptCheck) {\n                  return hasExpenditure ? (\n                    <div className=\"w-full px-1 leading-none\">\n                      <div className=\"text-blue-700 text-[9px] leading-[1.1] font-normal\">\n                        {(() => {\n                          const date = new Date(item.expenditure_date)\n                          const year = date.getFullYear().toString().slice(-2)\n                          const month = (date.getMonth() + 1).toString().padStart(2, '0')\n                          const day = date.getDate().toString().padStart(2, '0')\n                          return `${year}.${month}.${day}`\n                        })()}\n                      </div>\n                      <div className=\"text-gray-700 text-[9px] leading-[1.1] font-normal\">\n                        {!canViewFinancialInfo \n                          ? '-' \n                          : (hasExpenditureAmount ? `${Number(item.expenditure_amount).toLocaleString()}` : '')}\n                      </div>\n                    </div>\n                  ) : (\n                    <DateAmountPickerPopover\n                      onConfirm={(date, amount) => handleItemExpenditure(item.id, date, amount)}\n                      placeholder=\"   \"\n                      align=\"center\"\n                      side=\"bottom\"\n                    >\n                      <button className=\"button-toggle-inactive\">\n                        \n                      </button>\n                    </DateAmountPickerPopover>\n                  )\n                } else {\n                  return hasExpenditure ? (\n                    <div className=\"w-full px-1 leading-none\">\n                      <div className=\"text-blue-700 text-[9px] leading-[1.1] font-normal\">\n                        {(() => {\n                          const date = new Date(item.expenditure_date)\n                          const year = date.getFullYear().toString().slice(-2)\n                          const month = (date.getMonth() + 1).toString().padStart(2, '0')\n                          const day = date.getDate().toString().padStart(2, '0')\n                          return `${year}.${month}.${day}`\n                        })()}\n                      </div>\n                      <div className=\"text-gray-700 text-[9px] leading-[1.1] font-normal\">\n                        {!canViewFinancialInfo \n                          ? '-' \n                          : (hasExpenditureAmount ? `${Number(item.expenditure_amount).toLocaleString()}` : '')}\n                      </div>\n                    </div>\n                  ) : (\n                    <span className=\"modal-subtitle text-gray-400\">-</span>\n                  )\n                }\n              })()}\n            </div>\n          )}\n\n        </div>\n        \n        {/* Mobile Layout */}\n        <div className=\"block sm:hidden space-y-2\">\n          <div className=\"flex justify-between items-start\">\n            <div className=\"flex-1 min-w-0 relative\">\n              {isEditing ? (\n                <Input\n                  value={item.item_name}\n                  onChange={(e) => handleItemChange(index, 'item_name', e.target.value)}\n                  onFocus={() => setFocusedInput(`m_item_name_${index}`)}\n                  onBlur={() => setFocusedInput(null)}\n                  className={`modal-label border-gray-200 rounded-lg w-full !px-1.5 !py-0.5 !text-[10px] focus:border-blue-400 transition-all duration-200 ${\n                    focusedInput === `m_item_name_${index}` \n                      ? '!h-auto !min-h-[20px] !absolute !z-[9999] !bg-white !shadow-lg !left-0 !right-0 !-translate-y-1/2 !top-1/2 !whitespace-normal' \n                      : '!h-5 !truncate'\n                  }`}\n                  placeholder=\"\"\n                />\n              ) : (\n                <div className=\"modal-value font-medium\">{item.item_name || ' '}</div>\n              )}\n              {isEditing ? (\n                <Input\n                  value={item.specification}\n                  onChange={(e) => handleItemChange(index, 'specification', e.target.value)}\n                  onFocus={() => setFocusedInput(`m_specification_${index}`)}\n                  onBlur={() => setFocusedInput(null)}\n                  className={`modal-label border-gray-200 rounded-lg mt-1 w-full !px-1.5 !py-0.5 !text-[10px] focus:border-blue-400 transition-all duration-200 ${\n                    focusedInput === `m_specification_${index}` \n                      ? '!h-auto !min-h-[20px] !absolute !z-[9999] !bg-white !shadow-lg !left-0 !right-0 !-translate-y-1/2 !top-1/2 !whitespace-normal !w-full' \n                      : '!h-5 !truncate'\n                  }`}\n                  placeholder=\"\"\n                />\n              ) : (\n                <div className=\"modal-subtitle text-gray-500\">{item.specification || '-'}</div>\n              )}\n            </div>\n            <div className=\"ml-3 text-right flex-shrink-0\">\n              {isEditing ? (\n                <Input\n                  type=\"number\"\n                  value={item.amount_value || 0}\n                  onChange={(e) => handleItemChange(index, 'amount_value', Number(e.target.value))}\n                  onWheel={(e) => e.currentTarget.blur()}\n                  className=\"border-gray-200 rounded-lg w-24 !h-6 !px-1.5 !py-0.5 !text-[10px] font-normal text-gray-600 focus:border-blue-400 text-right\"\n                  placeholder=\"\"\n                />\n              ) : (\n                <div className=\"modal-value font-semibold\">{formatMoney(item.amount_value || 0, getItemDisplayCurrency(item))}</div>\n              )}\n              <div className=\"text-[10px] text-gray-500 mt-0.5\">\n                {activeTab === 'done' && !canViewFinancialInfo \n                  ? '-' \n                  : `${formatMoney(item.unit_price_value || 0, getItemDisplayCurrency(item))}`} / \n              </div>\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-2\">\n            <div>\n              <span className=\"text-gray-500 text-xs\"></span>\n              {isEditing ? (\n                (activeTab === 'receipt' || activeTab === 'done') ? (\n                  <div className=\"grid grid-cols-2 gap-1 mt-1\">\n                    <Input\n                      type=\"number\"\n                      value={item.quantity}\n                      onChange={(e) => handleItemChange(index, 'quantity', Number(e.target.value))}\n                      className=\"border-gray-200 rounded-lg text-center w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                      placeholder=\"\"\n                      max=\"99999\"\n                    />\n                    <Input\n                      type=\"number\"\n                      value={item.received_quantity ?? ''}\n                      onChange={(e) => handleItemChange(index, 'received_quantity', e.target.value ? Number(e.target.value) : null)}\n                      className=\"border-gray-200 rounded-lg text-center w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                      placeholder=\"\"\n                      max=\"99999\"\n                    />\n                  </div>\n                ) : (\n                  <Input\n                    type=\"number\"\n                    value={item.quantity}\n                    onChange={(e) => handleItemChange(index, 'quantity', Number(e.target.value))}\n                    className=\"border-gray-200 rounded-lg text-center w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400 mt-1\"\n                    placeholder=\"\"\n                    max=\"99999\"\n                  />\n                )\n              ) : (\n                <div className=\"modal-subtitle mt-1\">\n                  {activeTab === 'receipt' || activeTab === 'done' ? (\n                    <>\n                      <span className=\"text-gray-500\">{item.quantity || 0}</span>\n                      <span className=\"text-gray-400\">/{item.received_quantity ?? 0}</span>\n                    </>\n                  ) : (\n                    item.quantity || 0\n                  )}\n                </div>\n              )}\n            </div>\n\n            <div>\n              <span className=\"text-gray-500 text-xs\"></span>\n              <div className=\"mt-1\">\n                {isEditing ? (\n                  <Input\n                    value={item.link || ''}\n                    onChange={(e) => handleItemChange(index, 'link', e.target.value)}\n                    className=\"border-gray-200 rounded-lg text-center w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                    placeholder=\"(URL)\"\n                  />\n                ) : (\n                  item.link ? (\n                    <a\n                      href={item.link}\n                      target=\"_blank\"\n                      rel=\"noopener noreferrer\"\n                      className=\"text-blue-600 hover:text-blue-800 underline text-[11px] break-all\"\n                      onClick={(e) => e.stopPropagation()}\n                    >\n                      {item.link}\n                    </a>\n                  ) : (\n                    <span className=\"text-gray-400 text-[11px]\">-</span>\n                  )\n                )}\n              </div>\n            </div>\n          </div>\n\n          {/* / */}\n          <div className=\"grid grid-cols-2 gap-2 items-center\">\n            <div>\n              <span className=\"text-gray-500 text-xs\"></span>\n              <div className=\"mt-1\">\n                {activeTab === 'pending' ? (\n                  <span className=\"text-xs text-gray-400\">-</span>\n                ) : (\n                  <>\n                    {activeTab === 'purchase' && (\n                      <div className=\"flex items-center gap-2\">\n                        {canPurchase ? (\n                          <button\n                            onClick={() => handlePaymentToggle(item.id, !item.is_payment_completed)}\n                            className={`text-xs px-2 py-1 rounded ${\n                              item.is_payment_completed\n                                ? 'button-action-primary'\n                                : 'bg-gray-100 text-gray-600'\n                            }`}\n                          >\n                            {item.is_payment_completed ? '' : ''}\n                          </button>\n                        ) : (\n                          <span className={`text-xs px-2 py-1 rounded ${\n                            item.is_payment_completed \n                              ? 'button-action-primary' \n                              : 'bg-gray-100 text-gray-400'\n                          }`}>\n                            {item.is_payment_completed ? '' : ''}\n                          </span>\n                        )}\n                      </div>\n                    )}\n\n                    {activeTab === 'receipt' && (\n                      <div className=\"flex items-center gap-2\">\n                        {canReceiveItems ? (\n                          actualReceivedAction.isCompleted(item) ? (\n                            <button\n                              onClick={() => {\n                                actualReceivedAction.handleCancel(item.id, {\n                                  item_name: item.item_name,\n                                  specification: item.specification,\n                                  quantity: item.quantity,\n                                  unit_price_value: item.unit_price_value,\n                                  amount_value: item.amount_value,\n                                  remark: item.remark\n                                })\n                              }}\n                              className=\"text-xs px-2 py-1 rounded button-action-primary\"\n                            >\n                              {actualReceivedAction.config.completedText}\n                            </button>\n                          ) : (\n                            <DatePickerPopover\n                              onDateSelect={(date) => {\n                                actualReceivedAction.handleConfirm(item.id, date, {\n                                  item_name: item.item_name,\n                                  specification: item.specification,\n                                  quantity: item.quantity,\n                                  unit_price_value: item.unit_price_value,\n                                  amount_value: item.amount_value,\n                                  remark: item.remark\n                                })\n                              }}\n                              placeholder=\"   \"\n                              align=\"center\"\n                              side=\"bottom\"\n                            >\n                              <button className=\"text-xs px-2 py-1 rounded bg-gray-100 text-gray-600\">\n                                {actualReceivedAction.config.waitingText}\n                              </button>\n                            </DatePickerPopover>\n                          )\n                        ) : (\n                          <span className={`text-xs px-2 py-1 rounded ${\n                            actualReceivedAction.isCompleted(item)\n                              ? 'button-action-primary' \n                              : 'bg-gray-100 text-gray-400'\n                          }`}>\n                            {actualReceivedAction.isCompleted(item) ? actualReceivedAction.config.completedText : actualReceivedAction.config.waitingText}\n                          </span>\n                        )}\n                      </div>\n                    )}\n                    \n                    {activeTab === 'done' && (\n                      <>\n                        <span className={`button-base ${\n                          actualReceivedAction.isCompleted(item)\n                            ? 'bg-green-500 text-white' \n                            : 'border border-gray-300 text-gray-600 bg-white'\n                        }`}>\n                          {actualReceivedAction.isCompleted(item) ? '' : ''}\n                        </span>\n                      </>\n                    )}\n                    \n                    {activeTab !== 'purchase' && activeTab !== 'receipt' && activeTab !== 'done' && (\n                      <span className=\"text-xs text-gray-400\">-</span>\n                    )}\n                  </>\n                )}\n              </div>\n            </div>\n\n            {(item.remark || isEditing) && (\n              <div>\n                <span className=\"text-gray-500 text-xs\">:</span>\n                {isEditing ? (\n                  <Input\n                    value={item.remark || ''}\n                    onChange={(e) => handleItemChange(index, 'remark', e.target.value)}\n                    className=\"modal-label border-gray-200 rounded-lg mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                    placeholder=\"\"\n                  />\n                ) : (\n                  <div className=\"modal-subtitle text-gray-500 mt-1\">{item.remark || '-'}</div>\n                )}\n              </div>\n            )}\n          </div>\n\n          {!isEditing && activeTab === 'receipt' && actualReceivedAction.getCompletedDate(item) && (\n            <div>\n              <span className=\"text-gray-500 text-xs\">:</span>\n              <div className=\"mt-1\">\n                <div className=\"modal-subtitle text-green-700\">\n                  {new Date(actualReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                    year: 'numeric',\n                    month: '2-digit',\n                    day: '2-digit'\n                  })}\n                </div>\n                <div className=\"text-[9px] text-gray-500\">\n                  {new Date(actualReceivedAction.getCompletedDate(item)).toLocaleTimeString('ko-KR', {\n                    hour: '2-digit',\n                    minute: '2-digit'\n                  })}\n                </div>\n              </div>\n            </div>\n          )}\n\n          {!isEditing && showStatementColumns && (\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-gray-500 text-xs\"> :</span>\n              <div className=\"flex items-center gap-2\">\n                {canReceiptCheck ? (\n                  statementReceivedAction.isCompleted(item) ? (\n                    <button\n                      onClick={() => {\n                        statementReceivedAction.handleCancel(item.id, {\n                          item_name: item.item_name,\n                          specification: item.specification,\n                          quantity: item.quantity,\n                          unit_price_value: item.unit_price_value,\n                          amount_value: item.amount_value,\n                          remark: item.remark\n                        })\n                      }}\n                      className=\"text-xs px-2 py-1 rounded button-action-primary\"\n                    >\n                      {statementReceivedAction.config.completedText}\n                    </button>\n                  ) : (\n                    <DatePickerPopover\n                      onDateSelect={(date) => {\n                        statementReceivedAction.handleConfirm(item.id, date, {\n                          item_name: item.item_name,\n                          specification: item.specification,\n                          quantity: item.quantity,\n                          unit_price_value: item.unit_price_value,\n                          amount_value: item.amount_value,\n                          remark: item.remark\n                        })\n                      }}\n                      placeholder=\"  \"\n                      align=\"center\"\n                      side=\"bottom\"\n                    >\n                      <button className=\"text-xs px-2 py-1 rounded bg-gray-100 text-gray-600\">\n                        {statementReceivedAction.config.waitingText}\n                      </button>\n                    </DatePickerPopover>\n                  )\n                ) : (\n                  <span className={`text-xs px-2 py-1 rounded ${\n                    statementReceivedAction.isCompleted(item)\n                      ? 'button-action-primary' \n                      : 'bg-gray-100 text-gray-400'\n                  }`}>\n                    {statementReceivedAction.isCompleted(item) ? statementReceivedAction.config.completedText : statementReceivedAction.config.waitingText}\n                  </span>\n                )}\n              </div>\n            </div>\n          )}\n\n          {!isEditing && showStatementColumns && statementReceivedAction.getCompletedDate(item) && (\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-gray-500 text-xs\"> :</span>\n              <span className=\"modal-subtitle text-blue-700\">\n                {new Date(statementReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                  year: 'numeric',\n                  month: '2-digit',\n                  day: '2-digit'\n                })}\n              </span>\n            </div>\n          )}\n\n          {!isEditing && showExpenditureColumn && (\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-gray-500 text-xs\">:</span>\n              <div className=\"text-right\">\n                {item.expenditure_date ? (\n                  <>\n                    <div className=\"text-blue-700 text-[11px]\">\n                      {(() => {\n                        const date = new Date(item.expenditure_date)\n                        const year = date.getFullYear().toString().slice(-2)\n                        const month = (date.getMonth() + 1).toString().padStart(2, '0')\n                        const day = date.getDate().toString().padStart(2, '0')\n                        return `${year}.${month}.${day}`\n                      })()}\n                    </div>\n                    <div className=\"text-gray-700 text-[11px]\">\n                      {!canViewFinancialInfo \n                        ? '-' \n                        : (item.expenditure_amount !== null && item.expenditure_amount !== undefined\n                          ? `${Number(item.expenditure_amount).toLocaleString()}`\n                          : '')}\n                    </div>\n                  </>\n                ) : (\n                  <span className=\"text-gray-400 text-[11px]\">-</span>\n                )}\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n    )\n  }\n\n  const content = (\n    <div className=\"space-y-1 sm:space-y-4\">\n      {loading ? (\n        <div className=\"flex items-center justify-center py-12\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-hansl-600\"></div>\n        </div>\n      ) : purchase ? (\n        <div>\n          {/* Compact Info Header */}\n          <div className=\"bg-gray-50 rounded-lg p-2 sm:p-3 mb-1 sm:mb-2 border border-gray-100\">\n            <div className=\"grid grid-cols-1 sm:grid-cols-3 items-center gap-3 sm:gap-0\">\n              <div className=\"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-4\">\n                <div className=\"flex items-center gap-3\">\n                  {getStatusBadge()}\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"modal-label\">:</span>\n                    <span className=\"modal-value\">{purchase.requester_name}</span>\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Calendar className=\"w-3 h-3 text-gray-500\" />\n                  <span className=\"modal-subtitle\">: {formatDate(purchase.request_date)}</span>\n                </div>\n              </div>\n              \n              {/*     */}\n              <div className=\"flex items-center justify-center gap-2 sm:gap-3 flex-wrap\">\n                {/* 1   */}\n                {(() => {\n                  const shouldShow = canApproveMiddle && purchase.middle_manager_status === 'pending';\n                  return shouldShow;\n                })() && (\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => handleApprove('middle')}\n                    className={`${approvalButtonClass} border border-gray-400 bg-white hover:bg-gray-50 hover:border-gray-500`}\n                  >\n                    1  \n                  </Button>\n                )}\n                {purchase.middle_manager_status === 'approved' && (\n                  <div className=\"button-approved badge-text shadow-sm\">\n                    <Check className=\"w-3 h-3\" />\n                    1 \n                  </div>\n                )}\n                {purchase.middle_manager_status === 'rejected' && (\n                  <div className=\"button-rejected badge-text\">\n                    <X className=\"w-3 h-3\" />\n                    1 \n                  </div>\n                )}\n                {purchase.middle_manager_status === 'pending' && !canApproveMiddle && (\n                  <div className={`${approvalWaitingPillClass} border border-gray-300 text-gray-600 bg-white`}>\n                    1 \n                  </div>\n                )}\n\n                {/*    */}\n                {(() => {\n                  const shouldShow = canApproveFinal && purchase.middle_manager_status === 'approved' && purchase.final_manager_status === 'pending';\n                  return shouldShow;\n                })() && (\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => handleApprove('final')}\n                    className={`${approvalButtonClass} border border-gray-400 bg-white hover:bg-gray-50 hover:border-gray-500`}\n                  >\n                    <Check className=\"w-3 h-3\" />\n                     \n                  </Button>\n                )}\n                {purchase.final_manager_status === 'approved' && (\n                  <div className=\"button-approved badge-text\">\n                    <Check className=\"w-3 h-3\" />\n                     \n                  </div>\n                )}\n                {purchase.final_manager_status === 'rejected' && (\n                  <div className=\"button-rejected badge-text\">\n                    <X className=\"w-3 h-3\" />\n                     \n                  </div>\n                )}\n                {purchase.middle_manager_status !== 'approved' && purchase.final_manager_status === 'pending' && (\n                  <div className={`${approvalWaitingPillClass} border border-gray-300 text-gray-600 bg-white`}>\n                     \n                  </div>\n                )}\n              </div>\n              \n              {/*    */}\n              <div></div>\n            </div>\n          </div>\n\n          {/* Main 2-Column Layout */}\n          <div className=\"flex flex-col lg:flex-row gap-3 sm:gap-6\">\n            {/* Left Column - Basic Info (Fixed Width) */}\n            <div className=\"lg:w-80 lg:flex-shrink-0 space-y-1 sm:space-y-4 relative\">\n              \n              {/*   */}\n              <div className=\"bg-white rounded-lg p-2 sm:p-3 border border-gray-100 shadow-sm\">\n                <div className=\"mb-3\">\n                  <div className=\"flex items-center justify-between\">\n                    <h3 className=\"modal-section-title flex items-center\">\n                      <FileText className=\"w-4 h-4 mr-2 text-gray-600\" />\n                      {purchase?.purchase_order_number || 'PO '}\n                    </h3>\n                    {canReceiptCheck && canViewFinancialInfo && (activeTab === 'done' || activeTab === 'receipt') && (\n                      <button\n                        onClick={handleToggleUtkCheck}\n                        className={`button-base text-xs px-2 py-1 flex items-center ${\n                          purchase?.is_utk_checked\n                            ? 'button-toggle-active bg-orange-500 hover:bg-orange-600 text-white'\n                            : 'button-toggle-inactive'\n                        }`}\n                        title={purchase?.is_utk_checked ? 'UTK  ' : 'UTK '}\n                      >\n                        <CheckCircle className=\"w-3 h-3 mr-1\" />\n                        UTK {purchase?.is_utk_checked ? '' : ''}\n                      </button>\n                    )}\n                  </div>\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\"> </span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.request_type || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, request_type: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"\"\n                          disabled={canEditLimited && !canEditAll}\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.request_type || ''}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\"> </span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.payment_category || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, payment_category: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"//\"\n                          disabled={canEditLimited && !canEditAll}\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.payment_category || '-'}</p>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\"> </span>\n                      {isEditing ? (\n                        <DatePickerPopover\n                          onDateSelect={(date) => {\n                            setEditedPurchase(prev => prev ? {\n                              ...prev,\n                              delivery_request_date: formatDateInput(date, 'yyyy-MM-dd')\n                            } : null)\n                          }}\n                          placeholder=\"  \"\n                          align=\"start\"\n                          side=\"bottom\"\n                        >\n                          <Button\n                            variant=\"outline\"\n                            className=\"mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] justify-start text-left font-normal business-radius-input\"\n                            disabled={canEditLimited && !canEditAll}\n                          >\n                            <Calendar className=\"mr-1 h-3 w-3\" />\n                            {editedPurchase?.delivery_request_date ? \n                              formatDate(editedPurchase.delivery_request_date) : \n                              ' '\n                            }\n                          </Button>\n                        </DatePickerPopover>\n                      ) : (\n                        <p className=\"modal-subtitle\">{formatDate(purchase.delivery_request_date)}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label text-orange-500\"> </span>\n                      {isEditing ? (\n                        <DatePickerPopover\n                          onDateSelect={(date) => {\n                            setEditedPurchase(prev => prev ? {\n                              ...prev,\n                              revised_delivery_request_date: formatDateInput(date, 'yyyy-MM-dd')\n                            } : null)\n                          }}\n                          placeholder=\"  \"\n                          align=\"start\"\n                          side=\"bottom\"\n                        >\n                          <Button\n                            variant=\"outline\"\n                            className=\"mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] justify-start text-left font-normal business-radius-input\"\n                            disabled={canEditLimited && !canEditAll}\n                          >\n                            <Calendar className=\"mr-1 h-3 w-3\" />\n                            {editedPurchase?.revised_delivery_request_date ? \n                              formatDate(editedPurchase.revised_delivery_request_date) : \n                              ' '\n                            }\n                          </Button>\n                        </DatePickerPopover>\n                      ) : (\n                        <p className=\"modal-subtitle text-orange-700\">\n                          {purchase.revised_delivery_request_date ? formatDate(purchase.revised_delivery_request_date) : ''}\n                        </p>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/*   */}\n              <div className=\"bg-white rounded-lg p-2 sm:p-3 border border-gray-100 shadow-sm\">\n                <h3 className=\"modal-section-title mb-3 flex items-center\">\n                  <Building2 className=\"w-4 h-4 mr-2 text-gray-600\" />\n                   \n                </h3>\n                \n                <div className=\"space-y-2\">\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\"></span>\n                      {isEditing ? (\n                        <ReactSelect\n                          options={vendors.map(v => ({ \n                            value: v.id.toString(), \n                            label: v.vendor_name \n                          }))}\n                          value={editedPurchase?.vendor_id ? {\n                            value: editedPurchase.vendor_id.toString(),\n                            label: editedPurchase.vendor_name || vendors.find(v => v.id === editedPurchase.vendor_id)?.vendor_name || ''\n                          } : null}\n                          isDisabled={canEditLimited && !canEditAll}\n                          onChange={(option) => {\n                            logger.info('ReactSelect onChange:', { option })\n                            if (option) {\n                              const selectedVendor = vendors.find(v => v.id.toString() === option.value)\n                              logger.info('Selected vendor:', { selectedVendor })\n                              if (selectedVendor) {\n                                //    \n                                const supabase = createClient()\n                                supabase\n                                  .from('vendor_contacts')\n                                  .select('id, contact_name, contact_email, contact_phone, position')\n                                  .eq('vendor_id', selectedVendor.id)\n                                  .then(({ data: contactsData, error }: { data: any, error: any }) => {\n                                    if (error) {\n                                      logger.error('   :', error)\n                                    }\n                                    \n                                    logger.info('   -   :', { \n                                      vendor_id: selectedVendor.id,\n                                      vendor_name: selectedVendor.vendor_name,\n                                      contactsData,\n                                      contactsCount: contactsData?.length || 0\n                                    })\n                                    logger.debug('  -  :', contactsData)\n                                    \n                                    setEditedPurchase(prev => {\n                                      const updated = prev ? { \n                                        ...prev, \n                                        vendor_id: selectedVendor.id,\n                                        vendor_name: selectedVendor.vendor_name,\n                                        vendor: selectedVendor,\n                                        vendor_contacts: Array.isArray(contactsData) ? contactsData : [],\n                                        contact_id: undefined,  //     \n                                        contact_name: undefined  //      \n                                      } : null\n                                      logger.info('   - editedPurchase  :', { \n                                        vendor_id: selectedVendor.id,\n                                        vendor_name: selectedVendor.vendor_name,\n                                        contactsData,\n                                        updated_vendor_contacts: updated?.vendor_contacts,\n                                        updated_full: updated\n                                      })\n                                      logger.debug('  - editedPurchase :', { updated })\n                                      return updated\n                                    })\n                                  })\n                              }\n                            } else {\n                              setEditedPurchase(prev => prev ? { \n                                ...prev, \n                                vendor_id: undefined,\n                                vendor_name: '',\n                                vendor: undefined,\n                                vendor_contacts: [],\n                                contact_id: undefined,  //     \n                                contact_name: undefined  //      \n                              } : null)\n                            }\n                          }}\n                          placeholder=\" \"\n                          isClearable\n                          isSearchable\n                          menuPortalTarget={document.body}\n                          styles={{\n                            control: (base) => ({\n                              ...base,\n                              minHeight: '20px',\n                              height: '20px',\n                              fontSize: '10px',\n                              borderRadius: '8px', // rounded-lg  \n                              borderColor: '#e5e7eb', // border-gray-200  \n                              borderWidth: '1px',\n                              backgroundColor: '#ffffff',\n                              boxShadow: 'none',\n                              paddingLeft: '6px', // px-1.5\n                              paddingRight: '6px', // px-1.5\n                              '&:hover': {\n                                borderColor: '#e5e7eb', // hover    \n                              },\n                              '&:focus-within': {\n                                borderColor: '#60a5fa', // focus:border-blue-400\n                                boxShadow: 'none',\n                                outline: 'none',\n                              },\n                            }),\n                            valueContainer: (base) => ({\n                              ...base,\n                              height: '18px', // Input   \n                              padding: '0 2px', //   \n                              margin: '0',\n                            }),\n                            input: (base) => ({\n                              ...base,\n                              margin: '0',\n                              padding: '0',\n                              fontSize: '10px',\n                            }),\n                            indicatorsContainer: (base) => ({\n                              ...base,\n                              height: '18px',\n                              padding: '0',\n                            }),\n                            indicatorSeparator: () => ({\n                              display: 'none',\n                            }),\n                            dropdownIndicator: (base) => ({\n                              ...base,\n                              padding: '0 2px',\n                              svg: {\n                                width: '12px',\n                                height: '12px',\n                              },\n                            }),\n                            clearIndicator: (base) => ({\n                              ...base,\n                              padding: '0 2px',\n                              svg: {\n                                width: '12px',\n                                height: '12px',\n                              },\n                            }),\n                            option: (base) => ({\n                              ...base,\n                              fontSize: '10px',\n                              padding: '4px 8px',\n                            }),\n                            menuPortal: (base) => ({\n                              ...base,\n                              zIndex: 9999,\n                            }),\n                          }}\n                          classNamePrefix=\"vendor-select\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.vendor?.vendor_name || '-'}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\"> </span>\n                      {isEditing ? (\n                        editedPurchase?.vendor_id ? (\n                          <ReactSelect\n                            isDisabled={canEditLimited && !canEditAll}\n                            options={(() => {\n                              const contacts = Array.isArray(editedPurchase.vendor_contacts) ? editedPurchase.vendor_contacts : []\n                              //  : id    ( ID  )\n                              const uniqueContacts = contacts.filter((contact, index, arr) => \n                                arr.findIndex(c => c.id === contact.id) === index\n                              )\n                              //  contact_name    (   ID  )\n                              const finalUniqueContacts = uniqueContacts.filter((contact, index, arr) => \n                                arr.findIndex(c => c.contact_name === contact.contact_name) === index\n                              )\n                              const options = finalUniqueContacts.map(c => ({\n                                value: c.id.toString(),\n                                label: c.contact_name || ''\n                              })) || []\n                              logger.info('   :', {\n                                vendor_id: editedPurchase.vendor_id,\n                                vendor_contacts_raw: editedPurchase.vendor_contacts,\n                                vendor_contacts_count: contacts.length,\n                                unique_by_id_count: uniqueContacts.length,\n                                final_unique_count: finalUniqueContacts.length,\n                                options\n                              })\n                              logger.debug('  :', { options })\n                              return options\n                            })()}\n                            value={(() => {\n                              const contacts = Array.isArray(editedPurchase.vendor_contacts) ? editedPurchase.vendor_contacts : []\n                              const firstContact = contacts[0]\n                              return firstContact?.id ? {\n                                value: firstContact.id.toString(),\n                                label: firstContact.contact_name || ''\n                              } : null\n                            })()}\n                            onChange={(option) => {\n                              logger.info('   :', { option })\n                              if (option) {\n                                const contacts = Array.isArray(editedPurchase.vendor_contacts) ? editedPurchase.vendor_contacts : []\n                                const selectedContact = contacts.find(c => c.id.toString() === option.value)\n                                if (selectedContact) {\n                                  setEditedPurchase(prev => prev ? {\n                                    ...prev,\n                                    contact_id: selectedContact.id,\n                                    contact_name: selectedContact.contact_name,\n                                    vendor_contacts: [selectedContact, ...contacts.filter(c => c.id !== selectedContact.id)]\n                                  } : null)\n                                }\n                              } else {\n                                setEditedPurchase(prev => prev ? {\n                                  ...prev,\n                                  contact_id: undefined,\n                                  contact_name: undefined,\n                                  vendor_contacts: Array.isArray(editedPurchase.vendor_contacts) ? editedPurchase.vendor_contacts : []\n                                } : null)\n                              }\n                            }}\n                            placeholder=\" \"\n                            isClearable\n                            isSearchable\n                            noOptionsMessage={() => \" \"}\n                            menuPortalTarget={document.body}\n                            styles={{\n                              control: (base) => ({\n                                ...base,\n                                minHeight: '20px',\n                                height: '20px',\n                                fontSize: '10px',\n                                borderRadius: '8px', // rounded-lg  \n                                borderColor: '#e5e7eb', // border-gray-200  \n                                borderWidth: '1px',\n                                backgroundColor: '#ffffff',\n                                boxShadow: 'none',\n                                paddingLeft: '6px', // px-1.5\n                                paddingRight: '6px', // px-1.5\n                                '&:hover': {\n                                  borderColor: '#e5e7eb', // hover    \n                                },\n                                '&:focus-within': {\n                                  borderColor: '#60a5fa', // focus:border-blue-400\n                                  boxShadow: 'none',\n                                  outline: 'none',\n                                },\n                              }),\n                              valueContainer: (base) => ({\n                                ...base,\n                                height: '18px', // Input   \n                                padding: '0 2px', //   \n                                margin: '0',\n                              }),\n                              input: (base) => ({\n                                ...base,\n                                margin: '0',\n                                padding: '0',\n                                fontSize: '10px',\n                              }),\n                              indicatorsContainer: (base) => ({\n                                ...base,\n                                height: '18px',\n                                padding: '0',\n                              }),\n                              indicatorSeparator: () => ({\n                                display: 'none',\n                              }),\n                              dropdownIndicator: (base) => ({\n                                ...base,\n                                padding: '0 2px',\n                                svg: {\n                                  width: '12px',\n                                  height: '12px',\n                                },\n                              }),\n                              clearIndicator: (base) => ({\n                                ...base,\n                                padding: '0 2px',\n                                svg: {\n                                  width: '12px',\n                                  height: '12px',\n                                },\n                              }),\n                              option: (base) => ({\n                                ...base,\n                                fontSize: '10px',\n                                padding: '4px 8px',\n                              }),\n                              menuPortal: (base) => ({\n                                ...base,\n                                zIndex: 9999,\n                              }),\n                            }}\n                            classNamePrefix=\"contact-select\"\n                          />\n                        ) : (\n                          <Input\n                            value=\"\"\n                            disabled\n                            className=\"mt-1 rounded-lg border-gray-200 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                            placeholder=\"  \"\n                          />\n                        )\n                      ) : (\n                        <p className=\"modal-value\">{(() => {\n                          // : 1. contact_name , 2. vendor_contacts    , 3. '-'\n                          const contacts = Array.isArray(purchase.vendor_contacts) ? purchase.vendor_contacts : []\n                          const contactName = (purchase as any).contact_name ||\n                                            contacts[0]?.contact_name || \n                                            '-'\n                          logger.info(' vendor_contacts display :', { \n                            purchase_id: purchase?.id,\n                            vendor_id: purchase?.vendor_id,\n                            contact_id: purchase?.contact_id,\n                            vendor_contacts: purchase.vendor_contacts,\n                            purchase_contact_name: purchase.contact_name,\n                            contactName,\n                            purchase_full: purchase\n                          })\n                          logger.debug('vendor_contacts display :', { \n                            purchase_id: purchase?.id,\n                            vendor_id: purchase?.vendor_id,\n                            contact_id: purchase?.contact_id,\n                            vendor_contacts: purchase.vendor_contacts,\n                            purchase_contact_name: purchase.contact_name,\n                            contactName\n                          })\n                          return contactName\n                        })()}</p>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">PJ</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.project_vendor || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, project_vendor: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"\"\n                          disabled={canEditLimited && !canEditAll}\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.project_vendor || '-'}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">Item</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.project_item || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, project_item: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"\"\n                          disabled={canEditLimited && !canEditAll}\n                        />\n                      ) : (\n                        <p\n                          className=\"modal-subtitle break-all whitespace-pre-wrap\"\n                          style={{ whiteSpace: 'pre-wrap', wordBreak: 'break-all' }}\n                        >\n                          {purchase.project_item || '-'}\n                        </p>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\"></span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.sales_order_number || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, sales_order_number: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"\"\n                          disabled={canEditLimited && !canEditAll}\n                        />\n                      ) : (\n                        <p className=\"modal-subtitle\">{purchase.sales_order_number || '-'}</p>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/*   */}\n              {linkedStatements.length > 0 && (\n                <div className=\"bg-white rounded-lg p-2 sm:p-3 border border-gray-100 shadow-sm mt-3\">\n                  <div className=\"mb-2\">\n                    <h3 className=\"modal-section-title flex items-center\">\n                      <FileCheck className=\"w-4 h-4 mr-2 text-gray-600\" />\n                       \n                      <span className=\"ml-2 badge-stats bg-green-500 text-white text-[10px]\">\n                        {linkedStatements.length}\n                      </span>\n                    </h3>\n                  </div>\n                  <div className=\"space-y-2\">\n                    {linkedStatements.map((stmt) => (\n                      <div\n                        key={stmt.id}\n                        className=\"flex items-center justify-between p-2 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors\"\n                        onClick={() => handleViewStatementImage(stmt.image_url)}\n                      >\n                        <div className=\"flex items-center gap-2 min-w-0\">\n                          <ImageIcon className=\"w-4 h-4 text-gray-400 flex-shrink-0\" />\n                          <div className=\"min-w-0\">\n                            <p className=\"text-xs font-medium text-gray-900 truncate\">\n                              {stmt.vendor_name || stmt.file_name || ''}\n                            </p>\n                            <p className=\"text-[10px] text-gray-500\">\n                              {stmt.statement_date \n                                ? formatDate(stmt.statement_date)\n                                : formatDate(stmt.uploaded_at)\n                              }\n                              {stmt.grand_total && (\n                                <span className=\"ml-2 text-gray-700\">\n                                  {stmt.grand_total.toLocaleString()}\n                                </span>\n                              )}\n                            </p>\n                          </div>\n                        </div>\n                        <Button\n                          size=\"sm\"\n                          variant=\"ghost\"\n                          className=\"h-6 w-6 p-0 flex-shrink-0\"\n                          title=\" \"\n                        >\n                          <ImageIcon className=\"w-3 h-3\" />\n                        </Button>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n            </div>\n\n            {/* Right Column - Items List */}\n            {/* NOTE: iPad(lg=1024)  w-fit        */}\n            <div className=\"w-full min-w-0 xl:w-fit relative\">\n              \n              <div className=\"bg-white rounded-lg border border-gray-100 shadow-sm overflow-hidden\">\n                <div className=\"p-2 sm:p-3 bg-gray-50 border-b border-gray-100 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-0\">\n                  <h3 className=\"modal-section-title flex items-center\">\n                    <Package className=\"w-4 h-4 mr-2 text-gray-600\" />\n                     \n                    <span className=\"ml-2 badge-stats bg-gray-500 text-white\">\n                      {currentItems?.length || 0}\n                    </span>\n                    {isEditing ? (\n                      <ReactSelect\n                        isDisabled={canEditLimited && !canEditAll}\n                        options={[\n                          { value: 'KRW', label: 'KRW' },\n                          { value: 'USD', label: 'USD' },\n                          { value: 'EUR', label: 'EUR' },\n                          { value: 'JPY', label: 'JPY' },\n                          { value: 'CNY', label: 'CNY' },\n                        ]}\n                        value={editedPurchase?.currency ? {\n                          value: editedPurchase.currency,\n                          label: editedPurchase.currency\n                        } : { value: 'KRW', label: 'KRW' }}\n                        onChange={(option) => {\n                          if (option) {\n                            setEditedPurchase(prev => prev ? { ...prev, currency: option.value as 'KRW' | 'USD' } : null)\n                          }\n                        }}\n                        menuPortalTarget={document.body}\n                        styles={{\n                          control: (base) => ({\n                            ...base,\n                            minHeight: '20px',\n                            height: '20px',\n                            width: '75px',\n                            fontSize: '10px',\n                            borderRadius: '8px',\n                            borderColor: '#e5e7eb',\n                            marginLeft: '8px',\n                          }),\n                          valueContainer: (base) => ({\n                            ...base,\n                            padding: '0 6px',\n                            height: '20px',\n                          }),\n                          singleValue: (base) => ({\n                            ...base,\n                            margin: 0,\n                            position: 'absolute',\n                            top: '50%',\n                            transform: 'translateY(-50%)',\n                          }),\n                          input: (base) => ({\n                            ...base,\n                            margin: 0,\n                            padding: 0,\n                          }),\n                          indicatorsContainer: (base) => ({\n                            ...base,\n                            height: '20px',\n                          }),\n                          indicatorSeparator: () => ({ display: 'none' }),\n                          dropdownIndicator: (base) => ({\n                            ...base,\n                            padding: '0 4px',\n                          }),\n                          option: (base) => ({\n                            ...base,\n                            fontSize: '10px',\n                            padding: '4px 8px',\n                          }),\n                          menuPortal: (base) => ({\n                            ...base,\n                            zIndex: 9999,\n                          }),\n                        }}\n                      />\n                    ) : (\n                      <span className=\"ml-2 badge-stats bg-blue-500 text-white\">\n                        {purchase.currency || 'KRW'}\n                      </span>\n                    )}\n                  </h3>\n                  {!isEditing && (\n                    <>\n                      {activeTab === 'purchase' && canPurchase && (\n                        <Button\n                          size=\"sm\"\n                          onClick={handleCompleteAllPayment}\n                          className=\"button-base bg-orange-500 hover:bg-orange-600 text-white\"\n                        >\n                          <CreditCard className=\"w-3 h-3 mr-1\" />\n                           \n                        </Button>\n                      )}\n                      {activeTab === 'receipt' && canReceiveItems && (\n                        <DateQuantityPickerPopover\n                          onConfirm={handleCompleteAllReceipt}\n                          placeholder=\" \"\n                          align=\"end\"\n                          side=\"bottom\"\n                          hideQuantityInput={true}\n                          quantityInfoText=\"   \"\n                        >\n                          <Button\n                            size=\"sm\"\n                            className=\"button-base button-action-primary\"\n                          >\n                            <Truck className=\"w-3 h-3 mr-1\" />\n                             \n                          </Button>\n                        </DateQuantityPickerPopover>\n                      )}\n                      {showStatementColumns && canReceiptCheck && canViewFinancialInfo && (\n                        <div className=\"flex items-center gap-2\">\n                          <DatePickerPopover\n                            onDateSelect={handleCompleteAllStatement}\n                            placeholder=\"   \"\n                            align=\"end\"\n                            side=\"bottom\"\n                          >\n                            <Button\n                              size=\"sm\"\n                              className=\"button-base button-action-primary\"\n                            >\n                              <FileText className=\"w-3 h-3 mr-1\" />\n                               \n                            </Button>\n                          </DatePickerPopover>\n                          {activeTab === 'done' && purchase.payment_category === '' && (\n                            <DateAmountPickerPopover\n                              onConfirm={handleBulkExpenditure}\n                              placeholder=\"    \"\n                              align=\"end\"\n                              side=\"bottom\"\n                            >\n                              <Button\n                                size=\"sm\"\n                                className=\"button-base button-action-primary\"\n                              >\n                                <DollarSign className=\"w-3 h-3 mr-1\" />\n                                \n                              </Button>\n                            </DateAmountPickerPopover>\n                          )}\n                        </div>\n                      )}\n                    </>\n                  )}\n                </div>\n                \n                {/* Mobile Table Header */}\n                <div className=\"block sm:hidden bg-gray-50 px-2 py-1 border-b border-gray-100\">\n                  <div className=\"text-xs font-medium text-gray-600\">  ( )</div>\n                </div>\n                \n                {/* Items List + Summary share ONE scroll (x+y) */}\n                <div className=\"max-h-[50vh] sm:max-h-[40vh] overflow-y-auto overflow-x-hidden sm:overflow-x-auto w-full\">\n                  <div className=\"min-w-max\">\n                    {/* Items Table Header - Sticky inside scroll container */}\n                    <div className={`bg-gray-50 px-2 sm:px-3 py-1 border-b border-gray-100 sticky top-0 z-20 min-w-max ${isEditing ? 'pl-7 sm:pl-8' : ''}`}>\n                      <div\n                        ref={headerRowRef}\n                        className=\"hidden sm:grid gap-1 modal-label min-w-max\"\n                        style={{\n                          gridTemplateColumns: getGridTemplateColumns()\n                        }}\n                      >\n                        <div className=\"text-center -ml-2 sm:-ml-3\">#</div>\n                        <div></div>\n                        <div></div>\n                        <div className=\"text-center\">\n                          {(activeTab === 'receipt' || activeTab === 'done') && !isEditing ? (\n                            <div className=\"flex flex-col items-center leading-tight\">\n                              <div className=\"text-[9px]\">/</div>\n                              <div className=\"text-[10px]\"></div>\n                            </div>\n                          ) : (\n                            ''\n                          )}\n                        </div>\n                        <div className=\"text-right\"></div>\n                        <div className=\"text-right\"></div>\n                        {purchase.payment_category === '' && (\n                          <div className=\"text-right\"></div>\n                        )}\n                        <div className=\"text-center\"></div>\n                        <div className=\"text-center\"></div>\n                        {activeTab !== 'pending' && (\n                          isEditing ? (\n                            <>\n                              <div className=\"text-center\"></div>\n                              {activeTab === 'receipt' && (\n                                <>\n                                  <div className=\"text-center\"></div>\n                                </>\n                              )}\n                              {showStatementColumns && (\n                                <>\n                                  <div className=\"text-center\"> </div>\n                                  <div className=\"text-center\"> </div>\n                                  {showExpenditureColumn && <div className=\"text-center\"></div>}\n                                </>\n                              )}\n                            </>\n                          ) : (\n                            <>\n                              <div className=\"text-center\">\n                                {activeTab === 'purchase'\n                                  ? ''\n                                  : (activeTab === 'receipt' || activeTab === 'done')\n                                  ? ''\n                                  : ''}\n                              </div>\n                              {activeTab === 'receipt' && (\n                                <>\n                                  <div className=\"text-center\"></div>\n                                </>\n                              )}\n                              {showStatementColumns && (\n                                <>\n                                  <div className=\"text-center\"> </div>\n                                  <div className=\"text-center\"> </div>\n                                  {showExpenditureColumn && <div className=\"text-center\"></div>}\n                                </>\n                              )}\n                            </>\n                          )\n                        )}\n                      </div>\n                      </div>\n                    {/* Rows */}\n                    <div className=\"pb-16\">\n                      {isEditing && (\n                        <DndContext sensors={sensors} collisionDetection={closestCenter} onDragEnd={handleDragEnd}>\n                          <SortableContext\n                            items={sortableIds}\n                            strategy={verticalListSortingStrategy}\n                          >\n                            {(editedItems || []).map((item, index) => (\n                              <SortableRow key={getSortableId(item, index)} id={getSortableId(item, index)}>\n                                {(dragProps) => renderItemRow(item, index, dragProps, getSortableId(item, index))}\n                              </SortableRow>\n                            ))}\n                          </SortableContext>\n                        </DndContext>\n                      )}\n                      {!isEditing && (\n                        <div className=\"divide-y divide-gray-100 overflow-visible min-w-max\">\n                          {(displayItems)?.map((item, index) => (\n                            renderItemRow(item, index, undefined, getSortableId(item, index))\n                          ))}\n                        </div>\n                      )}\n                    </div>\n\n                    {/* Desktop Summary (sticky bottom, shares horizontal scroll) */}\n                    <div className=\"hidden sm:block sticky bottom-0 z-20 bg-gray-50 border-t border-gray-100\">\n                      <div className=\"px-2 sm:px-3\">\n                        <div className=\"sm:grid items-center gap-1 py-2 min-w-max\" style={{\n                          gridTemplateColumns: getGridTemplateColumns()\n                        }}>\n                      {/*  */}\n                      <div className=\"-ml-2 sm:-ml-3\"></div>\n                      {/*  */}\n                      <div></div>\n                      {/*  */}\n                      <div></div>\n                      {/*  */}\n                      <div></div>\n                      {/*   -   */}\n                      <div className=\"text-right flex items-center justify-end\">\n                        <span className=\"text-[11px] text-gray-600 font-medium\"></span>\n                      </div>\n                      {/*   -    */}\n                      <div className=\"text-right flex items-center justify-end\">\n                        <span className=\"text-[12px] font-bold text-gray-900\">\n                          {activeTab === 'done' && !canViewFinancialInfo\n                            ? '-'\n                            : `${(isEditing ? editedPurchase?.currency : purchase.currency) === 'USD' ? '$' : ''}${formatCurrency(\n                                (displayItems)?.reduce((sum, item) => sum + (item.amount_value || 0), 0) || 0\n                              )}`}\n                        </span>\n                      </div>\n                      {/*   ( ) */}\n                      {purchase.payment_category === '' && (\n                        <div className=\"text-right flex items-center justify-end\">\n                          {/*   -    */}\n                          <span className=\"text-[12px] font-bold text-gray-900\">\n                            {activeTab === 'done' && !canViewFinancialInfo\n                              ? '-'\n                              : `${(isEditing ? editedPurchase?.currency : purchase.currency) === 'USD' ? '$' : ''}${formatCurrency(\n                                  (displayItems)?.reduce((sum, item) => sum + (item.tax_amount_value || 0), 0) || 0\n                                )}`}\n                          </span>\n                        </div>\n                      )}\n                      {/*  */}\n                      <div></div>\n                      {/*  */}\n                      <div></div>\n                      {/*    - pending  ,      */}\n                      {activeTab !== 'pending' && (\n                        isEditing ? (\n                          <div></div>\n                        ) : (\n                          <div className={activeTab === 'done' && purchase.payment_category === '' ? \"text-right flex items-center justify-end\" : \"\"}>\n                            {activeTab === 'done' && purchase.payment_category === '' && (\n                              <span className=\"text-[11px] text-gray-600 font-medium\"></span>\n                            )}\n                          </div>\n                        )\n                      )}\n                      {activeTab === 'receipt' && <div></div>}\n                      {activeTab === 'done' && (\n                        <>\n                          {/*   -      */}\n                          {purchase.payment_category === '' && (\n                            <>\n                              <div className=\"text-right flex items-center justify-end\">\n                                <div className=\"text-[12px] font-bold text-blue-700\">\n                                  {!canViewFinancialInfo\n                                    ? '-'\n                                    : `${formatCurrency(\n                                        purchase.total_expenditure_amount ??\n                                        ((isEditing ? editedItems : currentItems)?.reduce((sum: number, item: any) => {\n                                          return sum + (Number(item.expenditure_amount) || 0)\n                                        }, 0) || 0)\n                                      )}`}\n                                </div>\n                              </div>\n                              {/*    */}\n                              <div></div>\n                              {/*   */}\n                              <div></div>\n                            </>\n                          )}\n                        </>\n                      )}\n                        </div>\n\n                        {/* +  ( ) */}\n                        {purchase.payment_category === '' && (\n                          <div className=\"sm:grid items-center gap-1 py-2 min-w-max border-t border-gray-300\" style={{\n                            gridTemplateColumns: getGridTemplateColumns()\n                          }}>\n                        {/*  */}\n                        <div className=\"-ml-2 sm:-ml-3\"></div>\n                        {/*   */}\n                        <div></div>\n                        <div></div>\n                        <div></div>\n                        {/*   -  */}\n                        <div></div>\n                        {/*   -   */}\n                        <div className=\"text-right flex items-center justify-end\">\n                          <span className=\"text-[11px] text-gray-600 font-medium\"></span>\n                        </div>\n                        {/*   - +  */}\n                        <div className=\"text-right flex items-center justify-end\">\n                          <span className=\"text-[12px] font-bold text-blue-600\">\n                            {activeTab === 'done' && !canViewFinancialInfo\n                              ? '-'\n                              : formatMoney(\n                                  (isEditing ? editedItems : currentItems)?.reduce((sum, item) => {\n                                    const amount = item.amount_value || 0\n                                    const tax = item.tax_amount_value || 0\n                                    return sum + amount + tax\n                                  }, 0) || 0\n                                , getPurchaseDisplayCurrency())}\n                          </span>\n                        </div>\n                        {/*   -  */}\n                        <div></div>\n                        {/*    */}\n                        <div></div>\n                        {isEditing ? <div></div> : <div></div>}\n                        {activeTab === 'receipt' && <div></div>}\n                        {activeTab === 'done' && purchase.payment_category === '' && (\n                          <>\n                            {/*   */}\n                            <div></div>\n                            {/*    */}\n                            <div></div>\n                            {/*   */}\n                            <div></div>\n                          </>\n                        )}\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Mobile  */}\n                <div className=\"bg-gray-50 px-2 sm:px-3 border-t border-gray-100\">\n                  <div className=\"block sm:hidden py-2 space-y-1\">\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-[12px] text-gray-500\"> </span>\n                      <span className=\"text-[13px] font-bold text-gray-900\">\n                        {activeTab === 'done' && !canViewFinancialInfo \n                          ? '-' \n                          : formatMoney(\n                              (isEditing ? editedItems : currentItems)?.reduce((sum, item) => sum + (item.amount_value || 0), 0) || 0,\n                              getPurchaseDisplayCurrency()\n                            )}\n                      </span>\n                    </div>\n                    {/*  ( ) */}\n                    {purchase.payment_category === '' && (\n                      <>\n                        <div className=\"flex justify-between items-center\">\n                          <span className=\"text-[12px] text-gray-500\"> </span>\n                          <span className=\"text-[13px] font-bold text-gray-900\">\n                            {activeTab === 'done' && !canViewFinancialInfo \n                              ? '-' \n                              : formatMoney(\n                                  (isEditing ? editedItems : currentItems)?.reduce((sum, item) => sum + (item.tax_amount_value || 0), 0) || 0,\n                                  getPurchaseDisplayCurrency()\n                                )}\n                          </span>\n                        </div>\n                        <div className=\"flex justify-between items-center border-t pt-1\">\n                          <span className=\"text-[12px] text-gray-500\">+</span>\n                          <span className=\"text-[13px] font-bold text-blue-600\">\n                            {activeTab === 'done' && !canViewFinancialInfo \n                              ? '-' \n                              : formatMoney(\n                                  (isEditing ? editedItems : currentItems)?.reduce((sum, item) => {\n                                    const amount = item.amount_value || 0\n                                    const tax = item.tax_amount_value || 0\n                                    return sum + amount + tax\n                                  }, 0) || 0,\n                                  getPurchaseDisplayCurrency()\n                                )}\n                          </span>\n                        </div>\n                      </>\n                    )}\n                    {/* Mobile   -    */}\n                    {activeTab === 'done' && purchase.payment_category === '' && (\n                      <div className=\"flex justify-between items-center border-t pt-1\">\n                        <span className=\"text-[12px] text-gray-500\"> </span>\n                        <span className=\"text-[13px] font-bold text-blue-700\">\n                          {!canViewFinancialInfo \n                            ? '-' \n                            : `${formatCurrency(\n                                purchase.total_expenditure_amount ??\n                                ((isEditing ? editedItems : currentItems)?.reduce((sum: number, item: any) => {\n                                  return sum + (Number(item.expenditure_amount) || 0)\n                                }, 0) || 0)\n                              )}`}\n                        </span>\n                      </div>\n                    )}\n                  </div>\n                </div>\n                \n                {/*    */}\n                {isEditing && (\n                  <div className=\"p-2 sm:p-3 border-t border-gray-100\">\n                    <Button\n                      type=\"button\"\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={handleAddItem}\n                      className=\"w-full rounded-lg border-dashed border-2 border-gray-300 hover:border-gray-400 py-2 badge-text\"\n                    >\n                      <Plus className=\"w-4 h-4 mr-1\" />\n                       \n                    </Button>\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n      ) : (\n        <div className=\"text-center py-12\">\n          {loading ? (\n            <div className=\"flex items-center justify-center gap-2\">\n              <div className=\"w-5 h-5 border-2 border-gray-300 border-t-transparent rounded-full animate-spin\" />\n              <span className=\"modal-subtitle\"> ...</span>\n            </div>\n          ) : (\n            <div className=\"space-y-3\">\n              <span className=\"modal-subtitle\">\n                   .\n              </span>\n              {!embedded && (\n                <div>\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={onClose}\n                    className=\"button-base button-action-secondary\"\n                  >\n                    \n                  </Button>\n                </div>\n              )}\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  )\n\n  // embedded true Dialog   \n  if (embedded) {\n    return content\n  }\n\n  // embedded false Dialog  \n  return (\n    <>\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent \n        className=\"overflow-hidden bg-white rounded-lg shadow-sm border-0 w-full sm:w-auto max-w-[calc(100vw-48px)] sm:max-w-[calc(100vw-80px)] lg:max-w-[90vw] xl:max-w-[85vw] h-[95vh] sm:h-auto sm:max-h-[90vh] lg:max-h-[85vh] sm:rounded-lg flex flex-col\" \n        showCloseButton={false}\n      >\n        <DialogHeader className=\"sr-only\">\n          <DialogTitle>  </DialogTitle>\n        </DialogHeader>\n        {/* Apple-style Header */}\n        <div className=\"relative px-3 sm:px-6 pt-0 sm:pt-3 lg:pt-4 pb-0 sm:pb-2 lg:pb-3 flex-shrink-0\">\n          <div className=\"absolute right-3 sm:right-6 top-3 sm:top-3 lg:top-4 flex items-center gap-2 z-10\">\n            {/*   (app_admin, final_approver, ceo, lead_buyer) */}\n            {!isEditing && canEdit && (\n              <Button\n                size=\"sm\"\n                variant=\"outline\"\n                onClick={() => handleEditToggle(true)}\n                className=\"button-base button-action-secondary h-8 text-xs px-3\"\n              >\n                <Edit2 className=\"w-3.5 h-3.5 mr-1.5\" />\n                \n              </Button>\n            )}\n            \n            {/*   */}\n            {!isEditing && canDelete && onDelete && (\n              <Button\n                size=\"sm\"\n                variant=\"outline\"\n                onClick={() => {\n                  if (purchase) {\n                    //      (    )\n                    onDelete(purchase);\n                    //             \n                  }\n                }}\n                className=\"button-base button-action-danger h-8 text-xs px-3\"\n              >\n                <Trash2 className=\"w-3.5 h-3.5 mr-1.5\" />\n                \n              </Button>\n            )}\n            \n            {/*   ( ,    lead_buyer) */}\n            {!isAdmin && !isEditing && (\n              <Popover open={isModifyRequestOpen} onOpenChange={handleModifyRequestOpenChange}>\n                <PopoverTrigger asChild>\n                  <Button \n                    variant=\"outline\" \n                    size=\"sm\" \n                    className=\"button-base button-action-secondary h-8 text-xs px-3 gap-1.5\"\n                    title=\" \"\n                  >\n                    <MessageSquarePlus className=\"w-3.5 h-3.5 text-gray-500\" />\n                    <span> </span>\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent \n                  className=\"w-[680px] max-w-[95vw] p-4\" \n                  align=\"end\"\n                  onOpenAutoFocus={(e) => e.preventDefault()}\n                >\n                  <div\n                    onWheel={handleModifyPopoverWheel}\n                    className=\"space-y-4 max-h-[70vh] overflow-y-auto pr-1\"\n                  >\n                    <div className=\"space-y-1\">\n                      <h4 className=\"modal-section-title text-gray-900\"> </h4>\n                      <p className=\"card-description text-gray-500\">\n                             .\n                      </p>\n                    </div>\n\n                    <div className=\"space-y-2\">\n                      <label className=\"modal-label text-gray-600\">  *</label>\n                      <Select value={modifyInquiryType} onValueChange={setModifyInquiryType}>\n                        <SelectTrigger\n                          size=\"sm\"\n                          className=\"button-base business-radius-input border border-gray-300 bg-white text-gray-700 w-auto !h-7 !px-2.5 !text-[11px]\"\n                          style={{ width: `${inquiryTypeControlWidthEm}em`, maxWidth: '100%' }}\n                        >\n                          <SelectValue placeholder={inquiryTypePlaceholder} />\n                        </SelectTrigger>\n                        <SelectContent\n                          className=\"text-[11px] business-radius-card\"\n                          style={{ minWidth: `${inquiryTypeMenuWidthEm}em` }}\n                        >\n                          {modifyInquiryTypeOptions.map((option) => (\n                            <SelectItem\n                              key={option.value}\n                              className=\"text-[11px] py-1.5\"\n                              value={option.value}\n                            >\n                              {option.label}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n\n                    <div className=\"space-y-2 p-3 bg-gray-50 business-radius-card border border-gray-200\">\n                      <div className=\"modal-section-title text-gray-900\"> </div>\n                      <div className=\"flex items-center gap-2\">\n                        <span className=\"card-title\">{purchase?.purchase_order_number || '()'}</span>\n                        <span className=\"card-subtitle\">{purchase?.vendor_name}</span>\n                        <span className=\"card-date\">\n                          {(purchase?.request_date || purchase?.created_at) &&\n                            formatDateInput(new Date(purchase.request_date || purchase.created_at), 'MM/dd')}\n                        </span>\n                      </div>\n                      {selectedPurchaseItems.length > 0 && (\n                        <div className=\"mt-2 space-y-1\">\n                          <div className=\"modal-label text-gray-600\"> </div>\n                          {selectedPurchaseItems.map((item: any, index: number) => (\n                            <div key={item.id || index} className=\"flex items-center gap-2 pl-2\">\n                              <span className=\"card-description text-gray-400\">{item.line_number ?? index + 1}.</span>\n                              <span className=\"card-description\">{item.item_name}</span>\n                              {item.specification && (\n                                <span className=\"card-description text-gray-500\">({item.specification})</span>\n                              )}\n                              <span className=\"card-description text-gray-500\">- {item.quantity}</span>\n                            </div>\n                          ))}\n                        </div>\n                      )}\n                    </div>\n\n                    {modifyInquiryType === 'delivery_date_change' && (\n                      <div className=\"space-y-3 p-3 bg-gray-50 business-radius-card border border-gray-200\">\n                        <div className=\"modal-section-title text-gray-900\">  </div>\n                        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                          <div>\n                            <label className=\"modal-label text-gray-600 mb-1 block\"> </label>\n                            <div className=\"modal-value text-gray-700\">\n                              {purchase?.delivery_request_date\n                                ? formatDateInput(new Date(purchase.delivery_request_date), 'yyyy-MM-dd')\n                                : '-'}\n                            </div>\n                          </div>\n                          <div>\n                            <label className=\"modal-label text-gray-600 mb-1 block\"> </label>\n                            <DatePickerPopover\n                              onDateSelect={setRequestedDeliveryDate}\n                              placeholder=\"  \"\n                              align=\"start\"\n                              side=\"bottom\"\n                            >\n                              <Button\n                                type=\"button\"\n                                variant=\"outline\"\n                                className=\"button-base justify-start border border-gray-300 bg-white text-gray-700 business-radius-input\"\n                              >\n                                <Calendar className=\"mr-2 h-3.5 w-3.5\" />\n                                {requestedDeliveryDate\n                                  ? formatDateInput(requestedDeliveryDate, 'yyyy-MM-dd')\n                                  : ' '}\n                              </Button>\n                            </DatePickerPopover>\n                          </div>\n                        </div>\n                      </div>\n                    )}\n\n                    {modifyInquiryType === 'quantity_change' && (\n                      <div className=\"space-y-3 p-3 bg-gray-50 business-radius-card border border-gray-200\">\n                        <div className=\"modal-section-title text-gray-900\">  </div>\n                        <div className=\"space-y-2\">\n                          {quantityChangeRows.map((row) => {\n                            const selectedItem = selectedPurchaseItems.find((item: any) => String(item.id) === row.itemId)\n\n                            return (\n                              <div key={row.id} className=\"flex flex-col sm:flex-row sm:items-center gap-2\">\n                                <div className=\"flex-1\">\n                                  <ReactSelect\n                                    value={itemOptions.find(option => option.value === row.itemId) || null}\n                                    onChange={(option) => updateQuantityRow(row.id, { itemId: (option as any)?.value || '' })}\n                                    options={itemOptions}\n                                    placeholder=\" /\"\n                                    isSearchable\n                                    noOptionsMessage={() => '  '}\n                                    filterOption={(option, inputValue) =>\n                                      option.label.toLowerCase().includes(inputValue.toLowerCase())\n                                    }\n                                    styles={getCompactSelectStyles(itemControlWidthPx, itemMenuWidthPx)}\n                                  />\n                                </div>\n                                <div className=\"badge-text text-gray-600 sm:w-24 text-right\">\n                                    :\n                                </div>\n                                <Input\n                                  type=\"number\"\n                                  value={row.newQuantity}\n                                  onChange={(e) => updateQuantityRow(row.id, { newQuantity: e.target.value })}\n                                  placeholder={`  : ${selectedItem?.quantity ?? '-'}`}\n                                  className=\"sm:w-28 business-radius-input h-7 !text-[11px] !leading-tight\"\n                                  min={0}\n                                />\n                                <button\n                                  type=\"button\"\n                                  onClick={() => removeQuantityRow(row.id)}\n                                  className=\"button-action-danger\"\n                                >\n                                  <Trash2 className=\"w-3.5 h-3.5 mr-1\" />\n                                  \n                                </button>\n                              </div>\n                            )\n                          })}\n                        </div>\n                        <button\n                          type=\"button\"\n                          onClick={addQuantityRow}\n                          className=\"button-action-secondary\"\n                        >\n                          <Plus className=\"w-3.5 h-3.5 mr-1\" />\n                           \n                        </button>\n                      </div>\n                    )}\n\n                    {modifyInquiryType === 'price_change' && (\n                      <div className=\"space-y-3 p-3 bg-gray-50 business-radius-card border border-gray-200\">\n                        <div className=\"modal-section-title text-gray-900\">/   </div>\n                        <div className=\"space-y-2\">\n                          {priceChangeRows.map((row) => {\n                            const selectedItem = selectedPurchaseItems.find((item: any) => String(item.id) === row.itemId)\n                            const currentUnitPrice = Number(selectedItem?.unit_price_value ?? selectedItem?.unit_price ?? 0)\n                            const currentAmount = Number(selectedItem?.amount_value ?? (currentUnitPrice * (selectedItem?.quantity ?? 0)))\n                            const currentUnitPriceLabel = selectedItem ? currentUnitPrice.toLocaleString('ko-KR') : '-'\n                            const currentAmountLabel = selectedItem ? currentAmount.toLocaleString('ko-KR') : '-'\n                            const placeholderText = row.changeType === 'amount'\n                              ? ` : ${currentAmountLabel}`\n                              : ` : ${currentUnitPriceLabel}`\n\n                            return (\n                              <div key={row.id} className=\"flex flex-col lg:flex-row lg:items-center gap-2\">\n                                <div className=\"flex-1\">\n                                  <ReactSelect\n                                    value={itemOptions.find(option => option.value === row.itemId) || null}\n                                    onChange={(option) => updatePriceRow(row.id, { itemId: (option as any)?.value || '' })}\n                                    options={itemOptions}\n                                    placeholder=\" /\"\n                                    isSearchable\n                                    noOptionsMessage={() => '  '}\n                                    filterOption={(option, inputValue) =>\n                                      option.label.toLowerCase().includes(inputValue.toLowerCase())\n                                    }\n                                    styles={getCompactSelectStyles(itemControlWidthPx, itemMenuWidthPx)}\n                                  />\n                                </div>\n                                <div className=\"flex items-center gap-2\">\n                                  <span className=\"badge-text text-gray-600\"> </span>\n                                  <Select\n                                    value={row.changeType}\n                                    onValueChange={(value) =>\n                                      updatePriceRow(row.id, { changeType: value as PriceChangeType, newValue: '' })\n                                    }\n                                  >\n                                    <SelectTrigger\n                                      size=\"sm\"\n                                      className=\"button-base business-radius-input border border-gray-300 bg-white text-gray-700 w-auto !h-7 !px-2.5 !text-[11px]\"\n                                    >\n                                      <SelectValue />\n                                    </SelectTrigger>\n                                    <SelectContent className=\"text-[11px] business-radius-card\">\n                                      {priceChangeTypeOptions.map((option) => (\n                                        <SelectItem\n                                          key={option.value}\n                                          className=\"text-[11px] py-1.5\"\n                                          value={option.value}\n                                        >\n                                          {option.label}\n                                        </SelectItem>\n                                      ))}\n                                    </SelectContent>\n                                  </Select>\n                                </div>\n                                <Input\n                                  type=\"text\"\n                                  inputMode=\"numeric\"\n                                  value={formatNumericInput(row.newValue)}\n                                  onChange={(e) => updatePriceRow(row.id, { newValue: normalizeNumericInput(e.target.value) })}\n                                  placeholder={placeholderText}\n                                  className=\"lg:w-40 business-radius-input h-7 !text-[11px] !leading-tight\"\n                                  min={0}\n                                />\n                                <button\n                                  type=\"button\"\n                                  onClick={() => removePriceRow(row.id)}\n                                  className=\"button-action-danger\"\n                                >\n                                  <Trash2 className=\"w-3.5 h-3.5 mr-1\" />\n                                  \n                                </button>\n                              </div>\n                            )\n                          })}\n                        </div>\n                        <button\n                          type=\"button\"\n                          onClick={addPriceRow}\n                          className=\"button-action-secondary\"\n                        >\n                          <Plus className=\"w-3.5 h-3.5 mr-1\" />\n                           \n                        </button>\n                      </div>\n                    )}\n\n                    <div>\n                      <label className=\"block modal-label text-gray-700 mb-1\">\n                         <span className=\"text-red-500\">*</span>\n                      </label>\n                      <div className=\"relative\" onWheel={(e) => e.stopPropagation()}>\n                        <Textarea\n                          value={modifyMessage}\n                          onChange={(e) => setModifyMessage(e.target.value)}\n                          className=\"business-radius-input min-h-20 text-[11px]\"\n                          placeholder=\"   \"\n                        />\n                      </div>\n                    </div>\n\n                    <div className=\"flex justify-end gap-2\">\n                      <Button \n                        variant=\"outline\" \n                        size=\"sm\" \n                        onClick={() => setIsModifyRequestOpen(false)}\n                        className=\"button-base border border-gray-300 bg-white text-gray-700\"\n                      >\n                        \n                      </Button>\n                      <Button \n                        size=\"sm\" \n                        onClick={handleSendModifyRequest}\n                        disabled={isSendingModify}\n                        className=\"button-base bg-blue-500 hover:bg-blue-600 text-white\"\n                      >\n                        {isSendingModify ? ' ...' : ' '}\n                      </Button>\n                    </div>\n                  </div>\n                </PopoverContent>\n              </Popover>\n            )}\n            \n            <button\n              onClick={onClose}\n              className=\"button-base button-action-secondary w-8 h-8 rounded-full flex items-center justify-center\"\n            >\n              <X className=\"w-4 h-4 text-gray-500\" />\n            </button>\n          </div>\n          \n          <div className=\"pr-8 sm:pr-16\">\n            <div className=\"flex items-start gap-4 mb-0 sm:mb-3\">\n              <div className=\"min-w-0 flex-1\">\n                <h1 className=\"page-title mb-0 sm:mb-1\">\n                   \n                </h1>\n              </div>\n              <div className=\"flex items-center gap-3\">\n                {isEditing && (\n                  <>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => {\n                        handleEditToggle(false)\n                        setEditedPurchase(purchase)\n                        setEditedItems(purchase?.items || [])\n                        setDeletedItemIds([])\n                      }}\n                      className=\"button-base button-action-secondary\"\n                    >\n                      <X className=\"w-4 h-4 mr-2\" />\n                      \n                    </Button>\n                    <Button\n                      size=\"sm\"\n                      onClick={handleSave}\n                      disabled={isSaving}\n                      className=\"button-base button-action-primary\"\n                    >\n                      {isSaving ? (\n                        <>\n                          <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                           ...\n                        </>\n                      ) : (\n                        <>\n                          <Save className=\"w-4 h-4 mr-2\" />\n                          \n                        </>\n                      )}\n                    </Button>\n                  </>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Apple-style Content */}\n        <div className=\"overflow-y-auto flex-1 px-3 sm:px-6 pb-1 sm:pb-6 mt-0\">\n          {content}\n        </div>\n      </DialogContent>\n      \n    </Dialog>\n    </>\n  )\n}\n\nexport default memo(PurchaseDetailModal)"],"names":["CircleCheckBig","createLucideIcon","d","key","DollarSign","x1","x2","y1","y2","GripVertical","cx","cy","r","Image","width","height","x","y","rx","ry","MessageSquarePlus","Pen","Truck","canUseDOM","window","document","createElement","isWindow","element","elementString","Object","prototype","toString","call","isNode","node","getWindow","target","_target$ownerDocument","_target$ownerDocument2","ownerDocument","defaultView","isDocument","Document","isHTMLElement","HTMLElement","isSVGElement","SVGElement","getOwnerDocument","useIsomorphicLayoutEffect","useLayoutEffect","useEffect","useEvent","handler","handlerRef","useRef","current","useCallback","_len","arguments","length","args","Array","_key","useLatestValue","value","dependencies","valueRef","useLazyMemo","callback","useMemo","newValue","useNodeRef","onChange","onChangeHandler","setNodeRef","usePrevious","ref","ids","useUniqueId","prefix","id","createAdjustmentFn","modifier","object","adjustments","reduce","accumulator","adjustment","entries","valueAdjustment","add","subtract","isKeyboardEvent","event","KeyboardEvent","getEventCoordinates","TouchEvent","isTouchEvent","touches","clientX","clientY","changedTouches","hasViewportRelativeCoordinates","CSS","freeze","Translate","transform","Math","round","Scale","scaleX","scaleY","Transform","join","Transition","_ref","property","duration","easing","SELECTOR","findFirstFocusableNode","matches","querySelector","hiddenStyles","display","HiddenText","React","style","LiveRegion","announcement","ariaLiveType","position","top","left","margin","border","padding","overflow","clip","clipPath","whiteSpace","role","DndMonitorContext","createContext","defaultScreenReaderInstructions","draggable","defaultAnnouncements","onDragStart","active","onDragOver","_ref2","over","onDragEnd","_ref3","onDragCancel","_ref4","Accessibility","announcements","container","hiddenTextDescribedById","screenReaderInstructions","announce","setAnnouncement","useState","useAnnouncement","liveRegionId","mounted","setMounted","listener","registerListener","useContext","Error","useDndMonitor","onDragMove","_ref5","_ref6","markup","Fragment","createPortal","Action","noop","defaultCoordinates","distanceBetween","p1","p2","sqrt","pow","sortCollisionsAsc","data","a","b","sortCollisionsDesc","centerOfRectangle","rect","closestCenter","collisionRect","droppableRects","droppableContainers","centerRect","collisions","droppableContainer","get","distBetween","push","sort","getIntersectionRatio","entry","max","right","min","bottom","targetArea","entryArea","intersectionArea","Number","toFixed","rectIntersection","intersectionRatio","getRectDelta","rect1","rect2","createRectAdjustmentFn","acc","getAdjustedRect","defaultOptions","ignoreTransform","getClientRect","options","getBoundingClientRect","transformOrigin","getComputedStyle","parsedTransform","startsWith","transformArray","slice","split","parseTransform","translateX","translateY","parseFloat","indexOf","w","h","inverseTransform","getTransformAgnosticClientRect","getScrollableAncestors","limit","scrollParents","findScrollableAncestors","scrollingElement","includes","computedStyle","overflowRegex","some","test","isScrollable","isFixed","parentNode","getFirstScrollableAncestor","firstScrollableAncestor","getScrollableElement","getScrollXCoordinate","scrollX","scrollLeft","getScrollYCoordinate","scrollY","scrollTop","getScrollCoordinates","Direction","isDocumentScrollingElement","getScrollPosition","scrollingContainer","minScroll","dimensions","innerHeight","innerWidth","clientHeight","clientWidth","maxScroll","scrollWidth","scrollHeight","isTop","isLeft","isBottom","isRight","defaultThreshold","getScrollDirectionAndSpeed","scrollContainer","scrollContainerRect","acceleration","thresholdPercentage","direction","speed","threshold","Backward","abs","Forward","getScrollElementRect","getScrollOffsets","scrollableAncestors","properties","Rect","constructor","this","scrollOffsets","axis","keys","getScrollOffset","defineProperty","currentOffsets","scrollOffsetsDeltla","enumerable","Listeners","listeners","removeAll","forEach","_this$target","removeEventListener","eventName","_this$target2","addEventListener","hasExceededDistance","delta","measurement","dx","dy","EventName","KeyboardCode","preventDefault","stopPropagation","defaultKeyboardCodes","start","Space","Enter","cancel","Esc","end","Tab","defaultKeyboardCoordinateGetter","currentCoordinates","code","Right","Left","Down","Up","KeyboardSensor","props","autoScrollEnabled","referenceCoordinates","windowListeners","handleKeyDown","bind","handleCancel","attach","handleStart","Resize","VisibilityChange","setTimeout","Keydown","activeNode","onStart","measure","scrollIntoView","block","inline","scrollIntoViewIfNeeded","context","keyboardCodes","coordinateGetter","scrollBehavior","handleEnd","newCoordinates","coordinatesDelta","scrollDelta","scrollElementRect","clampedCoordinates","canScrollX","canScrollY","newScrollCoordinates","canScrollToNewCoordinates","scrollTo","behavior","scrollBy","handleMove","coordinates","onMove","onEnd","detach","onCancel","isDistanceConstraint","constraint","Boolean","isDelayConstraint","activators","onActivation","nativeEvent","activator","activatorNode","AbstractPointerSensor","events","listenerTarget","_getEventCoordinates","EventTarget","getEventListenerTarget","activated","initialCoordinates","timeoutId","documentListeners","handleKeydown","removeTextSelection","activationConstraint","bypassActivationConstraint","move","name","passive","DragStart","ContextMenu","delay","handlePending","clearTimeout","offset","onPending","Click","capture","SelectionChange","_getEventCoordinates2","tolerance","distance","cancelable","onAbort","_this$document$getSel","getSelection","removeAllRanges","PointerSensor","super","isPrimary","button","events$1","MouseButton","RightClick","events$2","AutoScrollActivator","TraversalOrder","useAutoScroller","Pointer","canScroll","draggingRect","enabled","interval","order","TreeOrder","pointerCoordinates","scrollableAncestorRects","scrollIntent","disabled","previousDelta","previousIntent","defaultScrollIntent","sign","useScrollIntent","setAutoScrollInterval","clearAutoScrollInterval","intervalRef","setInterval","clearInterval","useInterval","scrollSpeed","scrollDirection","DraggableRect","scrollContainerRef","autoScroll","sortedScrollableAncestors","reverse","index","JSON","stringify","setup","MeasuringStrategy","MeasuringFrequency","defaultValue","Map","useInitialValue","computeFn","previousValue","useResizeObserver","handleResize","resizeObserver","ResizeObserver","disconnect","defaultMeasure","useRect","fallbackRect","setRect","measureRect","currentRect","isConnected","newRect","mutationObserver","handleMutations","MutationObserver","useMutationObserver","records","record","type","contains","observe","body","childList","subtree","defaultValue$1","useScrollOffsetsDelta","initialScrollOffsets","hasScrollOffsets","useWindowRect","getWindowClientRect","defaultValue$2","useDragOverlayMeasuring","handleNodeChange","children","firstChild","getMeasurableNode","nodeRef","setRef","defaultSensors","sensor","defaultData","defaultMeasuringConfiguration","droppable","strategy","WhileDragging","frequency","Optimized","dragOverlay","DroppableContainersMap","_super$get","toArray","from","values","getEnabled","filter","getNodeFor","_this$get$node$curren","_this$get","defaultPublicContext","activatorEvent","activeNodeRect","containerNodeRect","draggableNodes","measuringConfiguration","measureDroppableContainers","windowRect","measuringScheduled","defaultInternalContext","ariaDescribedById","dispatch","InternalContext","PublicContext","getInitialState","nodes","translate","containers","reducer","state","action","DragMove","DragEnd","DragCancel","RegisterDroppable","set","SetDroppableDisabled","UnregisterDroppable","delete","RestoreFocus","previousActivatorEvent","previousActiveId","activeElement","draggableNode","requestAnimationFrame","focusableNode","focus","ActiveDraggableContext","Status","DndContext","memo","_sensorContext$curren","_dragOverlay$nodeRef$","_dragOverlay$rect","_over$rect","accessibility","sensors","collisionDetection","measuring","modifiers","store","useReducer","dispatchMonitorEvent","registerMonitorListener","Set","_listener$type","useDndMonitorProvider","status","setStatus","Uninitialized","isInitialized","Initialized","activeId","activeRects","initial","translated","_node$data","activeRef","activeSensor","setActiveSensor","setActivatorEvent","latestProps","draggableDescribedById","enabledDroppableContainers","config","dragging","queue","setQueue","containersRef","Always","BeforeDragging","isDisabled","disabledRef","concat","map","useDroppableMeasuring","cachedNode","useCachedNode","activationCoordinates","autoScrollOptions","activeSensorDisablesAutoscroll","autoScrollGloballyDisabled","getAutoScrollerOptions","initialActiveNodeRect","useInitialRect","initialRect","initialized","rectDelta","useLayoutShiftScrollCompensation","layoutShiftCompensation","parentElement","sensorContext","draggingNode","draggingNodeRect","scrollAdjustedTranslate","overNode","usesDragOverlay","nodeRectDelta","previousNode","ancestors","useScrollableAncestors","elements","firstElement","rects","setRects","measureRects","useRects","modifiedTranslate","applyModifiers","overlayNodeRect","scrollCoordinates","setScrollCoordinates","prevElements","handleScroll","previousElements","cleanup","scrollableElement","useScrollOffsets","scrollAdjustment","activeNodeScrollDelta","overId","firstCollision","getFirstCollision","setOver","adjustScale","activeSensorRef","instantiateSensor","Sensor","sensorInstance","onDragAbort","onDragPending","unstable_batchedUpdates","Initializing","createHandler","async","cancelDrop","Promise","resolve","getSyntheticHandler","useCombineActivators","activeDraggableNode","dndKit","defaultPrevented","activationContext","capturedBy","teardownFns","teardown","useSensorSetup","overContainer","publicContext","internalContext","Provider","restoreFocus","NullContext","defaultRole","useDraggable","attributes","roleDescription","tabIndex","isDragging","setActivatorNodeRef","useSyntheticListeners","dataRef","defaultResizeObserverConfig","timeout","arrayMove","array","to","newArray","splice","getSortedRects","items","isValidIndex","rectSortingStrategy","activeIndex","overIndex","newRects","oldRect","defaultScale$1","verticalListSortingStrategy","_rects$activeIndex","fallbackActiveRect","overIndexRect","itemGap","clientRects","previousRect","nextRect","getItemGap$1","ID_PREFIX","Context","containerId","disableTransforms","useDragOverlay","sortedRects","SortableContext","userDefinedItems","disabledProp","item","previousItemsRef","itemsHaveChanged","i","itemsEqual","normalizeDisabled","contextValue","defaultNewIndexGetter","defaultAnimateLayoutChanges","isSorting","wasDragging","newIndex","previousItems","previousContainerId","transition","defaultTransition","transitionProperty","disabledTransition","defaultAttributes","useSortable","animateLayoutChanges","userDefinedAttributes","localDisabled","customData","getNewIndex","localStrategy","resizeObserverConfig","globalDisabled","globalStrategy","_localDisabled$dragga","_localDisabled$droppa","normalizeLocalDisabled","sortable","itemsAfterCurrentSortable","isOver","setDroppableNodeRef","previous","resizeObserverConnected","callbackId","resizeObserverDisabled","updateMeasurementsFor","resizeObserverTimeout","isArray","newElement","previousElement","unobserve","useDroppable","setDraggableNodeRef","refs","useCombinedRefs","displaceItem","shouldDisplaceDragSource","dragSourceDisplacement","finalTransform","shouldAnimateLayoutChanges","derivedTransform","setDerivedtransform","previousIndex","useDerivedTransform","getTransition","DateAmountPickerPopover","onConfirm","placeholder","align","side","defaultDate","defaultAmount","open","setOpen","selectedDate","setSelectedDate","amount","setAmount","jsxs","Popover","onOpenChange","jsx","PopoverTrigger","asChild","PopoverContent","className","sideOffset","Calendar","mode","selected","onSelect","locale","ko","initialFocus","fromDate","Date","toDate","defaultMonth","today","modifiersClassNames","Input","e","replace","numValue","parseInt","toLocaleString","Button","variant","size","onClick","amountNum","isNaN","DateQuantityPickerPopover","defaultQuantity","maxQuantity","allowOverMaxQuantity","hideQuantityInput","quantityInfoText","quantity","setQuantity","quantityNum","useConfirmDateAction","currentUserName","canPerformAction","purchaseId","onUpdate","onBeforeUpdate","onOptimisticUpdate","supabase","createClient","handleConfirm","itemId","itemInfo","receivedQuantity","logger","warn","toast","error","field","numericId","confirmMessage","item_name","specification","unit_price_value","amount_value","remark","confirm","updateData","is_statement_received","statement_received_date","dateToISOString","statement_received_by_name","requestedQuantity","currentReceivedQuantity","received_quantity","newReceivedQuantity","totalReceivedQuantity","existingItem","select","eq","single","existingHistory","receipt_history","newHistoryItem","seq","qty","date","by","updatedHistory","isFullyReceived","actual_received_date","is_received","delivery_status","debug","historyCount","update","info","markItemAsReceived","markItemAsStatementReceived","success","successMessage","itemName","markItemAsReceiptCanceled","markItemAsStatementCanceled","isCompleted","isPartiallyReceived","receivedQty","requestedQty","getRemainingQuantity","getCompletedDate","getCompletedByName","DONE_TAB_COLUMNS","label","description","defaultVisible","DEFAULT_COLUMN_VISIBILITY","column","REQUIRED_COLUMNS","RESTRICTED_COLUMNS","AUTHORIZED_ROLES","UTK_AUTHORIZED_ROLES","COLUMN_GROUPS","title","columns","normalizeOrderNumber","input","normalized","toUpperCase","poMatch","match","num","padStart","soMatch","transactionStatementService","uploadStatement","file","uploaderName","ext","pop","toLowerCase","uuid","crypto","randomUUID","storagePath","uploadData","uploadError","storage","upload","contentType","upsert","urlData","getPublicUrl","imageUrl","publicUrl","user","auth","getUser","statement","dbError","insert","image_url","file_name","uploaded_by","uploaded_by_name","message","statementId","extractStatementData","functions","invoke","getStatementWithItems","getStatements","filters","query","count","ascending","dateFrom","gte","dateTo","lte","search","or","range","allPurchaseIds","matched_purchase_id","purchaseInfoMap","purchases","in","p","purchase_order_number","sales_order_number","purchaseIds","matchedPurchases","purchase_id","rest","matched_purchases","stmtError","itemsError","statementVendorName","vendor_name","itemsWithMatch","all","matchCandidates","findMatchCandidates","matchedPurchase","matchedItem","purchase","vendor","matched_item_id","purchaseItem","match_candidates","matched_purchase","matched_item","candidateMap","rawNumber","extracted_po_number","normalizedNumber","partialPOMatch","partialSOMatch","isPartialNumber","datePrefix","byNumber","sysVendorName","vendorSimilarity","calculateVendorSimilarity","matchReasons","score","extracted_item_name","itemMatch","calculateItemMatchScore","matchedField","extracted_quantity","item_id","unit_price","match_reasons","byDatePrefix","has","trim","searchTermCandidates","substring","t","uniqueSearchTerms","searchTerm","byNameOrSpec","sysPO","sysSO","hasHighQualityCandidate","c","vendors","matchedVendors","v","vendorIds","threeMonthsAgo","setMonth","getMonth","recentPurchases","toISOString","candidates","calculateNameSimilarity","name1","name2","s1","s2","maxLen","similarity","levenshteinDistance","ocrItemName","systemItemName","systemSpecification","itemNameScore","specScore","vendor1","vendor2","normalize","n1","n2","translitMap","yg","tech","high","korea","electric","steel","metal","system","soft","net","global","trade","international","n1Replaced","n2Replaced","val","isVendorMatch","m","n","dp","fill","j","calculateSimilarityScore","extractedItem","extracted_specification","diff","extracted_unit_price","getMatchReasons","reasons","updateItemMatch","matchedPurchaseId","matchedItemId","matchMethod","match_method","confirmStatement","request","confirmerName","itemError","is_confirmed","confirmed_quantity","confirmed_unit_price","confirmed_amount","is_additional_item","parent_item_id","hasValidUnitPrice","hasValidAmount","purchaseError","statementItem","getStatementItem","insertError","purchase_request_id","extracted_amount","confirmed_at","confirmed_by","confirmed_by_name","rejectStatement","deleteStatement","path","remove","findBestMatchingPurchaseOrderSet","extractedItems","extractedPONumber","purchaseScores","setScore","calculateSetMatchScore","matchScore","matchedItemCount","matchedCount","totalItemCount","itemMatches","bestByNumber","bestMatch","confidence","ocrItems","systemItems","usedSystemItems","totalSimilarity","ocrItem","sysItem","quantityBonus","totalScore","ocrItemId","systemItemId","matchRatio","avgSimilarity","saveCorrection","statement_id","statement_item_id","original_text","corrected_text","field_type","corrected_by","getStatementsByPurchaseId","statementIds","statements","SortableRow","PurchaseDetailModal$1","isOpen","onClose","embedded","currentUserRoles","activeTab","onRefresh","onDelete","allPurchases","lastFetch","usePurchaseMemory","loading","setLoading","setPurchase","isEditing","setIsEditing","editedPurchase","setEditedPurchase","editedItems","setEditedItems","deletedItemIds","setDeletedItemIds","userRoles","setUserRoles","setCurrentUserName","columnWidths","setColumnWidths","focusedInput","setFocusedInput","setVendors","vendorSearchTerm","setVendorSearchTerm","isModifyRequestOpen","setIsModifyRequestOpen","modifyInquiryType","setModifyInquiryType","modifyMessage","setModifyMessage","requestedDeliveryDate","setRequestedDeliveryDate","quantityChangeRows","setQuantityChangeRows","priceChangeRows","setPriceChangeRows","isSendingModify","setIsSendingModify","textMeasureCanvasRef","isSaving","setIsSaving","linkedStatements","setLinkedStatements","useSensors","makeStableKey","idx","stableKey","tempId","line_number","normalizeItems","withTemp","getSortableId","handleDragEnd","prev","oldIndex","findIndex","createRowId","newQuantity","changeType","now","random","selectedPurchaseItems","purchase_request_items","MAX_SAFE_INTEGER","itemOptions","String","modifyInquiryTypeOptions","priceChangeTypeOptions","measureTextWidthPx","text","getContext","font","bodyStyle","fontFamily","fontWeight","getMeasureFont","ceil","measureText","getLabelWidthEm","getSelectLabelMaxPx","option","inquiryTypePlaceholder","inquiryTypeControlWidthEm","inquiryTypeMenuWidthEm","itemSelectPlaceholder","itemControlWidthPx","maxLabelPx","base","getSelectControlWidthPx","itemMenuWidthPx","getMenuWidthPx","getCompactSelectStyles","controlWidthPx","menuWidthPx","control","minHeight","fontSize","borderRadius","borderColor","boxShadow","maxWidth","valueContainer","indicatorsContainer","textOverflow","color","singleValue","menu","minWidth","menuList","formatNumericInput","numericValue","isFinite","updateQuantityRow","rowId","updates","row","updatePriceRow","isEditingRef","isSavingRef","lastSaveAtRef","lastAddItemAtRef","realtimeFirstMount","isUpdatingRef","unsubscribe","addCacheListener","updatedPurchase","findPurchaseInMemory","cacheItems","currentItems","preservedItems","is_po_generated","memoryPurchase","find","memoryItems","displayItems","la","lb","ca","created_at","getTime","cb","ia","ib","ta","tb","sortableIds","columnGap","total","sum","baseColumns","headerRowRef","supabaseUrl","employeeData","maybeSingle","email","employeeByEmail","purchase_role","roles","loadUserRoles","vendorsData","loadVendors","effectiveRoles","canEditAll","canEditLimited","canEdit","canViewFinancialInfo","showStatementColumns","payment_category","showExpenditureColumn","canDelete","final_manager_status","requester_name","canPurchase","canReceiveItems","isAdmin","isRequester","canReceiptCheck","canProcessReceipt","refreshModalData","vendorContacts","vendor_id","allContacts","contact_id","currentContact","otherContacts","allContacts_count","contact","sortedItems","itemsData","calculated_amount","purchaseData","vendor_contacts","contact_name","vendorContacts_from_query","purchase_updated","has_vendor_contacts","purchaseData_full","refreshModalDataWithLock","handleToggleUtkCheck","newStatus","is_utk_checked","updated_at","updatePurchaseInMemory","refreshResult","silent","normalizedItems","is_active","isInitialLoad","setIsInitialLoad","purchaseIdNumber","NaN","handleActualReceiptOptimisticUpdate","itemIdStr","nowIso","selectedDateIso","updateItems","received_at","updatedItems","updatedRequestItems","completed","allReceived","prevItems","prevPurchase","handleStatementReceivedOptimisticUpdate","nextAllCompleted","nextStatementAt","every","statement_received_at","allCompleted","then","handleBeforeUpdate","statementReceivedAction","completedText","waitingText","actualReceivedAction","canApproveMiddle","canApproveFinal","approvalButtonClass","approvalWaitingPillClass","loadPurchaseDetail","loadLinkedStatements","result","calculateOptimalColumnWidths","columnConfigs","baseWidth","calculatedWidths","maxLength","headers","statusHeader","quantityHeader","baseHeaders","receiptHeaders","doneHeaders","getHeaders","cellValue","tax_amount_value","getStatusDisplay","formatDate","expenditure_date","expenditure_amount","adjustedLength","char","calculatedWidth","is_payment_completed","getGridTemplateColumns","receiptColumns","doneColumns","hasItems","handleEditToggle","editing","safeNumber","trimmed","formatCurrency","Intl","NumberFormat","format","normalizeCurrency","currency","getPurchaseDisplayCurrency","getItemDisplayCurrency","unit_price_currency","amount_currency","tax_amount_currency","formatMoney","getCurrencySymbol","withTimeout","promise","timeoutMs","race","_","reject","handleItemChange","newItems","is_amount_manual","unitPrice","taxAmount","handlePaymentToggle","purchaseItems","requestItems","targetItem","unit","payment_completed_at","markItemAsPaymentCompleted","markItemAsPaymentCanceled","prevRequestItems","payment_completed_by_name","handleItemReceiptToggle","currentItem","newReceivedQty","totalReceivedQty","shouldIncreaseRequestedQty","nextRequestedQty","deliveryStatus","quantityUpdate","handleApprove","approvalType","middle_manager_status","handleItemExpenditure","totalExpenditure","total_expenditure_amount","markItemAsExpenditureSet","renderItemRow","dragProps","rowKey","rowProps","gridTemplateColumns","onFocus","onBlur","wordBreak","overflowWrap","hyphens","WebkitHyphens","MozHyphens","msHyphens","lineHeight","maxHeight","WebkitLineClamp","WebkitBoxOrient","hasReceived","onWheel","currentTarget","blur","link","href","rel","boxSizing","it","handleRemoveItem","Trash2","DatePickerPopover","onDateSelect","toLocaleDateString","year","month","day","hasExpenditure","hasExpenditureAmount","getFullYear","getDate","toLocaleTimeString","hour","minute","content","category","getStatusBadge","request_date","Check","X","FileText","CheckCircle","request_type","delivery_request_date","formatDateInput","revised_delivery_request_date","Building2","ReactSelect","selectedVendor","contactsData","contactsCount","updated","updated_vendor_contacts","updated_full","isClearable","isSearchable","menuPortalTarget","styles","borderWidth","backgroundColor","paddingLeft","paddingRight","outline","indicatorSeparator","dropdownIndicator","svg","clearIndicator","menuPortal","zIndex","classNamePrefix","contacts","uniqueContacts","arr","finalUniqueContacts","vendor_contacts_raw","vendor_contacts_count","unique_by_id_count","final_unique_count","firstContact","selectedContact","noOptionsMessage","contactName","purchase_contact_name","purchase_full","project_vendor","project_item","FileCheck","stmt","screen","handleViewStatementImage","ImageIcon","statement_date","uploaded_at","grand_total","Package","marginLeft","allItems","pendingItems","CreditCard","applyOptimisticUpdate","itemReceivedQuantity","requestError","markBulkExpenditureSet","deltaMs","newItem","lineNum","Plus","Dialog","DialogContent","showCloseButton","DialogHeader","DialogTitle","Edit2","onOpenAutoFocus","deltaY","Select","onValueChange","SelectTrigger","SelectValue","SelectContent","SelectItem","selectedItem","filterOption","inputValue","removeQuantityRow","currentUnitPrice","currentAmount","currentUnitPriceLabel","currentAmountLabel","placeholderText","inputMode","removePriceRow","Textarea","subjectText","getInquiryTypeLabel","inquiryPayload","summaryLines","currentDateText","requestedDateText","requested_date","current_date","activeRows","itemsPayload","current_quantity","new_quantity","quantityValue","newAmount","newUnitPrice","change_type","current_unit_price","new_unit_price","current_amount","new_amount","reason","purchaseInfo","itemsText","messageSections","finalMessage","purchaseIdValue","purchaseRequestId","supportService","createInquiry","inquiry_type","subject","purchase_info","attachments","inquiry_payload","STEP_TIMEOUT_MS","totalAmount","contactId","updateResult","total_amount","updateError","finalContactId","contactUpdateError","contact_email","contact_phone","newContact","contactInsertError","purchaseUpdateError","contactError","deleteResult","deleteError","requestDeleteError","removePurchaseFromMemory","itemTimeoutMs","normalizedUnitPriceValue","normalizedAmountValue","numericItemId","isExistingItem","unitPriceValue","finalAmountValue","updateItemResult","insertData","insertItemResult","sourceData","removeItemFromMemory","memoryError","finalItems","optimisticError","catch","err","msg","errorMessage","Loader2","Save"],"mappings":"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AkQ,gBACA3gB,eACAikB,cACAC,sBACAG,uBACAC,mBACAC,qBAEJ,CH2PoBhmB,GAAagB,KAAMhB,GAAac,MAAOd,GAAaiB,GAAIjB,GAAae,KIvoBlF,MAAMklB,GAAiC,CAC5C,CACEx1B,GAAI,qBACJy1B,MAAO,QACPC,YAAa,eACbC,gBAAgB,GAElB,CACE31B,GAAI,wBACJy1B,MAAO,OACPC,YAAa,UACbC,gBAAgB,GAElB,CACE31B,GAAI,mBACJy1B,MAAO,OACPC,YAAa,2BACbC,gBAAgB,GAElB,CACE31B,GAAI,iBACJy1B,MAAO,MACPC,YAAa,cACbC,gBAAgB,GAElB,CACE31B,GAAI,eACJy1B,MAAO,MACPC,YAAa,WACbC,gBAAgB,GAElB,CACE31B,GAAI,aACJy1B,MAAO,MACPC,YAAa,YACbC,gBAAgB,GAElB,CACE31B,GAAI,cACJy1B,MAAO,KACPC,YAAa,QACbC,gBAAgB,GAElB,CACE31B,GAAI,eACJy1B,MAAO,MACPC,YAAa,UACbC,gBAAgB,GAElB,CACE31B,GAAI,wBACJy1B,MAAO,QACPC,YAAa,WACbC,gBAAgB,GAElB,CACE31B,GAAI,wBACJy1B,MAAO,QACPC,YAAa,YACbC,gBAAgB,GAElB,CACE31B,GAAI,YACJy1B,MAAO,KACPC,YAAa,SACbC,gBAAgB,GAElB,CACE31B,GAAI,gBACJy1B,MAAO,KACPC,YAAa,WACbC,gBAAgB,GAElB,CACE31B,GAAI,WACJy1B,MAAO,KACPC,YAAa,QACbC,gBAAgB,GAElB,CACE31B,GAAI,aACJy1B,MAAO,KACPC,YAAa,QACbC,gBAAgB,GAElB,CACE31B,GAAI,SACJy1B,MAAO,KACPC,YAAa,OACbC,gBAAgB,GAElB,CACE31B,GAAI,SACJy1B,MAAO,KACPC,YAAa,WACbC,gBAAgB,GAElB,CACE31B,GAAI,OACJy1B,MAAO,KACPC,YAAa,QACbC,gBAAgB,GAElB,CACE31B,GAAI,iBACJy1B,MAAO,OACPC,YAAa,UACbC,gBAAgB,GAElB,CACE31B,GAAI,eACJy1B,MAAO,UACPC,YAAa,WACbC,gB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","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9,10]}