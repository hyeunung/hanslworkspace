{"version":3,"file":"PurchaseDetailModal-DMgntdze.js","sources":["../../node_modules/lucide-react/dist/esm/icons/truck.js","../../src/components/ui/date-picker-popover.tsx","../../src/hooks/useConfirmDateAction.ts","../../src/components/purchase/PurchaseDetailModal.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2\", key: \"wrbu53\" }],\n  [\"path\", { d: \"M15 18H9\", key: \"1lyqi6\" }],\n  [\n    \"path\",\n    {\n      d: \"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14\",\n      key: \"lysw3i\"\n    }\n  ],\n  [\"circle\", { cx: \"17\", cy: \"18\", r: \"2\", key: \"332jqn\" }],\n  [\"circle\", { cx: \"7\", cy: \"18\", r: \"2\", key: \"19iecd\" }]\n];\nconst Truck = createLucideIcon(\"truck\", __iconNode);\n\nexport { __iconNode, Truck as default };\n//# sourceMappingURL=truck.js.map\n","import { useState } from 'react'\nimport { Calendar } from '@/components/ui/calendar'\nimport { Button } from '@/components/ui/button'\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from '@/components/ui/popover'\nimport { Calendar as CalendarIcon } from 'lucide-react'\nimport { format } from 'date-fns'\nimport { ko } from 'date-fns/locale'\nimport { cn } from '@/lib/utils'\nimport { logger } from '@/lib/logger'\n\ninterface DatePickerPopoverProps {\n  children: React.ReactNode\n  onDateSelect: (date: Date) => void\n  disabled?: boolean\n  placeholder?: string\n  align?: \"center\" | \"start\" | \"end\"\n  side?: \"top\" | \"right\" | \"bottom\" | \"left\"\n}\n\nexport function DatePickerPopover({\n  children,\n  onDateSelect,\n  disabled = false,\n  placeholder = \"ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”\",\n  align = \"center\",\n  side = \"bottom\"\n}: DatePickerPopoverProps) {\n  const [open, setOpen] = useState(false)\n\n  const handleDateSelect = (date: Date | undefined) => {\n    logger.debug('ğŸ“… DatePickerPopover handleDateSelect í˜¸ì¶œ:', { \n      date, \n      isToday: date && new Date().toDateString() === date.toDateString(),\n      dateString: date?.toDateString(),\n      todayString: new Date().toDateString()\n    });\n    if (date) {\n      logger.debug('âœ… ë‚ ì§œ ì„ íƒë¨, onDateSelect í˜¸ì¶œ ì˜ˆì •');\n      onDateSelect(date)\n      setOpen(false) // ë‚ ì§œ ì„ íƒ í›„ íŒì˜¤ë²„ ë‹«ê¸°\n      logger.debug('ğŸ”š DatePickerPopover ì²˜ë¦¬ ì™„ë£Œ');\n    } else {\n      logger.debug('âŒ ë‚ ì§œê°€ undefinedì„');\n    }\n  }\n\n  return (\n    <Popover open={open} onOpenChange={setOpen}>\n      <PopoverTrigger asChild disabled={disabled}>\n        {children}\n      </PopoverTrigger>\n      <PopoverContent \n        className=\"w-auto p-0 border-gray-200 shadow-lg\" \n        align={align}\n        side={side}\n        sideOffset={8}\n      >\n        <div className=\"bg-white business-radius-card p-2\">\n          <div className=\"mb-2 px-1\">\n            <div className=\"modal-label text-gray-600 text-center\">\n              {placeholder}\n            </div>\n          </div>\n          <Calendar\n            mode=\"single\"\n            selected={undefined}\n            onSelect={(date) => {\n              logger.debug('ğŸ—“ï¸ Calendar onSelect ì§ì ‘ í˜¸ì¶œ:', { \n                date, \n                isToday: date && new Date().toDateString() === date.toDateString(),\n                dateValue: date?.getTime(),\n                todayValue: new Date().getTime()\n              });\n              handleDateSelect(date);\n            }}\n            locale={ko}\n            initialFocus\n            className=\"compact-calendar\"\n            disabled={false}\n            fromDate={new Date('2020-01-01')}\n            toDate={new Date('2030-12-31')}\n            defaultMonth={new Date()}\n            modifiers={{\n              today: new Date()\n            }}\n            modifiersClassNames={{\n              today: \"bg-blue-500 text-white font-semibold cursor-pointer hover:bg-blue-600 rounded-md\"\n            }}\n          />\n        </div>\n      </PopoverContent>\n    </Popover>\n  )\n}","import { useCallback } from 'react'\nimport { createClient } from '@/lib/supabase/client'\nimport { toast } from 'sonner'\nimport { logger } from '@/lib/logger'\n\nexport interface ConfirmDateActionConfig {\n  field: 'statement_received' | 'actual_received'\n  confirmMessage: {\n    confirm: string\n    cancel: string\n  }\n  successMessage: {\n    confirm: string\n    cancel: string\n  }\n  completedText: string\n  waitingText: string\n}\n\nexport interface UseConfirmDateActionProps {\n  config: ConfirmDateActionConfig\n  currentUserName: string | null\n  canPerformAction: boolean\n  onUpdate?: () => void\n  onOptimisticUpdate?: (params: {\n    itemId: number\n    selectedDate?: Date\n    action: 'confirm' | 'cancel'\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n    }\n  }) => void\n}\n\nexport function useConfirmDateAction({\n  config,\n  currentUserName,\n  canPerformAction,\n  onUpdate,\n  onOptimisticUpdate\n}: UseConfirmDateActionProps) {\n  const supabase = createClient()\n\n  const handleConfirm = useCallback(async (\n    itemId: number | string,\n    selectedDate: Date,\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n    }\n  ) => {\n    \n    if (!canPerformAction) {\n      logger.warn(`âŒ ê¶Œí•œ ì—†ìŒ`, { canPerformAction, currentUserName })\n      toast.error(`${config.field === 'statement_received' ? 'ê±°ë˜ëª…ì„¸ì„œ' : 'ì…ê³ '} í™•ì¸ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.`)\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      logger.error('âŒ ì˜ëª»ëœ ID', { itemId, numericId })\n      toast.error('ìœ íš¨í•˜ì§€ ì•Šì€ í•­ëª© ID ì…ë‹ˆë‹¤.')\n      return\n    }\n\n    // í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ\n    if (itemInfo) {\n      const confirmMessage = `í’ˆëª©ëª…: ${itemInfo.item_name || '-'}\nê·œê²©: ${itemInfo.specification || '-'}\nìˆ˜ëŸ‰: ${itemInfo.quantity?.toLocaleString() || 0}\në‹¨ê°€: â‚©${itemInfo.unit_price_value?.toLocaleString() || 0}\ní•©ê³„: â‚©${itemInfo.amount_value?.toLocaleString() || 0}\në¹„ê³ : ${itemInfo.remark || '-'}\n\n${config.confirmMessage.confirm}`\n      \n      if (!window.confirm(confirmMessage)) {\n        return\n      }\n    }\n\n    try {\n      let updateData: any\n\n      if (config.field === 'statement_received') {\n        updateData = {\n          is_statement_received: true,\n          statement_received_date: selectedDate.toISOString(),\n          statement_received_by_name: currentUserName\n        }\n      } else if (config.field === 'actual_received') {\n        updateData = {\n          actual_received_date: selectedDate.toISOString()\n        }\n      }\n\n      logger.debug('ğŸ“ ì—…ë°ì´íŠ¸í•  ë°ì´í„°:', updateData)\n\n      const { data, error } = await supabase\n        .from('purchase_request_items')\n        .update(updateData)\n        .eq('id', numericId)\n        .select()\n\n      logger.debug('ğŸ“ DB ì—…ë°ì´íŠ¸ ê²°ê³¼:', { data, error })\n\n      if (error) {\n        logger.error('âŒ DB ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', error)\n        throw error\n      }\n\n      logger.info('âœ… DB ì—…ë°ì´íŠ¸ ì„±ê³µ', data)\n\n      if (onOptimisticUpdate) {\n        onOptimisticUpdate({\n          itemId: numericId,\n          selectedDate,\n          action: 'confirm',\n          itemInfo\n        })\n      }\n\n      // ê°•ì œ ìƒˆë¡œê³ ì¹¨ì„ ìœ„í•´ onUpdate í˜¸ì¶œ\n      if (onUpdate) {\n        onUpdate()\n      }\n      \n      toast.success(config.successMessage.confirm)\n    } catch (error) {\n      logger.error('âŒ ì „ì²´ ì²˜ë¦¬ ì‹¤íŒ¨', error)\n      toast.error(`${config.field === 'statement_received' ? 'ê±°ë˜ëª…ì„¸ì„œ' : 'ì…ê³ '} í™•ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.`)\n    }\n  }, [config, currentUserName, canPerformAction, onUpdate, onOptimisticUpdate, supabase])\n\n  const handleCancel = useCallback(async (\n    itemId: number | string,\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n    }\n  ) => {\n    if (!canPerformAction) {\n      logger.warn(`âŒ ì·¨ì†Œ ê¶Œí•œ ì—†ìŒ`, { canPerformAction, currentUserName })\n      toast.error(`${config.field === 'statement_received' ? 'ê±°ë˜ëª…ì„¸ì„œ' : 'ì…ê³ '} í™•ì¸ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.`)\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      toast.error('ìœ íš¨í•˜ì§€ ì•Šì€ í•­ëª© ID ì…ë‹ˆë‹¤.')\n      return\n    }\n\n    // í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ\n    if (itemInfo) {\n      const confirmMessage = `í’ˆëª©ëª…: ${itemInfo.item_name || '-'}\nê·œê²©: ${itemInfo.specification || '-'}\nìˆ˜ëŸ‰: ${itemInfo.quantity?.toLocaleString() || 0}\në‹¨ê°€: â‚©${itemInfo.unit_price_value?.toLocaleString() || 0}\ní•©ê³„: â‚©${itemInfo.amount_value?.toLocaleString() || 0}\në¹„ê³ : ${itemInfo.remark || '-'}\n\n${config.confirmMessage.cancel}`\n      \n      if (!window.confirm(confirmMessage)) {\n        return\n      }\n    }\n\n    try {\n      logger.debug(`ğŸ”„ ${config.field} í™•ì¸ ì·¨ì†Œ ì‹œì‘`, { \n        itemId, \n        itemName: itemInfo?.item_name \n      })\n\n      let updateData: any\n\n      if (config.field === 'statement_received') {\n        updateData = {\n          is_statement_received: false,\n          statement_received_date: null,\n          statement_received_by_name: null\n        }\n      } else if (config.field === 'actual_received') {\n        updateData = {\n          actual_received_date: null\n        }\n      }\n\n      logger.debug('ğŸ”„ ì·¨ì†Œ ì—…ë°ì´íŠ¸í•  ë°ì´í„°:', updateData)\n\n      const { data, error } = await supabase\n        .from('purchase_request_items')\n        .update(updateData)\n        .eq('id', numericId)\n        .select()\n\n      logger.debug('ğŸ”„ ì·¨ì†Œ DB ì—…ë°ì´íŠ¸ ê²°ê³¼:', { data, error })\n\n      if (error) {\n        logger.error('âŒ DB ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', error)\n        throw error\n      }\n\n      logger.info(`âœ… ${config.field} í™•ì¸ ì·¨ì†Œ ì„±ê³µ`, data)\n\n      if (onOptimisticUpdate) {\n        onOptimisticUpdate({\n          itemId: numericId,\n          action: 'cancel',\n          itemInfo\n        })\n      }\n\n      // ê°•ì œ ìƒˆë¡œê³ ì¹¨ì„ ìœ„í•´ onUpdate í˜¸ì¶œ\n      if (onUpdate) {\n        onUpdate()\n      }\n      \n      toast.success(config.successMessage.cancel)\n    } catch (error) {\n      logger.error(`âŒ ${config.field} í™•ì¸ ì·¨ì†Œ ì‹¤íŒ¨`, error)\n      toast.error(`${config.field === 'statement_received' ? 'ê±°ë˜ëª…ì„¸ì„œ' : 'ì…ê³ '} í™•ì¸ ì·¨ì†Œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.`)\n    }\n  }, [config, canPerformAction, onUpdate, onOptimisticUpdate, supabase])\n\n  const isCompleted = useCallback((item: any) => {\n    if (config.field === 'statement_received') {\n      return item.is_statement_received\n    } else if (config.field === 'actual_received') {\n      return !!item.actual_received_date\n    }\n    return false\n  }, [config.field])\n\n  const getCompletedDate = useCallback((item: any) => {\n    if (config.field === 'statement_received') {\n      return item.statement_received_date\n    } else if (config.field === 'actual_received') {\n      return item.actual_received_date\n    }\n    return null\n  }, [config.field])\n\n  const getCompletedByName = useCallback((item: any) => {\n    if (config.field === 'statement_received') {\n      return item.statement_received_by_name\n    } else if (config.field === 'actual_received') {\n      // ì…ê³ ì™„ë£ŒëŠ” ì²˜ë¦¬ì ì •ë³´ë¥¼ ê¸°ë¡í•˜ì§€ ì•ŠìŒ\n      return null\n    }\n    return null\n  }, [config.field])\n\n  return {\n    config,\n    handleConfirm,\n    handleCancel,\n    isCompleted,\n    getCompletedDate,\n    getCompletedByName\n  }\n}","import { useEffect, useState, useRef, useCallback, useMemo, memo } from 'react'\nimport { createClient } from '@/lib/supabase/client'\nimport { PurchaseRequestWithDetails, Purchase } from '@/types/purchase'\nimport { formatDate } from '@/utils/helpers'\nimport { DatePickerPopover } from '@/components/ui/date-picker-popover'\nimport { \n  Calendar, \n  User, \n  Building2, \n  Package, \n  CreditCard,\n  X,\n  FileText,\n  DollarSign,\n  Edit2,\n  Trash2,\n  Save,\n  Plus,\n  CheckCircle,\n  XCircle,\n  Check,\n  Truck\n} from 'lucide-react'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog'\nimport { toast } from 'sonner'\nimport { logger } from '@/lib/logger'\nimport { useConfirmDateAction } from '@/hooks/useConfirmDateAction'\nimport { format as formatDateInput } from 'date-fns'\n\ninterface PurchaseDetailModalProps {\n  purchaseId: number | null\n  isOpen: boolean\n  onClose: () => void\n  embedded?: boolean  // Dialog ì—†ì´ ë‚´ìš©ë§Œ ë Œë”ë§\n  currentUserRoles?: string[]\n  activeTab?: string\n  onRefresh?: (forceRefresh?: boolean, options?: { silent?: boolean }) => void | Promise<void>\n  onOptimisticUpdate?: (purchaseId: number, updater: (prev: Purchase) => Purchase) => void\n  onDelete?: (purchase: PurchaseRequestWithDetails) => void\n}\n\nfunction PurchaseDetailModal({ \n  purchaseId, \n  isOpen, \n  onClose, \n  embedded = false,\n  currentUserRoles = [],\n  activeTab,\n  onRefresh,\n  onOptimisticUpdate,\n  onDelete\n}: PurchaseDetailModalProps) {\n  const [loading, setLoading] = useState(false)\n  const [purchase, setPurchase] = useState<PurchaseRequestWithDetails | null>(null)\n  const [isEditing, setIsEditing] = useState(false)\n  const [editedPurchase, setEditedPurchase] = useState<PurchaseRequestWithDetails | null>(null)\n  const [editedItems, setEditedItems] = useState<any[]>([])\n  const [deletedItemIds, setDeletedItemIds] = useState<number[]>([])\n  const [userRoles, setUserRoles] = useState<string[]>([])\n  const [currentUserName, setCurrentUserName] = useState<string>('')\n  const [columnWidths, setColumnWidths] = useState<number[]>([])\n  const tableMinWidth = useMemo(() => {\n    if (columnWidths.length > 0) {\n      const columnGap = columnWidths.length > 1 ? (columnWidths.length - 1) * 12 : 0\n      const padding = 48\n      const total = columnWidths.reduce((sum, width) => sum + width, 0) + columnGap + padding\n      return Math.max(total, 720)\n    }\n\n    const baseColumns: number[] = [120, 140, 80, 110, 130, 110, 120]\n\n    if (activeTab === 'purchase') {\n      baseColumns.push(120)\n    }\n\n    if (activeTab === 'receipt' || activeTab === 'done') {\n      baseColumns.push(120)\n    }\n\n    if (activeTab === 'receipt') {\n      baseColumns.push(140)\n    }\n\n    if (activeTab === 'done') {\n      baseColumns.push(140, 140, 110)\n    }\n\n    if (isEditing) {\n      baseColumns.push(110)\n    }\n\n    const columnGap = baseColumns.length > 1 ? (baseColumns.length - 1) * 12 : 0\n    const total = baseColumns.reduce((sum, width) => sum + width, 0) + columnGap + 48\n    return Math.max(total, 720)\n  }, [columnWidths, activeTab, isEditing])\n  const headerRowRef = useRef<HTMLDivElement>(null)\n  const supabase = createClient()\n  \n  // ì‚¬ìš©ì ê¶Œí•œ ë° ì´ë¦„ ì§ì ‘ ë¡œë“œ\n  useEffect(() => {\n    const loadUserRoles = async () => {\n      try {\n        // Supabase í™˜ê²½ ë³€ìˆ˜ í™•ì¸\n        const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\n        const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;\n        \n        if (!supabaseUrl || !supabaseAnonKey || supabaseUrl.includes('placeholder')) {\n          logger.warn('Supabase í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•ŠìŒ - PurchaseDetailModal');\n          return;\n        }\n\n        const { data: { user } } = await supabase.auth.getUser()\n        if (user) {\n          // ë¨¼ì € IDë¡œ ì‹œë„\n          let { data: employeeData } = await supabase\n            .from('employees')\n            .select('*')\n            .eq('id', user.id)\n            .maybeSingle()\n          \n          // IDë¡œ ëª» ì°¾ì•˜ìœ¼ë©´ ì´ë©”ì¼ë¡œ ì‹œë„\n          if (!employeeData && user.email) {\n            const { data: employeeByEmail } = await supabase\n              .from('employees')\n              .select('*')\n              .eq('email', user.email)\n              .maybeSingle()\n            \n            employeeData = employeeByEmail\n          }\n          \n          // ì‚¬ìš©ì ì´ë¦„ ì €ì¥\n          if (employeeData?.name) {\n            setCurrentUserName(employeeData.name)\n          }\n          \n          if (employeeData?.purchase_role) {\n            let roles: string[] = []\n            if (Array.isArray(employeeData.purchase_role)) {\n              roles = employeeData.purchase_role.map((r: any) => String(r).trim())\n            } else {\n              const roleString = String(employeeData.purchase_role)\n              roles = roleString\n                .split(',')\n                .map((r: string) => r.trim())\n                .filter((r: string) => r.length > 0)\n            }\n            setUserRoles(roles)\n          }\n        }\n      } catch (error) {\n      }\n    }\n    \n    if (isOpen) {\n      loadUserRoles()\n    }\n  }, [isOpen])\n  \n  // currentUserRolesê°€ ë°°ì—´ì´ ì•„ë‹ˆë©´ userRoles ì‚¬ìš©\n  const effectiveRoles = Array.isArray(currentUserRoles) && currentUserRoles.length > 0 \n    ? currentUserRoles \n    : userRoles\n  \n  // ê¶Œí•œ ì²´í¬\n  // ì „ì²´ ìˆ˜ì • ê¶Œí•œ (ëª¨ë“  í•„ë“œ ìˆ˜ì • ê°€ëŠ¥)\n  const canEditAll = effectiveRoles.includes('final_approver') || \n                     effectiveRoles.includes('app_admin') || \n                     effectiveRoles.includes('ceo')\n  \n  // lead buyer ì œí•œì  ìˆ˜ì • ê¶Œí•œ (ê¸ˆì•¡/ìˆ˜ëŸ‰ë§Œ ìˆ˜ì • ê°€ëŠ¥)\n  const canEditLimited = effectiveRoles.includes('lead buyer')\n  \n  // í†µí•© ìˆ˜ì • ê¶Œí•œ (ë‘˜ ì¤‘ í•˜ë‚˜ë¼ë„ ìˆìœ¼ë©´ ìˆ˜ì • ëª¨ë“œ í™œì„±í™”)\n  const canEdit = canEditAll || canEditLimited\n  \n  // ì‚­ì œ ê¶Œí•œ: ê´€ë¦¬ì ë˜ëŠ” ìš”ì²­ì ë³¸ì¸ (ë‹¨, ìŠ¹ì¸ëœ ìš”ì²­ì€ ê´€ë¦¬ìë§Œ, lead buyerëŠ” ì‚­ì œ ë¶ˆê°€)\n  const isApproved = purchase?.final_manager_status === 'approved';\n  const canDelete = isApproved \n    ? canEditAll  // ìŠ¹ì¸ëœ ìš”ì²­ì€ ê´€ë¦¬ìë§Œ ì‚­ì œ ê°€ëŠ¥ (lead buyer ì œì™¸)\n    : (canEditAll || (purchase?.requester_name === currentUserName))  // ë¯¸ìŠ¹ì¸ë„ lead buyer ì œì™¸\n  \n  // êµ¬ë§¤ ê¶Œí•œ ì²´í¬: app_admin + lead buyerë§Œ (ìš”ì²­ì ë³¸ì¸ ì œì™¸)\n  const canPurchase = effectiveRoles.includes('app_admin') || \n                     effectiveRoles.includes('lead buyer') || \n                     effectiveRoles.includes('lead buyer')\n  \n  // ì…ê³  ê¶Œí•œ ì²´í¬ \n  // 1. ê´€ë¦¬ìëŠ” ëª¨ë“  ê±´ ì…ê³  ì²˜ë¦¬ ê°€ëŠ¥\n  // 2. ìš”ì²­ìëŠ” ìì‹ ì˜ ìš”ì²­ê±´ë§Œ ì…ê³  ì²˜ë¦¬ ê°€ëŠ¥\n  const canReceiveItems = effectiveRoles.includes('app_admin') || \n                         (purchase?.requester_name === currentUserName)\n  // 2. ì¼ë°˜ ì§ì›ì€ ë³¸ì¸ì´ ìš”ì²­í•œ ê±´ë§Œ ì…ê³  ì²˜ë¦¬ ê°€ëŠ¥\n  const isAdmin = effectiveRoles.includes('final_approver') || \n                  effectiveRoles.includes('app_admin') || \n                  effectiveRoles.includes('ceo')\n  const isRequester = purchase?.requester_name === currentUserName\n  \n  // ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ & UTK í™•ì¸ ê¶Œí•œ: app_adminê³¼ lead buyerë§Œ ê°€ëŠ¥\n  const canReceiptCheck = effectiveRoles.includes('app_admin') || \n                         effectiveRoles.includes('lead buyer')\n  \n\n  // ëª¨ë‹¬ ë‚´ë¶€ ë°ì´í„°ë§Œ ìƒˆë¡œê³ ì¹¨í•˜ëŠ” í•¨ìˆ˜ (ëª¨ë‹¬ ë‹«ì§€ ì•ŠìŒ)\n  const refreshModalData = useCallback(async () => {\n    if (!purchaseId) return\n    \n    try {\n      const supabase = createClient()\n      // ìµœì‹  êµ¬ë§¤ ìš”ì²­ ë°ì´í„° ë¡œë“œ\n      const { data, error } = await supabase\n        .from('purchase_requests')\n        .select(`\n          *,\n          vendors(id, vendor_name),\n          purchase_request_items(*)\n        `)\n        .eq('id', purchaseId)\n        .single()\n      \n      if (error) throw error\n\n      if (data) {\n        // ë¼ì¸ë„˜ë²„ ìˆœì„œëŒ€ë¡œ ì •ë ¬\n        const sortedItems = (data.purchase_request_items || []).sort((a: any, b: any) => {\n          const lineA = a.line_number || 999999;\n          const lineB = b.line_number || 999999;\n          return lineA - lineB;\n        });\n\n        const purchaseData = {\n          ...data,\n          items: sortedItems,\n          vendor: data.vendors || { id: 0, vendor_name: 'ì•Œ ìˆ˜ ì—†ìŒ' },\n          vendor_contacts: []\n        } as PurchaseRequestWithDetails\n\n        setPurchase(purchaseData)\n        setEditedPurchase(purchaseData)\n        setEditedItems(sortedItems)\n        \n        logger.debug('ëª¨ë‹¬ ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ - ëª¨ë‹¬ ìƒíƒœ ìœ ì§€')\n      }\n    } catch (error) {\n      logger.error('ëª¨ë‹¬ ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨', error)\n    }\n  }, [purchaseId])\n  \n  // ì»´í¬ë„ŒíŠ¸ê°€ ë§ˆìš´íŠ¸ë  ë•Œ ì™¸ë¶€ ìƒˆë¡œê³ ì¹¨ì„ ë°©ì§€í•˜ëŠ” í”Œë˜ê·¸\n  const [isInitialLoad, setIsInitialLoad] = useState(true)\n  \n  // ì»¤ìŠ¤í…€ í›… ì„¤ì •\n  const purchaseIdNumber = purchaseId ? Number(purchaseId) : (purchase ? Number(purchase.id) : NaN)\n\n  const handleActualReceiptOptimisticUpdate = useCallback(({ itemId, selectedDate, action }: {\n    itemId: number\n    selectedDate?: Date\n    action: 'confirm' | 'cancel'\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n    }\n  }) => {\n    const itemIdStr = String(itemId)\n    const nowIso = new Date().toISOString()\n    const selectedDateIso = selectedDate ? selectedDate.toISOString() : undefined\n\n    const updateItems = (items?: any[]) => {\n      if (!items) return items\n      return items.map(item => {\n        if (String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_received: true,\n            actual_received_date: selectedDateIso,\n            received_at: nowIso\n          }\n        }\n\n        return {\n          ...item,\n          is_received: false,\n          actual_received_date: undefined,\n          received_at: undefined\n        }\n      })\n    }\n\n    setPurchase(prev => {\n      if (!prev) return prev\n      const updatedItems = updateItems(prev.items) || []\n      const total = updatedItems.length\n      const completed = updatedItems.filter(item => item.is_received).length\n      const allReceived = total > 0 && completed === total\n\n      return {\n        ...prev,\n        items: updatedItems,\n        is_received: allReceived,\n        received_at: allReceived ? (prev.received_at || nowIso) : undefined\n      }\n    })\n\n    setEditedPurchase(prev => {\n      if (!prev) return prev\n      const updatedItems = updateItems(prev.items) || []\n      return {\n        ...prev,\n        items: updatedItems\n      }\n    })\n\n    setEditedItems(prevItems => {\n      if (!prevItems || prevItems.length === 0) return prevItems\n      return prevItems.map(item => {\n        if (!item.id || String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_received: true,\n            actual_received_date: selectedDateIso,\n            received_at: nowIso\n          }\n        }\n\n        return {\n          ...item,\n          is_received: false,\n          actual_received_date: undefined,\n          received_at: undefined\n        }\n      })\n    })\n\n    if (!Number.isNaN(purchaseIdNumber)) {\n      onOptimisticUpdate?.(purchaseIdNumber, prevPurchase => {\n        const updatedItems = updateItems(prevPurchase.items) || prevPurchase.items || []\n        const total = updatedItems.length || prevPurchase.items?.length || 0\n        const completed = updatedItems.filter(item => item.is_received).length\n        const allReceived = total > 0 && completed === total\n\n        return {\n          ...prevPurchase,\n          items: updatedItems,\n          is_received: allReceived,\n          received_at: allReceived ? (prevPurchase.received_at || nowIso) : undefined\n        }\n      })\n    }\n  }, [onOptimisticUpdate, purchaseIdNumber])\n\n  const handleStatementReceivedOptimisticUpdate = useCallback(({ itemId, selectedDate, action }: {\n    itemId: number\n    selectedDate?: Date\n    action: 'confirm' | 'cancel'\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n    }\n  }) => {\n    const itemIdStr = String(itemId)\n    const selectedDateIso = selectedDate ? selectedDate.toISOString() : undefined\n\n    let nextAllCompleted = false\n    let nextStatementAt: string | null = null\n\n    setPurchase(prev => {\n      if (!prev) return prev\n\n      const updatedItems = (prev.items || []).map(item => {\n        if (String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_statement_received: true,\n            statement_received_date: selectedDateIso,\n            statement_received_by_name: currentUserName\n          }\n        }\n\n        return {\n          ...item,\n          is_statement_received: false,\n          statement_received_date: null,\n          statement_received_by_name: null\n        }\n      })\n\n      nextAllCompleted = updatedItems.length > 0 && updatedItems.every(item => item.is_statement_received)\n      nextStatementAt = nextAllCompleted\n        ? (selectedDateIso || prev.statement_received_at || new Date().toISOString())\n        : null\n\n      return {\n        ...prev,\n        items: updatedItems,\n        is_statement_received: nextAllCompleted,\n        statement_received_at: nextStatementAt\n      }\n    })\n\n    setEditedPurchase(prev => {\n      if (!prev) return prev\n\n      const updatedItems = (prev.items || []).map(item => {\n        if (String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_statement_received: true,\n            statement_received_date: selectedDateIso,\n            statement_received_by_name: currentUserName\n          }\n        }\n\n        return {\n          ...item,\n          is_statement_received: false,\n          statement_received_date: null,\n          statement_received_by_name: null\n        }\n      })\n\n      return {\n        ...prev,\n        items: updatedItems,\n        is_statement_received: nextAllCompleted,\n        statement_received_at: nextStatementAt\n      }\n    })\n\n    setEditedItems(prevItems => {\n      if (!prevItems) return prevItems\n      return prevItems.map(item => {\n        if (String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_statement_received: true,\n            statement_received_date: selectedDateIso,\n            statement_received_by_name: currentUserName\n          }\n        }\n\n        return {\n          ...item,\n          is_statement_received: false,\n          statement_received_date: null,\n          statement_received_by_name: null\n        }\n      })\n    })\n\n    if (!Number.isNaN(purchaseIdNumber)) {\n      onOptimisticUpdate?.(purchaseIdNumber, prevPurchase => {\n        const updatedItems = (prevPurchase.items || []).map(item => {\n          if (String(item.id) !== itemIdStr) return item\n\n          if (action === 'confirm') {\n            return {\n              ...item,\n              is_statement_received: true,\n              statement_received_date: selectedDateIso,\n              statement_received_by_name: currentUserName\n            }\n          }\n\n          return {\n            ...item,\n            is_statement_received: false,\n            statement_received_date: null,\n            statement_received_by_name: null\n          }\n        })\n\n        const allCompleted = updatedItems.length > 0 && updatedItems.every(item => item.is_statement_received)\n\n        return {\n          ...prevPurchase,\n          items: updatedItems,\n          is_statement_received: allCompleted\n        }\n      })\n    }\n\n    // purchase_requests ë ˆë²¨ í”Œë˜ê·¸ë„ ì—…ë°ì´íŠ¸\n    if (purchase && nextAllCompleted !== undefined) {\n      const supabase = createClient()\n      supabase\n        .from('purchase_requests')\n        .update({\n          is_statement_received: nextAllCompleted,\n          statement_received_at: nextStatementAt\n        })\n        .eq('id', purchase.id)\n        .then(({ error }: { error: any }) => {\n          if (error) {\n            logger.error('ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ purchase_requests ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', error)\n          }\n        })\n    }\n  }, [currentUserName, onOptimisticUpdate, purchaseIdNumber, purchase])\n\n  const statementReceivedAction = useConfirmDateAction({\n    config: {\n      field: 'statement_received',\n      confirmMessage: {\n        confirm: 'ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ì„ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?',\n        cancel: 'ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?'\n      },\n      successMessage: {\n        confirm: 'ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.',\n        cancel: 'ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.'\n      },\n      completedText: 'âœ“ ì™„ë£Œ',\n      waitingText: 'ëŒ€ê¸°'\n    },\n    currentUserName,\n    canPerformAction: canReceiptCheck,\n    onUpdate: refreshModalData,\n    onOptimisticUpdate: handleStatementReceivedOptimisticUpdate\n  })\n\n  const actualReceivedAction = useConfirmDateAction({\n    config: {\n      field: 'actual_received',\n      confirmMessage: {\n        confirm: 'ì‹¤ì œ ì…ê³  ì²˜ë¦¬ë¥¼ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?',\n        cancel: 'ì‹¤ì œ ì…ê³  ì²˜ë¦¬ë¥¼ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?'\n      },\n      successMessage: {\n        confirm: 'ì‹¤ì œ ì…ê³  ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.',\n        cancel: 'ì‹¤ì œ ì…ê³  ì²˜ë¦¬ê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.'\n      },\n      completedText: 'ì…ê³ ì™„ë£Œ',\n      waitingText: 'ì…ê³ ëŒ€ê¸°'\n    },\n    currentUserName,\n    canPerformAction: canReceiptCheck,\n    onUpdate: refreshModalData,\n    onOptimisticUpdate: handleActualReceiptOptimisticUpdate\n  })\n  \n  // ë‚ ì§œ ì„ íƒ í•¸ë“¤ëŸ¬ë“¤\n  \n  // ë””ë²„ê¹…ìš© ë¡œê·¸\n  logger.debug('Receipt Check', {\n    activeTab,\n    canReceiptCheck,\n    isAdmin,\n    isRequester,\n    currentUserName,\n    requesterName: purchase?.requester_name,\n    effectiveRoles\n  });\n  \n  // ìŠ¹ì¸ ê¶Œí•œ ì²´í¬\n const canApproveMiddle = effectiveRoles.includes('middle_manager') || \n                          effectiveRoles.includes('app_admin') || \n                          effectiveRoles.includes('ceo')\n \n const canApproveFinal = effectiveRoles.includes('final_approver') || \n                         effectiveRoles.includes('app_admin') || \n                         effectiveRoles.includes('ceo')\n \n const approvalPillClass = 'inline-flex items-center gap-1 business-radius-badge px-2 py-0.5 badge-text leading-tight'\n const approvalButtonClass = 'inline-flex items-center gap-1 business-radius-badge !h-auto !min-h-0 !px-2.5 !py-0.5 badge-text leading-tight'\n const approvalWaitingPillClass = 'inline-flex items-center gap-1 business-radius-badge px-2.5 py-0.5 badge-text leading-tight'\n \n   // ë””ë²„ê¹… ë¡œê·¸\n   logger.debug('PurchaseDetailModal ê¶Œí•œ ì²´í¬', {\n     purchaseOrderNumber: purchase?.purchase_order_number,\n     currentUserRoles,\n     userRoles,\n     effectiveRoles,\n     canApproveMiddle,\n     canApproveFinal,\n     isEditing,\n     middleManagerStatus: purchase?.middle_manager_status,\n     finalManagerStatus: purchase?.final_manager_status\n   });\n \n  useEffect(() => {\n    if (purchaseId && isOpen) {\n      loadPurchaseDetail(purchaseId.toString())\n      setIsEditing(false) // ëª¨ë‹¬ ì—´ ë•Œë§ˆë‹¤ í¸ì§‘ ëª¨ë“œ ì´ˆê¸°í™”\n    }\n  }, [purchaseId, isOpen])\n\n  // ì¹¼ëŸ¼ ë„ˆë¹„ ê³„ì‚° (í…ìŠ¤íŠ¸ ê¸¸ì´ ê¸°ë°˜)\n  const calculateOptimalColumnWidths = useCallback(() => {\n    if (!purchase?.purchase_request_items || purchase.purchase_request_items.length === 0) return []\n\n    const items = purchase.purchase_request_items ?? []\n\n    const columnConfigs = [\n      { key: 'item_name', minWidth: 80, maxWidth: 500, baseWidth: 80 },\n      { key: 'specification', minWidth: 120, maxWidth: 700, baseWidth: 120 },\n      { key: 'quantity', minWidth: 70, maxWidth: 100, baseWidth: 70 },\n      { key: 'unit_price', minWidth: 90, maxWidth: 150, baseWidth: 90 },\n      { key: 'total_price', minWidth: 100, maxWidth: 180, baseWidth: 100 },\n      { key: 'remarks', minWidth: 80, maxWidth: 240, baseWidth: 80 },\n      { key: 'status', minWidth: 80, maxWidth: 120, baseWidth: 80 }\n    ]\n\n    // ì¶”ê°€ ì¹¼ëŸ¼ë“¤ (íƒ­ë³„)\n    if (activeTab === 'receipt') {\n      columnConfigs.push({ key: 'actual_receipt_date', minWidth: 100, maxWidth: 160, baseWidth: 100 })\n    }\n    if (activeTab === 'done') {\n      columnConfigs.push(\n        { key: 'transaction_confirm', minWidth: 100, maxWidth: 160, baseWidth: 100 },\n        { key: 'accounting_date', minWidth: 100, maxWidth: 160, baseWidth: 100 },\n        { key: 'processor', minWidth: 80, maxWidth: 120, baseWidth: 80 },\n        { key: 'utk_confirm', minWidth: 80, maxWidth: 120, baseWidth: 80 }\n      )\n    }\n\n    const calculatedWidths = columnConfigs.map((config, index) => {\n      let maxLength = 4 // ìµœì†Œ 4ì\n\n      // í—¤ë” í…ìŠ¤íŠ¸ ê¸¸ì´ ê³ ë ¤ (íƒ­ë³„)\n      const getHeaders = () => {\n        const statusHeader = activeTab === 'purchase'\n          ? 'êµ¬ë§¤ìƒíƒœ'\n          : (activeTab === 'receipt' || activeTab === 'done')\n          ? 'ì…ê³ ìƒíƒœ'\n          : 'ìƒíƒœ'\n\n        // ìŠ¹ì¸ëŒ€ê¸°íƒ­ì—ì„œëŠ” ìƒíƒœ ì¹¼ëŸ¼ ì œì™¸\n        const baseHeaders = activeTab === 'pending' \n          ? ['í’ˆëª©ëª…', 'ê·œê²©', 'ìˆ˜ëŸ‰', 'ë‹¨ê°€', 'í•©ê³„', 'ë¹„ê³ ']\n          : ['í’ˆëª©ëª…', 'ê·œê²©', 'ìˆ˜ëŸ‰', 'ë‹¨ê°€', 'í•©ê³„', 'ë¹„ê³ ', statusHeader]\n        if (activeTab === 'receipt') {\n          return [...baseHeaders, 'ì‹¤ì œì…ê³ ì¼']\n        } else if (activeTab === 'done') {\n          return [...baseHeaders, 'ê±°ë˜ëª…ì„¸ì„œ í™•ì¸', 'íšŒê³„ìƒ ì…ê³ ì¼', 'ì²˜ë¦¬ì', 'UTK']\n        }\n        return baseHeaders\n      }\n      \n      const headers = getHeaders()\n      if (headers[index]) {\n        maxLength = Math.max(maxLength, headers[index].length)\n      }\n\n      // ì‹¤ì œ ë°ì´í„°ì—ì„œ ìµœëŒ€ ê¸¸ì´ ì°¾ê¸°\n      items.forEach(item => {\n        let cellValue = ''\n        switch (config.key) {\n          case 'item_name':\n            cellValue = item.item_name || ''\n            break\n          case 'specification':\n            cellValue = item.specification || ''\n            break\n          case 'quantity':\n            cellValue = item.quantity?.toString() || ''\n            break\n          case 'unit_price':\n            cellValue = item.unit_price_value != null ? item.unit_price_value.toLocaleString() : ''\n            break\n          case 'total_price':\n            if (item.amount_value != null) {\n              cellValue = item.amount_value.toLocaleString()\n            } else if (item.quantity != null && item.unit_price_value != null) {\n              cellValue = (Number(item.quantity) * Number(item.unit_price_value)).toLocaleString()\n            } else {\n              cellValue = ''\n            }\n            break\n          case 'remarks':\n            cellValue = item.remark || ''\n            break\n          case 'status':\n            cellValue = getStatusDisplay(item) || ''\n            break\n          case 'actual_receipt_date':\n            cellValue = item.actual_received_date ? formatDate(item.actual_received_date) : ''\n            break\n          case 'transaction_confirm':\n            cellValue = item.is_statement_received ? 'í™•ì¸ì™„ë£Œ' : 'ë¯¸í™•ì¸'\n            break\n          case 'accounting_date':\n            cellValue = item.statement_received_date ? formatDate(item.statement_received_date) : ''\n            break\n          case 'processor':\n            cellValue = item.statement_received_by_name || ''\n            break\n          case 'utk_confirm':\n            cellValue = item.is_utk_checked ? 'ì™„ë£Œ' : 'ëŒ€ê¸°'\n            break\n        }\n        \n        // í•œê¸€/ì˜ë¬¸ í˜¼í•© í…ìŠ¤íŠ¸ ê¸¸ì´ ê³„ì‚° (í•œê¸€ì€ 1.5ë°° ê°€ì¤‘ì¹˜)\n        const adjustedLength = cellValue.split('').reduce((acc, char) => {\n          return acc + (/[ê°€-í£]/.test(char) ? 1.5 : 1)\n        }, 0)\n        \n        maxLength = Math.max(maxLength, Math.ceil(adjustedLength))\n      })\n\n      // ê¸¸ì´ë¥¼ í”½ì…€ë¡œ ë³€í™˜ (ê¸€ìë‹¹ ì•½ 7px + ì—¬ë°± 20px)\n      const calculatedWidth = Math.max(\n        config.minWidth,\n        Math.min(config.maxWidth, maxLength * 7 + 20)\n      )\n\n      logger.debug(`Column ${config.key} calculated:`, { \n        maxLength, \n        calculatedWidth, \n        range: `${config.minWidth}-${config.maxWidth}px` \n      })\n\n      return calculatedWidth\n    })\n\n    setColumnWidths(calculatedWidths)\n    logger.debug('Optimal column widths calculated', { calculatedWidths })\n    return calculatedWidths\n  }, [purchase, activeTab])\n\n  // ìƒíƒœ í‘œì‹œ í…ìŠ¤íŠ¸ ë°˜í™˜ í•¨ìˆ˜\n  const getStatusDisplay = (item: any) => {\n    if (activeTab === 'purchase') {\n      return item.is_payment_completed ? 'êµ¬ë§¤ì™„ë£Œ' : 'êµ¬ë§¤ìš”ì²­'\n    } else if (activeTab === 'receipt') {\n      return item.is_received ? 'ì…ê³ ' : 'ì…ê³ ëŒ€ê¸°'\n    }\n    return item.is_payment_completed ? 'êµ¬ë§¤ì™„ë£Œ' : 'êµ¬ë§¤ìš”ì²­'\n  }\n\n  // ë™ì  gridTemplateColumns ìƒì„±\n  const getGridTemplateColumns = () => {\n    if (columnWidths.length > 0) {\n      return columnWidths.map(width => `${width}px`).join(' ')\n    }\n    \n    // ê¸°ë³¸ê°’ (ë°ì´í„° ë¡œë“œ ì „)\n    const baseColumns = ['80px', '120px', '70px', '90px', '100px', '80px', '80px']\n    \n    // íƒ­ë³„ ì¶”ê°€ ì¹¼ëŸ¼\n    if (activeTab === 'receipt') {\n      return [...baseColumns, '100px'].join(' ')\n    } else if (activeTab === 'done') {\n      return [...baseColumns, '100px', '100px', '80px', '80px'].join(' ')\n    }\n    \n    return baseColumns.join(' ')\n  }\n\n  // ë ˆê±°ì‹œ measureColumnWidths í•¨ìˆ˜ (í˜¸í™˜ì„± ìœ ì§€)\n  const measureColumnWidths = () => {\n    calculateOptimalColumnWidths()\n  }\n\n  // View ëª¨ë“œì—ì„œ ì¹¼ëŸ¼ ë„ˆë¹„ ê³„ì‚° (ë°ì´í„° ë¡œë“œ í›„)\n  useEffect(() => {\n    if (purchase && purchase.purchase_request_items && purchase.purchase_request_items.length > 0 && !isEditing) {\n      // ì¦‰ì‹œ ê³„ì‚° (DOM ì¸¡ì • ë¶ˆí•„ìš”)\n      calculateOptimalColumnWidths()\n    }\n  }, [purchase, isEditing, activeTab, calculateOptimalColumnWidths])\n\n  // Edit ëª¨ë“œ ì „í™˜ ì‹œ ë„ˆë¹„ ê³„ì‚°\n  const handleEditToggle = (editing: boolean) => {\n    if (editing && !isEditing) {\n      // Edit ëª¨ë“œë¡œ ì „í™˜í•˜ê¸° ì „ì— í˜„ì¬ ë„ˆë¹„ ê³„ì‚°\n      calculateOptimalColumnWidths()\n    }\n    setIsEditing(editing)\n  }\n\n  const loadPurchaseDetail = async (id: string) => {\n    try {\n      setLoading(true)\n      const supabase = createClient()\n      \n      const { data, error } = await supabase\n        .from('purchase_requests')\n        .select(`\n          *,\n          vendors(id, vendor_name),\n          purchase_request_items(*)\n        `)\n        .eq('id', id)\n        .single()\n\n      if (error) throw error\n\n      if (data) {\n        // ë¼ì¸ë„˜ë²„ ìˆœì„œëŒ€ë¡œ ì •ë ¬\n        const sortedItems = (data.purchase_request_items || []).sort((a: any, b: any) => {\n          const lineA = a.line_number || 999999;\n          const lineB = b.line_number || 999999;\n          return lineA - lineB;\n        });\n\n        const purchaseData = {\n          ...data,\n          items: sortedItems,\n          vendor: data.vendors || { id: 0, vendor_name: 'ì•Œ ìˆ˜ ì—†ìŒ' },\n          vendor_contacts: []\n        } as PurchaseRequestWithDetails\n        setPurchase(purchaseData)\n        setEditedPurchase(purchaseData)\n        setEditedItems(sortedItems)\n      }\n    } catch (error) {\n      toast.error('ë°œì£¼ ìƒì„¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const getStatusBadge = () => {\n    if (!purchase) return null\n    \n    // payment_category ìš°ì„  í™•ì¸\n    if (purchase.payment_category) {\n      const category = purchase.payment_category.trim()\n      \n      if (category === 'ë°œì£¼') {\n        return <span className=\"badge-stats bg-green-500 text-white\">ë°œì£¼</span>\n      } else if (category === 'êµ¬ë§¤ìš”ì²­') {\n        return <span className=\"badge-stats bg-blue-500 text-white\">êµ¬ë§¤ìš”ì²­</span>\n      } else if (category === 'í˜„ì¥ê²°ì œ') {\n        return <span className=\"badge-stats bg-gray-500 text-white\">í˜„ì¥ê²°ì œ</span>\n      } else {\n        // payment_category ê°’ì´ ìˆì§€ë§Œ ì•Œë ¤ì§„ ê°’ì´ ì•„ë‹Œ ê²½ìš°\n        return <span className=\"badge-stats bg-blue-500 text-white\">{category}</span>\n      }\n    }\n    \n    // payment_categoryê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’\n    return <span className=\"badge-stats bg-blue-500 text-white\">êµ¬ë§¤ìš”ì²­</span>\n  }\n\n  // formatDateëŠ” utils/helpers.tsì—ì„œ import\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat('ko-KR').format(amount)\n  }\n\n  const handleSave = async () => {\n    if (!purchase || !editedPurchase) {\n      toast.error('ì €ì¥í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.')\n      return\n    }\n    \n    try {\n      logger.debug('ì €ì¥ ì‹œì‘', { \n        purchaseId: purchase.id, \n        editedItemsCount: editedItems.length,\n        deletedItemsCount: deletedItemIds.length \n      });\n      \n      // ë°œì£¼ ê¸°ë³¸ ì •ë³´ ì—…ë°ì´íŠ¸\n      const totalAmount = editedItems.reduce((sum, item) => sum + (item.amount_value || 0), 0)\n      logger.debug('ê³„ì‚°ëœ ì´ì•¡', { totalAmount });\n      \n      const { error: updateError } = await supabase\n        .from('purchase_requests')\n        .update({\n          purchase_order_number: editedPurchase.purchase_order_number || null,\n          requester_name: editedPurchase.requester_name || null,\n          delivery_request_date: editedPurchase.delivery_request_date || null,\n          revised_delivery_request_date: editedPurchase.revised_delivery_request_date || null,\n          payment_category: editedPurchase.payment_category || null,\n          project_vendor: editedPurchase.project_vendor || null,\n          total_amount: Number(totalAmount),\n          updated_at: new Date().toISOString()\n        })\n        .eq('id', purchase.id)\n\n      if (updateError) throw updateError\n\n      // ì‚­ì œëœ í•­ëª©ë“¤ ì²˜ë¦¬\n      if (deletedItemIds.length > 0) {\n        const { error: deleteError } = await supabase\n          .from('purchase_request_items')\n          .delete()\n          .in('id', deletedItemIds)\n\n        if (deleteError) throw deleteError\n      }\n\n      // ê° ì•„ì´í…œ ì—…ë°ì´íŠ¸ ë˜ëŠ” ìƒì„±\n      logger.debug('ì €ì¥í•  editedItems', { count: editedItems.length });\n      \n      for (const item of editedItems) {\n        logger.debug('ì²˜ë¦¬ ì¤‘ì¸ item', { \n          itemId: item.id, \n          itemName: item.item_name,\n          quantity: item.quantity,\n          unitPrice: item.unit_price_value,\n          amount: item.amount_value\n        });\n        \n        // í•„ìˆ˜ í•„ë“œ ê²€ì¦\n        if (!item.item_name || !item.item_name.trim()) {\n          throw new Error('í’ˆëª©ëª…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.');\n        }\n        if (!item.quantity || item.quantity <= 0) {\n          throw new Error('ìˆ˜ëŸ‰ì€ 0ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤.');\n        }\n        if (item.unit_price_value !== null && item.unit_price_value !== undefined && item.unit_price_value < 0) {\n          throw new Error('ë‹¨ê°€ëŠ” 0 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');\n        }\n        if (item.amount_value !== null && item.amount_value !== undefined && item.amount_value < 0) {\n          throw new Error('í•©ê³„ëŠ” 0 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');\n        }\n        \n        if (item.id) {\n          // ê¸°ì¡´ í•­ëª© ì—…ë°ì´íŠ¸\n          logger.debug('ê¸°ì¡´ í•­ëª© ì—…ë°ì´íŠ¸', { itemId: item.id });\n          const { error } = await supabase\n            .from('purchase_request_items')\n            .update({\n              item_name: item.item_name.trim(),\n              specification: item.specification || null,\n              quantity: Number(item.quantity),\n              unit_price_value: Number(item.unit_price_value),\n              unit_price_currency: purchase.currency || 'KRW',\n              amount_value: Number(item.amount_value),\n              amount_currency: purchase.currency || 'KRW',\n              remark: item.remark || null,\n              updated_at: new Date().toISOString()\n            })\n            .eq('id', item.id)\n\n          if (error) {\n            logger.error('ê¸°ì¡´ í•­ëª© ì—…ë°ì´íŠ¸ ì˜¤ë¥˜', error);\n            throw error;\n          }\n        } else {\n          // ìƒˆ í•­ëª© ìƒì„±\n          logger.debug('ìƒˆ í•­ëª© ìƒì„±', { itemName: item.item_name });\n          const insertData = {\n            purchase_request_id: purchase.id,\n            item_name: item.item_name.trim(),\n            specification: item.specification || null,\n            quantity: Number(item.quantity),\n            unit_price_value: Number(item.unit_price_value),\n            unit_price_currency: purchase.currency || 'KRW',\n            amount_value: Number(item.amount_value),\n            amount_currency: purchase.currency || 'KRW',\n            remark: item.remark || null,\n            line_number: item.line_number || editedItems.indexOf(item) + 1,\n            created_at: new Date().toISOString()\n          };\n          logger.debug('ì‚½ì…í•  ë°ì´í„°', { itemName: insertData.item_name });\n          \n          const { error } = await supabase\n            .from('purchase_request_items')\n            .insert(insertData)\n\n          if (error) {\n            logger.error('ìƒˆ í•­ëª© ìƒì„± ì˜¤ë¥˜', error);\n            throw error;\n          } else {\n            logger.debug('ìƒˆ í•­ëª© ìƒì„± ì„±ê³µ');\n          }\n        }\n      }\n\n      logger.debug('ì €ì¥ ì™„ë£Œ');\n      toast.success('ë°œì£¼ ë‚´ì—­ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.')\n      handleEditToggle(false)\n      setDeletedItemIds([])\n      \n      // ìˆ˜ì •ëœ ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ (ëª¨ë‹¬ì€ ì—´ë¦° ìƒíƒœ ìœ ì§€)\n      await loadPurchaseDetail(purchaseId?.toString() || '')\n\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      logger.error('ì €ì¥ ì¤‘ ì „ì²´ ì˜¤ë¥˜', error);\n      const errorMessage = error instanceof Error ? error.message : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤'\n      toast.error(`ì €ì¥ ì‹¤íŒ¨: ${errorMessage}`)\n    }\n  }\n\n  const handleItemChange = (index: number, field: string, value: any) => {\n    const newItems = [...editedItems]\n    \n    if (field === 'amount_value') {\n      // ê¸ˆì•¡ì„ ì§ì ‘ ìˆ˜ì •í•œ ê²½ìš°\n      newItems[index] = {\n        ...newItems[index],\n        amount_value: value\n      }\n    } else if (field === 'quantity' || field === 'unit_price_value') {\n      // ìˆ˜ëŸ‰ì´ë‚˜ ë‹¨ê°€ë¥¼ ìˆ˜ì •í•œ ê²½ìš° ê¸ˆì•¡ ìë™ ê³„ì‚°\n      const quantity = field === 'quantity' ? value : newItems[index].quantity\n      const unitPrice = field === 'unit_price_value' ? value : newItems[index].unit_price_value\n      newItems[index] = {\n        ...newItems[index],\n        [field]: value,\n        amount_value: quantity * unitPrice\n      }\n    } else {\n      // ê¸°íƒ€ í•„ë“œ ìˆ˜ì •\n      newItems[index] = {\n        ...newItems[index],\n        [field]: value\n      }\n    }\n    \n    setEditedItems(newItems)\n  }\n\n  const handleAddItem = () => {\n    // í˜„ì¬ ìµœëŒ€ ë¼ì¸ë„˜ë²„ ì°¾ê¸°\n    const maxLineNumber = editedItems.reduce((max, item) => {\n      const lineNum = item.line_number || 0;\n      return lineNum > max ? lineNum : max;\n    }, 0);\n\n    const newItem = {\n      item_name: '',\n      specification: '',\n      quantity: 1,\n      unit_price_value: 0,\n      amount_value: 0,\n      remark: '',\n      line_number: maxLineNumber + 1\n    }\n    \n    // ìƒˆ ì•„ì´í…œ ì¶”ê°€ í›„ ë¼ì¸ë„˜ë²„ ìˆœì„œëŒ€ë¡œ ì •ë ¬\n    const newItems = [...editedItems, newItem].sort((a, b) => {\n      const lineA = a.line_number || 999999;\n      const lineB = b.line_number || 999999;\n      return lineA - lineB;\n    });\n    \n    setEditedItems(newItems)\n  }\n\n  const handleRemoveItem = (index: number) => {\n    const item = editedItems[index]\n    if (item.id) {\n      setDeletedItemIds([...deletedItemIds, item.id])\n    }\n    const newItems = editedItems.filter((_, i) => i !== index).sort((a, b) => {\n      const lineA = a.line_number || 999999;\n      const lineB = b.line_number || 999999;\n      return lineA - lineB;\n    });\n    setEditedItems(newItems)\n  }\n\n  // êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ í•¨ìˆ˜\n  const handlePaymentToggle = async (itemId: number | string, isCompleted: boolean) => {\n    if (!canPurchase) {\n      toast.error('êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.')\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      toast.error('ìœ íš¨í•˜ì§€ ì•Šì€ í•­ëª© ID ì…ë‹ˆë‹¤.')\n      return\n    }\n\n    // í•´ë‹¹ í’ˆëª© ì •ë³´ ì°¾ê¸°\n    const targetItem = purchase?.items?.find(item => String(item.id) === itemIdStr)\n    if (!targetItem) return\n\n    const itemInfo = `í’ˆëª…: ${targetItem.item_name}\nê·œê²©: ${targetItem.specification || 'ë¯¸ì…ë ¥'}\nìˆ˜ëŸ‰: ${targetItem.quantity?.toLocaleString() || 0}${targetItem.unit || ''}\në‹¨ê°€: â‚©${targetItem.unit_price_value?.toLocaleString() || 0}\ní•©ê³„: â‚©${targetItem.amount_value?.toLocaleString() || 0}`\n\n    const confirmMessage = isCompleted \n      ? `ë‹¤ìŒ í’ˆëª©ì„ êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\\n\\n${itemInfo}` \n      : `ë‹¤ìŒ í’ˆëª©ì˜ êµ¬ë§¤ì™„ë£Œë¥¼ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\\n\\n${itemInfo}`\n    \n    const confirm = window.confirm(confirmMessage)\n    if (!confirm) return\n\n    try {\n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_payment_completed: isCompleted,\n          payment_completed_at: isCompleted ? new Date().toISOString() : null\n        })\n        .eq('id', numericId)\n\n      if (error) throw error\n\n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (UI ì¦‰ì‹œ ë°˜ì˜)\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          String(item.id) === itemIdStr \n            ? { ...item, is_payment_completed: isCompleted, payment_completed_at: isCompleted ? new Date().toISOString() : null }\n            : item\n        )\n        return { ...prev, items: updatedItems }\n      })\n\n      if (purchase) {\n        const purchaseIdNumber = Number(purchase.id)\n        if (!Number.isNaN(purchaseIdNumber)) {\n          onOptimisticUpdate?.(purchaseIdNumber, prev => {\n            const updatedItems = (prev.items || []).map(item =>\n              String(item.id) === itemIdStr\n                ? { ...item, is_payment_completed: isCompleted }\n                : item\n            )\n            const total = updatedItems.length || prev.items?.length || 0\n            const completed = updatedItems.filter(item => item.is_payment_completed).length\n            const allCompleted = total > 0 && completed === total\n            return {\n              ...prev,\n              items: updatedItems,\n              is_payment_completed: allCompleted,\n              payment_completed_at: allCompleted ? new Date().toISOString() : null,\n              payment_completed_by_name: allCompleted ? (currentUserName || prev.payment_completed_by_name) : prev.payment_completed_by_name\n            }\n          })\n        }\n      }\n      \n      toast.success(isCompleted ? 'êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'êµ¬ë§¤ì™„ë£Œê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.')\n\n      // ìƒì„¸ ëª¨ë‹¬ ë° ìƒìœ„ ë¦¬ìŠ¤íŠ¸ ëª¨ë‘ ìµœì‹  ìƒíƒœë¡œ ë™ê¸°í™”\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      toast.error('êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n\n  // ê°œë³„ í’ˆëª© ì…ê³ ì™„ë£Œ ì²˜ë¦¬ (ë‚ ì§œ ì„ íƒ)\n  const handleItemReceiptToggle = async (itemId: number | string, selectedDate: Date) => {\n    if (!canReceiptCheck) {\n      toast.error('ì…ê³  ì²˜ë¦¬ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.')\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      toast.error('ìœ íš¨í•˜ì§€ ì•Šì€ í•­ëª© ID ì…ë‹ˆë‹¤.')\n      return\n    }\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item =>\n            String(item.id) === itemIdStr\n              ? {\n                  ...item,\n                  is_received: true,\n                  actual_received_date: selectedDate.toISOString()\n                }\n              : item\n          )\n          const total = updatedItems.length || prev.items?.length || 0\n          const completed = updatedItems.filter(item => item.is_received).length\n          const allReceived = total > 0 && completed === total\n\n          return {\n            ...prev,\n            items: updatedItems,\n            is_received: allReceived,\n            received_at: allReceived ? new Date().toISOString() : prev.received_at\n          }\n        })\n      }\n    }\n\n    try {\n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_received: true,\n          received_at: new Date().toISOString(),\n          actual_received_date: selectedDate.toISOString()\n        })\n        .eq('id', numericId)\n\n      if (error) throw error\n\n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          String(item.id) === itemIdStr \n            ? { \n                ...item, \n                is_received: true, \n                received_at: new Date().toISOString(),\n                actual_received_date: selectedDate.toISOString()\n              }\n            : item\n        )\n        return { ...prev, items: updatedItems }\n      })\n\n      applyOptimisticUpdate()\n      \n      const targetItem = purchase?.items?.find(item => String(item.id) === itemIdStr)\n      toast.success(`\"${targetItem?.item_name}\" í’ˆëª©ì´ ì…ê³ ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.`)\n\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n\n      applyOptimisticUpdate()\n    } catch (error) {\n      toast.error('ì…ê³ ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n\n  // ì…ê³ ì™„ë£Œ ì·¨ì†Œ ì²˜ë¦¬\n  const handleReceiptCancel = async (itemId: number | string) => {\n    if (!canReceiptCheck) {\n      toast.error('ì…ê³  ì²˜ë¦¬ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.')\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      toast.error('ìœ íš¨í•˜ì§€ ì•Šì€ í•­ëª© ID ì…ë‹ˆë‹¤.')\n      return\n    }\n\n    const targetItem = purchase?.items?.find(item => String(item.id) === itemIdStr)\n    if (!targetItem) return\n\n    const confirm = window.confirm(`\"${targetItem.item_name}\" í’ˆëª©ì˜ ì…ê³ ì™„ë£Œë¥¼ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)\n    if (!confirm) return\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item =>\n            String(item.id) === itemIdStr\n              ? {\n                  ...item,\n                  is_received: false,\n                  actual_received_date: undefined\n                }\n              : item\n          )\n          const total = updatedItems.length || prev.items?.length || 0\n          const completed = updatedItems.filter(item => item.is_received).length\n          const allReceived = total > 0 && completed === total\n\n          return {\n            ...prev,\n            items: updatedItems,\n            is_received: allReceived,\n            received_at: allReceived ? prev.received_at : null\n          }\n        })\n      }\n    }\n\n    try {\n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_received: false,\n          received_at: null,\n          actual_received_date: null,\n          actual_received_by_name: null\n        })\n        .eq('id', numericId)\n\n      if (error) throw error\n\n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          String(item.id) === itemIdStr \n            ? { ...item, is_received: false, received_at: null, actual_received_date: undefined, actual_received_by_name: undefined }\n            : item\n        )\n        return { ...prev, items: updatedItems }\n      })\n      \n      applyOptimisticUpdate()\n\n      toast.success('ì…ê³ ì™„ë£Œê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.')\n\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n\n      applyOptimisticUpdate()\n    } catch (error) {\n      toast.error('ì…ê³ ì™„ë£Œ ì·¨ì†Œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n\n\n  // ìŠ¹ì¸ ì²˜ë¦¬\n  const handleApprove = async (type: 'middle' | 'final') => {\n    if (!purchase) return\n    \n    const approvalType = type === 'middle' ? '1ì°¨ ìŠ¹ì¸' : 'ìµœì¢… ìŠ¹ì¸'\n    const confirmMessage = `ë°œì£¼ë²ˆí˜¸: ${purchase.purchase_order_number}\\n\\n${approvalType}ì„ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`\n    const confirm = window.confirm(confirmMessage)\n    if (!confirm) return\n    \n    try {\n      const updateData = type === 'middle' \n        ? { \n            middle_manager_status: 'approved'\n          }\n        : { \n            final_manager_status: 'approved'\n          }\n      \n      const { error } = await supabase\n        .from('purchase_requests')\n        .update(updateData)\n        .eq('id', purchase.id)\n      \n      if (error) {\n        throw error\n      }\n      \n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (UI ì¦‰ì‹œ ë°˜ì˜)\n      if (type === 'middle') {\n        setPurchase(prev => prev ? { ...prev, middle_manager_status: 'approved' } : null)\n      } else {\n        setPurchase(prev => prev ? { ...prev, final_manager_status: 'approved' } : null)\n      }\n      \n      toast.success(`${type === 'middle' ? 'ì¤‘ê°„' : 'ìµœì¢…'} ìŠ¹ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`)\n    } catch (error) {\n      toast.error('ìŠ¹ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n  \n  // ì „ì²´ êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬\n  const handleCompleteAllPayment = async () => {\n    if (!purchase || !canPurchase) return\n    \n    const confirmMessage = `ë°œì£¼ë²ˆí˜¸: ${purchase.purchase_order_number}\\n\\nëª¨ë“  í’ˆëª©ì„ êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`\n    const confirm = window.confirm(confirmMessage)\n    if (!confirm) return\n    \n    try {\n      const updateData = {\n        is_payment_completed: true,\n        payment_completed_at: new Date().toISOString()\n      }\n      \n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update(updateData)\n        .eq('purchase_request_id', purchase.id)\n        .eq('is_payment_completed', false) // ì•„ì§ êµ¬ë§¤ì™„ë£Œë˜ì§€ ì•Šì€ í•­ëª©ë§Œ\n      \n      if (error) throw error\n      \n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (UI ì¦‰ì‹œ ë°˜ì˜)\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          !item.is_payment_completed \n            ? { ...item, is_payment_completed: true, payment_completed_at: new Date().toISOString() }\n            : item\n        )\n        return { ...prev, items: updatedItems }\n      })\n\n      if (purchase) {\n        const purchaseIdNumber = Number(purchase.id)\n        if (!Number.isNaN(purchaseIdNumber)) {\n          onOptimisticUpdate?.(purchaseIdNumber, prev => {\n            const updatedItems = (prev.items || []).map(item => ({\n              ...item,\n              is_payment_completed: true\n            }))\n            return {\n              ...prev,\n              items: updatedItems,\n              is_payment_completed: true,\n              payment_completed_at: new Date().toISOString(),\n              payment_completed_by_name: currentUserName || prev.payment_completed_by_name\n            }\n          })\n        }\n      }\n      \n      toast.success('ëª¨ë“  í’ˆëª©ì´ êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.')\n\n      // ìƒì„¸ ëª¨ë‹¬ ë° ë¦¬ìŠ¤íŠ¸ ëª¨ë‘ ìƒˆë¡œê³ ì¹¨\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      logger.error('ì „ì²´ êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ ì˜¤ë¥˜', error);\n      toast.error('êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n\n  // UTK í™•ì¸ ì²˜ë¦¬ í•¨ìˆ˜\n  const handleUtkToggle = async (itemId: number | string, isChecked: boolean) => {\n    if (!canReceiptCheck) {\n      toast.error('UTK í™•ì¸ ì²˜ë¦¬ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.')\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      toast.error('ìœ íš¨í•˜ì§€ ì•Šì€ í•­ëª© ID ì…ë‹ˆë‹¤.')\n      return\n    }\n\n    // í•´ë‹¹ í’ˆëª© ì •ë³´ ì°¾ê¸°\n    const targetItem = purchase?.items?.find(item => String(item.id) === itemIdStr)\n    if (!targetItem) return\n\n    const itemInfo = `í’ˆëª…: ${targetItem.item_name}\nê·œê²©: ${targetItem.specification || 'ë¯¸ì…ë ¥'}\nìˆ˜ëŸ‰: ${targetItem.quantity?.toLocaleString() || 0}${targetItem.unit || ''}\në‹¨ê°€: â‚©${targetItem.unit_price_value?.toLocaleString() || 0}\ní•©ê³„: â‚©${targetItem.amount_value?.toLocaleString() || 0}`\n\n    const confirmMessage = isChecked \n      ? `ë‹¤ìŒ í’ˆëª©ì„ UTK í™•ì¸ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\\n\\n${itemInfo}` \n      : `ë‹¤ìŒ í’ˆëª©ì˜ UTK í™•ì¸ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\\n\\n${itemInfo}`\n    \n    const confirm = window.confirm(confirmMessage)\n    if (!confirm) return\n\n    try {\n      const supabase = createClient()\n      logger.debug('UTK í™•ì¸ ì²˜ë¦¬ ì‹œì‘', { itemId: numericId, isChecked, itemIdStr })\n      \n      const { data, error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_utk_checked: isChecked\n        })\n        .eq('id', numericId)\n        .select()\n\n      if (error) {\n        logger.error('UTK í™•ì¸ DB ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { error, itemId: numericId, isChecked })\n        throw error\n      }\n      \n      logger.debug('UTK í™•ì¸ DB ì—…ë°ì´íŠ¸ ì„±ê³µ', { data })\n\n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (UI ì¦‰ì‹œ ë°˜ì˜)\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          String(item.id) === itemIdStr \n            ? { ...item, is_utk_checked: isChecked }\n            : item\n        )\n        return { ...prev, items: updatedItems }\n      })\n\n      if (purchase) {\n        const purchaseIdNumber = Number(purchase.id)\n        if (!Number.isNaN(purchaseIdNumber)) {\n          onOptimisticUpdate?.(purchaseIdNumber, prev => {\n            const updatedItems = (prev.items || []).map(item =>\n              String(item.id) === itemIdStr\n                ? { ...item, is_utk_checked: isChecked }\n                : item\n            )\n            const total = updatedItems.length || prev.items?.length || 0\n            const checked = updatedItems.filter(item => item.is_utk_checked).length\n            const allChecked = total > 0 && checked === total\n            return {\n              ...prev,\n              items: updatedItems,\n              is_utk_checked: allChecked\n            }\n          })\n        }\n      }\n\n      // ëª¨ë“  í’ˆëª©ì´ í™•ì¸ë˜ë©´ purchase_requestsì—ë„ ì—…ë°ì´íŠ¸\n      const allChecked = purchase?.items?.every(item => {\n        if (String(item.id) === itemIdStr) {\n          return isChecked\n        }\n        return item.is_utk_checked === true\n      })\n\n      if (allChecked !== undefined && purchase) {\n        logger.debug('purchase_requests ì—…ë°ì´íŠ¸ ì‹œì‘', { purchaseId: purchase.id, allChecked })\n        const { error: updateError } = await supabase\n          .from('purchase_requests')\n          .update({ is_utk_checked: allChecked })\n          .eq('id', purchase.id)\n          .select()\n        \n        if (updateError) {\n          logger.error('purchase_requests ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { error: updateError, purchaseId: purchase.id, allChecked })\n        } else {\n          logger.debug('purchase_requests ì—…ë°ì´íŠ¸ ì„±ê³µ', { purchaseId: purchase.id, allChecked })\n        }\n      }\n      \n      toast.success(isChecked ? 'UTK í™•ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.' : 'UTK í™•ì¸ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.')\n\n      // ìƒì„¸ ëª¨ë‹¬ ë° ìƒìœ„ ë¦¬ìŠ¤íŠ¸ ëª¨ë‘ ìµœì‹  ìƒíƒœë¡œ ë™ê¸°í™”\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      logger.error('UTK í™•ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜', error)\n      toast.error('UTK í™•ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n\n  // ì „ì²´ UTK í™•ì¸ ì²˜ë¦¬\n  const handleCompleteAllUtk = async () => {\n    if (!purchase || !canReceiptCheck) return\n    \n    const confirmMessage = `ë°œì£¼ë²ˆí˜¸: ${purchase.purchase_order_number}\\n\\nëª¨ë“  í’ˆëª©ì„ UTK í™•ì¸ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`\n    const confirm = window.confirm(confirmMessage)\n    if (!confirm) return\n    \n    try {\n      const supabase = createClient()\n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_utk_checked: true\n        })\n        .eq('purchase_request_id', purchase.id)\n        .eq('is_utk_checked', false) // ì•„ì§ í™•ì¸ë˜ì§€ ì•Šì€ í•­ëª©ë§Œ\n      \n      if (error) throw error\n\n      // purchase_requestsë„ ì—…ë°ì´íŠ¸\n      await supabase\n        .from('purchase_requests')\n        .update({ is_utk_checked: true })\n        .eq('id', purchase.id)\n      \n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (UI ì¦‰ì‹œ ë°˜ì˜)\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          !item.is_utk_checked \n            ? { ...item, is_utk_checked: true }\n            : item\n        )\n        return { \n          ...prev, \n          items: updatedItems,\n          is_utk_checked: true\n        }\n      })\n\n      if (purchase) {\n        const purchaseIdNumber = Number(purchase.id)\n        if (!Number.isNaN(purchaseIdNumber)) {\n          onOptimisticUpdate?.(purchaseIdNumber, prev => {\n            const updatedItems = (prev.items || []).map(item => ({\n              ...item,\n              is_utk_checked: true\n            }))\n            return {\n              ...prev,\n              items: updatedItems,\n              is_utk_checked: true\n            }\n          })\n        }\n      }\n      \n      toast.success('ëª¨ë“  í’ˆëª©ì˜ UTK í™•ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.')\n\n      // ìƒì„¸ ëª¨ë‹¬ ë° ë¦¬ìŠ¤íŠ¸ ëª¨ë‘ ìƒˆë¡œê³ ì¹¨\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      logger.error('ì „ì²´ UTK í™•ì¸ ì²˜ë¦¬ ì˜¤ë¥˜', error);\n      toast.error('UTK í™•ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n\n  // ì „ì²´ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ì²˜ë¦¬ (ë‚ ì§œ ì„ íƒ)\n  const handleCompleteAllStatement = async (selectedDate: Date) => {\n    if (!purchase || !canReceiptCheck) {\n      return\n    }\n\n    const formattedDate = selectedDate.toLocaleDateString('ko-KR', {\n      year: 'numeric',\n      month: '2-digit',\n      day: '2-digit'\n    })\n\n    const confirmMessage = `ë°œì£¼ë²ˆí˜¸: ${purchase.purchase_order_number}\n\nëª¨ë“  í’ˆëª©ì˜ íšŒê³„ìƒ ì…ê³ ì¼ì„ ${formattedDate}ë¡œ ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`\n    \n    if (!window.confirm(confirmMessage)) {\n      return\n    }\n\n    const selectedDateIso = selectedDate.toISOString()\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    try {\n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_statement_received: true,\n          statement_received_date: selectedDateIso,\n          statement_received_by_name: currentUserName || null\n        })\n        .eq('purchase_request_id', purchase.id)\n        .eq('is_statement_received', false) // ì•„ì§ í™•ì¸ë˜ì§€ ì•Šì€ í•­ëª©ë§Œ\n      \n      if (error) throw error\n\n      // purchase_requestsë„ ì—…ë°ì´íŠ¸\n      await supabase\n        .from('purchase_requests')\n        .update({ \n          is_statement_received: true,\n          statement_received_at: selectedDateIso\n        })\n        .eq('id', purchase.id)\n\n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          !item.is_statement_received \n            ? { \n                ...item, \n                is_statement_received: true,\n                statement_received_date: selectedDateIso,\n                statement_received_by_name: currentUserName || null\n              }\n            : item\n        )\n        const allCompleted = updatedItems && updatedItems.length > 0 && updatedItems.every(item => item.is_statement_received)\n        return { \n          ...prev, \n          items: updatedItems,\n          is_statement_received: allCompleted,\n          statement_received_at: allCompleted ? selectedDateIso : prev.statement_received_at\n        }\n      })\n\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item => ({\n            ...item,\n            is_statement_received: true,\n            statement_received_date: item.statement_received_date || selectedDateIso,\n            statement_received_by_name: item.statement_received_by_name || currentUserName || null\n          }))\n          return {\n            ...prev,\n            items: updatedItems,\n            is_statement_received: true,\n            statement_received_at: selectedDateIso\n          }\n        })\n      }\n\n      toast.success('ëª¨ë“  í’ˆëª©ì˜ íšŒê³„ìƒ ì…ê³ ì¼ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.')\n\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      logger.error('ì „ì²´ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ì²˜ë¦¬ ì˜¤ë¥˜', error)\n      toast.error('ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n\n  // ì „ì²´ ì…ê³ ì™„ë£Œ ì²˜ë¦¬ (ë‚ ì§œ ì„ íƒ)\n  const handleCompleteAllReceipt = async (selectedDate: Date) => {\n    if (!purchase || !canReceiveItems) {\n      return\n    }\n\n    // í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ\n    const confirmMessage = `ë°œì£¼ë²ˆí˜¸: ${purchase.purchase_order_number}\n\nì „ì²´ ì…ê³ ì™„ë£Œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`\n    \n    if (!window.confirm(confirmMessage)) {\n      return\n    }\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item => ({\n            ...item,\n            is_received: true,\n            actual_received_date: item.actual_received_date || selectedDate.toISOString()\n          }))\n\n          return {\n            ...prev,\n            items: updatedItems,\n            is_received: true,\n            received_at: new Date().toISOString()\n          }\n        })\n      }\n    }\n\n    try {\n      const updateData = {\n        is_received: true,\n        received_at: new Date().toISOString(),\n        actual_received_date: selectedDate.toISOString()\n      }\n      \n\n      const { data, error } = await supabase\n        .from('purchase_request_items')\n        .update(updateData)\n        .eq('purchase_request_id', purchase.id)\n        .is('actual_received_date', null) // ì•„ì§ ì‹¤ì œ ì…ê³ ë˜ì§€ ì•Šì€ í•­ëª©ë§Œ\n        .select()\n\n\n      if (error) throw error\n\n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          !item.actual_received_date \n            ? { \n                ...item, \n                is_received: true, \n                received_at: new Date().toISOString(),\n                actual_received_date: selectedDate.toISOString()\n              }\n            : item\n        )\n        return { ...prev, items: updatedItems }\n      })\n\n      applyOptimisticUpdate()\n\n      toast.success('ëª¨ë“  í’ˆëª©ì´ ì…ê³ ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.')\n\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n\n      applyOptimisticUpdate()\n    } catch (error) {\n      logger.error('ì „ì²´ ì…ê³ ì™„ë£Œ ì²˜ë¦¬ ì˜¤ë¥˜', error)\n      toast.error('ì…ê³ ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n  \n\n  // ë°˜ë ¤ ì²˜ë¦¬\n  const handleReject = async (type: 'middle' | 'final') => {\n    if (!purchase) return\n    \n    const reason = window.prompt('ë°˜ë ¤ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”:')\n    if (!reason) return\n    \n    try {\n      const updateData = type === 'middle'\n        ? {\n            middle_manager_status: 'rejected'\n          }\n        : {\n            final_manager_status: 'rejected'\n          }\n      \n      const { error } = await supabase\n        .from('purchase_requests')\n        .update(updateData)\n        .eq('id', purchase.id)\n      \n      if (error) {\n        throw error\n      }\n      \n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (UI ì¦‰ì‹œ ë°˜ì˜)\n      if (type === 'middle') {\n        setPurchase(prev => prev ? { ...prev, middle_manager_status: 'rejected' } : null)\n      } else {\n        setPurchase(prev => prev ? { ...prev, final_manager_status: 'rejected' } : null)\n      }\n      \n      toast.success(`${type === 'middle' ? 'ì¤‘ê°„' : 'ìµœì¢…'} ë°˜ë ¤ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`)\n    } catch (error) {\n      toast.error('ë°˜ë ¤ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n\n  const content = (\n    <div className=\"space-y-1 sm:space-y-4\">\n      {loading ? (\n        <div className=\"flex items-center justify-center py-12\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-hansl-600\"></div>\n        </div>\n      ) : purchase ? (\n        <div>\n          {/* Compact Info Header */}\n          <div className=\"bg-gray-50 rounded-lg p-2 sm:p-3 mb-1 sm:mb-2 border border-gray-100\">\n            <div className=\"grid grid-cols-1 sm:grid-cols-3 items-center gap-3 sm:gap-0\">\n              <div className=\"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-4\">\n                <div className=\"flex items-center gap-3\">\n                  {getStatusBadge()}\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"modal-label\">ìš”ì²­ì:</span>\n                    <span className=\"modal-value\">{purchase.requester_name}</span>\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Calendar className=\"w-3 h-3 text-gray-500\" />\n                  <span className=\"modal-subtitle\">ì²­êµ¬ì¼: {formatDate(purchase.request_date)}</span>\n                </div>\n              </div>\n              \n              {/* ìŠ¹ì¸ ë²„íŠ¼ë“¤ì„ ì¤‘ì•™ì— ë°°ì¹˜ */}\n              <div className=\"flex items-center justify-center gap-2 sm:gap-3 flex-wrap\">\n                {/* 1ì°¨ ìŠ¹ì¸ ë²„íŠ¼ */}\n                {(() => {\n                  const shouldShow = canApproveMiddle && purchase.middle_manager_status === 'pending';\n                  if (purchase?.purchase_order_number === 'F20251105_004') {\n                    logger.debug('F20251105_004 1ì°¨ ìŠ¹ì¸ ë²„íŠ¼ ì¡°ê±´', {\n                      canApproveMiddle,\n                      middleManagerStatus: purchase.middle_manager_status,\n                      shouldShow\n                    });\n                  }\n                  return shouldShow;\n                })() && (\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => handleApprove('middle')}\n                    className={`${approvalButtonClass} border border-gray-400 bg-white hover:bg-gray-50 hover:border-gray-500`}\n                  >\n                    1ì°¨ ìŠ¹ì¸ ëŒ€ê¸°\n                  </Button>\n                )}\n                {purchase.middle_manager_status === 'approved' && (\n                  <div className=\"button-approved badge-text shadow-sm\">\n                    <Check className=\"w-3 h-3\" />\n                    1ì°¨ ìŠ¹ì¸ì™„ë£Œ\n                  </div>\n                )}\n                {purchase.middle_manager_status === 'rejected' && (\n                  <div className=\"button-rejected badge-text\">\n                    <X className=\"w-3 h-3\" />\n                    1ì°¨ ë°˜ë ¤\n                  </div>\n                )}\n                {purchase.middle_manager_status === 'pending' && !canApproveMiddle && (\n                  <div className={`${approvalWaitingPillClass} border border-gray-300 text-gray-600 bg-white`}>\n                    1ì°¨ ìŠ¹ì¸ëŒ€ê¸°\n                  </div>\n                )}\n\n                {/* ìµœì¢… ìŠ¹ì¸ ë²„íŠ¼ */}\n                {(() => {\n                  const shouldShow = canApproveFinal && purchase.middle_manager_status === 'approved' && purchase.final_manager_status === 'pending';\n                  if (purchase?.purchase_order_number === 'F20251105_004') {\n                    logger.debug('F20251105_004 ìµœì¢… ìŠ¹ì¸ ë²„íŠ¼ ì¡°ê±´', {\n                      canApproveFinal,\n                      middleManagerStatus: purchase.middle_manager_status,\n                      finalManagerStatus: purchase.final_manager_status,\n                      shouldShow\n                    });\n                  }\n                  return shouldShow;\n                })() && (\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => handleApprove('final')}\n                    className={`${approvalButtonClass} border border-gray-400 bg-white hover:bg-gray-50 hover:border-gray-500`}\n                  >\n                    <Check className=\"w-3 h-3\" />\n                    ìµœì¢… ìŠ¹ì¸\n                  </Button>\n                )}\n                {purchase.final_manager_status === 'approved' && (\n                  <div className=\"button-approved badge-text\">\n                    <Check className=\"w-3 h-3\" />\n                    ìµœì¢… ìŠ¹ì¸ì™„ë£Œ\n                  </div>\n                )}\n                {purchase.final_manager_status === 'rejected' && (\n                  <div className=\"button-rejected badge-text\">\n                    <X className=\"w-3 h-3\" />\n                    ìµœì¢… ë°˜ë ¤\n                  </div>\n                )}\n                {purchase.middle_manager_status !== 'approved' && purchase.final_manager_status === 'pending' && (\n                  <div className={`${approvalWaitingPillClass} border border-gray-300 text-gray-600 bg-white`}>\n                    ìµœì¢… ìŠ¹ì¸ëŒ€ê¸°\n                  </div>\n                )}\n              </div>\n              \n              {/* ìš°ì¸¡ ë¹ˆ ì˜ì—­ */}\n              <div></div>\n            </div>\n          </div>\n\n          {/* Main 2-Column Layout */}\n          <div className=\"flex flex-col lg:flex-row gap-3 sm:gap-6\">\n            {/* Left Column - Basic Info (Fixed Width) */}\n            <div className=\"lg:w-80 lg:flex-shrink-0 space-y-1 sm:space-y-4 relative\">\n              \n              {/* ë°œì£¼ ê¸°ë³¸ì •ë³´ */}\n              <div className=\"bg-white rounded-lg p-2 sm:p-3 border border-gray-100 shadow-sm\">\n                <div className=\"mb-3\">\n                  <h3 className=\"modal-section-title flex items-center\">\n                    <FileText className=\"w-4 h-4 mr-2 text-gray-600\" />\n                    {purchase?.purchase_order_number || 'POë²ˆí˜¸ ì—†ìŒ'}\n                  </h3>\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">ë°œì£¼ì„œ ì¢…ë¥˜</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.request_type || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, request_type: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"ì¼ë°˜\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.request_type || 'ì¼ë°˜'}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">ê²°ì œ ì¢…ë¥˜</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.payment_category || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, payment_category: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"ë°œì£¼/êµ¬ë§¤ìš”ì²­/í˜„ì¥ê²°ì œ\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.payment_category || '-'}</p>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">ì…ê³  ìš”ì²­ì¼</span>\n                      {isEditing ? (\n                        <DatePickerPopover\n                          onDateSelect={(date) => {\n                            setEditedPurchase(prev => prev ? {\n                              ...prev,\n                              delivery_request_date: formatDateInput(date, 'yyyy-MM-dd')\n                            } : null)\n                          }}\n                          placeholder=\"ì…ê³  ìš”ì²­ì¼ì„ ì„ íƒí•˜ì„¸ìš”\"\n                          align=\"start\"\n                          side=\"bottom\"\n                        >\n                          <Button\n                            variant=\"outline\"\n                            className=\"mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] justify-start text-left font-normal business-radius-input\"\n                          >\n                            <Calendar className=\"mr-1 h-3 w-3\" />\n                            {editedPurchase?.delivery_request_date ? \n                              formatDate(editedPurchase.delivery_request_date) : \n                              'ë‚ ì§œ ì„ íƒ'\n                            }\n                          </Button>\n                        </DatePickerPopover>\n                      ) : (\n                        <p className=\"modal-subtitle\">{formatDate(purchase.delivery_request_date)}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label text-orange-500\">ë³€ê²½ ì…ê³ ì¼</span>\n                      {isEditing ? (\n                        <DatePickerPopover\n                          onDateSelect={(date) => {\n                            setEditedPurchase(prev => prev ? {\n                              ...prev,\n                              revised_delivery_request_date: formatDateInput(date, 'yyyy-MM-dd')\n                            } : null)\n                          }}\n                          placeholder=\"ë³€ê²½ ì…ê³ ì¼ì„ ì„ íƒí•˜ì„¸ìš”\"\n                          align=\"start\"\n                          side=\"bottom\"\n                        >\n                          <Button\n                            variant=\"outline\"\n                            className=\"mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] justify-start text-left font-normal business-radius-input\"\n                          >\n                            <Calendar className=\"mr-1 h-3 w-3\" />\n                            {editedPurchase?.revised_delivery_request_date ? \n                              formatDate(editedPurchase.revised_delivery_request_date) : \n                              'ë‚ ì§œ ì„ íƒ'\n                            }\n                          </Button>\n                        </DatePickerPopover>\n                      ) : (\n                        <p className=\"modal-subtitle text-orange-700\">\n                          {purchase.revised_delivery_request_date ? formatDate(purchase.revised_delivery_request_date) : 'ë¯¸ì„¤ì •'}\n                        </p>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/* ì—…ì²´ ì •ë³´ */}\n              <div className=\"bg-white rounded-lg p-2 sm:p-3 border border-gray-100 shadow-sm\">\n                <h3 className=\"modal-section-title mb-3 flex items-center\">\n                  <Building2 className=\"w-4 h-4 mr-2 text-gray-600\" />\n                  ì—…ì²´ ì •ë³´\n                </h3>\n                \n                <div className=\"space-y-2\">\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">ì—…ì²´ëª…</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.vendor?.vendor_name || editedPurchase?.vendor_name || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, vendor_name: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"ì—…ì²´ ì„ íƒ\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.vendor?.vendor_name || '-'}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">ì—…ì²´ ë‹´ë‹¹ì</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.vendor_contacts?.[0]?.contact_name || ''}\n                          onChange={(e) => {\n                            setEditedPurchase(prev => {\n                              if (!prev) return null;\n                              const contacts = prev.vendor_contacts || [];\n                              const updatedContacts = [...contacts];\n                              if (updatedContacts[0]) {\n                                updatedContacts[0] = { ...updatedContacts[0], contact_name: e.target.value };\n                              } else {\n                                updatedContacts[0] = { contact_name: e.target.value } as any;\n                              }\n                              return { ...prev, vendor_contacts: updatedContacts };\n                            })\n                          }}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"ë‹´ë‹¹ì ì„ íƒ\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.vendor_contacts?.[0]?.contact_name || '-'}</p>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">PJì—…ì²´</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.project_vendor || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, project_vendor: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"ì…ë ¥\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.project_vendor || '-'}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">Item</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.project_item || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, project_item: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"ì…ë ¥\"\n                        />\n                      ) : (\n                        <p className=\"modal-subtitle\">{purchase.project_item || '-'}</p>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">ìˆ˜ì£¼ë²ˆí˜¸</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.order_number || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, order_number: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"ì…ë ¥\"\n                        />\n                      ) : (\n                        <p className=\"modal-subtitle\">{purchase.order_number || '-'}</p>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n            </div>\n\n            {/* Right Column - Items List (Flexible Width) */}\n            <div className=\"lg:flex-1 lg:min-w-0 relative overflow-visible\">\n              \n              <div className=\"bg-white rounded-lg border border-gray-100 overflow-hidden shadow-sm\">\n                <div className=\"p-2 sm:p-3 bg-gray-50 border-b border-gray-100 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-0\">\n                  <h3 className=\"modal-section-title flex items-center\">\n                    <Package className=\"w-4 h-4 mr-2 text-gray-600\" />\n                    í’ˆëª© ë¦¬ìŠ¤íŠ¸\n                    <span className=\"ml-2 badge-stats bg-gray-500 text-white\">\n                      {purchase.purchase_request_items?.length || 0}ê°œ\n                    </span>\n                  </h3>\n                  {!isEditing && (\n                    <>\n                      {activeTab === 'purchase' && canPurchase && (\n                        <Button\n                          size=\"sm\"\n                          onClick={handleCompleteAllPayment}\n                          className=\"button-base bg-orange-500 hover:bg-orange-600 text-white\"\n                        >\n                          <CreditCard className=\"w-3 h-3 mr-1\" />\n                          ì „ì²´ êµ¬ë§¤ì™„ë£Œ\n                        </Button>\n                      )}\n                      {activeTab === 'receipt' && canReceiveItems && (\n                        <DatePickerPopover\n                          onDateSelect={handleCompleteAllReceipt}\n                          placeholder=\"ì „ì²´ ì…ê³ ì™„ë£Œ ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”\"\n                          align=\"end\"\n                          side=\"bottom\"\n                        >\n                          <Button\n                            size=\"sm\"\n                            className=\"button-base button-action-primary\"\n                          >\n                            <Truck className=\"w-3 h-3 mr-1\" />\n                            ì „ì²´ ì…ê³ ì™„ë£Œ\n                          </Button>\n                        </DatePickerPopover>\n                      )}\n                      {activeTab === 'done' && canReceiptCheck && (\n                        <div className=\"flex items-center gap-2\">\n                          <DatePickerPopover\n                            onDateSelect={handleCompleteAllStatement}\n                            placeholder=\"ì „ì²´ íšŒê³„ìƒ ì…ê³ ì¼ì„ ì„ íƒí•˜ì„¸ìš”\"\n                            align=\"end\"\n                            side=\"bottom\"\n                          >\n                            <Button\n                              size=\"sm\"\n                              className=\"button-base button-action-primary\"\n                            >\n                              <FileText className=\"w-3 h-3 mr-1\" />\n                              ê±°ë˜ëª…ì„¸ì„œ í™•ì¸\n                            </Button>\n                          </DatePickerPopover>\n                          <Button\n                            size=\"sm\"\n                            onClick={handleCompleteAllUtk}\n                            className=\"button-base bg-orange-500 hover:bg-orange-600 text-white\"\n                          >\n                            <CheckCircle className=\"w-3 h-3 mr-1\" />\n                            UTK í™•ì¸\n                          </Button>\n                        </div>\n                      )}\n                    </>\n                  )}\n                </div>\n                \n                {/* Mobile Table Header */}\n                <div className=\"block sm:hidden bg-gray-50 px-2 py-1 border-b border-gray-100\">\n                  <div className=\"text-xs font-medium text-gray-600\">í’ˆëª© ëª©ë¡ (í„°ì¹˜í•˜ì—¬ ìŠ¤í¬ë¡¤)</div>\n                </div>\n                \n                {/* Items List with Header Inside Scrollable Container */}\n                <div className=\"max-h-[50vh] sm:max-h-[40vh] w-full min-w-0 overflow-auto\">\n                  <div style={{ minWidth: `${tableMinWidth}px` }}>\n                    {/* Items Table Header - Sticky inside scroll container */}\n                    <div className=\"bg-gray-50 px-2 sm:px-3 py-1 border-b border-gray-100 sticky top-0 z-10\">\n                      <div \n                        ref={headerRowRef}\n                        className=\"hidden sm:grid gap-3 modal-label\" \n                        style={{\n                          gridTemplateColumns: getGridTemplateColumns()\n                        }}\n                      >\n                        <div>í’ˆëª©ëª…</div>\n                        <div>ê·œê²©</div>\n                        <div className=\"text-center\">ìˆ˜ëŸ‰</div>\n                        <div className=\"text-right\">ë‹¨ê°€</div>\n                        <div className=\"text-right\">í•©ê³„</div>\n                        <div className=\"text-center\">ë¹„ê³ </div>\n                        {isEditing ? (\n                          <>\n                            <div className=\"text-center\">ì‚­ì œ</div>\n                            {activeTab === 'receipt' && (\n                              <>\n                                <div className=\"text-center\">ì‹¤ì œì…ê³ ì¼</div>\n                              </>\n                            )}\n                            {activeTab === 'done' && (\n                              <>\n                                <div className=\"text-center\">ê±°ë˜ëª…ì„¸ì„œ í™•ì¸</div>\n                                <div className=\"text-center\">íšŒê³„ìƒ ì…ê³ ì¼</div>\n                                <div className=\"text-center\">ì²˜ë¦¬ì</div>\n                                <div className=\"text-center\">UTK</div>\n                              </>\n                            )}\n                          </>\n                        ) : (\n                          <>\n                            <div className=\"text-center\">\n                              {activeTab === 'purchase'\n                                ? 'êµ¬ë§¤ìƒíƒœ'\n                                : (activeTab === 'receipt' || activeTab === 'done')\n                                ? 'ì…ê³ ìƒíƒœ'\n                                : 'ìƒíƒœ'}\n                            </div>\n                            {activeTab === 'done' && (\n                              <>\n                                <div className=\"text-center\">ê±°ë˜ëª…ì„¸ì„œ í™•ì¸</div>\n                                <div className=\"text-center\">íšŒê³„ìƒ ì…ê³ ì¼</div>\n                                <div className=\"text-center\">ì²˜ë¦¬ì</div>\n                                <div className=\"text-center\">UTK</div>\n                              </>\n                            )}\n                            {activeTab === 'receipt' && (\n                              <>\n                                <div className=\"text-center\">ì‹¤ì œì…ê³ ì¼</div>\n                              </>\n                            )}\n                          </>\n                        )}\n                      </div>\n                    </div>\n                    <div className=\"divide-y divide-gray-100\">\n                      {(isEditing ? editedItems : purchase.purchase_request_items)?.map((item, index) => (\n                        <div key={index} className=\"px-2 sm:px-3 py-1.5 border-b border-gray-50 hover:bg-gray-50/50 transition-colors\">\n                          {/* Desktop Layout */}\n                          <div className={`hidden sm:grid items-center gap-3`} style={{\n                            gridTemplateColumns: getGridTemplateColumns()\n                          }}>\n                            {/* í’ˆëª©ëª… */}\n                            <div className=\"min-w-0\">\n                              {isEditing ? (\n                                <Input\n                                  value={item.item_name}\n                                  onChange={(e) => handleItemChange(index, 'item_name', e.target.value)}\n                                  className=\"modal-label border-gray-200 rounded-lg w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                  placeholder=\"í’ˆëª©ëª…\"\n                                  disabled={canEditLimited && !canEditAll}  // lead buyerëŠ” í’ˆëª©ëª… ìˆ˜ì • ë¶ˆê°€\n                                />\n                              ) : (\n                                <span className=\"modal-value\">{item.item_name || 'í’ˆëª©ëª… ì—†ìŒ'}</span>\n                              )}\n                            </div>\n                            \n                            {/* ê·œê²© */}\n                            <div className=\"min-w-0\">\n                              {isEditing ? (\n                                <Input\n                                  value={item.specification}\n                                  onChange={(e) => handleItemChange(index, 'specification', e.target.value)}\n                                  className=\"modal-label border-gray-200 rounded-lg w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                  placeholder=\"ê·œê²©\"\n                                  disabled={canEditLimited && !canEditAll}  // lead buyerëŠ” ê·œê²© ìˆ˜ì • ë¶ˆê°€\n                                />\n                              ) : (\n                                <span className=\"modal-subtitle\">{item.specification || '-'}</span>\n                              )}\n                            </div>\n                            \n                            {/* ìˆ˜ëŸ‰ */}\n                            <div className=\"text-center min-w-0\">\n                              {isEditing ? (\n                                <Input\n                                  type=\"number\"\n                                  value={item.quantity}\n                                  onChange={(e) => handleItemChange(index, 'quantity', Number(e.target.value))}\n                                  className=\"modal-label border-gray-200 rounded-lg text-center w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                  placeholder=\"ìˆ˜ëŸ‰\"\n                                  max=\"99999\"\n                                />\n                              ) : (\n                                <span className=\"modal-subtitle\">{item.quantity || 0}</span>\n                              )}\n                            </div>\n                            \n                            {/* ë‹¨ê°€ */}\n                            <div className=\"text-right min-w-0\">\n                              {isEditing ? (\n                                <Input\n                                  type=\"number\"\n                                  value={item.unit_price_value}\n                                  onChange={(e) => handleItemChange(index, 'unit_price_value', Number(e.target.value))}\n                                  className=\"modal-label border-gray-200 rounded-lg text-right w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                  placeholder=\"ë‹¨ê°€\"\n                                  max=\"100000000000\"\n                                />\n                              ) : (\n                                <span className=\"modal-subtitle\">â‚©{formatCurrency(item.unit_price_value)}</span>\n                              )}\n                            </div>\n                            \n                            {/* í•©ê³„ */}\n                            <div className=\"text-right min-w-0\">\n                              {isEditing ? (\n                                <Input\n                                  type=\"number\"\n                                  value={item.amount_value}\n                                  onChange={(e) => handleItemChange(index, 'amount_value', Number(e.target.value))}\n                                  className=\"modal-label border-gray-200 rounded-lg text-right w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                  placeholder=\"í•©ê³„\"\n                                  max=\"10000000000\"\n                                  disabled={canEditLimited && !canEditAll}  // lead buyerëŠ” í•©ê³„ ìˆ˜ì • ë¶ˆê°€ (ìë™ê³„ì‚°)\n                                />\n                              ) : (\n                                <span className=\"modal-value\">â‚©{formatCurrency(item.amount_value || 0)}</span>\n                              )}\n                            </div>\n                            \n                            {/* ë¹„ê³  */}\n                            <div className=\"min-w-0 flex justify-center items-start pt-1 text-center\">\n                              {isEditing ? (\n                                <Input\n                                  value={item.remark || ''}\n                                  disabled={canEditLimited && !canEditAll}  // lead buyerëŠ” ë¹„ê³  ìˆ˜ì • ë¶ˆê°€\n                                  onChange={(e) => handleItemChange(index, 'remark', e.target.value)}\n                                  className=\"modal-label border-gray-200 rounded-lg text-center w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                  placeholder=\"ë¹„ê³ \"\n                                />\n                              ) : (\n                                <span className=\"modal-subtitle text-center\">{item.remark || '-'}</span>\n                              )}\n                            </div>\n                            \n                            {/* ìƒíƒœ/ì•¡ì…˜ - ìŠ¹ì¸ëŒ€ê¸°íƒ­ì—ì„œëŠ” ì œì™¸ */}\n                            {activeTab !== 'pending' && (\n                              <div className=\"text-center flex justify-center items-start pt-1\">\n                                {isEditing ? (\n                                  <Button\n                                    size=\"sm\"\n                                    variant=\"ghost\"\n                                    onClick={() => handleRemoveItem(index)}\n                                    className=\"text-red-600 hover:bg-red-50 rounded-lg p-1 h-6 w-6\"\n                                  >\n                                    <Trash2 className=\"w-3 h-3\" />\n                                  </Button>\n                                ) : (\n                                  <>\n                                    {/* êµ¬ë§¤ íƒ­ì—ì„œì˜ êµ¬ë§¤ì™„ë£Œ ìƒíƒœ */}\n                                    {activeTab === 'purchase' && (\n                                    <div className=\"flex justify-center\">\n                                      {canPurchase ? (\n                                        <button\n                                          onClick={() => handlePaymentToggle(item.id, !item.is_payment_completed)}\n                                          className={`transition-colors ${\n                                            item.is_payment_completed\n                                              ? 'button-toggle-active bg-orange-500 hover:bg-orange-600 text-white'\n                                              : 'button-toggle-inactive'\n                                          }`}\n                                        >\n                                          {item.is_payment_completed ? 'êµ¬ë§¤ì™„ë£Œ' : 'êµ¬ë§¤ëŒ€ê¸°'}\n                                        </button>\n                                      ) : (\n                                        <span className={`${\n                                          item.is_payment_completed \n                                            ? 'button-toggle-active bg-orange-500 text-white' \n                                            : 'button-waiting-inactive'\n                                        }`}>\n                                          {item.is_payment_completed ? 'êµ¬ë§¤ì™„ë£Œ' : 'êµ¬ë§¤ëŒ€ê¸°'}\n                                        </span>\n                                      )}\n                                    </div>\n                                  )}\n                                  \n                                  {/* ì…ê³  íƒ­ì—ì„œì˜ ì…ê³ ì™„ë£Œ ìƒíƒœ */}\n                                  {activeTab === 'receipt' && (\n                                    <div className=\"flex justify-center\">\n                                      {canReceiptCheck ? (\n                                        actualReceivedAction.isCompleted(item) ? (\n                                          <button\n                                            onClick={() => {\n                                              actualReceivedAction.handleCancel(item.id, {\n                                                item_name: item.item_name,\n                                                specification: item.specification,\n                                                quantity: item.quantity,\n                                                unit_price_value: item.unit_price_value,\n                                                amount_value: item.amount_value,\n                                                remark: item.remark\n                                              })\n                                            }}\n                                            className=\"button-action-primary\"\n                                          >\n                                            {actualReceivedAction.config.completedText}\n                                          </button>\n                                        ) : (\n                                          <DatePickerPopover\n                                            onDateSelect={(date) => {\n                                              actualReceivedAction.handleConfirm(item.id, date, {\n                                                item_name: item.item_name,\n                                                specification: item.specification,\n                                                quantity: item.quantity,\n                                                unit_price_value: item.unit_price_value,\n                                                amount_value: item.amount_value,\n                                                remark: item.remark\n                                              })\n                                            }}\n                                            placeholder=\"ì‹¤ì œ ì…ê³ ëœ ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”\"\n                                            align=\"center\"\n                                            side=\"bottom\"\n                                          >\n                                            <button className=\"button-toggle-inactive\">\n                                              {actualReceivedAction.config.waitingText}\n                                            </button>\n                                          </DatePickerPopover>\n                                        )\n                                      ) : (\n                                        <span className={`${\n                                          actualReceivedAction.isCompleted(item)\n                                            ? 'button-action-primary' \n                                            : 'button-waiting-inactive'\n                                        }`}>\n                                          {actualReceivedAction.isCompleted(item) ? actualReceivedAction.config.completedText : actualReceivedAction.config.waitingText}\n                                        </span>\n                                      )}\n                                    </div>\n                                  )}\n                                  \n                                  {/* ì „ì²´ í•­ëª© íƒ­ì—ì„œëŠ” ì…ê³  ìƒíƒœë§Œ í‘œì‹œ (í´ë¦­ ë¶ˆê°€) */}\n                                  {activeTab === 'done' && (\n                                    <div className=\"flex justify-center\">\n                                      <span className={`button-base ${\n                                        actualReceivedAction.isCompleted(item)\n                                          ? 'bg-green-500 hover:bg-green-600 text-white' \n                                          : 'border border-gray-300 text-gray-600 bg-white hover:bg-gray-50'\n                                      }`}>\n                                        {actualReceivedAction.isCompleted(item) ? 'ì…ê³ ì™„ë£Œ' : 'ì…ê³ ëŒ€ê¸°'}\n                                      </span>\n                                    </div>\n                                  )}\n                                  \n                                  {/* ê¸°íƒ€ íƒ­ì—ì„œëŠ” ê¸°ë³¸ ìƒíƒœ í‘œì‹œ */}\n                                  {activeTab !== 'purchase' && activeTab !== 'receipt' && activeTab !== 'done' && (\n                                    <div className=\"flex justify-center\">\n                                      <span className=\"badge-text\">-</span>\n                                    </div>\n                                  )}\n                                </>\n                              )}\n                              </div>\n                            )}\n                            \n                            {/* ì‹¤ì œ ì…ê³  ë‚ ì§œ - ì…ê³  íƒ­ì—ì„œë§Œ í‘œì‹œ (ìƒíƒœ ì»¬ëŸ¼ ì˜¤ë¥¸ìª½) */}\n                            {activeTab === 'receipt' && (\n                              <div className=\"text-center flex justify-center items-start pt-1 pl-2\">\n                                {actualReceivedAction.getCompletedDate(item) ? (\n                                  <div className=\"modal-subtitle text-green-700\">\n                                    {new Date(actualReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                                      year: 'numeric',\n                                      month: '2-digit',\n                                      day: '2-digit'\n                                    })}\n                                  </div>\n                                ) : (\n                                  <span className=\"modal-subtitle text-gray-400\">-</span>\n                                )}\n                              </div>\n                            )}\n\n                            {/* ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ - ì „ì²´í•­ëª© íƒ­ì—ì„œë§Œ í‘œì‹œ */}\n                            {activeTab === 'done' && (\n                              <div className=\"text-center flex justify-center items-start pt-1\">\n                                {canReceiptCheck ? (\n                                  statementReceivedAction.isCompleted(item) ? (\n                                    <button\n                                      onClick={() => {\n                                        statementReceivedAction.handleCancel(item.id, {\n                                          item_name: item.item_name,\n                                          specification: item.specification,\n                                          quantity: item.quantity,\n                                          unit_price_value: item.unit_price_value,\n                                          amount_value: item.amount_value,\n                                          remark: item.remark\n                                        })\n                                      }}\n                                      className=\"button-action-primary hover:bg-green-600 transition-colors\"\n                                      title=\"í´ë¦­í•˜ì—¬ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ì·¨ì†Œ\"\n                                    >\n                                      {statementReceivedAction.config.completedText}\n                                    </button>\n                                  ) : (\n                                    <DatePickerPopover\n                                      onDateSelect={(date) => {\n                                        statementReceivedAction.handleConfirm(item.id, date, {\n                                          item_name: item.item_name,\n                                          specification: item.specification,\n                                          quantity: item.quantity,\n                                          unit_price_value: item.unit_price_value,\n                                          amount_value: item.amount_value,\n                                          remark: item.remark\n                                        })\n                                      }}\n                                      placeholder=\"íšŒê³„ìƒ ì…ê³ ì¼ì„ ì„ íƒí•˜ì„¸ìš”\"\n                                      align=\"center\"\n                                      side=\"bottom\"\n                                    >\n                                      <button \n                                        className=\"button-toggle-inactive\"\n                                        onClick={() => {}}\n                                      >\n                                        {statementReceivedAction.config.waitingText}\n                                      </button>\n                                    </DatePickerPopover>\n                                  )\n                                ) : (\n                                  <span className={`${\n                                    statementReceivedAction.isCompleted(item)\n                                      ? 'button-action-primary' \n                                      : 'button-waiting-inactive'\n                                  }`}>\n                                    {statementReceivedAction.isCompleted(item) ? statementReceivedAction.config.completedText : statementReceivedAction.config.waitingText}\n                                  </span>\n                                )}\n                              </div>\n                            )}\n\n                            {/* íšŒê³„ìƒ ì…ê³ ì¼ - ì „ì²´í•­ëª© íƒ­ì—ì„œë§Œ í‘œì‹œ */}\n                            {activeTab === 'done' && (\n                              <div className=\"text-center flex justify-center items-start pt-1\">\n                                {statementReceivedAction.getCompletedDate(item) ? (\n                                  <div className=\"modal-subtitle text-blue-700\">\n                                    {new Date(statementReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                                      year: 'numeric',\n                                      month: '2-digit',\n                                      day: '2-digit'\n                                    })}\n                                  </div>\n                                ) : (\n                                  <span className=\"modal-subtitle text-gray-400\">-</span>\n                                )}\n                              </div>\n                            )}\n                            {/* ì²˜ë¦¬ì - ì „ì²´í•­ëª© íƒ­ì—ì„œë§Œ í‘œì‹œ */}\n                            {activeTab === 'done' && (\n                              <div className=\"text-center flex justify-center items-start pt-1\">\n                                {statementReceivedAction.getCompletedByName(item) ? (\n                                  <span className=\"modal-subtitle text-gray-600\">\n                                    {statementReceivedAction.getCompletedByName(item)}\n                                  </span>\n                                ) : (\n                                  <span className=\"modal-subtitle text-gray-400\">-</span>\n                                )}\n                              </div>\n                            )}\n\n                            {/* UTK í™•ì¸ - ì „ì²´í•­ëª© íƒ­ì—ì„œë§Œ í‘œì‹œ (ë§¨ ì˜¤ë¥¸ìª½ ë) */}\n                            {activeTab === 'done' && (\n                              <div className=\"text-center flex justify-center items-start pt-1\">\n                                {canReceiptCheck ? (\n                                  <button\n                                    onClick={() => handleUtkToggle(item.id, !item.is_utk_checked)}\n                                    className={`button-base transition-colors ${\n                                      item.is_utk_checked\n                                        ? 'button-toggle-active bg-orange-500 hover:bg-orange-600 text-white'\n                                        : 'button-toggle-inactive'\n                                    }`}\n                                    title={item.is_utk_checked ? 'UTK í™•ì¸ ì·¨ì†Œ' : 'UTK í™•ì¸ ì²˜ë¦¬'}\n                                  >\n                                    {item.is_utk_checked ? 'ì™„ë£Œ' : 'ëŒ€ê¸°'}\n                                  </button>\n                                ) : (\n                                  <span className={`${\n                                    item.is_utk_checked \n                                      ? 'button-toggle-active bg-orange-500 text-white' \n                                      : 'button-waiting-inactive'\n                                  }`}>\n                                    {item.is_utk_checked ? 'ì™„ë£Œ' : 'ëŒ€ê¸°'}\n                                  </span>\n                                )}\n                              </div>\n                            )}\n                          </div>\n                          \n                          {/* Mobile Layout */}\n                          <div className=\"block sm:hidden space-y-2\">\n                            <div className=\"flex justify-between items-start\">\n                              <div className=\"flex-1 min-w-0\">\n                                {isEditing ? (\n                                  <Input\n                                    value={item.item_name}\n                                    onChange={(e) => handleItemChange(index, 'item_name', e.target.value)}\n                                    className=\"modal-label border-gray-200 rounded-lg w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                    placeholder=\"í’ˆëª©ëª…\"\n                                    disabled={canEditLimited && !canEditAll}  // lead buyerëŠ” í’ˆëª©ëª… ìˆ˜ì • ë¶ˆê°€\n                                  />\n                                ) : (\n                                  <div className=\"modal-value font-medium\">{item.item_name || 'í’ˆëª©ëª… ì—†ìŒ'}</div>\n                                )}\n                                {isEditing ? (\n                                  <Input\n                                    value={item.specification}\n                                    onChange={(e) => handleItemChange(index, 'specification', e.target.value)}\n                                    className=\"modal-label border-gray-200 rounded-lg mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                    placeholder=\"ê·œê²©\"\n                                    disabled={canEditLimited && !canEditAll}  // lead buyerëŠ” ê·œê²© ìˆ˜ì • ë¶ˆê°€\n                                  />\n                                ) : (\n                                  <div className=\"modal-subtitle text-gray-500\">{item.specification || '-'}</div>\n                                )}\n                              </div>\n                              <div className=\"ml-3 text-right flex-shrink-0\">\n                                {isEditing ? (\n                                  <Input\n                                    type=\"number\"\n                                    value={item.amount_value}\n                                    onChange={(e) => handleItemChange(index, 'amount_value', Number(e.target.value))}\n                                    className=\"modal-label border-gray-200 rounded-lg text-right w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                    placeholder=\"í•©ê³„\"\n                                    disabled={canEditLimited && !canEditAll}  // lead buyerëŠ” í•©ê³„ ìˆ˜ì • ë¶ˆê°€ (ìë™ê³„ì‚°)\n                                  />\n                                ) : (\n                                  <div className=\"modal-value font-semibold\">â‚©{formatCurrency(item.amount_value || 0)}</div>\n                                )}\n                              </div>\n                            </div>\n                            \n                            <div className=\"grid grid-cols-3 gap-2 text-sm\">\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">ìˆ˜ëŸ‰:</span>\n                                {isEditing ? (\n                                  <Input\n                                    type=\"number\"\n                                    value={item.quantity}\n                                    onChange={(e) => handleItemChange(index, 'quantity', Number(e.target.value))}\n                                    className=\"modal-label border-gray-200 rounded-lg mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                    placeholder=\"ìˆ˜ëŸ‰\"\n                                  />\n                                ) : (\n                                  <div className=\"modal-subtitle\">{item.quantity || 0}</div>\n                                )}\n                              </div>\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">ë‹¨ê°€:</span>\n                                {isEditing ? (\n                                  <Input\n                                    type=\"number\"\n                                    value={item.unit_price_value}\n                                    onChange={(e) => handleItemChange(index, 'unit_price_value', Number(e.target.value))}\n                                    className=\"modal-label border-gray-200 rounded-lg mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                    placeholder=\"ë‹¨ê°€\"\n                                  />\n                                ) : (\n                                  <div className=\"modal-subtitle\">â‚©{formatCurrency(item.unit_price_value)}</div>\n                                )}\n                              </div>\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">ìƒíƒœ:</span>\n                                <div className=\"mt-1\">\n                                  {isEditing ? (\n                                    <Button\n                                      size=\"sm\"\n                                      variant=\"ghost\"\n                                      onClick={() => handleRemoveItem(index)}\n                                      className=\"text-red-600 hover:bg-red-50 rounded-lg p-1 h-6 w-6\"\n                                    >\n                                      <Trash2 className=\"w-3 h-3\" />\n                                    </Button>\n                                  ) : (\n                                    <>\n                                      {activeTab === 'purchase' && (\n                                        <>\n                                          {canPurchase ? (\n                                            <button\n                                              onClick={() => handlePaymentToggle(item.id, !item.is_payment_completed)}\n                                              className={`text-xs px-2 py-1 rounded transition-colors ${\n                                                item.is_payment_completed\n                                                  ? 'bg-orange-500 text-white hover:bg-orange-600'\n                                                  : 'bg-gray-100 text-gray-600'\n                                              }`}\n                                            >\n                                              {item.is_payment_completed ? 'êµ¬ë§¤ì™„ë£Œ' : 'êµ¬ë§¤ëŒ€ê¸°'}\n                                            </button>\n                                          ) : (\n                                            <span className={`text-xs px-2 py-1 rounded ${\n                                              item.is_payment_completed \n                                                ? 'bg-orange-500 text-white' \n                                                : 'bg-gray-100 text-gray-400'\n                                            }`}>\n                                              {item.is_payment_completed ? 'êµ¬ë§¤ì™„ë£Œ' : 'êµ¬ë§¤ëŒ€ê¸°'}\n                                            </span>\n                                          )}\n                                        </>\n                                      )}\n                                      \n                                      {activeTab === 'receipt' && (\n                                        <>\n                                          {canReceiptCheck ? (\n                                            actualReceivedAction.isCompleted(item) ? (\n                                              <button\n                                                onClick={() => {\n                                                  actualReceivedAction.handleCancel(item.id, {\n                                                    item_name: item.item_name,\n                                                    specification: item.specification,\n                                                    quantity: item.quantity,\n                                                    unit_price_value: item.unit_price_value,\n                                                    amount_value: item.amount_value,\n                                                    remark: item.remark\n                                                  })\n                                                }}\n                                                className=\"text-xs px-2 py-1 rounded button-action-primary\"\n                                              >\n                                                {actualReceivedAction.config.completedText}\n                                              </button>\n                                            ) : (\n                                              <DatePickerPopover\n                                                onDateSelect={(date) => {\n                                                  actualReceivedAction.handleConfirm(item.id, date, {\n                                                    item_name: item.item_name,\n                                                    specification: item.specification,\n                                                    quantity: item.quantity,\n                                                    unit_price_value: item.unit_price_value,\n                                                    amount_value: item.amount_value,\n                                                    remark: item.remark\n                                                  })\n                                                }}\n                                                placeholder=\"ì‹¤ì œ ì…ê³ ëœ ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”\"\n                                                align=\"center\"\n                                                side=\"bottom\"\n                                              >\n                                                <button className=\"text-xs px-2 py-1 rounded bg-gray-100 text-gray-600\">\n                                                  {actualReceivedAction.config.waitingText}\n                                                </button>\n                                              </DatePickerPopover>\n                                            )\n                                          ) : (\n                                            <span className={`text-xs px-2 py-1 rounded ${\n                                              actualReceivedAction.isCompleted(item)\n                                                ? 'button-action-primary' \n                                                : 'bg-gray-100 text-gray-400'\n                                            }`}>\n                                              {actualReceivedAction.isCompleted(item) ? actualReceivedAction.config.completedText : actualReceivedAction.config.waitingText}\n                                            </span>\n                                          )}\n                                        </>\n                                      )}\n                                      \n                                      {activeTab === 'done' && (\n                                        <>\n                                          {/* ì „ì²´ í•­ëª© íƒ­ì—ì„œëŠ” ì…ê³  ìƒíƒœë§Œ í‘œì‹œ (í´ë¦­ ë¶ˆê°€) */}\n                                          <span className={`button-base ${\n                                            actualReceivedAction.isCompleted(item)\n                                              ? 'bg-green-500 text-white' \n                                              : 'border border-gray-300 text-gray-600 bg-white'\n                                          }`}>\n                                            {actualReceivedAction.isCompleted(item) ? 'ì…ê³ ì™„ë£Œ' : 'ì…ê³ ëŒ€ê¸°'}\n                                          </span>\n                                        </>\n                                      )}\n                                      \n                                      {activeTab !== 'purchase' && activeTab !== 'receipt' && activeTab !== 'done' && (\n                                        <span className=\"text-xs text-gray-400\">-</span>\n                                      )}\n                                    </>\n                                  )}\n                                </div>\n                              </div>\n                            </div>\n                            \n                            {(item.remark || isEditing) && (\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">ë¹„ê³ :</span>\n                                {isEditing ? (\n                                  <Input\n                                    value={item.remark || ''}\n                                    onChange={(e) => handleItemChange(index, 'remark', e.target.value)}\n                                    className=\"modal-label border-gray-200 rounded-lg mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                    placeholder=\"ë¹„ê³ \"\n                                  />\n                                ) : (\n                                  <div className=\"modal-subtitle text-gray-500 mt-1\">{item.remark || '-'}</div>\n                                )}\n                              </div>\n                            )}\n                            \n                            {/* ëª¨ë°”ì¼ì—ì„œ ì‹¤ì œ ì…ê³  ë‚ ì§œ í‘œì‹œ */}\n                            {!isEditing && activeTab === 'receipt' && actualReceivedAction.getCompletedDate(item) && (\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">ì‹¤ì œì…ê³ ì¼:</span>\n                                <div className=\"mt-1\">\n                                  <div className=\"modal-subtitle text-green-700\">\n                                    {new Date(actualReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                                      year: 'numeric',\n                                      month: '2-digit',\n                                      day: '2-digit'\n                                    })}\n                                  </div>\n                                  <div className=\"text-[9px] text-gray-500\">\n                                    {new Date(actualReceivedAction.getCompletedDate(item)).toLocaleTimeString('ko-KR', {\n                                      hour: '2-digit',\n                                      minute: '2-digit'\n                                    })}\n                                  </div>\n                                </div>\n                              </div>\n                            )}\n\n                            {/* ëª¨ë°”ì¼ì—ì„œ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ í‘œì‹œ - ì „ì²´í•­ëª© íƒ­ì—ì„œë§Œ */}\n                            {!isEditing && activeTab === 'done' && (\n                              <div className=\"flex items-center justify-between\">\n                                <span className=\"text-gray-500 text-xs\">ê±°ë˜ëª…ì„¸ì„œ í™•ì¸:</span>\n                                <div className=\"flex items-center gap-2\">\n                                  {canReceiptCheck ? (\n                                    statementReceivedAction.isCompleted(item) ? (\n                                      <button\n                                        onClick={() => {\n                                          statementReceivedAction.handleCancel(item.id, {\n                                            item_name: item.item_name,\n                                            specification: item.specification,\n                                            quantity: item.quantity,\n                                            unit_price_value: item.unit_price_value,\n                                            amount_value: item.amount_value,\n                                            remark: item.remark\n                                          })\n                                        }}\n                                        className=\"text-xs px-2 py-1 rounded button-action-primary hover:bg-green-600 transition-colors\"\n                                        title=\"í´ë¦­í•˜ì—¬ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ì·¨ì†Œ\"\n                                      >\n                                        {statementReceivedAction.config.completedText}\n                                      </button>\n                                    ) : (\n                                      <DatePickerPopover\n                                        onDateSelect={(date) => {\n                                          statementReceivedAction.handleConfirm(item.id, date, {\n                                            item_name: item.item_name,\n                                            specification: item.specification,\n                                            quantity: item.quantity,\n                                            unit_price_value: item.unit_price_value,\n                                            amount_value: item.amount_value,\n                                            remark: item.remark\n                                          })\n                                        }}\n                                        placeholder=\"íšŒê³„ìƒ ì…ê³ ì¼ì„ ì„ íƒí•˜ì„¸ìš”\"\n                                        align=\"end\"\n                                        side=\"bottom\"\n                                      >\n                                        <button \n                                          className=\"text-xs px-2 py-1 rounded bg-gray-100 text-gray-600\"\n                                          onClick={() => {}}\n                                        >\n                                          {statementReceivedAction.config.waitingText}\n                                        </button>\n                                      </DatePickerPopover>\n                                    )\n                                  ) : (\n                                    <span className={`text-xs px-2 py-1 rounded ${\n                                      statementReceivedAction.isCompleted(item)\n                                        ? 'button-action-primary' \n                                        : 'bg-gray-100 text-gray-400'\n                                    }`}>\n                                      {statementReceivedAction.isCompleted(item) ? statementReceivedAction.config.completedText : statementReceivedAction.config.waitingText}\n                                    </span>\n                                  )}\n                                </div>\n                              </div>\n                            )}\n\n                            {/* ëª¨ë°”ì¼ì—ì„œ íšŒê³„ìƒ ì…ê³ ì¼ í‘œì‹œ - ì „ì²´í•­ëª© íƒ­ì—ì„œë§Œ */}\n                            {!isEditing && activeTab === 'done' && statementReceivedAction.getCompletedDate(item) && (\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">íšŒê³„ìƒ ì…ê³ ì¼:</span>\n                                <div className=\"mt-1\">\n                                  <div className=\"modal-subtitle text-blue-700\">\n                                    {new Date(statementReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                                      year: 'numeric',\n                                      month: '2-digit',\n                                      day: '2-digit'\n                                    })}\n                                  </div>\n                                </div>\n                              </div>\n                            )}\n                            {/* ëª¨ë°”ì¼ì—ì„œ ì²˜ë¦¬ì í‘œì‹œ - ì „ì²´í•­ëª© íƒ­ì—ì„œë§Œ */}\n                            {!isEditing && activeTab === 'done' && statementReceivedAction.getCompletedByName(item) && (\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">ì²˜ë¦¬ì:</span>\n                                <div className=\"mt-1\">\n                                  <div className=\"modal-subtitle text-gray-600\">\n                                    {statementReceivedAction.getCompletedByName(item)}\n                                  </div>\n                                </div>\n                              </div>\n                            )}\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                </div>\n                \n                {/* í•©ê³„ */}\n                <div className=\"bg-gray-50 px-2 sm:px-3 border-t border-gray-100\">\n                  <div className=\"hidden sm:grid items-center gap-3 py-0.5\" style={{\n                    gridTemplateColumns: getGridTemplateColumns()\n                  }}>\n                    {/* í’ˆëª©ëª… */}\n                    <div></div>\n                    {/* ê·œê²© */}\n                    <div></div>\n                    {/* ìˆ˜ëŸ‰ */}\n                    <div></div>\n                    {/* ë‹¨ê°€ */}\n                    <div className=\"text-right\">\n                      <span className=\"text-[12px] font-bold text-gray-900\">ì´ì•¡</span>\n                    </div>\n                    {/* í•©ê³„ */}\n                    <div className=\"text-right\">\n                      <span className=\"text-[12px] font-bold text-gray-900\">\n                        â‚©{formatCurrency(\n                          (isEditing ? editedItems : purchase.purchase_request_items)?.reduce((sum, item) => sum + (item.amount_value || 0), 0) || 0\n                        )}\n                      </span>\n                    </div>\n                    {/* ë‚˜ë¨¸ì§€ ì¹¼ëŸ¼ë“¤ */}\n                    <div></div>\n                    <div></div>\n                    {activeTab === 'receipt' && <div></div>}\n                  </div>\n                  \n                  {/* Mobile ì´ì•¡ */}\n                  <div className=\"block sm:hidden py-0.5\">\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-[13px] font-bold text-gray-900\">ì´ì•¡</span>\n                      <span className=\"text-[13px] font-bold text-gray-900\">\n                        â‚©{formatCurrency(\n                          (isEditing ? editedItems : purchase.purchase_request_items)?.reduce((sum, item) => sum + (item.amount_value || 0), 0) || 0\n                        )}\n                      </span>\n                    </div>\n                  </div>\n                </div>\n                \n                {/* í•­ëª© ì¶”ê°€ ë²„íŠ¼ */}\n                {isEditing && (\n                  <div className=\"p-2 sm:p-3 border-t border-gray-100\">\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={handleAddItem}\n                      className=\"w-full rounded-lg border-dashed border-2 border-gray-300 hover:border-gray-400 py-2 badge-text\"\n                    >\n                      <Plus className=\"w-4 h-4 mr-1\" />\n                      í•­ëª© ì¶”ê°€\n                    </Button>\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n      ) : (\n        <div className=\"text-center py-12\">\n          <span className=\"modal-subtitle\">\n            ë°œì£¼ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n          </span>\n        </div>\n      )}\n    </div>\n  )\n\n  // embeddedê°€ trueë©´ Dialog ì—†ì´ ë‚´ìš©ë§Œ ë°˜í™˜\n  if (embedded) {\n    return content\n  }\n\n  // embeddedê°€ falseë©´ Dialogë¡œ ê°ì‹¸ì„œ ë°˜í™˜\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent \n        className=\"overflow-hidden bg-white rounded-lg shadow-sm border-0 w-full sm:w-auto max-w-[calc(100vw-48px)] sm:max-w-[calc(100vw-80px)] lg:max-w-[90vw] xl:max-w-[85vw] h-[95vh] sm:h-auto sm:max-h-[90vh] lg:max-h-[85vh] sm:rounded-lg flex flex-col\" \n        showCloseButton={false}\n      >\n        <DialogHeader className=\"sr-only\">\n          <DialogTitle>ë°œì£¼ ìƒì„¸ ì •ë³´</DialogTitle>\n        </DialogHeader>\n        {/* Apple-style Header */}\n        <div className=\"relative px-3 sm:px-6 pt-0 sm:pt-3 lg:pt-4 pb-0 sm:pb-2 lg:pb-3 flex-shrink-0\">\n          <button\n            onClick={onClose}\n            className=\"button-base button-action-secondary absolute right-3 sm:right-6 top-0 sm:top-3 lg:top-4 w-6 h-6 sm:w-8 sm:h-8 rounded-full\"\n          >\n            <X className=\"w-4 h-4 text-gray-500\" />\n          </button>\n          \n          <div className=\"pr-8 sm:pr-16\">\n            <div className=\"flex items-start gap-4 mb-0 sm:mb-3\">\n              <div className=\"min-w-0 flex-1\">\n                <h1 className=\"page-title mb-0 sm:mb-1\">\n                  ë°œì£¼ ê¸°ë³¸ì •ë³´\n                </h1>\n              </div>\n              <div className=\"flex items-center gap-3\">\n                {!isEditing && canEdit && (\n                  <>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => handleEditToggle(true)}\n                      className=\"button-base button-action-secondary\"\n                    >\n                      <Edit2 className=\"w-4 h-4 mr-2\" />\n                      ìˆ˜ì •\n                    </Button>\n                    {canDelete && onDelete && (\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={async () => {\n                          if (purchase) {\n                            try {\n                              logger.debug('ë°œì£¼ ì‚­ì œ ì‹œì‘', { purchaseOrderNumber: purchase.purchase_order_number });\n                              await onDelete(purchase);\n                              logger.debug('ë°œì£¼ ì‚­ì œ ì™„ë£Œ - ëª¨ë‹¬ ë‹«ê¸° ë° ìƒˆë¡œê³ ì¹¨ ì§„í–‰');\n                              \n                              // ì‚­ì œ í›„ ëª¨ë‹¬ ë‹«ê¸° ë° ìƒˆë¡œê³ ì¹¨\n                              onClose();\n                              if (onRefresh) {\n                                await onRefresh(true); // ê°•ì œ ìƒˆë¡œê³ ì¹¨\n                                logger.debug('ìƒìœ„ ì»´í¬ë„ŒíŠ¸ ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ');\n                              }\n                            } catch (error) {\n                              logger.error('ë°œì£¼ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ', error);\n                              toast.error('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');\n                            }\n                          }\n                        }}\n                        className=\"button-base button-action-danger\"\n                      >\n                        <Trash2 className=\"w-4 h-4 mr-2\" />\n                        ì‚­ì œ\n                      </Button>\n                    )}\n                  </>\n                )}\n                {isEditing && (\n                  <>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => {\n                        handleEditToggle(false)\n                        setEditedPurchase(purchase)\n                        setEditedItems(purchase?.items || [])\n                        setDeletedItemIds([])\n                      }}\n                      className=\"button-base button-action-secondary\"\n                    >\n                      <X className=\"w-4 h-4 mr-2\" />\n                      ì·¨ì†Œ\n                    </Button>\n                    <Button\n                      size=\"sm\"\n                      onClick={handleSave}\n                      className=\"button-base button-action-primary\"\n                    >\n                      <Save className=\"w-4 h-4 mr-2\" />\n                      ì €ì¥\n                    </Button>\n                  </>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Apple-style Content */}\n        <div className=\"overflow-y-auto flex-1 px-3 sm:px-6 pb-1 sm:pb-6 mt-0\">\n          {content}\n        </div>\n      </DialogContent>\n      \n    </Dialog>\n  )\n}\n\nexport default memo(PurchaseDetailModal)"],"names":["Truck","createLucideIcon","d","key","cx","cy","r","DatePickerPopover","children","onDateSelect","disabled","placeholder","align","side","open","setOpen","useState","jsxs","Popover","onOpenChange","jsx","PopoverTrigger","asChild","PopoverContent","className","sideOffset","Calendar","mode","selected","onSelect","date","logger","debug","isToday","Date","toDateString","dateValue","getTime","todayValue","dateString","todayString","handleDateSelect","locale","ko","initialFocus","fromDate","toDate","defaultMonth","modifiers","today","modifiersClassNames","useConfirmDateAction","config","currentUserName","canPerformAction","onUpdate","onOptimisticUpdate","supabase","createClient","handleConfirm","useCallback","async","itemId","selectedDate","itemInfo","warn","toast","error","field","numericId","Number","isNaN","confirmMessage","item_name","specification","quantity","toLocaleString","unit_price_value","amount_value","remark","confirm","window","updateData","is_statement_received","statement_received_date","toISOString","statement_received_by_name","actual_received_date","data","from","update","eq","select","info","action","success","successMessage","handleCancel","cancel","itemName","isCompleted","item","getCompletedDate","getCompletedByName","PurchaseDetailModal$1","memo","purchaseId","isOpen","onClose","embedded","currentUserRoles","activeTab","onRefresh","onDelete","loading","setLoading","purchase","setPurchase","isEditing","setIsEditing","editedPurchase","setEditedPurchase","editedItems","setEditedItems","deletedItemIds","setDeletedItemIds","userRoles","setUserRoles","setCurrentUserName","columnWidths","setColumnWidths","tableMinWidth","useMemo","length","columnGap","padding","total","reduce","sum","width","Math","max","baseColumns","push","headerRowRef","useRef","useEffect","supabaseUrl","includes","user","auth","getUser","employeeData","id","maybeSingle","email","employeeByEmail","name","purchase_role","roles","Array","isArray","map","String","trim","split","filter","loadUserRoles","effectiveRoles","canEditAll","canEditLimited","canEdit","canDelete","final_manager_status","requester_name","canPurchase","canReceiveItems","isAdmin","isRequester","canReceiptCheck","refreshModalData","single","sortedItems","purchase_request_items","sort","a","b","line_number","purchaseData","items","vendor","vendors","vendor_name","vendor_contacts","isInitialLoad","setIsInitialLoad","purchaseIdNumber","NaN","handleActualReceiptOptimisticUpdate","itemIdStr","nowIso","selectedDateIso","updateItems","is_received","received_at","prev","updatedItems","completed","allReceived","prevItems","prevPurchase","handleStatementReceivedOptimisticUpdate","nextAllCompleted","nextStatementAt","every","statement_received_at","allCompleted","then","statementReceivedAction","completedText","waitingText","actualReceivedAction","requesterName","canApproveMiddle","canApproveFinal","approvalButtonClass","approvalWaitingPillClass","purchaseOrderNumber","purchase_order_number","middleManagerStatus","middle_manager_status","finalManagerStatus","loadPurchaseDetail","toString","calculateOptimalColumnWidths","columnConfigs","minWidth","maxWidth","baseWidth","calculatedWidths","index","maxLength","headers","baseHeaders","getHeaders","forEach","cellValue","getStatusDisplay","formatDate","is_utk_checked","adjustedLength","acc","char","test","ceil","calculatedWidth","min","range","is_payment_completed","getGridTemplateColumns","join","handleEditToggle","editing","formatCurrency","amount","Intl","NumberFormat","format","handleItemChange","value","newItems","unitPrice","handleRemoveItem","_","i","handlePaymentToggle","targetItem","find","unit","payment_completed_at","payment_completed_by_name","refreshResult","silent","Promise","handleApprove","type","approvalType","content","payment_category","category","getStatusBadge","request_date","shouldShow","Button","size","variant","onClick","Check","X","FileText","Input","request_type","onChange","e","target","delivery_request_date","formatDateInput","revised_delivery_request_date","Building2","contact_name","updatedContacts","project_vendor","project_item","order_number","Package","Fragment","CreditCard","applyOptimisticUpdate","is","formattedDate","toLocaleDateString","year","month","day","CheckCircle","style","ref","gridTemplateColumns","Trash2","title","isChecked","checked","allChecked","updateError","handleUtkToggle","toLocaleTimeString","hour","minute","newItem","lineNum","Plus","Dialog","DialogContent","showCloseButton","DialogHeader","DialogTitle","Edit2","editedItemsCount","deletedItemsCount","totalAmount","total_amount","updated_at","deleteError","delete","in","count","Error","unit_price_currency","currency","amount_currency","insertData","purchase_request_id","indexOf","created_at","insert","errorMessage","message","Save"],"mappings":"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","x_google_ignoreList":[0]}