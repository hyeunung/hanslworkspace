{"version":3,"file":"ReceiptsMain-DBUE7XH1.js","sources":["../../node_modules/lucide-react/dist/esm/icons/funnel.js","../../node_modules/lucide-react/dist/esm/icons/images.js","../../node_modules/lucide-react/dist/esm/icons/printer.js","../../src/hooks/useReceiptPermissions.ts","../../src/components/receipts/ReceiptDetailModal.tsx","../../src/components/receipts/MobileReceiptCard.tsx","../../src/components/receipts/ReceiptUploadModal.tsx","../../src/utils/receipt.ts","../../src/components/receipts/ReceiptsMain.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z\",\n      key: \"sc7q7i\"\n    }\n  ]\n];\nconst Funnel = createLucideIcon(\"funnel\", __iconNode);\n\nexport { __iconNode, Funnel as default };\n//# sourceMappingURL=funnel.js.map\n","/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"m22 11-1.296-1.296a2.4 2.4 0 0 0-3.408 0L11 16\", key: \"9kzy35\" }],\n  [\"path\", { d: \"M4 8a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2\", key: \"1t0f0t\" }],\n  [\"circle\", { cx: \"13\", cy: \"7\", r: \"1\", fill: \"currentColor\", key: \"1obus6\" }],\n  [\"rect\", { x: \"8\", y: \"2\", width: \"14\", height: \"14\", rx: \"2\", key: \"1gvhby\" }]\n];\nconst Images = createLucideIcon(\"images\", __iconNode);\n\nexport { __iconNode, Images as default };\n//# sourceMappingURL=images.js.map\n","/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2\",\n      key: \"143wyd\"\n    }\n  ],\n  [\"path\", { d: \"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6\", key: \"1itne7\" }],\n  [\"rect\", { x: \"6\", y: \"14\", width: \"12\", height: \"8\", rx: \"1\", key: \"1ue0tg\" }]\n];\nconst Printer = createLucideIcon(\"printer\", __iconNode);\n\nexport { __iconNode, Printer as default };\n//# sourceMappingURL=printer.js.map\n","import { useState, useEffect } from 'react';\nimport { createClient } from '@/lib/supabase/client';\nimport type { ReceiptPermissions, UserRole } from '@/types/receipt';\n\n/**\n * ì˜ìˆ˜ì¦ ê´€ë¦¬ ê¶Œí•œì„ ê´€ë¦¬í•˜ëŠ” React Hook\n * \n * ì‚¬ìš©ìì˜ ì—­í• (role)ì— ë”°ë¼ ì˜ìˆ˜ì¦ ê´€ë ¨ ê¶Œí•œì„ ê³„ì‚°í•˜ê³  ì œê³µí•©ë‹ˆë‹¤.\n * \n * @returns {Object} ê¶Œí•œ ì •ë³´ì™€ ê´€ë ¨ ìƒíƒœ\n * @returns {ReceiptPermissions} permissions - ê¶Œí•œ ê°ì²´\n * @returns {UserRole | null} userRole - ì‚¬ìš©ì ì—­í• \n * @returns {boolean} loading - ê¶Œí•œ ë¡œë”© ìƒíƒœ\n * @returns {Function} refreshPermissions - ê¶Œí•œ ìƒˆë¡œê³ ì¹¨ í•¨ìˆ˜\n * \n * @example\n * ```tsx\n * const { permissions, userRole, loading } = useReceiptPermissions();\n * \n * if (loading) return <div>ë¡œë”© ì¤‘...</div>;\n * \n * return (\n *   <div>\n *     {permissions.canUpload && <UploadButton />}\n *     {permissions.canDelete && <DeleteButton />}\n *   </div>\n * );\n * ```\n */\nexport function useReceiptPermissions() {\n  const [permissions, setPermissions] = useState<ReceiptPermissions>({\n    canView: false,\n    canUpload: false,\n    canDownload: false,\n    canPrint: false,\n    canDelete: false,\n    canViewUploaderInfo: false,\n  });\n  const [userRole, setUserRole] = useState<UserRole | null>(null);\n  const [loading, setLoading] = useState(true);\n\n  const supabase = createClient();\n\n  const checkPermissions = async () => {\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) {\n        setLoading(false);\n        return;\n      }\n\n      const { data: employee } = await supabase\n        .from('employees')\n        .select('purchase_role')\n        .eq('email', user.email)\n        .single();\n\n      const role = employee?.purchase_role || '';\n      setUserRole(role);\n\n      // ê¶Œí•œ ê³„ì‚°\n      const isAppAdmin = role.includes('app_admin');\n      const isHr = role.includes('hr');\n      const isLeadBuyer = role.includes('lead buyer');\n      \n      // ì˜ìˆ˜ì¦ ê´€ë¦¬ ì ‘ê·¼ ê°€ëŠ¥ ê¶Œí•œ\n      const hasReceiptAccess = isAppAdmin || isHr || isLeadBuyer;\n\n      setPermissions({\n        canView: hasReceiptAccess,\n        canUpload: hasReceiptAccess,\n        canDownload: hasReceiptAccess,\n        canPrint: hasReceiptAccess,\n        canDelete: isAppAdmin, // ì˜¤ì§ app_adminë§Œ\n        canViewUploaderInfo: isAppAdmin, // ì˜¤ì§ app_adminë§Œ\n      });\n    } catch (error) {\n      console.error('ì˜ìˆ˜ì¦ ê¶Œí•œ í™•ì¸ ì‹¤íŒ¨', error)\n      setUserRole(null)\n      setPermissions({\n        canView: false,\n        canUpload: false,\n        canDownload: false,\n        canPrint: false,\n        canDelete: false,\n        canViewUploaderInfo: false,\n      })\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    checkPermissions();\n  }, []);\n\n  return {\n    permissions,\n    userRole,\n    loading,\n    refreshPermissions: checkPermissions,\n  };\n}","import { useState, useEffect, useCallback } from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Download, X, ZoomIn, ZoomOut, RotateCcw, Printer, Trash2, ChevronLeft, ChevronRight } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { createClient } from \"@/lib/supabase/client\";\nimport { useReceiptPermissions } from \"@/hooks/useReceiptPermissions\";\nimport type { ReceiptItem } from \"@/types/receipt\";\nimport { logger } from \"@/lib/logger\";\n\ninterface ReceiptDetailModalProps {\n  receipt: ReceiptItem;\n  groupReceipts?: ReceiptItem[];\n  isOpen: boolean;\n  onClose: () => void;\n  onDelete?: () => void;\n}\n\nexport default function ReceiptDetailModal({ receipt, groupReceipts, isOpen, onClose, onDelete }: ReceiptDetailModalProps) {\n  const allReceipts = groupReceipts && groupReceipts.length > 0 ? groupReceipts : [receipt];\n  const [currentIndex, setCurrentIndex] = useState(0);\n  const [imageScale, setImageScale] = useState(1);\n  const [imageRotation, setImageRotation] = useState(0);\n  const [imageError, setImageError] = useState(false);\n  const [deleting, setDeleting] = useState(false);\n  const [imageDimensions, setImageDimensions] = useState({ width: 0, height: 0 });\n  const [imageLoaded, setImageLoaded] = useState(false);\n  \n  const supabase = createClient();\n  const { permissions } = useReceiptPermissions();\n\n  const currentReceipt = allReceipts[currentIndex] || receipt;\n  const hasMultiple = allReceipts.length > 1;\n\n  useEffect(() => {\n    if (isOpen) {\n      setCurrentIndex(0);\n      setImageScale(1);\n      setImageRotation(0);\n      setImageError(false);\n      setImageLoaded(false);\n    }\n  }, [isOpen]);\n\n  useEffect(() => {\n    setImageScale(1);\n    setImageRotation(0);\n    setImageError(false);\n    setImageLoaded(false);\n  }, [currentIndex]);\n\n  const goNext = useCallback(() => {\n    if (currentIndex < allReceipts.length - 1) setCurrentIndex(prev => prev + 1);\n  }, [currentIndex, allReceipts.length]);\n\n  const goPrev = useCallback(() => {\n    if (currentIndex > 0) setCurrentIndex(prev => prev - 1);\n  }, [currentIndex]);\n\n  useEffect(() => {\n    if (!isOpen || !hasMultiple) return;\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key === 'ArrowLeft') goPrev();\n      if (e.key === 'ArrowRight') goNext();\n    };\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [isOpen, hasMultiple, goPrev, goNext]);\n\n  const handleDownload = async () => {\n    try {\n      const url = new URL(currentReceipt.receipt_image_url);\n      const pathSegments = url.pathname.split('/');\n      const bucketIndex = pathSegments.indexOf('receipt-images');\n      \n      if (bucketIndex === -1) {\n        throw new Error('ì˜ëª»ëœ ì˜ìˆ˜ì¦ URLì…ë‹ˆë‹¤');\n      }\n      \n      const filePath = pathSegments.slice(bucketIndex + 1).join('/');\n\n      const { data, error } = await supabase.storage\n        .from('receipt-images')\n        .download(filePath);\n\n      if (error) throw error;\n\n      const blob = new Blob([data], { type: 'image/jpeg' });\n      const downloadUrl = window.URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = downloadUrl;\n      a.download = currentReceipt.file_name || `ì˜ìˆ˜ì¦_${currentReceipt.id}.jpg`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      window.URL.revokeObjectURL(downloadUrl);\n      \n      toast.success('ì˜ìˆ˜ì¦ ì´ë¯¸ì§€ê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');\n    } catch (error) {\n      logger.error('ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜', error);\n      toast.error('ë‹¤ìš´ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n    }\n  };\n\n  const handleZoomIn = () => setImageScale(prev => Math.min(prev + 0.25, 3));\n  const handleZoomOut = () => setImageScale(prev => Math.max(prev - 0.25, 0.5));\n  const handleRotate = () => setImageRotation(prev => (prev + 90) % 360);\n\n  const handleImageLoad = (e: React.SyntheticEvent<HTMLImageElement>) => {\n    const img = e.currentTarget;\n    setImageDimensions({ width: img.naturalWidth, height: img.naturalHeight });\n    setImageLoaded(true);\n  };\n\n  const getOptimalImageStyle = () => {\n    if (!imageLoaded) return { width: '100%', height: '100vh' };\n    \n    const containerWidth = window.innerWidth - 64;\n    const containerHeight = window.innerHeight;\n    \n    const widthRatio = containerWidth / imageDimensions.width;\n    const heightRatio = containerHeight / imageDimensions.height;\n    const optimalRatio = Math.min(widthRatio, heightRatio);\n    \n    return {\n      width: `${imageDimensions.width * optimalRatio}px`,\n      height: `${imageDimensions.height * optimalRatio}px`,\n    };\n  };\n\n  const markAllAsPrinted = useCallback(async () => {\n    try {\n      const { data: { user }, error: authError } = await supabase.auth.getUser();\n      if (authError || !user) {\n        toast.error('ì‚¬ìš©ì ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n        return;\n      }\n\n      const { data: employee, error: empError } = await supabase\n        .from('employees')\n        .select('name, purchase_role')\n        .eq('email', user.email)\n        .single();\n\n      if (empError) {\n        toast.error('ì§ì› ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');\n        return;\n      }\n\n      const role = employee?.purchase_role || '';\n      const hasPermission = role.includes('app_admin') || role.includes('hr') || role.includes('lead buyer');\n      \n      if (!hasPermission) {\n        toast.error('ì¸ì‡„ì™„ë£Œ ì²˜ë¦¬ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');\n        return;\n      }\n\n      const updateData = {\n        is_printed: true,\n        printed_at: new Date().toISOString(),\n        printed_by: user.id,\n        printed_by_name: employee?.name || user.email\n      };\n\n      const receiptIds = allReceipts.map(r => r.id);\n      const { error: updateError } = await supabase\n        .from('purchase_receipts')\n        .update(updateData)\n        .in('id', receiptIds);\n\n      if (updateError) {\n        logger.error('ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', updateError);\n        toast.error(`ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: ${updateError.message}`);\n        return;\n      }\n\n      toast.success('ì¸ì‡„ ì™„ë£Œë¡œ í‘œì‹œë˜ì—ˆìŠµë‹ˆë‹¤.');\n      if (onDelete) onDelete();\n    } catch (error) {\n      const errorObj = error as any;\n      logger.error('ì¸ì‡„ì™„ë£Œ ì²˜ë¦¬ ì˜ˆì™¸', errorObj);\n      toast.error(`ì¸ì‡„ ì™„ë£Œ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${errorObj?.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);\n    }\n  }, [supabase, allReceipts, onClose, onDelete]);\n\n  const handlePrint = useCallback(() => {\n    const imageUrls = allReceipts\n      .filter(r => r.receipt_image_url)\n      .map(r => r.receipt_image_url);\n\n    if (imageUrls.length === 0) return;\n\n    const printWindow = window.open('', '_blank');\n    if (!printWindow) {\n      toast.error('íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.');\n      return;\n    }\n\n    const imagesHtml = imageUrls.map((url, i) => {\n      const isLast = i === imageUrls.length - 1;\n      return `<div class=\"page${isLast ? '' : ' page-break'}\"><img src=\"${url}\" alt=\"\" class=\"receipt-image\" onload=\"onImgLoad()\" onerror=\"onImgError()\" /></div>`;\n    }).join('\\n');\n\n    printWindow.document.write(`\n      <!DOCTYPE html>\n      <html><head><title></title>\n      <style>\n        *{margin:0;padding:0;box-sizing:border-box;}\n        body{background:white;}\n        .page{display:flex;justify-content:center;align-items:center;min-height:100vh;}\n        .page-break{page-break-after:always;}\n        .receipt-image{max-width:100%;max-height:100vh;object-fit:contain;}\n        @media print{\n          @page{margin:0;size:auto;}\n          body{margin:0;padding:0;}\n          .page{min-height:auto;}\n          .page-break{page-break-after:always;}\n          .receipt-image{max-width:100%;max-height:100%;width:auto;height:auto;}\n        }\n      </style>\n      <script>\n        var loaded=0,total=${imageUrls.length};\n        function onImgLoad(){loaded++;if(loaded>=total)setTimeout(function(){window.print();window.close();},200);}\n        function onImgError(){loaded++;if(loaded>=total){alert('ì¼ë¶€ ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');window.close();}}\n      </script>\n      </head><body>${imagesHtml}</body></html>\n    `);\n    printWindow.document.close();\n\n    setTimeout(() => {\n      if (confirm('ì¸ì‡„ë¥¼ ì™„ë£Œí•˜ì…¨ìŠµë‹ˆê¹Œ?')) {\n        onClose();\n        markAllAsPrinted();\n      }\n    }, 1000);\n  }, [allReceipts, markAllAsPrinted, onClose]);\n\n  const handleDelete = useCallback(async () => {\n    if (!permissions.canDelete) {\n      toast.error('ì‚­ì œ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');\n      return;\n    }\n\n    const countText = allReceipts.length > 1 ? `${allReceipts.length}ì¥ì˜ ì˜ìˆ˜ì¦ì„` : 'ì´ ì˜ìˆ˜ì¦ì„';\n    if (!confirm(`ì •ë§ë¡œ ${countText} ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {\n      return;\n    }\n\n    try {\n      setDeleting(true);\n\n      for (const r of allReceipts) {\n        const url = new URL(r.receipt_image_url);\n        const pathSegments = url.pathname.split('/');\n        const bucketIndex = pathSegments.indexOf('receipt-images');\n        \n        if (bucketIndex !== -1) {\n          const filePath = pathSegments.slice(bucketIndex + 1).join('/');\n          const { error: storageError } = await supabase.storage\n            .from('receipt-images')\n            .remove([filePath]);\n          if (storageError) {\n            logger.warn('ìŠ¤í† ë¦¬ì§€ íŒŒì¼ ì‚­ì œ ì‹¤íŒ¨', { error: storageError });\n          }\n        }\n\n        const { error: dbError } = await supabase\n          .from('purchase_receipts')\n          .delete()\n          .eq('id', r.id);\n\n        if (dbError) throw dbError;\n      }\n\n      toast.success('ì˜ìˆ˜ì¦ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');\n      onClose();\n      if (onDelete) onDelete();\n    } catch (error) {\n      logger.error('ì‚­ì œ ì˜¤ë¥˜', error);\n      toast.error('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n    } finally {\n      setDeleting(false);\n    }\n  }, [permissions.canDelete, allReceipts, onClose, onDelete, supabase]);\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"w-[100vw] max-w-none h-[100vh] p-0 overflow-hidden m-0 border-0 rounded-none\">\n        <DialogHeader className=\"sr-only\">\n          <DialogTitle>ì˜ìˆ˜ì¦ ìƒì„¸ ë³´ê¸°</DialogTitle>\n        </DialogHeader>\n        <div className=\"flex h-full\">\n          {/* ì´ë¯¸ì§€ ì˜ì—­ */}\n          <div className=\"flex-1 bg-white relative overflow-hidden\">\n            <div className=\"absolute inset-0 flex items-center justify-center\">\n              <img\n                src={currentReceipt.receipt_image_url}\n                alt=\"ì˜ìˆ˜ì¦\"\n                className=\"object-contain\"\n                style={{\n                  ...getOptimalImageStyle(),\n                  transform: `scale(${imageScale}) rotate(${imageRotation}deg)`,\n                  transformOrigin: 'center'\n                }}\n                onLoad={handleImageLoad}\n                onError={() => setImageError(true)}\n              />\n            </div>\n            \n            {/* ë‹«ê¸° ë²„íŠ¼ */}\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={onClose}\n              className=\"absolute top-4 left-4 h-10 w-10 p-0 bg-gray-900/80 hover:bg-gray-900 text-white rounded-full\"\n            >\n              <X className=\"h-5 w-5\" />\n            </Button>\n\n            {/* í˜ì´ì§€ ì¸ë””ì¼€ì´í„° */}\n            {hasMultiple && (\n              <div className=\"absolute top-4 left-1/2 transform -translate-x-1/2 bg-gray-900/80 text-white rounded-full px-3 py-1.5\">\n                <span className=\"text-[11px] font-medium\">{currentIndex + 1} / {allReceipts.length}</span>\n              </div>\n            )}\n\n            {/* ì¢Œìš° ë„¤ë¹„ê²Œì´ì…˜ */}\n            {hasMultiple && currentIndex > 0 && (\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={goPrev}\n                className=\"absolute left-4 top-1/2 -translate-y-1/2 h-12 w-12 p-0 bg-gray-900/60 hover:bg-gray-900/80 text-white rounded-full\"\n              >\n                <ChevronLeft className=\"h-6 w-6\" />\n              </Button>\n            )}\n            {hasMultiple && currentIndex < allReceipts.length - 1 && (\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={goNext}\n                className=\"absolute right-20 top-1/2 -translate-y-1/2 h-12 w-12 p-0 bg-gray-900/60 hover:bg-gray-900/80 text-white rounded-full\"\n              >\n                <ChevronRight className=\"h-6 w-6\" />\n              </Button>\n            )}\n\n            {/* ì´ë¯¸ì§€ ì»¨íŠ¸ë¡¤ */}\n            <div className=\"absolute bottom-4 left-1/2 transform -translate-x-1/2 bg-gray-900/80 rounded-full px-4 py-2\">\n              <div className=\"flex items-center gap-2 text-white\">\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={handleZoomOut}\n                  disabled={imageScale <= 0.5}\n                  className=\"h-7 w-7 p-0 text-white hover:bg-white/20\"\n                >\n                  <ZoomOut className=\"w-4 h-4\" />\n                </Button>\n                <span className=\"modal-subtitle min-w-[40px] text-center\">\n                  {Math.round(imageScale * 100)}%\n                </span>\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={handleZoomIn}\n                  disabled={imageScale >= 3}\n                  className=\"h-7 w-7 p-0 text-white hover:bg-white/20\"\n                >\n                  <ZoomIn className=\"w-4 h-4\" />\n                </Button>\n                <div className=\"w-px h-4 bg-white/30 mx-1\" />\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={handleRotate}\n                  className=\"h-7 w-7 p-0 text-white hover:bg-white/20\"\n                >\n                  <RotateCcw className=\"w-4 h-4\" />\n                </Button>\n              </div>\n            </div>\n\n            {/* ì¸ë„¤ì¼ ìŠ¤íŠ¸ë¦½ (ì—¬ëŸ¬ ì¥ì¼ ë•Œë§Œ) */}\n            {hasMultiple && (\n              <div className=\"absolute bottom-16 left-1/2 transform -translate-x-1/2 bg-gray-900/80 rounded-lg px-2 py-1.5 flex items-center gap-1.5\">\n                {allReceipts.map((r, i) => (\n                  <button\n                    key={r.id}\n                    onClick={() => setCurrentIndex(i)}\n                    className={`w-10 h-10 rounded overflow-hidden border-2 transition-all ${\n                      i === currentIndex ? 'border-white scale-110' : 'border-transparent opacity-60 hover:opacity-100'\n                    }`}\n                  >\n                    <img src={r.receipt_image_url} alt=\"\" className=\"w-full h-full object-cover\" />\n                  </button>\n                ))}\n              </div>\n            )}\n          </div>\n\n          {/* ìš°ì¸¡ ì„¸ë¡œ íƒ­ë°” */}\n          <div className=\"w-16 bg-gray-900 flex flex-col items-center justify-center space-y-4\">\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={handlePrint}\n              className=\"w-10 h-10 p-0 text-white hover:bg-gray-700 rounded-lg relative\"\n              title={hasMultiple ? `${allReceipts.length}ì¥ ì¸ì‡„` : 'ì¸ì‡„'}\n            >\n              <Printer className=\"w-6 h-6\" />\n              {hasMultiple && (\n                <span className=\"absolute -top-1 -right-1 bg-blue-500 text-white text-[8px] w-4 h-4 rounded-full flex items-center justify-center font-bold\">\n                  {allReceipts.length}\n                </span>\n              )}\n            </Button>\n            \n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={handleDownload}\n              className=\"w-10 h-10 p-0 text-white hover:bg-gray-700 rounded-lg\"\n              title=\"ë‹¤ìš´ë¡œë“œ\"\n            >\n              <Download className=\"w-6 h-6\" />\n            </Button>\n\n            {permissions.canDelete && (\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={handleDelete}\n                disabled={deleting}\n                className=\"w-10 h-10 p-0 text-white hover:bg-red-600 rounded-lg\"\n                title=\"ì‚­ì œ\"\n              >\n                {deleting ? (\n                  <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\n                ) : (\n                  <Trash2 className=\"w-6 h-6\" />\n                )}\n              </Button>\n            )}\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","import { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Printer, Download, Calendar, User, FileText, Trash2, Images } from \"lucide-react\";\nimport type { ReceiptItem } from \"@/types/receipt\";\nimport { formatDate, formatFileSize } from \"@/utils/helpers\";\n\ninterface MobileReceiptCardProps {\n  receipt: ReceiptItem;\n  groupCount?: number;\n  onView: (receipt: ReceiptItem) => void;\n  onPrint: (receipt: ReceiptItem) => void;\n  onDownload: (receipt: ReceiptItem) => void;\n  onDelete?: (receipt: ReceiptItem) => void;\n}\n\nexport default function MobileReceiptCard({ receipt, groupCount = 1, onView, onPrint, onDownload, onDelete }: MobileReceiptCardProps) {\n  return (\n    <Card className=\"w-full border border-gray-200 hover:shadow-md transition-shadow cursor-pointer\" onClick={() => onView(receipt)}>\n      <CardContent className=\"p-4\">\n        <div className=\"space-y-3\">\n          {/* ìƒë‹¨: ì¸ì‡„ ìƒíƒœ + ì—…ë¡œë“œì¼ */}\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-1.5\">\n              {receipt.is_printed ? (\n                <span className=\"badge-stats bg-green-100 text-green-700 badge-text\">\n                  âœ“ ì¸ì‡„ì™„ë£Œ\n                </span>\n              ) : (\n                <span className=\"badge-stats bg-gray-100 text-gray-600 badge-text\">\n                  ë¯¸ì™„ë£Œ\n                </span>\n              )}\n              {groupCount > 1 && (\n                <span className=\"inline-flex items-center gap-0.5 badge-stats bg-blue-100 text-blue-700 badge-text\">\n                  <Images className=\"w-3 h-3\" />\n                  {groupCount}ì¥\n                </span>\n              )}\n            </div>\n            <div className=\"flex items-center gap-1 badge-text text-gray-500\">\n              <Calendar className=\"w-3 h-3\" />\n              <span>{formatDate(receipt.uploaded_at)}</span>\n            </div>\n          </div>\n\n          {/* íŒŒì¼ëª… */}\n          <div className=\"flex items-center gap-2\">\n            <FileText className=\"w-4 h-4 text-hansl-600\" />\n            <span className=\"card-title text-gray-900\">\n              {receipt.file_name}\n            </span>\n          </div>\n\n          {/* ë©”ëª¨ */}\n          {receipt.memo && (\n            <div className=\"card-subtitle text-gray-900 bg-gray-50 rounded p-2\">\n              {receipt.memo}\n            </div>\n          )}\n\n          {/* ì—…ë¡œë“œ ì •ë³´ */}\n          <div className=\"flex items-center justify-between card-subtitle\">\n            <div className=\"flex items-center gap-1 text-gray-600\">\n              <User className=\"w-3 h-3\" />\n              <span>{receipt.uploaded_by_name || receipt.uploaded_by}</span>\n            </div>\n            <span className=\"text-gray-500\">{formatFileSize(receipt.file_size)}</span>\n          </div>\n\n          {/* ì•¡ì…˜ ë²„íŠ¼ */}\n          <div className={`flex gap-2 pt-2 border-t border-gray-100 ${onDelete ? 'grid grid-cols-3' : 'grid grid-cols-2'}`}>\n            <Button\n              size=\"sm\"\n              variant=\"outline\"\n              onClick={(e) => {\n                e.stopPropagation();\n                onPrint(receipt);\n              }}\n              className=\"flex-1\"\n            >\n              <Printer className=\"w-4 h-4 mr-1\" />\n              ì¸ì‡„{groupCount > 1 ? ` (${groupCount})` : ''}\n            </Button>\n            <Button\n              size=\"sm\"\n              variant=\"outline\"\n              onClick={(e) => {\n                e.stopPropagation();\n                onDownload(receipt);\n              }}\n              className=\"flex-1\"\n            >\n              <Download className=\"w-4 h-4 mr-1\" />\n              ë‹¤ìš´ë¡œë“œ\n            </Button>\n            {onDelete && (\n              <Button\n                size=\"sm\"\n                variant=\"outline\"\n                onClick={(e) => {\n                  e.stopPropagation();\n                  onDelete(receipt);\n                }}\n                className=\"flex-1 border-red-200 text-red-600 hover:bg-red-50\"\n              >\n                <Trash2 className=\"w-4 h-4 mr-1\" />\n                ì‚­ì œ\n              </Button>\n            )}\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","import { useState, useCallback } from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Upload, X, Plus } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { createClient } from \"@/lib/supabase/client\";\nimport { useReceiptPermissions } from \"@/hooks/useReceiptPermissions\";\n\ninterface ReceiptUploadModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSuccess: () => void;\n}\n\ninterface FileWithPreview {\n  file: File;\n  preview: string;\n  id: string;\n}\n\nexport default function ReceiptUploadModal({ isOpen, onClose, onSuccess }: ReceiptUploadModalProps) {\n  const [files, setFiles] = useState<FileWithPreview[]>([]);\n  const [memo, setMemo] = useState(\"\");\n  const [uploading, setUploading] = useState(false);\n  const [dragOver, setDragOver] = useState(false);\n  \n  const supabase = createClient();\n  const { permissions } = useReceiptPermissions();\n\n  const validateAndAddFile = useCallback((selectedFile: File) => {\n    if (!selectedFile.type.startsWith('image/')) {\n      toast.error('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');\n      return;\n    }\n\n    if (selectedFile.size > 10 * 1024 * 1024) {\n      toast.error('íŒŒì¼ í¬ê¸°ëŠ” 10MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.');\n      return;\n    }\n\n    const preview = URL.createObjectURL(selectedFile);\n    const newFile: FileWithPreview = {\n      file: selectedFile,\n      preview,\n      id: crypto.randomUUID(),\n    };\n\n    setFiles(prev => [...prev, newFile]);\n  }, []);\n\n  const handleFileSelect = useCallback((selectedFiles: FileList | File[]) => {\n    const fileArray = Array.from(selectedFiles);\n    fileArray.forEach(f => validateAndAddFile(f));\n  }, [validateAndAddFile]);\n\n  const handleRemoveFile = useCallback((id: string) => {\n    setFiles(prev => {\n      const removed = prev.find(f => f.id === id);\n      if (removed) URL.revokeObjectURL(removed.preview);\n      return prev.filter(f => f.id !== id);\n    });\n  }, []);\n\n  const handleDragOver = (e: React.DragEvent) => {\n    e.preventDefault();\n    setDragOver(true);\n  };\n\n  const handleDragLeave = (e: React.DragEvent) => {\n    e.preventDefault();\n    setDragOver(false);\n  };\n\n  const handleDrop = (e: React.DragEvent) => {\n    e.preventDefault();\n    setDragOver(false);\n    \n    const droppedFiles = Array.from(e.dataTransfer.files);\n    if (droppedFiles.length > 0) {\n      handleFileSelect(droppedFiles);\n    }\n  };\n\n  const handleUpload = useCallback(async () => {\n    if (!permissions.canUpload) {\n      toast.error('ì—…ë¡œë“œ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');\n      return;\n    }\n\n    if (files.length === 0) {\n      toast.error('íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');\n      return;\n    }\n\n    try {\n      setUploading(true);\n\n      const { data: { user }, error: userError } = await supabase.auth.getUser();\n      if (userError || !user) {\n        throw new Error('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');\n      }\n\n      const { data: employee } = await supabase\n        .from('employees')\n        .select('name')\n        .eq('email', user.email)\n        .single();\n\n      const userName = employee?.name || '';\n\n      // 2ì¥ ì´ìƒì´ë©´ group_id ìƒì„±\n      const groupId = files.length > 1 ? crypto.randomUUID() : null;\n\n      for (const fileItem of files) {\n        const now = new Date();\n        const fileExtension = fileItem.file.name.split('.').pop() || 'jpg';\n        const fileName = `rec${now.getFullYear().toString().substring(2)}${(now.getMonth() + 1).toString().padStart(2, '0')}${now.getDate().toString().padStart(2, '0')}${now.getHours().toString().padStart(2, '0')}${now.getMinutes().toString().padStart(2, '0')}${now.getSeconds().toString().padStart(2, '0')}.${fileExtension}`;\n        \n        const filePath = `receipts/web/${now.getTime()}_${fileItem.id.slice(0, 8)}/${fileName}`;\n\n        const { error: uploadError } = await supabase.storage\n          .from('receipt-images')\n          .upload(filePath, fileItem.file, {\n            contentType: fileItem.file.type,\n            upsert: false,\n          });\n\n        if (uploadError) throw uploadError;\n\n        const { data: { publicUrl } } = supabase.storage\n          .from('receipt-images')\n          .getPublicUrl(filePath);\n\n        const { error: dbError } = await supabase\n          .from('purchase_receipts')\n          .insert({\n            receipt_image_url: publicUrl,\n            file_name: fileName,\n            file_size: fileItem.file.size,\n            uploaded_by: user.email!,\n            uploaded_by_name: userName,\n            memo: memo || null,\n            uploaded_at: new Date().toISOString(),\n            group_id: groupId,\n          });\n\n        if (dbError) throw dbError;\n      }\n\n      const countText = files.length > 1 ? `${files.length}ì¥ì´` : 'ì˜ìˆ˜ì¦ì´';\n      toast.success(`${countText} ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.`);\n      handleClose();\n      onSuccess();\n    } catch (error) {\n      toast.error(`ì—…ë¡œë“œ ì‹¤íŒ¨: ${error instanceof Error ? error.message : error}`);\n    } finally {\n      setUploading(false);\n    }\n  }, [files, memo, permissions.canUpload, onSuccess]);\n\n  const handleClose = useCallback(() => {\n    files.forEach(f => URL.revokeObjectURL(f.preview));\n    setFiles([]);\n    setMemo(\"\");\n    setUploading(false);\n    setDragOver(false);\n    onClose();\n  }, [onClose, files]);\n\n  return (\n    <Dialog open={isOpen} onOpenChange={handleClose}>\n      <DialogContent>\n        <DialogHeader>\n          <DialogTitle className=\"modal-title\">ğŸ“ ì˜ìˆ˜ì¦ ì—…ë¡œë“œ</DialogTitle>\n          <DialogDescription className=\"modal-subtitle\">\n            ì˜ìˆ˜ì¦ ì´ë¯¸ì§€ë¥¼ ì—¬ëŸ¬ ì¥ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê°™ì€ í•­ëª©ì´ë©´ í•¨ê»˜ ë¬¶ì–´ì„œ ê´€ë¦¬ë©ë‹ˆë‹¤.\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"px-8 py-4 space-y-4\">\n          {/* íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­ */}\n          <div className=\"space-y-2\">\n            <Label className=\"modal-label\">íŒŒì¼ ì„ íƒ <span className=\"text-gray-400 badge-text\">(ì—¬ëŸ¬ ì¥ ê°€ëŠ¥)</span></Label>\n            <div\n              className={`relative border-2 border-dashed business-radius-card p-6 text-center transition-all duration-200 cursor-pointer ${\n                dragOver\n                  ? 'border-hansl-400 bg-hansl-50'\n                  : files.length > 0\n                  ? 'border-green-400 bg-green-50'\n                  : 'border-gray-300 hover:border-hansl-300 hover:bg-gray-50'\n              }`}\n              onDragOver={handleDragOver}\n              onDragLeave={handleDragLeave}\n              onDrop={handleDrop}\n            >\n              {files.length > 0 ? (\n                <div className=\"space-y-3\">\n                  <div className=\"grid grid-cols-3 gap-2\">\n                    {files.map((fileItem) => (\n                      <div key={fileItem.id} className=\"relative group\">\n                        <img\n                          src={fileItem.preview}\n                          alt={fileItem.file.name}\n                          className=\"w-full h-24 object-cover business-radius-card border border-gray-200\"\n                        />\n                        <button\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            handleRemoveFile(fileItem.id);\n                          }}\n                          className=\"absolute -top-1.5 -right-1.5 w-5 h-5 bg-red-500 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity\"\n                        >\n                          <X className=\"w-3 h-3\" />\n                        </button>\n                        <p className=\"mt-1 text-[9px] text-gray-500 truncate\">{fileItem.file.name}</p>\n                      </div>\n                    ))}\n                    <label className=\"flex flex-col items-center justify-center h-24 border-2 border-dashed border-gray-300 business-radius-card cursor-pointer hover:border-hansl-400 hover:bg-hansl-50 transition-colors\">\n                      <Plus className=\"w-5 h-5 text-gray-400\" />\n                      <span className=\"text-[9px] text-gray-400 mt-1\">ì¶”ê°€</span>\n                      <input\n                        type=\"file\"\n                        accept=\"image/*\"\n                        multiple\n                        onChange={(e) => {\n                          if (e.target.files) handleFileSelect(e.target.files);\n                          e.target.value = '';\n                        }}\n                        className=\"hidden\"\n                      />\n                    </label>\n                  </div>\n                  <p className=\"text-[10px] text-green-600 font-medium\">\n                    {files.length}ì¥ ì„ íƒë¨ {files.length > 1 && '(í•˜ë‚˜ì˜ ê·¸ë£¹ìœ¼ë¡œ ë¬¶ì…ë‹ˆë‹¤)'}\n                  </p>\n                </div>\n              ) : (\n                <div className=\"space-y-3\">\n                  <div className=\"w-14 h-14 bg-gray-100 rounded-full flex items-center justify-center mx-auto\">\n                    <Upload className=\"w-7 h-7 text-gray-400\" />\n                  </div>\n                  <div className=\"space-y-1\">\n                    <p className=\"modal-value\">\n                      ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸í•˜ì—¬ ë†“ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”\n                    </p>\n                    <p className=\"badge-text text-gray-500\">\n                      JPG, PNG, HEIC, WebP â€¢ ìµœëŒ€ 10MB â€¢ ì—¬ëŸ¬ ì¥ ì„ íƒ ê°€ëŠ¥\n                    </p>\n                  </div>\n                </div>\n              )}\n              \n              {files.length === 0 && (\n                <input\n                  type=\"file\"\n                  accept=\"image/*\"\n                  multiple\n                  onChange={(e) => {\n                    if (e.target.files) handleFileSelect(e.target.files);\n                    e.target.value = '';\n                  }}\n                  className=\"absolute inset-0 w-full h-full opacity-0 cursor-pointer\"\n                />\n              )}\n            </div>\n          </div>\n\n          {/* ë©”ëª¨ */}\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"memo\" className=\"modal-label\">\n              ë©”ëª¨ <span className=\"text-gray-400 badge-text\">(ì„ íƒì‚¬í•­)</span>\n            </Label>\n            <Textarea\n              id=\"memo\"\n              placeholder=\"ì˜ìˆ˜ì¦ì— ëŒ€í•œ ê°„ë‹¨í•œ ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”\"\n              value={memo}\n              onChange={(e) => setMemo(e.target.value)}\n              className=\"resize-none border-gray-200 focus:border-hansl-400 focus:ring-hansl-400 business-radius-input\"\n              rows={3}\n            />\n          </div>\n        </div>\n\n        {/* í•˜ë‹¨ ë²„íŠ¼ */}\n        <div className=\"flex justify-end gap-2 px-8 py-4 border-t border-gray-100\">\n          <Button\n            variant=\"outline\"\n            onClick={handleClose}\n            className=\"button-base w-20 border-gray-200 hover:bg-gray-50\"\n            disabled={uploading}\n          >\n            ì·¨ì†Œ\n          </Button>\n          <Button\n            onClick={handleUpload}\n            disabled={files.length === 0 || uploading}\n            className=\"button-base w-20 bg-hansl-600 hover:bg-hansl-700 text-white\"\n          >\n            {uploading ? (\n              <div className=\"flex items-center gap-2\">\n                <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\n                ì—…ë¡œë“œ ì¤‘...\n              </div>\n            ) : (\n              <>\n                <Upload className=\"w-4 h-4 mr-2\" />\n                ì—…ë¡œë“œ {files.length > 1 && `(${files.length}ì¥)`}\n              </>\n            )}\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","/**\n * ì˜ìˆ˜ì¦ ê´€ë¦¬ ê´€ë ¨ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤\n */\n\n\n// íŒŒì¼ íƒ€ì… ê²€ì¦\nexport function isValidImageFile(file: File): boolean {\n  const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp', 'image/heic'];\n  return validTypes.includes(file.type.toLowerCase());\n}\n\n// íŒŒì¼ í¬ê¸° ê²€ì¦ (ê¸°ë³¸ 10MB)\nexport function isValidFileSize(file: File, maxSizeMB: number = 10): boolean {\n  const maxSizeBytes = maxSizeMB * 1024 * 1024;\n  return file.size <= maxSizeBytes;\n}\n\n// ì˜ìˆ˜ì¦ íŒŒì¼ëª… ìƒì„±\nexport function generateReceiptFileName(extension: string = 'jpg'): string {\n  const now = new Date();\n  const year = now.getFullYear().toString().substring(2);\n  const month = (now.getMonth() + 1).toString().padStart(2, '0');\n  const day = now.getDate().toString().padStart(2, '0');\n  const hour = now.getHours().toString().padStart(2, '0');\n  const minute = now.getMinutes().toString().padStart(2, '0');\n  \n  return `rec${year}${month}${day}${hour}${minute}.${extension}`;\n}\n\n// Supabase Storage URLì—ì„œ íŒŒì¼ ê²½ë¡œ ì¶”ì¶œ\nexport function extractStoragePathFromUrl(url: string, bucketName: string = 'receipt-images'): string | null {\n  try {\n    const urlObj = new URL(url);\n    const pathSegments = urlObj.pathname.split('/');\n    const bucketIndex = pathSegments.indexOf(bucketName);\n    \n    if (bucketIndex === -1) return null;\n    \n    return pathSegments.slice(bucketIndex + 1).join('/');\n  } catch {\n    return null;\n  }\n}\n\n// ê²€ìƒ‰ì–´ í•˜ì´ë¼ì´íŠ¸ìš© í•¨ìˆ˜\nexport function highlightSearchTerm(text: string, searchTerm: string): string {\n  if (!searchTerm) return text;\n  \n  const regex = new RegExp(`(${searchTerm.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')})`, 'gi');\n  return text.replace(regex, '<mark>$1</mark>');\n}\n\n// í‚¤ë³´ë“œ ì ‘ê·¼ì„±ì„ ìœ„í•œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬\nexport function handleKeyboardActivation(\n  event: React.KeyboardEvent,\n  callback: () => void\n): void {\n  if (event.key === 'Enter' || event.key === ' ') {\n    event.preventDefault();\n    callback();\n  }\n}","import { useState, useEffect, useCallback, useMemo } from \"react\";\nimport { createClient } from \"@/lib/supabase/client\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Search, Filter, Receipt, Printer, Download, Calendar, Plus, Trash2, Images } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport ReceiptDetailModal from \"./ReceiptDetailModal\";\nimport MobileReceiptCard from \"./MobileReceiptCard\";\nimport ReceiptUploadModal from \"./ReceiptUploadModal\";\nimport { useReceiptPermissions } from \"@/hooks/useReceiptPermissions\";\nimport type { ReceiptItem, ReceiptGroup } from \"@/types/receipt\";\nimport { formatDate, formatFileSize } from \"@/utils/helpers\";\nimport { extractStoragePathFromUrl } from \"@/utils/receipt\";\nimport { logger } from \"@/lib/logger\";\n\nfunction buildGroups(receipts: ReceiptItem[]): ReceiptGroup[] {\n  const groupMap = new Map<string, ReceiptItem[]>();\n  const singles: ReceiptItem[] = [];\n\n  for (const r of receipts) {\n    if (r.group_id) {\n      const list = groupMap.get(r.group_id) || [];\n      list.push(r);\n      groupMap.set(r.group_id, list);\n    } else {\n      singles.push(r);\n    }\n  }\n\n  const groups: ReceiptGroup[] = [];\n\n  for (const [gid, items] of groupMap) {\n    items.sort((a, b) => new Date(a.uploaded_at).getTime() - new Date(b.uploaded_at).getTime());\n    groups.push({ group_id: gid, receipts: items, primary: items[0], count: items.length });\n  }\n\n  for (const s of singles) {\n    groups.push({ group_id: null, receipts: [s], primary: s, count: 1 });\n  }\n\n  groups.sort((a, b) => new Date(b.primary.uploaded_at).getTime() - new Date(a.primary.uploaded_at).getTime());\n  return groups;\n}\n\nfunction printReceiptImages(imageUrls: string[], onPrintDone?: () => void) {\n  const printWindow = window.open('', '_blank');\n  if (!printWindow) {\n    toast.error('íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. íŒì—…ì„ í—ˆìš©í•´ì£¼ì„¸ìš”.');\n    return;\n  }\n\n  const imagesHtml = imageUrls.map((url, i) => {\n    const isLast = i === imageUrls.length - 1;\n    return `<div class=\"page${isLast ? '' : ' page-break'}\"><img src=\"${url}\" alt=\"ì˜ìˆ˜ì¦ ${i + 1}\" class=\"receipt-image\" /></div>`;\n  }).join('\\n');\n\n  printWindow.document.write(`\n    <!DOCTYPE html>\n    <html>\n    <head>\n      <title>ì˜ìˆ˜ì¦ ì¸ì‡„</title>\n      <style>\n        * { margin: 0; padding: 0; box-sizing: border-box; }\n        body { background: white; }\n        .page {\n          display: flex;\n          justify-content: center;\n          align-items: center;\n          min-height: 100vh;\n        }\n        .page-break { page-break-after: always; }\n        .receipt-image {\n          max-width: 100%;\n          max-height: 100vh;\n          object-fit: contain;\n        }\n        @media print {\n          @page { margin: 0; size: auto; }\n          body { margin: 0; padding: 0; }\n          .page { min-height: auto; }\n          .page-break { page-break-after: always; }\n          .receipt-image {\n            max-width: 100%;\n            max-height: 100%;\n            width: auto;\n            height: auto;\n          }\n        }\n      </style>\n      <script>\n        var loaded = 0;\n        var total = ${imageUrls.length};\n        function onImgLoad() {\n          loaded++;\n          if (loaded >= total) {\n            setTimeout(function(){ window.print(); window.close(); }, 200);\n          }\n        }\n        function onImgError() {\n          loaded++;\n          if (loaded >= total) {\n            alert('ì¼ë¶€ ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');\n            window.close();\n          }\n        }\n      </script>\n    </head>\n    <body>\n      ${imagesHtml.replace(/onload=\"[^\"]*\"/g, '').replace(/<img /g, '<img onload=\"onImgLoad()\" onerror=\"onImgError()\" ')}\n    </body>\n    </html>\n  `);\n\n  printWindow.document.close();\n\n  if (onPrintDone) {\n    setTimeout(() => {\n      if (confirm('ì¸ì‡„ë¥¼ ì™„ë£Œí•˜ì…¨ìŠµë‹ˆê¹Œ?')) {\n        onPrintDone();\n      }\n    }, 1000);\n  }\n}\n\nexport default function ReceiptsMain() {\n  const [receipts, setReceipts] = useState<ReceiptItem[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [dateFilter, setDateFilter] = useState(\"\");\n  const [selectedReceipt, setSelectedReceipt] = useState<ReceiptItem | null>(null);\n  const [selectedGroupReceipts, setSelectedGroupReceipts] = useState<ReceiptItem[]>([]);\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const [isUploadModalOpen, setIsUploadModalOpen] = useState(false);\n\n  const supabase = createClient();\n  const { permissions, loading: permissionsLoading } = useReceiptPermissions();\n\n  useEffect(() => {\n    if (!permissionsLoading && !permissions.canView) {\n      toast.error('ì˜ìˆ˜ì¦ ê´€ë¦¬ì— ì ‘ê·¼í•  ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');\n    }\n  }, [permissions.canView, permissionsLoading]);\n\n  const loadReceipts = useCallback(async () => {\n    if (!permissions.canView) return;\n    \n    try {\n      setLoading(true);\n      \n      const { data, error } = await supabase\n        .from('purchase_receipts')\n        .select(`\n          id,\n          receipt_image_url,\n          file_name,\n          file_size,\n          uploaded_by,\n          uploaded_by_name,\n          uploaded_at,\n          memo,\n          is_printed,\n          printed_at,\n          printed_by,\n          printed_by_name,\n          group_id\n        `)\n        .order('uploaded_at', { ascending: false });\n\n      if (error) throw error;\n\n      setReceipts(data || []);\n    } catch (error) {\n      toast.error('ì˜ìˆ˜ì¦ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n    } finally {\n      setLoading(false);\n    }\n  }, [permissions.canView, supabase]);\n\n  const filteredReceipts = useMemo(() => {\n    let filtered = [...receipts];\n\n    if (searchTerm) {\n      const searchLower = searchTerm.toLowerCase();\n      filtered = filtered.filter(receipt => \n        receipt.file_name.toLowerCase().includes(searchLower) ||\n        receipt.memo?.toLowerCase().includes(searchLower) ||\n        formatDate(receipt.uploaded_at).includes(searchTerm) ||\n        receipt.uploaded_at.includes(searchTerm)\n      );\n    }\n\n    if (dateFilter) {\n      filtered = filtered.filter(receipt => {\n        if (!receipt.uploaded_at) return false;\n        const uploadDate = new Date(receipt.uploaded_at).toISOString().split('T')[0];\n        return uploadDate === dateFilter;\n      });\n    }\n\n    return filtered;\n  }, [receipts, searchTerm, dateFilter]);\n\n  const groups = useMemo(() => buildGroups(filteredReceipts), [filteredReceipts]);\n\n  useEffect(() => {\n    if (!permissionsLoading) {\n      loadReceipts();\n    }\n  }, [loadReceipts, permissionsLoading]);\n\n  const handleViewReceipt = (group: ReceiptGroup) => {\n    setSelectedReceipt(group.primary);\n    setSelectedGroupReceipts(group.receipts);\n    setIsModalOpen(true);\n  };\n\n  const markGroupAsPrinted = useCallback(async (receiptIds: string[]) => {\n    try {\n      const { data: { user }, error: authError } = await supabase.auth.getUser();\n      if (authError || !user) {\n        toast.error('ì‚¬ìš©ì ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n        return;\n      }\n\n      const { data: employee, error: empError } = await supabase\n        .from('employees')\n        .select('name, purchase_role')\n        .eq('email', user.email)\n        .single();\n\n      if (empError) {\n        toast.error('ì§ì› ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');\n        return;\n      }\n\n      const role = employee?.purchase_role || '';\n      const hasPermission = role.includes('app_admin') || role.includes('hr') || role.includes('lead buyer');\n      \n      if (!hasPermission) {\n        toast.error('ì¸ì‡„ì™„ë£Œ ì²˜ë¦¬ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');\n        return;\n      }\n\n      const updateData = {\n        is_printed: true,\n        printed_at: new Date().toISOString(),\n        printed_by: user.id,\n        printed_by_name: employee?.name || user.email\n      };\n\n      const { error: updateError } = await supabase\n        .from('purchase_receipts')\n        .update(updateData)\n        .in('id', receiptIds);\n\n      if (updateError) {\n        logger.error('ì˜ìˆ˜ì¦ ì¸ì‡„ì™„ë£Œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', updateError);\n        toast.error(`ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: ${updateError.message}`);\n        return;\n      }\n\n      toast.success('ì¸ì‡„ ì™„ë£Œë¡œ í‘œì‹œë˜ì—ˆìŠµë‹ˆë‹¤.');\n      loadReceipts();\n    } catch (error) {\n      const errorObj = error as any;\n      logger.error('ì˜ìˆ˜ì¦ ì¸ì‡„ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜ˆì™¸ ë°œìƒ', error);\n      toast.error(`ì¸ì‡„ ì™„ë£Œ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${errorObj?.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);\n    }\n  }, [supabase, loadReceipts]);\n\n  const handlePrintGroup = (group: ReceiptGroup) => {\n    const imageUrls = group.receipts\n      .filter(r => r.receipt_image_url)\n      .map(r => r.receipt_image_url);\n\n    if (imageUrls.length === 0) {\n      toast.error('ì˜ìˆ˜ì¦ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.');\n      return;\n    }\n\n    const receiptIds = group.receipts.map(r => r.id);\n    printReceiptImages(imageUrls, () => markGroupAsPrinted(receiptIds));\n  };\n\n  const handleDownloadReceipt = async (receipt: ReceiptItem) => {\n    if (!receipt.receipt_image_url) {\n      toast.error('ì˜ìˆ˜ì¦ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.');\n      return;\n    }\n\n    try {\n      const url = new URL(receipt.receipt_image_url);\n      const pathSegments = url.pathname.split('/');\n      const bucketIndex = pathSegments.indexOf('receipt-images');\n      \n      if (bucketIndex === -1) {\n        throw new Error('ì˜ëª»ëœ ì˜ìˆ˜ì¦ URLì…ë‹ˆë‹¤');\n      }\n      \n      const filePath = pathSegments.slice(bucketIndex + 1).join('/');\n\n      const { data, error } = await supabase.storage\n        .from('receipt-images')\n        .download(filePath);\n\n      if (error) throw error;\n\n      const blob = new Blob([data], { type: 'image/jpeg' });\n      const downloadUrl = window.URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = downloadUrl;\n      a.download = receipt.file_name || `ì˜ìˆ˜ì¦_${receipt.id}.jpg`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      window.URL.revokeObjectURL(downloadUrl);\n      \n      toast.success('ì˜ìˆ˜ì¦ ì´ë¯¸ì§€ê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');\n    } catch (error) {\n      toast.error('ë‹¤ìš´ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n    }\n  };\n\n  const handleDeleteGroup = useCallback(async (group: ReceiptGroup) => {\n    if (!permissions.canDelete) {\n      toast.error('ì‚­ì œ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');\n      return;\n    }\n\n    const countText = group.count > 1 ? `${group.count}ì¥ì˜ ì˜ìˆ˜ì¦ì„` : `\"${group.primary.file_name}\" ì˜ìˆ˜ì¦ì„`;\n    if (!confirm(`ì •ë§ë¡œ ${countText} ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {\n      return;\n    }\n\n    try {\n      for (const receipt of group.receipts) {\n        const filePath = extractStoragePathFromUrl(receipt.receipt_image_url);\n        \n        if (filePath) {\n          const { error: storageError } = await supabase.storage\n            .from('receipt-images')\n            .remove([filePath]);\n\n          if (storageError) {\n            logger.warn('Storage íŒŒì¼ ì‚­ì œ ì‹¤íŒ¨', { storageError, filePath });\n          }\n        }\n\n        const { error: dbError } = await supabase\n          .from('purchase_receipts')\n          .delete()\n          .eq('id', receipt.id);\n\n        if (dbError) throw dbError;\n      }\n\n      toast.success('ì˜ìˆ˜ì¦ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');\n      loadReceipts();\n    } catch (error) {\n      toast.error('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n    }\n  }, [permissions.canDelete, loadReceipts]);\n\n  const isGroupPrinted = (group: ReceiptGroup) => group.receipts.every(r => r.is_printed);\n\n  return (\n    <div className=\"w-full\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4\">\n        <div>\n          <h1 className=\"page-title\">ì˜ìˆ˜ì¦ ê´€ë¦¬</h1>\n          <p className=\"page-subtitle\" style={{marginTop:'-2px',marginBottom:'-4px'}}>Receipt Management</p>\n        </div>\n        <div className=\"flex items-center gap-2 mt-4 sm:mt-0\">\n          <Button\n            onClick={() => {\n              setIsUploadModalOpen(true);\n            }}\n            className=\"button-base bg-hansl-600 hover:bg-hansl-700 text-white\"\n          >\n            <Plus className=\"w-4 h-4 mr-1\" />\n            ì˜ìˆ˜ì¦ ì—…ë¡œë“œ\n          </Button>\n          <span className=\"badge-stats bg-gray-100 text-gray-600 modal-subtitle\">\n            ì´ {groups.length}ê±´\n          </span>\n        </div>\n      </div>\n\n      {/* í•„í„° ì„¹ì…˜ */}\n      <Card className=\"mb-4 border border-gray-200\">\n        <CardHeader className=\"bg-white border-b border-gray-200 py-3\">\n          <CardTitle className=\"flex items-center modal-section-title\">\n            <Filter className=\"w-4 h-4 mr-2\" />\n            ê²€ìƒ‰ í•„í„°\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"py-3\">\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2\">\n            <div>\n              <label className=\"block modal-label mb-1\">ê²€ìƒ‰</label>\n              <div className=\"relative\">\n                <Search className=\"absolute left-2 top-1/2 transform -translate-y-1/2 w-3 h-3 text-gray-400\" />\n                <Input\n                  placeholder=\"íŒŒì¼ëª…, ë©”ëª¨, ì—…ë¡œë“œì¼...\"\n                  value={searchTerm}\n                  onChange={(e) => setSearchTerm(e.target.value)}\n                  className=\"pl-7 modal-subtitle h-9\"\n                />\n              </div>\n            </div>\n\n            <div>\n              <label className=\"block modal-label mb-1\">ì—…ë¡œë“œ ë‚ ì§œ</label>\n              <Input\n                type=\"date\"\n                value={dateFilter}\n                onChange={(e) => setDateFilter(e.target.value)}\n                className=\"modal-subtitle h-9\"\n              />\n            </div>\n\n            <div className=\"flex items-end\">\n              <Button\n                variant=\"outline\"\n                onClick={() => {\n                  setSearchTerm(\"\");\n                  setDateFilter(\"\");\n                }}\n                className=\"h-9 modal-subtitle\"\n              >\n                ì´ˆê¸°í™”\n              </Button>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* ì˜ìˆ˜ì¦ ëª©ë¡ */}\n      <Card className=\"overflow-hidden border border-gray-200\">\n        <CardContent className=\"p-0\">\n          {(loading || permissionsLoading) ? (\n            <div className=\"flex items-center justify-center py-12\">\n              <div className=\"w-8 h-8 border-2 border-hansl-500 border-t-transparent rounded-full animate-spin\" />\n              <span className=\"ml-3 card-subtitle\">ë¡œë”© ì¤‘...</span>\n            </div>\n          ) : !permissions.canView ? (\n            <div className=\"text-center py-12\">\n              <div className=\"w-12 h-12 text-red-400 mx-auto mb-4\">ğŸ”’</div>\n              <h3 className=\"modal-section-title mb-2\">ì ‘ê·¼ ê¶Œí•œ ì—†ìŒ</h3>\n              <p className=\"card-subtitle\">ì˜ìˆ˜ì¦ ê´€ë¦¬ì— ì ‘ê·¼í•  ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.</p>\n            </div>\n          ) : groups.length === 0 ? (\n            <div className=\"text-center py-12\">\n              <Receipt className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" />\n              <h3 className=\"modal-section-title mb-2\">ì˜ìˆ˜ì¦ì´ ì—†ìŠµë‹ˆë‹¤</h3>\n              <p className=\"card-subtitle\">ì—…ë¡œë“œëœ ì˜ìˆ˜ì¦ì´ ì—†ê±°ë‚˜ ê²€ìƒ‰ ì¡°ê±´ì— ë§ëŠ” ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>\n            </div>\n          ) : (\n            <>\n              {/* ë°ìŠ¤í¬í†± í…Œì´ë¸” ë·° */}\n              <div className=\"hidden md:block overflow-x-auto\">\n                <table className=\"w-full min-w-fit\">\n                <thead className=\"bg-gray-50\">\n                  <tr>\n                    <th className=\"px-4 py-3 text-center header-title text-gray-600 uppercase tracking-wider\">ì¸ì‡„ì™„ë£Œ</th>\n                    <th className=\"px-4 py-3 text-center header-title text-gray-600 uppercase tracking-wider\">ì—…ë¡œë“œì¼</th>\n                    <th className=\"px-4 py-3 text-left header-title text-gray-600 uppercase tracking-wider\">ë©”ëª¨</th>\n                    {permissions.canViewUploaderInfo && (\n                      <th className=\"px-4 py-3 text-left header-title text-gray-600 uppercase tracking-wider\">ë“±ë¡ì¸</th>\n                    )}\n                    <th className=\"px-4 py-3 text-center header-title text-gray-600 uppercase tracking-wider\">í¬ê¸°</th>\n                    <th className=\"px-4 py-3 text-center header-title text-gray-600 uppercase tracking-wider\">ì•¡ì…˜</th>\n                    {permissions.canDelete && (\n                      <th className=\"px-4 py-3 text-center header-title text-gray-600 uppercase tracking-wider\">ì‚­ì œ</th>\n                    )}\n                  </tr>\n                </thead>\n                <tbody className=\"bg-white divide-y divide-gray-200\">\n                  {groups.map((group) => {\n                    const r = group.primary;\n                    const printed = isGroupPrinted(group);\n                    const totalSize = group.receipts.reduce((acc, cur) => acc + (cur.file_size || 0), 0);\n                    return (\n                      <tr \n                        key={group.group_id || r.id} \n                        className=\"hover:bg-gray-50 transition-colors cursor-pointer\"\n                        onClick={() => handleViewReceipt(group)}\n                      >\n                        <td className=\"px-4 py-3 modal-subtitle text-center\">\n                          {printed ? (\n                            <span className=\"badge-stats bg-green-100 text-green-700\">\n                              âœ“ ì™„ë£Œ\n                            </span>\n                          ) : (\n                            <span className=\"badge-stats bg-gray-100 text-gray-600\">\n                              ë¯¸ì™„ë£Œ\n                            </span>\n                          )}\n                        </td>\n                        <td className=\"px-4 py-3 modal-subtitle text-center text-gray-600\">\n                          {formatDate(r.uploaded_at)}\n                        </td>\n                        <td className=\"px-4 py-3 modal-subtitle text-gray-900\">\n                          <div className=\"flex items-center gap-1.5\">\n                            {r.memo || '-'}\n                            {group.count > 1 && (\n                              <span className=\"inline-flex items-center gap-0.5 badge-stats bg-blue-100 text-blue-700\">\n                                <Images className=\"w-3 h-3\" />\n                                {group.count}ì¥\n                              </span>\n                            )}\n                          </div>\n                        </td>\n                        {permissions.canViewUploaderInfo && (\n                          <td className=\"px-4 py-3 modal-subtitle text-gray-600\">\n                            {r.uploaded_by_name || r.uploaded_by}\n                          </td>\n                        )}\n                        <td className=\"px-4 py-3 modal-subtitle text-center text-gray-600\">\n                          {formatFileSize(totalSize)}\n                        </td>\n                        <td className=\"px-4 py-3 modal-subtitle text-center\">\n                          <div className=\"flex items-center justify-center gap-1\">\n                            <Button\n                              size=\"sm\"\n                              variant=\"ghost\"\n                              onClick={(e) => {\n                                e.stopPropagation();\n                                handlePrintGroup(group);\n                              }}\n                              className=\"h-8 w-8 p-0\"\n                              title={group.count > 1 ? `${group.count}ì¥ ì¸ì‡„` : 'ì¸ì‡„'}\n                            >\n                              <Printer className=\"w-4 h-4\" />\n                            </Button>\n                            <Button\n                              size=\"sm\"\n                              variant=\"ghost\"\n                              onClick={(e) => {\n                                e.stopPropagation();\n                                handleDownloadReceipt(r);\n                              }}\n                              className=\"h-8 w-8 p-0\"\n                              title=\"ë‹¤ìš´ë¡œë“œ\"\n                            >\n                              <Download className=\"w-4 h-4\" />\n                            </Button>\n                          </div>\n                        </td>\n                        {permissions.canDelete && (\n                          <td className=\"px-4 py-3 modal-subtitle text-center\">\n                            <Button\n                              size=\"sm\"\n                              variant=\"ghost\"\n                              onClick={(e) => {\n                                e.stopPropagation();\n                                handleDeleteGroup(group);\n                              }}\n                              className=\"h-8 w-8 p-0 text-red-600 hover:bg-red-50\"\n                              title=\"ì‚­ì œ\"\n                            >\n                              <Trash2 className=\"w-4 h-4\" />\n                            </Button>\n                          </td>\n                        )}\n                      </tr>\n                    );\n                  })}\n                </tbody>\n                </table>\n              </div>\n\n              {/* ëª¨ë°”ì¼ ì¹´ë“œ ë·° */}\n              <div className=\"md:hidden space-y-3 p-4\">\n                {groups.map((group) => (\n                  <MobileReceiptCard\n                    key={group.group_id || group.primary.id}\n                    receipt={group.primary}\n                    groupCount={group.count}\n                    onView={() => handleViewReceipt(group)}\n                    onPrint={() => handlePrintGroup(group)}\n                    onDownload={handleDownloadReceipt}\n                    onDelete={permissions.canDelete ? () => handleDeleteGroup(group) : undefined}\n                  />\n                ))}\n              </div>\n            </>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* ì˜ìˆ˜ì¦ ìƒì„¸ë³´ê¸° ëª¨ë‹¬ */}\n      {selectedReceipt && (\n        <ReceiptDetailModal\n          receipt={selectedReceipt}\n          groupReceipts={selectedGroupReceipts}\n          isOpen={isModalOpen}\n          onClose={() => {\n            setIsModalOpen(false);\n            setSelectedReceipt(null);\n            setSelectedGroupReceipts([]);\n          }}\n          onDelete={() => {\n            loadReceipts();\n          }}\n        />\n      )}\n\n      {/* ì˜ìˆ˜ì¦ ì—…ë¡œë“œ ëª¨ë‹¬ */}\n      <ReceiptUploadModal\n        isOpen={isUploadModalOpen}\n        onClose={() => setIsUploadModalOpen(false)}\n        onSuccess={() => {\n          loadReceipts();\n        }}\n      />\n    </div>\n  );\n}\n"],"names":["Funnel","createLucideIcon","d","key","Images","cx","cy","r","fill","x","y","width","height","rx","Printer","useReceiptPermissions","permissions","setPermissions","useState","canView","canUpload","canDownload","canPrint","canDelete","canViewUploaderInfo","userRole","setUserRole","loading","setLoading","supabase","createClient","checkPermissions","async","data","user","auth","getUser","employee","from","select","eq","email","single","role","purchase_role","isAppAdmin","includes","isHr","isLeadBuyer","hasReceiptAccess","error","useEffect","refreshPermissions","ReceiptDetailModal","receipt","groupReceipts","isOpen","onClose","onDelete","allReceipts","length","currentIndex","setCurrentIndex","imageScale","setImageScale","imageRotation","setImageRotation","imageError","setImageError","deleting","setDeleting","imageDimensions","setImageDimensions","imageLoaded","setImageLoaded","currentReceipt","hasMultiple","goNext","useCallback","prev","goPrev","handleKeyDown","e","window","addEventListener","removeEventListener","markAllAsPrinted","authError","toast","empError","updateData","is_printed","printed_at","Date","toISOString","printed_by","id","printed_by_name","name","receiptIds","map","updateError","update","in","logger","message","success","errorObj","handlePrint","imageUrls","filter","receipt_image_url","printWindow","open","imagesHtml","url","i","join","document","write","close","setTimeout","confirm","handleDelete","countText","pathSegments","URL","pathname","split","bucketIndex","indexOf","filePath","slice","storageError","storage","remove","warn","dbError","delete","jsx","Dialog","onOpenChange","children","jsxs","DialogContent","className","DialogHeader","DialogTitle","src","alt","style","containerWidth","innerWidth","containerHeight","innerHeight","widthRatio","heightRatio","optimalRatio","Math","min","getOptimalImageStyle","transform","transformOrigin","onLoad","img","currentTarget","naturalWidth","naturalHeight","onError","Button","variant","size","onClick","X","ChevronLeft","ChevronRight","max","disabled","ZoomOut","round","ZoomIn","RotateCcw","title","Error","download","blob","Blob","type","downloadUrl","createObjectURL","a","createElement","href","file_name","body","appendChild","click","removeChild","revokeObjectURL","Download","Trash2","MobileReceiptCard","groupCount","onView","onPrint","onDownload","Card","CardContent","Calendar","formatDate","uploaded_at","FileText","memo","User","uploaded_by_name","uploaded_by","formatFileSize","file_size","stopPropagation","ReceiptUploadModal","onSuccess","files","setFiles","setMemo","uploading","setUploading","dragOver","setDragOver","validateAndAddFile","selectedFile","startsWith","newFile","file","preview","crypto","randomUUID","handleFileSelect","selectedFiles","Array","forEach","f","handleRemoveFile","removed","find","handleUpload","userError","userName","groupId","fileItem","now","fileExtension","pop","fileName","getFullYear","toString","substring","getMonth","padStart","getDate","getHours","getMinutes","getSeconds","getTime","uploadError","upload","contentType","upsert","publicUrl","getPublicUrl","insert","group_id","handleClose","DialogDescription","Label","onDragOver","preventDefault","onDragLeave","onDrop","droppedFiles","dataTransfer","Plus","accept","multiple","onChange","target","value","Upload","htmlFor","Textarea","placeholder","rows","Fragment","extractStoragePathFromUrl","bucketName","ReceiptsMain","receipts","setReceipts","searchTerm","setSearchTerm","dateFilter","setDateFilter","selectedReceipt","setSelectedReceipt","selectedGroupReceipts","setSelectedGroupReceipts","isModalOpen","setIsModalOpen","isUploadModalOpen","setIsUploadModalOpen","permissionsLoading","loadReceipts","order","ascending","filteredReceipts","useMemo","filtered","searchLower","toLowerCase","groups","groupMap","Map","singles","list","get","push","set","gid","items","sort","b","primary","count","s","buildGroups","handleViewReceipt","group","markGroupAsPrinted","handlePrintGroup","onPrintDone","replace","printReceiptImages","handleDownloadReceipt","handleDeleteGroup","marginTop","marginBottom","CardHeader","CardTitle","Filter","Search","Input","Receipt","printed","every","isGroupPrinted","totalSize","reduce","acc","cur"],"mappings":"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","x_google_ignoreList":[0,1,2]}