{"version":3,"mappings":"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","names":["formatDate","formatDateISO","getCurrencySymbol","currency","includes","async","generatePurchaseOrderExcelJS","data","workbook","__vitePreload","import","then","n","e","__VITE_PRELOAD__","Workbook","sheet","addWorksheet","pageSetup","paperSize","orientation","fitToPage","fitToWidth","fitToHeight","horizontalCentered","verticalCentered","margins","left","right","top","bottom","header","footer","getRow","height","r","eachCell","cell","font","name","size","mergeCells","response","fetch","arrayBuffer","imageId","addImage","buffer","extension","dWidth","getColumn","width","logoWidth","Math","max","logoHeight","logoCol","logoRow","tl","col","row","ext","_e","getCell","value","alignment","horizontal","vertical","indent","bold","vendor_payment_schedule","vendor_name","vendor_contact_name","request_date","vendor_phone","vendor_fax","delivery_request_date","requester_name","purchase_order_number","tableHeaders","i","length","String","fromCharCode","sortedItems","items","sort","a","b","line_number","itemRows","sumRow","item","rowIdx","bCell","item_name","specification","quantity","unitSymbol","unitWithCurrency","unit_price_value","toLocaleString","trim","amountSymbol","amountWithCurrency","amount_value","gCell","remark","wrapText","shrinkToFit","c","totalSymbol","totalAmount","reduce","sum","lastRow","cellAddr","isItemRow","border","style","currentBorder","sumCellBorder","Object","entries","A","B","C","D","E","F","G","forEach","xlsx","writeBuffer","Blob","type","supabase","createClient","downloadPurchaseOrderExcel","purchase","currentUserRoles","onSuccessCallback","purchaseRequest","error","requestError","from","select","eq","single","toast","orderItems","itemsError","order","vendorInfo","vendorId","vendor_id","contactId","contact_id","vendorData","vendorError","contactData","contactError","contact_name","excelData","project_vendor","sales_order_number","project_item","map","blob","downloadFilename","url","window","URL","createObjectURL","document","createElement","href","download","body","appendChild","click","removeChild","revokeObjectURL","success","downloadFlagErr","update","is_po_download","flagErr","PurchaseDetailModal","lazy","DeliveryDateWarningModal","isOpen","onClose","purchases","onRefresh","currentUserName","completedIds","setCompletedIds","useState","Set","fixedWarningItems","setFixedWarningItems","hasFixedItemsRef","useRef","hasClosedRef","openPopoverId","setOpenPopoverId","modifySubject","setModifySubject","modifyMessage","setModifyMessage","isSending","setIsSending","detailModalPurchaseId","setDetailModalPurchaseId","isDetailModalOpen","setIsDetailModalOpen","detailModalPurchaseIdRef","useEffect","current","onCloseRef","calculateWarningItems","useCallback","today","Date","setHours","is_received","delivery_status","middle_manager_status","final_manager_status","delivery_revision_requested","deliveryDate","revisedDate","revised_delivery_request_date","push","warningType","daysOverdue","floor","getTime","warningItems","setWarningItems","remainingItems","filter","fixedItem","memoryPurchase","findPurchaseInMemory","id","currentPurchase","find","p","setTimeout","every","has","logger","info","allCompleted","useMemo","progress","round","realtimeFirstMount","unsubscribe","addCacheListener","openPopover","purchaseId","orderNumber","sendRequest","user","auth","getUser","createdInquiry","inquiryError","insert","user_id","user_email","email","user_name","inquiry_type","subject","message","status","purchase_request_id","requester_id","purchase_info","JSON","stringify","inquiryId","msgError","inquiry_id","sender_role","sender_email","attachments","updateError","delivery_revision_requested_at","toISOString","delivery_revision_requested_by","updatePurchaseInMemory","notifyCacheListeners","prev","add","handleClose","dateStr","d","getFullYear","getMonth","padStart","getDate","handleCardClick","handleDetailModalClose","purchaseIdToCheck","silent","jsxs","Fragment","children","jsx","Dialog","open","onOpenChange","DialogContent","className","showCloseButton","DialogHeader","AlertCircle","DialogTitle","Progress","isCompleted","onClick","Calendar","stopPropagation","Button","disabled","Check","Popover","PopoverTrigger","asChild","MessageSquarePlus","PopoverContent","align","onOpenAutoFocus","preventDefault","Label","Input","onChange","target","Textarea","placeholder","variant","Loader2","Suspense","fallback","activeTab","options","result","Promise","currentPurchaseId","useDeliveryWarningCount","count","debugItems","isTarget","step","middle","final","dateToISOString"],"ignoreList":[],"sources":["../../src/utils/exceljs/generatePurchaseOrderExcel.ts","../../src/utils/excelDownload.ts","../../src/components/purchase/DeliveryDateWarningModal.tsx"],"sourcesContent":["// hanslwebapp과 동일한 코드 기반 Excel 생성\nimport { formatDateISO } from '@/utils/helpers';\n\nexport interface PurchaseOrderData {\n  purchase_order_number: string;\n  request_date: string;\n  delivery_request_date: string;\n  requester_name: string;\n  vendor_name: string;\n  vendor_contact_name?: string;\n  vendor_phone?: string;\n  vendor_fax?: string;\n  project_vendor: string;\n  sales_order_number: string;\n  project_item: string;\n  items: PurchaseOrderItem[];\n  vendor_payment_schedule?: string;\n}\n\nexport interface PurchaseOrderItem {\n  line_number: number;\n  item_name: string;\n  specification: string;\n  quantity: number;\n  unit_price_value: number;\n  amount_value: number;\n  remark: string;\n  currency: string;\n}\n\nconst formatDate = formatDateISO;\n\n// Helper: currency code to symbol\nfunction getCurrencySymbol(currency: string) {\n  if (!currency) return '';\n  if (['KRW', '원', '₩'].includes(currency)) return '₩';\n  if (['USD', '$', '달러'].includes(currency)) return '$';\n  if (['EUR', '€'].includes(currency)) return '€';\n  if (['JPY', '엔', '¥'].includes(currency)) return '¥';\n  if (['CNY', '위안', '元'].includes(currency)) return '¥';\n  return currency;\n}\n\n/**\n * 엑셀 발주서 생성 (ExcelJS) - hanslwebapp과 동일한 방식\n * @param data PurchaseOrderData\n * @returns Blob (xlsx)\n */\nexport async function generatePurchaseOrderExcelJS(data: PurchaseOrderData): Promise<Blob> {\n  // ExcelJS를 동적으로 import하여 초기 번들 크기 감소\n  const ExcelJS = await import('exceljs');\n  const workbook = new ExcelJS.Workbook();\n  \n  const sheet = workbook.addWorksheet('발주서', {\n    pageSetup: {\n      paperSize: 9, // A4\n      orientation: 'portrait',\n      fitToPage: true,\n      fitToWidth: 1,\n      fitToHeight: 1,\n      horizontalCentered: true,\n      verticalCentered: true,\n      margins: {\n        left: 0.3,\n        right: 0.3,\n        top: 0.5,\n        bottom: 0.5,\n        header: 0.2,\n        footer: 0.2\n      }\n    }\n  });\n\n  // 행 높이 고정: 1행 39.75px(≈29.8pt), 2행부터 18px(≈13.5pt)\n  sheet.getRow(1).height = 29.8; // 39.75px\n  for (let r = 2; r <= 60; r++) {\n    sheet.getRow(r).height = 15.75; // 21px≈15.75pt\n  }\n  // 폰트 기본값: 맑은고딕, 크기 11 (2행부터), 1행은 20\n  // 1행\n  sheet.getRow(1).eachCell(cell => {\n    cell.font = { ...(cell.font || {}), name: '맑은 고딕', size: 20 };\n  });\n\n  // 나머지 행 기본 폰트 설정 (필요시 뒤에서 개별 셀에서 다시 bold 지정)\n  for (let r = 2; r <= 60; r++) {\n    sheet.getRow(r).eachCell(cell => {\n      cell.font = { ...(cell.font || {}), name: '맑은 고딕', size: 11 };\n    });\n  }\n\n  // 1. 병합 범위 템플릿과 1:1 적용\n  sheet.mergeCells('A1:G1');\n  sheet.mergeCells('A2:B2'); sheet.mergeCells('C2:D2'); sheet.mergeCells('F2:G2');\n  sheet.mergeCells('A3:B3'); sheet.mergeCells('C3:D3'); sheet.mergeCells('F3:G3');\n  sheet.mergeCells('A4:B4'); sheet.mergeCells('C4:D4'); sheet.mergeCells('F4:G4');\n  sheet.mergeCells('A5:B5'); sheet.mergeCells('C5:D5'); sheet.mergeCells('F5:G5');\n  sheet.mergeCells('A6:B6'); sheet.mergeCells('C6:D6'); sheet.mergeCells('F6:G6');\n  sheet.mergeCells('A7:B7'); sheet.mergeCells('C7:D7'); sheet.mergeCells('F7:G7');\n  // 8~46행(헤더/품목/합계) 병합 없음\n  // 합계가 들어가는 행에 맞춰 병합 범위도 동적으로 이동\n  // (아래에서 sumRow 계산 후 병합)\n\n  try {\n    const response = await fetch('/logo_KOR.png');\n    const arrayBuffer = await response.arrayBuffer();\n    const imageId = workbook.addImage({\n      buffer: arrayBuffer,\n      extension: 'png',\n    });\n    // 로고(이모티콘)는 너비 0.58col, '발주서' 글자 바로 왼쪽에 딱 붙게 배치\n    // D열 width가 undefined/null/0이면 기본값 22로 대체\n    const dWidth = sheet.getColumn('D').width || 22;\n    const logoWidth = Math.max(1, dWidth * 7.2 * 0.58) + 4; // 기존보다 4px 더 크게\n    const logoHeight = 30 + 4; // 기존 30에서 4px 더 크게\n    // D1 셀 중앙(3.5, 0.5)에서 왼쪽 2px(0.28col), 위로 2px(0.13row) 이동\n    const logoCol = 3.5 - 0.50;\n    const logoRow = 0.5 - 0.20;\n    sheet.addImage(imageId, {\n      tl: { col: logoCol, row: logoRow }, // D1 셀 중앙에서 왼쪽 2px, 위로 2px 이동\n      ext: { width: logoWidth, height: logoHeight },\n    });\n  } catch (_e) {\n    // Logo loading failed, continue without logo\n  }\n\n  // 2. 제목 (B1:H1 병합, 중앙정렬)\n  sheet.getCell('D1').value = '                발 주 서';\n  sheet.getCell('D1').alignment = { horizontal: 'left', vertical: 'middle', indent: 1 };\n  sheet.getCell('D1').font = { bold: true, size: 20 };\n\n  // 3. 상단 정보 고정 라벨 적용 (공백 포함)\n  sheet.getCell('A2').value = '업   체   명';\n  sheet.getCell('A2').font = { bold: true };\n  sheet.getCell('A3').value = '담   당   자';\n  sheet.getCell('A3').font = { bold: true };\n  sheet.getCell('A4').value = '청   구   일';\n  sheet.getCell('A4').font = { bold: true };\n  sheet.getCell('A5').value = 'TEL.';\n  sheet.getCell('A5').font = { bold: true };\n  sheet.getCell('A6').value = 'FAX.';\n  sheet.getCell('A6').font = { bold: true };\n  sheet.getCell('A7').value = '입고요청일';\n  sheet.getCell('A7').font = { bold: true };\n\n  sheet.getCell('E2').value = '구매요청자';\n  sheet.getCell('E2').font = { bold: true };\n  sheet.getCell('E3').value = '주         소';\n  sheet.getCell('E3').font = { bold: true };\n  sheet.getCell('E4').value = '발 주 번 호';\n  sheet.getCell('E4').font = { bold: true };\n  sheet.getCell('E5').value = 'TEL.';\n  sheet.getCell('E5').font = { bold: true };\n  sheet.getCell('E6').value = 'FAX.';\n  sheet.getCell('E6').font = { bold: true };\n  sheet.getCell('E7').value = '지출 예정일';\n  sheet.getCell('E7').font = { bold: true };\n\n  sheet.getCell('F7').value = data.vendor_payment_schedule || '';\n\n  // 데이터 매핑(예시)\n  sheet.getCell('C2').value = data.vendor_name;\n  sheet.getCell('C3').value = data.vendor_contact_name || '';\n  sheet.getCell('C4').value = formatDate(data.request_date);\n  sheet.getCell('C5').value = data.vendor_phone || '';\n  sheet.getCell('C6').value = data.vendor_fax || '';\n  sheet.getCell('C7').value = formatDate(data.delivery_request_date);\n\n  sheet.getCell('F2').value = data.requester_name;\n  sheet.getCell('F3').value = '대구광역시 달서구 성서공단북로305';\n  sheet.getCell('F4').value = data.purchase_order_number;\n  sheet.getCell('F5').value = '(053) 626-7805';\n  sheet.getCell('F6').value = '(053) 657-7905';\n  sheet.getCell('F5').alignment = { horizontal: 'center', vertical: 'middle' };\n  sheet.getCell('F6').alignment = { horizontal: 'center', vertical: 'middle' };\n\n  // 8행: 테이블 헤더\n  const tableHeaders = ['No', '품명', '규격', '수량', '단가', '금액', '비고'];\n  for (let i = 0; i < tableHeaders.length; i++) {\n    sheet.getCell(String.fromCharCode(65 + i) + '8').value = tableHeaders[i];\n    sheet.getCell(String.fromCharCode(65 + i) + '8').font = { bold: true };\n    if(i===6){\n       sheet.getCell('G8').alignment = { horizontal:'center', vertical:'middle' };\n    }\n  }\n\n  // 품목이 45개를 넘으면 아래로 밀어서 합계/하단 정보 출력\n  const baseRow = 9;\n  const minRows = 45;\n  // --- 품목 데이터 line_number 기준 정렬 ---\n  const sortedItems = [...data.items].sort((a, b) => a.line_number - b.line_number);\n  const itemRows = sortedItems.length;\n  const sumRow = baseRow + Math.max(itemRows, minRows); // 합계 위치\n\n  // 품목 데이터\n  for (let i = 0; i < sortedItems.length; i++) {\n    const item = sortedItems[i];\n    const rowIdx = baseRow + i;\n    sheet.getCell('A' + rowIdx).value = item.line_number;\n    const bCell = sheet.getCell('B' + rowIdx);\n    bCell.value = item.item_name;\n    bCell.alignment = { horizontal: 'left', vertical: 'middle' };\n    sheet.getCell('C' + rowIdx).value = item.specification;\n    sheet.getCell('C' + rowIdx).alignment = { horizontal: 'left', vertical: 'middle' };\n    sheet.getCell('D' + rowIdx).value = item.quantity;\n    // 단가(E열) - 통화 기호 포함\n    const unitSymbol = getCurrencySymbol(item.currency);\n    const unitWithCurrency = (item.unit_price_value !== undefined && item.unit_price_value !== null)\n      ? `${item.unit_price_value.toLocaleString()} ${unitSymbol}`.trim()\n      : '';\n    sheet.getCell('E' + rowIdx).value = unitWithCurrency;\n    sheet.getCell('E' + rowIdx).alignment = { horizontal: 'right', vertical: 'middle' };\n\n    // 금액(F열) - 통화 기호 포함\n    const amountSymbol = getCurrencySymbol(item.currency);\n    const amountWithCurrency = (item.amount_value !== undefined && item.amount_value !== null)\n      ? `${item.amount_value.toLocaleString()} ${amountSymbol}`.trim()\n      : '';\n    sheet.getCell('F' + rowIdx).value = amountWithCurrency;\n    sheet.getCell('F' + rowIdx).alignment = { horizontal: 'right', vertical: 'middle' };\n    // G열은 비워둠\n    const gCell = sheet.getCell('G' + rowIdx);\n    gCell.value = (item.remark !== undefined && item.remark !== null) ? String(item.remark) : '';\n    gCell.alignment = { horizontal: 'left', vertical: 'middle', wrapText: false, shrinkToFit: true };\n  }\n\n  // 품목이 45개보다 적으면 빈 행 추가\n  for (let i = itemRows; i < minRows; i++) {\n    const rowIdx = baseRow + i;\n    for (let c = 0; c < 7; c++) {\n      sheet.getCell(String.fromCharCode(65 + c) + rowIdx).value = '';\n    }\n  }\n\n  // 합계\n  sheet.mergeCells(`A${sumRow}:E${sumRow}`);\n  sheet.getCell('A' + sumRow).value = '합계';\n  sheet.getCell('A' + sumRow).font = { bold: true };\n  const totalSymbol = getCurrencySymbol(data.items[0]?.currency);\n  const totalAmount = data.items.reduce((sum, item) => sum + (item.amount_value || 0), 0);\n  sheet.getCell('F' + sumRow).value = `${totalAmount.toLocaleString()} ${totalSymbol}`.trim();\n  sheet.getCell('F' + sumRow).alignment = { horizontal: 'right', vertical: 'middle' };\n\n  // 실제 마지막 데이터가 들어간 행까지 동적으로 테두리 적용 (합계까지만)\n  const lastRow = sumRow;\n  for (let r = 1; r <= lastRow; r++) {\n    for (let c = 1; c <= 7; c++) {\n      const col = String.fromCharCode(64 + c); // A~G\n      const cellAddr = col + r;\n      const cell = sheet.getCell(cellAddr);\n      // E(5), F(6)열의 품목 데이터 행(단가/금액)과 합계행, C(3)열의 품목 데이터 행(규격)은 alignment를 덮어쓰지 않음\n      const isPriceCol = (c === 5 || c === 6);\n      const isSpecCol = (c === 3);\n      const isItemRow = (r >= baseRow && r < sumRow);\n      const isSumRow = (r === sumRow);\n      if (!((isPriceCol && (isItemRow || isSumRow)) || (isSpecCol && isItemRow))) {\n        // 나머지 셀만 중앙 정렬\n        cell.alignment = { horizontal: 'center', vertical: 'middle' };\n      }\n      // 기존 스타일: 2행/8행/합계행(sumRow) 위, 8행 아래, 마지막행만 굵은선\n      cell.border = {\n        top:    { style: (r === 1) ? 'medium' : (r === 2 || r === 8 || r === sumRow) ? 'medium' : 'thin' },\n        left:   { style: c === 1 ? 'medium' : 'thin' },\n        right:  { style: c === 7 ? 'medium' : 'thin' },\n        bottom: { style: (r === 8 || r === sumRow || r === lastRow) ? 'medium' : 'thin' }\n      };\n    }\n  }\n  // 규격(C열) 입력란(품목 데이터 행)은 마지막에 좌측 정렬로 덮어쓴다\n  for (let i = 0; i < itemRows; i++) {\n    const rowIdx = baseRow + i;\n    sheet.getCell('C' + rowIdx).alignment = { horizontal: 'left', vertical: 'middle' };\n  }\n\n  // B2:B7, D2:D7, E2:E6 오른쪽 테두리 굵게\n  for (let r = 2; r <= 7; r++) {\n    sheet.getCell('B' + r).border = {\n      ...sheet.getCell('B' + r).border,\n      right: { style: 'medium' }\n    };\n    sheet.getCell('D' + r).border = {\n      ...sheet.getCell('D' + r).border,\n      right: { style: 'medium' }\n    };\n    if (r <= 6) {\n      sheet.getCell('E' + r).border = {\n        ...sheet.getCell('E' + r).border,\n        right: { style: 'medium' }\n      };\n    }\n  }\n  // E7, G7 위쪽 테두리 일반(얇게)\n  sheet.getCell('E7').border = {\n    ...sheet.getCell('E7').border,\n    top: { style: 'thin' },\n    right: { style: 'medium' }\n  };\n  sheet.getCell('G7').border = {\n    ...sheet.getCell('G7').border,\n    top: { style: 'thin' }\n  };\n\n  // A1~A7 왼쪽 테두리 굵게 명시적 설정 (덮어쓰기 방지)\n  for (let r = 1; r <= 7; r++) {\n    const currentBorder = sheet.getCell('A' + r).border || {};\n    sheet.getCell('A' + r).border = {\n      ...currentBorder,\n      left: { style: 'medium' }\n    };\n  }\n\n  // 합계 행(A열) 왼쪽 테두리 굵게 명시적 설정\n  const sumCellBorder = sheet.getCell('A' + sumRow).border || {};\n  sheet.getCell('A' + sumRow).border = {\n    ...sumCellBorder,\n    left: { style: 'medium' }\n  };\n\n  // 열 너비 (템플릿 기준)\n  const colWidths = { A:4.7, B:23, C:30, D:11, E:15, F:16, G:37 };\n  Object.entries(colWidths).forEach(([col, width]) => {\n    sheet.getColumn(col).width = width;\n  });\n\n  /* -----------------------------------\n      최종 행 높이/폰트 일괄 적용\n      1행 : 39.75pt\n      2행~lastRow : 18pt\n  ----------------------------------- */\n  sheet.getRow(1).height = 29.8; // 39.75px≈29.8pt\n  sheet.getRow(1).eachCell(c => { c.font = { ...(c.font || {}), name: '맑은 고딕', size: 20 }; });\n\n  for (let r = 2; r <= lastRow; r++) {\n    const row = sheet.getRow(r);\n    row.height = 15.75; // 21px≈15.75pt\n    row.eachCell(c => {\n      c.font = { ...(c.font || {}), name: '맑은 고딕', size: 11 };\n    });\n  }\n\n  // G열 전체 좌측 정렬 및 자동 줄바꿈 보장\n  for (let r = 9; r <= lastRow; r++) {\n    sheet.getCell('G' + r).alignment = { horizontal: 'left', vertical: 'middle', wrapText: false, shrinkToFit: true };\n    sheet.getCell('B' + r).alignment = { horizontal: 'left', vertical: 'middle' };\n  }\n\n  // 9. 파일 생성\n  const buffer = await workbook.xlsx.writeBuffer();\n  return new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });\n}","// 공통 Excel 다운로드 유틸리티 - 관리탭과 대시보드에서 공유\nimport { createClient } from '@/lib/supabase/client'\n\nconst supabase = createClient()\nimport { generatePurchaseOrderExcelJS } from '@/utils/exceljs/generatePurchaseOrderExcel'\nimport type { PurchaseOrderData } from '@/utils/exceljs/generatePurchaseOrderExcel'\nimport { toast } from 'sonner'\n\nexport interface Purchase {\n  id?: number\n  purchase_order_number: string\n  vendor_name: string\n  vendor_id?: string\n  contact_id?: string\n}\n\n/**\n * 공통 Excel 다운로드 함수 - 관리탭과 대시보드 모두에서 사용\n * 관리탭의 handleExcelDownload 로직을 그대로 유틸리티로 분리\n */\nexport const downloadPurchaseOrderExcel = async (\n  purchase: Purchase, \n  currentUserRoles?: string[],\n  onSuccessCallback?: () => void\n) => {\n  try {\n    // DB에서 직접 모든 품목 조회\n    const { data: purchaseRequest, error: requestError } = await supabase\n      .from('purchase_requests')\n      .select('*')\n      .eq('purchase_order_number', purchase.purchase_order_number)\n      .single();\n\n    if (requestError || !purchaseRequest) {\n      toast.error('해당 발주요청번호의 데이터를 찾을 수 없습니다.');\n      return;\n    }\n\n    // 품목 데이터 조회\n    const { data: orderItems, error: itemsError } = await supabase\n      .from('purchase_request_items')\n      .select('*')\n      .eq('purchase_order_number', purchase.purchase_order_number)\n      .order('line_number');\n\n    if (itemsError || !orderItems || orderItems.length === 0) {\n      toast.error('해당 발주요청번호의 품목 데이터를 찾을 수 없습니다.');\n      return;\n    }\n\n    // 업체 상세 정보 및 담당자 정보 조회\n    const vendorInfo = {\n      vendor_name: purchase.vendor_name,\n      vendor_phone: '',\n      vendor_fax: '',\n      vendor_contact_name: ''\n    };\n\n    try {\n      const vendorId = purchaseRequest.vendor_id || purchase.vendor_id;\n      const contactId = purchaseRequest.contact_id || purchase.contact_id;\n      \n      // vendor 정보 조회\n      if (vendorId) {\n        const { data: vendorData, error: vendorError } = await supabase\n          .from('vendors')\n          .select('vendor_phone, vendor_fax')\n          .eq('id', vendorId)\n          .single();\n\n        if (vendorData && !vendorError) {\n          vendorInfo.vendor_phone = vendorData.vendor_phone || '';\n          vendorInfo.vendor_fax = vendorData.vendor_fax || '';\n        }\n      }\n\n      // vendor_contacts에서 contact_id로 담당자 정보 조회\n      if (contactId) {\n        const { data: contactData, error: contactError } = await supabase\n          .from('vendor_contacts')\n          .select('contact_name, contact_phone, contact_email')\n          .eq('id', contactId)\n          .single();\n        if (contactData && !contactError) {\n          vendorInfo.vendor_contact_name = contactData.contact_name || '';\n        }\n      }\n    } catch (error) {\n      // 업체 정보 조회 실패 시에도 계속 진행\n    }\n\n    const excelData: PurchaseOrderData = {\n      purchase_order_number: purchaseRequest.purchase_order_number || '',\n      request_date: purchaseRequest.request_date,\n      delivery_request_date: purchaseRequest.delivery_request_date,\n      requester_name: purchaseRequest.requester_name,\n      vendor_name: vendorInfo.vendor_name || '',\n      vendor_contact_name: vendorInfo.vendor_contact_name,\n      vendor_phone: vendorInfo.vendor_phone,\n      vendor_fax: vendorInfo.vendor_fax,\n      project_vendor: purchaseRequest.project_vendor,\n      sales_order_number: purchaseRequest.sales_order_number,\n      project_item: purchaseRequest.project_item,\n      items: orderItems.map((item: any) => ({\n        line_number: item.line_number,\n        item_name: item.item_name,\n        specification: item.specification,\n        quantity: item.quantity,\n        unit_price_value: item.unit_price_value,\n        amount_value: item.amount_value,\n        remark: item.remark,\n        currency: purchaseRequest.currency || 'KRW'\n      }))\n    };\n\n    // 코드 기반 ExcelJS 생성 (템플릿 없이 서식 직접 정의)\n    const blob = await generatePurchaseOrderExcelJS(excelData);\n    \n    // 다운로드용 파일명: 발주서_{업체명}_발주요청번호\n    const downloadFilename = `발주서_${excelData.vendor_name}_${excelData.purchase_order_number}.xlsx`;\n\n    // 사용자에게 즉시 다운로드 제공\n    const url = window.URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = downloadFilename;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    window.URL.revokeObjectURL(url);\n    \n    toast.success('엑셀 파일이 다운로드되었습니다.');\n    \n    // DB에 다운로드 완료 플래그(is_po_download) 업데이트 - lead buyer만 해당\n    try {\n      const isLeadBuyer = currentUserRoles && currentUserRoles.includes('lead buyer');\n\n      if (isLeadBuyer) {\n        const { error: downloadFlagErr } = await supabase\n          .from('purchase_requests')\n          .update({ is_po_download: true })\n          .eq('purchase_order_number', purchase.purchase_order_number);\n        \n        if (!downloadFlagErr) {\n          // 성공 콜백 실행 (UI 업데이트용)\n          onSuccessCallback?.();\n        }\n      }\n    } catch (flagErr) {\n      // 플래그 업데이트 실패는 무시하고 계속 진행\n    }\n  } catch (error) {\n    console.error('❌ Excel 다운로드 실패:', error);\n    toast.error('엑셀 다운로드에 실패했습니다.');\n    throw error;\n  }\n};","import { useMemo, useState, useCallback, useEffect, useRef, lazy, Suspense } from 'react';\nimport { AlertCircle, Calendar, Loader2, MessageSquarePlus, Check } from 'lucide-react';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Progress } from '@/components/ui/progress';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';\nimport { Purchase } from '@/types/purchase';\nimport { createClient } from '@/lib/supabase/client';\nimport { toast } from 'sonner';\nimport { addCacheListener, updatePurchaseInMemory, notifyCacheListeners, findPurchaseInMemory } from '@/stores/purchaseMemoryStore';\nimport { dateToISOString } from '@/utils/helpers';\nimport { logger } from '@/lib/logger';\n\n// 상세 모달 lazy load\nconst PurchaseDetailModal = lazy(() => import('./PurchaseDetailModal'));\n\ninterface DeliveryDateWarningModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  purchases: Purchase[];\n  onRefresh?: (forceRefresh?: boolean, options?: { silent?: boolean }) => void | Promise<void>;\n  currentUserName?: string | null;\n}\n\ninterface WarningItem {\n  purchase: Purchase;\n  warningType: 'delivery_overdue' | 'revision_overdue';\n  daysOverdue: number;\n}\n\nexport default function DeliveryDateWarningModal({\n  isOpen,\n  onClose,\n  purchases,\n  onRefresh,\n  currentUserName\n}: DeliveryDateWarningModalProps) {\n  // 완료된 항목 ID 목록 (로컬 상태로 즉시 UI 반영)\n  const [completedIds, setCompletedIds] = useState<Set<number>>(new Set());\n  // 모달이 열릴 때 고정된 경고 항목 (이후 재계산 방지)\n  const [fixedWarningItems, setFixedWarningItems] = useState<WarningItem[]>([]);\n  // 이미 항목을 고정했는지 추적 (한 번만 고정)\n  const hasFixedItemsRef = useRef(false);\n  // 자동 닫기가 이미 실행되었는지 추적 (중복 방지)\n  const hasClosedRef = useRef(false);\n  const [openPopoverId, setOpenPopoverId] = useState<number | null>(null);\n  const [modifySubject, setModifySubject] = useState('');\n  const [modifyMessage, setModifyMessage] = useState('');\n  const [isSending, setIsSending] = useState(false);\n  \n  // 상세 모달 상태\n  const [detailModalPurchaseId, setDetailModalPurchaseId] = useState<number | null>(null);\n  const [isDetailModalOpen, setIsDetailModalOpen] = useState(false);\n  \n  // detailModalPurchaseId를 ref로도 저장 (onRefresh 콜백에서 사용)\n  const detailModalPurchaseIdRef = useRef<number | null>(null);\n  useEffect(() => {\n    detailModalPurchaseIdRef.current = detailModalPurchaseId;\n  }, [detailModalPurchaseId]);\n  \n  // onClose를 ref로 감싸서 useEffect 의존성 문제 해결\n  const onCloseRef = useRef(onClose);\n  onCloseRef.current = onClose;\n  \n  const supabase = createClient();\n\n  // 경고 항목 계산 함수\n  const calculateWarningItems = useCallback(() => {\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    \n    const items: WarningItem[] = [];\n    \n    purchases.forEach(purchase => {\n      // 이미 입고 완료된 항목 제외\n      if (purchase.is_received || purchase.delivery_status === 'completed') return;\n      // 승인 안된 항목 제외\n      if (purchase.middle_manager_status !== 'approved' || purchase.final_manager_status !== 'approved') return;\n      // 본인 발주만 표시\n      if (currentUserName && purchase.requester_name !== currentUserName) return;\n      // 이미 수정요청 완료된 항목 제외\n      if (purchase.delivery_revision_requested === true) return;\n      \n      const deliveryDate = purchase.delivery_request_date ? new Date(purchase.delivery_request_date) : null;\n      const revisedDate = purchase.revised_delivery_request_date ? new Date(purchase.revised_delivery_request_date) : null;\n      \n      if (deliveryDate) deliveryDate.setHours(0, 0, 0, 0);\n      if (revisedDate) revisedDate.setHours(0, 0, 0, 0);\n      \n      // 변경요청일이 있고 지난 경우\n      if (revisedDate && revisedDate < today) {\n        items.push({\n          purchase,\n          warningType: 'revision_overdue',\n          daysOverdue: Math.floor((today.getTime() - revisedDate.getTime()) / (1000 * 60 * 60 * 24))\n        });\n        return;\n      }\n      \n      // 입고요청일이 지났고 변경요청일이 없는 경우\n      if (deliveryDate && deliveryDate < today && !revisedDate) {\n        items.push({\n          purchase,\n          warningType: 'delivery_overdue',\n          daysOverdue: Math.floor((today.getTime() - deliveryDate.getTime()) / (1000 * 60 * 60 * 24))\n        });\n      }\n    });\n    \n    return items.sort((a, b) => b.daysOverdue - a.daysOverdue);\n  }, [purchases, currentUserName]);\n\n  // 모달이 열릴 때 경고 항목 고정 (이후 메모리 캐시 업데이트로 재계산되지 않음)\n  // 단, 입고완료 처리로 항목이 제거되면 실시간으로 업데이트\n  const [warningItems, setWarningItems] = useState<WarningItem[]>([]);\n\n  // 모달 열릴 때 상태 초기화 및 경고 항목 고정 (한 번만)\n  useEffect(() => {\n    if (isOpen && !hasFixedItemsRef.current) {\n      setCompletedIds(new Set());\n      setOpenPopoverId(null);\n      hasClosedRef.current = false; // 자동 닫기 플래그 초기화\n      // 모달 열릴 때 경고 항목 고정 (이후 재계산 방지)\n      const items = calculateWarningItems();\n      setFixedWarningItems(items);\n      setWarningItems(items);\n      hasFixedItemsRef.current = true;\n    }\n    \n    // 모달이 닫히면 플래그 초기화\n    if (!isOpen) {\n      hasFixedItemsRef.current = false;\n    }\n  }, [isOpen, calculateWarningItems]);\n  \n  // 입고완료 처리 후 경고 항목 실시간 업데이트\n  useEffect(() => {\n    if (!isOpen || fixedWarningItems.length === 0) return;\n    \n    // 입고완료된 항목 제거 (메모리 캐시 우선 확인, 없으면 purchases prop 확인)\n    const remainingItems = fixedWarningItems.filter(fixedItem => {\n      // 1. 메모리 캐시에서 먼저 확인 (가장 최신 데이터)\n      const memoryPurchase = findPurchaseInMemory(fixedItem.purchase.id);\n      if (memoryPurchase) {\n        if (memoryPurchase.is_received || memoryPurchase.delivery_status === 'completed') {\n          return false;\n        }\n        return true;\n      }\n      \n      // 2. 메모리 캐시에 없으면 purchases prop에서 확인\n      const currentPurchase = purchases.find(p => p.id === fixedItem.purchase.id);\n      if (!currentPurchase) {\n        // 데이터가 없으면 원본 데이터로 체크\n        return !(fixedItem.purchase.is_received || fixedItem.purchase.delivery_status === 'completed');\n      }\n      \n      // 입고완료되었으면 제외\n      if (currentPurchase.is_received || currentPurchase.delivery_status === 'completed') {\n        return false;\n      }\n      \n      return true;\n    });\n    \n    // 경고 항목 업데이트\n    if (remainingItems.length !== warningItems.length) {\n      setWarningItems(remainingItems);\n    }\n    \n    // 모든 항목이 입고완료되었으면 모달 자동 닫기\n    if (remainingItems.length === 0 && fixedWarningItems.length > 0 && !hasClosedRef.current) {\n      hasClosedRef.current = true;\n      setTimeout(() => {\n        onCloseRef.current();\n      }, 300);\n    }\n  }, [purchases, isOpen, fixedWarningItems, warningItems.length]);\n  \n  // warningItems가 변경될 때 모든 항목 완료 확인\n  useEffect(() => {\n    if (!isOpen) return;\n    \n    // 모든 항목이 완료되었는지 확인 (입고완료 또는 수정요청 완료)\n    const allCompleted = warningItems.length === 0 || \n      warningItems.every(item => \n        completedIds.has(item.purchase.id) ||\n        item.purchase.is_received ||\n        item.purchase.delivery_status === 'completed'\n      );\n    \n    if (allCompleted && warningItems.length > 0 && !hasClosedRef.current) {\n      logger.info('🔍 [입고지연알림] 모든 항목 완료, 모달 자동 닫기');\n      hasClosedRef.current = true;\n      setTimeout(() => {\n        onCloseRef.current();\n      }, 300);\n    }\n  }, [warningItems, completedIds, isOpen]);\n\n  // 모든 항목 완료 여부\n  const allCompleted = useMemo(() => {\n    if (warningItems.length === 0) return true;\n    return warningItems.every(item => completedIds.has(item.purchase.id));\n  }, [warningItems, completedIds]);\n\n  // 진행률\n  const progress = useMemo(() => {\n    if (warningItems.length === 0) return 100;\n    return Math.round((completedIds.size / warningItems.length) * 100);\n  }, [warningItems.length, completedIds.size]);\n\n  // 100% 완료 시 자동 닫기\n  useEffect(() => {\n    if (progress === 100 && warningItems.length > 0 && !hasClosedRef.current) {\n      hasClosedRef.current = true;\n      // 300ms 후 모달 자동 닫기\n      setTimeout(() => {\n        onCloseRef.current();\n      }, 300);\n    }\n  }, [progress, warningItems.length]);\n\n  // 🚀 Realtime 이벤트 구독 - 모달이 열려있는 동안 실시간 업데이트\n  const realtimeFirstMount = useRef(true);\n  useEffect(() => {\n    if (!isOpen) return;\n\n    const handleCacheUpdate = () => {\n      if (realtimeFirstMount.current) {\n        realtimeFirstMount.current = false;\n        return;\n      }\n      // Realtime 이벤트 발생 시 부모에게 새로고침 요청\n      onRefresh?.();\n    };\n\n    const unsubscribe = addCacheListener(handleCacheUpdate);\n    return () => unsubscribe();\n  }, [isOpen, onRefresh]);\n\n  // 팝오버 열기\n  const openPopover = useCallback((purchaseId: number, orderNumber: string) => {\n    setOpenPopoverId(purchaseId);\n    setModifySubject(`[입고일 수정요청] ${orderNumber}`);\n    setModifyMessage('');\n  }, []);\n\n  // 수정 요청 전송\n  const sendRequest = useCallback(async (purchase: Purchase) => {\n    if (!modifySubject.trim() || !modifyMessage.trim()) {\n      toast.error('제목과 내용을 모두 입력해주세요.');\n      return;\n    }\n\n    setIsSending(true);\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) {\n        toast.error('로그인이 필요합니다.');\n        return;\n      }\n\n      // 1. 문의하기에 저장\n      const { data: createdInquiry, error: inquiryError } = await supabase\n        .from('support_inquires')\n        .insert({\n          user_id: user.id,\n          user_email: user.email,\n          user_name: currentUserName,\n          inquiry_type: 'modify',\n          subject: modifySubject,\n          message: modifyMessage,\n          status: 'open',\n          purchase_request_id: purchase.id,\n          purchase_order_number: purchase.purchase_order_number,\n          requester_id: purchase.requester_id,\n          purchase_info: JSON.stringify({\n            vendor_name: purchase.vendor_name,\n            delivery_request_date: purchase.delivery_request_date,\n            revised_delivery_request_date: purchase.revised_delivery_request_date\n          })\n        })\n        .select('id')\n        .single();\n\n      if (inquiryError) throw inquiryError;\n\n      // ✅ 대화 로그 첫 메시지 기록 (새 문의 알림/채팅 히스토리용)\n      const inquiryId = createdInquiry?.id\n      if (inquiryId) {\n        const { error: msgError } = await supabase\n          .from('support_inquiry_messages')\n          .insert({\n            inquiry_id: inquiryId,\n            sender_role: 'user',\n            sender_email: user.email,\n            message: modifyMessage,\n            attachments: []\n          })\n        if (msgError) throw msgError\n      }\n\n      // 2. 수정요청완료 플래그 업데이트\n      const { error: updateError } = await supabase\n        .from('purchase_requests')\n        .update({\n          delivery_revision_requested: true,\n          delivery_revision_requested_at: new Date().toISOString(),\n          delivery_revision_requested_by: currentUserName || 'unknown'\n        })\n        .eq('id', purchase.id);\n\n      if (updateError) throw updateError;\n\n      // 3. 메모리 캐시 즉시 업데이트 (deliveryWarningCount 재계산용)\n      const updated = updatePurchaseInMemory(purchase.id, (p) => ({\n        ...p,\n        delivery_revision_requested: true,\n        delivery_revision_requested_at: new Date().toISOString(),\n        delivery_revision_requested_by: currentUserName || 'unknown'\n      }));\n      if (updated) {\n        notifyCacheListeners(); // 구독자들에게 알림\n      }\n\n      // 4. 로컬 상태 즉시 업데이트 (UI 즉시 반영)\n      setCompletedIds(prev => new Set(prev).add(purchase.id));\n      setOpenPopoverId(null);\n      setModifySubject('');\n      setModifyMessage('');\n      toast.success('수정 요청이 전송되었습니다.');\n\n    } catch (error: any) {\n      console.error('수정 요청 실패:', error);\n      toast.error('수정 요청 전송에 실패했습니다.');\n    } finally {\n      setIsSending(false);\n    }\n  }, [supabase, currentUserName, modifySubject, modifyMessage]);\n\n  // 닫기 핸들러\n  const handleClose = useCallback(() => {\n    if (allCompleted) {\n      onClose();\n    } else {\n      toast.error(`모든 항목(${warningItems.length}건)에 대해 수정요청을 완료해주세요.`);\n    }\n  }, [allCompleted, onClose, warningItems.length]);\n\n  // 날짜 포맷\n  const formatDate = (dateStr: string | undefined | null) => {\n    if (!dateStr) return '-';\n    const d = new Date(dateStr);\n    return `${d.getFullYear()}.${String(d.getMonth() + 1).padStart(2, '0')}.${String(d.getDate()).padStart(2, '0')}`;\n  };\n\n  // 카드 클릭 시 상세 모달 열기\n  const handleCardClick = useCallback((purchaseId: number) => {\n    setDetailModalPurchaseId(purchaseId);\n    setIsDetailModalOpen(true);\n  }, []);\n\n  // 상세 모달 닫기 - 입고완료 처리 확인 및 경고 항목 업데이트\n  const handleDetailModalClose = useCallback(() => {\n    const purchaseIdToCheck = detailModalPurchaseId;\n    \n    setIsDetailModalOpen(false);\n    setDetailModalPurchaseId(null);\n    \n    if (purchaseIdToCheck) {\n      // 1. 메모리 캐시에서 즉시 확인 (지연 없음)\n      const memoryPurchase = findPurchaseInMemory(purchaseIdToCheck);\n      \n      if (memoryPurchase) {\n        const isReceived = memoryPurchase.is_received || memoryPurchase.delivery_status === 'completed';\n        \n        if (isReceived) {\n          // 즉시 경고 항목에서 제거\n          setWarningItems(prev => {\n            const filtered = prev.filter(item => item.purchase.id !== purchaseIdToCheck);\n            return filtered;\n          });\n          \n          setFixedWarningItems(prev => prev.filter(item => item.purchase.id !== purchaseIdToCheck));\n          setCompletedIds(prev => new Set(prev).add(purchaseIdToCheck));\n        }\n      } else {\n        // 메모리 캐시에 없으면 purchases prop에서 확인 (fallback)\n        const currentPurchase = purchases.find(p => p.id === purchaseIdToCheck);\n        \n        if (currentPurchase) {\n          const isReceived = currentPurchase.is_received || currentPurchase.delivery_status === 'completed';\n          \n          if (isReceived) {\n            setWarningItems(prev => prev.filter(item => item.purchase.id !== purchaseIdToCheck));\n            setFixedWarningItems(prev => prev.filter(item => item.purchase.id !== purchaseIdToCheck));\n            setCompletedIds(prev => new Set(prev).add(purchaseIdToCheck));\n          }\n        }\n      }\n      \n      // 2. 백그라운드에서 onRefresh 호출 (prop 업데이트용)\n      onRefresh?.(false, { silent: true });\n    }\n  }, [detailModalPurchaseId, purchases, onRefresh]);\n\n  if (warningItems.length === 0) return null;\n\n  return (\n    <>\n      <Dialog open={isOpen} onOpenChange={(open) => !open && handleClose()}>\n        <DialogContent className=\"max-w-2xl max-h-[80vh] flex flex-col p-0 gap-0\" showCloseButton={false}>\n          {/* 헤더 */}\n          <DialogHeader className=\"px-5 py-4 border-b\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-3\">\n                <AlertCircle className=\"w-5 h-5 text-red-500\" />\n                <DialogTitle className=\"page-title text-base\">\n                  입고 일정 지연 알림\n                </DialogTitle>\n              </div>\n              <span className=\"text-xs text-gray-500\">\n                {completedIds.size}/{warningItems.length} 완료\n              </span>\n            </div>\n            <Progress value={progress} className=\"h-1 mt-3\" />\n          </DialogHeader>\n\n          {/* 본문 */}\n          <div className=\"flex-1 overflow-auto p-4 space-y-2\">\n            {warningItems.map((item) => {\n              const isCompleted = completedIds.has(item.purchase.id);\n\n              return (\n                <div\n                  key={item.purchase.id}\n                  className={`border rounded-lg p-3 transition-all duration-200 cursor-pointer hover:border-hansl-400 ${\n                    isCompleted ? 'bg-gray-50 opacity-60' : 'bg-white'\n                  }`}\n                  onClick={() => handleCardClick(item.purchase.id)}\n                >\n                  <div className=\"flex items-center justify-between gap-3\">\n                    {/* 정보 */}\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"flex items-center gap-2 mb-1\">\n                        <span className=\"text-sm font-medium text-gray-900\">\n                          {item.purchase.purchase_order_number}\n                        </span>\n                        <span className=\"text-xs text-gray-500\">\n                          {item.purchase.vendor_name}\n                        </span>\n                      </div>\n                      <div className=\"flex items-center gap-3 text-xs text-gray-500\">\n                        <span className=\"flex items-center gap-1\">\n                          <Calendar className=\"w-3 h-3\" />\n                          입고요청: {formatDate(item.purchase.delivery_request_date)}\n                        </span>\n                        {item.purchase.revised_delivery_request_date && (\n                          <span>변경: {formatDate(item.purchase.revised_delivery_request_date)}</span>\n                        )}\n                        <span className=\"text-red-500\">{item.daysOverdue}일 경과</span>\n                      </div>\n                    </div>\n\n                    {/* 버튼 */}\n                    <div className=\"flex-shrink-0\" onClick={(e) => e.stopPropagation()}>\n                      {isCompleted ? (\n                        <Button\n                          size=\"sm\"\n                          disabled\n                          className=\"button-base bg-gray-100 text-gray-500 h-7 px-3 text-xs\"\n                        >\n                          <Check className=\"w-3 h-3 mr-1\" />\n                          요청 완료\n                        </Button>\n                      ) : (\n                        <Popover\n                          open={openPopoverId === item.purchase.id}\n                          onOpenChange={(open) => {\n                            if (open) {\n                              openPopover(item.purchase.id, item.purchase.purchase_order_number);\n                            } else {\n                              setOpenPopoverId(null);\n                            }\n                          }}\n                        >\n                          <PopoverTrigger asChild>\n                            <Button\n                              size=\"sm\"\n                              className=\"button-base bg-hansl-600 hover:bg-hansl-700 text-white h-7 px-3 text-xs\"\n                            >\n                              <MessageSquarePlus className=\"w-3 h-3 mr-1\" />\n                              수정 요청\n                            </Button>\n                          </PopoverTrigger>\n                          <PopoverContent\n                            className=\"w-80 p-4\"\n                            align=\"end\"\n                            onOpenAutoFocus={(e) => e.preventDefault()}\n                          >\n                            <div className=\"space-y-3\">\n                              <div>\n                                <h4 className=\"font-medium text-sm\">입고일 수정 요청</h4>\n                                <p className=\"text-xs text-gray-500 mt-0.5\">\n                                  {item.purchase.vendor_name}\n                                </p>\n                              </div>\n                              <div className=\"space-y-2\">\n                                <div>\n                                  <Label className=\"text-xs\">제목</Label>\n                                  <Input\n                                    value={modifySubject}\n                                    onChange={(e) => setModifySubject(e.target.value)}\n                                    className=\"h-8 text-xs mt-1\"\n                                  />\n                                </div>\n                                <div>\n                                  <Label className=\"text-xs\">내용</Label>\n                                  <Textarea\n                                    value={modifyMessage}\n                                    onChange={(e) => setModifyMessage(e.target.value)}\n                                    className=\"min-h-[80px] text-xs mt-1\"\n                                    placeholder=\"변경 요청 내용을 입력하세요\"\n                                  />\n                                </div>\n                              </div>\n                              <div className=\"flex justify-end gap-2\">\n                                <Button\n                                  variant=\"outline\"\n                                  size=\"sm\"\n                                  onClick={() => setOpenPopoverId(null)}\n                                  className=\"button-base h-7 text-xs\"\n                                >\n                                  취소\n                                </Button>\n                                <Button\n                                  size=\"sm\"\n                                  onClick={() => sendRequest(item.purchase)}\n                                  disabled={isSending}\n                                  className=\"button-base bg-hansl-600 hover:bg-hansl-700 text-white h-7 text-xs\"\n                                >\n                                  {isSending && <Loader2 className=\"w-3 h-3 animate-spin mr-1\" />}\n                                  요청 전송\n                                </Button>\n                              </div>\n                            </div>\n                          </PopoverContent>\n                        </Popover>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n\n          {/* 푸터 */}\n          <div className=\"border-t px-5 py-3\">\n            <p className=\"text-xs text-gray-500 text-center\">\n              ℹ️ 모든 수정 요청이 완료되면 이 창이 자동으로 닫힙니다\n            </p>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* 상세 모달 - 발주요청관리 > 입고현황 탭의 상세 모달과 동일 */}\n      {detailModalPurchaseId && (\n        <Suspense fallback={\n          <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-[100]\">\n            <Loader2 className=\"w-8 h-8 animate-spin text-white\" />\n          </div>\n        }>\n          <PurchaseDetailModal\n            purchaseId={detailModalPurchaseId}\n            isOpen={isDetailModalOpen}\n            onClose={handleDetailModalClose}\n            activeTab=\"receipt\"\n            onRefresh={async (silent, options) => {\n              // 상세 모달에서 입고완료 처리 시 부모에게 새로고침 요청\n              if (onRefresh) {\n                const result = onRefresh(silent, options);\n                if (result instanceof Promise) {\n                  await result;\n                }\n              }\n              \n              // 입고완료 처리 후 메모리 캐시에서 즉시 확인하여 경고 항목 제거\n              const currentPurchaseId = detailModalPurchaseIdRef.current;\n              if (currentPurchaseId) {\n                // 약간의 지연 후 메모리 캐시 확인 (입고완료 처리 완료 대기)\n                setTimeout(() => {\n                  const memoryPurchase = findPurchaseInMemory(currentPurchaseId);\n                  \n                  if (memoryPurchase) {\n                    const isReceived = memoryPurchase.is_received || memoryPurchase.delivery_status === 'completed';\n                    \n                    if (isReceived) {\n                      // 즉시 경고 항목에서 제거\n                      setWarningItems(prev => prev.filter(item => item.purchase.id !== currentPurchaseId));\n                      setFixedWarningItems(prev => prev.filter(item => item.purchase.id !== currentPurchaseId));\n                      setCompletedIds(prev => new Set(prev).add(currentPurchaseId));\n                    }\n                  }\n                }, 100); // 100ms 지연으로 입고완료 처리 완료 대기\n              }\n            }}\n          />\n        </Suspense>\n      )}\n    </>\n  );\n}\n\n// 경고 항목 수 계산 훅\nexport function useDeliveryWarningCount(purchases: Purchase[], currentUserName?: string | null): number {\n  return useMemo(() => {\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n\n    let count = 0;\n    const debugItems: any[] = [];\n\n    purchases.forEach(purchase => {\n      // F20251226_003 항목 디버깅\n      const isTarget = purchase.purchase_order_number === 'F20251226_003';\n      \n      if (purchase.is_received || purchase.delivery_status === 'completed') {\n        if (isTarget) debugItems.push({ step: '입고완료로 제외', purchase: purchase.purchase_order_number });\n        return;\n      }\n      if (purchase.middle_manager_status !== 'approved' || purchase.final_manager_status !== 'approved') {\n        if (isTarget) debugItems.push({ \n          step: '승인 미완료로 제외', \n          purchase: purchase.purchase_order_number,\n          middle: purchase.middle_manager_status,\n          final: purchase.final_manager_status\n        });\n        return;\n      }\n      if (currentUserName && purchase.requester_name !== currentUserName) {\n        if (isTarget) debugItems.push({ \n          step: '본인 발주 아님으로 제외', \n          purchase: purchase.purchase_order_number,\n          requester_name: purchase.requester_name,\n          currentUserName\n        });\n        return;\n      }\n      if (purchase.delivery_revision_requested === true) {\n        if (isTarget) debugItems.push({ \n          step: '수정요청 완료로 제외', \n          purchase: purchase.purchase_order_number \n        });\n        return;\n      }\n\n      const deliveryDate = purchase.delivery_request_date ? new Date(purchase.delivery_request_date) : null;\n      const revisedDate = purchase.revised_delivery_request_date ? new Date(purchase.revised_delivery_request_date) : null;\n\n      if (deliveryDate) deliveryDate.setHours(0, 0, 0, 0);\n      if (revisedDate) revisedDate.setHours(0, 0, 0, 0);\n\n      if (revisedDate && revisedDate < today) {\n        count++;\n        if (isTarget) debugItems.push({ \n          step: '변경요청일 지연으로 포함', \n          purchase: purchase.purchase_order_number,\n          revisedDate: dateToISOString(revisedDate),\n          today: today.toISOString()\n        });\n        return;\n      }\n\n      if (deliveryDate && deliveryDate < today && !revisedDate) {\n        count++;\n        if (isTarget) debugItems.push({ \n          step: '입고요청일 지연으로 포함', \n          purchase: purchase.purchase_order_number,\n          deliveryDate: dateToISOString(deliveryDate),\n          today: today.toISOString()\n        });\n        return;\n      }\n      \n      if (isTarget) {\n        debugItems.push({ \n          step: '날짜 조건 불만족', \n          purchase: purchase.purchase_order_number,\n          deliveryDate: deliveryDate ? dateToISOString(deliveryDate) : null,\n          revisedDate: revisedDate ? dateToISOString(revisedDate) : null,\n          today: today.toISOString()\n        });\n      }\n    });\n\n    // 디버깅 로그 출력\n    if (debugItems.length > 0) {\n      console.log('🔍 [useDeliveryWarningCount] F20251226_003 디버깅:', debugItems);\n    }\n    \n    // F20251226_003 항목이 purchases에 있는지 확인\n    const targetPurchase = purchases.find(p => p.purchase_order_number === 'F20251226_003');\n    if (targetPurchase) {\n      console.log('🔍 [useDeliveryWarningCount] F20251226_003 항목 상세 정보:', {\n        purchase_order_number: targetPurchase.purchase_order_number,\n        requester_name: targetPurchase.requester_name,\n        currentUserName,\n        nameMatch: targetPurchase.requester_name === currentUserName,\n        is_received: targetPurchase.is_received,\n        delivery_status: targetPurchase.delivery_status,\n        middle_manager_status: targetPurchase.middle_manager_status,\n        final_manager_status: targetPurchase.final_manager_status,\n        delivery_revision_requested: targetPurchase.delivery_revision_requested,\n        delivery_request_date: targetPurchase.delivery_request_date,\n        revised_delivery_request_date: targetPurchase.revised_delivery_request_date,\n        today: today.toISOString(),\n        finalCount: count\n      });\n    }\n\n    return count;\n  }, [purchases, currentUserName]);\n}\n"],"file":"assets/DeliveryDateWarningModal-DQNdFWCn.js"}