const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/exceljs.min-0ErSvM8v.js","assets/index-Dn0C8hlu.js","assets/index-BvFHlzzL.css","assets/PurchaseItemsModal-DFpO94Ra.js","assets/input-qj27tG5y.js","assets/index-C4q8KAfy.js","assets/PurchaseDetailModal-C-nAcXvr.js","assets/helpers-CsHcdtkA.js","assets/calendar-CJSwo784.js","assets/chevron-right-gjWH000m.js","assets/chevron-down-ChckHpzP.js","assets/popover-B2qm7xGb.js","assets/calendar-TYgVm03w.js","assets/package-CxxfcTN2.js","assets/credit-card-DPHBdA7A.js","assets/card-CUOrr6Q0.js","assets/plus-uCe3GJev.js","assets/save-C807h-nW.js"])))=>i.map(i=>d[i]);
import{c as e,l as t,r as a,p as s,j as r,_ as l,a as n,g as i,h as c,k as d,m as o,n as m,o as u,q as p,P as h,s as x,t as g,v as b,B as _,w as y,X as f,U as j,u as v,x as w,d as N,y as C,z as k,A as q,C as $}from"./index-Dn0C8hlu.js";import{P as S}from"./PurchaseDetailModal-C-nAcXvr.js";import{f as D,a as F}from"./helpers-CsHcdtkA.js";import{E as M}from"./eye-HRamImSP.js";import{t as A}from"./index-C4q8KAfy.js";import{f as P,R,P as E,W as I,C as T,T as z,g as L,h as O,O as V,i as B,I as U}from"./input-qj27tG5y.js";import{D as Y,a as W,b as J,c as K,d as G,e as Z,A as H}from"./dropdown-menu-B9_mjVEZ.js";import{u as X,S as Q,a as ee,b as te,c as ae,d as se}from"./select-aySc-pqU.js";import{C as re}from"./chevron-down-ChckHpzP.js";import{R as le}from"./rotate-ccw-D2mSwlSw.js";import{P as ne,a as ie,b as ce}from"./popover-B2qm7xGb.js";import{C as de,f as oe,a as me}from"./calendar-CJSwo784.js";import{C as ue}from"./calendar-TYgVm03w.js";import{P as pe}from"./package-CxxfcTN2.js";import{S as he,C as xe,a as ge,b as be,c as _e}from"./card-CUOrr6Q0.js";import{P as ye}from"./plus-uCe3GJev.js";import"./credit-card-DPHBdA7A.js";import"./save-C807h-nW.js";import"./chevron-right-gjWH000m.js";
/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=e("building",[["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3",key:"cabbwy"}],["rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",key:"1uxh74"}]]),je=e("dollar-sign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),ve=e("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),we=e("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),Ne=e("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Ce=e("sliders-vertical",[["line",{x1:"4",x2:"4",y1:"21",y2:"14",key:"1p332r"}],["line",{x1:"4",x2:"4",y1:"10",y2:"3",key:"gb41h5"}],["line",{x1:"12",x2:"12",y1:"21",y2:"12",key:"hf2csr"}],["line",{x1:"12",x2:"12",y1:"8",y2:"3",key:"1kfi7u"}],["line",{x1:"20",x2:"20",y1:"21",y2:"16",key:"1lhrwl"}],["line",{x1:"20",x2:"20",y1:"12",y2:"3",key:"16vvfq"}],["line",{x1:"2",x2:"6",y1:"14",y2:"14",key:"1uebub"}],["line",{x1:"10",x2:"14",y1:"8",y2:"8",key:"1yglbp"}],["line",{x1:"18",x2:"22",y1:"16",y2:"16",key:"1jxqpz"}]]),ke=["ì •í¬ì›…"],qe=(e,a,s)=>{if(!e||!s)return[];const r=Array.isArray(s.purchase_role)?s.purchase_role.map(e=>e.trim()):"string"==typeof s.purchase_role?s.purchase_role.split(",").map(e=>e.trim()):[];switch(a){case"pending":return e.filter(e=>{if("approved"===e.middle_manager_status&&"approved"===e.final_manager_status)return!1;if("rejected"===e.middle_manager_status||"rejected"===e.final_manager_status)return!1;if(r.includes("consumable_manager")&&"êµ¬ë§¤ ìš”ì²­"!==e.payment_category)return!1;if(r.includes("raw_material_manager")&&"ë°œì£¼"!==e.payment_category)return!1;if(r.includes("app_admin")||r.includes("ceo"))return t.debug("ğŸ”¥ App Admin detected! Showing all items for:",{purchase_order_number:e.purchase_order_number}),!0;if(r.includes("middle_manager")){return["pending","ëŒ€ê¸°","",null,void 0].includes(e.middle_manager_status)}return e.requester_name===s?.name});case"purchase":return e.filter(e=>{const t="êµ¬ë§¤ ìš”ì²­"===e.payment_category,a=!e.is_payment_completed;if(!t||!a)return!1;const s=(e.progress_type||"").includes("ì„ ì§„í–‰"),r=(e.progress_type||"").includes("ì¼ë°˜")||!e.progress_type||""===e.progress_type,l="approved"===e.final_manager_status;return s||r&&l});case"receipt":return e.filter(e=>{if(e.is_received)return!1;const t=(e.progress_type||"").includes("ì„ ì§„í–‰"),a="approved"===e.final_manager_status;return t||a});default:return e}},$e=(e,t)=>{if("is_payment_completed"===t){return!0===e.is_payment_completed?"ì™„ë£Œ":"ëŒ€ê¸°"}if("is_received"===t){return!0===e.is_received?"ì™„ë£Œ":"ëŒ€ê¸°"}if("is_statement_received"===t){return!0===e.is_statement_received?"ì™„ë£Œ":"ëŒ€ê¸°"}if("is_utk_checked"===t){return!0===e.is_utk_checked?"ì™„ë£Œ":"ëŒ€ê¸°"}const a=t.split(".");let s=e;for(const r of a){if(null==s)return null;s=s[r]}return s},Se=(e,t,a)=>{let s=e;return t.tab&&(s=qe(s,t.tab,a)),t.employeeName&&(s=((e,t,a)=>{if(!e||!t||"ì „ì²´"===t)return e;const s=(Array.isArray(a?.purchase_role)?a.purchase_role.map(e=>e.trim()):"string"==typeof a?.purchase_role?a.purchase_role.split(",").map(e=>e.trim()):[]).some(e=>["lead_buyer","ceo","finance_team","raw_material_manager","consumable_manager"].includes(e));return e.filter(e=>{const a=e.requester_name||"";return!(ke.includes(a)&&!s)&&a===t})})(s,t.employeeName,a)),t.searchTerm&&(s=((e,t)=>{if(!t||""===t.trim())return e;const a=t.toLowerCase().trim();return e.filter(e=>[e.purchase_order_number,e.requester_name,e.purchase_order_number,e.vendor_name,...(e.purchase_request_items||[]).map(e=>[e.item_name,e.item_detail,e.manufacturer,e.model,e.spec]).flat()].some(e=>e&&String(e).toLowerCase().includes(a)))})(s,t.searchTerm)),t.advancedFilters&&(s=((e,t)=>t&&0!==t.length?e.filter(e=>t.every(t=>{const{field:a,condition:s,value:r,dateField:l}=t,n=$e(e,l||a);switch(s){case"contains":return String(n).toLowerCase().includes(String(r).toLowerCase());case"equals":if("string"==typeof r&&r.includes("~")){const[e,t]=r.split("~"),a=new Date(n).toISOString().split("T")[0];return a>=e&&a<=t}if("string"==typeof r&&(r.match(/^\d{4}-\d{2}$/)||r.match(/^\d{4}-\d{2}~\d{4}-\d{2}$/))){if(r.includes("~")){const[e,t]=r.split("~"),a=new Date(n).toISOString().slice(0,7);return a>=e&&a<=t}return new Date(n).toISOString().slice(0,7)===r}return n===r;case"not_equals":return n!==r;case"starts_with":return String(n).toLowerCase().startsWith(String(r).toLowerCase());case"ends_with":return String(n).toLowerCase().endsWith(String(r).toLowerCase());case"greater_than":return Number(n)>Number(r);case"less_than":return Number(n)<Number(r);case"after":return new Date(n)>new Date(r);case"before":return new Date(n)<new Date(r);case"is_empty":return!n||""===n||null===n;case"is_not_empty":return n&&""!==n&&null!==n;case"between":{const[e,t]=r.split(",").map(Number),a=Number(n);return a>=e&&a<=t}case"in":return r.split(",").map(e=>e.trim()).includes(String(n));default:return!0}})):e)(s,t.advancedFilters)),(t.startDate||t.endDate)&&(s=((e,t,a)=>t||a?e.filter(e=>{const s=new Date(e.request_date);return!(t&&s<new Date(t)||a&&s>new Date(a))}):e)(s,t.startDate,t.endDate)),t.sortConfig&&(s=((e,t)=>t?[...e].sort((e,a)=>{const s=$e(e,t.key),r=$e(a,t.key);if(null==s)return 1;if(null==r)return-1;let l=0;return s>r&&(l=1),s<r&&(l=-1),"desc"===t.direction?-l:l}):e)(s,t.sortConfig)),s};function De(){const[e,t]=a.useState([]),[r,l]=a.useState(!1),[n,i]=a.useState(null),c=s.currentUser;a.useEffect(()=>{let e=s.allPurchases,a=s.lastFetch;const r=()=>{const r=s.allPurchases!==e,n=s.lastFetch!==a;(r||n)&&(s.allPurchases?(t([...s.allPurchases]),l(!1),e=s.allPurchases,a=s.lastFetch):l(s.isLoading),i(s.error))};r();const n=setInterval(r,10);return()=>clearInterval(n)},[]);const d=a.useCallback(e=>s.allPurchases?Se(s.allPurchases,e,c):[],[c]),o=a.useMemo(()=>e&&0!==e.length?((e,t)=>({pending:qe(e,"pending",t).length,purchase:qe(e,"purchase",t).length,receipt:qe(e,"receipt",t).length,done:e.length}))(e,c):{pending:0,purchase:0,receipt:0,done:0},[e,c]),m=a.useMemo(()=>({total:e.length,loaded:s.stats?.loadedCount||0,memoryUsage:s.stats?.memoryUsage||0,lastFetch:s.lastFetch}),[e]);return{allPurchases:e,getFilteredPurchases:d,loading:r,error:n,tabCounts:o,stats:m,currentUser:c}}const Fe=a.memo(({purchase:e})=>{const t=e.is_received?"completed":"approved"===e.middle_manager_status&&"approved"===e.final_manager_status?"inProgress":"rejected"===e.middle_manager_status||"rejected"===e.final_manager_status?"rejected":"pending",{text:a,className:s}={completed:{text:"ì…ê³ ì™„ë£Œ",className:"badge-success"},inProgress:{text:"êµ¬ë§¤ì§„í–‰",className:"badge-primary"},rejected:{text:"ë°˜ë ¤",className:"badge-danger"},pending:{text:"ìŠ¹ì¸ëŒ€ê¸°",className:"badge-warning"}}[t];return r.jsx("span",{className:`badge-stats ${s}`,children:a})});Fe.displayName="StatusBadge";const Me=a.memo(({purchase:e,onClick:t})=>{const a=(e=>{if(!e.purchase_request_items||0===e.purchase_request_items.length)return{received:0,total:0,percentage:0};const t=e.purchase_request_items.length,a=e.purchase_request_items.filter(e=>null!==e.actual_received_date&&void 0!==e.actual_received_date).length;return{received:a,total:t,percentage:t>0?Math.round(a/t*100):0}})(e),s="ì„ ì§„í–‰"===e.progress_type||e.progress_type?.includes("ì„ ì§„í–‰");return r.jsxs("div",{className:"bg-white rounded-lg border p-4 space-y-3 cursor-pointer transition-all hover:shadow-md "+(s?"border-red-400 bg-red-50 hover:bg-red-100":"hover:bg-gray-50"),onClick:()=>t(e),children:[r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center gap-2",children:[s?r.jsx("span",{className:"badge-stats bg-red-500 text-white",children:"ì„ ì§„í–‰"}):r.jsx("span",{className:"badge-stats bg-gray-500 text-white",children:"ì¼ë°˜"}),r.jsx("span",{className:"card-title text-gray-900",children:e.purchase_order_number||"-"})]}),r.jsxs("div",{className:"badge-text text-gray-500 mt-1",children:[D(e.request_date)," ìš”ì²­"]})]}),r.jsx(Fe,{purchase:e})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[r.jsx("span",{className:"text-gray-600",children:"ìš”ì²­ì"}),r.jsx("span",{className:"card-title",children:e.requester_name})]}),r.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[r.jsx("span",{className:"text-gray-600",children:"ì—…ì²´"}),r.jsx("span",{className:"card-title",children:e.vendor_name})]}),e.project_vendor&&r.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[r.jsx("span",{className:"text-gray-600",children:"PJì—…ì²´"}),r.jsx("span",{className:"card-title truncate max-w-[150px]",children:e.project_vendor})]}),e.project_item&&r.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[r.jsx("span",{className:"text-gray-600",children:"PJ ITEM"}),r.jsx("span",{className:"card-title truncate max-w-[150px]",children:e.project_item})]}),e.sales_order_number&&r.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[r.jsx("span",{className:"text-gray-600",children:"ìˆ˜ì£¼ë²ˆí˜¸"}),r.jsx("span",{className:"card-title truncate max-w-[150px]",children:e.sales_order_number})]}),e.item_name&&r.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[r.jsx("span",{className:"text-gray-600",children:"í’ˆëª©"}),r.jsx("span",{className:"card-title truncate max-w-[150px]",children:e.item_name})]}),r.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[r.jsx("span",{className:"text-gray-600",children:"ê¸ˆì•¡"}),r.jsxs("span",{className:"font-semibold text-gray-900",children:[(e.amount_value||e.total_amount)?.toLocaleString()," ",e.currency]})]})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsxs("div",{className:"flex items-center justify-between badge-text",children:[r.jsx("span",{className:"text-gray-600",children:"ì…ê³ í˜„í™©"}),r.jsxs("span",{className:"text-gray-700",children:[a.received,"/",a.total," (",a.percentage,"%)"]})]}),r.jsx("div",{className:"bg-gray-200 rounded-full h-2",children:r.jsx("div",{className:"h-2 rounded-full transition-all "+(100===a.percentage?"bg-green-500":a.percentage>0?"bg-hansl-500":"bg-gray-300"),style:{width:`${a.percentage}%`}})})]}),void 0!==e.is_payment_completed&&r.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[r.jsx("span",{className:"text-gray-600",children:"ê²°ì œ"}),e.is_payment_completed?r.jsx("span",{className:"badge-stats bg-green-500 text-white",children:"ì™„ë£Œ"}):r.jsx("span",{className:"badge-stats bg-gray-500 text-white",children:"ëŒ€ê¸°"})]}),r.jsx("div",{className:"pt-2 border-t",children:r.jsxs("div",{className:"flex items-center justify-center badge-text text-gray-500",children:[r.jsx(M,{className:"w-3 h-3 mr-1"}),"í´ë¦­í•˜ì—¬ ìƒì„¸ë³´ê¸°"]})})]})});Me.displayName="MobilePurchaseCard";const Ae=F;function Pe(e){return e?["KRW","ì›","â‚©"].includes(e)?"â‚©":["USD","$","ë‹¬ëŸ¬"].includes(e)?"$":["EUR","â‚¬"].includes(e)?"â‚¬":["JPY","ì—”","Â¥"].includes(e)||["CNY","ìœ„ì•ˆ","å…ƒ"].includes(e)?"Â¥":e:""}const Re=[{id:"statement_progress",label:"ê±°ë˜ëª…ì„¸ì„œ",description:"ê±°ë˜ëª…ì„¸ì„œ ìˆ˜ë ¹ ì§„í–‰ë¥ ",defaultVisible:!0},{id:"purchase_order_number",label:"ë°œì£¼ë²ˆí˜¸",description:"ë°œì£¼ìš”ì²­ ë²ˆí˜¸",defaultVisible:!0},{id:"payment_category",label:"ê²°ì œì¢…ë¥˜",description:"ê²°ì œ ë°©ì‹ (êµ¬ë§¤ìš”ì²­, ë°œì£¼, í˜„ì¥ê²°ì œ ë“±)",defaultVisible:!0},{id:"requester_name",label:"ìš”ì²­ì",description:"ë°œì£¼ë¥¼ ìš”ì²­í•œ ì‚¬ìš©ì",defaultVisible:!0},{id:"request_date",label:"ì²­êµ¬ì¼",description:"ë°œì£¼ ìš”ì²­ ë‚ ì§œ",defaultVisible:!0},{id:"utk_status",label:"UTK",description:"UTK í™•ì¸ ìƒíƒœ",defaultVisible:!0},{id:"vendor_name",label:"ì—…ì²´",description:"ê³µê¸‰ì—…ì²´ëª…",defaultVisible:!0},{id:"contact_name",label:"ë‹´ë‹¹ì",description:"ì—…ì²´ ë‹´ë‹¹ìëª…",defaultVisible:!0},{id:"delivery_request_date",label:"ì…ê³ ìš”ì²­ì¼",description:"ì…ê³  ìš”ì²­ ë‚ ì§œ",defaultVisible:!0},{id:"revised_delivery_date",label:"ë³€ê²½ì…ê³ ì¼",description:"ìˆ˜ì •ëœ ì…ê³  ë‚ ì§œ",defaultVisible:!0},{id:"item_name",label:"í’ˆëª…",description:"êµ¬ë§¤ í’ˆëª©ëª…",defaultVisible:!0},{id:"specification",label:"ê·œê²©",description:"í’ˆëª© ê·œê²© ì •ë³´",defaultVisible:!0},{id:"quantity",label:"ìˆ˜ëŸ‰",description:"êµ¬ë§¤ ìˆ˜ëŸ‰",defaultVisible:!0},{id:"unit_price",label:"ë‹¨ê°€",description:"í’ˆëª© ë‹¨ê°€",defaultVisible:!0},{id:"amount",label:"í•©ê³„",description:"ì´ ê¸ˆì•¡",defaultVisible:!0},{id:"remark",label:"ë¹„ê³ ",description:"ì¶”ê°€ ë©”ëª¨ ì‚¬í•­",defaultVisible:!0},{id:"link",label:"ë§í¬",description:"ê´€ë ¨ ë§í¬",defaultVisible:!0},{id:"project_vendor",label:"PJì—…ì²´",description:"í”„ë¡œì íŠ¸ ì—…ì²´",defaultVisible:!0},{id:"project_item",label:"PJ ITEM",description:"í”„ë¡œì íŠ¸ ì•„ì´í…œ",defaultVisible:!0},{id:"sales_order_number",label:"ìˆ˜ì£¼ë²ˆí˜¸",description:"ìˆ˜ì£¼ ë²ˆí˜¸",defaultVisible:!0},{id:"purchase_progress",label:"êµ¬ë§¤ì§„í–‰",description:"êµ¬ë§¤ ì§„í–‰ë¥ ",defaultVisible:!0},{id:"receipt_progress",label:"ì…ê³ ì§„í–‰",description:"ì…ê³  ì§„í–‰ë¥ ",defaultVisible:!0}],Ee=Re.reduce((e,t)=>(e[t.id]=t.defaultVisible,e),{});Re.reduce((e,t)=>(e[t.id]=t,e),{});const Ie=["purchase_order_number","vendor_name","item_name","amount"],Te=[{title:"ê¸°ë³¸ ì •ë³´",columns:["statement_progress","purchase_order_number","payment_category","requester_name","request_date","utk_status"]},{title:"ì—…ì²´ ì •ë³´",columns:["vendor_name","contact_name","delivery_request_date","revised_delivery_date"]},{title:"í’ˆëª© ì •ë³´",columns:["item_name","specification","quantity","unit_price","amount","remark","link"]},{title:"í”„ë¡œì íŠ¸ ì •ë³´",columns:["project_vendor","project_item","sales_order_number"]},{title:"ì§„í–‰ ìƒíƒœ",columns:["purchase_progress","receipt_progress"]}],ze=()=>{const[e,s]=a.useState(Ee),[r,l]=a.useState(!0),[i,c]=a.useState(null),d=n(),o=a.useCallback(async()=>{try{l(!0),c(null);const{data:{user:e},error:a}=await d.auth.getUser();if(a||!e?.email)return t.warn("[useColumnSettings] ì‚¬ìš©ì ì¸ì¦ ì •ë³´ ì—†ìŒ",{authError:a}),void s(Ee);const{data:r,error:n}=await d.from("user_ui_settings").select("setting_value").eq("user_email",e.email).eq("setting_type","column_visibility").eq("setting_key","purchase_list_done").maybeSingle();if(n)return t.error("[useColumnSettings] ì„¤ì • ì¡°íšŒ ì‹¤íŒ¨",n,{userEmail:e.email}),c("ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."),void s(Ee);if(r?.setting_value){const a=r.setting_value,l={...Ee,...a};s(l),t.debug("[useColumnSettings] ì‚¬ìš©ì ì„¤ì • ë¡œë“œ ì™„ë£Œ",{userEmail:e.email,settingsCount:Object.keys(l).length})}else s(Ee),t.debug("[useColumnSettings] ê¸°ë³¸ ì„¤ì • ì‚¬ìš©",{userEmail:e.email})}catch(e){t.error("[useColumnSettings] ì„¤ì • ë¡œë“œ ì¤‘ ì˜ˆì™¸ ë°œìƒ",e),c("ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."),s(Ee)}finally{l(!1)}},[d]),m=a.useCallback(async e=>{try{const{data:{user:a},error:s}=await d.auth.getUser();if(s||!a?.email)return void t.warn("[useColumnSettings] ì‚¬ìš©ì ì¸ì¦ ì •ë³´ ì—†ìŒ - ì €ì¥ ì‹¤íŒ¨",{authError:s});const{error:r}=await d.from("user_ui_settings").upsert({user_email:a.email,setting_type:"column_visibility",setting_key:"purchase_list_done",setting_value:e},{onConflict:"user_email,setting_type,setting_key"});if(r)throw t.error("[useColumnSettings] ì„¤ì • ì €ì¥ ì‹¤íŒ¨",r,{userEmail:a.email,settings:e}),r;t.info("[useColumnSettings] ì„¤ì • ì €ì¥ ì„±ê³µ",{userEmail:a.email,settingsCount:Object.keys(e).length,visibleColumns:Object.entries(e).filter(([,e])=>e).length})}catch(a){throw t.error("[useColumnSettings] ì„¤ì • ì €ì¥ ì¤‘ ì˜ˆì™¸ ë°œìƒ",a),a}},[d]),u=a.useCallback(e=>{s(a=>{const r={...a,[e]:!a[e]};return m(r).catch(e=>{s(a),A.error("ì„¤ì • ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."),t.error("[useColumnSettings] í† ê¸€ ì €ì¥ ì‹¤íŒ¨, ë¡¤ë°± ì²˜ë¦¬",e)}),r})},[m]),p=a.useCallback(()=>{s(Ee),m(Ee).catch(e=>{A.error("ê¸°ë³¸ ì„¤ì • ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."),t.error("[useColumnSettings] ê¸°ë³¸ê°’ ì €ì¥ ì‹¤íŒ¨",e)}),A.success("ì¹¼ëŸ¼ ì„¤ì •ì´ ê¸°ë³¸ê°’ìœ¼ë¡œ ì¬ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.")},[m]);return a.useEffect(()=>{o()},[o]),{columnVisibility:e,toggleColumn:u,resetToDefault:p,isLoading:r,error:i}};var Le="AlertDialog",[Oe,Ve]=c(Le,[P]),Be=P(),Ue=e=>{const{__scopeAlertDialog:t,...a}=e,s=Be(t);return r.jsx(R,{...s,...a,modal:!0})};Ue.displayName=Le;a.forwardRef((e,t)=>{const{__scopeAlertDialog:a,...s}=e,l=Be(a);return r.jsx(B,{...l,...s,ref:t})}).displayName="AlertDialogTrigger";var Ye=e=>{const{__scopeAlertDialog:t,...a}=e,s=Be(t);return r.jsx(E,{...s,...a})};Ye.displayName="AlertDialogPortal";var We=a.forwardRef((e,t)=>{const{__scopeAlertDialog:a,...s}=e,l=Be(a);return r.jsx(V,{...l,...s,ref:t})});We.displayName="AlertDialogOverlay";var Je="AlertDialogContent",[Ke,Ge]=Oe(Je),Ze=o("AlertDialogContent"),He=a.forwardRef((e,t)=>{const{__scopeAlertDialog:s,children:l,...n}=e,c=Be(s),o=a.useRef(null),m=i(t,o),u=a.useRef(null);return r.jsx(I,{contentName:Je,titleName:Xe,docsSlug:"alert-dialog",children:r.jsx(Ke,{scope:s,cancelRef:u,children:r.jsxs(T,{role:"alertdialog",...c,...n,ref:m,onOpenAutoFocus:d(n.onOpenAutoFocus,e=>{e.preventDefault(),u.current?.focus({preventScroll:!0})}),onPointerDownOutside:e=>e.preventDefault(),onInteractOutside:e=>e.preventDefault(),children:[r.jsx(Ze,{children:l}),r.jsx(lt,{contentRef:o})]})})})});He.displayName=Je;var Xe="AlertDialogTitle",Qe=a.forwardRef((e,t)=>{const{__scopeAlertDialog:a,...s}=e,l=Be(a);return r.jsx(z,{...l,...s,ref:t})});Qe.displayName=Xe;var et="AlertDialogDescription",tt=a.forwardRef((e,t)=>{const{__scopeAlertDialog:a,...s}=e,l=Be(a);return r.jsx(L,{...l,...s,ref:t})});tt.displayName=et;var at=a.forwardRef((e,t)=>{const{__scopeAlertDialog:a,...s}=e,l=Be(a);return r.jsx(O,{...l,...s,ref:t})});at.displayName="AlertDialogAction";var st="AlertDialogCancel",rt=a.forwardRef((e,t)=>{const{__scopeAlertDialog:a,...s}=e,{cancelRef:l}=Ge(st,a),n=Be(a),c=i(t,l);return r.jsx(O,{...n,...s,ref:c})});rt.displayName=st;var lt=({contentRef:e})=>{const t=`\`${Je}\` requires a description for the component to be accessible for screen reader users.\n\nYou can add a description to the \`${Je}\` by passing a \`${et}\` component as a child, which also benefits sighted users by adding visible context to the dialog.\n\nAlternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${Je}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.\n\nFor more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return a.useEffect(()=>{document.getElementById(e.current?.getAttribute("aria-describedby"))},[t,e]),null},nt=We,it=He,ct=at,dt=rt,ot=Qe,mt=tt;const ut=Ue,pt=Ye,ht=a.forwardRef(({className:e,...t},a)=>r.jsx(nt,{className:m("fixed inset-0 z-50 bg-black/40 backdrop-blur-sm","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:a}));ht.displayName=nt.displayName;const xt=a.forwardRef(({className:e,...t},a)=>r.jsxs(pt,{children:[r.jsx(ht,{}),r.jsx(it,{ref:a,className:m("fixed left-[50%] top-[50%] z-50","w-full max-w-md translate-x-[-50%] translate-y-[-50%]","grid gap-4 bg-white border border-gray-200","rounded-lg p-6 shadow-professional-xl","duration-200","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0","data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95","data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%]","data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%]",e),...t})]}));xt.displayName=it.displayName;const gt=({className:e,...t})=>r.jsx("div",{className:m("flex flex-col space-y-2 text-left",e),...t});gt.displayName="AlertDialogHeader";const bt=({className:e,...t})=>r.jsx("div",{className:m("flex flex-col-reverse sm:flex-row sm:justify-end gap-3",e),...t});bt.displayName="AlertDialogFooter";const _t=a.forwardRef(({className:e,...t},a)=>r.jsx(ot,{ref:a,className:m("text-lg font-semibold text-gray-800 tracking-tight",e),...t}));_t.displayName=ot.displayName;const yt=a.forwardRef(({className:e,...t},a)=>r.jsx(mt,{ref:a,className:m("text-sm text-gray-600",e),...t}));yt.displayName=mt.displayName;const ft=a.forwardRef(({className:e,...t},a)=>r.jsx(ct,{ref:a,className:m(u(),e),...t}));ft.displayName=ct.displayName;const jt=a.forwardRef(({className:e,...t},a)=>r.jsx(dt,{ref:a,className:m(u({variant:"outline"}),"mt-2 sm:mt-0",e),...t}));jt.displayName=dt.displayName;const vt=a.memo(({purchase:e})=>{const t=e.is_received?"completed":"approved"===e.middle_manager_status&&"approved"===e.final_manager_status?"inProgress":"rejected"===e.middle_manager_status||"rejected"===e.final_manager_status?"rejected":"pending",{text:a,className:s}={completed:{text:"ì…ê³ ì™„ë£Œ",className:"badge-success"},inProgress:{text:"êµ¬ë§¤ì§„í–‰",className:"badge-primary"},rejected:{text:"ë°˜ë ¤",className:"badge-danger"},pending:{text:"ìŠ¹ì¸ëŒ€ê¸°",className:"badge-warning"}}[t];return r.jsx("span",{className:`badge-stats ${s}`,children:a})});vt.displayName="StatusBadge";const wt=e=>e?["KRW","ì›","â‚©"].includes(e)?"â‚©":["USD","$","ë‹¬ëŸ¬"].includes(e)?"$":["EUR","â‚¬"].includes(e)?"â‚¬":["JPY","ì—”","Â¥"].includes(e)||["CNY","ìœ„ì•ˆ","å…ƒ"].includes(e)?"Â¥":e:"â‚©",Nt="text-center w-20 min-w-[85px] max-w-[85px]",Ct="pl-2 w-38 min-w-[155px] max-w-[155px]",kt="pl-2 w-36 min-w-[140px] max-w-[140px]",qt="text-center w-20 min-w-[85px] max-w-[85px]",$t="w-16 min-w-[68px] max-w-[68px]",St="text-center px-2 w-16 min-w-[64px] max-w-[68px]",Dt="pl-3 pr-2 w-32 min-w-[130px] max-w-[130px]",Ft="w-16 min-w-[68px] max-w-[68px]",Mt="w-20 min-w-[85px] max-w-[85px]",At="w-20 min-w-[85px] max-w-[85px]",Pt="w-28 min-w-[120px] max-w-[120px]",Rt="w-64 min-w-[260px] max-w-[260px]",Et="text-center w-14 min-w-[60px] max-w-[60px]",It="text-right w-24 min-w-[100px] max-w-[100px]",Tt="text-right w-24 min-w-[100px] max-w-[100px]",zt="w-28 min-w-[115px] max-w-[115px]",Lt="w-24 min-w-[105px] max-w-[105px]",Ot="w-28 min-w-[115px] max-w-[115px]",Vt="w-44 min-w-[180px] max-w-[180px]",Bt="text-center w-20 min-w-[85px] max-w-[85px]",Ut="text-center w-20 min-w-[85px] max-w-[85px]",Yt="text-center w-24 min-w-[100px] max-w-[100px]",Wt="w-20 min-w-[85px] max-w-[85px]",Jt="text-center w-14 min-w-[56px] max-w-[60px]",Kt=a.memo(({purchase:e})=>{const{allPurchases:t}=De(),a=t?.find(t=>t.id===e.id)||e,s="approved"===a.middle_manager_status,l="rejected"===a.middle_manager_status,n="approved"===a.final_manager_status,i="rejected"===a.final_manager_status;return l||i?r.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[r.jsx("div",{className:"flex items-center gap-0.5",children:r.jsx("div",{className:"w-1.5 h-1.5 bg-red-500 rounded-full animate-pulse"})}),r.jsx("span",{className:"badge-stats bg-red-500 text-white",children:"ë°˜ë ¤"})]}):s&&n?r.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[r.jsx("div",{className:"flex items-center gap-0.5",children:r.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"})}),r.jsx("span",{className:"badge-stats bg-green-500 text-white",children:"ìŠ¹ì¸ì™„ë£Œ"})]}):!s||n||i?r.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full"}),r.jsx("div",{className:"w-3 h-0.5 bg-gray-300"}),r.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full"})]}),r.jsx("span",{className:"badge-stats bg-gray-500 text-white",children:"ìŠ¹ì¸ëŒ€ê¸°"})]}):r.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),r.jsx("div",{className:"w-3 h-0.5 bg-gray-300"}),r.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full"})]}),r.jsx("span",{className:"badge-stats bg-yellow-500 text-white",children:"1ì°¨ ìŠ¹ì¸"})]})});Kt.displayName="ApprovalStatusBadge";const Gt=a.memo(({purchase:e,activeTab:t})=>{const{allPurchases:a}=De(),s=a?.find(t=>t.id===e.id)||e;if("done"===t&&"êµ¬ë§¤ ìš”ì²­"!==s.payment_category)return r.jsx("div",{className:"flex items-center justify-center",children:r.jsx("span",{className:"card-title text-gray-500",children:"-"})});if(s.is_payment_completed)return r.jsxs("div",{className:"flex items-center justify-center gap-1",children:[r.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:r.jsx("div",{className:"h-1.5 rounded-full bg-orange-500",style:{width:"100%"}})}),r.jsx("span",{className:"card-title text-gray-600",children:"100%"})]});if(!s.purchase_request_items||0===s.purchase_request_items.length)return r.jsxs("div",{className:"flex items-center justify-center gap-1",children:[r.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:r.jsx("div",{className:"h-1.5 rounded-full bg-gray-300",style:{width:"0%"}})}),r.jsx("span",{className:"card-title text-gray-600",children:"0%"})]});const l=s.purchase_request_items.length,n=s.purchase_request_items.filter(e=>!0===e.is_payment_completed).length,i=l>0?Math.round(n/l*100):0;return r.jsxs("div",{className:"flex items-center justify-center gap-1",children:[r.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:r.jsx("div",{className:"h-1.5 rounded-full "+(100===i?"bg-orange-500":i>0?"bg-orange-400":"bg-gray-300"),style:{width:`${i}%`}})}),r.jsxs("span",{className:"card-title text-gray-600",children:[i,"%"]})]})});Gt.displayName="PaymentProgressBar";const Zt=a.memo(({purchase:e})=>{const{allPurchases:t}=De(),a=t?.find(t=>t.id===e.id)||e;if(!a.purchase_request_items||0===a.purchase_request_items.length)return r.jsxs("div",{className:"flex items-center justify-center gap-1",children:[r.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:r.jsx("div",{className:"h-1.5 rounded-full bg-gray-300",style:{width:"0%"}})}),r.jsx("span",{className:"card-title text-gray-600",children:"0%"})]});const s=a.purchase_request_items.length,l=a.purchase_request_items.filter(e=>!0===e.is_received).length,n=s>0?Math.round(l/s*100):0;return r.jsxs("div",{className:"flex items-center justify-center gap-1",children:[r.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:r.jsx("div",{className:"h-1.5 rounded-full "+(100===n?"bg-blue-500":n>0?"bg-blue-400":"bg-gray-300"),style:{width:`${n}%`}})}),r.jsxs("span",{className:"card-title text-gray-600",children:[n,"%"]})]})});Zt.displayName="ReceiptProgressBar";const Ht=a.memo(({purchase:e})=>{const{allPurchases:t}=De(),s=a.useMemo(()=>{if(!t)return e;return t.find(t=>t.id===e.id)||e},[t,e.id,e]),l=a.useMemo(()=>{const e=s.purchase_request_items||s.items||[];if(0===e.length)return{completed:0,total:1,percentage:0};const t=e.length,a=e.filter(e=>!0===e.is_statement_received).length;return{completed:a,total:t,percentage:t>0?Math.round(a/t*100):0}},[s]);return r.jsxs("div",{className:"flex items-center justify-center gap-1",children:[r.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:r.jsx("div",{className:"h-1.5 rounded-full "+(100===l.percentage?"bg-green-500":l.percentage>0?"bg-green-400":"bg-gray-300"),style:{width:`${l.percentage}%`}})}),r.jsxs("span",{className:"card-title text-gray-600",children:[l.percentage,"%"]})]})});Ht.displayName="StatementProgressBar";a.memo(({type:e})=>"ì„ ì§„í–‰"===e||e?.includes("ì„ ì§„í–‰")?r.jsx("span",{className:"badge-stats bg-red-500 text-white",children:"ì„ ì§„í–‰"}):r.jsx("span",{className:"badge-stats bg-gray-500 text-white",children:"ì¼ë°˜"})).displayName="ProgressTypeBadge";const Xt=a.memo(({purchase:e,onClick:t,activeTab:a,isLeadBuyer:s,onPaymentComplete:l,onReceiptComplete:n,onExcelDownload:i,columnVisibility:c})=>{const d="ì„ ì§„í–‰"===e.progress_type||e.progress_type?.includes("ì„ ì§„í–‰"),o=e=>"done"!==a||!c||!1!==c[e];return r.jsxs("tr",{className:"border-b hover:bg-gray-100 cursor-pointer transition-colors "+(d?"bg-red-50 hover:bg-red-100":""),onClick:()=>t(e),children:["pending"===a&&r.jsx("td",{className:`px-2 py-1.5 whitespace-nowrap ${Nt}`,children:r.jsx(Kt,{purchase:e})}),"purchase"===a&&r.jsx("td",{className:`px-2 py-1.5 ${Bt}`,children:r.jsx(Gt,{purchase:e,activeTab:a})}),"receipt"===a&&r.jsx("td",{className:`px-2 py-1.5 ${Bt}`,children:r.jsx(Zt,{purchase:e})}),"done"===a&&o("statement_progress")&&r.jsx("td",{className:`px-2 py-1.5 ${Bt}`,children:r.jsx(Ht,{purchase:e})}),o("purchase_order_number")&&r.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${"purchase"===a?kt:Ct}`,children:r.jsxs("div",{className:"flex items-center gap-1",children:[i&&r.jsx("img",{src:"/excels-icon.svg",alt:"ì—‘ì…€ ë‹¤ìš´ë¡œë“œ",width:"16",height:"16",className:`inline-block align-middle transition-transform p-0.5 rounded\n                ${e.is_po_download?"border border-gray-400":""}\n                ${"ì„ ì§„í–‰"===e.progress_type||e.progress_type?.includes("ì„ ì§„í–‰")||"approved"===e.middle_manager_status&&"approved"===e.final_manager_status?e.is_po_download?"cursor-pointer":"cursor-pointer hover:scale-110":"opacity-40 grayscale cursor-not-allowed"}`,onClick:async t=>{("ì„ ì§„í–‰"===e.progress_type||e.progress_type?.includes("ì„ ì§„í–‰")||"approved"===e.middle_manager_status&&"approved"===e.final_manager_status)&&(t.stopPropagation(),await i(e))},style:{pointerEvents:"ì„ ì§„í–‰"===e.progress_type||e.progress_type?.includes("ì„ ì§„í–‰")||"approved"===e.middle_manager_status&&"approved"===e.final_manager_status?"auto":"none"},title:e.is_po_download?"ë‹¤ìš´ë¡œë“œ ì™„ë£Œ":"ì—‘ì…€ ë°œì£¼ì„œ ë‹¤ìš´ë¡œë“œ"}),r.jsxs("span",{className:"block truncate",title:e.purchase_order_number||"",children:[e.purchase_order_number||"-",e.purchase_request_items&&e.purchase_request_items.length>1&&r.jsxs("span",{className:"text-gray-500 ml-0.5",children:["(",e.purchase_request_items.length,")"]})]})]})}),("pending"===a||"purchase"===a||"receipt"===a||!a||"done"===a&&o("payment_category"))&&r.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${qt}`,children:r.jsx("span",{className:"badge-stats "+("êµ¬ë§¤ìš”ì²­"===e.payment_category||"êµ¬ë§¤ ìš”ì²­"===e.payment_category?"bg-blue-500 text-white":"ë°œì£¼"===e.payment_category?"bg-green-500 text-white":("í˜„ì¥ê²°ì œ"===e.payment_category||"í˜„ì¥ ê²°ì œ"===e.payment_category||e.payment_category,"bg-gray-500 text-white")),children:"ë°œì£¼"===e.payment_category?"ë°œì£¼ìš”ì²­":"êµ¬ë§¤ ìš”ì²­"===e.payment_category?"êµ¬ë§¤ìš”ì²­":"í˜„ì¥ ê²°ì œ"===e.payment_category?"í˜„ì¥ê²°ì œ":e.payment_category||"-"})}),o("requester_name")&&r.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${$t}`,children:r.jsx("span",{className:"block truncate",title:e.requester_name||"",children:e.requester_name||"-"})}),o("request_date")&&r.jsx("td",{className:`py-1.5 card-title whitespace-nowrap ${St}`,children:D(e.request_date)}),"done"===a&&o("utk_status")&&r.jsx("td",{className:`pl-2 pr-3 py-1.5 card-title whitespace-nowrap text-center overflow-visible text-clip ${Jt}`,children:r.jsx("span",{className:e.is_utk_checked?"badge-utk-complete":"badge-utk-pending",children:e.is_utk_checked?"ì™„ë£Œ":"ëŒ€ê¸°"})}),o("vendor_name")&&r.jsx("td",{className:`pl-3 pr-2 py-1.5 card-title ${Dt}`,children:r.jsx("span",{className:"block truncate",title:e.vendor_name||"",children:e.vendor_name||"-"})}),o("contact_name")&&r.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${Ft}`,children:r.jsx("span",{className:"block truncate",title:e.contact_name||"",children:e.contact_name||"-"})}),o("delivery_request_date")&&r.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${Mt} ${e.revised_delivery_request_date?"text-gray-400":""}`,children:D(e.delivery_request_date)}),("receipt"===a||!a||"done"===a&&o("revised_delivery_date"))&&r.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${At}`,children:D(e.revised_delivery_request_date)}),o("item_name")&&r.jsx("td",{className:`px-2 py-1.5 card-title ${Pt}`,children:r.jsx("span",{className:"block truncate",title:e.purchase_request_items?.[0]?.item_name||"",children:e.purchase_request_items?.[0]?.item_name||"-"})}),o("specification")&&r.jsx("td",{className:`px-2 py-1.5 card-title ${Rt}`,children:r.jsx("span",{className:"block truncate",title:e.purchase_request_items?.[0]?.specification||"",children:e.purchase_request_items?.[0]?.specification||"-"})}),o("quantity")&&r.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${Et}`,children:e.purchase_request_items?.[0]?.quantity||0}),o("unit_price")&&r.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${It}`,children:e.purchase_request_items?.[0]?.unit_price_value?`${e.purchase_request_items[0].unit_price_value.toLocaleString()} ${wt(e.purchase_request_items[0]?.unit_price_currency||"KRW")}`:`0 ${wt(e.purchase_request_items?.[0]?.unit_price_currency||"KRW")}`}),o("amount")&&r.jsx("td",{className:`px-2 py-1.5 card-amount whitespace-nowrap ${Tt}`,children:e.purchase_request_items?.[0]?.amount_value?`${e.purchase_request_items[0].amount_value.toLocaleString()} ${wt(e.purchase_request_items[0]?.amount_currency||"KRW")}`:e.total_amount?`${e.total_amount.toLocaleString()} ${wt(e.currency||"KRW")}`:`0 ${wt(e.currency||"KRW")}`}),"pending"===a&&r.jsxs(r.Fragment,{children:[r.jsx("td",{className:`px-2 py-1.5 card-title ${zt}`,children:r.jsx("span",{className:"block truncate",title:e.purchase_request_items?.[0]?.remark||"",children:e.purchase_request_items?.[0]?.remark||"-"})}),r.jsx("td",{className:`px-2 py-1.5 card-title ${Lt}`,children:r.jsx("span",{className:"block truncate",title:e.project_vendor||"",children:e.project_vendor||"-"})}),r.jsx("td",{className:`px-2 py-1.5 card-title ${Vt}`,children:r.jsx("span",{className:"block truncate",title:e.project_item||"",children:e.project_item||"-"})}),r.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${Ot}`,children:r.jsx("span",{className:"block truncate",title:e.sales_order_number||"",children:e.sales_order_number||"-"})})]}),"purchase"===a&&r.jsxs(r.Fragment,{children:[r.jsx("td",{className:`px-2 py-1.5 card-title ${zt}`,children:r.jsx("span",{className:"block truncate",title:e.purchase_request_items?.[0]?.remark||"",children:e.purchase_request_items?.[0]?.remark||"-"})}),r.jsx("td",{className:`px-2 py-1.5 card-title ${Wt}`,children:e.purchase_request_items?.[0]?.link?r.jsx("a",{href:e.purchase_request_items?.[0]?.link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline truncate block",title:e.purchase_request_items?.[0]?.link,children:"ë§í¬ ë³´ê¸°"}):r.jsx("span",{className:"text-gray-400",children:"-"})})]}),"receipt"===a&&r.jsxs(r.Fragment,{children:[r.jsx("td",{className:`px-2 py-1.5 card-title ${zt}`,children:r.jsx("span",{className:"block truncate",title:e.purchase_request_items?.[0]?.remark||"",children:e.purchase_request_items?.[0]?.remark||"-"})}),r.jsx("td",{className:`px-2 py-1.5 card-title ${Lt}`,children:r.jsx("span",{className:"block truncate",title:e.project_vendor||"",children:e.project_vendor||"-"})}),r.jsx("td",{className:`px-2 py-1.5 card-title ${Vt}`,children:r.jsx("span",{className:"block truncate",title:e.project_item||"",children:e.project_item||"-"})}),r.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${Ot}`,children:r.jsx("span",{className:"block truncate",title:e.sales_order_number||"",children:e.sales_order_number||"-"})})]}),("done"===a||!a)&&r.jsxs(r.Fragment,{children:[o("remark")&&r.jsx("td",{className:`px-2 py-1.5 card-title ${zt}`,children:r.jsx("span",{className:"block truncate",title:e.purchase_request_items?.[0]?.remark||"",children:e.purchase_request_items?.[0]?.remark||"-"})}),o("link")&&r.jsx("td",{className:`px-2 py-1.5 card-title ${Wt}`,children:e.purchase_request_items?.[0]?.link?r.jsx("a",{href:e.purchase_request_items?.[0]?.link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline truncate block",title:e.purchase_request_items?.[0]?.link,children:"ë§í¬ ë³´ê¸°"}):r.jsx("span",{className:"text-gray-400",children:"-"})}),o("project_vendor")&&r.jsx("td",{className:`px-2 py-1.5 card-title ${Lt}`,children:r.jsx("span",{className:"block truncate",title:e.project_vendor||"",children:e.project_vendor||"-"})}),o("project_item")&&r.jsx("td",{className:`px-2 py-1.5 card-title ${Vt}`,children:r.jsx("span",{className:"block truncate",title:e.project_item||"",children:e.project_item||"-"})}),o("sales_order_number")&&r.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${Ot}`,children:r.jsx("span",{className:"block truncate",title:e.sales_order_number||"",children:e.sales_order_number||"-"})}),o("purchase_progress")&&r.jsx("td",{className:`px-2 py-1.5 ${Ut}`,children:r.jsx(Gt,{purchase:e,activeTab:a})}),o("receipt_progress")&&r.jsx("td",{className:`px-2 py-1.5 ${Yt} ${"done"===a?"column-progress":""}`,children:r.jsx(Zt,{purchase:e})})]})]})});Xt.displayName="TableRow";const Qt=a.memo(({purchases:e,activeTab:s="done",currentUserRoles:i=[],onRefresh:c,onOptimisticUpdate:d,onPaymentComplete:o,onReceiptComplete:m})=>{const[u,h]=a.useState(null),[x,g]=a.useState(!1),[b,_]=a.useState(!1),[y,f]=a.useState(null),j=n(),{columnVisibility:v}=ze(),w=i&&(i.includes("lead buyer")||i.includes("app_admin"));i.includes("final_approver")||i.includes("app_admin")||i.includes("ceo");const N=a.useCallback(e=>{h(e.id),g(!0)},[]),C=a.useCallback(()=>{g(!1),h(null)},[]),k=a.useCallback(async e=>{try{const{data:s,error:r}=await j.from("purchase_requests").select("*").eq("purchase_order_number",e.purchase_order_number).single();if(r||!s)return void A.error("í•´ë‹¹ ë°œì£¼ìš”ì²­ë²ˆí˜¸ì˜ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");const{data:n,error:d}=await j.from("purchase_request_items").select("*").eq("purchase_order_number",e.purchase_order_number).order("line_number");if(d||!n||0===n.length)return void A.error("í•´ë‹¹ ë°œì£¼ìš”ì²­ë²ˆí˜¸ì˜ í’ˆëª© ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");const o={vendor_name:e.vendor_name,vendor_phone:"",vendor_fax:"",vendor_contact_name:"",vendor_payment_schedule:""};try{const t=s.vendor_id||e.vendor_id,a=s.contact_id||e.contact_id;if(t){const{data:e}=await j.from("vendors").select("vendor_phone, vendor_fax, vendor_payment_schedule").eq("id",t).single();e&&(o.vendor_phone=e.vendor_phone||"",o.vendor_fax=e.vendor_fax||"",o.vendor_payment_schedule=e.vendor_payment_schedule||"")}if(a){const{data:e}=await j.from("vendor_contacts").select("contact_name, contact_phone, contact_email").eq("id",a).single();e&&(o.vendor_contact_name=e.contact_name||"")}}catch(t){}const m={purchase_order_number:s.purchase_order_number||"",request_date:s.request_date,delivery_request_date:s.delivery_request_date,requester_name:s.requester_name,vendor_name:o.vendor_name||"",vendor_contact_name:o.vendor_contact_name,vendor_phone:o.vendor_phone,vendor_fax:o.vendor_fax,project_vendor:s.project_vendor,sales_order_number:s.sales_order_number,project_item:s.project_item,vendor_payment_schedule:o.vendor_payment_schedule,items:n.map(e=>({line_number:e.line_number,item_name:e.item_name,specification:e.specification,quantity:e.quantity,unit_price_value:e.unit_price_value,amount_value:e.amount_value,remark:e.remark,currency:s.currency||"KRW"}))},u=await async function(e){const t=new((await l(()=>import("./exceljs.min-0ErSvM8v.js").then(e=>e.e),__vite__mapDeps([0,1,2]))).Workbook),a=t.addWorksheet("ë°œì£¼ì„œ",{pageSetup:{paperSize:9,orientation:"portrait",fitToPage:!0,fitToWidth:1,fitToHeight:1,horizontalCentered:!0,verticalCentered:!0,margins:{left:.3,right:.3,top:.5,bottom:.5,header:.2,footer:.2}}});a.getRow(1).height=29.8;for(let l=2;l<=60;l++)a.getRow(l).height=15.75;a.getRow(1).eachCell(e=>{e.font={...e.font||{},name:"ë§‘ì€ ê³ ë”•",size:20}});for(let l=2;l<=60;l++)a.getRow(l).eachCell(e=>{e.font={...e.font||{},name:"ë§‘ì€ ê³ ë”•",size:11}});a.mergeCells("A1:G1"),a.mergeCells("A2:B2"),a.mergeCells("C2:D2"),a.mergeCells("F2:G2"),a.mergeCells("A3:B3"),a.mergeCells("C3:D3"),a.mergeCells("F3:G3"),a.mergeCells("A4:B4"),a.mergeCells("C4:D4"),a.mergeCells("F4:G4"),a.mergeCells("A5:B5"),a.mergeCells("C5:D5"),a.mergeCells("F5:G5"),a.mergeCells("A6:B6"),a.mergeCells("C6:D6"),a.mergeCells("F6:G6"),a.mergeCells("A7:B7"),a.mergeCells("C7:D7"),a.mergeCells("F7:G7");try{const e=await fetch("/logo_KOR.png"),s=await e.arrayBuffer(),r=t.addImage({buffer:s,extension:"png"}),l=a.getColumn("D").width||22,n=Math.max(1,7.2*l*.58)+4,i=34,c=3,d=.3;a.addImage(r,{tl:{col:c,row:d},ext:{width:n,height:i}})}catch(p){}a.getCell("D1").value="                ë°œ ì£¼ ì„œ",a.getCell("D1").alignment={horizontal:"left",vertical:"middle",indent:1},a.getCell("D1").font={bold:!0,size:20},a.getCell("A2").value="ì—…   ì²´   ëª…",a.getCell("A2").font={bold:!0},a.getCell("A3").value="ë‹´   ë‹¹   ì",a.getCell("A3").font={bold:!0},a.getCell("A4").value="ì²­   êµ¬   ì¼",a.getCell("A4").font={bold:!0},a.getCell("A5").value="TEL.",a.getCell("A5").font={bold:!0},a.getCell("A6").value="FAX.",a.getCell("A6").font={bold:!0},a.getCell("A7").value="ì…ê³ ìš”ì²­ì¼",a.getCell("A7").font={bold:!0},a.getCell("E2").value="êµ¬ë§¤ìš”ì²­ì",a.getCell("E2").font={bold:!0},a.getCell("E3").value="ì£¼         ì†Œ",a.getCell("E3").font={bold:!0},a.getCell("E4").value="ë°œ ì£¼ ë²ˆ í˜¸",a.getCell("E4").font={bold:!0},a.getCell("E5").value="TEL.",a.getCell("E5").font={bold:!0},a.getCell("E6").value="FAX.",a.getCell("E6").font={bold:!0},a.getCell("E7").value="ì§€ì¶œ ì˜ˆì •ì¼",a.getCell("E7").font={bold:!0},a.getCell("F7").value=e.vendor_payment_schedule||"",a.getCell("C2").value=e.vendor_name,a.getCell("C3").value=e.vendor_contact_name||"",a.getCell("C4").value=Ae(e.request_date),a.getCell("C5").value=e.vendor_phone||"",a.getCell("C6").value=e.vendor_fax||"",a.getCell("C7").value=Ae(e.delivery_request_date),a.getCell("F2").value=e.requester_name,a.getCell("F3").value="ëŒ€êµ¬ê´‘ì—­ì‹œ ë‹¬ì„œêµ¬ ì„±ì„œê³µë‹¨ë¶ë¡œ305",a.getCell("F4").value=e.purchase_order_number,a.getCell("F5").value="(053) 626-7805",a.getCell("F6").value="(053) 657-7905",a.getCell("F5").alignment={horizontal:"center",vertical:"middle"},a.getCell("F6").alignment={horizontal:"center",vertical:"middle"};const s=["No","í’ˆëª…","ê·œê²©","ìˆ˜ëŸ‰","ë‹¨ê°€","ê¸ˆì•¡","ë¹„ê³ "];for(let l=0;l<s.length;l++)a.getCell(String.fromCharCode(65+l)+"8").value=s[l],a.getCell(String.fromCharCode(65+l)+"8").font={bold:!0},6===l&&(a.getCell("G8").alignment={horizontal:"center",vertical:"middle"});const r=[...e.items].sort((e,t)=>e.line_number-t.line_number),n=r.length,i=9+Math.max(n,45);for(let l=0;l<r.length;l++){const e=r[l],t=9+l;a.getCell("A"+t).value=e.line_number;const s=a.getCell("B"+t);s.value=e.item_name,s.alignment={horizontal:"left",vertical:"middle"},a.getCell("C"+t).value=e.specification,a.getCell("C"+t).alignment={horizontal:"left",vertical:"middle"},a.getCell("D"+t).value=e.quantity;const n=Pe(e.currency),i=void 0!==e.unit_price_value&&null!==e.unit_price_value?`${e.unit_price_value.toLocaleString()} ${n}`.trim():"";a.getCell("E"+t).value=i,a.getCell("E"+t).alignment={horizontal:"right",vertical:"middle"};const c=Pe(e.currency),d=void 0!==e.amount_value&&null!==e.amount_value?`${e.amount_value.toLocaleString()} ${c}`.trim():"";a.getCell("F"+t).value=d,a.getCell("F"+t).alignment={horizontal:"right",vertical:"middle"};const o=a.getCell("G"+t);o.value=void 0!==e.remark&&null!==e.remark?String(e.remark):"",o.alignment={horizontal:"left",vertical:"middle",wrapText:!1,shrinkToFit:!0}}for(let l=n;l<45;l++){const e=9+l;for(let t=0;t<7;t++)a.getCell(String.fromCharCode(65+t)+e).value=""}a.mergeCells(`A${i}:E${i}`),a.getCell("A"+i).value="í•©ê³„",a.getCell("A"+i).font={bold:!0};const c=Pe(e.items[0]?.currency),d=e.items.reduce((e,t)=>e+(t.amount_value||0),0);a.getCell("F"+i).value=`${d.toLocaleString()} ${c}`.trim(),a.getCell("F"+i).alignment={horizontal:"right",vertical:"middle"};const o=i;for(let l=1;l<=o;l++)for(let e=1;e<=7;e++){const t=String.fromCharCode(64+e)+l,s=a.getCell(t),r=l>=9&&l<i;(5===e||6===e)&&(r||l===i)||3===e&&r||(s.alignment={horizontal:"center",vertical:"middle"}),s.border={top:{style:1===l||2===l||8===l||l===i?"medium":"thin"},left:{style:1===e?"medium":"thin"},right:{style:7===e?"medium":"thin"},bottom:{style:8===l||l===i||l===o?"medium":"thin"}}}for(let l=0;l<n;l++){const e=9+l;a.getCell("C"+e).alignment={horizontal:"left",vertical:"middle"}}for(let l=2;l<=7;l++)a.getCell("B"+l).border={...a.getCell("B"+l).border,right:{style:"medium"}},a.getCell("D"+l).border={...a.getCell("D"+l).border,right:{style:"medium"}},l<=6&&(a.getCell("E"+l).border={...a.getCell("E"+l).border,right:{style:"medium"}});a.getCell("E7").border={...a.getCell("E7").border,top:{style:"thin"},right:{style:"medium"}},a.getCell("G7").border={...a.getCell("G7").border,top:{style:"thin"}};for(let l=1;l<=7;l++){const e=a.getCell("A"+l).border||{};a.getCell("A"+l).border={...e,left:{style:"medium"}}}const m=a.getCell("A"+i).border||{};a.getCell("A"+i).border={...m,left:{style:"medium"}},Object.entries({A:4.7,B:23,C:30,D:11,E:15,F:16,G:37}).forEach(([e,t])=>{a.getColumn(e).width=t}),a.getRow(1).height=29.8,a.getRow(1).eachCell(e=>{e.font={...e.font||{},name:"ë§‘ì€ ê³ ë”•",size:20}});for(let l=2;l<=o;l++){const e=a.getRow(l);e.height=15.75,e.eachCell(e=>{e.font={...e.font||{},name:"ë§‘ì€ ê³ ë”•",size:11}})}for(let l=9;l<=o;l++)a.getCell("G"+l).alignment={horizontal:"left",vertical:"middle",wrapText:!1,shrinkToFit:!0},a.getCell("B"+l).alignment={horizontal:"left",vertical:"middle"};const u=await t.xlsx.writeBuffer();return new Blob([u],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})}(m),p=`ë°œì£¼ì„œ_${m.vendor_name}_${m.purchase_order_number}.xlsx`,h=window.URL.createObjectURL(u),x=document.createElement("a");x.href=h,x.download=p,document.body.appendChild(x),x.click(),document.body.removeChild(x),window.URL.revokeObjectURL(h),A.success("ì—‘ì…€ íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.");try{if(i&&i.includes("lead buyer")){const{error:t}=await j.from("purchase_requests").update({is_po_download:!0}).eq("purchase_order_number",e.purchase_order_number);t||c?.()}}catch(a){}}catch(t){A.error("ì—‘ì…€ ë‹¤ìš´ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}},[j]),q=a.useCallback(async()=>{if(y){try{const e="https://qvhbigvdfyvhoegkhvef.supabase.co";if(!e||!"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF2aGJpZ3ZkZnl2aG9lZ2todmVmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc4MTQzNjAsImV4cCI6MjA2MzM5MDM2MH0.7VZlSwnNuE0MaQpDjuzeZFgjJrDBQOWA_COyqaM8Rbg"||e.includes("placeholder"))return t.warn("Supabase í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•ŠìŒ - FastPurchaseTable"),void A.error("í™˜ê²½ ì„¤ì • ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");const{data:{user:a},error:s}=await j.auth.getUser();if(s||!a)return void A.error("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");const{data:r,error:l}=await j.from("employees").select("name, email, purchase_role").eq("email",a.email).single();if(l||!r)return void A.error("ì‚¬ìš©ì ê¶Œí•œì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");let n=[];if(r.purchase_role)if(Array.isArray(r.purchase_role))n=r.purchase_role.map(e=>String(e).trim());else{n=String(r.purchase_role).split(",").map(e=>e.trim()).filter(e=>e.length>0)}const i=n.includes("final_approver")||n.includes("app_admin")||n.includes("ceo"),d="approved"===y.final_manager_status,o=y.requester_name===r.name;if(!(d?i:i||o))return void A.error("ì‚­ì œ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");const{data:m,error:u}=await j.from("purchase_request_items").delete().eq("purchase_request_id",y.id).select();if(u)throw t.error("ì•„ì´í…œ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ",u,{code:u.code,message:u.message,details:u.details,hint:u.hint}),u;const{data:h,error:x}=await j.from("purchase_requests").delete().eq("id",y.id).select();if(x)throw t.error("ë°œì£¼ìš”ì²­ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ",x,{code:x.code,message:x.message,details:x.details,hint:x.hint}),x;p(y.id)?t.info("âœ… [handleConfirmDelete] ë©”ëª¨ë¦¬ ìºì‹œì—ì„œ ë°œì£¼ì„œ ì‚­ì œ ì„±ê³µ",{purchaseId:y.id}):t.warn("[handleConfirmDelete] ë©”ëª¨ë¦¬ ìºì‹œì—ì„œ ë°œì£¼ì„œ ì‚­ì œ ì‹¤íŒ¨",{purchaseId:y.id}),A.success("ë°œì£¼ìš”ì²­ ë‚´ì—­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤."),c?.()}catch(e){const a=e;t.error("ë°œì£¼ìš”ì²­ ì‚­ì œ ì¤‘ ì˜ˆì™¸ ë°œìƒ",a,{name:a?.name,message:a?.message,code:a?.code,details:a?.details,hint:a?.hint,stack:a?.stack}),A.error(`ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${a?.message||"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}`)}_(!1),f(null)}},[j,y,c]),$=a.useCallback(e=>"done"!==s||!1!==v[e],[s,v]),D=a.useMemo(()=>{if("pending"===s)return r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Nt}`,children:"ìŠ¹ì¸ìƒíƒœ"}),r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ct}`,children:"ë°œì£¼ë²ˆí˜¸"}),r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${qt}`,children:"ê²°ì œì¢…ë¥˜"}),r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${$t}`,children:"ìš”ì²­ì"}),r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${St}`,children:"ì²­êµ¬ì¼"}),r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${Dt}`,children:"ì—…ì²´"}),r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ft}`,children:"ë‹´ë‹¹ì"}),r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Mt}`,children:"ì…ê³ ìš”ì²­ì¼"}),r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${Pt}`,children:"í’ˆëª…"}),r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${Rt}`,children:"ê·œê²©"}),r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Et}`,children:"ìˆ˜ëŸ‰"}),r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${It}`,children:"ë‹¨ê°€"}),r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Tt}`,children:"í•©ê³„"}),r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${zt}`,children:"ë¹„ê³ "}),r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Lt}`,children:"PJì—…ì²´"}),r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Vt}`,children:"PJ ITEM"}),r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ot}`,children:"ìˆ˜ì£¼ë²ˆí˜¸"})]})});const e=r.jsxs(r.Fragment,{children:[("done"!==s||$("purchase_order_number"))&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${"purchase"===s?kt:Ct}`,children:"ë°œì£¼ë²ˆí˜¸"}),("purchase"===s||"receipt"===s||!s||"done"===s&&$("payment_category"))&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${qt}`,children:"ê²°ì œì¢…ë¥˜"}),("done"!==s||$("requester_name"))&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${$t}`,children:"ìš”ì²­ì"}),("done"!==s||$("request_date"))&&r.jsx("th",{className:`py-1.5 modal-label text-gray-900 whitespace-nowrap ${St}`,children:"ì²­êµ¬ì¼"}),"done"===s&&$("utk_status")&&r.jsx("th",{className:`pl-2 pr-3 py-1.5 modal-label text-gray-900 whitespace-nowrap text-center ${Jt}`,children:"UTK"}),("done"!==s||$("vendor_name"))&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Dt}`,children:"ì—…ì²´"}),("done"!==s||$("contact_name"))&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ft}`,children:"ë‹´ë‹¹ì"}),("done"!==s||$("delivery_request_date"))&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Mt}`,children:"ì…ê³ ìš”ì²­ì¼"}),("receipt"===s||!s||"done"===s&&$("revised_delivery_date"))&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${At}`,children:"ë³€ê²½ ì…ê³ ì¼"}),("done"!==s||$("item_name"))&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${Pt}`,children:"í’ˆëª…"}),("done"!==s||$("specification"))&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${Rt}`,children:"ê·œê²©"}),("done"!==s||$("quantity"))&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Et}`,children:"ìˆ˜ëŸ‰"}),("done"!==s||$("unit_price"))&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${It}`,children:"ë‹¨ê°€"}),("done"!==s||$("amount"))&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Tt}`,children:"í•©ê³„"})]});let t=null;return t="purchase"===s?r.jsxs(r.Fragment,{children:[r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${zt}`,children:"ë¹„ê³ "}),r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Wt}`,children:"ë§í¬"})]}):"receipt"===s?r.jsxs(r.Fragment,{children:[r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${zt}`,children:"ë¹„ê³ "}),r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Lt}`,children:"PJì—…ì²´"}),r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Vt}`,children:"PJ ITEM"}),r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ot}`,children:"ìˆ˜ì£¼ë²ˆí˜¸"})]}):r.jsxs(r.Fragment,{children:[("done"!==s||$("remark"))&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${zt}`,children:"ë¹„ê³ "}),("done"!==s||$("link"))&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Wt}`,children:"ë§í¬"}),("done"!==s||$("project_vendor"))&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Lt}`,children:"PJì—…ì²´"}),("done"!==s||$("project_item"))&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Vt}`,children:"PJ ITEM"}),("done"!==s||$("sales_order_number"))&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ot}`,children:"ìˆ˜ì£¼ë²ˆí˜¸"}),("done"!==s||$("purchase_progress"))&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Ut}`,children:"êµ¬ë§¤ì§„í–‰"}),("done"!==s||$("receipt_progress"))&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Yt}`,children:"ì…ê³ ì§„í–‰"})]}),r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:["purchase"===s&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Bt}`,children:"êµ¬ë§¤ì§„í–‰"}),"receipt"===s&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Bt}`,children:"ì…ê³ ì§„í–‰"}),"done"===s&&$("statement_progress")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Bt}`,children:"ê±°ë˜ëª…ì„¸ì„œ"}),e,t]})})},[s,$]);return r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"hidden md:block w-full",children:r.jsx("div",{className:"done"===s?"table-container-fit-left":"overflow-x-auto border rounded-lg",children:r.jsxs("table",{className:"done"===s?"table-fit-left":"w-full min-w-[1790px] border-collapse",children:[D,r.jsx("tbody",{children:e.map(e=>r.jsx(Xt,{purchase:e,onClick:N,activeTab:s,isLeadBuyer:w,onPaymentComplete:o,onReceiptComplete:m,onExcelDownload:k,columnVisibility:v},e.id))})]})})}),r.jsx("div",{className:"hidden sm:block md:hidden w-full",children:r.jsx("div",{className:"overflow-x-auto border rounded-lg",children:r.jsxs("table",{className:"w-full min-w-[600px] card-title",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"text-left p-2 modal-label text-gray-900 w-24",children:"ë°œì£¼ë²ˆí˜¸"}),r.jsx("th",{className:"text-left p-2 modal-label text-gray-900 w-16",children:"ìš”ì²­ì"}),r.jsx("th",{className:"text-left p-2 modal-label text-gray-900 w-20",children:"ì—…ì²´"}),r.jsx("th",{className:"text-left p-2 modal-label text-gray-900 w-32",children:"í’ˆëª…"}),r.jsx("th",{className:"text-right p-2 modal-label text-gray-900 w-20",children:"ê¸ˆì•¡"}),r.jsx("th",{className:"text-center p-2 modal-label text-gray-900 w-16",children:"ìƒíƒœ"})]})}),r.jsx("tbody",{children:e.map(e=>r.jsxs("tr",{className:"border-b hover:bg-gray-50 cursor-pointer",onClick:()=>N(e),children:[r.jsx("td",{className:"p-2 modal-value",children:e.purchase_order_number||"-"}),r.jsx("td",{className:"p-2",children:e.requester_name}),r.jsx("td",{className:"p-2 truncate",title:e.vendor_name,children:e.vendor_name}),r.jsx("td",{className:"p-2 truncate",title:e.purchase_request_items?.[0]?.item_name,children:e.purchase_request_items?.[0]?.item_name||"-"}),r.jsx("td",{className:"p-2 text-right card-amount",children:e.purchase_request_items?.[0]?.amount_value?`${e.purchase_request_items[0].amount_value.toLocaleString()} ${wt(e.purchase_request_items[0]?.amount_currency||"KRW")}`:e.total_amount?`${e.total_amount.toLocaleString()} ${wt(e.currency||"KRW")}`:`0 ${wt(e.currency||"KRW")}`}),r.jsx("td",{className:"p-2 text-center",children:r.jsx(vt,{purchase:e})})]},e.id))})]})})}),r.jsx("div",{className:"sm:hidden space-y-3",children:e.map(e=>r.jsx(Me,{purchase:e,onClick:()=>N(e)},e.id))}),r.jsx(S,{purchaseId:u,isOpen:x,onClose:C,currentUserRoles:i,activeTab:s,onRefresh:c,onOptimisticUpdate:d,onDelete:e=>{f(e),_(!0)}}),r.jsx(ut,{open:b,onOpenChange:_,children:r.jsxs(xt,{children:[r.jsxs(gt,{children:[r.jsx(_t,{children:"ë°œì£¼ìš”ì²­ ë‚´ì—­ ì‚­ì œ"}),r.jsxs(yt,{children:["ë°œì£¼ìš”ì²­ë²ˆí˜¸ ",y?.purchase_order_number,"ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."]})]}),r.jsxs(bt,{children:[r.jsx(jt,{children:"ì·¨ì†Œ"}),r.jsx(ft,{onClick:q,className:"bg-red-600 hover:bg-red-700",children:"ì‚­ì œ"})]})]})})]})});Qt.displayName="FastPurchaseTable";var ea="Checkbox",[ta,aa]=c(ea),[sa,ra]=ta(ea);function la(e){const{__scopeCheckbox:t,checked:s,children:l,defaultChecked:n,disabled:i,form:c,name:d,onCheckedChange:o,required:m,value:u="on",internal_do_not_use_render:p}=e,[h,x]=g({prop:s,defaultProp:n??!1,onChange:o,caller:ea}),[b,_]=a.useState(null),[y,f]=a.useState(null),j=a.useRef(!1),v=!b||(!!c||!!b.closest("form")),w={checked:h,disabled:i,setChecked:x,control:b,setControl:_,name:d,form:c,value:u,hasConsumerStoppedPropagationRef:j,required:m,defaultChecked:!ha(n)&&n,isFormControl:v,bubbleInput:y,setBubbleInput:f};return r.jsx(sa,{scope:t,...w,children:pa(p)?p(w):l})}var na="CheckboxTrigger",ia=a.forwardRef(({__scopeCheckbox:e,onKeyDown:t,onClick:s,...l},n)=>{const{control:c,value:o,disabled:m,checked:u,required:p,setControl:h,setChecked:g,hasConsumerStoppedPropagationRef:b,isFormControl:_,bubbleInput:y}=ra(na,e),f=i(n,h),j=a.useRef(u);return a.useEffect(()=>{const e=c?.form;if(e){const t=()=>g(j.current);return e.addEventListener("reset",t),()=>e.removeEventListener("reset",t)}},[c,g]),r.jsx(x.button,{type:"button",role:"checkbox","aria-checked":ha(u)?"mixed":u,"aria-required":p,"data-state":xa(u),"data-disabled":m?"":void 0,disabled:m,value:o,...l,ref:f,onKeyDown:d(t,e=>{"Enter"===e.key&&e.preventDefault()}),onClick:d(s,e=>{g(e=>!!ha(e)||!e),y&&_&&(b.current=e.isPropagationStopped(),b.current||e.stopPropagation())})})});ia.displayName=na;var ca=a.forwardRef((e,t)=>{const{__scopeCheckbox:a,name:s,checked:l,defaultChecked:n,required:i,disabled:c,value:d,onCheckedChange:o,form:m,...u}=e;return r.jsx(la,{__scopeCheckbox:a,checked:l,defaultChecked:n,disabled:c,required:i,onCheckedChange:o,name:s,form:m,value:d,internal_do_not_use_render:({isFormControl:e})=>r.jsxs(r.Fragment,{children:[r.jsx(ia,{...u,ref:t,__scopeCheckbox:a}),e&&r.jsx(ua,{__scopeCheckbox:a})]})})});ca.displayName=ea;var da="CheckboxIndicator",oa=a.forwardRef((e,t)=>{const{__scopeCheckbox:a,forceMount:s,...l}=e,n=ra(da,a);return r.jsx(h,{present:s||ha(n.checked)||!0===n.checked,children:r.jsx(x.span,{"data-state":xa(n.checked),"data-disabled":n.disabled?"":void 0,...l,ref:t,style:{pointerEvents:"none",...e.style}})})});oa.displayName=da;var ma="CheckboxBubbleInput",ua=a.forwardRef(({__scopeCheckbox:e,...t},s)=>{const{control:l,hasConsumerStoppedPropagationRef:n,checked:c,defaultChecked:d,required:o,disabled:m,name:u,value:p,form:h,bubbleInput:g,setBubbleInput:_}=ra(ma,e),y=i(s,_),f=X(c),j=b(l);a.useEffect(()=>{const e=g;if(!e)return;const t=window.HTMLInputElement.prototype,a=Object.getOwnPropertyDescriptor(t,"checked").set,s=!n.current;if(f!==c&&a){const t=new Event("click",{bubbles:s});e.indeterminate=ha(c),a.call(e,!ha(c)&&c),e.dispatchEvent(t)}},[g,f,c,n]);const v=a.useRef(!ha(c)&&c);return r.jsx(x.input,{type:"checkbox","aria-hidden":!0,defaultChecked:d??v.current,required:o,disabled:m,name:u,value:p,form:h,...t,tabIndex:-1,ref:y,style:{...t.style,...j,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});function pa(e){return"function"==typeof e}function ha(e){return"indeterminate"===e}function xa(e){return ha(e)?"indeterminate":e?"checked":"unchecked"}ua.displayName=ma;const ga=a.forwardRef(({className:e,...t},a)=>r.jsx(ca,{ref:a,className:m("peer h-5 w-5 shrink-0 rounded-sm","border-2 border-gray-300 bg-white","transition-all duration-200","hover:border-gray-400","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-hansl-500/20 focus-visible:ring-offset-2","disabled:cursor-not-allowed disabled:opacity-50","data-[state=checked]:bg-hansl-500 data-[state=checked]:border-hansl-500 data-[state=checked]:text-white",e),...t,children:r.jsx(oa,{className:m("flex items-center justify-center text-current"),children:r.jsx(re,{className:"h-4 w-4"})})}));function ba({className:e,...t}){return r.jsx("div",{className:m("animate-pulse rounded-professional","bg-gradient-to-r from-gray-200 via-gray-100 to-gray-200","background-size-200 bg-[length:200%_100%]",e),...t})}ga.displayName=ca.displayName;const _a=a.memo(({isVisible:e=!0,className:t=""})=>{const{columnVisibility:a,toggleColumn:s,resetToDefault:l,isLoading:n,error:i}=ze();if(!e)return null;if(n)return r.jsxs(_,{variant:"outline",size:"sm",className:`button-base ${t}`,disabled:!0,children:[r.jsx(ba,{className:"w-4 h-4 mr-2"}),r.jsx("span",{className:"button-text",children:"ì¹¼ëŸ¼ ì„¤ì •"})]});if(i)return r.jsxs(_,{variant:"outline",size:"sm",className:`button-base ${t}`,disabled:!0,children:[r.jsx(Ne,{className:"w-4 h-4 mr-2"}),r.jsx("span",{className:"button-text text-red-500",children:"ì„¤ì • ì˜¤ë¥˜"})]});const c=Object.values(a).filter(Boolean).length,d=Object.keys(a).length,o=e=>{Ie.includes(e)&&a[e]||s(e)};return r.jsxs(Y,{children:[r.jsx(W,{asChild:!0,children:r.jsxs(_,{variant:"outline",size:"sm",className:`button-base ${t}`,children:[r.jsx(Ne,{className:"w-4 h-4 mr-2"}),r.jsxs("span",{className:"button-text",children:["ì¹¼ëŸ¼ ì„¤ì • (",c,"/",d,")"]})]})}),r.jsxs(J,{className:"w-80 max-h-96 overflow-y-auto",align:"end",children:[r.jsxs(K,{className:"flex items-center justify-between",children:[r.jsx("span",{className:"modal-section-title",children:"ì¹¼ëŸ¼ í‘œì‹œ ì„¤ì •"}),r.jsx(_,{variant:"ghost",size:"sm",onClick:l,className:"h-6 px-2",title:"ê¸°ë³¸ê°’ìœ¼ë¡œ ì¬ì„¤ì •",children:r.jsx(le,{className:"w-3 h-3"})})]}),r.jsx(G,{}),r.jsx("div",{className:"px-3 py-2",children:r.jsxs("div",{className:"flex items-center justify-between text-xs",children:[r.jsx("span",{className:"card-subtitle",children:"í‘œì‹œ ì¤‘ì¸ ì¹¼ëŸ¼"}),r.jsxs("span",{className:"badge-stats bg-blue-500 text-white",children:[c," / ",d]})]})}),r.jsx(G,{}),Te.map((e,t)=>r.jsxs(y.Fragment,{children:[r.jsx("div",{className:"px-3 py-2",children:r.jsx("div",{className:"modal-label text-gray-700 font-medium",children:e.title})}),e.columns.map(e=>{const t=a[e],s=Ie.includes(e);Te.flatMap(e=>e.columns).find(t=>t===e);return r.jsxs(Z,{className:"flex items-center gap-2 px-3 py-2 cursor-pointer "+(s?"opacity-75":""),onClick:()=>o(e),disabled:s&&t,children:[r.jsx(ga,{checked:t,disabled:s&&t,className:"w-4 h-4",onCheckedChange:()=>o(e)}),r.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[t?r.jsx(M,{className:"w-3 h-3 text-green-600"}):r.jsx(ve,{className:"w-3 h-3 text-gray-400"}),r.jsx("div",{className:"flex-1",children:r.jsxs("div",{className:"modal-value text-xs "+(t?"":"text-gray-500"),children:[{statement_progress:"ê±°ë˜ëª…ì„¸ì„œ",purchase_order_number:"ë°œì£¼ë²ˆí˜¸",payment_category:"ê²°ì œì¢…ë¥˜",requester_name:"ìš”ì²­ì",request_date:"ì²­êµ¬ì¼",utk_status:"UTK",vendor_name:"ì—…ì²´",contact_name:"ë‹´ë‹¹ì",delivery_request_date:"ì…ê³ ìš”ì²­ì¼",revised_delivery_date:"ë³€ê²½ì…ê³ ì¼",item_name:"í’ˆëª…",specification:"ê·œê²©",quantity:"ìˆ˜ëŸ‰",unit_price:"ë‹¨ê°€",amount:"í•©ê³„",remark:"ë¹„ê³ ",link:"ë§í¬",project_vendor:"PJì—…ì²´",project_item:"PJ ITEM",sales_order_number:"ìˆ˜ì£¼ë²ˆí˜¸",purchase_progress:"êµ¬ë§¤ì§„í–‰",receipt_progress:"ì…ê³ ì§„í–‰"}[e],s&&r.jsx("span",{className:"ml-1 text-red-500",title:"í•„ìˆ˜ ì¹¼ëŸ¼",children:"*"})]})})]})]},e)}),t<Te.length-1&&r.jsx(G,{})]},e.title)),r.jsx(G,{}),r.jsx("div",{className:"px-3 py-2",children:r.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[r.jsx("div",{children:"â€¢ í•„ìˆ˜ ì¹¼ëŸ¼(*)ì€ ìˆ¨ê¸¸ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"}),r.jsx("div",{children:"â€¢ ì„¤ì •ì€ ìë™ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤"}),r.jsx("div",{children:"â€¢ ìƒˆë¡œê³ ì¹¨ ì‹œì—ë„ ì„¤ì •ì´ ìœ ì§€ë©ë‹ˆë‹¤"})]})})]})]})});_a.displayName="ColumnSettingsDropdown";const ya=[{key:"date_range",label:"ê¸°ê°„ë³„",type:"date_range",icon:ue,category:"ë‚ ì§œ"},{key:"date_month",label:"ì›”ë³„",type:"date_month",icon:ue,category:"ë‚ ì§œ"},{key:"requester_name",label:"ìš”ì²­ì",type:"searchable_select",icon:j,category:"ì‚¬ìš©ì"},{key:"vendor_name",label:"ì—…ì²´",type:"searchable_select",icon:fe,category:"ì‚¬ìš©ì"},{key:"contact_name",label:"ë‹´ë‹¹ì",type:"searchable_select",icon:j,category:"ì‚¬ìš©ì"},{key:"purchase_order_number",label:"ë°œì£¼ë²ˆí˜¸",type:"text",icon:pe,category:"í…ìŠ¤íŠ¸"},{key:"item_name",label:"í’ˆëª…",type:"text",icon:pe,category:"í…ìŠ¤íŠ¸"},{key:"specification",label:"ê·œê²©",type:"text",icon:pe,category:"í…ìŠ¤íŠ¸"},{key:"remark",label:"ë¹„ê³ ",type:"text",icon:pe,category:"í…ìŠ¤íŠ¸"},{key:"project_vendor",label:"PJì—…ì²´",type:"text",icon:fe,category:"í…ìŠ¤íŠ¸"},{key:"project_item",label:"PJ ITEM",type:"text",icon:pe,category:"í…ìŠ¤íŠ¸"},{key:"sales_order_number",label:"ìˆ˜ì£¼ë²ˆí˜¸",type:"text",icon:pe,category:"í…ìŠ¤íŠ¸"},{key:"quantity",label:"ìˆ˜ëŸ‰",type:"number",icon:je,category:"ìˆ«ì"},{key:"unit_price_value",label:"ë‹¨ê°€",type:"number",icon:je,category:"ìˆ«ì"},{key:"total_amount",label:"í•©ê³„",type:"number",icon:je,category:"ìˆ«ì"},{key:"payment_category",label:"ê²°ì œì¢…ë¥˜",type:"select",icon:de,category:"ìƒíƒœ",options:["í˜„ì¥ê²°ì œ","êµ¬ë§¤ìš”ì²­","ë°œì£¼ìš”ì²­"]},{key:"payment_schedule",label:"ì§€ì¶œì˜ˆì •ì¼",type:"select_with_empty",icon:ue,category:"ìƒíƒœ"},{key:"is_payment_completed",label:"êµ¬ë§¤í˜„í™©",type:"select",icon:re,category:"ìƒíƒœ",options:["ëŒ€ê¸°","ì™„ë£Œ"]},{key:"is_received",label:"ì…ê³ í˜„í™©",type:"select",icon:re,category:"ìƒíƒœ",options:["ëŒ€ê¸°","ì™„ë£Œ"]},{key:"is_statement_received",label:"ê±°ë˜ëª…ì„¸ì„œ í™•ì¸",type:"select",icon:re,category:"ìƒíƒœ",options:["ëŒ€ê¸°","ì™„ë£Œ"]},{key:"is_utk_checked",label:"UTK í™•ì¸",type:"select",icon:de,category:"ìƒíƒœ",options:["ëŒ€ê¸°","ì™„ë£Œ"]}],fa=[{value:"request_date",label:"ì²­êµ¬ì¼"},{value:"delivery_request_date",label:"ì…ê³ ìš”ì²­ì¼"},{value:"payment_completed_at",label:"êµ¬ë§¤ì™„ë£Œì¼"},{value:"received_at",label:"ì…ê³ ì™„ë£Œì¼"},{value:"created_at",label:"ìƒì„±ì¼"},{value:"statement_received_at",label:"ê±°ë˜ëª…ì„¸ì„œì…ê³ ì¼"}],ja=[{value:"request_date",label:"ìš”ì²­ì¼"},{value:"purchase_order_number",label:"ë°œì£¼ë²ˆí˜¸"},{value:"vendor_name",label:"ì—…ì²´ëª…"},{value:"requester_name",label:"ìš”ì²­ì"},{value:"total_amount",label:"í•©ê³„"},{value:"delivery_request_date",label:"ì…ê³ ìš”ì²­ì¼"},{value:"created_at",label:"ìƒì„±ì¼"}];function va({activeFilters:e,sortConfig:t,searchTerm:s,onFiltersChange:l,onSortChange:n,onSearchChange:i,availableEmployees:c=[],availableVendors:d=[],availableContacts:o=[],availablePaymentSchedules:m=[],showColumnSettings:u=!1,activeTab:p}){const[h,x]=a.useState(!1),[g,b]=a.useState(!1),[y,j]=a.useState(!1),[v,w]=a.useState({}),[N,C]=a.useState(!1),[k,q]=a.useState(!1),[$,S]=a.useState({}),[D,F]=a.useState(),[M,A]=a.useState({}),[P,R]=a.useState({}),[E,I]=a.useState(""),T=a.useRef(null);a.useEffect(()=>{y&&T.current&&T.current.focus()},[y]),a.useEffect(()=>{g&&R({field:t?.field||"",direction:t?.direction||"asc"})},[g,t]);const z=t=>{l(e.filter(e=>e.id!==t))},L=()=>{const e=ya.find(e=>e.key===v.field);if(!e)return null;switch(e.type){case"text":return r.jsx(U,{placeholder:"ê°’ ì…ë ¥",value:v.value||"",onChange:e=>w(t=>({...t,value:e.target.value})),className:"w-full business-radius-input border border-gray-300 bg-white text-gray-700 card-description h-auto",style:{padding:"2px 10px",fontSize:"10px",fontWeight:"500"}});case"number":return r.jsx(U,{type:"number",placeholder:"ìˆ«ì ì…ë ¥",value:v.value||"",onChange:e=>w(t=>({...t,value:e.target.value})),className:"w-full business-radius-input border border-gray-300 bg-white text-gray-700 card-description h-auto",style:{padding:"2px 10px",fontSize:"10px",fontWeight:"500"}});case"searchable_select":let t=[],a="ì„ íƒ";"requester_name"===e.key?(t=c,a="ìš”ì²­ì"):"vendor_name"===e.key?(t=d,a="ì—…ì²´"):"contact_name"===e.key&&(t=o,a="ë‹´ë‹¹ì");const s=t.filter(e=>e.toLowerCase().includes(E.toLowerCase()));return r.jsxs(ne,{onOpenChange:e=>{e||I("")},children:[r.jsx(ie,{asChild:!0,children:r.jsxs(_,{variant:"outline",role:"combobox",className:"w-full button-base business-radius-button border border-gray-300 bg-white text-gray-700 justify-between [&>svg]:hidden",children:[r.jsx("span",{className:"truncate text-left",style:{fontSize:"12px",fontWeight:"500"},children:v.value||a}),r.jsx(he,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),r.jsx(ce,{className:"w-[200px] p-1 border-0 shadow-lg",align:"start",children:r.jsxs("div",{className:"space-y-1",children:[r.jsx(U,{placeholder:`${a} ê²€ìƒ‰...`,className:"h-auto border-0 focus:ring-0 focus:outline-none card-description placeholder:card-description",style:{padding:"2px 10px"},value:E,onChange:e=>I(e.target.value),autoFocus:!0}),r.jsx("div",{className:"max-h-[200px] overflow-y-auto",children:0===s.length?r.jsx("div",{className:"p-2 text-sm text-gray-500",children:E?"ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤":`${a}ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤`}):s.map(e=>r.jsxs(_,{variant:"ghost",onClick:()=>{w(t=>({...t,value:e})),I("")},className:"w-full justify-start p-2 h-auto hover:bg-gray-100 text-left",children:[r.jsx(re,{className:"mr-2 h-3 w-3 "+(v.value===e?"opacity-100":"opacity-0")}),r.jsx("span",{className:"card-description",children:e})]},e))})]})})]});case"select":return r.jsxs(Q,{value:v.value||"",onValueChange:e=>w(t=>({...t,value:e})),children:[r.jsx(ee,{className:"button-base business-radius-button border border-gray-300 bg-white text-gray-700 [&>svg]:hidden text-center",children:r.jsx(te,{placeholder:"ì„ íƒ"})}),r.jsx(ae,{children:e.options?.map(e=>r.jsx(se,{value:e,children:r.jsx("span",{className:"card-description",children:e})},e))})]});case"select_with_empty":const l=["ê³µë€",...m];return r.jsxs(Q,{value:v.value||"",onValueChange:e=>w(t=>({...t,value:e})),children:[r.jsx(ee,{className:"button-base business-radius-button border border-gray-300 bg-white text-gray-700 [&>svg]:hidden text-center",children:r.jsx(te,{placeholder:"ì§€ì¶œì˜ˆì •ì¼"})}),r.jsx(ae,{children:l.map(e=>r.jsx(se,{value:e,children:r.jsx("span",{className:"card-description",children:e})},e))})]});case"date_range":return r.jsxs(ne,{open:N,onOpenChange:e=>{if(e)if(v.value)if(v.value.includes("~")){const[e,t]=v.value.split("~");S({from:new Date(e),to:new Date(t)})}else S({from:new Date(v.value),to:void 0});else S({});C(e)},children:[r.jsx(ie,{asChild:!0,children:r.jsx(_,{variant:"outline",className:"w-full button-base business-radius-button border border-gray-300 bg-white text-gray-700 justify-between h-auto",children:r.jsxs("div",{className:"flex items-center gap-1.5 min-h-[32px]",children:[r.jsx(ue,{className:"w-3 h-3 flex-shrink-0"}),r.jsx("span",{className:"card-description leading-tight whitespace-pre-line",children:v.value?(()=>{if(v.value.includes("~")){const[e,t]=v.value.split("~");return`${oe(new Date(e),"yy/MM/dd")}\n~ ${oe(new Date(t),"yy/MM/dd")}`}return oe(new Date(v.value),"yy/MM/dd")})():"ë‚ ì§œ ì„ íƒ"})]})})}),r.jsx(ce,{className:"w-auto p-0",align:"start",children:r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"p-3 pb-0",children:[r.jsx("div",{className:"text-xs font-medium text-gray-600 mb-2",children:"ë‚ ì§œ ë²”ìœ„ ì„ íƒ"}),r.jsx(me,{mode:"range",selected:$,onSelect:e=>{e&&S(e)},numberOfMonths:1,initialFocus:!0,className:"compact-calendar"})]}),r.jsxs("div",{className:"flex gap-2 p-3 pt-0",children:[r.jsx(_,{onClick:()=>{S({}),C(!1)},variant:"outline",className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 flex-1",children:"ì·¨ì†Œ"}),r.jsx(_,{onClick:()=>{if($.from){if($.to){const e=`${oe($.from,"yyyy-MM-dd")}~${oe($.to,"yyyy-MM-dd")}`;w(t=>({...t,value:e}))}else w(e=>({...e,value:oe($.from,"yyyy-MM-dd")}));C(!1)}},disabled:!$.from,className:"button-base bg-blue-500 text-white hover:bg-blue-600 flex-1",children:"í™•ì¸"})]})]})})]});case"date_month":return r.jsxs(ne,{open:k,onOpenChange:e=>{if(e)if(v.value)if(v.value.includes("~")){const[e,t]=v.value.split("~");A({from:new Date(`${e}-01`),to:new Date(`${t}-01`)})}else A({from:new Date(`${v.value}-01`),to:void 0});else A({});q(e)},children:[r.jsx(ie,{asChild:!0,children:r.jsx(_,{variant:"outline",className:"w-full button-base business-radius-button border border-gray-300 bg-white text-gray-700 justify-between h-auto",children:r.jsxs("div",{className:"flex items-center gap-1.5",children:[r.jsx(ue,{className:"w-3 h-3 flex-shrink-0"}),r.jsx("span",{className:"card-description leading-tight whitespace-pre-line",children:v.value?(()=>{if(v.value.includes("~")){const[e,t]=v.value.split("~"),[a,s]=e.split("-"),[r,l]=t.split("-");return`${a.slice(-2)}/${s}\n~ ${r.slice(-2)}/${l}`}{const[e,t]=v.value.split("-");return`${e.slice(-2)}/${t}`}})():"ì›” ì„ íƒ"})]})})}),r.jsx(ce,{className:"w-auto p-0",align:"start",children:r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"p-3 pb-0",children:[r.jsx("div",{className:"text-xs font-medium text-gray-600 mb-3",children:"ì›” ì„ íƒ"}),r.jsxs("div",{className:"flex gap-4",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"ì‹œì‘ ì›” ì„ íƒ"}),r.jsx("div",{className:"mb-3",children:r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx(_,{onClick:()=>{const e=M.from?M.from.getFullYear():(new Date).getFullYear(),t=new Date(e-1,M.from?M.from.getMonth():0,1);A(e=>({...e,from:t}))},variant:"outline",size:"sm",className:"button-base border border-gray-300 bg-white text-gray-600 hover:bg-gray-50",children:"â€¹"}),r.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[M.from?M.from.getFullYear():(new Date).getFullYear(),"ë…„"]}),r.jsx(_,{onClick:()=>{const e=M.from?M.from.getFullYear():(new Date).getFullYear(),t=new Date(e+1,M.from?M.from.getMonth():0,1);A(e=>({...e,from:t}))},variant:"outline",size:"sm",className:"button-base border border-gray-300 bg-white text-gray-600 hover:bg-gray-50",children:"â€º"})]})}),r.jsx("div",{className:"grid grid-cols-3 gap-2",children:Array.from({length:12},(e,t)=>{const a=M.from?M.from.getFullYear():(new Date).getFullYear(),s=new Date(a,t,1),l=M.from&&M.from.getFullYear()===a&&M.from.getMonth()===t;return r.jsxs(_,{onClick:()=>{A(e=>({...e,from:s}))},variant:"outline",className:"button-base text-xs h-8 "+(l?"bg-blue-500 text-white border-blue-500 hover:bg-blue-600":"border-gray-300 bg-white text-gray-700 hover:bg-gray-50"),children:[t+1,"ì›”"]},t)})})]}),M.from&&r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"ì¢…ë£Œ ì›” ì„ íƒ (ì„ íƒì‚¬í•­)"}),r.jsx("div",{className:"mb-3",children:r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx(_,{onClick:()=>{const e=M.to?M.to.getFullYear():M.from.getFullYear(),t=new Date(e-1,M.to?M.to.getMonth():11,1);A(e=>({...e,to:t}))},variant:"outline",size:"sm",className:"button-base border border-gray-300 bg-white text-gray-600 hover:bg-gray-50",children:"â€¹"}),r.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[M.to?M.to.getFullYear():M.from.getFullYear(),"ë…„"]}),r.jsx(_,{onClick:()=>{const e=M.to?M.to.getFullYear():M.from.getFullYear(),t=new Date(e+1,M.to?M.to.getMonth():11,1);A(e=>({...e,to:t}))},variant:"outline",size:"sm",className:"button-base border border-gray-300 bg-white text-gray-600 hover:bg-gray-50",children:"â€º"})]})}),r.jsx("div",{className:"grid grid-cols-3 gap-2",children:Array.from({length:12},(e,t)=>{const a=M.to?M.to.getFullYear():M.from.getFullYear(),s=new Date(a,t,1),l=M.to&&M.to.getFullYear()===a&&M.to.getMonth()===t,n=s<M.from;return r.jsxs(_,{onClick:()=>{n||A(e=>({...e,to:s}))},variant:"outline",disabled:n,className:"button-base text-xs h-8 "+(l?"bg-blue-500 text-white border-blue-500 hover:bg-blue-600":n?"border-gray-200 bg-gray-100 text-gray-400 cursor-not-allowed":"border-gray-300 bg-white text-gray-700 hover:bg-gray-50"),children:[t+1,"ì›”"]},t)})}),r.jsx("div",{className:"mt-3",children:r.jsx(_,{onClick:()=>{A(e=>({...e,to:void 0}))},variant:"outline",size:"sm",className:"button-base border border-gray-300 bg-white text-gray-600 hover:bg-gray-50 text-xs",children:"ì¢…ë£Œ ì›” ì œê±°"})})]})]})]}),r.jsxs("div",{className:"flex gap-2 p-3 pt-0",children:[r.jsx(_,{onClick:()=>{A({}),q(!1)},variant:"outline",className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 flex-1",children:"ì·¨ì†Œ"}),r.jsx(_,{onClick:()=>{if(M.from){if(M.to){const e=`${oe(M.from,"yyyy-MM")}~${oe(M.to,"yyyy-MM")}`;w(t=>({...t,value:e}))}else w(e=>({...e,value:oe(M.from,"yyyy-MM")}));q(!1)}},disabled:!M.from,className:"button-base bg-blue-500 text-white hover:bg-blue-600 flex-1",children:"í™•ì¸"})]})]})})]});default:return null}};return r.jsxs("div",{className:"w-full space-y-3",children:[r.jsx("div",{className:"flex items-center justify-between",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs(ne,{open:h,onOpenChange:x,children:[r.jsx(ie,{asChild:!0,children:r.jsxs(_,{variant:"outline",className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50",children:[r.jsx(Ce,{className:"w-4 h-4 mr-1"}),r.jsx("span",{className:"button-text",children:"í•„í„°"}),e.length>0&&r.jsx("span",{className:"ml-1 badge-stats bg-blue-50 text-blue-700",children:e.length})]})}),r.jsx(ce,{className:"w-64 p-3",align:"start",children:r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("h4",{className:"card-title",children:"í•„í„°"}),e.length>0&&r.jsx(_,{variant:"ghost",onClick:()=>{l([]),x(!1)},className:"button-base text-red-600 hover:text-red-700 hover:bg-red-50",children:r.jsx("span",{className:"button-text",children:"ëª¨ë‘ ì§€ìš°ê¸°"})})]}),e.length>0&&r.jsxs("div",{className:"space-y-2",children:[e.map(e=>r.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 business-radius",children:[r.jsxs("span",{className:"card-description",children:[e.label,e.dateField&&r.jsxs("span",{className:"text-blue-600",children:["(",fa.find(t=>t.value===e.dateField)?.label,")"]}),": ",e.value]}),r.jsx(_,{variant:"ghost",onClick:()=>z(e.id),className:"button-base h-6 w-6 p-0 hover:bg-red-50",children:r.jsx(f,{className:"w-3 h-3"})})]},e.id)),r.jsx("div",{className:"border-t border-gray-200 my-2"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs(Q,{onValueChange:e=>{const t=ya.find(t=>t.key===e);if(!t)return;let a="contains";"date_range"!==t.type&&"date_month"!==t.type||(a="equals"),w({id:`${e}_${Date.now()}`,field:e,condition:a,value:"",label:t.label})},children:[r.jsx(ee,{className:"button-base business-radius-button border border-gray-300 bg-white text-gray-700 [&>svg]:hidden text-center",children:r.jsx(te,{placeholder:"+ í•„í„° ì¶”ê°€"})}),r.jsx(ae,{className:"w-64 max-h-80 overflow-y-auto",style:{scrollbarWidth:"auto",scrollbarColor:"#9ca3af #f3f4f6",WebkitScrollbarWidth:"8px"},children:Object.entries(ya.reduce((e,t)=>(e[t.category]||(e[t.category]=[]),e[t.category].push(t),e),{})).map(([e,t])=>r.jsxs("div",{children:[r.jsx("div",{className:"px-2 py-1 card-description uppercase",children:e}),t.map(e=>r.jsx(se,{value:e.key,children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(e.icon,{className:"w-4 h-4"}),r.jsx("span",{className:"card-description",children:e.label})]})},e.key))]},e))})]}),v.field&&r.jsxs("div",{className:"space-y-2 p-3 border business-radius bg-white",children:[r.jsx("div",{className:"flex items-center gap-2",children:r.jsxs("span",{className:"card-title",children:[v.label," í•„í„°"]})}),"date_range"===v.field||"date_month"===v.field?r.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[r.jsx("div",{className:"flex items-start",children:r.jsxs(Q,{value:v.dateField||"",onValueChange:e=>w(t=>({...t,dateField:e})),children:[r.jsx(ee,{className:"w-full button-base business-radius-button border border-gray-300 bg-white text-gray-700 [&>svg]:hidden text-center justify-center",children:r.jsx(te,{placeholder:"ë‚ ì§œ í•­ëª©",className:"text-center"})}),r.jsx(ae,{children:fa.map(e=>r.jsx(se,{value:e.value,children:r.jsx("span",{className:"card-description",children:e.label})},e.value))})]})}),r.jsx("div",{className:"flex items-start",children:L()})]}):r.jsx("div",{children:L()}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(_,{onClick:()=>{const t="date_range"===v.field||"date_month"===v.field,a=t&&!v.dateField;let s=v.condition;if(!s)if(t)s="equals";else{const e=ya.find(e=>e.key===v.field);s="select"===e?.type||"select_with_empty"===e?.type||"searchable_select"===e?.type?"equals":"contains"}if(v.field&&void 0!==s&&""!==v.value&&!a){const t={id:v.id,field:v.field,condition:s,value:v.value,label:v.label,dateField:v.dateField};l([...e,t]),w({}),x(!1)}},disabled:!v.field||""===v.value||("date_range"===v.field||"date_month"===v.field)&&!v.dateField,className:"button-base bg-blue-500 text-white hover:bg-blue-600 flex-1",children:"ì ìš©"}),r.jsx(_,{variant:"outline",onClick:()=>w({}),className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 flex-1",children:"ì·¨ì†Œ"})]})]})]})]})})]}),r.jsxs(ne,{open:g,onOpenChange:b,children:[r.jsx(ie,{asChild:!0,children:r.jsxs(_,{variant:"outline",className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50",children:[r.jsx(H,{className:"w-4 h-4 mr-1"}),r.jsx("span",{className:"button-text",children:"ì •ë ¬"}),t&&r.jsxs("span",{className:"ml-1 card-description",children:["(","asc"===t.direction?"â†‘":"â†“",")"]})]})}),r.jsx(ce,{className:"w-56 p-3",align:"start",children:r.jsxs("div",{className:"space-y-3",children:[r.jsx("h4",{className:"card-title",children:"ì •ë ¬ ì„¤ì •"}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"ì •ë ¬ ê¸°ì¤€"}),r.jsxs(Q,{value:P.field||"",onValueChange:e=>{R(t=>({...t,field:e}))},children:[r.jsx(ee,{className:"button-base business-radius-button border border-gray-300 bg-white text-gray-700 [&>svg]:hidden",children:r.jsx(te,{placeholder:"ì„ íƒí•˜ì„¸ìš”"})}),r.jsx(ae,{children:ja.map(e=>r.jsx(se,{value:e.value,children:r.jsx("span",{className:"card-description",children:e.label})},e.value))})]})]}),P.field&&r.jsxs("div",{children:[r.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"ì •ë ¬ ë°©í–¥"}),r.jsxs(Q,{value:P.direction||"",onValueChange:e=>{R(t=>({...t,direction:e}))},children:[r.jsx(ee,{className:"button-base business-radius-button border border-gray-300 bg-white text-gray-700 [&>svg]:hidden",children:r.jsx(te,{placeholder:"ì„ íƒí•˜ì„¸ìš”"})}),r.jsxs(ae,{children:[r.jsx(se,{value:"asc",children:r.jsx("span",{className:"card-description",children:"ì˜¤ë¦„ì°¨ìˆœ â†‘"})}),r.jsx(se,{value:"desc",children:r.jsx("span",{className:"card-description",children:"ë‚´ë¦¼ì°¨ìˆœ â†“"})})]})]})]}),r.jsxs("div",{className:"flex gap-2 pt-2",children:[r.jsx(_,{onClick:()=>{if(P.field&&P.direction){const e=ja.find(e=>e.value===P.field);e&&n({field:P.field,direction:P.direction,label:e.label})}b(!1),R({})},disabled:!P.field||!P.direction,className:"button-base bg-blue-500 hover:bg-blue-600 text-white flex-1",children:"ì ìš©"}),r.jsx(_,{onClick:()=>{n(null),R({}),b(!1)},className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50",children:"ì´ˆê¸°í™”"})]})]}),t&&r.jsx("div",{className:"border-t pt-2",children:r.jsx(_,{variant:"outline",onClick:()=>n(null),className:"button-base w-full border border-gray-300 text-gray-700",children:r.jsx("span",{className:"button-text",children:"ì •ë ¬ í•´ì œ"})})})]})})]}),r.jsx("div",{className:"flex items-center gap-2",children:y?r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(U,{ref:T,placeholder:"ì „ì²´ ê²€ìƒ‰...",value:s,onChange:e=>i(e.target.value),className:"w-64 business-radius-input button-base border border-gray-300 bg-white text-gray-700"}),r.jsx(_,{variant:"ghost",onClick:()=>{j(!1),i("")},className:"button-base h-8 w-8 p-0",children:r.jsx(f,{className:"w-4 h-4"})})]}):r.jsxs(_,{variant:"outline",onClick:()=>j(!0),className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50",children:[r.jsx(he,{className:"w-4 h-4 mr-1"}),r.jsx("span",{className:"button-text",children:"ê²€ìƒ‰"})]})}),r.jsxs(_,{variant:"outline",onClick:()=>{i(""),l([]),n({field:"created_at",direction:"desc",label:"ìƒì„±ì¼"}),j(!1)},className:"button-base border border-gray-300 bg-white text-blue-600 hover:bg-blue-50 hover:border-blue-300",children:["â†» ",r.jsx("span",{className:"button-text text-blue-600",children:"ì´ˆê¸°í™”"})]}),u&&r.jsx(_a,{isVisible:!0})]})}),e.length>0&&r.jsx("div",{className:"flex flex-wrap gap-2",children:e.map(e=>r.jsxs("span",{className:"badge-stats flex items-center gap-1 bg-blue-50 text-blue-700 border border-blue-200",children:[e.label,e.dateField&&r.jsxs("span",{className:"text-blue-600",children:["(",fa.find(t=>t.value===e.dateField)?.label,")"]}),": ",e.value,r.jsx(_,{variant:"ghost",size:"sm",onClick:()=>z(e.id),className:"h-4 w-4 p-0 hover:bg-blue-100 ml-1",children:r.jsx(f,{className:"w-3 h-3"})})]},e.id))})]})}const wa=["purchase_manager","app_admin","raw_material_manager","consumable_manager"],Na=["ì •í¬ì›…"];function Ca(e,t){return a=t,wa.some(e=>a.includes(e))?e:e.filter(e=>!Na.includes(e.requester_name));var a}const ka=a.lazy(()=>l(()=>import("./PurchaseItemsModal-DFpO94Ra.js"),__vite__mapDeps([3,1,2,4,5,6,7,8,9,10,11,12,13,14,15,16,17]))),qa=[{key:"pending",label:"ìŠ¹ì¸ëŒ€ê¸°"},{key:"purchase",label:"êµ¬ë§¤ í˜„í™©"},{key:"receipt",label:"ì…ê³  í˜„í™©"},{key:"done",label:"ì „ì²´ í•­ëª©"}];function $a({showEmailButton:e=!0}){const l=v(),i=w(),c=n(),[d,o]=a.useState(null),[m,u]=a.useState(!1),[p,h]=a.useState([]),[x,g]=a.useState({field:"created_at",direction:"desc",label:"ìƒì„±ì¼"}),[b,y]=a.useState(""),[f,j]=a.useState([]),[S,D]=a.useState([]),[F,M]=a.useState([]),[P,R]=a.useState([]),{allPurchases:E,loading:I,currentUser:T,getFilteredPurchases:z}=De(),L=Array.isArray(T?.purchase_role)?T.purchase_role.map(e=>e.trim()):"string"==typeof T?.purchase_role?T.purchase_role.split(",").map(e=>e.trim()):[],O=T?.name||null,[V,B]=a.useState(0),U=a.useCallback(async()=>{B(e=>e+1)},[]),Y=a.useCallback((e,t)=>{N(e,t)},[]),W=L?.includes("app_admin"),[J,K]=a.useState("pending"),[G,Z]=a.useState("");a.useMemo(()=>Ca(E,L),[E,L]);const H=a.useMemo(()=>{return(e=L)&&0!==e.length?e.includes("app_admin")||e.includes("ceo")?3:e.includes("consumable_manager")||e.includes("raw_material_manager")||e.includes("purchase_manager")||e.includes("middle_manager")?2:1:1;var e},[L]),X=a.useCallback(e=>{if(!O)return"all";switch(H){case 1:case 2:return"done"===e?"all":O;case 3:return"all";default:return O}},[O,H]);a.useEffect(()=>{if(!O)return;const e=X(J);Z(e)},[J,O,X]),a.useEffect(()=>{const e=new URLSearchParams(i.search).get("tab");e&&["pending","purchase","receipt","done"].includes(e)&&K(e)},[i.search]),a.useEffect(()=>{(async()=>{if(!q()||!s.allPurchases)try{await $(T?.id)}catch(e){}})()},[T?.id]),a.useEffect(()=>{(async()=>{try{const{data:e}=await c.from("employees").select("name");if(e){const t=[...new Set(e.map(e=>e.name).filter(Boolean))];j(t)}const{data:t}=await c.from("vendors").select("vendor_name");if(t){const e=[...new Set(t.map(e=>e.vendor_name).filter(Boolean))];D(e)}const{data:a}=await c.from("vendor_contacts").select("contact_name");if(a){const e=[...new Set(a.map(e=>e.contact_name).filter(Boolean))];M(e)}const{data:s}=await c.from("vendors").select("vendor_payment_schedule");if(s){const e=[...new Set(s.map(e=>e.vendor_payment_schedule).filter(Boolean))];R(e)}}catch(e){t.error("í•„í„° ì˜µì…˜ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨",e)}})()},[c]),a.useCallback(e=>e.is_received?r.jsx("span",{className:"badge-stats bg-green-500 text-white",children:"ì…ê³ ì™„ë£Œ"}):"approved"===e.middle_manager_status&&"approved"===e.final_manager_status?r.jsx("span",{className:"badge-stats bg-blue-500 text-white",children:"êµ¬ë§¤ì§„í–‰"}):"rejected"===e.middle_manager_status||"rejected"===e.final_manager_status?r.jsx("span",{className:"badge-stats bg-red-500 text-white",children:"ë°˜ë ¤"}):r.jsx("span",{className:"badge-stats bg-yellow-500 text-white",children:"ìŠ¹ì¸ëŒ€ê¸°"}),[]),a.useCallback((e,t)=>{switch(t){case"purchase_order_number":return e.purchase_order_number;case"payment_category":return e.payment_category;case"requester_name":return e.requester_name;case"vendor_name":return e.vendor_name;case"contact_name":case"payment_schedule":return"-";case"item_name":return e.purchase_request_items?.[0]?.item_name||"";case"specification":return e.purchase_request_items?.[0]?.specification||"";case"quantity":return e.purchase_request_items?.[0]?.quantity||0;case"unit_price_value":return e.purchase_request_items?.[0]?.unit_price_value||0;case"total_amount":return e.total_amount;case"remark":return e.purchase_request_items?.[0]?.remark||"";case"project_vendor":return e.project_vendor;case"project_item":return e.project_item;case"sales_order_number":return e.sales_order_number;case"is_payment_completed":return e.is_payment_completed?"ì™„ë£Œ":"ëŒ€ê¸°";case"is_received":return e.is_received?"ì™„ë£Œ":"ëŒ€ê¸°";case"is_statement_received":return e.is_statement_received?"ì™„ë£Œ":"ëŒ€ê¸°";case"is_utk_checked":return e.is_utk_checked?"ì™„ë£Œ":"ëŒ€ê¸°";case"request_date":return e.request_date;case"delivery_request_date":return e.delivery_request_date;case"payment_completed_at":return e.payment_completed_at;case"received_at":return e.received_at;case"created_at":return e.created_at;case"statement_received_at":return e.purchase_request_items?.[0]?.statement_received_date||null;default:return null}},[]),a.useCallback((e,a,s,r)=>{if(null==e)return"is_empty"===a;if("date_range"===r&&s&&"string"==typeof s&&s.includes("~")){if(!e)return!1;const[t,a]=s.split("~"),r=new Date(e),l=new Date(t),n=new Date(a);return r>=l&&r<=n}if("date_month"===r&&s&&"string"==typeof s&&s.includes("~")){if(!e)return!1;const[t,a]=s.split("~"),r=new Date(e),l=new Date(`${t}-01`),n=new Date(`${a}-01`),i=new Date(n.getFullYear(),n.getMonth()+1,0,23,59,59);return r>=l&&r<=i}if(r&&("date_month"===r||r.endsWith("_month"))){if(!s)return!0;const t=new Date(e),[a,r]=s.split("-");return t.getFullYear()===parseInt(a)&&t.getMonth()+1===parseInt(r)}const l=String(e).toLowerCase(),n=String(s).toLowerCase();switch(a){case"contains":return l.includes(n);case"equals":if("date_range"===r||s.match(/^[0-9]{4}-[0-9]{2}-[0-9]{2}/)){if(!e)return!1;try{const t=new Date(e).toISOString().split("T")[0];return t===s.split("T")[0]}catch(i){return t.error("ë‚ ì§œ ë¹„êµ ì˜¤ë¥˜:",i),!1}}return l===n;case"starts_with":return l.startsWith(n);case"ends_with":return l.endsWith(n);case"is_empty":return!e||""===l.trim();case"is_not_empty":return!!e&&""!==l.trim();case"greater_than":return Number(e)>Number(s);case"less_than":return Number(e)<Number(s);case"between":default:return!0;case"after":return new Date(e)>new Date(s);case"before":return new Date(e)<new Date(s);case"not_equals":return l!==n}},[]);const Q=a.useMemo(()=>{let e;if(!(p.length>0||""!==b.trim()||G&&"all"!==G&&"ì „ì²´"!==G)){const t=new Date;t.setDate(t.getDate()-60),e=t.toISOString().split("T")[0]}return z({tab:J,employeeName:"all"===G||"ì „ì²´"===G?null:G,searchTerm:b,advancedFilters:p,startDate:e,sortConfig:x?{key:x.field,direction:x.direction}:void 0})},[z,J,G,b,p,x,E]),ee=a.useMemo(()=>{let e;if(!(p.length>0||""!==b.trim()||G&&"all"!==G&&"ì „ì²´"!==G)){const t=new Date;t.setDate(t.getDate()-60),e=t.toISOString().split("T")[0]}const t={employeeName:"all"===G||"ì „ì²´"===G?null:G,searchTerm:b,advancedFilters:p,startDate:e,sortConfig:x?{key:x.field,direction:x.direction}:void 0};return{pending:z({tab:"pending",...t}).length,purchase:z({tab:"purchase",...t}).length,receipt:z({tab:"receipt",...t}).length,done:z({tab:"done",...t}).length}},[z,G,b,p,x]),te=a.useMemo(()=>{const e=p.filter(e=>"date_month"===e.field||"date_range"===e.field&&e.dateField&&e.dateField.includes("_month"));if(0===e.length)return null;const t=e[0].value;if(t&&"string"==typeof t&&t.includes("~")){const[e,a]=t.split("~"),s=new Date(`${e}-01`),r=new Date(`${a}-01`),l=[];let n=0;const i=new Date(s);for(;i<=r;){const e=i.getFullYear(),t=i.getMonth()+1,a=`${e}-${t.toString().padStart(2,"0")}`,s=Q.filter(a=>{const s=new Date(a.request_date);return s.getFullYear()===e&&s.getMonth()+1===t}),r=s.reduce((e,t)=>{if(t.purchase_request_items?.length){return e+t.purchase_request_items.reduce((e,t)=>e+(t.amount_value||0),0)}return e+(t.total_amount||0)},0);l.push({year:e,month:t,monthStr:a,total:r,count:s.length}),n+=r,i.setMonth(i.getMonth()+1)}return{type:"range",months:l,grandTotal:n}}{const[e,a]=("string"==typeof t?t:"").split("-"),s=Q.filter(t=>{const s=new Date(t.request_date);return s.getFullYear()===parseInt(e)&&s.getMonth()+1===parseInt(a)}),r=s.reduce((e,t)=>{if(t.purchase_request_items?.length){return e+t.purchase_request_items.reduce((e,t)=>e+(t.amount_value||0),0)}return e+(t.total_amount||0)},0);return{type:"single",year:parseInt(e),month:parseInt(a),total:r,count:s.length}}},[p,Q]),ae=a.useCallback(async e=>{try{const a=(new Date).toISOString(),[s,r]=await Promise.all([c.from("purchase_requests").update({is_received:!0,received_at:a}).eq("id",e),c.from("purchase_request_items").update({is_received:!0,delivery_status:"received"}).eq("purchase_request_id",e)]);if(s.error)throw s.error;if(r.error)throw r.error;C(e)||t.warn("[PurchaseListMain] ë©”ëª¨ë¦¬ ìºì‹œ ì…ê³ ì™„ë£Œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨",{purchaseId:e}),A.success("ì…ê³ ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤."),await U()}catch(a){A.error("ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},[c,U]),se=a.useCallback(async e=>{try{const a=(new Date).toISOString(),[s,r]=await Promise.all([c.from("purchase_requests").update({is_payment_completed:!0,payment_completed_at:a}).eq("id",e),c.from("purchase_request_items").update({is_payment_completed:!0,payment_completed_at:a}).eq("purchase_request_id",e)]);if(s.error)throw s.error;if(r.error)throw r.error;k(e)||(t.warn("[PurchaseListMain] ë©”ëª¨ë¦¬ ìºì‹œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨, ë°ì´í„° ì¬ë¡œë“œ",{purchaseId:e}),await U()),A.success("êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.")}catch(a){t.error("[PurchaseListMain] êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ ì‹¤íŒ¨:",a),A.error("ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},[c,U]);a.useCallback(e=>{o(e),u(!0)},[]);const re=a.useMemo(()=>d?{...d,vendor_name:d.vendor_name||"",project_vendor:d.project_vendor||"",sales_order_number:d.sales_order_number||"",project_item:d.project_item||""}:null,[d]);return r.jsxs("div",{className:"w-full",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"page-title",children:"ë°œì£¼ìš”ì²­ ê´€ë¦¬"}),r.jsx("p",{className:"page-subtitle",style:{marginTop:"-2px",marginBottom:"-4px"},children:"Purchase Management"})]}),r.jsxs(_,{onClick:()=>l("/purchase/new"),className:"mt-4 sm:mt-0 bg-hansl-500 hover:bg-hansl-600",children:[r.jsx(ye,{className:"w-4 h-4 mr-2"}),"ìƒˆ ë°œì£¼ìš”ì²­ ì‘ì„±"]})]}),r.jsxs("div",{className:"mb-3",children:[r.jsx(va,{activeFilters:p,sortConfig:x,searchTerm:b,onFiltersChange:h,onSortChange:g,onSearchChange:y,availableEmployees:f,availableVendors:S,availableContacts:F,availablePaymentSchedules:P,showColumnSettings:!0,activeTab:J}),0===p.length&&!b.trim()&&r.jsxs("div",{className:"mt-2 flex items-center gap-1.5 text-xs text-gray-500",children:[r.jsx(we,{className:"w-3.5 h-3.5"}),r.jsx("span",{children:"ìµœê·¼ 60ì¼ ë°ì´í„°ë§Œ í‘œì‹œë©ë‹ˆë‹¤. ë” ì˜¤ë˜ëœ ë°ì´í„°ë¥¼ ë³´ë ¤ë©´ í•„í„°ë¥¼ ì ìš©í•´ì£¼ì„¸ìš”."})]})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsx("div",{className:"flex flex-col sm:flex-row sm:space-x-1 space-y-1 sm:space-y-0 bg-gray-50 p-1 business-radius-card border border-gray-200",children:qa.map(e=>r.jsxs("button",{onClick:()=>{K(e.key)},className:"flex-1 flex items-center justify-center space-x-2 py-1.5 px-3 sm:px-4 business-radius-button button-text font-medium transition-colors "+(J===e.key?"text-hansl-600 bg-white shadow-sm border border-gray-200":"text-gray-600 bg-transparent hover:text-gray-900 hover:bg-white/50"),children:[r.jsx("span",{className:"whitespace-nowrap",children:e.label}),r.jsx("span",{className:"badge-stats "+(J===e.key?"bg-hansl-50 text-hansl-700":"bg-gray-100 text-gray-600"),children:ee[e.key]})]},e.key))}),te&&r.jsx("div",{className:"mb-3",children:"single"===te.type?r.jsxs("div",{className:"inline-flex items-center gap-2 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 business-radius-badge px-3 py-2 shadow-sm",children:[r.jsxs("div",{className:"flex items-center gap-1.5",children:[r.jsx("div",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full"}),r.jsxs("span",{className:"card-subtitle text-gray-700",children:[te.year,"ë…„ ",te.month,"ì›”"]}),r.jsxs("span",{className:"badge-text text-gray-500",children:[te.count,"ê±´"]})]}),r.jsx("div",{className:"h-4 w-px bg-blue-300"}),r.jsxs("span",{className:"modal-value text-blue-700 font-semibold",children:["â‚©",te.total?.toLocaleString()||"0"]})]}):r.jsxs(xe,{className:"business-radius-card border border-gray-200 shadow-sm",children:[r.jsx(ge,{className:"pb-3 pt-4 px-4",children:r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full"}),r.jsx(be,{className:"section-title text-gray-800",children:"ì›”ë³„ ë°œì£¼ìš”ì²­ ì´ì•¡"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("span",{className:"badge-text text-gray-600",children:["(",te.months?.reduce((e,t)=>e+t.count,0)||0,"ê±´)"]}),r.jsx("div",{className:"h-4 w-px bg-gray-300"}),r.jsxs("span",{className:"modal-value text-gray-500 font-bold",children:["â‚©",te.grandTotal?.toLocaleString()||"0"]})]})]})}),r.jsx(_e,{className:"px-4 pb-4",children:r.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:te.months?.map(e=>r.jsx("div",{className:"bg-gray-50 business-radius-card px-3 py-1.5 border border-gray-200 hover:border-blue-300 hover:bg-blue-50 transition-all flex-shrink-0",children:r.jsxs("div",{className:"flex items-baseline gap-1.5",children:[r.jsxs("span",{className:"modal-value font-bold text-gray-800 whitespace-nowrap",children:[e.month,"ì›”"]}),r.jsxs("span",{className:"text-[9px] text-gray-500 whitespace-nowrap",children:["(",e.count,")"]}),r.jsxs("span",{className:"modal-value text-gray-500 font-bold whitespace-nowrap ml-1",children:["â‚©",e.total.toLocaleString()]})]})},e.monthStr))})})]})}),r.jsx(xe,{className:"overflow-hidden border border-gray-200",children:r.jsx(_e,{className:"p-0",children:I?r.jsxs("div",{className:"flex items-center justify-center py-12",children:[r.jsx("div",{className:"w-8 h-8 border-2 border-hansl-500 border-t-transparent rounded-full animate-spin"}),r.jsx("span",{className:"ml-3 card-subtitle",children:"ë¡œë”© ì¤‘..."})]}):0===Q.length?r.jsxs("div",{className:"text-center py-12",children:[r.jsx(pe,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"ë°œì£¼ìš”ì²­ì„œê°€ ì—†ìŠµë‹ˆë‹¤"}),r.jsx("p",{className:"card-subtitle",children:"ìƒˆë¡œìš´ ë°œì£¼ìš”ì²­ì„œë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”."})]}):r.jsx(Qt,{purchases:Q,activeTab:J,currentUserRoles:L,onRefresh:U,onOptimisticUpdate:Y,onPaymentComplete:se,onReceiptComplete:ae})})})]}),re&&r.jsx(a.Suspense,{fallback:r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"})}),children:r.jsx(ka,{isOpen:m,onClose:()=>{u(!1),o(null)},purchase:re,isAdmin:W||!1,onUpdate:U,activeTab:J})})]})}export{$a as default};
//# sourceMappingURL=PurchaseListMain-D9uXeo8a.js.map
