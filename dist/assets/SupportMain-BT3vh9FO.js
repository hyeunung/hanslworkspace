import{c as le,a as de,r as i,j as e,M as ee,B as m,z as Ee,X as De}from"./index-C_XLQIpZ.js";import{C as se,a as te,b as ae,c as re}from"./card-Bnuex2Us.js";import{S as Me,a as Re,b as ze,c as Le,d as P,I as y,t as ce,v as ne,D as Te,e as Ae,f as Ue,g as $e}from"./dialog-9qER4IKQ.js";import{T as Fe}from"./textarea-0SY6bP-i.js";import{B as v,t as o}from"./index-VAyiyELQ.js";import{S as Be,T as ie}from"./trash-2-BJ-Nc10b.js";import{C as He}from"./circle-check-big-Mifekiap.js";import{C as Oe}from"./chevron-right-BfA4GGJg.js";import{S as Ke}from"./save-CgRjXPhw.js";import{f as E,P as Ve}from"./format-Duuke9o2.js";/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],Xe=le("chevron-left",We);/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],Je=le("send",Ge);class Qe{constructor(){this.supabase=de()}async createInquiry(r){try{const{data:{user:t},error:c}=await this.supabase.auth.getUser();if(c||!t)return{success:!1,error:"로그인이 필요합니다."};const{data:l}=await this.supabase.from("employees").select("id, name, email").eq("email",t.email).maybeSingle(),{error:x}=await this.supabase.from("support_inquiries").insert({user_id:t.id,user_email:l?.email||t.email,user_name:l?.name||"",requester_id:l?.id,inquiry_type:r.inquiry_type,subject:r.subject,message:r.message,purchase_request_id:r.purchase_request_id,purchase_order_number:r.purchase_order_number,status:"open"});return x?{success:!1,error:x.message}:{success:!0}}catch(t){return{success:!1,error:t instanceof Error?t.message:"문의 접수 실패"}}}async getMyInquiries(){try{const{data:{user:r},error:t}=await this.supabase.auth.getUser();if(t||!r)return{success:!1,data:[],error:"로그인이 필요합니다."};const{data:c,error:l}=await this.supabase.from("support_inquiries").select(`
          *,
          purchase_requests (
            purchase_order_number,
            vendor_name,
            requester_name
          )
        `).eq("user_id",r.id).order("created_at",{ascending:!1});if(l)throw l;return{success:!0,data:c||[]}}catch(r){return{success:!1,data:[],error:r instanceof Error?r.message:"문의 조회 실패"}}}async getAllInquiries(){try{const{data:r,error:t}=await this.supabase.from("support_inquiries").select(`
          *,
          purchase_requests (
            purchase_order_number,
            vendor_name,
            requester_name,
            purchase_request_items (
              item_name,
              specification,
              quantity
            )
          )
        `).order("created_at",{ascending:!1});if(t)throw t;return{success:!0,data:r||[]}}catch(r){return{success:!1,data:[],error:r instanceof Error?r.message:"문의 조회 실패"}}}async updateInquiryStatus(r,t,c){try{const{data:{user:l},error:x}=await this.supabase.auth.getUser();if(x||!l)return{success:!1,error:"로그인이 필요합니다."};const{data:h}=await this.supabase.from("employees").select("name").eq("email",l.email).single(),j={status:t,handled_by:h?.name||l.email,updated_at:new Date().toISOString()};(t==="resolved"||t==="closed")&&(j.processed_at=new Date().toISOString()),c&&(j.resolution_note=c);const{error:N}=await this.supabase.from("support_inquiries").update(j).eq("id",r);if(N)throw N;return{success:!0}}catch(l){return{success:!1,error:l instanceof Error?l.message:"상태 업데이트 실패"}}}async getMyPurchaseRequests(r,t){try{const{data:{user:c},error:l}=await this.supabase.auth.getUser();if(l||!c)return{success:!1,data:[],error:"로그인이 필요합니다."};const{data:x}=await this.supabase.from("employees").select("name").eq("email",c.email).single();if(!x)return{success:!1,data:[],error:"사용자 정보를 찾을 수 없습니다."};let h=this.supabase.from("purchase_requests").select(`
          id,
          purchase_order_number,
          vendor_name,
          request_date,
          requester_name,
          purchase_request_items (
            item_name,
            specification,
            quantity
          )
        `).eq("requester_name",x.name).order("request_date",{ascending:!1});r&&(h=h.gte("request_date",r)),t&&(h=h.lte("request_date",t));const{data:j,error:N}=await h.limit(100);if(N)throw N;return{success:!0,data:j||[]}}catch(c){return{success:!1,data:[],error:c instanceof Error?c.message:"발주요청 조회 실패"}}}subscribeToInquiries(r){return this.supabase.channel("support_inquiries_changes").on("postgres_changes",{event:"*",schema:"public",table:"support_inquiries"},r).subscribe()}async updatePurchaseRequestItem(r,t){try{const c={};t.item_name!==void 0&&(c.item_name=t.item_name),t.specification!==void 0&&(c.specification=t.specification),t.quantity!==void 0&&(c.quantity=t.quantity),t.remark!==void 0&&(c.remark=t.remark),t.unit_price_value!==void 0&&(c.unit_price_value=t.unit_price_value,c.unit_price_currency="KRW"),t.amount_value!==void 0&&(c.amount_value=t.amount_value,c.amount_currency="KRW");const{error:l}=await this.supabase.from("purchase_request_items").update(c).eq("id",r);if(l)throw l;return{success:!0}}catch(c){return{success:!1,error:c instanceof Error?c.message:"품목 수정 실패"}}}async deletePurchaseRequestItem(r){try{const{error:t}=await this.supabase.from("purchase_request_items").delete().eq("id",r);if(t)throw t;return{success:!0}}catch(t){return{success:!1,error:t instanceof Error?t.message:"품목 삭제 실패"}}}async deletePurchaseRequest(r){try{const{error:t}=await this.supabase.from("purchase_request_items").delete().eq("purchase_request_id",r);if(t)throw t;const{error:c}=await this.supabase.from("purchase_requests").delete().eq("id",r);if(c)throw c;return{success:!0}}catch(t){return{success:!1,error:t instanceof Error?t.message:"발주요청 삭제 실패"}}}async getPurchaseRequestDetail(r){try{const{data:t,error:c}=await this.supabase.from("purchase_requests").select(`
          *,
          purchase_request_items (
            id,
            line_number,
            item_name,
            specification,
            quantity,
            unit_price_value,
            amount_value,
            remark,
            link
          )
        `).eq("id",r).single();if(c)throw c;return{success:!0,data:t}}catch(t){return{success:!1,error:t instanceof Error?t.message:"발주요청 조회 실패"}}}}const g=new Qe;function ds(){const[f,r]=i.useState(""),[t,c]=i.useState(""),[l,x]=i.useState(""),[h,j]=i.useState(!1),[N,$]=i.useState(!1),[F,B]=i.useState(""),[H,O]=i.useState(""),[C,K]=i.useState([]),[q,D]=i.useState(null),[V,W]=i.useState(!1),[w,I]=i.useState(1),[M,ue]=i.useState(null),R=5,[z,oe]=i.useState([]),[p,me]=i.useState(!1),[Ye,xe]=i.useState(""),[he,X]=i.useState(!0),[L,pe]=i.useState(null),[ge,T]=i.useState(!1),[u,G]=i.useState(null),[fe,J]=i.useState(!1),[b,A]=i.useState(null),[d,_]=i.useState(null);i.useEffect(()=>{(async()=>{await je()})();const a=g.subscribeToInquiries(n=>{console.log("실시간 업데이트:",n),S()});return()=>{a.unsubscribe()}},[]),i.useEffect(()=>{S()},[p]);const je=async()=>{const s=de(),{data:{user:a}}=await s.auth.getUser();if(!a)return;xe(a.email||"");const{data:n}=await s.from("employees").select("purchase_role").eq("email",a.email).single();if(n){const ke=Array.isArray(n.purchase_role)?n.purchase_role:n.purchase_role?.split(",").map(Pe=>Pe.trim())||[];me(ke.includes("app_admin"))}},S=async()=>{X(!0);const s=p?await g.getAllInquiries():await g.getMyInquiries();s.success&&oe(s.data),X(!1)};i.useEffect(()=>{f==="modify"||f==="delete"?$(!0):($(!1),D(null))},[f]);const _e=async()=>{W(!0),I(1);const s=await g.getMyPurchaseRequests(F,H);s.success?K(s.data):o.error(s.error||"발주요청 조회 실패"),W(!1)},k=Math.ceil(C.length/R),Q=(w-1)*R,ye=Q+R,Ne=C.slice(Q,ye),be=async s=>{if(s.preventDefault(),!f||!t||!l){o.error("모든 필드를 입력해주세요.");return}if((f==="modify"||f==="delete")&&!q){o.error("수정/삭제할 발주요청을 선택해주세요.");return}j(!0);const a=await g.createInquiry({inquiry_type:f,subject:t,message:l,purchase_request_id:q?.id,purchase_order_number:q?.purchase_order_number});a.success?(o.success("문의가 접수되었습니다."),r(""),c(""),x(""),D(null),K([]),B(""),O(""),S()):o.error(a.error||"문의 접수에 실패했습니다."),j(!1)},Y=async(s,a)=>{const n=await g.updateInquiryStatus(s,a);n.success?(o.success("상태가 업데이트되었습니다."),S()):o.error(n.error||"상태 업데이트 실패")},U=async s=>{J(!0),A(null),_(null);const a=await g.getPurchaseRequestDetail(s);a.success?(G(a.data),T(!0)):o.error(a.error||"발주요청 상세 조회 실패"),J(!1)},ve=s=>{A(s.id),_({item_name:s.item_name,specification:s.specification,quantity:s.quantity,unit_price_value:s.unit_price_value,remark:s.remark})},Z=()=>{A(null),_(null)},we=async s=>{if(!d)return;const a=(d.quantity||0)*(d.unit_price_value||0),n=await g.updatePurchaseRequestItem(s,{item_name:d.item_name,specification:d.specification,quantity:d.quantity,unit_price_value:d.unit_price_value,amount_value:a,remark:d.remark});n.success?(o.success("품목이 수정되었습니다."),u?.id&&U(u.id),Z()):o.error(n.error||"품목 수정 실패")},qe=async s=>{if(!confirm("이 품목을 삭제하시겠습니까?"))return;const a=await g.deletePurchaseRequestItem(s);a.success?(o.success("품목이 삭제되었습니다."),u?.id&&U(u.id)):o.error(a.error||"품목 삭제 실패")},Se=async()=>{if(!u?.id||!confirm(`이 발주요청 전체를 삭제하시겠습니까?
모든 품목이 함께 삭제됩니다.`))return;const s=await g.deletePurchaseRequest(u.id);s.success?(o.success("발주요청이 삭제되었습니다."),T(!1),G(null),S()):o.error(s.error||"발주요청 삭제 실패")},Ce=s=>{switch(s){case"open":return e.jsx(v,{className:"bg-yellow-100 text-yellow-800",children:"대기"});case"in_progress":return e.jsx(v,{className:"bg-blue-100 text-blue-800",children:"처리중"});case"resolved":return e.jsx(v,{className:"bg-green-100 text-green-800",children:"완료"});case"closed":return e.jsx(v,{className:"bg-gray-100 text-gray-800",children:"종료"});default:return e.jsx(v,{children:"-"})}},Ie=s=>{switch(s){case"bug":return"오류 신고";case"modify":return"수정 요청";case"delete":return"삭제 요청";case"other":return"기타 문의";default:return s}};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"문의하기"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"시스템 사용 중 궁금하신 점이나 개선사항을 알려주세요"})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-4",children:[e.jsxs(se,{children:[e.jsx(te,{children:e.jsxs(ae,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5"}),"문의 내용"]})}),e.jsx(re,{children:e.jsxs("form",{onSubmit:be,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["문의 유형 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(Me,{value:f,onValueChange:r,children:[e.jsx(Re,{children:e.jsx(ze,{placeholder:"문의 유형을 선택해주세요"})}),e.jsxs(Le,{children:[e.jsx(P,{value:"bug",children:"오류 신고"}),e.jsx(P,{value:"modify",children:"수정 요청"}),e.jsx(P,{value:"delete",children:"삭제 요청"}),e.jsx(P,{value:"other",children:"기타 문의"})]})]})]}),N&&e.jsxs("div",{className:"space-y-3 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("div",{className:"text-sm font-medium text-blue-900",children:"수정/삭제할 발주요청 선택"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"시작일"}),e.jsx(y,{type:"date",value:F,onChange:s=>B(s.target.value),className:"h-9"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"종료일"}),e.jsx(y,{type:"date",value:H,onChange:s=>O(s.target.value),className:"h-9"})]})]}),e.jsx(m,{type:"button",onClick:_e,disabled:V,className:"w-full h-9",variant:"outline",children:V?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-600 border-t-transparent rounded-full animate-spin mr-2"}),"검색 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),"발주요청 검색"]})}),C.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-xs text-gray-600",children:["발주요청 선택 (총 ",C.length,"건)"]}),e.jsx("div",{className:"space-y-1",children:Ne.map(s=>e.jsxs("div",{className:"border rounded overflow-hidden",children:[e.jsx("div",{onClick:()=>D(s),className:`px-3 py-2 cursor-pointer transition-all text-xs ${q?.id===s.id?"border-blue-500 bg-blue-50":"hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("span",{className:"font-medium whitespace-nowrap",children:s.purchase_order_number||"N/A"}),e.jsx("span",{className:"text-gray-600 truncate",children:s.vendor_name}),e.jsxs("span",{className:"text-gray-500",children:[s.purchase_request_items?.[0]?.item_name||"품목 없음",s.purchase_request_items?.length>1&&e.jsx("span",{className:"font-medium text-blue-600",children:` 외 ${s.purchase_request_items.length-1}건`})]}),e.jsx("span",{className:"text-gray-400 whitespace-nowrap ml-auto",children:s.request_date&&E(new Date(s.request_date),"MM/dd")})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[q?.id===s.id&&e.jsx(He,{className:"w-4 h-4 text-blue-500 flex-shrink-0"}),s.purchase_request_items?.length>1&&e.jsx("button",{type:"button",onClick:a=>{a.stopPropagation(),ue(M===s.id?null:s.id)},className:"p-1 hover:bg-gray-200 rounded",children:M===s.id?e.jsx(ce,{className:"w-4 h-4"}):e.jsx(ne,{className:"w-4 h-4"})})]})]})}),M===s.id&&s.purchase_request_items?.length>0&&e.jsx("div",{className:"px-3 py-2 bg-gray-50 border-t text-xs",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-gray-700 mb-1",children:"품목 상세"}),s.purchase_request_items.map((a,n)=>e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 pl-2",children:[e.jsxs("span",{className:"text-gray-400",children:[n+1,"."]}),e.jsx("span",{children:a.item_name}),a.specification&&e.jsxs("span",{className:"text-gray-500",children:["(",a.specification,")"]}),e.jsxs("span",{className:"text-gray-500",children:["- ",a.quantity,"개"]})]},n))]})})]},s.id))}),k>1&&e.jsxs("div",{className:"flex justify-center items-center gap-1 pt-2",children:[e.jsx(m,{type:"button",variant:"outline",size:"sm",onClick:()=>I(Math.max(1,w-1)),disabled:w===1,className:"h-8 w-8 p-0",children:e.jsx(Xe,{className:"w-4 h-4"})}),Array.from({length:k},(s,a)=>a+1).map(s=>e.jsx(m,{type:"button",variant:w===s?"default":"outline",size:"sm",onClick:()=>I(s),className:"h-8 w-8 p-0",children:s},s)),e.jsx(m,{type:"button",variant:"outline",size:"sm",onClick:()=>I(Math.min(k,w+1)),disabled:w===k,className:"h-8 w-8 p-0",children:e.jsx(Oe,{className:"w-4 h-4"})})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["제목 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(y,{value:t,onChange:s=>c(s.target.value),placeholder:"문의 제목을 입력해주세요",maxLength:100})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["내용 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(Fe,{value:l,onChange:s=>x(s.target.value),placeholder:"문의 내용을 자세히 입력해주세요",rows:6,maxLength:1e3}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[l.length,"/1000"]})]}),e.jsx(m,{type:"submit",className:"w-full",disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"전송 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Je,{className:"w-4 h-4 mr-2"}),"문의 보내기"]})})]})})]}),e.jsxs(se,{children:[e.jsx(te,{children:e.jsxs(ae,{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"w-5 h-5 text-orange-500"}),p?"전체 문의 목록":"내 문의 내역"]}),e.jsxs(v,{variant:"outline",children:[z.length,"건"]})]})}),e.jsx(re,{children:he?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"w-6 h-6 border-2 border-gray-300 border-t-transparent rounded-full animate-spin"})}):z.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ee,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"문의 내역이 없습니다"})]}):e.jsx("div",{className:"space-y-1 max-h-[600px] overflow-y-auto",children:z.map(s=>e.jsxs("div",{className:"border rounded overflow-hidden",children:[e.jsx("div",{className:`px-3 py-2 hover:bg-gray-50 transition-colors cursor-pointer ${(s.inquiry_type==="modify"||s.inquiry_type==="delete")&&s.purchase_request_id?"hover:bg-blue-50":""}`,onClick:()=>{(s.inquiry_type==="modify"||s.inquiry_type==="delete")&&s.purchase_request_id?U(s.purchase_request_id.toString()):pe(L===s.id?null:s.id)},children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx(v,{variant:"outline",className:"text-xs whitespace-nowrap",children:Ie(s.inquiry_type)}),Ce(s.status),e.jsx("span",{className:"text-sm font-medium truncate",children:s.subject}),p&&e.jsx("span",{className:"text-xs text-gray-500",children:s.user_name||s.user_email}),s.purchase_order_number&&e.jsxs("span",{className:"text-xs text-blue-600",children:["[",s.purchase_order_number,"]"]}),e.jsx("span",{className:"text-xs text-gray-400 ml-auto whitespace-nowrap",children:s.created_at&&E(new Date(s.created_at),"MM/dd HH:mm")})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[p&&s.status==="open"&&e.jsx(m,{size:"sm",variant:"outline",onClick:a=>{a.stopPropagation(),Y(s.id,"in_progress")},className:"h-6 text-xs px-2",children:"처리중"}),p&&(s.status==="open"||s.status==="in_progress")&&e.jsx(m,{size:"sm",onClick:a=>{a.stopPropagation(),Y(s.id,"resolved")},className:"h-6 text-xs px-2 bg-green-600 hover:bg-green-700",children:"완료"}),e.jsx("button",{type:"button",className:"p-1 hover:bg-gray-200 rounded",children:L===s.id?e.jsx(ce,{className:"w-4 h-4"}):e.jsx(ne,{className:"w-4 h-4"})})]})]})}),L===s.id&&e.jsx("div",{className:"px-3 py-3 bg-gray-50 border-t text-sm",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"내용:"}),e.jsx("p",{className:"text-gray-600 mt-1 whitespace-pre-wrap",children:s.message})]}),s.purchase_order_number&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"관련 발주번호:"}),e.jsx("span",{className:"text-blue-600 ml-2",children:s.purchase_order_number})]}),s.handled_by&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"처리자:"}),e.jsxs("span",{className:"text-green-600 ml-2",children:[s.handled_by,s.processed_at&&` (${E(new Date(s.processed_at),"yyyy-MM-dd HH:mm")})`]})]}),s.resolution_note&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"처리 내용:"}),e.jsx("p",{className:"text-gray-600 mt-1",children:s.resolution_note})]})]})})]},s.id))})})]})]})]}),e.jsx(Te,{open:ge,onOpenChange:T,children:e.jsxs(Ae,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsx(Ue,{children:e.jsxs($e,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"발주요청 상세"}),p&&u&&e.jsxs(m,{variant:"destructive",size:"sm",onClick:Se,className:"h-8 text-xs px-3",children:[e.jsx(ie,{className:"w-3 h-3 mr-1"}),"전체 삭제"]})]})}),fe?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"w-6 h-6 border-2 border-gray-300 border-t-transparent rounded-full animate-spin"})}):u&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"발주번호"}),e.jsx("p",{className:"font-medium",children:u.purchase_order_number||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"업체명"}),e.jsx("p",{className:"font-medium",children:u.vendor_name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"요청자"}),e.jsx("p",{className:"font-medium",children:u.requester_name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"요청일"}),e.jsx("p",{className:"font-medium",children:u.request_date&&E(new Date(u.request_date),"yyyy-MM-dd")})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"품목 상세"}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left text-xs font-medium text-gray-700 px-2 py-2 w-12",children:"번호"}),e.jsx("th",{className:"text-left text-xs font-medium text-gray-700 px-2 py-2",children:"품명"}),e.jsx("th",{className:"text-left text-xs font-medium text-gray-700 px-2 py-2",children:"규격"}),e.jsx("th",{className:"text-center text-xs font-medium text-gray-700 px-2 py-2 w-16",children:"수량"}),e.jsx("th",{className:"text-right text-xs font-medium text-gray-700 px-2 py-2 w-24",children:"단가"}),e.jsx("th",{className:"text-right text-xs font-medium text-gray-700 px-2 py-2 w-28",children:"금액"}),e.jsx("th",{className:"text-left text-xs font-medium text-gray-700 px-2 py-2",children:"비고"}),e.jsx("th",{className:"text-left text-xs font-medium text-gray-700 px-2 py-2 w-20",children:"링크"}),p&&e.jsx("th",{className:"text-center text-xs font-medium text-gray-700 px-2 py-2 w-20",children:"작업"})]})}),e.jsx("tbody",{children:u.purchase_request_items?.map((s,a)=>e.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[e.jsx("td",{className:"text-xs px-2 py-2 text-center",children:s.line_number||a+1}),e.jsx("td",{className:"text-xs px-2 py-2",children:b===s.id?e.jsx(y,{value:d?.item_name||"",onChange:n=>_({...d,item_name:n.target.value}),className:"h-7 text-xs"}):s.item_name}),e.jsx("td",{className:"text-xs px-2 py-2",children:b===s.id?e.jsx(y,{value:d?.specification||"",onChange:n=>_({...d,specification:n.target.value}),className:"h-7 text-xs"}):s.specification||"-"}),e.jsx("td",{className:"text-xs text-center px-2 py-2",children:b===s.id?e.jsx(y,{type:"number",value:d?.quantity||"",onChange:n=>_({...d,quantity:parseInt(n.target.value)}),className:"h-7 text-xs text-center"}):s.quantity}),e.jsx("td",{className:"text-xs text-right px-2 py-2",children:b===s.id?e.jsx(y,{type:"number",value:d?.unit_price_value||"",onChange:n=>_({...d,unit_price_value:parseInt(n.target.value)}),className:"h-7 text-xs text-right"}):s.unit_price_value?`${parseFloat(s.unit_price_value).toLocaleString()}`:"-"}),e.jsx("td",{className:"text-xs text-right px-2 py-2",children:b===s.id?`${((d?.quantity||0)*(d?.unit_price_value||0)).toLocaleString()}`:s.amount_value?`${parseFloat(s.amount_value).toLocaleString()}`:"-"}),e.jsx("td",{className:"text-xs px-2 py-2",children:b===s.id?e.jsx(y,{value:d?.remark||"",onChange:n=>_({...d,remark:n.target.value}),className:"h-7 text-xs"}):s.remark||"-"}),e.jsx("td",{className:"text-xs px-2 py-2",children:s.link?e.jsx("a",{href:s.link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"링크"}):"-"}),p&&e.jsx("td",{className:"text-xs text-center px-3 py-2",children:b===s.id?e.jsxs("div",{className:"flex justify-center gap-1",children:[e.jsx(m,{size:"sm",variant:"outline",onClick:()=>we(s.id),className:"h-6 w-6 p-0",children:e.jsx(Ke,{className:"w-3 h-3"})}),e.jsx(m,{size:"sm",variant:"ghost",onClick:Z,className:"h-6 w-6 p-0",children:e.jsx(De,{className:"w-3 h-3"})})]}):e.jsxs("div",{className:"flex justify-center gap-1",children:[e.jsx(m,{size:"sm",variant:"ghost",onClick:()=>ve(s),className:"h-6 w-6 p-0",children:e.jsx(Ve,{className:"w-3 h-3"})}),e.jsx(m,{size:"sm",variant:"ghost",onClick:()=>qe(s.id),className:"h-6 w-6 p-0 text-red-600 hover:text-red-700",children:e.jsx(ie,{className:"w-3 h-3"})})]})})]},s.id))}),e.jsx("tfoot",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:5,className:"text-xs font-medium text-right px-2 py-2",children:"합계"}),e.jsx("td",{className:"text-xs font-medium text-right px-2 py-2",children:u.purchase_request_items?.reduce((s,a)=>s+(parseFloat(a.amount_value)||0),0).toLocaleString()}),e.jsx("td",{colSpan:p?3:2,className:"px-2 py-2"})]})})]})})]}),u.notes&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"비고"}),e.jsx("p",{className:"text-sm text-gray-600 p-3 bg-gray-50 rounded-lg",children:u.notes})]})]})]})})]})}export{ds as default};
//# sourceMappingURL=SupportMain-BT3vh9FO.js.map
