import{c as Me,a as oe,r as l,j as e,M as se,b as g,G as Re}from"./index-m3fJUWdN.js";import{C as te,a as ae,b as re,c as ne}from"./card-CB2Q29jH.js";import{I as v}from"./input-L8jZtFSn.js";import{T as ce}from"./textarea-wXZ1djWI.js";import{S as Ae,a as ze,b as Le,c as Te,d as P,f as le}from"./select-CHF8V9yq.js";import{B as b,t as m}from"./index-OpY-RBjo.js";import{D as Ue,a as Fe,b as $e,c as He}from"./dialog-BsyHRK2b.js";import{S as Be}from"./search-gHNZD30F.js";import{C as Oe,a as Ke}from"./circle-check-big-B_vs-Xwo.js";import{C as ie}from"./chevron-down-B34F4nwP.js";import{C as Ve,E as We}from"./eye-D8dGsA2j.js";import{T as F}from"./trash-2-CYhjtZSR.js";import{S as Ge}from"./save-CXgkag0j.js";import{f as E,P as Je}from"./format-Dg54GRbZ.js";/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],Xe=Me("send",Qe);class Ye{constructor(){this.supabase=oe()}async createInquiry(a){try{const{data:{user:t},error:n}=await this.supabase.auth.getUser();if(n||!t)return{success:!1,error:"로그인이 필요합니다."};const{data:c}=await this.supabase.from("employees").select("id, name, email").eq("email",t.email).maybeSingle(),{error:d}=await this.supabase.from("support_inquires").insert({user_id:t.id,user_email:c?.email||t.email,user_name:c?.name||"",requester_id:c?.id,inquiry_type:a.inquiry_type,subject:a.subject,message:a.message,purchase_request_id:a.purchase_request_id,purchase_order_number:a.purchase_order_number,status:"open"});return d?(console.error("문의 등록 에러:",d),console.error("에러 상세:",{code:d.code,message:d.message,details:d.details,hint:d.hint}),{success:!1,error:d.message}):{success:!0}}catch(t){return{success:!1,error:t instanceof Error?t.message:"문의 접수 실패"}}}async getMyInquiries(){try{console.log("🔍 getMyInquiries 시작");const{data:{user:a},error:t}=await this.supabase.auth.getUser();if(t||!a)return console.log("❌ 인증 에러:",t),{success:!1,data:[],error:"로그인이 필요합니다."};console.log("👤 현재 사용자:",a.id,a.email);const{data:n,error:c}=await this.supabase.from("support_inquires").select("*,purchase_requests(purchase_order_number,vendor_name,requester_name)").eq("user_id",a.id).order("created_at",{ascending:!1});if(console.log("📊 문의 쿼리 결과:",{data:n,error:c}),c)throw console.error("❌ 문의 조회 에러:",c),c;return console.log("✅ 내 문의 목록 조회 성공:",n?.length||0,"건"),{success:!0,data:n||[]}}catch(a){return console.error("❌ getMyInquiries 예외:",a),{success:!1,data:[],error:a instanceof Error?a.message:"문의 조회 실패"}}}async getAllInquiries(){try{console.log("🔍 getAllInquiries 시작 (관리자용)");const{data:a,error:t}=await this.supabase.from("support_inquires").select("*,purchase_requests(purchase_order_number,vendor_name,requester_name,purchase_request_items(item_name,specification,quantity).order(line_number))").order("created_at",{ascending:!1});if(console.log("📊 전체 문의 쿼리 결과:",{data:a,error:t}),t)throw console.error("❌ 전체 문의 조회 에러:",t),t;return console.log("✅ 전체 문의 목록 조회 성공:",a?.length||0,"건"),{success:!0,data:a||[]}}catch(a){return console.error("❌ getAllInquiries 예외:",a),{success:!1,data:[],error:a instanceof Error?a.message:"문의 조회 실패"}}}async updateInquiryStatus(a,t,n){try{const{data:{user:c},error:d}=await this.supabase.auth.getUser();if(d||!c)return{success:!1,error:"로그인이 필요합니다."};const{data:x}=await this.supabase.from("employees").select("name").eq("email",c.email).single(),p={status:t,handled_by:x?.name||c.email,updated_at:new Date().toISOString()};(t==="resolved"||t==="closed")&&(p.processed_at=new Date().toISOString()),n&&(p.resolution_note=n);const{error:_}=await this.supabase.from("support_inquires").update(p).eq("id",a);if(_)throw _;return{success:!0}}catch(c){return{success:!1,error:c instanceof Error?c.message:"상태 업데이트 실패"}}}async getMyPurchaseRequests(a,t){try{const{data:{user:n},error:c}=await this.supabase.auth.getUser();if(c||!n)return{success:!1,data:[],error:"로그인이 필요합니다."};const{data:d}=await this.supabase.from("employees").select("name").eq("email",n.email).single();if(!d)return{success:!1,data:[],error:"사용자 정보를 찾을 수 없습니다."};let x=this.supabase.from("purchase_requests").select("id,purchase_order_number,vendor_name,request_date,requester_name,purchase_request_items(item_name,specification,quantity).order(line_number)").eq("requester_name",d.name).order("request_date",{ascending:!1});a&&(x=x.gte("request_date",a)),t&&(x=x.lte("request_date",t));const{data:p,error:_}=await x.limit(100);if(_)throw _;return{success:!0,data:p||[]}}catch(n){return{success:!1,data:[],error:n instanceof Error?n.message:"발주요청 조회 실패"}}}subscribeToInquiries(a){return this.supabase.channel("support_inquires_changes").on("postgres_changes",{event:"*",schema:"public",table:"support_inquires"},a).subscribe()}async updatePurchaseRequestItem(a,t){try{const n={};t.item_name!==void 0&&(n.item_name=t.item_name),t.specification!==void 0&&(n.specification=t.specification),t.quantity!==void 0&&(n.quantity=t.quantity),t.remark!==void 0&&(n.remark=t.remark),t.unit_price_value!==void 0&&(n.unit_price_value=t.unit_price_value,n.unit_price_currency="KRW"),t.amount_value!==void 0&&(n.amount_value=t.amount_value,n.amount_currency="KRW");const{error:c}=await this.supabase.from("purchase_request_items").update(n).eq("id",a);if(c)throw c;return{success:!0}}catch(n){return{success:!1,error:n instanceof Error?n.message:"품목 수정 실패"}}}async deletePurchaseRequestItem(a){try{const{error:t}=await this.supabase.from("purchase_request_items").delete().eq("id",a);if(t)throw t;return{success:!0}}catch(t){return{success:!1,error:t instanceof Error?t.message:"품목 삭제 실패"}}}async deletePurchaseRequest(a){try{const{error:t}=await this.supabase.from("purchase_request_items").delete().eq("purchase_request_id",a);if(t)throw t;const{error:n}=await this.supabase.from("purchase_requests").delete().eq("id",a);if(n)throw n;return{success:!0}}catch(t){return{success:!1,error:t instanceof Error?t.message:"발주요청 삭제 실패"}}}async getPurchaseRequestDetail(a){try{const{data:t,error:n}=await this.supabase.from("purchase_requests").select("*,purchase_request_items(id,line_number,item_name,specification,quantity,unit_price_value,amount_value,remark,link).order(line_number)").eq("id",a).single();if(n)throw n;return{success:!0,data:t}}catch(t){return{success:!1,error:t instanceof Error?t.message:"발주요청 조회 실패"}}}async deleteInquiry(a){try{const{data:{user:t},error:n}=await this.supabase.auth.getUser();if(n||!t)return{success:!1,error:"로그인이 필요합니다."};const{data:c}=await this.supabase.from("employees").select("purchase_role").eq("email",t.email).single();if(!c?.purchase_role?.includes("app_admin")){const{data:p,error:_}=await this.supabase.from("support_inquires").select("user_id, status, resolution_note").eq("id",a).single();if(_||!p)return{success:!1,error:"문의를 찾을 수 없습니다."};if(p.user_id!==t.id)return{success:!1,error:"본인의 문의만 삭제할 수 있습니다."};if(p.resolution_note)return{success:!1,error:"답변이 완료된 문의는 삭제할 수 없습니다."};if(p.status!=="open")return{success:!1,error:"처리가 진행된 문의는 삭제할 수 없습니다."}}const{error:x}=await this.supabase.from("support_inquires").delete().eq("id",a);if(x)throw x;return{success:!0}}catch(t){return{success:!1,error:t instanceof Error?t.message:"문의 삭제 실패"}}}}const f=new Ye;function hs(){const[j,a]=l.useState(""),[t,n]=l.useState(""),[c,d]=l.useState(""),[x,p]=l.useState(!1),[_,$]=l.useState(!1),[H,B]=l.useState(""),[O,K]=l.useState(""),[I,V]=l.useState([]),[S,D]=l.useState(null),[W,G]=l.useState(!1),[w,C]=l.useState(1),[M,ue]=l.useState(null),R=5,[A,de]=l.useState([]),[h,me]=l.useState(!1),[he,xe]=l.useState(""),[pe,J]=l.useState(!0),[z,ge]=l.useState(null),[fe,L]=l.useState(!1),[u,Q]=l.useState(null),[je,X]=l.useState(!1),[N,T]=l.useState(null),[o,y]=l.useState(null);l.useEffect(()=>{(async()=>{await _e()})();const r=f.subscribeToInquiries(i=>{q()});return()=>{r.unsubscribe()}},[]),l.useEffect(()=>{q()},[h]);const _e=async()=>{const s=oe(),{data:{user:r}}=await s.auth.getUser();if(!r)return;xe(r.email||"");const{data:i}=await s.from("employees").select("purchase_role").eq("email",r.email).single();if(i){const Ee=Array.isArray(i.purchase_role)?i.purchase_role:i.purchase_role?.split(",").map(De=>De.trim())||[];me(Ee.includes("app_admin"))}},q=async()=>{console.log("🔄 loadInquiries 시작 - isAdmin:",h),J(!0);const s=h?await f.getAllInquiries():await f.getMyInquiries();console.log("📋 문의 목록 로드 결과:",s),s.success?(console.log("✅ 문의 목록 설정:",s.data.length,"건"),de(s.data)):console.error("❌ 문의 목록 로드 실패:",s.error),J(!1)};l.useEffect(()=>{j==="modify"||j==="delete"?$(!0):($(!1),D(null))},[j]);const ye=async()=>{G(!0),C(1);const s=await f.getMyPurchaseRequests(H,O);s.success?V(s.data):m.error(s.error||"발주요청 조회 실패"),G(!1)},k=Math.ceil(I.length/R),Y=(w-1)*R,be=Y+R,Ne=I.slice(Y,be),ve=async s=>{if(s.preventDefault(),!j||!t||!c){m.error("모든 필드를 입력해주세요.");return}if((j==="modify"||j==="delete")&&!S){m.error("수정/삭제할 발주요청을 선택해주세요.");return}p(!0);const r=await f.createInquiry({inquiry_type:j,subject:t,message:c,purchase_request_id:S?.id,purchase_order_number:S?.purchase_order_number});r.success?(m.success("문의가 접수되었습니다."),a(""),n(""),d(""),D(null),V([]),B(""),K(""),q()):m.error(r.error||"문의 접수에 실패했습니다."),p(!1)},Z=async(s,r)=>{const i=await f.updateInquiryStatus(s,r);i.success?(m.success("상태가 업데이트되었습니다."),q()):m.error(i.error||"상태 업데이트 실패")},we=async s=>{if(!confirm(`정말로 이 문의를 삭제하시겠습니까?
삭제된 문의는 복구할 수 없습니다.`))return;const r=await f.deleteInquiry(s);r.success?(m.success("문의가 삭제되었습니다."),q()):m.error(r.error||"문의 삭제 실패")},U=async s=>{X(!0),T(null),y(null);const r=await f.getPurchaseRequestDetail(s);r.success?(Q(r.data),L(!0)):m.error(r.error||"발주요청 상세 조회 실패"),X(!1)},qe=s=>{T(s.id),y({item_name:s.item_name,specification:s.specification,quantity:s.quantity,unit_price_value:s.unit_price_value,remark:s.remark})},ee=()=>{T(null),y(null)},Se=async s=>{if(!o)return;const r=(o.quantity||0)*(o.unit_price_value||0),i=await f.updatePurchaseRequestItem(s,{item_name:o.item_name,specification:o.specification,quantity:o.quantity,unit_price_value:o.unit_price_value,amount_value:r,remark:o.remark});i.success?(m.success("품목이 수정되었습니다."),u?.id&&U(u.id),ee()):m.error(i.error||"품목 수정 실패")},Ie=async s=>{if(!confirm("이 품목을 삭제하시겠습니까?"))return;const r=await f.deletePurchaseRequestItem(s);r.success?(m.success("품목이 삭제되었습니다."),u?.id&&U(u.id)):m.error(r.error||"품목 삭제 실패")},Ce=async()=>{if(!u?.id||!confirm(`이 발주요청 전체를 삭제하시겠습니까?
모든 품목이 함께 삭제됩니다.`))return;const s=await f.deletePurchaseRequest(u.id);s.success?(m.success("발주요청이 삭제되었습니다."),L(!1),Q(null),q()):m.error(s.error||"발주요청 삭제 실패")},ke=s=>{switch(s){case"open":return e.jsx(b,{className:"bg-yellow-100 text-yellow-800",children:"대기"});case"in_progress":return e.jsx(b,{className:"bg-blue-100 text-blue-800",children:"처리중"});case"resolved":return e.jsx(b,{className:"bg-green-100 text-green-800",children:"완료"});case"closed":return e.jsx(b,{className:"bg-gray-100 text-gray-800",children:"종료"});default:return e.jsx(b,{children:"-"})}},Pe=s=>{switch(s){case"bug":return"오류 신고";case"modify":return"수정 요청";case"delete":return"삭제 요청";case"other":return"기타 문의";default:return s}};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"문의하기"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:h?"모든 문의를 관리하고 답변할 수 있습니다":"시스템 사용 중 궁금하신 점이나 개선사항을 알려주세요"})]}),e.jsxs("div",{className:`${h?"max-w-4xl":"grid grid-cols-1 xl:grid-cols-2 gap-4"}`,children:[!h&&e.jsxs(te,{children:[e.jsx(ae,{children:e.jsxs(re,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5"}),"문의 내용"]})}),e.jsx(ne,{children:e.jsxs("form",{onSubmit:ve,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["문의 유형 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(Ae,{value:j,onValueChange:a,children:[e.jsx(ze,{children:e.jsx(Le,{placeholder:"문의 유형을 선택해주세요"})}),e.jsxs(Te,{children:[e.jsx(P,{value:"bug",children:"오류 신고"}),e.jsx(P,{value:"modify",children:"수정 요청"}),e.jsx(P,{value:"delete",children:"삭제 요청"}),e.jsx(P,{value:"other",children:"기타 문의"})]})]})]}),_&&e.jsxs("div",{className:"space-y-3 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("div",{className:"text-sm font-medium text-blue-900",children:"수정/삭제할 발주요청 선택"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"시작일"}),e.jsx(v,{type:"date",value:H,onChange:s=>B(s.target.value),className:"h-9"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"종료일"}),e.jsx(v,{type:"date",value:O,onChange:s=>K(s.target.value),className:"h-9"})]})]}),e.jsx(g,{type:"button",onClick:ye,disabled:W,className:"w-full h-9",variant:"outline",children:W?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-600 border-t-transparent rounded-full animate-spin mr-2"}),"검색 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),"발주요청 검색"]})}),I.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-xs text-gray-600",children:["발주요청 선택 (총 ",I.length,"건)"]}),e.jsx("div",{className:"space-y-1",children:Ne.map(s=>e.jsxs("div",{className:"border rounded overflow-hidden",children:[e.jsx("div",{onClick:()=>D(s),className:`px-3 py-2 cursor-pointer transition-all text-xs ${S?.id===s.id?"border-blue-500 bg-blue-50":"hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("span",{className:"font-medium whitespace-nowrap",children:s.purchase_order_number||"N/A"}),e.jsx("span",{className:"text-gray-600 truncate",children:s.vendor_name}),e.jsxs("span",{className:"text-gray-500",children:[s.purchase_request_items?.[0]?.item_name||"품목 없음",s.purchase_request_items?.length>1&&e.jsx("span",{className:"font-medium text-blue-600",children:` 외 ${s.purchase_request_items.length-1}건`})]}),e.jsx("span",{className:"text-gray-400 whitespace-nowrap ml-auto",children:s.request_date&&E(new Date(s.request_date),"MM/dd")})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[S?.id===s.id&&e.jsx(Oe,{className:"w-4 h-4 text-blue-500 flex-shrink-0"}),s.purchase_request_items?.length>1&&e.jsx("button",{type:"button",onClick:r=>{r.stopPropagation(),ue(M===s.id?null:s.id)},className:"p-1 hover:bg-gray-200 rounded",children:M===s.id?e.jsx(le,{className:"w-4 h-4"}):e.jsx(ie,{className:"w-4 h-4"})})]})]})}),M===s.id&&s.purchase_request_items?.length>0&&e.jsx("div",{className:"px-3 py-2 bg-gray-50 border-t text-xs",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-gray-700 mb-1",children:"품목 상세"}),s.purchase_request_items.map((r,i)=>e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 pl-2",children:[e.jsxs("span",{className:"text-gray-400",children:[i+1,"."]}),e.jsx("span",{children:r.item_name}),r.specification&&e.jsxs("span",{className:"text-gray-500",children:["(",r.specification,")"]}),e.jsxs("span",{className:"text-gray-500",children:["- ",r.quantity,"개"]})]},i))]})})]},s.id))}),k>1&&e.jsxs("div",{className:"flex justify-center items-center gap-1 pt-2",children:[e.jsx(g,{type:"button",variant:"outline",size:"sm",onClick:()=>C(Math.max(1,w-1)),disabled:w===1,className:"h-8 w-8 p-0",children:e.jsx(Ke,{className:"w-4 h-4"})}),Array.from({length:k},(s,r)=>r+1).map(s=>e.jsx(g,{type:"button",variant:w===s?"default":"outline",size:"sm",onClick:()=>C(s),className:"h-8 w-8 p-0",children:s},s)),e.jsx(g,{type:"button",variant:"outline",size:"sm",onClick:()=>C(Math.min(k,w+1)),disabled:w===k,className:"h-8 w-8 p-0",children:e.jsx(Ve,{className:"w-4 h-4"})})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["제목 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(v,{value:t,onChange:s=>n(s.target.value),placeholder:"문의 제목을 입력해주세요",maxLength:100})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["내용 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(ce,{value:c,onChange:s=>d(s.target.value),placeholder:"문의 내용을 자세히 입력해주세요",rows:6,maxLength:1e3}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[c.length,"/1000"]})]}),e.jsx(g,{type:"submit",className:"w-full",disabled:x,children:x?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"전송 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Xe,{className:"w-4 h-4 mr-2"}),"문의 보내기"]})})]})})]}),e.jsxs(te,{children:[e.jsx(ae,{children:e.jsxs(re,{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-5 h-5 text-orange-500"}),h?"전체 문의 목록":"내 문의 내역"]}),e.jsxs(b,{variant:"outline",children:[A.length,"건"]})]})}),e.jsx(ne,{children:pe?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"w-6 h-6 border-2 border-gray-300 border-t-transparent rounded-full animate-spin"})}):A.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(se,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"문의 내역이 없습니다"})]}):e.jsx("div",{className:"space-y-1 max-h-[600px] overflow-y-auto",children:A.map(s=>e.jsxs("div",{className:"border rounded overflow-hidden",children:[e.jsx("div",{className:`px-3 py-2 hover:bg-gray-50 transition-colors cursor-pointer ${(s.inquiry_type==="modify"||s.inquiry_type==="delete")&&s.purchase_request_id?"hover:bg-blue-50":""}`,onClick:()=>{(s.inquiry_type==="modify"||s.inquiry_type==="delete")&&s.purchase_request_id?U(s.purchase_request_id.toString()):ge(z===s.id?null:s.id)},children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx(b,{variant:"outline",className:"text-xs whitespace-nowrap",children:Pe(s.inquiry_type)}),ke(s.status),e.jsx("span",{className:"text-sm font-medium truncate",children:s.subject}),h&&e.jsx("span",{className:"text-xs text-gray-500",children:s.user_name||s.user_email}),s.purchase_order_number&&e.jsxs("span",{className:"text-xs text-blue-600",children:["[",s.purchase_order_number,"]"]}),e.jsx("span",{className:"text-xs text-gray-400 ml-auto whitespace-nowrap",children:s.created_at&&E(new Date(s.created_at),"MM/dd HH:mm")})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[h&&s.status==="open"&&e.jsx(g,{size:"sm",variant:"outline",onClick:r=>{r.stopPropagation(),Z(s.id,"in_progress")},className:"h-6 text-xs px-2",children:"처리중"}),h&&(s.status==="open"||s.status==="in_progress")&&e.jsx(g,{size:"sm",onClick:r=>{r.stopPropagation(),Z(s.id,"resolved")},className:"h-6 text-xs px-2 bg-green-600 hover:bg-green-700",children:"완료"}),(h||s.status==="open"&&!s.resolution_note&&s.user_email===he)&&e.jsx(g,{size:"sm",variant:"ghost",onClick:r=>{r.stopPropagation(),we(s.id)},className:"h-6 w-6 p-0 hover:bg-red-50",title:"문의 삭제",children:e.jsx(F,{className:"w-3 h-3 text-red-600"})}),e.jsx("button",{type:"button",className:"p-1 hover:bg-gray-200 rounded",children:z===s.id?e.jsx(le,{className:"w-4 h-4"}):e.jsx(ie,{className:"w-4 h-4"})})]})]})}),z===s.id&&e.jsx("div",{className:"px-3 py-3 bg-gray-50 border-t text-sm",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"내용:"}),e.jsx("p",{className:"text-gray-600 mt-1 whitespace-pre-wrap",children:s.message})]}),s.purchase_order_number&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"관련 발주번호:"}),e.jsx("span",{className:"text-blue-600 ml-2",children:s.purchase_order_number})]}),s.handled_by&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"처리자:"}),e.jsxs("span",{className:"text-green-600 ml-2",children:[s.handled_by,s.processed_at&&` (${E(new Date(s.processed_at),"yyyy-MM-dd HH:mm")})`]})]}),s.resolution_note&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"처리 내용:"}),e.jsx("p",{className:"text-gray-600 mt-1",children:s.resolution_note})]})]})})]},s.id))})})]})]})]}),e.jsx(Ue,{open:fe,onOpenChange:L,children:e.jsxs(Fe,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsx($e,{children:e.jsxs(He,{className:"flex items-center justify-between text-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"발주요청 상세"}),u?.purchase_order_number&&e.jsx(b,{variant:"outline",className:"font-normal",children:u.purchase_order_number})]}),h&&u&&e.jsxs(g,{variant:"destructive",size:"sm",onClick:Ce,className:"h-8 px-3",children:[e.jsx(F,{className:"w-4 h-4 mr-1"}),"전체 삭제"]})]})}),je?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"w-6 h-6 border-2 border-gray-300 border-t-transparent rounded-full animate-spin"})}):u&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wider",children:"발주번호"}),e.jsx("p",{className:"font-semibold text-sm mt-1",children:u.purchase_order_number||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wider",children:"업체명"}),e.jsx("p",{className:"font-semibold text-sm mt-1",children:u.vendor_name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wider",children:"요청자"}),e.jsx("p",{className:"font-semibold text-sm mt-1",children:u.requester_name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wider",children:"요청일"}),e.jsx("p",{className:"font-semibold text-sm mt-1",children:u.request_date&&E(new Date(u.request_date),"yyyy-MM-dd")})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-base mb-3",children:"품목 상세"}),e.jsx("div",{className:"border rounded-lg overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left text-xs font-medium text-gray-700 px-3 py-3 w-12",children:"번호"}),e.jsx("th",{className:"text-left text-xs font-medium text-gray-700 px-3 py-3 min-w-[180px]",children:"품명"}),e.jsx("th",{className:"text-left text-xs font-medium text-gray-700 px-3 py-3 min-w-[150px]",children:"규격"}),e.jsx("th",{className:"text-center text-xs font-medium text-gray-700 px-3 py-3 w-20",children:"수량"}),e.jsx("th",{className:"text-right text-xs font-medium text-gray-700 px-3 py-3 w-28",children:"단가"}),e.jsx("th",{className:"text-right text-xs font-medium text-gray-700 px-3 py-3 w-32",children:"금액"}),e.jsx("th",{className:"text-left text-xs font-medium text-gray-700 px-3 py-3 min-w-[150px]",children:"비고"}),e.jsx("th",{className:"text-center text-xs font-medium text-gray-700 px-3 py-3 w-16",children:"링크"}),h&&e.jsx("th",{className:"text-center text-xs font-medium text-gray-700 px-3 py-3 w-24",children:"작업"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:u.purchase_request_items?.map((s,r)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"text-sm px-3 py-3 text-center font-medium text-gray-600",children:s.line_number||r+1}),e.jsx("td",{className:"text-sm px-3 py-3",children:N===s.id?e.jsx(v,{value:o?.item_name||"",onChange:i=>y({...o,item_name:i.target.value}),className:"h-9 text-sm w-full",autoFocus:!0}):e.jsx("span",{className:"font-medium text-gray-900",children:s.item_name})}),e.jsx("td",{className:"text-sm px-3 py-3",children:N===s.id?e.jsx(v,{value:o?.specification||"",onChange:i=>y({...o,specification:i.target.value}),className:"h-9 text-sm w-full"}):e.jsx("span",{className:"text-gray-600",children:s.specification||"-"})}),e.jsx("td",{className:"text-sm text-center px-3 py-3",children:N===s.id?e.jsx(v,{type:"number",value:o?.quantity||"",onChange:i=>y({...o,quantity:parseInt(i.target.value)}),className:"h-9 text-sm text-center w-full"}):e.jsx("span",{className:"font-medium",children:s.quantity})}),e.jsx("td",{className:"text-sm text-right px-3 py-3",children:N===s.id?e.jsx(v,{type:"number",value:o?.unit_price_value||"",onChange:i=>y({...o,unit_price_value:parseInt(i.target.value)}),className:"h-9 text-sm text-right w-full"}):e.jsx("span",{className:"font-medium",children:s.unit_price_value?`${parseFloat(s.unit_price_value).toLocaleString()}`:"-"})}),e.jsx("td",{className:"text-sm text-right px-3 py-3",children:N===s.id?e.jsx("span",{className:"font-semibold text-blue-600",children:((o?.quantity||0)*(o?.unit_price_value||0)).toLocaleString()}):e.jsx("span",{className:"font-semibold text-blue-600",children:s.amount_value?`${parseFloat(s.amount_value).toLocaleString()}`:"-"})}),e.jsx("td",{className:"text-sm px-3 py-3",children:N===s.id?e.jsx(ce,{value:o?.remark||"",onChange:i=>y({...o,remark:i.target.value}),className:"h-9 text-sm w-full resize-none",rows:1}):e.jsx("span",{className:"text-gray-600 text-xs",children:s.remark||"-"})}),e.jsx("td",{className:"text-sm text-center px-3 py-3",children:s.link?e.jsx("a",{href:s.link,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center justify-center w-8 h-8 rounded hover:bg-blue-50 text-blue-600",children:e.jsx(We,{className:"w-4 h-4"})}):e.jsx("span",{className:"text-gray-400",children:"-"})}),h&&e.jsx("td",{className:"text-sm text-center px-3 py-3",children:N===s.id?e.jsxs("div",{className:"flex justify-center gap-1",children:[e.jsxs(g,{size:"sm",onClick:()=>Se(s.id),className:"h-8 px-2 bg-green-600 hover:bg-green-700",children:[e.jsx(Ge,{className:"w-4 h-4 mr-1"}),"저장"]}),e.jsx(g,{size:"sm",variant:"outline",onClick:ee,className:"h-8 px-2",children:"취소"})]}):e.jsxs("div",{className:"flex justify-center gap-1",children:[e.jsx(g,{size:"sm",variant:"ghost",onClick:()=>qe(s),className:"h-8 w-8 p-0 hover:bg-blue-50",children:e.jsx(Je,{className:"w-4 h-4 text-blue-600"})}),e.jsx(g,{size:"sm",variant:"ghost",onClick:()=>Ie(s.id),className:"h-8 w-8 p-0 hover:bg-red-50",children:e.jsx(F,{className:"w-4 h-4 text-red-600"})})]})})]},s.id))}),e.jsx("tfoot",{className:"bg-gray-50 border-t-2",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:5,className:"text-sm font-semibold text-right px-3 py-3",children:"합계"}),e.jsx("td",{className:"text-sm font-bold text-right px-3 py-3 text-blue-600",children:u.purchase_request_items?.reduce((s,r)=>s+(parseFloat(r.amount_value)||0),0).toLocaleString()}),e.jsx("td",{colSpan:h?3:2,className:"px-3 py-3"})]})})]})})]}),u.notes&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"비고"}),e.jsx("p",{className:"text-sm text-gray-600 p-3 bg-gray-50 rounded-lg",children:u.notes})]})]})]})})]})}export{hs as default};
//# sourceMappingURL=SupportMain-D8BqYe_8.js.map
