import{e,a as t,c as a,r,j as s,B as n,P as i,X as o,i as l,f as c,m as d}from"./index-DsAL4iro.js";import{I as m,P as p,D as u,a as x,b as h,c as g,d as _,e as f}from"./dialog-B22Nto94.js";import{L as y}from"./label-CAHWWo0C.js";import{S as b,a as v,b as j,c as w,d as N}from"./select-8avWESM0.js";import{u as S,a as k}from"./index.esm-6XL2iNhF.js";import{t as q}from"./index-Dz8943Z0.js";import{S as C,D as I,f as z}from"./react-select.esm-xf0YyH9B.js";import{C as R}from"./calendar-TX1shQE9.js";import{C as $}from"./check-B6iIntpq.js";import{S as E}from"./popover-CdBmGBMH.js";import"./index-dVjxNOkf.js";import"./chevron-left-DiNSaEMF.js";import"./chevron-right-3Zn4N5p9.js";
/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=e("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);function D(){const e=t(),D=a(),[M,O]=r.useState(null),[T,V]=r.useState(""),[P,K]=r.useState([]),[W,F]=r.useState(!1),[B,U]=r.useState(1),[A,L]=r.useState(""),[J,Y]=r.useState([]),[G,Q]=r.useState(null),[X,Z]=r.useState(100);r.useEffect(()=>{(async()=>{const{data:{user:e}}=await D.auth.getUser();O(e)})()},[]),r.useEffect(()=>{(async()=>{const{data:e,error:t}=await D.from("cad_drawings").select("id, board_name").order("board_name");e&&!t&&Y(e)})()},[D]),r.useEffect(()=>{(async()=>{try{const{data:e,error:t}=await D.from("employees").select("id, name, email, phone, adress, position, department").order("name");if(e&&!t&&e.length>0){if(K(e.map(e=>({id:e.id,name:e.name,email:e.email||"",phone:e.phone||"",address:e.address||"",position:e.position||"",department:e.department||""}))),T&&!e.find(e=>e.name===T)){const t={id:M?.id||"current-user",name:T,email:M?.email||"",phone:"",address:"",position:"",department:""};K([...e.map(e=>({id:e.id,name:e.name,email:e.email||"",phone:e.phone||"",address:e.address||"",position:e.position||"",department:e.department||""})),t])}}else K(T?[{id:M?.id||"current-user",name:T,email:M?.email||"",phone:"",address:"",position:"",department:""}]:[])}catch(e){K(T?[{id:M?.id||"current-user",name:T,email:M?.email||"",phone:"",address:"",position:"",department:""}]:[])}})()},[T,M]);const[ee,te]=r.useState([]),[ae,re]=r.useState([]),[se,ne]=r.useState(""),[ie,oe]=r.useState([]),[le,ce]=r.useState("KRW"),[de,me]=r.useState(!1),[pe,ue]=r.useState(""),[xe,he]=r.useState({}),[ge,_e]=r.useState(!1),[fe,ye]=r.useState([]),[be,ve]=r.useState(!1),je=r.useRef(!1),[we,Ne]=r.useState(!1),{control:Se,handleSubmit:ke,watch:qe,setValue:Ce,reset:Ie,getValues:ze}=S({defaultValues:{progress_type:"",payment_category:"",currency:"KRW",po_template_type:"",request_type:"",contacts:[],sales_order_number:"",project_vendor:"",project_item:"",delivery_request_date:"",vendor_id:0,requester_name:"",items:[{line_number:1,item_name:"",specification:"",quantity:1,unit_price_value:0,unit_price_currency:"KRW",amount_value:0,amount_currency:"KRW",remark:"",link:""}],request_date:(new Date).toISOString().slice(0,10)}}),{fields:Re,append:$e,remove:Ee,update:He,replace:De}=k({control:Se,name:"items"});r.useEffect(()=>{if(!M?.email||W)return;(async()=>{const{data:e}=await D.from("employees").select("name").eq("email",M.email).single();e?.name&&(V(e.name),Ce("requester_name",e.name),F(!0))})()},[M,D,Ce,W]),r.useEffect(()=>{(async()=>{if(M?.email&&Ce&&!W)try{const{data:e,error:t}=await D.from("employees").select("name").eq("email",M.email).single();if(e&&!t)V(e.name),setTimeout(()=>{Ce("requester_name",e.name,{shouldValidate:!0,shouldDirty:!0})},100),F(!0);else{const e=M.email.split("@")[0]||"ì‚¬ìš©ì";V(e),setTimeout(()=>{Ce("requester_name",e,{shouldValidate:!0,shouldDirty:!0})},100),F(!0)}}catch(e){const t=M.email?.split("@")[0]||"ì‚¬ìš©ì";V(t),setTimeout(()=>{Ce("requester_name",t,{shouldValidate:!0,shouldDirty:!0})},100),F(!0)}})()},[M,Ce,W]),r.useEffect(()=>{(async()=>{try{const{data:e,error:t}=await D.from("vendors").select("*").order("vendor_name");if(t)throw t;te(e||[])}catch(e){q.error("ì—…ì²´ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")}})()},[]);const Me=qe("vendor_id");r.useEffect(()=>{(async()=>{if(Me)try{const{data:e,error:t}=await D.from("vendor_contacts").select("id, contact_name, contact_email, contact_phone, position").eq("vendor_id",Me);if(t)throw t;re(e||[])}catch(e){re([])}else re([])})()},[Me]),r.useEffect(()=>{const e=ze("items").map(e=>({...e,unit_price_currency:le,amount_currency:le}));Ce("items",e),ce(le)},[le,Ce,ze]),r.useEffect(()=>{Re.forEach((e,t)=>{const a=Number(e.quantity)*Number(e.unit_price_value);e.amount_value!==a&&He(t,{...e,amount_value:a})})},[Re.map(e=>`${e.quantity}-${e.unit_price_value}`).join(",")]);const Oe=async e=>{if(Q(e),e&&confirm(`"${e.label}"ì˜ BOM ë°ì´í„°ë¡œ í’ˆëª© ëª©ë¡ì„ ë®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ?\n(ê¸°ì¡´ ì…ë ¥ëœ í’ˆëª©ì€ ì‚­ì œë©ë‹ˆë‹¤)`))try{const{data:t,error:a}=await D.from("bom_items").select("*").eq("cad_drawing_id",e.value).order("line_number");if(a)throw a;if(t&&t.length>0){const e=t.map(e=>({line_number:e.line_number,item_name:e.item_name,specification:e.specification||"",quantity:(e.set_count||0)*X,unit_price_value:0,unit_price_currency:le,amount_value:0,amount_currency:le,remark:e.remark||"",link:""}));De(e),q.success(`${t.length}ê°œ í’ˆëª©ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`)}else q.warning("í•´ë‹¹ ë³´ë“œì˜ BOM ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.")}catch(t){q.error("BOM ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},Te=()=>{const e=qe("po_template_type");if(!e)return!1;if("ë°œì£¼/êµ¬ë§¤"===e){const e=qe("request_type"),t=qe("progress_type"),a=qe("payment_category"),r=qe("vendor_id");return!!(e&&t&&a&&r&&0!==r&&Re.length>0)}return!0},[Ve,Pe]=r.useState(!1);r.useEffect(()=>{Pe(Te())},[qe("po_template_type"),qe("request_type"),qe("progress_type"),qe("payment_category"),qe("vendor_id"),Re]);const Ke=async()=>{const e=`F${new Date((new Date).getTime()+324e5).toISOString().slice(0,10).replace(/-/g,"")}_`,{data:t,error:a}=await D.from("purchase_requests").select("purchase_order_number").like("purchase_order_number",`${e}%`).order("purchase_order_number",{ascending:!1});if(a)throw a;let r=1,s=0;if(t&&t.length>0){for(const e of t){const t=e.purchase_order_number.split("_");if(t.length>=2){const e=t[1],a=parseInt(e,10);!isNaN(a)&&a>s&&(s=a)}}r=s+1}const n=isNaN(r)?1:r;return`${e}${String(n).padStart(3,"0")}`},We=async t=>{const a=P.find(e=>e.name===t.requester_name);if(!je.current)if(a){if(Te()){je.current=!0,me(!0),ue("");try{let o=0,m="";const p=5;let u=0;for(;u<p;)try{m=await Ke();const{data:e,error:r}=await D.from("purchase_requests").insert({requester_id:a.id,purchase_order_number:m,requester_name:t.requester_name,requester_phone:a?.phone,requester_fax:null,requester_address:a?.address,vendor_id:t.vendor_id,sales_order_number:t.sales_order_number,project_vendor:t.project_vendor,project_item:t.project_item,request_date:t.request_date,delivery_request_date:t.delivery_request_date||null,request_type:t.request_type,progress_type:t.progress_type,is_payment_completed:!1,payment_category:t.payment_category,currency:le,total_amount:Re.reduce((e,t)=>e+t.amount_value,0),unit_price_currency:Re[0]?.unit_price_currency||le,po_template_type:t.po_template_type,contact_id:t.contact_id?Number(t.contact_id):null}).select("id").single();if(r&&!r.message.includes("duplicate key value violates unique constraint"))throw r;if(r&&r.message.includes("duplicate key value violates unique constraint")){if(u++,u>=p)throw new Error(`ë°œì£¼ìš”ì²­ë²ˆí˜¸ ìƒì„±ì— ${p}ë²ˆ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.`);await new Promise(e=>setTimeout(e,100+200*Math.random()));continue}if(!e)throw new Error("ë“±ë¡ ì‹¤íŒ¨");o=e.id;break}catch(r){if(!r.message.includes("duplicate key value violates unique constraint"))throw r;if(u++,u>=p)throw new Error(`ë°œì£¼ìš”ì²­ë²ˆí˜¸ ìƒì„±ì— ${p}ë²ˆ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.`);await new Promise(e=>setTimeout(e,100+200*Math.random()))}for(const[e,t]of Re.entries()){const{error:a}=await D.from("purchase_request_items").insert({purchase_request_id:o,line_number:e+1,item_name:t.item_name,specification:t.specification,quantity:t.quantity,unit_price_value:t.unit_price_value,unit_price_currency:le,amount_value:t.amount_value,amount_currency:le,remark:t.remark,link:t.link||null});if(a)throw a}try{const e=await fetch(`/api/purchase/${o}/notify-middle-manager`,{method:"POST",headers:{"Content-Type":"application/json"}});if(e.ok){await e.json()}else{await e.text()}}catch(s){}Ie({progress_type:"",payment_category:"",currency:"KRW",po_template_type:"",request_type:"",contacts:[],sales_order_number:"",project_vendor:"",project_item:"",delivery_request_date:"",vendor_id:0,requester_name:T,items:[{line_number:1,item_name:"",specification:"",quantity:1,unit_price_value:0,unit_price_currency:"KRW",amount_value:0,amount_currency:"KRW",remark:"",link:""}],request_date:(new Date).toISOString().slice(0,10)}),ne(""),oe([]),ce("KRW"),ue(""),me(!1),q.success("ë°œì£¼ìš”ì²­ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤."),l();try{await c(String(a.id))}catch(n){}finally{d()}je.current=!1;try{await e("/purchase/list?tab=pending")}catch(i){window.location.href="/purchase/list?tab=pending"}return}catch(o){ue(o.message||"ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."),q.error(o.message||"ë°œì£¼ìš”ì²­ì„œ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{me(!1),je.current=!1}}}else ue("êµ¬ë§¤ìš”ì²­ì ì´ë¦„ì— í•´ë‹¹í•˜ëŠ” ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤. ì´ë¦„ì„ ì •í™•íˆ ì…ë ¥í•´ ì£¼ì„¸ìš”.")},Fe=Re.reduce((e,t)=>e+t.amount_value,0),Be=(e,t,a)=>{ye(r=>r.map((r,s)=>s===e?{...r,[t]:a}:r)),ve(!0)},Ue=qe("payment_category");return s.jsxs("form",{onSubmit:e=>{e.preventDefault(),ke(We)(e)},onKeyDown:e=>{"Enter"!==e.key&&13!==e.keyCode||e.preventDefault()},children:[s.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 lg:gap-6 items-start",children:[s.jsxs("div",{className:"w-full lg:w-[280px] lg:min-w-[280px] lg:flex-shrink-0 relative bg-muted/20 border border-border rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300 p-3 lg:p-4 space-y-2.5",children:[s.jsxs("div",{className:"flex flex-col",children:[s.jsx("h4",{className:"font-semibold text-foreground text-sm",children:{"ë°œì£¼/êµ¬ë§¤":"ë°œì£¼/êµ¬ë§¤ ìš”ì²­ ì •ë³´","ì¹´ë“œì‚¬ìš©":"ì¹´ë“œì‚¬ìš© ìš”ì²­ ì •ë³´","ì¶œì¥":"ì¶œì¥ ìš”ì²­ ì •ë³´","ì°¨ëŸ‰":"ì°¨ëŸ‰ ìš”ì²­ ì •ë³´"}[qe("po_template_type")]||"ìš”ì²­ ì •ë³´"}),s.jsx("p",{className:"text-[10px] text-muted-foreground",children:{"ë°œì£¼/êµ¬ë§¤":"Purchase Request","ì¹´ë“œì‚¬ìš©":"Card Usage Request","ì¶œì¥":"Business Trip Request","ì°¨ëŸ‰":"Vehicle Request"}[qe("po_template_type")]||"Request Information"})]}),s.jsxs("div",{children:[s.jsxs(y,{className:"mb-0.5 block text-[10px] sm:text-xs",children:["í…œí”Œë¦¿",s.jsx("span",{className:"text-red-500 ml-0.5",children:"*"})]}),s.jsxs(b,{value:qe("po_template_type")||void 0,onValueChange:e=>Ce("po_template_type",e),children:[s.jsx(v,{className:"!h-7 !py-0 !leading-none bg-white border border-[#d2d2d7] rounded-md text-xs shadow-sm hover:shadow-md transition-shadow duration-200 [&>svg]:hidden "+(qe("po_template_type")?"":"text-gray-400"),children:s.jsx(j,{placeholder:"ì„ íƒ"})}),s.jsxs(w,{position:"popper",className:"z-[9999]",children:[s.jsx(N,{value:"ë°œì£¼/êµ¬ë§¤",children:"ë°œì£¼/êµ¬ë§¤"}),s.jsx(N,{value:"ì¹´ë“œì‚¬ìš©",children:"ì¹´ë“œì‚¬ìš©"}),s.jsx(N,{value:"ì¶œì¥",children:"ì¶œì¥"}),s.jsx(N,{value:"ì°¨ëŸ‰",children:"ì°¨ëŸ‰"})]})]})]}),"ë°œì£¼/êµ¬ë§¤"===qe("po_template_type")&&s.jsx("div",{className:"grid grid-cols-2 gap-1.5 sm:gap-2",children:s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-1 mb-0.5",children:[s.jsx(y,{className:"text-[10px] sm:text-xs",children:"ë³´ë“œëª…"}),G&&s.jsx("span",{className:"text-[9px] text-blue-600 cursor-pointer hover:underline",onClick:()=>Q(null),children:"ì´ˆê¸°í™”"})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(C,{options:J.map(e=>({value:e.id,label:e.board_name})),value:G,onChange:Oe,placeholder:"ì„ íƒ",isClearable:!0,isSearchable:!0,className:"text-xs flex-1",menuPortalTarget:document.body,styles:{control:e=>({...e,minHeight:"28px",height:"28px",fontSize:"0.75rem",backgroundColor:"#fff",borderColor:"#d2d2d7",borderRadius:"6px",boxShadow:"0 1px 2px 0 rgb(0 0 0 / 0.05)","&:hover":{borderColor:"#d2d2d7",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1)"}}),valueContainer:e=>({...e,padding:"0 6px"}),menuPortal:e=>({...e,zIndex:9999}),menu:e=>({...e,zIndex:9999,fontSize:"0.75rem",minWidth:"160px",width:"auto",whiteSpace:"nowrap"}),option:e=>({...e,padding:"4px 8px",whiteSpace:"nowrap"}),placeholder:e=>({...e,color:"#9ca3af"}),dropdownIndicator:()=>({display:"none"}),clearIndicator:e=>({...e,padding:"2px"}),indicatorSeparator:()=>({display:"none"})}}),G&&s.jsxs(s.Fragment,{children:[s.jsx(m,{type:"number",min:"1",value:X,onChange:e=>{const t=parseInt(e.target.value)||0;Z(t)},className:"h-7 w-12 text-center text-xs bg-white border border-[#d2d2d7] rounded-md shadow-sm hover:shadow-md transition-shadow duration-200",placeholder:"ìˆ˜ëŸ‰"}),s.jsx(n,{type:"button",size:"sm",variant:"outline",onClick:()=>{G?Oe(G):q.error("ë¨¼ì € ë³´ë“œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.")},className:"h-7 px-2 text-[10px] border-[#d2d2d7] hover:bg-gray-50",children:"ì ìš©"})]})]})]})}),"ë°œì£¼/êµ¬ë§¤"===qe("po_template_type")&&s.jsxs("div",{className:"space-y-2.5",children:[s.jsxs("div",{className:"grid grid-cols-3 gap-1.5 sm:gap-2",children:[s.jsxs("div",{children:[s.jsxs(y,{className:"mb-0.5 block text-[10px] sm:text-xs",children:["ìš”ì²­ ìœ í˜•",s.jsx("span",{className:"text-red-500 ml-0.5",children:"*"})]}),s.jsxs(b,{value:qe("request_type"),onValueChange:e=>Ce("request_type",e),children:[s.jsx(v,{className:"!h-7 !py-0 !leading-none bg-white border border-[#d2d2d7] rounded-md text-xs shadow-sm hover:shadow-md transition-shadow duration-200 [&>svg]:hidden",children:s.jsx(j,{placeholder:"ì„ íƒ"})}),s.jsxs(w,{position:"popper",className:"z-[9999]",children:[s.jsx(N,{value:"ì›ìì¬",children:"ì›ìì¬"}),s.jsx(N,{value:"ì†Œëª¨í’ˆ",children:"ì†Œëª¨í’ˆ"})]})]})]}),s.jsxs("div",{children:[s.jsxs(y,{className:"mb-0.5 block text-[10px] sm:text-xs",children:["ì§„í–‰ ì¢…ë¥˜",s.jsx("span",{className:"text-red-500 ml-0.5",children:"*"})]}),s.jsxs(b,{value:qe("progress_type"),onValueChange:e=>Ce("progress_type",e),children:[s.jsx(v,{className:"!h-7 !py-0 !leading-none bg-white border border-[#d2d2d7] rounded-md text-xs shadow-sm hover:shadow-md transition-shadow duration-200 [&>svg]:hidden",children:s.jsx(j,{placeholder:"ì„ íƒ"})}),s.jsxs(w,{position:"popper",className:"z-[9999]",children:[s.jsx(N,{value:"ì¼ë°˜",children:"ì¼ë°˜"}),s.jsx(N,{value:"ì„ ì§„í–‰",children:"ì„ ì§„í–‰"})]})]})]}),s.jsxs("div",{children:[s.jsxs(y,{className:"mb-0.5 block text-[10px] sm:text-xs",children:["ê²°ì œ ì¢…ë¥˜",s.jsx("span",{className:"text-red-500 ml-0.5",children:"*"})]}),s.jsxs(b,{value:qe("payment_category"),onValueChange:e=>Ce("payment_category",e),children:[s.jsx(v,{className:"!h-7 !py-0 !leading-none bg-white border border-[#d2d2d7] rounded-md text-xs shadow-sm hover:shadow-md transition-shadow duration-200 [&>svg]:hidden",children:s.jsx(j,{placeholder:"ì„ íƒ"})}),s.jsxs(w,{position:"popper",className:"z-[9999]",children:[s.jsx(N,{value:"êµ¬ë§¤ ìš”ì²­",children:"êµ¬ë§¤ ìš”ì²­"}),s.jsx(N,{value:"ë°œì£¼",children:"ë°œì£¼"}),s.jsx(N,{value:"í˜„ì¥ ê²°ì œ",children:"í˜„ì¥ ê²°ì œ"})]})]})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-1.5 sm:gap-2 lg:grid-cols-2",children:[s.jsxs("div",{children:[s.jsxs(y,{className:"mb-0.5 block text-[10px] sm:text-xs",children:["ì—…ì²´ëª…",s.jsx("span",{className:"text-red-500 ml-0.5",children:"*"})]}),s.jsx(C,{options:ee.map(e=>({value:e.id.toString(),label:e.vendor_name})),value:ee.find(e=>e.id.toString()===se)?{value:se,label:ee.find(e=>e.id.toString()===se)?.vendor_name}:null,onChange:e=>{const t=e;t?(ne(t.value),Ce("vendor_id",Number(t.value))):(ne(""),Ce("vendor_id",0))},placeholder:"ì—…ì²´ ì„ íƒ",isClearable:!1,isSearchable:!0,closeMenuOnSelect:!1,classNamePrefix:"vendor-select",blurInputOnSelect:!1,openMenuOnFocus:!1,openMenuOnClick:!0,tabSelectsValue:!1,captureMenuScroll:!1,pageSize:20,styles:{container:e=>({...e,width:"100%"}),control:e=>({...e,height:"28px !important",minHeight:"28px !important",maxHeight:"28px !important",background:"#fff",border:"1px solid #d2d2d7",borderRadius:"6px",fontSize:"0.75rem",boxShadow:"0 1px 2px 0 rgb(0 0 0 / 0.05)",padding:"0 !important",margin:"0 !important",alignItems:"center",display:"flex",position:"relative",verticalAlign:"top",lineHeight:"1","&:hover":{boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1)"}}),valueContainer:e=>({...e,height:"28px !important",minHeight:"28px !important",maxHeight:"28px !important",padding:"0 8px !important",margin:"0 !important",fontSize:"0.75rem",alignItems:"center",display:"flex",lineHeight:"1",justifyContent:"flex-start"}),input:e=>({...e,margin:"0 !important",padding:"0 !important",fontSize:"0.75rem",lineHeight:"28px"}),singleValue:e=>({...e,margin:"0 !important",padding:"0 !important",fontSize:"0.75rem",lineHeight:"28px"}),placeholder:e=>({...e,margin:"0 !important",padding:"0 !important",fontSize:"0.75rem",lineHeight:"28px",color:"#9ca3af"}),indicatorsContainer:e=>({...e,height:"28px !important",padding:"0 4px !important",alignItems:"center",display:"flex"}),indicatorSeparator:()=>({display:"none"}),dropdownIndicator:()=>({display:"none"}),clearIndicator:e=>({...e,padding:"2px !important"}),menuPortal:e=>({...e,zIndex:1400}),option:e=>({...e,padding:"4px 8px"})}})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[s.jsx(y,{className:"text-[10px] sm:text-xs",children:"ì—…ì²´ ë‹´ë‹¹ì"}),s.jsxs("span",{className:"text-primary text-[9px] sm:text-[10px] cursor-pointer hover:underline select-none flex items-center",onClick:()=>{const e=ae.map(e=>({...e,isNew:!1}));ye([...e,{contact_name:"",contact_email:"",contact_phone:"",position:"",isNew:!0}]),ve(!1),_e(!0)},children:[s.jsx("span",{className:"-translate-y-px",children:"+"}),s.jsx("span",{className:"ml-0.5",children:"ì¶”ê°€/ìˆ˜ì •"})]})]}),s.jsxs(b,{value:qe("contacts")[0]||"",onValueChange:e=>{Ce("contacts",[e]),Ce("contact_id",e?Number(e):void 0)},children:[s.jsx(v,{className:"!h-7 !py-0 !leading-none bg-white border border-[#d2d2d7] rounded-md text-xs shadow-sm hover:shadow-md transition-shadow duration-200 [&>svg]:hidden",children:s.jsx(j,{placeholder:"ë‹´ë‹¹ì ì„ íƒ"})}),s.jsx(w,{position:"popper",className:"z-[9999]",children:ae.map(e=>s.jsx(N,{value:e.id.toString(),children:e.contact_name||e.contact_email||e.contact_phone||e.position||""},e.id))})]})]})]}),s.jsxs("div",{className:"grid grid-cols-3 gap-1.5 sm:gap-2",children:[s.jsxs("div",{children:[s.jsx(y,{className:"mb-0.5 block text-[10px] sm:text-xs",children:"êµ¬ë§¤ìš”êµ¬ì"}),s.jsx(C,{value:T?{value:T,label:T}:null,defaultValue:T?{value:T,label:T}:null,onChange:e=>{const t=e?.value||"";Ce("requester_name",t),V(t)},options:P.map(e=>({value:e.name,label:e.name})),placeholder:"ì„ íƒ",isSearchable:!0,isClearable:!1,noOptionsMessage:()=>"ì¼ì¹˜í•˜ëŠ” ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤",filterOption:(e,t)=>{const a=P.find(t=>t.name===e.value);return`${a?.name||""} ${a?.position||""} ${a?.email||""}`.toLowerCase().includes(t.toLowerCase())},styles:{control:e=>({...e,height:"28px !important",minHeight:"28px !important",maxHeight:"28px !important",background:"#fff",border:"1px solid #d2d2d7",borderRadius:"6px",fontSize:"0.75rem",boxShadow:"0 1px 2px 0 rgb(0 0 0 / 0.05)",padding:"0 !important",margin:"0 !important",alignItems:"center",display:"flex",position:"relative",verticalAlign:"top",lineHeight:"1","&:hover":{borderColor:"#d2d2d7",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1)"}}),valueContainer:e=>({...e,height:"28px !important",minHeight:"28px !important",maxHeight:"28px !important",padding:"0 8px !important",margin:"0 !important",fontSize:"0.75rem",alignItems:"center",display:"flex",lineHeight:"28px",justifyContent:"flex-start",overflow:"visible"}),input:e=>({...e,margin:"0 !important",padding:"0 !important",fontSize:"0.75rem",lineHeight:"28px"}),singleValue:e=>({...e,margin:"0 !important",padding:"0 !important",fontSize:"0.75rem",lineHeight:"28px",overflow:"visible",textOverflow:"clip",whiteSpace:"nowrap"}),placeholder:e=>({...e,margin:"0 !important",padding:"0 !important",fontSize:"0.75rem",lineHeight:"28px",color:"#9ca3af"}),indicatorsContainer:e=>({...e,height:"28px !important",padding:"0 4px !important",alignItems:"center",display:"flex"}),indicatorSeparator:()=>({display:"none"}),dropdownIndicator:()=>({display:"none"}),clearIndicator:e=>({...e,padding:"2px !important"}),menu:e=>({...e,fontSize:"0.75rem",zIndex:9999}),option:e=>({...e,fontSize:"0.75rem",padding:"4px 8px"})}},`employee-select-${T}`)]}),s.jsxs("div",{children:[s.jsx(y,{className:"mb-0.5 block text-[10px] sm:text-xs",children:"ì²­êµ¬ì¼"}),s.jsx(I,{onDateSelect:e=>{Ce("request_date",z(e,"yyyy-MM-dd"))},placeholder:"ì²­êµ¬ì¼ ì„ íƒ",align:"start",children:s.jsxs("div",{className:"h-7 w-full bg-white border border-[#d2d2d7] rounded-md text-xs shadow-sm hover:shadow-md hover:bg-gray-50 transition-all duration-200 flex items-center justify-center gap-1 cursor-pointer",children:[s.jsx("span",{children:qe("request_date")?qe("request_date").slice(2).replace(/-/g,"."):s.jsx("span",{className:"text-gray-400",children:"ì—°ë„.ì›”.ì¼"})}),s.jsx(R,{className:"w-3 h-3 text-gray-400"})]})})]}),s.jsxs("div",{children:[s.jsx(y,{className:"mb-0.5 block text-[10px] sm:text-xs",children:"ì…ê³  ìš”ì²­ì¼"}),s.jsx(I,{onDateSelect:e=>{Ce("delivery_request_date",z(e,"yyyy-MM-dd"))},placeholder:"ì…ê³  ìš”ì²­ì¼ ì„ íƒ",align:"start",children:s.jsxs("div",{className:"h-7 w-full bg-white border border-[#d2d2d7] rounded-md text-xs shadow-sm hover:shadow-md hover:bg-gray-50 transition-all duration-200 flex items-center justify-center gap-1 cursor-pointer",children:[s.jsx("span",{children:qe("delivery_request_date")?qe("delivery_request_date").slice(2).replace(/-/g,"."):s.jsx("span",{className:"text-gray-400",children:"ì—°ë„.ì›”.ì¼"})}),s.jsx(R,{className:"w-3 h-3 text-gray-400"})]})})]})]}),s.jsxs("div",{className:"grid grid-cols-3 gap-1.5 sm:gap-2",children:[s.jsxs("div",{children:[s.jsx(y,{className:"mb-0.5 block text-[10px] sm:text-xs",children:"PJì—…ì²´"}),s.jsx(m,{type:"text",value:qe("project_vendor"),onChange:e=>Ce("project_vendor",e.target.value),placeholder:"ì…ë ¥",className:"h-7 bg-white border border-[#d2d2d7] rounded-md text-xs shadow-sm hover:shadow-md focus:shadow-md transition-shadow duration-200"})]}),s.jsxs("div",{children:[s.jsx(y,{className:"mb-0.5 block text-[10px] sm:text-xs",children:"ìˆ˜ì£¼ë²ˆí˜¸"}),s.jsx(m,{type:"text",value:qe("sales_order_number"),onChange:e=>Ce("sales_order_number",e.target.value),placeholder:"ì…ë ¥",className:"h-7 bg-white border border-[#d2d2d7] rounded-md text-xs shadow-sm hover:shadow-md focus:shadow-md transition-shadow duration-200"})]}),s.jsxs("div",{children:[s.jsx(y,{className:"mb-0.5 block text-[10px] sm:text-xs",children:"Item"}),s.jsx(m,{type:"text",value:qe("project_item"),onChange:e=>Ce("project_item",e.target.value),placeholder:"ì…ë ¥",className:"h-7 bg-white border border-[#d2d2d7] rounded-md text-xs shadow-sm hover:shadow-md focus:shadow-md transition-shadow duration-200"})]})]})]})]}),qe("po_template_type")&&s.jsxs("div",{className:"w-full lg:w-3/4 space-y-4",children:[s.jsxs("div",{className:"relative border border-gray-200 rounded-lg overflow-hidden",children:[s.jsxs("div",{className:"bg-gray-50 border-b border-gray-100 px-2 sm:px-3 py-2 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-3",children:[s.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(i,{className:"w-4 h-4 text-gray-600"}),s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{className:"font-semibold text-foreground leading-tight",children:"í’ˆëª© ëª©ë¡"}),s.jsx("span",{className:"text-xs text-muted-foreground leading-tight",children:"Purchase Items"})]}),s.jsxs("span",{className:"badge-secondary whitespace-nowrap",children:[Re.length,"ê°œ"]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(b,{value:le,onValueChange:ce,children:[s.jsx(v,{className:"w-20 text-xs border-border business-radius-badge shadow-sm hover:shadow-md transition-shadow duration-200 bg-white [&>svg]:hidden",style:{height:"auto",padding:"2.5px 10px",minHeight:"auto"},children:s.jsx(j,{})}),s.jsxs(w,{className:"rounded-md",children:[s.jsx(N,{value:"KRW",children:"KRW"}),s.jsx(N,{value:"USD",children:"USD"})]})]}),G?.label&&s.jsxs("span",{className:"text-[11px] text-gray-400",children:["ë³´ë“œëª…: ",G.label]})]})]}),s.jsxs("div",{className:"flex items-center justify-end gap-2 flex-wrap sm:flex-nowrap",children:[s.jsxs("span",{className:"badge-stats text-hansl-500 text-[10px] px-1.5 py-0.5 whitespace-nowrap flex-shrink-0 bg-hansl-50 business-radius-badge",children:["ì´ì•¡: ",Fe.toLocaleString("ko-KR")," ",le]}),s.jsx(n,{type:"button",className:"button-base border transition-all duration-200 "+(we?"border-green-400 text-green-600 bg-green-50":"border-gray-300 text-gray-600 bg-white hover:bg-blue-50 hover:text-blue-600"),disabled:we,onClick:async()=>{const e=()=>{Ne(!0),setTimeout(()=>Ne(!1),1e3)};try{const t="êµ¬ë§¤ ìš”ì²­"===Ue?["í’ˆëª©","ê·œê²©","ìˆ˜ëŸ‰","ë‹¨ê°€","í•©ê³„","ë§í¬","ë¹„ê³ "]:["í’ˆëª©","ê·œê²©","ìˆ˜ëŸ‰","ë‹¨ê°€","í•©ê³„","ë¹„ê³ "],a=Re.map(e=>{const t=[e.item_name||"",e.specification||"",e.quantity?.toString()||"0",e.unit_price_value?.toString()||"0",e.amount_value?.toString()||"0"];return"êµ¬ë§¤ ìš”ì²­"===Ue&&t.push(e.link||""),t.push(e.remark||""),t.join("\t")}),r=[t.join("\t"),...a].join("\n");await navigator.clipboard.writeText(r),e(),q.success(`ğŸ“‹ ${Re.length}ê°œ í’ˆëª© ë³µì‚¬ ì™„ë£Œ! ì—‘ì…€ì— ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”.`)}catch(t){try{const t="êµ¬ë§¤ ìš”ì²­"===Ue?["í’ˆëª©","ê·œê²©","ìˆ˜ëŸ‰","ë‹¨ê°€","í•©ê³„","ë§í¬","ë¹„ê³ "]:["í’ˆëª©","ê·œê²©","ìˆ˜ëŸ‰","ë‹¨ê°€","í•©ê³„","ë¹„ê³ "],a=Re.map(e=>{const t=[e.item_name||"",e.specification||"",e.quantity?.toString()||"0",e.unit_price_value?.toString()||"0",e.amount_value?.toString()||"0"];return"êµ¬ë§¤ ìš”ì²­"===Ue&&t.push(e.link||""),t.push(e.remark||""),t.join("\t")}),r=[t.join("\t"),...a].join("\n"),s=document.createElement("textarea");s.value=r,s.style.position="fixed",s.style.left="-9999px",document.body.appendChild(s),s.select(),document.execCommand("copy"),document.body.removeChild(s),e(),q.success(`ğŸ“‹ ${Re.length}ê°œ í’ˆëª© ë³µì‚¬ ì™„ë£Œ! ì—‘ì…€ì— ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”.`)}catch(a){q.error("í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.")}}},children:we?s.jsxs(s.Fragment,{children:[s.jsx($,{className:"w-3 h-3 mr-0.5"}),"ë³µì‚¬ë¨"]}):s.jsxs(s.Fragment,{children:[s.jsx(H,{className:"w-3 h-3 mr-0.5"}),"ì „ì²´ë³µì‚¬"]})}),s.jsx(n,{type:"button",className:"button-base border border-gray-300 text-gray-600 bg-white hover:bg-red-50 hover:text-red-600",onClick:()=>{confirm("ëª¨ë“  í’ˆëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&(Re.forEach((e,t)=>Ee(Re.length-1-t)),$e({line_number:1,item_name:"",specification:"",quantity:1,unit_price_value:0,unit_price_currency:le,amount_value:0,amount_currency:le,remark:"",link:""}))},children:"ì „ì²´ì‚­ì œ"}),s.jsx(m,{type:"number",min:1,max:1e3,value:B,onChange:e=>U(Math.max(1,Number(e.target.value.replace(/[^0-9]/g,"")))),className:"w-12 text-center flex-shrink-0 business-radius-badge border border-gray-300 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none [&]:!text-[12px] [&]:!font-medium [&]:!leading-tight",style:{height:"auto",padding:"2px 6px",minHeight:"auto",maxHeight:"none",lineHeight:"1.25"}}),s.jsxs(n,{type:"button",onClick:()=>{for(let e=0;e<B;e++)$e({line_number:Re.length+1+e,item_name:"",specification:"",quantity:1,unit_price_value:0,unit_price_currency:le,amount_value:0,amount_currency:le,remark:"",link:""})},className:"button-base bg-blue-500 hover:bg-blue-600 text-white",children:[s.jsx(p,{className:"w-3 h-3 mr-0.5"}),"ì¶”ê°€"]})]})]}),s.jsx("div",{className:"overflow-x-auto",onPaste:e=>{const t=e.clipboardData.getData("text");if(!t)return;if(t.includes("\t")||t.includes("\n")){e.preventDefault(),e.stopPropagation();try{const a=t.split(/\r\n|\n|\r/).filter(e=>""!==e.trim());if(0===a.length)return;const r=ze("items");let s=0,n="item_name";const i=document.activeElement;let o=null;if(i&&"INPUT"===i.tagName)o=i;else{const t=e.target;if(t){let e=t;for(;e&&"INPUT"!==e.tagName;)if(e=e.parentElement,e&&"INPUT"===e.tagName){o=e;break}}}if(o){const e=o.getAttribute("data-row-index");if(null!==e){const t=parseInt(e,10);!isNaN(t)&&t>=0&&t<r.length&&(s=t)}else{let e=o.parentElement;for(;e&&"TR"!==e.tagName;)e=e.parentElement;if(e&&"TR"===e.tagName){const t=e.parentElement;if(t&&"TBODY"===t.tagName){const a=Array.from(t.children).indexOf(e);a>=0&&a<r.length&&(s=a)}}}const t=o.getAttribute("data-field-name");t&&(n=t)}const l=["item_name","specification","quantity","unit_price_value","amount_value",..."êµ¬ë§¤ ìš”ì²­"===Ue?["link"]:[],"remark"],c=l.indexOf(n);if(-1===c)return;const d=[...r];let m=r.length-1;a.forEach((e,t)=>{const a=e.split("\t"),r=s+t;r>m&&(d.push({line_number:r+1,item_name:"",specification:"",quantity:1,unit_price_value:0,unit_price_currency:le,amount_value:0,amount_currency:le,remark:"",link:""}),m++);const n=d[r];a.forEach((e,t)=>{const a=c+t;if(a>=l.length)return;const r=l[a],s=e.trim();if("amount_value"!==r)if("quantity"===r){const e=parseInt(s.replace(/,/g,"")||"0")||0;n.quantity=e}else if("unit_price_value"===r){const e=parseFloat(s.replace(/,/g,"")||"0")||0;n.unit_price_value=e}else"link"===r?n.link=s:"remark"===r?n.remark=s:"item_name"===r?n.item_name=s:"specification"===r&&(n.specification=s)}),n.amount_value=n.quantity*n.unit_price_value,d[r]=n});Math.min(a.length+(d.length-r.length),d.length-s);for(let e=0;e<a.length;e++){const t=s+e;t<r.length&&He(t,d[t])}if(d.length>r.length){const e=d.slice(r.length);$e(e)}q.success(`${a.length}ê°œ í–‰ ë°ì´í„°ë¥¼ ë¶™ì—¬ë„£ì—ˆìŠµë‹ˆë‹¤.`)}catch(a){q.error("ì—‘ì…€ ë°ì´í„° ë¶™ì—¬ë„£ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}}},tabIndex:0,style:{outline:"none"},children:s.jsx("div",{className:"max-h-[calc(100vh-180px)] overflow-y-auto",children:s.jsxs("table",{className:"w-full text-xs",children:[s.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10",children:s.jsxs("tr",{className:"border-b border-gray-200",children:[s.jsx("th",{className:"px-2 py-2 text-left font-medium text-gray-700 w-10",children:"#"}),s.jsxs("th",{className:"px-2 py-2 text-left font-medium text-gray-700 min-w-[100px] sm:min-w-[120px]",children:["í’ˆëª©",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("th",{className:"px-2 py-2 text-left font-medium text-gray-700 min-w-[250px] sm:min-w-[320px]",children:"ê·œê²©"}),s.jsxs("th",{className:"px-2 py-2 text-center font-medium text-gray-700 w-20",children:["ìˆ˜ëŸ‰",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsxs("th",{className:"px-2 py-2 text-right font-medium text-gray-700 w-[140px] sm:w-[160px]",children:["ë‹¨ê°€ (",le,")"]}),s.jsxs("th",{className:"px-2 py-2 text-right font-medium text-gray-700 min-w-[110px] sm:min-w-[140px]",children:["í•©ê³„ (",le,")"]}),"êµ¬ë§¤ ìš”ì²­"===Ue&&s.jsx("th",{className:"px-2 py-2 text-left font-medium text-gray-700 min-w-[120px] sm:min-w-[150px]",children:"ë§í¬"}),s.jsx("th",{className:"px-2 py-2 text-left font-medium text-gray-700 min-w-[100px] sm:min-w-[150px]",children:"ë¹„ê³ "}),s.jsx("th",{className:"px-2 py-2 text-center font-medium text-gray-700 w-10"})]})}),s.jsx("tbody",{className:"bg-white",children:Re.map((e,t)=>s.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[s.jsx("td",{className:"px-2 py-1 text-center text-gray-500",children:t+1}),s.jsx("td",{className:"px-2 py-1",children:s.jsx(m,{"data-row-index":t,"data-field-name":"item_name",value:e.item_name,onChange:a=>He(t,{...e,item_name:a.target.value}),className:"h-7 w-full bg-white border border-gray-200 text-xs",placeholder:"í’ˆëª©ëª… ì…ë ¥"})}),s.jsx("td",{className:"px-2 py-1",children:s.jsx(m,{"data-row-index":t,"data-field-name":"specification",value:e.specification,onChange:a=>He(t,{...e,specification:a.target.value}),className:"h-7 w-full bg-white border border-gray-200 text-xs",placeholder:"ê·œê²© ì…ë ¥"})}),s.jsx("td",{className:"px-2 py-1",children:s.jsx(m,{"data-row-index":t,"data-field-name":"quantity",type:"number",min:"1",value:e.quantity||"",className:"h-7 w-20 bg-white border border-gray-200 text-xs text-center [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",placeholder:"0",onChange:a=>{const r=parseInt(a.target.value)||0;He(t,{...e,quantity:r})}})}),s.jsx("td",{className:"px-2 py-1",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(m,{"data-row-index":t,"data-field-name":"unit_price_value",type:"text",inputMode:"decimal",value:xe[`${t}_unit_price_value`]??(0===e.unit_price_value?"":e.unit_price_value?.toLocaleString("ko-KR")||""),onChange:a=>{const r=a.target.value.replace(/,/g,"").replace(/[^0-9.]/g,""),s=r.split("."),n=s.length>2?s[0]+"."+s.slice(1).join(""):r;he(e=>({...e,[`${t}_unit_price_value`]:n}));const i=""===n?0:parseFloat(n)||0;He(t,{...e,unit_price_value:i})},onBlur:()=>{he(e=>{const a={...e};return delete a[`${t}_unit_price_value`],a})},className:"h-7 w-32 bg-white border border-gray-200 text-xs text-right",placeholder:"0"}),s.jsx("span",{className:"ml-1 text-xs text-gray-500",children:"KRW"===le?"â‚©":"$"})]})}),s.jsx("td",{className:"px-2 py-1",children:s.jsxs("div",{className:"flex items-center justify-end",children:[s.jsx("span",{className:"text-xs text-right font-medium",children:(e.amount_value||0).toLocaleString("ko-KR")}),s.jsx("span",{className:"ml-1 text-xs text-gray-500",children:"KRW"===le?"â‚©":"$"})]})}),"êµ¬ë§¤ ìš”ì²­"===Ue&&s.jsx("td",{className:"px-2 py-1",children:s.jsx(m,{"data-row-index":t,"data-field-name":"link",value:e.link||"",onChange:a=>He(t,{...e,link:a.target.value}),type:"url",className:"h-7 w-full bg-white border border-gray-200 text-xs",placeholder:"https://..."})}),s.jsx("td",{className:"px-2 py-1",children:s.jsx(m,{"data-row-index":t,"data-field-name":"remark",value:e.remark||"",onChange:a=>He(t,{...e,remark:a.target.value}),className:"h-7 w-full bg-white border border-gray-200 text-xs",placeholder:"ë¹„ê³ "})}),s.jsx("td",{className:"px-2 py-1 text-center",children:Re.length>1&&s.jsx(n,{type:"button",onClick:()=>Ee(t),size:"sm",variant:"ghost",className:"h-6 w-6 p-0 hover:bg-red-50",children:s.jsx(o,{className:"w-3 h-3 text-red-600"})})})]},t))})]})})})]}),s.jsxs("div",{className:"flex justify-end gap-3 mt-2",children:[s.jsx(n,{type:"button",variant:"outline",onClick:()=>e(-1),className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-400",children:"ì·¨ì†Œ"}),s.jsx(n,{type:"submit",disabled:de||!Ve,className:"button-base bg-hansl-600 hover:bg-hansl-700 text-white",children:de?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"ì²˜ë¦¬ ì¤‘..."]}):s.jsxs(s.Fragment,{children:[s.jsx(E,{className:"w-4 h-4 mr-2"}),{"ë°œì£¼/êµ¬ë§¤":"ë°œì£¼ìš”ì²­","ì¹´ë“œì‚¬ìš©":"ì¹´ë“œì‚¬ìš©ìš”ì²­","ì¶œì¥":"ì¶œì¥ìš”ì²­","ì°¨ëŸ‰":"ì°¨ëŸ‰ìš”ì²­"}[qe("po_template_type")]||"ìš”ì²­"]})})]})]})]}),pe&&s.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-700 text-sm",children:pe}),s.jsx(u,{open:ge,onOpenChange:_e,children:s.jsxs(x,{className:"w-full max-w-[95vw] sm:max-w-3xl max-h-[80vh] overflow-y-auto",children:[s.jsx(h,{children:s.jsx(g,{children:"ë‹´ë‹¹ì ê´€ë¦¬"})}),s.jsx("div",{className:"space-y-4",children:fe.map((e,t)=>s.jsxs("div",{className:"flex gap-2 items-end",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx(y,{className:"text-xs",children:"ì´ë¦„"}),s.jsx(m,{value:e.contact_name,onChange:e=>Be(t,"contact_name",e.target.value),placeholder:"ë‹´ë‹¹ì ì´ë¦„",className:"h-9"})]}),s.jsxs("div",{className:"flex-1",children:[s.jsx(y,{className:"text-xs",children:"ì´ë©”ì¼"}),s.jsx(m,{value:e.contact_email,onChange:e=>Be(t,"contact_email",e.target.value),placeholder:"ì´ë©”ì¼",className:"h-9"})]}),s.jsxs("div",{className:"flex-1",children:[s.jsx(y,{className:"text-xs",children:"ì „í™”ë²ˆí˜¸"}),s.jsx(m,{value:e.contact_phone,onChange:e=>Be(t,"contact_phone",e.target.value),placeholder:"ì „í™”ë²ˆí˜¸",className:"h-9"})]}),s.jsxs("div",{className:"flex-1",children:[s.jsx(y,{className:"text-xs",children:"ì§ì±…"}),s.jsx(m,{value:e.position,onChange:e=>Be(t,"position",e.target.value),placeholder:"ì§ì±…",className:"h-9"})]}),s.jsx(n,{type:"button",size:"sm",variant:"ghost",onClick:()=>(e=>{ye(t=>t.filter((t,a)=>a!==e)),ve(!0)})(t),className:"h-9 px-2",children:s.jsx(o,{className:"h-4 w-4"})})]},t))}),s.jsxs(_,{className:"gap-2",children:[s.jsxs(n,{type:"button",variant:"outline",onClick:()=>{ye(e=>[...e,{contact_name:"",contact_email:"",contact_phone:"",position:"",isNew:!0}]),ve(!0)},size:"sm",children:[s.jsx(p,{className:"h-4 w-4 mr-1"}),"ë‹´ë‹¹ì ì¶”ê°€"]}),s.jsx(f,{asChild:!0,children:s.jsx(n,{type:"button",variant:"outline",size:"sm",children:"ì·¨ì†Œ"})}),s.jsx(n,{type:"button",onClick:async()=>{if(Me)try{if(fe.filter(e=>e.contact_email&&e.contact_email.endsWith("@hansl.io")).length>0)return void alert("í•œìŠ¬ ì§ì› ì´ë©”ì¼ì€ ì—…ì²´ ë‹´ë‹¹ìë¡œ ë“±ë¡í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");const e=fe.filter(e=>!e.isNew&&e.id).map(e=>e.id),t=ae.filter(t=>t.id&&!e.includes(t.id)),a=[];for(const s of t)if(s.id){const{error:e}=await D.from("vendor_contacts").delete().eq("id",s.id);e&&a.push(s.contact_name||`ID:${s.id}`)}a.length>0&&q.error(`ë‹¤ìŒ ë‹´ë‹¹ìëŠ” ë°œì£¼ì— ì—°ê²°ë˜ì–´ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${a.join(", ")}`);if(fe.filter(e=>e.contact_name&&e.contact_name.trim()&&(!e.contact_email||!e.contact_email.trim())).length>0)return void q.error("ë‹´ë‹¹ìì˜ ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");for(const s of fe)if(s.contact_name&&s.contact_email)if(!s.isNew&&s.id){const{error:e}=await D.from("vendor_contacts").update({contact_name:s.contact_name,contact_email:s.contact_email,contact_phone:s.contact_phone||"",position:s.position||""}).eq("id",s.id)}else if(s.isNew){const{error:e}=await D.from("vendor_contacts").insert({vendor_id:Me,contact_name:s.contact_name,contact_email:s.contact_email,contact_phone:s.contact_phone||"",position:s.position||""});e&&q.error(`ë‹´ë‹¹ì ì¶”ê°€ ì‹¤íŒ¨: ${e.message}`)}const{data:r}=await D.from("vendor_contacts").select("id, contact_name, contact_email, contact_phone, position").eq("vendor_id",Me);r&&re(r),_e(!1),q.success("ë‹´ë‹¹ì ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.")}catch(e){q.error("ë‹´ë‹¹ì ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}},disabled:!be,size:"sm",children:"ì €ì¥"})]})]})})]})}export{D as default};
//# sourceMappingURL=PurchaseNewMain-BW3ol2pB.js.map
