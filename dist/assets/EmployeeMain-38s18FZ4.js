import{e,c as a,l as t,r as s,j as r,B as n,X as l,A as i,U as o,b as c,_ as d}from"./index-DsAL4iro.js";import{P as u,I as m,D as h,a as p,b as x,c as g}from"./dialog-B22Nto94.js";import{S as y,a as b,b as _,c as v,d as j}from"./select-8avWESM0.js";import{C as w}from"./calendar-TX1shQE9.js";import{D as f}from"./download-ayaITdR2.js";import{S as N}from"./search-8TWKvsJc.js";import{b as k}from"./helpers-CmqE03mo.js";import{T as C,a as S,b as D,c as E,d as I,e as $}from"./table-D-PuXFms.js";import{D as R,a as O,b as F,e as L}from"./dropdown-menu-SziJVaKh.js";import{t as z}from"./index-Dz8943Z0.js";import{u as K,S as M,E as q,a as T,M as A,b as U,c as P,d as V}from"./mobile-card-C7SMUOFY.js";import{S as Y,P as B,a as W,b as H}from"./popover-CdBmGBMH.js";import{T as J}from"./card-C_LMoGjm.js";import{C as G,a as Q,b as X,c as Z,d as ee,e as ae}from"./command-C36rWf8P.js";import{C as te}from"./check-B6iIntpq.js";import{E as se}from"./exceljs.min-DyxZKerE.js";import"./index-dVjxNOkf.js";import"./chevron-right-3Zn4N5p9.js";import"./arrow-up-down-Bn06tBgN.js";
/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=e("toggle-left",[["circle",{cx:"9",cy:"12",r:"3",key:"u3jwor"}],["rect",{width:"20",height:"14",x:"2",y:"5",rx:"7",key:"g7kal2"}]]),ne=e("toggle-right",[["circle",{cx:"15",cy:"12",r:"3",key:"1afu0r"}],["rect",{width:"20",height:"14",x:"2",y:"5",rx:"7",key:"g7kal2"}]]);const le=new class{constructor(){this.supabase=a()}async getEmployees(e){try{let a=this.supabase.from("employees").select("*").order("name");e?.search&&(a=a.or(`\n          name.ilike.%${e.search}%,\n          email.ilike.%${e.search}%,\n          phone.ilike.%${e.search}%,\n          position.ilike.%${e.search}%,\n          department.ilike.%${e.search}%\n        `)),e?.department&&(a=a.eq("department",e.department)),e?.position&&(a=a.eq("position",e.position)),"none"===e?.purchase_role?a=a.is("purchase_role",null):e?.purchase_role&&(a=a.contains("purchase_role",[e.purchase_role])),void 0!==e?.is_active&&(a=a.eq("is_active",e.is_active));const{data:t,error:s}=await a;if(s)throw s;return{success:!0,data:t||[]}}catch(a){return t.error("직원 목록 조회 실패",a),{success:!1,error:a instanceof Error?a.message:"알 수 없는 오류가 발생했습니다."}}}async getEmployee(e){try{const{data:a,error:t}=await this.supabase.from("employees").select("*").eq("id",e).single();if(t)throw t;return{success:!0,data:a}}catch(a){return t.error("직원 조회 실패",a),{success:!1,error:a instanceof Error?a.message:"알 수 없는 오류가 발생했습니다."}}}async createEmployee(e){try{const{data:a}=await this.supabase.from("employees").select("id").eq("email",e.email).single();if(a)return{success:!1,error:"이미 등록된 이메일입니다."};const t=crypto.randomUUID(),s=e.is_active??!0,{data:r,error:n}=await this.supabase.from("employees").insert({id:t,...e,purchase_role:e.purchase_role&&e.purchase_role.length>0?e.purchase_role:null,is_active:s,terminated_at:s?null:(new Date).toISOString()}).select().single();if(n)throw n;return{success:!0,data:r}}catch(a){t.error("직원 생성 실패",a);return{success:!1,error:a instanceof Error?a.message:"object"==typeof a&&a&&"message"in a?String(a.message):"알 수 없는 오류가 발생했습니다."}}}async updateEmployee(e,a){try{if(a.email){const{data:t}=await this.supabase.from("employees").select("id").eq("email",a.email).neq("id",e).single();if(t)return{success:!1,error:"이미 등록된 이메일입니다."}}const t={...a};void 0===a.purchase_role?delete t.purchase_role:t.purchase_role=a.purchase_role.length>0?a.purchase_role:null,void 0!==a.is_active&&null!==a.is_active&&(t.terminated_at=a.is_active?null:(new Date).toISOString());const{data:s,error:r}=await this.supabase.from("employees").update(t).eq("id",e).select().single();if(r)throw r;return{success:!0,data:s}}catch(s){t.error("직원 수정 실패",s);return{success:!1,error:s instanceof Error?s.message:"object"==typeof s&&s&&"message"in s?String(s.message):"알 수 없는 오류가 발생했습니다."}}}async deleteEmployee(e){try{const{data:a}=await this.supabase.from("purchase_requests").select("id").eq("requester_id",e).limit(1);if(a&&a.length>0){const{error:a}=await this.supabase.from("employees").update({is_active:!1,terminated_at:(new Date).toISOString()}).eq("id",e);if(a)throw a;return{success:!0}}{const{error:a}=await this.supabase.from("employees").delete().eq("id",e);if(a)throw a;return{success:!0}}}catch(a){return t.error("직원 삭제 실패",a),{success:!1,error:a instanceof Error?a.message:"알 수 없는 오류가 발생했습니다."}}}async toggleEmployeeStatus(e){try{const{data:a,error:t}=await this.supabase.from("employees").select("is_active").eq("id",e).single();if(t)throw t;const s=!a.is_active,{data:r,error:n}=await this.supabase.from("employees").update({is_active:s,terminated_at:s?null:(new Date).toISOString()}).eq("id",e).select().single();if(n)throw n;return{success:!0,data:r}}catch(a){return t.error("직원 상태 변경 실패",a),{success:!1,error:a instanceof Error?a.message:"알 수 없는 오류가 발생했습니다."}}}async updateEmployeeRole(e,a){try{const{data:t,error:s}=await this.supabase.from("employees").update({purchase_role:a?[a]:null}).eq("id",e).select().single();if(s)throw s;return{success:!0,data:t}}catch(s){return t.error("직원 권한 변경 실패",s),{success:!1,error:s instanceof Error?s.message:"알 수 없는 오류가 발생했습니다."}}}async getDepartments(){try{const{data:e,error:a}=await this.supabase.from("employees").select("department");if(a)throw a;return{success:!0,data:[...new Set((e||[]).map(e=>e.department).filter(e=>null!=e&&""!==e))].sort()}}catch(e){return t.error("부서 목록 조회 실패",e),{success:!1,error:e instanceof Error?e.message:"알 수 없는 오류가 발생했습니다."}}}async getPositions(){try{const{data:e,error:a}=await this.supabase.from("employees").select("position");if(a)throw a;return{success:!0,data:[...new Set((e||[]).map(e=>e.position).filter(e=>null!=e&&""!==e))].sort()}}catch(e){return t.error("직급 목록 조회 실패",e),{success:!1,error:e instanceof Error?e.message:"알 수 없는 오류가 발생했습니다."}}}async getEmployeesForExport(){try{const{data:e,error:a}=await this.supabase.from("employees").select("*").order("name");if(a)throw a;return{success:!0,data:(e||[]).map(e=>({"이름":e.name,"이메일":e.email||"","전화번호":e.phone||"","주소":e.adress||"","부서":e.department||"","직급":e.position||"","권한":this.getRoleDisplayName(e.purchase_role),"상태":e.is_active?"활성":"비활성","등록일":e.created_at?new Date(e.created_at).toLocaleDateString("ko-KR"):""}))}}catch(e){return t.error("직원 Excel 내보내기 실패",e),{success:!1,error:e instanceof Error?e.message:"알 수 없는 오류가 발생했습니다."}}}getRoleDisplayName(e){const a={app_admin:"앱 관리자",hr:"HR",accounting:"회계",ceo:"CEO",final_approver:"최종 승인자",middle_manager:"중간 관리자","lead buyer":"수석 구매자",buyer:"구매자"},t=this.normalizeRoles(e);return 0===t.length?"권한 없음":t.map(e=>a[e]||e).join(", ")}normalizeRoles(e){return e?Array.isArray(e)?e.filter(e=>e&&e.trim()):"string"==typeof e?e.split(",").map(e=>e.trim()).filter(Boolean):[]:[]}async checkPermission(e,a){try{const{data:t}=await this.supabase.from("employees").select("purchase_role, is_active").eq("id",e).single();if(!t||!t.is_active)return{success:!0,hasPermission:!1};const s=this.normalizeRoles(t.purchase_role);return{success:!0,hasPermission:s.some(e=>a.includes(e))}}catch(t){return{success:!1,error:t instanceof Error?t.message:"알 수 없는 오류가 발생했습니다."}}}},ie=[{value:"app_admin",label:"앱 관리자"},{value:"ceo",label:"CEO"},{value:"final_approver",label:"최종 승인자"},{value:"middle_manager",label:"중간 관리자"},{value:"lead buyer",label:"수석 구매자"},{value:"buyer",label:"구매자"}];function oe({filters:e,onFiltersChange:a,onExport:t,onCreateNew:i,onAttendanceDownload:o,onAnnualLeaveUsageDownload:c,canManageEmployees:d=!1}){const[h,p]=s.useState(e.search||""),[x,g]=s.useState([]),[k,C]=s.useState([]);s.useEffect(()=>{(async()=>{const[e,a]=await Promise.all([le.getDepartments(),le.getPositions()]);e.success&&g(e.data||[]),a.success&&C(a.data||[])})()},[]),s.useEffect(()=>{p(e.search||"")},[e.search]),s.useEffect(()=>{const t=setTimeout(()=>{const t=h.trim();t!==(e.search||"")&&a({...e,search:t||void 0})},300);return()=>clearTimeout(t)},[h,e,a]);const S=e.search||e.department||e.position||e.purchase_role||void 0!==e.is_active;return r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"page-title",children:"직원 관리"}),r.jsx("p",{className:"page-subtitle",style:{marginTop:"-2px",marginBottom:"-4px"},children:"Employee Management"})]}),d&&r.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.jsxs(n,{onClick:c,className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 flex items-center gap-1",children:[r.jsx(w,{className:"w-4 h-4"}),r.jsx("span",{className:"hidden sm:inline",children:"연차사용현황"}),r.jsx("span",{className:"sm:hidden",children:"연차"})]}),r.jsxs(n,{onClick:o,className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 flex items-center gap-1",children:[r.jsx(w,{className:"w-4 h-4"}),r.jsx("span",{className:"hidden sm:inline",children:"출근현황표"}),r.jsx("span",{className:"sm:hidden",children:"출근"})]}),r.jsxs(n,{onClick:t,className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 flex items-center gap-1",children:[r.jsx(f,{className:"w-4 h-4"}),r.jsx("span",{className:"hidden sm:inline",children:"Excel 내보내기"}),r.jsx("span",{className:"sm:hidden",children:"Excel"})]}),r.jsxs(n,{onClick:i,className:"button-base bg-blue-500 hover:bg-blue-600 text-white flex items-center gap-1",children:[r.jsx(u,{className:"w-4 h-4"}),"직원 등록"]})]})]}),r.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[r.jsxs("div",{className:"relative min-w-[180px] flex-1 max-w-[260px]",children:[r.jsx(N,{className:"absolute left-1.5 top-1/2 -translate-y-1/2 w-2.5 h-2.5 text-gray-400"}),r.jsx(m,{type:"text",placeholder:"이름, 이메일, 전화번호 검색",value:h,onChange:e=>p(e.target.value),className:"!h-auto !py-px !pr-1.5 !pl-5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700"})]}),r.jsx("div",{className:"min-w-[120px]",children:r.jsxs(y,{value:e.department||"all",onValueChange:t=>{a({...e,department:"all"===t?void 0:t})},children:[r.jsx(b,{className:"!h-auto !min-h-[20px] !py-px !px-2 !text-[11px] business-radius-input border border-gray-300 bg-white text-gray-700",children:r.jsx(_,{placeholder:"부서"})}),r.jsxs(v,{children:[r.jsx(j,{value:"all",children:"전체 부서"}),x.map(e=>r.jsx(j,{value:e,children:e},e))]})]})}),r.jsx("div",{className:"min-w-[120px]",children:r.jsxs(y,{value:e.position||"all",onValueChange:t=>{a({...e,position:"all"===t?void 0:t})},children:[r.jsx(b,{className:"!h-auto !min-h-[20px] !py-px !px-2 !text-[11px] business-radius-input border border-gray-300 bg-white text-gray-700",children:r.jsx(_,{placeholder:"직급"})}),r.jsxs(v,{children:[r.jsx(j,{value:"all",children:"전체 직급"}),k.map(e=>r.jsx(j,{value:e,children:e},e))]})]})}),r.jsx("div",{className:"min-w-[140px]",children:r.jsxs(y,{value:e.purchase_role||"all",onValueChange:t=>{a({...e,purchase_role:"all"===t?void 0:t})},children:[r.jsx(b,{className:"!h-auto !min-h-[20px] !py-px !px-2 !text-[11px] business-radius-input border border-gray-300 bg-white text-gray-700",children:r.jsx(_,{placeholder:"권한"})}),r.jsxs(v,{children:[r.jsx(j,{value:"all",children:"전체 권한"}),r.jsx(j,{value:"none",children:"권한 없음"}),ie.map(e=>r.jsx(j,{value:e.value,children:e.label},e.value))]})]})}),r.jsx("div",{className:"min-w-[100px]",children:r.jsxs(y,{value:void 0===e.is_active?"all":e.is_active?"active":"inactive",onValueChange:t=>{a({...e,is_active:"all"===t?void 0:"active"===t})},children:[r.jsx(b,{className:"!h-auto !min-h-[20px] !py-px !px-2 !text-[11px] business-radius-input border border-gray-300 bg-white text-gray-700",children:r.jsx(_,{placeholder:"상태"})}),r.jsxs(v,{children:[r.jsx(j,{value:"all",children:"전체"}),r.jsx(j,{value:"active",children:"활성"}),r.jsx(j,{value:"inactive",children:"비활성"})]})]})}),S&&r.jsxs(n,{type:"button",onClick:()=>{p(""),a({})},className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 flex items-center gap-1",children:[r.jsx(l,{className:"w-4 h-4"}),r.jsx("span",{className:"hidden sm:inline",children:"초기화"}),r.jsx("span",{className:"sm:hidden",children:"초기"})]})]})]})}const ce="__new_employee__",de=[{value:"app_admin",label:"앱 관리자"},{value:"hr",label:"HR"},{value:"accounting",label:"회계"},{value:"ceo",label:"CEO"},{value:"final_approver",label:"최종 승인자"},{value:"middle_manager",label:"중간 관리자"},{value:"lead buyer",label:"수석 구매자"},{value:"buyer",label:"구매자"}],ue=e=>e?e.includes("T")?e.slice(0,10):e:"";function me({employees:e,onRefresh:a,currentUserRoles:t=[],createRequestToken:i=0}){const[o,c]=s.useState(null),{sortedData:d,sortConfig:u,handleSort:h}=K(e,"name","asc"),p=t.includes("app_admin")||t.includes("hr"),[x,g]=s.useState(null),[w,f]=s.useState(!1),[N,B]=s.useState(null),[W,H]=s.useState(null),G=async e=>{if(p){c(e.id);try{const t=await le.toggleEmployeeStatus(e.id);t.success?(z.success(`직원이 ${e.is_active?"비활성화":"활성화"}되었습니다.`),a()):z.error(t.error||"상태 변경에 실패했습니다.")}catch(t){z.error("상태 변경 중 오류가 발생했습니다.")}finally{c(null)}}else z.error("상태 변경 권한이 없습니다.")},Q=async e=>{if(p){if(confirm(`정말로 '${e.name}' 직원을 삭제하시겠습니까?`)){c(e.id);try{const t=await le.deleteEmployee(e.id);t.success?(z.success("직원이 삭제되었습니다."),a()):z.error(t.error||"삭제에 실패했습니다.")}catch(t){z.error("삭제 중 오류가 발생했습니다.")}finally{c(null)}}}else z.error("삭제 권한이 없습니다.")},X=e=>{const a=(e=>e?Array.isArray(e)?e.filter(e=>e&&e.trim()):"string"==typeof e?e.split(",").map(e=>e.trim()).filter(Boolean):[]:[])(e);return a[0]},Z=e=>{const a=X(e);return a?{app_admin:"앱 관리자",hr:"HR",accounting:"회계",ceo:"CEO",final_approver:"최종 승인자",middle_manager:"중간 관리자","lead buyer":"수석 구매자",buyer:"구매자"}[a]||a:"권한 없음"},ee=e=>({app_admin:"bg-purple-100 text-purple-800",hr:"bg-blue-100 text-blue-800",accounting:"bg-sky-100 text-sky-800",ceo:"bg-red-100 text-red-800",final_approver:"bg-hansl-100 text-hansl-800",middle_manager:"bg-green-100 text-green-800","lead buyer":"bg-yellow-100 text-yellow-800",buyer:"bg-gray-100 text-gray-800"}[X(e)||""]||"bg-gray-100 text-gray-600");s.useEffect(()=>{i&&(()=>{if(!p)return void z.error("직원 등록 권한이 없습니다.");const a=e[0];a&&H(new Set(Object.keys(a))),f(!0),g(ce),B({employeeID:"",name:"",position:"",department:"",phone:"",email:"",personal_email:"",annual_leave_granted_current_year:"",used_annual_leave:"",remaining_annual_leave:"",join_date:"",birthday:"",bank_account:"",adress:"",purchase_role:"",is_active:"true"})})()},[i]);const ae=e=>{if(!p)return void z.error("직원 수정 권한이 없습니다.");const a=X(e.purchase_role)||"";f(!1),g(e.id),H(new Set(Object.keys(e||{}))),B({employeeID:e.employeeID||e.employee_number||"",name:e.name||"",position:e.position||"",department:e.department||"",phone:e.phone||"",email:e.email||"",personal_email:e.personal_email||"",annual_leave_granted_current_year:void 0===e.annual_leave_granted_current_year||null===e.annual_leave_granted_current_year?"":String(e.annual_leave_granted_current_year),used_annual_leave:void 0===e.used_annual_leave||null===e.used_annual_leave?"":String(e.used_annual_leave),remaining_annual_leave:void 0===e.remaining_annual_leave||null===e.remaining_annual_leave?"":String(e.remaining_annual_leave),join_date:ue(e.join_date),birthday:ue(e.birthday),bank_account:e.bank_account||"",adress:e.adress||"",purchase_role:a,is_active:e.is_active?"true":"false"})},te=()=>{g(null),f(!1),B(null)},se=e=>{const a=e.trim();return""===a?null:a},ie=e=>{const a=e.trim();if(""===a)return null;const t=Number(a);return Number.isFinite(t)?t:null},oe=async()=>{if(!p)return void z.error("직원 수정 권한이 없습니다.");if(!N||!x)return;const t=N.name.trim(),s=N.email.trim();if(!t)return void z.error("이름은 필수입니다.");if(!s)return void z.error("이메일은 필수입니다.");const r={employeeID:se(N.employeeID),employee_number:se(N.employeeID),name:t,position:se(N.position),department:se(N.department),phone:se(N.phone),email:s,personal_email:se(N.personal_email),annual_leave_granted_current_year:ie(N.annual_leave_granted_current_year),used_annual_leave:ie(N.used_annual_leave),remaining_annual_leave:ie(N.remaining_annual_leave),join_date:se(N.join_date),birthday:se(N.birthday),bank_account:se(N.bank_account),adress:se(N.adress),purchase_role:N.purchase_role?[N.purchase_role]:[],is_active:"true"===N.is_active},n=W??(e[0]?new Set(Object.keys(e[0])):null),l=null===n?r:Object.fromEntries(Object.entries(r).filter(([e])=>n.has(e)));c(x);try{const e=x===ce?await le.createEmployee(l):await le.updateEmployee(x,l);e.success?(z.success(x===ce?"직원이 등록되었습니다.":"직원 정보가 수정되었습니다."),te(),a()):z.error(e.error||"저장에 실패했습니다.")}catch(i){z.error("저장 중 오류가 발생했습니다.")}finally{c(null)}},me=(e,a)=>{B(t=>t?{...t,[e]:a}:t)},he=s.useMemo(()=>{if(!w||x!==ce)return d;return[{id:ce,employeeID:N?.employeeID||"",employee_number:N?.employeeID||"",name:N?.name||"",email:N?.email||"",personal_email:N?.personal_email||"",department:N?.department||"",position:N?.position||"",phone:N?.phone||"",purchase_role:N?.purchase_role?[N.purchase_role]:null,is_active:"true"===N?.is_active,terminated_at:null,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),bank_account:N?.bank_account||"",adress:N?.adress||"",join_date:N?.join_date||"",birthday:N?.birthday||"",annual_leave_granted_current_year:N?.annual_leave_granted_current_year?Number(N.annual_leave_granted_current_year):0,used_annual_leave:N?.used_annual_leave?Number(N.used_annual_leave):0,remaining_annual_leave:N?.remaining_annual_leave?Number(N.remaining_annual_leave):0},...d]},[N,x,w,d]),pe=e=>p&&x===e&&!!N;return r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"hidden md:block border rounded-lg overflow-hidden",children:r.jsx("div",{className:"overflow-x-auto",children:r.jsxs(C,{children:[r.jsx(S,{children:r.jsxs(D,{children:[r.jsx(E,{className:"w-16 min-w-[50px]",children:r.jsx(M,{sortKey:"employeeID",currentSortKey:u.key,sortDirection:u.direction,onSort:()=>h("employeeID"),children:"사번"})}),r.jsx(E,{className:"w-14 min-w-[45px]",children:r.jsx(M,{sortKey:"name",currentSortKey:u.key,sortDirection:u.direction,onSort:()=>h("name"),children:"이름"})}),r.jsx(E,{className:"w-12 min-w-[40px]",children:r.jsx(M,{sortKey:"position",currentSortKey:u.key,sortDirection:u.direction,onSort:()=>h("position"),children:"직급"})}),r.jsx(E,{className:"w-16 min-w-[50px]",children:r.jsx(M,{sortKey:"department",currentSortKey:u.key,sortDirection:u.direction,onSort:()=>h("department"),children:"부서"})}),r.jsx(E,{className:"w-20 min-w-[70px]",children:r.jsx(M,{sortKey:"phone",currentSortKey:u.key,sortDirection:u.direction,onSort:()=>h("phone"),children:"연락처"})}),r.jsx(E,{className:"w-32 min-w-[100px]",children:r.jsx(M,{sortKey:"email",currentSortKey:u.key,sortDirection:u.direction,onSort:()=>h("email"),children:"회사 이메일"})}),p&&r.jsx(E,{className:"w-40 min-w-[140px]",children:"개인 이메일"}),p&&r.jsxs(r.Fragment,{children:[r.jsx(E,{className:"w-11 min-w-[40px] text-center",children:"생성"}),r.jsx(E,{className:"w-11 min-w-[40px] text-center",children:"사용"}),r.jsx(E,{className:"w-11 min-w-[40px] text-center",children:"남은"}),r.jsx(E,{className:"w-18 min-w-[60px]",children:r.jsx(M,{sortKey:"join_date",currentSortKey:u.key,sortDirection:u.direction,onSort:()=>h("join_date"),children:"입사일"})}),r.jsx(E,{className:"w-20 min-w-[70px]",children:r.jsx(M,{sortKey:"birthday",currentSortKey:u.key,sortDirection:u.direction,onSort:()=>h("birthday"),children:"생년월일"})}),r.jsx(E,{className:"w-24 min-w-[80px]",children:"계좌번호"}),r.jsx(E,{className:"min-w-[120px]",children:"주소"}),r.jsx(E,{children:r.jsx(M,{sortKey:"purchase_role",currentSortKey:u.key,sortDirection:u.direction,onSort:()=>h("purchase_role"),children:"권한"})}),r.jsx(E,{children:r.jsx(M,{sortKey:"is_active",currentSortKey:u.key,sortDirection:u.direction,onSort:()=>h("is_active"),children:"상태"})}),r.jsx(E,{className:"w-16 min-w-[50px]",children:"작업"})]})]})}),r.jsx(I,{children:0===he.length?r.jsx(D,{children:r.jsx($,{colSpan:p?16:6,className:"text-center py-8 text-gray-500",children:"등록된 직원이 없습니다."})}):he.map(e=>r.jsxs(D,{children:[r.jsx($,{className:"text-[11px] px-2 py-1.5",children:pe(e.id)?r.jsx(m,{value:N?.employeeID||"",onChange:e=>me("employeeID",e.target.value),placeholder:"사번",className:"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700"}):e.employeeID||e.employee_number||e.id.slice(0,8)}),r.jsx($,{className:"text-[11px] px-2 py-1.5",children:pe(e.id)?r.jsx(m,{value:N?.name||"",onChange:e=>me("name",e.target.value),className:"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700"}):e.name}),r.jsx($,{className:"text-[11px] px-2 py-1.5",children:pe(e.id)?r.jsx(m,{value:N?.position||"",onChange:e=>me("position",e.target.value),className:"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700"}):e.position||"-"}),r.jsx($,{className:"text-[11px] px-2 py-1.5",children:pe(e.id)?r.jsx(m,{value:N?.department||"",onChange:e=>me("department",e.target.value),className:"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700"}):e.department||"-"}),r.jsx($,{className:"text-[11px] px-2 py-1.5",children:pe(e.id)?r.jsx(m,{value:N?.phone||"",onChange:e=>me("phone",e.target.value),className:"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700"}):e.phone||"-"}),r.jsx($,{className:"text-[11px] px-2 py-1.5",children:pe(e.id)?r.jsx(m,{value:N?.email||"",onChange:e=>me("email",e.target.value),className:"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700"}):e.email||"-"}),p&&r.jsx($,{className:"px-2 py-1.5",children:pe(e.id)?r.jsx(m,{value:N?.personal_email||"",onChange:e=>me("personal_email",e.target.value),placeholder:"personal@example.com",className:"!h-auto !py-px !px-1 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700"}):e.personal_email||"-"}),p&&r.jsxs(r.Fragment,{children:[r.jsx($,{className:"text-center text-[11px] px-1 py-1.5",children:pe(e.id)?r.jsx(m,{type:"number",value:N?.annual_leave_granted_current_year||"",onChange:e=>me("annual_leave_granted_current_year",e.target.value),className:"!h-auto !py-px !px-1 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700 text-center"}):e.annual_leave_granted_current_year||0}),r.jsx($,{className:"text-center text-[11px] px-1 py-1.5",children:pe(e.id)?r.jsx(m,{type:"number",value:N?.used_annual_leave||"",onChange:e=>me("used_annual_leave",e.target.value),className:"!h-auto !py-px !px-1 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700 text-center"}):e.used_annual_leave||0}),r.jsx($,{className:"text-center text-[11px] px-1 py-1.5",children:pe(e.id)?r.jsx(m,{type:"number",value:N?.remaining_annual_leave||"",onChange:e=>me("remaining_annual_leave",e.target.value),className:"!h-auto !py-px !px-1 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700 text-center"}):void 0!==e.remaining_annual_leave?e.remaining_annual_leave:"-"}),r.jsx($,{className:"text-[11px] px-2 py-1.5",children:pe(e.id)?r.jsx(m,{type:"date",value:N?.join_date||"",onChange:e=>me("join_date",e.target.value),className:"!h-auto !py-px !px-1 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700"}):k(e.join_date)}),r.jsx($,{className:"text-[11px] px-2 py-1.5",children:pe(e.id)?r.jsx(m,{type:"date",value:N?.birthday||"",onChange:e=>me("birthday",e.target.value),className:"!h-auto !py-px !px-1 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700"}):k(e.birthday)}),r.jsx($,{className:"px-2 py-1.5",children:pe(e.id)?r.jsx(m,{value:N?.bank_account||"",onChange:e=>me("bank_account",e.target.value),className:"!h-auto !py-px !px-1 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700"}):e.bank_account||"-"}),r.jsx($,{className:"px-1 py-1.5",children:pe(e.id)?r.jsx(m,{value:N?.adress||"",onChange:e=>me("adress",e.target.value),className:"!h-auto !py-px !px-1 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700"}):e.adress||"-"}),r.jsx($,{className:"px-2 py-1.5",children:pe(e.id)?r.jsxs(y,{value:N?.purchase_role||"none",onValueChange:e=>me("purchase_role","none"===e?"":e),children:[r.jsx(b,{className:"!h-auto !min-h-[20px] !py-px !px-2 !text-[11px] business-radius-input border border-gray-300 bg-white text-gray-700",children:r.jsx(_,{placeholder:"권한"})}),r.jsxs(v,{children:[r.jsx(j,{value:"none",children:"권한 없음"}),de.map(e=>r.jsx(j,{value:e.value,children:e.label},e.value))]})]}):r.jsx("span",{className:`badge-stats text-[10px] px-1.5 py-0.5 ${ee(e.purchase_role)}`,children:Z(e.purchase_role)})}),r.jsx($,{className:"px-2 py-1.5",children:pe(e.id)?r.jsxs(y,{value:N?.is_active||"true",onValueChange:e=>me("is_active",e),children:[r.jsx(b,{className:"!h-auto !min-h-[20px] !py-px !px-2 !text-[11px] business-radius-input border border-gray-300 bg-white text-gray-700",children:r.jsx(_,{placeholder:"상태"})}),r.jsxs(v,{children:[r.jsx(j,{value:"true",children:"활성"}),r.jsx(j,{value:"false",children:"비활성"})]})]}):r.jsx("span",{className:"badge-stats text-[10px] px-1.5 py-0.5 "+(e.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-600"),children:e.is_active?"활성":"비활성"})}),r.jsx($,{className:"px-1 py-1.5",children:pe(e.id)?r.jsxs("div",{className:"flex gap-1",children:[r.jsxs(n,{className:"button-base bg-blue-500 hover:bg-blue-600 text-white flex items-center gap-1",onClick:oe,disabled:o===e.id,children:[r.jsx(Y,{className:"w-4 h-4"}),"저장"]}),r.jsxs(n,{className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 flex items-center gap-1",onClick:te,disabled:o===e.id,children:[r.jsx(l,{className:"w-4 h-4"}),"취소"]})]}):r.jsxs(R,{children:[r.jsx(O,{asChild:!0,children:r.jsx(n,{className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50",disabled:o===e.id,children:r.jsx(q,{className:"h-4 w-4"})})}),r.jsxs(F,{align:"end",children:[r.jsxs(L,{onClick:()=>ae(e),children:[r.jsx(T,{className:"mr-2 h-4 w-4"}),"수정"]}),r.jsx(L,{onClick:()=>G(e),children:e.is_active?r.jsxs(r.Fragment,{children:[r.jsx(re,{className:"mr-2 h-4 w-4"}),"비활성화"]}):r.jsxs(r.Fragment,{children:[r.jsx(ne,{className:"mr-2 h-4 w-4"}),"활성화"]})}),r.jsxs(L,{onClick:()=>Q(e),className:"text-red-600",children:[r.jsx(J,{className:"mr-2 h-4 w-4"}),"삭제"]})]})]})})]})]},e.id))})]})})}),r.jsx("div",{className:"block md:hidden space-y-3",children:0===he.length?r.jsx("div",{className:"text-center py-8 text-gray-500",children:"등록된 직원이 없습니다."}):he.map(e=>r.jsxs(A,{children:[r.jsx(U,{children:r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{children:e.name}),p&&r.jsx("span",{className:"badge-stats "+(e.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-600"),children:e.is_active?"활성":"비활성"})]})}),r.jsx(P,{label:"사번",value:pe(e.id)?r.jsx(m,{value:N?.employeeID||"",onChange:e=>me("employeeID",e.target.value),placeholder:"사번",className:"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700"}):e.employeeID||e.employee_number||e.id.slice(0,8)}),r.jsx(P,{label:"이름",value:pe(e.id)?r.jsx(m,{value:N?.name||"",onChange:e=>me("name",e.target.value),className:"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700"}):e.name}),r.jsx(P,{label:"직급",value:pe(e.id)?r.jsx(m,{value:N?.position||"",onChange:e=>me("position",e.target.value),className:"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700"}):e.position||"-"}),r.jsx(P,{label:"부서",value:pe(e.id)?r.jsx(m,{value:N?.department||"",onChange:e=>me("department",e.target.value),className:"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700"}):e.department||"-"}),r.jsx(P,{label:"연락처",value:pe(e.id)?r.jsx(m,{value:N?.phone||"",onChange:e=>me("phone",e.target.value),className:"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700"}):e.phone||"-"}),r.jsx(P,{label:"회사 이메일",value:pe(e.id)?r.jsx(m,{value:N?.email||"",onChange:e=>me("email",e.target.value),className:"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700"}):e.email||"-"}),p&&r.jsx(P,{label:"개인 이메일",value:pe(e.id)?r.jsx(m,{value:N?.personal_email||"",onChange:e=>me("personal_email",e.target.value),placeholder:"personal@example.com",className:"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700"}):e.personal_email||"-"}),p&&r.jsxs(r.Fragment,{children:[r.jsx(P,{label:"권한",value:pe(e.id)?r.jsxs(y,{value:N?.purchase_role||"none",onValueChange:e=>me("purchase_role","none"===e?"":e),children:[r.jsx(b,{className:"!h-auto !min-h-[20px] !py-px !px-2 !text-[11px] business-radius-input border border-gray-300 bg-white text-gray-700",children:r.jsx(_,{placeholder:"권한"})}),r.jsxs(v,{children:[r.jsx(j,{value:"none",children:"권한 없음"}),de.map(e=>r.jsx(j,{value:e.value,children:e.label},e.value))]})]}):r.jsx("span",{className:`badge-stats ${ee(e.purchase_role)}`,children:Z(e.purchase_role)})}),r.jsx(P,{label:"상태",value:pe(e.id)?r.jsxs(y,{value:N?.is_active||"true",onValueChange:e=>me("is_active",e),children:[r.jsx(b,{className:"!h-auto !min-h-[20px] !py-px !px-2 !text-[11px] business-radius-input border border-gray-300 bg-white text-gray-700",children:r.jsx(_,{placeholder:"상태"})}),r.jsxs(v,{children:[r.jsx(j,{value:"true",children:"활성"}),r.jsx(j,{value:"false",children:"비활성"})]})]}):e.is_active?"활성":"비활성"}),r.jsx(P,{label:"입사일",value:pe(e.id)?r.jsx(m,{type:"date",value:N?.join_date||"",onChange:e=>me("join_date",e.target.value),className:"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700"}):k(e.join_date)}),r.jsx(P,{label:"생년월일",value:pe(e.id)?r.jsx(m,{type:"date",value:N?.birthday||"",onChange:e=>me("birthday",e.target.value),className:"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700"}):k(e.birthday)}),r.jsx(P,{label:"계좌번호",value:pe(e.id)?r.jsx(m,{value:N?.bank_account||"",onChange:e=>me("bank_account",e.target.value),className:"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700"}):e.bank_account||"-"}),r.jsx(P,{label:"주소",value:pe(e.id)?r.jsx(m,{value:N?.adress||"",onChange:e=>me("adress",e.target.value),className:"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700"}):e.adress||"-"}),r.jsx(P,{label:"연차(생성/사용/남은)",value:pe(e.id)?r.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[r.jsx(m,{type:"number",value:N?.annual_leave_granted_current_year||"",onChange:e=>me("annual_leave_granted_current_year",e.target.value),placeholder:"생성",className:"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700"}),r.jsx(m,{type:"number",value:N?.used_annual_leave||"",onChange:e=>me("used_annual_leave",e.target.value),placeholder:"사용",className:"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700"}),r.jsx(m,{type:"number",value:N?.remaining_annual_leave||"",onChange:e=>me("remaining_annual_leave",e.target.value),placeholder:"남은",className:"!h-auto !py-px !px-1.5 !text-[11px] !min-h-[20px] business-radius-input border border-gray-300 bg-white text-gray-700"})]}):`${e.annual_leave_granted_current_year||0}/${e.used_annual_leave||0}/${void 0!==e.remaining_annual_leave?e.remaining_annual_leave:"-"}`}),r.jsx(V,{children:pe(e.id)?r.jsxs(r.Fragment,{children:[r.jsxs(n,{className:"button-base bg-blue-500 hover:bg-blue-600 text-white flex items-center gap-1",onClick:oe,disabled:o===e.id,children:[r.jsx(Y,{className:"w-4 h-4"}),"저장"]}),r.jsxs(n,{className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 flex items-center gap-1",onClick:te,disabled:o===e.id,children:[r.jsx(l,{className:"w-4 h-4"}),"취소"]})]}):r.jsxs(r.Fragment,{children:[r.jsxs(n,{className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 flex items-center gap-1",onClick:()=>ae(e),children:[r.jsx(T,{className:"w-4 h-4"}),"수정"]}),r.jsxs(n,{className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 flex items-center gap-1",onClick:()=>G(e),disabled:o===e.id,children:[e.is_active?r.jsx(re,{className:"w-4 h-4"}):r.jsx(ne,{className:"w-4 h-4"}),"상태"]}),r.jsxs(n,{className:"button-base border border-red-200 bg-white text-red-600 hover:bg-red-50 flex items-center gap-1",onClick:()=>Q(e),disabled:o===e.id,children:[r.jsx(J,{className:"w-4 h-4"}),"삭제"]})]})})]})]},e.id))})]})}function he({options:e,value:a,onValueChange:t,placeholder:l="선택...",searchPlaceholder:o="검색...",emptyText:c="결과가 없습니다.",className:d}){const[u,m]=s.useState(!1);return r.jsxs(B,{open:u,onOpenChange:m,children:[r.jsx(W,{asChild:!0,children:r.jsxs(n,{variant:"outline",role:"combobox","aria-expanded":u,className:i("w-full justify-between h-9 text-sm font-normal",d),children:[a?e.find(e=>e.value===a)?.label:l,r.jsx(G,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),r.jsx(H,{className:"w-full p-0",align:"start",children:r.jsxs(Q,{children:[r.jsx(X,{placeholder:o,className:"h-9"}),r.jsx(Z,{children:c}),r.jsx(ee,{className:"max-h-[300px] overflow-auto",children:e.map(e=>r.jsxs(ae,{value:e.label,onSelect:()=>{t(e.value===a?"":e.value),m(!1)},children:[r.jsx(te,{className:i("mr-2 h-4 w-4",a===e.value?"opacity-100":"opacity-0")}),e.label]},e.value))})]})})]})}async function pe(e){const a=new se.Workbook,t=a.addWorksheet("출근현황표");t.pageSetup={paperSize:9,orientation:"portrait",margins:{left:.7,right:.7,top:.75,bottom:.75,header:.3,footer:.3}},t.columns=[{width:12},{width:8},{width:12},{width:8},{width:6},{width:8},{width:12},{width:12},{width:8},{width:8}];t.addRow(["1"]).height=25,t.mergeCells("A1:J1");const s=t.getCell("A1");s.value="1",s.font={name:"맑은 고딕",size:14,bold:!0},s.alignment={horizontal:"center",vertical:"middle"},t.addRow([]);t.addRow([`${e.employeeName} 내역 (21)`]).height=20,t.mergeCells("A3:J3");const r=t.getCell("A3");r.font={name:"맑은 고딕",size:12,bold:!0},r.alignment={horizontal:"left",vertical:"middle"};t.addRow([`조회기간: ${e.startDate} ~ ${e.endDate}`]).height=20,t.mergeCells("A4:J4");const n=t.getCell("A4");n.font={name:"맑은 고딕",size:10},n.alignment={horizontal:"left",vertical:"middle"};const l=t.addRow(["날짜","이름","사번","부서","직급","근무형태","출근시간","퇴근시간","출퇴근상태","근무상태"]);l.height=25,l.eachCell((e,a)=>{e.font={name:"맑은 고딕",size:10,bold:!0},e.alignment={horizontal:"center",vertical:"middle"},e.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE0E0E0"}}});e.records.forEach(e=>{let a=e.remarks||"-";const s=(e=>{const a=new Date(e.split("(")[0]),t=a.getDay();if(0===t||6===t)return!0;const s=a.getFullYear(),r=a.getMonth()+1,n=a.getDate(),l=[`${s}-01-01`,`${s}-03-01`,`${s}-05-05`,`${s}-06-06`,`${s}-08-15`,`${s}-10-03`,`${s}-10-09`,`${s}-12-25`],i=`${s}-${r.toString().padStart(2,"0")}-${n.toString().padStart(2,"0")}`;return l.includes(i)})(e.date);if(e.remarks&&e.remarks.includes("연차"))a="연차";else if(s){const t=new Date(e.date.split("(")[0]).getDay();a=0===t||6===t?"주말":"공휴일"}const r=t.addRow([e.date,e.employeeName,e.employeeId,e.department,e.position,e.workType,e.clockIn||"-",e.clockOut||"-",e.status,a]);r.height=20;const n=s,l=e.remarks&&e.remarks.includes("연차");r.eachCell((e,a)=>{e.font={name:"맑은 고딕",size:9},e.alignment={horizontal:1===a?"center":"left",vertical:"middle"},e.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},7!==a&&8!==a||(e.alignment={horizontal:"center",vertical:"middle"}),l?e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE8F5E8"}}:n&&(e.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFE8E8"}})})});const i=await a.xlsx.writeBuffer();return new Blob([i],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})}function xe(e){const a=function(e){return["일","월","화","수","목","금","토"][new Date(e).getDay()]}(e);return`${e}(${a})`}function ge({employees:e,isOpen:t,onClose:l}){const[i,c]=s.useState(""),[d,u]=s.useState(""),[y,b]=s.useState(""),[_,v]=s.useState(!1),j=a(),N=()=>{c(""),u(""),b(""),v(!1),l()};return r.jsx(h,{open:t,onOpenChange:N,children:r.jsxs(p,{className:"sm:max-w-[520px] max-h-[85vh] overflow-y-auto",children:[r.jsxs(x,{className:"pb-6 space-y-3",children:[r.jsxs(g,{className:"flex items-center text-2xl font-bold text-gray-900",children:[r.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-hansl-400 to-hansl-600 flex items-center justify-center mr-4 shadow-sm",children:r.jsx(w,{className:"w-6 h-6 text-white"})}),"출근현황표 다운로드"]}),r.jsxs("p",{className:"text-gray-600 leading-relaxed pl-16",children:["직원과 조회 기간을 선택하여 출근현황을",r.jsx("br",{}),"엑셀 파일로 간편하게 다운로드하세요"]})]}),r.jsxs("div",{className:"space-y-8 py-2",children:[r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"w-8 h-8 rounded-lg bg-blue-50 flex items-center justify-center",children:r.jsx(o,{className:"w-4 h-4 text-blue-600"})}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"직원 선택"})]}),r.jsx("div",{className:"pl-11",children:r.jsx(he,{value:i,onValueChange:c,options:e.filter(e=>e.name&&""!==e.name.trim()).sort((e,a)=>(e.name||"").localeCompare(a.name||"")).map(e=>({value:e.id,label:`${e.name} (${e.department||"부서없음"})`})),placeholder:"직원명 검색...",searchPlaceholder:"직원 이름 검색...",emptyText:"검색 결과가 없습니다",className:"h-10 text-sm border-gray-200 focus:border-hansl-400 focus:ring-1 focus:ring-hansl-100"})})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"w-8 h-8 rounded-lg bg-green-50 flex items-center justify-center",children:r.jsx(w,{className:"w-4 h-4 text-green-600"})}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"조회 기간"})]}),r.jsxs("div",{className:"pl-11 space-y-4",children:[r.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"시작일"}),r.jsx(m,{type:"date",value:d,onChange:e=>u(e.target.value),className:"h-9 text-sm border-gray-200 focus:border-hansl-400 focus:ring-1 focus:ring-hansl-100"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"종료일"}),r.jsx(m,{type:"date",value:y,onChange:e=>b(e.target.value),className:"h-9 text-sm border-gray-200 focus:border-hansl-400 focus:ring-1 focus:ring-hansl-100"})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("p",{className:"text-sm font-medium text-gray-700",children:"빠른 선택"}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(n,{type:"button",variant:"outline",size:"sm",onClick:()=>{const e=new Date,a=new Date(e.getFullYear(),e.getMonth(),1),t=new Date(e.getFullYear(),e.getMonth()+1,0);u(a.toISOString().split("T")[0]),b(t.toISOString().split("T")[0])},className:"h-8 px-4 text-sm border-gray-200 hover:bg-hansl-50 hover:border-hansl-300 hover:text-hansl-700 transition-colors",children:"이번 달"}),r.jsx(n,{type:"button",variant:"outline",size:"sm",onClick:()=>{const e=new Date,a=new Date(e.getFullYear(),e.getMonth()-1,1),t=new Date(e.getFullYear(),e.getMonth(),0);u(a.toISOString().split("T")[0]),b(t.toISOString().split("T")[0])},className:"h-8 px-4 text-sm border-gray-200 hover:bg-hansl-50 hover:border-hansl-300 hover:text-hansl-700 transition-colors",children:"지난 달"})]})]})]})]})]}),r.jsxs("div",{className:"flex gap-3 pt-6 mt-2 border-t border-gray-100",children:[r.jsx(n,{variant:"outline",onClick:N,className:"flex-1 h-10 text-sm font-medium border-gray-200 hover:bg-gray-50 transition-colors",disabled:_,children:"취소"}),r.jsxs(n,{onClick:async()=>{if(i)if(d&&y)if(new Date(d)>new Date(y))z.error("시작일이 종료일보다 늦을 수 없습니다.");else{v(!0);try{const a=e.find(e=>e.id===i);if(!a)throw new Error("선택된 직원 정보를 찾을 수 없습니다.");const{data:t,error:s}=await j.from("attendance_records").select("*").eq("employee_id",i).gte("date",d).lte("date",y).order("date",{ascending:!0});if(s)throw new Error("출근 기록을 조회하는데 실패했습니다.");const r=[],n=new Date(d),o=new Date(y);for(let e=new Date(n);e<=o;e.setDate(e.getDate()+1))r.push(e.toISOString().split("T")[0]);const c=new Map;t?.forEach(e=>{c.set(e.date,e)});const u=r.map(e=>{const t=c.get(e),s=xe(e),r=s.split("(")[1]?.split(")")[0]||"",n=new Date(e),l=0===n.getDay()||6===n.getDay();return{date:s,dayOfWeek:r,employeeName:a.name||"",employeeId:a.employeeID||a.employee_number||"",department:a.department||"",position:a.position||"",workType:"사원",clockIn:t?.clock_in||(l?"-":""),clockOut:t?.clock_out||(l?"-":""),status:"정상 출근"===t?.status?"정상 출근":t?.status||"",remarks:t?.remarks||""}}),m={employeeName:a.name||"",employeeId:a.employeeID||"",department:a.department||"",startDate:d,endDate:y,records:u},h=await pe(m),p=window.URL.createObjectURL(h),x=document.createElement("a");x.href=p,x.download=`출근현황표_${a.name}_${d}_${y}.xlsx`,document.body.appendChild(x),x.click(),document.body.removeChild(x),window.URL.revokeObjectURL(p),z.success("출근현황표가 다운로드되었습니다."),l()}catch(a){z.error(a instanceof Error?a.message:"다운로드 중 오류가 발생했습니다.")}finally{v(!1)}}else z.error("조회 기간을 설정해주세요.");else z.error("직원을 선택해주세요.")},disabled:_||!i||!d||!y,className:"flex-1 h-10 text-sm bg-gradient-to-r from-hansl-500 to-hansl-600 hover:from-hansl-600 hover:to-hansl-700 text-white font-medium shadow-sm transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:[r.jsx(f,{className:"w-4 h-4 mr-2"}),_?"다운로드 중...":"엑셀 다운로드"]})]})]})})}const ye=["일","월","화","수","목","금","토"];function be(e){const a=new Date(e);return a.setHours(0,0,0,0),a}function _e(e){return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}function ve(e){const a=(e.status??"").toString().toLowerCase();if(!("approved"===a||a.includes("approved")||a.includes("승인")))return{ok:!1,reason:"not_approved",unit:1};const t=(e.type??"").toString(),s=(e.reason??"").toString(),r=t.toLowerCase(),n=s.toLowerCase();return r.includes("annual")||r.includes("연차")||r.includes("half")||r.includes("반차")||n.includes("half")||n.includes("반차")||n.includes("0.5")?{ok:!0,reason:"included",unit:je(e)}:{ok:!1,reason:"not_annual_or_half",unit:1}}function je(e){const a=Number(e.days??NaN);if(!Number.isNaN(a))return.5===a?.5:1;const t=(e.start_period??"").toString().toLowerCase(),s=(e.end_period??"").toString().toLowerCase();if((t&&"full"!==t||s&&"full"!==s)&&e.start_date===e.end_date)return.5;const r=(e.type??"").toString().toLowerCase(),n=(e.reason??"").toString().toLowerCase();return(r.includes("half")||r.includes("반차")||n.includes("half")||n.includes("반차")||n.includes("0.5"))&&e.start_date===e.end_date?.5:1}function we({isOpen:e,onClose:t}){const[l,i]=s.useState(String((new Date).getFullYear())),[o,c]=s.useState(!1),d=a();return r.jsx(h,{open:e,onOpenChange:()=>{i(String((new Date).getFullYear())),c(!1),t()},children:r.jsxs(p,{className:"sm:max-w-[520px] max-h-[85vh] overflow-y-auto",children:[r.jsxs(x,{className:"pb-6 space-y-3",children:[r.jsxs(g,{className:"flex items-center text-2xl font-bold text-gray-900",children:[r.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-hansl-400 to-hansl-600 flex items-center justify-center mr-4 shadow-sm",children:r.jsx(w,{className:"w-6 h-6 text-white"})}),"연차사용현황 다운로드"]}),r.jsxs("p",{className:"text-gray-600 leading-relaxed pl-16",children:["연도를 선택하면 직원별 사용일수와 월별 상세(일자/단위)를",r.jsx("br",{}),"엑셀로 다운로드합니다"]})]}),r.jsxs("div",{className:"space-y-6 py-2",children:[r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"연도"}),r.jsx(m,{type:"number",value:l,onChange:e=>i(e.target.value),min:2e3,max:2100,placeholder:"예: 2025",className:"h-9 text-sm border-gray-200 focus:border-hansl-400 focus:ring-1 focus:ring-hansl-100"})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(n,{type:"button",variant:"outline",size:"sm",onClick:()=>i(String((new Date).getFullYear())),className:"h-8 px-4 text-sm border-gray-200 hover:bg-hansl-50 hover:border-hansl-300 hover:text-hansl-700 transition-colors",children:"올해"}),r.jsx(n,{type:"button",variant:"outline",size:"sm",onClick:()=>i(String((new Date).getFullYear()-1)),className:"h-8 px-4 text-sm border-gray-200 hover:bg-hansl-50 hover:border-hansl-300 hover:text-hansl-700 transition-colors",children:"작년"})]})]}),r.jsx("div",{className:"pt-2",children:r.jsx(n,{onClick:async()=>{const e=Number(l);if(!l||Number.isNaN(e)||e<2e3||e>2100)return void z.error("연도를 올바르게 입력해주세요. (예: 2025)");const a=`${e}-01-01`,s=`${e}-12-31`;c(!0);try{const{data:r,error:n}=await d.from("leave").select("*").lte("start_date",s).gte("end_date",a).order("start_date",{ascending:!0});if(n)throw n;const l=r||[];if(0===l.length)return void z.error("선택한 기간에 연차(승인) 기록이 없습니다.");const i=l.map(e=>{const a=ve(e);return a.ok?{id:e.id,user_email:e.user_email,start_date:e.start_date,end_date:e.end_date,unit:a.unit,type:e.type??null,status:e.status??null,reason:e.reason??null}:null}).filter(Boolean),o=l.map(e=>{const a=ve(e);return a.ok?null:{id:e.id,user_email:e.user_email,start_date:e.start_date,end_date:e.end_date,excludeReason:a.reason,type:e.type??null,status:e.status??null,reason:e.reason??null}}).filter(Boolean),{summaries:c,details:u}=function(e){const{leaves:a,startDate:t,endDate:s}=e,r=be(t),n=be(s),l=[],i=new Map;a.forEach(e=>{const a=ve(e);if(!a.ok)return;const t=be(e.start_date),s=be(e.end_date),o=t>r?t:r,c=s<n?s:n;if(o>c)return;const d=new Date(o);for(;d<=c;d.setDate(d.getDate()+1)){const t=d.getDay(),s=_e(d);let r=1;if(e.start_date===e.end_date)r=a.unit;else{const a=(e.start_period??"").toString().toLowerCase(),t=(e.end_period??"").toString().toLowerCase();s===e.start_date&&a&&"full"!==a&&(r=.5),s===e.end_date&&t&&"full"!==t&&(r=.5)}l.push({user_email:e.user_email,date:s,dayOfWeek:ye[t],unit:r,leave_id:e.id,leave_start_date:e.start_date,leave_end_date:e.end_date,reason:e.reason??null}),i.set(e.user_email,(i.get(e.user_email)??0)+r)}});const o=Array.from(i.entries()).map(([e,a])=>({user_email:e,used_days:a})).sort((e,a)=>a.used_days-e.used_days);return l.sort((e,a)=>e.user_email!==a.user_email?e.user_email.localeCompare(a.user_email):e.date.localeCompare(a.date)),{summaries:o,details:l}}({leaves:l,startDate:a,endDate:s});if(0===c.length||0===u.length)return void z.error("선택한 연도에 승인된 연차/반차(근무일 기준) 기록이 없습니다.");const m=await le.getEmployees({is_active:void 0});if(!m.success||!m.data)throw new Error(m.error||"직원 목록을 불러오지 못했습니다.");const h=m.data,p=new Map;h.forEach(e=>{e.email&&p.set(e.email,e)});const x=new Set(c.map(e=>e.user_email)),g=[],y=new Map;h.forEach(e=>{e.email&&x.has(e.email)&&e.id&&(y.set(e.email,e.id),g.push(e.id))});const b=new Map;u.forEach(e=>{const[a,t,s]=e.date.split("-");if(!a||!t||!s)return;const r=Number(t),n=Number(s);if(Number.isNaN(r)||Number.isNaN(n))return;b.has(e.user_email)||b.set(e.user_email,new Map);const l=b.get(e.user_email);l.has(r)||l.set(r,[]),l.get(r).push({day:n,unit:e.unit})});const _=(e,a)=>{const t=b.get(e),s=t?.get(a)||[];return s.sort((e,a)=>e.day-a.day),s.map(e=>`${e.day}(${1===e.unit?"1":"0.5"})`).join(",")},v=c.map(a=>{const t=p.get(a.user_email),s={};for(let e=1;e<=12;e++)s[e]=_(a.user_email,e);const r=((e,a)=>{if(!e)return 0;const t=new Date(e);if(Number.isNaN(t.getTime()))return 0;const s=t.getFullYear(),r=t.getMonth()+1,n=a-s;if(0===n){const e=13-r;return Math.floor(15*e/12)}return 1===n||2===n?15:n>=3?Math.min(25,15+Math.floor((n-1)/2)):0})(t?.join_date,e);return{employeeId:t?.employeeID||t?.employee_number||"",name:t?.name||"",grantedDays:r,usedDays:a.used_days,months:s}}),j=await async function(e){const{summaries:a,debug:t}=e,s=new se.Workbook,r=s.addWorksheet("연차사용현황");if(r.columns=[{header:"사번",key:"employeeId",width:14},{header:"이름",key:"name",width:12},{header:"지급연차",key:"grantedDays",width:10},{header:"사용일수",key:"usedDays",width:10},{header:"1월",key:"m1",width:22},{header:"2월",key:"m2",width:22},{header:"3월",key:"m3",width:22},{header:"4월",key:"m4",width:22},{header:"5월",key:"m5",width:22},{header:"6월",key:"m6",width:22},{header:"7월",key:"m7",width:22},{header:"8월",key:"m8",width:22},{header:"9월",key:"m9",width:22},{header:"10월",key:"m10",width:24},{header:"11월",key:"m11",width:24},{header:"12월",key:"m12",width:24}],r.getRow(1).font={name:"맑은 고딕",bold:!0},r.getRow(1).alignment={vertical:"middle",horizontal:"center"},[...a].sort((e,a)=>{const t=(e.name??"").toString(),s=(a.name??"").toString(),r=t.localeCompare(s);return 0!==r?r:(e.employeeId??"").toString().localeCompare((a.employeeId??"").toString())}).forEach(e=>{r.addRow({employeeId:e.employeeId??"",name:e.name??"",grantedDays:e.grantedDays??"",usedDays:e.usedDays,m1:e.months[1]??"",m2:e.months[2]??"",m3:e.months[3]??"",m4:e.months[4]??"",m5:e.months[5]??"",m6:e.months[6]??"",m7:e.months[7]??"",m8:e.months[8]??"",m9:e.months[9]??"",m10:e.months[10]??"",m11:e.months[11]??"",m12:e.months[12]??""})}),t){const e=s.addWorksheet(`검증_포함_${t.year}`);e.columns=[{header:"leave_id",key:"id",width:10},{header:"user_email",key:"user_email",width:26},{header:"start_date",key:"start_date",width:12},{header:"end_date",key:"end_date",width:12},{header:"unit",key:"unit",width:6},{header:"type",key:"type",width:18},{header:"status",key:"status",width:12},{header:"reason",key:"reason",width:30}],e.getRow(1).font={name:"맑은 고딕",bold:!0},e.getRow(1).alignment={vertical:"middle",horizontal:"center"},t.includedLeaves.forEach(a=>e.addRow(a));const a=s.addWorksheet(`검증_제외_${t.year}`);a.columns=[{header:"leave_id",key:"id",width:10},{header:"user_email",key:"user_email",width:26},{header:"start_date",key:"start_date",width:12},{header:"end_date",key:"end_date",width:12},{header:"excludeReason",key:"excludeReason",width:16},{header:"type",key:"type",width:18},{header:"status",key:"status",width:12},{header:"reason",key:"reason",width:30}],a.getRow(1).font={name:"맑은 고딕",bold:!0},a.getRow(1).alignment={vertical:"middle",horizontal:"center"},t.excludedLeaves.forEach(e=>a.addRow(e))}const n=await s.xlsx.writeBuffer();return new Blob([n],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})}({summaries:v,debug:{year:e,includedLeaves:i,excludedLeaves:o}}),w=window.URL.createObjectURL(j),f=document.createElement("a");f.href=w,f.download=`연차_사용현황_${e}.xlsx`,document.body.appendChild(f),f.click(),document.body.removeChild(f),window.URL.revokeObjectURL(w),z.success("연차사용현황 엑셀이 다운로드되었습니다."),t()}catch(r){const e=r?.message||("string"==typeof r?r:"")||"다운로드 중 오류가 발생했습니다.";z.error(e)}finally{c(!1)}},disabled:o,className:"w-full h-11 bg-hansl-600 hover:bg-hansl-700 text-white font-semibold shadow-sm",children:o?"다운로드 중...":r.jsxs(r.Fragment,{children:[r.jsx(f,{className:"w-4 h-4 mr-2"}),"엑셀 다운로드"]})})})]})]})})}function fe(){const{currentUserRoles:e}=c(),a=e.includes("app_admin")||e.includes("hr"),[t,n]=s.useState([]),[l,i]=s.useState([]),[o,u]=s.useState(!0),[m,h]=s.useState({}),[p,x]=s.useState(0),[g,y]=s.useState(!1),[b,_]=s.useState(!1),v=async()=>{u(!0);try{const e=await le.getEmployees(m);e.success&&e.data?(n(e.data),i(e.data)):z.error(e.error||"직원 목록을 불러오는데 실패했습니다.")}catch(e){z.error("직원 목록을 불러오는 중 오류가 발생했습니다.")}finally{u(!1)}};s.useEffect(()=>{v()},[]),s.useEffect(()=>{v()},[m]);return o&&0===t.length?r.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),r.jsx("p",{className:"mt-2 card-subtitle",children:"직원 목록을 불러오는 중..."})]})}):r.jsx(r.Fragment,{children:r.jsxs("div",{className:"space-y-6",children:[r.jsx(oe,{filters:m,onFiltersChange:h,onExport:async()=>{if(a)try{const e=await le.getEmployeesForExport();if(e.success&&e.data){const a=await d(()=>import("./xlsx-ByDo_lG2.js"),[]),t=a.utils.json_to_sheet(e.data),s=a.utils.book_new();a.utils.book_append_sheet(s,t,"직원 목록");const r=`직원_목록_${(new Date).toISOString().slice(0,10)}.xlsx`;a.writeFile(s,r),z.success("Excel 파일이 다운로드되었습니다.")}else z.error(e.error||"Excel 내보내기에 실패했습니다.")}catch(e){z.error("Excel 내보내기 중 오류가 발생했습니다.")}else z.error("Excel 내보내기 권한이 없습니다.")},onCreateNew:()=>{a?x(e=>e+1):z.error("직원 등록 권한이 없습니다.")},onAttendanceDownload:()=>{a?y(!0):z.error("출근현황표 다운로드 권한이 없습니다.")},onAnnualLeaveUsageDownload:()=>{a?_(!0):z.error("연차사용현황 다운로드 권한이 없습니다.")},canManageEmployees:a}),r.jsxs("div",{className:"bg-white rounded-lg border",children:[r.jsx("div",{className:"p-4 border-b",children:r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("h3",{className:"modal-title",children:"직원 목록"}),r.jsx("div",{className:"card-description",children:o?"로딩 중...":`총 ${l.length}명의 직원`})]})}),r.jsx(me,{employees:l,onRefresh:v,currentUserRoles:e,createRequestToken:p})]}),r.jsx(ge,{employees:t,isOpen:g,onClose:()=>y(!1)}),r.jsx(we,{isOpen:b,onClose:()=>_(!1)})]})})}export{fe as default};
//# sourceMappingURL=EmployeeMain-38s18FZ4.js.map
