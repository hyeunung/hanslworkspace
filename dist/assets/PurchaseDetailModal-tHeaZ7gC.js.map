{"version":3,"file":"PurchaseDetailModal-tHeaZ7gC.js","sources":["../../src/components/purchase/PurchaseDetailModal.tsx"],"sourcesContent":["import { useEffect, useState, useRef, useCallback, useMemo } from 'react'\nimport { createClient } from '@/lib/supabase/client'\nimport { PurchaseRequestWithDetails, Purchase } from '@/types/purchase'\nimport { formatDate } from '@/utils/helpers'\nimport { DatePickerPopover } from '@/components/ui/date-picker-popover'\nimport { \n  Calendar, \n  User, \n  Building2, \n  Package, \n  CreditCard,\n  X,\n  FileText,\n  DollarSign,\n  Edit2,\n  Trash2,\n  Save,\n  Plus,\n  CheckCircle,\n  XCircle,\n  Check,\n  Truck\n} from 'lucide-react'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport { Input } from '@/components/ui/input'\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog'\nimport { toast } from 'sonner'\nimport { logger } from '@/lib/logger'\nimport { useConfirmDateAction } from '@/hooks/useConfirmDateAction'\nimport { format as formatDateInput } from 'date-fns'\n\ninterface PurchaseDetailModalProps {\n  purchaseId: number | null\n  isOpen: boolean\n  onClose: () => void\n  embedded?: boolean  // Dialog 없이 내용만 렌더링\n  currentUserRoles?: string[]\n  activeTab?: string\n  onRefresh?: (forceRefresh?: boolean, options?: { silent?: boolean }) => void | Promise<void>\n  onOptimisticUpdate?: (purchaseId: number, updater: (prev: Purchase) => Purchase) => void\n  onDelete?: (purchase: PurchaseRequestWithDetails) => void\n}\n\nexport default function PurchaseDetailModal({ \n  purchaseId, \n  isOpen, \n  onClose, \n  embedded = false,\n  currentUserRoles = [],\n  activeTab,\n  onRefresh,\n  onOptimisticUpdate,\n  onDelete\n}: PurchaseDetailModalProps) {\n  const [loading, setLoading] = useState(false)\n  const [purchase, setPurchase] = useState<PurchaseRequestWithDetails | null>(null)\n  const [isEditing, setIsEditing] = useState(false)\n  const [editedPurchase, setEditedPurchase] = useState<PurchaseRequestWithDetails | null>(null)\n  const [editedItems, setEditedItems] = useState<any[]>([])\n  const [deletedItemIds, setDeletedItemIds] = useState<number[]>([])\n  const [userRoles, setUserRoles] = useState<string[]>([])\n  const [currentUserName, setCurrentUserName] = useState<string>('')\n  const [columnWidths, setColumnWidths] = useState<number[]>([])\n  const tableMinWidth = useMemo(() => {\n    if (columnWidths.length > 0) {\n      const columnGap = columnWidths.length > 1 ? (columnWidths.length - 1) * 12 : 0\n      const padding = 48\n      const total = columnWidths.reduce((sum, width) => sum + width, 0) + columnGap + padding\n      return Math.max(total, 720)\n    }\n\n    const baseColumns: number[] = [120, 140, 80, 110, 130, 110, 120]\n\n    if (activeTab === 'purchase') {\n      baseColumns.push(120)\n    }\n\n    if (activeTab === 'receipt' || activeTab === 'done') {\n      baseColumns.push(120)\n    }\n\n    if (activeTab === 'receipt') {\n      baseColumns.push(140)\n    }\n\n    if (activeTab === 'done') {\n      baseColumns.push(140, 140, 110)\n    }\n\n    if (isEditing) {\n      baseColumns.push(110)\n    }\n\n    const columnGap = baseColumns.length > 1 ? (baseColumns.length - 1) * 12 : 0\n    const total = baseColumns.reduce((sum, width) => sum + width, 0) + columnGap + 48\n    return Math.max(total, 720)\n  }, [columnWidths, activeTab, isEditing])\n  const headerRowRef = useRef<HTMLDivElement>(null)\n  const supabase = createClient()\n  \n  // 사용자 권한 및 이름 직접 로드\n  useEffect(() => {\n    const loadUserRoles = async () => {\n      try {\n        // Supabase 환경 변수 확인\n        const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\n        const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;\n        \n        if (!supabaseUrl || !supabaseAnonKey || supabaseUrl.includes('placeholder')) {\n          logger.warn('Supabase 환경 변수가 설정되지 않음 - PurchaseDetailModal');\n          return;\n        }\n\n        const { data: { user } } = await supabase.auth.getUser()\n        if (user) {\n          // 먼저 ID로 시도\n          let { data: employeeData } = await supabase\n            .from('employees')\n            .select('*')\n            .eq('id', user.id)\n            .maybeSingle()\n          \n          // ID로 못 찾았으면 이메일로 시도\n          if (!employeeData && user.email) {\n            const { data: employeeByEmail } = await supabase\n              .from('employees')\n              .select('*')\n              .eq('email', user.email)\n              .maybeSingle()\n            \n            employeeData = employeeByEmail\n          }\n          \n          // 사용자 이름 저장\n          if (employeeData?.name) {\n            setCurrentUserName(employeeData.name)\n          }\n          \n          if (employeeData?.purchase_role) {\n            let roles: string[] = []\n            if (Array.isArray(employeeData.purchase_role)) {\n              roles = employeeData.purchase_role.map((r: any) => String(r).trim())\n            } else {\n              const roleString = String(employeeData.purchase_role)\n              roles = roleString\n                .split(',')\n                .map((r: string) => r.trim())\n                .filter((r: string) => r.length > 0)\n            }\n            setUserRoles(roles)\n          }\n        }\n      } catch (error) {\n      }\n    }\n    \n    if (isOpen) {\n      loadUserRoles()\n    }\n  }, [isOpen])\n  \n  // currentUserRoles가 배열이 아니면 userRoles 사용\n  const effectiveRoles = Array.isArray(currentUserRoles) && currentUserRoles.length > 0 \n    ? currentUserRoles \n    : userRoles\n  \n  // 권한 체크\n  const canEdit = effectiveRoles.includes('final_approver') || \n                  effectiveRoles.includes('app_admin') || \n                  effectiveRoles.includes('ceo')\n  \n  // 삭제 권한: 관리자 또는 요청자 본인 (단, 승인된 요청은 관리자만)\n  const isApproved = purchase?.final_manager_status === 'approved';\n  const canDelete = isApproved \n    ? canEdit  // 승인된 요청은 관리자만 삭제 가능\n    : (canEdit || (purchase?.requester_name === currentUserName))  // 미승인 요청은 요청자도 삭제 가능\n  \n  // 구매 권한 체크: app_admin + lead buyer만 (요청자 본인 제외)\n  const canPurchase = effectiveRoles.includes('app_admin') || \n                     effectiveRoles.includes('lead_buyer') || \n                     effectiveRoles.includes('lead buyer')\n  \n  // 입고 권한 체크 \n  // 1. 관리자는 모든 건 입고 처리 가능\n  // 2. 요청자는 자신의 요청건만 입고 처리 가능\n  const canReceiveItems = effectiveRoles.includes('app_admin') || \n                         (purchase?.requester_name === currentUserName)\n  // 2. 일반 직원은 본인이 요청한 건만 입고 처리 가능\n  const isAdmin = effectiveRoles.includes('final_approver') || \n                  effectiveRoles.includes('app_admin') || \n                  effectiveRoles.includes('ceo')\n  const isRequester = purchase?.requester_name === currentUserName\n  const canReceiptCheck = isAdmin || isRequester\n  \n\n  // 모달 내부 데이터만 새로고침하는 함수 (모달 닫지 않음)\n  const refreshModalData = useCallback(async () => {\n    if (!purchaseId) return\n    \n    try {\n      const supabase = createClient()\n      // 최신 구매 요청 데이터 로드\n      const { data, error } = await supabase\n        .from('purchase_requests')\n        .select(`\n          *,\n          vendors(id, vendor_name),\n          purchase_request_items(*)\n        `)\n        .eq('id', purchaseId)\n        .single()\n      \n      if (error) throw error\n\n      if (data) {\n        // 라인넘버 순서대로 정렬\n        const sortedItems = (data.purchase_request_items || []).sort((a: any, b: any) => {\n          const lineA = a.line_number || 999999;\n          const lineB = b.line_number || 999999;\n          return lineA - lineB;\n        });\n\n        const purchaseData = {\n          ...data,\n          items: sortedItems,\n          vendor: data.vendors || { id: 0, vendor_name: '알 수 없음' },\n          vendor_contacts: []\n        } as PurchaseRequestWithDetails\n\n        setPurchase(purchaseData)\n        setEditedPurchase(purchaseData)\n        setEditedItems(sortedItems)\n        \n        logger.debug('모달 데이터 새로고침 완료 - 모달 상태 유지')\n      }\n    } catch (error) {\n      logger.error('모달 데이터 새로고침 실패', error)\n    }\n  }, [purchaseId])\n  \n  // 컴포넌트가 마운트될 때 외부 새로고침을 방지하는 플래그\n  const [isInitialLoad, setIsInitialLoad] = useState(true)\n  \n  // 커스텀 훅 설정\n  const purchaseIdNumber = purchaseId ? Number(purchaseId) : (purchase ? Number(purchase.id) : NaN)\n\n  const handleActualReceiptOptimisticUpdate = useCallback(({ itemId, selectedDate, action }: {\n    itemId: number\n    selectedDate?: Date\n    action: 'confirm' | 'cancel'\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n    }\n  }) => {\n    const itemIdStr = String(itemId)\n    const nowIso = new Date().toISOString()\n    const selectedDateIso = selectedDate ? selectedDate.toISOString() : undefined\n\n    const updateItems = (items?: any[]) => {\n      if (!items) return items\n      return items.map(item => {\n        if (String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_received: true,\n            actual_received_date: selectedDateIso,\n            received_at: nowIso\n          }\n        }\n\n        return {\n          ...item,\n          is_received: false,\n          actual_received_date: undefined,\n          received_at: undefined\n        }\n      })\n    }\n\n    setPurchase(prev => {\n      if (!prev) return prev\n      const updatedItems = updateItems(prev.items) || []\n      const total = updatedItems.length\n      const completed = updatedItems.filter(item => item.is_received).length\n      const allReceived = total > 0 && completed === total\n\n      return {\n        ...prev,\n        items: updatedItems,\n        is_received: allReceived,\n        received_at: allReceived ? (prev.received_at || nowIso) : undefined\n      }\n    })\n\n    setEditedPurchase(prev => {\n      if (!prev) return prev\n      const updatedItems = updateItems(prev.items) || []\n      return {\n        ...prev,\n        items: updatedItems\n      }\n    })\n\n    setEditedItems(prevItems => {\n      if (!prevItems || prevItems.length === 0) return prevItems\n      return prevItems.map(item => {\n        if (!item.id || String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_received: true,\n            actual_received_date: selectedDateIso,\n            received_at: nowIso\n          }\n        }\n\n        return {\n          ...item,\n          is_received: false,\n          actual_received_date: undefined,\n          received_at: undefined\n        }\n      })\n    })\n\n    if (!Number.isNaN(purchaseIdNumber)) {\n      onOptimisticUpdate?.(purchaseIdNumber, prevPurchase => {\n        const updatedItems = updateItems(prevPurchase.items) || prevPurchase.items || []\n        const total = updatedItems.length || prevPurchase.items?.length || 0\n        const completed = updatedItems.filter(item => item.is_received).length\n        const allReceived = total > 0 && completed === total\n\n        return {\n          ...prevPurchase,\n          items: updatedItems,\n          is_received: allReceived,\n          received_at: allReceived ? (prevPurchase.received_at || nowIso) : undefined\n        }\n      })\n    }\n  }, [onOptimisticUpdate, purchaseIdNumber])\n\n  const handleStatementReceivedOptimisticUpdate = useCallback(({ itemId, selectedDate, action }: {\n    itemId: number\n    selectedDate?: Date\n    action: 'confirm' | 'cancel'\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n    }\n  }) => {\n    const itemIdStr = String(itemId)\n    const selectedDateIso = selectedDate ? selectedDate.toISOString() : undefined\n\n    let nextAllCompleted = false\n    let nextStatementAt: string | null = null\n\n    setPurchase(prev => {\n      if (!prev) return prev\n\n      const updatedItems = (prev.items || []).map(item => {\n        if (String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_statement_received: true,\n            statement_received_date: selectedDateIso,\n            statement_received_by_name: currentUserName\n          }\n        }\n\n        return {\n          ...item,\n          is_statement_received: false,\n          statement_received_date: null,\n          statement_received_by_name: null\n        }\n      })\n\n      nextAllCompleted = updatedItems.length > 0 && updatedItems.every(item => item.is_statement_received)\n      nextStatementAt = nextAllCompleted\n        ? (selectedDateIso || prev.statement_received_at || new Date().toISOString())\n        : null\n\n      return {\n        ...prev,\n        items: updatedItems,\n        is_statement_received: nextAllCompleted,\n        statement_received_at: nextStatementAt\n      }\n    })\n\n    setEditedPurchase(prev => {\n      if (!prev) return prev\n\n      const updatedItems = (prev.items || []).map(item => {\n        if (String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_statement_received: true,\n            statement_received_date: selectedDateIso,\n            statement_received_by_name: currentUserName\n          }\n        }\n\n        return {\n          ...item,\n          is_statement_received: false,\n          statement_received_date: null,\n          statement_received_by_name: null\n        }\n      })\n\n      return {\n        ...prev,\n        items: updatedItems,\n        is_statement_received: nextAllCompleted,\n        statement_received_at: nextStatementAt\n      }\n    })\n\n    setEditedItems(prevItems => {\n      if (!prevItems) return prevItems\n      return prevItems.map(item => {\n        if (String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_statement_received: true,\n            statement_received_date: selectedDateIso,\n            statement_received_by_name: currentUserName\n          }\n        }\n\n        return {\n          ...item,\n          is_statement_received: false,\n          statement_received_date: null,\n          statement_received_by_name: null\n        }\n      })\n    })\n\n    if (!Number.isNaN(purchaseIdNumber)) {\n      onOptimisticUpdate?.(purchaseIdNumber, prevPurchase => {\n        const updatedItems = (prevPurchase.items || []).map(item => {\n          if (String(item.id) !== itemIdStr) return item\n\n          if (action === 'confirm') {\n            return {\n              ...item,\n              is_statement_received: true,\n              statement_received_date: selectedDateIso,\n              statement_received_by_name: currentUserName\n            }\n          }\n\n          return {\n            ...item,\n            is_statement_received: false,\n            statement_received_date: null,\n            statement_received_by_name: null\n          }\n        })\n\n        const allCompleted = updatedItems.length > 0 && updatedItems.every(item => item.is_statement_received)\n\n        return {\n          ...prevPurchase,\n          items: updatedItems,\n          is_statement_received: allCompleted\n        }\n      })\n    }\n\n    // purchase_requests 레벨 플래그도 업데이트\n    if (purchase && nextAllCompleted !== undefined) {\n      const supabase = createClient()\n      supabase\n        .from('purchase_requests')\n        .update({\n          is_statement_received: nextAllCompleted,\n          statement_received_at: nextStatementAt\n        })\n        .eq('id', purchase.id)\n        .then(({ error }: { error: any }) => {\n          if (error) {\n            logger.error('거래명세서 확인 purchase_requests 업데이트 실패', error)\n          }\n        })\n    }\n  }, [currentUserName, onOptimisticUpdate, purchaseIdNumber, purchase])\n\n  const statementReceivedAction = useConfirmDateAction({\n    config: {\n      field: 'statement_received',\n      confirmMessage: {\n        confirm: '거래명세서 확인을 처리하시겠습니까?',\n        cancel: '거래명세서 확인을 취소하시겠습니까?'\n      },\n      successMessage: {\n        confirm: '거래명세서 확인이 완료되었습니다.',\n        cancel: '거래명세서 확인이 취소되었습니다.'\n      },\n      completedText: '✓ 완료',\n      waitingText: '대기'\n    },\n    currentUserName,\n    canPerformAction: canReceiptCheck,\n    onUpdate: refreshModalData,\n    onOptimisticUpdate: handleStatementReceivedOptimisticUpdate\n  })\n\n  const actualReceivedAction = useConfirmDateAction({\n    config: {\n      field: 'actual_received',\n      confirmMessage: {\n        confirm: '실제 입고 처리를 진행하시겠습니까?',\n        cancel: '실제 입고 처리를 취소하시겠습니까?'\n      },\n      successMessage: {\n        confirm: '실제 입고 처리가 완료되었습니다.',\n        cancel: '실제 입고 처리가 취소되었습니다.'\n      },\n      completedText: '입고완료',\n      waitingText: '입고대기'\n    },\n    currentUserName,\n    canPerformAction: canReceiptCheck,\n    onUpdate: refreshModalData,\n    onOptimisticUpdate: handleActualReceiptOptimisticUpdate\n  })\n  \n  // 날짜 선택 핸들러들\n  \n  // 디버깅용 로그\n  logger.debug('Receipt Check', {\n    activeTab,\n    canReceiptCheck,\n    isAdmin,\n    isRequester,\n    currentUserName,\n    requesterName: purchase?.requester_name,\n    effectiveRoles\n  });\n  \n  // 승인 권한 체크\n const canApproveMiddle = effectiveRoles.includes('middle_manager') || \n                          effectiveRoles.includes('app_admin') || \n                          effectiveRoles.includes('ceo')\n \n const canApproveFinal = effectiveRoles.includes('final_approver') || \n                         effectiveRoles.includes('app_admin') || \n                         effectiveRoles.includes('ceo')\n \n const approvalPillClass = 'inline-flex items-center gap-1 business-radius-badge px-2 py-0.5 badge-text leading-tight'\n const approvalButtonClass = 'inline-flex items-center gap-1 business-radius-badge !h-auto !min-h-0 !px-2.5 !py-0.5 badge-text leading-tight'\n const approvalWaitingPillClass = 'inline-flex items-center gap-1 business-radius-badge px-2.5 py-0.5 badge-text leading-tight'\n \n   // 디버깅 로그\n   logger.debug('PurchaseDetailModal 권한 체크', {\n     currentUserRoles,\n     userRoles,\n     effectiveRoles,\n     canApproveMiddle,\n     canApproveFinal,\n     isEditing,\n     middleManagerStatus: purchase?.middle_manager_status,\n     finalManagerStatus: purchase?.final_manager_status\n   });\n \n  useEffect(() => {\n    if (purchaseId && isOpen) {\n      loadPurchaseDetail(purchaseId.toString())\n      setIsEditing(false) // 모달 열 때마다 편집 모드 초기화\n    }\n  }, [purchaseId, isOpen])\n\n  // 칼럼 너비 계산 (텍스트 길이 기반)\n  const calculateOptimalColumnWidths = useCallback(() => {\n    if (!purchase?.items || purchase.items.length === 0) return []\n\n    const items = purchase.items ?? []\n\n    const columnConfigs = [\n      { key: 'item_name', minWidth: 80, maxWidth: 500, baseWidth: 80 },\n      { key: 'specification', minWidth: 120, maxWidth: 700, baseWidth: 120 },\n      { key: 'quantity', minWidth: 70, maxWidth: 100, baseWidth: 70 },\n      { key: 'unit_price', minWidth: 90, maxWidth: 150, baseWidth: 90 },\n      { key: 'total_price', minWidth: 100, maxWidth: 180, baseWidth: 100 },\n      { key: 'remarks', minWidth: 80, maxWidth: 240, baseWidth: 80 },\n      { key: 'status', minWidth: 80, maxWidth: 120, baseWidth: 80 }\n    ]\n\n    // 추가 칼럼들 (탭별)\n    if (activeTab === 'receipt') {\n      columnConfigs.push({ key: 'actual_receipt_date', minWidth: 100, maxWidth: 160, baseWidth: 100 })\n    }\n    if (activeTab === 'done') {\n      columnConfigs.push(\n        { key: 'transaction_confirm', minWidth: 100, maxWidth: 160, baseWidth: 100 },\n        { key: 'accounting_date', minWidth: 100, maxWidth: 160, baseWidth: 100 },\n        { key: 'processor', minWidth: 80, maxWidth: 120, baseWidth: 80 },\n        { key: 'utk_confirm', minWidth: 80, maxWidth: 120, baseWidth: 80 }\n      )\n    }\n\n    const calculatedWidths = columnConfigs.map((config, index) => {\n      let maxLength = 4 // 최소 4자\n\n      // 헤더 텍스트 길이 고려 (탭별)\n      const getHeaders = () => {\n        const statusHeader = activeTab === 'purchase'\n          ? '구매상태'\n          : (activeTab === 'receipt' || activeTab === 'done')\n          ? '입고상태'\n          : '상태'\n\n        const baseHeaders = ['품목명', '규격', '수량', '단가', '합계', '비고', statusHeader]\n        if (activeTab === 'receipt') {\n          return [...baseHeaders, '실제입고일']\n        } else if (activeTab === 'done') {\n          return [...baseHeaders, '거래명세서 확인', '회계상 입고일', '처리자', 'UTK']\n        }\n        return baseHeaders\n      }\n      \n      const headers = getHeaders()\n      if (headers[index]) {\n        maxLength = Math.max(maxLength, headers[index].length)\n      }\n\n      // 실제 데이터에서 최대 길이 찾기\n      items.forEach(item => {\n        let cellValue = ''\n        switch (config.key) {\n          case 'item_name':\n            cellValue = item.item_name || ''\n            break\n          case 'specification':\n            cellValue = item.specification || ''\n            break\n          case 'quantity':\n            cellValue = item.quantity?.toString() || ''\n            break\n          case 'unit_price':\n            cellValue = item.unit_price_value != null ? item.unit_price_value.toLocaleString() : ''\n            break\n          case 'total_price':\n            if (item.amount_value != null) {\n              cellValue = item.amount_value.toLocaleString()\n            } else if (item.quantity != null && item.unit_price_value != null) {\n              cellValue = (Number(item.quantity) * Number(item.unit_price_value)).toLocaleString()\n            } else {\n              cellValue = ''\n            }\n            break\n          case 'remarks':\n            cellValue = item.remark || ''\n            break\n          case 'status':\n            cellValue = getStatusDisplay(item) || ''\n            break\n          case 'actual_receipt_date':\n            cellValue = item.actual_received_date ? formatDate(item.actual_received_date) : ''\n            break\n          case 'transaction_confirm':\n            cellValue = item.is_statement_received ? '확인완료' : '미확인'\n            break\n          case 'accounting_date':\n            cellValue = item.statement_received_date ? formatDate(item.statement_received_date) : ''\n            break\n          case 'processor':\n            cellValue = item.statement_received_by_name || ''\n            break\n          case 'utk_confirm':\n            cellValue = item.is_utk_checked ? '완료' : '대기'\n            break\n        }\n        \n        // 한글/영문 혼합 텍스트 길이 계산 (한글은 1.5배 가중치)\n        const adjustedLength = cellValue.split('').reduce((acc, char) => {\n          return acc + (/[가-힣]/.test(char) ? 1.5 : 1)\n        }, 0)\n        \n        maxLength = Math.max(maxLength, Math.ceil(adjustedLength))\n      })\n\n      // 길이를 픽셀로 변환 (글자당 약 7px + 여백 20px)\n      const calculatedWidth = Math.max(\n        config.minWidth,\n        Math.min(config.maxWidth, maxLength * 7 + 20)\n      )\n\n      logger.debug(`Column ${config.key} calculated:`, { \n        maxLength, \n        calculatedWidth, \n        range: `${config.minWidth}-${config.maxWidth}px` \n      })\n\n      return calculatedWidth\n    })\n\n    setColumnWidths(calculatedWidths)\n    logger.debug('Optimal column widths calculated', { calculatedWidths })\n    return calculatedWidths\n  }, [purchase, activeTab])\n\n  // 상태 표시 텍스트 반환 함수\n  const getStatusDisplay = (item: any) => {\n    if (activeTab === 'purchase') {\n      return item.purchase_status === 'ordered' ? '발주' : '구매요청'\n    } else if (activeTab === 'receipt') {\n      return item.receipt_status === 'received' ? '입고' : '입고대기'\n    }\n    return item.purchase_status === 'ordered' ? '발주' : '구매요청'\n  }\n\n  // 동적 gridTemplateColumns 생성\n  const getGridTemplateColumns = () => {\n    if (columnWidths.length > 0) {\n      return columnWidths.map(width => `${width}px`).join(' ')\n    }\n    \n    // 기본값 (데이터 로드 전)\n    const baseColumns = ['80px', '120px', '70px', '90px', '100px', '80px', '80px']\n    \n    // 탭별 추가 칼럼\n    if (activeTab === 'receipt') {\n      return [...baseColumns, '100px'].join(' ')\n    } else if (activeTab === 'done') {\n      return [...baseColumns, '100px', '100px', '80px', '80px'].join(' ')\n    }\n    \n    return baseColumns.join(' ')\n  }\n\n  // 레거시 measureColumnWidths 함수 (호환성 유지)\n  const measureColumnWidths = () => {\n    calculateOptimalColumnWidths()\n  }\n\n  // View 모드에서 칼럼 너비 계산 (데이터 로드 후)\n  useEffect(() => {\n    if (purchase && purchase.items && purchase.items.length > 0 && !isEditing) {\n      // 즉시 계산 (DOM 측정 불필요)\n      calculateOptimalColumnWidths()\n    }\n  }, [purchase, isEditing, activeTab, calculateOptimalColumnWidths])\n\n  // Edit 모드 전환 시 너비 계산\n  const handleEditToggle = (editing: boolean) => {\n    if (editing && !isEditing) {\n      // Edit 모드로 전환하기 전에 현재 너비 계산\n      calculateOptimalColumnWidths()\n    }\n    setIsEditing(editing)\n  }\n\n  const loadPurchaseDetail = async (id: string) => {\n    try {\n      setLoading(true)\n      const supabase = createClient()\n      \n      const { data, error } = await supabase\n        .from('purchase_requests')\n        .select(`\n          *,\n          vendors(id, vendor_name),\n          purchase_request_items(*)\n        `)\n        .eq('id', id)\n        .single()\n\n      if (error) throw error\n\n      if (data) {\n        // 라인넘버 순서대로 정렬\n        const sortedItems = (data.purchase_request_items || []).sort((a: any, b: any) => {\n          const lineA = a.line_number || 999999;\n          const lineB = b.line_number || 999999;\n          return lineA - lineB;\n        });\n\n        const purchaseData = {\n          ...data,\n          items: sortedItems,\n          vendor: data.vendors || { id: 0, vendor_name: '알 수 없음' },\n          vendor_contacts: []\n        } as PurchaseRequestWithDetails\n        setPurchase(purchaseData)\n        setEditedPurchase(purchaseData)\n        setEditedItems(sortedItems)\n      }\n    } catch (error) {\n      toast.error('발주 상세 정보를 불러오는데 실패했습니다.')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const getStatusBadge = () => {\n    if (!purchase) return null\n    \n    // payment_category 우선 확인\n    if (purchase.payment_category) {\n      const category = purchase.payment_category.trim()\n      \n      if (category === '발주') {\n        return <Badge variant={null} className=\"badge-success\">발주</Badge>\n      } else if (category === '구매요청') {\n        return <Badge variant={null} className=\"badge-primary\">구매요청</Badge>\n      } else if (category === '현장결제') {\n        return <Badge variant={null} className=\"badge-secondary\">현장결제</Badge>\n      } else {\n        // payment_category 값이 있지만 알려진 값이 아닌 경우\n        return <Badge variant={null} className=\"badge-primary\">{category}</Badge>\n      }\n    }\n    \n    // payment_category가 없으면 기본값\n    return <Badge variant={null} className=\"badge-primary\">구매요청</Badge>\n  }\n\n  // formatDate는 utils/helpers.ts에서 import\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat('ko-KR').format(amount)\n  }\n\n  const handleSave = async () => {\n    if (!purchase || !editedPurchase) {\n      toast.error('저장할 데이터가 없습니다.')\n      return\n    }\n    \n    try {\n      logger.debug('저장 시작', { \n        purchaseId: purchase.id, \n        editedItemsCount: editedItems.length,\n        deletedItemsCount: deletedItemIds.length \n      });\n      \n      // 발주 기본 정보 업데이트\n      const totalAmount = editedItems.reduce((sum, item) => sum + (item.amount_value || 0), 0)\n      logger.debug('계산된 총액', { totalAmount });\n      \n      const { error: updateError } = await supabase\n        .from('purchase_requests')\n        .update({\n          purchase_order_number: editedPurchase.purchase_order_number || null,\n          requester_name: editedPurchase.requester_name || null,\n          delivery_request_date: editedPurchase.delivery_request_date || null,\n          revised_delivery_request_date: editedPurchase.revised_delivery_request_date || null,\n          payment_category: editedPurchase.payment_category || null,\n          project_vendor: editedPurchase.project_vendor || null,\n          total_amount: Number(totalAmount),\n          updated_at: new Date().toISOString()\n        })\n        .eq('id', purchase.id)\n\n      if (updateError) throw updateError\n\n      // 삭제된 항목들 처리\n      if (deletedItemIds.length > 0) {\n        const { error: deleteError } = await supabase\n          .from('purchase_request_items')\n          .delete()\n          .in('id', deletedItemIds)\n\n        if (deleteError) throw deleteError\n      }\n\n      // 각 아이템 업데이트 또는 생성\n      logger.debug('저장할 editedItems', { count: editedItems.length });\n      \n      for (const item of editedItems) {\n        logger.debug('처리 중인 item', { \n          itemId: item.id, \n          itemName: item.item_name,\n          quantity: item.quantity,\n          unitPrice: item.unit_price_value,\n          amount: item.amount_value\n        });\n        \n        // 필수 필드 검증\n        if (!item.item_name || !item.item_name.trim()) {\n          throw new Error('품목명은 필수입니다.');\n        }\n        if (!item.quantity || item.quantity <= 0) {\n          throw new Error('수량은 0보다 커야 합니다.');\n        }\n        if (item.unit_price_value !== null && item.unit_price_value !== undefined && item.unit_price_value < 0) {\n          throw new Error('단가는 0 이상이어야 합니다.');\n        }\n        if (item.amount_value !== null && item.amount_value !== undefined && item.amount_value < 0) {\n          throw new Error('합계는 0 이상이어야 합니다.');\n        }\n        \n        if (item.id) {\n          // 기존 항목 업데이트\n          logger.debug('기존 항목 업데이트', { itemId: item.id });\n          const { error } = await supabase\n            .from('purchase_request_items')\n            .update({\n              item_name: item.item_name.trim(),\n              specification: item.specification || null,\n              quantity: Number(item.quantity),\n              unit_price_value: Number(item.unit_price_value),\n              unit_price_currency: purchase.currency || 'KRW',\n              amount_value: Number(item.amount_value),\n              amount_currency: purchase.currency || 'KRW',\n              remark: item.remark || null,\n              updated_at: new Date().toISOString()\n            })\n            .eq('id', item.id)\n\n          if (error) {\n            logger.error('기존 항목 업데이트 오류', error);\n            throw error;\n          }\n        } else {\n          // 새 항목 생성\n          logger.debug('새 항목 생성', { itemName: item.item_name });\n          const insertData = {\n            purchase_request_id: purchase.id,\n            item_name: item.item_name.trim(),\n            specification: item.specification || null,\n            quantity: Number(item.quantity),\n            unit_price_value: Number(item.unit_price_value),\n            unit_price_currency: purchase.currency || 'KRW',\n            amount_value: Number(item.amount_value),\n            amount_currency: purchase.currency || 'KRW',\n            remark: item.remark || null,\n            line_number: item.line_number || editedItems.indexOf(item) + 1,\n            created_at: new Date().toISOString()\n          };\n          logger.debug('삽입할 데이터', { itemName: insertData.item_name });\n          \n          const { error } = await supabase\n            .from('purchase_request_items')\n            .insert(insertData)\n\n          if (error) {\n            logger.error('새 항목 생성 오류', error);\n            throw error;\n          } else {\n            logger.debug('새 항목 생성 성공');\n          }\n        }\n      }\n\n      logger.debug('저장 완료');\n      toast.success('발주 내역이 성공적으로 저장되었습니다.')\n      handleEditToggle(false)\n      setDeletedItemIds([])\n      \n      // 수정된 데이터 다시 로드 (모달은 열린 상태 유지)\n      await loadPurchaseDetail(purchaseId?.toString() || '')\n\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      logger.error('저장 중 전체 오류', error);\n      const errorMessage = error instanceof Error ? error.message : '알 수 없는 오류가 발생했습니다'\n      toast.error(`저장 실패: ${errorMessage}`)\n    }\n  }\n\n  const handleItemChange = (index: number, field: string, value: any) => {\n    const newItems = [...editedItems]\n    \n    if (field === 'amount_value') {\n      // 금액을 직접 수정한 경우\n      newItems[index] = {\n        ...newItems[index],\n        amount_value: value\n      }\n    } else if (field === 'quantity' || field === 'unit_price_value') {\n      // 수량이나 단가를 수정한 경우 금액 자동 계산\n      const quantity = field === 'quantity' ? value : newItems[index].quantity\n      const unitPrice = field === 'unit_price_value' ? value : newItems[index].unit_price_value\n      newItems[index] = {\n        ...newItems[index],\n        [field]: value,\n        amount_value: quantity * unitPrice\n      }\n    } else {\n      // 기타 필드 수정\n      newItems[index] = {\n        ...newItems[index],\n        [field]: value\n      }\n    }\n    \n    setEditedItems(newItems)\n  }\n\n  const handleAddItem = () => {\n    // 현재 최대 라인넘버 찾기\n    const maxLineNumber = editedItems.reduce((max, item) => {\n      const lineNum = item.line_number || 0;\n      return lineNum > max ? lineNum : max;\n    }, 0);\n\n    const newItem = {\n      item_name: '',\n      specification: '',\n      quantity: 1,\n      unit_price_value: 0,\n      amount_value: 0,\n      remark: '',\n      line_number: maxLineNumber + 1\n    }\n    \n    // 새 아이템 추가 후 라인넘버 순서대로 정렬\n    const newItems = [...editedItems, newItem].sort((a, b) => {\n      const lineA = a.line_number || 999999;\n      const lineB = b.line_number || 999999;\n      return lineA - lineB;\n    });\n    \n    setEditedItems(newItems)\n  }\n\n  const handleRemoveItem = (index: number) => {\n    const item = editedItems[index]\n    if (item.id) {\n      setDeletedItemIds([...deletedItemIds, item.id])\n    }\n    const newItems = editedItems.filter((_, i) => i !== index).sort((a, b) => {\n      const lineA = a.line_number || 999999;\n      const lineB = b.line_number || 999999;\n      return lineA - lineB;\n    });\n    setEditedItems(newItems)\n  }\n\n  // 구매완료 처리 함수\n  const handlePaymentToggle = async (itemId: number | string, isCompleted: boolean) => {\n    if (!canPurchase) {\n      toast.error('구매완료 처리 권한이 없습니다.')\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      toast.error('유효하지 않은 항목 ID 입니다.')\n      return\n    }\n\n    // 해당 품목 정보 찾기\n    const targetItem = purchase?.items?.find(item => String(item.id) === itemIdStr)\n    if (!targetItem) return\n\n    const itemInfo = `품명: ${targetItem.item_name}\n규격: ${targetItem.specification || '미입력'}\n수량: ${targetItem.quantity?.toLocaleString() || 0}${targetItem.unit || ''}\n단가: ₩${targetItem.unit_price_value?.toLocaleString() || 0}\n합계: ₩${targetItem.amount_value?.toLocaleString() || 0}`\n\n    const confirmMessage = isCompleted \n      ? `다음 품목을 구매완료 처리하시겠습니까?\\n\\n${itemInfo}` \n      : `다음 품목의 구매완료를 취소하시겠습니까?\\n\\n${itemInfo}`\n    \n    const confirm = window.confirm(confirmMessage)\n    if (!confirm) return\n\n    try {\n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_payment_completed: isCompleted,\n          payment_completed_at: isCompleted ? new Date().toISOString() : null\n        })\n        .eq('id', numericId)\n\n      if (error) throw error\n\n      // 로컬 상태 즉시 업데이트 (UI 즉시 반영)\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          String(item.id) === itemIdStr \n            ? { ...item, is_payment_completed: isCompleted, payment_completed_at: isCompleted ? new Date().toISOString() : null }\n            : item\n        )\n        return { ...prev, items: updatedItems }\n      })\n\n      if (purchase) {\n        const purchaseIdNumber = Number(purchase.id)\n        if (!Number.isNaN(purchaseIdNumber)) {\n          onOptimisticUpdate?.(purchaseIdNumber, prev => {\n            const updatedItems = (prev.items || []).map(item =>\n              String(item.id) === itemIdStr\n                ? { ...item, is_payment_completed: isCompleted }\n                : item\n            )\n            const total = updatedItems.length || prev.items?.length || 0\n            const completed = updatedItems.filter(item => item.is_payment_completed).length\n            const allCompleted = total > 0 && completed === total\n            return {\n              ...prev,\n              items: updatedItems,\n              is_payment_completed: allCompleted,\n              payment_completed_at: allCompleted ? new Date().toISOString() : null,\n              payment_completed_by_name: allCompleted ? (currentUserName || prev.payment_completed_by_name) : prev.payment_completed_by_name\n            }\n          })\n        }\n      }\n      \n      toast.success(isCompleted ? '구매완료 처리되었습니다.' : '구매완료가 취소되었습니다.')\n\n      // 상세 모달 및 상위 리스트 모두 최신 상태로 동기화\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      toast.error('구매완료 처리 중 오류가 발생했습니다.')\n    }\n  }\n\n  // 개별 품목 입고완료 처리 (날짜 선택)\n  const handleItemReceiptToggle = async (itemId: number | string, selectedDate: Date) => {\n    if (!canReceiptCheck) {\n      toast.error('입고 처리 권한이 없습니다.')\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      toast.error('유효하지 않은 항목 ID 입니다.')\n      return\n    }\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item =>\n            String(item.id) === itemIdStr\n              ? {\n                  ...item,\n                  is_received: true,\n                  actual_received_date: selectedDate.toISOString()\n                }\n              : item\n          )\n          const total = updatedItems.length || prev.items?.length || 0\n          const completed = updatedItems.filter(item => item.is_received).length\n          const allReceived = total > 0 && completed === total\n\n          return {\n            ...prev,\n            items: updatedItems,\n            is_received: allReceived,\n            received_at: allReceived ? new Date().toISOString() : prev.received_at\n          }\n        })\n      }\n    }\n\n    try {\n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_received: true,\n          received_at: new Date().toISOString(),\n          actual_received_date: selectedDate.toISOString()\n        })\n        .eq('id', numericId)\n\n      if (error) throw error\n\n      // 로컬 상태 즉시 업데이트\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          String(item.id) === itemIdStr \n            ? { \n                ...item, \n                is_received: true, \n                received_at: new Date().toISOString(),\n                actual_received_date: selectedDate.toISOString()\n              }\n            : item\n        )\n        return { ...prev, items: updatedItems }\n      })\n\n      applyOptimisticUpdate()\n      \n      const targetItem = purchase?.items?.find(item => String(item.id) === itemIdStr)\n      toast.success(`\"${targetItem?.item_name}\" 품목이 입고완료 처리되었습니다.`)\n\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n\n      applyOptimisticUpdate()\n    } catch (error) {\n      toast.error('입고완료 처리 중 오류가 발생했습니다.')\n    }\n  }\n\n  // 입고완료 취소 처리\n  const handleReceiptCancel = async (itemId: number | string) => {\n    if (!canReceiptCheck) {\n      toast.error('입고 처리 권한이 없습니다.')\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      toast.error('유효하지 않은 항목 ID 입니다.')\n      return\n    }\n\n    const targetItem = purchase?.items?.find(item => String(item.id) === itemIdStr)\n    if (!targetItem) return\n\n    const confirm = window.confirm(`\"${targetItem.item_name}\" 품목의 입고완료를 취소하시겠습니까?`)\n    if (!confirm) return\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item =>\n            String(item.id) === itemIdStr\n              ? {\n                  ...item,\n                  is_received: false,\n                  actual_received_date: undefined\n                }\n              : item\n          )\n          const total = updatedItems.length || prev.items?.length || 0\n          const completed = updatedItems.filter(item => item.is_received).length\n          const allReceived = total > 0 && completed === total\n\n          return {\n            ...prev,\n            items: updatedItems,\n            is_received: allReceived,\n            received_at: allReceived ? prev.received_at : null\n          }\n        })\n      }\n    }\n\n    try {\n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_received: false,\n          received_at: null,\n          actual_received_date: null,\n          actual_received_by_name: null\n        })\n        .eq('id', numericId)\n\n      if (error) throw error\n\n      // 로컬 상태 즉시 업데이트\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          String(item.id) === itemIdStr \n            ? { ...item, is_received: false, received_at: null, actual_received_date: undefined, actual_received_by_name: undefined }\n            : item\n        )\n        return { ...prev, items: updatedItems }\n      })\n      \n      applyOptimisticUpdate()\n\n      toast.success('입고완료가 취소되었습니다.')\n\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n\n      applyOptimisticUpdate()\n    } catch (error) {\n      toast.error('입고완료 취소 중 오류가 발생했습니다.')\n    }\n  }\n\n\n  // 승인 처리\n  const handleApprove = async (type: 'middle' | 'final') => {\n    if (!purchase) return\n    \n    const approvalType = type === 'middle' ? '1차 승인' : '최종 승인'\n    const confirmMessage = `발주번호: ${purchase.purchase_order_number}\\n\\n${approvalType}을 진행하시겠습니까?`\n    const confirm = window.confirm(confirmMessage)\n    if (!confirm) return\n    \n    try {\n      const updateData = type === 'middle' \n        ? { \n            middle_manager_status: 'approved'\n          }\n        : { \n            final_manager_status: 'approved'\n          }\n      \n      const { error } = await supabase\n        .from('purchase_requests')\n        .update(updateData)\n        .eq('id', purchase.id)\n      \n      if (error) {\n        throw error\n      }\n      \n      // 로컬 상태 즉시 업데이트 (UI 즉시 반영)\n      if (type === 'middle') {\n        setPurchase(prev => prev ? { ...prev, middle_manager_status: 'approved' } : null)\n      } else {\n        setPurchase(prev => prev ? { ...prev, final_manager_status: 'approved' } : null)\n      }\n      \n      toast.success(`${type === 'middle' ? '중간' : '최종'} 승인이 완료되었습니다.`)\n    } catch (error) {\n      toast.error('승인 처리 중 오류가 발생했습니다.')\n    }\n  }\n  \n  // 전체 구매완료 처리\n  const handleCompleteAllPayment = async () => {\n    if (!purchase || !canPurchase) return\n    \n    const confirmMessage = `발주번호: ${purchase.purchase_order_number}\\n\\n모든 품목을 구매완료 처리하시겠습니까?`\n    const confirm = window.confirm(confirmMessage)\n    if (!confirm) return\n    \n    try {\n      const updateData = {\n        is_payment_completed: true,\n        payment_completed_at: new Date().toISOString()\n      }\n      \n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update(updateData)\n        .eq('purchase_request_id', purchase.id)\n        .eq('is_payment_completed', false) // 아직 구매완료되지 않은 항목만\n      \n      if (error) throw error\n      \n      // 로컬 상태 즉시 업데이트 (UI 즉시 반영)\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          !item.is_payment_completed \n            ? { ...item, is_payment_completed: true, payment_completed_at: new Date().toISOString() }\n            : item\n        )\n        return { ...prev, items: updatedItems }\n      })\n\n      if (purchase) {\n        const purchaseIdNumber = Number(purchase.id)\n        if (!Number.isNaN(purchaseIdNumber)) {\n          onOptimisticUpdate?.(purchaseIdNumber, prev => {\n            const updatedItems = (prev.items || []).map(item => ({\n              ...item,\n              is_payment_completed: true\n            }))\n            return {\n              ...prev,\n              items: updatedItems,\n              is_payment_completed: true,\n              payment_completed_at: new Date().toISOString(),\n              payment_completed_by_name: currentUserName || prev.payment_completed_by_name\n            }\n          })\n        }\n      }\n      \n      toast.success('모든 품목이 구매완료 처리되었습니다.')\n\n      // 상세 모달 및 리스트 모두 새로고침\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      logger.error('전체 구매완료 처리 오류', error);\n      toast.error('구매완료 처리 중 오류가 발생했습니다.')\n    }\n  }\n\n  // UTK 확인 처리 함수\n  const handleUtkToggle = async (itemId: number | string, isChecked: boolean) => {\n    if (!canReceiptCheck) {\n      toast.error('UTK 확인 처리 권한이 없습니다.')\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      toast.error('유효하지 않은 항목 ID 입니다.')\n      return\n    }\n\n    // 해당 품목 정보 찾기\n    const targetItem = purchase?.items?.find(item => String(item.id) === itemIdStr)\n    if (!targetItem) return\n\n    const itemInfo = `품명: ${targetItem.item_name}\n규격: ${targetItem.specification || '미입력'}\n수량: ${targetItem.quantity?.toLocaleString() || 0}${targetItem.unit || ''}\n단가: ₩${targetItem.unit_price_value?.toLocaleString() || 0}\n합계: ₩${targetItem.amount_value?.toLocaleString() || 0}`\n\n    const confirmMessage = isChecked \n      ? `다음 품목을 UTK 확인 처리하시겠습니까?\\n\\n${itemInfo}` \n      : `다음 품목의 UTK 확인을 취소하시겠습니까?\\n\\n${itemInfo}`\n    \n    const confirm = window.confirm(confirmMessage)\n    if (!confirm) return\n\n    try {\n      const supabase = createClient()\n      logger.debug('UTK 확인 처리 시작', { itemId: numericId, isChecked, itemIdStr })\n      \n      const { data, error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_utk_checked: isChecked\n        })\n        .eq('id', numericId)\n        .select()\n\n      if (error) {\n        logger.error('UTK 확인 DB 업데이트 실패', { error, itemId: numericId, isChecked })\n        throw error\n      }\n      \n      logger.debug('UTK 확인 DB 업데이트 성공', { data })\n\n      // 로컬 상태 즉시 업데이트 (UI 즉시 반영)\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          String(item.id) === itemIdStr \n            ? { ...item, is_utk_checked: isChecked }\n            : item\n        )\n        return { ...prev, items: updatedItems }\n      })\n\n      if (purchase) {\n        const purchaseIdNumber = Number(purchase.id)\n        if (!Number.isNaN(purchaseIdNumber)) {\n          onOptimisticUpdate?.(purchaseIdNumber, prev => {\n            const updatedItems = (prev.items || []).map(item =>\n              String(item.id) === itemIdStr\n                ? { ...item, is_utk_checked: isChecked }\n                : item\n            )\n            const total = updatedItems.length || prev.items?.length || 0\n            const checked = updatedItems.filter(item => item.is_utk_checked).length\n            const allChecked = total > 0 && checked === total\n            return {\n              ...prev,\n              items: updatedItems,\n              is_utk_checked: allChecked\n            }\n          })\n        }\n      }\n\n      // 모든 품목이 확인되면 purchase_requests에도 업데이트\n      const allChecked = purchase?.items?.every(item => {\n        if (String(item.id) === itemIdStr) {\n          return isChecked\n        }\n        return item.is_utk_checked === true\n      })\n\n      if (allChecked !== undefined && purchase) {\n        logger.debug('purchase_requests 업데이트 시작', { purchaseId: purchase.id, allChecked })\n        const { error: updateError } = await supabase\n          .from('purchase_requests')\n          .update({ is_utk_checked: allChecked })\n          .eq('id', purchase.id)\n          .select()\n        \n        if (updateError) {\n          logger.error('purchase_requests 업데이트 실패', { error: updateError, purchaseId: purchase.id, allChecked })\n        } else {\n          logger.debug('purchase_requests 업데이트 성공', { purchaseId: purchase.id, allChecked })\n        }\n      }\n      \n      toast.success(isChecked ? 'UTK 확인이 완료되었습니다.' : 'UTK 확인이 취소되었습니다.')\n\n      // 상세 모달 및 상위 리스트 모두 최신 상태로 동기화\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      logger.error('UTK 확인 처리 중 오류', error)\n      toast.error('UTK 확인 처리 중 오류가 발생했습니다.')\n    }\n  }\n\n  // 전체 UTK 확인 처리\n  const handleCompleteAllUtk = async () => {\n    if (!purchase || !canReceiptCheck) return\n    \n    const confirmMessage = `발주번호: ${purchase.purchase_order_number}\\n\\n모든 품목을 UTK 확인 처리하시겠습니까?`\n    const confirm = window.confirm(confirmMessage)\n    if (!confirm) return\n    \n    try {\n      const supabase = createClient()\n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_utk_checked: true\n        })\n        .eq('purchase_request_id', purchase.id)\n        .eq('is_utk_checked', false) // 아직 확인되지 않은 항목만\n      \n      if (error) throw error\n\n      // purchase_requests도 업데이트\n      await supabase\n        .from('purchase_requests')\n        .update({ is_utk_checked: true })\n        .eq('id', purchase.id)\n      \n      // 로컬 상태 즉시 업데이트 (UI 즉시 반영)\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          !item.is_utk_checked \n            ? { ...item, is_utk_checked: true }\n            : item\n        )\n        return { \n          ...prev, \n          items: updatedItems,\n          is_utk_checked: true\n        }\n      })\n\n      if (purchase) {\n        const purchaseIdNumber = Number(purchase.id)\n        if (!Number.isNaN(purchaseIdNumber)) {\n          onOptimisticUpdate?.(purchaseIdNumber, prev => {\n            const updatedItems = (prev.items || []).map(item => ({\n              ...item,\n              is_utk_checked: true\n            }))\n            return {\n              ...prev,\n              items: updatedItems,\n              is_utk_checked: true\n            }\n          })\n        }\n      }\n      \n      toast.success('모든 품목의 UTK 확인이 완료되었습니다.')\n\n      // 상세 모달 및 리스트 모두 새로고침\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      logger.error('전체 UTK 확인 처리 오류', error);\n      toast.error('UTK 확인 처리 중 오류가 발생했습니다.')\n    }\n  }\n\n  // 전체 거래명세서 확인 처리 (날짜 선택)\n  const handleCompleteAllStatement = async (selectedDate: Date) => {\n    if (!purchase || !canReceiptCheck) {\n      return\n    }\n\n    const formattedDate = selectedDate.toLocaleDateString('ko-KR', {\n      year: 'numeric',\n      month: '2-digit',\n      day: '2-digit'\n    })\n\n    const confirmMessage = `발주번호: ${purchase.purchase_order_number}\n\n모든 품목의 회계상 입고일을 ${formattedDate}로 등록하시겠습니까?`\n    \n    if (!window.confirm(confirmMessage)) {\n      return\n    }\n\n    const selectedDateIso = selectedDate.toISOString()\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    try {\n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_statement_received: true,\n          statement_received_date: selectedDateIso,\n          statement_received_by_name: currentUserName || null\n        })\n        .eq('purchase_request_id', purchase.id)\n        .eq('is_statement_received', false) // 아직 확인되지 않은 항목만\n      \n      if (error) throw error\n\n      // purchase_requests도 업데이트\n      await supabase\n        .from('purchase_requests')\n        .update({ \n          is_statement_received: true,\n          statement_received_at: selectedDateIso\n        })\n        .eq('id', purchase.id)\n\n      // 로컬 상태 즉시 업데이트\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          !item.is_statement_received \n            ? { \n                ...item, \n                is_statement_received: true,\n                statement_received_date: selectedDateIso,\n                statement_received_by_name: currentUserName || null\n              }\n            : item\n        )\n        const allCompleted = updatedItems && updatedItems.length > 0 && updatedItems.every(item => item.is_statement_received)\n        return { \n          ...prev, \n          items: updatedItems,\n          is_statement_received: allCompleted,\n          statement_received_at: allCompleted ? selectedDateIso : prev.statement_received_at\n        }\n      })\n\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item => ({\n            ...item,\n            is_statement_received: true,\n            statement_received_date: item.statement_received_date || selectedDateIso,\n            statement_received_by_name: item.statement_received_by_name || currentUserName || null\n          }))\n          return {\n            ...prev,\n            items: updatedItems,\n            is_statement_received: true,\n            statement_received_at: selectedDateIso\n          }\n        })\n      }\n\n      toast.success('모든 품목의 회계상 입고일이 등록되었습니다.')\n\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      logger.error('전체 거래명세서 확인 처리 오류', error)\n      toast.error('거래명세서 확인 처리 중 오류가 발생했습니다.')\n    }\n  }\n\n  // 전체 입고완료 처리 (날짜 선택)\n  const handleCompleteAllReceipt = async (selectedDate: Date) => {\n    if (!purchase || !canReceiveItems) {\n      return\n    }\n\n    // 확인 다이얼로그 표시\n    const confirmMessage = `발주번호: ${purchase.purchase_order_number}\n\n전체 입고완료 처리하시겠습니까?`\n    \n    if (!window.confirm(confirmMessage)) {\n      return\n    }\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item => ({\n            ...item,\n            is_received: true,\n            actual_received_date: item.actual_received_date || selectedDate.toISOString()\n          }))\n\n          return {\n            ...prev,\n            items: updatedItems,\n            is_received: true,\n            received_at: new Date().toISOString()\n          }\n        })\n      }\n    }\n\n    try {\n      const updateData = {\n        is_received: true,\n        received_at: new Date().toISOString(),\n        actual_received_date: selectedDate.toISOString()\n      }\n      \n\n      const { data, error } = await supabase\n        .from('purchase_request_items')\n        .update(updateData)\n        .eq('purchase_request_id', purchase.id)\n        .is('actual_received_date', null) // 아직 실제 입고되지 않은 항목만\n        .select()\n\n\n      if (error) throw error\n\n      // 로컬 상태 즉시 업데이트\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          !item.actual_received_date \n            ? { \n                ...item, \n                is_received: true, \n                received_at: new Date().toISOString(),\n                actual_received_date: selectedDate.toISOString()\n              }\n            : item\n        )\n        return { ...prev, items: updatedItems }\n      })\n\n      applyOptimisticUpdate()\n\n      toast.success('모든 품목이 입고완료 처리되었습니다.')\n\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n\n      applyOptimisticUpdate()\n    } catch (error) {\n      logger.error('전체 입고완료 처리 오류', error)\n      toast.error('입고완료 처리 중 오류가 발생했습니다.')\n    }\n  }\n  \n\n  // 반려 처리\n  const handleReject = async (type: 'middle' | 'final') => {\n    if (!purchase) return\n    \n    const reason = window.prompt('반려 사유를 입력해주세요:')\n    if (!reason) return\n    \n    try {\n      const updateData = type === 'middle'\n        ? {\n            middle_manager_status: 'rejected'\n          }\n        : {\n            final_manager_status: 'rejected'\n          }\n      \n      const { error } = await supabase\n        .from('purchase_requests')\n        .update(updateData)\n        .eq('id', purchase.id)\n      \n      if (error) {\n        throw error\n      }\n      \n      // 로컬 상태 즉시 업데이트 (UI 즉시 반영)\n      if (type === 'middle') {\n        setPurchase(prev => prev ? { ...prev, middle_manager_status: 'rejected' } : null)\n      } else {\n        setPurchase(prev => prev ? { ...prev, final_manager_status: 'rejected' } : null)\n      }\n      \n      toast.success(`${type === 'middle' ? '중간' : '최종'} 반려가 완료되었습니다.`)\n    } catch (error) {\n      toast.error('반려 처리 중 오류가 발생했습니다.')\n    }\n  }\n\n  const content = (\n    <div className=\"space-y-1 sm:space-y-4\">\n      {loading ? (\n        <div className=\"flex items-center justify-center py-12\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-hansl-600\"></div>\n        </div>\n      ) : purchase ? (\n        <div>\n          {/* Compact Info Header */}\n          <div className=\"bg-gray-50 rounded-lg p-2 sm:p-3 mb-1 sm:mb-2 border border-gray-100\">\n            <div className=\"grid grid-cols-1 sm:grid-cols-3 items-center gap-3 sm:gap-0\">\n              <div className=\"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-4\">\n                <div className=\"flex items-center gap-3\">\n                  {getStatusBadge()}\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"modal-label\">요청자:</span>\n                    <span className=\"modal-value\">{purchase.requester_name}</span>\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Calendar className=\"w-3 h-3 text-gray-500\" />\n                  <span className=\"modal-subtitle\">청구일: {formatDate(purchase.request_date)}</span>\n                </div>\n              </div>\n              \n              {/* 승인 버튼들을 중앙에 배치 */}\n              <div className=\"flex items-center justify-center gap-2 sm:gap-3 flex-wrap\">\n                {/* 1차 승인 버튼 */}\n                {canApproveMiddle && purchase.middle_manager_status === 'pending' && (\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => handleApprove('middle')}\n                    className={`${approvalButtonClass} border border-gray-400 bg-white hover:bg-gray-50 hover:border-gray-500`}\n                  >\n                    1차 승인 대기\n                  </Button>\n                )}\n                {purchase.middle_manager_status === 'approved' && (\n                  <div className=\"button-approved badge-text shadow-sm\">\n                    <Check className=\"w-3 h-3\" />\n                    1차 승인완료\n                  </div>\n                )}\n                {purchase.middle_manager_status === 'rejected' && (\n                  <div className=\"button-rejected badge-text\">\n                    <X className=\"w-3 h-3\" />\n                    1차 반려\n                  </div>\n                )}\n                {purchase.middle_manager_status === 'pending' && !canApproveMiddle && (\n                  <div className={`${approvalWaitingPillClass} border border-gray-300 text-gray-600 bg-white`}>\n                    1차 승인대기\n                  </div>\n                )}\n\n                {/* 최종 승인 버튼 */}\n                {canApproveFinal && purchase.middle_manager_status === 'approved' && purchase.final_manager_status === 'pending' && (\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => handleApprove('final')}\n                    className={`${approvalButtonClass} border border-gray-400 bg-white hover:bg-gray-50 hover:border-gray-500`}\n                  >\n                    <Check className=\"w-3 h-3\" />\n                    최종 승인\n                  </Button>\n                )}\n                {purchase.final_manager_status === 'approved' && (\n                  <div className=\"button-approved badge-text\">\n                    <Check className=\"w-3 h-3\" />\n                    최종 승인완료\n                  </div>\n                )}\n                {purchase.final_manager_status === 'rejected' && (\n                  <div className=\"button-rejected badge-text\">\n                    <X className=\"w-3 h-3\" />\n                    최종 반려\n                  </div>\n                )}\n                {purchase.middle_manager_status !== 'approved' && purchase.final_manager_status === 'pending' && (\n                  <div className={`${approvalWaitingPillClass} border border-gray-300 text-gray-600 bg-white`}>\n                    최종 승인대기\n                  </div>\n                )}\n              </div>\n              \n              {/* 우측 빈 영역 */}\n              <div></div>\n            </div>\n          </div>\n\n          {/* Main 2-Column Layout */}\n          <div className=\"flex flex-col lg:flex-row gap-3 sm:gap-6\">\n            {/* Left Column - Basic Info (Fixed Width) */}\n            <div className=\"lg:w-80 lg:flex-shrink-0 space-y-1 sm:space-y-4 relative\">\n              \n              {/* 발주 기본정보 */}\n              <div className=\"bg-white rounded-lg p-2 sm:p-3 border border-gray-100 shadow-sm\">\n                <div className=\"mb-3\">\n                  <h3 className=\"modal-section-title flex items-center\">\n                    <FileText className=\"w-4 h-4 mr-2 text-gray-600\" />\n                    {purchase?.purchase_order_number || 'PO번호 없음'}\n                  </h3>\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">발주서 종류</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.request_type || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, request_type: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"일반\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.request_type || '일반'}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">결제 종류</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.payment_category || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, payment_category: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"발주/구매요청/현장결제\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.payment_category || '-'}</p>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">입고 요청일</span>\n                      {isEditing ? (\n                        <DatePickerPopover\n                          onDateSelect={(date) => {\n                            setEditedPurchase(prev => prev ? {\n                              ...prev,\n                              delivery_request_date: formatDateInput(date, 'yyyy-MM-dd')\n                            } : null)\n                          }}\n                          placeholder=\"입고 요청일을 선택하세요\"\n                          align=\"start\"\n                          side=\"bottom\"\n                        >\n                          <Button\n                            variant=\"outline\"\n                            className=\"mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] justify-start text-left font-normal business-radius-input\"\n                          >\n                            <Calendar className=\"mr-1 h-3 w-3\" />\n                            {editedPurchase?.delivery_request_date ? \n                              formatDate(editedPurchase.delivery_request_date) : \n                              '날짜 선택'\n                            }\n                          </Button>\n                        </DatePickerPopover>\n                      ) : (\n                        <p className=\"modal-subtitle\">{formatDate(purchase.delivery_request_date)}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label text-orange-500\">변경 입고일</span>\n                      {isEditing ? (\n                        <DatePickerPopover\n                          onDateSelect={(date) => {\n                            setEditedPurchase(prev => prev ? {\n                              ...prev,\n                              revised_delivery_request_date: formatDateInput(date, 'yyyy-MM-dd')\n                            } : null)\n                          }}\n                          placeholder=\"변경 입고일을 선택하세요\"\n                          align=\"start\"\n                          side=\"bottom\"\n                        >\n                          <Button\n                            variant=\"outline\"\n                            className=\"mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] justify-start text-left font-normal business-radius-input\"\n                          >\n                            <Calendar className=\"mr-1 h-3 w-3\" />\n                            {editedPurchase?.revised_delivery_request_date ? \n                              formatDate(editedPurchase.revised_delivery_request_date) : \n                              '날짜 선택'\n                            }\n                          </Button>\n                        </DatePickerPopover>\n                      ) : (\n                        <p className=\"modal-subtitle text-orange-700\">\n                          {purchase.revised_delivery_request_date ? formatDate(purchase.revised_delivery_request_date) : '미설정'}\n                        </p>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/* 업체 정보 */}\n              <div className=\"bg-white rounded-lg p-2 sm:p-3 border border-gray-100 shadow-sm\">\n                <h3 className=\"modal-section-title mb-3 flex items-center\">\n                  <Building2 className=\"w-4 h-4 mr-2 text-gray-600\" />\n                  업체 정보\n                </h3>\n                \n                <div className=\"space-y-2\">\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">업체명</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.vendor?.vendor_name || editedPurchase?.vendor_name || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, vendor_name: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"업체 선택\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.vendor?.vendor_name || '-'}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">업체 담당자</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.vendor_contacts?.[0]?.contact_name || ''}\n                          onChange={(e) => {\n                            setEditedPurchase(prev => {\n                              if (!prev) return null;\n                              const contacts = prev.vendor_contacts || [];\n                              const updatedContacts = [...contacts];\n                              if (updatedContacts[0]) {\n                                updatedContacts[0] = { ...updatedContacts[0], contact_name: e.target.value };\n                              } else {\n                                updatedContacts[0] = { contact_name: e.target.value } as any;\n                              }\n                              return { ...prev, vendor_contacts: updatedContacts };\n                            })\n                          }}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"담당자 선택\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.vendor_contacts?.[0]?.contact_name || '-'}</p>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">PJ업체</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.project_vendor || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, project_vendor: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"입력\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.project_vendor || '-'}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">Item</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.project_item || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, project_item: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"입력\"\n                        />\n                      ) : (\n                        <p className=\"modal-subtitle\">{purchase.project_item || '-'}</p>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">수주번호</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.order_number || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, order_number: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"입력\"\n                        />\n                      ) : (\n                        <p className=\"modal-subtitle\">{purchase.order_number || '-'}</p>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n            </div>\n\n            {/* Right Column - Items List (Flexible Width) */}\n            <div className=\"lg:flex-1 lg:min-w-0 relative overflow-visible\">\n              \n              <div className=\"bg-white rounded-lg border border-gray-100 overflow-hidden shadow-sm\">\n                <div className=\"p-2 sm:p-3 bg-gray-50 border-b border-gray-100 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-0\">\n                  <h3 className=\"modal-section-title flex items-center\">\n                    <Package className=\"w-4 h-4 mr-2 text-gray-600\" />\n                    품목 리스트\n                    <span className=\"ml-2 badge-secondary\">\n                      {purchase.items?.length || 0}개\n                    </span>\n                  </h3>\n                  {!isEditing && (\n                    <>\n                      {activeTab === 'purchase' && canPurchase && (\n                        <Button\n                          size=\"sm\"\n                          onClick={handleCompleteAllPayment}\n                          className=\"button-base bg-orange-500 hover:bg-orange-600 text-white\"\n                        >\n                          <CreditCard className=\"w-3 h-3 mr-1\" />\n                          전체 구매완료\n                        </Button>\n                      )}\n                      {activeTab === 'receipt' && canReceiveItems && (\n                        <DatePickerPopover\n                          onDateSelect={handleCompleteAllReceipt}\n                          placeholder=\"전체 입고완료 날짜를 선택하세요\"\n                          align=\"end\"\n                          side=\"bottom\"\n                        >\n                          <Button\n                            size=\"sm\"\n                            className=\"button-base button-action-primary\"\n                          >\n                            <Truck className=\"w-3 h-3 mr-1\" />\n                            전체 입고완료\n                          </Button>\n                        </DatePickerPopover>\n                      )}\n                      {activeTab === 'done' && canReceiptCheck && (\n                        <div className=\"flex items-center gap-2\">\n                          <DatePickerPopover\n                            onDateSelect={handleCompleteAllStatement}\n                            placeholder=\"전체 회계상 입고일을 선택하세요\"\n                            align=\"end\"\n                            side=\"bottom\"\n                          >\n                            <Button\n                              size=\"sm\"\n                              className=\"button-base button-action-primary\"\n                            >\n                              <FileText className=\"w-3 h-3 mr-1\" />\n                              전체 거래명세서 확인\n                            </Button>\n                          </DatePickerPopover>\n                          <Button\n                            size=\"sm\"\n                            onClick={handleCompleteAllUtk}\n                            className=\"button-base bg-orange-500 hover:bg-orange-600 text-white\"\n                          >\n                            <CheckCircle className=\"w-3 h-3 mr-1\" />\n                            UTK 전체 확인 완료\n                          </Button>\n                        </div>\n                      )}\n                    </>\n                  )}\n                </div>\n                \n                {/* Mobile Table Header */}\n                <div className=\"block sm:hidden bg-gray-50 px-2 py-1 border-b border-gray-100\">\n                  <div className=\"text-xs font-medium text-gray-600\">품목 목록 (터치하여 스크롤)</div>\n                </div>\n                \n                {/* Items List with Header Inside Scrollable Container */}\n                <div className=\"max-h-[50vh] sm:max-h-[40vh] w-full min-w-0 overflow-auto\">\n                  <div style={{ minWidth: `${tableMinWidth}px` }}>\n                    {/* Items Table Header - Sticky inside scroll container */}\n                    <div className=\"bg-gray-50 px-2 sm:px-3 py-1 border-b border-gray-100 sticky top-0 z-10\">\n                      <div \n                        ref={headerRowRef}\n                        className=\"hidden sm:grid gap-3 modal-label\" \n                        style={{\n                          gridTemplateColumns: getGridTemplateColumns()\n                        }}\n                      >\n                        <div>품목명</div>\n                        <div>규격</div>\n                        <div className=\"text-center\">수량</div>\n                        <div className=\"text-right\">단가</div>\n                        <div className=\"text-right\">합계</div>\n                        <div className=\"text-center\">비고</div>\n                        {isEditing ? (\n                          <>\n                            <div className=\"text-center\">삭제</div>\n                            {activeTab === 'receipt' && (\n                              <>\n                                <div className=\"text-center\">실제입고일</div>\n                              </>\n                            )}\n                            {activeTab === 'done' && (\n                              <>\n                                <div className=\"text-center\">거래명세서 확인</div>\n                                <div className=\"text-center\">회계상 입고일</div>\n                                <div className=\"text-center\">처리자</div>\n                                <div className=\"text-center\">UTK</div>\n                              </>\n                            )}\n                          </>\n                        ) : (\n                          <>\n                            <div className=\"text-center\">\n                              {activeTab === 'purchase'\n                                ? '구매상태'\n                                : (activeTab === 'receipt' || activeTab === 'done')\n                                ? '입고상태'\n                                : '상태'}\n                            </div>\n                            {activeTab === 'done' && (\n                              <>\n                                <div className=\"text-center\">거래명세서 확인</div>\n                                <div className=\"text-center\">회계상 입고일</div>\n                                <div className=\"text-center\">처리자</div>\n                                <div className=\"text-center\">UTK</div>\n                              </>\n                            )}\n                            {activeTab === 'receipt' && (\n                              <>\n                                <div className=\"text-center\">실제입고일</div>\n                              </>\n                            )}\n                          </>\n                        )}\n                      </div>\n                    </div>\n                    <div className=\"divide-y divide-gray-100\">\n                      {(isEditing ? editedItems : purchase.items)?.map((item, index) => (\n                        <div key={index} className=\"px-2 sm:px-3 py-1.5 border-b border-gray-50 hover:bg-gray-50/50 transition-colors\">\n                          {/* Desktop Layout */}\n                          <div className={`hidden sm:grid items-center gap-3`} style={{\n                            gridTemplateColumns: getGridTemplateColumns()\n                          }}>\n                            {/* 품목명 */}\n                            <div className=\"min-w-0\">\n                              {isEditing ? (\n                                <Input\n                                  value={item.item_name}\n                                  onChange={(e) => handleItemChange(index, 'item_name', e.target.value)}\n                                  className=\"modal-label border-gray-200 rounded-lg w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                  placeholder=\"품목명\"\n                                />\n                              ) : (\n                                <span className=\"modal-value\">{item.item_name || '품목명 없음'}</span>\n                              )}\n                            </div>\n                            \n                            {/* 규격 */}\n                            <div className=\"min-w-0\">\n                              {isEditing ? (\n                                <Input\n                                  value={item.specification}\n                                  onChange={(e) => handleItemChange(index, 'specification', e.target.value)}\n                                  className=\"modal-label border-gray-200 rounded-lg w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                  placeholder=\"규격\"\n                                />\n                              ) : (\n                                <span className=\"modal-subtitle\">{item.specification || '-'}</span>\n                              )}\n                            </div>\n                            \n                            {/* 수량 */}\n                            <div className=\"text-center min-w-0\">\n                              {isEditing ? (\n                                <Input\n                                  type=\"number\"\n                                  value={item.quantity}\n                                  onChange={(e) => handleItemChange(index, 'quantity', Number(e.target.value))}\n                                  className=\"modal-label border-gray-200 rounded-lg text-center w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                  placeholder=\"수량\"\n                                  max=\"99999\"\n                                />\n                              ) : (\n                                <span className=\"modal-subtitle\">{item.quantity || 0}</span>\n                              )}\n                            </div>\n                            \n                            {/* 단가 */}\n                            <div className=\"text-right min-w-0\">\n                              {isEditing ? (\n                                <Input\n                                  type=\"number\"\n                                  value={item.unit_price_value}\n                                  onChange={(e) => handleItemChange(index, 'unit_price_value', Number(e.target.value))}\n                                  className=\"modal-label border-gray-200 rounded-lg text-right w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                  placeholder=\"단가\"\n                                  max=\"100000000000\"\n                                />\n                              ) : (\n                                <span className=\"modal-subtitle\">₩{formatCurrency(item.unit_price_value)}</span>\n                              )}\n                            </div>\n                            \n                            {/* 합계 */}\n                            <div className=\"text-right min-w-0\">\n                              {isEditing ? (\n                                <Input\n                                  type=\"number\"\n                                  value={item.amount_value}\n                                  onChange={(e) => handleItemChange(index, 'amount_value', Number(e.target.value))}\n                                  className=\"modal-label border-gray-200 rounded-lg text-right w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                  placeholder=\"합계\"\n                                  max=\"10000000000\"\n                                />\n                              ) : (\n                                <span className=\"modal-value\">₩{formatCurrency(item.amount_value || 0)}</span>\n                              )}\n                            </div>\n                            \n                            {/* 비고 */}\n                            <div className=\"min-w-0 flex justify-center items-start pt-1 text-center\">\n                              {isEditing ? (\n                                <Input\n                                  value={item.remark || ''}\n                                  onChange={(e) => handleItemChange(index, 'remark', e.target.value)}\n                                  className=\"modal-label border-gray-200 rounded-lg text-center w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                  placeholder=\"비고\"\n                                />\n                              ) : (\n                                <span className=\"modal-subtitle text-center\">{item.remark || '-'}</span>\n                              )}\n                            </div>\n                            \n                            {/* 상태/액션 */}\n                            <div className=\"text-center flex justify-center items-start pt-1\">\n                              {isEditing ? (\n                                <Button\n                                  size=\"sm\"\n                                  variant=\"ghost\"\n                                  onClick={() => handleRemoveItem(index)}\n                                  className=\"text-red-600 hover:bg-red-50 rounded-lg p-1 h-6 w-6\"\n                                >\n                                  <Trash2 className=\"w-3 h-3\" />\n                                </Button>\n                              ) : (\n                                <>\n                                  {/* 구매 탭에서의 구매완료 상태 */}\n                                  {activeTab === 'purchase' && (\n                                    <div className=\"flex justify-center\">\n                                      {canPurchase ? (\n                                        <button\n                                          onClick={() => handlePaymentToggle(item.id, !item.is_payment_completed)}\n                                          className={`transition-colors ${\n                                            item.is_payment_completed\n                                              ? 'button-toggle-active bg-orange-500 hover:bg-orange-600 text-white'\n                                              : 'button-toggle-inactive'\n                                          }`}\n                                        >\n                                          {item.is_payment_completed ? '구매완료' : '구매대기'}\n                                        </button>\n                                      ) : (\n                                        <span className={`${\n                                          item.is_payment_completed \n                                            ? 'button-toggle-active bg-orange-500 text-white' \n                                            : 'button-waiting-inactive'\n                                        }`}>\n                                          {item.is_payment_completed ? '구매완료' : '구매대기'}\n                                        </span>\n                                      )}\n                                    </div>\n                                  )}\n                                  \n                                  {/* 입고 탭에서의 입고완료 상태 */}\n                                  {activeTab === 'receipt' && (\n                                    <div className=\"flex justify-center\">\n                                      {canReceiptCheck ? (\n                                        actualReceivedAction.isCompleted(item) ? (\n                                          <button\n                                            onClick={() => {\n                                              actualReceivedAction.handleCancel(item.id, {\n                                                item_name: item.item_name,\n                                                specification: item.specification,\n                                                quantity: item.quantity,\n                                                unit_price_value: item.unit_price_value,\n                                                amount_value: item.amount_value,\n                                                remark: item.remark\n                                              })\n                                            }}\n                                            className=\"button-action-primary\"\n                                          >\n                                            {actualReceivedAction.config.completedText}\n                                          </button>\n                                        ) : (\n                                          <DatePickerPopover\n                                            onDateSelect={(date) => {\n                                              actualReceivedAction.handleConfirm(item.id, date, {\n                                                item_name: item.item_name,\n                                                specification: item.specification,\n                                                quantity: item.quantity,\n                                                unit_price_value: item.unit_price_value,\n                                                amount_value: item.amount_value,\n                                                remark: item.remark\n                                              })\n                                            }}\n                                            placeholder=\"실제 입고된 날짜를 선택하세요\"\n                                            align=\"center\"\n                                            side=\"bottom\"\n                                          >\n                                            <button className=\"button-toggle-inactive\">\n                                              {actualReceivedAction.config.waitingText}\n                                            </button>\n                                          </DatePickerPopover>\n                                        )\n                                      ) : (\n                                        <span className={`${\n                                          actualReceivedAction.isCompleted(item)\n                                            ? 'button-action-primary' \n                                            : 'button-waiting-inactive'\n                                        }`}>\n                                          {actualReceivedAction.isCompleted(item) ? actualReceivedAction.config.completedText : actualReceivedAction.config.waitingText}\n                                        </span>\n                                      )}\n                                    </div>\n                                  )}\n                                  \n                                  {/* 전체 항목 탭에서는 입고 상태만 표시 (클릭 불가) */}\n                                  {activeTab === 'done' && (\n                                    <div className=\"flex justify-center\">\n                                      <span className={`button-base ${\n                                        actualReceivedAction.isCompleted(item)\n                                          ? 'bg-green-500 hover:bg-green-600 text-white' \n                                          : 'border border-gray-300 text-gray-600 bg-white hover:bg-gray-50'\n                                      }`}>\n                                        {actualReceivedAction.isCompleted(item) ? '입고완료' : '입고대기'}\n                                      </span>\n                                    </div>\n                                  )}\n                                  \n                                  {/* 기타 탭에서는 기본 상태 표시 */}\n                                  {activeTab !== 'purchase' && activeTab !== 'receipt' && activeTab !== 'done' && (\n                                    <div className=\"flex justify-center\">\n                                      <span className=\"badge-text\">-</span>\n                                    </div>\n                                  )}\n                                </>\n                              )}\n                            </div>\n                            \n                            {/* 실제 입고 날짜 - 입고 탭에서만 표시 (상태 컬럼 오른쪽) */}\n                            {activeTab === 'receipt' && (\n                              <div className=\"text-center flex justify-center items-start pt-1 pl-2\">\n                                {actualReceivedAction.getCompletedDate(item) ? (\n                                  <div className=\"modal-subtitle text-green-700\">\n                                    {new Date(actualReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                                      year: 'numeric',\n                                      month: '2-digit',\n                                      day: '2-digit'\n                                    })}\n                                  </div>\n                                ) : (\n                                  <span className=\"modal-subtitle text-gray-400\">-</span>\n                                )}\n                              </div>\n                            )}\n\n                            {/* 거래명세서 확인 - 전체항목 탭에서만 표시 */}\n                            {activeTab === 'done' && (\n                              <div className=\"text-center flex justify-center items-start pt-1\">\n                                {canReceiptCheck ? (\n                                  statementReceivedAction.isCompleted(item) ? (\n                                    <button\n                                      onClick={() => {\n                                        statementReceivedAction.handleCancel(item.id, {\n                                          item_name: item.item_name,\n                                          specification: item.specification,\n                                          quantity: item.quantity,\n                                          unit_price_value: item.unit_price_value,\n                                          amount_value: item.amount_value,\n                                          remark: item.remark\n                                        })\n                                      }}\n                                      className=\"button-action-primary hover:bg-green-600 transition-colors\"\n                                      title=\"클릭하여 거래명세서 확인 취소\"\n                                    >\n                                      {statementReceivedAction.config.completedText}\n                                    </button>\n                                  ) : (\n                                    <DatePickerPopover\n                                      onDateSelect={(date) => {\n                                        statementReceivedAction.handleConfirm(item.id, date, {\n                                          item_name: item.item_name,\n                                          specification: item.specification,\n                                          quantity: item.quantity,\n                                          unit_price_value: item.unit_price_value,\n                                          amount_value: item.amount_value,\n                                          remark: item.remark\n                                        })\n                                      }}\n                                      placeholder=\"회계상 입고일을 선택하세요\"\n                                      align=\"center\"\n                                      side=\"bottom\"\n                                    >\n                                      <button \n                                        className=\"button-toggle-inactive\"\n                                        onClick={() => {}}\n                                      >\n                                        {statementReceivedAction.config.waitingText}\n                                      </button>\n                                    </DatePickerPopover>\n                                  )\n                                ) : (\n                                  <span className={`${\n                                    statementReceivedAction.isCompleted(item)\n                                      ? 'button-action-primary' \n                                      : 'button-waiting-inactive'\n                                  }`}>\n                                    {statementReceivedAction.isCompleted(item) ? statementReceivedAction.config.completedText : statementReceivedAction.config.waitingText}\n                                  </span>\n                                )}\n                              </div>\n                            )}\n\n                            {/* 회계상 입고일 - 전체항목 탭에서만 표시 */}\n                            {activeTab === 'done' && (\n                              <div className=\"text-center flex justify-center items-start pt-1\">\n                                {statementReceivedAction.getCompletedDate(item) ? (\n                                  <div className=\"modal-subtitle text-blue-700\">\n                                    {new Date(statementReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                                      year: 'numeric',\n                                      month: '2-digit',\n                                      day: '2-digit'\n                                    })}\n                                  </div>\n                                ) : (\n                                  <span className=\"modal-subtitle text-gray-400\">-</span>\n                                )}\n                              </div>\n                            )}\n                            {/* 처리자 - 전체항목 탭에서만 표시 */}\n                            {activeTab === 'done' && (\n                              <div className=\"text-center flex justify-center items-start pt-1\">\n                                {statementReceivedAction.getCompletedByName(item) ? (\n                                  <span className=\"modal-subtitle text-gray-600\">\n                                    {statementReceivedAction.getCompletedByName(item)}\n                                  </span>\n                                ) : (\n                                  <span className=\"modal-subtitle text-gray-400\">-</span>\n                                )}\n                              </div>\n                            )}\n\n                            {/* UTK 확인 - 전체항목 탭에서만 표시 (맨 오른쪽 끝) */}\n                            {activeTab === 'done' && (\n                              <div className=\"text-center flex justify-center items-start pt-1\">\n                                {canReceiptCheck ? (\n                                  <button\n                                    onClick={() => handleUtkToggle(item.id, !item.is_utk_checked)}\n                                    className={`button-base transition-colors ${\n                                      item.is_utk_checked\n                                        ? 'button-toggle-active bg-orange-500 hover:bg-orange-600 text-white'\n                                        : 'button-toggle-inactive'\n                                    }`}\n                                    title={item.is_utk_checked ? 'UTK 확인 취소' : 'UTK 확인 처리'}\n                                  >\n                                    {item.is_utk_checked ? '완료' : '대기'}\n                                  </button>\n                                ) : (\n                                  <span className={`${\n                                    item.is_utk_checked \n                                      ? 'button-toggle-active bg-orange-500 text-white' \n                                      : 'button-waiting-inactive'\n                                  }`}>\n                                    {item.is_utk_checked ? '완료' : '대기'}\n                                  </span>\n                                )}\n                              </div>\n                            )}\n                          </div>\n                          \n                          {/* Mobile Layout */}\n                          <div className=\"block sm:hidden space-y-2\">\n                            <div className=\"flex justify-between items-start\">\n                              <div className=\"flex-1 min-w-0\">\n                                {isEditing ? (\n                                  <Input\n                                    value={item.item_name}\n                                    onChange={(e) => handleItemChange(index, 'item_name', e.target.value)}\n                                    className=\"modal-label border-gray-200 rounded-lg w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                    placeholder=\"품목명\"\n                                  />\n                                ) : (\n                                  <div className=\"modal-value font-medium\">{item.item_name || '품목명 없음'}</div>\n                                )}\n                                {isEditing ? (\n                                  <Input\n                                    value={item.specification}\n                                    onChange={(e) => handleItemChange(index, 'specification', e.target.value)}\n                                    className=\"modal-label border-gray-200 rounded-lg mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                    placeholder=\"규격\"\n                                  />\n                                ) : (\n                                  <div className=\"modal-subtitle text-gray-500\">{item.specification || '-'}</div>\n                                )}\n                              </div>\n                              <div className=\"ml-3 text-right flex-shrink-0\">\n                                {isEditing ? (\n                                  <Input\n                                    type=\"number\"\n                                    value={item.amount_value}\n                                    onChange={(e) => handleItemChange(index, 'amount_value', Number(e.target.value))}\n                                    className=\"modal-label border-gray-200 rounded-lg text-right w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                    placeholder=\"합계\"\n                                  />\n                                ) : (\n                                  <div className=\"modal-value font-semibold\">₩{formatCurrency(item.amount_value || 0)}</div>\n                                )}\n                              </div>\n                            </div>\n                            \n                            <div className=\"grid grid-cols-3 gap-2 text-sm\">\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">수량:</span>\n                                {isEditing ? (\n                                  <Input\n                                    type=\"number\"\n                                    value={item.quantity}\n                                    onChange={(e) => handleItemChange(index, 'quantity', Number(e.target.value))}\n                                    className=\"modal-label border-gray-200 rounded-lg mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                    placeholder=\"수량\"\n                                  />\n                                ) : (\n                                  <div className=\"modal-subtitle\">{item.quantity || 0}</div>\n                                )}\n                              </div>\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">단가:</span>\n                                {isEditing ? (\n                                  <Input\n                                    type=\"number\"\n                                    value={item.unit_price_value}\n                                    onChange={(e) => handleItemChange(index, 'unit_price_value', Number(e.target.value))}\n                                    className=\"modal-label border-gray-200 rounded-lg mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                    placeholder=\"단가\"\n                                  />\n                                ) : (\n                                  <div className=\"modal-subtitle\">₩{formatCurrency(item.unit_price_value)}</div>\n                                )}\n                              </div>\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">상태:</span>\n                                <div className=\"mt-1\">\n                                  {isEditing ? (\n                                    <Button\n                                      size=\"sm\"\n                                      variant=\"ghost\"\n                                      onClick={() => handleRemoveItem(index)}\n                                      className=\"text-red-600 hover:bg-red-50 rounded-lg p-1 h-6 w-6\"\n                                    >\n                                      <Trash2 className=\"w-3 h-3\" />\n                                    </Button>\n                                  ) : (\n                                    <>\n                                      {activeTab === 'purchase' && (\n                                        <>\n                                          {canPurchase ? (\n                                            <button\n                                              onClick={() => handlePaymentToggle(item.id, !item.is_payment_completed)}\n                                              className={`text-xs px-2 py-1 rounded transition-colors ${\n                                                item.is_payment_completed\n                                                  ? 'bg-orange-500 text-white hover:bg-orange-600'\n                                                  : 'bg-gray-100 text-gray-600'\n                                              }`}\n                                            >\n                                              {item.is_payment_completed ? '구매완료' : '구매대기'}\n                                            </button>\n                                          ) : (\n                                            <span className={`text-xs px-2 py-1 rounded ${\n                                              item.is_payment_completed \n                                                ? 'bg-orange-500 text-white' \n                                                : 'bg-gray-100 text-gray-400'\n                                            }`}>\n                                              {item.is_payment_completed ? '구매완료' : '구매대기'}\n                                            </span>\n                                          )}\n                                        </>\n                                      )}\n                                      \n                                      {activeTab === 'receipt' && (\n                                        <>\n                                          {canReceiptCheck ? (\n                                            actualReceivedAction.isCompleted(item) ? (\n                                              <button\n                                                onClick={() => {\n                                                  actualReceivedAction.handleCancel(item.id, {\n                                                    item_name: item.item_name,\n                                                    specification: item.specification,\n                                                    quantity: item.quantity,\n                                                    unit_price_value: item.unit_price_value,\n                                                    amount_value: item.amount_value,\n                                                    remark: item.remark\n                                                  })\n                                                }}\n                                                className=\"text-xs px-2 py-1 rounded button-action-primary\"\n                                              >\n                                                {actualReceivedAction.config.completedText}\n                                              </button>\n                                            ) : (\n                                              <DatePickerPopover\n                                                onDateSelect={(date) => {\n                                                  actualReceivedAction.handleConfirm(item.id, date, {\n                                                    item_name: item.item_name,\n                                                    specification: item.specification,\n                                                    quantity: item.quantity,\n                                                    unit_price_value: item.unit_price_value,\n                                                    amount_value: item.amount_value,\n                                                    remark: item.remark\n                                                  })\n                                                }}\n                                                placeholder=\"실제 입고된 날짜를 선택하세요\"\n                                                align=\"center\"\n                                                side=\"bottom\"\n                                              >\n                                                <button className=\"text-xs px-2 py-1 rounded bg-gray-100 text-gray-600\">\n                                                  {actualReceivedAction.config.waitingText}\n                                                </button>\n                                              </DatePickerPopover>\n                                            )\n                                          ) : (\n                                            <span className={`text-xs px-2 py-1 rounded ${\n                                              actualReceivedAction.isCompleted(item)\n                                                ? 'button-action-primary' \n                                                : 'bg-gray-100 text-gray-400'\n                                            }`}>\n                                              {actualReceivedAction.isCompleted(item) ? actualReceivedAction.config.completedText : actualReceivedAction.config.waitingText}\n                                            </span>\n                                          )}\n                                        </>\n                                      )}\n                                      \n                                      {activeTab === 'done' && (\n                                        <>\n                                          {/* 전체 항목 탭에서는 입고 상태만 표시 (클릭 불가) */}\n                                          <span className={`button-base ${\n                                            actualReceivedAction.isCompleted(item)\n                                              ? 'bg-green-500 text-white' \n                                              : 'border border-gray-300 text-gray-600 bg-white'\n                                          }`}>\n                                            {actualReceivedAction.isCompleted(item) ? '입고완료' : '입고대기'}\n                                          </span>\n                                        </>\n                                      )}\n                                      \n                                      {activeTab !== 'purchase' && activeTab !== 'receipt' && activeTab !== 'done' && (\n                                        <span className=\"text-xs text-gray-400\">-</span>\n                                      )}\n                                    </>\n                                  )}\n                                </div>\n                              </div>\n                            </div>\n                            \n                            {(item.remark || isEditing) && (\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">비고:</span>\n                                {isEditing ? (\n                                  <Input\n                                    value={item.remark || ''}\n                                    onChange={(e) => handleItemChange(index, 'remark', e.target.value)}\n                                    className=\"modal-label border-gray-200 rounded-lg mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                    placeholder=\"비고\"\n                                  />\n                                ) : (\n                                  <div className=\"modal-subtitle text-gray-500 mt-1\">{item.remark || '-'}</div>\n                                )}\n                              </div>\n                            )}\n                            \n                            {/* 모바일에서 실제 입고 날짜 표시 */}\n                            {!isEditing && activeTab === 'receipt' && actualReceivedAction.getCompletedDate(item) && (\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">실제입고일:</span>\n                                <div className=\"mt-1\">\n                                  <div className=\"modal-subtitle text-green-700\">\n                                    {new Date(actualReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                                      year: 'numeric',\n                                      month: '2-digit',\n                                      day: '2-digit'\n                                    })}\n                                  </div>\n                                  <div className=\"text-[9px] text-gray-500\">\n                                    {new Date(actualReceivedAction.getCompletedDate(item)).toLocaleTimeString('ko-KR', {\n                                      hour: '2-digit',\n                                      minute: '2-digit'\n                                    })}\n                                  </div>\n                                </div>\n                              </div>\n                            )}\n\n                            {/* 모바일에서 거래명세서 확인 표시 - 전체항목 탭에서만 */}\n                            {!isEditing && activeTab === 'done' && (\n                              <div className=\"flex items-center justify-between\">\n                                <span className=\"text-gray-500 text-xs\">거래명세서 확인:</span>\n                                <div className=\"flex items-center gap-2\">\n                                  {canReceiptCheck ? (\n                                    statementReceivedAction.isCompleted(item) ? (\n                                      <button\n                                        onClick={() => {\n                                          statementReceivedAction.handleCancel(item.id, {\n                                            item_name: item.item_name,\n                                            specification: item.specification,\n                                            quantity: item.quantity,\n                                            unit_price_value: item.unit_price_value,\n                                            amount_value: item.amount_value,\n                                            remark: item.remark\n                                          })\n                                        }}\n                                        className=\"text-xs px-2 py-1 rounded button-action-primary hover:bg-green-600 transition-colors\"\n                                        title=\"클릭하여 거래명세서 확인 취소\"\n                                      >\n                                        {statementReceivedAction.config.completedText}\n                                      </button>\n                                    ) : (\n                                      <DatePickerPopover\n                                        onDateSelect={(date) => {\n                                          statementReceivedAction.handleConfirm(item.id, date, {\n                                            item_name: item.item_name,\n                                            specification: item.specification,\n                                            quantity: item.quantity,\n                                            unit_price_value: item.unit_price_value,\n                                            amount_value: item.amount_value,\n                                            remark: item.remark\n                                          })\n                                        }}\n                                        placeholder=\"회계상 입고일을 선택하세요\"\n                                        align=\"end\"\n                                        side=\"bottom\"\n                                      >\n                                        <button \n                                          className=\"text-xs px-2 py-1 rounded bg-gray-100 text-gray-600\"\n                                          onClick={() => {}}\n                                        >\n                                          {statementReceivedAction.config.waitingText}\n                                        </button>\n                                      </DatePickerPopover>\n                                    )\n                                  ) : (\n                                    <span className={`text-xs px-2 py-1 rounded ${\n                                      statementReceivedAction.isCompleted(item)\n                                        ? 'button-action-primary' \n                                        : 'bg-gray-100 text-gray-400'\n                                    }`}>\n                                      {statementReceivedAction.isCompleted(item) ? statementReceivedAction.config.completedText : statementReceivedAction.config.waitingText}\n                                    </span>\n                                  )}\n                                </div>\n                              </div>\n                            )}\n\n                            {/* 모바일에서 회계상 입고일 표시 - 전체항목 탭에서만 */}\n                            {!isEditing && activeTab === 'done' && statementReceivedAction.getCompletedDate(item) && (\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">회계상 입고일:</span>\n                                <div className=\"mt-1\">\n                                  <div className=\"modal-subtitle text-blue-700\">\n                                    {new Date(statementReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                                      year: 'numeric',\n                                      month: '2-digit',\n                                      day: '2-digit'\n                                    })}\n                                  </div>\n                                </div>\n                              </div>\n                            )}\n                            {/* 모바일에서 처리자 표시 - 전체항목 탭에서만 */}\n                            {!isEditing && activeTab === 'done' && statementReceivedAction.getCompletedByName(item) && (\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">처리자:</span>\n                                <div className=\"mt-1\">\n                                  <div className=\"modal-subtitle text-gray-600\">\n                                    {statementReceivedAction.getCompletedByName(item)}\n                                  </div>\n                                </div>\n                              </div>\n                            )}\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                </div>\n                \n                {/* 합계 */}\n                <div className=\"bg-gray-50 px-2 sm:px-3 border-t border-gray-100\">\n                  <div className=\"hidden sm:grid items-center gap-3 py-0.5\" style={{\n                    gridTemplateColumns: getGridTemplateColumns()\n                  }}>\n                    {/* 품목명 */}\n                    <div></div>\n                    {/* 규격 */}\n                    <div></div>\n                    {/* 수량 */}\n                    <div></div>\n                    {/* 단가 */}\n                    <div className=\"text-right\">\n                      <span className=\"text-[12px] font-bold text-gray-900\">총액</span>\n                    </div>\n                    {/* 합계 */}\n                    <div className=\"text-right\">\n                      <span className=\"text-[12px] font-bold text-gray-900\">\n                        ₩{formatCurrency(\n                          (isEditing ? editedItems : purchase.items)?.reduce((sum, item) => sum + (item.amount_value || 0), 0) || 0\n                        )}\n                      </span>\n                    </div>\n                    {/* 나머지 칼럼들 */}\n                    <div></div>\n                    <div></div>\n                    {activeTab === 'receipt' && <div></div>}\n                  </div>\n                  \n                  {/* Mobile 총액 */}\n                  <div className=\"block sm:hidden py-0.5\">\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-[13px] font-bold text-gray-900\">총액</span>\n                      <span className=\"text-[13px] font-bold text-gray-900\">\n                        ₩{formatCurrency(\n                          (isEditing ? editedItems : purchase.items)?.reduce((sum, item) => sum + (item.amount_value || 0), 0) || 0\n                        )}\n                      </span>\n                    </div>\n                  </div>\n                </div>\n                \n                {/* 항목 추가 버튼 */}\n                {isEditing && (\n                  <div className=\"p-2 sm:p-3 border-t border-gray-100\">\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={handleAddItem}\n                      className=\"w-full rounded-lg border-dashed border-2 border-gray-300 hover:border-gray-400 py-2 badge-text\"\n                    >\n                      <Plus className=\"w-4 h-4 mr-1\" />\n                      항목 추가\n                    </Button>\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n      ) : (\n        <div className=\"text-center py-12\">\n          <span className=\"modal-subtitle\">\n            발주 정보를 불러올 수 없습니다.\n          </span>\n        </div>\n      )}\n    </div>\n  )\n\n  // embedded가 true면 Dialog 없이 내용만 반환\n  if (embedded) {\n    return content\n  }\n\n  // embedded가 false면 Dialog로 감싸서 반환\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent \n        className=\"overflow-hidden bg-white rounded-lg shadow-sm border-0 w-full sm:w-auto max-w-[calc(100vw-48px)] sm:max-w-[calc(100vw-80px)] lg:max-w-[90vw] xl:max-w-[85vw] h-[95vh] sm:h-auto sm:max-h-[90vh] lg:max-h-[85vh] sm:rounded-lg flex flex-col\" \n        showCloseButton={false}\n      >\n        {/* Apple-style Header */}\n        <div className=\"relative px-3 sm:px-6 pt-0 sm:pt-3 lg:pt-4 pb-0 sm:pb-2 lg:pb-3 flex-shrink-0\">\n          <button\n            onClick={onClose}\n            className=\"button-base button-action-secondary absolute right-3 sm:right-6 top-0 sm:top-3 lg:top-4 w-6 h-6 sm:w-8 sm:h-8 rounded-full\"\n          >\n            <X className=\"w-4 h-4 text-gray-500\" />\n          </button>\n          \n          <div className=\"pr-8 sm:pr-16\">\n            <div className=\"flex items-start gap-4 mb-0 sm:mb-3\">\n              <div className=\"min-w-0 flex-1\">\n                <h1 className=\"page-title mb-0 sm:mb-1\">\n                  발주 기본정보\n                </h1>\n              </div>\n              <div className=\"flex items-center gap-3\">\n                {!isEditing && canEdit && (\n                  <>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => handleEditToggle(true)}\n                      className=\"button-base button-action-secondary\"\n                    >\n                      <Edit2 className=\"w-4 h-4 mr-2\" />\n                      수정\n                    </Button>\n                    {canDelete && onDelete && (\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={() => purchase && onDelete(purchase)}\n                        className=\"button-base button-action-danger\"\n                      >\n                        <Trash2 className=\"w-4 h-4 mr-2\" />\n                        삭제\n                      </Button>\n                    )}\n                  </>\n                )}\n                {isEditing && (\n                  <>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => {\n                        handleEditToggle(false)\n                        setEditedPurchase(purchase)\n                        setEditedItems(purchase?.items || [])\n                        setDeletedItemIds([])\n                      }}\n                      className=\"button-base button-action-secondary\"\n                    >\n                      <X className=\"w-4 h-4 mr-2\" />\n                      취소\n                    </Button>\n                    <Button\n                      size=\"sm\"\n                      onClick={handleSave}\n                      className=\"button-base button-action-primary\"\n                    >\n                      <Save className=\"w-4 h-4 mr-2\" />\n                      저장\n                    </Button>\n                  </>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Apple-style Content */}\n        <div className=\"overflow-y-auto flex-1 px-3 sm:px-6 pb-1 sm:pb-6 mt-0\">\n          {content}\n        </div>\n      </DialogContent>\n      \n    </Dialog>\n  )\n}"],"names":["PurchaseDetailModal","purchaseId","isOpen","onClose","embedded","currentUserRoles","activeTab","onRefresh","onOptimisticUpdate","onDelete","loading","setLoading","useState","purchase","setPurchase","isEditing","setIsEditing","editedPurchase","setEditedPurchase","editedItems","setEditedItems","deletedItemIds","setDeletedItemIds","userRoles","setUserRoles","currentUserName","setCurrentUserName","columnWidths","setColumnWidths","tableMinWidth","useMemo","length","columnGap","padding","total","reduce","sum","width","Math","max","baseColumns","push","headerRowRef","useRef","supabase","createClient","useEffect","async","supabaseUrl","includes","logger","warn","data","user","auth","getUser","employeeData","from","select","eq","id","maybeSingle","email","employeeByEmail","name","purchase_role","roles","Array","isArray","map","r","String","trim","split","filter","error","loadUserRoles","effectiveRoles","canEdit","canDelete","final_manager_status","requester_name","canPurchase","canReceiveItems","isAdmin","isRequester","canReceiptCheck","refreshModalData","useCallback","single","sortedItems","purchase_request_items","sort","a","b","line_number","purchaseData","items","vendor","vendors","vendor_name","vendor_contacts","debug","isInitialLoad","setIsInitialLoad","purchaseIdNumber","Number","NaN","handleActualReceiptOptimisticUpdate","itemId","selectedDate","action","itemIdStr","nowIso","Date","toISOString","selectedDateIso","updateItems","item","is_received","actual_received_date","received_at","prev","updatedItems","completed","allReceived","prevItems","isNaN","prevPurchase","handleStatementReceivedOptimisticUpdate","nextAllCompleted","nextStatementAt","is_statement_received","statement_received_date","statement_received_by_name","every","statement_received_at","allCompleted","update","then","statementReceivedAction","useConfirmDateAction","config","field","confirmMessage","confirm","cancel","successMessage","completedText","waitingText","canPerformAction","onUpdate","actualReceivedAction","requesterName","canApproveMiddle","canApproveFinal","approvalButtonClass","approvalWaitingPillClass","middleManagerStatus","middle_manager_status","finalManagerStatus","loadPurchaseDetail","toString","calculateOptimalColumnWidths","columnConfigs","key","minWidth","maxWidth","baseWidth","calculatedWidths","index","maxLength","headers","baseHeaders","getHeaders","forEach","cellValue","item_name","specification","quantity","unit_price_value","toLocaleString","amount_value","remark","getStatusDisplay","formatDate","is_utk_checked","adjustedLength","acc","char","test","ceil","calculatedWidth","min","range","purchase_status","receipt_status","getGridTemplateColumns","join","handleEditToggle","editing","toast","formatCurrency","amount","Intl","NumberFormat","format","handleItemChange","value","newItems","unitPrice","handleRemoveItem","_","i","handlePaymentToggle","isCompleted","numericId","targetItem","find","itemInfo","unit","window","is_payment_completed","payment_completed_at","payment_completed_by_name","success","refreshResult","silent","Promise","handleApprove","type","approvalType","purchase_order_number","updateData","content","jsx","className","children","jsxs","payment_category","category","Badge","variant","getStatusBadge","Calendar","request_date","Button","size","onClick","Check","X","FileText","Input","request_type","onChange","e","target","placeholder","DatePickerPopover","onDateSelect","date","delivery_request_date","formatDateInput","align","side","revised_delivery_request_date","Building2","contact_name","updatedContacts","project_vendor","project_item","order_number","Package","Fragment","CreditCard","applyOptimisticUpdate","is","Truck","formattedDate","toLocaleDateString","year","month","day","CheckCircle","style","ref","gridTemplateColumns","Trash2","handleCancel","handleConfirm","getCompletedDate","title","getCompletedByName","isChecked","checked","allChecked","updateError","handleUtkToggle","toLocaleTimeString","hour","minute","newItem","lineNum","Plus","Dialog","open","onOpenChange","DialogContent","showCloseButton","Edit2","editedItemsCount","deletedItemsCount","totalAmount","total_amount","updated_at","deleteError","delete","in","count","itemName","Error","unit_price_currency","currency","amount_currency","insertData","purchase_request_id","indexOf","created_at","insert","errorMessage","message","Save"],"mappings":"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"}