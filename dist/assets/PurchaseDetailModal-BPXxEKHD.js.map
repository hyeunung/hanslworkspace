{"version":3,"file":"PurchaseDetailModal-BPXxEKHD.js","sources":["../../node_modules/lucide-react/dist/esm/icons/dollar-sign.js","../../node_modules/lucide-react/dist/esm/icons/truck.js","../../src/components/ui/date-picker-popover.tsx","../../src/components/ui/date-amount-picker-popover.tsx","../../src/hooks/useConfirmDateAction.ts","../../src/components/purchase/PurchaseDetailModal.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"line\", { x1: \"12\", x2: \"12\", y1: \"2\", y2: \"22\", key: \"7eqyqh\" }],\n  [\"path\", { d: \"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6\", key: \"1b0p4s\" }]\n];\nconst DollarSign = createLucideIcon(\"dollar-sign\", __iconNode);\n\nexport { __iconNode, DollarSign as default };\n//# sourceMappingURL=dollar-sign.js.map\n","/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2\", key: \"wrbu53\" }],\n  [\"path\", { d: \"M15 18H9\", key: \"1lyqi6\" }],\n  [\n    \"path\",\n    {\n      d: \"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14\",\n      key: \"lysw3i\"\n    }\n  ],\n  [\"circle\", { cx: \"17\", cy: \"18\", r: \"2\", key: \"332jqn\" }],\n  [\"circle\", { cx: \"7\", cy: \"18\", r: \"2\", key: \"19iecd\" }]\n];\nconst Truck = createLucideIcon(\"truck\", __iconNode);\n\nexport { __iconNode, Truck as default };\n//# sourceMappingURL=truck.js.map\n","import { useState } from 'react'\nimport { Calendar } from '@/components/ui/calendar'\nimport { Button } from '@/components/ui/button'\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from '@/components/ui/popover'\nimport { Calendar as CalendarIcon } from 'lucide-react'\nimport { format } from 'date-fns'\nimport { ko } from 'date-fns/locale'\nimport { cn } from '@/lib/utils'\nimport { logger } from '@/lib/logger'\n\ninterface DatePickerPopoverProps {\n  children: React.ReactNode\n  onDateSelect: (date: Date) => void\n  disabled?: boolean\n  placeholder?: string\n  align?: \"center\" | \"start\" | \"end\"\n  side?: \"top\" | \"right\" | \"bottom\" | \"left\"\n}\n\nexport function DatePickerPopover({\n  children,\n  onDateSelect,\n  disabled = false,\n  placeholder = \"ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”\",\n  align = \"center\",\n  side = \"bottom\"\n}: DatePickerPopoverProps) {\n  const [open, setOpen] = useState(false)\n\n  const handleDateSelect = (date: Date | undefined) => {\n    logger.debug('ğŸ“… DatePickerPopover handleDateSelect í˜¸ì¶œ:', { \n      date, \n      isToday: date && new Date().toDateString() === date.toDateString(),\n      dateString: date?.toDateString(),\n      todayString: new Date().toDateString()\n    });\n    if (date) {\n      logger.debug('âœ… ë‚ ì§œ ì„ íƒë¨, onDateSelect í˜¸ì¶œ ì˜ˆì •');\n      onDateSelect(date)\n      setOpen(false) // ë‚ ì§œ ì„ íƒ í›„ íŒì˜¤ë²„ ë‹«ê¸°\n      logger.debug('ğŸ”š DatePickerPopover ì²˜ë¦¬ ì™„ë£Œ');\n    } else {\n      logger.debug('âŒ ë‚ ì§œê°€ undefinedì„');\n    }\n  }\n\n  return (\n    <Popover open={open} onOpenChange={setOpen}>\n      <PopoverTrigger asChild disabled={disabled}>\n        {children}\n      </PopoverTrigger>\n      <PopoverContent \n        className=\"w-auto p-0 border-gray-200 shadow-lg\" \n        align={align}\n        side={side}\n        sideOffset={8}\n      >\n        <div className=\"bg-white business-radius-card p-2\">\n          <div className=\"mb-2 px-1\">\n            <div className=\"modal-label text-gray-600 text-center\">\n              {placeholder}\n            </div>\n          </div>\n          <Calendar\n            mode=\"single\"\n            selected={undefined}\n            onSelect={(date) => {\n              logger.debug('ğŸ—“ï¸ Calendar onSelect ì§ì ‘ í˜¸ì¶œ:', { \n                date, \n                isToday: date && new Date().toDateString() === date.toDateString(),\n                dateValue: date?.getTime(),\n                todayValue: new Date().getTime()\n              });\n              handleDateSelect(date);\n            }}\n            locale={ko}\n            initialFocus\n            className=\"compact-calendar\"\n            disabled={false}\n            fromDate={new Date('2020-01-01')}\n            toDate={new Date('2030-12-31')}\n            defaultMonth={new Date()}\n            modifiers={{\n              today: new Date()\n            }}\n            modifiersClassNames={{\n              today: \"bg-blue-500 text-white font-semibold cursor-pointer hover:bg-blue-600 rounded-md\"\n            }}\n          />\n        </div>\n      </PopoverContent>\n    </Popover>\n  )\n}","import { useState } from 'react'\nimport { Calendar } from '@/components/ui/calendar'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from '@/components/ui/popover'\nimport { Calendar as CalendarIcon } from 'lucide-react'\nimport { format } from 'date-fns'\nimport { ko } from 'date-fns/locale'\nimport { cn } from '@/lib/utils'\nimport { logger } from '@/lib/logger'\n\ninterface DateAmountPickerPopoverProps {\n  children: React.ReactNode\n  onConfirm: (date: Date, amount: number) => void\n  disabled?: boolean\n  placeholder?: string\n  align?: \"center\" | \"start\" | \"end\"\n  side?: \"top\" | \"right\" | \"bottom\" | \"left\"\n  defaultDate?: Date\n  defaultAmount?: number\n}\n\nexport function DateAmountPickerPopover({\n  children,\n  onConfirm,\n  disabled = false,\n  placeholder = \"ë‚ ì§œì™€ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”\",\n  align = \"center\",\n  side = \"bottom\",\n  defaultDate,\n  defaultAmount\n}: DateAmountPickerPopoverProps) {\n  const [open, setOpen] = useState(false)\n  const [selectedDate, setSelectedDate] = useState<Date | undefined>(defaultDate)\n  const [amount, setAmount] = useState<string>(defaultAmount?.toString() || '')\n\n  const handleConfirm = () => {\n    if (!selectedDate) {\n      return\n    }\n    \n    const amountNum = parseFloat(amount.replace(/,/g, ''))\n    if (isNaN(amountNum) || amountNum <= 0) {\n      return\n    }\n\n    onConfirm(selectedDate, amountNum)\n    setOpen(false)\n    // Reset after close\n    setSelectedDate(defaultDate)\n    setAmount(defaultAmount?.toString() || '')\n  }\n\n  const handleAmountChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const value = e.target.value.replace(/[^0-9]/g, '')\n    if (value) {\n      const numValue = parseInt(value, 10)\n      setAmount(numValue.toLocaleString())\n    } else {\n      setAmount('')\n    }\n  }\n\n  return (\n    <Popover open={open} onOpenChange={setOpen}>\n      <PopoverTrigger asChild disabled={disabled}>\n        {children}\n      </PopoverTrigger>\n      <PopoverContent \n        className=\"w-auto p-0 border-gray-200 shadow-lg\" \n        align={align}\n        side={side}\n        sideOffset={8}\n      >\n        <div className=\"bg-white business-radius-card p-3\">\n          <div className=\"mb-2 px-1\">\n            <div className=\"modal-label text-gray-600 text-center\">\n              {placeholder}\n            </div>\n          </div>\n          <Calendar\n            mode=\"single\"\n            selected={selectedDate}\n            onSelect={setSelectedDate}\n            locale={ko}\n            initialFocus\n            className=\"compact-calendar\"\n            disabled={false}\n            fromDate={new Date('2020-01-01')}\n            toDate={new Date('2030-12-31')}\n            defaultMonth={selectedDate || new Date()}\n            modifiers={{\n              today: new Date()\n            }}\n            modifiersClassNames={{\n              today: \"bg-blue-500 text-white font-semibold cursor-pointer hover:bg-blue-600 rounded-md\"\n            }}\n          />\n          <div className=\"mt-3 px-1\">\n            <label className=\"block text-xs font-medium text-gray-700 mb-1\">\n              ì§€ì¶œê¸ˆì•¡\n            </label>\n            <Input\n              type=\"text\"\n              value={amount}\n              onChange={handleAmountChange}\n              placeholder=\"ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”\"\n              className=\"w-full\"\n            />\n          </div>\n          <div className=\"mt-3 flex justify-end gap-2\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => setOpen(false)}\n            >\n              ì·¨ì†Œ\n            </Button>\n            <Button\n              size=\"sm\"\n              onClick={handleConfirm}\n              disabled={!selectedDate || !amount || parseFloat(amount.replace(/,/g, '')) <= 0}\n              className=\"button-base button-action-primary\"\n            >\n              í™•ì¸\n            </Button>\n          </div>\n        </div>\n      </PopoverContent>\n    </Popover>\n  )\n}\n\n","import { useCallback } from 'react'\nimport { createClient } from '@/lib/supabase/client'\nimport { toast } from 'sonner'\nimport { logger } from '@/lib/logger'\nimport { markItemAsReceived, markItemAsReceiptCanceled, markItemAsStatementReceived, markItemAsStatementCanceled } from '@/stores/purchaseMemoryStore'\n\nexport interface ConfirmDateActionConfig {\n  field: 'statement_received' | 'actual_received'\n  confirmMessage: {\n    confirm: string\n    cancel: string\n  }\n  successMessage: {\n    confirm: string\n    cancel: string\n  }\n  completedText: string\n  waitingText: string\n}\n\nexport interface UseConfirmDateActionProps {\n  config: ConfirmDateActionConfig\n  currentUserName: string | null\n  canPerformAction: boolean\n  purchaseId?: number | string  // ë©”ëª¨ë¦¬ ìºì‹œ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•œ purchase ID\n  onUpdate?: () => void\n  onOptimisticUpdate?: (params: {\n    itemId: number\n    selectedDate?: Date\n    action: 'confirm' | 'cancel'\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n    }\n  }) => void\n}\n\nexport function useConfirmDateAction({\n  config,\n  currentUserName,\n  canPerformAction,\n  purchaseId,\n  onUpdate,\n  onOptimisticUpdate\n}: UseConfirmDateActionProps) {\n  const supabase = createClient()\n\n  const handleConfirm = useCallback(async (\n    itemId: number | string,\n    selectedDate: Date,\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n    }\n  ) => {\n    \n    if (!canPerformAction) {\n      logger.warn(`âŒ ê¶Œí•œ ì—†ìŒ`, { canPerformAction, currentUserName })\n      toast.error(`${config.field === 'statement_received' ? 'ê±°ë˜ëª…ì„¸ì„œ' : 'ì…ê³ '} í™•ì¸ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.`)\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      logger.error('âŒ ì˜ëª»ëœ ID', { itemId, numericId })\n      toast.error('ìœ íš¨í•˜ì§€ ì•Šì€ í•­ëª© ID ì…ë‹ˆë‹¤.')\n      return\n    }\n\n    // í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ\n    if (itemInfo) {\n      const confirmMessage = `í’ˆëª©ëª…: ${itemInfo.item_name || '-'}\nê·œê²©: ${itemInfo.specification || '-'}\nìˆ˜ëŸ‰: ${itemInfo.quantity?.toLocaleString() || 0}\në‹¨ê°€: â‚©${itemInfo.unit_price_value?.toLocaleString() || 0}\ní•©ê³„: â‚©${itemInfo.amount_value?.toLocaleString() || 0}\në¹„ê³ : ${itemInfo.remark || '-'}\n\n${config.confirmMessage.confirm}`\n      \n      if (!window.confirm(confirmMessage)) {\n        return\n      }\n    }\n\n    try {\n      let updateData: any\n\n      if (config.field === 'statement_received') {\n        updateData = {\n          is_statement_received: true,\n          statement_received_date: selectedDate.toISOString(),\n          statement_received_by_name: currentUserName\n        }\n      } else if (config.field === 'actual_received') {\n        updateData = {\n          actual_received_date: selectedDate.toISOString(),\n          is_received: true\n        }\n      }\n\n      logger.debug('ğŸ“ ì—…ë°ì´íŠ¸í•  ë°ì´í„°:', updateData)\n\n      const { data, error } = await supabase\n        .from('purchase_request_items')\n        .update(updateData)\n        .eq('id', numericId)\n        .select()\n\n      logger.debug('ğŸ“ DB ì—…ë°ì´íŠ¸ ê²°ê³¼:', { data, error })\n\n      if (error) {\n        logger.error('âŒ DB ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', error)\n        throw error\n      }\n\n      logger.info('âœ… DB ì—…ë°ì´íŠ¸ ì„±ê³µ', data)\n\n      // ğŸš€ ë©”ëª¨ë¦¬ ìºì‹œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸\n      if (purchaseId) {\n        if (config.field === 'actual_received') {\n          const memoryUpdated = markItemAsReceived(purchaseId, numericId, selectedDate.toISOString())\n          if (!memoryUpdated) {\n            logger.warn('[useConfirmDateAction] ë©”ëª¨ë¦¬ ìºì‹œ ì…ê³ ì™„ë£Œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { \n              purchaseId, \n              itemId: numericId \n            })\n          }\n        } else if (config.field === 'statement_received') {\n          const memoryUpdated = markItemAsStatementReceived(purchaseId, numericId, selectedDate.toISOString(), currentUserName || undefined)\n          if (!memoryUpdated) {\n            logger.warn('[useConfirmDateAction] ë©”ëª¨ë¦¬ ìºì‹œ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { \n              purchaseId, \n              itemId: numericId \n            })\n          }\n        }\n      }\n\n      if (onOptimisticUpdate) {\n        onOptimisticUpdate({\n          itemId: numericId,\n          selectedDate,\n          action: 'confirm',\n          itemInfo\n        })\n      }\n\n      // ê°•ì œ ìƒˆë¡œê³ ì¹¨ì„ ìœ„í•´ onUpdate í˜¸ì¶œ\n      if (onUpdate) {\n        onUpdate()\n      }\n      \n      toast.success(config.successMessage.confirm)\n    } catch (error) {\n      logger.error('âŒ ì „ì²´ ì²˜ë¦¬ ì‹¤íŒ¨', error)\n      toast.error(`${config.field === 'statement_received' ? 'ê±°ë˜ëª…ì„¸ì„œ' : 'ì…ê³ '} í™•ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.`)\n    }\n  }, [config, currentUserName, canPerformAction, purchaseId, onUpdate, onOptimisticUpdate, supabase])\n\n  const handleCancel = useCallback(async (\n    itemId: number | string,\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n    }\n  ) => {\n    if (!canPerformAction) {\n      logger.warn(`âŒ ì·¨ì†Œ ê¶Œí•œ ì—†ìŒ`, { canPerformAction, currentUserName })\n      toast.error(`${config.field === 'statement_received' ? 'ê±°ë˜ëª…ì„¸ì„œ' : 'ì…ê³ '} í™•ì¸ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.`)\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      toast.error('ìœ íš¨í•˜ì§€ ì•Šì€ í•­ëª© ID ì…ë‹ˆë‹¤.')\n      return\n    }\n\n    // í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ\n    if (itemInfo) {\n      const confirmMessage = `í’ˆëª©ëª…: ${itemInfo.item_name || '-'}\nê·œê²©: ${itemInfo.specification || '-'}\nìˆ˜ëŸ‰: ${itemInfo.quantity?.toLocaleString() || 0}\në‹¨ê°€: â‚©${itemInfo.unit_price_value?.toLocaleString() || 0}\ní•©ê³„: â‚©${itemInfo.amount_value?.toLocaleString() || 0}\në¹„ê³ : ${itemInfo.remark || '-'}\n\n${config.confirmMessage.cancel}`\n      \n      if (!window.confirm(confirmMessage)) {\n        return\n      }\n    }\n\n    try {\n      logger.debug(`ğŸ”„ ${config.field} í™•ì¸ ì·¨ì†Œ ì‹œì‘`, { \n        itemId, \n        itemName: itemInfo?.item_name \n      })\n\n      let updateData: any\n\n      if (config.field === 'statement_received') {\n        updateData = {\n          is_statement_received: false,\n          statement_received_date: null,\n          statement_received_by_name: null\n        }\n      } else if (config.field === 'actual_received') {\n        updateData = {\n          actual_received_date: null,\n          is_received: false\n        }\n      }\n\n      logger.debug('ğŸ”„ ì·¨ì†Œ ì—…ë°ì´íŠ¸í•  ë°ì´í„°:', updateData)\n\n      const { data, error } = await supabase\n        .from('purchase_request_items')\n        .update(updateData)\n        .eq('id', numericId)\n        .select()\n\n      logger.debug('ğŸ”„ ì·¨ì†Œ DB ì—…ë°ì´íŠ¸ ê²°ê³¼:', { data, error })\n\n      if (error) {\n        logger.error('âŒ DB ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', error)\n        throw error\n      }\n\n      logger.info(`âœ… ${config.field} í™•ì¸ ì·¨ì†Œ ì„±ê³µ`, data)\n\n      // ğŸš€ ë©”ëª¨ë¦¬ ìºì‹œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸\n      if (purchaseId) {\n        if (config.field === 'actual_received') {\n          const memoryUpdated = markItemAsReceiptCanceled(purchaseId, numericId)\n          if (!memoryUpdated) {\n            logger.warn('[useConfirmDateAction] ë©”ëª¨ë¦¬ ìºì‹œ ì…ê³ ì·¨ì†Œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { \n              purchaseId, \n              itemId: numericId \n            })\n          }\n        } else if (config.field === 'statement_received') {\n          const memoryUpdated = markItemAsStatementCanceled(purchaseId, numericId)\n          if (!memoryUpdated) {\n            logger.warn('[useConfirmDateAction] ë©”ëª¨ë¦¬ ìºì‹œ ê±°ë˜ëª…ì„¸ì„œ ì·¨ì†Œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { \n              purchaseId, \n              itemId: numericId \n            })\n          }\n        }\n      }\n\n      if (onOptimisticUpdate) {\n        onOptimisticUpdate({\n          itemId: numericId,\n          action: 'cancel',\n          itemInfo\n        })\n      }\n\n      // ê°•ì œ ìƒˆë¡œê³ ì¹¨ì„ ìœ„í•´ onUpdate í˜¸ì¶œ\n      if (onUpdate) {\n        onUpdate()\n      }\n      \n      toast.success(config.successMessage.cancel)\n    } catch (error) {\n      logger.error(`âŒ ${config.field} í™•ì¸ ì·¨ì†Œ ì‹¤íŒ¨`, error)\n      toast.error(`${config.field === 'statement_received' ? 'ê±°ë˜ëª…ì„¸ì„œ' : 'ì…ê³ '} í™•ì¸ ì·¨ì†Œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.`)\n    }\n  }, [config, canPerformAction, purchaseId, onUpdate, onOptimisticUpdate, supabase])\n\n  const isCompleted = useCallback((item: any) => {\n    if (config.field === 'statement_received') {\n      return item.is_statement_received\n    } else if (config.field === 'actual_received') {\n      return item.is_received // actual_received_date ëŒ€ì‹  is_received í•„ë“œ ì‚¬ìš©\n    }\n    return false\n  }, [config.field])\n\n  const getCompletedDate = useCallback((item: any) => {\n    if (config.field === 'statement_received') {\n      return item.statement_received_date\n    } else if (config.field === 'actual_received') {\n      return item.actual_received_date\n    }\n    return null\n  }, [config.field])\n\n  const getCompletedByName = useCallback((item: any) => {\n    if (config.field === 'statement_received') {\n      return item.statement_received_by_name\n    } else if (config.field === 'actual_received') {\n      // ì…ê³ ì™„ë£ŒëŠ” ì²˜ë¦¬ì ì •ë³´ë¥¼ ê¸°ë¡í•˜ì§€ ì•ŠìŒ\n      return null\n    }\n    return null\n  }, [config.field])\n\n  return {\n    config,\n    handleConfirm,\n    handleCancel,\n    isCompleted,\n    getCompletedDate,\n    getCompletedByName\n  }\n}","import { useEffect, useState, useRef, useCallback, useMemo, memo } from 'react'\nimport { createClient } from '@/lib/supabase/client'\nimport { PurchaseRequestWithDetails, Purchase, Vendor } from '@/types/purchase'\nimport { findPurchaseInMemory, markItemAsPaymentCompleted, markPurchaseAsPaymentCompleted, markItemAsReceived, markPurchaseAsReceived, markItemAsPaymentCanceled, markItemAsStatementReceived, markItemAsStatementCanceled, usePurchaseMemory, updatePurchaseInMemory, removeItemFromMemory, markItemAsExpenditureSet } from '@/stores/purchaseMemoryStore'\nimport { formatDate } from '@/utils/helpers'\nimport { DatePickerPopover } from '@/components/ui/date-picker-popover'\nimport { DateAmountPickerPopover } from '@/components/ui/date-amount-picker-popover'\nimport { \n  Calendar, \n  User, \n  Building2, \n  Package, \n  CreditCard,\n  X,\n  FileText,\n  DollarSign,\n  Edit2,\n  Trash2,\n  Save,\n  Plus,\n  CheckCircle,\n  XCircle,\n  Check,\n  Truck\n} from 'lucide-react'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog'\nimport { toast } from 'sonner'\nimport { logger } from '@/lib/logger'\nimport { useConfirmDateAction } from '@/hooks/useConfirmDateAction'\nimport { format as formatDateInput } from 'date-fns'\n\ninterface PurchaseDetailModalProps {\n  purchaseId: number | null\n  isOpen: boolean\n  onClose: () => void\n  embedded?: boolean  // Dialog ì—†ì´ ë‚´ìš©ë§Œ ë Œë”ë§\n  currentUserRoles?: string[]\n  activeTab?: string\n  onRefresh?: (forceRefresh?: boolean, options?: { silent?: boolean }) => void | Promise<void>\n  onOptimisticUpdate?: (purchaseId: number, updater: (prev: Purchase) => Purchase) => void\n  onDelete?: (purchase: PurchaseRequestWithDetails) => void\n}\n\nfunction PurchaseDetailModal({ \n  purchaseId, \n  isOpen, \n  onClose, \n  embedded = false,\n  currentUserRoles = [],\n  activeTab,\n  onRefresh,\n  onOptimisticUpdate,\n  onDelete\n}: PurchaseDetailModalProps) {\n  const { allPurchases, lastFetch } = usePurchaseMemory(); // ğŸš€ ë©”ëª¨ë¦¬ ìºì‹œ ì‹¤ì‹œê°„ ë™ê¸°í™”\n  \n  const [loading, setLoading] = useState(false)\n  const [purchase, setPurchase] = useState<PurchaseRequestWithDetails | null>(null)\n  const [isEditing, setIsEditing] = useState(false)\n  const [editedPurchase, setEditedPurchase] = useState<PurchaseRequestWithDetails | null>(null)\n  const [editedItems, setEditedItems] = useState<any[]>([])\n  const [deletedItemIds, setDeletedItemIds] = useState<number[]>([])\n  const [userRoles, setUserRoles] = useState<string[]>([])\n  const [currentUserName, setCurrentUserName] = useState<string>('')\n  const [columnWidths, setColumnWidths] = useState<number[]>([])\n  const [focusedInput, setFocusedInput] = useState<string | null>(null)\n  \n  // ë©”ëª¨ë¦¬ ìºì‹œ ë™ê¸°í™”ëŠ” useEffectì—ì„œ ì²˜ë¦¬\n\n  // ğŸš€ ì‹¤ì‹œê°„ items ë°ì´í„° (ë¡œì»¬ purchase stateë¥¼ ìš°ì„  ì‚¬ìš©)\n  const currentItems = useMemo(() => {\n    // purchase stateë¥¼ ìš°ì„  ì‚¬ìš© (ë¡œì»¬ ìƒíƒœê°€ ê°€ì¥ ìµœì‹ )\n    if (purchase?.items && purchase.items.length > 0) {\n      return purchase.items;\n    }\n    if (purchase?.purchase_request_items && purchase.purchase_request_items.length > 0) {\n      return purchase.purchase_request_items;\n    }\n    \n    // purchase stateê°€ ì—†ìœ¼ë©´ ë©”ëª¨ë¦¬ ìºì‹œì—ì„œ ê°€ì ¸ì˜¤ê¸°\n    if (purchaseId && allPurchases) {\n      const memoryPurchase = allPurchases.find(p => p.id === purchaseId);\n      if (memoryPurchase) {\n        return (memoryPurchase.items && memoryPurchase.items.length > 0) ? memoryPurchase.items : (memoryPurchase.purchase_request_items || []);\n      }\n    }\n    \n    return [];\n  }, [purchase, purchaseId, allPurchases, lastFetch]); // purchase ê°ì²´ ì „ì²´ë¥¼ ì˜ì¡´ì„±ìœ¼ë¡œ ì‚¬ìš©í•˜ì—¬ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ë³´ì¥\n\n  const tableMinWidth = useMemo(() => {\n    if (columnWidths.length > 0) {\n      const columnGap = columnWidths.length > 1 ? (columnWidths.length - 1) * 12 : 0\n      const padding = 24\n      const total = columnWidths.reduce((sum, width) => sum + width, 0) + columnGap + padding\n      return Math.max(total, 720)\n    }\n\n    const baseColumns: number[] = [120, 200, 70, 90, 100, 150, 80] // í’ˆëª©ëª…, ê·œê²©, ìˆ˜ëŸ‰, ë‹¨ê°€, í•©ê³„, ë¹„ê³ , ìƒíƒœ\n\n    if (activeTab === 'purchase') {\n      baseColumns.push(120)\n    }\n\n    if (activeTab === 'receipt' || activeTab === 'done') {\n      baseColumns.push(120)\n    }\n\n    if (activeTab === 'receipt') {\n      baseColumns.push(140)\n    }\n\n    if (activeTab === 'done') {\n      baseColumns.push(100, 80, 110) // ê±°ë˜ëª…ì„¸ì„œ(100), íšŒê³„ìƒì…ê³ ì¼(80), ì§€ì¶œì •ë³´(110)\n    }\n\n    if (isEditing) {\n      baseColumns.push(110)\n    }\n\n    const columnGap = baseColumns.length > 1 ? (baseColumns.length - 1) * 12 : 0\n    const total = baseColumns.reduce((sum, width) => sum + width, 0) + columnGap + 48\n    return Math.max(total, 720)\n  }, [columnWidths, activeTab, isEditing])\n  const headerRowRef = useRef<HTMLDivElement>(null)\n  const supabase = createClient()\n  \n  // ì‚¬ìš©ì ê¶Œí•œ ë° ì´ë¦„ ì§ì ‘ ë¡œë“œ\n  useEffect(() => {\n    const loadUserRoles = async () => {\n      try {\n        // Supabase í™˜ê²½ ë³€ìˆ˜ í™•ì¸\n        const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\n        const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;\n        \n        if (!supabaseUrl || !supabaseAnonKey || supabaseUrl.includes('placeholder')) {\n          logger.warn('Supabase í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•ŠìŒ - PurchaseDetailModal');\n          return;\n        }\n\n        const { data: { user } } = await supabase.auth.getUser()\n        if (user) {\n          // ë¨¼ì € IDë¡œ ì‹œë„\n          let { data: employeeData } = await supabase\n            .from('employees')\n            .select('*')\n            .eq('id', user.id)\n            .maybeSingle()\n          \n          // IDë¡œ ëª» ì°¾ì•˜ìœ¼ë©´ ì´ë©”ì¼ë¡œ ì‹œë„\n          if (!employeeData && user.email) {\n            const { data: employeeByEmail } = await supabase\n              .from('employees')\n              .select('*')\n              .eq('email', user.email)\n              .maybeSingle()\n            \n            employeeData = employeeByEmail\n          }\n          \n          // ì‚¬ìš©ì ì´ë¦„ ì €ì¥\n          if (employeeData?.name) {\n            setCurrentUserName(employeeData.name)\n          }\n          \n          if (employeeData?.purchase_role) {\n            let roles: string[] = []\n            if (Array.isArray(employeeData.purchase_role)) {\n              roles = employeeData.purchase_role.map((r: any) => String(r).trim())\n            } else {\n              const roleString = String(employeeData.purchase_role)\n              roles = roleString\n                .split(',')\n                .map((r: string) => r.trim())\n                .filter((r: string) => r.length > 0)\n            }\n            setUserRoles(roles)\n          }\n        }\n      } catch (error) {\n      }\n    }\n    \n    if (isOpen) {\n      loadUserRoles()\n    }\n  }, [isOpen])\n  \n  // currentUserRolesê°€ ë°°ì—´ì´ ì•„ë‹ˆë©´ userRoles ì‚¬ìš©\n  const effectiveRoles = Array.isArray(currentUserRoles) && currentUserRoles.length > 0 \n    ? currentUserRoles \n    : userRoles\n  \n  // ê¶Œí•œ ì²´í¬\n  // ì „ì²´ ìˆ˜ì • ê¶Œí•œ (ëª¨ë“  í•„ë“œ ìˆ˜ì • ê°€ëŠ¥)\n  const canEditAll = effectiveRoles.includes('final_approver') || \n                     effectiveRoles.includes('app_admin') || \n                     effectiveRoles.includes('ceo')\n  \n  // lead buyer ì œí•œì  ìˆ˜ì • ê¶Œí•œ (ê¸ˆì•¡/ìˆ˜ëŸ‰ë§Œ ìˆ˜ì • ê°€ëŠ¥)\n  const canEditLimited = effectiveRoles.includes('lead buyer')\n  \n  // í†µí•© ìˆ˜ì • ê¶Œí•œ (ë‘˜ ì¤‘ í•˜ë‚˜ë¼ë„ ìˆìœ¼ë©´ ìˆ˜ì • ëª¨ë“œ í™œì„±í™”)\n  const canEdit = canEditAll || canEditLimited\n  \n  // ì‚­ì œ ê¶Œí•œ: ê´€ë¦¬ì ë˜ëŠ” ìš”ì²­ì ë³¸ì¸ (ë‹¨, ìŠ¹ì¸ëœ ìš”ì²­ì€ ê´€ë¦¬ìë§Œ, lead buyerëŠ” ì‚­ì œ ë¶ˆê°€)\n  const isApproved = purchase?.final_manager_status === 'approved';\n  const canDelete = isApproved \n    ? canEditAll  // ìŠ¹ì¸ëœ ìš”ì²­ì€ ê´€ë¦¬ìë§Œ ì‚­ì œ ê°€ëŠ¥ (lead buyer ì œì™¸)\n    : (canEditAll || (purchase?.requester_name === currentUserName))  // ë¯¸ìŠ¹ì¸ë„ lead buyer ì œì™¸\n  \n  // êµ¬ë§¤ ê¶Œí•œ ì²´í¬: app_admin + lead buyerë§Œ (ìš”ì²­ì ë³¸ì¸ ì œì™¸)\n  const canPurchase = effectiveRoles.includes('app_admin') || \n                     effectiveRoles.includes('lead buyer') || \n                     effectiveRoles.includes('lead buyer')\n  \n  // ì…ê³  ê¶Œí•œ ì²´í¬ \n  // 1. ê´€ë¦¬ìëŠ” ëª¨ë“  ê±´ ì…ê³  ì²˜ë¦¬ ê°€ëŠ¥\n  // 2. ìš”ì²­ìëŠ” ìì‹ ì˜ ìš”ì²­ê±´ë§Œ ì…ê³  ì²˜ë¦¬ ê°€ëŠ¥\n  const canReceiveItems = effectiveRoles.includes('app_admin') || \n                         (purchase?.requester_name === currentUserName)\n  // 2. ì¼ë°˜ ì§ì›ì€ ë³¸ì¸ì´ ìš”ì²­í•œ ê±´ë§Œ ì…ê³  ì²˜ë¦¬ ê°€ëŠ¥\n  const isAdmin = effectiveRoles.includes('final_approver') || \n                  effectiveRoles.includes('app_admin') || \n                  effectiveRoles.includes('ceo')\n  const isRequester = purchase?.requester_name === currentUserName\n  \n  // ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ & UTK í™•ì¸ ê¶Œí•œ: app_adminê³¼ lead buyerë§Œ ê°€ëŠ¥\n  const canReceiptCheck = effectiveRoles.includes('app_admin') || \n                         effectiveRoles.includes('lead buyer')\n  \n\n  // ëª¨ë‹¬ ë‚´ë¶€ ë°ì´í„°ë§Œ ìƒˆë¡œê³ ì¹¨í•˜ëŠ” í•¨ìˆ˜ (ëª¨ë‹¬ ë‹«ì§€ ì•ŠìŒ)\n  const refreshModalData = useCallback(async () => {\n    if (!purchaseId) return\n    \n    try {\n      // ğŸš€ ë©”ëª¨ë¦¬ì—ì„œ ë¨¼ì € ì°¾ê¸° (ì¦‰ì‹œ ìƒˆë¡œê³ ì¹¨)\n      const memoryPurchase = findPurchaseInMemory(purchaseId)\n      if (memoryPurchase) {\n        \n        // items í•„ë“œ ì •ê·œí™”: purchase_request_itemsë¥¼ itemsë¡œ ë³µì‚¬\n        const normalizedItems = (memoryPurchase.items && memoryPurchase.items.length > 0)\n          ? memoryPurchase.items \n          : (memoryPurchase.purchase_request_items || [])\n        \n        // ë©”ëª¨ë¦¬ ë°ì´í„°ë¥¼ PurchaseRequestWithDetails í˜•íƒœë¡œ ë³€í™˜\n        const purchaseData = {\n          ...memoryPurchase,\n          id: String(memoryPurchase.id), // PurchaseRequestëŠ” idê°€ string\n          is_po_generated: false, // Purchase íƒ€ì…ì—ëŠ” ì—†ì§€ë§Œ PurchaseRequestì— í•„ìˆ˜\n          items: normalizedItems, // ì •ê·œí™”ëœ items ì‚¬ìš©\n          purchase_request_items: normalizedItems, // í•˜ìœ„ í˜¸í™˜ì„±ì„ ìœ„í•´ ì–‘ìª½ ëª¨ë‘ ì„¤ì •\n          vendor: {\n            id: memoryPurchase.vendor_id,\n            vendor_name: memoryPurchase.vendor_name || 'ì•Œ ìˆ˜ ì—†ìŒ',\n            is_active: true\n          } as Vendor,\n          vendor_contacts: []\n        } as PurchaseRequestWithDetails\n        \n        setPurchase(purchaseData)\n        setEditedPurchase(purchaseData)\n        setEditedItems(normalizedItems.length > 0 ? normalizedItems : [])\n        return\n      }\n      \n      // ë©”ëª¨ë¦¬ì— ì—†ëŠ” ê²½ìš°ì—ë§Œ DBì—ì„œ ë¡œë“œ (fallback)\n      const supabase = createClient()\n      // ìµœì‹  êµ¬ë§¤ ìš”ì²­ ë°ì´í„° ë¡œë“œ\n      const { data, error } = await supabase\n        .from('purchase_requests')\n        .select(`\n          *,\n          vendors(id, vendor_name),\n          purchase_request_items(*)\n        `)\n        .eq('id', purchaseId)\n        .single()\n      \n      if (error) throw error\n\n      if (data) {\n        // ë¼ì¸ë„˜ë²„ ìˆœì„œëŒ€ë¡œ ì •ë ¬\n        const sortedItems = (data.purchase_request_items || []).sort((a: any, b: any) => {\n          const lineA = a.line_number || 999999;\n          const lineB = b.line_number || 999999;\n          return lineA - lineB;\n        });\n\n        const purchaseData = {\n          ...data,\n          items: sortedItems,\n          vendor: data.vendors || { id: 0, vendor_name: 'ì•Œ ìˆ˜ ì—†ìŒ' },\n          vendor_contacts: []\n        } as PurchaseRequestWithDetails\n\n        setPurchase(purchaseData)\n        setEditedPurchase(purchaseData)\n        setEditedItems(sortedItems)\n      }\n    } catch (error) {\n      logger.error('ëª¨ë‹¬ ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨', error)\n    }\n  }, [purchaseId])\n\n  // ğŸš€ ë©”ëª¨ë¦¬ ìºì‹œ ë³€ê²½ ì‹¤ì‹œê°„ ê°ì§€ ë° ëª¨ë‹¬ ë°ì´í„° ë™ê¸°í™”\n  useEffect(() => {\n    if (!purchaseId || !allPurchases || !purchase) return;\n\n    const memoryPurchase = allPurchases.find(p => p.id === purchaseId);\n    if (memoryPurchase) {\n      // ë©”ëª¨ë¦¬ ë°ì´í„°ë¡œ purchase state ì—…ë°ì´íŠ¸ (ê¹œë¹¡ì„ ì—†ì´ ì‹¤ì‹œê°„ ë°˜ì˜)\n      const normalizedItems = (memoryPurchase.items && memoryPurchase.items.length > 0) \n        ? memoryPurchase.items \n        : (memoryPurchase.purchase_request_items || []);\n      \n      const updatedPurchase = {\n        ...purchase,\n        ...memoryPurchase,\n        id: String(memoryPurchase.id),\n        items: normalizedItems,\n        purchase_request_items: normalizedItems\n      } as PurchaseRequestWithDetails;\n\n      setPurchase(updatedPurchase);\n      setEditedPurchase(updatedPurchase);\n      setEditedItems(normalizedItems.length > 0 ? normalizedItems : []);\n    }\n  }, [allPurchases, lastFetch]); // lastFetch ì¶”ê°€ë¡œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ê°•ì œ ê°ì§€\n\n  // ğŸš€ ëª¨ë‹¬ì´ ì—´ë¦´ ë•Œë§ˆë‹¤ ë©”ëª¨ë¦¬ì—ì„œ ìµœì‹  ë°ì´í„° ê°•ì œ ë™ê¸°í™”\n  useEffect(() => {\n    if (!isOpen || !purchaseId || !allPurchases) return;\n\n    const memoryPurchase = allPurchases.find(p => p.id === purchaseId);\n    if (memoryPurchase) {\n      const normalizedItems = (memoryPurchase.items && memoryPurchase.items.length > 0) \n        ? memoryPurchase.items \n        : (memoryPurchase.purchase_request_items || []);\n      \n      const updatedPurchase = {\n        ...memoryPurchase,\n        id: String(memoryPurchase.id),\n        is_po_generated: false,\n        items: normalizedItems,\n        purchase_request_items: normalizedItems,\n        vendor: {\n          id: memoryPurchase.vendor_id,\n          vendor_name: memoryPurchase.vendor_name || 'ì•Œ ìˆ˜ ì—†ìŒ',\n          is_active: true\n        } as Vendor,\n        vendor_contacts: []\n      } as PurchaseRequestWithDetails;\n\n      setPurchase(updatedPurchase);\n      setEditedPurchase(updatedPurchase);\n      setEditedItems(normalizedItems.length > 0 ? normalizedItems : []);\n    }\n  }, [isOpen, purchaseId, allPurchases]); // ëª¨ë‹¬ì´ ì—´ë¦´ ë•Œë§ˆë‹¤ ì‹¤í–‰\n  \n  // ì»´í¬ë„ŒíŠ¸ê°€ ë§ˆìš´íŠ¸ë  ë•Œ ì™¸ë¶€ ìƒˆë¡œê³ ì¹¨ì„ ë°©ì§€í•˜ëŠ” í”Œë˜ê·¸\n  const [isInitialLoad, setIsInitialLoad] = useState(true)\n  \n  // ì»¤ìŠ¤í…€ í›… ì„¤ì •\n  const purchaseIdNumber = purchaseId ? Number(purchaseId) : (purchase ? Number(purchase.id) : NaN)\n\n  const handleActualReceiptOptimisticUpdate = useCallback(({ itemId, selectedDate, action }: {\n    itemId: number\n    selectedDate?: Date\n    action: 'confirm' | 'cancel'\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n    }\n  }) => {\n    const itemIdStr = String(itemId)\n    const nowIso = new Date().toISOString()\n    const selectedDateIso = selectedDate ? selectedDate.toISOString() : undefined\n\n    const updateItems = (items?: any[]) => {\n      if (!items) return items\n      return items.map(item => {\n        if (String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_received: true,\n            actual_received_date: selectedDateIso,\n            received_at: nowIso\n          }\n        }\n\n        return {\n          ...item,\n          is_received: false,\n          actual_received_date: undefined,\n          received_at: undefined\n        }\n      })\n    }\n\n    setPurchase(prev => {\n      if (!prev) return prev\n      const updatedItems = updateItems(prev.items) || []\n      const total = updatedItems.length\n      const completed = updatedItems.filter(item => item.is_received).length\n      const allReceived = total > 0 && completed === total\n\n      return {\n        ...prev,\n        items: updatedItems,\n        is_received: allReceived,\n        received_at: allReceived ? (prev.received_at || nowIso) : undefined\n      }\n    })\n\n    setEditedPurchase(prev => {\n      if (!prev) return prev\n      const updatedItems = updateItems(prev.items) || []\n      return {\n        ...prev,\n        items: updatedItems\n      }\n    })\n\n    setEditedItems(prevItems => {\n      if (!prevItems || prevItems.length === 0) return prevItems\n      return prevItems.map(item => {\n        if (!item.id || String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_received: true,\n            actual_received_date: selectedDateIso,\n            received_at: nowIso\n          }\n        }\n\n        return {\n          ...item,\n          is_received: false,\n          actual_received_date: undefined,\n          received_at: undefined\n        }\n      })\n    })\n\n    if (!Number.isNaN(purchaseIdNumber)) {\n      onOptimisticUpdate?.(purchaseIdNumber, prevPurchase => {\n        const updatedItems = updateItems(prevPurchase.items) || prevPurchase.items || []\n        const total = updatedItems.length || prevPurchase.items?.length || 0\n        const completed = updatedItems.filter(item => item.is_received).length\n        const allReceived = total > 0 && completed === total\n\n        return {\n          ...prevPurchase,\n          items: updatedItems,\n          is_received: allReceived,\n          received_at: allReceived ? (prevPurchase.received_at || nowIso) : undefined\n        }\n      })\n    }\n  }, [onOptimisticUpdate, purchaseIdNumber])\n\n  const handleStatementReceivedOptimisticUpdate = useCallback(({ itemId, selectedDate, action }: {\n    itemId: number\n    selectedDate?: Date\n    action: 'confirm' | 'cancel'\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n    }\n  }) => {\n    const itemIdStr = String(itemId)\n    const selectedDateIso = selectedDate ? selectedDate.toISOString() : undefined\n\n    let nextAllCompleted = false\n    let nextStatementAt: string | null = null\n\n    setPurchase(prev => {\n      if (!prev) return prev\n\n      const updatedItems = (prev.items || []).map(item => {\n        if (String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_statement_received: true,\n            statement_received_date: selectedDateIso,\n            statement_received_by_name: currentUserName\n          }\n        }\n\n        return {\n          ...item,\n          is_statement_received: false,\n          statement_received_date: null,\n          statement_received_by_name: null\n        }\n      })\n\n      nextAllCompleted = updatedItems.length > 0 && updatedItems.every(item => item.is_statement_received)\n      nextStatementAt = nextAllCompleted\n        ? (selectedDateIso || prev.statement_received_at || new Date().toISOString())\n        : null\n\n      return {\n        ...prev,\n        items: updatedItems,\n        is_statement_received: nextAllCompleted,\n        statement_received_at: nextStatementAt\n      }\n    })\n\n    setEditedPurchase(prev => {\n      if (!prev) return prev\n\n      const updatedItems = (prev.items || []).map(item => {\n        if (String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_statement_received: true,\n            statement_received_date: selectedDateIso,\n            statement_received_by_name: currentUserName\n          }\n        }\n\n        return {\n          ...item,\n          is_statement_received: false,\n          statement_received_date: null,\n          statement_received_by_name: null\n        }\n      })\n\n      return {\n        ...prev,\n        items: updatedItems,\n        is_statement_received: nextAllCompleted,\n        statement_received_at: nextStatementAt\n      }\n    })\n\n    setEditedItems(prevItems => {\n      if (!prevItems) return prevItems\n      return prevItems.map(item => {\n        if (String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_statement_received: true,\n            statement_received_date: selectedDateIso,\n            statement_received_by_name: currentUserName\n          }\n        }\n\n        return {\n          ...item,\n          is_statement_received: false,\n          statement_received_date: null,\n          statement_received_by_name: null\n        }\n      })\n    })\n\n    if (!Number.isNaN(purchaseIdNumber)) {\n      onOptimisticUpdate?.(purchaseIdNumber, prevPurchase => {\n        const updatedItems = (prevPurchase.items || []).map(item => {\n          if (String(item.id) !== itemIdStr) return item\n\n          if (action === 'confirm') {\n            return {\n              ...item,\n              is_statement_received: true,\n              statement_received_date: selectedDateIso,\n              statement_received_by_name: currentUserName\n            }\n          }\n\n          return {\n            ...item,\n            is_statement_received: false,\n            statement_received_date: null,\n            statement_received_by_name: null\n          }\n        })\n\n        const allCompleted = updatedItems.length > 0 && updatedItems.every(item => item.is_statement_received)\n\n        return {\n          ...prevPurchase,\n          items: updatedItems,\n          is_statement_received: allCompleted\n        }\n      })\n    }\n\n    // purchase_requests ë ˆë²¨ í”Œë˜ê·¸ë„ ì—…ë°ì´íŠ¸\n    if (purchase && nextAllCompleted !== undefined) {\n      const supabase = createClient()\n      supabase\n        .from('purchase_requests')\n        .update({\n          is_statement_received: nextAllCompleted,\n          statement_received_at: nextStatementAt\n        })\n        .eq('id', purchase.id)\n        .then(({ error }: { error: any }) => {\n          if (error) {\n            logger.error('ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ purchase_requests ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', error)\n          }\n        })\n    }\n  }, [currentUserName, onOptimisticUpdate, purchaseIdNumber, purchase])\n\n  const statementReceivedAction = useConfirmDateAction({\n    config: {\n      field: 'statement_received',\n      confirmMessage: {\n        confirm: 'ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ì„ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?',\n        cancel: 'ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?'\n      },\n      successMessage: {\n        confirm: 'ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.',\n        cancel: 'ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.'\n      },\n      completedText: 'âœ“ ì™„ë£Œ',\n      waitingText: 'ëŒ€ê¸°'\n    },\n    currentUserName,\n    canPerformAction: canReceiptCheck,\n    purchaseId: purchase?.id,\n    onUpdate: refreshModalData,\n    onOptimisticUpdate: handleStatementReceivedOptimisticUpdate\n  })\n\n  const actualReceivedAction = useConfirmDateAction({\n    config: {\n      field: 'actual_received',\n      confirmMessage: {\n        confirm: 'ì‹¤ì œ ì…ê³  ì²˜ë¦¬ë¥¼ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?',\n        cancel: 'ì‹¤ì œ ì…ê³  ì²˜ë¦¬ë¥¼ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?'\n      },\n      successMessage: {\n        confirm: 'ì‹¤ì œ ì…ê³  ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.',\n        cancel: 'ì‹¤ì œ ì…ê³  ì²˜ë¦¬ê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.'\n      },\n      completedText: 'ì…ê³ ì™„ë£Œ',\n      waitingText: 'ì…ê³ ëŒ€ê¸°'\n    },\n    currentUserName,\n    canPerformAction: canReceiptCheck,\n    purchaseId: purchase?.id,\n    onUpdate: refreshModalData,\n    onOptimisticUpdate: handleActualReceiptOptimisticUpdate\n  })\n  \n  // ë‚ ì§œ ì„ íƒ í•¸ë“¤ëŸ¬ë“¤\n  \n  \n  // ìŠ¹ì¸ ê¶Œí•œ ì²´í¬\n const canApproveMiddle = effectiveRoles.includes('middle_manager') || \n                          effectiveRoles.includes('app_admin') || \n                          effectiveRoles.includes('ceo')\n \n const canApproveFinal = effectiveRoles.includes('final_approver') || \n                         effectiveRoles.includes('app_admin') || \n                         effectiveRoles.includes('ceo')\n \n const approvalPillClass = 'inline-flex items-center gap-1 business-radius-badge px-2 py-0.5 badge-text leading-tight'\n const approvalButtonClass = 'inline-flex items-center gap-1 business-radius-badge !h-auto !min-h-0 !px-2.5 !py-0.5 badge-text leading-tight'\n const approvalWaitingPillClass = 'inline-flex items-center gap-1 business-radius-badge px-2.5 py-0.5 badge-text leading-tight'\n \n \n  useEffect(() => {\n    if (purchaseId && isOpen) {\n      // ğŸš€ ë©”ëª¨ë¦¬ì—ì„œ ì¦‰ì‹œ ë°ì´í„° í™•ì¸ í›„ ë¡œë“œ\n      const memoryPurchase = findPurchaseInMemory(purchaseId)\n      if (memoryPurchase) {\n        // ë©”ëª¨ë¦¬ì— ìˆìœ¼ë©´ ì¦‰ì‹œ ë¡œë“œ (loading ìƒíƒœ ì—†ìŒ)\n        const purchaseData = {\n          ...memoryPurchase,\n          id: String(memoryPurchase.id), // PurchaseRequestëŠ” idê°€ string\n          is_po_generated: false, // Purchase íƒ€ì…ì—ëŠ” ì—†ì§€ë§Œ PurchaseRequestì— í•„ìˆ˜\n          vendor: {\n            id: memoryPurchase.vendor_id,\n            vendor_name: memoryPurchase.vendor_name || 'ì•Œ ìˆ˜ ì—†ìŒ',\n            is_active: true\n          } as Vendor,\n          vendor_contacts: []\n        } as PurchaseRequestWithDetails\n        \n        setPurchase(purchaseData)\n        setEditedPurchase(purchaseData)\n        setEditedItems(memoryPurchase.items || [])\n      } else {\n        // ë©”ëª¨ë¦¬ì— ì—†ìœ¼ë©´ ê¸°ì¡´ ë°©ì‹ìœ¼ë¡œ ë¡œë“œ\n        loadPurchaseDetail(purchaseId.toString())\n      }\n      setIsEditing(false) // ëª¨ë‹¬ ì—´ ë•Œë§ˆë‹¤ í¸ì§‘ ëª¨ë“œ ì´ˆê¸°í™”\n    }\n  }, [purchaseId, isOpen])\n\n  // ì¹¼ëŸ¼ ë„ˆë¹„ ê³„ì‚° (í…ìŠ¤íŠ¸ ê¸¸ì´ ê¸°ë°˜)\n  const calculateOptimalColumnWidths = useCallback(() => {\n    // itemsì™€ purchase_request_items ë‘˜ ë‹¤ í™•ì¸\n    const items = (purchase?.items && purchase.items.length > 0) \n      ? purchase.items \n      : (purchase?.purchase_request_items && purchase.purchase_request_items.length > 0)\n      ? purchase.purchase_request_items\n      : []\n    \n    if (items.length === 0) return []\n\n    const columnConfigs = [\n      { key: 'item_name', minWidth: 80, maxWidth: 500, baseWidth: 80 },\n      { key: 'specification', minWidth: 200, maxWidth: 200, baseWidth: 200, isFixed: true }, // ê³ ì • ë„ˆë¹„ 200px\n      { key: 'quantity', minWidth: 70, maxWidth: 100, baseWidth: 70 },\n      { key: 'unit_price', minWidth: 90, maxWidth: 150, baseWidth: 90 },\n      { key: 'total_price', minWidth: 100, maxWidth: 180, baseWidth: 100 },\n      { key: 'remarks', minWidth: 150, maxWidth: 150, baseWidth: 150, isFixed: true }, // ê³ ì • ë„ˆë¹„ 150px\n      { key: 'status', minWidth: 80, maxWidth: 120, baseWidth: 80 }\n    ]\n\n      // ì¶”ê°€ ì¹¼ëŸ¼ë“¤ (íƒ­ë³„)\n      if (activeTab === 'receipt') {\n        columnConfigs.push({ key: 'actual_receipt_date', minWidth: 100, maxWidth: 160, baseWidth: 100, isFixed: false })\n      }\n      if (activeTab === 'done') {\n        columnConfigs.push(\n          { key: 'transaction_confirm', minWidth: 100, maxWidth: 160, baseWidth: 100, isFixed: false },\n          { key: 'accounting_date', minWidth: 80, maxWidth: 80, baseWidth: 80, isFixed: true },\n          { key: 'expenditure_info', minWidth: 100, maxWidth: 200, baseWidth: 100, isFixed: false }\n        )\n      }\n\n    const calculatedWidths = columnConfigs.map((config, index) => {\n      let maxLength = 4 // ìµœì†Œ 4ì\n\n      // í—¤ë” í…ìŠ¤íŠ¸ ê¸¸ì´ ê³ ë ¤ (íƒ­ë³„)\n      const getHeaders = () => {\n        const statusHeader = activeTab === 'purchase'\n          ? 'êµ¬ë§¤ìƒíƒœ'\n          : (activeTab === 'receipt' || activeTab === 'done')\n          ? 'ì…ê³ ìƒíƒœ'\n          : 'ìƒíƒœ'\n\n        // ìŠ¹ì¸ëŒ€ê¸°íƒ­ì—ì„œëŠ” ìƒíƒœ ì¹¼ëŸ¼ ì œì™¸\n        const baseHeaders = activeTab === 'pending' \n          ? ['í’ˆëª©ëª…', 'ê·œê²©', 'ìˆ˜ëŸ‰', 'ë‹¨ê°€', 'í•©ê³„', 'ë¹„ê³ ']\n          : ['í’ˆëª©ëª…', 'ê·œê²©', 'ìˆ˜ëŸ‰', 'ë‹¨ê°€', 'í•©ê³„', 'ë¹„ê³ ', statusHeader]\n        if (activeTab === 'receipt') {\n          return [...baseHeaders, 'ì‹¤ì œì…ê³ ì¼']\n        } else if (activeTab === 'done') {\n          return [...baseHeaders, 'ê±°ë˜ëª…ì„¸ì„œ í™•ì¸', 'íšŒê³„ìƒ ì…ê³ ì¼', 'ì§€ì¶œì •ë³´']\n        }\n        return baseHeaders\n      }\n      \n      const headers = getHeaders()\n      if (headers[index]) {\n        maxLength = Math.max(maxLength, headers[index].length)\n      }\n\n      // ì‹¤ì œ ë°ì´í„°ì—ì„œ ìµœëŒ€ ê¸¸ì´ ì°¾ê¸°\n      items.forEach(item => {\n        let cellValue = ''\n        switch (config.key) {\n          case 'item_name':\n            cellValue = item.item_name || ''\n            break\n          case 'specification':\n            cellValue = item.specification || ''\n            break\n          case 'quantity':\n            cellValue = item.quantity?.toString() || ''\n            break\n          case 'unit_price':\n            cellValue = item.unit_price_value != null ? item.unit_price_value.toLocaleString() : ''\n            break\n          case 'total_price':\n            if (item.amount_value != null) {\n              cellValue = item.amount_value.toLocaleString()\n            } else if (item.quantity != null && item.unit_price_value != null) {\n              cellValue = (Number(item.quantity) * Number(item.unit_price_value)).toLocaleString()\n            } else {\n              cellValue = ''\n            }\n            break\n          case 'remarks':\n            cellValue = item.remark || ''\n            break\n          case 'status':\n            cellValue = getStatusDisplay(item) || ''\n            break\n          case 'actual_receipt_date':\n            cellValue = item.actual_received_date ? formatDate(item.actual_received_date) : ''\n            break\n          case 'transaction_confirm':\n            cellValue = item.is_statement_received ? 'í™•ì¸ì™„ë£Œ' : 'ë¯¸í™•ì¸'\n            break\n          case 'accounting_date':\n            cellValue = item.statement_received_date ? formatDate(item.statement_received_date) : ''\n            break\n          case 'expenditure_info':\n            // ì§€ì¶œì •ë³´ëŠ” ë‚ ì§œì™€ ê¸ˆì•¡ì´ 2ì¤„ë¡œ í‘œì‹œë˜ë¯€ë¡œ íŠ¹ë³„ ì²˜ë¦¬\n            if (item.expenditure_date && item.expenditure_amount !== null && item.expenditure_amount !== undefined) {\n              // ì‹¤ì œ í‘œì‹œ í˜•ì‹: \"2025. 11. 25.\" (ì•½ 14ì)\n              cellValue = '2025. 11. 25.' // ë‚ ì§œ í˜•ì‹ ê³ ì • ê¸¸ì´\n            } else {\n              cellValue = 'ì§€ì¶œì…ë ¥' // ë²„íŠ¼ í…ìŠ¤íŠ¸\n            }\n            break\n        }\n        \n        // í•œê¸€/ì˜ë¬¸ í˜¼í•© í…ìŠ¤íŠ¸ ê¸¸ì´ ê³„ì‚° (í•œê¸€ì€ 1.5ë°° ê°€ì¤‘ì¹˜)\n        const adjustedLength = cellValue.split('').reduce((acc, char) => {\n          return acc + (/[ê°€-í£]/.test(char) ? 1.5 : 1)\n        }, 0)\n        \n        maxLength = Math.max(maxLength, Math.ceil(adjustedLength))\n      })\n\n      // ê³ ì • ë„ˆë¹„ ì¹¼ëŸ¼ì€ ë°”ë¡œ ë°˜í™˜\n      if (config.isFixed) {\n        return config.baseWidth\n      }\n      \n      // ê¸¸ì´ë¥¼ í”½ì…€ë¡œ ë³€í™˜ (ê¸€ìë‹¹ ì•½ 7px + ì—¬ë°± 20px)\n      let calculatedWidth = Math.max(\n        config.minWidth,\n        Math.min(config.maxWidth, maxLength * 7 + 20)\n      )\n      \n      // ì§€ì¶œì •ë³´ ì¹¼ëŸ¼ì€ ì‹¤ì œ í‘œì‹œë˜ëŠ” í…ìŠ¤íŠ¸ê°€ 2ì¤„ì´ë¯€ë¡œ ë” ì •í™•í•œ ê³„ì‚°\n      if (config.key === 'expenditure_info') {\n        // ë‚ ì§œ í˜•ì‹ \"2025. 11. 25.\" ê¸°ì¤€ìœ¼ë¡œ ê³ ì •\n        // 2ì¤„ í‘œì‹œì´ë¯€ë¡œ ì¶©ë¶„í•œ ì—¬ë°±ì„ ì£¼ë˜ ìµœì†Œí™”\n        calculatedWidth = 110 // ê³ ì • ë„ˆë¹„ë¡œ ì„¤ì •\n      }\n\n      return calculatedWidth\n    })\n\n    setColumnWidths(calculatedWidths)\n    return calculatedWidths\n  }, [purchase, activeTab])\n\n  // ìƒíƒœ í‘œì‹œ í…ìŠ¤íŠ¸ ë°˜í™˜ í•¨ìˆ˜\n  const getStatusDisplay = (item: any) => {\n    if (activeTab === 'purchase') {\n      return item.is_payment_completed ? 'êµ¬ë§¤ì™„ë£Œ' : 'êµ¬ë§¤ìš”ì²­'\n    } else if (activeTab === 'receipt') {\n      return item.is_received ? 'ì…ê³ ' : 'ì…ê³ ëŒ€ê¸°'\n    }\n    return item.is_payment_completed ? 'êµ¬ë§¤ì™„ë£Œ' : 'êµ¬ë§¤ìš”ì²­'\n  }\n\n  // ë™ì  gridTemplateColumns ìƒì„±\n  const getGridTemplateColumns = () => {\n    // ë™ì  ê³„ì‚°ëœ ë„ˆë¹„ê°€ ìˆìœ¼ë©´ ì‚¬ìš© (ë‹¨, íŠ¹ì • ì»¬ëŸ¼ì€ ê³ ì •ê°’ ê°•ì œ)\n    if (columnWidths.length > 0) {\n      const widths = columnWidths.map(width => `${width}px`)\n      \n      // ë™ì  ê³„ì‚°ëœ ê°’ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš© (ê³ ì •ê°’ ì œê±°)\n      // ëª¨ë“  ì¹¼ëŸ¼ì´ ë‚´ìš©ì— ë§ê²Œ ë™ì ìœ¼ë¡œ ì¡°ì ˆë¨\n      \n      return widths.join(' ')\n    }\n    \n    // ê¸°ë³¸ê°’ (ë°ì´í„° ë¡œë“œ ì „)\n    // [í’ˆëª©ëª…, ê·œê²©, ìˆ˜ëŸ‰, ë‹¨ê°€, í•©ê³„, ë¹„ê³ ]\n    let baseColumns = ['minmax(80px, 1fr)', '200px', '70px', '90px', '100px', '150px']\n    \n    // isEditingì— ë”°ë¼ ìƒíƒœ ë˜ëŠ” ì‚­ì œ ì¹¼ëŸ¼ ì¶”ê°€\n    if (isEditing) {\n      baseColumns.push('80px') // ì‚­ì œ\n    } else {\n      baseColumns.push('80px') // ìƒíƒœ\n    }\n    \n    // íƒ­ë³„ ì¶”ê°€ ì¹¼ëŸ¼\n    if (activeTab === 'receipt') {\n      return [...baseColumns, '100px'].join(' ')\n    } else if (activeTab === 'done') {\n      return [...baseColumns, '100px', '80px', '110px'].join(' ') // ê±°ë˜ëª…ì„¸ì„œ, íšŒê³„ìƒì…ê³ ì¼, ì§€ì¶œì •ë³´\n    }\n    \n    return baseColumns.join(' ')\n  }\n\n  // ë ˆê±°ì‹œ measureColumnWidths í•¨ìˆ˜ (í˜¸í™˜ì„± ìœ ì§€)\n  const measureColumnWidths = () => {\n    calculateOptimalColumnWidths()\n  }\n\n  // View ëª¨ë“œì—ì„œ ì¹¼ëŸ¼ ë„ˆë¹„ ê³„ì‚° (ë°ì´í„° ë¡œë“œ í›„)\n  // ë¹„ë™ê¸°ë¡œ ì²˜ë¦¬í•˜ì—¬ ëª¨ë‹¬ì´ ë¨¼ì € í‘œì‹œë˜ë„ë¡ í•¨\n  useEffect(() => {\n    // itemsì™€ purchase_request_items ë‘˜ ë‹¤ í™•ì¸\n    const hasItems = (purchase?.items && purchase.items.length > 0) || \n                     (purchase?.purchase_request_items && purchase.purchase_request_items.length > 0)\n    \n    if (purchase && hasItems && !isEditing) {\n      // requestAnimationFrameìœ¼ë¡œ ë‹¤ìŒ í”„ë ˆì„ì— ê³„ì‚°í•˜ì—¬ ëª¨ë‹¬ ë Œë”ë§ì„ ë¸”ë¡œí‚¹í•˜ì§€ ì•ŠìŒ\n      requestAnimationFrame(() => {\n        calculateOptimalColumnWidths()\n      })\n    }\n  }, [purchase, isEditing, activeTab, calculateOptimalColumnWidths])\n\n  // Edit ëª¨ë“œ ì „í™˜ ì‹œ ë„ˆë¹„ ê³„ì‚°\n  const handleEditToggle = (editing: boolean) => {\n    if (editing && !isEditing) {\n      // Edit ëª¨ë“œë¡œ ì „í™˜í•  ë•Œ í˜„ì¬ ë°ì´í„°ë¡œ ì´ˆê¸°í™”\n      setEditedPurchase(purchase)\n      setEditedItems(currentItems || [])\n      setDeletedItemIds([])\n      // Edit ëª¨ë“œë¡œ ì „í™˜í•˜ê¸° ì „ì— í˜„ì¬ ë„ˆë¹„ ê³„ì‚°\n      calculateOptimalColumnWidths()\n    }\n    setIsEditing(editing)\n  }\n\n  const loadPurchaseDetail = async (id: string) => {\n    try {\n      // ğŸš€ ë©”ëª¨ë¦¬ì—ì„œ ë¨¼ì € ì°¾ê¸° (ë¡œë”© ìƒíƒœ ì—†ì´ ì¦‰ì‹œ ë¡œë“œ)\n      const memoryPurchase = findPurchaseInMemory(id)\n      if (memoryPurchase) {\n        // ë©”ëª¨ë¦¬ ë°ì´í„°ë¥¼ PurchaseRequestWithDetails í˜•íƒœë¡œ ë³€í™˜\n        const purchaseData = {\n          ...memoryPurchase,\n          id: String(memoryPurchase.id), // PurchaseRequestëŠ” idê°€ string\n          is_po_generated: false, // Purchase íƒ€ì…ì—ëŠ” ì—†ì§€ë§Œ PurchaseRequestì— í•„ìˆ˜\n          vendor: {\n            id: memoryPurchase.vendor_id,\n            vendor_name: memoryPurchase.vendor_name || 'ì•Œ ìˆ˜ ì—†ìŒ',\n            is_active: true\n          } as Vendor,\n          vendor_contacts: []\n        } as PurchaseRequestWithDetails\n        \n        setPurchase(purchaseData)\n        setEditedPurchase(purchaseData)\n        setEditedItems(memoryPurchase.items || [])\n        return\n      }\n      \n      // ë©”ëª¨ë¦¬ì— ì—†ëŠ” ê²½ìš°ì—ë§Œ ë¡œë”© ìƒíƒœ í‘œì‹œ í›„ DBì—ì„œ ë¡œë“œ (fallback)\n      setLoading(true)\n      const supabase = createClient()\n      \n      const { data, error } = await supabase\n        .from('purchase_requests')\n        .select(`\n          *,\n          vendors(id, vendor_name),\n          purchase_request_items(*)\n        `)\n        .eq('id', id)\n        .single()\n\n      if (error) throw error\n\n      if (data) {\n        // ë¼ì¸ë„˜ë²„ ìˆœì„œëŒ€ë¡œ ì •ë ¬\n        const sortedItems = (data.purchase_request_items || []).sort((a: any, b: any) => {\n          const lineA = a.line_number || 999999;\n          const lineB = b.line_number || 999999;\n          return lineA - lineB;\n        });\n\n        const purchaseData = {\n          ...data,\n          items: sortedItems,\n          vendor: data.vendors || { id: 0, vendor_name: 'ì•Œ ìˆ˜ ì—†ìŒ' },\n          vendor_contacts: []\n        } as PurchaseRequestWithDetails\n        setPurchase(purchaseData)\n        setEditedPurchase(purchaseData)\n        setEditedItems(sortedItems)\n      }\n    } catch (error) {\n      logger.error('[PurchaseDetailModal] ë°œì£¼ ìƒì„¸ ë¡œë“œ ì‹¤íŒ¨:', error)\n      toast.error('ë°œì£¼ ìƒì„¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const getStatusBadge = () => {\n    if (!purchase) return null\n    \n    // payment_category ìš°ì„  í™•ì¸\n    if (purchase.payment_category) {\n      const category = purchase.payment_category.trim()\n      \n      if (category === 'ë°œì£¼') {\n        return <span className=\"badge-stats bg-green-500 text-white\">ë°œì£¼</span>\n      } else if (category === 'êµ¬ë§¤ìš”ì²­') {\n        return <span className=\"badge-stats bg-blue-500 text-white\">êµ¬ë§¤ìš”ì²­</span>\n      } else if (category === 'í˜„ì¥ê²°ì œ') {\n        return <span className=\"badge-stats bg-gray-500 text-white\">í˜„ì¥ê²°ì œ</span>\n      } else {\n        // payment_category ê°’ì´ ìˆì§€ë§Œ ì•Œë ¤ì§„ ê°’ì´ ì•„ë‹Œ ê²½ìš°\n        return <span className=\"badge-stats bg-blue-500 text-white\">{category}</span>\n      }\n    }\n    \n    // payment_categoryê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’\n    return <span className=\"badge-stats bg-blue-500 text-white\">êµ¬ë§¤ìš”ì²­</span>\n  }\n\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat('ko-KR').format(amount)\n  }\n\n  const handleSave = async () => {\n    if (!purchase || !editedPurchase) {\n      toast.error('ì €ì¥í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.')\n      return\n    }\n    \n    try {\n      \n      // ë°œì£¼ ê¸°ë³¸ ì •ë³´ ì—…ë°ì´íŠ¸\n      const totalAmount = editedItems.reduce((sum, item) => sum + (item.amount_value || 0), 0)\n      \n      const { error: updateError } = await supabase\n        .from('purchase_requests')\n        .update({\n          purchase_order_number: editedPurchase.purchase_order_number || null,\n          requester_name: editedPurchase.requester_name || null,\n          delivery_request_date: editedPurchase.delivery_request_date || null,\n          revised_delivery_request_date: editedPurchase.revised_delivery_request_date || null,\n          payment_category: editedPurchase.payment_category || null,\n          project_vendor: editedPurchase.project_vendor || null,\n          total_amount: Number(totalAmount),\n          updated_at: new Date().toISOString()\n        })\n        .eq('id', purchase.id)\n\n      if (updateError) throw updateError\n\n      // ì‚­ì œëœ í•­ëª©ë“¤ ì²˜ë¦¬\n      if (deletedItemIds.length > 0) {\n        const { error: deleteError } = await supabase\n          .from('purchase_request_items')\n          .delete()\n          .in('id', deletedItemIds)\n\n        if (deleteError) throw deleteError\n      }\n\n      // ê° ì•„ì´í…œ ì—…ë°ì´íŠ¸ ë˜ëŠ” ìƒì„±\n      \n      for (const item of editedItems) {\n        \n        // í•„ìˆ˜ í•„ë“œ ê²€ì¦\n        if (!item.item_name || !item.item_name.trim()) {\n          throw new Error('í’ˆëª©ëª…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.');\n        }\n        if (!item.quantity || item.quantity <= 0) {\n          throw new Error('ìˆ˜ëŸ‰ì€ 0ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤.');\n        }\n        if (item.unit_price_value !== null && item.unit_price_value !== undefined && item.unit_price_value < 0) {\n          throw new Error('ë‹¨ê°€ëŠ” 0 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');\n        }\n        if (item.amount_value !== null && item.amount_value !== undefined && item.amount_value < 0) {\n          throw new Error('í•©ê³„ëŠ” 0 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');\n        }\n        \n        if (item.id) {\n          // ê¸°ì¡´ í•­ëª© ì—…ë°ì´íŠ¸\n          const { error } = await supabase\n            .from('purchase_request_items')\n            .update({\n              item_name: item.item_name.trim(),\n              specification: item.specification || null,\n              quantity: Number(item.quantity),\n              unit_price_value: Number(item.unit_price_value),\n              unit_price_currency: purchase.currency || 'KRW',\n              amount_value: Number(item.amount_value),\n              amount_currency: purchase.currency || 'KRW',\n              remark: item.remark || null,\n              updated_at: new Date().toISOString()\n            })\n            .eq('id', item.id)\n\n          if (error) {\n            logger.error('ê¸°ì¡´ í•­ëª© ì—…ë°ì´íŠ¸ ì˜¤ë¥˜', error);\n            throw error;\n          }\n        } else {\n          // ìƒˆ í•­ëª© ìƒì„±\n          const insertData = {\n            purchase_request_id: purchase.id,\n            item_name: item.item_name.trim(),\n            specification: item.specification || null,\n            quantity: Number(item.quantity),\n            unit_price_value: Number(item.unit_price_value),\n            unit_price_currency: purchase.currency || 'KRW',\n            amount_value: Number(item.amount_value),\n            amount_currency: purchase.currency || 'KRW',\n            remark: item.remark || null,\n            line_number: item.line_number || editedItems.indexOf(item) + 1,\n            created_at: new Date().toISOString()\n          };\n          \n          const { error } = await supabase\n            .from('purchase_request_items')\n            .insert(insertData)\n\n          if (error) {\n            logger.error('ìƒˆ í•­ëª© ìƒì„± ì˜¤ë¥˜', error);\n            throw error;\n          }\n        }\n      }\n\n      // ğŸš€ ì „ì²´ì™„ë£Œ í•¨ìˆ˜ì™€ ì •í™•íˆ ë™ì¼í•œ íŒ¨í„´ ì ìš© (ë©”ëª¨ë¦¬ ìºì‹œ í¬í•¨)\n      const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n      const sourceData = editedPurchase || purchase\n      \n      // 1. ğŸš€ ì‚­ì œëœ í’ˆëª©ë“¤ì— ëŒ€í•´ ê°œë³„ ë©”ëª¨ë¦¬ ìºì‹œ ì²˜ë¦¬ (êµ¬ë§¤ì™„ë£Œì™€ ë™ì¼í•œ ë°©ì‹)\n      if (!Number.isNaN(purchaseIdNumber) && deletedItemIds.length > 0) {\n        logger.info('ğŸš€ [ë©”ëª¨ë¦¬ ìºì‹œ] ê°œë³„ í’ˆëª© ì‚­ì œ ì²˜ë¦¬ ì‹œì‘', {\n          purchaseId: purchaseIdNumber,\n          deletedItemIds: deletedItemIds,\n          deletedCount: deletedItemIds.length\n        })\n        \n        // ê° ì‚­ì œëœ í’ˆëª©ì— ëŒ€í•´ ê°œë³„ ë©”ëª¨ë¦¬ ìºì‹œ ì—…ë°ì´íŠ¸ (êµ¬ë§¤ì™„ë£Œì™€ ì •í™•íˆ ë™ì¼í•œ íŒ¨í„´)\n        deletedItemIds.forEach(itemId => {\n          const memoryUpdated = removeItemFromMemory(purchaseIdNumber, itemId)\n          if (!memoryUpdated) {\n            logger.warn('[handleSave] ê°œë³„ í’ˆëª© ì‚­ì œ ë©”ëª¨ë¦¬ ìºì‹œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { \n              purchaseId: purchaseIdNumber, \n              itemId: itemId \n            })\n          } else {\n            logger.info('âœ… [handleSave] ê°œë³„ í’ˆëª© ì‚­ì œ ë©”ëª¨ë¦¬ ìºì‹œ ì—…ë°ì´íŠ¸ ì„±ê³µ', { \n              purchaseId: purchaseIdNumber, \n              itemId: itemId \n            })\n          }\n        })\n      }\n      \n      // 2. ë°œì£¼ ê¸°ë³¸ ì •ë³´ ë©”ëª¨ë¦¬ ìºì‹œ ì—…ë°ì´íŠ¸ (ìˆ˜ì •ëœ í•„ë“œë“¤ë§Œ)\n      if (!Number.isNaN(purchaseIdNumber)) {\n        const memoryUpdated = updatePurchaseInMemory(purchaseIdNumber, (prev) => {\n          const totalAmount = editedItems.reduce((sum, item) => sum + (item.amount_value || 0), 0)\n          \n          logger.info('ğŸš€ [ë©”ëª¨ë¦¬ ìºì‹œ] ë°œì£¼ ê¸°ë³¸ ì •ë³´ ì—…ë°ì´íŠ¸', {\n            purchaseId: purchaseIdNumber,\n            newTotalAmount: totalAmount,\n            itemsCount: editedItems.length\n          })\n          \n          return {\n            ...prev,\n            // ë°œì£¼ ê¸°ë³¸ ì •ë³´ ì—…ë°ì´íŠ¸\n            purchase_order_number: sourceData?.purchase_order_number || prev.purchase_order_number,\n            requester_name: sourceData?.requester_name || prev.requester_name,\n            delivery_request_date: sourceData?.delivery_request_date || prev.delivery_request_date,\n            revised_delivery_request_date: sourceData?.revised_delivery_request_date || prev.revised_delivery_request_date,\n            payment_category: sourceData?.payment_category || prev.payment_category,\n            project_vendor: sourceData?.project_vendor || prev.project_vendor,\n            total_amount: totalAmount,\n            updated_at: new Date().toISOString()\n          } as Purchase\n        })\n        \n        logger.info('ğŸš€ [ë©”ëª¨ë¦¬ ìºì‹œ] ê¸°ë³¸ ì •ë³´ ì—…ë°ì´íŠ¸ ê²°ê³¼:', { memoryUpdated })\n      }\n      \n      // 3. applyOptimisticUpdate í•¨ìˆ˜ ì •ì˜ (ì „ì²´ì™„ë£Œ í•¨ìˆ˜ íŒ¨í„´)\n      const applyOptimisticUpdate = () => {\n        if (!Number.isNaN(purchaseIdNumber) && onOptimisticUpdate) {\n          onOptimisticUpdate(purchaseIdNumber, prev => {\n            const finalItems = editedItems // ì‚­ì œëœ í•­ëª©ì´ ì´ë¯¸ ì œì™¸ë¨\n            const totalAmount = finalItems.reduce((sum, item) => sum + (item.amount_value || 0), 0)\n            \n            logger.info('ğŸš€ [onOptimisticUpdate] ì¦‰ì‹œ UI ì—…ë°ì´íŠ¸', {\n              originalItemsCount: prev.items?.length || prev.purchase_request_items?.length || 0,\n              finalItemsCount: finalItems.length,\n              deletedItemsCount: deletedItemIds.length\n            })\n            \n            return {\n              ...prev,\n              // ë°œì£¼ ê¸°ë³¸ ì •ë³´ ì—…ë°ì´íŠ¸\n              purchase_order_number: sourceData?.purchase_order_number || prev.purchase_order_number,\n              requester_name: sourceData?.requester_name || prev.requester_name,\n              delivery_request_date: sourceData?.delivery_request_date || prev.delivery_request_date,\n              revised_delivery_request_date: sourceData?.revised_delivery_request_date || prev.revised_delivery_request_date,\n              payment_category: sourceData?.payment_category || prev.payment_category,\n              project_vendor: sourceData?.project_vendor || prev.project_vendor,\n              total_amount: totalAmount,\n              // í’ˆëª© ë°ì´í„° ì—…ë°ì´íŠ¸ - ì‚­ì œëœ í•­ëª© ì œì™¸\n              items: finalItems,\n              purchase_request_items: finalItems,\n              updated_at: new Date().toISOString()\n            } as Purchase\n          })\n        }\n      }\n      \n      // 4. ì¦‰ì‹œ UI ì—…ë°ì´íŠ¸ ì‹¤í–‰ (ì „ì²´ì™„ë£Œ í•¨ìˆ˜ íŒ¨í„´)\n      applyOptimisticUpdate()\n\n      toast.success('ë°œì£¼ ë‚´ì—­ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.')\n      handleEditToggle(false)\n      setDeletedItemIds([])\n      \n      // 5. ì „ì²´ì™„ë£Œ í•¨ìˆ˜ íŒ¨í„´: refreshModalData ë¨¼ì €, ê·¸ ë‹¤ìŒ onRefresh\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      logger.error('ì €ì¥ ì¤‘ ì „ì²´ ì˜¤ë¥˜', error);\n      const errorMessage = error instanceof Error ? error.message : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤'\n      toast.error(`ì €ì¥ ì‹¤íŒ¨: ${errorMessage}`)\n    }\n  }\n\n  const handleItemChange = (index: number, field: string, value: any) => {\n    const newItems = [...editedItems]\n    \n    if (field === 'quantity' || field === 'unit_price_value') {\n      // ìˆ˜ëŸ‰ì´ë‚˜ ë‹¨ê°€ë¥¼ ìˆ˜ì •í•œ ê²½ìš° ê¸ˆì•¡ ìë™ ê³„ì‚°\n      const quantity = field === 'quantity' ? value : newItems[index].quantity\n      const unitPrice = field === 'unit_price_value' ? value : newItems[index].unit_price_value\n      newItems[index] = {\n        ...newItems[index],\n        [field]: value,\n        amount_value: (quantity || 0) * (unitPrice || 0)  // null ì²´í¬ ì¶”ê°€\n      }\n    } else {\n      // ê¸°íƒ€ í•„ë“œ ìˆ˜ì • (amount_value ì§ì ‘ ìˆ˜ì •ì€ ì œê±°ë¨)\n      newItems[index] = {\n        ...newItems[index],\n        [field]: value\n      }\n    }\n    \n    setEditedItems(newItems)\n  }\n\n  const handleAddItem = () => {\n    // í˜„ì¬ ìµœëŒ€ ë¼ì¸ë„˜ë²„ ì°¾ê¸°\n    const maxLineNumber = editedItems.reduce((max, item) => {\n      const lineNum = item.line_number || 0;\n      return lineNum > max ? lineNum : max;\n    }, 0);\n\n    const newItem = {\n      item_name: '',\n      specification: '',\n      quantity: 1,\n      unit_price_value: 0,\n      amount_value: 0,\n      remark: '',\n      line_number: maxLineNumber + 1\n    }\n    \n    // ìƒˆ ì•„ì´í…œ ì¶”ê°€ í›„ ë¼ì¸ë„˜ë²„ ìˆœì„œëŒ€ë¡œ ì •ë ¬\n    const newItems = [...editedItems, newItem].sort((a, b) => {\n      const lineA = a.line_number || 999999;\n      const lineB = b.line_number || 999999;\n      return lineA - lineB;\n    });\n    \n    setEditedItems(newItems)\n  }\n\n  const handleRemoveItem = (index: number) => {\n    const item = editedItems[index]\n    if (item.id) {\n      setDeletedItemIds([...deletedItemIds, item.id])\n    }\n    const newItems = editedItems.filter((_, i) => i !== index).sort((a, b) => {\n      const lineA = a.line_number || 999999;\n      const lineB = b.line_number || 999999;\n      return lineA - lineB;\n    });\n    setEditedItems(newItems)\n  }\n\n  // êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ í•¨ìˆ˜\n  const handlePaymentToggle = async (itemId: number | string, isCompleted: boolean) => {\n    \n    if (!canPurchase) {\n      logger.warn('[handlePaymentToggle] ê¶Œí•œ ì—†ìŒ', { canPurchase, currentUserRoles })\n      toast.error('êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.')\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n\n    if (Number.isNaN(numericId)) {\n      logger.error('[handlePaymentToggle] ì˜ëª»ëœ ID', { itemId, numericId })\n      toast.error('ìœ íš¨í•˜ì§€ ì•Šì€ í•­ëª© ID ì…ë‹ˆë‹¤.')\n      return\n    }\n\n    // í•´ë‹¹ í’ˆëª© ì •ë³´ ì°¾ê¸° - ë°ì´í„° êµ¬ì¡° ë””ë²„ê¹…\n    \n    // itemsì™€ purchase_request_items ë‘˜ ë‹¤ í™•ì¸ - lengthë¡œ ì‹¤ì œ ë°ì´í„° ìœ ë¬´ íŒë‹¨\n    if (!purchase) return\n    \n    const purchaseItems = (purchase.items && purchase.items.length > 0) ? purchase.items : []\n    const requestItems = (purchase.purchase_request_items && purchase.purchase_request_items.length > 0) ? purchase.purchase_request_items : []\n    const items = purchaseItems.length > 0 ? purchaseItems : requestItems\n    \n    \n    const targetItem = items.find(item => String(item.id) === itemIdStr)\n    \n    \n    if (!targetItem) {\n      return\n    }\n\n    const itemInfo = `í’ˆëª…: ${targetItem.item_name}\nê·œê²©: ${targetItem.specification || 'ë¯¸ì…ë ¥'}\nìˆ˜ëŸ‰: ${targetItem.quantity?.toLocaleString() || 0}${targetItem.unit || ''}\në‹¨ê°€: â‚©${targetItem.unit_price_value?.toLocaleString() || 0}\ní•©ê³„: â‚©${targetItem.amount_value?.toLocaleString() || 0}`\n\n    const confirmMessage = isCompleted \n      ? `ë‹¤ìŒ í’ˆëª©ì„ êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\\n\\n${itemInfo}` \n      : `ë‹¤ìŒ í’ˆëª©ì˜ êµ¬ë§¤ì™„ë£Œë¥¼ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\\n\\n${itemInfo}`\n    \n    const confirm = window.confirm(confirmMessage)\n    \n    if (!confirm) {\n      return\n    }\n\n    try {\n      \n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_payment_completed: isCompleted,\n          payment_completed_at: isCompleted ? new Date().toISOString() : null\n        })\n        .eq('id', numericId)\n\n      if (error) {\n        throw error\n      }\n      \n\n      // ğŸš€ ë©”ëª¨ë¦¬ ìºì‹œ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (êµ¬ë§¤ì™„ë£Œ/ì·¨ì†Œ ëª¨ë‘ ì²˜ë¦¬)\n      if (purchase) {\n        \n        const memoryUpdated = isCompleted \n          ? markItemAsPaymentCompleted(purchase.id, numericId)\n          : markItemAsPaymentCanceled(purchase.id, numericId);\n          \n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal] ë©”ëª¨ë¦¬ ìºì‹œ í’ˆëª© ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { \n            purchaseId: purchase.id, \n            itemId: numericId,\n            isCompleted\n          });\n        }\n      }\n\n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (UI ì¦‰ì‹œ ë°˜ì˜)\n      setPurchase(prev => {\n        if (!prev) {\n          return null\n        }\n        \n        // itemsì™€ purchase_request_items ë‘˜ ë‹¤ í™•ì¸í•˜ì—¬ ì—…ë°ì´íŠ¸ - lengthë¡œ ì‹¤ì œ ë°ì´í„° ìœ ë¬´ íŒë‹¨\n        const prevItems = (prev.items && prev.items.length > 0) ? prev.items : []\n        const prevRequestItems = (prev.purchase_request_items && prev.purchase_request_items.length > 0) ? prev.purchase_request_items : []\n        const currentItems = prevItems.length > 0 ? prevItems : prevRequestItems\n        const updatedItems = currentItems.map(item => \n          String(item.id) === itemIdStr \n            ? { ...item, is_payment_completed: isCompleted, payment_completed_at: isCompleted ? new Date().toISOString() : null }\n            : item\n        )\n        \n        \n        // ë°ì´í„° êµ¬ì¡°ì— ë§ê²Œ ì—…ë°ì´íŠ¸\n        const result = {\n          ...prev,\n          items: prev.items ? updatedItems : prev.items,\n          purchase_request_items: prev.purchase_request_items ? updatedItems : prev.purchase_request_items\n        }\n        \n        return result\n      })\n\n      if (purchase) {\n        const purchaseIdNumber = Number(purchase.id)\n        if (!Number.isNaN(purchaseIdNumber)) {\n          onOptimisticUpdate?.(purchaseIdNumber, prev => {\n            const updatedItems = (prev.items || []).map(item =>\n              String(item.id) === itemIdStr\n                ? { ...item, is_payment_completed: isCompleted }\n                : item\n            )\n            const total = updatedItems.length || prev.items?.length || 0\n            const completed = updatedItems.filter(item => item.is_payment_completed).length\n            const allCompleted = total > 0 && completed === total\n            return {\n              ...prev,\n              items: updatedItems,\n              is_payment_completed: allCompleted,\n              payment_completed_at: allCompleted ? new Date().toISOString() : null,\n              payment_completed_by_name: allCompleted ? (currentUserName || prev.payment_completed_by_name) : prev.payment_completed_by_name\n            }\n          })\n        }\n      }\n      \n      toast.success(isCompleted ? 'êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'êµ¬ë§¤ì™„ë£Œê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.')\n\n      // ìƒì„¸ ëª¨ë‹¬ ë° ìƒìœ„ ë¦¬ìŠ¤íŠ¸ ëª¨ë‘ ìµœì‹  ìƒíƒœë¡œ ë™ê¸°í™”\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      toast.error('êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n\n  // ê°œë³„ í’ˆëª© ì…ê³ ì™„ë£Œ ì²˜ë¦¬ (ë‚ ì§œ ì„ íƒ)\n  const handleItemReceiptToggle = async (itemId: number | string, selectedDate: Date) => {\n    if (!canReceiptCheck) {\n      toast.error('ì…ê³  ì²˜ë¦¬ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.')\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      toast.error('ìœ íš¨í•˜ì§€ ì•Šì€ í•­ëª© ID ì…ë‹ˆë‹¤.')\n      return\n    }\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item =>\n            String(item.id) === itemIdStr\n              ? {\n                  ...item,\n                  is_received: true,\n                  actual_received_date: selectedDate.toISOString()\n                }\n              : item\n          )\n          const total = updatedItems.length || prev.items?.length || 0\n          const completed = updatedItems.filter(item => item.is_received).length\n          const allReceived = total > 0 && completed === total\n\n          return {\n            ...prev,\n            items: updatedItems,\n            is_received: allReceived,\n            received_at: allReceived ? new Date().toISOString() : prev.received_at\n          }\n        })\n      }\n    }\n\n    try {\n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_received: true,\n          received_at: new Date().toISOString(),\n          actual_received_date: selectedDate.toISOString()\n        })\n        .eq('id', numericId)\n\n      if (error) throw error\n\n      // ğŸš€ ë©”ëª¨ë¦¬ ìºì‹œ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (ê°œë³„ í’ˆëª© ì…ê³ ì™„ë£Œ)\n      if (purchase) {\n        const memoryUpdated = markItemAsReceived(purchase.id, numericId);\n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal] ë©”ëª¨ë¦¬ ìºì‹œ ê°œë³„ í’ˆëª© ì…ê³ ì™„ë£Œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { \n            purchaseId: purchase.id, \n            itemId: numericId \n          });\n        }\n      }\n\n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          String(item.id) === itemIdStr \n            ? { \n                ...item, \n                is_received: true, \n                received_at: new Date().toISOString(),\n                actual_received_date: selectedDate.toISOString()\n              }\n            : item\n        )\n        return { ...prev, items: updatedItems }\n      })\n\n      applyOptimisticUpdate()\n      \n      const targetItem = purchase?.items?.find(item => String(item.id) === itemIdStr)\n      toast.success(`\"${targetItem?.item_name}\" í’ˆëª©ì´ ì…ê³ ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.`)\n\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      toast.error('ì…ê³ ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n\n  // ì…ê³ ì™„ë£Œ ì·¨ì†Œ ì²˜ë¦¬\n  const handleReceiptCancel = async (itemId: number | string) => {\n    if (!canReceiptCheck) {\n      toast.error('ì…ê³  ì²˜ë¦¬ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.')\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      toast.error('ìœ íš¨í•˜ì§€ ì•Šì€ í•­ëª© ID ì…ë‹ˆë‹¤.')\n      return\n    }\n\n    const targetItem = purchase?.items?.find(item => String(item.id) === itemIdStr)\n    if (!targetItem) return\n\n    const confirm = window.confirm(`\"${targetItem.item_name}\" í’ˆëª©ì˜ ì…ê³ ì™„ë£Œë¥¼ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)\n    if (!confirm) return\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item =>\n            String(item.id) === itemIdStr\n              ? {\n                  ...item,\n                  is_received: false,\n                  actual_received_date: undefined\n                }\n              : item\n          )\n          const total = updatedItems.length || prev.items?.length || 0\n          const completed = updatedItems.filter(item => item.is_received).length\n          const allReceived = total > 0 && completed === total\n\n          return {\n            ...prev,\n            items: updatedItems,\n            is_received: allReceived,\n            received_at: allReceived ? prev.received_at : null\n          }\n        })\n      }\n    }\n\n    try {\n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_received: false,\n          received_at: null,\n          actual_received_date: null,\n          actual_received_by_name: null\n        })\n        .eq('id', numericId)\n\n      if (error) throw error\n\n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          String(item.id) === itemIdStr \n            ? { ...item, is_received: false, received_at: null, actual_received_date: undefined, actual_received_by_name: undefined }\n            : item\n        )\n        return { ...prev, items: updatedItems }\n      })\n      \n      applyOptimisticUpdate()\n\n      toast.success('ì…ê³ ì™„ë£Œê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.')\n\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      toast.error('ì…ê³ ì™„ë£Œ ì·¨ì†Œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n\n\n  // ìŠ¹ì¸ ì²˜ë¦¬\n  const handleApprove = async (type: 'middle' | 'final') => {\n    if (!purchase) return\n    \n    const approvalType = type === 'middle' ? '1ì°¨ ìŠ¹ì¸' : 'ìµœì¢… ìŠ¹ì¸'\n    const confirmMessage = `ë°œì£¼ë²ˆí˜¸: ${purchase.purchase_order_number}\\n\\n${approvalType}ì„ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`\n    const confirm = window.confirm(confirmMessage)\n    if (!confirm) return\n    \n    try {\n      const updateData = type === 'middle' \n        ? { \n            middle_manager_status: 'approved'\n          }\n        : { \n            final_manager_status: 'approved'\n          }\n\n      const { error } = await supabase\n        .from('purchase_requests')\n        .update(updateData)\n        .eq('id', purchase.id)\n      \n      if (error) {\n        throw error\n      }\n\n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (UI ì¦‰ì‹œ ë°˜ì˜)\n      if (type === 'middle') {\n        setPurchase(prev => prev ? { ...prev, middle_manager_status: 'approved' } : null)\n      } else {\n        setPurchase(prev => prev ? { ...prev, final_manager_status: 'approved' } : null)\n      }\n\n      // Optimistic Updateë¡œ ë¦¬ìŠ¤íŠ¸ ì¦‰ì‹œ ë°˜ì˜ (êµ¬ë§¤ì™„ë£Œ/ì…ê³ ì™„ë£Œì™€ ë™ì¼í•œ íŒ¨í„´)\n      if (purchase && onOptimisticUpdate) {\n        const purchaseIdNumber = Number(purchase.id)\n        if (!Number.isNaN(purchaseIdNumber)) {\n          onOptimisticUpdate(purchaseIdNumber, prev => {\n            if (type === 'middle') {\n              return {\n                ...prev,\n                middle_manager_status: 'approved' as any\n              }\n            } else {\n              return {\n                ...prev,\n                final_manager_status: 'approved' as any\n              }\n            }\n          })\n        }\n      }\n      \n      toast.success(`${type === 'middle' ? 'ì¤‘ê°„' : 'ìµœì¢…'} ìŠ¹ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`)\n\n      // ìƒì„¸ ëª¨ë‹¬ ë° ë¦¬ìŠ¤íŠ¸ ëª¨ë‘ ìƒˆë¡œê³ ì¹¨\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      toast.error('ìŠ¹ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n  \n  // ì „ì²´ êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ (ê°œë³„ í’ˆëª©ë³„ ì²˜ë¦¬ ë°©ì‹)\n  const handleCompleteAllPayment = async () => {\n    \n    if (!purchase || !canPurchase) {\n      return\n    }\n    \n    const confirmMessage = `ë°œì£¼ë²ˆí˜¸: ${purchase.purchase_order_number}\\n\\nì „ì²´ êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`\n    const confirm = window.confirm(confirmMessage)\n    if (!confirm) {\n      return\n    }\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const allItems = prev.purchase_request_items || [];\n          const pendingItems = allItems.filter(item => !item.is_payment_completed);\n          \n          const updatedItems = allItems.map(item => \n            !item.is_payment_completed \n              ? { ...item, is_payment_completed: true, payment_completed_at: new Date().toISOString() }\n              : item\n          );\n          \n          return {\n            ...prev,\n            purchase_request_items: updatedItems,\n            items: prev.items ? updatedItems : prev.items,\n            is_payment_completed: updatedItems.every(item => item.is_payment_completed)\n          }\n        })\n      }\n    }\n    \n    try {\n      // ğŸš€ ë¯¸ì™„ë£Œ í’ˆëª©ë§Œ í•„í„°ë§ (ì´ë¯¸ êµ¬ë§¤ì™„ë£Œëœ í’ˆëª© ì œì™¸)\n      const allItems = purchase.purchase_request_items || [];\n      const pendingItems = allItems.filter(item => !item.is_payment_completed);\n      \n      if (pendingItems.length === 0) {\n        toast.info('ëª¨ë“  í’ˆëª©ì´ ì´ë¯¸ êµ¬ë§¤ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');\n        return;\n      }\n\n      logger.info(`ì „ì²´ êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬: ${pendingItems.length}ê°œ í’ˆëª© (ì´ ${allItems.length}ê°œ ì¤‘)`);\n      \n      for (const item of pendingItems) {\n        // ê° í’ˆëª©ë³„ë¡œ DB ì—…ë°ì´íŠ¸ (ê°œë³„ í’ˆëª©ê³¼ ë™ì¼í•œ ë°©ì‹)\n        const updateData = {\n          is_payment_completed: true,\n          payment_completed_at: new Date().toISOString()\n        };\n\n        const { error } = await supabase\n          .from('purchase_request_items')\n          .update(updateData)\n          .eq('id', item.id);\n\n        if (error) throw error;\n\n        // ğŸš€ ê°œë³„ í’ˆëª© ë©”ëª¨ë¦¬ ìºì‹œ ì—…ë°ì´íŠ¸ (ê°œë³„ ì²˜ë¦¬ì™€ ë™ì¼)\n        const memoryUpdated = markItemAsPaymentCompleted(purchase.id, item.id);\n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal] ë©”ëª¨ë¦¬ ìºì‹œ ê°œë³„ í’ˆëª© êµ¬ë§¤ì™„ë£Œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { \n            purchaseId: purchase.id, \n            itemId: item.id \n          });\n        }\n      }\n\n      toast.success(`${pendingItems.length}ê°œ í’ˆëª©ì´ êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.`);\n\n      // ğŸš€ ìƒˆë¡œê³ ì¹¨ (ê°œë³„ í’ˆëª©ê³¼ ë™ì¼)\n      await refreshModalData();\n      const refreshResult = onRefresh?.(true, { silent: true });\n      if (refreshResult instanceof Promise) {\n        await refreshResult;\n      }\n    } catch (error) {\n      logger.error('ì „ì²´ êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ ì˜¤ë¥˜', error);\n      toast.error('êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n\n  // ê°œë³„ ì§€ì¶œ ì •ë³´ ì…ë ¥ ì²˜ë¦¬\n  const handleItemExpenditure = async (itemId: number | string, date: Date, amount: number) => {\n    if (!purchase || !canReceiptCheck) {\n      toast.error('ì§€ì¶œ ì •ë³´ ì…ë ¥ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.')\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      logger.error('ìœ íš¨í•˜ì§€ ì•Šì€ itemId', { itemId })\n      return\n    }\n\n    const targetItem = purchase.items?.find(item => String(item.id) === itemIdStr)\n    if (!targetItem) return\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item =>\n            String(item.id) === itemIdStr\n              ? {\n                  ...item,\n                  expenditure_date: date.toISOString(),\n                  expenditure_amount: amount\n                }\n              : item\n          )\n          return { ...prev, items: updatedItems }\n        })\n      }\n    }\n\n    try {\n      applyOptimisticUpdate()\n\n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (itemsì™€ purchase_request_items ëª¨ë‘ ì—…ë°ì´íŠ¸) - ë‹¤ë¥¸ í•¨ìˆ˜ë“¤ê³¼ ë™ì¼í•œ íŒ¨í„´\n      setPurchase(prev => {\n        if (!prev) return null\n        const currentItems = prev.items || prev.purchase_request_items || []\n        const updatedItems = currentItems.map(item => \n          String(item.id) === itemIdStr\n            ? {\n                ...item,\n                expenditure_date: date.toISOString(),\n                expenditure_amount: amount\n              }\n            : item\n        )\n        const totalExpenditure = updatedItems.reduce((sum, item) => sum + (item.expenditure_amount || 0), 0)\n        // ìƒˆ ê°ì²´ë¥¼ ë°˜í™˜í•˜ì—¬ Reactê°€ ë³€ê²½ì„ ê°ì§€í•˜ë„ë¡ í•¨\n        return { \n          ...prev, \n          items: updatedItems,\n          purchase_request_items: updatedItems,\n          total_expenditure_amount: totalExpenditure,\n          updated_at: new Date().toISOString() // ê°•ì œë¡œ ê°ì²´ ì°¸ì¡° ë³€ê²½\n        }\n      })\n\n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          expenditure_date: date.toISOString(),\n          expenditure_amount: amount\n        })\n        .eq('id', numericId)\n\n      if (error) {\n        logger.error('ì§€ì¶œ ì •ë³´ DB ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { error, itemId: numericId })\n        throw error\n      }\n\n      // purchase_requestsì˜ total_expenditure_amount ì—…ë°ì´íŠ¸\n      const allItemsForTotal = purchase.items || purchase.purchase_request_items || []\n      const totalExpenditure = allItemsForTotal.reduce((sum, item) => {\n        if (String(item.id) === itemIdStr) {\n          return sum + amount\n        }\n        return sum + (item.expenditure_amount || 0)\n      }, 0)\n\n      await supabase\n        .from('purchase_requests')\n        .update({ total_expenditure_amount: totalExpenditure })\n        .eq('id', purchaseIdNumber)\n\n      // ğŸš€ ë©”ëª¨ë¦¬ ìºì‹œ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (ì‹¤ì‹œê°„ UI ë°˜ì˜) - DB ì—…ë°ì´íŠ¸ í›„ì— í˜¸ì¶œ\n      if (purchase?.id) {\n        const memoryUpdated = markItemAsExpenditureSet(purchase.id, numericId, date.toISOString(), amount)\n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal] ë©”ëª¨ë¦¬ ìºì‹œ ì§€ì¶œ ì •ë³´ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { \n            purchaseId: purchase.id, \n            itemId: numericId \n          })\n        }\n      }\n\n      toast.success(`\"${targetItem.item_name}\" í’ˆëª©ì˜ ì§€ì¶œ ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`)\n\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      logger.error('ì§€ì¶œ ì •ë³´ ì…ë ¥ ì¤‘ ì˜¤ë¥˜', error)\n      toast.error('ì§€ì¶œ ì •ë³´ ì…ë ¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n\n  // ì¼ê´„ ì§€ì¶œ ì •ë³´ ì…ë ¥ ì²˜ë¦¬\n  const handleBulkExpenditure = async (date: Date, amount: number) => {\n    if (!purchase || !canReceiptCheck) {\n      toast.error('ì§€ì¶œ ì •ë³´ ì…ë ¥ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.')\n      return\n    }\n\n    const confirmMessage = `ë°œì£¼ë²ˆí˜¸: ${purchase.purchase_order_number}\\n\\nì¼ê´„ ì§€ì¶œ ì •ë³´ë¥¼ ì…ë ¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\\në‚ ì§œ: ${date.toLocaleDateString('ko-KR')}\\nê¸ˆì•¡: ${amount.toLocaleString()}ì›`\n    \n    if (!window.confirm(confirmMessage)) {\n      return\n    }\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item =>\n            // ì´ë¯¸ ê°œë³„ ì…ë ¥ëœ í•­ëª©ì€ ì œì™¸\n            item.expenditure_date && item.expenditure_amount\n              ? item\n              : {\n                  ...item,\n                  expenditure_date: date.toISOString(),\n                  expenditure_amount: amount\n                }\n          )\n          return { ...prev, items: updatedItems }\n        })\n      }\n    }\n\n    try {\n      applyOptimisticUpdate()\n\n      // ì´ë¯¸ ê°œë³„ ì…ë ¥ëœ í•­ëª© ì œì™¸í•˜ê³  ì¼ê´„ ì—…ë°ì´íŠ¸\n      const allItems = purchase.items || purchase.purchase_request_items || []\n      const pendingItems = allItems.filter(item => !item.expenditure_date || !item.expenditure_amount)\n      \n      if (pendingItems.length === 0) {\n        toast.info('ëª¨ë“  í’ˆëª©ì— ì´ë¯¸ ì§€ì¶œ ì •ë³´ê°€ ì…ë ¥ë˜ì–´ ìˆìŠµë‹ˆë‹¤.')\n        return\n      }\n\n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (itemsì™€ purchase_request_items ëª¨ë‘ ì—…ë°ì´íŠ¸)\n      setPurchase(prev => {\n        if (!prev) return null\n        const allItems = prev.items || prev.purchase_request_items || []\n        const updatedItems = allItems.map(item =>\n          // ì´ë¯¸ ê°œë³„ ì…ë ¥ëœ í•­ëª©ì€ ì œì™¸\n          item.expenditure_date && item.expenditure_amount\n            ? item\n            : {\n                ...item,\n                expenditure_date: date.toISOString(),\n                expenditure_amount: amount\n              }\n        )\n        const totalExpenditure = updatedItems.reduce((sum, item) => sum + (item.expenditure_amount || 0), 0)\n        // ìƒˆ ê°ì²´ë¥¼ ë°˜í™˜í•˜ì—¬ Reactê°€ ë³€ê²½ì„ ê°ì§€í•˜ë„ë¡ í•¨\n        return { \n          ...prev, \n          items: updatedItems,\n          purchase_request_items: updatedItems,\n          total_expenditure_amount: totalExpenditure,\n          updated_at: new Date().toISOString() // ê°•ì œë¡œ ê°ì²´ ì°¸ì¡° ë³€ê²½\n        }\n      })\n\n      for (const item of pendingItems) {\n        const { error } = await supabase\n          .from('purchase_request_items')\n          .update({\n            expenditure_date: date.toISOString(),\n            expenditure_amount: amount\n          })\n          .eq('id', item.id)\n\n        if (error) {\n          logger.error('ì¼ê´„ ì§€ì¶œ ì •ë³´ DB ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { error, itemId: item.id })\n          throw error\n        }\n      }\n\n      // purchase_requestsì˜ total_expenditure_amount ì—…ë°ì´íŠ¸\n      const totalExpenditure = allItems.reduce((sum, item) => {\n        if (pendingItems.find(pi => pi.id === item.id)) {\n          return sum + amount\n        }\n        return sum + (item.expenditure_amount || 0)\n      }, 0)\n\n      await supabase\n        .from('purchase_requests')\n        .update({ total_expenditure_amount: totalExpenditure })\n        .eq('id', purchaseIdNumber)\n\n      // ğŸš€ ë©”ëª¨ë¦¬ ìºì‹œ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (ì‹¤ì‹œê°„ UI ë°˜ì˜) - DB ì—…ë°ì´íŠ¸ í›„ì— í˜¸ì¶œ\n      for (const item of pendingItems) {\n        const memoryUpdated = markItemAsExpenditureSet(purchase.id, item.id, date.toISOString(), amount)\n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal] ë©”ëª¨ë¦¬ ìºì‹œ ì¼ê´„ ì§€ì¶œ ì •ë³´ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { \n            purchaseId: purchase.id, \n            itemId: item.id \n          })\n        }\n      }\n\n      // ë©”ëª¨ë¦¬ ìºì‹œ ì—…ë°ì´íŠ¸ í›„ ì¦‰ì‹œ ë¡œì»¬ ìƒíƒœë„ ë™ê¸°í™” (ì‹¤ì‹œê°„ ë°˜ì˜)\n      const memoryPurchase = findPurchaseInMemory(purchase.id)\n      if (memoryPurchase) {\n        const normalizedItems = (memoryPurchase.items && memoryPurchase.items.length > 0) \n          ? memoryPurchase.items \n          : (memoryPurchase.purchase_request_items || [])\n        const totalExpenditure = normalizedItems.reduce((sum, item) => sum + (item.expenditure_amount || 0), 0)\n        setPurchase(prev => ({\n          ...prev!,\n          items: normalizedItems,\n          purchase_request_items: normalizedItems,\n          total_expenditure_amount: totalExpenditure\n        }))\n      }\n\n      toast.success(`${pendingItems.length}ê°œ í’ˆëª©ì˜ ì§€ì¶œ ì •ë³´ê°€ ì¼ê´„ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤.`)\n\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      logger.error('ì¼ê´„ ì§€ì¶œ ì •ë³´ ì…ë ¥ ì¤‘ ì˜¤ë¥˜', error)\n      toast.error('ì¼ê´„ ì§€ì¶œ ì •ë³´ ì…ë ¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n\n  // ì „ì²´ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ì²˜ë¦¬ (ê°œë³„ í’ˆëª©ë³„ ì²˜ë¦¬ ë°©ì‹)\n  const handleCompleteAllStatement = async (selectedDate: Date) => {\n    if (!purchase || !canReceiptCheck) {\n      return\n    }\n\n    const formattedDate = selectedDate.toLocaleDateString('ko-KR', {\n      year: 'numeric',\n      month: '2-digit',\n      day: '2-digit'\n    })\n\n    const confirmMessage = `ë°œì£¼ë²ˆí˜¸: ${purchase.purchase_order_number}\n\nì „ì²´ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`\n    \n    if (!window.confirm(confirmMessage)) {\n      return\n    }\n\n    const selectedDateIso = selectedDate.toISOString()\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const allItems = prev.purchase_request_items || [];\n          const pendingItems = allItems.filter(item => !item.is_statement_received);\n          \n          const updatedItems = allItems.map(item => \n            !item.is_statement_received \n              ? { \n                  ...item, \n                  is_statement_received: true, \n                  statement_received_date: selectedDateIso,\n                  statement_received_by_name: currentUserName || null\n                }\n              : item\n          );\n          \n          return {\n            ...prev,\n            purchase_request_items: updatedItems,\n            items: prev.items ? updatedItems : prev.items,\n            is_statement_received: updatedItems.every(item => item.is_statement_received),\n            statement_received_at: selectedDateIso\n          }\n        })\n      }\n    }\n\n    try {\n      // ğŸš€ ë¯¸ì™„ë£Œ í’ˆëª©ë§Œ í•„í„°ë§ (ì´ë¯¸ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ëœ í’ˆëª© ì œì™¸)\n      const allItems = purchase.purchase_request_items || [];\n      const pendingItems = allItems.filter(item => !item.is_statement_received);\n      \n      if (pendingItems.length === 0) {\n        toast.info('ëª¨ë“  í’ˆëª©ì˜ ê±°ë˜ëª…ì„¸ì„œê°€ ì´ë¯¸ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.');\n        return;\n      }\n\n      logger.info(`ì „ì²´ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ì²˜ë¦¬: ${pendingItems.length}ê°œ í’ˆëª© (ì´ ${allItems.length}ê°œ ì¤‘)`);\n      \n      for (const item of pendingItems) {\n        // ê° í’ˆëª©ë³„ë¡œ DB ì—…ë°ì´íŠ¸ (ê°œë³„ í’ˆëª©ê³¼ ë™ì¼í•œ ë°©ì‹)\n        const updateData = {\n          is_statement_received: true,\n          statement_received_date: selectedDateIso,\n          statement_received_by_name: currentUserName || null\n        };\n\n        const { error } = await supabase\n          .from('purchase_request_items')\n          .update(updateData)\n          .eq('id', item.id);\n\n        if (error) throw error;\n\n        // ğŸš€ ê°œë³„ í’ˆëª© ë©”ëª¨ë¦¬ ìºì‹œ ì—…ë°ì´íŠ¸ (ê°œë³„ ì²˜ë¦¬ì™€ ë™ì¼)\n        const memoryUpdated = markItemAsStatementReceived(purchase.id, item.id, selectedDateIso, currentUserName || undefined);\n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal] ë©”ëª¨ë¦¬ ìºì‹œ ê°œë³„ í’ˆëª© ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { \n            purchaseId: purchase.id, \n            itemId: item.id \n          });\n        }\n      }\n\n      toast.success(`${pendingItems.length}ê°œ í’ˆëª©ì˜ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`);\n\n      // ğŸš€ ìƒˆë¡œê³ ì¹¨ (ê°œë³„ í’ˆëª©ê³¼ ë™ì¼)\n      await refreshModalData();\n      const refreshResult = onRefresh?.(true, { silent: true });\n      if (refreshResult instanceof Promise) {\n        await refreshResult;\n      }\n    } catch (error) {\n      logger.error('ì „ì²´ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ì²˜ë¦¬ ì˜¤ë¥˜', error)\n      toast.error('ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n\n  // ì „ì²´ ì…ê³ ì™„ë£Œ ì²˜ë¦¬ (ë‚ ì§œ ì„ íƒ)\n  const handleCompleteAllReceipt = async (selectedDate: Date) => {\n    if (!purchase || !canReceiveItems) {\n      return\n    }\n\n    // í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ\n    const confirmMessage = `ë°œì£¼ë²ˆí˜¸: ${purchase.purchase_order_number}\n\nì „ì²´ ì…ê³ ì™„ë£Œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`\n    \n    if (!window.confirm(confirmMessage)) {\n      return\n    }\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item => ({\n            ...item,\n            is_received: true,\n            actual_received_date: item.actual_received_date || selectedDate.toISOString()\n          }))\n\n          return {\n            ...prev,\n            items: updatedItems,\n            is_received: true,\n            received_at: new Date().toISOString()\n          }\n        })\n      }\n    }\n\n    try {\n      // ğŸš€ ë¯¸ì™„ë£Œ í’ˆëª©ë§Œ í•„í„°ë§ (ì´ë¯¸ ì…ê³ ì™„ë£Œëœ í’ˆëª© ì œì™¸)\n      const allItems = purchase.purchase_request_items || [];\n      const pendingItems = allItems.filter(item => !item.is_received);\n      \n      if (pendingItems.length === 0) {\n        toast.info('ëª¨ë“  í’ˆëª©ì´ ì´ë¯¸ ì…ê³ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');\n        return;\n      }\n\n      logger.info(`ì „ì²´ ì…ê³ ì™„ë£Œ ì²˜ë¦¬: ${pendingItems.length}ê°œ í’ˆëª© (ì´ ${allItems.length}ê°œ ì¤‘)`);\n      \n      for (const item of pendingItems) {\n        // ê° í’ˆëª©ë³„ë¡œ DB ì—…ë°ì´íŠ¸ (ê°œë³„ í’ˆëª©ê³¼ ë™ì¼í•œ ë°©ì‹)\n        const updateData = {\n          actual_received_date: selectedDate.toISOString(),\n          is_received: true\n        };\n\n        const { error } = await supabase\n          .from('purchase_request_items')\n          .update(updateData)\n          .eq('id', item.id);\n\n        if (error) throw error;\n\n        // ğŸš€ ê°œë³„ í’ˆëª© ë©”ëª¨ë¦¬ ìºì‹œ ì—…ë°ì´íŠ¸ (ê°œë³„ ì²˜ë¦¬ì™€ ë™ì¼)\n        const memoryUpdated = markItemAsReceived(purchase.id, item.id, selectedDate.toISOString());\n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal] ë©”ëª¨ë¦¬ ìºì‹œ ê°œë³„ í’ˆëª© ì…ê³ ì™„ë£Œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { \n            purchaseId: purchase.id, \n            itemId: item.id \n          });\n        }\n      }\n\n      toast.success(`${pendingItems.length}ê°œ í’ˆëª©ì´ ì…ê³ ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.`);\n\n      // ğŸš€ ìƒˆë¡œê³ ì¹¨ (ê°œë³„ í’ˆëª©ê³¼ ë™ì¼)\n      await refreshModalData();\n      const refreshResult = onRefresh?.(true, { silent: true });\n      if (refreshResult instanceof Promise) {\n        await refreshResult;\n      }\n    } catch (error) {\n      logger.error('ì „ì²´ ì…ê³ ì™„ë£Œ ì²˜ë¦¬ ì˜¤ë¥˜', error)\n      toast.error('ì…ê³ ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n  \n\n  // ë°˜ë ¤ ì²˜ë¦¬\n  const handleReject = async (type: 'middle' | 'final') => {\n    if (!purchase) return\n    \n    const reason = window.prompt('ë°˜ë ¤ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”:')\n    if (!reason) return\n    \n    try {\n      const updateData = type === 'middle'\n        ? {\n            middle_manager_status: 'rejected'\n          }\n        : {\n            final_manager_status: 'rejected'\n          }\n      \n      const { error } = await supabase\n        .from('purchase_requests')\n        .update(updateData)\n        .eq('id', purchase.id)\n      \n      if (error) {\n        throw error\n      }\n      \n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (UI ì¦‰ì‹œ ë°˜ì˜)\n      if (type === 'middle') {\n        setPurchase(prev => prev ? { ...prev, middle_manager_status: 'rejected' } : null)\n      } else {\n        setPurchase(prev => prev ? { ...prev, final_manager_status: 'rejected' } : null)\n      }\n      \n      toast.success(`${type === 'middle' ? 'ì¤‘ê°„' : 'ìµœì¢…'} ë°˜ë ¤ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`)\n    } catch (error) {\n      toast.error('ë°˜ë ¤ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n\n  const content = (\n    <div className=\"space-y-1 sm:space-y-4\">\n      {loading ? (\n        <div className=\"flex items-center justify-center py-12\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-hansl-600\"></div>\n        </div>\n      ) : purchase ? (\n        <div>\n          {/* Compact Info Header */}\n          <div className=\"bg-gray-50 rounded-lg p-2 sm:p-3 mb-1 sm:mb-2 border border-gray-100\">\n            <div className=\"grid grid-cols-1 sm:grid-cols-3 items-center gap-3 sm:gap-0\">\n              <div className=\"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-4\">\n                <div className=\"flex items-center gap-3\">\n                  {getStatusBadge()}\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"modal-label\">ìš”ì²­ì:</span>\n                    <span className=\"modal-value\">{purchase.requester_name}</span>\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Calendar className=\"w-3 h-3 text-gray-500\" />\n                  <span className=\"modal-subtitle\">ì²­êµ¬ì¼: {formatDate(purchase.request_date)}</span>\n                </div>\n              </div>\n              \n              {/* ìŠ¹ì¸ ë²„íŠ¼ë“¤ì„ ì¤‘ì•™ì— ë°°ì¹˜ */}\n              <div className=\"flex items-center justify-center gap-2 sm:gap-3 flex-wrap\">\n                {/* 1ì°¨ ìŠ¹ì¸ ë²„íŠ¼ */}\n                {(() => {\n                  const shouldShow = canApproveMiddle && purchase.middle_manager_status === 'pending';\n                  return shouldShow;\n                })() && (\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => handleApprove('middle')}\n                    className={`${approvalButtonClass} border border-gray-400 bg-white hover:bg-gray-50 hover:border-gray-500`}\n                  >\n                    1ì°¨ ìŠ¹ì¸ ëŒ€ê¸°\n                  </Button>\n                )}\n                {purchase.middle_manager_status === 'approved' && (\n                  <div className=\"button-approved badge-text shadow-sm\">\n                    <Check className=\"w-3 h-3\" />\n                    1ì°¨ ìŠ¹ì¸ì™„ë£Œ\n                  </div>\n                )}\n                {purchase.middle_manager_status === 'rejected' && (\n                  <div className=\"button-rejected badge-text\">\n                    <X className=\"w-3 h-3\" />\n                    1ì°¨ ë°˜ë ¤\n                  </div>\n                )}\n                {purchase.middle_manager_status === 'pending' && !canApproveMiddle && (\n                  <div className={`${approvalWaitingPillClass} border border-gray-300 text-gray-600 bg-white`}>\n                    1ì°¨ ìŠ¹ì¸ëŒ€ê¸°\n                  </div>\n                )}\n\n                {/* ìµœì¢… ìŠ¹ì¸ ë²„íŠ¼ */}\n                {(() => {\n                  const shouldShow = canApproveFinal && purchase.middle_manager_status === 'approved' && purchase.final_manager_status === 'pending';\n                  return shouldShow;\n                })() && (\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => handleApprove('final')}\n                    className={`${approvalButtonClass} border border-gray-400 bg-white hover:bg-gray-50 hover:border-gray-500`}\n                  >\n                    <Check className=\"w-3 h-3\" />\n                    ìµœì¢… ìŠ¹ì¸\n                  </Button>\n                )}\n                {purchase.final_manager_status === 'approved' && (\n                  <div className=\"button-approved badge-text\">\n                    <Check className=\"w-3 h-3\" />\n                    ìµœì¢… ìŠ¹ì¸ì™„ë£Œ\n                  </div>\n                )}\n                {purchase.final_manager_status === 'rejected' && (\n                  <div className=\"button-rejected badge-text\">\n                    <X className=\"w-3 h-3\" />\n                    ìµœì¢… ë°˜ë ¤\n                  </div>\n                )}\n                {purchase.middle_manager_status !== 'approved' && purchase.final_manager_status === 'pending' && (\n                  <div className={`${approvalWaitingPillClass} border border-gray-300 text-gray-600 bg-white`}>\n                    ìµœì¢… ìŠ¹ì¸ëŒ€ê¸°\n                  </div>\n                )}\n              </div>\n              \n              {/* ìš°ì¸¡ ë¹ˆ ì˜ì—­ */}\n              <div></div>\n            </div>\n          </div>\n\n          {/* Main 2-Column Layout */}\n          <div className=\"flex flex-col lg:flex-row gap-3 sm:gap-6\">\n            {/* Left Column - Basic Info (Fixed Width) */}\n            <div className=\"lg:w-80 lg:flex-shrink-0 space-y-1 sm:space-y-4 relative\">\n              \n              {/* ë°œì£¼ ê¸°ë³¸ì •ë³´ */}\n              <div className=\"bg-white rounded-lg p-2 sm:p-3 border border-gray-100 shadow-sm\">\n                <div className=\"mb-3\">\n                  <div className=\"flex items-center justify-between\">\n                    <h3 className=\"modal-section-title flex items-center\">\n                      <FileText className=\"w-4 h-4 mr-2 text-gray-600\" />\n                      {purchase?.purchase_order_number || 'POë²ˆí˜¸ ì—†ìŒ'}\n                    </h3>\n                    {canReceiptCheck && activeTab === 'done' && (\n                      <button\n                        onClick={async () => {\n                          if (!purchase) return\n                          const isCurrentlyChecked = purchase.is_utk_checked || false\n                          const newStatus = !isCurrentlyChecked\n                          \n                          const confirmMessage = newStatus\n                            ? `ë°œì£¼ë²ˆí˜¸: ${purchase.purchase_order_number}\\n\\nUTK í™•ì¸ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`\n                            : `ë°œì£¼ë²ˆí˜¸: ${purchase.purchase_order_number}\\n\\nUTK í™•ì¸ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`\n                          \n                          if (!window.confirm(confirmMessage)) return\n                          \n                          try {\n                            const supabase = createClient()\n                            const { error } = await supabase\n                              .from('purchase_requests')\n                              .update({ is_utk_checked: newStatus })\n                              .eq('id', purchase.id)\n                            \n                            if (error) {\n                              logger.error('UTK í™•ì¸ DB ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { error, purchaseId: purchase.id })\n                              toast.error('UTK í™•ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n                              return\n                            }\n                            \n                            // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (ê°ì²´ ì°¸ì¡° ë³€ê²½ìœ¼ë¡œ React ì¬ë Œë”ë§ ë³´ì¥)\n                            setPurchase(prev => prev ? { \n                              ...prev, \n                              is_utk_checked: newStatus,\n                              updated_at: new Date().toISOString() // ê°•ì œë¡œ ê°ì²´ ì°¸ì¡° ë³€ê²½\n                            } : null)\n                            \n                            // ë©”ëª¨ë¦¬ ìºì‹œ ì—…ë°ì´íŠ¸\n                            if (purchase.id) {\n                              updatePurchaseInMemory(purchase.id, (prev) => ({\n                                ...prev,\n                                is_utk_checked: newStatus\n                              }))\n                            }\n                            \n                            toast.success(newStatus ? 'UTK í™•ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.' : 'UTK í™•ì¸ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.')\n                            \n                            await refreshModalData()\n                            const refreshResult = onRefresh?.(true, { silent: true })\n                            if (refreshResult instanceof Promise) {\n                              await refreshResult\n                            }\n                          } catch (error) {\n                            logger.error('UTK í™•ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜', error)\n                            toast.error('UTK í™•ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n                          }\n                        }}\n                        className={`button-base text-xs px-2 py-1 flex items-center ${\n                          purchase?.is_utk_checked\n                            ? 'button-toggle-active bg-orange-500 hover:bg-orange-600 text-white'\n                            : 'button-toggle-inactive'\n                        }`}\n                        title={purchase?.is_utk_checked ? 'UTK í™•ì¸ ì·¨ì†Œ' : 'UTK í™•ì¸'}\n                      >\n                        <CheckCircle className=\"w-3 h-3 mr-1\" />\n                        UTK {purchase?.is_utk_checked ? 'ì™„ë£Œ' : 'í™•ì¸'}\n                      </button>\n                    )}\n                  </div>\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">ë°œì£¼ì„œ ì¢…ë¥˜</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.request_type || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, request_type: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"ì¼ë°˜\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.request_type || 'ì¼ë°˜'}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">ê²°ì œ ì¢…ë¥˜</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.payment_category || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, payment_category: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"ë°œì£¼/êµ¬ë§¤ìš”ì²­/í˜„ì¥ê²°ì œ\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.payment_category || '-'}</p>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">ì…ê³  ìš”ì²­ì¼</span>\n                      {isEditing ? (\n                        <DatePickerPopover\n                          onDateSelect={(date) => {\n                            setEditedPurchase(prev => prev ? {\n                              ...prev,\n                              delivery_request_date: formatDateInput(date, 'yyyy-MM-dd')\n                            } : null)\n                          }}\n                          placeholder=\"ì…ê³  ìš”ì²­ì¼ì„ ì„ íƒí•˜ì„¸ìš”\"\n                          align=\"start\"\n                          side=\"bottom\"\n                        >\n                          <Button\n                            variant=\"outline\"\n                            className=\"mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] justify-start text-left font-normal business-radius-input\"\n                          >\n                            <Calendar className=\"mr-1 h-3 w-3\" />\n                            {editedPurchase?.delivery_request_date ? \n                              formatDate(editedPurchase.delivery_request_date) : \n                              'ë‚ ì§œ ì„ íƒ'\n                            }\n                          </Button>\n                        </DatePickerPopover>\n                      ) : (\n                        <p className=\"modal-subtitle\">{formatDate(purchase.delivery_request_date)}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label text-orange-500\">ë³€ê²½ ì…ê³ ì¼</span>\n                      {isEditing ? (\n                        <DatePickerPopover\n                          onDateSelect={(date) => {\n                            setEditedPurchase(prev => prev ? {\n                              ...prev,\n                              revised_delivery_request_date: formatDateInput(date, 'yyyy-MM-dd')\n                            } : null)\n                          }}\n                          placeholder=\"ë³€ê²½ ì…ê³ ì¼ì„ ì„ íƒí•˜ì„¸ìš”\"\n                          align=\"start\"\n                          side=\"bottom\"\n                        >\n                          <Button\n                            variant=\"outline\"\n                            className=\"mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] justify-start text-left font-normal business-radius-input\"\n                          >\n                            <Calendar className=\"mr-1 h-3 w-3\" />\n                            {editedPurchase?.revised_delivery_request_date ? \n                              formatDate(editedPurchase.revised_delivery_request_date) : \n                              'ë‚ ì§œ ì„ íƒ'\n                            }\n                          </Button>\n                        </DatePickerPopover>\n                      ) : (\n                        <p className=\"modal-subtitle text-orange-700\">\n                          {purchase.revised_delivery_request_date ? formatDate(purchase.revised_delivery_request_date) : 'ë¯¸ì„¤ì •'}\n                        </p>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/* ì—…ì²´ ì •ë³´ */}\n              <div className=\"bg-white rounded-lg p-2 sm:p-3 border border-gray-100 shadow-sm\">\n                <h3 className=\"modal-section-title mb-3 flex items-center\">\n                  <Building2 className=\"w-4 h-4 mr-2 text-gray-600\" />\n                  ì—…ì²´ ì •ë³´\n                </h3>\n                \n                <div className=\"space-y-2\">\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">ì—…ì²´ëª…</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.vendor?.vendor_name || editedPurchase?.vendor_name || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, vendor_name: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"ì—…ì²´ ì„ íƒ\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.vendor?.vendor_name || '-'}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">ì—…ì²´ ë‹´ë‹¹ì</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.vendor_contacts?.[0]?.contact_name || ''}\n                          onChange={(e) => {\n                            setEditedPurchase(prev => {\n                              if (!prev) return null;\n                              const contacts = prev.vendor_contacts || [];\n                              const updatedContacts = [...contacts];\n                              if (updatedContacts[0]) {\n                                updatedContacts[0] = { ...updatedContacts[0], contact_name: e.target.value };\n                              } else {\n                                updatedContacts[0] = { contact_name: e.target.value } as any;\n                              }\n                              return { ...prev, vendor_contacts: updatedContacts };\n                            })\n                          }}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"ë‹´ë‹¹ì ì„ íƒ\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.vendor_contacts?.[0]?.contact_name || '-'}</p>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">PJì—…ì²´</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.project_vendor || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, project_vendor: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"ì…ë ¥\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.project_vendor || '-'}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">Item</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.project_item || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, project_item: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"ì…ë ¥\"\n                        />\n                      ) : (\n                        <p className=\"modal-subtitle\">{purchase.project_item || '-'}</p>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">ìˆ˜ì£¼ë²ˆí˜¸</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.order_number || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, order_number: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"ì…ë ¥\"\n                        />\n                      ) : (\n                        <p className=\"modal-subtitle\">{purchase.order_number || '-'}</p>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n            </div>\n\n            {/* Right Column - Items List (Fit Width) */}\n            <div className=\"lg:w-fit lg:min-w-0 relative overflow-visible\">\n              \n              <div className=\"bg-white rounded-lg border border-gray-100 shadow-sm\">\n                <div className=\"p-2 sm:p-3 bg-gray-50 border-b border-gray-100 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-0\">\n                  <h3 className=\"modal-section-title flex items-center\">\n                    <Package className=\"w-4 h-4 mr-2 text-gray-600\" />\n                    í’ˆëª© ë¦¬ìŠ¤íŠ¸\n                    <span className=\"ml-2 badge-stats bg-gray-500 text-white\">\n                      {currentItems?.length || 0}ê°œ\n                    </span>\n                  </h3>\n                  {!isEditing && (\n                    <>\n                      {activeTab === 'purchase' && canPurchase && (\n                        <Button\n                          size=\"sm\"\n                          onClick={handleCompleteAllPayment}\n                          className=\"button-base bg-orange-500 hover:bg-orange-600 text-white\"\n                        >\n                          <CreditCard className=\"w-3 h-3 mr-1\" />\n                          ì „ì²´ êµ¬ë§¤ì™„ë£Œ\n                        </Button>\n                      )}\n                      {activeTab === 'receipt' && canReceiveItems && (\n                        <DatePickerPopover\n                          onDateSelect={handleCompleteAllReceipt}\n                          placeholder=\"ì „ì²´ ì…ê³ ì™„ë£Œ ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”\"\n                          align=\"end\"\n                          side=\"bottom\"\n                        >\n                          <Button\n                            size=\"sm\"\n                            className=\"button-base button-action-primary\"\n                          >\n                            <Truck className=\"w-3 h-3 mr-1\" />\n                            ì „ì²´ ì…ê³ ì™„ë£Œ\n                          </Button>\n                        </DatePickerPopover>\n                      )}\n                      {activeTab === 'done' && canReceiptCheck && (\n                        <div className=\"flex items-center gap-2\">\n                          <DatePickerPopover\n                            onDateSelect={handleCompleteAllStatement}\n                            placeholder=\"ì „ì²´ íšŒê³„ìƒ ì…ê³ ì¼ì„ ì„ íƒí•˜ì„¸ìš”\"\n                            align=\"end\"\n                            side=\"bottom\"\n                          >\n                            <Button\n                              size=\"sm\"\n                              className=\"button-base button-action-primary\"\n                            >\n                              <FileText className=\"w-3 h-3 mr-1\" />\n                              ê±°ë˜ëª…ì„¸ì„œ í™•ì¸\n                            </Button>\n                          </DatePickerPopover>\n                          <DateAmountPickerPopover\n                            onConfirm={handleBulkExpenditure}\n                            placeholder=\"ì¼ê´„ ì§€ì¶œ ë‚ ì§œì™€ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”\"\n                            align=\"end\"\n                            side=\"bottom\"\n                          >\n                            <Button\n                              size=\"sm\"\n                              className=\"button-base button-action-primary\"\n                            >\n                              <DollarSign className=\"w-3 h-3 mr-1\" />\n                              ì¼ê´„ì§€ì¶œ\n                            </Button>\n                          </DateAmountPickerPopover>\n                        </div>\n                      )}\n                    </>\n                  )}\n                </div>\n                \n                {/* Mobile Table Header */}\n                <div className=\"block sm:hidden bg-gray-50 px-2 py-1 border-b border-gray-100\">\n                  <div className=\"text-xs font-medium text-gray-600\">í’ˆëª© ëª©ë¡ (í„°ì¹˜í•˜ì—¬ ìŠ¤í¬ë¡¤)</div>\n                </div>\n                \n                {/* Items List with Header Inside Scrollable Container */}\n                <div className=\"max-h-[50vh] sm:max-h-[40vh] overflow-auto\">\n                  <div className=\"w-fit\">\n                    {/* Items Table Header - Sticky inside scroll container */}\n                    <div className=\"bg-gray-50 px-2 sm:px-3 py-1 border-b border-gray-100 sticky top-0 z-10 w-fit\">\n                      <div \n                        ref={headerRowRef}\n                         className=\"hidden sm:grid gap-2 modal-label w-fit\"\n                        style={{\n                          gridTemplateColumns: getGridTemplateColumns()\n                        }}\n                      >\n                        <div>í’ˆëª©ëª…</div>\n                        <div>ê·œê²©</div>\n                        <div className=\"text-center\">ìˆ˜ëŸ‰</div>\n                        <div className=\"text-right\">ë‹¨ê°€</div>\n                        <div className=\"text-right\">í•©ê³„</div>\n                        <div className=\"text-center\">ë¹„ê³ </div>\n                        {isEditing ? (\n                          <>\n                            <div className=\"text-center\">ì‚­ì œ</div>\n                            {activeTab === 'receipt' && (\n                              <>\n                                <div className=\"text-center\">ì‹¤ì œì…ê³ ì¼</div>\n                              </>\n                            )}\n                            {activeTab === 'done' && (\n                              <>\n                                <div className=\"text-center\">ê±°ë˜ëª…ì„¸ì„œ í™•ì¸</div>\n                                <div className=\"text-center\">íšŒê³„ìƒ ì…ê³ ì¼</div>\n                                <div className=\"text-center\">ì§€ì¶œì •ë³´</div>\n                              </>\n                            )}\n                          </>\n                        ) : (\n                          <>\n                            <div className=\"text-center\">\n                              {activeTab === 'purchase'\n                                ? 'êµ¬ë§¤ìƒíƒœ'\n                                : (activeTab === 'receipt' || activeTab === 'done')\n                                ? 'ì…ê³ ìƒíƒœ'\n                                : 'ìƒíƒœ'}\n                            </div>\n                            {activeTab === 'done' && (\n                              <>\n                                <div className=\"text-center\">ê±°ë˜ëª…ì„¸ì„œ í™•ì¸</div>\n                                <div className=\"text-center\">íšŒê³„ìƒ ì…ê³ ì¼</div>\n                                <div className=\"text-center\">ì§€ì¶œì •ë³´</div>\n                              </>\n                            )}\n                            {activeTab === 'receipt' && (\n                              <>\n                                <div className=\"text-center\">ì‹¤ì œì…ê³ ì¼</div>\n                              </>\n                            )}\n                          </>\n                        )}\n                      </div>\n                    </div>\n                    <div className=\"divide-y divide-gray-100 overflow-visible w-fit\">\n                      {(isEditing ? editedItems : currentItems)?.map((item, index) => (\n                        <div key={index} className=\"px-2 sm:px-3 py-1 border-b border-gray-50 hover:bg-gray-50/50 relative overflow-visible\">\n                          {/* Desktop Layout */}\n                          <div className={`hidden sm:grid items-center gap-2 overflow-visible w-fit`} style={{\n                            gridTemplateColumns: getGridTemplateColumns()\n                          }}>\n                            {/* í’ˆëª©ëª… */}\n                            <div className=\"min-w-0 relative overflow-visible flex items-center\">\n                              {isEditing ? (\n                                <Input\n                                  value={item.item_name}\n                                  onChange={(e) => handleItemChange(index, 'item_name', e.target.value)}\n                                  onFocus={() => setFocusedInput(`item_name_${index}`)}\n                                  onBlur={() => setFocusedInput(null)}\n                                  className={`modal-label border-gray-200 rounded-lg w-full !px-1.5 !py-0.5 !text-[10px] focus:border-blue-400 transition-all duration-200 ${\n                                    focusedInput === `item_name_${index}` \n                                      ? '!h-auto !min-h-[20px] !absolute !z-[9999] !bg-white !shadow-lg !left-0 !right-0 !-translate-y-1/2 !top-1/2 !whitespace-normal' \n                                      : '!h-5 !truncate'\n                                  }`}\n                                  placeholder=\"í’ˆëª©ëª…\"\n                                  disabled={canEditLimited && !canEditAll}  // lead buyerëŠ” í’ˆëª©ëª… ìˆ˜ì • ë¶ˆê°€\n                                />\n                              ) : (\n                                <div \n                                  className=\"modal-value\" \n                                  style={{\n                                    whiteSpace: 'normal',\n                                    wordBreak: 'break-all', // ì–´ë””ì„œë“  ì¤„ë°”ê¿ˆ ê°€ëŠ¥ (í•˜ì´í”ˆ ë¬´ì‹œ)\n                                    overflowWrap: 'break-word',\n                                    hyphens: 'none', // í•˜ì´í”ˆì—ì„œ ìë™ ì¤„ë°”ê¿ˆ ë°©ì§€\n                                    WebkitHyphens: 'none',\n                                    MozHyphens: 'none',\n                                    msHyphens: 'none',\n                                    lineHeight: '1.4',\n                                    maxHeight: '2.8em', // ìµœëŒ€ 2í–‰ ë†’ì´\n                                    overflow: 'hidden',\n                                    display: '-webkit-box',\n                                    WebkitLineClamp: 2,\n                                    WebkitBoxOrient: 'vertical'\n                                  }}\n                                  title={item.item_name || 'í’ˆëª©ëª… ì—†ìŒ'}\n                                >\n                                  {item.item_name || 'í’ˆëª©ëª… ì—†ìŒ'}\n                                </div>\n                              )}\n                            </div>\n                            \n                            {/* ê·œê²© */}\n                            <div className=\"min-w-0 relative overflow-visible flex items-center\" style={{ width: '200px', maxWidth: '200px', minWidth: '200px' }}>\n                              {isEditing ? (\n                                <Input\n                                  value={item.specification}\n                                  onChange={(e) => handleItemChange(index, 'specification', e.target.value)}\n                                  onFocus={() => setFocusedInput(`specification_${index}`)}\n                                  onBlur={() => setFocusedInput(null)}\n                                  className={`modal-label border-gray-200 rounded-lg w-full !px-1.5 !py-0.5 !text-[10px] focus:border-blue-400 transition-all duration-200 ${\n                                    focusedInput === `specification_${index}` \n                                      ? '!h-auto !min-h-[20px] !absolute !z-[9999] !bg-white !shadow-lg !left-1/2 !-translate-x-1/2 !-translate-y-1/2 !top-1/2 !whitespace-normal !w-[300px]' \n                                      : '!h-5 !truncate'\n                                  }`}\n                                  placeholder=\"ê·œê²©\"\n                                  disabled={canEditLimited && !canEditAll}  // lead buyerëŠ” ê·œê²© ìˆ˜ì • ë¶ˆê°€\n                                />\n                              ) : (\n                                <div \n                                  className=\"text-[11px] text-gray-600 font-medium\" \n                                  style={{\n                                    whiteSpace: 'normal',\n                                    wordBreak: 'break-all', // ì–´ë””ì„œë“  ì¤„ë°”ê¿ˆ ê°€ëŠ¥ (í•˜ì´í”ˆ ë¬´ì‹œ)\n                                    overflowWrap: 'break-word',\n                                    hyphens: 'none', // í•˜ì´í”ˆì—ì„œ ìë™ ì¤„ë°”ê¿ˆ ë°©ì§€\n                                    WebkitHyphens: 'none', // Safari ì§€ì›\n                                    MozHyphens: 'none', // Firefox ì§€ì›\n                                    msHyphens: 'none', // IE ì§€ì›\n                                    lineHeight: '1.4',\n                                    maxHeight: '2.8em', // ìµœëŒ€ 2í–‰ ë†’ì´\n                                    overflow: 'hidden',\n                                    display: '-webkit-box',\n                                    WebkitLineClamp: 2, // ìµœëŒ€ 2í–‰ê¹Œì§€ë§Œ í‘œì‹œ\n                                    WebkitBoxOrient: 'vertical'\n                                  }}\n                                  title={item.specification || '-'}\n                                >\n                                  {item.specification || '-'}\n                                </div>\n                              )}\n                            </div>\n                            \n                            {/* ìˆ˜ëŸ‰ */}\n                            <div className=\"text-center min-w-0 flex items-center justify-center\">\n                              {isEditing ? (\n                                <Input\n                                  type=\"number\"\n                                  value={item.quantity}\n                                  onChange={(e) => handleItemChange(index, 'quantity', Number(e.target.value))}\n                                  className=\"border-gray-200 rounded-lg text-center w-full !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400\"\n                                  placeholder=\"ìˆ˜ëŸ‰\"\n                                  max=\"99999\"\n                                />\n                              ) : (\n                                <span className=\"modal-subtitle\">{item.quantity || 0}</span>\n                              )}\n                            </div>\n                            \n                            {/* ë‹¨ê°€ */}\n                            <div className=\"text-right min-w-0 flex items-center justify-end\">\n                              {isEditing ? (\n                                <Input\n                                  type=\"number\"\n                                  value={item.unit_price_value}\n                                  onChange={(e) => handleItemChange(index, 'unit_price_value', Number(e.target.value))}\n                                  className=\"border-gray-200 rounded-lg text-right w-full !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400\"\n                                  placeholder=\"ë‹¨ê°€\"\n                                  max=\"100000000000\"\n                                />\n                              ) : (\n                                <span className=\"modal-subtitle\">â‚©{formatCurrency(item.unit_price_value)}</span>\n                              )}\n                            </div>\n                            \n                            {/* í•©ê³„ (ìë™ê³„ì‚°, ìˆ˜ì • ë¶ˆê°€) */}\n                            <div className=\"text-right min-w-0 flex items-center justify-end\">\n                              <span className={isEditing ? \"modal-subtitle\" : \"modal-value\"}>â‚©{formatCurrency(item.amount_value || 0)}</span>\n                            </div>\n                            \n                            {/* ë¹„ê³  */}\n                            <div className=\"min-w-0 flex justify-center items-center text-center relative overflow-visible\" style={{ width: '150px', maxWidth: '150px', minWidth: '150px' }}>\n                              {isEditing ? (\n                                <Input\n                                  value={item.remark || ''}\n                                  disabled={canEditLimited && !canEditAll}  // lead buyerëŠ” ë¹„ê³  ìˆ˜ì • ë¶ˆê°€\n                                  onChange={(e) => handleItemChange(index, 'remark', e.target.value)}\n                                  onFocus={() => setFocusedInput(`remark_${index}`)}\n                                  onBlur={() => setFocusedInput(null)}\n                                  className={`modal-label border-gray-200 rounded-lg text-center w-full !px-1.5 !py-0.5 !text-[10px] focus:border-blue-400 transition-all duration-200 ${\n                                    focusedInput === `remark_${index}` \n                                      ? '!h-auto !min-h-[20px] !absolute !z-[9999] !bg-white !shadow-lg !left-0 !right-0 !-translate-y-1/2 !top-1/2 !whitespace-normal !text-left' \n                                      : '!h-5 !truncate'\n                                  }`}\n                                  placeholder=\"ë¹„ê³ \"\n                                />\n                              ) : (\n                                <div \n                                  className=\"text-[11px] text-gray-600 font-medium\"\n                                  style={{\n                                    width: '150px',\n                                    maxWidth: '150px',\n                                    minWidth: '150px',\n                                    boxSizing: 'border-box',\n                                    whiteSpace: 'normal',\n                                    wordBreak: 'break-all',\n                                    overflowWrap: 'break-word',\n                                    hyphens: 'none',\n                                    WebkitHyphens: 'none',\n                                    MozHyphens: 'none',\n                                    msHyphens: 'none',\n                                    lineHeight: '1.4',\n                                    maxHeight: '2.8em',\n                                    overflow: 'hidden',\n                                    display: '-webkit-box',\n                                    WebkitLineClamp: 2,\n                                    WebkitBoxOrient: 'vertical'\n                                  }}\n                                  title={item.remark || '-'}\n                                >\n                                  {item.remark || '-'}\n                                </div>\n                              )}\n                            </div>\n                            \n                            {/* ìƒíƒœ/ì•¡ì…˜ - ìŠ¹ì¸ëŒ€ê¸°íƒ­ì—ì„œëŠ” ì œì™¸ */}\n                            {activeTab !== 'pending' && (\n                              <div className=\"text-center flex justify-center items-center\">\n                                {isEditing ? (\n                                  <Button\n                                    size=\"sm\"\n                                    variant=\"ghost\"\n                                    onClick={() => handleRemoveItem(index)}\n                                    className=\"text-red-600 hover:bg-red-50 rounded-lg p-1 h-6 w-6\"\n                                  >\n                                    <Trash2 className=\"w-3 h-3\" />\n                                  </Button>\n                                ) : (\n                                  <>\n                                    {/* êµ¬ë§¤ íƒ­ì—ì„œì˜ êµ¬ë§¤ì™„ë£Œ ìƒíƒœ */}\n                                    {activeTab === 'purchase' && (\n                                    <div className=\"flex justify-center\">\n                                      {canPurchase ? (\n                                        <button\n                                          onClick={() => handlePaymentToggle(item.id, !item.is_payment_completed)}\n                                          className={`${\n                                            item.is_payment_completed\n                                              ? 'button-toggle-active bg-orange-500 hover:bg-orange-600 text-white'\n                                              : 'button-toggle-inactive'\n                                          }`}\n                                        >\n                                          {item.is_payment_completed ? 'êµ¬ë§¤ì™„ë£Œ' : 'êµ¬ë§¤ëŒ€ê¸°'}\n                                        </button>\n                                      ) : (\n                                        <span className={`${\n                                          item.is_payment_completed \n                                            ? 'button-toggle-active bg-orange-500 text-white' \n                                            : 'button-waiting-inactive'\n                                        }`}>\n                                          {item.is_payment_completed ? 'êµ¬ë§¤ì™„ë£Œ' : 'êµ¬ë§¤ëŒ€ê¸°'}\n                                        </span>\n                                      )}\n                                    </div>\n                                  )}\n                                  \n                                  {/* ì…ê³  íƒ­ì—ì„œì˜ ì…ê³ ì™„ë£Œ ìƒíƒœ */}\n                                  {activeTab === 'receipt' && (\n                                    <div className=\"flex justify-center\">\n                                      {canReceiptCheck ? (\n                                        actualReceivedAction.isCompleted(item) ? (\n                                          <button\n                                            onClick={() => {\n                                              actualReceivedAction.handleCancel(item.id, {\n                                                item_name: item.item_name,\n                                                specification: item.specification,\n                                                quantity: item.quantity,\n                                                unit_price_value: item.unit_price_value,\n                                                amount_value: item.amount_value,\n                                                remark: item.remark\n                                              })\n                                            }}\n                                            className=\"button-action-primary\"\n                                          >\n                                            {actualReceivedAction.config.completedText}\n                                          </button>\n                                        ) : (\n                                          <DatePickerPopover\n                                            onDateSelect={(date) => {\n                                              actualReceivedAction.handleConfirm(item.id, date, {\n                                                item_name: item.item_name,\n                                                specification: item.specification,\n                                                quantity: item.quantity,\n                                                unit_price_value: item.unit_price_value,\n                                                amount_value: item.amount_value,\n                                                remark: item.remark\n                                              })\n                                            }}\n                                            placeholder=\"ì‹¤ì œ ì…ê³ ëœ ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”\"\n                                            align=\"center\"\n                                            side=\"bottom\"\n                                          >\n                                            <button className=\"button-toggle-inactive\">\n                                              {actualReceivedAction.config.waitingText}\n                                            </button>\n                                          </DatePickerPopover>\n                                        )\n                                      ) : (\n                                        <span className={`${\n                                          actualReceivedAction.isCompleted(item)\n                                            ? 'button-action-primary' \n                                            : 'button-waiting-inactive'\n                                        }`}>\n                                          {actualReceivedAction.isCompleted(item) ? actualReceivedAction.config.completedText : actualReceivedAction.config.waitingText}\n                                        </span>\n                                      )}\n                                    </div>\n                                  )}\n                                  \n                                  {/* ì „ì²´ í•­ëª© íƒ­ì—ì„œëŠ” ì…ê³  ìƒíƒœë§Œ í‘œì‹œ (í´ë¦­ ë¶ˆê°€) */}\n                                  {activeTab === 'done' && (\n                                    <div className=\"flex justify-center\">\n                                      <span className={`button-base ${\n                                        actualReceivedAction.isCompleted(item)\n                                          ? 'bg-green-500 hover:bg-green-600 text-white' \n                                          : 'border border-gray-300 text-gray-600 bg-white hover:bg-gray-50'\n                                      }`}>\n                                        {actualReceivedAction.isCompleted(item) ? 'ì…ê³ ì™„ë£Œ' : 'ì…ê³ ëŒ€ê¸°'}\n                                      </span>\n                                    </div>\n                                  )}\n                                  \n                                  {/* ê¸°íƒ€ íƒ­ì—ì„œëŠ” ê¸°ë³¸ ìƒíƒœ í‘œì‹œ */}\n                                  {activeTab !== 'purchase' && activeTab !== 'receipt' && activeTab !== 'done' && (\n                                    <div className=\"flex justify-center\">\n                                      <span className=\"badge-text\">-</span>\n                                    </div>\n                                  )}\n                                </>\n                              )}\n                              </div>\n                            )}\n                            \n                            {/* ì‹¤ì œ ì…ê³  ë‚ ì§œ - ì…ê³  íƒ­ì—ì„œë§Œ í‘œì‹œ (ìƒíƒœ ì»¬ëŸ¼ ì˜¤ë¥¸ìª½) */}\n                            {activeTab === 'receipt' && (\n                              <div className=\"text-center flex justify-center items-center pl-2\">\n                                {actualReceivedAction.getCompletedDate(item) ? (\n                                  <div className=\"modal-subtitle text-green-700\">\n                                    {new Date(actualReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                                      year: 'numeric',\n                                      month: '2-digit',\n                                      day: '2-digit'\n                                    })}\n                                  </div>\n                                ) : (\n                                  <span className=\"modal-subtitle text-gray-400\">-</span>\n                                )}\n                              </div>\n                            )}\n\n                            {/* ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ - ì „ì²´í•­ëª© íƒ­ì—ì„œë§Œ í‘œì‹œ */}\n                            {activeTab === 'done' && (\n                              <div className=\"text-center flex justify-center items-center\">\n                                {canReceiptCheck ? (\n                                  statementReceivedAction.isCompleted(item) ? (\n                                    <button\n                                      onClick={() => {\n                                        statementReceivedAction.handleCancel(item.id, {\n                                          item_name: item.item_name,\n                                          specification: item.specification,\n                                          quantity: item.quantity,\n                                          unit_price_value: item.unit_price_value,\n                                          amount_value: item.amount_value,\n                                          remark: item.remark\n                                        })\n                                      }}\n                                      className=\"button-action-primary hover:bg-green-600\"\n                                      title=\"í´ë¦­í•˜ì—¬ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ì·¨ì†Œ\"\n                                    >\n                                      {statementReceivedAction.config.completedText}\n                                    </button>\n                                  ) : (\n                                    <DatePickerPopover\n                                      onDateSelect={(date) => {\n                                        statementReceivedAction.handleConfirm(item.id, date, {\n                                          item_name: item.item_name,\n                                          specification: item.specification,\n                                          quantity: item.quantity,\n                                          unit_price_value: item.unit_price_value,\n                                          amount_value: item.amount_value,\n                                          remark: item.remark\n                                        })\n                                      }}\n                                      placeholder=\"íšŒê³„ìƒ ì…ê³ ì¼ì„ ì„ íƒí•˜ì„¸ìš”\"\n                                      align=\"center\"\n                                      side=\"bottom\"\n                                    >\n                                      <button \n                                        className=\"button-toggle-inactive\"\n                                        onClick={() => {}}\n                                      >\n                                        {statementReceivedAction.config.waitingText}\n                                      </button>\n                                    </DatePickerPopover>\n                                  )\n                                ) : (\n                                  <span className={`${\n                                    statementReceivedAction.isCompleted(item)\n                                      ? 'button-action-primary' \n                                      : 'button-waiting-inactive'\n                                  }`}>\n                                    {statementReceivedAction.isCompleted(item) ? statementReceivedAction.config.completedText : statementReceivedAction.config.waitingText}\n                                  </span>\n                                )}\n                              </div>\n                            )}\n\n                            {/* íšŒê³„ìƒ ì…ê³ ì¼ - ì „ì²´í•­ëª© íƒ­ì—ì„œë§Œ í‘œì‹œ */}\n                            {activeTab === 'done' && (\n                              <div className=\"text-center flex justify-center items-center\">\n                                {statementReceivedAction.getCompletedDate(item) ? (\n                                  <div className=\"modal-subtitle text-blue-700\">\n                                    {new Date(statementReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                                      year: 'numeric',\n                                      month: '2-digit',\n                                      day: '2-digit'\n                                    })}\n                                  </div>\n                                ) : (\n                                  <span className=\"modal-subtitle text-gray-400\">-</span>\n                                )}\n                              </div>\n                            )}\n\n                            {/* ì§€ì¶œì •ë³´ - ì „ì²´í•­ëª© íƒ­ì—ì„œë§Œ í‘œì‹œ */}\n                            {activeTab === 'done' && (\n                              <div className=\"text-center flex justify-center items-center\">\n                                {(() => {\n                                  const hasExpenditure = item.expenditure_date && \n                                                        item.expenditure_amount !== null && \n                                                        item.expenditure_amount !== undefined\n                                  \n                                  if (canReceiptCheck) {\n                                    return hasExpenditure ? (\n                                      <div className=\"w-full px-1 leading-none\">\n                                        <div className=\"text-blue-700 text-[9px] leading-[1.1] font-normal\">\n                                          {new Date(item.expenditure_date).toLocaleDateString('ko-KR', {\n                                            year: 'numeric',\n                                            month: '2-digit',\n                                            day: '2-digit'\n                                          })}\n                                        </div>\n                                        <div className=\"text-gray-700 text-[9px] leading-[1.1] font-normal\">\n                                          â‚©{Number(item.expenditure_amount).toLocaleString()}\n                                        </div>\n                                      </div>\n                                    ) : (\n                                      <DateAmountPickerPopover\n                                        onConfirm={(date, amount) => handleItemExpenditure(item.id, date, amount)}\n                                        placeholder=\"ì§€ì¶œ ë‚ ì§œì™€ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”\"\n                                        align=\"center\"\n                                        side=\"bottom\"\n                                      >\n                                        <button className=\"button-toggle-inactive\">\n                                          ì§€ì¶œì…ë ¥\n                                        </button>\n                                      </DateAmountPickerPopover>\n                                    )\n                                  } else {\n                                    return hasExpenditure ? (\n                                      <div className=\"w-full px-1 leading-none\">\n                                        <div className=\"text-blue-700 text-[9px] leading-[1.1] font-normal\">\n                                          {new Date(item.expenditure_date).toLocaleDateString('ko-KR', {\n                                            year: 'numeric',\n                                            month: '2-digit',\n                                            day: '2-digit'\n                                          })}\n                                        </div>\n                                        <div className=\"text-gray-700 text-[9px] leading-[1.1] font-normal\">\n                                          â‚©{Number(item.expenditure_amount).toLocaleString()}\n                                        </div>\n                                      </div>\n                                    ) : (\n                                      <span className=\"modal-subtitle text-gray-400\">-</span>\n                                    )\n                                  }\n                                })()}\n                              </div>\n                            )}\n\n                          </div>\n                          \n                          {/* Mobile Layout */}\n                          <div className=\"block sm:hidden space-y-2\">\n                            <div className=\"flex justify-between items-start\">\n                              <div className=\"flex-1 min-w-0 relative\">\n                                {isEditing ? (\n                                  <Input\n                                    value={item.item_name}\n                                    onChange={(e) => handleItemChange(index, 'item_name', e.target.value)}\n                                    onFocus={() => setFocusedInput(`m_item_name_${index}`)}\n                                    onBlur={() => setFocusedInput(null)}\n                                    className={`modal-label border-gray-200 rounded-lg w-full !px-1.5 !py-0.5 !text-[10px] focus:border-blue-400 transition-all duration-200 ${\n                                      focusedInput === `m_item_name_${index}` \n                                        ? '!h-auto !min-h-[20px] !absolute !z-[9999] !bg-white !shadow-lg !left-0 !right-0 !-translate-y-1/2 !top-1/2 !whitespace-normal' \n                                        : '!h-5 !truncate'\n                                    }`}\n                                    placeholder=\"í’ˆëª©ëª…\"\n                                    disabled={canEditLimited && !canEditAll}  // lead buyerëŠ” í’ˆëª©ëª… ìˆ˜ì • ë¶ˆê°€\n                                  />\n                                ) : (\n                                  <div className=\"modal-value font-medium\">{item.item_name || 'í’ˆëª©ëª… ì—†ìŒ'}</div>\n                                )}\n                                {isEditing ? (\n                                  <Input\n                                    value={item.specification}\n                                    onChange={(e) => handleItemChange(index, 'specification', e.target.value)}\n                                    onFocus={() => setFocusedInput(`m_specification_${index}`)}\n                                    onBlur={() => setFocusedInput(null)}\n                                    className={`modal-label border-gray-200 rounded-lg mt-1 w-full !px-1.5 !py-0.5 !text-[10px] focus:border-blue-400 transition-all duration-200 ${\n                                      focusedInput === `m_specification_${index}` \n                                        ? '!h-auto !min-h-[20px] !absolute !z-[9999] !bg-white !shadow-lg !left-0 !right-0 !-translate-y-1/2 !top-1/2 !whitespace-normal !w-full' \n                                        : '!h-5 !truncate'\n                                    }`}\n                                    placeholder=\"ê·œê²©\"\n                                    disabled={canEditLimited && !canEditAll}  // lead buyerëŠ” ê·œê²© ìˆ˜ì • ë¶ˆê°€\n                                  />\n                                ) : (\n                                  <div className=\"modal-subtitle text-gray-500\">{item.specification || '-'}</div>\n                                )}\n                              </div>\n                              <div className=\"ml-3 text-right flex-shrink-0\">\n                                <div className={`${isEditing ? \"modal-subtitle\" : \"modal-value\"} font-semibold`}>â‚©{formatCurrency(item.amount_value || 0)}</div>\n                              </div>\n                            </div>\n                            \n                            <div className=\"grid grid-cols-3 gap-2 text-sm\">\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">ìˆ˜ëŸ‰:</span>\n                                {isEditing ? (\n                                  <Input\n                                    type=\"number\"\n                                    value={item.quantity}\n                                    onChange={(e) => handleItemChange(index, 'quantity', Number(e.target.value))}\n                                    className=\"border-gray-200 rounded-lg mt-1 w-full !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400\"\n                                    placeholder=\"ìˆ˜ëŸ‰\"\n                                  />\n                                ) : (\n                                  <div className=\"modal-subtitle\">{item.quantity || 0}</div>\n                                )}\n                              </div>\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">ë‹¨ê°€:</span>\n                                {isEditing ? (\n                                  <Input\n                                    type=\"number\"\n                                    value={item.unit_price_value}\n                                    onChange={(e) => handleItemChange(index, 'unit_price_value', Number(e.target.value))}\n                                    className=\"border-gray-200 rounded-lg mt-1 w-full !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400\"\n                                    placeholder=\"ë‹¨ê°€\"\n                                  />\n                                ) : (\n                                  <div className=\"modal-subtitle\">â‚©{formatCurrency(item.unit_price_value)}</div>\n                                )}\n                              </div>\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">ìƒíƒœ:</span>\n                                <div className=\"mt-1\">\n                                  {isEditing ? (\n                                    <Button\n                                      size=\"sm\"\n                                      variant=\"ghost\"\n                                      onClick={() => handleRemoveItem(index)}\n                                      className=\"text-red-600 hover:bg-red-50 rounded-lg p-1 h-6 w-6\"\n                                    >\n                                      <Trash2 className=\"w-3 h-3\" />\n                                    </Button>\n                                  ) : (\n                                    <>\n                                      {activeTab === 'purchase' && (\n                                        <>\n                                          {canPurchase ? (\n                                            <button\n                                              onClick={() => handlePaymentToggle(item.id, !item.is_payment_completed)}\n                                              className={`text-xs px-2 py-1 rounded ${\n                                                item.is_payment_completed\n                                                  ? 'bg-orange-500 text-white hover:bg-orange-600'\n                                                  : 'bg-gray-100 text-gray-600'\n                                              }`}\n                                            >\n                                              {item.is_payment_completed ? 'êµ¬ë§¤ì™„ë£Œ' : 'êµ¬ë§¤ëŒ€ê¸°'}\n                                            </button>\n                                          ) : (\n                                            <span className={`text-xs px-2 py-1 rounded ${\n                                              item.is_payment_completed \n                                                ? 'bg-orange-500 text-white' \n                                                : 'bg-gray-100 text-gray-400'\n                                            }`}>\n                                              {item.is_payment_completed ? 'êµ¬ë§¤ì™„ë£Œ' : 'êµ¬ë§¤ëŒ€ê¸°'}\n                                            </span>\n                                          )}\n                                        </>\n                                      )}\n                                      \n                                      {activeTab === 'receipt' && (\n                                        <>\n                                          {canReceiptCheck ? (\n                                            actualReceivedAction.isCompleted(item) ? (\n                                              <button\n                                                onClick={() => {\n                                                  actualReceivedAction.handleCancel(item.id, {\n                                                    item_name: item.item_name,\n                                                    specification: item.specification,\n                                                    quantity: item.quantity,\n                                                    unit_price_value: item.unit_price_value,\n                                                    amount_value: item.amount_value,\n                                                    remark: item.remark\n                                                  })\n                                                }}\n                                                className=\"text-xs px-2 py-1 rounded button-action-primary\"\n                                              >\n                                                {actualReceivedAction.config.completedText}\n                                              </button>\n                                            ) : (\n                                              <DatePickerPopover\n                                                onDateSelect={(date) => {\n                                                  actualReceivedAction.handleConfirm(item.id, date, {\n                                                    item_name: item.item_name,\n                                                    specification: item.specification,\n                                                    quantity: item.quantity,\n                                                    unit_price_value: item.unit_price_value,\n                                                    amount_value: item.amount_value,\n                                                    remark: item.remark\n                                                  })\n                                                }}\n                                                placeholder=\"ì‹¤ì œ ì…ê³ ëœ ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”\"\n                                                align=\"center\"\n                                                side=\"bottom\"\n                                              >\n                                                <button className=\"text-xs px-2 py-1 rounded bg-gray-100 text-gray-600\">\n                                                  {actualReceivedAction.config.waitingText}\n                                                </button>\n                                              </DatePickerPopover>\n                                            )\n                                          ) : (\n                                            <span className={`text-xs px-2 py-1 rounded ${\n                                              actualReceivedAction.isCompleted(item)\n                                                ? 'button-action-primary' \n                                                : 'bg-gray-100 text-gray-400'\n                                            }`}>\n                                              {actualReceivedAction.isCompleted(item) ? actualReceivedAction.config.completedText : actualReceivedAction.config.waitingText}\n                                            </span>\n                                          )}\n                                        </>\n                                      )}\n                                      \n                                      {activeTab === 'done' && (\n                                        <>\n                                          {/* ì „ì²´ í•­ëª© íƒ­ì—ì„œëŠ” ì…ê³  ìƒíƒœë§Œ í‘œì‹œ (í´ë¦­ ë¶ˆê°€) */}\n                                          <span className={`button-base ${\n                                            actualReceivedAction.isCompleted(item)\n                                              ? 'bg-green-500 text-white' \n                                              : 'border border-gray-300 text-gray-600 bg-white'\n                                          }`}>\n                                            {actualReceivedAction.isCompleted(item) ? 'ì…ê³ ì™„ë£Œ' : 'ì…ê³ ëŒ€ê¸°'}\n                                          </span>\n                                        </>\n                                      )}\n                                      \n                                      {activeTab !== 'purchase' && activeTab !== 'receipt' && activeTab !== 'done' && (\n                                        <span className=\"text-xs text-gray-400\">-</span>\n                                      )}\n                                    </>\n                                  )}\n                                </div>\n                              </div>\n                            </div>\n                            \n                            {(item.remark || isEditing) && (\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">ë¹„ê³ :</span>\n                                {isEditing ? (\n                                  <Input\n                                    value={item.remark || ''}\n                                    onChange={(e) => handleItemChange(index, 'remark', e.target.value)}\n                                    className=\"modal-label border-gray-200 rounded-lg mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                    placeholder=\"ë¹„ê³ \"\n                                  />\n                                ) : (\n                                  <div className=\"modal-subtitle text-gray-500 mt-1\">{item.remark || '-'}</div>\n                                )}\n                              </div>\n                            )}\n                            \n                            {/* ëª¨ë°”ì¼ì—ì„œ ì‹¤ì œ ì…ê³  ë‚ ì§œ í‘œì‹œ */}\n                            {!isEditing && activeTab === 'receipt' && actualReceivedAction.getCompletedDate(item) && (\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">ì‹¤ì œì…ê³ ì¼:</span>\n                                <div className=\"mt-1\">\n                                  <div className=\"modal-subtitle text-green-700\">\n                                    {new Date(actualReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                                      year: 'numeric',\n                                      month: '2-digit',\n                                      day: '2-digit'\n                                    })}\n                                  </div>\n                                  <div className=\"text-[9px] text-gray-500\">\n                                    {new Date(actualReceivedAction.getCompletedDate(item)).toLocaleTimeString('ko-KR', {\n                                      hour: '2-digit',\n                                      minute: '2-digit'\n                                    })}\n                                  </div>\n                                </div>\n                              </div>\n                            )}\n\n                            {/* ëª¨ë°”ì¼ì—ì„œ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ í‘œì‹œ - ì „ì²´í•­ëª© íƒ­ì—ì„œë§Œ */}\n                            {!isEditing && activeTab === 'done' && (\n                              <div className=\"flex items-center justify-between\">\n                                <span className=\"text-gray-500 text-xs\">ê±°ë˜ëª…ì„¸ì„œ í™•ì¸:</span>\n                                <div className=\"flex items-center gap-2\">\n                                  {canReceiptCheck ? (\n                                    statementReceivedAction.isCompleted(item) ? (\n                                      <button\n                                        onClick={() => {\n                                          statementReceivedAction.handleCancel(item.id, {\n                                            item_name: item.item_name,\n                                            specification: item.specification,\n                                            quantity: item.quantity,\n                                            unit_price_value: item.unit_price_value,\n                                            amount_value: item.amount_value,\n                                            remark: item.remark\n                                          })\n                                        }}\n                                        className=\"text-xs px-2 py-1 rounded button-action-primary hover:bg-green-600\"\n                                        title=\"í´ë¦­í•˜ì—¬ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ì·¨ì†Œ\"\n                                      >\n                                        {statementReceivedAction.config.completedText}\n                                      </button>\n                                    ) : (\n                                      <DatePickerPopover\n                                        onDateSelect={(date) => {\n                                          statementReceivedAction.handleConfirm(item.id, date, {\n                                            item_name: item.item_name,\n                                            specification: item.specification,\n                                            quantity: item.quantity,\n                                            unit_price_value: item.unit_price_value,\n                                            amount_value: item.amount_value,\n                                            remark: item.remark\n                                          })\n                                        }}\n                                        placeholder=\"íšŒê³„ìƒ ì…ê³ ì¼ì„ ì„ íƒí•˜ì„¸ìš”\"\n                                        align=\"end\"\n                                        side=\"bottom\"\n                                      >\n                                        <button \n                                          className=\"text-xs px-2 py-1 rounded bg-gray-100 text-gray-600\"\n                                          onClick={() => {}}\n                                        >\n                                          {statementReceivedAction.config.waitingText}\n                                        </button>\n                                      </DatePickerPopover>\n                                    )\n                                  ) : (\n                                    <span className={`text-xs px-2 py-1 rounded ${\n                                      statementReceivedAction.isCompleted(item)\n                                        ? 'button-action-primary' \n                                        : 'bg-gray-100 text-gray-400'\n                                    }`}>\n                                      {statementReceivedAction.isCompleted(item) ? statementReceivedAction.config.completedText : statementReceivedAction.config.waitingText}\n                                    </span>\n                                  )}\n                                </div>\n                              </div>\n                            )}\n\n                            {/* ëª¨ë°”ì¼ì—ì„œ íšŒê³„ìƒ ì…ê³ ì¼ í‘œì‹œ - ì „ì²´í•­ëª© íƒ­ì—ì„œë§Œ */}\n                            {!isEditing && activeTab === 'done' && statementReceivedAction.getCompletedDate(item) && (\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">íšŒê³„ìƒ ì…ê³ ì¼:</span>\n                                <div className=\"mt-1\">\n                                  <div className=\"modal-subtitle text-blue-700\">\n                                    {new Date(statementReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                                      year: 'numeric',\n                                      month: '2-digit',\n                                      day: '2-digit'\n                                    })}\n                                  </div>\n                                </div>\n                              </div>\n                            )}\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                </div>\n                \n                {/* í•©ê³„ */}\n                <div className=\"bg-gray-50 px-2 sm:px-3 border-t border-gray-100\">\n                  <div className=\"hidden sm:grid items-center gap-2 py-0.5 w-fit\" style={{\n                    gridTemplateColumns: getGridTemplateColumns()\n                  }}>\n                    {/* í’ˆëª©ëª… */}\n                    <div></div>\n                    {/* ê·œê²© */}\n                    <div></div>\n                    {/* ìˆ˜ëŸ‰ */}\n                    <div></div>\n                    {/* ë‹¨ê°€ */}\n                    <div className=\"text-right\">\n                      <span className=\"text-[12px] font-bold text-gray-900\">ì´ì•¡</span>\n                    </div>\n                    {/* í•©ê³„ */}\n                    <div className=\"text-right\">\n                      <span className=\"text-[12px] font-bold text-gray-900\">\n                        â‚©{formatCurrency(\n                          (isEditing ? editedItems : currentItems)?.reduce((sum, item) => sum + (item.amount_value || 0), 0) || 0\n                        )}\n                      </span>\n                    </div>\n                    {/* ë‚˜ë¨¸ì§€ ì¹¼ëŸ¼ë“¤ì€ ë¹„ì›Œë‘  */}\n                    <div></div>\n                    {isEditing ? (\n                      <div></div>\n                    ) : (\n                      <div></div>\n                    )}\n                    {activeTab === 'receipt' && <div></div>}\n                    {activeTab === 'done' && (\n                      <>\n                        <div></div>\n                        <div></div>\n                        <div></div>\n                      </>\n                    )}\n                  </div>\n                  \n                  {/* Mobile ì´ì•¡ */}\n                  <div className=\"block sm:hidden py-0.5\">\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-[13px] font-bold text-gray-900\">ì´ì•¡</span>\n                      <span className=\"text-[13px] font-bold text-gray-900\">\n                        â‚©{formatCurrency(\n                          (isEditing ? editedItems : currentItems)?.reduce((sum, item) => sum + (item.amount_value || 0), 0) || 0\n                        )}\n                      </span>\n                    </div>\n                  </div>\n\n                  {/* ì§€ì¶œ ì´í•© - ì „ì²´í•­ëª© íƒ­ì—ì„œë§Œ í‘œì‹œ */}\n                  {activeTab === 'done' && (\n                    <>\n                      {/* Desktop ì§€ì¶œ ì´í•© */}\n                      <div className=\"hidden sm:grid items-center gap-2 py-0.5 w-fit border-t border-gray-200 pt-1\" style={{\n                        gridTemplateColumns: getGridTemplateColumns()\n                      }}>\n                        {/* í’ˆëª©ëª… */}\n                        <div></div>\n                        {/* ê·œê²© */}\n                        <div></div>\n                        {/* ìˆ˜ëŸ‰ */}\n                        <div></div>\n                        {/* ë‹¨ê°€ */}\n                        <div></div>\n                        {/* í•©ê³„ */}\n                        <div></div>\n                        {/* ë¹„ê³  */}\n                        <div></div>\n                        {/* ìƒíƒœ/ì‘ì—… */}\n                        <div></div>\n                        {/* ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ */}\n                        <div></div>\n                        {/* íšŒê³„ìƒ ì…ê³ ì¼ */}\n                        <div className=\"text-right\">\n                          <span className=\"text-[12px] font-bold text-gray-900\">ì§€ì¶œ ì´í•©</span>\n                        </div>\n                        {/* ì§€ì¶œì •ë³´ */}\n                        <div className=\"text-center\">\n                          <span className=\"text-[12px] font-bold text-gray-900\">\n                            â‚©{formatCurrency(\n                              (isEditing ? editedItems : currentItems)?.reduce((sum, item) => {\n                                return sum + (item.expenditure_amount || 0)\n                              }, 0) || 0\n                            )}\n                          </span>\n                        </div>\n                      </div>\n\n                      {/* Mobile ì§€ì¶œ ì´í•© */}\n                      <div className=\"block sm:hidden py-0.5 border-t border-gray-200 pt-1\">\n                        <div className=\"flex justify-between items-center\">\n                          <span className=\"text-[13px] font-bold text-gray-900\">ì§€ì¶œ ì´í•©</span>\n                          <span className=\"text-[13px] font-bold text-gray-900\">\n                            â‚©{formatCurrency(\n                              (isEditing ? editedItems : currentItems)?.reduce((sum, item) => {\n                                return sum + (item.expenditure_amount || 0)\n                              }, 0) || 0\n                            )}\n                          </span>\n                        </div>\n                      </div>\n                    </>\n                  )}\n                </div>\n                \n                {/* í•­ëª© ì¶”ê°€ ë²„íŠ¼ */}\n                {isEditing && (\n                  <div className=\"p-2 sm:p-3 border-t border-gray-100\">\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={handleAddItem}\n                      className=\"w-full rounded-lg border-dashed border-2 border-gray-300 hover:border-gray-400 py-2 badge-text\"\n                    >\n                      <Plus className=\"w-4 h-4 mr-1\" />\n                      í•­ëª© ì¶”ê°€\n                    </Button>\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n      ) : (\n        <div className=\"text-center py-12\">\n          <span className=\"modal-subtitle\">\n            ë°œì£¼ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n          </span>\n        </div>\n      )}\n    </div>\n  )\n\n  // embeddedê°€ trueë©´ Dialog ì—†ì´ ë‚´ìš©ë§Œ ë°˜í™˜\n  if (embedded) {\n    return content\n  }\n\n  // embeddedê°€ falseë©´ Dialogë¡œ ê°ì‹¸ì„œ ë°˜í™˜\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent \n        className=\"overflow-hidden bg-white rounded-lg shadow-sm border-0 w-full sm:w-auto max-w-[calc(100vw-48px)] sm:max-w-[calc(100vw-80px)] lg:max-w-[90vw] xl:max-w-[85vw] h-[95vh] sm:h-auto sm:max-h-[90vh] lg:max-h-[85vh] sm:rounded-lg flex flex-col\" \n        showCloseButton={false}\n      >\n        <DialogHeader className=\"sr-only\">\n          <DialogTitle>ë°œì£¼ ìƒì„¸ ì •ë³´</DialogTitle>\n        </DialogHeader>\n        {/* Apple-style Header */}\n        <div className=\"relative px-3 sm:px-6 pt-0 sm:pt-3 lg:pt-4 pb-0 sm:pb-2 lg:pb-3 flex-shrink-0\">\n          <button\n            onClick={onClose}\n            className=\"button-base button-action-secondary absolute right-3 sm:right-6 top-0 sm:top-3 lg:top-4 w-6 h-6 sm:w-8 sm:h-8 rounded-full\"\n          >\n            <X className=\"w-4 h-4 text-gray-500\" />\n          </button>\n          \n          <div className=\"pr-8 sm:pr-16\">\n            <div className=\"flex items-start gap-4 mb-0 sm:mb-3\">\n              <div className=\"min-w-0 flex-1\">\n                <h1 className=\"page-title mb-0 sm:mb-1\">\n                  ë°œì£¼ ê¸°ë³¸ì •ë³´\n                </h1>\n              </div>\n              <div className=\"flex items-center gap-3\">\n                {!isEditing && canEdit && (\n                  <>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => handleEditToggle(true)}\n                      className=\"button-base button-action-secondary\"\n                    >\n                      <Edit2 className=\"w-4 h-4 mr-2\" />\n                      ìˆ˜ì •\n                    </Button>\n                    {canDelete && onDelete && (\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={async () => {\n                          if (purchase) {\n                            try {\n                              await onDelete(purchase);\n                              \n                              // ì‚­ì œ í›„ ëª¨ë‹¬ ë‹«ê¸° ë° ìƒˆë¡œê³ ì¹¨\n                              onClose();\n                              if (onRefresh) {\n                                await onRefresh(true); // ê°•ì œ ìƒˆë¡œê³ ì¹¨\n                              }\n                            } catch (error) {\n                              logger.error('ë°œì£¼ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ', error);\n                              toast.error('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');\n                            }\n                          }\n                        }}\n                        className=\"button-base button-action-danger\"\n                      >\n                        <Trash2 className=\"w-4 h-4 mr-2\" />\n                        ì‚­ì œ\n                      </Button>\n                    )}\n                  </>\n                )}\n                {isEditing && (\n                  <>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => {\n                        handleEditToggle(false)\n                        setEditedPurchase(purchase)\n                        setEditedItems(purchase?.items || [])\n                        setDeletedItemIds([])\n                      }}\n                      className=\"button-base button-action-secondary\"\n                    >\n                      <X className=\"w-4 h-4 mr-2\" />\n                      ì·¨ì†Œ\n                    </Button>\n                    <Button\n                      size=\"sm\"\n                      onClick={handleSave}\n                      className=\"button-base button-action-primary\"\n                    >\n                      <Save className=\"w-4 h-4 mr-2\" />\n                      ì €ì¥\n                    </Button>\n                  </>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Apple-style Content */}\n        <div className=\"overflow-y-auto flex-1 px-3 sm:px-6 pb-1 sm:pb-6 mt-0\">\n          {content}\n        </div>\n      </DialogContent>\n      \n    </Dialog>\n  )\n}\n\nexport default memo(PurchaseDetailModal)"],"names":["DollarSign","createLucideIcon","x1","x2","y1","y2","key","d","Truck","cx","cy","r","DatePickerPopover","children","onDateSelect","disabled","placeholder","align","side","open","setOpen","useState","jsxs","Popover","onOpenChange","jsx","PopoverTrigger","asChild","PopoverContent","className","sideOffset","Calendar","mode","selected","onSelect","date","logger","debug","isToday","Date","toDateString","dateValue","getTime","todayValue","dateString","todayString","handleDateSelect","locale","ko","initialFocus","fromDate","toDate","defaultMonth","modifiers","today","modifiersClassNames","DateAmountPickerPopover","onConfirm","defaultDate","defaultAmount","selectedDate","setSelectedDate","amount","setAmount","toString","Input","type","value","onChange","e","target","replace","numValue","parseInt","toLocaleString","Button","variant","size","onClick","amountNum","parseFloat","isNaN","useConfirmDateAction","config","currentUserName","canPerformAction","purchaseId","onUpdate","onOptimisticUpdate","supabase","createClient","handleConfirm","useCallback","async","itemId","itemInfo","warn","toast","error","field","numericId","Number","confirmMessage","item_name","specification","quantity","unit_price_value","amount_value","remark","confirm","window","updateData","is_statement_received","statement_received_date","toISOString","statement_received_by_name","actual_received_date","is_received","data","from","update","eq","select","info","markItemAsReceived","markItemAsStatementReceived","action","success","successMessage","handleCancel","cancel","itemName","markItemAsReceiptCanceled","markItemAsStatementCanceled","isCompleted","item","getCompletedDate","getCompletedByName","PurchaseDetailModal$1","memo","isOpen","onClose","embedded","currentUserRoles","activeTab","onRefresh","onDelete","allPurchases","lastFetch","usePurchaseMemory","loading","setLoading","purchase","setPurchase","isEditing","setIsEditing","editedPurchase","setEditedPurchase","editedItems","setEditedItems","deletedItemIds","setDeletedItemIds","userRoles","setUserRoles","setCurrentUserName","columnWidths","setColumnWidths","focusedInput","setFocusedInput","currentItems","useMemo","items","length","purchase_request_items","memoryPurchase","find","p","id","columnGap","padding","total","reduce","sum","width","Math","max","baseColumns","push","headerRowRef","useRef","useEffect","supabaseUrl","includes","user","auth","getUser","employeeData","maybeSingle","email","employeeByEmail","name","purchase_role","roles","Array","isArray","map","String","trim","split","filter","loadUserRoles","effectiveRoles","canEditAll","canEditLimited","canEdit","canDelete","final_manager_status","requester_name","canPurchase","canReceiveItems","canReceiptCheck","refreshModalData","findPurchaseInMemory","normalizedItems","purchaseData","is_po_generated","vendor","vendor_id","vendor_name","is_active","vendor_contacts","single","sortedItems","sort","a","b","line_number","vendors","updatedPurchase","isInitialLoad","setIsInitialLoad","purchaseIdNumber","NaN","handleActualReceiptOptimisticUpdate","itemIdStr","nowIso","selectedDateIso","updateItems","received_at","prev","updatedItems","completed","allReceived","prevItems","prevPurchase","handleStatementReceivedOptimisticUpdate","nextAllCompleted","nextStatementAt","every","statement_received_at","allCompleted","then","statementReceivedAction","completedText","waitingText","actualReceivedAction","canApproveMiddle","canApproveFinal","approvalButtonClass","approvalWaitingPillClass","loadPurchaseDetail","calculateOptimalColumnWidths","columnConfigs","minWidth","maxWidth","baseWidth","isFixed","calculatedWidths","index","maxLength","headers","baseHeaders","getHeaders","forEach","cellValue","getStatusDisplay","formatDate","expenditure_date","expenditure_amount","adjustedLength","acc","char","test","ceil","calculatedWidth","min","is_payment_completed","getGridTemplateColumns","join","hasItems","requestAnimationFrame","handleEditToggle","editing","formatCurrency","Intl","NumberFormat","format","handleItemChange","newItems","unitPrice","handleRemoveItem","_","i","handlePaymentToggle","purchaseItems","requestItems","targetItem","unit","payment_completed_at","markItemAsPaymentCompleted","markItemAsPaymentCanceled","prevRequestItems","payment_completed_by_name","refreshResult","silent","Promise","handleApprove","approvalType","purchase_order_number","middle_manager_status","handleItemExpenditure","totalExpenditure","total_expenditure_amount","updated_at","markItemAsExpenditureSet","content","payment_category","category","getStatusBadge","request_date","Check","X","FileText","newStatus","is_utk_checked","updatePurchaseInMemory","title","CheckCircle","request_type","delivery_request_date","formatDateInput","revised_delivery_request_date","Building2","contact_name","updatedContacts","project_vendor","project_item","order_number","Package","Fragment","allItems","pendingItems","CreditCard","toLocaleDateString","year","month","day","pi","ref","style","gridTemplateColumns","onFocus","onBlur","whiteSpace","wordBreak","overflowWrap","hyphens","WebkitHyphens","MozHyphens","msHyphens","lineHeight","maxHeight","overflow","display","WebkitLineClamp","WebkitBoxOrient","boxSizing","Trash2","hasExpenditure","toLocaleTimeString","hour","minute","newItem","lineNum","Plus","Dialog","DialogContent","showCloseButton","DialogHeader","DialogTitle","Edit2","totalAmount","updateError","total_amount","deleteError","delete","in","Error","unit_price_currency","currency","amount_currency","insertData","purchase_request_id","indexOf","created_at","insert","sourceData","deletedCount","removeItemFromMemory","memoryUpdated","newTotalAmount","itemsCount","finalItems","originalItemsCount","finalItemsCount","deletedItemsCount","applyOptimisticUpdate","errorMessage","message","Save"],"mappings":"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","x_google_ignoreList":[0,1]}