const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/react-select.esm-DPeuQ82O.js","assets/index-C_XLQIpZ.js","assets/index-aTcv6XqW.css"])))=>i.map(i=>d[i]);
import{c as Ee,u as Te,a as Ie,r as n,j as e,B as N,X as oe,_ as Pe}from"./index-C_XLQIpZ.js";import{S as q,a as S,b as k,c as V,d as x,I as i,D as Ke,e as $e,f as Oe,g as Fe,h as Le,i as We}from"./dialog-9qER4IKQ.js";import{u as ze,a as Me,L as m,C as y}from"./index.esm-sc0Xy_Rz.js";import{B as Ue,t as R}from"./index-VAyiyELQ.js";import{P as ie}from"./plus-BvSdp0Hp.js";import{S as Ae}from"./save-CgRjXPhw.js";/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],Je=Ee("pencil",Be);n.lazy(()=>Pe(()=>import("./react-select.esm-DPeuQ82O.js"),__vite__mapDeps([0,1,2])));function at(){const H=Te(),_=Ie(),[u,de]=n.useState(null),[j,E]=n.useState(""),[me,D]=n.useState([]),[T,I]=n.useState(!1),[L,ue]=n.useState(1),[Q,X]=n.useState("");n.useEffect(()=>{(async()=>{const{data:{user:a}}=await _.auth.getUser();de(a)})()},[]),n.useEffect(()=>{(async()=>{try{const{data:a,error:s}=await _.from("employees").select("id, name, email, phone, address, position, department").order("name");if(a&&!s&&a.length>0){if(D(a.map(r=>({id:r.id,name:r.name,email:r.email||"",phone:r.phone||"",address:r.address||"",position:r.position||"",department:r.department||""}))),j&&!a.find(r=>r.name===j)){const r={id:u?.id||"current-user",name:j,email:u?.email||"",phone:"",address:"",position:"",department:""};D([...a.map(l=>({id:l.id,name:l.name,email:l.email||"",phone:l.phone||"",address:l.address||"",position:l.position||"",department:l.department||""})),r])}}else D(j?[{id:u?.id||"current-user",name:j,email:u?.email||"",phone:"",address:"",position:"",department:""}]:[])}catch{D(j?[{id:u?.id||"current-user",name:j,email:u?.email||"",phone:"",address:"",position:"",department:""}]:[])}})()},[j,u]);const[he,xe]=n.useState([]),[W,P]=n.useState([]),[He,G]=n.useState(""),[Qe,pe]=n.useState([]),[d,z]=n.useState("KRW"),[Y,M]=n.useState(!1),[Z,K]=n.useState(""),[_e,ee]=n.useState({}),[ye,U]=n.useState(!1),[A,$]=n.useState([]),[ge,O]=n.useState(!1),B=n.useRef(!1),{control:p,handleSubmit:je,watch:v,setValue:f,reset:ve,getValues:te}=ze({defaultValues:{progress_type:"",payment_category:"",currency:"KRW",po_template_type:"일반",request_type:"",contacts:[],sales_order_number:"",project_vendor:"",project_item:"",delivery_request_date:"",vendor_id:0,requester_name:"",items:[{line_number:1,item_name:"",specification:"",quantity:1,unit_price_value:0,unit_price_currency:"KRW",amount_value:0,amount_currency:"KRW",remark:"",link:""}],request_date:new Date().toISOString().slice(0,10)}}),{fields:h,append:se,remove:ae,update:w}=Me({control:p,name:"items"});n.useEffect(()=>{if(!u?.email||T)return;(async()=>{const{data:a}=await _.from("employees").select("name").eq("email",u.email).single();a?.name&&(E(a.name),f("requester_name",a.name),I(!0))})()},[u,_,f,T]),n.useEffect(()=>{(async()=>{if(u?.email&&f&&!T)try{const{data:a,error:s}=await _.from("employees").select("name").eq("email",u.email).single();if(a&&!s)E(a.name),setTimeout(()=>{f("requester_name",a.name,{shouldValidate:!0,shouldDirty:!0})},100),I(!0);else{const r=u.email.split("@")[0]||"사용자";E(r),setTimeout(()=>{f("requester_name",r,{shouldValidate:!0,shouldDirty:!0})},100),I(!0)}}catch{const s=u.email?.split("@")[0]||"사용자";E(s),setTimeout(()=>{f("requester_name",s,{shouldValidate:!0,shouldDirty:!0})},100),I(!0)}})()},[u,f,T]),n.useEffect(()=>{(async()=>{try{const{data:a,error:s}=await _.from("vendors").select("*").order("vendor_name");if(s)throw s;xe(a||[])}catch{R.error("업체 목록을 불러올 수 없습니다.")}})()},[]);const C=v("vendor_id");n.useEffect(()=>{(async()=>{if(C)try{const{data:a,error:s}=await _.from("vendor_contacts").select("id, contact_name, contact_email, contact_phone, position").eq("vendor_id",C);if(s)throw s;P(a||[])}catch{P([])}else P([])})()},[C]),n.useEffect(()=>{const a=te("items").map(s=>({...s,unit_price_currency:d,amount_currency:d}));f("items",a),z(d)},[d,f,te]),n.useEffect(()=>{h.forEach((t,a)=>{const s=Number(t.quantity)*Number(t.unit_price_value);t.amount_value!==s&&w(a,{...t,amount_value:s})})},[h.map(t=>`${t.quantity}-${t.unit_price_value}`).join(",")]);const re=()=>{const t=v("request_type"),a=v("progress_type"),s=v("payment_category"),r=v("vendor_id");return!!(t&&a&&s&&r&&r!==0&&h.length>0)},[fe,be]=n.useState(!1);n.useEffect(()=>{be(re())},[v("request_type"),v("progress_type"),v("payment_category"),v("vendor_id"),h]);const Ne=async()=>{const t=new Date,r=`F${new Date(t.getTime()+540*60*1e3).toISOString().slice(0,10).replace(/-/g,"")}_`,{data:l,error:g}=await _.from("purchase_requests").select("purchase_order_number").like("purchase_order_number",`${r}%`).order("purchase_order_number",{ascending:!1});let o=1,c=0;if(l&&l.length>0){for(const De of l){const ce=De.purchase_order_number.split("_");if(ce.length>=2){const Re=ce[1],J=parseInt(Re,10);!isNaN(J)&&J>c&&(c=J)}}o=c+1}const b=isNaN(o)?1:o;return`${r}${String(b).padStart(3,"0")}`},we=async t=>{const a=me.find(s=>s.name===t.requester_name);if(!B.current){if(!a){K("구매요청자 이름에 해당하는 직원이 없습니다. 이름을 정확히 입력해 주세요.");return}if(re()){B.current=!0,M(!0),K("");try{let s=0,r="";const l=5;let g=0;for(;g<l;)try{r=await Ne();const{data:o,error:c}=await _.from("purchase_requests").insert({requester_id:a.id,purchase_order_number:r,requester_name:t.requester_name,requester_phone:a?.phone,requester_fax:null,requester_address:a?.address,vendor_id:t.vendor_id,sales_order_number:t.sales_order_number,project_vendor:t.project_vendor,project_item:t.project_item,request_date:t.request_date,delivery_request_date:t.delivery_request_date||null,request_type:t.request_type,progress_type:t.progress_type,is_payment_completed:!1,payment_category:t.payment_category,currency:d,total_amount:h.reduce((b,le)=>b+le.amount_value,0),unit_price_currency:h[0]?.unit_price_currency||d,po_template_type:t.po_template_type,contact_id:t.contact_id?Number(t.contact_id):null}).select("id").single();if(c&&!c.message.includes("duplicate key value violates unique constraint"))throw c;if(c&&c.message.includes("duplicate key value violates unique constraint")){if(g++,g>=l)throw new Error(`발주요청번호 생성에 ${l}번 실패했습니다. 잠시 후 다시 시도해주세요.`);await new Promise(b=>setTimeout(b,100+Math.random()*200));continue}if(!o)throw new Error("등록 실패");s=o.id;break}catch(o){if(!o.message.includes("duplicate key value violates unique constraint"))throw o;if(g++,g>=l)throw new Error(`발주요청번호 생성에 ${l}번 실패했습니다. 잠시 후 다시 시도해주세요.`);await new Promise(c=>setTimeout(c,100+Math.random()*200))}for(const[o,c]of h.entries()){const{error:b}=await _.from("purchase_request_items").insert({purchase_request_id:s,line_number:o+1,item_name:c.item_name,specification:c.specification,quantity:c.quantity,unit_price_value:c.unit_price_value,unit_price_currency:d,amount_value:c.amount_value,amount_currency:d,remark:c.remark,link:c.link||null});if(b)throw b}try{const o=await fetch(`/api/purchase/${s}/notify-middle-manager`,{method:"POST",headers:{"Content-Type":"application/json"}});if(o.ok){const c=await o.json()}else{const c=await o.text()}}catch{}ve({progress_type:"",payment_category:"",currency:"KRW",po_template_type:"일반",request_type:"",contacts:[],sales_order_number:"",project_vendor:"",project_item:"",delivery_request_date:"",vendor_id:0,requester_name:j,items:[{line_number:1,item_name:"",specification:"",quantity:1,unit_price_value:0,unit_price_currency:"KRW",amount_value:0,amount_currency:"KRW",remark:"",link:""}],request_date:new Date().toISOString().slice(0,10)}),G(""),pe([]),z("KRW"),K(""),M(!1),R.success("발주요청서가 성공적으로 생성되었습니다.");try{await H("/purchase/list")}catch{window.location.href="/purchase/list"}return}catch(s){K(s.message||"오류가 발생했습니다."),R.error(s.message||"발주요청서 저장에 실패했습니다.")}finally{M(!1),B.current=!1}}}},Ce=h.reduce((t,a)=>t+a.amount_value,0),qe=()=>{const t=W.map(s=>({...s,isNew:!1})),a={contact_name:"",contact_email:"",contact_phone:"",position:"",isNew:!0};$([...t,a]),O(!1),U(!0)},F=(t,a,s)=>{$(r=>r.map((l,g)=>g===t?{...l,[a]:s}:l)),O(!0)},Se=()=>{$(t=>[...t,{contact_name:"",contact_email:"",contact_phone:"",position:"",isNew:!0}]),O(!0)},ke=t=>{$(a=>a.filter((s,r)=>r!==t)),O(!0)},Ve=async()=>{if(C)try{if(A.filter(s=>s.contact_email&&s.contact_email.endsWith("@hansl.io")).length>0){alert("한슬 직원 이메일은 업체 담당자로 등록할 수 없습니다.");return}for(const s of A)s.contact_name&&s.contact_email&&(!s.isNew&&s.id?await _.from("vendor_contacts").update({contact_name:s.contact_name,contact_email:s.contact_email,contact_phone:s.contact_phone||"",position:s.position||""}).eq("id",s.id):s.isNew&&await _.from("vendor_contacts").insert({vendor_id:C,contact_name:s.contact_name,contact_email:s.contact_email,contact_phone:s.contact_phone||"",position:s.position||""}));const{data:a}=await _.from("vendor_contacts").select("id, contact_name, contact_email, contact_phone, position").eq("vendor_id",C);a&&P(a),U(!1),R.success("담당자 정보가 저장되었습니다.")}catch{R.error("담당자 저장에 실패했습니다.")}},ne=v("payment_category");return e.jsxs("form",{onSubmit:t=>{t.preventDefault(),je(we)(t)},onKeyDown:t=>{(t.key==="Enter"||t.keyCode===13)&&t.preventDefault()},children:[e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("div",{className:"w-1/3 relative bg-white border border-gray-200 rounded-lg p-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-row items-start justify-between w-full mb-4",children:[e.jsx("div",{className:"flex flex-col",children:e.jsx("h4",{className:"text-base font-semibold text-gray-900",children:"발주요청 기본 정보"})}),e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsxs(m,{className:"mb-1 block text-xs",children:["발주요청서 종류",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx(y,{control:p,name:"po_template_type",render:({field:t})=>e.jsxs(q,{value:t.value,onValueChange:t.onChange,children:[e.jsx(S,{className:"h-8 w-28 bg-white border border-gray-200 rounded-md text-xs",children:e.jsx(k,{placeholder:"종류 선택"})}),e.jsxs(V,{children:[e.jsx(x,{value:"일반",children:"일반"}),e.jsx(x,{value:"PCB",children:"PCB"}),e.jsx(x,{value:"소모품",children:"소모품"}),e.jsx(x,{value:"기타",children:"기타"})]})]})})]})]}),e.jsxs("div",{children:[e.jsxs(m,{className:"mb-1 block text-xs",children:["구매요청자",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx(y,{control:p,name:"requester_name",render:({field:t})=>e.jsx(i,{...t,value:t.value||j||"",className:"h-8 bg-white border border-gray-200 text-xs",placeholder:"구매요청자 이름",readOnly:!0})})]}),e.jsxs("div",{children:[e.jsxs(m,{className:"mb-1 block text-xs",children:["업체 선택",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx(y,{control:p,name:"vendor_id",render:({field:t})=>{const a=he.filter(s=>s.vendor_name.toLowerCase().includes(Q.toLowerCase()));return e.jsx("div",{className:"relative",children:e.jsxs(q,{value:t.value?.toString(),onValueChange:s=>{t.onChange(Number(s)),G(s),f("vendor_id",Number(s)),X("")},children:[e.jsx(S,{className:"h-8 bg-white border border-gray-200 text-xs",children:e.jsx(k,{placeholder:"업체 선택"})}),e.jsxs(V,{children:[e.jsx("div",{className:"p-2",onClick:s=>s.stopPropagation(),children:e.jsx(i,{placeholder:"업체 검색...",value:Q,onChange:s=>X(s.target.value),onKeyDown:s=>s.stopPropagation(),className:"h-7 text-xs mb-2",autoFocus:!0})}),a.length===0?e.jsx("div",{className:"text-xs text-gray-500 text-center py-2",children:"검색 결과가 없습니다"}):a.map(s=>e.jsx(x,{value:s.id.toString(),className:"text-xs",children:s.vendor_name},s.id))]})]})})}})]}),C>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx(m,{className:"block text-xs",children:"담당자"}),e.jsxs(N,{type:"button",onClick:qe,variant:"ghost",size:"sm",className:"h-6 px-2 text-xs",children:[e.jsx(Je,{className:"h-3 w-3 mr-1"}),"관리"]})]}),W.length>0?e.jsx(y,{control:p,name:"contact_id",render:({field:t})=>e.jsxs(q,{value:t.value?.toString(),onValueChange:a=>t.onChange(Number(a)),children:[e.jsx(S,{className:"h-8 bg-white border border-gray-200 text-xs",children:e.jsx(k,{placeholder:"담당자 선택"})}),e.jsx(V,{children:W.map(a=>e.jsxs(x,{value:a.id.toString(),children:[a.contact_name," (",a.position,")"]},a.id))})]})}):e.jsx("div",{className:"text-xs text-gray-500 p-2 border border-gray-200 rounded bg-gray-50",children:"담당자를 추가하려면 관리 버튼을 클릭하세요"})]}),e.jsxs("div",{children:[e.jsx(m,{className:"mb-1 block text-xs",children:"수주번호"}),e.jsx(y,{control:p,name:"sales_order_number",render:({field:t})=>e.jsx(i,{...t,className:"h-8 bg-white border border-gray-200 text-xs",placeholder:"주문번호"})})]}),e.jsxs("div",{children:[e.jsx(m,{className:"mb-1 block text-xs",children:"PJ업체"}),e.jsx(y,{control:p,name:"project_vendor",render:({field:t})=>e.jsx(i,{...t,className:"h-8 bg-white border border-gray-200 text-xs",placeholder:"PJ업체"})})]}),e.jsxs("div",{children:[e.jsx(m,{className:"mb-1 block text-xs",children:"PJ ITEM"}),e.jsx(y,{control:p,name:"project_item",render:({field:t})=>e.jsx(i,{...t,className:"h-8 bg-white border border-gray-200 text-xs",placeholder:"PJ ITEM"})})]}),e.jsxs("div",{children:[e.jsxs(m,{className:"mb-1 block text-xs",children:["요청일",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx(y,{control:p,name:"request_date",render:({field:t})=>e.jsx(i,{...t,type:"date",className:"h-8 bg-white border border-gray-200 text-xs"})})]}),e.jsxs("div",{children:[e.jsx(m,{className:"mb-1 block text-xs",children:"납기요청일"}),e.jsx(y,{control:p,name:"delivery_request_date",render:({field:t})=>e.jsx(i,{...t,type:"date",className:"h-8 bg-white border border-gray-200 text-xs"})})]}),e.jsxs("div",{children:[e.jsxs(m,{className:"mb-1 block text-xs",children:["요청 종류",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx(y,{control:p,name:"request_type",render:({field:t})=>e.jsxs(q,{value:t.value,onValueChange:t.onChange,children:[e.jsx(S,{className:"h-8 bg-white border border-gray-200 text-xs",children:e.jsx(k,{placeholder:"요청 종류"})}),e.jsxs(V,{children:[e.jsx(x,{value:"원자재",children:"원자재"}),e.jsx(x,{value:"소모품",children:"소모품"})]})]})})]}),e.jsxs("div",{children:[e.jsxs(m,{className:"mb-1 block text-xs",children:["진행 종류",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx(y,{control:p,name:"progress_type",render:({field:t})=>e.jsxs(q,{value:t.value,onValueChange:t.onChange,children:[e.jsx(S,{className:"h-8 bg-white border border-gray-200 text-xs",children:e.jsx(k,{placeholder:"진행 종류"})}),e.jsxs(V,{children:[e.jsx(x,{value:"일반",children:"일반"}),e.jsx(x,{value:"선진행",children:"선진행"})]})]})})]}),e.jsxs("div",{children:[e.jsxs(m,{className:"mb-1 block text-xs",children:["결제 종류",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx(y,{control:p,name:"payment_category",render:({field:t})=>e.jsxs(q,{value:t.value,onValueChange:t.onChange,children:[e.jsx(S,{className:"h-8 bg-white border border-gray-200 text-xs",children:e.jsx(k,{placeholder:"결제 종류"})}),e.jsxs(V,{children:[e.jsx(x,{value:"발주요청",children:"발주요청"}),e.jsx(x,{value:"구매요청",children:"구매요청"}),e.jsx(x,{value:"현장 결제",children:"현장 결제"})]})]})})]}),e.jsxs("div",{children:[e.jsxs(m,{className:"mb-1 block text-xs",children:["통화",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx(y,{control:p,name:"currency",render:({field:t})=>e.jsxs(q,{value:t.value,onValueChange:a=>{t.onChange(a),z(a)},children:[e.jsx(S,{className:"h-8 bg-white border border-gray-200 text-xs",children:e.jsx(k,{})}),e.jsxs(V,{children:[e.jsx(x,{value:"KRW",children:"KRW (원화)"}),e.jsx(x,{value:"USD",children:"USD (달러)"})]})]})})]})]}),e.jsxs("div",{className:"flex-1 bg-white border border-gray-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-base font-semibold text-gray-900",children:"품목 정보"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"최대 100개 품목 입력 가능"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Ue,{variant:"secondary",className:"text-hansl-500",children:["총 금액: ",Ce.toLocaleString("ko-KR")," ",d]}),e.jsx(N,{type:"button",size:"sm",variant:"outline",className:"bg-white text-gray-600 hover:text-red-600 hover:bg-red-50",onClick:()=>{confirm("모든 품목을 삭제하시겠습니까?")&&(h.forEach((t,a)=>ae(h.length-1-a)),se({line_number:1,item_name:"",specification:"",quantity:1,unit_price_value:0,unit_price_currency:d,amount_value:0,amount_currency:d,remark:"",link:""}))},children:"전체삭제"}),e.jsx(i,{type:"number",min:1,value:L,onChange:t=>ue(Math.max(1,Number(t.target.value.replace(/[^0-9]/g,"")))),className:"w-16 h-8 text-xs"}),e.jsxs(N,{type:"button",onClick:()=>{const t=100-h.length;if(t<=0){alert("최대 100개까지만 추가할 수 있습니다.");return}const a=Math.min(L,t);for(let s=0;s<a;s++)se({line_number:h.length+1+s,item_name:"",specification:"",quantity:1,unit_price_value:0,unit_price_currency:d,amount_value:0,amount_currency:d,remark:"",link:""});a<L&&alert(`최대 한도로 ${a}개만 추가되었습니다.`)},size:"sm",className:"bg-hansl-500 hover:bg-hansl-600 text-white",children:[e.jsx(ie,{className:"w-4 h-4 mr-1"}),"품목 추가"]})]})]}),e.jsx("div",{className:"relative border border-gray-200 rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"max-h-[500px] overflow-y-auto",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10",children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"px-2 py-2 text-left font-medium text-gray-700 w-10",children:"#"}),e.jsxs("th",{className:"px-2 py-2 text-left font-medium text-gray-700 sm:min-w-[150px]",children:["품목",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("th",{className:"px-2 py-2 text-left font-medium text-gray-700 sm:min-w-[120px]",children:"규격"}),e.jsxs("th",{className:"px-2 py-2 text-center font-medium text-gray-700 w-20",children:["수량",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("th",{className:"px-2 py-2 text-right font-medium text-gray-700 sm:min-w-[100px]",children:["단가 (",d,")"]}),e.jsxs("th",{className:"px-2 py-2 text-right font-medium text-gray-700 sm:min-w-[120px]",children:["합계 (",d,")"]}),ne==="구매요청"&&e.jsx("th",{className:"px-2 py-2 text-left font-medium text-gray-700 sm:min-w-[150px]",children:"링크"}),e.jsx("th",{className:"px-2 py-2 text-left font-medium text-gray-700 sm:min-w-[150px]",children:"비고"}),e.jsx("th",{className:"px-2 py-2 text-center font-medium text-gray-700 w-10"})]})}),e.jsx("tbody",{className:"bg-white",children:h.map((t,a)=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-2 py-1 text-center text-gray-500",children:a+1}),e.jsx("td",{className:"px-2 py-1",children:e.jsx(i,{value:t.item_name,onChange:s=>w(a,{...t,item_name:s.target.value}),className:"h-7 w-full bg-white border border-gray-200 text-xs",placeholder:"품목명 입력"})}),e.jsx("td",{className:"px-2 py-1",children:e.jsx(i,{value:t.specification,onChange:s=>w(a,{...t,specification:s.target.value}),className:"h-7 w-full bg-white border border-gray-200 text-xs",placeholder:"규격 입력"})}),e.jsx("td",{className:"px-2 py-1",children:e.jsx(i,{type:"number",min:"1",value:t.quantity||"",className:"h-7 w-full bg-white border border-gray-200 text-xs text-center",placeholder:"0",onChange:s=>{const r=parseInt(s.target.value)||0;w(a,{...t,quantity:r})}})}),e.jsx("td",{className:"px-2 py-1",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(i,{type:"text",inputMode:"decimal",value:_e[`${a}_unit_price_value`]??(t.unit_price_value===0?"":t.unit_price_value?.toLocaleString("ko-KR")||""),onChange:s=>{const l=s.target.value.replace(/,/g,"").replace(/[^0-9.]/g,""),g=l.split("."),o=g.length>2?g[0]+"."+g.slice(1).join(""):l;ee(b=>({...b,[`${a}_unit_price_value`]:o}));const c=o===""?0:parseFloat(o)||0;w(a,{...t,unit_price_value:c})},onBlur:()=>{ee(s=>{const r={...s};return delete r[`${a}_unit_price_value`],r})},className:"h-7 w-full bg-white border border-gray-200 text-xs text-right",placeholder:"0"}),e.jsx("span",{className:"ml-1 text-xs text-gray-500",children:d==="KRW"?"₩":"$"})]})}),e.jsx("td",{className:"px-2 py-1",children:e.jsxs("div",{className:"flex items-center justify-end",children:[e.jsx("span",{className:"text-xs text-right font-medium",children:(t.amount_value||0).toLocaleString("ko-KR")}),e.jsx("span",{className:"ml-1 text-xs text-gray-500",children:d==="KRW"?"₩":"$"})]})}),ne==="구매요청"&&e.jsx("td",{className:"px-2 py-1",children:e.jsx(i,{value:t.link||"",onChange:s=>w(a,{...t,link:s.target.value}),type:"url",className:"h-7 w-full bg-white border border-gray-200 text-xs",placeholder:"https://..."})}),e.jsx("td",{className:"px-2 py-1",children:e.jsx(i,{value:t.remark||"",onChange:s=>w(a,{...t,remark:s.target.value}),className:"h-7 w-full bg-white border border-gray-200 text-xs",placeholder:"비고"})}),e.jsx("td",{className:"px-2 py-1 text-center",children:h.length>1&&e.jsx(N,{type:"button",onClick:()=>ae(a),size:"sm",variant:"ghost",className:"h-6 w-6 p-0 hover:bg-red-50",children:e.jsx(oe,{className:"w-3 h-3 text-red-600"})})})]},a))})]})})})}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500 text-right",children:["총 ",h.length,"개 품목 / 최대 100개"]})]})]}),Z&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-700 text-sm",children:Z}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>H(-1),children:"취소"}),e.jsx(N,{type:"submit",disabled:Y||!fe,className:"bg-hansl-600 hover:bg-hansl-700 text-white",children:Y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"처리 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"발주요청"]})})]}),e.jsx(Ke,{open:ye,onOpenChange:U,children:e.jsxs($e,{className:"w-full max-w-[95vw] sm:max-w-3xl max-h-[80vh] overflow-y-auto",children:[e.jsx(Oe,{children:e.jsx(Fe,{children:"담당자 관리"})}),e.jsx("div",{className:"space-y-4",children:A.map((t,a)=>e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(m,{className:"text-xs",children:"이름"}),e.jsx(i,{value:t.contact_name,onChange:s=>F(a,"contact_name",s.target.value),placeholder:"담당자 이름",className:"h-8"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(m,{className:"text-xs",children:"이메일"}),e.jsx(i,{value:t.contact_email,onChange:s=>F(a,"contact_email",s.target.value),placeholder:"이메일",className:"h-8"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(m,{className:"text-xs",children:"전화번호"}),e.jsx(i,{value:t.contact_phone,onChange:s=>F(a,"contact_phone",s.target.value),placeholder:"전화번호",className:"h-8"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(m,{className:"text-xs",children:"직책"}),e.jsx(i,{value:t.position,onChange:s=>F(a,"position",s.target.value),placeholder:"직책",className:"h-8"})]}),e.jsx(N,{type:"button",size:"sm",variant:"ghost",onClick:()=>ke(a),className:"h-8 px-2",children:e.jsx(oe,{className:"h-4 w-4"})})]},a))}),e.jsxs(Le,{className:"gap-2",children:[e.jsxs(N,{type:"button",variant:"outline",onClick:Se,size:"sm",children:[e.jsx(ie,{className:"h-4 w-4 mr-1"}),"담당자 추가"]}),e.jsx(We,{asChild:!0,children:e.jsx(N,{type:"button",variant:"outline",size:"sm",children:"취소"})}),e.jsx(N,{type:"button",onClick:Ve,disabled:!ge,size:"sm",children:"저장"})]})]})})]})}export{at as default};
//# sourceMappingURL=PurchaseNewMain-CyiD0ksK.js.map
