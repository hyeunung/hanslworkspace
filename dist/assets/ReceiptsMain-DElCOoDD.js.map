{"version":3,"file":"ReceiptsMain-DElCOoDD.js","sources":["../../node_modules/lucide-react/dist/esm/icons/file-image.js","../../node_modules/lucide-react/dist/esm/icons/funnel.js","../../node_modules/lucide-react/dist/esm/icons/printer.js","../../node_modules/lucide-react/dist/esm/icons/rotate-ccw.js","../../node_modules/lucide-react/dist/esm/icons/upload.js","../../node_modules/lucide-react/dist/esm/icons/zoom-in.js","../../node_modules/lucide-react/dist/esm/icons/zoom-out.js","../../src/hooks/useReceiptPermissions.ts","../../src/components/receipts/ReceiptDetailModal.tsx","../../src/components/receipts/MobileReceiptCard.tsx","../../src/components/receipts/ReceiptUploadModal.tsx","../../src/components/receipts/ReceiptsMain.tsx","../../src/utils/receipt.ts"],"sourcesContent":["/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z\", key: \"1rqfz7\" }],\n  [\"path\", { d: \"M14 2v4a2 2 0 0 0 2 2h4\", key: \"tnqrlb\" }],\n  [\"circle\", { cx: \"10\", cy: \"12\", r: \"2\", key: \"737tya\" }],\n  [\"path\", { d: \"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22\", key: \"wt3hpn\" }]\n];\nconst FileImage = createLucideIcon(\"file-image\", __iconNode);\n\nexport { __iconNode, FileImage as default };\n//# sourceMappingURL=file-image.js.map\n","/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z\",\n      key: \"sc7q7i\"\n    }\n  ]\n];\nconst Funnel = createLucideIcon(\"funnel\", __iconNode);\n\nexport { __iconNode, Funnel as default };\n//# sourceMappingURL=funnel.js.map\n","/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2\",\n      key: \"143wyd\"\n    }\n  ],\n  [\"path\", { d: \"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6\", key: \"1itne7\" }],\n  [\"rect\", { x: \"6\", y: \"14\", width: \"12\", height: \"8\", rx: \"1\", key: \"1ue0tg\" }]\n];\nconst Printer = createLucideIcon(\"printer\", __iconNode);\n\nexport { __iconNode, Printer as default };\n//# sourceMappingURL=printer.js.map\n","/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8\", key: \"1357e3\" }],\n  [\"path\", { d: \"M3 3v5h5\", key: \"1xhq8a\" }]\n];\nconst RotateCcw = createLucideIcon(\"rotate-ccw\", __iconNode);\n\nexport { __iconNode, RotateCcw as default };\n//# sourceMappingURL=rotate-ccw.js.map\n","/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M12 3v12\", key: \"1x0j5s\" }],\n  [\"path\", { d: \"m17 8-5-5-5 5\", key: \"7q97r8\" }],\n  [\"path\", { d: \"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\", key: \"ih7n3h\" }]\n];\nconst Upload = createLucideIcon(\"upload\", __iconNode);\n\nexport { __iconNode, Upload as default };\n//# sourceMappingURL=upload.js.map\n","/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"circle\", { cx: \"11\", cy: \"11\", r: \"8\", key: \"4ej97u\" }],\n  [\"line\", { x1: \"21\", x2: \"16.65\", y1: \"21\", y2: \"16.65\", key: \"13gj7c\" }],\n  [\"line\", { x1: \"11\", x2: \"11\", y1: \"8\", y2: \"14\", key: \"1vmskp\" }],\n  [\"line\", { x1: \"8\", x2: \"14\", y1: \"11\", y2: \"11\", key: \"durymu\" }]\n];\nconst ZoomIn = createLucideIcon(\"zoom-in\", __iconNode);\n\nexport { __iconNode, ZoomIn as default };\n//# sourceMappingURL=zoom-in.js.map\n","/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"circle\", { cx: \"11\", cy: \"11\", r: \"8\", key: \"4ej97u\" }],\n  [\"line\", { x1: \"21\", x2: \"16.65\", y1: \"21\", y2: \"16.65\", key: \"13gj7c\" }],\n  [\"line\", { x1: \"8\", x2: \"14\", y1: \"11\", y2: \"11\", key: \"durymu\" }]\n];\nconst ZoomOut = createLucideIcon(\"zoom-out\", __iconNode);\n\nexport { __iconNode, ZoomOut as default };\n//# sourceMappingURL=zoom-out.js.map\n","import { useState, useEffect } from 'react';\nimport { createClient } from '@/lib/supabase/client';\nimport type { ReceiptPermissions, UserRole } from '@/types/receipt';\n\n/**\n * ì˜ìˆ˜ì¦ ê´€ë¦¬ ê¶Œí•œì„ ê´€ë¦¬í•˜ëŠ” React Hook\n * \n * ì‚¬ìš©ìì˜ ì—­í• (role)ì— ë”°ë¼ ì˜ìˆ˜ì¦ ê´€ë ¨ ê¶Œí•œì„ ê³„ì‚°í•˜ê³  ì œê³µí•©ë‹ˆë‹¤.\n * \n * @returns {Object} ê¶Œí•œ ì •ë³´ì™€ ê´€ë ¨ ìƒíƒœ\n * @returns {ReceiptPermissions} permissions - ê¶Œí•œ ê°ì²´\n * @returns {UserRole | null} userRole - ì‚¬ìš©ì ì—­í• \n * @returns {boolean} loading - ê¶Œí•œ ë¡œë”© ìƒíƒœ\n * @returns {Function} refreshPermissions - ê¶Œí•œ ìƒˆë¡œê³ ì¹¨ í•¨ìˆ˜\n * \n * @example\n * ```tsx\n * const { permissions, userRole, loading } = useReceiptPermissions();\n * \n * if (loading) return <div>ë¡œë”© ì¤‘...</div>;\n * \n * return (\n *   <div>\n *     {permissions.canUpload && <UploadButton />}\n *     {permissions.canDelete && <DeleteButton />}\n *   </div>\n * );\n * ```\n */\nexport function useReceiptPermissions() {\n  const [permissions, setPermissions] = useState<ReceiptPermissions>({\n    canView: false,\n    canUpload: false,\n    canDownload: false,\n    canPrint: false,\n    canDelete: false,\n    canViewUploaderInfo: false,\n  });\n  const [userRole, setUserRole] = useState<UserRole | null>(null);\n  const [loading, setLoading] = useState(true);\n\n  const supabase = createClient();\n\n  const checkPermissions = async () => {\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) {\n        setLoading(false);\n        return;\n      }\n\n      const { data: employee } = await supabase\n        .from('employees')\n        .select('purchase_role')\n        .eq('email', user.email)\n        .single();\n\n      const role = employee?.purchase_role || '';\n      setUserRole(role);\n\n      // ê¶Œí•œ ê³„ì‚°\n      const isAppAdmin = role.includes('app_admin');\n      const isHr = role.includes('hr');\n      const isLeadBuyer = role.includes('lead buyer');\n      \n      // ì˜ìˆ˜ì¦ ê´€ë¦¬ ì ‘ê·¼ ê°€ëŠ¥ ê¶Œí•œ\n      const hasReceiptAccess = isAppAdmin || isHr || isLeadBuyer;\n\n      setPermissions({\n        canView: hasReceiptAccess,\n        canUpload: hasReceiptAccess,\n        canDownload: hasReceiptAccess,\n        canPrint: hasReceiptAccess,\n        canDelete: isAppAdmin, // ì˜¤ì§ app_adminë§Œ\n        canViewUploaderInfo: isAppAdmin, // ì˜¤ì§ app_adminë§Œ\n      });\n    } catch (error) {\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    checkPermissions();\n  }, []);\n\n  return {\n    permissions,\n    userRole,\n    loading,\n    refreshPermissions: checkPermissions,\n  };\n}","import { useState, useEffect, useCallback } from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Download, X, ZoomIn, ZoomOut, RotateCcw, Printer, Trash2 } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { createClient } from \"@/lib/supabase/client\";\nimport { useReceiptPermissions } from \"@/hooks/useReceiptPermissions\";\nimport type { ReceiptItem } from \"@/types/receipt\";\nimport { logger } from \"@/lib/logger\";\n\ninterface ReceiptDetailModalProps {\n  receipt: ReceiptItem;\n  isOpen: boolean;\n  onClose: () => void;\n  onDelete?: () => void;\n}\n\nexport default function ReceiptDetailModal({ receipt, isOpen, onClose, onDelete }: ReceiptDetailModalProps) {\n  const [imageScale, setImageScale] = useState(1);\n  const [imageRotation, setImageRotation] = useState(0);\n  const [imageError, setImageError] = useState(false);\n  const [deleting, setDeleting] = useState(false);\n  const [imageDimensions, setImageDimensions] = useState({ width: 0, height: 0 });\n  const [imageLoaded, setImageLoaded] = useState(false);\n  \n  const supabase = createClient();\n  const { permissions } = useReceiptPermissions();\n\n  // ëª¨ë‹¬ì´ ì—´ë¦´ ë•Œ ì´ˆê¸°í™”\n  useEffect(() => {\n    if (isOpen) {\n      setImageScale(1);\n      setImageRotation(0);\n      setImageError(false);\n      setImageLoaded(false);\n    }\n  }, [isOpen]);\n\n  // formatDateTimeì€ utils/helpers.tsì—ì„œ importí•˜ì—¬ ì‚¬ìš© ê°€ëŠ¥\n\n  // ì˜ìˆ˜ì¦ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ\n  const handleDownload = async () => {\n    try {\n      // URLì—ì„œ íŒŒì¼ ê²½ë¡œ ì¶”ì¶œ (Supabase Storage ê²½ë¡œ)\n      const url = new URL(receipt.receipt_image_url);\n      const pathSegments = url.pathname.split('/');\n      const bucketIndex = pathSegments.indexOf('receipt-images');\n      \n      if (bucketIndex === -1) {\n        throw new Error('ì˜ëª»ëœ ì˜ìˆ˜ì¦ URLì…ë‹ˆë‹¤');\n      }\n      \n      const filePath = pathSegments.slice(bucketIndex + 1).join('/');\n\n      // Supabase Storageì—ì„œ ë‹¤ìš´ë¡œë“œ\n      const { data, error } = await supabase.storage\n        .from('receipt-images')\n        .download(filePath);\n\n      if (error) throw error;\n\n      // Blobì„ ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥í•œ URLë¡œ ë³€í™˜\n      const blob = new Blob([data], { type: 'image/jpeg' });\n      const downloadUrl = window.URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = downloadUrl;\n      a.download = receipt.file_name || `ì˜ìˆ˜ì¦_${receipt.id}.jpg`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      window.URL.revokeObjectURL(downloadUrl);\n      \n      toast.success('ì˜ìˆ˜ì¦ ì´ë¯¸ì§€ê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');\n    } catch (error) {\n      logger.error('ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜', error);\n      toast.error('ë‹¤ìš´ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n    }\n  };\n\n  // í™•ëŒ€/ì¶•ì†Œ\n  const handleZoomIn = () => {\n    setImageScale(prev => Math.min(prev + 0.25, 3));\n  };\n\n  const handleZoomOut = () => {\n    setImageScale(prev => Math.max(prev - 0.25, 0.5));\n  };\n\n  // íšŒì „\n  const handleRotate = () => {\n    setImageRotation(prev => (prev + 90) % 360);\n  };\n\n  // ì´ˆê¸°í™”\n  const handleReset = () => {\n    setImageScale(1);\n    setImageRotation(0);\n  };\n\n  // ì´ë¯¸ì§€ ë¡œë“œ ì™„ë£Œ í•¸ë“¤ëŸ¬\n  const handleImageLoad = (e: React.SyntheticEvent<HTMLImageElement>) => {\n    const img = e.currentTarget;\n    setImageDimensions({ width: img.naturalWidth, height: img.naturalHeight });\n    setImageLoaded(true);\n  };\n\n  // ì´ë¯¸ì§€ ìµœì  í¬ê¸° ê³„ì‚°\n  const getOptimalImageStyle = () => {\n    if (!imageLoaded) return { width: '100%', height: '100vh' };\n    \n    const containerWidth = window.innerWidth - 64; // ìš°ì¸¡ íƒ­ë°” ì œì™¸\n    const containerHeight = window.innerHeight;\n    \n    const widthRatio = containerWidth / imageDimensions.width;\n    const heightRatio = containerHeight / imageDimensions.height;\n    const optimalRatio = Math.min(widthRatio, heightRatio);\n    \n    return {\n      width: `${imageDimensions.width * optimalRatio}px`,\n      height: `${imageDimensions.height * optimalRatio}px`,\n    };\n  };\n\n  // ì˜ìˆ˜ì¦ ì¸ì‡„ ì™„ë£Œ ì²˜ë¦¬\n  const markAsPrinted = useCallback(async () => {\n    logger.debug('ì¸ì‡„ì™„ë£Œ ì²˜ë¦¬ ì‹œì‘', {\n      receiptId: receipt.id,\n      receiptName: receipt.file_name\n    });\n\n\n    try {\n      // 1. ì‚¬ìš©ì ì¸ì¦ ì •ë³´ í™•ì¸\n      const { data: { user }, error: authError } = await supabase.auth.getUser();\n      \n      if (authError) {\n        logger.error('ì¸ì¦ ì˜¤ë¥˜', authError);\n        toast.error('ì‚¬ìš©ì ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n        return;\n      }\n      \n      if (!user) {\n        logger.error('ì‚¬ìš©ì ì •ë³´ ì—†ìŒ');\n        toast.error('ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');\n        return;\n      }\n\n\n      // 2. ì‚¬ìš©ì ê¶Œí•œ ë° ì •ë³´ í™•ì¸\n      const { data: employee, error: empError } = await supabase\n        .from('employees')\n        .select('name, purchase_role')\n        .eq('email', user.email)\n        .single();\n\n      if (empError) {\n        logger.error('ì§ì› ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨', empError);\n        toast.error('ì§ì› ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');\n        return;\n      }\n\n\n      // 3. ê¶Œí•œ ê²€ì¦\n      const role = employee?.purchase_role || '';\n      const hasPermission = role.includes('app_admin') || role.includes('hr') || role.includes('lead buyer');\n      \n\n      if (!hasPermission) {\n        logger.error('ê¶Œí•œ ë¶€ì¡±', { role });\n        toast.error('ì¸ì‡„ì™„ë£Œ ì²˜ë¦¬ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');\n        return;\n      }\n\n      // 4. ì—…ë°ì´íŠ¸ ë°ì´í„° ì¤€ë¹„\n      const updateData = {\n        is_printed: true,\n        printed_at: new Date().toISOString(),\n        printed_by: user.id,\n        printed_by_name: employee?.name || user.email\n      };\n\n\n      // 5. ë°ì´í„°ë² ì´ìŠ¤ ì—…ë°ì´íŠ¸ ì‹¤í–‰\n      const startTime = performance.now();\n      \n      const { data: updateResult, error: updateError } = await supabase\n        .from('purchase_receipts')\n        .update(updateData)\n        .eq('id', receipt.id)\n        .select('*');\n\n      const endTime = performance.now();\n      const executionTime = endTime - startTime;\n\n      if (updateError) {\n        logger.error('ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', updateError);\n        \n        \n        // RLS ê´€ë ¨ ì˜¤ë¥˜ íŠ¹ë³„ ì²˜ë¦¬\n        if (updateError.code === '42501' || updateError.message?.includes('policy')) {\n          toast.error('ë°ì´í„°ë² ì´ìŠ¤ ê¶Œí•œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.');\n        } else {\n          toast.error(`ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: ${updateError.message}`);\n        }\n        return;\n      }\n\n      const affectedRows = updateResult?.length || 0;\n      \n\n      // affectedRowsê°€ 0ì´ì–´ë„ ì„±ê³µìœ¼ë¡œ ì²˜ë¦¬ (ì´ë¯¸ ì¸ì‡„ì™„ë£Œ ìƒíƒœì¸ ê²½ìš°)\n      if (affectedRows === 0) {\n      }\n\n\n      // 6. ì„±ê³µ ì²˜ë¦¬\n      toast.success('ì¸ì‡„ ì™„ë£Œë¡œ í‘œì‹œë˜ì—ˆìŠµë‹ˆë‹¤.');\n      \n      // 7. ëª©ë¡ ìƒˆë¡œê³ ì¹¨\n      if (onDelete) {\n        onDelete(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨ì„ ìœ„í•´ í˜¸ì¶œ\n      }\n\n      logger.debug('ì¸ì‡„ì™„ë£Œ ì²˜ë¦¬ ì™„ë£Œ', { receiptId: receipt.id });\n\n    } catch (error) {\n      const errorObj = error as any;\n      logger.error('ì¸ì‡„ì™„ë£Œ ì²˜ë¦¬ ì˜ˆì™¸', errorObj, { receiptId: receipt.id });\n\n      \n      toast.error(`ì¸ì‡„ ì™„ë£Œ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${errorObj?.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);\n    }\n  }, [supabase, receipt.id, receipt.file_name, onClose, onDelete]);\n\n  // ì˜ìˆ˜ì¦ ì¸ì‡„ í•¸ë“¤ëŸ¬\n  const handlePrint = useCallback(() => {\n    const printWindow = window.open('', '_blank');\n    if (printWindow) {\n      printWindow.document.write(`\n        <!DOCTYPE html>\n        <html><head><title></title>\n        <style>@page{margin:0;size:auto;}*{margin:0;padding:0;box-sizing:border-box;}body{display:flex;justify-content:center;align-items:center;min-height:100vh;background:white;margin:0;padding:0;}.receipt-image{max-width:100%;max-height:100vh;object-fit:contain;display:block;}@media print{@page{margin:0;}body{margin:0;padding:0;background:white;}.receipt-image{max-width:100%;max-height:100%;width:auto;height:auto;page-break-inside:avoid;}}</style>\n        </head><body>\n        <img src=\"${receipt.receipt_image_url}\" alt=\"\" class=\"receipt-image\" onload=\"setTimeout(function(){window.print();window.close();},100);\" onerror=\"window.close();\" />\n        </body></html>\n      `);\n      printWindow.document.close();\n\n      // ì¸ì‡„ ì™„ë£Œ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸\n      setTimeout(() => {\n        const userConfirmed = confirm('ì¸ì‡„ë¥¼ ì™„ë£Œí•˜ì…¨ìŠµë‹ˆê¹Œ?');\n        \n        if (userConfirmed) {\n          logger.debug('ëª¨ë‹¬ ë‹«ê¸° ì‹¤í–‰ ì¤‘');\n          // ë¨¼ì € ëª¨ë‹¬ ë‹«ê¸°\n          onClose();\n          \n          logger.debug('markAsPrinted í•¨ìˆ˜ í˜¸ì¶œ ì‹œì‘');\n          // ê·¸ ë‹¤ìŒ ì¸ì‡„ì™„ë£Œ ì²˜ë¦¬\n          markAsPrinted();\n        } else {\n          logger.debug('ì‚¬ìš©ìê°€ ì·¨ì†Œí•¨ - ì¸ì‡„ì™„ë£Œ ì²˜ë¦¬ ì•ˆí•¨');\n        }\n      }, 1000);\n    }\n  }, [receipt.receipt_image_url, markAsPrinted, onClose]);\n\n  // ì˜ìˆ˜ì¦ ì‚­ì œ - useCallbackìœ¼ë¡œ ìµœì í™”\n  const handleDelete = useCallback(async () => {\n    if (!permissions.canDelete) {\n      toast.error('ì‚­ì œ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');\n      return;\n    }\n\n    if (!confirm('ì •ë§ë¡œ ì´ ì˜ìˆ˜ì¦ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {\n      return;\n    }\n\n    try {\n      setDeleting(true);\n\n      // URLì—ì„œ íŒŒì¼ ê²½ë¡œ ì¶”ì¶œ (Supabase Storage ê²½ë¡œ)\n      const url = new URL(receipt.receipt_image_url);\n      const pathSegments = url.pathname.split('/');\n      const bucketIndex = pathSegments.indexOf('receipt-images');\n      \n      if (bucketIndex !== -1) {\n        const filePath = pathSegments.slice(bucketIndex + 1).join('/');\n        \n        // Supabase Storageì—ì„œ íŒŒì¼ ì‚­ì œ\n        const { error: storageError } = await supabase.storage\n          .from('receipt-images')\n          .remove([filePath]);\n\n        if (storageError) {\n          logger.warn('ìŠ¤í† ë¦¬ì§€ íŒŒì¼ ì‚­ì œ ì‹¤íŒ¨', { error: storageError });\n        }\n      }\n\n      // DBì—ì„œ ë ˆì½”ë“œ ì‚­ì œ\n      const { error: dbError } = await supabase\n        .from('purchase_receipts')\n        .delete()\n        .eq('id', receipt.id);\n\n      if (dbError) throw dbError;\n\n      toast.success('ì˜ìˆ˜ì¦ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');\n      onClose();\n      if (onDelete) {\n        onDelete();\n      }\n    } catch (error) {\n      logger.error('ì‚­ì œ ì˜¤ë¥˜', error);\n      toast.error('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n    } finally {\n      setDeleting(false);\n    }\n  }, [permissions.canDelete, receipt.id, receipt.receipt_image_url, onClose, onDelete, supabase]);\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"w-[100vw] max-w-none h-[100vh] p-0 overflow-hidden m-0 border-0 rounded-none\">\n        <div className=\"flex h-full\">\n          {/* ì´ë¯¸ì§€ ì˜ì—­ */}\n          <div className=\"flex-1 bg-white relative overflow-hidden\">\n            <div className=\"absolute inset-0 flex items-center justify-center\">\n              <img\n                src={receipt.receipt_image_url}\n                alt=\"ì˜ìˆ˜ì¦\"\n                className=\"object-contain\"\n                style={{\n                  ...getOptimalImageStyle(),\n                  transform: `scale(${imageScale}) rotate(${imageRotation}deg)`,\n                  transformOrigin: 'center'\n                }}\n                onLoad={handleImageLoad}\n                onError={() => setImageError(true)}\n              />\n            </div>\n            \n            {/* ë‹«ê¸° ë²„íŠ¼ */}\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={onClose}\n              className=\"absolute top-4 left-4 h-10 w-10 p-0 bg-gray-900/80 hover:bg-gray-900 text-white rounded-full\"\n            >\n              <X className=\"h-5 w-5\" />\n            </Button>\n\n            {/* ì´ë¯¸ì§€ ì»¨íŠ¸ë¡¤ */}\n            <div className=\"absolute bottom-4 left-1/2 transform -translate-x-1/2 bg-gray-900/80 rounded-full px-4 py-2\">\n              <div className=\"flex items-center gap-2 text-white\">\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={handleZoomOut}\n                  disabled={imageScale <= 0.5}\n                  className=\"h-7 w-7 p-0 text-white hover:bg-white/20\"\n                >\n                  <ZoomOut className=\"w-4 h-4\" />\n                </Button>\n                <span className=\"modal-subtitle min-w-[40px] text-center\">\n                  {Math.round(imageScale * 100)}%\n                </span>\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={handleZoomIn}\n                  disabled={imageScale >= 3}\n                  className=\"h-7 w-7 p-0 text-white hover:bg-white/20\"\n                >\n                  <ZoomIn className=\"w-4 h-4\" />\n                </Button>\n                <div className=\"w-px h-4 bg-white/30 mx-1\" />\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={handleRotate}\n                  className=\"h-7 w-7 p-0 text-white hover:bg-white/20\"\n                >\n                  <RotateCcw className=\"w-4 h-4\" />\n                </Button>\n              </div>\n            </div>\n          </div>\n\n          {/* ìš°ì¸¡ ì„¸ë¡œ íƒ­ë°” */}\n          <div className=\"w-16 bg-gray-900 flex flex-col items-center justify-center space-y-4\">\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={handlePrint}\n              className=\"w-10 h-10 p-0 text-white hover:bg-gray-700 rounded-lg\"\n              title=\"ì¸ì‡„\"\n            >\n              <Printer className=\"w-6 h-6\" />\n            </Button>\n            \n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={handleDownload}\n              className=\"w-10 h-10 p-0 text-white hover:bg-gray-700 rounded-lg\"\n              title=\"ë‹¤ìš´ë¡œë“œ\"\n            >\n              <Download className=\"w-6 h-6\" />\n            </Button>\n\n            {permissions.canDelete && (\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={handleDelete}\n                disabled={deleting}\n                className=\"w-10 h-10 p-0 text-white hover:bg-red-600 rounded-lg\"\n                title=\"ì‚­ì œ\"\n              >\n                {deleting ? (\n                  <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\n                ) : (\n                  <Trash2 className=\"w-6 h-6\" />\n                )}\n              </Button>\n            )}\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","import { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Printer, Download, Calendar, User, FileText, Trash2 } from \"lucide-react\";\nimport type { ReceiptItem } from \"@/types/receipt\";\nimport { formatDate, formatFileSize } from \"@/utils/helpers\";\n\ninterface MobileReceiptCardProps {\n  receipt: ReceiptItem;\n  onView: (receipt: ReceiptItem) => void;\n  onPrint: (receipt: ReceiptItem) => void;\n  onDownload: (receipt: ReceiptItem) => void;\n  onDelete?: (receipt: ReceiptItem) => void;\n}\n\nexport default function MobileReceiptCard({ receipt, onView, onPrint, onDownload, onDelete }: MobileReceiptCardProps) {\n  // formatDateì™€ formatFileSizeëŠ” utilsì—ì„œ import\n\n  return (\n    <Card className=\"w-full border border-gray-200 hover:shadow-md transition-shadow cursor-pointer\" onClick={() => onView(receipt)}>\n      <CardContent className=\"p-4\">\n        <div className=\"space-y-3\">\n          {/* ìƒë‹¨: ì¸ì‡„ ìƒíƒœ + ì—…ë¡œë“œì¼ */}\n          <div className=\"flex items-center justify-between\">\n            {receipt.is_printed ? (\n              <Badge className=\"bg-green-100 text-green-700 hover:bg-green-100 badge-text\">\n                âœ“ ì¸ì‡„ì™„ë£Œ\n              </Badge>\n            ) : (\n              <Badge variant=\"secondary\" className=\"bg-gray-100 text-gray-600 badge-text\">\n                ë¯¸ì™„ë£Œ\n              </Badge>\n            )}\n            <div className=\"flex items-center gap-1 badge-text text-gray-500\">\n              <Calendar className=\"w-3 h-3\" />\n              <span>{formatDate(receipt.uploaded_at)}</span>\n            </div>\n          </div>\n\n          {/* íŒŒì¼ëª… */}\n          <div className=\"flex items-center gap-2\">\n            <FileText className=\"w-4 h-4 text-hansl-600\" />\n            <span className=\"card-title text-gray-900\">\n              {receipt.file_name}\n            </span>\n          </div>\n\n          {/* ë©”ëª¨ */}\n          {receipt.memo && (\n            <div className=\"card-subtitle text-gray-900 bg-gray-50 rounded p-2\">\n              {receipt.memo}\n            </div>\n          )}\n\n          {/* ì—…ë¡œë“œ ì •ë³´ */}\n          <div className=\"flex items-center justify-between card-subtitle\">\n            <div className=\"flex items-center gap-1 text-gray-600\">\n              <User className=\"w-3 h-3\" />\n              <span>{receipt.uploaded_by_name || receipt.uploaded_by}</span>\n            </div>\n            <span className=\"text-gray-500\">{formatFileSize(receipt.file_size)}</span>\n          </div>\n\n          {/* ì•¡ì…˜ ë²„íŠ¼ */}\n          <div className={`flex gap-2 pt-2 border-t border-gray-100 ${onDelete ? 'grid grid-cols-3' : 'grid grid-cols-2'}`}>\n            <Button\n              size=\"sm\"\n              variant=\"outline\"\n              onClick={(e) => {\n                e.stopPropagation();\n                onPrint(receipt);\n              }}\n              className=\"flex-1\"\n            >\n              <Printer className=\"w-4 h-4 mr-1\" />\n              ì¸ì‡„\n            </Button>\n            <Button\n              size=\"sm\"\n              variant=\"outline\"\n              onClick={(e) => {\n                e.stopPropagation();\n                onDownload(receipt);\n              }}\n              className=\"flex-1\"\n            >\n              <Download className=\"w-4 h-4 mr-1\" />\n              ë‹¤ìš´ë¡œë“œ\n            </Button>\n            {onDelete && (\n              <Button\n                size=\"sm\"\n                variant=\"outline\"\n                onClick={(e) => {\n                  e.stopPropagation();\n                  onDelete(receipt);\n                }}\n                className=\"flex-1 border-red-200 text-red-600 hover:bg-red-50\"\n              >\n                <Trash2 className=\"w-4 h-4 mr-1\" />\n                ì‚­ì œ\n              </Button>\n            )}\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}","import { useState, useCallback } from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Upload, X, FileImage } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { createClient } from \"@/lib/supabase/client\";\nimport { useReceiptPermissions } from \"@/hooks/useReceiptPermissions\";\n\ninterface ReceiptUploadModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSuccess: () => void;\n}\n\nexport default function ReceiptUploadModal({ isOpen, onClose, onSuccess }: ReceiptUploadModalProps) {\n  const [file, setFile] = useState<File | null>(null);\n  const [memo, setMemo] = useState(\"\");\n  const [uploading, setUploading] = useState(false);\n  const [dragOver, setDragOver] = useState(false);\n  \n  const supabase = createClient();\n  const { permissions } = useReceiptPermissions();\n\n  // íŒŒì¼ ì„ íƒ í•¸ë“¤ëŸ¬ - useCallbackìœ¼ë¡œ ìµœì í™”\n  const handleFileSelect = useCallback((selectedFile: File) => {\n    // ì´ë¯¸ì§€ íŒŒì¼ë§Œ í—ˆìš©\n    if (!selectedFile.type.startsWith('image/')) {\n      toast.error('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');\n      return;\n    }\n\n    // íŒŒì¼ í¬ê¸° ì œí•œ (10MB)\n    if (selectedFile.size > 10 * 1024 * 1024) {\n      toast.error('íŒŒì¼ í¬ê¸°ëŠ” 10MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.');\n      return;\n    }\n\n    setFile(selectedFile);\n  }, []);\n\n  // ë“œë˜ê·¸ ì•¤ ë“œë¡­ í•¸ë“¤ëŸ¬\n  const handleDragOver = (e: React.DragEvent) => {\n    e.preventDefault();\n    setDragOver(true);\n  };\n\n  const handleDragLeave = (e: React.DragEvent) => {\n    e.preventDefault();\n    setDragOver(false);\n  };\n\n  const handleDrop = (e: React.DragEvent) => {\n    e.preventDefault();\n    setDragOver(false);\n    \n    const files = Array.from(e.dataTransfer.files);\n    if (files.length > 0) {\n      handleFileSelect(files[0]);\n    }\n  };\n\n  // ì—…ë¡œë“œ í•¸ë“¤ëŸ¬ - useCallbackìœ¼ë¡œ ìµœì í™”\n  const handleUpload = useCallback(async () => {\n    if (!permissions.canUpload) {\n      toast.error('ì—…ë¡œë“œ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');\n      return;\n    }\n\n    if (!file) {\n      toast.error('íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');\n      return;\n    }\n\n    try {\n      setUploading(true);\n\n      // í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°\n      const { data: { user }, error: userError } = await supabase.auth.getUser();\n      if (userError || !user) {\n        throw new Error('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');\n      }\n\n      // ì‚¬ìš©ì ì´ë¦„ ê°€ì ¸ì˜¤ê¸°\n      const { data: employee, error: employeeError } = await supabase\n        .from('employees')\n        .select('name')\n        .eq('email', user.email)\n        .single();\n\n      const userName = employee?.name || '';\n\n      // íŒŒì¼ëª… ìƒì„±\n      const now = new Date();\n      const fileExtension = file.name.split('.').pop() || 'jpg';\n      const fileName = `rec${now.getFullYear().toString().substring(2)}${(now.getMonth() + 1).toString().padStart(2, '0')}${now.getDate().toString().padStart(2, '0')}${now.getHours().toString().padStart(2, '0')}${now.getMinutes().toString().padStart(2, '0')}.${fileExtension}`;\n      \n      // íŒŒì¼ ê²½ë¡œ\n      const filePath = `receipts/web/${now.getTime()}/${fileName}`;\n\n      // Supabase Storageì— ì—…ë¡œë“œ\n      const { error: uploadError } = await supabase.storage\n        .from('receipt-images')\n        .upload(filePath, file, {\n          contentType: file.type,\n          upsert: false,\n        });\n\n      if (uploadError) throw uploadError;\n\n      // Public URL ìƒì„±\n      const { data: { publicUrl } } = supabase.storage\n        .from('receipt-images')\n        .getPublicUrl(filePath);\n\n      // DBì— ì €ì¥ - memo ì¹¼ëŸ¼ í¬í•¨\n      const { error: dbError } = await supabase\n        .from('purchase_receipts')\n        .insert({\n          receipt_image_url: publicUrl,\n          file_name: fileName,\n          file_size: file.size,\n          uploaded_by: user.email!,\n          uploaded_by_name: userName,\n          memo: memo || null,\n          uploaded_at: new Date().toISOString(),\n        });\n\n      if (dbError) throw dbError;\n\n      toast.success('ì˜ìˆ˜ì¦ì´ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');\n      handleClose();\n      onSuccess();\n    } catch (error) {\n      toast.error(`ì—…ë¡œë“œ ì‹¤íŒ¨: ${error instanceof Error ? error.message : error}`);\n    } finally {\n      setUploading(false);\n    }\n  }, [file, memo, permissions.canUpload, onSuccess]);\n\n  // ëª¨ë‹¬ ë‹«ê¸° - useCallbackìœ¼ë¡œ ìµœì í™”\n  const handleClose = useCallback(() => {\n    setFile(null);\n    setMemo(\"\");\n    setUploading(false);\n    setDragOver(false);\n    onClose();\n  }, [onClose]);\n\n  return (\n    <Dialog open={isOpen} onOpenChange={handleClose}>\n      <DialogContent className=\"max-w-lg\">\n        <DialogHeader className=\"space-y-3\">\n          <div className=\"flex items-center justify-between\">\n            <DialogTitle className=\"modal-title\">ğŸ“ ì˜ìˆ˜ì¦ ì—…ë¡œë“œ</DialogTitle>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={handleClose}\n              className=\"h-7 w-7 p-0 hover:bg-gray-100\"\n            >\n              <X className=\"h-4 w-4\" />\n            </Button>\n          </div>\n          <DialogDescription className=\"modal-subtitle\">\n            ì˜ìˆ˜ì¦ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ê³  ë©”ëª¨ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-6 pt-2\">\n          {/* íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­ */}\n          <div className=\"space-y-2\">\n            <Label className=\"modal-label\">íŒŒì¼ ì„ íƒ</Label>\n            <div\n              className={`relative border-2 border-dashed rounded-xl p-8 text-center transition-all duration-200 cursor-pointer ${\n                dragOver\n                  ? 'border-hansl-400 bg-hansl-50 scale-[1.02]'\n                  : file\n                  ? 'border-green-400 bg-green-50'\n                  : 'border-gray-300 hover:border-hansl-300 hover:bg-gray-50'\n              }`}\n              onDragOver={handleDragOver}\n              onDragLeave={handleDragLeave}\n              onDrop={handleDrop}\n            >\n              {file ? (\n                <div className=\"space-y-3\">\n                  <div className=\"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto\">\n                    <FileImage className=\"w-8 h-8 text-green-600\" />\n                  </div>\n                  <div className=\"space-y-1\">\n                    <p className=\"modal-value text-green-800 truncate max-w-[200px] mx-auto\">{file.name}</p>\n                    <p className=\"badge-text text-green-600\">\n                      {(file.size / 1024 / 1024).toFixed(2)}MB\n                    </p>\n                  </div>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => setFile(null)}\n                    className=\"mt-3 text-red-600 border-red-200 hover:bg-red-50\"\n                  >\n                    <X className=\"w-3 h-3 mr-1\" />\n                    ì œê±°\n                  </Button>\n                </div>\n              ) : (\n                <div className=\"space-y-4\">\n                  <div className=\"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto\">\n                    <Upload className=\"w-8 h-8 text-gray-400\" />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <p className=\"modal-value\">\n                      ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸í•˜ì—¬ ë†“ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”\n                    </p>\n                    <p className=\"badge-text text-gray-500\">\n                      JPG, PNG, HEIC, WebP â€¢ ìµœëŒ€ 10MB\n                    </p>\n                  </div>\n                </div>\n              )}\n              \n              {!file && (\n                <input\n                  type=\"file\"\n                  accept=\"image/*\"\n                  onChange={(e) => {\n                    const selectedFile = e.target.files?.[0];\n                    if (selectedFile) {\n                      handleFileSelect(selectedFile);\n                    }\n                  }}\n                  className=\"absolute inset-0 w-full h-full opacity-0 cursor-pointer\"\n                />\n              )}\n            </div>\n          </div>\n\n          {/* ë©”ëª¨ */}\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"memo\" className=\"modal-label\">\n              ë©”ëª¨ <span className=\"text-gray-400 badge-text\">(ì„ íƒì‚¬í•­)</span>\n            </Label>\n            <Textarea\n              id=\"memo\"\n              placeholder=\"ì˜ìˆ˜ì¦ì— ëŒ€í•œ ê°„ë‹¨í•œ ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”\"\n              value={memo}\n              onChange={(e) => setMemo(e.target.value)}\n              className=\"resize-none border-gray-200 focus:border-hansl-400 focus:ring-hansl-400\"\n              rows={3}\n            />\n          </div>\n\n\n          {/* ì—…ë¡œë“œ ë²„íŠ¼ */}\n          <div className=\"flex gap-3 pt-6 border-t border-gray-100\">\n            <Button\n              variant=\"outline\"\n              onClick={handleClose}\n              className=\"flex-1 h-9 border-gray-200 hover:bg-gray-50\"\n              disabled={uploading}\n            >\n              ì·¨ì†Œ\n            </Button>\n            <Button\n              onClick={handleUpload}\n              disabled={!file || uploading}\n              className=\"flex-1 h-9 bg-hansl-600 hover:bg-hansl-700 text-white badge-text shadow-sm\"\n            >\n              {uploading ? (\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\n                  ì—…ë¡œë“œ ì¤‘...\n                </div>\n              ) : (\n                <>\n                  <Upload className=\"w-4 h-4 mr-2\" />\n                  ì—…ë¡œë“œ\n                </>\n              )}\n            </Button>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}","import { useState, useEffect, useCallback, useMemo } from \"react\";\nimport { createClient } from \"@/lib/supabase/client\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Search, Filter, Receipt, Printer, Download, Calendar, Plus, Trash2 } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport ReceiptDetailModal from \"./ReceiptDetailModal\";\nimport MobileReceiptCard from \"./MobileReceiptCard\";\nimport ReceiptUploadModal from \"./ReceiptUploadModal\";\nimport { useReceiptPermissions } from \"@/hooks/useReceiptPermissions\";\nimport type { ReceiptItem } from \"@/types/receipt\";\nimport { formatDate, formatFileSize } from \"@/utils/helpers\";\nimport { extractStoragePathFromUrl } from \"@/utils/receipt\";\nimport { logger } from \"@/lib/logger\";\n\n/**\n * ì˜ìˆ˜ì¦ ê´€ë¦¬ ë©”ì¸ í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸\n * \n * ì˜ìˆ˜ì¦ ëª©ë¡ ì¡°íšŒ, ê²€ìƒ‰, í•„í„°ë§, ì—…ë¡œë“œ, ë‹¤ìš´ë¡œë“œ, ì¸ì‡„, ì‚­ì œ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.\n * ì‚¬ìš©ì ê¶Œí•œì— ë”°ë¼ ê¸°ëŠ¥ì´ ì œí•œë©ë‹ˆë‹¤.\n * \n * @component\n * \n * ### ì£¼ìš” ê¸°ëŠ¥\n * - ì˜ìˆ˜ì¦ ëª©ë¡ ì¡°íšŒ (ë°ìŠ¤í¬í†±: í…Œì´ë¸”, ëª¨ë°”ì¼: ì¹´ë“œ)\n * - íŒŒì¼ëª…, ë©”ëª¨, ë‚ ì§œ ê¸°ë°˜ ê²€ìƒ‰\n * - ë‚ ì§œ í•„í„°ë§\n * - ê¶Œí•œ ê¸°ë°˜ UI ì œì–´\n * - ì˜ìˆ˜ì¦ ìƒì„¸ë³´ê¸° ëª¨ë‹¬\n * - ì—…ë¡œë“œ ëª¨ë‹¬\n * \n * ### ê¶Œí•œ ì²´ê³„\n * - `app_admin`: ëª¨ë“  ê¸°ëŠ¥ + ì‚­ì œ + ë“±ë¡ì¸ ì •ë³´ ì¡°íšŒ\n * - `hr`, `lead buyer`: ì¡°íšŒ, ì—…ë¡œë“œ, ë‹¤ìš´ë¡œë“œ, ì¸ì‡„\n * - ê¸°íƒ€: ì ‘ê·¼ ë¶ˆê°€\n * \n * @example\n * ```tsx\n * // App.tsxì—ì„œ ë¼ìš°íŒ…\n * <Route path=\"/receipts\" element={<ReceiptsMain />} />\n * ```\n */\nexport default function ReceiptsMain() {\n  const [receipts, setReceipts] = useState<ReceiptItem[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [dateFilter, setDateFilter] = useState(\"\");\n  const [selectedReceipt, setSelectedReceipt] = useState<ReceiptItem | null>(null);\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const [isUploadModalOpen, setIsUploadModalOpen] = useState(false);\n\n  const supabase = createClient();\n  const { permissions, loading: permissionsLoading } = useReceiptPermissions();\n\n  // ê¶Œí•œ ì—†ëŠ” ì‚¬ìš©ì ì ‘ê·¼ ì°¨ë‹¨\n  useEffect(() => {\n    if (!permissionsLoading && !permissions.canView) {\n      toast.error('ì˜ìˆ˜ì¦ ê´€ë¦¬ì— ì ‘ê·¼í•  ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');\n      // ì ì ˆí•œ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ê°€ëŠ¥\n    }\n  }, [permissions.canView, permissionsLoading]);\n\n  // ì˜ìˆ˜ì¦ ë°ì´í„° ë¡œë“œ - useCallbackìœ¼ë¡œ ìµœì í™”\n  const loadReceipts = useCallback(async () => {\n    if (!permissions.canView) return;\n    \n    try {\n      setLoading(true);\n      \n      const { data, error } = await supabase\n        .from('purchase_receipts')\n        .select(`\n          id,\n          receipt_image_url,\n          file_name,\n          file_size,\n          uploaded_by,\n          uploaded_by_name,\n          uploaded_at,\n          memo,\n          is_printed,\n          printed_at,\n          printed_by,\n          printed_by_name\n        `)\n        .order('uploaded_at', { ascending: false });\n\n      if (error) throw error;\n\n      setReceipts(data || []);\n    } catch (error) {\n      toast.error('ì˜ìˆ˜ì¦ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n    } finally {\n      setLoading(false);\n    }\n  }, [permissions.canView, supabase]);\n\n  // í•„í„°ë§ ë¡œì§ - useMemoë¡œ ìµœì í™”\n  const filteredReceipts = useMemo(() => {\n    let filtered = [...receipts];\n\n    // ê²€ìƒ‰ì–´ í•„í„°\n    if (searchTerm) {\n      const searchLower = searchTerm.toLowerCase();\n      filtered = filtered.filter(receipt => \n        receipt.file_name.toLowerCase().includes(searchLower) ||\n        receipt.memo?.toLowerCase().includes(searchLower) ||\n        formatDate(receipt.uploaded_at).includes(searchTerm) ||\n        receipt.uploaded_at.includes(searchTerm)\n      );\n    }\n\n    // ë‚ ì§œ í•„í„°\n    if (dateFilter) {\n      filtered = filtered.filter(receipt => {\n        if (!receipt.uploaded_at) return false;\n        const uploadDate = new Date(receipt.uploaded_at).toISOString().split('T')[0];\n        return uploadDate === dateFilter;\n      });\n    }\n\n    return filtered;\n  }, [receipts, searchTerm, dateFilter]);\n\n  // ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ ì‹œ ë°ì´í„° ë¡œë“œ\n  useEffect(() => {\n    if (!permissionsLoading) {\n      loadReceipts();\n    }\n  }, [loadReceipts, permissionsLoading]);\n\n  // formatDateëŠ” utilsì—ì„œ importí•˜ë¯€ë¡œ ì œê±°\n\n  // ì˜ìˆ˜ì¦ ìƒì„¸ë³´ê¸°\n  const handleViewReceipt = (receipt: ReceiptItem) => {\n    setSelectedReceipt(receipt);\n    setIsModalOpen(true);\n  };\n\n  // ì˜ìˆ˜ì¦ ì¸ì‡„ ì™„ë£Œ ì²˜ë¦¬\n  const markAsPrinted = useCallback(async (receiptId: string) => {\n    logger.debug('ì˜ìˆ˜ì¦ ì¸ì‡„ ì™„ë£Œ ì²˜ë¦¬ ì‹œì‘', {\n      receiptId,\n      timestamp: new Date().toISOString(),\n      location: 'ReceiptsMain.tsx'\n    });\n\n    try {\n      // 1. ì‚¬ìš©ì ì¸ì¦ ì •ë³´ í™•ì¸\n      const { data: { user }, error: authError } = await supabase.auth.getUser();\n      \n      if (authError) {\n        toast.error('ì‚¬ìš©ì ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n        return;\n      }\n      \n      if (!user) {\n        toast.error('ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');\n        return;\n      }\n\n      logger.debug('ì‚¬ìš©ì ì¸ì¦ ì •ë³´ í™•ì¸ ì™„ë£Œ', {\n        userId: user.id,\n        email: user.email,\n        lastSignIn: user.last_sign_in_at\n      });\n\n      // 2. ì‚¬ìš©ì ê¶Œí•œ ë° ì •ë³´ í™•ì¸\n      const { data: employee, error: empError } = await supabase\n        .from('employees')\n        .select('name, purchase_role')\n        .eq('email', user.email)\n        .single();\n\n      if (empError) {\n        toast.error('ì§ì› ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');\n        return;\n      }\n\n      logger.debug('ì§ì› ì •ë³´ ì¡°íšŒ ì™„ë£Œ', {\n        name: employee?.name,\n        email: user.email,\n        role: employee?.purchase_role\n      });\n\n      // 3. ê¶Œí•œ ê²€ì¦\n      const role = employee?.purchase_role || '';\n      const hasPermission = role.includes('app_admin') || role.includes('hr') || role.includes('lead buyer');\n      \n      logger.debug('ê¶Œí•œ ê²€ì¦ ê²°ê³¼', {\n        role,\n        hasPermission,\n        isAppAdmin: role.includes('app_admin'),\n        isHr: role.includes('hr'),\n        isLeadBuyer: role.includes('lead buyer')\n      });\n\n      if (!hasPermission) {\n        toast.error('ì¸ì‡„ì™„ë£Œ ì²˜ë¦¬ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');\n        return;\n      }\n\n      // 4. ì—…ë°ì´íŠ¸ ë°ì´í„° ì¤€ë¹„\n      const updateData = {\n        is_printed: true,\n        printed_at: new Date().toISOString(),\n        printed_by: user.id,\n        printed_by_name: employee?.name || user.email\n      };\n\n\n      // 5. ë°ì´í„°ë² ì´ìŠ¤ ì—…ë°ì´íŠ¸ ì‹¤í–‰\n      const startTime = performance.now();\n      \n      const { data: updateResult, error: updateError } = await supabase\n        .from('purchase_receipts')\n        .update(updateData)\n        .eq('id', receiptId)\n        .select('*');\n\n      const endTime = performance.now();\n      const executionTime = endTime - startTime;\n\n      if (updateError) {\n        logger.error('ì˜ìˆ˜ì¦ ì¸ì‡„ì™„ë£Œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', updateError, {\n          error: updateError,\n          code: updateError.code,\n          message: updateError.message,\n          details: updateError.details,\n          hint: updateError.hint,\n          executionTime: `${executionTime.toFixed(2)}ms`\n        });\n        \n        // RLS ê´€ë ¨ ì˜¤ë¥˜ íŠ¹ë³„ ì²˜ë¦¬\n        if (updateError.code === '42501' || updateError.message?.includes('policy')) {\n          toast.error('ë°ì´í„°ë² ì´ìŠ¤ ê¶Œí•œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.');\n        } else {\n          toast.error(`ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: ${updateError.message}`);\n        }\n        return;\n      }\n\n      logger.debug('ì˜ìˆ˜ì¦ ì¸ì‡„ì™„ë£Œ ì—…ë°ì´íŠ¸ ì„±ê³µ', {\n        updateResult,\n        executionTime: `${executionTime.toFixed(2)}ms`,\n        affectedRows: updateResult?.length || 0\n      });\n\n      // 6. ì„±ê³µ ì²˜ë¦¬\n      toast.success('ì¸ì‡„ ì™„ë£Œë¡œ í‘œì‹œë˜ì—ˆìŠµë‹ˆë‹¤.');\n      \n      // 7. ëª©ë¡ ìƒˆë¡œê³ ì¹¨\n      loadReceipts();\n\n      logger.debug('ì˜ìˆ˜ì¦ ì¸ì‡„ì™„ë£Œ ì²˜ë¦¬ ì„±ê³µ', {\n        receiptId,\n        success: true,\n        timestamp: new Date().toISOString()\n      });\n\n    } catch (error) {\n      const errorObj = error as any;\n      logger.error('ì˜ìˆ˜ì¦ ì¸ì‡„ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜ˆì™¸ ë°œìƒ', error, {\n        error,\n        message: errorObj?.message,\n        stack: errorObj?.stack,\n        receiptId,\n        timestamp: new Date().toISOString()\n      });\n      \n      toast.error(`ì¸ì‡„ ì™„ë£Œ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${errorObj?.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);\n    }\n  }, [supabase, loadReceipts]);\n\n  // ì˜ìˆ˜ì¦ ì¸ì‡„\n  const handlePrintReceipt = async (receipt: ReceiptItem) => {\n    if (!receipt.receipt_image_url) {\n      toast.error('ì˜ìˆ˜ì¦ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.');\n      return;\n    }\n\n    try {\n      // ìƒˆ ì°½ì—ì„œ ì¸ì‡„ìš© í˜ì´ì§€ ì—´ê¸°\n      const printWindow = window.open('', '_blank');\n      if (!printWindow) {\n        toast.error('íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. íŒì—…ì„ í—ˆìš©í•´ì£¼ì„¸ìš”.');\n        return;\n      }\n\n      printWindow.document.write(`\n        <!DOCTYPE html>\n        <html>\n        <head>\n          <title>ì˜ìˆ˜ì¦ ì¸ì‡„</title>\n          <style>\n            * {\n              margin: 0;\n              padding: 0;\n              box-sizing: border-box;\n            }\n            body {\n              display: flex;\n              justify-content: center;\n              align-items: center;\n              min-height: 100vh;\n              background: white;\n            }\n            .receipt-image {\n              max-width: 100%;\n              max-height: 100vh;\n              object-fit: contain;\n            }\n            @media print {\n              body {\n                margin: 0;\n                padding: 0;\n              }\n              .receipt-image {\n                max-width: 100%;\n                max-height: 100%;\n                width: auto;\n                height: auto;\n              }\n            }\n          </style>\n        </head>\n        <body>\n          <img \n            src=\"${receipt.receipt_image_url}\" \n            alt=\"ì˜ìˆ˜ì¦\" \n            class=\"receipt-image\"\n            onload=\"window.print(); window.close();\"\n            onerror=\"alert('ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); window.close();\"\n          />\n        </body>\n        </html>\n      `);\n      \n      printWindow.document.close();\n\n      // ì¸ì‡„ ì™„ë£Œ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸\n      setTimeout(() => {\n        if (confirm('ì¸ì‡„ë¥¼ ì™„ë£Œí•˜ì…¨ìŠµë‹ˆê¹Œ?')) {\n          markAsPrinted(receipt.id);\n        }\n      }, 1000);\n    } catch (error) {\n      toast.error('ì¸ì‡„ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n    }\n  };\n\n  // ì˜ìˆ˜ì¦ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ\n  const handleDownloadReceipt = async (receipt: ReceiptItem) => {\n    if (!receipt.receipt_image_url) {\n      toast.error('ì˜ìˆ˜ì¦ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.');\n      return;\n    }\n\n    try {\n      // URLì—ì„œ íŒŒì¼ ê²½ë¡œ ì¶”ì¶œ (Supabase Storage ê²½ë¡œ)\n      const url = new URL(receipt.receipt_image_url);\n      const pathSegments = url.pathname.split('/');\n      const bucketIndex = pathSegments.indexOf('receipt-images');\n      \n      if (bucketIndex === -1) {\n        throw new Error('ì˜ëª»ëœ ì˜ìˆ˜ì¦ URLì…ë‹ˆë‹¤');\n      }\n      \n      const filePath = pathSegments.slice(bucketIndex + 1).join('/');\n\n      // Supabase Storageì—ì„œ ë‹¤ìš´ë¡œë“œ\n      const { data, error } = await supabase.storage\n        .from('receipt-images')\n        .download(filePath);\n\n      if (error) throw error;\n\n      // Blobì„ ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥í•œ URLë¡œ ë³€í™˜\n      const blob = new Blob([data], { type: 'image/jpeg' });\n      const downloadUrl = window.URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = downloadUrl;\n      a.download = receipt.file_name || `ì˜ìˆ˜ì¦_${receipt.id}.jpg`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      window.URL.revokeObjectURL(downloadUrl);\n      \n      toast.success('ì˜ìˆ˜ì¦ ì´ë¯¸ì§€ê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');\n    } catch (error) {\n      toast.error('ë‹¤ìš´ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n    }\n  };\n\n  // ì˜ìˆ˜ì¦ ì‚­ì œ - useCallbackìœ¼ë¡œ ìµœì í™”\n  const handleDeleteReceipt = useCallback(async (receipt: ReceiptItem) => {\n    if (!permissions.canDelete) {\n      toast.error('ì‚­ì œ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');\n      return;\n    }\n\n    if (!confirm(`ì •ë§ë¡œ \"${receipt.file_name}\" ì˜ìˆ˜ì¦ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {\n      return;\n    }\n\n    try {\n      // URLì—ì„œ íŒŒì¼ ê²½ë¡œ ì¶”ì¶œ (ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ì‚¬ìš©)\n      const filePath = extractStoragePathFromUrl(receipt.receipt_image_url);\n      \n      if (filePath) {\n        logger.debug('Storage íŒŒì¼ ì‚­ì œ ì‹œì‘', { filePath });\n        \n        // Supabase Storageì—ì„œ íŒŒì¼ ì‚­ì œ\n        const { error: storageError } = await supabase.storage\n          .from('receipt-images')\n          .remove([filePath]);\n\n        if (storageError) {\n          logger.warn('Storage íŒŒì¼ ì‚­ì œ ì‹¤íŒ¨', storageError, { filePath });\n        }\n      }\n\n      // DBì—ì„œ ë ˆì½”ë“œ ì‚­ì œ\n      const { error: dbError } = await supabase\n        .from('purchase_receipts')\n        .delete()\n        .eq('id', receipt.id);\n\n      if (dbError) throw dbError;\n\n      toast.success('ì˜ìˆ˜ì¦ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');\n      loadReceipts(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨\n    } catch (error) {\n      toast.error('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n    }\n  }, [permissions.canDelete, loadReceipts]);\n\n  return (\n    <div className=\"w-full\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4\">\n        <div>\n          <h1 className=\"page-title\">ì˜ìˆ˜ì¦ ê´€ë¦¬</h1>\n          <p className=\"page-subtitle\" style={{marginTop:'-2px',marginBottom:'-4px'}}>Receipt Management</p>\n        </div>\n        <div className=\"flex items-center gap-2 mt-4 sm:mt-0\">\n          <Button\n            onClick={() => {\n              setIsUploadModalOpen(true);\n            }}\n            className=\"bg-hansl-600 hover:bg-hansl-700 text-white\"\n          >\n            <Plus className=\"w-4 h-4 mr-2\" />\n            ì˜ìˆ˜ì¦ ì—…ë¡œë“œ\n          </Button>\n          <Badge variant=\"secondary\" className=\"modal-subtitle\">\n            ì´ {filteredReceipts.length}ê±´\n          </Badge>\n        </div>\n      </div>\n\n      {/* í•„í„° ì„¹ì…˜ */}\n      <Card className=\"mb-4 border border-gray-200\">\n        <CardHeader className=\"bg-white border-b border-gray-200 py-3\">\n          <CardTitle className=\"flex items-center modal-section-title\">\n            <Filter className=\"w-4 h-4 mr-2\" />\n            ê²€ìƒ‰ í•„í„°\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"py-3\">\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2\">\n            <div>\n              <label className=\"block modal-label mb-1\">ê²€ìƒ‰</label>\n              <div className=\"relative\">\n                <Search className=\"absolute left-2 top-1/2 transform -translate-y-1/2 w-3 h-3 text-gray-400\" />\n                <Input\n                  placeholder=\"íŒŒì¼ëª…, ë©”ëª¨, ì—…ë¡œë“œì¼...\"\n                  value={searchTerm}\n                  onChange={(e) => setSearchTerm(e.target.value)}\n                  className=\"pl-7 modal-subtitle h-9\"\n                />\n              </div>\n            </div>\n\n            <div>\n              <label className=\"block modal-label mb-1\">ì—…ë¡œë“œ ë‚ ì§œ</label>\n              <Input\n                type=\"date\"\n                value={dateFilter}\n                onChange={(e) => setDateFilter(e.target.value)}\n                className=\"modal-subtitle h-9\"\n              />\n            </div>\n\n            <div className=\"flex items-end\">\n              <Button\n                variant=\"outline\"\n                onClick={() => {\n                  setSearchTerm(\"\");\n                  setDateFilter(\"\");\n                }}\n                className=\"h-9 modal-subtitle\"\n              >\n                ì´ˆê¸°í™”\n              </Button>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* ì˜ìˆ˜ì¦ ëª©ë¡ */}\n      <Card className=\"overflow-hidden border border-gray-200\">\n        <CardContent className=\"p-0\">\n          {(loading || permissionsLoading) ? (\n            <div className=\"flex items-center justify-center py-12\">\n              <div className=\"w-8 h-8 border-2 border-hansl-500 border-t-transparent rounded-full animate-spin\" />\n              <span className=\"ml-3 card-subtitle\">ë¡œë”© ì¤‘...</span>\n            </div>\n          ) : !permissions.canView ? (\n            <div className=\"text-center py-12\">\n              <div className=\"w-12 h-12 text-red-400 mx-auto mb-4\">ğŸ”’</div>\n              <h3 className=\"modal-section-title mb-2\">ì ‘ê·¼ ê¶Œí•œ ì—†ìŒ</h3>\n              <p className=\"card-subtitle\">ì˜ìˆ˜ì¦ ê´€ë¦¬ì— ì ‘ê·¼í•  ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.</p>\n            </div>\n          ) : filteredReceipts.length === 0 ? (\n            <div className=\"text-center py-12\">\n              <Receipt className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" />\n              <h3 className=\"modal-section-title mb-2\">ì˜ìˆ˜ì¦ì´ ì—†ìŠµë‹ˆë‹¤</h3>\n              <p className=\"card-subtitle\">ì—…ë¡œë“œëœ ì˜ìˆ˜ì¦ì´ ì—†ê±°ë‚˜ ê²€ìƒ‰ ì¡°ê±´ì— ë§ëŠ” ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>\n            </div>\n          ) : (\n            <>\n              {/* ë°ìŠ¤í¬í†± í…Œì´ë¸” ë·° */}\n              <div className=\"hidden md:block overflow-x-auto\">\n                <table className=\"w-full min-w-fit\">\n                <thead className=\"bg-gray-50\">\n                  <tr>\n                    <th className=\"px-4 py-3 text-center header-title text-gray-600 uppercase tracking-wider\">ì¸ì‡„ì™„ë£Œ</th>\n                    <th className=\"px-4 py-3 text-center header-title text-gray-600 uppercase tracking-wider\">ì—…ë¡œë“œì¼</th>\n                    <th className=\"px-4 py-3 text-left header-title text-gray-600 uppercase tracking-wider\">íŒŒì¼ëª…</th>\n                    <th className=\"px-4 py-3 text-left header-title text-gray-600 uppercase tracking-wider\">ë©”ëª¨</th>\n                    {permissions.canViewUploaderInfo && (\n                      <th className=\"px-4 py-3 text-left header-title text-gray-600 uppercase tracking-wider\">ë“±ë¡ì¸</th>\n                    )}\n                    <th className=\"px-4 py-3 text-center header-title text-gray-600 uppercase tracking-wider\">í¬ê¸°</th>\n                    <th className=\"px-4 py-3 text-center header-title text-gray-600 uppercase tracking-wider\">ì•¡ì…˜</th>\n                    {permissions.canDelete && (\n                      <th className=\"px-4 py-3 text-center header-title text-gray-600 uppercase tracking-wider\">ì‚­ì œ</th>\n                    )}\n                  </tr>\n                </thead>\n                <tbody className=\"bg-white divide-y divide-gray-200\">\n                  {filteredReceipts.map((receipt) => (\n                    <tr \n                      key={receipt.id} \n                      className=\"hover:bg-gray-50 transition-colors cursor-pointer\"\n                      onClick={() => handleViewReceipt(receipt)}\n                    >\n                      <td className=\"px-4 py-3 modal-subtitle text-center\">\n                        {receipt.is_printed ? (\n                          <Badge className=\"bg-green-100 text-green-700 hover:bg-green-100\">\n                            âœ“ ì™„ë£Œ\n                          </Badge>\n                        ) : (\n                          <Badge variant=\"secondary\" className=\"bg-gray-100 text-gray-600\">\n                            ë¯¸ì™„ë£Œ\n                          </Badge>\n                        )}\n                      </td>\n                      <td className=\"px-4 py-3 modal-subtitle text-center text-gray-600\">\n                        {formatDate(receipt.uploaded_at)}\n                      </td>\n                      <td className=\"px-4 py-3 modal-value text-gray-900\">\n                        {receipt.file_name}\n                      </td>\n                      <td className=\"px-4 py-3 modal-subtitle text-gray-900\">\n                        {receipt.memo || '-'}\n                      </td>\n                      {permissions.canViewUploaderInfo && (\n                        <td className=\"px-4 py-3 modal-subtitle text-gray-600\">\n                          {receipt.uploaded_by_name || receipt.uploaded_by}\n                        </td>\n                      )}\n                      <td className=\"px-4 py-3 modal-subtitle text-center text-gray-600\">\n                        {formatFileSize(receipt.file_size)}\n                      </td>\n                      <td className=\"px-4 py-3 modal-subtitle text-center\">\n                        <div className=\"flex items-center justify-center gap-1\">\n                          <Button\n                            size=\"sm\"\n                            variant=\"ghost\"\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              handlePrintReceipt(receipt);\n                            }}\n                            className=\"h-8 w-8 p-0\"\n                            title=\"ì¸ì‡„\"\n                          >\n                            <Printer className=\"w-4 h-4\" />\n                          </Button>\n                          <Button\n                            size=\"sm\"\n                            variant=\"ghost\"\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              handleDownloadReceipt(receipt);\n                            }}\n                            className=\"h-8 w-8 p-0\"\n                            title=\"ë‹¤ìš´ë¡œë“œ\"\n                          >\n                            <Download className=\"w-4 h-4\" />\n                          </Button>\n                        </div>\n                      </td>\n                      {permissions.canDelete && (\n                        <td className=\"px-4 py-3 modal-subtitle text-center\">\n                          <Button\n                            size=\"sm\"\n                            variant=\"ghost\"\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              handleDeleteReceipt(receipt);\n                            }}\n                            className=\"h-8 w-8 p-0 text-red-600 hover:bg-red-50\"\n                            title=\"ì‚­ì œ\"\n                          >\n                            <Trash2 className=\"w-4 h-4\" />\n                          </Button>\n                        </td>\n                      )}\n                    </tr>\n                  ))}\n                </tbody>\n                </table>\n              </div>\n\n              {/* ëª¨ë°”ì¼ ì¹´ë“œ ë·° */}\n              <div className=\"md:hidden space-y-3 p-4\">\n                {filteredReceipts.map((receipt) => (\n                  <MobileReceiptCard\n                    key={receipt.id}\n                    receipt={receipt}\n                    onView={handleViewReceipt}\n                    onPrint={handlePrintReceipt}\n                    onDownload={handleDownloadReceipt}\n                    onDelete={permissions.canDelete ? handleDeleteReceipt : undefined}\n                  />\n                ))}\n              </div>\n            </>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* ì˜ìˆ˜ì¦ ìƒì„¸ë³´ê¸° ëª¨ë‹¬ */}\n      {selectedReceipt && (\n        <ReceiptDetailModal\n          receipt={selectedReceipt}\n          isOpen={isModalOpen}\n          onClose={() => {\n            setIsModalOpen(false);\n            setSelectedReceipt(null);\n          }}\n          onDelete={() => {\n            loadReceipts(); // ì‚­ì œ í›„ ëª©ë¡ ìƒˆë¡œê³ ì¹¨\n          }}\n        />\n      )}\n\n      {/* ì˜ìˆ˜ì¦ ì—…ë¡œë“œ ëª¨ë‹¬ */}\n      <ReceiptUploadModal\n        isOpen={isUploadModalOpen}\n        onClose={() => setIsUploadModalOpen(false)}\n        onSuccess={() => {\n          loadReceipts(); // ì—…ë¡œë“œ í›„ ëª©ë¡ ìƒˆë¡œê³ ì¹¨\n        }}\n      />\n    </div>\n  );\n}","/**\n * ì˜ìˆ˜ì¦ ê´€ë¦¬ ê´€ë ¨ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤\n */\n\n\n// íŒŒì¼ íƒ€ì… ê²€ì¦\nexport function isValidImageFile(file: File): boolean {\n  const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp', 'image/heic'];\n  return validTypes.includes(file.type.toLowerCase());\n}\n\n// íŒŒì¼ í¬ê¸° ê²€ì¦ (ê¸°ë³¸ 10MB)\nexport function isValidFileSize(file: File, maxSizeMB: number = 10): boolean {\n  const maxSizeBytes = maxSizeMB * 1024 * 1024;\n  return file.size <= maxSizeBytes;\n}\n\n// ì˜ìˆ˜ì¦ íŒŒì¼ëª… ìƒì„±\nexport function generateReceiptFileName(extension: string = 'jpg'): string {\n  const now = new Date();\n  const year = now.getFullYear().toString().substring(2);\n  const month = (now.getMonth() + 1).toString().padStart(2, '0');\n  const day = now.getDate().toString().padStart(2, '0');\n  const hour = now.getHours().toString().padStart(2, '0');\n  const minute = now.getMinutes().toString().padStart(2, '0');\n  \n  return `rec${year}${month}${day}${hour}${minute}.${extension}`;\n}\n\n// Supabase Storage URLì—ì„œ íŒŒì¼ ê²½ë¡œ ì¶”ì¶œ\nexport function extractStoragePathFromUrl(url: string, bucketName: string = 'receipt-images'): string | null {\n  try {\n    const urlObj = new URL(url);\n    const pathSegments = urlObj.pathname.split('/');\n    const bucketIndex = pathSegments.indexOf(bucketName);\n    \n    if (bucketIndex === -1) return null;\n    \n    return pathSegments.slice(bucketIndex + 1).join('/');\n  } catch {\n    return null;\n  }\n}\n\n// ê²€ìƒ‰ì–´ í•˜ì´ë¼ì´íŠ¸ìš© í•¨ìˆ˜\nexport function highlightSearchTerm(text: string, searchTerm: string): string {\n  if (!searchTerm) return text;\n  \n  const regex = new RegExp(`(${searchTerm.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')})`, 'gi');\n  return text.replace(regex, '<mark>$1</mark>');\n}\n\n// í‚¤ë³´ë“œ ì ‘ê·¼ì„±ì„ ìœ„í•œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬\nexport function handleKeyboardActivation(\n  event: React.KeyboardEvent,\n  callback: () => void\n): void {\n  if (event.key === 'Enter' || event.key === ' ') {\n    event.preventDefault();\n    callback();\n  }\n}"],"names":["FileImage","createLucideIcon","d","key","cx","cy","r","Funnel","Printer","x","y","width","height","rx","RotateCcw","Upload","ZoomIn","x1","x2","y1","y2","ZoomOut","useReceiptPermissions","permissions","setPermissions","useState","canView","canUpload","canDownload","canPrint","canDelete","canViewUploaderInfo","userRole","setUserRole","loading","setLoading","supabase","createClient","checkPermissions","async","data","user","auth","getUser","employee","from","select","eq","email","single","role","purchase_role","isAppAdmin","includes","isHr","isLeadBuyer","hasReceiptAccess","error","useEffect","refreshPermissions","ReceiptDetailModal","receipt","isOpen","onClose","onDelete","imageScale","setImageScale","imageRotation","setImageRotation","imageError","setImageError","deleting","setDeleting","imageDimensions","setImageDimensions","imageLoaded","setImageLoaded","markAsPrinted","useCallback","logger","debug","receiptId","id","receiptName","file_name","authError","toast","empError","updateData","is_printed","printed_at","Date","toISOString","printed_by","printed_by_name","name","startTime","performance","now","updateResult","updateError","update","code","message","success","errorObj","handlePrint","printWindow","window","open","document","write","receipt_image_url","close","setTimeout","confirm","handleDelete","pathSegments","URL","pathname","split","bucketIndex","indexOf","filePath","slice","join","storageError","storage","remove","warn","dbError","delete","jsx","Dialog","onOpenChange","children","DialogContent","className","jsxs","src","alt","style","containerWidth","innerWidth","containerHeight","innerHeight","widthRatio","heightRatio","optimalRatio","Math","min","getOptimalImageStyle","transform","transformOrigin","onLoad","e","img","currentTarget","naturalWidth","naturalHeight","onError","Button","variant","size","onClick","X","max","prev","disabled","round","title","Error","download","blob","Blob","type","downloadUrl","createObjectURL","a","createElement","href","body","appendChild","click","removeChild","revokeObjectURL","Download","Trash2","MobileReceiptCard","onView","onPrint","onDownload","Card","CardContent","Badge","Calendar","formatDate","uploaded_at","FileText","memo","User","uploaded_by_name","uploaded_by","formatFileSize","file_size","stopPropagation","ReceiptUploadModal","onSuccess","file","setFile","setMemo","uploading","setUploading","dragOver","setDragOver","handleFileSelect","selectedFile","startsWith","handleUpload","userError","employeeError","userName","fileExtension","pop","fileName","getFullYear","toString","substring","getMonth","padStart","getDate","getHours","getMinutes","getTime","uploadError","upload","contentType","upsert","publicUrl","getPublicUrl","insert","handleClose","DialogHeader","DialogTitle","DialogDescription","Label","onDragOver","preventDefault","onDragLeave","onDrop","files","Array","dataTransfer","length","toFixed","accept","onChange","target","htmlFor","Textarea","placeholder","value","rows","Fragment","ReceiptsMain","receipts","setReceipts","searchTerm","setSearchTerm","dateFilter","setDateFilter","selectedReceipt","setSelectedReceipt","isModalOpen","setIsModalOpen","isUploadModalOpen","setIsUploadModalOpen","permissionsLoading","loadReceipts","order","ascending","filteredReceipts","useMemo","filtered","searchLower","toLowerCase","filter","handleViewReceipt","timestamp","location","userId","lastSignIn","last_sign_in_at","hasPermission","executionTime","details","hint","affectedRows","stack","handlePrintReceipt","handleDownloadReceipt","handleDeleteReceipt","url","bucketName","extractStoragePathFromUrl","marginTop","marginBottom","Plus","CardHeader","CardTitle","Filter","Search","Input","Receipt","map"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6]}