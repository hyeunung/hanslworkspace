import{c as _e,r as i,a as ee,l as ne,j as e,F as xt,b as pt,B as A,U as ut,X as ve,d as we,e as ht,f as yt,g as gt,h as Q,i as be,u as Nt}from"./index-C_XLQIpZ.js";import{t as E,B as w}from"./index-VAyiyELQ.js";import{I as P,D as Se,e as ke,f as De,g as Ce,j as $e,R as jt,P as ft,W as _t,C as vt,T as wt,k as bt,l as qe,O as St,m as kt,S as ie,a as ce,b as de,c as me,d as X}from"./dialog-9qER4IKQ.js";import{P as xe}from"./package-CeUSbuLm.js";import{C as oe}from"./circle-check-big-Mifekiap.js";import{T as pe,S as Dt}from"./trash-2-BJ-Nc10b.js";import{P as ue}from"./plus-BvSdp0Hp.js";import{P as Ae,f as Ct}from"./format-Duuke9o2.js";import{S as Pe}from"./save-CgRjXPhw.js";import{E as $t}from"./eye-Bfo_WycG.js";import{T as qt,a as At,b as ye,c as H,d as Pt,e as J}from"./table-CNwVWA08.js";import{C as ge,a as It,b as Et,c as Ne}from"./card-Bnuex2Us.js";/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ft=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],je=_e("circle-x",Ft);/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ot=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Wt=_e("funnel",Ot),Tt=()=>{const[t,r]=i.useState([]),[a,p]=i.useState([]),[u,S]=i.useState([]),[k,v]=i.useState(!0),[$,D]=i.useState([]),[m,F]=i.useState(""),N=ee();i.useEffect(()=>{(async()=>{try{const[C,_,y]=await Promise.all([N.from("vendors").select("id, vendor_name").order("vendor_name"),N.from("employees").select("id, name, email, full_name").order("full_name"),N.auth.getUser()]);if(C.error)throw C.error;if(p(C.data||[]),_.error)throw _.error;if(S(_.data||[]),y.data.user&&!y.error){let{data:d}=await N.from("employees").select("*").eq("id",y.data.user.id).maybeSingle();if(!d&&y.data.user.email&&(d=(await N.from("employees").select("*").eq("email",y.data.user.email).maybeSingle()).data),d){let c=[];d.purchase_role&&(Array.isArray(d.purchase_role)?c=d.purchase_role.map(g=>String(g).trim()):c=String(d.purchase_role).split(",").map(j=>j.trim()).filter(j=>j.length>0)),D(c),F(d.full_name||d.name||"")}}}catch(C){ne.error("초기 데이터 로드 실패",C)}})()},[]);const q=i.useCallback(async()=>{v(!0);try{const{data:{user:b},error:C}=await N.auth.getUser();if(C||!b){ne.error("사용자 인증 실패",C),E.error("로그인이 필요합니다."),v(!1);return}const{data:_,error:y}=await N.from("purchase_requests").select(`
          *,
          vendors (
            vendor_name,
            vendor_payment_schedule
          ),
          vendor_contacts (
            contact_name
          ),
          purchase_request_items (
            item_name,
            specification,
            quantity,
            unit_price_value,
            amount_value,
            remark,
            line_number,
            link
          )
        `).order("request_date",{ascending:!1}).limit(2e3);if(y)throw y;const d=(_||[]).map(c=>{const g=c.purchase_request_items?.[0]||{};return{id:Number(c.id),purchase_order_number:c.purchase_order_number,request_date:c.request_date,delivery_request_date:c.delivery_request_date,progress_type:c.progress_type,payment_completed_at:c.payment_completed_at,payment_category:c.payment_category,currency:c.currency,request_type:c.request_type,vendor:c.vendors||null,vendor_name:c.vendors?.vendor_name||"",vendor_payment_schedule:c.vendors?.vendor_payment_schedule||"",vendor_contacts:c.vendor_contacts||[],requester_name:c.requester_name,item_name:g.item_name||"",specification:g.specification||"",quantity:Number(g.quantity)||0,unit_price_value:Number(g.unit_price_value)||0,amount_value:Number(g.amount_value)||0,remark:g.remark||"",project_vendor:c.project_vendor,sales_order_number:c.sales_order_number,project_item:c.project_item,line_number:Number(g.line_number)||1,contact_name:c.vendor_contacts?.contact_name||"",middle_manager_status:c.middle_manager_status,final_manager_status:c.final_manager_status,is_received:!!c.is_received,received_at:c.received_at,is_payment_completed:!!c.is_payment_completed,is_po_download:!!c.is_po_download,link:g.link,items:c.purchase_request_items||[],total_amount:c.purchase_request_items?.reduce((j,z)=>j+(Number(z.amount_value)||0),0)||0,purchase_status:c.purchase_status||"pending"}});r(d)}catch(b){ne.error("발주 목록 로드 실패",b),E.error("발주 목록을 불러올 수 없습니다.")}finally{v(!1)}},[]);return i.useEffect(()=>{q()},[q]),{purchases:t,vendors:a,employees:u,loading:k,currentUserRoles:$,currentUserName:m,refreshPurchases:q}};function Mt(t,r=500){const[a,p]=i.useState(t);return i.useEffect(()=>{const u=setTimeout(()=>{p(t)},r);return()=>{clearTimeout(u)}},[t,r]),a}const Rt=["정현웅","정희웅"],Lt=(t,r,a)=>{const p=ee(),[u,S]=i.useState("pending"),[k,v]=i.useState(""),[$,D]=i.useState(""),[m,F]=i.useState(""),[N,q]=i.useState(""),[b,C]=i.useState(""),[_,y]=i.useState(""),[d,c]=i.useState(""),[g,j]=i.useState(""),z=new Date().getFullYear(),O=new Date(z,0,1).toISOString().split("T")[0],te=new Date().toISOString().split("T")[0],[W,R]=i.useState(O),[T,Z]=i.useState(te),V=Mt(k,300),re=r?.includes("app_admin")||r?.includes("final_approver"),L=l=>a||a||"";i.useEffect(()=>{if(!a)return;const l=L();F(l)},[u,a,re]);const se=i.useMemo(()=>r.includes("purchase_manager")||r.includes("app_admin")?t:t.filter(l=>!Rt.includes(l.requester_name)),[t,r]),M=i.useMemo(()=>se.filter(l=>{const x=l.request_date?l.request_date.split("T")[0]:"",f=!W||x>=W,I=!T||x<=T;return f&&I}),[se,W,T]),G=i.useMemo(()=>M.filter(l=>{switch(u){case"pending":return["pending","대기","",null].includes(l.final_manager_status);case"purchase":{const x=l.payment_category==="구매요청",f=!l.is_payment_completed;if(!x||!f)return!1;const I=(l.progress_type||"").includes("선진행"),le=l.final_manager_status==="approved";return I||le}case"receipt":{const x=!l.is_received,f=(l.progress_type||"").includes("선진행")||l.final_manager_status==="approved";return x&&f}case"done":return!0;default:return!0}}),[M,u]),K=i.useMemo(()=>!m||m==="all"||m==="전체"?G:G.filter(l=>l.requester_name===m),[G,m]),U=i.useMemo(()=>$?K.filter(l=>l.vendor_name===$):K,[K,$]),B=i.useMemo(()=>{let l=U;if(N){const x=N.trim().toLowerCase();l=l.filter(f=>f.purchase_order_number?.toLowerCase().includes(x))}if(b){const x=b.trim().toLowerCase();l=l.filter(f=>f.items&&f.items.length>0?f.items.some(I=>I.item_name?.toLowerCase().includes(x)):!1)}if(_){const x=_.trim().toLowerCase();l=l.filter(f=>f.items&&f.items.length>0?f.items.some(I=>I.specification?.toLowerCase().includes(x)):!1)}if(d&&d!=="all"&&(l=l.filter(x=>{switch(d){case"pending":return!x.final_manager_status||x.final_manager_status==="pending"||x.final_manager_status==="대기";case"approved":return x.final_manager_status==="approved";case"rejected":return x.final_manager_status==="rejected"||x.middle_manager_status==="rejected";default:return!0}})),g){const x=g.trim().toLowerCase();l=l.filter(f=>f.items&&f.items.length>0?f.items.some(I=>I.remark?.toLowerCase().includes(x)):!1)}return l},[U,N,b,_,d,g]),h=i.useMemo(()=>{if(!V)return B;const l=V.trim().toLowerCase();return B.filter(x=>x.purchase_order_number?.toLowerCase().includes(l)||x.vendor_name?.toLowerCase().includes(l)||x.requester_name?.toLowerCase().includes(l)||x.project_vendor?.toLowerCase().includes(l)?!0:x.items&&x.items.length>0?x.items.some(f=>f.item_name&&f.item_name.toLowerCase().includes(l)||f.specification&&f.specification.toLowerCase().includes(l)):!1)},[B,V]),n=i.useMemo(()=>[...h].sort((l,x)=>{const f=l.request_date?new Date(l.request_date).getTime():0;return(x.request_date?new Date(x.request_date).getTime():0)-f}),[h]),o=i.useMemo(()=>{const l=x=>new Set(x.map(f=>f.purchase_order_number)).size;return{pending:l(M.filter(x=>["pending","대기","",null].includes(x.final_manager_status))),purchase:l(M.filter(x=>{const f=x.payment_category==="구매요청",I=!x.is_payment_completed;if(!f||!I)return!1;const le=(x.progress_type||"").includes("선진행"),ot=x.final_manager_status==="approved";return le||ot})),receipt:l(M.filter(x=>{const f=!x.is_received,I=(x.progress_type||"").includes("선진행")||x.final_manager_status==="approved";return f&&I})),done:l(M)}},[M]);return i.useEffect(()=>{(async()=>{const{data:{user:l}}=await p.auth.getUser();if(!l)return;const{data:x}=await p.from("user_preferences").select("period_start, period_end").eq("user_id",l.id).single();if(x){const f=x.period_start?new Date(x.period_start).toISOString().split("T")[0]:O,I=x.period_end?new Date(x.period_end).toISOString().split("T")[0]:te;R(f),Z(I)}})()},[]),i.useEffect(()=>{(async()=>{const{data:{user:l}}=await p.auth.getUser();l&&(!W||!T||await p.from("user_preferences").upsert({user_id:l.id,period_start:W,period_end:T,updated_at:new Date().toISOString()}))})()},[W,T]),{activeTab:u,searchTerm:k,vendorFilter:$,dateFromFilter:W,dateToFilter:T,selectedEmployee:m,purchaseNumberFilter:N,itemNameFilter:b,specificationFilter:_,approvalStatusFilter:d,remarkFilter:g,setActiveTab:S,setSearchTerm:v,setVendorFilter:D,setDateFromFilter:R,setDateToFilter:Z,setSelectedEmployee:F,setPurchaseNumberFilter:q,setItemNameFilter:C,setSpecificationFilter:y,setApprovalStatusFilter:c,setRemarkFilter:j,filteredPurchases:n,tabCounts:o}};function zt({purchaseId:t,isOpen:r,onClose:a,embedded:p=!1,currentUserRoles:u=[],activeTab:S,onRefresh:k,onDelete:v}){const[$,D]=i.useState(!1),[m,F]=i.useState(null),[N,q]=i.useState(!1),[b,C]=i.useState(null),[_,y]=i.useState([]),[d,c]=i.useState([]),g=ee(),j=u.includes("final_approver")||u.includes("app_admin")||u.includes("ceo"),z=j,O=u.includes("final_approver")||u.includes("app_admin")||u.includes("ceo"),te=u.includes("middle_manager")||u.includes("app_admin")||u.includes("ceo"),W=u.includes("final_approver")||u.includes("app_admin")||u.includes("ceo");i.useEffect(()=>{t&&r&&R(t.toString())},[t,r]);const R=async h=>{try{D(!0);const n=ee(),{data:o,error:l}=await n.from("purchase_requests").select(`
          *,
          vendors(id, vendor_name),
          purchase_request_items(*)
        `).eq("id",h).single();if(l)throw l;if(o){const x={...o,items:o.purchase_request_items||[],vendor:o.vendors||{id:0,vendor_name:"알 수 없음"},vendor_contacts:[]};F(x),C(x),y(x.items||[])}}catch{E.error("발주 상세 정보를 불러오는데 실패했습니다.")}finally{D(!1)}},T=()=>m?m.is_received?e.jsx(w,{className:"bg-green-100 text-green-800",children:"입고완료"}):m.middle_manager_status==="approved"&&m.final_manager_status==="approved"?e.jsx(w,{className:"bg-hansl-100 text-hansl-800",children:"구매진행"}):m.middle_manager_status==="rejected"||m.final_manager_status==="rejected"?e.jsx(w,{className:"bg-red-100 text-red-800",children:"반려"}):e.jsx(w,{className:"bg-yellow-100 text-yellow-800",children:"승인대기"}):null,Z=h=>h?new Date(h).toLocaleDateString("ko-KR"):"-",V=h=>new Intl.NumberFormat("ko-KR").format(h),re=async()=>{if(!(!m||!b))try{const h=_.reduce((o,l)=>o+(l.amount_value||0),0),{error:n}=await g.from("purchase_requests").update({purchase_order_number:b.purchase_order_number,requester_name:b.requester_name,vendor_name:b.vendor?.vendor_name||b.vendor_name,delivery_request_date:b.delivery_request_date,request_date:b.request_date,payment_category:b.payment_category,project_vendor:b.project_vendor,total_amount:h,updated_at:new Date().toISOString()}).eq("id",m.id);if(n)throw n;if(d.length>0){const{error:o}=await g.from("purchase_request_items").delete().in("id",d);if(o)throw o}for(const o of _)if(o.id){const{error:l}=await g.from("purchase_request_items").update({item_name:o.item_name,specification:o.specification,quantity:o.quantity,unit_price_value:o.unit_price_value,amount_value:o.amount_value,remark:o.remark,updated_at:new Date().toISOString()}).eq("id",o.id);if(l)throw l}else{const{error:l}=await g.from("purchase_request_items").insert({purchase_request_id:m.id,item_name:o.item_name,specification:o.specification,quantity:o.quantity,unit_price_value:o.unit_price_value,amount_value:o.amount_value,remark:o.remark,line_number:o.line_number||_.indexOf(o)+1,created_at:new Date().toISOString()});if(l)throw l}E.success("발주 내역이 수정되었습니다."),q(!1),c([]),k?.(),await R(t?.toString()||"")}catch{E.error("저장 중 오류가 발생했습니다.")}},L=(h,n,o)=>{const l=[..._];if(n==="amount_value")l[h]={...l[h],amount_value:o};else if(n==="quantity"||n==="unit_price_value"){const x=n==="quantity"?o:l[h].quantity,f=n==="unit_price_value"?o:l[h].unit_price_value;l[h]={...l[h],[n]:o,amount_value:x*f}}else l[h]={...l[h],[n]:o};y(l)},se=()=>{const h={item_name:"",specification:"",quantity:1,unit_price_value:0,amount_value:0,remark:"",line_number:_.length+1};y([..._,h])},M=h=>{const n=_[h];n.id&&c([...d,n.id]);const o=_.filter((l,x)=>x!==h);y(o)},G=async(h,n)=>{if(!O){E.error("입고 처리 권한이 없습니다.");return}try{const{error:o}=await g.from("purchase_request_items").update({is_received:n,delivery_status:n?"received":"pending",received_quantity:n&&m?.items?.find(l=>String(l.id)===String(h))?.quantity||0,received_at:n?new Date().toISOString():null}).eq("id",h);if(o)throw o;E.success(n?"입고 처리되었습니다.":"입고가 취소되었습니다."),t&&await R(t.toString()),k?.()}catch{E.error("입고 처리 중 오류가 발생했습니다.")}},K=async h=>{if(m)try{const n=h==="middle"?{middle_manager_status:"approved"}:{final_manager_status:"approved"},{error:o}=await g.from("purchase_requests").update(n).eq("id",m.id);if(o)throw o;E.success(`${h==="middle"?"중간":"최종"} 승인이 완료되었습니다.`),k?.(),await R(t?.toString()||"")}catch{E.error("승인 처리 중 오류가 발생했습니다.")}},U=async h=>{if(!(!m||!window.prompt("반려 사유를 입력해주세요:")))try{const o=h==="middle"?{middle_manager_status:"rejected"}:{final_manager_status:"rejected"},{error:l}=await g.from("purchase_requests").update(o).eq("id",m.id);if(l)throw l;E.success(`${h==="middle"?"중간":"최종"} 반려가 완료되었습니다.`),k?.(),await R(t?.toString()||"")}catch{E.error("반려 처리 중 오류가 발생했습니다.")}},B=e.jsx(e.Fragment,{children:$?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-hansl-600"})}):m?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold mb-3 flex items-center",children:[e.jsx(xt,{className:"w-4 h-4 mr-2"}),"기본 정보"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"요청자"}),e.jsx("p",{className:"font-medium",children:m.requester_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"요청일"}),e.jsx("p",{className:"font-medium",children:Z(m.request_date)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"입고요청일"}),e.jsx("p",{className:"font-medium",children:Z(m.delivery_request_date)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"결제유형"}),e.jsx("p",{className:"font-medium",children:m.payment_category||"-"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold mb-3 flex items-center",children:[e.jsx(pt,{className:"w-4 h-4 mr-2"}),"업체 정보"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"업체명"}),e.jsx("p",{className:"font-medium",children:m.vendor?.vendor_name||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"프로젝트 업체"}),e.jsx("p",{className:"font-medium",children:m.project_vendor||"-"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold mb-3 flex items-center",children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"품목 리스트"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-white",children:e.jsxs("tr",{children:[O&&S==="receipt"&&e.jsx("th",{className:"px-3 py-2 text-center text-xs font-medium text-gray-500",children:"입고"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500",children:"품명"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500",children:"규격"}),e.jsx("th",{className:"px-3 py-2 text-center text-xs font-medium text-gray-500",children:"수량"}),e.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-gray-500",children:"단가"}),e.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-gray-500",children:"금액"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500",children:"비고"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:(N?_:m.items)?.map((h,n)=>e.jsxs("tr",{children:[O&&S==="receipt"&&e.jsx("td",{className:"px-3 py-2 text-center",children:e.jsx("div",{className:"flex items-center justify-center",children:h.is_received||h.delivery_status==="received"?e.jsxs("button",{onClick:()=>G(h.id,!1),className:"flex items-center gap-1 px-2 py-1 text-xs bg-green-100 text-green-800 rounded-md hover:bg-green-200 transition-colors",disabled:!O,children:[e.jsx(oe,{className:"w-3 h-3"}),"입고완료"]}):e.jsxs("button",{onClick:()=>G(h.id,!0),className:"flex items-center gap-1 px-2 py-1 text-xs bg-gray-100 text-gray-600 rounded-md hover:bg-gray-200 transition-colors",disabled:!O,children:[e.jsx(xe,{className:"w-3 h-3"}),"미입고"]})})}),e.jsx("td",{className:"px-3 py-2",children:N?e.jsx(P,{value:h.item_name,onChange:o=>L(n,"item_name",o.target.value),className:"text-sm"}):e.jsx("span",{className:"text-sm",children:h.item_name})}),e.jsx("td",{className:"px-3 py-2",children:N?e.jsx(P,{value:h.specification,onChange:o=>L(n,"specification",o.target.value),className:"text-sm"}):e.jsx("span",{className:"text-sm",children:h.specification})}),e.jsx("td",{className:"px-3 py-2 text-center",children:N?e.jsx(P,{type:"number",value:h.quantity,onChange:o=>L(n,"quantity",Number(o.target.value)),className:"text-sm text-center w-20 mx-auto"}):e.jsx("span",{className:"text-sm",children:h.quantity})}),e.jsx("td",{className:"px-3 py-2 text-right",children:N?e.jsx(P,{type:"number",value:h.unit_price_value,onChange:o=>L(n,"unit_price_value",Number(o.target.value)),className:"text-sm text-right"}):e.jsxs("span",{className:"text-sm",children:[V(h.unit_price_value)," ",m.currency]})}),e.jsx("td",{className:"px-3 py-2 text-right",children:N?e.jsx(P,{type:"number",value:h.amount_value,onChange:o=>L(n,"amount_value",Number(o.target.value)),className:"text-sm text-right"}):e.jsxs("span",{className:"text-sm",children:[V(h.amount_value)," ",m.currency]})}),e.jsx("td",{className:"px-3 py-2",children:N?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{value:h.remark||"",onChange:o=>L(n,"remark",o.target.value),className:"text-sm"}),e.jsx(A,{size:"sm",variant:"ghost",onClick:()=>M(n),className:"text-red-600 hover:bg-red-50",children:e.jsx(pe,{className:"w-4 h-4"})})]}):e.jsx("span",{className:"text-sm",children:h.remark||"-"})})]},n))}),e.jsx("tfoot",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:O&&S==="receipt"?5:4,className:"px-3 py-2 text-sm font-semibold text-right",children:"총액"}),e.jsxs("td",{className:"px-3 py-2 text-sm font-semibold text-right",children:[V((N?_:m.items)?.reduce((h,n)=>h+(n.amount_value||0),0)||0)," ",m.currency]}),e.jsx("td",{})]})})]})}),N&&e.jsxs(A,{size:"sm",variant:"outline",onClick:se,className:"w-full mt-2",children:[e.jsx(ue,{className:"w-4 h-4 mr-1"}),"항목 추가"]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold mb-3 flex items-center",children:[e.jsx(ut,{className:"w-4 h-4 mr-2"}),"승인 정보"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"중간승인"}),e.jsx(w,{variant:m.middle_manager_status==="approved"?"default":"secondary",className:m.middle_manager_status==="approved"?"bg-green-100 text-green-800":m.middle_manager_status==="rejected"?"bg-red-100 text-red-800":"",children:m.middle_manager_status==="approved"?"승인":m.middle_manager_status==="rejected"?"반려":"대기"})]}),!N&&te&&m.middle_manager_status!=="approved"&&m.middle_manager_status!=="rejected"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(A,{size:"sm",onClick:()=>K("middle"),className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(oe,{className:"w-4 h-4 mr-1"}),"승인"]}),e.jsxs(A,{size:"sm",variant:"outline",onClick:()=>U("middle"),className:"text-red-600 hover:bg-red-50",children:[e.jsx(je,{className:"w-4 h-4 mr-1"}),"반려"]})]})]})}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"최종승인"}),e.jsx(w,{variant:m.final_manager_status==="approved"?"default":"secondary",className:m.final_manager_status==="approved"?"bg-green-100 text-green-800":m.final_manager_status==="rejected"?"bg-red-100 text-red-800":"",children:m.final_manager_status==="approved"?"승인":m.final_manager_status==="rejected"?"반려":"대기"})]}),!N&&W&&m.middle_manager_status==="approved"&&m.final_manager_status!=="approved"&&m.final_manager_status!=="rejected"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(A,{size:"sm",onClick:()=>K("final"),className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(oe,{className:"w-4 h-4 mr-1"}),"승인"]}),e.jsxs(A,{size:"sm",variant:"outline",onClick:()=>U("final"),className:"text-red-600 hover:bg-red-50",children:[e.jsx(je,{className:"w-4 h-4 mr-1"}),"반려"]})]})]})})]})]})]}):e.jsx("div",{className:"text-center py-12 text-gray-500",children:"발주 정보를 불러올 수 없습니다."})});return p?B:e.jsx(Se,{open:r,onOpenChange:a,children:e.jsxs(ke,{className:"w-full max-w-[95vw] sm:max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(De,{children:e.jsxs(Ce,{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xl font-bold",children:N?"발주 내역 수정":"발주 상세 정보"}),m&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["#",m.purchase_order_number]}),!N&&T(),!N&&j&&e.jsxs(e.Fragment,{children:[e.jsxs(A,{size:"sm",variant:"outline",onClick:()=>q(!0),className:"text-blue-600 hover:bg-blue-50",children:[e.jsx(Ae,{className:"w-4 h-4 mr-1"}),"수정"]}),z&&v&&e.jsxs(A,{size:"sm",variant:"outline",onClick:()=>v(m),className:"text-red-600 hover:bg-red-50",children:[e.jsx(pe,{className:"w-4 h-4 mr-1"}),"삭제"]})]}),N&&e.jsxs(e.Fragment,{children:[e.jsxs(A,{size:"sm",variant:"outline",onClick:()=>{q(!1),C(m),y(m.items||[]),c([])},children:[e.jsx(ve,{className:"w-4 h-4 mr-1"}),"취소"]}),e.jsxs(A,{size:"sm",onClick:re,className:"bg-hansl-600 hover:bg-hansl-700 text-white",children:[e.jsx(Pe,{className:"w-4 h-4 mr-1"}),"저장"]})]})]})]})}),B]})})}const Vt=t=>{if(!t)return"-";const r=new Date(t);return`${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")}`},Bt=t=>{if(!t.items||t.items.length===0)return{received:0,total:0,percentage:0};const r=t.items.length,a=t.items.filter(u=>u.is_received||u.delivery_status==="received").length,p=r>0?Math.round(a/r*100):0;return{received:a,total:r,percentage:p}},Ie=i.memo(({purchase:t})=>{const r=t.is_received?"completed":t.middle_manager_status==="approved"&&t.final_manager_status==="approved"?"inProgress":t.middle_manager_status==="rejected"||t.final_manager_status==="rejected"?"rejected":"pending",a={completed:{text:"입고완료",className:"bg-green-100 text-green-800"},inProgress:{text:"구매진행",className:"bg-hansl-100 text-hansl-800"},rejected:{text:"반려",className:"bg-red-100 text-red-800"},pending:{text:"승인대기",className:"bg-yellow-100 text-yellow-800"}},{text:p,className:u}=a[r];return e.jsx(w,{className:`${u} text-xs`,children:p})});Ie.displayName="StatusBadge";const Ee=i.memo(({purchase:t,onClick:r})=>{const a=Bt(t),p=t.progress_type==="선진행"||t.progress_type?.includes("선진행");return e.jsxs("div",{className:`bg-white rounded-lg border p-4 space-y-3 cursor-pointer transition-all hover:shadow-md ${p?"border-red-400 bg-red-50 hover:bg-red-100":"hover:bg-gray-50"}`,onClick:()=>r(t),children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[p?e.jsx(w,{className:"bg-red-500 text-white font-bold text-xs px-2 py-0.5",children:"선진행"}):e.jsx(w,{className:"bg-gray-200 text-gray-700 text-xs px-2 py-0.5",children:"일반"}),e.jsx("span",{className:"font-semibold text-sm text-gray-900",children:t.purchase_order_number||"-"})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[Vt(t.request_date)," 요청"]})]}),e.jsx(Ie,{purchase:t})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"요청자"}),e.jsx("span",{className:"font-medium",children:t.requester_name})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"업체"}),e.jsx("span",{className:"font-medium",children:t.vendor_name})]}),t.project_vendor&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"PJ업체"}),e.jsx("span",{className:"font-medium truncate max-w-[150px]",children:t.project_vendor})]}),t.project_item&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"PJ ITEM"}),e.jsx("span",{className:"font-medium truncate max-w-[150px]",children:t.project_item})]}),t.sales_order_number&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"수주번호"}),e.jsx("span",{className:"font-medium truncate max-w-[150px]",children:t.sales_order_number})]}),t.item_name&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"품목"}),e.jsx("span",{className:"font-medium truncate max-w-[150px]",children:t.item_name})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"금액"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[(t.amount_value||t.total_amount)?.toLocaleString()," ",t.currency]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"입고현황"}),e.jsxs("span",{className:"text-gray-700",children:[a.received,"/",a.total," (",a.percentage,"%)"]})]}),e.jsx("div",{className:"bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${a.percentage===100?"bg-green-500":a.percentage>0?"bg-hansl-500":"bg-gray-300"}`,style:{width:`${a.percentage}%`}})})]}),t.is_payment_completed!==void 0&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"결제"}),t.is_payment_completed?e.jsx(w,{className:"bg-green-100 text-green-800 text-xs",children:"완료"}):e.jsx(w,{className:"bg-gray-100 text-gray-800 text-xs",children:"대기"})]}),e.jsx("div",{className:"pt-2 border-t",children:e.jsxs("div",{className:"flex items-center justify-center text-xs text-gray-500",children:[e.jsx($t,{className:"w-3 h-3 mr-1"}),"클릭하여 상세보기"]})})]})});Ee.displayName="MobilePurchaseCard";var Fe="AlertDialog",[Ht,_s]=ht(Fe,[$e]),Y=$e(),Oe=t=>{const{__scopeAlertDialog:r,...a}=t,p=Y(r);return e.jsx(jt,{...p,...a,modal:!0})};Oe.displayName=Fe;var Jt="AlertDialogTrigger",Yt=i.forwardRef((t,r)=>{const{__scopeAlertDialog:a,...p}=t,u=Y(a);return e.jsx(kt,{...u,...p,ref:r})});Yt.displayName=Jt;var Gt="AlertDialogPortal",We=t=>{const{__scopeAlertDialog:r,...a}=t,p=Y(r);return e.jsx(ft,{...p,...a})};We.displayName=Gt;var Kt="AlertDialogOverlay",Te=i.forwardRef((t,r)=>{const{__scopeAlertDialog:a,...p}=t,u=Y(a);return e.jsx(St,{...u,...p,ref:r})});Te.displayName=Kt;var ae="AlertDialogContent",[Xt,Qt]=Ht(ae),Zt=gt("AlertDialogContent"),Me=i.forwardRef((t,r)=>{const{__scopeAlertDialog:a,children:p,...u}=t,S=Y(a),k=i.useRef(null),v=we(r,k),$=i.useRef(null);return e.jsx(_t,{contentName:ae,titleName:Re,docsSlug:"alert-dialog",children:e.jsx(Xt,{scope:a,cancelRef:$,children:e.jsxs(vt,{role:"alertdialog",...S,...u,ref:v,onOpenAutoFocus:yt(u.onOpenAutoFocus,D=>{D.preventDefault(),$.current?.focus({preventScroll:!0})}),onPointerDownOutside:D=>D.preventDefault(),onInteractOutside:D=>D.preventDefault(),children:[e.jsx(Zt,{children:p}),e.jsx(es,{contentRef:k})]})})})});Me.displayName=ae;var Re="AlertDialogTitle",Le=i.forwardRef((t,r)=>{const{__scopeAlertDialog:a,...p}=t,u=Y(a);return e.jsx(wt,{...u,...p,ref:r})});Le.displayName=Re;var ze="AlertDialogDescription",Ve=i.forwardRef((t,r)=>{const{__scopeAlertDialog:a,...p}=t,u=Y(a);return e.jsx(bt,{...u,...p,ref:r})});Ve.displayName=ze;var Ut="AlertDialogAction",Be=i.forwardRef((t,r)=>{const{__scopeAlertDialog:a,...p}=t,u=Y(a);return e.jsx(qe,{...u,...p,ref:r})});Be.displayName=Ut;var He="AlertDialogCancel",Je=i.forwardRef((t,r)=>{const{__scopeAlertDialog:a,...p}=t,{cancelRef:u}=Qt(He,a),S=Y(a),k=we(r,u);return e.jsx(qe,{...S,...p,ref:k})});Je.displayName=He;var es=({contentRef:t})=>{const r=`\`${ae}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${ae}\` by passing a \`${ze}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${ae}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return i.useEffect(()=>{document.getElementById(t.current?.getAttribute("aria-describedby"))||console.warn(r)},[r,t]),null},ts=Oe,ss=We,Ye=Te,Ge=Me,Ke=Be,Xe=Je,Qe=Le,Ze=Ve;const as=ts,rs=ss,Ue=i.forwardRef(({className:t,...r},a)=>e.jsx(Ye,{className:Q("fixed inset-0 z-50 bg-black/40 backdrop-blur-sm","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...r,ref:a}));Ue.displayName=Ye.displayName;const et=i.forwardRef(({className:t,...r},a)=>e.jsxs(rs,{children:[e.jsx(Ue,{}),e.jsx(Ge,{ref:a,className:Q("fixed left-[50%] top-[50%] z-50","w-full max-w-md translate-x-[-50%] translate-y-[-50%]","grid gap-4 bg-white border border-gray-200","rounded-lg p-6 shadow-professional-xl","duration-200","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0","data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95","data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%]","data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%]",t),...r})]}));et.displayName=Ge.displayName;const tt=({className:t,...r})=>e.jsx("div",{className:Q("flex flex-col space-y-2 text-left",t),...r});tt.displayName="AlertDialogHeader";const st=({className:t,...r})=>e.jsx("div",{className:Q("flex flex-col-reverse sm:flex-row sm:justify-end gap-3",t),...r});st.displayName="AlertDialogFooter";const at=i.forwardRef(({className:t,...r},a)=>e.jsx(Qe,{ref:a,className:Q("text-lg font-semibold text-gray-800 tracking-tight",t),...r}));at.displayName=Qe.displayName;const rt=i.forwardRef(({className:t,...r},a)=>e.jsx(Ze,{ref:a,className:Q("text-sm text-gray-600",t),...r}));rt.displayName=Ze.displayName;const lt=i.forwardRef(({className:t,...r},a)=>e.jsx(Ke,{ref:a,className:Q(be(),t),...r}));lt.displayName=Ke.displayName;const nt=i.forwardRef(({className:t,...r},a)=>e.jsx(Xe,{ref:a,className:Q(be({variant:"outline"}),"mt-2 sm:mt-0",t),...r}));nt.displayName=Xe.displayName;const he=i.memo(({purchase:t})=>{const r=t.is_received?"completed":t.middle_manager_status==="approved"&&t.final_manager_status==="approved"?"inProgress":t.middle_manager_status==="rejected"||t.final_manager_status==="rejected"?"rejected":"pending",a={completed:{text:"입고완료",className:"bg-green-100 text-green-800"},inProgress:{text:"구매진행",className:"bg-hansl-100 text-hansl-800"},rejected:{text:"반려",className:"bg-red-100 text-red-800"},pending:{text:"승인대기",className:"bg-yellow-100 text-yellow-800"}},{text:p,className:u}=a[r];return e.jsx(w,{className:u,children:p})});he.displayName="StatusBadge";const it=i.memo(({purchase:t})=>t.is_received||t.items&&t.items.length>0&&t.items.every(a=>a.is_received===!0||a.delivery_status==="received"||a.delivery_status==="completed")?e.jsx(w,{className:"bg-gray-100 text-gray-600 text-[11px]",children:"구매완료"}):e.jsx(w,{className:"bg-yellow-100 text-yellow-800 text-[11px]",children:"진행중"}));it.displayName="PurchaseStatusBadge";const s={approvalStatus:{style:{width:"80px",minWidth:"80px",maxWidth:"80px"},className:"text-center"},purchaseOrderNumber:{style:{width:"130px",minWidth:"130px",maxWidth:"130px",paddingLeft:"8px"},className:""},paymentCategory:{style:{width:"80px",minWidth:"80px",maxWidth:"80px"},className:"text-center"},requesterName:{style:{width:"70px",minWidth:"70px",maxWidth:"70px"},className:""},requestDate:{style:{width:"85px",minWidth:"85px",maxWidth:"85px"},className:""},vendorName:{style:{width:"120px",minWidth:"120px",maxWidth:"120px"},className:""},contactName:{style:{width:"70px",minWidth:"70px",maxWidth:"70px"},className:""},deliveryRequestDate:{style:{width:"85px",minWidth:"85px",maxWidth:"85px"},className:""},itemName:{style:{width:"180px",minWidth:"180px",maxWidth:"180px"},className:""},specification:{style:{width:"200px",minWidth:"200px",maxWidth:"200px"},className:""},quantity:{style:{width:"50px",minWidth:"50px",maxWidth:"50px"},className:"text-center"},unitPrice:{style:{width:"80px",minWidth:"80px",maxWidth:"80px"},className:"text-right"},amount:{style:{width:"90px",minWidth:"90px",maxWidth:"90px"},className:"text-right"},remark:{style:{width:"auto",minWidth:"200px"},className:""},paymentSchedule:{style:{width:"80px",minWidth:"80px",maxWidth:"80px"},className:""},purchaseStatus:{style:{width:"80px",minWidth:"80px",maxWidth:"80px"},className:"text-center"},projectVendor:{style:{width:"120px",minWidth:"120px",maxWidth:"120px"},className:""},salesOrderNumber:{style:{width:"100px",minWidth:"100px",maxWidth:"100px"},className:""},projectItem:{style:{width:"120px",minWidth:"120px",maxWidth:"120px"},className:""},receiptProgress:{style:{width:"80px",minWidth:"80px",maxWidth:"80px"},className:"text-center"},status:{style:{width:"80px",minWidth:"80px",maxWidth:"80px"},className:"text-center"},receipt:{style:{width:"80px",minWidth:"80px",maxWidth:"80px"},className:"text-center"},paymentStatus:{style:{width:"70px",minWidth:"70px",maxWidth:"70px"},className:"text-center"},link:{style:{width:"80px",minWidth:"80px",maxWidth:"80px"},className:""}},ct=i.memo(({purchase:t})=>{const r=t.middle_manager_status==="approved",a=t.middle_manager_status==="rejected",p=t.final_manager_status==="approved",u=t.final_manager_status==="rejected";return a||u?e.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[e.jsx("div",{className:"flex items-center gap-0.5",children:e.jsx("div",{className:"w-1.5 h-1.5 bg-red-500 rounded-full animate-pulse"})}),e.jsx(w,{className:"bg-red-100 text-red-800 text-[11px] font-medium px-1.5 py-0",children:"반려"})]}):r&&p?e.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[e.jsx("div",{className:"flex items-center gap-0.5",children:e.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"})}),e.jsx(w,{className:"bg-green-100 text-green-800 text-[11px] font-medium px-1.5 py-0",children:"승인완료"})]}):r&&!p&&!u?e.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),e.jsx("div",{className:"w-3 h-0.5 bg-gray-300"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full"})]}),e.jsx(w,{className:"bg-yellow-100 text-yellow-800 text-[11px] font-medium px-1.5 py-0",children:"1차 승인"})]}):e.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full"}),e.jsx("div",{className:"w-3 h-0.5 bg-gray-300"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full"})]}),e.jsx(w,{className:"bg-gray-100 text-gray-600 text-[11px] font-medium px-1.5 py-0",children:"승인대기"})]})});ct.displayName="ApprovalStatusBadge";const ls=t=>{if(t.is_received)return{received:1,total:1,percentage:100};if(!t.items||t.items.length===0)return{received:0,total:1,percentage:0};const r=t.items.length,a=t.items.filter(u=>u.is_received===!0||u.delivery_status==="received"||u.delivery_status==="completed").length,p=r>0?Math.round(a/r*100):0;return{received:a,total:r,percentage:p}},fe=t=>{if(!t)return"-";const r=new Date(t);return`${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")}`},ns=i.memo(({type:t})=>t==="선진행"||t?.includes("선진행")?e.jsx(w,{className:"bg-red-500 text-white font-bold text-[11px] px-2 py-0.5",children:"선진행"}):e.jsx(w,{className:"bg-gray-200 text-gray-700 text-[11px] px-2 py-0.5",children:"일반"}));ns.displayName="ProgressTypeBadge";const dt=i.memo(({purchase:t,onClick:r,activeTab:a})=>{const p=ls(t),u=t.progress_type==="선진행"||t.progress_type?.includes("선진행");return e.jsxs("tr",{className:`border-b hover:bg-gray-100 cursor-pointer transition-colors ${u?"bg-red-50 hover:bg-red-100":""}`,onClick:()=>r(t),children:[a==="pending"&&e.jsx("td",{className:`px-2 py-1.5 whitespace-nowrap ${s.approvalStatus.className}`,style:s.approvalStatus.style,children:e.jsx(ct,{purchase:t})}),a==="purchase"&&e.jsx("td",{className:`px-2 py-1.5 whitespace-nowrap ${s.purchaseStatus.className}`,style:s.purchaseStatus.style,children:e.jsx(it,{purchase:t})}),a==="receipt"&&e.jsx("td",{className:`px-2 py-1.5 ${s.receiptProgress.className}`,style:s.receiptProgress.style,children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:e.jsx("div",{className:`h-1.5 rounded-full ${p.percentage===100?"bg-green-500":p.percentage>0?"bg-hansl-500":"bg-gray-300"}`,style:{width:`${p.percentage}%`}})}),e.jsxs("span",{className:"text-[11px] text-gray-600",children:[p.percentage,"%"]})]})}),e.jsx("td",{className:`px-2 py-1.5 font-medium text-[11px] whitespace-nowrap ${s.purchaseOrderNumber.className}`,style:s.purchaseOrderNumber.style,children:e.jsx("span",{className:"block truncate",title:t.purchase_order_number||"",children:t.purchase_order_number||"-"})}),(a==="pending"||a==="receipt"||a==="done"||!a)&&e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${s.paymentCategory.className}`,style:s.paymentCategory.style,children:e.jsx(w,{className:`text-[11px] ${t.payment_category==="구매요청"?"bg-blue-100 text-blue-800":t.payment_category==="경비 청구"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:t.payment_category||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${s.requesterName.className}`,style:s.requesterName.style,children:e.jsx("span",{className:"block truncate",title:t.requester_name||"",children:t.requester_name||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${s.requestDate.className}`,style:s.requestDate.style,children:fe(t.request_date)}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${s.vendorName.className}`,style:s.vendorName.style,children:e.jsx("span",{className:"block truncate",title:t.vendor_name||"",children:t.vendor_name||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${s.contactName.className}`,style:s.contactName.style,children:e.jsx("span",{className:"block truncate",title:t.contact_name||"",children:t.contact_name||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${s.deliveryRequestDate.className}`,style:s.deliveryRequestDate.style,children:fe(t.delivery_request_date)}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${s.itemName.className}`,style:s.itemName.style,children:e.jsx("span",{className:"block truncate",title:t.item_name||"",children:t.item_name||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${s.specification.className}`,style:s.specification.style,children:e.jsx("span",{className:"block truncate",title:t.specification||"",children:t.specification||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${s.quantity.className}`,style:s.quantity.style,children:t.quantity||0}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${s.unitPrice.className}`,style:s.unitPrice.style,children:t.unit_price_value?.toLocaleString()||0}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] font-medium whitespace-nowrap ${s.amount.className}`,style:s.amount.style,children:t.amount_value?.toLocaleString()||t.total_amount?.toLocaleString()||0}),a==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${s.remark.className}`,style:s.remark.style,children:e.jsx("span",{className:"block truncate",title:t.remark||"",children:t.remark||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${s.projectVendor.className}`,style:s.projectVendor.style,children:e.jsx("span",{className:"block truncate",title:t.project_vendor||"",children:t.project_vendor||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${s.projectItem.className}`,style:s.projectItem.style,children:e.jsx("span",{className:"block truncate",title:t.project_item||"",children:t.project_item||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${s.salesOrderNumber.className}`,style:s.salesOrderNumber.style,children:e.jsx("span",{className:"block truncate",title:t.sales_order_number||"",children:t.sales_order_number||"-"})})]}),a==="purchase"&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${s.remark.className}`,style:s.remark.style,children:e.jsx("span",{className:"block truncate",title:t.remark||"",children:t.remark||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${s.link.className}`,style:s.link.style,children:t.link?e.jsx("a",{href:t.link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline truncate block",title:t.link,children:"링크 보기"}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${s.paymentSchedule.className}`,style:s.paymentSchedule.style,children:e.jsx("span",{className:"block truncate",title:t.vendor_payment_schedule||"",children:t.vendor_payment_schedule||"-"})})]}),a==="receipt"&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${s.remark.className}`,style:s.remark.style,children:e.jsx("span",{className:"block truncate",title:t.remark||"",children:t.remark||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${s.projectVendor.className}`,style:s.projectVendor.style,children:e.jsx("span",{className:"block truncate",title:t.project_vendor||"",children:t.project_vendor||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${s.projectItem.className}`,style:s.projectItem.style,children:e.jsx("span",{className:"block truncate",title:t.project_item||"",children:t.project_item||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${s.salesOrderNumber.className}`,style:s.salesOrderNumber.style,children:e.jsx("span",{className:"block truncate",title:t.sales_order_number||"",children:t.sales_order_number||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${s.paymentSchedule.className}`,style:s.paymentSchedule.style,children:e.jsx("span",{className:"block truncate",title:t.vendor_payment_schedule||"",children:t.vendor_payment_schedule||"-"})})]}),(a==="done"||!a)&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${s.remark.className}`,style:s.remark.style,children:e.jsx("span",{className:"block truncate",title:t.remark||"",children:t.remark||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${s.link.className}`,style:s.link.style,children:t.link?e.jsx("a",{href:t.link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline truncate block",title:t.link,children:"링크 보기"}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${s.projectVendor.className}`,style:s.projectVendor.style,children:e.jsx("span",{className:"block truncate",title:t.project_vendor||"",children:t.project_vendor||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${s.projectItem.className}`,style:s.projectItem.style,children:e.jsx("span",{className:"block truncate",title:t.project_item||"",children:t.project_item||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${s.salesOrderNumber.className}`,style:s.salesOrderNumber.style,children:e.jsx("span",{className:"block truncate",title:t.sales_order_number||"",children:t.sales_order_number||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${s.paymentSchedule.className}`,style:s.paymentSchedule.style,children:e.jsx("span",{className:"block truncate",title:t.vendor_payment_schedule||"",children:t.vendor_payment_schedule||"-"})}),e.jsx("td",{className:`px-2 py-1.5 ${s.status.className}`,style:s.status.style,children:e.jsx(he,{purchase:t})}),e.jsx("td",{className:`px-2 py-1.5 ${s.receipt.className}`,style:s.receipt.style,children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:e.jsx("div",{className:`h-1.5 rounded-full ${p.percentage===100?"bg-green-500":p.percentage>0?"bg-hansl-500":"bg-gray-300"}`,style:{width:`${p.percentage}%`}})}),e.jsxs("span",{className:"text-[11px] text-gray-600",children:[p.percentage,"%"]})]})}),e.jsx("td",{className:`px-2 py-1.5 ${s.paymentStatus.className}`,style:s.paymentStatus.style,children:t.is_payment_completed?e.jsx(w,{className:"bg-green-100 text-green-800 text-[11px]",children:"완료"}):e.jsx(w,{className:"bg-gray-100 text-gray-800 text-[11px]",children:"대기"})})]})]})});dt.displayName="TableRow";const mt=i.memo(({purchases:t,activeTab:r="done",currentUserRoles:a=[],onRefresh:p})=>{const[u,S]=i.useState(null),[k,v]=i.useState(!1),[$,D]=i.useState(!1),[m,F]=i.useState(null),N=ee();a.includes("final_approver")||a.includes("app_admin")||a.includes("ceo");const q=y=>{S(y.id),v(!0)},b=()=>{v(!1),S(null)},C=async()=>{if(m){try{const{error:y}=await N.from("purchase_request_items").delete().eq("purchase_request_id",m.id);if(y)throw y;const{error:d}=await N.from("purchase_requests").delete().eq("id",m.id);if(d)throw d;E.success("발주요청 내역이 삭제되었습니다."),p?.()}catch{E.error("삭제 중 오류가 발생했습니다.")}D(!1),F(null)}},_=i.useMemo(()=>{if(r==="pending")return e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${s.approvalStatus.className}`,style:s.approvalStatus.style,children:"승인상태"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${s.purchaseOrderNumber.className}`,style:s.purchaseOrderNumber.style,children:"발주요청번호"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${s.paymentCategory.className}`,style:s.paymentCategory.style,children:"결제종류"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${s.requesterName.className}`,style:s.requesterName.style,children:"요청자"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${s.requestDate.className}`,style:s.requestDate.style,children:"청구일"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] text-left ${s.vendorName.className}`,style:s.vendorName.style,children:"업체"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${s.contactName.className}`,style:s.contactName.style,children:"담당자"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${s.deliveryRequestDate.className}`,style:s.deliveryRequestDate.style,children:"입고요청일"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] text-left ${s.itemName.className}`,style:s.itemName.style,children:"품명"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] text-left ${s.specification.className}`,style:s.specification.style,children:"규격"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${s.quantity.className}`,style:s.quantity.style,children:"수량"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${s.unitPrice.className}`,style:s.unitPrice.style,children:"단가"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${s.amount.className}`,style:s.amount.style,children:"금액"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${s.remark.className}`,style:s.remark.style,children:"비고"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${s.projectVendor.className}`,style:s.projectVendor.style,children:"PJ업체"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${s.projectItem.className}`,style:s.projectItem.style,children:"PJ ITEM"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${s.salesOrderNumber.className}`,style:s.salesOrderNumber.style,children:"수주번호"})]})});const y=e.jsxs(e.Fragment,{children:[e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${s.purchaseOrderNumber.className}`,style:s.purchaseOrderNumber.style,children:"발주요청번호"}),(r==="receipt"||r==="done"||!r)&&e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${s.paymentCategory.className}`,style:s.paymentCategory.style,children:"결제종류"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${s.requesterName.className}`,style:s.requesterName.style,children:"요청자"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${s.requestDate.className}`,style:s.requestDate.style,children:"청구일"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${s.vendorName.className}`,style:s.vendorName.style,children:"업체"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${s.contactName.className}`,style:s.contactName.style,children:"담당자"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${s.deliveryRequestDate.className}`,style:s.deliveryRequestDate.style,children:"입고요청일"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] text-left ${s.itemName.className}`,style:s.itemName.style,children:"품명"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] text-left ${s.specification.className}`,style:s.specification.style,children:"규격"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${s.quantity.className}`,style:s.quantity.style,children:"수량"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${s.unitPrice.className}`,style:s.unitPrice.style,children:"단가"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${s.amount.className}`,style:s.amount.style,children:"금액"})]});let d=null;return r==="purchase"?d=e.jsxs(e.Fragment,{children:[e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${s.remark.className}`,style:s.remark.style,children:"비고"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${s.link.className}`,style:s.link.style,children:"링크"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${s.paymentSchedule.className}`,style:s.paymentSchedule.style,children:"지출예정일"})]}):r==="receipt"?d=e.jsxs(e.Fragment,{children:[e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${s.remark.className}`,style:s.remark.style,children:"비고"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${s.projectVendor.className}`,style:s.projectVendor.style,children:"PJ업체"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${s.projectItem.className}`,style:s.projectItem.style,children:"PJ ITEM"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${s.salesOrderNumber.className}`,style:s.salesOrderNumber.style,children:"수주번호"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${s.paymentSchedule.className}`,style:s.paymentSchedule.style,children:"지출예정일"})]}):d=e.jsxs(e.Fragment,{children:[e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${s.remark.className}`,style:s.remark.style,children:"비고"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${s.link.className}`,style:s.link.style,children:"링크"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${s.projectVendor.className}`,style:s.projectVendor.style,children:"PJ업체"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${s.projectItem.className}`,style:s.projectItem.style,children:"PJ ITEM"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${s.salesOrderNumber.className}`,style:s.salesOrderNumber.style,children:"수주번호"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${s.paymentSchedule.className}`,style:s.paymentSchedule.style,children:"지출예정일"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${s.status.className}`,style:s.status.style,children:"상태"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${s.receipt.className}`,style:s.receipt.style,children:"입고"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${s.paymentStatus.className}`,style:s.paymentStatus.style,children:"결제"})]}),e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[r==="purchase"&&e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${s.purchaseStatus.className}`,style:s.purchaseStatus.style,children:"구매상태"}),r==="receipt"&&e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${s.receiptProgress.className}`,style:s.receiptProgress.style,children:"입고진행"}),y,d]})})},[r]);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:block w-full",children:e.jsx("div",{className:"overflow-x-auto border rounded-lg",style:{maxWidth:"calc(100vw - 4rem)"},children:e.jsxs("table",{className:"w-full min-w-fit",children:[_,e.jsx("tbody",{children:t.map(y=>e.jsx(dt,{purchase:y,onClick:q,activeTab:r},y.id))})]})})}),e.jsx("div",{className:"hidden sm:block md:hidden w-full",children:e.jsx("div",{className:"overflow-x-auto border rounded-lg",children:e.jsxs("table",{className:"w-full min-w-[800px] text-[11px]",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-2 font-medium text-gray-900 w-[100px]",children:"발주요청번호"}),e.jsx("th",{className:"text-left p-2 font-medium text-gray-900 w-[80px]",children:"요청자"}),e.jsx("th",{className:"text-left p-2 font-medium text-gray-900 w-[120px]",children:"업체"}),e.jsx("th",{className:"text-left p-2 font-medium text-gray-900",children:"품명"}),e.jsx("th",{className:"text-right p-2 font-medium text-gray-900 w-[90px]",children:"금액"}),e.jsx("th",{className:"text-center p-2 font-medium text-gray-900 w-[80px]",children:"상태"})]})}),e.jsx("tbody",{children:t.map(y=>e.jsxs("tr",{className:"border-b hover:bg-gray-50 cursor-pointer",onClick:()=>q(y),children:[e.jsx("td",{className:"p-2 font-medium",children:y.purchase_order_number||"-"}),e.jsx("td",{className:"p-2",children:y.requester_name}),e.jsx("td",{className:"p-2 truncate",title:y.vendor_name,children:y.vendor_name}),e.jsx("td",{className:"p-2 truncate",title:y.item_name,children:y.item_name||"-"}),e.jsx("td",{className:"p-2 text-right font-medium",children:y.amount_value?.toLocaleString()||y.total_amount?.toLocaleString()||0}),e.jsx("td",{className:"p-2 text-center",children:e.jsx(he,{purchase:y})})]},y.id))})]})})}),e.jsx("div",{className:"sm:hidden space-y-3",children:t.map(y=>e.jsx(Ee,{purchase:y,onClick:()=>q(y)},y.id))}),e.jsx(zt,{purchaseId:u,isOpen:k,onClose:b,currentUserRoles:a,activeTab:r,onRefresh:p,onDelete:y=>{F(y),D(!0)}}),e.jsx(as,{open:$,onOpenChange:D,children:e.jsxs(et,{children:[e.jsxs(tt,{children:[e.jsx(at,{children:"발주요청 내역 삭제"}),e.jsxs(rt,{children:["발주요청번호 ",m?.purchase_order_number,"를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."]})]}),e.jsxs(st,{children:[e.jsx(nt,{children:"취소"}),e.jsx(lt,{onClick:C,className:"bg-red-600 hover:bg-red-700",children:"삭제"})]})]})})]})});mt.displayName="FastPurchaseTable";function is({isOpen:t,onClose:r,purchase:a,isAdmin:p,onUpdate:u}){const[S,k]=i.useState(a.items||[]),[v,$]=i.useState(!1),D=ee(),m=()=>{$(!0),k([...a.items||[]])},F=()=>{$(!1),k(a.items||[])},N=(d,c,g)=>{const j=[...S];j[d]={...j[d],[c]:c==="quantity"||c==="unit_price_value"||c==="amount_value"?Number(g):g},(c==="quantity"||c==="unit_price_value")&&(j[d].amount_value=j[d].quantity*j[d].unit_price_value),k(j)},q=()=>{const d={line_number:S.length+1,item_name:"",specification:"",quantity:0,unit_price_value:0,amount_value:0,remark:"",is_received:!1};k([...S,d])},b=d=>{const c=S.filter((g,j)=>j!==d);c.forEach((g,j)=>{g.line_number=j+1}),k(c)},C=async()=>{try{await D.from("purchase_request_items").delete().eq("purchase_request_id",a.id);const d=S.map(j=>({purchase_request_id:a.id,purchase_order_number:a.purchase_order_number,line_number:j.line_number,item_name:j.item_name,specification:j.specification,quantity:j.quantity,unit_price_value:j.unit_price_value,amount_value:j.amount_value,remark:j.remark,link:j.link,is_received:j.is_received||!1,delivery_status:j.delivery_status||"pending"})),{error:c}=await D.from("purchase_request_items").insert(d);if(c)throw c;const g=S.reduce((j,z)=>j+z.amount_value,0);await D.from("purchase_requests").update({total_amount:g}).eq("id",a.id),E.success("품목이 수정되었습니다."),$(!1),u(),r()}catch{E.error("저장 중 오류가 발생했습니다.")}},_=v?S:a.items||[],y=_.reduce((d,c)=>d+(c.amount_value||0),0);return e.jsx(Se,{open:t,onOpenChange:r,children:e.jsxs(ke,{className:"w-full max-w-[95vw] sm:max-w-6xl max-h-[80vh] overflow-hidden flex flex-col bg-white",children:[e.jsx(De,{className:"flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Ce,{className:"text-xl font-bold",children:["발주 상세 항목 - ",a.purchase_order_number]}),e.jsxs("div",{className:"flex items-center gap-2",children:[p&&!v&&e.jsxs(A,{variant:"outline",size:"sm",onClick:m,children:[e.jsx(Ae,{className:"h-4 w-4 mr-1"}),"편집"]}),v&&e.jsxs(e.Fragment,{children:[e.jsxs(A,{variant:"outline",size:"sm",onClick:q,children:[e.jsx(ue,{className:"h-4 w-4 mr-1"}),"품목 추가"]}),e.jsxs(A,{variant:"default",size:"sm",onClick:C,children:[e.jsx(Pe,{className:"h-4 w-4 mr-1"}),"저장"]}),e.jsx(A,{variant:"ghost",size:"sm",onClick:F,children:"취소"})]}),e.jsx(A,{variant:"ghost",size:"icon",onClick:r,className:"h-6 w-6",children:e.jsx(ve,{className:"h-4 w-4"})})]})]})}),e.jsxs("div",{className:"flex-shrink-0 grid grid-cols-2 md:grid-cols-4 gap-4 py-4 border-b",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"업체명"}),e.jsx("p",{className:"font-medium",children:a.vendor_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"요청자"}),e.jsx("p",{className:"font-medium",children:a.requester_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"프로젝트"}),e.jsx("p",{className:"font-medium truncate",title:a.project_vendor,children:a.project_vendor})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"납기일"}),e.jsx("p",{className:"font-medium",children:a.delivery_request_date&&Ct(new Date(a.delivery_request_date),"yyyy-MM-dd")})]})]}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsxs(qt,{children:[e.jsx(At,{className:"sticky top-0 bg-white z-10",children:e.jsxs(ye,{children:[e.jsx(H,{className:"w-12",children:"No."}),e.jsx(H,{children:"품목"}),e.jsx(H,{children:"규격"}),e.jsx(H,{className:"text-right",children:"수량"}),e.jsx(H,{className:"text-right",children:"단가"}),e.jsx(H,{className:"text-right",children:"금액"}),e.jsx(H,{children:"입고상태"}),e.jsx(H,{children:"비고"}),v&&e.jsx(H,{className:"w-20",children:"삭제"})]})}),e.jsx(Pt,{children:_.map((d,c)=>e.jsxs(ye,{children:[e.jsx(J,{className:"font-medium",children:d.line_number||c+1}),e.jsx(J,{children:v?e.jsx(P,{value:d.item_name,onChange:g=>N(c,"item_name",g.target.value),className:"h-8 text-sm"}):e.jsx("div",{className:"sm:max-w-[200px]",children:e.jsx("p",{className:"font-medium truncate",title:d.item_name,children:d.item_name})})}),e.jsx(J,{children:v?e.jsx(P,{value:d.specification,onChange:g=>N(c,"specification",g.target.value),className:"h-8 text-sm"}):e.jsx("div",{className:"sm:max-w-[150px] truncate",title:d.specification,children:d.specification})}),e.jsx(J,{className:"text-right",children:v?e.jsx(P,{type:"number",value:d.quantity,onChange:g=>N(c,"quantity",g.target.value),className:"h-8 text-sm text-right"}):e.jsx("span",{className:"font-medium",children:d.quantity.toLocaleString()})}),e.jsx(J,{className:"text-right",children:v?e.jsx(P,{type:"number",value:d.unit_price_value,onChange:g=>N(c,"unit_price_value",g.target.value),className:"h-8 text-sm text-right"}):e.jsxs("span",{children:[d.unit_price_value.toLocaleString()," ",a.currency]})}),e.jsx(J,{className:"text-right",children:v?e.jsx(P,{type:"number",value:d.amount_value,onChange:g=>N(c,"amount_value",g.target.value),className:"h-8 text-sm text-right font-medium"}):e.jsxs("span",{className:"font-medium",children:[d.amount_value.toLocaleString()," ",a.currency]})}),e.jsx(J,{children:d.is_received?e.jsx(w,{className:"bg-green-100 text-green-800",children:"입고완료"}):e.jsx(w,{variant:"outline",children:"대기"})}),e.jsx(J,{children:v?e.jsx(P,{value:d.remark||"",onChange:g=>N(c,"remark",g.target.value),className:"h-8 text-sm",placeholder:"비고"}):e.jsx("div",{className:"sm:max-w-[150px]",children:e.jsx("span",{className:"text-sm text-gray-500 truncate block",title:d.remark,children:d.remark||"-"})})}),v&&e.jsx(J,{children:e.jsx(A,{variant:"ghost",size:"icon",onClick:()=>b(c),className:"h-8 w-8 text-red-500 hover:text-red-700",children:e.jsx(pe,{className:"h-4 w-4"})})})]},d.id||c))})]})}),e.jsxs("div",{className:"flex-shrink-0 border-t pt-4 flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["총 ",_.length,"개 품목"]}),e.jsxs("div",{className:"text-lg font-bold",children:["총 금액: ",y.toLocaleString()," ",a.currency]})]})]})})}const cs=[{key:"pending",label:"승인대기"},{key:"purchase",label:"구매 현황"},{key:"receipt",label:"입고 현황"},{key:"done",label:"전체 항목"}];function vs({onEmailToggle:t,showEmailButton:r=!0}){const a=Nt();ee();const[p,u]=i.useState(null),[S,k]=i.useState({}),[v,$]=i.useState(null),[D,m]=i.useState(!1),{purchases:F,vendors:N,employees:q,loading:b,currentUserRoles:C,currentUserName:_,refreshPurchases:y}=Tt(),d=C?.includes("app_admin"),{activeTab:c,searchTerm:g,vendorFilter:j,dateFromFilter:z,dateToFilter:O,selectedEmployee:te,purchaseNumberFilter:W,itemNameFilter:R,approvalStatusFilter:T,setActiveTab:Z,setSearchTerm:V,setVendorFilter:re,setDateFromFilter:L,setDateToFilter:se,setSelectedEmployee:M,setPurchaseNumberFilter:G,setItemNameFilter:K,setApprovalStatusFilter:U,filteredPurchases:B,tabCounts:h}=Lt(F,C,_);return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"발주요청 관리"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"발주요청서를 관리하고 승인 처리를 할 수 있습니다"})]}),e.jsxs(A,{onClick:()=>a("/purchase/new"),className:"mt-4 sm:mt-0 bg-hansl-500 hover:bg-hansl-600",children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"새 발주요청 작성"]})]}),e.jsxs(ge,{className:"mb-4 border border-gray-200",children:[e.jsx(It,{className:"bg-white border-b border-gray-200 py-3",children:e.jsxs(Et,{className:"flex items-center text-gray-900 text-sm font-medium",children:[e.jsx(Wt,{className:"w-4 h-4 mr-2"}),"검색 필터"]})}),e.jsx(Ne,{className:"py-3",children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 2xl:grid-cols-8 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"시작일"}),e.jsx(P,{type:"date",value:z,onChange:n=>L(n.target.value),className:"text-sm h-9"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"종료일"}),e.jsx(P,{type:"date",value:O,onChange:n=>se(n.target.value),className:"text-sm h-9"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"요청자"}),e.jsxs(ie,{value:te||_||"all",onValueChange:n=>M(n==="all"?"":n),children:[e.jsx(ce,{className:"h-9 text-sm",children:e.jsx(de,{placeholder:_||"선택"})}),e.jsxs(me,{children:[e.jsx(X,{value:"all",children:"전체"}),q.filter(n=>n.full_name&&n.full_name.trim()!=="").sort((n,o)=>(n.full_name||"").localeCompare(o.full_name||"")).map(n=>e.jsxs(X,{value:n.full_name||"",children:[n.full_name,n.full_name===_&&" (나)"]},n.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"업체"}),e.jsxs(ie,{value:j||"all",onValueChange:n=>re(n==="all"?"":n),children:[e.jsx(ce,{className:"h-9 text-sm",children:e.jsx(de,{placeholder:"전체"})}),e.jsxs(me,{children:[e.jsx(X,{value:"all",children:"전체"}),N.map(n=>e.jsx(X,{value:n.vendor_name,children:n.vendor_name},n.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"발주번호"}),e.jsx(P,{placeholder:"번호",value:W,onChange:n=>G(n.target.value),className:"text-sm h-9"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"품명"}),e.jsx(P,{placeholder:"품명",value:R,onChange:n=>K(n.target.value),className:"text-sm h-9"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"승인상태"}),e.jsxs(ie,{value:T||"all",onValueChange:n=>U(n==="all"?"":n),children:[e.jsx(ce,{className:"h-9 text-sm",children:e.jsx(de,{placeholder:"전체"})}),e.jsxs(me,{children:[e.jsx(X,{value:"all",children:"전체"}),e.jsx(X,{value:"pending",children:"대기"}),e.jsx(X,{value:"approved",children:"승인"}),e.jsx(X,{value:"rejected",children:"반려"})]})]})]}),e.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"통합검색"}),e.jsxs("div",{className:"relative",children:[e.jsx(Dt,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 w-3 h-3 text-gray-400"}),e.jsx(P,{placeholder:"검색...",value:g,onChange:n=>V(n.target.value),className:"pl-7 text-sm h-9"})]})]})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex space-x-1 bg-gray-50 p-1 rounded-lg border border-gray-200",children:cs.map(n=>e.jsxs("button",{onClick:()=>Z(n.key),className:`flex-1 flex items-center justify-center space-x-2 py-2.5 px-4 rounded-md text-sm font-medium transition-colors ${c===n.key?"text-hansl-600 bg-white shadow-sm border border-gray-200":"text-gray-600 bg-transparent hover:text-gray-900 hover:bg-white/50"}`,children:[e.jsx("span",{children:n.label}),e.jsx(w,{variant:"secondary",className:`text-xs ${c===n.key?"bg-hansl-50 text-hansl-700":"bg-gray-100 text-gray-600"}`,children:h[n.key]})]},n.key))}),e.jsx(ge,{className:"overflow-hidden border border-gray-200",children:e.jsx(Ne,{className:"p-0",children:b?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-hansl-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"로딩 중..."})]}):B.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(xe,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"발주요청서가 없습니다"}),e.jsx("p",{className:"text-gray-600",children:"새로운 발주요청서를 작성해보세요."})]}):e.jsx(mt,{purchases:B,activeTab:c,currentUserRoles:C,onRefresh:y})})})]}),v&&e.jsx(is,{isOpen:D,onClose:()=>{m(!1),$(null)},purchase:v,isAdmin:d||!1,onUpdate:y})]})}export{vs as default};
//# sourceMappingURL=PurchaseListMain-CTlTTTrz.js.map
