import{c as ue,r as i,a as ee,l as ne,j as e,F as xt,b as pt,B as F,U as ut,X as ve,d as we,e as ht,f as gt,g as yt,h as Q,i as be,u as Nt}from"./index-BA_gFQ-Z.js";import{t as I,B as w}from"./index-CFkfiXwO.js";import{I as q,P as he,D as Se,e as ke,f as De,g as Ce,j as $e,R as jt,k as ft,W as _t,C as vt,T as wt,l as bt,m as qe,O as St,n as kt,S as ie,a as ce,b as me,c as de,d as X}from"./dialog-B0amFztA.js";import{P as xe,C as oe,f as Dt}from"./format-DvJHaB9Z.js";import{T as pe,E as Ct,a as $t,b as qt,c as ye,d as B,e as At,f as H,C as Ne,g as Pt,h as Ft,i as je,S as It}from"./card-BGBaK9_2.js";import{S as Ae}from"./save-CJQ4cFIz.js";/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],fe=ue("circle-x",Et);/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ot=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Wt=ue("funnel",Ot);/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Pe=ue("pen",Mt),Tt=()=>{const[t,r]=i.useState([]),[a,u]=i.useState([]),[p,S]=i.useState([]),[k,v]=i.useState(!0),[$,D]=i.useState([]),[m,E]=i.useState(""),j=ee();i.useEffect(()=>{(async()=>{try{const[C,_,g]=await Promise.all([j.from("vendors").select("id, vendor_name").order("vendor_name"),j.from("employees").select("id, name, email").order("name"),j.auth.getUser()]);if(C.error)throw C.error;if(u(C.data||[]),_.error)throw _.error;if(S(_.data||[]),g.data.user&&!g.error){let{data:d}=await j.from("employees").select("*").eq("id",g.data.user.id).maybeSingle();if(!d&&g.data.user.email&&(d=(await j.from("employees").select("*").eq("email",g.data.user.email).maybeSingle()).data),d){let c=[];d.purchase_role&&(Array.isArray(d.purchase_role)?c=d.purchase_role.map(y=>String(y).trim()):c=String(d.purchase_role).split(",").map(f=>f.trim()).filter(f=>f.length>0)),D(c),E(d.name||"")}}}catch(C){ne.error("초기 데이터 로드 실패",C)}})()},[]);const P=i.useCallback(async()=>{v(!0);try{const{data:{user:b},error:C}=await j.auth.getUser();if(C||!b){ne.error("사용자 인증 실패",C),I.error("로그인이 필요합니다."),v(!1);return}const{data:_,error:g}=await j.from("purchase_requests").select(`
          *,
          vendors (
            vendor_name,
            vendor_payment_schedule
          ),
          vendor_contacts (
            contact_name
          ),
          purchase_request_items (
            item_name,
            specification,
            quantity,
            unit_price_value,
            amount_value,
            remark,
            line_number,
            link
          )
        `).order("request_date",{ascending:!1}).limit(2e3);if(g)throw g;const d=(_||[]).map(c=>{const y=c.purchase_request_items?.[0]||{};return{id:Number(c.id),purchase_order_number:c.purchase_order_number,request_date:c.request_date,delivery_request_date:c.delivery_request_date,progress_type:c.progress_type,payment_completed_at:c.payment_completed_at,payment_category:c.payment_category,currency:c.currency,request_type:c.request_type,vendor:c.vendors||null,vendor_name:c.vendors?.vendor_name||"",vendor_payment_schedule:c.vendors?.vendor_payment_schedule||"",vendor_contacts:c.vendor_contacts||[],requester_name:c.requester_name,item_name:y.item_name||"",specification:y.specification||"",quantity:Number(y.quantity)||0,unit_price_value:Number(y.unit_price_value)||0,amount_value:Number(y.amount_value)||0,remark:y.remark||"",project_vendor:c.project_vendor,sales_order_number:c.sales_order_number,project_item:c.project_item,line_number:Number(y.line_number)||1,contact_name:c.vendor_contacts?.contact_name||"",middle_manager_status:c.middle_manager_status,final_manager_status:c.final_manager_status,is_received:!!c.is_received,received_at:c.received_at,is_payment_completed:!!c.is_payment_completed,is_po_download:!!c.is_po_download,link:y.link,items:c.purchase_request_items||[],total_amount:c.purchase_request_items?.reduce((f,z)=>f+(Number(z.amount_value)||0),0)||0,purchase_status:c.purchase_status||"pending"}});r(d)}catch(b){ne.error("발주 목록 로드 실패",b),I.error("발주 목록을 불러올 수 없습니다.")}finally{v(!1)}},[]);return i.useEffect(()=>{P()},[P]),{purchases:t,vendors:a,employees:p,loading:k,currentUserRoles:$,currentUserName:m,refreshPurchases:P}};function Rt(t,r=500){const[a,u]=i.useState(t);return i.useEffect(()=>{const p=setTimeout(()=>{u(t)},r);return()=>{clearTimeout(p)}},[t,r]),a}const Lt=["정현웅","정희웅"],zt=(t,r,a)=>{const u=ee(),[p,S]=i.useState("pending"),[k,v]=i.useState(""),[$,D]=i.useState(""),[m,E]=i.useState(""),[j,P]=i.useState(""),[b,C]=i.useState(""),[_,g]=i.useState(""),[d,c]=i.useState(""),[y,f]=i.useState(""),z=new Date().getFullYear(),O=new Date(z,0,1).toISOString().split("T")[0],te=new Date().toISOString().split("T")[0],[W,R]=i.useState(O),[M,Z]=i.useState(te),V=Rt(k,300),se=r?.includes("app_admin")||r?.includes("final_approver"),L=l=>!a||se||l==="done"?"all":a;i.useEffect(()=>{if(!a)return;const l=L(p);E(l)},[p,a,se]);const ae=i.useMemo(()=>r.includes("purchase_manager")||r.includes("app_admin")?t:t.filter(l=>!Lt.includes(l.requester_name)),[t,r]),T=i.useMemo(()=>ae.filter(l=>{const o=l.request_date?l.request_date.split("T")[0]:"",n=!W||o>=W,A=!M||o<=M;return n&&A}),[ae,W,M]),Y=i.useMemo(()=>T.filter(l=>{switch(p){case"pending":return["pending","대기","",null].includes(l.final_manager_status);case"purchase":{const o=l.payment_category==="구매 요청",n=!l.is_payment_completed;if(!o||!n)return!1;const A=(l.progress_type||"").includes("선진행"),le=l.final_manager_status==="approved";return A||le}case"receipt":{const o=!l.is_received,n=(l.progress_type||"").includes("선진행")||l.final_manager_status==="approved";return o&&n}case"done":return!0;default:return!0}}),[T,p]),G=i.useMemo(()=>!m||m==="all"||m==="전체"?Y:Y.filter(l=>l.requester_name===m),[Y,m]),U=i.useMemo(()=>$?G.filter(l=>l.vendor_name===$):G,[G,$]),K=i.useMemo(()=>{let l=U;if(j){const o=j.trim().toLowerCase();l=l.filter(n=>n.purchase_order_number?.toLowerCase().includes(o))}if(b){const o=b.trim().toLowerCase();l=l.filter(n=>n.items&&n.items.length>0?n.items.some(A=>A.item_name?.toLowerCase().includes(o)):!1)}if(_){const o=_.trim().toLowerCase();l=l.filter(n=>n.items&&n.items.length>0?n.items.some(A=>A.specification?.toLowerCase().includes(o)):!1)}if(d&&d!=="all"&&(l=l.filter(o=>{switch(d){case"pending":return!o.final_manager_status||o.final_manager_status==="pending"||o.final_manager_status==="대기";case"approved":return o.final_manager_status==="approved";case"rejected":return o.final_manager_status==="rejected"||o.middle_manager_status==="rejected";default:return!0}})),y){const o=y.trim().toLowerCase();l=l.filter(n=>n.items&&n.items.length>0?n.items.some(A=>A.remark?.toLowerCase().includes(o)):!1)}return l},[U,j,b,_,d,y]),h=i.useMemo(()=>{if(!V)return K;const l=V.trim().toLowerCase();return K.filter(o=>o.purchase_order_number?.toLowerCase().includes(l)||o.vendor_name?.toLowerCase().includes(l)||o.requester_name?.toLowerCase().includes(l)||o.project_vendor?.toLowerCase().includes(l)?!0:o.items&&o.items.length>0?o.items.some(n=>n.item_name&&n.item_name.toLowerCase().includes(l)||n.specification&&n.specification.toLowerCase().includes(l)):!1)},[K,V]),N=i.useMemo(()=>[...h].sort((l,o)=>{const n=l.request_date?new Date(l.request_date).getTime():0;return(o.request_date?new Date(o.request_date).getTime():0)-n}),[h]),x=i.useMemo(()=>{const l=o=>new Set(o.map(n=>n.purchase_order_number)).size;return{pending:l(T.filter(o=>["pending","대기","",null].includes(o.final_manager_status))),purchase:l(T.filter(o=>{const n=o.payment_category==="구매 요청",A=!o.is_payment_completed;if(!n||!A)return!1;const le=(o.progress_type||"").includes("선진행"),ot=o.final_manager_status==="approved";return le||ot})),receipt:l(T.filter(o=>{const n=!o.is_received,A=(o.progress_type||"").includes("선진행")||o.final_manager_status==="approved";return n&&A})),done:l(T)}},[T]);return i.useEffect(()=>{(async()=>{const{data:{user:l}}=await u.auth.getUser();if(!l)return;const{data:o}=await u.from("user_preferences").select("period_start, period_end").eq("user_id",l.id).single();if(o){const n=o.period_start?new Date(o.period_start).toISOString().split("T")[0]:O,A=o.period_end?new Date(o.period_end).toISOString().split("T")[0]:te;R(n),Z(A)}})()},[]),i.useEffect(()=>{(async()=>{const{data:{user:l}}=await u.auth.getUser();l&&(!W||!M||await u.from("user_preferences").upsert({user_id:l.id,period_start:W,period_end:M,updated_at:new Date().toISOString()}))})()},[W,M]),{activeTab:p,searchTerm:k,vendorFilter:$,dateFromFilter:W,dateToFilter:M,selectedEmployee:m,purchaseNumberFilter:j,itemNameFilter:b,specificationFilter:_,approvalStatusFilter:d,remarkFilter:y,setActiveTab:S,setSearchTerm:v,setVendorFilter:D,setDateFromFilter:R,setDateToFilter:Z,setSelectedEmployee:E,setPurchaseNumberFilter:P,setItemNameFilter:C,setSpecificationFilter:g,setApprovalStatusFilter:c,setRemarkFilter:f,filteredPurchases:N,tabCounts:x}};function Vt({purchaseId:t,isOpen:r,onClose:a,embedded:u=!1,currentUserRoles:p=[],activeTab:S,onRefresh:k,onDelete:v}){const[$,D]=i.useState(!1),[m,E]=i.useState(null),[j,P]=i.useState(!1),[b,C]=i.useState(null),[_,g]=i.useState([]),[d,c]=i.useState([]),y=ee(),f=p.includes("final_approver")||p.includes("app_admin")||p.includes("ceo"),z=f,O=p.includes("final_approver")||p.includes("app_admin")||p.includes("ceo"),te=p.includes("middle_manager")||p.includes("app_admin")||p.includes("ceo"),W=p.includes("final_approver")||p.includes("app_admin")||p.includes("ceo");i.useEffect(()=>{t&&r&&R(t.toString())},[t,r]);const R=async h=>{try{D(!0);const N=ee(),{data:x,error:l}=await N.from("purchase_requests").select(`
          *,
          vendors(id, vendor_name),
          purchase_request_items(*)
        `).eq("id",h).single();if(l)throw l;if(x){const o={...x,items:x.purchase_request_items||[],vendor:x.vendors||{id:0,vendor_name:"알 수 없음"},vendor_contacts:[]};E(o),C(o),g(o.items||[])}}catch{I.error("발주 상세 정보를 불러오는데 실패했습니다.")}finally{D(!1)}},M=()=>m?m.is_received?e.jsx(w,{className:"bg-green-100 text-green-800",children:"입고완료"}):m.middle_manager_status==="approved"&&m.final_manager_status==="approved"?e.jsx(w,{className:"bg-hansl-100 text-hansl-800",children:"구매진행"}):m.middle_manager_status==="rejected"||m.final_manager_status==="rejected"?e.jsx(w,{className:"bg-red-100 text-red-800",children:"반려"}):e.jsx(w,{className:"bg-yellow-100 text-yellow-800",children:"승인대기"}):null,Z=h=>h?new Date(h).toLocaleDateString("ko-KR"):"-",V=h=>new Intl.NumberFormat("ko-KR").format(h),se=async()=>{if(!(!m||!b))try{const h=_.reduce((x,l)=>x+(l.amount_value||0),0),{error:N}=await y.from("purchase_requests").update({purchase_order_number:b.purchase_order_number,requester_name:b.requester_name,vendor_name:b.vendor?.vendor_name||b.vendor_name,delivery_request_date:b.delivery_request_date,request_date:b.request_date,payment_category:b.payment_category,project_vendor:b.project_vendor,total_amount:h,updated_at:new Date().toISOString()}).eq("id",m.id);if(N)throw N;if(d.length>0){const{error:x}=await y.from("purchase_request_items").delete().in("id",d);if(x)throw x}for(const x of _)if(x.id){const{error:l}=await y.from("purchase_request_items").update({item_name:x.item_name,specification:x.specification,quantity:x.quantity,unit_price_value:x.unit_price_value,amount_value:x.amount_value,remark:x.remark,updated_at:new Date().toISOString()}).eq("id",x.id);if(l)throw l}else{const{error:l}=await y.from("purchase_request_items").insert({purchase_request_id:m.id,item_name:x.item_name,specification:x.specification,quantity:x.quantity,unit_price_value:x.unit_price_value,amount_value:x.amount_value,remark:x.remark,line_number:x.line_number||_.indexOf(x)+1,created_at:new Date().toISOString()});if(l)throw l}I.success("발주 내역이 수정되었습니다."),P(!1),c([]),k?.(),await R(t?.toString()||"")}catch{I.error("저장 중 오류가 발생했습니다.")}},L=(h,N,x)=>{const l=[..._];if(N==="amount_value")l[h]={...l[h],amount_value:x};else if(N==="quantity"||N==="unit_price_value"){const o=N==="quantity"?x:l[h].quantity,n=N==="unit_price_value"?x:l[h].unit_price_value;l[h]={...l[h],[N]:x,amount_value:o*n}}else l[h]={...l[h],[N]:x};g(l)},ae=()=>{const h={item_name:"",specification:"",quantity:1,unit_price_value:0,amount_value:0,remark:"",line_number:_.length+1};g([..._,h])},T=h=>{const N=_[h];N.id&&c([...d,N.id]);const x=_.filter((l,o)=>o!==h);g(x)},Y=async(h,N)=>{if(!O){I.error("입고 처리 권한이 없습니다.");return}try{const{error:x}=await y.from("purchase_request_items").update({is_received:N,delivery_status:N?"received":"pending",received_quantity:N&&m?.items?.find(l=>l.id===h)?.quantity||0,received_at:N?new Date().toISOString():null}).eq("id",h);if(x)throw x;I.success(N?"입고 처리되었습니다.":"입고가 취소되었습니다."),t&&await R(t.toString()),k?.()}catch{I.error("입고 처리 중 오류가 발생했습니다.")}},G=async h=>{if(m)try{const N=h==="middle"?{middle_manager_status:"approved"}:{final_manager_status:"approved"},{error:x}=await y.from("purchase_requests").update(N).eq("id",m.id);if(x)throw x;I.success(`${h==="middle"?"중간":"최종"} 승인이 완료되었습니다.`),k?.(),await R(t?.toString()||"")}catch{I.error("승인 처리 중 오류가 발생했습니다.")}},U=async h=>{if(!(!m||!window.prompt("반려 사유를 입력해주세요:")))try{const x=h==="middle"?{middle_manager_status:"rejected"}:{final_manager_status:"rejected"},{error:l}=await y.from("purchase_requests").update(x).eq("id",m.id);if(l)throw l;I.success(`${h==="middle"?"중간":"최종"} 반려가 완료되었습니다.`),k?.(),await R(t?.toString()||"")}catch{I.error("반려 처리 중 오류가 발생했습니다.")}},K=e.jsx(e.Fragment,{children:$?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-hansl-600"})}):m?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold mb-3 flex items-center",children:[e.jsx(xt,{className:"w-4 h-4 mr-2"}),"기본 정보"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"요청자"}),e.jsx("p",{className:"font-medium",children:m.requester_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"요청일"}),e.jsx("p",{className:"font-medium",children:Z(m.request_date)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"입고요청일"}),e.jsx("p",{className:"font-medium",children:Z(m.delivery_request_date)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"결제유형"}),e.jsx("p",{className:"font-medium",children:m.payment_category||"-"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold mb-3 flex items-center",children:[e.jsx(pt,{className:"w-4 h-4 mr-2"}),"업체 정보"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"업체명"}),e.jsx("p",{className:"font-medium",children:m.vendor?.vendor_name||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"프로젝트 업체"}),e.jsx("p",{className:"font-medium",children:m.project_vendor||"-"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold mb-3 flex items-center",children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"품목 리스트"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-white",children:e.jsxs("tr",{children:[O&&S==="receipt"&&e.jsx("th",{className:"px-3 py-2 text-center text-xs font-medium text-gray-500",children:"입고"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500",children:"품명"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500",children:"규격"}),e.jsx("th",{className:"px-3 py-2 text-center text-xs font-medium text-gray-500",children:"수량"}),e.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-gray-500",children:"단가"}),e.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-gray-500",children:"금액"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500",children:"비고"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:(j?_:m.items)?.map((h,N)=>e.jsxs("tr",{children:[O&&S==="receipt"&&e.jsx("td",{className:"px-3 py-2 text-center",children:e.jsx("div",{className:"flex items-center justify-center",children:h.is_received||h.delivery_status==="received"?e.jsxs("button",{onClick:()=>Y(h.id,!1),className:"flex items-center gap-1 px-2 py-1 text-xs bg-green-100 text-green-800 rounded-md hover:bg-green-200 transition-colors",disabled:!O,children:[e.jsx(oe,{className:"w-3 h-3"}),"입고완료"]}):e.jsxs("button",{onClick:()=>Y(h.id,!0),className:"flex items-center gap-1 px-2 py-1 text-xs bg-gray-100 text-gray-600 rounded-md hover:bg-gray-200 transition-colors",disabled:!O,children:[e.jsx(xe,{className:"w-3 h-3"}),"미입고"]})})}),e.jsx("td",{className:"px-3 py-2",children:j?e.jsx(q,{value:h.item_name,onChange:x=>L(N,"item_name",x.target.value),className:"text-sm"}):e.jsx("span",{className:"text-sm",children:h.item_name})}),e.jsx("td",{className:"px-3 py-2",children:j?e.jsx(q,{value:h.specification,onChange:x=>L(N,"specification",x.target.value),className:"text-sm"}):e.jsx("span",{className:"text-sm",children:h.specification})}),e.jsx("td",{className:"px-3 py-2 text-center",children:j?e.jsx(q,{type:"number",value:h.quantity,onChange:x=>L(N,"quantity",Number(x.target.value)),className:"text-sm text-center w-20 mx-auto"}):e.jsx("span",{className:"text-sm",children:h.quantity})}),e.jsx("td",{className:"px-3 py-2 text-right",children:j?e.jsx(q,{type:"number",value:h.unit_price_value,onChange:x=>L(N,"unit_price_value",Number(x.target.value)),className:"text-sm text-right"}):e.jsxs("span",{className:"text-sm",children:[V(h.unit_price_value)," ",m.currency]})}),e.jsx("td",{className:"px-3 py-2 text-right",children:j?e.jsx(q,{type:"number",value:h.amount_value,onChange:x=>L(N,"amount_value",Number(x.target.value)),className:"text-sm text-right"}):e.jsxs("span",{className:"text-sm",children:[V(h.amount_value)," ",m.currency]})}),e.jsx("td",{className:"px-3 py-2",children:j?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{value:h.remark||"",onChange:x=>L(N,"remark",x.target.value),className:"text-sm"}),e.jsx(F,{size:"sm",variant:"ghost",onClick:()=>T(N),className:"text-red-600 hover:bg-red-50",children:e.jsx(pe,{className:"w-4 h-4"})})]}):e.jsx("span",{className:"text-sm",children:h.remark||"-"})})]},N))}),e.jsx("tfoot",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:O&&S==="receipt"?5:4,className:"px-3 py-2 text-sm font-semibold text-right",children:"총액"}),e.jsxs("td",{className:"px-3 py-2 text-sm font-semibold text-right",children:[V((j?_:m.items)?.reduce((h,N)=>h+(N.amount_value||0),0)||0)," ",m.currency]}),e.jsx("td",{})]})})]})}),j&&e.jsxs(F,{size:"sm",variant:"outline",onClick:ae,className:"w-full mt-2",children:[e.jsx(he,{className:"w-4 h-4 mr-1"}),"항목 추가"]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold mb-3 flex items-center",children:[e.jsx(ut,{className:"w-4 h-4 mr-2"}),"승인 정보"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"중간승인"}),e.jsx(w,{variant:m.middle_manager_status==="approved"?"default":"secondary",className:m.middle_manager_status==="approved"?"bg-green-100 text-green-800":m.middle_manager_status==="rejected"?"bg-red-100 text-red-800":"",children:m.middle_manager_status==="approved"?"승인":m.middle_manager_status==="rejected"?"반려":"대기"})]}),!j&&te&&m.middle_manager_status!=="approved"&&m.middle_manager_status!=="rejected"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(F,{size:"sm",onClick:()=>G("middle"),className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(oe,{className:"w-4 h-4 mr-1"}),"승인"]}),e.jsxs(F,{size:"sm",variant:"outline",onClick:()=>U("middle"),className:"text-red-600 hover:bg-red-50",children:[e.jsx(fe,{className:"w-4 h-4 mr-1"}),"반려"]})]})]})}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"최종승인"}),e.jsx(w,{variant:m.final_manager_status==="approved"?"default":"secondary",className:m.final_manager_status==="approved"?"bg-green-100 text-green-800":m.final_manager_status==="rejected"?"bg-red-100 text-red-800":"",children:m.final_manager_status==="approved"?"승인":m.final_manager_status==="rejected"?"반려":"대기"})]}),!j&&W&&m.middle_manager_status==="approved"&&m.final_manager_status!=="approved"&&m.final_manager_status!=="rejected"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(F,{size:"sm",onClick:()=>G("final"),className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(oe,{className:"w-4 h-4 mr-1"}),"승인"]}),e.jsxs(F,{size:"sm",variant:"outline",onClick:()=>U("final"),className:"text-red-600 hover:bg-red-50",children:[e.jsx(fe,{className:"w-4 h-4 mr-1"}),"반려"]})]})]})})]})]})]}):e.jsx("div",{className:"text-center py-12 text-gray-500",children:"발주 정보를 불러올 수 없습니다."})});return u?K:e.jsx(Se,{open:r,onOpenChange:a,children:e.jsxs(ke,{className:"w-full max-w-[95vw] sm:max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(De,{children:e.jsxs(Ce,{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xl font-bold",children:j?"발주 내역 수정":"발주 상세 정보"}),m&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["#",m.purchase_order_number]}),!j&&M(),!j&&f&&e.jsxs(e.Fragment,{children:[e.jsxs(F,{size:"sm",variant:"outline",onClick:()=>P(!0),className:"text-blue-600 hover:bg-blue-50",children:[e.jsx(Pe,{className:"w-4 h-4 mr-1"}),"수정"]}),z&&v&&e.jsxs(F,{size:"sm",variant:"outline",onClick:()=>v(m),className:"text-red-600 hover:bg-red-50",children:[e.jsx(pe,{className:"w-4 h-4 mr-1"}),"삭제"]})]}),j&&e.jsxs(e.Fragment,{children:[e.jsxs(F,{size:"sm",variant:"outline",onClick:()=>{P(!1),C(m),g(m.items||[]),c([])},children:[e.jsx(ve,{className:"w-4 h-4 mr-1"}),"취소"]}),e.jsxs(F,{size:"sm",onClick:se,className:"bg-hansl-600 hover:bg-hansl-700 text-white",children:[e.jsx(Ae,{className:"w-4 h-4 mr-1"}),"저장"]})]})]})]})}),K]})})}const Bt=t=>{if(!t)return"-";const r=new Date(t);return`${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")}`},Ht=t=>{if(!t.items||t.items.length===0)return{received:0,total:0,percentage:0};const r=t.items.length,a=t.items.filter(p=>p.is_received||p.delivery_status==="received").length,u=r>0?Math.round(a/r*100):0;return{received:a,total:r,percentage:u}},Fe=i.memo(({purchase:t})=>{const r=t.is_received?"completed":t.middle_manager_status==="approved"&&t.final_manager_status==="approved"?"inProgress":t.middle_manager_status==="rejected"||t.final_manager_status==="rejected"?"rejected":"pending",a={completed:{text:"입고완료",className:"bg-green-100 text-green-800"},inProgress:{text:"구매진행",className:"bg-hansl-100 text-hansl-800"},rejected:{text:"반려",className:"bg-red-100 text-red-800"},pending:{text:"승인대기",className:"bg-yellow-100 text-yellow-800"}},{text:u,className:p}=a[r];return e.jsx(w,{className:`${p} text-xs`,children:u})});Fe.displayName="StatusBadge";const Ie=i.memo(({purchase:t,onClick:r})=>{const a=Ht(t),u=t.progress_type==="선진행"||t.progress_type?.includes("선진행");return e.jsxs("div",{className:`bg-white rounded-lg border p-4 space-y-3 cursor-pointer transition-all hover:shadow-md ${u?"border-red-400 bg-red-50 hover:bg-red-100":"hover:bg-gray-50"}`,onClick:()=>r(t),children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[u?e.jsx(w,{className:"bg-red-500 text-white font-bold text-xs px-2 py-0.5",children:"선진행"}):e.jsx(w,{className:"bg-gray-200 text-gray-700 text-xs px-2 py-0.5",children:"일반"}),e.jsx("span",{className:"font-semibold text-sm text-gray-900",children:t.purchase_order_number||"-"})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[Bt(t.request_date)," 요청"]})]}),e.jsx(Fe,{purchase:t})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"요청자"}),e.jsx("span",{className:"font-medium",children:t.requester_name})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"업체"}),e.jsx("span",{className:"font-medium",children:t.vendor_name})]}),t.project_vendor&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"PJ업체"}),e.jsx("span",{className:"font-medium truncate max-w-[150px]",children:t.project_vendor})]}),t.project_item&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"PJ ITEM"}),e.jsx("span",{className:"font-medium truncate max-w-[150px]",children:t.project_item})]}),t.sales_order_number&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"수주번호"}),e.jsx("span",{className:"font-medium truncate max-w-[150px]",children:t.sales_order_number})]}),t.item_name&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"품목"}),e.jsx("span",{className:"font-medium truncate max-w-[150px]",children:t.item_name})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"금액"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[(t.amount_value||t.total_amount)?.toLocaleString()," ",t.currency]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"입고현황"}),e.jsxs("span",{className:"text-gray-700",children:[a.received,"/",a.total," (",a.percentage,"%)"]})]}),e.jsx("div",{className:"bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${a.percentage===100?"bg-green-500":a.percentage>0?"bg-hansl-500":"bg-gray-300"}`,style:{width:`${a.percentage}%`}})})]}),t.is_payment_completed!==void 0&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"결제"}),t.is_payment_completed?e.jsx(w,{className:"bg-green-100 text-green-800 text-xs",children:"완료"}):e.jsx(w,{className:"bg-gray-100 text-gray-800 text-xs",children:"대기"})]}),e.jsx("div",{className:"pt-2 border-t",children:e.jsxs("div",{className:"flex items-center justify-center text-xs text-gray-500",children:[e.jsx(Ct,{className:"w-3 h-3 mr-1"}),"클릭하여 상세보기"]})})]})});Ie.displayName="MobilePurchaseCard";var Ee="AlertDialog",[Jt,gs]=ht(Ee,[$e]),J=$e(),Oe=t=>{const{__scopeAlertDialog:r,...a}=t,u=J(r);return e.jsx(jt,{...u,...a,modal:!0})};Oe.displayName=Ee;var Yt="AlertDialogTrigger",Gt=i.forwardRef((t,r)=>{const{__scopeAlertDialog:a,...u}=t,p=J(a);return e.jsx(kt,{...p,...u,ref:r})});Gt.displayName=Yt;var Kt="AlertDialogPortal",We=t=>{const{__scopeAlertDialog:r,...a}=t,u=J(r);return e.jsx(ft,{...u,...a})};We.displayName=Kt;var Xt="AlertDialogOverlay",Me=i.forwardRef((t,r)=>{const{__scopeAlertDialog:a,...u}=t,p=J(a);return e.jsx(St,{...p,...u,ref:r})});Me.displayName=Xt;var re="AlertDialogContent",[Qt,Zt]=Jt(re),Ut=yt("AlertDialogContent"),Te=i.forwardRef((t,r)=>{const{__scopeAlertDialog:a,children:u,...p}=t,S=J(a),k=i.useRef(null),v=we(r,k),$=i.useRef(null);return e.jsx(_t,{contentName:re,titleName:Re,docsSlug:"alert-dialog",children:e.jsx(Qt,{scope:a,cancelRef:$,children:e.jsxs(vt,{role:"alertdialog",...S,...p,ref:v,onOpenAutoFocus:gt(p.onOpenAutoFocus,D=>{D.preventDefault(),$.current?.focus({preventScroll:!0})}),onPointerDownOutside:D=>D.preventDefault(),onInteractOutside:D=>D.preventDefault(),children:[e.jsx(Ut,{children:u}),e.jsx(ts,{contentRef:k})]})})})});Te.displayName=re;var Re="AlertDialogTitle",Le=i.forwardRef((t,r)=>{const{__scopeAlertDialog:a,...u}=t,p=J(a);return e.jsx(wt,{...p,...u,ref:r})});Le.displayName=Re;var ze="AlertDialogDescription",Ve=i.forwardRef((t,r)=>{const{__scopeAlertDialog:a,...u}=t,p=J(a);return e.jsx(bt,{...p,...u,ref:r})});Ve.displayName=ze;var es="AlertDialogAction",Be=i.forwardRef((t,r)=>{const{__scopeAlertDialog:a,...u}=t,p=J(a);return e.jsx(qe,{...p,...u,ref:r})});Be.displayName=es;var He="AlertDialogCancel",Je=i.forwardRef((t,r)=>{const{__scopeAlertDialog:a,...u}=t,{cancelRef:p}=Zt(He,a),S=J(a),k=we(r,p);return e.jsx(qe,{...S,...u,ref:k})});Je.displayName=He;var ts=({contentRef:t})=>{const r=`\`${re}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${re}\` by passing a \`${ze}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${re}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return i.useEffect(()=>{document.getElementById(t.current?.getAttribute("aria-describedby"))||console.warn(r)},[r,t]),null},ss=Oe,as=We,Ye=Me,Ge=Te,Ke=Be,Xe=Je,Qe=Le,Ze=Ve;const rs=ss,ls=as,Ue=i.forwardRef(({className:t,...r},a)=>e.jsx(Ye,{className:Q("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...r,ref:a}));Ue.displayName=Ye.displayName;const et=i.forwardRef(({className:t,...r},a)=>e.jsxs(ls,{children:[e.jsx(Ue,{}),e.jsx(Ge,{ref:a,className:Q("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...r})]}));et.displayName=Ge.displayName;const tt=({className:t,...r})=>e.jsx("div",{className:Q("flex flex-col space-y-2 text-center sm:text-left",t),...r});tt.displayName="AlertDialogHeader";const st=({className:t,...r})=>e.jsx("div",{className:Q("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...r});st.displayName="AlertDialogFooter";const at=i.forwardRef(({className:t,...r},a)=>e.jsx(Qe,{ref:a,className:Q("text-lg font-semibold",t),...r}));at.displayName=Qe.displayName;const rt=i.forwardRef(({className:t,...r},a)=>e.jsx(Ze,{ref:a,className:Q("text-sm text-muted-foreground",t),...r}));rt.displayName=Ze.displayName;const lt=i.forwardRef(({className:t,...r},a)=>e.jsx(Ke,{ref:a,className:Q(be(),t),...r}));lt.displayName=Ke.displayName;const nt=i.forwardRef(({className:t,...r},a)=>e.jsx(Xe,{ref:a,className:Q(be({variant:"outline"}),"mt-2 sm:mt-0",t),...r}));nt.displayName=Xe.displayName;const ge=i.memo(({purchase:t})=>{const r=t.is_received?"completed":t.middle_manager_status==="approved"&&t.final_manager_status==="approved"?"inProgress":t.middle_manager_status==="rejected"||t.final_manager_status==="rejected"?"rejected":"pending",a={completed:{text:"입고완료",className:"bg-green-100 text-green-800"},inProgress:{text:"구매진행",className:"bg-hansl-100 text-hansl-800"},rejected:{text:"반려",className:"bg-red-100 text-red-800"},pending:{text:"승인대기",className:"bg-yellow-100 text-yellow-800"}},{text:u,className:p}=a[r];return e.jsx(w,{className:p,children:u})});ge.displayName="StatusBadge";const it=i.memo(({purchase:t})=>t.is_received||t.items&&t.items.length>0&&t.items.every(a=>a.is_received===!0||a.delivery_status==="received"||a.delivery_status==="completed")?e.jsx(w,{className:"bg-gray-100 text-gray-600 text-xs",children:"구매완료"}):e.jsx(w,{className:"bg-yellow-100 text-yellow-800 text-xs",children:"진행중"}));it.displayName="PurchaseStatusBadge";const s={approvalStatus:{style:{width:"100px",minWidth:"100px",maxWidth:"100px"},className:"text-center"},purchaseOrderNumber:{style:{width:"160px",minWidth:"160px",maxWidth:"160px",paddingLeft:"8px"},className:""},paymentCategory:{style:{width:"100px",minWidth:"100px",maxWidth:"100px"},className:"text-center"},requesterName:{style:{width:"80px",minWidth:"80px",maxWidth:"80px"},className:""},requestDate:{style:{width:"90px",minWidth:"90px",maxWidth:"90px"},className:""},vendorName:{style:{width:"140px",minWidth:"140px",maxWidth:"140px"},className:""},contactName:{style:{width:"80px",minWidth:"80px",maxWidth:"80px"},className:""},deliveryRequestDate:{style:{width:"100px",minWidth:"100px",maxWidth:"100px"},className:""},itemName:{style:{width:"250px",minWidth:"250px",maxWidth:"250px"},className:""},specification:{style:{width:"300px",minWidth:"300px",maxWidth:"300px"},className:""},quantity:{style:{width:"70px",minWidth:"70px",maxWidth:"70px"},className:"text-center"},unitPrice:{style:{width:"100px",minWidth:"100px",maxWidth:"100px"},className:"text-right"},amount:{style:{width:"120px",minWidth:"120px",maxWidth:"120px"},className:"text-right"},remark:{style:{width:"150px",minWidth:"150px",maxWidth:"150px"},className:""},paymentSchedule:{style:{width:"100px",minWidth:"100px",maxWidth:"100px"},className:""},purchaseStatus:{style:{width:"100px",minWidth:"100px",maxWidth:"100px"},className:"text-center"},projectVendor:{style:{width:"140px",minWidth:"140px",maxWidth:"140px"},className:""},salesOrderNumber:{style:{width:"120px",minWidth:"120px",maxWidth:"120px"},className:""},projectItem:{style:{width:"150px",minWidth:"150px",maxWidth:"150px"},className:""},receiptProgress:{style:{width:"100px",minWidth:"100px",maxWidth:"100px"},className:"text-center"},status:{style:{width:"90px",minWidth:"90px",maxWidth:"90px"},className:"text-center"},receipt:{style:{width:"90px",minWidth:"90px",maxWidth:"90px"},className:"text-center"},paymentStatus:{style:{width:"80px",minWidth:"80px",maxWidth:"80px"},className:"text-center"},link:{style:{width:"100px",minWidth:"100px",maxWidth:"100px"},className:""}},ct=i.memo(({purchase:t})=>{const r=t.middle_manager_status==="approved",a=t.middle_manager_status==="rejected",u=t.final_manager_status==="approved",p=t.final_manager_status==="rejected";return a||p?e.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[e.jsx("div",{className:"flex items-center gap-0.5",children:e.jsx("div",{className:"w-1.5 h-1.5 bg-red-500 rounded-full animate-pulse"})}),e.jsx(w,{className:"bg-red-100 text-red-800 text-xs font-medium px-1.5 py-0",children:"반려"})]}):r&&u?e.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[e.jsx("div",{className:"flex items-center gap-0.5",children:e.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"})}),e.jsx(w,{className:"bg-green-100 text-green-800 text-xs font-medium px-1.5 py-0",children:"승인완료"})]}):r&&!u&&!p?e.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),e.jsx("div",{className:"w-3 h-0.5 bg-gray-300"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full"})]}),e.jsx(w,{className:"bg-yellow-100 text-yellow-800 text-xs font-medium px-1.5 py-0",children:"1차 승인"})]}):e.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full"}),e.jsx("div",{className:"w-3 h-0.5 bg-gray-300"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full"})]}),e.jsx(w,{className:"bg-gray-100 text-gray-600 text-xs font-medium px-1.5 py-0",children:"승인대기"})]})});ct.displayName="ApprovalStatusBadge";const ns=t=>{if(t.is_received)return{received:1,total:1,percentage:100};if(!t.items||t.items.length===0)return{received:0,total:1,percentage:0};const r=t.items.length,a=t.items.filter(p=>p.is_received===!0||p.delivery_status==="received"||p.delivery_status==="completed").length,u=r>0?Math.round(a/r*100):0;return{received:a,total:r,percentage:u}},_e=t=>{if(!t)return"-";const r=new Date(t);return`${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")}`},is=i.memo(({type:t})=>t==="선진행"||t?.includes("선진행")?e.jsx(w,{className:"bg-red-500 text-white font-bold text-xs px-2 py-0.5",children:"선진행"}):e.jsx(w,{className:"bg-gray-200 text-gray-700 text-xs px-2 py-0.5",children:"일반"}));is.displayName="ProgressTypeBadge";const mt=i.memo(({purchase:t,onClick:r,activeTab:a})=>{const u=ns(t),p=t.progress_type==="선진행"||t.progress_type?.includes("선진행");return e.jsxs("tr",{className:`border-b hover:bg-gray-100 cursor-pointer transition-colors ${p?"bg-red-50 hover:bg-red-100":""}`,onClick:()=>r(t),children:[a==="pending"&&e.jsx("td",{className:`p-2 sm:p-3 whitespace-nowrap ${s.approvalStatus.className}`,style:s.approvalStatus.style,children:e.jsx(ct,{purchase:t})}),a==="purchase"&&e.jsx("td",{className:`p-2 sm:p-3 whitespace-nowrap ${s.purchaseStatus.className}`,style:s.purchaseStatus.style,children:e.jsx(it,{purchase:t})}),a==="receipt"&&e.jsx("td",{className:`p-2 sm:p-3 ${s.receiptProgress.className}`,style:s.receiptProgress.style,children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:e.jsx("div",{className:`h-1.5 rounded-full ${u.percentage===100?"bg-green-500":u.percentage>0?"bg-hansl-500":"bg-gray-300"}`,style:{width:`${u.percentage}%`}})}),e.jsxs("span",{className:"text-xs text-gray-600",children:[u.percentage,"%"]})]})}),e.jsx("td",{className:`p-2 sm:p-3 font-medium text-xs whitespace-nowrap ${s.purchaseOrderNumber.className}`,style:s.purchaseOrderNumber.style,children:e.jsx("span",{className:"block truncate",title:t.purchase_order_number||"",children:t.purchase_order_number||"-"})}),(a==="pending"||a==="receipt"||a==="done"||!a)&&e.jsx("td",{className:`p-2 sm:p-3 text-xs whitespace-nowrap ${s.paymentCategory.className}`,style:s.paymentCategory.style,children:e.jsx(w,{className:`text-xs ${t.payment_category==="구매 요청"?"bg-blue-100 text-blue-800":t.payment_category==="경비 청구"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:t.payment_category||"-"})}),e.jsx("td",{className:`p-2 sm:p-3 text-xs whitespace-nowrap ${s.requesterName.className}`,style:s.requesterName.style,children:e.jsx("span",{className:"block truncate",title:t.requester_name||"",children:t.requester_name||"-"})}),e.jsx("td",{className:`p-2 sm:p-3 text-xs whitespace-nowrap ${s.requestDate.className}`,style:s.requestDate.style,children:_e(t.request_date)}),e.jsx("td",{className:`p-2 sm:p-3 text-xs ${s.vendorName.className}`,style:s.vendorName.style,children:e.jsx("span",{className:"block truncate",title:t.vendor_name||"",children:t.vendor_name||"-"})}),e.jsx("td",{className:`p-2 sm:p-3 text-xs whitespace-nowrap ${s.contactName.className}`,style:s.contactName.style,children:e.jsx("span",{className:"block truncate",title:t.contact_name||"",children:t.contact_name||"-"})}),e.jsx("td",{className:`p-2 sm:p-3 text-xs whitespace-nowrap ${s.deliveryRequestDate.className}`,style:s.deliveryRequestDate.style,children:_e(t.delivery_request_date)}),e.jsx("td",{className:`p-2 sm:p-3 text-xs ${s.itemName.className}`,style:s.itemName.style,children:e.jsx("span",{className:"block truncate",title:t.item_name||"",children:t.item_name||"-"})}),e.jsx("td",{className:`p-2 sm:p-3 text-xs ${s.specification.className}`,style:s.specification.style,children:e.jsx("span",{className:"block truncate",title:t.specification||"",children:t.specification||"-"})}),e.jsx("td",{className:`p-2 sm:p-3 text-xs whitespace-nowrap ${s.quantity.className}`,style:s.quantity.style,children:t.quantity||0}),e.jsx("td",{className:`p-2 sm:p-3 text-xs whitespace-nowrap ${s.unitPrice.className}`,style:s.unitPrice.style,children:t.unit_price_value?.toLocaleString()||0}),e.jsx("td",{className:`p-2 sm:p-3 text-xs font-medium whitespace-nowrap ${s.amount.className}`,style:s.amount.style,children:t.amount_value?.toLocaleString()||t.total_amount?.toLocaleString()||0}),a==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:`p-2 sm:p-3 text-xs ${s.remark.className}`,style:s.remark.style,children:e.jsx("span",{className:"block truncate",title:t.remark||"",children:t.remark||"-"})}),e.jsx("td",{className:`p-2 sm:p-3 text-xs ${s.projectVendor.className}`,style:s.projectVendor.style,children:e.jsx("span",{className:"block truncate",title:t.project_vendor||"",children:t.project_vendor||"-"})}),e.jsx("td",{className:`p-2 sm:p-3 text-xs ${s.projectItem.className}`,style:s.projectItem.style,children:e.jsx("span",{className:"block truncate",title:t.project_item||"",children:t.project_item||"-"})}),e.jsx("td",{className:`p-2 sm:p-3 text-xs whitespace-nowrap ${s.salesOrderNumber.className}`,style:s.salesOrderNumber.style,children:e.jsx("span",{className:"block truncate",title:t.sales_order_number||"",children:t.sales_order_number||"-"})})]}),a==="purchase"&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:`p-2 sm:p-3 text-xs ${s.remark.className}`,style:s.remark.style,children:e.jsx("span",{className:"block truncate",title:t.remark||"",children:t.remark||"-"})}),e.jsx("td",{className:`p-2 sm:p-3 text-xs ${s.link.className}`,style:s.link.style,children:t.link?e.jsx("a",{href:t.link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline truncate block",title:t.link,children:"링크 보기"}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:`p-2 sm:p-3 text-xs whitespace-nowrap ${s.paymentSchedule.className}`,style:s.paymentSchedule.style,children:e.jsx("span",{className:"block truncate",title:t.vendor_payment_schedule||"",children:t.vendor_payment_schedule||"-"})})]}),a==="receipt"&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:`p-2 sm:p-3 text-xs ${s.remark.className}`,style:s.remark.style,children:e.jsx("span",{className:"block truncate",title:t.remark||"",children:t.remark||"-"})}),e.jsx("td",{className:`p-2 sm:p-3 text-xs ${s.projectVendor.className}`,style:s.projectVendor.style,children:e.jsx("span",{className:"block truncate",title:t.project_vendor||"",children:t.project_vendor||"-"})}),e.jsx("td",{className:`p-2 sm:p-3 text-xs ${s.projectItem.className}`,style:s.projectItem.style,children:e.jsx("span",{className:"block truncate",title:t.project_item||"",children:t.project_item||"-"})}),e.jsx("td",{className:`p-2 sm:p-3 text-xs whitespace-nowrap ${s.salesOrderNumber.className}`,style:s.salesOrderNumber.style,children:e.jsx("span",{className:"block truncate",title:t.sales_order_number||"",children:t.sales_order_number||"-"})}),e.jsx("td",{className:`p-2 sm:p-3 text-xs whitespace-nowrap ${s.paymentSchedule.className}`,style:s.paymentSchedule.style,children:e.jsx("span",{className:"block truncate",title:t.vendor_payment_schedule||"",children:t.vendor_payment_schedule||"-"})})]}),(a==="done"||!a)&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:`p-2 sm:p-3 text-xs ${s.remark.className}`,style:s.remark.style,children:e.jsx("span",{className:"block truncate",title:t.remark||"",children:t.remark||"-"})}),e.jsx("td",{className:`p-2 sm:p-3 text-xs ${s.link.className}`,style:s.link.style,children:t.link?e.jsx("a",{href:t.link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline truncate block",title:t.link,children:"링크 보기"}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:`p-2 sm:p-3 text-xs ${s.projectVendor.className}`,style:s.projectVendor.style,children:e.jsx("span",{className:"block truncate",title:t.project_vendor||"",children:t.project_vendor||"-"})}),e.jsx("td",{className:`p-2 sm:p-3 text-xs ${s.projectItem.className}`,style:s.projectItem.style,children:e.jsx("span",{className:"block truncate",title:t.project_item||"",children:t.project_item||"-"})}),e.jsx("td",{className:`p-2 sm:p-3 text-xs whitespace-nowrap ${s.salesOrderNumber.className}`,style:s.salesOrderNumber.style,children:e.jsx("span",{className:"block truncate",title:t.sales_order_number||"",children:t.sales_order_number||"-"})}),e.jsx("td",{className:`p-2 sm:p-3 text-xs whitespace-nowrap ${s.paymentSchedule.className}`,style:s.paymentSchedule.style,children:e.jsx("span",{className:"block truncate",title:t.vendor_payment_schedule||"",children:t.vendor_payment_schedule||"-"})}),e.jsx("td",{className:`p-2 sm:p-3 ${s.status.className}`,style:s.status.style,children:e.jsx(ge,{purchase:t})}),e.jsx("td",{className:`p-2 sm:p-3 ${s.receipt.className}`,style:s.receipt.style,children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:e.jsx("div",{className:`h-1.5 rounded-full ${u.percentage===100?"bg-green-500":u.percentage>0?"bg-hansl-500":"bg-gray-300"}`,style:{width:`${u.percentage}%`}})}),e.jsxs("span",{className:"text-xs text-gray-600",children:[u.percentage,"%"]})]})}),e.jsx("td",{className:`p-2 sm:p-3 ${s.paymentStatus.className}`,style:s.paymentStatus.style,children:t.is_payment_completed?e.jsx(w,{className:"bg-green-100 text-green-800 text-xs",children:"완료"}):e.jsx(w,{className:"bg-gray-100 text-gray-800 text-xs",children:"대기"})})]})]})});mt.displayName="TableRow";const dt=i.memo(({purchases:t,activeTab:r="done",currentUserRoles:a=[],onRefresh:u})=>{const[p,S]=i.useState(null),[k,v]=i.useState(!1),[$,D]=i.useState(!1),[m,E]=i.useState(null),j=ee();a.includes("final_approver")||a.includes("app_admin")||a.includes("ceo");const P=g=>{S(g.id),v(!0)},b=()=>{v(!1),S(null)},C=async()=>{if(m){try{const{error:g}=await j.from("purchase_request_items").delete().eq("purchase_request_id",m.id);if(g)throw g;const{error:d}=await j.from("purchase_requests").delete().eq("id",m.id);if(d)throw d;I.success("발주 내역이 삭제되었습니다."),u?.()}catch{I.error("삭제 중 오류가 발생했습니다.")}D(!1),E(null)}},_=i.useMemo(()=>{if(r==="pending")return e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap ${s.approvalStatus.className}`,style:s.approvalStatus.style,children:"승인상태"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap text-left ${s.purchaseOrderNumber.className}`,style:s.purchaseOrderNumber.style,children:"발주번호"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap ${s.paymentCategory.className}`,style:s.paymentCategory.style,children:"결제종류"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap text-left ${s.requesterName.className}`,style:s.requesterName.style,children:"요청자"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap text-left ${s.requestDate.className}`,style:s.requestDate.style,children:"청구일"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs text-left ${s.vendorName.className}`,style:s.vendorName.style,children:"업체"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap text-left ${s.contactName.className}`,style:s.contactName.style,children:"담당자"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap text-left ${s.deliveryRequestDate.className}`,style:s.deliveryRequestDate.style,children:"입고요청일"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs text-left ${s.itemName.className}`,style:s.itemName.style,children:"품명"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs text-left ${s.specification.className}`,style:s.specification.style,children:"규격"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap ${s.quantity.className}`,style:s.quantity.style,children:"수량"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap ${s.unitPrice.className}`,style:s.unitPrice.style,children:"단가"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap ${s.amount.className}`,style:s.amount.style,children:"금액"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap text-left ${s.remark.className}`,style:s.remark.style,children:"비고"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap text-left ${s.projectVendor.className}`,style:s.projectVendor.style,children:"PJ업체"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap text-left ${s.projectItem.className}`,style:s.projectItem.style,children:"PJ ITEM"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap text-left ${s.salesOrderNumber.className}`,style:s.salesOrderNumber.style,children:"수주번호"})]})});const g=e.jsxs(e.Fragment,{children:[e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap text-left ${s.purchaseOrderNumber.className}`,style:s.purchaseOrderNumber.style,children:"발주번호"}),(r==="receipt"||r==="done"||!r)&&e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap ${s.paymentCategory.className}`,style:s.paymentCategory.style,children:"결제종류"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap text-left ${s.requesterName.className}`,style:s.requesterName.style,children:"요청자"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap text-left ${s.requestDate.className}`,style:s.requestDate.style,children:"청구일"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap text-left ${s.vendorName.className}`,style:s.vendorName.style,children:"업체"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap text-left ${s.contactName.className}`,style:s.contactName.style,children:"담당자"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap text-left ${s.deliveryRequestDate.className}`,style:s.deliveryRequestDate.style,children:"입고요청일"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs text-left ${s.itemName.className}`,style:s.itemName.style,children:"품명"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs text-left ${s.specification.className}`,style:s.specification.style,children:"규격"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap ${s.quantity.className}`,style:s.quantity.style,children:"수량"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap ${s.unitPrice.className}`,style:s.unitPrice.style,children:"단가"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap ${s.amount.className}`,style:s.amount.style,children:"금액"})]});let d=null;return r==="purchase"?d=e.jsxs(e.Fragment,{children:[e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap text-left ${s.remark.className}`,style:s.remark.style,children:"비고"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap text-left ${s.link.className}`,style:s.link.style,children:"링크"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap text-left ${s.paymentSchedule.className}`,style:s.paymentSchedule.style,children:"결제예정"})]}):r==="receipt"?d=e.jsxs(e.Fragment,{children:[e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap text-left ${s.remark.className}`,style:s.remark.style,children:"비고"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap text-left ${s.projectVendor.className}`,style:s.projectVendor.style,children:"PJ업체"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap text-left ${s.projectItem.className}`,style:s.projectItem.style,children:"PJ ITEM"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap text-left ${s.salesOrderNumber.className}`,style:s.salesOrderNumber.style,children:"수주번호"})]}):d=e.jsxs(e.Fragment,{children:[e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap text-left ${s.remark.className}`,style:s.remark.style,children:"비고"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap text-left ${s.link.className}`,style:s.link.style,children:"링크"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap text-left ${s.projectVendor.className}`,style:s.projectVendor.style,children:"PJ업체"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap text-left ${s.projectItem.className}`,style:s.projectItem.style,children:"PJ ITEM"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap text-left ${s.salesOrderNumber.className}`,style:s.salesOrderNumber.style,children:"수주번호"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap text-left ${s.paymentSchedule.className}`,style:s.paymentSchedule.style,children:"지출예정일"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap ${s.status.className}`,style:s.status.style,children:"상태"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap ${s.receipt.className}`,style:s.receipt.style,children:"입고"}),e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap ${s.paymentStatus.className}`,style:s.paymentStatus.style,children:"결제"})]}),e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[r==="purchase"&&e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap ${s.purchaseStatus.className}`,style:s.purchaseStatus.style,children:"구매상태"}),r==="receipt"&&e.jsx("th",{className:`p-2 sm:p-3 font-medium text-gray-900 text-xs whitespace-nowrap ${s.receiptProgress.className}`,style:s.receiptProgress.style,children:"입고진행"}),g,d]})})},[r]);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:block w-full",children:e.jsx("div",{className:"overflow-x-auto border rounded-lg",style:{maxWidth:"calc(100vw - 4rem)"},children:e.jsxs("table",{className:"w-full min-w-fit",children:[_,e.jsx("tbody",{children:t.map(g=>e.jsx(mt,{purchase:g,onClick:P,activeTab:r},g.id))})]})})}),e.jsx("div",{className:"hidden sm:block md:hidden w-full",children:e.jsx("div",{className:"overflow-x-auto border rounded-lg",children:e.jsxs("table",{className:"w-full min-w-[800px] text-xs",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-2 font-medium text-gray-900 w-[100px]",children:"발주번호"}),e.jsx("th",{className:"text-left p-2 font-medium text-gray-900 w-[80px]",children:"요청자"}),e.jsx("th",{className:"text-left p-2 font-medium text-gray-900 w-[120px]",children:"업체"}),e.jsx("th",{className:"text-left p-2 font-medium text-gray-900",children:"품명"}),e.jsx("th",{className:"text-right p-2 font-medium text-gray-900 w-[90px]",children:"금액"}),e.jsx("th",{className:"text-center p-2 font-medium text-gray-900 w-[80px]",children:"상태"})]})}),e.jsx("tbody",{children:t.map(g=>e.jsxs("tr",{className:"border-b hover:bg-gray-50 cursor-pointer",onClick:()=>P(g),children:[e.jsx("td",{className:"p-2 font-medium",children:g.purchase_order_number||"-"}),e.jsx("td",{className:"p-2",children:g.requester_name}),e.jsx("td",{className:"p-2 truncate",title:g.vendor_name,children:g.vendor_name}),e.jsx("td",{className:"p-2 truncate",title:g.item_name,children:g.item_name||"-"}),e.jsx("td",{className:"p-2 text-right font-medium",children:g.amount_value?.toLocaleString()||g.total_amount?.toLocaleString()||0}),e.jsx("td",{className:"p-2 text-center",children:e.jsx(ge,{purchase:g})})]},g.id))})]})})}),e.jsx("div",{className:"sm:hidden space-y-3",children:t.map(g=>e.jsx(Ie,{purchase:g,onClick:()=>P(g)},g.id))}),e.jsx(Vt,{purchaseId:p,isOpen:k,onClose:b,currentUserRoles:a,activeTab:r,onRefresh:u,onDelete:g=>{E(g),D(!0)}}),e.jsx(rs,{open:$,onOpenChange:D,children:e.jsxs(et,{children:[e.jsxs(tt,{children:[e.jsx(at,{children:"발주 내역 삭제"}),e.jsxs(rt,{children:["발주번호 ",m?.purchase_order_number,"를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."]})]}),e.jsxs(st,{children:[e.jsx(nt,{children:"취소"}),e.jsx(lt,{onClick:C,className:"bg-red-600 hover:bg-red-700",children:"삭제"})]})]})})]})});dt.displayName="FastPurchaseTable";function cs({isOpen:t,onClose:r,purchase:a,isAdmin:u,onUpdate:p}){const[S,k]=i.useState(a.items||[]),[v,$]=i.useState(!1),D=ee(),m=()=>{$(!0),k([...a.items||[]])},E=()=>{$(!1),k(a.items||[])},j=(d,c,y)=>{const f=[...S];f[d]={...f[d],[c]:c==="quantity"||c==="unit_price_value"||c==="amount_value"?Number(y):y},(c==="quantity"||c==="unit_price_value")&&(f[d].amount_value=f[d].quantity*f[d].unit_price_value),k(f)},P=()=>{const d={line_number:S.length+1,item_name:"",specification:"",quantity:0,unit_price_value:0,amount_value:0,remark:"",is_received:!1};k([...S,d])},b=d=>{const c=S.filter((y,f)=>f!==d);c.forEach((y,f)=>{y.line_number=f+1}),k(c)},C=async()=>{try{await D.from("purchase_request_items").delete().eq("purchase_request_id",a.id);const d=S.map(f=>({purchase_request_id:a.id,purchase_order_number:a.purchase_order_number,line_number:f.line_number,item_name:f.item_name,specification:f.specification,quantity:f.quantity,unit_price_value:f.unit_price_value,amount_value:f.amount_value,remark:f.remark,link:f.link,is_received:f.is_received||!1,delivery_status:f.delivery_status||"pending"})),{error:c}=await D.from("purchase_request_items").insert(d);if(c)throw c;const y=S.reduce((f,z)=>f+z.amount_value,0);await D.from("purchase_requests").update({total_amount:y}).eq("id",a.id),I.success("품목이 수정되었습니다."),$(!1),p(),r()}catch{I.error("저장 중 오류가 발생했습니다.")}},_=v?S:a.items||[],g=_.reduce((d,c)=>d+(c.amount_value||0),0);return e.jsx(Se,{open:t,onOpenChange:r,children:e.jsxs(ke,{className:"w-full max-w-[95vw] sm:max-w-6xl max-h-[80vh] overflow-hidden flex flex-col bg-white",children:[e.jsx(De,{className:"flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Ce,{className:"text-xl font-bold",children:["발주 상세 항목 - ",a.purchase_order_number]}),e.jsxs("div",{className:"flex items-center gap-2",children:[u&&!v&&e.jsxs(F,{variant:"outline",size:"sm",onClick:m,children:[e.jsx(Pe,{className:"h-4 w-4 mr-1"}),"편집"]}),v&&e.jsxs(e.Fragment,{children:[e.jsxs(F,{variant:"outline",size:"sm",onClick:P,children:[e.jsx(he,{className:"h-4 w-4 mr-1"}),"품목 추가"]}),e.jsxs(F,{variant:"default",size:"sm",onClick:C,children:[e.jsx(Ae,{className:"h-4 w-4 mr-1"}),"저장"]}),e.jsx(F,{variant:"ghost",size:"sm",onClick:E,children:"취소"})]}),e.jsx(F,{variant:"ghost",size:"icon",onClick:r,className:"h-6 w-6",children:e.jsx(ve,{className:"h-4 w-4"})})]})]})}),e.jsxs("div",{className:"flex-shrink-0 grid grid-cols-2 md:grid-cols-4 gap-4 py-4 border-b",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"업체명"}),e.jsx("p",{className:"font-medium",children:a.vendor_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"요청자"}),e.jsx("p",{className:"font-medium",children:a.requester_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"프로젝트"}),e.jsx("p",{className:"font-medium truncate",title:a.project_vendor,children:a.project_vendor})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"납기일"}),e.jsx("p",{className:"font-medium",children:a.delivery_request_date&&Dt(new Date(a.delivery_request_date),"yyyy-MM-dd")})]})]}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsxs($t,{children:[e.jsx(qt,{className:"sticky top-0 bg-white z-10",children:e.jsxs(ye,{children:[e.jsx(B,{className:"w-12",children:"No."}),e.jsx(B,{children:"품목"}),e.jsx(B,{children:"규격"}),e.jsx(B,{className:"text-right",children:"수량"}),e.jsx(B,{className:"text-right",children:"단가"}),e.jsx(B,{className:"text-right",children:"금액"}),e.jsx(B,{children:"입고상태"}),e.jsx(B,{children:"비고"}),v&&e.jsx(B,{className:"w-20",children:"삭제"})]})}),e.jsx(At,{children:_.map((d,c)=>e.jsxs(ye,{children:[e.jsx(H,{className:"font-medium",children:d.line_number||c+1}),e.jsx(H,{children:v?e.jsx(q,{value:d.item_name,onChange:y=>j(c,"item_name",y.target.value),className:"h-8 text-sm"}):e.jsx("div",{className:"sm:max-w-[200px]",children:e.jsx("p",{className:"font-medium truncate",title:d.item_name,children:d.item_name})})}),e.jsx(H,{children:v?e.jsx(q,{value:d.specification,onChange:y=>j(c,"specification",y.target.value),className:"h-8 text-sm"}):e.jsx("div",{className:"sm:max-w-[150px] truncate",title:d.specification,children:d.specification})}),e.jsx(H,{className:"text-right",children:v?e.jsx(q,{type:"number",value:d.quantity,onChange:y=>j(c,"quantity",y.target.value),className:"h-8 text-sm text-right"}):e.jsx("span",{className:"font-medium",children:d.quantity.toLocaleString()})}),e.jsx(H,{className:"text-right",children:v?e.jsx(q,{type:"number",value:d.unit_price_value,onChange:y=>j(c,"unit_price_value",y.target.value),className:"h-8 text-sm text-right"}):e.jsxs("span",{children:[d.unit_price_value.toLocaleString()," ",a.currency]})}),e.jsx(H,{className:"text-right",children:v?e.jsx(q,{type:"number",value:d.amount_value,onChange:y=>j(c,"amount_value",y.target.value),className:"h-8 text-sm text-right font-medium"}):e.jsxs("span",{className:"font-medium",children:[d.amount_value.toLocaleString()," ",a.currency]})}),e.jsx(H,{children:d.is_received?e.jsx(w,{className:"bg-green-100 text-green-800",children:"입고완료"}):e.jsx(w,{variant:"outline",children:"대기"})}),e.jsx(H,{children:v?e.jsx(q,{value:d.remark||"",onChange:y=>j(c,"remark",y.target.value),className:"h-8 text-sm",placeholder:"비고"}):e.jsx("div",{className:"sm:max-w-[150px]",children:e.jsx("span",{className:"text-sm text-gray-500 truncate block",title:d.remark,children:d.remark||"-"})})}),v&&e.jsx(H,{children:e.jsx(F,{variant:"ghost",size:"icon",onClick:()=>b(c),className:"h-8 w-8 text-red-500 hover:text-red-700",children:e.jsx(pe,{className:"h-4 w-4"})})})]},d.id||c))})]})}),e.jsxs("div",{className:"flex-shrink-0 border-t pt-4 flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["총 ",_.length,"개 품목"]}),e.jsxs("div",{className:"text-lg font-bold",children:["총 금액: ",g.toLocaleString()," ",a.currency]})]})]})})}const ms=[{key:"pending",label:"승인대기"},{key:"purchase",label:"구매 현황"},{key:"receipt",label:"입고 현황"},{key:"done",label:"전체 항목"}];function ys({onEmailToggle:t,showEmailButton:r=!0}){const a=Nt();ee();const[u,p]=i.useState(null),[S,k]=i.useState({}),[v,$]=i.useState(null),[D,m]=i.useState(!1),{purchases:E,vendors:j,employees:P,loading:b,currentUserRoles:C,currentUserName:_,refreshPurchases:g}=Tt(),d=C?.includes("app_admin"),{activeTab:c,searchTerm:y,vendorFilter:f,dateFromFilter:z,dateToFilter:O,selectedEmployee:te,purchaseNumberFilter:W,itemNameFilter:R,specificationFilter:M,approvalStatusFilter:Z,remarkFilter:V,setActiveTab:se,setSearchTerm:L,setVendorFilter:ae,setDateFromFilter:T,setDateToFilter:Y,setSelectedEmployee:G,setPurchaseNumberFilter:U,setItemNameFilter:K,setSpecificationFilter:h,setApprovalStatusFilter:N,setRemarkFilter:x,filteredPurchases:l,tabCounts:o}=zt(E,C,_);return e.jsxs("div",{className:"w-full overflow-hidden",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4 sm:mb-6 lg:mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"발주 관리"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"발주 요청서를 관리하고 승인 처리를 할 수 있습니다"})]}),e.jsxs(F,{onClick:()=>a("/purchase/new"),className:"mt-4 sm:mt-0 bg-hansl-600 hover:bg-hansl-700",children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"새 발주 작성"]})]}),e.jsxs(Ne,{className:"mb-3 sm:mb-4 lg:mb-6",children:[e.jsx(Pt,{children:e.jsxs(Ft,{className:"flex items-center text-hansl-600",children:[e.jsx(Wt,{className:"w-5 h-5 mr-2"}),"필터"]})}),e.jsx(je,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"청구일 (시작)"}),e.jsx(q,{type:"date",value:z,onChange:n=>T(n.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"청구일 (종료)"}),e.jsx(q,{type:"date",value:O,onChange:n=>Y(n.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"요청자"}),e.jsxs(ie,{value:te||"all",onValueChange:n=>G(n==="all"?"":n),children:[e.jsx(ce,{children:e.jsx(me,{placeholder:"전체"})}),e.jsxs(de,{children:[e.jsx(X,{value:"all",children:"전체"}),P.filter(n=>n.full_name&&n.full_name.trim()!=="").sort((n,A)=>(n.full_name||"").localeCompare(A.full_name||"")).map(n=>e.jsx(X,{value:n.full_name||"",children:n.full_name},n.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"업체"}),e.jsxs(ie,{value:f||"all",onValueChange:n=>ae(n==="all"?"":n),children:[e.jsx(ce,{children:e.jsx(me,{placeholder:"전체"})}),e.jsxs(de,{children:[e.jsx(X,{value:"all",children:"전체"}),j.map(n=>e.jsx(X,{value:n.vendor_name,children:n.vendor_name},n.id))]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"발주번호"}),e.jsx(q,{placeholder:"발주번호 검색",value:W,onChange:n=>U(n.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"품명"}),e.jsx(q,{placeholder:"품명 검색",value:R,onChange:n=>K(n.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"규격"}),e.jsx(q,{placeholder:"규격 검색",value:M,onChange:n=>h(n.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"승인상태"}),e.jsxs(ie,{value:Z||"all",onValueChange:n=>N(n==="all"?"":n),children:[e.jsx(ce,{children:e.jsx(me,{placeholder:"전체"})}),e.jsxs(de,{children:[e.jsx(X,{value:"all",children:"전체"}),e.jsx(X,{value:"pending",children:"승인대기"}),e.jsx(X,{value:"approved",children:"승인완료"}),e.jsx(X,{value:"rejected",children:"반려"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"비고"}),e.jsx(q,{placeholder:"비고 검색",value:V,onChange:n=>x(n.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"통합검색"}),e.jsxs("div",{className:"relative",children:[e.jsx(It,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(q,{placeholder:"발주번호, 요청자, 프로젝트명...",value:y,onChange:n=>L(n.target.value),className:"pl-10"})]})]})]})]})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg",children:ms.map(n=>e.jsxs("button",{onClick:()=>se(n.key),className:`flex-1 flex items-center justify-center space-x-2 py-3 px-4 rounded-md text-sm font-medium ${c===n.key?"text-white bg-gradient-to-r from-hansl-600 to-hansl-500 shadow-sm":"text-gray-600 bg-transparent hover:text-gray-900 hover:bg-white/50"}`,children:[e.jsx("span",{children:n.label}),e.jsx(w,{variant:"secondary",className:`text-xs ${c===n.key?"bg-white/20 text-white":"bg-gray-200 text-gray-600"}`,children:o[n.key]})]},n.key))}),e.jsx(Ne,{className:"overflow-hidden",children:e.jsx(je,{className:"p-0",children:b?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-hansl-600 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"로딩 중..."})]}):l.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(xe,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"발주 요청서가 없습니다"}),e.jsx("p",{className:"text-gray-600",children:"새로운 발주 요청서를 작성해보세요."})]}):e.jsx(dt,{purchases:l,activeTab:c,currentUserRoles:C,onRefresh:g})})})]}),v&&e.jsx(cs,{isOpen:D,onClose:()=>{m(!1),$(null)},purchase:v,isAdmin:d||!1,onUpdate:g})]})}export{ys as default};
//# sourceMappingURL=PurchaseListMain-B-D-XFWY.js.map
