{"version":3,"file":"SupportMain-DAuYXLsE.js","sources":["../../node_modules/lucide-react/dist/esm/icons/image-plus.js","../../node_modules/lucide-react/dist/esm/icons/send.js","../../src/components/ui/date-range-picker.tsx","../../src/components/support/SupportMain.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M16 5h6\", key: \"1vod17\" }],\n  [\"path\", { d: \"M19 2v6\", key: \"4bpg5p\" }],\n  [\"path\", { d: \"M21 11.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7.5\", key: \"1ue2ih\" }],\n  [\"path\", { d: \"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21\", key: \"1xmnt7\" }],\n  [\"circle\", { cx: \"9\", cy: \"9\", r: \"2\", key: \"af1f0g\" }]\n];\nconst ImagePlus = createLucideIcon(\"image-plus\", __iconNode);\n\nexport { __iconNode, ImagePlus as default };\n//# sourceMappingURL=image-plus.js.map\n","/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z\",\n      key: \"1ffxy3\"\n    }\n  ],\n  [\"path\", { d: \"m21.854 2.147-10.94 10.939\", key: \"12cjpa\" }]\n];\nconst Send = createLucideIcon(\"send\", __iconNode);\n\nexport { __iconNode, Send as default };\n//# sourceMappingURL=send.js.map\n","import * as React from \"react\"\nimport { CalendarIcon, X } from \"lucide-react\"\nimport { DateRange } from \"react-day-picker\"\nimport { ko } from \"date-fns/locale\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Calendar } from \"@/components/ui/calendar\"\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\"\n\ninterface DateRangePickerProps extends React.HTMLAttributes<HTMLDivElement> {\n  date?: DateRange\n  onDateChange?: (date: DateRange | undefined) => void\n  placeholder?: string\n  disabled?: boolean\n  triggerClassName?: string\n}\n\nexport function DateRangePicker({\n  className,\n  date,\n  onDateChange,\n  placeholder = \"기간을 선택하세요\",\n  disabled = false,\n  triggerClassName,\n  ...props\n}: DateRangePickerProps) {\n  const [open, setOpen] = React.useState(false)\n\n  const formatDateRange = (range: DateRange | undefined) => {\n    if (!range?.from) {\n      return placeholder\n    }\n\n    const formatDate = (date: Date) => {\n      return date.toLocaleDateString('ko-KR', {\n        year: 'numeric',\n        month: 'long',\n        day: 'numeric'\n      })\n    }\n\n    if (range.from && range.to) {\n      // 같은 달인지 확인\n      const isSameMonth = range.from.getFullYear() === range.to.getFullYear() && \n                         range.from.getMonth() === range.to.getMonth()\n      \n      if (isSameMonth) {\n        const year = range.from.getFullYear()\n        const month = range.from.toLocaleDateString('ko-KR', { month: 'long' })\n        const fromDay = range.from.getDate()\n        const toDay = range.to.getDate()\n        return `${year}년 ${month} ${fromDay}일 - ${toDay}일`\n      }\n      \n      return `${formatDate(range.from)} - ${formatDate(range.to)}`\n    }\n\n    return formatDate(range.from)\n  }\n\n  return (\n    <div className={cn(\"grid gap-2\", className)} {...props}>\n      <Popover open={open} onOpenChange={setOpen}>\n        <PopoverTrigger asChild>\n          <Button\n            id=\"date\"\n            className={cn(\n              \"button-base w-full justify-start text-left font-normal border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 transition-colors\",\n              !date && \"text-gray-500\",\n              date && \"text-gray-900\",\n              triggerClassName\n            )}\n            disabled={disabled}\n          >\n            <CalendarIcon className=\"mr-2 h-4 w-4 text-gray-400\" />\n            <span className=\"truncate\">{formatDateRange(date)}</span>\n            {date && (\n              <X \n                className=\"ml-auto h-4 w-4 text-gray-400 hover:text-gray-600 transition-colors\" \n                onClick={(e) => {\n                  e.stopPropagation()\n                  onDateChange?.(undefined)\n                  setOpen(false)\n                }}\n              />\n            )}\n          </Button>\n        </PopoverTrigger>\n        <PopoverContent className=\"w-auto p-0 shadow-lg border border-gray-200 business-radius-card\" align=\"start\">\n          <div className=\"bg-white business-radius-card overflow-hidden\">\n            <div className=\"bg-gray-50 border-b border-gray-100 px-4 py-3\">\n              <h4 className=\"text-[11px] font-semibold text-gray-900\">기간 선택</h4>\n              <p className=\"text-[10px] text-gray-500 mt-1\">시작일과 종료일을 선택하세요</p>\n            </div>\n            <div className=\"p-4\">\n              <Calendar\n                initialFocus\n                mode=\"range\"\n                defaultMonth={date?.from}\n                selected={date}\n                onSelect={(newDate) => {\n                  onDateChange?.(newDate)\n                  // 종료일이 선택되면 자동으로 팝오버 닫기\n                  if (newDate?.from && newDate?.to) {\n                    setOpen(false)\n                  }\n                }}\n                numberOfMonths={2}\n                disabled={disabled}\n                locale={ko}\n                className=\"business-radius-card\"\n                classNames={{\n                  months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n                  month: \"space-y-4\",\n                  caption: \"flex justify-center pt-1 relative items-center text-[11px] font-medium\",\n                  caption_label: \"text-[11px] font-medium text-gray-900\",\n                  nav: \"space-x-1 flex items-center\",\n                  nav_button: \"inline-flex items-center justify-center rounded-md text-[11px] font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none border border-input bg-background hover:bg-accent hover:text-accent-foreground h-6 w-6\",\n                  nav_button_previous: \"absolute left-1\",\n                  nav_button_next: \"absolute right-1\",\n                  table: \"w-full border-collapse space-y-1\",\n                  head_row: \"flex\",\n                  head_cell: \"text-gray-500 rounded-md w-7 font-normal text-[10px]\",\n                  row: \"flex w-full mt-2\",\n                  cell: \"h-7 w-7 text-center text-[11px] p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n                  day: \"inline-flex items-center justify-center rounded-md text-[11px] font-normal ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 aria-selected:opacity-100 h-7 w-7 hover:bg-gray-100 hover:text-gray-900 text-gray-900\",\n                  day_range_start: \"day-range-start bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n                  day_range_end: \"day-range-end bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n                  day_selected: \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n                  day_today: \"bg-accent text-accent-foreground font-semibold\",\n                  outside: \"!text-gray-400 !opacity-40 hover:!text-gray-500 hover:bg-gray-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30\",\n                  day_disabled: \"!text-gray-400 !opacity-40\",\n                  day_range_middle: \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n                  day_hidden: \"invisible\",\n                }}\n              />\n            </div>\n            {date && (\n              <div className=\"bg-gray-50 border-t border-gray-100 px-4 py-3\">\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"badge-text text-gray-600\">\n                    선택된 기간: {formatDateRange(date)}\n                  </span>\n                  <Button\n                    onClick={() => {\n                      onDateChange?.(undefined)\n                      setOpen(false)\n                    }}\n                    className=\"button-action-secondary\"\n                  >\n                    지우기\n                  </Button>\n                </div>\n              </div>\n            )}\n          </div>\n        </PopoverContent>\n      </Popover>\n    </div>\n  )\n}","import React, { useState, useEffect, useLayoutEffect, useRef } from 'react'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Textarea } from '@/components/ui/textarea'\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'\nimport { MessageCircle, Send, Calendar, Search, CheckCircle, Clock, AlertCircle, ChevronRight, ChevronLeft, ChevronDown, ChevronUp, Eye, X, Edit2, Trash2, Save, ImagePlus, Loader2, Plus } from 'lucide-react'\nimport { supportService, type SupportInquiry, type SupportAttachment, type SupportInquiryMessage, type SupportInquiryPayload } from '@/services/supportService'\nimport { createClient } from '@/lib/supabase/client'\nimport { toast } from 'sonner'\nimport { removePurchaseFromMemory } from '@/stores/purchaseMemoryStore'\nimport { format } from 'date-fns'\nimport { ko } from 'date-fns/locale'\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog'\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from '@/components/ui/alert-dialog'\nimport { DateRangePicker } from '@/components/ui/date-range-picker'\nimport { DatePickerPopover } from '@/components/ui/date-picker-popover'\nimport { DateRange } from 'react-day-picker'\nimport PurchaseDetailModal from '@/components/purchase/PurchaseDetailModal'\nimport ReactSelect from 'react-select'\n\ntype QuantityChangeRow = {\n  id: string\n  itemId: string\n  newQuantity: string\n}\n\ntype QuantityChangePayloadItem = {\n  item_id: string\n  line_number?: number | null\n  item_name: string\n  specification?: string | null\n  current_quantity?: number | null\n  new_quantity: number\n}\n\ntype PriceChangeType = 'unit_price' | 'amount'\n\ntype PriceChangeRow = {\n  id: string\n  itemId: string\n  changeType: PriceChangeType\n  newValue: string\n}\n\ntype PriceChangePayloadItem = {\n  item_id: string\n  line_number?: number | null\n  item_name: string\n  specification?: string | null\n  change_type: PriceChangeType\n  current_unit_price?: number | null\n  new_unit_price?: number | null\n  current_amount?: number | null\n  new_amount?: number | null\n}\n\nexport default function SupportMain() {\n  const [inquiryType, setInquiryType] = useState('')\n  const [message, setMessage] = useState('')\n  const [loading, setLoading] = useState(false)\n  \n  // 첨부파일 관련\n  const [attachments, setAttachments] = useState<SupportAttachment[]>([])\n  const [uploadingImage, setUploadingImage] = useState(false)\n  const fileInputRef = useRef<HTMLInputElement>(null)\n  const textMeasureCanvasRef = useRef<HTMLCanvasElement | null>(null)\n  \n  // 발주요청 선택 관련\n  const [showPurchaseSelect, setShowPurchaseSelect] = useState(false)\n  const [dateRange, setDateRange] = useState<DateRange | undefined>()\n  const [purchaseRequests, setPurchaseRequests] = useState<any[]>([])\n  const [selectedPurchase, setSelectedPurchase] = useState<any>(null)\n  const [searchingPurchase, setSearchingPurchase] = useState(false)\n  const [requestedDeliveryDate, setRequestedDeliveryDate] = useState<Date | undefined>()\n  const [quantityChangeRows, setQuantityChangeRows] = useState<QuantityChangeRow[]>([])\n  const [priceChangeRows, setPriceChangeRows] = useState<PriceChangeRow[]>([])\n  const purchaseLinkedInquiryTypes = ['modify', 'delete', 'delivery_date_change', 'quantity_change', 'price_change']\n  const purchaseSelectLabel = inquiryType === 'delete' ? '삭제할 발주요청 선택' : '발주요청 선택'\n  const messageLabel = inquiryType === 'delete' ? '삭제 사유' : '내용'\n\n  const createRowId = () => `row-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`\n  \n  // 문의 목록 관련\n  const [inquiries, setInquiries] = useState<SupportInquiry[]>([])\n  const [isAdmin, setIsAdmin] = useState<boolean | null>(null)\n  const [currentUserEmail, setCurrentUserEmail] = useState('')\n  const [currentUserId, setCurrentUserId] = useState<string>('')\n  const [currentUserRoles, setCurrentUserRoles] = useState<string[]>([])\n  const [loadingInquiries, setLoadingInquiries] = useState(true)\n  const [expandedInquiry, setExpandedInquiry] = useState<number | null>(null)\n  \n  // 모달 관련\n  const [showDetailModal, setShowDetailModal] = useState(false)\n  const [selectedInquiryDetail, setSelectedInquiryDetail] = useState<any>(null)\n  const [loadingDetail, setLoadingDetail] = useState(false)\n  const [editingItemId, setEditingItemId] = useState<string | null>(null)\n  const [editingItem, setEditingItem] = useState<any>(null)\n\n  // 전체항목 탭 상세모달(PurchaseDetailModal) 재사용\n  const [purchaseDetailModalOpen, setPurchaseDetailModalOpen] = useState(false)\n  const [purchaseDetailId, setPurchaseDetailId] = useState<number | null>(null)\n  const [deleteConfirmOpen, setDeleteConfirmOpen] = useState(false)\n  const [purchaseToDelete, setPurchaseToDelete] = useState<any>(null)\n  const [purchaseMissingOpen, setPurchaseMissingOpen] = useState(false)\n  const [purchaseMissingMessage, setPurchaseMissingMessage] = useState('발주내역이 삭제 되었거나 없습니다.')\n\n  // 채팅(대화) 드롭다운(확장 영역 내)\n  const [chatMessages, setChatMessages] = useState<SupportInquiryMessage[]>([])\n  const [chatLoading, setChatLoading] = useState(false)\n  const [chatRefreshing, setChatRefreshing] = useState(false)\n  const [chatText, setChatText] = useState('')\n  const [chatSending, setChatSending] = useState(false)\n  const chatScrollRef = useRef<HTMLDivElement>(null)\n  const chatScrollRestoreRef = useRef<{ atBottom: boolean; prevTop: number } | null>(null)\n  const chatFirstLoadInquiryIdRef = useRef<number | null>(null)\n  const chatForceBottomOnOpenRef = useRef(false)\n  const chatMessagesCacheRef = useRef<Map<number, SupportInquiryMessage[]>>(new Map())\n\n  // 초기 권한/목록 로드는 마운트 1회만 (드롭다운 토글로 재실행되면 깜빡임 발생)\n  useEffect(() => {\n    checkUserRole()\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  // 실시간 구독은 권한/사용자 정보가 준비된 후에만 세팅 (expandedInquiry 변화로는 재구독하지 않음)\n  useEffect(() => {\n    if (isAdmin === null) return\n    // 실시간 구독 설정\n    const subscription = supportService.subscribeToInquiries((payload) => {\n      const eventType = payload?.eventType as 'INSERT' | 'UPDATE' | 'DELETE' | undefined\n      const newRow = payload?.new as SupportInquiry | undefined\n      const oldRow = payload?.old as SupportInquiry | undefined\n\n      const isRelevantRow = (row?: SupportInquiry) => {\n        if (!row) return false\n        if (isAdmin) return true\n        return !!currentUserId && row.user_id === currentUserId\n      }\n\n      // 이벤트에 따라 inquiries state를 직접 갱신 (페이지 새로고침 없이 실시간 반영)\n      if (eventType === 'DELETE') {\n        const deletedId = oldRow?.id\n        if (!deletedId) return\n        setInquiries(prev => {\n          const next = prev.filter(i => i.id !== deletedId)\n          return next\n        })\n        if (expandedInquiry === deletedId) {\n          setExpandedInquiry(null)\n        }\n        return\n      }\n\n      // INSERT/UPDATE\n      const row = newRow\n      if (!row?.id) return\n\n      setInquiries(prev => {\n        // 비관리자는 내 문의만 유지\n        const relevant = isRelevantRow(row)\n        const idx = prev.findIndex(i => i.id === row.id)\n\n        // 관련 없는 row면 기존에 있던 것만 제거\n        if (!relevant) {\n          if (idx === -1) return prev\n          const next = prev.filter(i => i.id !== row.id)\n          return next\n        }\n\n        // upsert\n        const next = [...prev]\n        if (idx >= 0) {\n          next[idx] = row\n        } else {\n          next.unshift(row)\n        }\n\n        // 최신순 정렬 (created_at 내림차순)\n        next.sort((a, b) => {\n          const at = a.created_at ? new Date(a.created_at).getTime() : 0\n          const bt = b.created_at ? new Date(b.created_at).getTime() : 0\n          return bt - at\n        })\n        return next\n      })\n    })\n    \n    return () => {\n      subscription.unsubscribe()\n    }\n  }, [isAdmin, currentUserId])\n\n  // 사용자 권한 확인\n  const checkUserRole = async () => {\n    const supabase = createClient()\n    const { data: { user } } = await supabase.auth.getUser()\n    if (!user) return\n\n    setCurrentUserEmail(user.email || '')\n    setCurrentUserId(user.id)\n\n    const { data: employee } = await supabase\n      .from('employees')\n      .select('purchase_role')\n      .eq('email', user.email)\n      .single()\n\n    if (employee) {\n      const roles = Array.isArray(employee.purchase_role)\n        ? employee.purchase_role\n        : employee.purchase_role?.split(',').map((r: string) => r.trim()) || []\n      \n      setCurrentUserRoles(roles)\n      const adminStatus = roles.includes('app_admin')\n      setIsAdmin(adminStatus)\n      \n      // 권한 확인 후 바로 목록 로드\n      loadInquiriesWithRole(adminStatus)\n    }\n  }\n  \n  // 역할에 따라 문의 목록 로드 (내부 함수)\n  const loadInquiriesWithRole = async (adminStatus: boolean) => {\n    setLoadingInquiries(true)\n    \n    const result = adminStatus \n      ? await supportService.getAllInquiries()\n      : await supportService.getMyInquiries()\n    \n    \n    if (result.success) {\n      setInquiries(result.data)\n    } else {\n      toast.error(result.error || '문의 목록 로드 실패')\n    }\n    \n    setLoadingInquiries(false)\n  }\n\n  // 문의 목록 로드\n  const loadInquiries = async () => {\n    // 권한 확인이 완료되지 않았으면 대기\n    if (isAdmin === null) {\n      return;\n    }\n    \n    setLoadingInquiries(true)\n    \n    // 관리자면 모든 문의, 아니면 내 문의만\n    const result = isAdmin \n      ? await supportService.getAllInquiries()\n      : await supportService.getMyInquiries()\n    \n    \n    if (result.success) {\n      setInquiries(result.data)\n    } else {\n      toast.error(result.error || '문의 목록 로드 실패')\n    }\n    \n    setLoadingInquiries(false)\n  }\n\n  // 문의 유형 변경 시\n  useEffect(() => {\n    const needsPurchase = purchaseLinkedInquiryTypes.includes(inquiryType)\n    if (needsPurchase) {\n      setShowPurchaseSelect(true)\n    } else {\n      setShowPurchaseSelect(false)\n      setSelectedPurchase(null)\n    }\n\n    setRequestedDeliveryDate(undefined)\n    setQuantityChangeRows([])\n    setPriceChangeRows([])\n  }, [inquiryType])\n\n  useEffect(() => {\n    setRequestedDeliveryDate(undefined)\n    setQuantityChangeRows([])\n    setPriceChangeRows([])\n  }, [selectedPurchase?.id])\n\n  useEffect(() => {\n    if (inquiryType === 'quantity_change' && quantityChangeRows.length === 0) {\n      setQuantityChangeRows([{ id: createRowId(), itemId: '', newQuantity: '' }])\n    }\n    if (inquiryType === 'price_change' && priceChangeRows.length === 0) {\n      setPriceChangeRows([{ id: createRowId(), itemId: '', changeType: 'unit_price', newValue: '' }])\n    }\n  }, [inquiryType, quantityChangeRows.length, priceChangeRows.length])\n\n  useEffect(() => {\n    if (!showPurchaseSelect) return\n    if (!dateRange?.from || !dateRange?.to) return\n    searchPurchaseRequests()\n  }, [showPurchaseSelect, dateRange?.from, dateRange?.to])\n\n  // 발주요청 검색\n  const searchPurchaseRequests = async () => {\n    setSearchingPurchase(true)\n    \n    const startDate = dateRange?.from ? dateRange.from.toISOString().split('T')[0] : undefined\n    const endDate = dateRange?.to ? dateRange.to.toISOString().split('T')[0] : undefined\n    \n    const result = await supportService.getMyPurchaseRequests(startDate, endDate)\n    \n    if (result.success) {\n      setPurchaseRequests(result.data)\n    } else {\n      toast.error(result.error || '발주요청 조회 실패')\n    }\n    \n    setSearchingPurchase(false)\n  }\n\n  // 기본 기간: 최근 2개월\n  useEffect(() => {\n    if (!dateRange) {\n      const today = new Date()\n      const from = new Date()\n      from.setMonth(from.getMonth() - 2)\n      setDateRange({ from, to: today })\n    }\n  }, [dateRange])\n\n  const purchaseOptions = [...purchaseRequests]\n    .sort((a, b) => {\n      const aTime = a.request_date || a.created_at\n      const bTime = b.request_date || b.created_at\n      const aValue = aTime ? new Date(aTime).getTime() : 0\n      const bValue = bTime ? new Date(bTime).getTime() : 0\n      return bValue - aValue\n    })\n    .map((pr) => {\n    const orderNumber = pr.purchase_order_number || '(승인대기)'\n    const vendorName = pr.vendor_name || ''\n    const firstItem = pr.purchase_request_items?.[0]?.item_name || '품목 없음'\n    const extraCount = pr.purchase_request_items?.length > 1\n      ? ` 외 ${pr.purchase_request_items.length - 1}건`\n      : ''\n    const label = `${orderNumber} · ${vendorName} · ${firstItem}${extraCount}`.trim()\n    const searchText = `${orderNumber} ${vendorName} ${pr.requester_name || ''} ${firstItem}`.toLowerCase()\n    return {\n      value: String(pr.id),\n      label,\n      data: pr,\n      searchText\n    }\n  })\n\n  const inquiryTypeOptions = [\n    { value: 'delivery_date_change', label: '입고일 변경 요청' },\n    { value: 'quantity_change', label: '수량 변경 요청' },\n    { value: 'price_change', label: '단가/합계 금액 변경 요청' },\n    { value: 'bug', label: '오류 신고' },\n    { value: 'modify', label: '수정 요청' },\n    { value: 'delete', label: '삭제 요청' },\n    { value: 'other', label: '기타 문의' }\n  ]\n\n  const selectedPurchaseItems = Array.isArray(selectedPurchase?.purchase_request_items)\n    ? [...selectedPurchase.purchase_request_items].sort((a: any, b: any) => {\n        const aLine = a.line_number ?? Number.MAX_SAFE_INTEGER\n        const bLine = b.line_number ?? Number.MAX_SAFE_INTEGER\n        return aLine - bLine\n      })\n    : []\n  const itemOptions = selectedPurchaseItems.map((item: any) => ({\n    value: String(item.id),\n    label: `${item.line_number ? `${item.line_number}.` : ''} ${item.item_name} (${item.specification || '-'})`.trim()\n  }))\n\n  const getMeasureFont = () => {\n    if (typeof document === 'undefined') {\n      return '11px Pretendard, -apple-system, BlinkMacSystemFont, \"Segoe UI\", \"Noto Sans KR\", sans-serif'\n    }\n\n    const bodyStyle = window.getComputedStyle(document.body)\n    const fontFamily = bodyStyle.fontFamily || 'Pretendard, -apple-system, BlinkMacSystemFont, \"Segoe UI\", \"Noto Sans KR\", sans-serif'\n    const fontWeight = bodyStyle.fontWeight || '400'\n    return `${fontWeight} 11px ${fontFamily}`\n  }\n\n  const measureTextWidthPx = (text: string) => {\n    if (typeof document === 'undefined') {\n      return text.length * 7\n    }\n\n    if (!textMeasureCanvasRef.current) {\n      textMeasureCanvasRef.current = document.createElement('canvas')\n    }\n\n    const context = textMeasureCanvasRef.current.getContext('2d')\n    if (!context) {\n      return text.length * 7\n    }\n\n    context.font = getMeasureFont()\n    return Math.ceil(context.measureText(text).width)\n  }\n\n  const getLabelWidthEm = (label: string, padding = 4, min = 12) =>\n    Math.max(label.length + padding, min)\n\n  const SELECT_OPTION_PADDING_PX = 24\n  const SELECT_INDICATOR_PX = 30\n  const SELECT_SCROLLBAR_PX = 14\n  const getSelectLabelMaxPx = (options: Array<{ label?: string }>) =>\n    options.reduce((max, option) => {\n      const label = option.label ?? ''\n      return Math.max(max, measureTextWidthPx(label))\n    }, 0)\n  const getSelectControlWidthPx = (options: Array<{ label?: string }>, placeholder: string) => {\n    const maxLabelPx = getSelectLabelMaxPx(options)\n    const base = Math.max(maxLabelPx, measureTextWidthPx(placeholder))\n    return Math.ceil(base + SELECT_OPTION_PADDING_PX + SELECT_INDICATOR_PX)\n  }\n  const getMenuWidthPx = (options: Array<{ label?: string }>, placeholder: string) => {\n    const maxLabelPx = getSelectLabelMaxPx(options)\n    const base = Math.max(maxLabelPx, measureTextWidthPx(placeholder))\n    return Math.ceil(base + SELECT_OPTION_PADDING_PX + SELECT_INDICATOR_PX + SELECT_SCROLLBAR_PX)\n  }\n\n  const inquiryTypePlaceholder = '문의 유형을 선택해주세요'\n  const inquiryTypeControlWidthEm = getLabelWidthEm(inquiryTypePlaceholder, 3, 14)\n  const inquiryTypeMenuWidthEm = getLabelWidthEm(\n    inquiryTypeOptions.reduce((max, option) => {\n      const label = option.label || ''\n      return label.length > max.length ? label : max\n    }, inquiryTypePlaceholder),\n    3,\n    inquiryTypeControlWidthEm\n  )\n  const purchaseSelectPlaceholder = '발주번호 선택/검색'\n  const purchaseControlWidthPx = getSelectControlWidthPx(purchaseOptions, purchaseSelectPlaceholder)\n  const purchaseMenuWidthPx = getMenuWidthPx(purchaseOptions, purchaseSelectPlaceholder)\n\n  const itemSelectPlaceholder = '품목 선택/검색'\n  const itemControlWidthPx = getSelectControlWidthPx(itemOptions, itemSelectPlaceholder)\n  const itemMenuWidthPx = getMenuWidthPx(itemOptions, itemSelectPlaceholder)\n  const priceChangeTypeOptions = [\n    { value: 'unit_price', label: '단가' },\n    { value: 'amount', label: '합계액' }\n  ]\n\n  const formatNumericInput = (value: string) => {\n    if (!value) return ''\n    const numericValue = Number(value)\n    return Number.isFinite(numericValue) ? numericValue.toLocaleString('ko-KR') : value\n  }\n\n  const normalizeNumericInput = (value: string) => value.replace(/[^\\d]/g, '')\n\n  const dateRangeWidthEm = Math.max('발주요청 기간을 선택하세요'.length + 5, 22)\n\n  const getCompactSelectStyles = (controlWidthPx?: number, menuWidthPx?: number) => ({\n    control: (base: any) => ({\n      ...base,\n      minHeight: '28px',\n      height: '28px',\n      fontSize: '11px',\n      borderRadius: '8px',\n      borderColor: '#e5e7eb',\n      boxShadow: 'none'\n    }),\n    container: (base: any) => ({\n      ...base,\n      width: controlWidthPx ? `${controlWidthPx}px` : base.width,\n      maxWidth: '100%'\n    }),\n    valueContainer: (base: any) => ({\n      ...base,\n      padding: '0 8px'\n    }),\n    input: (base: any) => ({\n      ...base,\n      margin: 0,\n      padding: 0,\n      fontSize: '11px'\n    }),\n    indicatorsContainer: (base: any) => ({\n      ...base,\n      height: '28px'\n    }),\n    option: (base: any) => ({\n      ...base,\n      fontSize: '11px',\n      whiteSpace: 'nowrap',\n      overflow: 'visible',\n      textOverflow: 'clip'\n    }),\n    placeholder: (base: any) => ({\n      ...base,\n      fontSize: '11px',\n      color: '#9ca3af'\n    }),\n    singleValue: (base: any) => ({\n      ...base,\n      fontSize: '11px',\n      overflow: 'visible',\n      textOverflow: 'clip',\n      maxWidth: 'none'\n    }),\n    menu: (base: any) => ({\n      ...base,\n      width: menuWidthPx ? `${menuWidthPx}px` : base.width,\n      minWidth: menuWidthPx ? `${menuWidthPx}px` : base.minWidth,\n      maxWidth: menuWidthPx ? `${menuWidthPx}px` : '90vw'\n    }),\n    menuList: (base: any) => ({\n      ...base,\n      width: menuWidthPx ? `${menuWidthPx}px` : base.width,\n      minWidth: menuWidthPx ? `${menuWidthPx}px` : base.minWidth,\n      maxWidth: menuWidthPx ? `${menuWidthPx}px` : base.maxWidth\n    })\n  })\n\n  const addQuantityRow = () => {\n    setQuantityChangeRows(prev => [\n      ...prev,\n      { id: createRowId(), itemId: '', newQuantity: '' }\n    ])\n  }\n\n  const addPriceRow = () => {\n    setPriceChangeRows(prev => [\n      ...prev,\n      { id: createRowId(), itemId: '', changeType: 'unit_price', newValue: '' }\n    ])\n  }\n\n  const updateQuantityRow = (rowId: string, updates: Partial<QuantityChangeRow>) => {\n    setQuantityChangeRows(prev =>\n      prev.map(row => row.id === rowId ? { ...row, ...updates } : row)\n    )\n  }\n\n  const removeQuantityRow = (rowId: string) => {\n    setQuantityChangeRows(prev => prev.filter(row => row.id !== rowId))\n  }\n\n  const updatePriceRow = (rowId: string, updates: Partial<PriceChangeRow>) => {\n    setPriceChangeRows(prev =>\n      prev.map(row => row.id === rowId ? { ...row, ...updates } : row)\n    )\n  }\n\n  const removePriceRow = (rowId: string) => {\n    setPriceChangeRows(prev => prev.filter(row => row.id !== rowId))\n  }\n\n  // 문의 제출\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    // #region agent log\n    fetch('http://127.0.0.1:7242/ingest/b22edbac-a44c-4882-a88d-47f6cafc7628',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'SupportMain.tsx:handleSubmit:start',message:'submit_start',data:{inquiryType,messageLength:message.length,loading,uploadingImage,selectedPurchaseId:selectedPurchase?.id ?? null,showPurchaseSelect},timestamp:Date.now(),sessionId:'debug-session',runId:'pre-fix',hypothesisId:'H1'})}).catch(()=>{});\n    // #endregion\n    \n    if (!inquiryType || !message) {\n      // #region agent log\n      fetch('http://127.0.0.1:7242/ingest/b22edbac-a44c-4882-a88d-47f6cafc7628',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'SupportMain.tsx:handleSubmit:validation',message:'missing_required',data:{inquiryType,hasMessage:!!message},timestamp:Date.now(),sessionId:'debug-session',runId:'pre-fix',hypothesisId:'H2'})}).catch(()=>{});\n      // #endregion\n      toast.error('모든 필드를 입력해주세요.')\n      return\n    }\n    \n    const requiresPurchase = purchaseLinkedInquiryTypes.includes(inquiryType)\n    if (requiresPurchase && !selectedPurchase) {\n      // #region agent log\n      fetch('http://127.0.0.1:7242/ingest/b22edbac-a44c-4882-a88d-47f6cafc7628',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'SupportMain.tsx:handleSubmit:validation',message:'missing_purchase',data:{inquiryType,requiresPurchase},timestamp:Date.now(),sessionId:'debug-session',runId:'pre-fix',hypothesisId:'H2'})}).catch(()=>{});\n      // #endregion\n      toast.error('발주요청을 선택해주세요.')\n      return\n    }\n\n    setLoading(true)\n    \n    const subjectText = getInquiryTypeLabel(inquiryType) || inquiryType\n\n    // 발주 정보를 텍스트로 구성\n    let finalMessage = message;\n    let purchaseInfo = '';\n    let inquiryPayload: SupportInquiryPayload | null = null\n    const summaryLines: string[] = []\n\n    if (inquiryType === 'delivery_date_change') {\n      if (!requestedDeliveryDate) {\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/b22edbac-a44c-4882-a88d-47f6cafc7628',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'SupportMain.tsx:handleSubmit:validation',message:'missing_requested_delivery_date',data:{inquiryType},timestamp:Date.now(),sessionId:'debug-session',runId:'pre-fix',hypothesisId:'H2'})}).catch(()=>{});\n        // #endregion\n        toast.error('변경 입고일을 입력해주세요.')\n        setLoading(false)\n        return\n      }\n      const currentDateText = selectedPurchase?.delivery_request_date\n        ? format(new Date(selectedPurchase.delivery_request_date), 'yyyy-MM-dd')\n        : '-'\n      const requestedDateText = format(requestedDeliveryDate, 'yyyy-MM-dd')\n\n      inquiryPayload = {\n        requested_date: requestedDateText,\n        current_date: selectedPurchase?.delivery_request_date || null\n      }\n      summaryLines.push(`현재 입고요청일: ${currentDateText}`)\n      summaryLines.push(`변경 입고일: ${requestedDateText}`)\n    }\n\n    if (inquiryType === 'quantity_change') {\n      const activeRows = quantityChangeRows.filter(row => row.itemId || row.newQuantity.trim())\n      if (activeRows.length === 0) {\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/b22edbac-a44c-4882-a88d-47f6cafc7628',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'SupportMain.tsx:handleSubmit:validation',message:'missing_quantity_rows',data:{inquiryType,rows:quantityChangeRows.length},timestamp:Date.now(),sessionId:'debug-session',runId:'pre-fix',hypothesisId:'H2'})}).catch(()=>{});\n        // #endregion\n        toast.error('수량 변경할 품목을 추가해주세요.')\n        setLoading(false)\n        return\n      }\n\n      const itemsPayload: QuantityChangePayloadItem[] = []\n      for (const row of activeRows) {\n        if (!row.itemId || !row.newQuantity.trim()) {\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/b22edbac-a44c-4882-a88d-47f6cafc7628',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'SupportMain.tsx:handleSubmit:validation',message:'invalid_quantity_row',data:{itemId:row.itemId,hasQuantity:!!row.newQuantity.trim()},timestamp:Date.now(),sessionId:'debug-session',runId:'pre-fix',hypothesisId:'H2'})}).catch(()=>{});\n          // #endregion\n          toast.error('수량 변경 항목을 모두 입력해주세요.')\n          setLoading(false)\n          return\n        }\n        const newQuantity = Number(row.newQuantity)\n        if (!Number.isFinite(newQuantity)) {\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/b22edbac-a44c-4882-a88d-47f6cafc7628',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'SupportMain.tsx:handleSubmit:validation',message:'invalid_quantity_value',data:{value:row.newQuantity},timestamp:Date.now(),sessionId:'debug-session',runId:'pre-fix',hypothesisId:'H2'})}).catch(()=>{});\n          // #endregion\n          toast.error('변경 수량이 올바르지 않습니다.')\n          setLoading(false)\n          return\n        }\n\n        const targetItem = selectedPurchaseItems.find((item: any) => String(item.id) === row.itemId)\n        if (!targetItem) {\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/b22edbac-a44c-4882-a88d-47f6cafc7628',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'SupportMain.tsx:handleSubmit:validation',message:'missing_target_item',data:{itemId:row.itemId},timestamp:Date.now(),sessionId:'debug-session',runId:'pre-fix',hypothesisId:'H2'})}).catch(()=>{});\n          // #endregion\n          toast.error('선택한 품목을 찾을 수 없습니다.')\n          setLoading(false)\n          return\n        }\n\n        itemsPayload.push({\n          item_id: String(targetItem.id),\n          line_number: targetItem.line_number ?? null,\n          item_name: targetItem.item_name,\n          specification: targetItem.specification ?? null,\n          current_quantity: targetItem.quantity ?? null,\n          new_quantity: newQuantity\n        })\n        summaryLines.push(\n          `${targetItem.line_number ?? '-'}번 ${targetItem.item_name} (${targetItem.specification || '-'}) ` +\n          `${targetItem.quantity ?? 0} → ${newQuantity}`\n        )\n      }\n\n      inquiryPayload = { items: itemsPayload }\n    }\n\n    if (inquiryType === 'price_change') {\n      const activeRows = priceChangeRows.filter(row => row.itemId || row.newValue.trim())\n      if (activeRows.length === 0) {\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/b22edbac-a44c-4882-a88d-47f6cafc7628',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'SupportMain.tsx:handleSubmit:validation',message:'missing_price_rows',data:{inquiryType,rows:priceChangeRows.length},timestamp:Date.now(),sessionId:'debug-session',runId:'pre-fix',hypothesisId:'H2'})}).catch(()=>{});\n        // #endregion\n        toast.error('단가/합계 금액 변경할 품목을 추가해주세요.')\n        setLoading(false)\n        return\n      }\n\n      const itemsPayload: PriceChangePayloadItem[] = []\n      for (const row of activeRows) {\n        if (!row.itemId || !row.newValue.trim()) {\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/b22edbac-a44c-4882-a88d-47f6cafc7628',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'SupportMain.tsx:handleSubmit:validation',message:'invalid_price_row',data:{itemId:row.itemId,hasValue:!!row.newValue.trim(),changeType:row.changeType},timestamp:Date.now(),sessionId:'debug-session',runId:'pre-fix',hypothesisId:'H2'})}).catch(()=>{});\n          // #endregion\n          toast.error('단가/합계 금액 변경 항목을 모두 입력해주세요.')\n          setLoading(false)\n          return\n        }\n        const newValue = Number(row.newValue)\n        if (!Number.isFinite(newValue)) {\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/b22edbac-a44c-4882-a88d-47f6cafc7628',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'SupportMain.tsx:handleSubmit:validation',message:'invalid_price_value',data:{value:row.newValue,changeType:row.changeType},timestamp:Date.now(),sessionId:'debug-session',runId:'pre-fix',hypothesisId:'H2'})}).catch(()=>{});\n          // #endregion\n          toast.error('변경 값이 올바르지 않습니다.')\n          setLoading(false)\n          return\n        }\n\n        const targetItem = selectedPurchaseItems.find((item: any) => String(item.id) === row.itemId)\n        if (!targetItem) {\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/b22edbac-a44c-4882-a88d-47f6cafc7628',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'SupportMain.tsx:handleSubmit:validation',message:'missing_target_item_price',data:{itemId:row.itemId},timestamp:Date.now(),sessionId:'debug-session',runId:'pre-fix',hypothesisId:'H2'})}).catch(()=>{});\n          // #endregion\n          toast.error('선택한 품목을 찾을 수 없습니다.')\n          setLoading(false)\n          return\n        }\n\n        const currentUnitPrice = Number(targetItem.unit_price_value ?? targetItem.unit_price ?? 0)\n        const currentAmount = Number(targetItem.amount_value ?? (currentUnitPrice * (targetItem.quantity ?? 0)))\n        const quantityValue = Number(targetItem.quantity ?? 0)\n\n        if (row.changeType === 'amount') {\n          const newAmount = newValue\n          const newUnitPrice = quantityValue > 0 ? newAmount / quantityValue : 0\n\n          itemsPayload.push({\n            item_id: String(targetItem.id),\n            line_number: targetItem.line_number ?? null,\n            item_name: targetItem.item_name,\n            specification: targetItem.specification ?? null,\n            change_type: 'amount',\n            current_unit_price: currentUnitPrice,\n            new_unit_price: newUnitPrice,\n            current_amount: currentAmount,\n            new_amount: newAmount\n          })\n          summaryLines.push(\n            `${targetItem.line_number ?? '-'}번 ${targetItem.item_name} (${targetItem.specification || '-'}) ` +\n            `합계 ${currentAmount.toLocaleString('ko-KR')} → ${newAmount.toLocaleString('ko-KR')}`\n          )\n        } else {\n          const newUnitPrice = newValue\n          const newAmount = quantityValue * newUnitPrice\n\n          itemsPayload.push({\n            item_id: String(targetItem.id),\n            line_number: targetItem.line_number ?? null,\n            item_name: targetItem.item_name,\n            specification: targetItem.specification ?? null,\n            change_type: 'unit_price',\n            current_unit_price: currentUnitPrice,\n            new_unit_price: newUnitPrice,\n            current_amount: currentAmount,\n            new_amount: newAmount\n          })\n          summaryLines.push(\n            `${targetItem.line_number ?? '-'}번 ${targetItem.item_name} (${targetItem.specification || '-'}) ` +\n            `단가 ${currentUnitPrice.toLocaleString('ko-KR')} → ${newUnitPrice.toLocaleString('ko-KR')} ` +\n            `합계 ${currentAmount.toLocaleString('ko-KR')} → ${newAmount.toLocaleString('ko-KR')}`\n          )\n        }\n      }\n\n      inquiryPayload = { items: itemsPayload }\n    }\n\n    if (inquiryType === 'delete') {\n      inquiryPayload = { reason: message.trim() }\n    }\n    \n    if (selectedPurchase) {\n      const items = selectedPurchase.purchase_request_items || [];\n      const itemsText = items.map((item: any, index: number) => \n        `- ${item.line_number ?? index + 1}. ${item.item_name} (${item.specification || '-'}) ${item.quantity}개`\n      ).join('\\n');\n      \n      const poNumberText = selectedPurchase.purchase_order_number || '(승인대기)'\n      purchaseInfo = `발주번호: ${poNumberText}\n업체: ${selectedPurchase.vendor_name}\n요청자: ${selectedPurchase.requester_name}\n요청일: ${selectedPurchase.request_date || selectedPurchase.created_at || '-'}\n품목:\n${itemsText}`;\n    }\n\n    const messageSections = [message.trim()]\n    if (summaryLines.length > 0) {\n      messageSections.push(`[요청 상세]\\n${summaryLines.join('\\n')}`)\n    }\n    if (purchaseInfo) {\n      messageSections.push(`[관련 발주 정보]\\n${purchaseInfo}`)\n    }\n    finalMessage = messageSections.join('\\n\\n')\n\n    const result = await supportService.createInquiry({\n      inquiry_type: inquiryType as any,\n      subject: subjectText,\n      message: finalMessage,\n      purchase_request_id: selectedPurchase?.id,\n      purchase_info: purchaseInfo,\n      purchase_order_number: selectedPurchase?.purchase_order_number,\n      attachments: attachments,\n      inquiry_payload: inquiryPayload\n    })\n    // #region agent log\n    fetch('http://127.0.0.1:7242/ingest/b22edbac-a44c-4882-a88d-47f6cafc7628',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'SupportMain.tsx:handleSubmit:createInquiry',message:'submit_result',data:{success:result.success,error:result.error || null,inquiryId:result.inquiryId || null},timestamp:Date.now(),sessionId:'debug-session',runId:'pre-fix',hypothesisId:'H3'})}).catch(()=>{});\n    // #endregion\n\n    if (result.success) {\n      toast.success('문의가 접수되었습니다.')\n      const createdId = result.inquiryId\n      // 폼 초기화\n      setInquiryType('')\n      setMessage('')\n      setSelectedPurchase(null)\n      setPurchaseRequests([])\n      setDateRange(undefined)\n      setAttachments([])\n      // 목록 새로고침\n      loadInquiries()\n\n      // ✅ 생성된 문의를 펼쳐서(드롭다운) 바로 대화창이 보이게\n      if (createdId) {\n        setExpandedInquiry(createdId)\n      }\n    } else {\n      toast.error(result.error || '문의 접수에 실패했습니다.')\n    }\n    \n    setLoading(false)\n  }\n\n  // 이미지 첨부 핸들러\n  const handleImageSelect = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = e.target.files\n    if (!files || files.length === 0) return\n\n    // 최대 5개 제한\n    if (attachments.length >= 5) {\n      toast.error('첨부파일은 최대 5개까지 가능합니다.')\n      return\n    }\n\n    const file = files[0]\n    \n    // 파일 크기 제한 (5MB)\n    if (file.size > 5 * 1024 * 1024) {\n      toast.error('파일 크기는 5MB 이하만 가능합니다.')\n      return\n    }\n\n    // 이미지 타입 확인\n    if (!file.type.startsWith('image/')) {\n      toast.error('이미지 파일만 첨부 가능합니다.')\n      return\n    }\n\n    setUploadingImage(true)\n    const result = await supportService.uploadAttachment(file)\n    \n    if (result.success && result.data) {\n      setAttachments(prev => [...prev, result.data!])\n      toast.success('이미지가 첨부되었습니다.')\n    } else {\n      toast.error(result.error || '이미지 업로드 실패')\n    }\n    \n    setUploadingImage(false)\n    \n    // input 초기화 (같은 파일 다시 선택 가능하도록)\n    if (fileInputRef.current) {\n      fileInputRef.current.value = ''\n    }\n  }\n\n  // 첨부파일 삭제 핸들러\n  const handleRemoveAttachment = async (index: number) => {\n    const attachment = attachments[index]\n    \n    // Storage에서 삭제\n    await supportService.deleteAttachment(attachment.path)\n    \n    // state에서 제거\n    setAttachments(prev => prev.filter((_, i) => i !== index))\n    toast.success('첨부파일이 삭제되었습니다.')\n  }\n\n  // 문의 상태 업데이트 (관리자용)\n  const handleStatusUpdate = async (inquiryId: number, newStatus: 'in_progress' | 'resolved' | 'closed', resolutionNote?: string) => {\n    if (newStatus === 'resolved') {\n      // ✅ 입력 없이 완료 처리 + 사용자에게 \"완료되었습니다\" 알림 + 로그 기록(DB 함수)\n      const result = await supportService.resolveInquiry(inquiryId)\n      if (result.success) {\n        toast.success('문의가 완료 처리되었습니다.')\n        loadInquiries()\n      } else {\n        toast.error(result.error || '완료 처리 실패')\n      }\n    } else {\n      const result = await supportService.updateInquiryStatus(inquiryId, newStatus)\n      \n      if (result.success) {\n        toast.success('상태가 업데이트되었습니다.')\n        loadInquiries()\n      } else {\n        toast.error(result.error || '상태 업데이트 실패')\n      }\n    }\n  }\n\n  const expandedInquiryObj = inquiries.find((i) => i.id === expandedInquiry) || null\n\n  // 확장된 문의에 대해 메시지 로드 + 실시간 구독 + (사용자) 알림 읽음 처리\n  useEffect(() => {\n    if (!expandedInquiryObj?.id) return\n    const inquiryId = expandedInquiryObj.id!\n\n    let cancelled = false\n    // 드롭다운 첫 오픈 시에는 무조건 맨 아래로\n    chatForceBottomOnOpenRef.current = true\n    const cached = chatMessagesCacheRef.current.get(inquiryId)\n    if (cached && cached.length > 0) {\n      // 캐시가 있으면 즉시 표시(깜빡임/빈 화면 없음)\n      setChatMessages(cached)\n      setChatLoading(false)\n      setChatRefreshing(true)\n    } else {\n      // 캐시가 없으면 초기 로딩 스피너\n      setChatMessages([])\n      setChatLoading(true)\n      setChatRefreshing(false)\n    }\n\n    const load = async () => {\n      // 캐시가 있을 때는 UI를 유지한 채로 백그라운드 갱신만 표시\n      const hasCached = (chatMessagesCacheRef.current.get(inquiryId)?.length ?? 0) > 0\n      if (hasCached) setChatRefreshing(true)\n      else setChatLoading(true)\n\n      const result = await supportService.getInquiryMessages(inquiryId)\n      if (!cancelled) {\n        if (result.success) {\n          const el = chatScrollRef.current\n          const prevTop = el?.scrollTop ?? 0\n          const isFirstLoad = chatFirstLoadInquiryIdRef.current !== inquiryId\n          chatFirstLoadInquiryIdRef.current = inquiryId\n\n          const atBottom = isFirstLoad\n            ? true\n            : (el ? (el.scrollHeight - el.scrollTop - el.clientHeight) < 80 : true)\n\n          chatScrollRestoreRef.current = { atBottom, prevTop }\n\n          setChatMessages(result.data)\n          chatMessagesCacheRef.current.set(inquiryId, result.data)\n          setChatLoading(false)\n          setChatRefreshing(false)\n        } else {\n          toast.error(result.error || '대화 내용을 불러오지 못했습니다.')\n          setChatLoading(false)\n          setChatRefreshing(false)\n        }\n      }\n    }\n\n    // 사용자: 해당 문의 알림(안읽음) 처리\n    const markAsRead = async () => {\n      if (isAdmin) return\n      if (!currentUserEmail) return\n      const supabase = createClient()\n      await supabase\n        .from('notifications')\n        .update({ is_read: true, read_at: new Date().toISOString() })\n        .eq('user_email', currentUserEmail)\n        .eq('is_read', false)\n        .in('type', ['inquiry_message', 'inquiry_resolved'])\n        .eq('data->>inquiryId', String(inquiryId))\n    }\n\n    load()\n    markAsRead()\n\n    const subscription = supportService.subscribeToInquiryMessages(inquiryId, () => {\n      load()\n    })\n\n    return () => {\n      cancelled = true\n      subscription.unsubscribe()\n    }\n  }, [expandedInquiryObj?.id, isAdmin, currentUserEmail])\n\n  // chatMessages가 DOM에 반영된 직후(useLayoutEffect)에 스크롤을 보정\n  // NOTE: expandedInquiryObj 선언 이후에 위치해야 TDZ(초기화 전 참조) 에러가 나지 않음\n  useLayoutEffect(() => {\n    if (!expandedInquiryObj?.id) return\n    const el = chatScrollRef.current\n    if (!el) return\n\n    if (chatForceBottomOnOpenRef.current) {\n      el.scrollTop = el.scrollHeight\n      // 실제 콘텐츠가 렌더된 상태(또는 로딩 종료)에서만 강제 플래그를 내림\n      // 너무 일찍 false가 되면, 이후 메시지 DOM이 붙을 때 다시 맨 위로 남는 문제가 생김\n      if (chatMessages.length > 0 || !chatLoading) {\n        chatForceBottomOnOpenRef.current = false\n      }\n    } else {\n      const restore = chatScrollRestoreRef.current\n      if (!restore) return\n      if (restore.atBottom) el.scrollTop = el.scrollHeight\n      else el.scrollTop = restore.prevTop\n    }\n  }, [expandedInquiryObj?.id, chatMessages, chatLoading])\n\n  const handleSendChat = async () => {\n    if (!expandedInquiryObj?.id) return\n    if (!chatText.trim()) {\n      toast.error('메시지를 입력해주세요.')\n      return\n    }\n    if (expandedInquiryObj.status === 'resolved' || expandedInquiryObj.status === 'closed') {\n      toast.error('완료된 문의에는 메시지를 보낼 수 없습니다.')\n      return\n    }\n\n    setChatSending(true)\n    const result = await supportService.sendInquiryMessage({\n      inquiryId: expandedInquiryObj.id!,\n      message: chatText.trim(),\n      senderRole: isAdmin ? 'admin' : 'user'\n    })\n\n    if (result.success) {\n      setChatText('')\n    } else {\n      toast.error(result.error || '메시지 전송 실패')\n    }\n    setChatSending(false)\n  }\n\n  const handleResolveFromChat = async () => {\n    if (!expandedInquiryObj?.id) return\n    const result = await supportService.resolveInquiry(expandedInquiryObj.id!)\n    if (result.success) {\n      toast.success('문의가 완료 처리되었습니다.')\n      setChatText('')\n      setExpandedInquiry(null)\n      loadInquiries()\n    } else {\n      toast.error(result.error || '완료 처리 실패')\n    }\n  }\n\n  // 문의 삭제\n  const handleDeleteInquiry = async (inquiryId: number) => {\n    if (!confirm('정말로 이 문의를 삭제하시겠습니까?\\n삭제된 문의는 복구할 수 없습니다.')) return\n\n    const result = await supportService.deleteInquiry(inquiryId)\n    \n    if (result.success) {\n      toast.success('문의가 삭제되었습니다.')\n      loadInquiries()\n    } else {\n      toast.error(result.error || '문의 삭제 실패')\n    }\n  }\n\n  // 문의 상세 보기\n  const viewInquiryDetail = (inquiry: SupportInquiry) => {\n    setSelectedInquiryDetail(inquiry)\n    setShowDetailModal(true)\n  }\n\n  const openPurchaseDetailFromInquiry = async (inquiry: SupportInquiry) => {\n    try {\n      // 1) 가장 정확한 값: purchase_request_id (신규 문의부터 저장됨)\n      if (inquiry.purchase_request_id) {\n        setPurchaseDetailId(inquiry.purchase_request_id)\n        setPurchaseDetailModalOpen(true)\n        return\n      }\n\n      // 2) 과거 데이터 호환: purchase_order_number로 purchase_requests에서 id 조회\n      const orderNumber = inquiry.purchase_order_number?.trim()\n      if (!orderNumber) {\n        setPurchaseMissingMessage('발주내역이 삭제 되었거나 없습니다.')\n        setPurchaseMissingOpen(true)\n        return\n      }\n\n      const supabase = createClient()\n      const { data, error } = await supabase\n        .from('purchase_requests')\n        .select('id')\n        .eq('purchase_order_number', orderNumber)\n        .limit(1)\n        .maybeSingle()\n\n      if (error) throw error\n      if (!data?.id) {\n        setPurchaseMissingMessage('발주내역이 삭제 되었거나 없습니다.')\n        setPurchaseMissingOpen(true)\n        return\n      }\n\n      setPurchaseDetailId(data.id)\n      setPurchaseDetailModalOpen(true)\n    } catch (e) {\n      setPurchaseMissingMessage('발주내역이 삭제 되었거나 없습니다.')\n      setPurchaseMissingOpen(true)\n    }\n  }\n\n  // 품목 수정 시작\n  const startEditItem = (item: any) => {\n    setEditingItemId(item.id)\n    setEditingItem({\n      item_name: item.item_name,\n      specification: item.specification,\n      quantity: item.quantity,\n      unit_price_value: item.unit_price_value,\n      remark: item.remark\n    })\n  }\n\n  // 품목 수정 취소\n  const cancelEditItem = () => {\n    setEditingItemId(null)\n    setEditingItem(null)\n  }\n\n  // 품목 수정 저장\n  const saveEditItem = async (itemId: string) => {\n    if (!editingItem) return\n\n    const totalPrice = (editingItem.quantity || 0) * (editingItem.unit_price_value || 0)\n    const result = await supportService.updatePurchaseRequestItem(itemId, {\n      item_name: editingItem.item_name,\n      specification: editingItem.specification,\n      quantity: editingItem.quantity,\n      unit_price_value: editingItem.unit_price_value,\n      amount_value: totalPrice,\n      remark: editingItem.remark\n    })\n\n    if (result.success) {\n      toast.success('품목이 수정되었습니다.')\n      // 목록 새로고침 - 상세 정보가 있다면 다시 로드\n      if (selectedInquiryDetail?.id) {\n        // Refresh logic can be implemented here if needed\n      }\n      cancelEditItem()\n    } else {\n      toast.error(result.error || '품목 수정 실패')\n    }\n  }\n\n  // 품목 삭제\n  const deleteItem = async (itemId: string) => {\n    if (!confirm('이 품목을 삭제하시겠습니까?')) return\n\n    const result = await supportService.deletePurchaseRequestItem(itemId)\n\n    if (result.success) {\n      toast.success('품목이 삭제되었습니다.')\n      // 목록 새로고침 - 상세 정보가 있다면 다시 로드\n      if (selectedInquiryDetail?.id) {\n        // Refresh logic can be implemented here if needed\n      }\n    } else {\n      toast.error(result.error || '품목 삭제 실패')\n    }\n  }\n\n  // 발주요청 전체 삭제\n  const deletePurchaseRequest = async () => {\n    if (!selectedInquiryDetail?.id) return\n    if (!confirm('이 발주요청 전체를 삭제하시겠습니까?\\n모든 품목이 함께 삭제됩니다.')) return\n\n    const result = await supportService.deletePurchaseRequest(selectedInquiryDetail.id)\n\n    if (result.success) {\n      // 🚀 메모리 캐시에서 즉시 삭제 (실시간 반영)\n      const memoryUpdated = removePurchaseFromMemory(selectedInquiryDetail.id)\n      if (!memoryUpdated) {\n        console.warn('[deletePurchaseRequest] 메모리 캐시에서 발주서 삭제 실패', { \n          purchaseId: selectedInquiryDetail.id \n        })\n      } else {\n        console.info('✅ [deletePurchaseRequest] 메모리 캐시에서 발주서 삭제 성공', { \n          purchaseId: selectedInquiryDetail.id \n        })\n      }\n\n      toast.success('발주요청이 삭제되었습니다.')\n      setShowDetailModal(false)\n      setSelectedInquiryDetail(null)\n      // 문의 목록 새로고침\n      loadInquiries()\n    } else {\n      toast.error(result.error || '발주요청 삭제 실패')\n    }\n  }\n\n  const handleConfirmDeleteFromPurchaseModal = async () => {\n    if (!purchaseToDelete?.id) {\n      toast.error('삭제할 발주 정보가 없습니다.')\n      return\n    }\n\n    const supabase = createClient()\n\n    try {\n      const purchaseIdForDelete =\n        typeof purchaseToDelete.id === 'string' ? parseInt(purchaseToDelete.id, 10) : purchaseToDelete.id\n\n      if (!purchaseIdForDelete || Number.isNaN(purchaseIdForDelete)) {\n        toast.error('발주 ID가 올바르지 않습니다.')\n        return\n      }\n\n      // 1) 문의 기록 보존: support_inquires에서 purchase_request_id만 null로 변경\n      const { error: inquiryUpdateError } = await supabase\n        .from('support_inquires')\n        .update({ purchase_request_id: null })\n        .eq('purchase_request_id', purchaseIdForDelete)\n\n      if (inquiryUpdateError) {\n        // 여기서 막지 않고 계속 진행하면 FK로 삭제가 실패할 수 있어 중단하는 편이 안전\n        throw inquiryUpdateError\n      }\n\n      // 2) 품목 삭제\n      const { error: itemsError } = await supabase\n        .from('purchase_request_items')\n        .delete()\n        .eq('purchase_request_id', purchaseIdForDelete)\n      if (itemsError) throw itemsError\n\n      // 3) 발주요청 삭제\n      const { error: requestError } = await supabase\n        .from('purchase_requests')\n        .delete()\n        .eq('id', purchaseIdForDelete)\n      if (requestError) throw requestError\n\n      // 4) 메모리 캐시 즉시 반영\n      removePurchaseFromMemory(purchaseIdForDelete)\n\n      toast.success('발주요청이 삭제되었습니다. (문의 기록은 보존됩니다)')\n\n      // UI 정리\n      setDeleteConfirmOpen(false)\n      setPurchaseToDelete(null)\n      setPurchaseDetailModalOpen(false)\n      setPurchaseDetailId(null)\n\n      // 문의 목록 갱신\n      loadInquiries()\n    } catch (e) {\n      toast.error(e instanceof Error ? e.message : '삭제 중 오류가 발생했습니다.')\n    } finally {\n      setDeleteConfirmOpen(false)\n      setPurchaseToDelete(null)\n    }\n  }\n\n  // 상태 배지 스타일\n  const getStatusBadge = (status?: string) => {\n    switch (status) {\n      case 'open':\n        return <span className=\"badge-stats bg-yellow-100 text-yellow-800\">대기</span>\n      case 'in_progress':\n        return <span className=\"badge-stats bg-blue-100 text-blue-800\">처리중</span>\n      case 'resolved':\n        return <span className=\"badge-stats bg-green-100 text-green-800\">완료</span>\n      case 'closed':\n        return <span className=\"badge-stats bg-gray-100 text-gray-800\">종료</span>\n      default:\n        return <span className=\"badge-stats border border-gray-300 bg-white text-gray-600\">-</span>\n    }\n  }\n\n  // 문의 유형 라벨\n  const getInquiryTypeLabel = (type: string) => {\n    switch (type) {\n      case 'bug': return '오류 신고'\n      case 'modify': return '수정 요청'\n      case 'delivery_date_change': return '입고일 변경 요청'\n      case 'quantity_change': return '수량 변경 요청'\n      case 'price_change': return '단가/합계 금액 변경 요청'\n      case 'delete': return '삭제 요청'\n      case 'annual_leave': return '연차 문의'\n      case 'attendance': return '근태 문의'\n      case 'other': return '기타 문의'\n      default: return type\n    }\n  }\n\n  const renderInquiryPayloadSummary = (inquiry: SupportInquiry) => {\n    const payload = inquiry.inquiry_payload as any\n    if (!payload || typeof payload !== 'object') return null\n\n    if (inquiry.inquiry_type === 'delivery_date_change') {\n      return (\n        <div>\n          <span className=\"modal-value text-gray-700\">입고일 변경 요청:</span>\n          <div className=\"mt-1 text-gray-600\">\n            <div>현재 입고요청일: {payload.current_date || '-'}</div>\n            <div>변경 입고일: {payload.requested_date || '-'}</div>\n          </div>\n        </div>\n      )\n    }\n\n    if (inquiry.inquiry_type === 'quantity_change') {\n      const items = Array.isArray(payload.items) ? payload.items : []\n      if (items.length === 0) return null\n      return (\n        <div>\n          <span className=\"modal-value text-gray-700\">수량 변경 요청:</span>\n          <div className=\"mt-1 text-gray-600 space-y-1\">\n            {items.map((item: any, index: number) => (\n              <div key={`${item.item_id}-${index}`}>\n                {item.line_number ?? '-'}번 {item.item_name} ({item.specification || '-'}) {item.current_quantity ?? '-'} → {item.new_quantity}\n              </div>\n            ))}\n          </div>\n        </div>\n      )\n    }\n\n    if (inquiry.inquiry_type === 'price_change') {\n      const items = Array.isArray(payload.items) ? payload.items : []\n      if (items.length === 0) return null\n      return (\n        <div>\n          <span className=\"modal-value text-gray-700\">단가/합계 금액 변경 요청:</span>\n          <div className=\"mt-1 text-gray-600 space-y-1\">\n            {items.map((item: any, index: number) => (\n              <div key={`${item.item_id}-${index}`}>\n                {item.line_number ?? '-'}번 {item.item_name} ({item.specification || '-'}){' '}\n                {item.change_type === 'amount'\n                  ? `합계 ${item.current_amount ?? '-'} → ${item.new_amount ?? '-'}`\n                  : `단가 ${item.current_unit_price ?? '-'} → ${item.new_unit_price ?? '-'} 합계 ${item.current_amount ?? '-'} → ${item.new_amount ?? '-'}`}\n              </div>\n            ))}\n          </div>\n        </div>\n      )\n    }\n\n    if (inquiry.inquiry_type === 'delete') {\n      if (!payload.reason) return null\n      return (\n        <div>\n          <span className=\"modal-value text-gray-700\">삭제 사유:</span>\n          <p className=\"text-gray-600 mt-1 whitespace-pre-wrap\">{payload.reason}</p>\n        </div>\n      )\n    }\n\n    return null\n  }\n\n  // 권한 확인 중일 때 로딩 표시\n  if (isAdmin === null) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4\"></div>\n          <p className=\"text-gray-600\">권한 확인 중...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <div className=\"w-full max-w-none mx-0 px-3 sm:px-4 lg:px-5 pb-6\">\n        {/* 헤더 */}\n        <div className=\"mb-4\">\n          <h1 className=\"page-title text-gray-900\">문의하기</h1>\n          <p className=\"page-subtitle text-gray-600 mt-1\">\n            {isAdmin \n              ? '모든 문의를 관리하고 답변할 수 있습니다'\n              : '시스템 사용 중 궁금하신 점이나 개선사항을 알려주세요'}\n          </p>\n        </div>\n\n        <div className={`${isAdmin ? 'w-full' : 'grid grid-cols-1 xl:grid-cols-2 gap-4'}`}>\n          {/* 문의 작성 폼 - app_admin이 아닌 경우에만 표시 */}\n          {!isAdmin && (\n            <Card className=\"business-radius-card border border-gray-200 shadow-sm\">\n              <CardHeader className=\"pb-3 pt-4 px-4\">\n                <CardTitle className=\"section-title flex items-center gap-2 text-gray-900\">\n                  <MessageCircle className=\"w-4 h-4 text-gray-600\" />\n                  문의 내용\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"px-4 pb-4\">\n                <form onSubmit={handleSubmit} className=\"space-y-4\">\n                <div>\n                  <label className=\"block modal-label text-gray-700 mb-1\">\n                    문의 유형 <span className=\"text-red-500\">*</span>\n                  </label>\n                  <Select value={inquiryType} onValueChange={setInquiryType}>\n                    <SelectTrigger\n                      size=\"sm\"\n                      className=\"button-base business-radius-input border border-gray-300 bg-white text-gray-700 w-auto !h-7 !px-2.5 !text-[11px]\"\n                      style={{ width: `${inquiryTypeControlWidthEm}em`, maxWidth: '100%' }}\n                    >\n                      <SelectValue placeholder={inquiryTypePlaceholder} />\n                    </SelectTrigger>\n                    <SelectContent\n                      className=\"text-[11px] business-radius-card\"\n                      style={{ minWidth: `${inquiryTypeMenuWidthEm}em` }}\n                    >\n                      {inquiryTypeOptions.map((option) => (\n                        <SelectItem\n                          key={option.value}\n                          className=\"text-[11px] py-1.5\"\n                          value={option.value}\n                        >\n                          {option.label}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                {/* 발주요청 선택 */}\n                {showPurchaseSelect && (\n                  <div className=\"space-y-3 p-4 bg-gray-50 business-radius-card border border-gray-200\">\n                    <div className=\"modal-section-title text-gray-900\">\n                      {purchaseSelectLabel}\n                    </div>\n                    \n                    <div>\n                      <label className=\"modal-label text-gray-600 mb-2 block\">기간 선택</label>\n                      <DateRangePicker\n                        date={dateRange}\n                        onDateChange={setDateRange}\n                        placeholder=\"발주요청 기간을 선택하세요\"\n                        className=\"inline-grid w-fit\"\n                        style={{ width: `${dateRangeWidthEm}em`, maxWidth: '100%' }}\n                        triggerClassName=\"button-base w-fit justify-start border border-gray-300 bg-white text-gray-700 business-radius-input\"\n                      />\n                    </div>\n\n                    <div className=\"space-y-3\">\n                      <div className=\"flex items-center justify-between\">\n                        <div className=\"modal-label text-gray-600\">\n                          발주요청 선택 (총 {purchaseRequests.length}건)\n                        </div>\n                        {searchingPurchase && (\n                          <span className=\"badge-text text-gray-400\">조회 중…</span>\n                        )}\n                      </div>\n                      <ReactSelect\n                        value={purchaseOptions.find(option => option.value === String(selectedPurchase?.id)) || null}\n                        onChange={(option) => setSelectedPurchase((option as any)?.data || null)}\n                        options={purchaseOptions}\n                        placeholder=\"발주번호 선택/검색\"\n                        isSearchable\n                        isLoading={searchingPurchase}\n                        noOptionsMessage={() => '일치하는 발주가 없습니다'}\n                        filterOption={(option, inputValue) => {\n                          const keyword = inputValue.toLowerCase()\n                          const label = option.label.toLowerCase()\n                          const searchText = option.data?.searchText || ''\n                          return label.includes(keyword) || searchText.includes(keyword)\n                        }}\n                        styles={getCompactSelectStyles(purchaseControlWidthPx, purchaseMenuWidthPx)}\n                      />\n                      {!searchingPurchase && purchaseRequests.length === 0 && (\n                        <div className=\"card-description text-gray-500\">\n                          선택한 기간 내 발주요청이 없습니다.\n                        </div>\n                      )}\n\n                      {selectedPurchase && (\n                        <div className=\"px-3 py-2 bg-white border border-gray-200 business-radius-card\">\n                          <div className=\"flex items-center gap-2\">\n                            <span className=\"card-title\">{selectedPurchase.purchase_order_number || '(승인대기)'}</span>\n                            <span className=\"card-subtitle\">{selectedPurchase.vendor_name}</span>\n                            <span className=\"card-date\">\n                              {(selectedPurchase.request_date || selectedPurchase.created_at) &&\n                                format(new Date(selectedPurchase.request_date || selectedPurchase.created_at), 'MM/dd')}\n                            </span>\n                          </div>\n                          {selectedPurchaseItems.length > 0 && (\n                            <div className=\"mt-2 space-y-1\">\n                              <div className=\"modal-label text-gray-600\">품목 상세</div>\n                              {selectedPurchaseItems.map((item: any, index: number) => (\n                                <div key={item.id || index} className=\"flex items-center gap-2 pl-2\">\n                                  <span className=\"card-description text-gray-400\">{item.line_number ?? index + 1}.</span>\n                                  <span className=\"card-description\">{item.item_name}</span>\n                                  {item.specification && (\n                                    <span className=\"card-description text-gray-500\">({item.specification})</span>\n                                  )}\n                                  <span className=\"card-description text-gray-500\">- {item.quantity}개</span>\n                                </div>\n                              ))}\n                            </div>\n                          )}\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                )}\n\n                {inquiryType === 'delivery_date_change' && (\n                  <div className=\"space-y-3 p-4 bg-gray-50 business-radius-card border border-gray-200\">\n                    <div className=\"modal-section-title text-gray-900\">입고일 변경 요청</div>\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                      <div>\n                        <label className=\"modal-label text-gray-600 mb-1 block\">현재 입고요청일</label>\n                        <div className=\"modal-value text-gray-700\">\n                          {selectedPurchase?.delivery_request_date\n                            ? format(new Date(selectedPurchase.delivery_request_date), 'yyyy-MM-dd')\n                            : '-'}\n                        </div>\n                      </div>\n                      <div>\n                        <label className=\"modal-label text-gray-600 mb-1 block\">변경 입고일</label>\n                        <DatePickerPopover\n                          onDateSelect={(date) => setRequestedDeliveryDate(date)}\n                          placeholder=\"변경 입고일 선택\"\n                          align=\"start\"\n                          side=\"bottom\"\n                        >\n                          <Button\n                            type=\"button\"\n                            className=\"button-base w-full justify-start border border-gray-300 bg-white text-gray-700 business-radius-input\"\n                            disabled={!selectedPurchase}\n                          >\n                            <Calendar className=\"mr-2 h-4 w-4\" />\n                            {requestedDeliveryDate\n                              ? format(requestedDeliveryDate, 'yyyy-MM-dd')\n                              : '날짜 선택'}\n                          </Button>\n                        </DatePickerPopover>\n                      </div>\n                    </div>\n                  </div>\n                )}\n\n                {inquiryType === 'quantity_change' && (\n                  <div className=\"space-y-3 p-4 bg-gray-50 business-radius-card border border-gray-200\">\n                    <div className=\"modal-section-title text-gray-900\">수량 변경 요청</div>\n\n                    <div className=\"space-y-2\">\n                      {quantityChangeRows.map((row) => {\n                        const selectedItem = selectedPurchaseItems.find((item: any) => String(item.id) === row.itemId)\n\n                        return (\n                          <div key={row.id} className=\"flex flex-col sm:flex-row sm:items-center gap-2\">\n                            <div className=\"flex-1\">\n                              <ReactSelect\n                                value={itemOptions.find(option => option.value === row.itemId) || null}\n                                onChange={(option) => updateQuantityRow(row.id, { itemId: (option as any)?.value || '' })}\n                                options={itemOptions}\n                                placeholder=\"품목 선택/검색\"\n                                isSearchable\n                                isDisabled={!selectedPurchase}\n                                noOptionsMessage={() => '일치하는 품목이 없습니다'}\n                                filterOption={(option, inputValue) =>\n                                  option.label.toLowerCase().includes(inputValue.toLowerCase())\n                                }\n                                styles={getCompactSelectStyles(itemControlWidthPx, itemMenuWidthPx)}\n                              />\n                            </div>\n                            <div className=\"badge-text text-gray-600 sm:w-24 text-right\">\n                              변경 수량 :\n                            </div>\n                            <Input\n                              type=\"number\"\n                              value={row.newQuantity}\n                              onChange={(e) => updateQuantityRow(row.id, { newQuantity: e.target.value })}\n                              placeholder={`입고 수량 : ${selectedItem?.quantity ?? '-'}`}\n                              className=\"sm:w-28 business-radius-input h-7 !text-[11px] !leading-tight\"\n                              min={0}\n                              disabled={!selectedPurchase}\n                            />\n                            <button\n                              type=\"button\"\n                              onClick={() => removeQuantityRow(row.id)}\n                              className=\"button-action-danger\"\n                            >\n                              <Trash2 className=\"w-3.5 h-3.5 mr-1\" />\n                              삭제\n                            </button>\n                          </div>\n                        )\n                      })}\n                    </div>\n\n                    <button\n                      type=\"button\"\n                      onClick={addQuantityRow}\n                      className=\"button-action-secondary\"\n                      disabled={!selectedPurchase}\n                    >\n                      <Plus className=\"w-3.5 h-3.5 mr-1\" />\n                      품목 추가\n                    </button>\n                  </div>\n                )}\n\n                {inquiryType === 'price_change' && (\n                  <div className=\"space-y-3 p-4 bg-gray-50 business-radius-card border border-gray-200\">\n                    <div className=\"modal-section-title text-gray-900\">단가/합계 금액 변경 요청</div>\n\n                    <div className=\"space-y-2\">\n                      {priceChangeRows.map((row) => {\n                        const selectedItem = selectedPurchaseItems.find((item: any) => String(item.id) === row.itemId)\n                        const currentUnitPrice = Number(selectedItem?.unit_price_value ?? selectedItem?.unit_price ?? 0)\n                        const currentAmount = Number(selectedItem?.amount_value ?? (currentUnitPrice * (selectedItem?.quantity ?? 0)))\n                        const currentUnitPriceLabel = selectedItem ? currentUnitPrice.toLocaleString('ko-KR') : '-'\n                        const currentAmountLabel = selectedItem ? currentAmount.toLocaleString('ko-KR') : '-'\n                        const placeholderText = row.changeType === 'amount'\n                          ? `현재 합계액: ${currentAmountLabel}`\n                          : `현재 단가: ${currentUnitPriceLabel}`\n\n                        return (\n                          <div key={row.id} className=\"flex flex-col lg:flex-row lg:items-center gap-2\">\n                            <div className=\"flex-1\">\n                              <ReactSelect\n                                value={itemOptions.find(option => option.value === row.itemId) || null}\n                                onChange={(option) => updatePriceRow(row.id, { itemId: (option as any)?.value || '' })}\n                                options={itemOptions}\n                                placeholder=\"품목 선택/검색\"\n                                isSearchable\n                                isDisabled={!selectedPurchase}\n                                noOptionsMessage={() => '일치하는 품목이 없습니다'}\n                                filterOption={(option, inputValue) =>\n                                  option.label.toLowerCase().includes(inputValue.toLowerCase())\n                                }\n                                styles={getCompactSelectStyles(itemControlWidthPx, itemMenuWidthPx)}\n                              />\n                            </div>\n                            <div className=\"flex items-center gap-2\">\n                              <span className=\"badge-text text-gray-600\">변경 요청</span>\n                              <Select\n                                value={row.changeType}\n                                onValueChange={(value) =>\n                                  updatePriceRow(row.id, { changeType: value as PriceChangeType, newValue: '' })\n                                }\n                                disabled={!selectedPurchase}\n                              >\n                                <SelectTrigger\n                                  size=\"sm\"\n                                  className=\"button-base business-radius-input border border-gray-300 bg-white text-gray-700 w-auto !h-7 !px-2.5 !text-[11px]\"\n                                >\n                                  <SelectValue />\n                                </SelectTrigger>\n                                <SelectContent className=\"text-[11px] business-radius-card\">\n                                  {priceChangeTypeOptions.map((option) => (\n                                    <SelectItem\n                                      key={option.value}\n                                      className=\"text-[11px] py-1.5\"\n                                      value={option.value}\n                                    >\n                                      {option.label}\n                                    </SelectItem>\n                                  ))}\n                                </SelectContent>\n                              </Select>\n                            </div>\n                            <Input\n                              type=\"text\"\n                              inputMode=\"numeric\"\n                              value={formatNumericInput(row.newValue)}\n                              onChange={(e) => updatePriceRow(row.id, { newValue: normalizeNumericInput(e.target.value) })}\n                              placeholder={placeholderText}\n                              className=\"lg:w-40 business-radius-input h-7 !text-[11px] !leading-tight\"\n                              min={0}\n                              disabled={!selectedPurchase}\n                            />\n                            <button\n                              type=\"button\"\n                              onClick={() => removePriceRow(row.id)}\n                              className=\"button-action-danger\"\n                            >\n                              <Trash2 className=\"w-3.5 h-3.5 mr-1\" />\n                              삭제\n                            </button>\n                          </div>\n                        )\n                      })}\n                    </div>\n\n                    <button\n                      type=\"button\"\n                      onClick={addPriceRow}\n                      className=\"button-action-secondary\"\n                      disabled={!selectedPurchase}\n                    >\n                      <Plus className=\"w-3.5 h-3.5 mr-1\" />\n                      품목 추가\n                    </button>\n                  </div>\n                )}\n\n                <div>\n                  <label className=\"block modal-label text-gray-700 mb-1\">\n                    {messageLabel} <span className=\"text-red-500\">*</span>\n                  </label>\n                  <Textarea\n                    value={message}\n                    onChange={(e) => setMessage(e.target.value)}\n                    placeholder={inquiryType === 'delete' ? '삭제 사유를 입력해주세요' : '문의 내용을 자세히 입력해주세요'}\n                    rows={6}\n                    maxLength={1000}\n                    className=\"business-radius-input text-[11px]\"\n                  />\n                  <p className=\"badge-text text-gray-500 mt-1\">\n                    {message.length}/1000\n                  </p>\n                </div>\n\n                {/* 사진 첨부 영역 */}\n                <div>\n                  <label className=\"block modal-label text-gray-700 mb-2\">\n                    사진 첨부 <span className=\"badge-text text-gray-400\">(선택, 최대 5개)</span>\n                  </label>\n                  \n                  {/* 첨부된 이미지 미리보기 */}\n                  {attachments.length > 0 && (\n                    <div className=\"flex flex-wrap gap-2 mb-3\">\n                      {attachments.map((attachment, index) => (\n                        <div key={index} className=\"relative group\">\n                          <img\n                            src={attachment.url}\n                            alt={attachment.name}\n                            className=\"w-20 h-20 object-cover business-radius-card border border-gray-200\"\n                          />\n                          <button\n                            type=\"button\"\n                            onClick={() => handleRemoveAttachment(index)}\n                            className=\"button-base absolute -top-2 -right-2 bg-red-500 text-white business-radius-badge opacity-0 group-hover:opacity-100 transition-opacity\"\n                            title=\"삭제\"\n                          >\n                            <X className=\"w-3 h-3\" />\n                          </button>\n                          <p className=\"text-[10px] text-gray-500 mt-1 truncate w-20 text-center\">\n                            {attachment.name}\n                          </p>\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                  \n                  {/* 이미지 추가 버튼 */}\n                  {attachments.length < 5 && (\n                    <div className=\"flex items-center gap-2\">\n                      <input\n                        ref={fileInputRef}\n                        type=\"file\"\n                        accept=\"image/*\"\n                        onChange={handleImageSelect}\n                        className=\"hidden\"\n                      />\n                      <button\n                        type=\"button\"\n                        onClick={() => fileInputRef.current?.click()}\n                        disabled={uploadingImage}\n                        className=\"button-action-secondary disabled:opacity-50 disabled:cursor-not-allowed\"\n                      >\n                        {uploadingImage ? (\n                          <>\n                            <Loader2 className=\"w-3.5 h-3.5 animate-spin\" />\n                            업로드 중...\n                          </>\n                        ) : (\n                          <>\n                            <ImagePlus className=\"w-3.5 h-3.5\" />\n                            사진 추가\n                          </>\n                        )}\n                      </button>\n                      <span className=\"badge-text text-gray-400\">\n                        {attachments.length}/5\n                      </span>\n                    </div>\n                  )}\n                </div>\n\n                <div className=\"flex justify-end\">\n                  <button\n                    type=\"submit\"\n                    className=\"button-action-primary\"\n                    disabled={loading || uploadingImage}\n                    onClick={() => {\n                      // #region agent log\n                      fetch('http://127.0.0.1:7242/ingest/b22edbac-a44c-4882-a88d-47f6cafc7628',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'SupportMain.tsx:submitButton:onClick',message:'submit_click',data:{disabled:loading || uploadingImage},timestamp:Date.now(),sessionId:'debug-session',runId:'pre-fix',hypothesisId:'H1'})}).catch(()=>{});\n                      // #endregion\n                    }}\n                  >\n                    {loading ? (\n                      <>\n                        <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2\" />\n                        전송 중...\n                      </>\n                    ) : (\n                      <>\n                        <Send className=\"w-4 h-4 mr-2\" />\n                        문의 보내기\n                      </>\n                    )}\n                  </button>\n                </div>\n              </form>\n            </CardContent>\n          </Card>\n          )}\n\n          {/* 문의 목록 */}\n          <Card className=\"business-radius-card border border-gray-200 shadow-sm\">\n            <CardHeader className=\"pb-3 pt-4 px-4\">\n              <CardTitle className=\"section-title flex items-center justify-between text-gray-900\">\n                <span className=\"flex items-center gap-2\">\n                  <AlertCircle className=\"w-4 h-4 text-orange-500\" />\n                  {isAdmin ? '전체 문의 목록' : '내 문의 내역'}\n                </span>\n                <span className=\"badge-stats border border-gray-300 bg-white text-gray-600\">\n                  {inquiries.length}건\n                </span>\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"px-4 pb-4\">\n              {loadingInquiries ? (\n                <div className=\"flex items-center justify-center py-8\">\n                  <div className=\"w-6 h-6 border-2 border-gray-300 border-t-transparent rounded-full animate-spin\" />\n                </div>\n              ) : inquiries.length === 0 ? (\n                <div className=\"text-center py-8 text-gray-500\">\n                  <MessageCircle className=\"w-10 h-10 mx-auto mb-3 text-gray-300\" />\n                  <p className=\"card-description text-gray-500\">문의 내역이 없습니다</p>\n                </div>\n              ) : (\n                <div className=\"space-y-2 max-h-[600px] overflow-y-auto\">\n                  {inquiries.map((inquiry) => (\n                    <div key={inquiry.id!} className=\"border border-gray-200 business-radius-card overflow-hidden bg-white\">\n                      {/* 문의 요약 (한 줄) */}\n                      <div \n                        className=\"px-4 py-1.5 hover:bg-gray-50 transition-colors cursor-pointer\"\n                        onClick={() => {\n                          setExpandedInquiry(expandedInquiry === inquiry.id ? null : inquiry.id!)\n                        }}\n                      >\n                        <div className=\"flex items-center justify-between gap-2\">\n                          <div className=\"flex items-center gap-2 flex-1 min-w-0 flex-nowrap\">\n                            <span className=\"badge-stats border border-gray-300 bg-white text-gray-600 whitespace-nowrap flex-shrink-0\">\n                              {getInquiryTypeLabel(inquiry.inquiry_type)}\n                            </span>\n                            <span className=\"flex-shrink-0\">{getStatusBadge(inquiry.status)}</span>\n                            {inquiry.purchase_order_number ? (\n                              <button\n                                type=\"button\"\n                                className=\"card-title truncate flex-1 min-w-0 text-blue-600 hover:underline text-left\"\n                                onClick={(e) => {\n                                  e.stopPropagation()\n                                  openPurchaseDetailFromInquiry(inquiry)\n                                }}\n                                title=\"발주 상세 열기\"\n                              >\n                                {inquiry.purchase_order_number}\n                              </button>\n                            ) : (\n                              <span className=\"card-title truncate flex-1 min-w-0\">\n                                {inquiry.subject}\n                              </span>\n                            )}\n                            {isAdmin && (\n                              <span className=\"badge-text text-gray-500 whitespace-nowrap flex-shrink-0\">\n                                {inquiry.user_name || inquiry.user_email}\n                              </span>\n                            )}\n                            <span className=\"badge-text text-gray-400 ml-auto whitespace-nowrap flex-shrink-0\">\n                              {inquiry.created_at && format(new Date(inquiry.created_at), 'MM/dd HH:mm')}\n                            </span>\n                          </div>\n                          <div className=\"flex items-center gap-1 flex-shrink-0\">\n                            {isAdmin && inquiry.status === 'open' && (\n                              <button\n                                type=\"button\"\n                                onClick={(e) => {\n                                  e.stopPropagation()\n                                  handleStatusUpdate(inquiry.id!, 'in_progress')\n                                }}\n                                className=\"button-waiting-active\"\n                              >\n                                처리중\n                              </button>\n                            )}\n                            {isAdmin && (inquiry.status === 'open' || inquiry.status === 'in_progress') && (\n                              <button\n                                type=\"button\"\n                                onClick={(e) => {\n                                  e.stopPropagation()\n                                  handleStatusUpdate(inquiry.id!, 'resolved')\n                                }}\n                                className=\"button-action-success\"\n                              >\n                                완료\n                              </button>\n                            )}\n                            {/* 삭제 버튼 - 관리자는 모든 문의 삭제 가능, 일반 사용자는 본인의 open 상태만 */}\n                            {(isAdmin || (inquiry.status === 'open' && !inquiry.resolution_note && inquiry.user_email === currentUserEmail)) && (\n                              <button\n                                type=\"button\"\n                                onClick={(e) => {\n                                  e.stopPropagation()\n                                  handleDeleteInquiry(inquiry.id!)\n                                }}\n                                className=\"button-base border border-red-200 bg-white text-red-600 hover:bg-red-50\"\n                                title=\"문의 삭제\"\n                              >\n                                <Trash2 className=\"w-3.5 h-3.5\" />\n                              </button>\n                            )}\n                            <button\n                              type=\"button\"\n                              className=\"button-action-secondary\"\n                            >\n                              {expandedInquiry === inquiry.id ? (\n                                <ChevronUp className=\"w-4 h-4\" />\n                              ) : (\n                                <ChevronDown className=\"w-4 h-4\" />\n                              )}\n                            </button>\n                          </div>\n                        </div>\n                      </div>\n                      \n                      {/* 상세 내역 */}\n                      {expandedInquiry === inquiry.id && (\n                        <div className=\"px-3 py-3 bg-gray-50 border-t\">\n                          <div className=\"space-y-2\">\n                            <div>\n                              <span className=\"modal-value text-gray-700\">내용:</span>\n                              <p className=\"card-description text-gray-600 mt-1 whitespace-pre-wrap\">{inquiry.message}</p>\n                            </div>\n                            {renderInquiryPayloadSummary(inquiry)}\n                            {inquiry.handled_by && (\n                              <div>\n                                <span className=\"modal-value text-gray-700\">처리자:</span>\n                                <span className=\"text-green-600 ml-2\">\n                                  {inquiry.handled_by}\n                                  {inquiry.processed_at && ` (${format(new Date(inquiry.processed_at), 'yyyy-MM-dd HH:mm')})`}\n                                </span>\n                              </div>\n                            )}\n                            {/* 첨부 이미지 */}\n                            {inquiry.attachments && inquiry.attachments.length > 0 && (\n                              <div>\n                                <span className=\"modal-value text-gray-700\">첨부 이미지:</span>\n                                <div className=\"flex flex-wrap gap-2 mt-2\">\n                                  {inquiry.attachments.map((attachment, index) => (\n                                    <a\n                                      key={index}\n                                      href={attachment.url}\n                                      target=\"_blank\"\n                                      rel=\"noopener noreferrer\"\n                                      className=\"block\"\n                                      onClick={(e) => e.stopPropagation()}\n                                    >\n                                      <img\n                                        src={attachment.url}\n                                        alt={attachment.name}\n                                        className=\"w-24 h-24 object-cover business-radius-card border border-gray-200 hover:border-blue-400 transition-colors cursor-pointer\"\n                                      />\n                                    </a>\n                                  ))}\n                                </div>\n                              </div>\n                            )}\n\n                            {/* 대화(드롭다운) */}\n                            <div className=\"mt-3 border-t pt-3\">\n                              <div className=\"flex items-center justify-between\">\n                                <div className=\"modal-value text-gray-800\">대화</div>\n                                {isAdmin && inquiry.status !== 'resolved' && inquiry.status !== 'closed' && (\n                                  <button\n                                    type=\"button\"\n                                    onClick={(e) => {\n                                      e.stopPropagation()\n                                      handleResolveFromChat()\n                                    }}\n                                    className=\"button-action-success\"\n                                  >\n                                    완료\n                                  </button>\n                                )}\n                              </div>\n\n                              <div className=\"mt-2 border border-gray-200 business-radius-card bg-white relative\">\n                                {chatRefreshing && (\n                                  <div\n                                    className=\"absolute top-2 right-2 badge-text text-gray-400 bg-white/80 backdrop-blur px-2 py-1 business-radius-badge border pointer-events-none\"\n                                    aria-hidden=\"true\"\n                                  >\n                                    업데이트 중…\n                                  </div>\n                                )}\n                                <div ref={chatScrollRef} className=\"max-h-[260px] overflow-y-auto p-3 space-y-2\">\n                                  {chatLoading && chatMessages.length === 0 ? (\n                                    <div className=\"flex items-center justify-center py-8\">\n                                      <div className=\"w-6 h-6 border-2 border-gray-300 border-t-transparent rounded-full animate-spin\" />\n                                    </div>\n                                  ) : chatMessages.length === 0 ? (\n                                    <div className=\"text-center text-gray-500 py-8 card-description\">\n                                      대화 내용이 없습니다.\n                                    </div>\n                                  ) : (\n                                    chatMessages.map((m) => {\n                                      const isSystem = m.sender_role === 'system'\n                                      const isMine = !isSystem && m.sender_email === currentUserEmail\n                                      return (\n                                        <div key={m.id} className={isSystem ? 'text-center' : `flex ${isMine ? 'justify-end' : 'justify-start'}`}>\n                                          <div className={isSystem ? 'inline-block badge-text text-gray-500 px-3 py-1 business-radius-badge bg-gray-50 border' : `max-w-[80%] business-radius-card px-3 py-2 ${isMine ? 'bg-blue-600 text-white' : 'bg-gray-50 border text-gray-800'}`}>\n                                            {!isSystem && (\n                                              <div className={`badge-text mb-1 ${isMine ? 'text-white/80' : 'text-gray-500'}`}>\n                                                {m.sender_role === 'admin' ? '관리자' : '문의자'}\n                                                {m.created_at && ` · ${format(new Date(m.created_at), 'MM/dd HH:mm')}`}\n                                              </div>\n                                            )}\n                                            <div className=\"whitespace-pre-wrap card-description\">{m.message}</div>\n                                            {m.attachments && m.attachments.length > 0 && (\n                                              <div className=\"flex flex-wrap gap-2 mt-2\">\n                                                {m.attachments.map((a, idx) => (\n                                                  <a\n                                                    key={idx}\n                                                    href={a.url}\n                                                    target=\"_blank\"\n                                                    rel=\"noopener noreferrer\"\n                                                    className=\"block\"\n                                                    onClick={(e) => e.stopPropagation()}\n                                                  >\n                                                    <img\n                                                      src={a.url}\n                                                      alt={a.name}\n                                                      className=\"w-20 h-20 object-cover business-radius-card border\"\n                                                    />\n                                                  </a>\n                                                ))}\n                                              </div>\n                                            )}\n                                          </div>\n                                        </div>\n                                      )\n                                    })\n                                  )}\n                                </div>\n\n                                <div className=\"border-t p-2\">\n                                  {(inquiry.status === 'resolved' || inquiry.status === 'closed') ? (\n                                    <div className=\"card-description text-gray-500 text-center py-1\">\n                                      완료된 문의입니다. 추가 대화가 필요하면 새 문의를 등록해주세요.\n                                    </div>\n                                  ) : (\n                                    <div className=\"flex items-end gap-2\">\n                                      <Textarea\n                                        value={chatText}\n                                        onChange={(e) => setChatText(e.target.value)}\n                                        placeholder=\"메시지를 입력하세요\"\n                                        rows={2}\n                                        maxLength={1000}\n                                        disabled={chatSending}\n                                        onClick={(e) => e.stopPropagation()}\n                                        className=\"business-radius-input text-[11px]\"\n                                      />\n                                      <button\n                                        type=\"button\"\n                                        onClick={(e) => {\n                                          e.stopPropagation()\n                                          handleSendChat()\n                                        }}\n                                        disabled={chatSending || !chatText.trim()}\n                                        className=\"button-action-primary disabled:opacity-50 disabled:cursor-not-allowed\"\n                                      >\n                                        {chatSending ? '전송중' : '전송'}\n                                      </button>\n                                    </div>\n                                  )}\n                                </div>\n                              </div>\n                            </div>\n                          </div>\n                        </div>\n                      )}\n                    </div>\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n\n      {/* 발주요청 상세 모달 */}\n      <Dialog open={showDetailModal} onOpenChange={setShowDetailModal}>\n        <DialogContent className=\"max-w-6xl max-h-[90vh] overflow-y-auto business-radius-modal\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center justify-between modal-title text-gray-900\">\n              <div className=\"flex items-center gap-2\">\n                <span>발주요청 상세</span>\n                {selectedInquiryDetail?.purchase_order_number && (\n                  <span className=\"badge-stats border border-gray-300 bg-white text-gray-600 font-normal\">\n                    {selectedInquiryDetail.purchase_order_number}\n                  </span>\n                )}\n              </div>\n              {isAdmin && selectedInquiryDetail && (\n                <Button\n                  onClick={deletePurchaseRequest}\n                  className=\"button-action-danger\"\n                >\n                  <Trash2 className=\"w-4 h-4 mr-1\" />\n                  전체 삭제\n                </Button>\n              )}\n            </DialogTitle>\n          </DialogHeader>\n          \n          {loadingDetail ? (\n            <div className=\"flex items-center justify-center py-8\">\n              <div className=\"w-6 h-6 border-2 border-gray-300 border-t-transparent rounded-full animate-spin\" />\n            </div>\n          ) : selectedInquiryDetail && (\n            <div className=\"space-y-6\">\n              {/* 기본 정보 */}\n              <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 p-4 bg-gray-50 border border-gray-200 business-radius-card\">\n                <div>\n                  <span className=\"modal-label text-gray-500\">발주번호</span>\n                  <p className=\"modal-value mt-1\">{selectedInquiryDetail.purchase_order_number || 'N/A'}</p>\n                </div>\n                <div>\n                  <span className=\"modal-label text-gray-500\">업체명</span>\n                  <p className=\"modal-value mt-1\">{selectedInquiryDetail.vendor_name}</p>\n                </div>\n                <div>\n                  <span className=\"modal-label text-gray-500\">요청자</span>\n                  <p className=\"modal-value mt-1\">{selectedInquiryDetail.requester_name}</p>\n                </div>\n                <div>\n                  <span className=\"modal-label text-gray-500\">요청일</span>\n                  <p className=\"modal-value mt-1\">\n                    {selectedInquiryDetail.request_date && \n                      format(new Date(selectedInquiryDetail.request_date), 'yyyy-MM-dd')}\n                  </p>\n                </div>\n              </div>\n\n              {/* 품목 목록 - 개선된 디자인 */}\n              <div>\n                <h3 className=\"modal-section-title mb-3\">품목 상세</h3>\n                <div className=\"border border-gray-200 business-radius-card overflow-x-auto\">\n                  <table className=\"w-full\">\n                    <thead className=\"bg-gray-50 border-b\">\n                      <tr>\n                        <th className=\"text-left badge-text modal-value text-gray-700 px-3 py-3 w-12\">번호</th>\n                        <th className=\"text-left badge-text modal-value text-gray-700 px-3 py-3 min-w-[180px]\">품명</th>\n                        <th className=\"text-left badge-text modal-value text-gray-700 px-3 py-3 min-w-[150px]\">규격</th>\n                        <th className=\"text-center badge-text modal-value text-gray-700 px-3 py-3 w-20\">수량</th>\n                        <th className=\"text-right badge-text modal-value text-gray-700 px-3 py-3 w-28\">단가</th>\n                        <th className=\"text-right badge-text modal-value text-gray-700 px-3 py-3 w-32\">금액</th>\n                        <th className=\"text-left badge-text modal-value text-gray-700 px-3 py-3 min-w-[150px]\">비고</th>\n                        <th className=\"text-center badge-text modal-value text-gray-700 px-3 py-3 w-16\">링크</th>\n                        {isAdmin && <th className=\"text-center badge-text modal-value text-gray-700 px-3 py-3 w-24\">작업</th>}\n                      </tr>\n                    </thead>\n                    <tbody className=\"divide-y divide-gray-200\">\n                      {selectedInquiryDetail.purchase_request_items?.map((item: any, index: number) => (\n                        <tr key={item.id} className=\"hover:bg-gray-50 transition-colors\">\n                          <td className=\"px-3 py-3 text-center modal-value text-gray-600\">\n                            {item.line_number || index + 1}\n                          </td>\n                          <td className=\"px-3 py-3\">\n                            {editingItemId === item.id ? (\n                              <Input\n                                value={editingItem?.item_name || ''}\n                                onChange={(e) => setEditingItem({...editingItem, item_name: e.target.value})}\n                                className=\"business-radius-input h-7 text-[11px] w-full\"\n                                autoFocus\n                              />\n                            ) : (\n                              <span className=\"modal-value text-gray-900\">{item.item_name}</span>\n                            )}\n                          </td>\n                          <td className=\"px-3 py-3\">\n                            {editingItemId === item.id ? (\n                              <Input\n                                value={editingItem?.specification || ''}\n                                onChange={(e) => setEditingItem({...editingItem, specification: e.target.value})}\n                                className=\"business-radius-input h-7 text-[11px] w-full\"\n                              />\n                            ) : (\n                              <span className=\"text-gray-600\">{item.specification || '-'}</span>\n                            )}\n                          </td>\n                          <td className=\"text-center px-3 py-3\">\n                            {editingItemId === item.id ? (\n                              <Input\n                                type=\"number\"\n                                value={editingItem?.quantity || ''}\n                                onChange={(e) => setEditingItem({...editingItem, quantity: parseInt(e.target.value)})}\n                                className=\"business-radius-input h-7 text-[11px] text-center w-full\"\n                              />\n                            ) : (\n                              <span className=\"modal-value\">{item.quantity}</span>\n                            )}\n                          </td>\n                          <td className=\"text-right px-3 py-3\">\n                            {editingItemId === item.id ? (\n                              <Input\n                                type=\"number\"\n                                value={editingItem?.unit_price_value || ''}\n                                onChange={(e) => setEditingItem({...editingItem, unit_price_value: parseInt(e.target.value)})}\n                                className=\"business-radius-input h-7 text-[11px] text-right w-full\"\n                              />\n                            ) : (\n                              <span className=\"modal-value\">\n                                {item.unit_price_value ? `${parseFloat(item.unit_price_value).toLocaleString()}` : '-'}\n                              </span>\n                            )}\n                          </td>\n                          <td className=\"text-right px-3 py-3\">\n                            {editingItemId === item.id ? (\n                              <span className=\"font-semibold text-blue-600\">\n                                {((editingItem?.quantity || 0) * (editingItem?.unit_price_value || 0)).toLocaleString()}\n                              </span>\n                            ) : (\n                              <span className=\"font-semibold text-blue-600\">\n                                {item.amount_value ? `${parseFloat(item.amount_value).toLocaleString()}` : '-'}\n                              </span>\n                            )}\n                          </td>\n                          <td className=\"px-3 py-3\">\n                            {editingItemId === item.id ? (\n                              <Textarea\n                                value={editingItem?.remark || ''}\n                                onChange={(e) => setEditingItem({...editingItem, remark: e.target.value})}\n                                className=\"business-radius-input h-7 text-[11px] w-full resize-none\"\n                                rows={1}\n                              />\n                            ) : (\n                              <span className=\"text-gray-600 badge-text\">{item.remark || '-'}</span>\n                            )}\n                          </td>\n                          <td className=\"text-center px-3 py-3\">\n                            {item.link ? (\n                              <a \n                                href={item.link} \n                                target=\"_blank\" \n                                rel=\"noopener noreferrer\" \n                                className=\"inline-flex items-center justify-center w-8 h-8 business-radius-badge hover:bg-blue-50 text-blue-600\"\n                              >\n                                <Eye className=\"w-4 h-4\" />\n                              </a>\n                            ) : (\n                              <span className=\"text-gray-400\">-</span>\n                            )}\n                          </td>\n                          {isAdmin && (\n                            <td className=\"text-center px-3 py-3\">\n                              {editingItemId === item.id ? (\n                                <div className=\"flex justify-center gap-1\">\n                                  <Button\n                                    onClick={() => saveEditItem(item.id)}\n                                      className=\"button-action-success\"\n                                  >\n                                    <Save className=\"w-4 h-4 mr-1\" />\n                                    저장\n                                  </Button>\n                                  <Button\n                                    onClick={cancelEditItem}\n                                      className=\"button-action-secondary\"\n                                  >\n                                    취소\n                                  </Button>\n                                </div>\n                              ) : (\n                                <div className=\"flex justify-center gap-1\">\n                                  <Button\n                                    onClick={() => startEditItem(item)}\n                                      className=\"button-action-secondary\"\n                                  >\n                                    <Edit2 className=\"w-4 h-4 text-blue-600\" />\n                                  </Button>\n                                  <Button\n                                    onClick={() => deleteItem(item.id)}\n                                      className=\"button-action-danger\"\n                                  >\n                                    <Trash2 className=\"w-4 h-4 text-red-600\" />\n                                  </Button>\n                                </div>\n                              )}\n                            </td>\n                          )}\n                        </tr>\n                      ))}\n                    </tbody>\n                    <tfoot className=\"bg-gray-50 border-t-2\">\n                      <tr>\n                        <td colSpan={5} className=\"modal-value text-right px-3 py-3\">\n                          합계\n                        </td>\n                        <td className=\"modal-value text-right px-3 py-3 text-blue-600\">\n                          {selectedInquiryDetail.purchase_request_items\n                            ?.reduce((sum: number, item: any) => sum + (parseFloat(item.amount_value) || 0), 0)\n                            .toLocaleString()}\n                        </td>\n                        <td colSpan={isAdmin ? 3 : 2} className=\"px-3 py-3\"></td>\n                      </tr>\n                    </tfoot>\n                  </table>\n                </div>\n              </div>\n\n              {/* 비고 */}\n              {selectedInquiryDetail.notes && (\n                <div>\n                  <h3 className=\"modal-section-title mb-2\">비고</h3>\n                  <p className=\"card-description text-gray-600 p-3 bg-gray-50 border border-gray-200 business-radius-card\">\n                    {selectedInquiryDetail.notes}\n                  </p>\n                </div>\n              )}\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      {/* 전체항목 탭 상세모달(재사용) */}\n      <PurchaseDetailModal\n        purchaseId={purchaseDetailId}\n        isOpen={purchaseDetailModalOpen}\n        onClose={() => {\n          setPurchaseDetailModalOpen(false)\n          setPurchaseDetailId(null)\n        }}\n        currentUserRoles={currentUserRoles}\n        activeTab=\"done\"\n        onDelete={(purchase) => {\n          setPurchaseToDelete(purchase)\n          setDeleteConfirmOpen(true)\n        }}\n      />\n\n      {/* 삭제 확인 다이얼로그 (PurchaseDetailModal 연동) */}\n      <AlertDialog\n        open={deleteConfirmOpen}\n        onOpenChange={(open) => {\n          setDeleteConfirmOpen(open)\n          if (!open) setPurchaseToDelete(null)\n        }}\n      >\n        <AlertDialogContent className=\"business-radius-modal\">\n          <AlertDialogHeader>\n            <AlertDialogTitle className=\"modal-title\">발주요청 내역 삭제</AlertDialogTitle>\n            <AlertDialogDescription>\n              발주요청번호 <strong>{purchaseToDelete?.purchase_order_number || '알 수 없음'}</strong>를 삭제하시겠습니까?\n              <br />\n              이 작업은 되돌릴 수 없습니다.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel className=\"button-action-secondary\">취소</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={handleConfirmDeleteFromPurchaseModal}\n              className=\"button-action-danger\"\n            >\n              삭제\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      {/* 삭제/없음 안내 모달 (문의에서 발주를 못 찾는 경우) */}\n      <Dialog open={purchaseMissingOpen} onOpenChange={setPurchaseMissingOpen}>\n        <DialogContent\n          showCloseButton={false}\n          maxWidth=\"sm:max-w-md\"\n          className=\"p-0 overflow-hidden business-radius-modal\"\n        >\n          <div className=\"px-8 py-10 text-center\">\n            <div className=\"modal-title text-gray-900\">안내</div>\n            <div className=\"mt-4 modal-value text-gray-700 whitespace-pre-wrap\">\n              {purchaseMissingMessage}\n            </div>\n            <div className=\"mt-6 badge-text text-gray-400\">\n              화면을 클릭하거나 ESC로 닫을 수 있습니다.\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  )\n}"],"names":["ImagePlus","createLucideIcon","d","key","cx","cy","r","Send","DateRangePicker","className","date","onDateChange","placeholder","disabled","triggerClassName","props","open","setOpen","React.useState","formatDateRange","range","from","formatDate","toLocaleDateString","year","month","day","to","getFullYear","getMonth","getDate","jsx","cn","children","jsxs","Popover","onOpenChange","PopoverTrigger","asChild","Button","id","CalendarIcon","X","onClick","e","stopPropagation","PopoverContent","align","Calendar","initialFocus","mode","defaultMonth","selected","onSelect","newDate","numberOfMonths","locale","ko","classNames","months","caption","caption_label","nav","nav_button","nav_button_previous","nav_button_next","table","head_row","head_cell","row","cell","day_range_start","day_range_end","day_selected","day_today","outside","day_disabled","day_range_middle","day_hidden","SupportMain","inquiryType","setInquiryType","useState","message","setMessage","loading","setLoading","attachments","setAttachments","uploadingImage","setUploadingImage","fileInputRef","useRef","textMeasureCanvasRef","showPurchaseSelect","setShowPurchaseSelect","dateRange","setDateRange","purchaseRequests","setPurchaseRequests","selectedPurchase","setSelectedPurchase","searchingPurchase","setSearchingPurchase","requestedDeliveryDate","setRequestedDeliveryDate","quantityChangeRows","setQuantityChangeRows","priceChangeRows","setPriceChangeRows","purchaseLinkedInquiryTypes","purchaseSelectLabel","messageLabel","createRowId","Date","now","Math","random","toString","slice","inquiries","setInquiries","isAdmin","setIsAdmin","currentUserEmail","setCurrentUserEmail","currentUserId","setCurrentUserId","currentUserRoles","setCurrentUserRoles","loadingInquiries","setLoadingInquiries","expandedInquiry","setExpandedInquiry","showDetailModal","setShowDetailModal","selectedInquiryDetail","setSelectedInquiryDetail","loadingDetail","setLoadingDetail","editingItemId","setEditingItemId","editingItem","setEditingItem","purchaseDetailModalOpen","setPurchaseDetailModalOpen","purchaseDetailId","setPurchaseDetailId","deleteConfirmOpen","setDeleteConfirmOpen","purchaseToDelete","setPurchaseToDelete","purchaseMissingOpen","setPurchaseMissingOpen","purchaseMissingMessage","setPurchaseMissingMessage","chatMessages","setChatMessages","chatLoading","setChatLoading","chatRefreshing","setChatRefreshing","chatText","setChatText","chatSending","setChatSending","chatScrollRef","chatScrollRestoreRef","chatFirstLoadInquiryIdRef","chatForceBottomOnOpenRef","chatMessagesCacheRef","Map","useEffect","checkUserRole","subscription","supportService","subscribeToInquiries","payload","eventType","newRow","new","oldRow","old","deletedId","prev","filter","i","relevant","user_id","idx","findIndex","next","unshift","sort","a","b","at","created_at","getTime","unsubscribe","async","supabase","createClient","data","user","auth","getUser","email","employee","select","eq","single","roles","Array","isArray","purchase_role","split","map","trim","adminStatus","includes","loadInquiriesWithRole","result","getAllInquiries","getMyInquiries","success","toast","error","loadInquiries","length","itemId","newQuantity","changeType","newValue","searchPurchaseRequests","startDate","toISOString","endDate","getMyPurchaseRequests","today","setMonth","purchaseOptions","aTime","request_date","bTime","aValue","pr","orderNumber","purchase_order_number","vendorName","vendor_name","firstItem","purchase_request_items","item_name","label","searchText","requester_name","toLowerCase","value","String","inquiryTypeOptions","selectedPurchaseItems","line_number","Number","MAX_SAFE_INTEGER","itemOptions","item","specification","measureTextWidthPx","text","document","current","createElement","context","getContext","font","bodyStyle","window","getComputedStyle","body","fontFamily","fontWeight","getMeasureFont","ceil","measureText","width","getLabelWidthEm","padding","min","max","getSelectLabelMaxPx","options","reduce","option","getSelectControlWidthPx","maxLabelPx","base","getMenuWidthPx","inquiryTypePlaceholder","inquiryTypeControlWidthEm","inquiryTypeMenuWidthEm","purchaseSelectPlaceholder","purchaseControlWidthPx","purchaseMenuWidthPx","itemSelectPlaceholder","itemControlWidthPx","itemMenuWidthPx","priceChangeTypeOptions","formatNumericInput","numericValue","isFinite","toLocaleString","dateRangeWidthEm","getCompactSelectStyles","controlWidthPx","menuWidthPx","control","minHeight","height","fontSize","borderRadius","borderColor","boxShadow","container","maxWidth","valueContainer","input","margin","indicatorsContainer","whiteSpace","overflow","textOverflow","color","singleValue","menu","minWidth","menuList","updateQuantityRow","rowId","updates","updatePriceRow","handleStatusUpdate","inquiryId","newStatus","resolutionNote","resolveInquiry","updateInquiryStatus","expandedInquiryObj","find","cancelled","cached","get","load","getInquiryMessages","el","prevTop","scrollTop","isFirstLoad","atBottom","scrollHeight","clientHeight","set","update","is_read","read_at","in","markAsRead","subscribeToInquiryMessages","useLayoutEffect","restore","cancelEditItem","getStatusBadge","status","getInquiryTypeLabel","type","renderInquiryPayloadSummary","inquiry","inquiry_payload","inquiry_type","current_date","requested_date","items","index","current_quantity","new_quantity","item_id","change_type","current_amount","new_amount","current_unit_price","new_unit_price","reason","Card","CardHeader","CardTitle","MessageCircle","CardContent","onSubmit","preventDefault","fetch","method","headers","JSON","stringify","location","messageLength","selectedPurchaseId","timestamp","sessionId","runId","hypothesisId","catch","hasMessage","requiresPurchase","subjectText","finalMessage","purchaseInfo","inquiryPayload","summaryLines","currentDateText","delivery_request_date","format","requestedDateText","push","activeRows","rows","itemsPayload","hasQuantity","targetItem","quantity","hasValue","currentUnitPrice","unit_price_value","unit_price","currentAmount","amount_value","quantityValue","newAmount","newUnitPrice","itemsText","join","messageSections","createInquiry","subject","purchase_request_id","purchase_info","createdId","Select","onValueChange","SelectTrigger","size","style","SelectValue","SelectContent","SelectItem","ReactSelect","onChange","isSearchable","isLoading","noOptionsMessage","filterOption","inputValue","keyword","styles","DatePickerPopover","onDateSelect","side","selectedItem","isDisabled","Input","target","removeQuantityRow","Trash2","Plus","currentUnitPriceLabel","currentAmountLabel","placeholderText","inputMode","replace","removePriceRow","Textarea","maxLength","attachment","src","url","alt","name","deleteAttachment","path","_","handleRemoveAttachment","title","ref","accept","files","file","startsWith","uploadAttachment","click","Fragment","Loader2","AlertCircle","limit","maybeSingle","openPurchaseDetailFromInquiry","user_name","user_email","resolution_note","confirm","deleteInquiry","handleDeleteInquiry","ChevronUp","ChevronDown","handled_by","processed_at","href","rel","handleResolveFromChat","m","isSystem","sender_role","isMine","sender_email","sendInquiryMessage","senderRole","handleSendChat","Dialog","DialogContent","DialogHeader","DialogTitle","deletePurchaseRequest","removePurchaseFromMemory","autoFocus","parseInt","parseFloat","remark","link","Eye","totalPrice","updatePurchaseRequestItem","saveEditItem","Save","startEditItem","Edit2","deletePurchaseRequestItem","deleteItem","colSpan","sum","notes","PurchaseDetailModal","purchaseId","isOpen","onClose","activeTab","onDelete","purchase","AlertDialog","AlertDialogContent","AlertDialogHeader","AlertDialogTitle","AlertDialogDescription","AlertDialogFooter","AlertDialogCancel","AlertDialogAction","purchaseIdForDelete","isNaN","inquiryUpdateError","itemsError","delete","requestError","Error","showCloseButton"],"mappings":"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","x_google_ignoreList":[0,1]}