import{c as Re,a as me,r as i,j as e,M as re,B as g,F as Ae}from"./index-DURjiRtV.js";import{C as ne,a as ce,b as le,c as ie,S as $e}from"./card-D7c8b6xy.js";import{I as w}from"./input-DR32zq7D.js";import{T as oe}from"./textarea-CBM0nzX1.js";import{S as ze,a as Te,b as Le,c as Ue,d as D,C as ue}from"./select-BOfJLo8C.js";import{B as b,t as x}from"./index-DgYLmkP3.js";import{D as Fe,a as Be,b as He,c as We}from"./dialog-BOugK96I.js";import{C as Oe,a as Ke}from"./circle-check-big-BuVt1Qd6.js";import{a as de}from"./chevron-down-Diu47hfg.js";import{C as Ve,E as Ge}from"./eye-Dp6JYudF.js";import{T as B}from"./trash-2-CdcJ6l8T.js";import{S as Je}from"./save-CLakp-ew.js";import{f as R,P as Qe}from"./format-NvEY_HGk.js";/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],Ye=Re("send",Xe);class Ze{constructor(){this.supabase=me()}async createInquiry(a){try{const{data:{user:t},error:n}=await this.supabase.auth.getUser();if(n||!t)return{success:!1,error:"ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤."};const{data:c}=await this.supabase.from("employees").select("id, name, email").eq("email",t.email).maybeSingle(),{error:d}=await this.supabase.from("support_inquires").insert({user_id:t.id,user_email:c?.email||t.email,user_name:c?.name||"",requester_id:c?.id,inquiry_type:a.inquiry_type,subject:a.subject,message:a.message,purchase_info:a.purchase_info,purchase_order_number:a.purchase_order_number,status:"open"});return d?(console.error("ë¬¸ì˜ ë“±ë¡ ì—ëŸ¬:",d),console.error("ì—ëŸ¬ ìƒì„¸:",{code:d.code,message:d.message,details:d.details,hint:d.hint}),{success:!1,error:d.message}):{success:!0}}catch(t){return{success:!1,error:t instanceof Error?t.message:"ë¬¸ì˜ ì ‘ìˆ˜ ì‹¤íŒ¨"}}}async getMyInquiries(){try{console.log("ðŸ” getMyInquiries ì‹œìž‘");const{data:{user:a},error:t}=await this.supabase.auth.getUser();if(t||!a)return console.log("âŒ ì¸ì¦ ì—ëŸ¬:",t),{success:!1,data:[],error:"ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤."};console.log("ðŸ‘¤ í˜„ìž¬ ì‚¬ìš©ìž:",a.id,a.email);const{data:n,error:c}=await this.supabase.from("support_inquires").select("*").eq("user_id",a.id).order("created_at",{ascending:!1});if(console.log("ðŸ“Š ë¬¸ì˜ ì¿¼ë¦¬ ê²°ê³¼:",{data:n,error:c}),c)throw console.error("âŒ ë¬¸ì˜ ì¡°íšŒ ì—ëŸ¬:",c),c;return console.log("âœ… ë‚´ ë¬¸ì˜ ëª©ë¡ ì¡°íšŒ ì„±ê³µ:",n?.length||0,"ê±´"),{success:!0,data:n||[]}}catch(a){return console.error("âŒ getMyInquiries ì˜ˆì™¸:",a),{success:!1,data:[],error:a instanceof Error?a.message:"ë¬¸ì˜ ì¡°íšŒ ì‹¤íŒ¨"}}}async getAllInquiries(){try{console.log("ðŸ” getAllInquiries ì‹œìž‘ (ê´€ë¦¬ìžìš©)");const{data:a,error:t}=await this.supabase.from("support_inquires").select("*").order("created_at",{ascending:!1});if(console.log("ðŸ“Š ì „ì²´ ë¬¸ì˜ ì¿¼ë¦¬ ê²°ê³¼:",{data:a,error:t}),t)throw console.error("âŒ ì „ì²´ ë¬¸ì˜ ì¡°íšŒ ì—ëŸ¬:",t),t;return console.log("âœ… ì „ì²´ ë¬¸ì˜ ëª©ë¡ ì¡°íšŒ ì„±ê³µ:",a?.length||0,"ê±´"),{success:!0,data:a||[]}}catch(a){return console.error("âŒ getAllInquiries ì˜ˆì™¸:",a),{success:!1,data:[],error:a instanceof Error?a.message:"ë¬¸ì˜ ì¡°íšŒ ì‹¤íŒ¨"}}}async updateInquiryStatus(a,t,n){try{const{data:{user:c},error:d}=await this.supabase.auth.getUser();if(d||!c)return{success:!1,error:"ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤."};const{data:h}=await this.supabase.from("employees").select("name").eq("email",c.email).single(),p={status:t,handled_by:h?.name||c.email,updated_at:new Date().toISOString()};(t==="resolved"||t==="closed")&&(p.processed_at=new Date().toISOString()),n&&(p.resolution_note=n);const{error:_}=await this.supabase.from("support_inquires").update(p).eq("id",a);if(_)throw _;return{success:!0}}catch(c){return{success:!1,error:c instanceof Error?c.message:"ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨"}}}async getMyPurchaseRequests(a,t){try{const{data:{user:n},error:c}=await this.supabase.auth.getUser();if(c||!n)return{success:!1,data:[],error:"ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤."};const{data:d}=await this.supabase.from("employees").select("name").eq("email",n.email).single();if(!d)return{success:!1,data:[],error:"ì‚¬ìš©ìž ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."};let h=this.supabase.from("purchase_requests").select("id,purchase_order_number,vendor_name,request_date,requester_name,purchase_request_items(item_name,specification,quantity)").eq("requester_name",d.name).order("request_date",{ascending:!1});a&&(h=h.gte("request_date",a)),t&&(h=h.lte("request_date",t));const{data:p,error:_}=await h.limit(100);if(_)throw _;return{success:!0,data:p||[]}}catch(n){return{success:!1,data:[],error:n instanceof Error?n.message:"ë°œì£¼ìš”ì²­ ì¡°íšŒ ì‹¤íŒ¨"}}}subscribeToInquiries(a){return this.supabase.channel("support_inquires_changes").on("postgres_changes",{event:"*",schema:"public",table:"support_inquires"},a).subscribe()}async updatePurchaseRequestItem(a,t){try{const n={};t.item_name!==void 0&&(n.item_name=t.item_name),t.specification!==void 0&&(n.specification=t.specification),t.quantity!==void 0&&(n.quantity=t.quantity),t.remark!==void 0&&(n.remark=t.remark),t.unit_price_value!==void 0&&(n.unit_price_value=t.unit_price_value,n.unit_price_currency="KRW"),t.amount_value!==void 0&&(n.amount_value=t.amount_value,n.amount_currency="KRW");const{error:c}=await this.supabase.from("purchase_request_items").update(n).eq("id",a);if(c)throw c;return{success:!0}}catch(n){return{success:!1,error:n instanceof Error?n.message:"í’ˆëª© ìˆ˜ì • ì‹¤íŒ¨"}}}async deletePurchaseRequestItem(a){try{const{error:t}=await this.supabase.from("purchase_request_items").delete().eq("id",a);if(t)throw t;return{success:!0}}catch(t){return{success:!1,error:t instanceof Error?t.message:"í’ˆëª© ì‚­ì œ ì‹¤íŒ¨"}}}async deletePurchaseRequest(a){try{const{error:t}=await this.supabase.from("purchase_request_items").delete().eq("purchase_request_id",a);if(t)throw t;const{error:n}=await this.supabase.from("purchase_requests").delete().eq("id",a);if(n)throw n;return{success:!0}}catch(t){return{success:!1,error:t instanceof Error?t.message:"ë°œì£¼ìš”ì²­ ì‚­ì œ ì‹¤íŒ¨"}}}async getPurchaseRequestDetail(a){try{const{data:t,error:n}=await this.supabase.from("purchase_requests").select("*,purchase_request_items(id,line_number,item_name,specification,quantity,unit_price_value,amount_value,remark,link)").eq("id",a).single();if(n)throw n;return{success:!0,data:t}}catch(t){return{success:!1,error:t instanceof Error?t.message:"ë°œì£¼ìš”ì²­ ì¡°íšŒ ì‹¤íŒ¨"}}}async deleteInquiry(a){try{const{data:{user:t},error:n}=await this.supabase.auth.getUser();if(n||!t)return{success:!1,error:"ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤."};const{data:c}=await this.supabase.from("employees").select("purchase_role").eq("email",t.email).single();if(!c?.purchase_role?.includes("app_admin")){const{data:p,error:_}=await this.supabase.from("support_inquires").select("user_id, status, resolution_note").eq("id",a).single();if(_||!p)return{success:!1,error:"ë¬¸ì˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."};if(p.user_id!==t.id)return{success:!1,error:"ë³¸ì¸ì˜ ë¬¸ì˜ë§Œ ì‚­ì œí•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤."};if(p.resolution_note)return{success:!1,error:"ë‹µë³€ì´ ì™„ë£Œëœ ë¬¸ì˜ëŠ” ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."};if(p.status!=="open")return{success:!1,error:"ì²˜ë¦¬ê°€ ì§„í–‰ëœ ë¬¸ì˜ëŠ” ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."}}const{error:h}=await this.supabase.from("support_inquires").delete().eq("id",a);if(h)throw h;return{success:!0}}catch(t){return{success:!1,error:t instanceof Error?t.message:"ë¬¸ì˜ ì‚­ì œ ì‹¤íŒ¨"}}}}const f=new Ze;function hs(){const[y,a]=i.useState(""),[t,n]=i.useState(""),[c,d]=i.useState(""),[h,p]=i.useState(!1),[_,H]=i.useState(!1),[W,O]=i.useState(""),[K,V]=i.useState(""),[I,G]=i.useState([]),[j,A]=i.useState(null),[J,Q]=i.useState(!1),[q,C]=i.useState(1),[$,xe]=i.useState(null),z=5,[T,X]=i.useState([]),[m,he]=i.useState(null),[pe,ge]=i.useState(""),[fe,k]=i.useState(!0),[L,je]=i.useState(null),[ye,Y]=i.useState(!1),[u,_e]=i.useState(null),[be,es]=i.useState(!1),[N,Z]=i.useState(null),[o,v]=i.useState(null);i.useEffect(()=>{(async()=>{await ee()})();const r=f.subscribeToInquiries(l=>{ee()});return()=>{r.unsubscribe()}},[]);const ee=async()=>{const s=me(),{data:{user:r}}=await s.auth.getUser();if(!r)return;ge(r.email||"");const{data:l}=await s.from("employees").select("purchase_role").eq("email",r.email).single();if(l){const S=Array.isArray(l.purchase_role)?l.purchase_role:l.purchase_role?.split(",").map(U=>U.trim())||[],M=S.includes("app_admin");he(M),console.log("ðŸ‘¤ ì‚¬ìš©ìž ê¶Œí•œ í™•ì¸:",{email:r.email,roles:S,isAdmin:M}),Ne(M)}},Ne=async s=>{console.log("ðŸ”„ loadInquiriesWithRole - isAdmin:",s),k(!0);const r=s?await f.getAllInquiries():await f.getMyInquiries();console.log("ðŸ“‹ ë¬¸ì˜ ëª©ë¡ ë¡œë“œ ê²°ê³¼:",r),r.success?(console.log("âœ… ë¬¸ì˜ ëª©ë¡ ì„¤ì •:",r.data.length,"ê±´"),X(r.data)):console.error("âŒ ë¬¸ì˜ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:",r.error),k(!1)},E=async()=>{if(m===null){console.log("â³ ê¶Œí•œ í™•ì¸ ëŒ€ê¸° ì¤‘...");return}console.log("ðŸ”„ loadInquiries ì‹œìž‘ - isAdmin:",m),k(!0);const s=m?await f.getAllInquiries():await f.getMyInquiries();console.log("ðŸ“‹ ë¬¸ì˜ ëª©ë¡ ë¡œë“œ ê²°ê³¼:",s),s.success?(console.log("âœ… ë¬¸ì˜ ëª©ë¡ ì„¤ì •:",s.data.length,"ê±´"),X(s.data)):console.error("âŒ ë¬¸ì˜ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:",s.error),k(!1)};i.useEffect(()=>{y==="modify"||y==="delete"?H(!0):(H(!1),A(null))},[y]);const ve=async()=>{Q(!0),C(1);const s=await f.getMyPurchaseRequests(W,K);s.success?G(s.data):x.error(s.error||"ë°œì£¼ìš”ì²­ ì¡°íšŒ ì‹¤íŒ¨"),Q(!1)},P=Math.ceil(I.length/z),se=(q-1)*z,we=se+z,qe=I.slice(se,we),Se=async s=>{if(s.preventDefault(),!y||!t||!c){x.error("ëª¨ë“  í•„ë“œë¥¼ ìž…ë ¥í•´ì£¼ì„¸ìš”.");return}if((y==="modify"||y==="delete")&&!j){x.error("ìˆ˜ì •/ì‚­ì œí•  ë°œì£¼ìš”ì²­ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");return}p(!0);let r=c,l="";if(j){const U=(j.purchase_request_items||[]).map(F=>`- ${F.item_name} (${F.specification}) ${F.quantity}ê°œ`).join(`
`);l=`ë°œì£¼ë²ˆí˜¸: ${j.purchase_order_number}
ì—…ì²´: ${j.vendor_name}
ìš”ì²­ìž: ${j.requester_name}
ìš”ì²­ì¼: ${j.request_date}
í’ˆëª©:
${U}`,r=`${c}

[ê´€ë ¨ ë°œì£¼ ì •ë³´]
${l}`}const S=await f.createInquiry({inquiry_type:y,subject:t,message:r,purchase_info:l,purchase_order_number:j?.purchase_order_number});S.success?(x.success("ë¬¸ì˜ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤."),a(""),n(""),d(""),A(null),G([]),O(""),V(""),E()):x.error(S.error||"ë¬¸ì˜ ì ‘ìˆ˜ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."),p(!1)},te=async(s,r)=>{const l=await f.updateInquiryStatus(s,r);l.success?(x.success("ìƒíƒœê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤."),E()):x.error(l.error||"ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨")},Ie=async s=>{if(!confirm(`ì •ë§ë¡œ ì´ ë¬¸ì˜ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?
ì‚­ì œëœ ë¬¸ì˜ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`))return;const r=await f.deleteInquiry(s);r.success?(x.success("ë¬¸ì˜ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤."),E()):x.error(r.error||"ë¬¸ì˜ ì‚­ì œ ì‹¤íŒ¨")},Ce=s=>{Z(s.id),v({item_name:s.item_name,specification:s.specification,quantity:s.quantity,unit_price_value:s.unit_price_value,remark:s.remark})},ae=()=>{Z(null),v(null)},ke=async s=>{if(!o)return;const r=(o.quantity||0)*(o.unit_price_value||0),l=await f.updatePurchaseRequestItem(s,{item_name:o.item_name,specification:o.specification,quantity:o.quantity,unit_price_value:o.unit_price_value,amount_value:r,remark:o.remark});l.success?(x.success("í’ˆëª©ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤."),u?.id&&console.log("í’ˆëª© ìˆ˜ì • ì™„ë£Œ, ìƒì„¸ ì •ë³´ ìƒˆë¡œê³ ì¹¨ í•„ìš”"),ae()):x.error(l.error||"í’ˆëª© ìˆ˜ì • ì‹¤íŒ¨")},Ee=async s=>{if(!confirm("ì´ í’ˆëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?"))return;const r=await f.deletePurchaseRequestItem(s);r.success?(x.success("í’ˆëª©ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤."),u?.id&&console.log("í’ˆëª© ìˆ˜ì • ì™„ë£Œ, ìƒì„¸ ì •ë³´ ìƒˆë¡œê³ ì¹¨ í•„ìš”")):x.error(r.error||"í’ˆëª© ì‚­ì œ ì‹¤íŒ¨")},Pe=async()=>{if(!u?.id||!confirm(`ì´ ë°œì£¼ìš”ì²­ ì „ì²´ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?
ëª¨ë“  í’ˆëª©ì´ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.`))return;const s=await f.deletePurchaseRequest(u.id);s.success?(x.success("ë°œì£¼ìš”ì²­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤."),Y(!1),_e(null),E()):x.error(s.error||"ë°œì£¼ìš”ì²­ ì‚­ì œ ì‹¤íŒ¨")},Me=s=>{switch(s){case"open":return e.jsx(b,{className:"bg-yellow-100 text-yellow-800",children:"ëŒ€ê¸°"});case"in_progress":return e.jsx(b,{className:"bg-blue-100 text-blue-800",children:"ì²˜ë¦¬ì¤‘"});case"resolved":return e.jsx(b,{className:"bg-green-100 text-green-800",children:"ì™„ë£Œ"});case"closed":return e.jsx(b,{className:"bg-gray-100 text-gray-800",children:"ì¢…ë£Œ"});default:return e.jsx(b,{children:"-"})}},De=s=>{switch(s){case"bug":return"ì˜¤ë¥˜ ì‹ ê³ ";case"modify":return"ìˆ˜ì • ìš”ì²­";case"delete":return"ì‚­ì œ ìš”ì²­";case"other":return"ê¸°íƒ€ ë¬¸ì˜";default:return s}};return m===null?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"ê¶Œí•œ í™•ì¸ ì¤‘..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"ë¬¸ì˜í•˜ê¸°"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:m?"ëª¨ë“  ë¬¸ì˜ë¥¼ ê´€ë¦¬í•˜ê³  ë‹µë³€í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤":"ì‹œìŠ¤í…œ ì‚¬ìš© ì¤‘ ê¶ê¸ˆí•˜ì‹  ì ì´ë‚˜ ê°œì„ ì‚¬í•­ì„ ì•Œë ¤ì£¼ì„¸ìš”"})]}),e.jsxs("div",{className:`${m?"max-w-4xl":"grid grid-cols-1 xl:grid-cols-2 gap-4"}`,children:[!m&&e.jsxs(ne,{children:[e.jsx(ce,{children:e.jsxs(le,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5"}),"ë¬¸ì˜ ë‚´ìš©"]})}),e.jsx(ie,{children:e.jsxs("form",{onSubmit:Se,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["ë¬¸ì˜ ìœ í˜• ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(ze,{value:y,onValueChange:a,children:[e.jsx(Te,{children:e.jsx(Le,{placeholder:"ë¬¸ì˜ ìœ í˜•ì„ ì„ íƒí•´ì£¼ì„¸ìš”"})}),e.jsxs(Ue,{children:[e.jsx(D,{value:"bug",children:"ì˜¤ë¥˜ ì‹ ê³ "}),e.jsx(D,{value:"modify",children:"ìˆ˜ì • ìš”ì²­"}),e.jsx(D,{value:"delete",children:"ì‚­ì œ ìš”ì²­"}),e.jsx(D,{value:"other",children:"ê¸°íƒ€ ë¬¸ì˜"})]})]})]}),_&&e.jsxs("div",{className:"space-y-3 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("div",{className:"text-sm font-medium text-blue-900",children:"ìˆ˜ì •/ì‚­ì œí•  ë°œì£¼ìš”ì²­ ì„ íƒ"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"ì‹œìž‘ì¼"}),e.jsx(w,{type:"date",value:W,onChange:s=>O(s.target.value),className:"h-9"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"ì¢…ë£Œì¼"}),e.jsx(w,{type:"date",value:K,onChange:s=>V(s.target.value),className:"h-9"})]})]}),e.jsx(g,{type:"button",onClick:ve,disabled:J,className:"w-full h-9",variant:"outline",children:J?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-600 border-t-transparent rounded-full animate-spin mr-2"}),"ê²€ìƒ‰ ì¤‘..."]}):e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"ë°œì£¼ìš”ì²­ ê²€ìƒ‰"]})}),I.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-xs text-gray-600",children:["ë°œì£¼ìš”ì²­ ì„ íƒ (ì´ ",I.length,"ê±´)"]}),e.jsx("div",{className:"space-y-1",children:qe.map(s=>e.jsxs("div",{className:"border rounded overflow-hidden",children:[e.jsx("div",{onClick:()=>A(s),className:`px-3 py-2 cursor-pointer transition-all text-xs ${j?.id===s.id?"border-blue-500 bg-blue-50":"hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("span",{className:"font-medium whitespace-nowrap",children:s.purchase_order_number||"N/A"}),e.jsx("span",{className:"text-gray-600 truncate",children:s.vendor_name}),e.jsxs("span",{className:"text-gray-500",children:[s.purchase_request_items?.[0]?.item_name||"í’ˆëª© ì—†ìŒ",s.purchase_request_items?.length>1&&e.jsx("span",{className:"font-medium text-blue-600",children:` ì™¸ ${s.purchase_request_items.length-1}ê±´`})]}),e.jsx("span",{className:"text-gray-400 whitespace-nowrap ml-auto",children:s.request_date&&R(new Date(s.request_date),"MM/dd")})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[j?.id===s.id&&e.jsx(Oe,{className:"w-4 h-4 text-blue-500 flex-shrink-0"}),s.purchase_request_items?.length>1&&e.jsx("button",{type:"button",onClick:r=>{r.stopPropagation(),xe($===s.id?null:s.id)},className:"p-1 hover:bg-gray-200 rounded",children:$===s.id?e.jsx(ue,{className:"w-4 h-4"}):e.jsx(de,{className:"w-4 h-4"})})]})]})}),$===s.id&&s.purchase_request_items?.length>0&&e.jsx("div",{className:"px-3 py-2 bg-gray-50 border-t text-xs",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-gray-700 mb-1",children:"í’ˆëª© ìƒì„¸"}),s.purchase_request_items.map((r,l)=>e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 pl-2",children:[e.jsxs("span",{className:"text-gray-400",children:[l+1,"."]}),e.jsx("span",{children:r.item_name}),r.specification&&e.jsxs("span",{className:"text-gray-500",children:["(",r.specification,")"]}),e.jsxs("span",{className:"text-gray-500",children:["- ",r.quantity,"ê°œ"]})]},l))]})})]},s.id))}),P>1&&e.jsxs("div",{className:"flex justify-center items-center gap-1 pt-2",children:[e.jsx(g,{type:"button",variant:"outline",size:"sm",onClick:()=>C(Math.max(1,q-1)),disabled:q===1,className:"h-8 w-8 p-0",children:e.jsx(Ke,{className:"w-4 h-4"})}),Array.from({length:P},(s,r)=>r+1).map(s=>e.jsx(g,{type:"button",variant:q===s?"default":"outline",size:"sm",onClick:()=>C(s),className:"h-8 w-8 p-0",children:s},s)),e.jsx(g,{type:"button",variant:"outline",size:"sm",onClick:()=>C(Math.min(P,q+1)),disabled:q===P,className:"h-8 w-8 p-0",children:e.jsx(Ve,{className:"w-4 h-4"})})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["ì œëª© ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(w,{value:t,onChange:s=>n(s.target.value),placeholder:"ë¬¸ì˜ ì œëª©ì„ ìž…ë ¥í•´ì£¼ì„¸ìš”",maxLength:100})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["ë‚´ìš© ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(oe,{value:c,onChange:s=>d(s.target.value),placeholder:"ë¬¸ì˜ ë‚´ìš©ì„ ìžì„¸ížˆ ìž…ë ¥í•´ì£¼ì„¸ìš”",rows:6,maxLength:1e3}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[c.length,"/1000"]})]}),e.jsx(g,{type:"submit",className:"w-full",disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"ì „ì†¡ ì¤‘..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ye,{className:"w-4 h-4 mr-2"}),"ë¬¸ì˜ ë³´ë‚´ê¸°"]})})]})})]}),e.jsxs(ne,{children:[e.jsx(ce,{children:e.jsxs(le,{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"w-5 h-5 text-orange-500"}),m?"ì „ì²´ ë¬¸ì˜ ëª©ë¡":"ë‚´ ë¬¸ì˜ ë‚´ì—­"]}),e.jsxs(b,{variant:"outline",children:[T.length,"ê±´"]})]})}),e.jsx(ie,{children:fe?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"w-6 h-6 border-2 border-gray-300 border-t-transparent rounded-full animate-spin"})}):T.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(re,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"ë¬¸ì˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤"})]}):e.jsx("div",{className:"space-y-1 max-h-[600px] overflow-y-auto",children:T.map(s=>e.jsxs("div",{className:"border rounded overflow-hidden",children:[e.jsx("div",{className:"px-3 py-2 hover:bg-gray-50 transition-colors cursor-pointer",onClick:()=>{je(L===s.id?null:s.id)},children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx(b,{variant:"outline",className:"text-xs whitespace-nowrap",children:De(s.inquiry_type)}),Me(s.status),e.jsx("span",{className:"text-sm font-medium truncate",children:s.subject}),m&&e.jsx("span",{className:"text-xs text-gray-500",children:s.user_name||s.user_email}),s.purchase_order_number&&e.jsxs("span",{className:"text-xs text-blue-600",children:["[",s.purchase_order_number,"]"]}),e.jsx("span",{className:"text-xs text-gray-400 ml-auto whitespace-nowrap",children:s.created_at&&R(new Date(s.created_at),"MM/dd HH:mm")})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[m&&s.status==="open"&&e.jsx(g,{size:"sm",variant:"outline",onClick:r=>{r.stopPropagation(),te(s.id,"in_progress")},className:"h-6 text-xs px-2",children:"ì²˜ë¦¬ì¤‘"}),m&&(s.status==="open"||s.status==="in_progress")&&e.jsx(g,{size:"sm",onClick:r=>{r.stopPropagation(),te(s.id,"resolved")},className:"h-6 text-xs px-2 bg-green-600 hover:bg-green-700",children:"ì™„ë£Œ"}),(m||s.status==="open"&&!s.resolution_note&&s.user_email===pe)&&e.jsx(g,{size:"sm",variant:"ghost",onClick:r=>{r.stopPropagation(),Ie(s.id)},className:"h-6 w-6 p-0 hover:bg-red-50",title:"ë¬¸ì˜ ì‚­ì œ",children:e.jsx(B,{className:"w-3 h-3 text-red-600"})}),e.jsx("button",{type:"button",className:"p-1 hover:bg-gray-200 rounded",children:L===s.id?e.jsx(ue,{className:"w-4 h-4"}):e.jsx(de,{className:"w-4 h-4"})})]})]})}),L===s.id&&e.jsx("div",{className:"px-3 py-3 bg-gray-50 border-t text-sm",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"ë‚´ìš©:"}),e.jsx("p",{className:"text-gray-600 mt-1 whitespace-pre-wrap",children:s.message})]}),s.purchase_order_number&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"ê´€ë ¨ ë°œì£¼ë²ˆí˜¸:"}),e.jsx("span",{className:"text-blue-600 ml-2",children:s.purchase_order_number})]}),s.handled_by&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"ì²˜ë¦¬ìž:"}),e.jsxs("span",{className:"text-green-600 ml-2",children:[s.handled_by,s.processed_at&&` (${R(new Date(s.processed_at),"yyyy-MM-dd HH:mm")})`]})]}),s.resolution_note&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"ì²˜ë¦¬ ë‚´ìš©:"}),e.jsx("p",{className:"text-gray-600 mt-1",children:s.resolution_note})]})]})})]},s.id))})})]})]})]}),e.jsx(Fe,{open:ye,onOpenChange:Y,children:e.jsxs(Be,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsx(He,{children:e.jsxs(We,{className:"flex items-center justify-between text-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"ë°œì£¼ìš”ì²­ ìƒì„¸"}),u?.purchase_order_number&&e.jsx(b,{variant:"outline",className:"font-normal",children:u.purchase_order_number})]}),m&&u&&e.jsxs(g,{variant:"destructive",size:"sm",onClick:Pe,className:"h-8 px-3",children:[e.jsx(B,{className:"w-4 h-4 mr-1"}),"ì „ì²´ ì‚­ì œ"]})]})}),be?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"w-6 h-6 border-2 border-gray-300 border-t-transparent rounded-full animate-spin"})}):u&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wider",children:"ë°œì£¼ë²ˆí˜¸"}),e.jsx("p",{className:"font-semibold text-sm mt-1",children:u.purchase_order_number||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wider",children:"ì—…ì²´ëª…"}),e.jsx("p",{className:"font-semibold text-sm mt-1",children:u.vendor_name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wider",children:"ìš”ì²­ìž"}),e.jsx("p",{className:"font-semibold text-sm mt-1",children:u.requester_name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wider",children:"ìš”ì²­ì¼"}),e.jsx("p",{className:"font-semibold text-sm mt-1",children:u.request_date&&R(new Date(u.request_date),"yyyy-MM-dd")})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-base mb-3",children:"í’ˆëª© ìƒì„¸"}),e.jsx("div",{className:"border rounded-lg overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left text-xs font-medium text-gray-700 px-3 py-3 w-12",children:"ë²ˆí˜¸"}),e.jsx("th",{className:"text-left text-xs font-medium text-gray-700 px-3 py-3 min-w-[180px]",children:"í’ˆëª…"}),e.jsx("th",{className:"text-left text-xs font-medium text-gray-700 px-3 py-3 min-w-[150px]",children:"ê·œê²©"}),e.jsx("th",{className:"text-center text-xs font-medium text-gray-700 px-3 py-3 w-20",children:"ìˆ˜ëŸ‰"}),e.jsx("th",{className:"text-right text-xs font-medium text-gray-700 px-3 py-3 w-28",children:"ë‹¨ê°€"}),e.jsx("th",{className:"text-right text-xs font-medium text-gray-700 px-3 py-3 w-32",children:"ê¸ˆì•¡"}),e.jsx("th",{className:"text-left text-xs font-medium text-gray-700 px-3 py-3 min-w-[150px]",children:"ë¹„ê³ "}),e.jsx("th",{className:"text-center text-xs font-medium text-gray-700 px-3 py-3 w-16",children:"ë§í¬"}),m&&e.jsx("th",{className:"text-center text-xs font-medium text-gray-700 px-3 py-3 w-24",children:"ìž‘ì—…"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:u.purchase_request_items?.map((s,r)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"text-sm px-3 py-3 text-center font-medium text-gray-600",children:s.line_number||r+1}),e.jsx("td",{className:"text-sm px-3 py-3",children:N===s.id?e.jsx(w,{value:o?.item_name||"",onChange:l=>v({...o,item_name:l.target.value}),className:"h-9 text-sm w-full",autoFocus:!0}):e.jsx("span",{className:"font-medium text-gray-900",children:s.item_name})}),e.jsx("td",{className:"text-sm px-3 py-3",children:N===s.id?e.jsx(w,{value:o?.specification||"",onChange:l=>v({...o,specification:l.target.value}),className:"h-9 text-sm w-full"}):e.jsx("span",{className:"text-gray-600",children:s.specification||"-"})}),e.jsx("td",{className:"text-sm text-center px-3 py-3",children:N===s.id?e.jsx(w,{type:"number",value:o?.quantity||"",onChange:l=>v({...o,quantity:parseInt(l.target.value)}),className:"h-9 text-sm text-center w-full"}):e.jsx("span",{className:"font-medium",children:s.quantity})}),e.jsx("td",{className:"text-sm text-right px-3 py-3",children:N===s.id?e.jsx(w,{type:"number",value:o?.unit_price_value||"",onChange:l=>v({...o,unit_price_value:parseInt(l.target.value)}),className:"h-9 text-sm text-right w-full"}):e.jsx("span",{className:"font-medium",children:s.unit_price_value?`${parseFloat(s.unit_price_value).toLocaleString()}`:"-"})}),e.jsx("td",{className:"text-sm text-right px-3 py-3",children:N===s.id?e.jsx("span",{className:"font-semibold text-blue-600",children:((o?.quantity||0)*(o?.unit_price_value||0)).toLocaleString()}):e.jsx("span",{className:"font-semibold text-blue-600",children:s.amount_value?`${parseFloat(s.amount_value).toLocaleString()}`:"-"})}),e.jsx("td",{className:"text-sm px-3 py-3",children:N===s.id?e.jsx(oe,{value:o?.remark||"",onChange:l=>v({...o,remark:l.target.value}),className:"h-9 text-sm w-full resize-none",rows:1}):e.jsx("span",{className:"text-gray-600 text-xs",children:s.remark||"-"})}),e.jsx("td",{className:"text-sm text-center px-3 py-3",children:s.link?e.jsx("a",{href:s.link,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center justify-center w-8 h-8 rounded hover:bg-blue-50 text-blue-600",children:e.jsx(Ge,{className:"w-4 h-4"})}):e.jsx("span",{className:"text-gray-400",children:"-"})}),m&&e.jsx("td",{className:"text-sm text-center px-3 py-3",children:N===s.id?e.jsxs("div",{className:"flex justify-center gap-1",children:[e.jsxs(g,{size:"sm",onClick:()=>ke(s.id),className:"h-8 px-2 bg-green-600 hover:bg-green-700",children:[e.jsx(Je,{className:"w-4 h-4 mr-1"}),"ì €ìž¥"]}),e.jsx(g,{size:"sm",variant:"outline",onClick:ae,className:"h-8 px-2",children:"ì·¨ì†Œ"})]}):e.jsxs("div",{className:"flex justify-center gap-1",children:[e.jsx(g,{size:"sm",variant:"ghost",onClick:()=>Ce(s),className:"h-8 w-8 p-0 hover:bg-blue-50",children:e.jsx(Qe,{className:"w-4 h-4 text-blue-600"})}),e.jsx(g,{size:"sm",variant:"ghost",onClick:()=>Ee(s.id),className:"h-8 w-8 p-0 hover:bg-red-50",children:e.jsx(B,{className:"w-4 h-4 text-red-600"})})]})})]},s.id))}),e.jsx("tfoot",{className:"bg-gray-50 border-t-2",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:5,className:"text-sm font-semibold text-right px-3 py-3",children:"í•©ê³„"}),e.jsx("td",{className:"text-sm font-bold text-right px-3 py-3 text-blue-600",children:u.purchase_request_items?.reduce((s,r)=>s+(parseFloat(r.amount_value)||0),0).toLocaleString()}),e.jsx("td",{colSpan:m?3:2,className:"px-3 py-3"})]})})]})})]}),u.notes&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"ë¹„ê³ "}),e.jsx("p",{className:"text-sm text-gray-600 p-3 bg-gray-50 rounded-lg",children:u.notes})]})]})]})})]})}export{hs as default};
//# sourceMappingURL=SupportMain-De-tHqFZ.js.map
