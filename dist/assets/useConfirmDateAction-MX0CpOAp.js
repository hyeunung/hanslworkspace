import{r as e,j as t,a,l as r}from"./index-d-YGDSGA.js";import{a as i,k as n}from"./calendar-D_-CL7g0.js";import{P as s,a as c,b as d}from"./popover-MjWsbupH.js";import{t as o}from"./index-CNk7Iw9X.js";function l({children:a,onDateSelect:r,disabled:o=!1,placeholder:l="날짜를 선택하세요",align:m="center",side:u="bottom"}){const[f,_]=e.useState(!1);return t.jsxs(s,{open:f,onOpenChange:_,children:[t.jsx(c,{asChild:!0,disabled:o,children:a}),t.jsx(d,{className:"w-auto p-0 border-gray-200 shadow-lg",align:m,side:u,sideOffset:8,children:t.jsxs("div",{className:"bg-white business-radius-card p-2",children:[t.jsx("div",{className:"mb-2 px-1",children:t.jsx("div",{className:"modal-label text-gray-600 text-center",children:l})}),t.jsx(i,{mode:"single",selected:void 0,onSelect:e=>{(e=>{e&&(r(e),_(!1))})(e)},locale:n,initialFocus:!0,className:"compact-calendar",disabled:!1,fromDate:new Date("2020-01-01"),toDate:new Date("2030-12-31"),defaultMonth:new Date,modifiers:{today:new Date},modifiersClassNames:{today:"bg-blue-500 text-white font-semibold cursor-pointer hover:bg-blue-600 rounded-md"}})]})})]})}function m({config:t,currentUserName:i,canPerformAction:n,onUpdate:s,onOptimisticUpdate:c}){const d=a(),l=e.useCallback(async(e,a,l)=>{if(!n)return r.warn("❌ 권한 없음",{canPerformAction:n}),void o.error(("statement_received"===t.field?"거래명세서":"입고")+" 확인 권한이 없습니다.");const m="number"==typeof e?e:Number(e);if(Number.isNaN(m))return r.error("❌ 잘못된 ID",{itemId:e,numericId:m}),void o.error("유효하지 않은 항목 ID 입니다.");if(l){const e=`품목명: ${l.item_name||"-"}\n규격: ${l.specification||"-"}\n수량: ${l.quantity?.toLocaleString()||0}\n단가: ₩${l.unit_price_value?.toLocaleString()||0}\n합계: ₩${l.amount_value?.toLocaleString()||0}\n비고: ${l.remark||"-"}\n\n${t.confirmMessage.confirm}`;if(!window.confirm(e))return}try{let e;"statement_received"===t.field?e={is_statement_received:!0,statement_received_date:a.toISOString(),statement_received_by_name:i}:"actual_received"===t.field&&(e={actual_received_date:a.toISOString()});const{data:n,error:u}=await d.from("purchase_request_items").update(e).eq("id",m).select();if(u)throw r.error("❌ DB 업데이트 실패",u),u;r.info("✅ DB 업데이트 성공"),c&&c({itemId:m,selectedDate:a,action:"confirm",itemInfo:l}),s&&s(),o.success(t.successMessage.confirm)}catch(u){r.error("❌ 전체 처리 실패",u),o.error(("statement_received"===t.field?"거래명세서":"입고")+" 확인 처리 중 오류가 발생했습니다.")}},[t,i,n,s,c,d]),m=e.useCallback(async(e,a)=>{if(!n)return void o.error(("statement_received"===t.field?"거래명세서":"입고")+" 확인 권한이 없습니다.");const i="number"==typeof e?e:Number(e);if(Number.isNaN(i))o.error("유효하지 않은 항목 ID 입니다.");else{if(a){const e=`품목명: ${a.item_name||"-"}\n규격: ${a.specification||"-"}\n수량: ${a.quantity?.toLocaleString()||0}\n단가: ₩${a.unit_price_value?.toLocaleString()||0}\n합계: ₩${a.amount_value?.toLocaleString()||0}\n비고: ${a.remark||"-"}\n\n${t.confirmMessage.cancel}`;if(!window.confirm(e))return}try{let e;"statement_received"===t.field?e={is_statement_received:!1,statement_received_date:null,statement_received_by_name:null}:"actual_received"===t.field&&(e={actual_received_date:null});const{data:n,error:l}=await d.from("purchase_request_items").update(e).eq("id",i).select();if(l)throw r.error("❌ DB 업데이트 실패",l),l;r.info(`✅ ${t.field} 확인 취소 성공`),c&&c({itemId:i,action:"cancel",itemInfo:a}),s&&s(),o.success(t.successMessage.cancel)}catch(l){r.error(`❌ ${t.field} 확인 취소 실패`,l),o.error(("statement_received"===t.field?"거래명세서":"입고")+" 확인 취소 중 오류가 발생했습니다.")}}},[t,n,s,c,d]),u=e.useCallback(e=>"statement_received"===t.field?e.is_statement_received:"actual_received"===t.field&&!!e.actual_received_date,[t.field]),f=e.useCallback(e=>"statement_received"===t.field?e.statement_received_date:"actual_received"===t.field?e.actual_received_date:null,[t.field]),_=e.useCallback(e=>"statement_received"===t.field?e.statement_received_by_name:(t.field,null),[t.field]);return{config:t,handleConfirm:l,handleCancel:m,isCompleted:u,getCompletedDate:f,getCompletedByName:_}}export{l as D,m as u};
//# sourceMappingURL=useConfirmDateAction-MX0CpOAp.js.map
