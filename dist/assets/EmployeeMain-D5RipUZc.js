import{a as te,l as C,r as m,j as e,b as y,X as ce,_ as ie}from"./index-Dv9d16If.js";import{I as O,D as oe,a as de,b as xe,c as he,e as me}from"./input-DUa4cizf.js";import{S as V,a as L,b as U,c as A,d as f}from"./select-DIyFZOqr.js";import{D as ue}from"./download-BhudwEBV.js";import{P as je}from"./plus-D4n6UfPv.js";import{S as pe}from"./search-BA1eViO3.js";import{a as Y}from"./helpers-BMiTuHMe.js";import{B as H,t as N}from"./index-V7ajxhIs.js";import{T as ge,a as fe,b as B,c as g,d as ve,e as p}from"./table-CmddlnI6.js";import{u as be,S,D as ee,a as se,E as ae,b as re,c as R,d as X,T as Z,e as G,M as we,f as Ne,g as k,h as _e,F as ye,i as K,j as M,k as T,l as P,m as $}from"./form-DQFAO8rv.js";import{E as J}from"./eye-Bmp-s4Ec.js";import{T as Q}from"./card-BFToctv8.js";import{u as Se}from"./index.esm-DPO7miKP.js";import"./chevron-down-BMz__SWj.js";import"./label-C9oEPhpt.js";class ke{constructor(){this.supabase=te()}async getEmployees(r){try{let a=this.supabase.from("employees").select("*").order("name");r?.search&&(a=a.or(`
          name.ilike.%${r.search}%,
          email.ilike.%${r.search}%,
          phone.ilike.%${r.search}%,
          position.ilike.%${r.search}%,
          department.ilike.%${r.search}%,
          slack_id.ilike.%${r.search}%
        `)),r?.department&&(a=a.eq("department",r.department)),r?.position&&(a=a.eq("position",r.position)),r?.purchase_role&&(a=a.eq("purchase_role",r.purchase_role)),r?.is_active!==void 0&&(a=a.eq("is_active",r.is_active));const{data:l,error:t}=await a;if(t)throw t;return{success:!0,data:l||[]}}catch(a){return C.error("직원 목록 조회 실패",a),{success:!1,error:a instanceof Error?a.message:"알 수 없는 오류가 발생했습니다."}}}async getEmployee(r){try{const{data:a,error:l}=await this.supabase.from("employees").select("*").eq("id",r).single();if(l)throw l;return{success:!0,data:a}}catch(a){return C.error("직원 조회 실패",a),{success:!1,error:a instanceof Error?a.message:"알 수 없는 오류가 발생했습니다."}}}async createEmployee(r){try{if(r.email){const{data:h}=await this.supabase.from("employees").select("id").eq("email",r.email).single();if(h)return{success:!1,error:"이미 등록된 이메일입니다."}}if(r.slack_id){const{data:h}=await this.supabase.from("employees").select("id").eq("slack_id",r.slack_id).single();if(h)return{success:!1,error:"이미 등록된 Slack ID입니다."}}const a=crypto.randomUUID(),{data:l,error:t}=await this.supabase.from("employees").insert({id:a,...r,purchase_role:r.purchase_role?.join(",")||null,is_active:!0}).select().single();if(t)throw t;return{success:!0,data:l}}catch(a){return C.error("직원 생성 실패",a),{success:!1,error:a instanceof Error?a.message:"알 수 없는 오류가 발생했습니다."}}}async updateEmployee(r,a){try{if(a.email){const{data:v}=await this.supabase.from("employees").select("id").eq("email",a.email).neq("id",r).single();if(v)return{success:!1,error:"이미 등록된 이메일입니다."}}if(a.slack_id){const{data:v}=await this.supabase.from("employees").select("id").eq("slack_id",a.slack_id).neq("id",r).single();if(v)return{success:!1,error:"이미 등록된 Slack ID입니다."}}const l={...a,purchase_role:a.purchase_role?a.purchase_role.join(","):void 0};l.purchase_role===void 0&&delete l.purchase_role;const{data:t,error:h}=await this.supabase.from("employees").update(l).eq("id",r).select().single();if(h)throw h;return{success:!0,data:t}}catch(l){return C.error("직원 수정 실패",l),{success:!1,error:l instanceof Error?l.message:"알 수 없는 오류가 발생했습니다."}}}async deleteEmployee(r){try{const{data:a}=await this.supabase.from("purchase_requests").select("id").eq("requester_id",r).limit(1);if(a&&a.length>0){const{error:l}=await this.supabase.from("employees").update({is_active:!1}).eq("id",r);if(l)throw l;return{success:!0}}else{const{error:l}=await this.supabase.from("employees").delete().eq("id",r);if(l)throw l;return{success:!0}}}catch(a){return C.error("직원 삭제 실패",a),{success:!1,error:a instanceof Error?a.message:"알 수 없는 오류가 발생했습니다."}}}async toggleEmployeeStatus(r){try{const{data:a,error:l}=await this.supabase.from("employees").select("is_active").eq("id",r).single();if(l)throw l;const{data:t,error:h}=await this.supabase.from("employees").update({is_active:!a.is_active}).eq("id",r).select().single();if(h)throw h;return{success:!0,data:t}}catch(a){return C.error("직원 상태 변경 실패",a),{success:!1,error:a instanceof Error?a.message:"알 수 없는 오류가 발생했습니다."}}}async updateEmployeeRole(r,a){try{const{data:l,error:t}=await this.supabase.from("employees").update({purchase_role:a}).eq("id",r).select().single();if(t)throw t;return{success:!0,data:l}}catch(l){return C.error("직원 권한 변경 실패",l),{success:!1,error:l instanceof Error?l.message:"알 수 없는 오류가 발생했습니다."}}}async getDepartments(){try{const{data:r,error:a}=await this.supabase.from("employees").select("department").not("department","is",null).not("department","eq","");if(a)throw a;return{success:!0,data:[...new Set((r||[]).map(t=>t.department))].sort()}}catch(r){return C.error("부서 목록 조회 실패",r),{success:!1,error:r instanceof Error?r.message:"알 수 없는 오류가 발생했습니다."}}}async getPositions(){try{const{data:r,error:a}=await this.supabase.from("employees").select("position").not("position","is",null).not("position","eq","");if(a)throw a;return{success:!0,data:[...new Set((r||[]).map(t=>t.position))].sort()}}catch(r){return C.error("직급 목록 조회 실패",r),{success:!1,error:r instanceof Error?r.message:"알 수 없는 오류가 발생했습니다."}}}async getEmployeesForExport(){try{const{data:r,error:a}=await this.supabase.from("employees").select("*").order("name");if(a)throw a;return{success:!0,data:(r||[]).map(t=>({이름:t.name,이메일:t.email||"",전화번호:t.phone||"",주소:t.adress||"",부서:t.department||"",직급:t.position||"",권한:this.getRoleDisplayName(t.purchase_role),"Slack ID":t.slack_id||"",상태:t.is_active?"활성":"비활성",등록일:t.created_at?new Date(t.created_at).toLocaleDateString("ko-KR"):""}))}}catch(r){return C.error("직원 Excel 내보내기 실패",r),{success:!1,error:r instanceof Error?r.message:"알 수 없는 오류가 발생했습니다."}}}getRoleDisplayName(r){return{app_admin:"앱 관리자",ceo:"CEO",final_approver:"최종 승인자",middle_manager:"중간 관리자","lead buyer":"수석 구매자",buyer:"구매자"}[r||""]||r||"권한 없음"}async checkPermission(r,a){try{const{data:l}=await this.supabase.from("employees").select("purchase_role, is_active").eq("id",r).single();return!l||!l.is_active?{success:!0,hasPermission:!1}:{success:!0,hasPermission:a.includes(l.purchase_role)}}catch(l){return{success:!1,error:l instanceof Error?l.message:"알 수 없는 오류가 발생했습니다."}}}}const D=new ke,Ee=[{value:"app_admin",label:"앱 관리자"},{value:"ceo",label:"CEO"},{value:"final_approver",label:"최종 승인자"},{value:"middle_manager",label:"중간 관리자"},{value:"lead buyer",label:"수석 구매자"},{value:"buyer",label:"구매자"}];function Ce({filters:x,onFiltersChange:r,onExport:a,onCreateNew:l}){const[t,h]=m.useState(x.search||""),[v,I]=m.useState([]),[q,b]=m.useState([]);m.useEffect(()=>{(async()=>{const[F,s]=await Promise.all([D.getDepartments(),D.getPositions()]);F.success&&I(F.data||[]),s.success&&b(s.data||[])})()},[]);const d=n=>{n.preventDefault(),r({...x,search:t.trim()||void 0})},c=n=>{r({...x,department:n==="all"?void 0:n})},_=n=>{r({...x,position:n==="all"?void 0:n})},E=n=>{r({...x,purchase_role:n==="all"?void 0:n==="none"?"":n})},u=n=>{r({...x,is_active:n==="all"?void 0:n==="active"})},o=()=>{h(""),r({})},i=x.search||x.department||x.position||x.purchase_role||x.is_active!==void 0;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-900",children:"직원 관리"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(y,{variant:"outline",onClick:a,className:"flex items-center gap-1 sm:gap-2 text-xs sm:text-sm",children:[e.jsx(ue,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Excel 내보내기"}),e.jsx("span",{className:"sm:hidden",children:"Excel"})]}),e.jsxs(y,{onClick:l,className:"flex items-center gap-1 sm:gap-2 text-xs sm:text-sm",children:[e.jsx(je,{className:"w-3 h-3 sm:w-4 sm:h-4"}),"직원 등록"]})]})]}),e.jsx("div",{className:"bg-white p-3 sm:p-4 rounded-lg border space-y-4",children:e.jsxs("form",{onSubmit:d,className:"flex flex-col sm:flex-row gap-3 sm:gap-4 sm:items-end sm:flex-wrap",children:[e.jsxs("div",{className:"flex-1 sm:min-w-[250px]",children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1",children:"검색"}),e.jsxs("div",{className:"relative",children:[e.jsx(pe,{className:"absolute left-2 sm:left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-3 h-3 sm:w-4 sm:h-4"}),e.jsx(O,{type:"text",placeholder:"이름, 이메일, 전화번호로 검색",value:t,onChange:n=>h(n.target.value),className:"pl-8 sm:pl-10 text-sm h-9"})]})]}),e.jsxs("div",{className:"w-full sm:w-auto sm:min-w-[120px]",children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1",children:"부서"}),e.jsxs(V,{value:x.department||"all",onValueChange:c,children:[e.jsx(L,{className:"h-9",children:e.jsx(U,{})}),e.jsxs(A,{children:[e.jsx(f,{value:"all",children:"전체 부서"}),v.map(n=>e.jsx(f,{value:n,children:n},n))]})]})]}),e.jsxs("div",{className:"w-full sm:w-auto sm:min-w-[120px]",children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1",children:"직급"}),e.jsxs(V,{value:x.position||"all",onValueChange:_,children:[e.jsx(L,{className:"h-9",children:e.jsx(U,{})}),e.jsxs(A,{children:[e.jsx(f,{value:"all",children:"전체 직급"}),q.map(n=>e.jsx(f,{value:n,children:n},n))]})]})]}),e.jsxs("div",{className:"w-full sm:w-auto sm:min-w-[140px]",children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1",children:"권한"}),e.jsxs(V,{value:x.purchase_role||"all",onValueChange:E,children:[e.jsx(L,{className:"h-9",children:e.jsx(U,{})}),e.jsxs(A,{children:[e.jsx(f,{value:"all",children:"전체 권한"}),e.jsx(f,{value:"none",children:"권한 없음"}),Ee.map(n=>e.jsx(f,{value:n.value,children:n.label},n.value))]})]})]}),e.jsxs("div",{className:"w-full sm:w-auto sm:min-w-[100px]",children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1",children:"상태"}),e.jsxs(V,{value:x.is_active===void 0?"all":x.is_active?"active":"inactive",onValueChange:u,children:[e.jsx(L,{className:"h-9",children:e.jsx(U,{})}),e.jsxs(A,{children:[e.jsx(f,{value:"all",children:"전체"}),e.jsx(f,{value:"active",children:"활성"}),e.jsx(f,{value:"inactive",children:"비활성"})]})]})]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsx(y,{type:"submit",className:"flex-1 sm:flex-none h-9 text-sm",children:"검색"}),i&&e.jsxs(y,{type:"button",variant:"outline",onClick:o,className:"flex items-center gap-1 h-9 text-sm",children:[e.jsx(ce,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"초기화"}),e.jsx("span",{className:"sm:hidden",children:"초기"})]})]})]})})]})}function De({employees:x,onEdit:r,onView:a,onRefresh:l}){const[t,h]=m.useState(null),[v,I]=m.useState(null),q=te(),{sortedData:b,sortConfig:d,handleSort:c}=be(x,"name","asc");m.useEffect(()=>{(async()=>{const{data:{user:w}}=await q.auth.getUser();if(w){const{data:j}=await q.from("employees").select("role, purchase_role").eq("id",w.id).single();j&&I(j.role||"")}})()},[]);const _=v==="hr"||v==="admin",E=_,u=_,o=async s=>{h(s.id);try{const w=await D.toggleEmployeeStatus(s.id);w.success?(N.success(`직원이 ${s.is_active?"비활성화":"활성화"}되었습니다.`),l()):N.error(w.error||"상태 변경에 실패했습니다.")}catch{N.error("상태 변경 중 오류가 발생했습니다.")}finally{h(null)}},i=async s=>{if(confirm(`정말로 '${s.name}' 직원을 삭제하시겠습니까?`)){h(s.id);try{const w=await D.deleteEmployee(s.id);w.success?(N.success("직원이 삭제되었습니다."),l()):N.error(w.error||"삭제에 실패했습니다.")}catch{N.error("삭제 중 오류가 발생했습니다.")}finally{h(null)}}},n=s=>({app_admin:"앱 관리자",ceo:"CEO",final_approver:"최종 승인자",middle_manager:"중간 관리자","lead buyer":"수석 구매자",buyer:"구매자"})[s||""]||"권한 없음",F=s=>({app_admin:"bg-purple-100 text-purple-800",ceo:"bg-red-100 text-red-800",final_approver:"bg-hansl-100 text-hansl-800",middle_manager:"bg-green-100 text-green-800","lead buyer":"bg-yellow-100 text-yellow-800",buyer:"bg-gray-100 text-gray-800"})[s||""]||"bg-gray-100 text-gray-600";return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden lg:block border rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ge,{children:[e.jsx(fe,{children:e.jsxs(B,{children:[e.jsx(g,{className:"w-16 min-w-[50px]",children:e.jsx(S,{sortKey:"employeeID",currentSortKey:d.key,sortDirection:d.direction,onSort:()=>c("employeeID"),children:"사번"})}),e.jsx(g,{className:"w-14 min-w-[45px]",children:e.jsx(S,{sortKey:"name",currentSortKey:d.key,sortDirection:d.direction,onSort:()=>c("name"),children:"이름"})}),e.jsx(g,{className:"w-12 min-w-[40px]",children:e.jsx(S,{sortKey:"position",currentSortKey:d.key,sortDirection:d.direction,onSort:()=>c("position"),children:"직급"})}),e.jsx(g,{className:"w-16 min-w-[50px]",children:e.jsx(S,{sortKey:"department",currentSortKey:d.key,sortDirection:d.direction,onSort:()=>c("department"),children:"부서"})}),e.jsx(g,{className:"w-20 min-w-[70px]",children:e.jsx(S,{sortKey:"phone",currentSortKey:d.key,sortDirection:d.direction,onSort:()=>c("phone"),children:"연락처"})}),e.jsx(g,{className:"w-32 min-w-[100px]",children:e.jsx(S,{sortKey:"email",currentSortKey:d.key,sortDirection:d.direction,onSort:()=>c("email"),children:"이메일"})}),e.jsx(g,{className:"w-11 min-w-[40px] text-center",children:"생성"}),e.jsx(g,{className:"w-11 min-w-[40px] text-center",children:"사용"}),e.jsx(g,{className:"w-11 min-w-[40px] text-center",children:"남은"}),e.jsx(g,{className:"hidden lg:table-cell w-18 min-w-[60px]",children:e.jsx(S,{sortKey:"join_date",currentSortKey:d.key,sortDirection:d.direction,onSort:()=>c("join_date"),children:"입사일"})}),e.jsx(g,{className:"hidden lg:table-cell w-20 min-w-[70px]",children:e.jsx(S,{sortKey:"birthday",currentSortKey:d.key,sortDirection:d.direction,onSort:()=>c("birthday"),children:"생년월일"})}),_&&e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"hidden xl:table-cell w-14 min-w-[45px]",children:"은행"}),e.jsx(g,{className:"hidden xl:table-cell w-24 min-w-[80px]",children:"계좌번호"}),e.jsx(g,{className:"hidden 2xl:table-cell min-w-[120px]",children:"주소"}),e.jsx(g,{children:e.jsx(S,{sortKey:"purchase_role",currentSortKey:d.key,sortDirection:d.direction,onSort:()=>c("purchase_role"),children:"권한"})}),e.jsx(g,{children:e.jsx(S,{sortKey:"slack_id",currentSortKey:d.key,sortDirection:d.direction,onSort:()=>c("slack_id"),children:"Slack ID"})}),e.jsx(g,{children:e.jsx(S,{sortKey:"is_active",currentSortKey:d.key,sortDirection:d.direction,onSort:()=>c("is_active"),children:"상태"})})]}),e.jsx(g,{className:"w-16 min-w-[50px]",children:"작업"})]})}),e.jsx(ve,{children:x.length===0?e.jsx(B,{children:e.jsx(p,{colSpan:E?14:7,className:"text-center py-8 text-gray-500",children:"등록된 직원이 없습니다."})}):b.map(s=>e.jsxs(B,{children:[e.jsx(p,{className:"text-[11px] px-2 py-1.5",children:s.employeeID||s.employee_number||s.id.slice(0,8)}),e.jsx(p,{className:"text-[11px] px-2 py-1.5",children:s.name}),e.jsx(p,{className:"text-[11px] px-2 py-1.5",children:s.position||"-"}),e.jsx(p,{className:"text-[11px] px-2 py-1.5",children:s.department||"-"}),e.jsx(p,{className:"text-[11px] px-2 py-1.5",children:s.phone||"-"}),e.jsx(p,{className:"text-[11px] px-2 py-1.5",children:s.email||"-"}),e.jsx(p,{className:"text-center text-[11px] px-1 py-1.5",children:s.annual_leave_granted_current_year||0}),e.jsx(p,{className:"text-center text-[11px] px-1 py-1.5",children:s.used_annual_leave||0}),e.jsx(p,{className:"text-center text-[11px] px-1 py-1.5",children:s.remaining_annual_leave!==void 0?s.remaining_annual_leave:"-"}),e.jsx(p,{className:"hidden lg:table-cell text-[11px] px-2 py-1.5",children:Y(s.join_date)}),e.jsx(p,{className:"hidden lg:table-cell text-[11px] px-2 py-1.5",children:Y(s.birthday)}),_&&e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"hidden xl:table-cell text-[11px] px-2 py-1.5",children:s.bank||"-"}),e.jsx(p,{className:"hidden xl:table-cell text-[11px] px-2 py-1.5",children:s.bank_account||"-"}),e.jsx(p,{className:"hidden 2xl:table-cell text-[11px] px-2 py-1.5",children:s.adress||"-"}),e.jsx(p,{className:"px-2 py-1.5",children:e.jsx(H,{className:`text-[10px] px-1.5 py-0.5 ${F(s.purchase_role)}`,children:n(s.purchase_role)})}),e.jsx(p,{className:"text-[11px] px-2 py-1.5",children:s.slack_id||"-"}),e.jsx(p,{className:"px-2 py-1.5",children:e.jsx(H,{variant:s.is_active?"default":"secondary",className:`text-[10px] px-1.5 py-0.5 ${s.is_active?"bg-green-100 text-green-800":""}`,children:s.is_active?"활성":"비활성"})})]}),e.jsx(p,{className:"px-1 py-1.5",children:e.jsxs(ee,{children:[e.jsx(se,{asChild:!0,children:e.jsx(y,{variant:"ghost",className:"h-7 w-7 p-0",disabled:t===s.id,children:e.jsx(ae,{className:"h-3 w-3"})})}),e.jsxs(re,{align:"end",children:[e.jsxs(R,{onClick:()=>a(s),children:[e.jsx(J,{className:"mr-2 h-4 w-4"}),"상세 보기"]}),u&&e.jsxs(e.Fragment,{children:[e.jsxs(R,{onClick:()=>r(s),children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),"수정"]}),e.jsx(R,{onClick:()=>o(s),children:s.is_active?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),"비활성화"]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),"활성화"]})}),e.jsxs(R,{onClick:()=>i(s),className:"text-red-600",children:[e.jsx(Q,{className:"mr-2 h-4 w-4"}),"삭제"]})]})]})]})})]},s.id))})]})})}),e.jsx("div",{className:"hidden md:block lg:hidden",children:e.jsx("div",{className:"overflow-x-auto border rounded-lg",children:e.jsxs("table",{className:"w-full min-w-[700px]",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 font-medium text-gray-900 text-sm w-16",children:"사번"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-900 text-sm w-20",children:"이름"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-900 text-sm w-20",children:"직급"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-900 text-sm w-24",children:"부서"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-900 text-sm",children:"연락처"}),e.jsx("th",{className:"text-left p-3 font-medium text-gray-900 text-sm",children:"이메일"}),_&&e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"text-left p-3 font-medium text-gray-900 text-sm w-24",children:"권한"}),e.jsx("th",{className:"text-center p-3 font-medium text-gray-900 text-sm w-16",children:"상태"})]}),e.jsx("th",{className:"text-center p-3 font-medium text-gray-900 text-sm w-16",children:"작업"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:b.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:_?9:7,className:"text-center py-8 text-gray-500",children:"등록된 직원이 없습니다."})}):b.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"p-3 text-sm",children:s.employeeID||s.employee_number||s.id.slice(0,8)}),e.jsx("td",{className:"p-3 text-sm font-medium",children:s.name}),e.jsx("td",{className:"p-3 text-sm",children:s.position||"-"}),e.jsx("td",{className:"p-3 text-sm",children:s.department||"-"}),e.jsx("td",{className:"p-3 text-sm",children:s.phone||"-"}),e.jsx("td",{className:"p-3 text-sm",children:s.email||"-"}),_&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"p-3",children:e.jsx(H,{className:`text-xs ${F(s.purchase_role)}`,children:n(s.purchase_role)})}),e.jsx("td",{className:"p-3 text-center",children:e.jsx(H,{variant:s.is_active?"default":"secondary",className:`text-xs ${s.is_active?"bg-green-100 text-green-800":""}`,children:s.is_active?"활성":"비활성"})})]}),e.jsx("td",{className:"p-3 text-center",children:e.jsxs(ee,{children:[e.jsx(se,{asChild:!0,children:e.jsx(y,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(ae,{className:"h-4 w-4"})})}),e.jsxs(re,{align:"end",children:[e.jsxs(R,{onClick:()=>a(s),children:[e.jsx(J,{className:"mr-2 h-4 w-4"}),"상세 보기"]}),u&&e.jsxs(e.Fragment,{children:[e.jsxs(R,{onClick:()=>r(s),children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),"수정"]}),e.jsx(R,{onClick:()=>o(s),children:s.is_active?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),"비활성화"]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),"활성화"]})}),e.jsxs(R,{onClick:()=>i(s),className:"text-red-600",children:[e.jsx(Q,{className:"mr-2 h-4 w-4"}),"삭제"]})]})]})]})})]},s.id))})]})})}),e.jsx("div",{className:"block md:hidden space-y-3",children:b.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"등록된 직원이 없습니다."}):b.map(s=>e.jsxs(we,{children:[e.jsx(Ne,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:s.name}),e.jsx(H,{variant:s.is_active?"default":"secondary",className:s.is_active?"bg-green-100 text-green-800":"",children:s.is_active?"활성":"비활성"})]})}),e.jsx(k,{label:"사번",value:s.employeeID||s.employee_number||s.id.slice(0,8)}),e.jsx(k,{label:"직급",value:s.position||"-"}),e.jsx(k,{label:"부서",value:s.department||"-"}),e.jsx(k,{label:"연락처",value:s.phone||"-"}),e.jsx(k,{label:"이메일",value:s.email||"-"}),E&&e.jsxs(e.Fragment,{children:[e.jsx(k,{label:"권한",value:e.jsx(H,{className:F(s.purchase_role),children:n(s.purchase_role)})}),e.jsx(k,{label:"Slack ID",value:s.slack_id||"-"}),e.jsx(k,{label:"주소",value:s.adress||"-"}),e.jsx(k,{label:"은행",value:s.bank||"-"}),e.jsx(k,{label:"계좌번호",value:s.bank_account||"-"}),e.jsx(k,{label:"연차",value:s.remaining_annual_leave!==void 0?`${s.remaining_annual_leave}일`:"-"})]}),e.jsxs(_e,{children:[e.jsx(y,{size:"sm",variant:"outline",onClick:()=>a(s),children:e.jsx(J,{className:"w-4 h-4"})}),u&&e.jsxs(e.Fragment,{children:[e.jsx(y,{size:"sm",variant:"outline",onClick:()=>r(s),children:e.jsx(X,{className:"w-4 h-4"})}),e.jsx(y,{size:"sm",variant:"outline",onClick:()=>o(s),disabled:t===s.id,children:s.is_active?e.jsx(Z,{className:"w-4 h-4"}):e.jsx(G,{className:"w-4 h-4"})}),e.jsx(y,{size:"sm",variant:"outline",className:"text-red-600",onClick:()=>i(s),disabled:t===s.id,children:e.jsx(Q,{className:"w-4 h-4"})})]})]})]},s.id))})]})}const qe=[{value:"app_admin",label:"앱 관리자"},{value:"ceo",label:"CEO"},{value:"final_approver",label:"최종 승인자"},{value:"middle_manager",label:"중간 관리자"},{value:"lead buyer",label:"수석 구매자"},{value:"buyer",label:"구매자"}];function Fe({isOpen:x,onClose:r,employee:a,onSave:l,mode:t}){const[h,v]=m.useState(!1),[I,q]=m.useState([]),[b,d]=m.useState([]),c=Se({defaultValues:{name:"",email:"",phone:"",position:"",department:"",purchase_role:[],slack_id:""}});m.useEffect(()=>{(async()=>{const[i,n]=await Promise.all([D.getDepartments(),D.getPositions()]);i.success&&q(i.data||[]),n.success&&d(n.data||[])})()},[]),m.useEffect(()=>{a&&x?c.reset({name:a.name||"",email:a.email||"",phone:a.phone||"",position:a.position||"",department:a.department||"",purchase_role:a.purchase_role?a.purchase_role.split(","):[],slack_id:a.slack_id||""}):!a&&x&&c.reset({name:"",email:"",phone:"",position:"",department:"",purchase_role:[],slack_id:""})},[a,x,c]);const _=async o=>{v(!0);try{let i;t==="create"?i=await D.createEmployee(o):t==="edit"&&a&&(i=await D.updateEmployee(a.id,o)),i?.success?(N.success(t==="create"?"직원이 등록되었습니다.":"직원 정보가 수정되었습니다."),l(),r()):N.error(i?.error||"처리 중 오류가 발생했습니다.")}catch{N.error("처리 중 오류가 발생했습니다.")}finally{v(!1)}},E=()=>{switch(t){case"create":return"직원 등록";case"edit":return"직원 수정";case"view":return"직원 상세";default:return"직원"}},u=t==="view";return e.jsx(oe,{open:x,onOpenChange:r,children:e.jsxs(de,{className:"w-full max-w-[95vw] sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(xe,{children:e.jsx(he,{children:E()})}),e.jsx(ye,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(_),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(K,{control:c.control,name:"name",rules:{required:"이름을 입력해주세요."},render:({field:o})=>e.jsxs(M,{children:[e.jsx(T,{children:"이름 *"}),e.jsx(P,{children:e.jsx(O,{...o,placeholder:"이름을 입력하세요",disabled:u})}),e.jsx($,{})]})}),e.jsx(K,{control:c.control,name:"email",rules:{pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"올바른 이메일 형식을 입력해주세요."}},render:({field:o})=>e.jsxs(M,{children:[e.jsx(T,{children:"이메일"}),e.jsx(P,{children:e.jsx(O,{...o,type:"email",placeholder:"user@example.com",disabled:u})}),e.jsx($,{})]})}),e.jsx(K,{control:c.control,name:"phone",render:({field:o})=>e.jsxs(M,{children:[e.jsx(T,{children:"전화번호"}),e.jsx(P,{children:e.jsx(O,{...o,placeholder:"010-0000-0000",disabled:u})}),e.jsx($,{})]})}),e.jsx(K,{control:c.control,name:"slack_id",render:({field:o})=>e.jsxs(M,{children:[e.jsx(T,{children:"Slack ID"}),e.jsx(P,{children:e.jsx(O,{...o,placeholder:"U01234567890",disabled:u})}),e.jsx($,{})]})}),e.jsx(K,{control:c.control,name:"department",render:({field:o})=>e.jsxs(M,{children:[e.jsx(T,{children:"부서"}),e.jsx(P,{children:u?e.jsx(O,{...o,disabled:!0}):e.jsxs(V,{onValueChange:o.onChange,defaultValue:o.value,children:[e.jsx(L,{children:e.jsx(U,{placeholder:"부서를 선택하세요"})}),e.jsxs(A,{children:[I.map(i=>e.jsx(f,{value:i,children:i},i)),e.jsx(f,{value:"custom",children:"직접 입력"})]})]})}),e.jsx($,{})]})}),e.jsx(K,{control:c.control,name:"position",render:({field:o})=>e.jsxs(M,{children:[e.jsx(T,{children:"직급"}),e.jsx(P,{children:u?e.jsx(O,{...o,disabled:!0}):e.jsxs(V,{onValueChange:o.onChange,defaultValue:o.value,children:[e.jsx(L,{children:e.jsx(U,{placeholder:"직급을 선택하세요"})}),e.jsxs(A,{children:[b.map(i=>e.jsx(f,{value:i,children:i},i)),e.jsx(f,{value:"custom",children:"직접 입력"})]})]})}),e.jsx($,{})]})}),e.jsx(K,{control:c.control,name:"purchase_role",render:({field:o})=>e.jsxs(M,{children:[e.jsx(T,{children:"권한"}),e.jsx(P,{children:e.jsxs(V,{onValueChange:i=>o.onChange(i==="none"?[]:[i]),defaultValue:o.value?.[0]||"none",disabled:u,children:[e.jsx(L,{children:e.jsx(U,{placeholder:"권한을 선택하세요"})}),e.jsxs(A,{children:[e.jsx(f,{value:"none",children:"권한 없음"}),qe.map(i=>e.jsx(f,{value:i.value,children:i.label},i.value))]})]})}),e.jsx($,{})]})})]}),t==="view"&&a&&e.jsx("div",{className:"pt-4 border-t",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"상태:"}),e.jsx("span",{className:`ml-2 px-2 py-1 rounded text-xs ${a.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-600"}`,children:a.is_active?"활성":"비활성"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"등록일:"}),e.jsx("span",{className:"ml-2",children:a.created_at?new Date(a.created_at).toLocaleDateString("ko-KR"):"-"})]})]})}),e.jsxs(me,{className:"gap-2",children:[e.jsx(y,{type:"button",variant:"outline",onClick:r,children:t==="view"?"닫기":"취소"}),!u&&e.jsx(y,{type:"submit",disabled:h,children:h?t==="create"?"등록 중...":"수정 중...":t==="create"?"등록":"수정"})]})]})})]})})}function Ze(){const[x,r]=m.useState([]),[a,l]=m.useState([]),[t,h]=m.useState(!0),[v,I]=m.useState({}),[q,b]=m.useState(!1),[d,c]=m.useState(null),[_,E]=m.useState("create"),u=async()=>{h(!0);try{const j=await D.getEmployees(v);j.success&&j.data?(r(j.data),l(j.data)):N.error(j.error||"직원 목록을 불러오는데 실패했습니다.")}catch{N.error("직원 목록을 불러오는 중 오류가 발생했습니다.")}finally{h(!1)}};m.useEffect(()=>{u()},[]),m.useEffect(()=>{u()},[v]);const o=()=>{c(null),E("create"),b(!0)},i=j=>{c(j),E("edit"),b(!0)},n=j=>{c(j),E("view"),b(!0)},F=()=>{b(!1),c(null)},s=()=>{u()},w=async()=>{try{const j=await D.getEmployeesForExport();if(j.success&&j.data){const z=await ie(()=>import("./xlsx-DGuHH-KN.js"),[]),le=z.utils.json_to_sheet(j.data),W=z.utils.book_new();z.utils.book_append_sheet(W,le,"직원 목록");const ne=`직원_목록_${new Date().toISOString().slice(0,10)}.xlsx`;z.writeFile(W,ne),N.success("Excel 파일이 다운로드되었습니다.")}else N.error(j.error||"Excel 내보내기에 실패했습니다.")}catch{N.error("Excel 내보내기 중 오류가 발생했습니다.")}};return t&&x.length===0?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"직원 목록을 불러오는 중..."})]})}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ce,{filters:v,onFiltersChange:I,onExport:w,onCreateNew:o}),e.jsxs("div",{className:"bg-white rounded-lg border",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium",children:"직원 목록"}),e.jsx("div",{className:"text-sm text-gray-600",children:t?"로딩 중...":`총 ${a.length}명의 직원`})]})}),e.jsx(De,{employees:a,onEdit:i,onView:n,onRefresh:u})]}),e.jsx(Fe,{isOpen:q,onClose:F,employee:d,onSave:s,mode:_})]})})}export{Ze as default};
//# sourceMappingURL=EmployeeMain-D5RipUZc.js.map
