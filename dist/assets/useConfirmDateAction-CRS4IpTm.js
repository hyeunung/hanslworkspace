import{r as e}from"./ui-components-CWOoty1N.js";import{a as t,l as r,t as i}from"./index-BoCLkSMB.js";function a({config:a,currentUserName:n,canPerformAction:c,onUpdate:o,onOptimisticUpdate:s}){const d=t(),l=e.useCallback(async(e,t,l)=>{if(!c)return r.warn("❌ 권한 없음",{canPerformAction:c}),void i.error(("statement_received"===a.field?"거래명세서":"입고")+" 확인 권한이 없습니다.");const m="number"==typeof e?e:Number(e);if(Number.isNaN(m))return r.error("❌ 잘못된 ID",{itemId:e,numericId:m}),void i.error("유효하지 않은 항목 ID 입니다.");if(l){const e=`품목명: ${l.item_name||"-"}\n규격: ${l.specification||"-"}\n수량: ${l.quantity?.toLocaleString()||0}\n단가: ₩${l.unit_price_value?.toLocaleString()||0}\n합계: ₩${l.amount_value?.toLocaleString()||0}\n비고: ${l.remark||"-"}\n\n${a.confirmMessage.confirm}`;if(!window.confirm(e))return}try{let e;"statement_received"===a.field?e={is_statement_received:!0,statement_received_date:t.toISOString(),statement_received_by_name:n}:"actual_received"===a.field&&(e={actual_received_date:t.toISOString()});const{data:c,error:u}=await d.from("purchase_request_items").update(e).eq("id",m).select();if(u)throw r.error("❌ DB 업데이트 실패",u),u;r.info("✅ DB 업데이트 성공"),s&&s({itemId:m,selectedDate:t,action:"confirm",itemInfo:l}),o&&o(),i.success(a.successMessage.confirm)}catch(u){r.error("❌ 전체 처리 실패",u),i.error(("statement_received"===a.field?"거래명세서":"입고")+" 확인 처리 중 오류가 발생했습니다.")}},[a,n,c,o,s,d]),m=e.useCallback(async(e,t)=>{if(!c)return void i.error(("statement_received"===a.field?"거래명세서":"입고")+" 확인 권한이 없습니다.");const n="number"==typeof e?e:Number(e);if(Number.isNaN(n))i.error("유효하지 않은 항목 ID 입니다.");else{if(t){const e=`품목명: ${t.item_name||"-"}\n규격: ${t.specification||"-"}\n수량: ${t.quantity?.toLocaleString()||0}\n단가: ₩${t.unit_price_value?.toLocaleString()||0}\n합계: ₩${t.amount_value?.toLocaleString()||0}\n비고: ${t.remark||"-"}\n\n${a.confirmMessage.cancel}`;if(!window.confirm(e))return}try{let e;"statement_received"===a.field?e={is_statement_received:!1,statement_received_date:null,statement_received_by_name:null}:"actual_received"===a.field&&(e={actual_received_date:null});const{data:c,error:l}=await d.from("purchase_request_items").update(e).eq("id",n).select();if(l)throw r.error("❌ DB 업데이트 실패",l),l;r.info(`✅ ${a.field} 확인 취소 성공`),s&&s({itemId:n,action:"cancel",itemInfo:t}),o&&o(),i.success(a.successMessage.cancel)}catch(l){r.error(`❌ ${a.field} 확인 취소 실패`,l),i.error(("statement_received"===a.field?"거래명세서":"입고")+" 확인 취소 중 오류가 발생했습니다.")}}},[a,c,o,s,d]),u=e.useCallback(e=>"statement_received"===a.field?e.is_statement_received:"actual_received"===a.field&&!!e.actual_received_date,[a.field]),f=e.useCallback(e=>"statement_received"===a.field?e.statement_received_date:"actual_received"===a.field?e.actual_received_date:null,[a.field]),_=e.useCallback(e=>"statement_received"===a.field?e.statement_received_by_name:(a.field,null),[a.field]);return{config:a,handleConfirm:l,handleCancel:m,isCompleted:u,getCompletedDate:f,getCompletedByName:_}}export{a as u};
//# sourceMappingURL=useConfirmDateAction-CRS4IpTm.js.map
