const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PurchaseDetailModal-tHeaZ7gC.js","assets/ui-components-CWOoty1N.js","assets/excel-libs-CEylypxp.js","assets/index-BoCLkSMB.js","assets/supabase-BBTAdlcZ.js","assets/react-vendor-DlOlWAvO.js","assets/date-utils-DDl0vnal.js","assets/index-0woRjauo.css","assets/helpers-Buk9LCEc.js","assets/useConfirmDateAction-CRS4IpTm.js","assets/credit-card-C8FmGSFH.js","assets/trash-2-DArXqw6O.js","assets/pen-D0DAF3mt.js","assets/save-BakkRVdz.js"])))=>i.map(i=>d[i]);
import{j as e,r as a,aa as t,s as l,y as s,u as r,ab as n,g as c,v as i,p as d,i as o,T as m,x as p,w as x,O as h,ac as u}from"./ui-components-CWOoty1N.js";import{d as g,s as y,a2 as _,a as j,t as f,l as w}from"./index-BoCLkSMB.js";import{_ as b}from"./supabase-BBTAdlcZ.js";import{b as v,c as N}from"./helpers-Buk9LCEc.js";import{E as C}from"./eye-Cs1ATNJq.js";import"./excel-libs-CEylypxp.js";import"./react-vendor-DlOlWAvO.js";import"./date-utils-DDl0vnal.js";const $=v;function k(e){return e?["KRW","원","₩"].includes(e)?"₩":["USD","$","달러"].includes(e)?"$":["EUR","€"].includes(e)?"€":["JPY","엔","¥"].includes(e)||["CNY","위안","元"].includes(e)?"¥":e:""}const A=a.lazy(()=>b(()=>import("./PurchaseDetailModal-tHeaZ7gC.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13])));function R(t){return e.jsx(a.Suspense,{fallback:e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center",children:e.jsx("div",{className:"bg-white rounded-lg p-6 max-w-md",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-hansl-600"}),e.jsx("span",{className:"text-gray-600",children:"모달 로딩 중..."})]})})}),children:e.jsx(A,{...t})})}const D=a.memo(({purchase:a})=>{const t=a.is_received?"completed":"approved"===a.middle_manager_status&&"approved"===a.final_manager_status?"inProgress":"rejected"===a.middle_manager_status||"rejected"===a.final_manager_status?"rejected":"pending",{text:l,className:s}={completed:{text:"입고완료",className:"badge-success"},inProgress:{text:"구매진행",className:"badge-primary"},rejected:{text:"반려",className:"badge-danger"},pending:{text:"승인대기",className:"badge-warning"}}[t];return e.jsx(g,{variant:null,className:s,children:l})});D.displayName="StatusBadge";const q=a.memo(({purchase:a,onClick:t})=>{const l=(e=>{if(!e.items||0===e.items.length)return{received:0,total:0,percentage:0};const a=e.items.length,t=e.items.filter(e=>null!==e.actual_received_date&&void 0!==e.actual_received_date).length;return{received:t,total:a,percentage:a>0?Math.round(t/a*100):0}})(a),s="선진행"===a.progress_type||a.progress_type?.includes("선진행");return e.jsxs("div",{className:"bg-white rounded-lg border p-4 space-y-3 cursor-pointer transition-all hover:shadow-md "+(s?"border-red-400 bg-red-50 hover:bg-red-100":"hover:bg-gray-50"),onClick:()=>t(a),children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s?e.jsx(g,{variant:null,className:"badge-danger",children:"선진행"}):e.jsx(g,{variant:null,className:"badge-secondary",children:"일반"}),e.jsx("span",{className:"card-title text-gray-900",children:a.purchase_order_number||"-"})]}),e.jsxs("div",{className:"badge-text text-gray-500 mt-1",children:[N(a.request_date)," 요청"]})]}),e.jsx(D,{purchase:a})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[e.jsx("span",{className:"text-gray-600",children:"요청자"}),e.jsx("span",{className:"card-title",children:a.requester_name})]}),e.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[e.jsx("span",{className:"text-gray-600",children:"업체"}),e.jsx("span",{className:"card-title",children:a.vendor_name})]}),a.project_vendor&&e.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[e.jsx("span",{className:"text-gray-600",children:"PJ업체"}),e.jsx("span",{className:"card-title truncate max-w-[150px]",children:a.project_vendor})]}),a.project_item&&e.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[e.jsx("span",{className:"text-gray-600",children:"PJ ITEM"}),e.jsx("span",{className:"card-title truncate max-w-[150px]",children:a.project_item})]}),a.sales_order_number&&e.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[e.jsx("span",{className:"text-gray-600",children:"수주번호"}),e.jsx("span",{className:"card-title truncate max-w-[150px]",children:a.sales_order_number})]}),a.item_name&&e.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[e.jsx("span",{className:"text-gray-600",children:"품목"}),e.jsx("span",{className:"card-title truncate max-w-[150px]",children:a.item_name})]}),e.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[e.jsx("span",{className:"text-gray-600",children:"금액"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[(a.amount_value||a.total_amount)?.toLocaleString()," ",a.currency]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between badge-text",children:[e.jsx("span",{className:"text-gray-600",children:"입고현황"}),e.jsxs("span",{className:"text-gray-700",children:[l.received,"/",l.total," (",l.percentage,"%)"]})]}),e.jsx("div",{className:"bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"h-2 rounded-full transition-all "+(100===l.percentage?"bg-green-500":l.percentage>0?"bg-hansl-500":"bg-gray-300"),style:{width:`${l.percentage}%`}})})]}),void 0!==a.is_payment_completed&&e.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[e.jsx("span",{className:"text-gray-600",children:"결제"}),a.is_payment_completed?e.jsx(g,{variant:null,className:"badge-success",children:"완료"}):e.jsx(g,{variant:null,className:"badge-secondary",children:"대기"})]}),e.jsx("div",{className:"pt-2 border-t",children:e.jsxs("div",{className:"flex items-center justify-center badge-text text-gray-500",children:[e.jsx(C,{className:"w-3 h-3 mr-1"}),"클릭하여 상세보기"]})})]})});q.displayName="MobilePurchaseCard";var E="AlertDialog",[F]=c(E,[t]),S=t(),z=a=>{const{__scopeAlertDialog:t,...s}=a,r=S(t);return e.jsx(l,{...r,...s,modal:!0})};z.displayName=E;a.forwardRef((a,t)=>{const{__scopeAlertDialog:l,...s}=a,r=S(l);return e.jsx(u,{...r,...s,ref:t})}).displayName="AlertDialogTrigger";var I=a=>{const{__scopeAlertDialog:t,...l}=a,r=S(t);return e.jsx(s,{...r,...l})};I.displayName="AlertDialogPortal";var T=a.forwardRef((a,t)=>{const{__scopeAlertDialog:l,...s}=a,r=S(l);return e.jsx(h,{...r,...s,ref:t})});T.displayName="AlertDialogOverlay";var P="AlertDialogContent",[B,M]=F(P),O=o("AlertDialogContent"),L=a.forwardRef((t,l)=>{const{__scopeAlertDialog:s,children:c,...o}=t,m=S(s),p=a.useRef(null),x=r(l,p),h=a.useRef(null);return e.jsx(n,{contentName:P,titleName:J,docsSlug:"alert-dialog",children:e.jsx(B,{scope:s,cancelRef:h,children:e.jsxs(i,{role:"alertdialog",...m,...o,ref:x,onOpenAutoFocus:d(o.onOpenAutoFocus,e=>{e.preventDefault(),h.current?.focus({preventScroll:!0})}),onPointerDownOutside:e=>e.preventDefault(),onInteractOutside:e=>e.preventDefault(),children:[e.jsx(O,{children:c}),e.jsx(V,{contentRef:p})]})})})});L.displayName=P;var J="AlertDialogTitle",G=a.forwardRef((a,t)=>{const{__scopeAlertDialog:l,...s}=a,r=S(l);return e.jsx(m,{...r,...s,ref:t})});G.displayName=J;var U="AlertDialogDescription",W=a.forwardRef((a,t)=>{const{__scopeAlertDialog:l,...s}=a,r=S(l);return e.jsx(p,{...r,...s,ref:t})});W.displayName=U;var K=a.forwardRef((a,t)=>{const{__scopeAlertDialog:l,...s}=a,r=S(l);return e.jsx(x,{...r,...s,ref:t})});K.displayName="AlertDialogAction";var Z="AlertDialogCancel",Y=a.forwardRef((a,t)=>{const{__scopeAlertDialog:l,...s}=a,{cancelRef:n}=M(Z,l),c=S(l),i=r(t,n);return e.jsx(x,{...c,...s,ref:i})});Y.displayName=Z;var V=({contentRef:e})=>{const t=`\`${P}\` requires a description for the component to be accessible for screen reader users.\n\nYou can add a description to the \`${P}\` by passing a \`${U}\` component as a child, which also benefits sighted users by adding visible context to the dialog.\n\nAlternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${P}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.\n\nFor more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return a.useEffect(()=>{document.getElementById(e.current?.getAttribute("aria-describedby"))},[t,e]),null},X=T,Q=L,H=K,ee=Y,ae=G,te=W;const le=z,se=I,re=a.forwardRef(({className:a,...t},l)=>e.jsx(X,{className:y("fixed inset-0 z-50 bg-black/40 backdrop-blur-sm","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...t,ref:l}));re.displayName=X.displayName;const ne=a.forwardRef(({className:a,...t},l)=>e.jsxs(se,{children:[e.jsx(re,{}),e.jsx(Q,{ref:l,className:y("fixed left-[50%] top-[50%] z-50","w-full max-w-md translate-x-[-50%] translate-y-[-50%]","grid gap-4 bg-white border border-gray-200","rounded-lg p-6 shadow-professional-xl","duration-200","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0","data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95","data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%]","data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%]",a),...t})]}));ne.displayName=Q.displayName;const ce=({className:a,...t})=>e.jsx("div",{className:y("flex flex-col space-y-2 text-left",a),...t});ce.displayName="AlertDialogHeader";const ie=({className:a,...t})=>e.jsx("div",{className:y("flex flex-col-reverse sm:flex-row sm:justify-end gap-3",a),...t});ie.displayName="AlertDialogFooter";const de=a.forwardRef(({className:a,...t},l)=>e.jsx(ae,{ref:l,className:y("text-lg font-semibold text-gray-800 tracking-tight",a),...t}));de.displayName=ae.displayName;const oe=a.forwardRef(({className:a,...t},l)=>e.jsx(te,{ref:l,className:y("text-sm text-gray-600",a),...t}));oe.displayName=te.displayName;const me=a.forwardRef(({className:a,...t},l)=>e.jsx(H,{ref:l,className:y(_(),a),...t}));me.displayName=H.displayName;const pe=a.forwardRef(({className:a,...t},l)=>e.jsx(ee,{ref:l,className:y(_({variant:"outline"}),"mt-2 sm:mt-0",a),...t}));pe.displayName=ee.displayName;const xe=a.memo(({purchase:a})=>{const t=a.is_received?"completed":"approved"===a.middle_manager_status&&"approved"===a.final_manager_status?"inProgress":"rejected"===a.middle_manager_status||"rejected"===a.final_manager_status?"rejected":"pending",{text:l,className:s}={completed:{text:"입고완료",className:"badge-success"},inProgress:{text:"구매진행",className:"badge-primary"},rejected:{text:"반려",className:"badge-danger"},pending:{text:"승인대기",className:"badge-warning"}}[t];return e.jsx(g,{className:s,children:l})});xe.displayName="StatusBadge";const he=e=>e?["KRW","원","₩"].includes(e)?"₩":["USD","$","달러"].includes(e)?"$":["EUR","€"].includes(e)?"€":["JPY","엔","¥"].includes(e)||["CNY","위안","元"].includes(e)?"¥":e:"₩",ue="text-center w-20 min-w-[85px] max-w-[85px]",ge="pl-2 w-38 min-w-[155px] max-w-[155px]",ye="pl-2 w-36 min-w-[140px] max-w-[140px]",_e="text-center w-20 min-w-[85px] max-w-[85px]",je="w-16 min-w-[68px] max-w-[68px]",fe="w-20 min-w-[85px] max-w-[85px]",we="w-28 min-w-[115px] max-w-[115px]",be="w-16 min-w-[68px] max-w-[68px]",ve="w-20 min-w-[85px] max-w-[85px]",Ne="w-20 min-w-[85px] max-w-[85px]",Ce="w-28 min-w-[120px] max-w-[120px]",$e="w-64 min-w-[260px] max-w-[260px]",ke="text-center w-14 min-w-[60px] max-w-[60px]",Ae="text-right w-24 min-w-[100px] max-w-[100px]",Re="text-right w-24 min-w-[100px] max-w-[100px]",De="w-28 min-w-[115px] max-w-[115px]",qe="w-24 min-w-[100px] max-w-[100px]",Ee="w-24 min-w-[105px] max-w-[105px]",Fe="w-28 min-w-[115px] max-w-[115px]",Se="w-44 min-w-[180px] max-w-[180px]",ze="text-center w-20 min-w-[85px] max-w-[85px]",Ie="text-center w-20 min-w-[85px] max-w-[85px]",Te="text-center w-24 min-w-[100px] max-w-[100px]",Pe="w-20 min-w-[85px] max-w-[85px]",Be=a.memo(({purchase:a})=>{const t="approved"===a.middle_manager_status,l="rejected"===a.middle_manager_status,s="approved"===a.final_manager_status,r="rejected"===a.final_manager_status;return l||r?e.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[e.jsx("div",{className:"flex items-center gap-0.5",children:e.jsx("div",{className:"w-1.5 h-1.5 bg-red-500 rounded-full animate-pulse"})}),e.jsx(g,{variant:null,className:"badge-danger",children:"반려"})]}):t&&s?e.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[e.jsx("div",{className:"flex items-center gap-0.5",children:e.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"})}),e.jsx(g,{variant:null,className:"badge-success",children:"승인완료"})]}):!t||s||r?e.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full"}),e.jsx("div",{className:"w-3 h-0.5 bg-gray-300"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full"})]}),e.jsx(g,{variant:null,className:"badge-secondary",children:"승인대기"})]}):e.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),e.jsx("div",{className:"w-3 h-0.5 bg-gray-300"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full"})]}),e.jsx(g,{variant:null,className:"badge-warning",children:"1차 승인"})]})});Be.displayName="ApprovalStatusBadge";a.memo(({type:a})=>"선진행"===a||a?.includes("선진행")?e.jsx(g,{variant:null,className:"badge-danger",children:"선진행"}):e.jsx(g,{variant:null,className:"badge-secondary",children:"일반"})).displayName="ProgressTypeBadge";const Me=a.memo(({purchase:a,onClick:t,activeTab:l,isLeadBuyer:s,onPaymentComplete:r,onReceiptComplete:n,onExcelDownload:c})=>{const i=(e=>{if(!e.items||0===e.items.length)return{received:0,total:1,percentage:0};const a=e.items.length,t=e.items.filter(e=>null!==e.actual_received_date&&void 0!==e.actual_received_date).length;return{received:t,total:a,percentage:a>0?Math.round(t/a*100):0}})(a),d=(e=>{if(e.is_payment_completed)return{completed:1,total:1,percentage:100};if(!e.items||0===e.items.length)return{completed:0,total:1,percentage:0};const a=e.items.length,t=e.items.filter(e=>!0===e.is_payment_completed).length;return{completed:t,total:a,percentage:a>0?Math.round(t/a*100):0}})(a),o=(e=>{if(!e.items||0===e.items.length)return{completed:0,total:1,percentage:0};const a=e.items.length,t=e.items.filter(e=>!0===e.is_statement_received).length;return{completed:t,total:a,percentage:a>0?Math.round(t/a*100):0}})(a),m="선진행"===a.progress_type||a.progress_type?.includes("선진행");return e.jsxs("tr",{className:"border-b hover:bg-gray-100 cursor-pointer transition-colors "+(m?"bg-red-50 hover:bg-red-100":""),onClick:()=>t(a),children:["pending"===l&&e.jsx("td",{className:`px-2 py-1.5 whitespace-nowrap ${ue}`,children:e.jsx(Be,{purchase:a})}),"purchase"===l&&e.jsx("td",{className:`px-2 py-1.5 ${ze}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:e.jsx("div",{className:"h-1.5 rounded-full "+(100===d.percentage?"bg-blue-500":d.percentage>0?"bg-blue-400":"bg-gray-300"),style:{width:`${d.percentage}%`}})}),e.jsxs("span",{className:"card-title text-gray-600",children:[d.percentage,"%"]})]})}),"receipt"===l&&e.jsx("td",{className:`px-2 py-1.5 ${ze}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:e.jsx("div",{className:"h-1.5 rounded-full "+(100===i.percentage?"bg-green-500":i.percentage>0?"bg-hansl-500":"bg-gray-300"),style:{width:`${i.percentage}%`}})}),e.jsxs("span",{className:"card-title text-gray-600",children:[i.percentage,"%"]})]})}),"done"===l&&e.jsx("td",{className:`px-2 py-1.5 ${ze}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:e.jsx("div",{className:"h-1.5 rounded-full "+(100===o.percentage?"bg-green-500":o.percentage>0?"bg-hansl-500":"bg-gray-300"),style:{width:`${o.percentage}%`}})}),e.jsxs("span",{className:"card-title text-gray-600",children:[o.percentage,"%"]})]})}),e.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${"purchase"===l?ye:ge}`,children:e.jsxs("div",{className:"flex items-center gap-1",children:[c&&e.jsx("img",{src:"/excels-icon.svg",alt:"엑셀 다운로드",width:"16",height:"16",className:`inline-block align-middle transition-transform p-0.5 rounded\n                ${a.is_po_download?"border border-gray-400":""}\n                ${"선진행"===a.progress_type||a.progress_type?.includes("선진행")||"approved"===a.middle_manager_status&&"approved"===a.final_manager_status?a.is_po_download?"cursor-pointer":"cursor-pointer hover:scale-110":"opacity-40 grayscale cursor-not-allowed"}`,onClick:async e=>{("선진행"===a.progress_type||a.progress_type?.includes("선진행")||"approved"===a.middle_manager_status&&"approved"===a.final_manager_status)&&(e.stopPropagation(),await c(a))},style:{pointerEvents:"선진행"===a.progress_type||a.progress_type?.includes("선진행")||"approved"===a.middle_manager_status&&"approved"===a.final_manager_status?"auto":"none"},title:a.is_po_download?"다운로드 완료":"엑셀 발주서 다운로드"}),e.jsxs("span",{className:"block truncate",title:a.purchase_order_number||"",children:[a.purchase_order_number||"-",a.items&&a.items.length>1&&e.jsxs("span",{className:"text-gray-500 ml-0.5",children:["(",a.items.length,")"]})]})]})}),("pending"===l||"purchase"===l||"receipt"===l||"done"===l||!l)&&e.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${_e}`,children:e.jsx(g,{variant:null,className:"구매요청"===a.payment_category||"구매 요청"===a.payment_category?"badge-primary":"발주"===a.payment_category?"badge-success":("현장결제"===a.payment_category||"현장 결제"===a.payment_category||a.payment_category,"badge-secondary"),children:"발주"===a.payment_category?"발주요청":"구매 요청"===a.payment_category?"구매요청":"현장 결제"===a.payment_category?"현장결제":a.payment_category||"-"})}),e.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${je}`,children:e.jsx("span",{className:"block truncate",title:a.requester_name||"",children:a.requester_name||"-"})}),e.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${fe}`,children:N(a.request_date)}),"done"===l&&e.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap text-center ${_e}`,children:e.jsx(g,{variant:null,className:a.is_utk_checked?"bg-orange-500 text-white":"bg-white border border-gray-300 text-gray-600",children:a.is_utk_checked?"완료":"대기"})}),e.jsx("td",{className:`px-2 py-1.5 card-title ${we}`,children:e.jsx("span",{className:"block truncate",title:a.vendor_name||"",children:a.vendor_name||"-"})}),e.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${be}`,children:e.jsx("span",{className:"block truncate",title:a.contact_name||"",children:a.contact_name||"-"})}),e.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${ve} ${a.revised_delivery_request_date?"text-gray-400":""}`,children:N(a.delivery_request_date)}),("receipt"===l||"done"===l||!l)&&e.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${Ne}`,children:N(a.revised_delivery_request_date)}),e.jsx("td",{className:`px-2 py-1.5 card-title ${Ce}`,children:e.jsx("span",{className:"block truncate",title:a.item_name||"",children:a.item_name||"-"})}),e.jsx("td",{className:`px-2 py-1.5 card-title ${$e}`,children:e.jsx("span",{className:"block truncate",title:a.specification||"",children:a.specification||"-"})}),e.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${ke}`,children:a.quantity||0}),e.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${Ae}`,children:a.unit_price_value?`${a.unit_price_value.toLocaleString()} ${he(a.currency||"KRW")}`:`0 ${he(a.currency||"KRW")}`}),e.jsx("td",{className:`px-2 py-1.5 card-amount whitespace-nowrap ${Re}`,children:a.amount_value?`${a.amount_value.toLocaleString()} ${he(a.currency||"KRW")}`:a.total_amount?`${a.total_amount.toLocaleString()} ${he(a.currency||"KRW")}`:`0 ${he(a.currency||"KRW")}`}),"pending"===l&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:`px-2 py-1.5 card-title ${De}`,children:e.jsx("span",{className:"block truncate",title:a.remark||"",children:a.remark||"-"})}),e.jsx("td",{className:`px-2 py-1.5 card-title ${Ee}`,children:e.jsx("span",{className:"block truncate",title:a.project_vendor||"",children:a.project_vendor||"-"})}),e.jsx("td",{className:`px-2 py-1.5 card-title ${Se}`,children:e.jsx("span",{className:"block truncate",title:a.project_item||"",children:a.project_item||"-"})}),e.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${Fe}`,children:e.jsx("span",{className:"block truncate",title:a.sales_order_number||"",children:a.sales_order_number||"-"})})]}),"purchase"===l&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:`px-2 py-1.5 card-title ${De}`,children:e.jsx("span",{className:"block truncate",title:a.remark||"",children:a.remark||"-"})}),e.jsx("td",{className:`px-2 py-1.5 card-title ${Pe}`,children:a.link?e.jsx("a",{href:a.link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline truncate block",title:a.link,children:"링크 보기"}):e.jsx("span",{className:"text-gray-400",children:"-"})}),"receipt"!==l&&e.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${qe}`,children:e.jsx("span",{className:"block truncate",title:a.vendor_payment_schedule||"",children:a.vendor_payment_schedule||"-"})})]}),"receipt"===l&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:`px-2 py-1.5 card-title ${De}`,children:e.jsx("span",{className:"block truncate",title:a.remark||"",children:a.remark||"-"})}),e.jsx("td",{className:`px-2 py-1.5 card-title ${Ee}`,children:e.jsx("span",{className:"block truncate",title:a.project_vendor||"",children:a.project_vendor||"-"})}),e.jsx("td",{className:`px-2 py-1.5 card-title ${Se}`,children:e.jsx("span",{className:"block truncate",title:a.project_item||"",children:a.project_item||"-"})}),e.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${Fe}`,children:e.jsx("span",{className:"block truncate",title:a.sales_order_number||"",children:a.sales_order_number||"-"})})]}),("done"===l||!l)&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:`px-2 py-1.5 card-title ${De}`,children:e.jsx("span",{className:"block truncate",title:a.remark||"",children:a.remark||"-"})}),e.jsx("td",{className:`px-2 py-1.5 card-title ${Pe}`,children:a.link?e.jsx("a",{href:a.link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline truncate block",title:a.link,children:"링크 보기"}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:`px-2 py-1.5 card-title ${Ee}`,children:e.jsx("span",{className:"block truncate",title:a.project_vendor||"",children:a.project_vendor||"-"})}),e.jsx("td",{className:`px-2 py-1.5 card-title ${Se}`,children:e.jsx("span",{className:"block truncate",title:a.project_item||"",children:a.project_item||"-"})}),e.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${Fe}`,children:e.jsx("span",{className:"block truncate",title:a.sales_order_number||"",children:a.sales_order_number||"-"})}),e.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${qe}`,children:e.jsx("span",{className:"block truncate",title:a.vendor_payment_schedule||"",children:a.vendor_payment_schedule||"-"})}),e.jsx("td",{className:`px-2 py-1.5 ${Ie}`,children:e.jsx("span",{className:"text-gray-400 card-title",children:"-"})}),e.jsx("td",{className:`px-2 py-1.5 ${Te}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:e.jsx("div",{className:"h-1.5 rounded-full "+(100===i.percentage?"bg-green-500":i.percentage>0?"bg-hansl-500":"bg-gray-300"),style:{width:`${i.percentage}%`}})}),e.jsxs("span",{className:"card-title text-gray-600",children:[i.percentage,"%"]})]})})]})]})});Me.displayName="TableRow";const Oe=a.memo(({purchases:t,activeTab:l="done",currentUserRoles:s=[],onRefresh:r,onOptimisticUpdate:n,onPaymentComplete:c,onReceiptComplete:i})=>{const[d,o]=a.useState(null),[m,p]=a.useState(!1),[x,h]=a.useState(!1),[u,g]=a.useState(null),y=j(),_=s&&(s.includes("lead buyer")||s.includes("lead_buyer")||s.includes("app_admin"));s.includes("final_approver")||s.includes("app_admin")||s.includes("ceo");const v=e=>{o(e.id),p(!0)},N=async e=>{try{const{data:l,error:n}=await y.from("purchase_requests").select("*").eq("purchase_order_number",e.purchase_order_number).single();if(n||!l)return void f.error("해당 발주요청번호의 데이터를 찾을 수 없습니다.");const{data:c,error:i}=await y.from("purchase_request_items").select("*").eq("purchase_order_number",e.purchase_order_number).order("line_number");if(i||!c||0===c.length)return void f.error("해당 발주요청번호의 품목 데이터를 찾을 수 없습니다.");const d={vendor_name:e.vendor_name,vendor_phone:"",vendor_fax:"",vendor_contact_name:"",vendor_payment_schedule:""};try{const a=l.vendor_id||e.vendor_id,t=l.contact_id||e.contact_id;if(a){const{data:e}=await y.from("vendors").select("vendor_phone, vendor_fax, vendor_payment_schedule").eq("id",a).single();e&&(d.vendor_phone=e.vendor_phone||"",d.vendor_fax=e.vendor_fax||"",d.vendor_payment_schedule=e.vendor_payment_schedule||"")}if(t){const{data:e}=await y.from("vendor_contacts").select("contact_name, contact_phone, contact_email").eq("id",t).single();e&&(d.vendor_contact_name=e.contact_name||"")}}catch(a){}const o={purchase_order_number:l.purchase_order_number||"",request_date:l.request_date,delivery_request_date:l.delivery_request_date,requester_name:l.requester_name,vendor_name:d.vendor_name||"",vendor_contact_name:d.vendor_contact_name,vendor_phone:d.vendor_phone,vendor_fax:d.vendor_fax,project_vendor:l.project_vendor,sales_order_number:l.sales_order_number,project_item:l.project_item,vendor_payment_schedule:d.vendor_payment_schedule,items:c.map(e=>({line_number:e.line_number,item_name:e.item_name,specification:e.specification,quantity:e.quantity,unit_price_value:e.unit_price_value,amount_value:e.amount_value,remark:e.remark,currency:l.currency||"KRW"}))},m=await async function(e){const a=new((await b(()=>import("./index-BoCLkSMB.js").then(e=>e.e),__vite__mapDeps([3,1,2,4,5,6,7]))).Workbook),t=a.addWorksheet("발주서",{pageSetup:{paperSize:9,orientation:"portrait",fitToPage:!0,fitToWidth:1,fitToHeight:1,horizontalCentered:!0,verticalCentered:!0,margins:{left:.3,right:.3,top:.5,bottom:.5,header:.2,footer:.2}}});t.getRow(1).height=29.8;for(let x=2;x<=60;x++)t.getRow(x).height=15.75;t.getRow(1).eachCell(e=>{e.font={...e.font||{},name:"맑은 고딕",size:20}});for(let x=2;x<=60;x++)t.getRow(x).eachCell(e=>{e.font={...e.font||{},name:"맑은 고딕",size:11}});t.mergeCells("A1:G1"),t.mergeCells("A2:B2"),t.mergeCells("C2:D2"),t.mergeCells("F2:G2"),t.mergeCells("A3:B3"),t.mergeCells("C3:D3"),t.mergeCells("F3:G3"),t.mergeCells("A4:B4"),t.mergeCells("C4:D4"),t.mergeCells("F4:G4"),t.mergeCells("A5:B5"),t.mergeCells("C5:D5"),t.mergeCells("F5:G5"),t.mergeCells("A6:B6"),t.mergeCells("C6:D6"),t.mergeCells("F6:G6"),t.mergeCells("A7:B7"),t.mergeCells("C7:D7"),t.mergeCells("F7:G7");try{const e=await fetch("/logo_KOR.png"),l=await e.arrayBuffer(),s=a.addImage({buffer:l,extension:"png"}),r=t.getColumn("D").width||22,n=Math.max(1,7.2*r*.58)+4,c=34,i=3,d=.3;t.addImage(s,{tl:{col:i,row:d},ext:{width:n,height:c}})}catch(p){}t.getCell("D1").value="                발 주 서",t.getCell("D1").alignment={horizontal:"left",vertical:"middle",indent:1},t.getCell("D1").font={bold:!0,size:20},t.getCell("A2").value="업   체   명",t.getCell("A2").font={bold:!0},t.getCell("A3").value="담   당   자",t.getCell("A3").font={bold:!0},t.getCell("A4").value="청   구   일",t.getCell("A4").font={bold:!0},t.getCell("A5").value="TEL.",t.getCell("A5").font={bold:!0},t.getCell("A6").value="FAX.",t.getCell("A6").font={bold:!0},t.getCell("A7").value="입고요청일",t.getCell("A7").font={bold:!0},t.getCell("E2").value="구매요청자",t.getCell("E2").font={bold:!0},t.getCell("E3").value="주         소",t.getCell("E3").font={bold:!0},t.getCell("E4").value="발 주 번 호",t.getCell("E4").font={bold:!0},t.getCell("E5").value="TEL.",t.getCell("E5").font={bold:!0},t.getCell("E6").value="FAX.",t.getCell("E6").font={bold:!0},t.getCell("E7").value="지출 예정일",t.getCell("E7").font={bold:!0},t.getCell("F7").value=e.vendor_payment_schedule||"",t.getCell("C2").value=e.vendor_name,t.getCell("C3").value=e.vendor_contact_name||"",t.getCell("C4").value=$(e.request_date),t.getCell("C5").value=e.vendor_phone||"",t.getCell("C6").value=e.vendor_fax||"",t.getCell("C7").value=$(e.delivery_request_date),t.getCell("F2").value=e.requester_name,t.getCell("F3").value="대구광역시 달서구 성서공단북로305",t.getCell("F4").value=e.purchase_order_number,t.getCell("F5").value="(053) 626-7805",t.getCell("F6").value="(053) 657-7905",t.getCell("F5").alignment={horizontal:"center",vertical:"middle"},t.getCell("F6").alignment={horizontal:"center",vertical:"middle"};const l=["No","품명","규격","수량","단가","금액","비고"];for(let x=0;x<l.length;x++)t.getCell(String.fromCharCode(65+x)+"8").value=l[x],t.getCell(String.fromCharCode(65+x)+"8").font={bold:!0},6===x&&(t.getCell("G8").alignment={horizontal:"center",vertical:"middle"});const s=[...e.items].sort((e,a)=>e.line_number-a.line_number),r=s.length,n=9+Math.max(r,45);for(let x=0;x<s.length;x++){const e=s[x],a=9+x;t.getCell("A"+a).value=e.line_number;const l=t.getCell("B"+a);l.value=e.item_name,l.alignment={horizontal:"left",vertical:"middle"},t.getCell("C"+a).value=e.specification,t.getCell("C"+a).alignment={horizontal:"left",vertical:"middle"},t.getCell("D"+a).value=e.quantity;const r=k(e.currency),n=void 0!==e.unit_price_value&&null!==e.unit_price_value?`${e.unit_price_value.toLocaleString()} ${r}`.trim():"";t.getCell("E"+a).value=n,t.getCell("E"+a).alignment={horizontal:"right",vertical:"middle"};const c=k(e.currency),i=void 0!==e.amount_value&&null!==e.amount_value?`${e.amount_value.toLocaleString()} ${c}`.trim():"";t.getCell("F"+a).value=i,t.getCell("F"+a).alignment={horizontal:"right",vertical:"middle"};const d=t.getCell("G"+a);d.value=void 0!==e.remark&&null!==e.remark?String(e.remark):"",d.alignment={horizontal:"left",vertical:"middle",wrapText:!1,shrinkToFit:!0}}for(let x=r;x<45;x++){const e=9+x;for(let a=0;a<7;a++)t.getCell(String.fromCharCode(65+a)+e).value=""}t.mergeCells(`A${n}:E${n}`),t.getCell("A"+n).value="합계",t.getCell("A"+n).font={bold:!0};const c=k(e.items[0]?.currency),i=e.items.reduce((e,a)=>e+(a.amount_value||0),0);t.getCell("F"+n).value=`${i.toLocaleString()} ${c}`.trim(),t.getCell("F"+n).alignment={horizontal:"right",vertical:"middle"};const d=n;for(let x=1;x<=d;x++)for(let e=1;e<=7;e++){const a=String.fromCharCode(64+e)+x,l=t.getCell(a),s=x>=9&&x<n;(5===e||6===e)&&(s||x===n)||3===e&&s||(l.alignment={horizontal:"center",vertical:"middle"}),l.border={top:{style:1===x||2===x||8===x||x===n?"medium":"thin"},left:{style:1===e?"medium":"thin"},right:{style:7===e?"medium":"thin"},bottom:{style:8===x||x===n||x===d?"medium":"thin"}}}for(let x=0;x<r;x++){const e=9+x;t.getCell("C"+e).alignment={horizontal:"left",vertical:"middle"}}for(let x=2;x<=7;x++)t.getCell("B"+x).border={...t.getCell("B"+x).border,right:{style:"medium"}},t.getCell("D"+x).border={...t.getCell("D"+x).border,right:{style:"medium"}},x<=6&&(t.getCell("E"+x).border={...t.getCell("E"+x).border,right:{style:"medium"}});t.getCell("E7").border={...t.getCell("E7").border,top:{style:"thin"},right:{style:"medium"}},t.getCell("G7").border={...t.getCell("G7").border,top:{style:"thin"}};for(let x=1;x<=7;x++){const e=t.getCell("A"+x).border||{};t.getCell("A"+x).border={...e,left:{style:"medium"}}}const o=t.getCell("A"+n).border||{};t.getCell("A"+n).border={...o,left:{style:"medium"}},Object.entries({A:4.7,B:23,C:30,D:11,E:15,F:16,G:37}).forEach(([e,a])=>{t.getColumn(e).width=a}),t.getRow(1).height=29.8,t.getRow(1).eachCell(e=>{e.font={...e.font||{},name:"맑은 고딕",size:20}});for(let x=2;x<=d;x++){const e=t.getRow(x);e.height=15.75,e.eachCell(e=>{e.font={...e.font||{},name:"맑은 고딕",size:11}})}for(let x=9;x<=d;x++)t.getCell("G"+x).alignment={horizontal:"left",vertical:"middle",wrapText:!1,shrinkToFit:!0},t.getCell("B"+x).alignment={horizontal:"left",vertical:"middle"};const m=await a.xlsx.writeBuffer();return new Blob([m],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})}(o),p=`발주서_${o.vendor_name}_${o.purchase_order_number}.xlsx`,x=window.URL.createObjectURL(m),h=document.createElement("a");h.href=x,h.download=p,document.body.appendChild(h),h.click(),document.body.removeChild(h),window.URL.revokeObjectURL(x),f.success("엑셀 파일이 다운로드되었습니다.");try{if(s&&(s.includes("lead buyer")||s.includes("lead_buyer"))){const{error:a}=await y.from("purchase_requests").update({is_po_download:!0}).eq("purchase_order_number",e.purchase_order_number);a||r?.()}}catch(t){}}catch(a){f.error("엑셀 다운로드에 실패했습니다.")}},C=a.useMemo(()=>{if("pending"===l)return e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${ue}`,children:"승인상태"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${ge}`,children:"발주번호"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${_e}`,children:"결제종류"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${je}`,children:"요청자"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${fe}`,children:"청구일"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${we}`,children:"업체"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${be}`,children:"담당자"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${ve}`,children:"입고요청일"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${Ce}`,children:"품명"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${$e}`,children:"규격"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${ke}`,children:"수량"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Ae}`,children:"단가"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Re}`,children:"합계"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${De}`,children:"비고"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ee}`,children:"PJ업체"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Se}`,children:"PJ ITEM"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Fe}`,children:"수주번호"})]})});const a=e.jsxs(e.Fragment,{children:[e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${"purchase"===l?ye:ge}`,children:"발주번호"}),("purchase"===l||"receipt"===l||"done"===l||!l)&&e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${_e}`,children:"결제종류"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${je}`,children:"요청자"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${fe}`,children:"청구일"}),"done"===l&&e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-center ${_e}`,children:"UTK"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${we}`,children:"업체"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${be}`,children:"담당자"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${ve}`,children:"입고요청일"}),("receipt"===l||"done"===l||!l)&&e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ne}`,children:"변경 입고일"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${Ce}`,children:"품명"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${$e}`,children:"규격"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${ke}`,children:"수량"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Ae}`,children:"단가"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Re}`,children:"합계"})]});let t=null;return t="purchase"===l?e.jsxs(e.Fragment,{children:[e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${De}`,children:"비고"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Pe}`,children:"링크"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${qe}`,children:"지출예정일"})]}):"receipt"===l?e.jsxs(e.Fragment,{children:[e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${De}`,children:"비고"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ee}`,children:"PJ업체"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Se}`,children:"PJ ITEM"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Fe}`,children:"수주번호"})]}):e.jsxs(e.Fragment,{children:[e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${De}`,children:"비고"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Pe}`,children:"링크"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ee}`,children:"PJ업체"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Se}`,children:"PJ ITEM"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Fe}`,children:"수주번호"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${qe}`,children:"지출예정일"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Ie}`,children:"구매진행"}),e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Te}`,children:"입고진행"})]}),e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:["purchase"===l&&e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${ze}`,children:"구매진행"}),"receipt"===l&&e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${ze}`,children:"입고진행"}),"done"===l&&e.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${ze}`,children:"거래명세서"}),a,t]})})},[l]);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:block w-full",children:e.jsx("div",{className:"overflow-x-auto border rounded-lg",children:e.jsxs("table",{className:"w-full min-w-[1790px]",children:[C,e.jsx("tbody",{children:t.map(a=>e.jsx(Me,{purchase:a,onClick:v,activeTab:l,isLeadBuyer:_,onPaymentComplete:c,onReceiptComplete:i,onExcelDownload:N},a.id))})]})})}),e.jsx("div",{className:"hidden sm:block md:hidden w-full",children:e.jsx("div",{className:"overflow-x-auto border rounded-lg",children:e.jsxs("table",{className:"w-full min-w-[600px] card-title",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-2 modal-label text-gray-900 w-24",children:"발주번호"}),e.jsx("th",{className:"text-left p-2 modal-label text-gray-900 w-16",children:"요청자"}),e.jsx("th",{className:"text-left p-2 modal-label text-gray-900 w-20",children:"업체"}),e.jsx("th",{className:"text-left p-2 modal-label text-gray-900 w-32",children:"품명"}),e.jsx("th",{className:"text-right p-2 modal-label text-gray-900 w-20",children:"금액"}),e.jsx("th",{className:"text-center p-2 modal-label text-gray-900 w-16",children:"상태"})]})}),e.jsx("tbody",{children:t.map(a=>e.jsxs("tr",{className:"border-b hover:bg-gray-50 cursor-pointer",onClick:()=>v(a),children:[e.jsx("td",{className:"p-2 modal-value",children:a.purchase_order_number||"-"}),e.jsx("td",{className:"p-2",children:a.requester_name}),e.jsx("td",{className:"p-2 truncate",title:a.vendor_name,children:a.vendor_name}),e.jsx("td",{className:"p-2 truncate",title:a.item_name,children:a.item_name||"-"}),e.jsx("td",{className:"p-2 text-right card-amount",children:a.amount_value?`${a.amount_value.toLocaleString()} ${he(a.currency||"KRW")}`:a.total_amount?`${a.total_amount.toLocaleString()} ${he(a.currency||"KRW")}`:`0 ${he(a.currency||"KRW")}`}),e.jsx("td",{className:"p-2 text-center",children:e.jsx(xe,{purchase:a})})]},a.id))})]})})}),e.jsx("div",{className:"sm:hidden space-y-3",children:t.map(a=>e.jsx(q,{purchase:a,onClick:()=>v(a)},a.id))}),e.jsx(R,{purchaseId:d,isOpen:m,onClose:()=>{p(!1),o(null)},currentUserRoles:s,activeTab:l,onRefresh:r,onOptimisticUpdate:n,onDelete:e=>{g(e),h(!0)}}),e.jsx(le,{open:x,onOpenChange:h,children:e.jsxs(ne,{children:[e.jsxs(ce,{children:[e.jsx(de,{children:"발주요청 내역 삭제"}),e.jsxs(oe,{children:["발주요청번호 ",u?.purchase_order_number,"를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."]})]}),e.jsxs(ie,{children:[e.jsx(pe,{children:"취소"}),e.jsx(me,{onClick:async()=>{if(u){w.debug("발주 삭제 확인",{id:u.id,purchase_order_number:u.purchase_order_number,requester_name:u.requester_name,final_manager_status:u.final_manager_status});try{const e="https://qvhbigvdfyvhoegkhvef.supabase.co";if(!e||!"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF2aGJpZ3ZkZnl2aG9lZ2todmVmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc4MTQzNjAsImV4cCI6MjA2MzM5MDM2MH0.7VZlSwnNuE0MaQpDjuzeZFgjJrDBQOWA_COyqaM8Rbg"||e.includes("placeholder"))return w.warn("Supabase 환경 변수가 설정되지 않음 - FastPurchaseTable"),void f.error("환경 설정 오류가 발생했습니다.");const{data:{user:a},error:t}=await y.auth.getUser();if(t||!a)return void f.error("로그인이 필요합니다.");const{data:l,error:s}=await y.from("employees").select("name, email, purchase_role").eq("email",a.email).single();if(w.debug("사용자 권한 확인",{employee:l?.name,roles:l?.purchase_role,email:l?.email}),s||!l)return void f.error("사용자 권한을 확인할 수 없습니다.");let n=[];if(l.purchase_role)if(Array.isArray(l.purchase_role))n=l.purchase_role.map(e=>String(e).trim());else{n=String(l.purchase_role).split(",").map(e=>e.trim()).filter(e=>e.length>0)}const c=n.includes("final_approver")||n.includes("app_admin")||n.includes("ceo"),i="approved"===u.final_manager_status,d=u.requester_name===l.name,o=i?c:c||d;if(w.debug("삭제 권한 확인",{canEdit:c,isApproved:i,isRequester:d,canDeleteThis:o,userRoles:n}),!o)return void f.error("삭제 권한이 없습니다.");const{data:m,error:p}=await y.from("purchase_request_items").delete().eq("purchase_request_id",u.id).select();if(p)throw w.error("아이템 삭제 중 오류 발생",p,{code:p.code,message:p.message,details:p.details,hint:p.hint}),p;w.debug("아이템 삭제 완료",{deletedItemsCount:m?.length||0,purchaseRequestId:u.id});const{data:x,error:h}=await y.from("purchase_requests").delete().eq("id",u.id).select();if(h)throw w.error("발주요청 삭제 중 오류 발생",h,{code:h.code,message:h.message,details:h.details,hint:h.hint}),h;w.debug("발주요청 삭제 완료",{deletedRequestId:u.id,purchase_order_number:u.purchase_order_number}),f.success("발주요청 내역이 삭제되었습니다."),r?.()}catch(e){const a=e;w.error("발주요청 삭제 중 예외 발생",a,{name:a?.name,message:a?.message,code:a?.code,details:a?.details,hint:a?.hint,stack:a?.stack}),f.error(`삭제 중 오류가 발생했습니다: ${a?.message||"알 수 없는 오류"}`)}h(!1),g(null)}},className:"bg-red-600 hover:bg-red-700",children:"삭제"})]})]})})]})});Oe.displayName="FastPurchaseTable";export{Oe as default};
//# sourceMappingURL=FastPurchaseTable-r8glpUiK.js.map
