import{c as S,a as O,r as D,u as L,j as e,B as g,S as C}from"./index-BtvHfG_q.js";import{B as p,t as k}from"./index-X2Wg0xG-.js";import{C as y,a as j,b,c as N}from"./card-B7dLkW5e.js";import{E as R}from"./eye-HrWmnDaY.js";import{C as A}from"./circle-check-big-DVo2-2l3.js";import{P}from"./package-CBE261W9.js";/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],w=S("arrow-right",E);/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],$=S("clock",U);/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]],M=S("thumbs-up",B);/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],H=S("triangle-alert",F);/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]],T=S("truck",Q);class K{constructor(){this.supabase=O()}parseRoles(r){let t=[];return r&&(Array.isArray(r)?t=r.map(n=>String(n).trim()):t=String(r).split(",").map(s=>s.trim()).filter(s=>s.length>0)),t}async getDashboardData(r){const[t,n,s,l,d,i,_]=await Promise.all([this.getDashboardStats(r),this.getUrgentRequests(r),this.getMyRecentRequests(r),this.getPendingApprovals(r),this.getQuickActions(r),this.getTodaySummary(r),this.getMyPurchaseStatus(r)]);return{employee:r,stats:t,urgentRequests:n,myRecentRequests:s,pendingApprovals:l,quickActions:d,todaySummary:i,myPurchaseStatus:_}}async getDashboardStats(r){const t=new Date().toISOString().split("T")[0],n=this.parseRoles(r.purchase_role);console.log("Getting stats for employee:",r.name,"with roles:",n);const[s,l,d,i,_,f]=await Promise.all([this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}),this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).eq("requester_name",r.name),this.getPendingCount(r,n),this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).eq("is_received",!0).gte("received_at",new Date(new Date().getFullYear(),new Date().getMonth(),1).toISOString()),this.getUrgentCount(r,n),this.getTodayActionsCount(r,t)]),q={total:s.count||0,myRequests:l.count||0,pending:d,completed:i.count||0,urgent:_,todayActions:f};return console.log("Dashboard stats:",q),q}async getUrgentRequests(r){const t=new Date(Date.now()-2592e5).toISOString(),n=this.parseRoles(r.purchase_role);if(n.length===0)return[];let s=this.supabase.from("purchase_requests").select(`
        *,
        vendors (vendor_name),
        purchase_request_items (id)
      `).lt("created_at",t);if(n.includes("app_admin"))s=s.or("middle_manager_status.eq.pending,final_manager_status.eq.pending,purchase_status.eq.pending");else if(n.includes("middle_manager"))s=s.eq("middle_manager_status","pending");else if(n.includes("final_approver")||n.includes("ceo"))s=s.eq("middle_manager_status","approved").eq("final_manager_status","pending");else if(n.includes("lead_buyer"))s=s.eq("final_manager_status","approved").eq("purchase_status","pending");else return[];const{data:l}=await s.order("created_at",{ascending:!0}).limit(5);return(l||[]).map(d=>({...d,vendor_name:d.vendors?.vendor_name,total_items:d.purchase_request_items?.length||0,daysOverdue:Math.floor((Date.now()-new Date(d.created_at).getTime())/(1e3*60*60*24)),priority:this.calculatePriority(d),urgentReason:this.getUrgentReason(d,n)}))}async getMyRecentRequests(r){const{data:t}=await this.supabase.from("purchase_requests").select(`
        *,
        vendors (vendor_name),
        purchase_request_items (id)
      `).eq("requester_name",r.name).or("middle_manager_status.eq.pending,final_manager_status.eq.pending").order("created_at",{ascending:!1}).limit(5);return(t||[]).map(n=>({...n,vendor_name:n.vendors?.vendor_name,total_items:n.purchase_request_items?.length||0,progress_percentage:this.calculateProgress(n),current_step:this.getCurrentStep(n),next_action:this.getNextAction(n),estimated_completion:this.estimateCompletion(n)}))}async getPendingApprovals(r){const t=this.parseRoles(r.purchase_role);let n=null;const s=await this.supabase.from("purchase_requests").select(`
        *,
        vendors (vendor_name),
        purchase_request_items (item_name, quantity, unit_price_value, amount_value)
      `).order("request_date",{ascending:!1}).limit(1e3);if(s.error){s.error;const i=await this.supabase.from("purchase_requests").select("*").order("request_date",{ascending:!1}).limit(1e3);if(i.error)return console.error("Error fetching purchase requests (fallback failed):",i.error),[];n=i.data||[]}else n=s.data||[];let l=n||[];const d=i=>i==="pending"||i==="ëŒ€ê¸°"||i===""||i===null||i===void 0;if(t.includes("app_admin"))l=l.filter(i=>d(i.middle_manager_status)||i.middle_manager_status==="approved"&&d(i.final_manager_status));else if(t.includes("middle_manager")&&!t.some(i=>["final_approver","ceo","app_admin"].includes(i)))l=l.filter(i=>d(i.middle_manager_status));else if(t.some(i=>["final_approver","ceo","app_admin"].includes(i)))l=l.filter(i=>i.middle_manager_status==="approved"&&d(i.final_manager_status));else if(t.includes("lead_buyer"))l=[];else return[];return l.map(i=>({...i,vendor_name:i.vendors?.vendor_name,purchase_request_items:i.purchase_request_items||i.items||[],total_amount:(i.purchase_request_items||i.items||[]).reduce((_,f)=>{const q=Number(f?.amount_value)||(Number(f?.quantity)||0)*(Number(f?.unit_price_value)||0);return _+q},0)}))}async getQuickActions(r){const t=this.parseRoles(r.purchase_role),n=[];if(t.includes("app_admin")||t.includes("middle_manager")||t.includes("final_approver")||t.includes("ceo")){const s=await this.getPendingCount(r,t);s>0&&n.push({id:"approve",type:"approve",label:"ìŠ¹ì¸ ëŒ€ê¸°",description:`${s}ê±´ì˜ ìŠ¹ì¸ ëŒ€ê¸° ì¤‘`,count:s,color:"red"})}if(t.includes("lead_buyer")){const{count:s}=await this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).eq("final_manager_status","approved").eq("purchase_status","pending");s&&s>0&&n.push({id:"purchase",type:"purchase",label:"êµ¬ë§¤ ì²˜ë¦¬",description:`${s}ê±´ì˜ êµ¬ë§¤ ëŒ€ê¸° ì¤‘`,count:s,color:"yellow"})}return n}async getTodaySummary(r){const t=new Date().toISOString().split("T")[0],n=new Date(Date.now()+1440*60*1e3).toISOString().split("T")[0],[s,l,d]=await Promise.all([this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).gte("updated_at",t).lt("updated_at",n).or("middle_manager_status.eq.approved,final_manager_status.eq.approved"),this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).eq("requester_name",r.name).gte("created_at",t).lt("created_at",n),this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).eq("is_received",!0).gte("received_at",t).lt("received_at",n)]);return{approved:s.count||0,requested:l.count||0,received:d.count||0}}async getMyPurchaseStatus(r){const t=new Date(Date.now()-6048e5).toISOString(),[n,s,l]=await Promise.all([this.supabase.from("purchase_requests").select(`
          *,
          vendors (vendor_name),
          purchase_request_items (item_name, quantity)
        `).eq("requester_name",r.name).or("purchase_status.is.null,purchase_status.eq.pending,purchase_status.eq.,purchase_status.eq.ëŒ€ê¸°").order("created_at",{ascending:!1}).limit(5),this.supabase.from("purchase_requests").select(`
          *,
          vendors (vendor_name),
          purchase_request_items (item_name, quantity)
        `).eq("requester_name",r.name).eq("is_payment_completed",!0).or("is_received.is.null,is_received.eq.false").order("created_at",{ascending:!1}).limit(5),this.supabase.from("purchase_requests").select(`
          *,
          vendors (vendor_name),
          purchase_request_items (item_name, quantity)
        `).eq("requester_name",r.name).eq("is_received",!0).gte("received_at",t).order("received_at",{ascending:!1}).limit(5)]);return{waitingPurchase:(n.data||[]).filter(i=>(i.progress_type||"").includes("ì„ ì§„í–‰")||i.final_manager_status==="approved"),waitingDelivery:s.data||[],recentCompleted:l.data||[]}}async quickApprove(r,t){try{const n=this.parseRoles(t.purchase_role),{data:s}=await this.supabase.from("purchase_requests").select("middle_manager_status, final_manager_status").eq("id",r).single();if(!s)return{success:!1,error:"ìš”ì²­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."};let l={};n.includes("app_admin")?s.middle_manager_status==="pending"?l={middle_manager_status:"approved",middle_manager_approved_at:new Date().toISOString(),middle_manager_id:t.id}:s.final_manager_status==="pending"&&(l={final_manager_status:"approved",final_manager_approved_at:new Date().toISOString(),final_manager_id:t.id}):n.includes("middle_manager")?l={middle_manager_status:"approved",middle_manager_approved_at:new Date().toISOString(),middle_manager_id:t.id}:(n.includes("final_approver")||n.includes("ceo"))&&(l={final_manager_status:"approved",final_manager_approved_at:new Date().toISOString(),final_manager_id:t.id});const{error:d}=await this.supabase.from("purchase_requests").update(l).eq("id",r);if(d)throw d;return{success:!0}}catch(n){return{success:!1,error:n.message}}}async getPendingCount(r,t){const n=s=>`${s}.in.(pending,ëŒ€ê¸°),${s}.is.null,${s}.eq.`;if(t.includes("app_admin")){const[s,l,d]=await Promise.all([this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).or(n("middle_manager_status")),this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).eq("middle_manager_status","approved").or(n("final_manager_status")),this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).eq("final_manager_status","approved").or(n("purchase_status"))]),i=(s.count||0)+(l.count||0)+(d.count||0);return console.log("Pending count (admin):",i),i}if(t.includes("middle_manager")){const{count:s,error:l}=await this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).or(n("middle_manager_status"));return l?(console.error("Error counting pending (middle_manager):",l),0):(console.log("Pending count (middle_manager):",s),s||0)}if(t.includes("final_approver")||t.includes("ceo")){const{count:s,error:l}=await this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).eq("middle_manager_status","approved").or(n("final_manager_status"));return l?(console.error("Error counting pending (final_approver/ceo):",l),0):(console.log("Pending count (final_approver/ceo):",s),s||0)}if(t.includes("lead_buyer")){const{count:s,error:l}=await this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).eq("final_manager_status","approved").or(n("purchase_status"));return l?(console.error("Error counting pending (lead_buyer):",l),0):(console.log("Pending count (lead_buyer):",s),s||0)}return 0}async getUrgentCount(r,t){if(t.length===0)return 0;const n=new Date(Date.now()-4320*60*1e3).toISOString();let s=this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).lt("created_at",n);if(t.includes("app_admin"))s=s.or("middle_manager_status.eq.pending,final_manager_status.eq.pending,purchase_status.eq.pending");else if(t.includes("middle_manager"))s=s.eq("middle_manager_status","pending");else if(t.includes("final_approver")||t.includes("ceo"))s=s.eq("middle_manager_status","approved").eq("final_manager_status","pending");else if(t.includes("lead_buyer"))s=s.eq("final_manager_status","approved").eq("purchase_status","pending");else return 0;const{count:l}=await s;return l||0}async getTodayActionsCount(r,t){const n=new Date(Date.now()+864e5).toISOString().split("T")[0],{count:s}=await this.supabase.from("purchase_requests").select("id",{count:"exact",head:!0}).gte("updated_at",t).lt("updated_at",n).or(`middle_manager_id.eq.${r.id},final_manager_id.eq.${r.id}`);return s||0}calculatePriority(r){const t=Math.floor((Date.now()-new Date(r.created_at).getTime())/864e5);return t>=7?"high":t>=5?"medium":"low"}getUrgentReason(r,t){return t.includes("middle_manager")&&r.middle_manager_status==="pending"||(t.includes("final_approver")||t.includes("ceo"))&&r.final_manager_status==="pending"?"overdue_approval":r.is_received?"payment_pending":"delivery_delay"}calculateProgress(r){let t=0;return r.middle_manager_status==="approved"&&(t+=25),r.final_manager_status==="approved"&&(t+=25),r.is_payment_completed&&(t+=25),r.is_received&&(t+=25),t}getCurrentStep(r){return r.is_received?"completed":r.is_payment_completed?"delivery":r.final_manager_status==="approved"?"purchase":"approval"}getNextAction(r){return r.middle_manager_status==="pending"?"ì¤‘ê°„ ìŠ¹ì¸ ëŒ€ê¸° ì¤‘":r.final_manager_status==="pending"?"ìµœì¢… ìŠ¹ì¸ ëŒ€ê¸° ì¤‘":r.is_payment_completed?r.is_received?"ì™„ë£Œ":"ì…ê³  ëŒ€ê¸° ì¤‘":"êµ¬ë§¤ ì²˜ë¦¬ ëŒ€ê¸° ì¤‘"}estimateCompletion(r){const t=new Date(r.created_at);Math.floor((new Date().getTime()-t.getTime())/(1e3*60*60*24));let s=7;return r.progress_type==="ê¸´ê¸‰"&&(s=3),new Date(t.getTime()+s*24*60*60*1e3).toLocaleDateString("ko-KR")}}const I=new K;function X(){const[c,r]=D.useState(null),[t,n]=D.useState(!0),[s,l]=D.useState(null),d=L();D.useEffect(()=>{i()},[]);const i=async()=>{try{n(!0);const a=O(),{data:{user:o}}=await a.auth.getUser();if(!o)return;const{data:u}=await a.from("employees").select("*").eq("email",o.email).single();if(!u)return;const m=await I.getDashboardData(u);console.log("=== Dashboard Debug ==="),console.log("Employee:",u),console.log("Employee purchase_role:",u.purchase_role),console.log("Dashboard Data:",m),console.log("Pending Approvals:",m.pendingApprovals),console.log("Pending Count:",m.pendingApprovals?.length||0),console.log("==================="),r(m)}catch(a){console.error("Dashboard load error:",a)}finally{n(!1)}},_=async a=>{if(c?.employee){l(a);try{const o=await I.quickApprove(a,c.employee);o.success?(k.success("ìŠ¹ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."),i()):k.error(o.error||"ìŠ¹ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}catch{k.error("ìŠ¹ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}finally{l(null)}}},f=a=>{switch(a){case"high":return"bg-red-100 text-red-800 border-red-200";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"low":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}};if(t)return e.jsx("div",{className:"flex items-center justify-center h-screen bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-3 border-hansl-500 border-t-transparent rounded-full animate-spin mx-auto"}),e.jsx("p",{className:"mt-4 text-sm text-gray-600",children:"ëŒ€ì‹œë³´ë“œë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆìŠµë‹ˆë‹¤..."})]})});if(!c?.employee)return e.jsx("div",{className:"flex items-center justify-center h-screen bg-gray-50",children:e.jsxs("div",{className:"text-center bg-white p-8 rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"}),e.jsx("p",{className:"text-sm text-gray-600",children:"ë¡œê·¸ì¸ì„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."})]})});const z=(Array.isArray(c.employee.purchase_role)?c.employee.purchase_role.map(a=>String(a).trim()):c.employee.purchase_role?String(c.employee.purchase_role).split(",").map(a=>a.trim()).filter(a=>a.length>0):[]).some(a=>["middle_manager","final_approver","app_admin"].includes(a));return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"ëŒ€ì‹œë³´ë“œ"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[c.employee.name,"ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤. ğŸ“Š"]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx(p,{variant:"outline",className:"text-xs",children:new Date().toLocaleDateString("ko-KR",{month:"long",day:"numeric",weekday:"short"})})})]})}),c.urgentRequests.length>0&&e.jsxs(y,{className:"mb-4 border-red-200 bg-red-50",children:[e.jsx(j,{className:"pb-3",children:e.jsxs(b,{className:"flex items-center gap-2 text-red-800",children:[e.jsx(H,{className:"w-5 h-5"}),"ê¸´ê¸‰ ì²˜ë¦¬ í•„ìš” (",c.urgentRequests.length,"ê±´)"]})}),e.jsx(N,{className:"space-y-3",children:c.urgentRequests.slice(0,3).map(a=>e.jsx("div",{className:"bg-white rounded-lg p-4 border border-red-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(p,{className:f(a.priority),children:a.priority==="high"?"ë†’ìŒ":a.priority==="medium"?"ë³´í†µ":"ë‚®ìŒ"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:a.vendor_name||"ì—…ì²´ëª… ì—†ìŒ"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[a.daysOverdue,"ì¼ ì§€ì—°"]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["ë°œì£¼ìš”ì²­ë²ˆí˜¸: ",a.purchase_order_number||a.id.slice(0,8),e.jsxs("span",{className:"ml-2",children:["í•­ëª©: ",a.total_items,"ê°œ"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(g,{size:"sm",variant:"outline",onClick:()=>d(`/purchase?highlight=${a.id}`),children:[e.jsx(R,{className:"w-4 h-4 mr-1"}),"ë³´ê¸°"]}),e.jsxs(g,{size:"sm",onClick:()=>_(a.id),disabled:s===a.id,className:"bg-red-600 hover:bg-red-700",children:[e.jsx(M,{className:"w-4 h-4 mr-1"}),s===a.id?"ì²˜ë¦¬ì¤‘...":"ìŠ¹ì¸"]})]})]})},a.id))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-3",children:[e.jsxs(y,{children:[e.jsx(j,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(b,{className:"text-sm font-semibold",children:[c.employee.name,"ë‹˜ì˜ ìŠ¹ì¸ ì§„í–‰ì¤‘"]}),e.jsxs(g,{variant:"ghost",size:"sm",onClick:()=>d("/purchase"),children:["ì „ì²´ë³´ê¸° ",e.jsx(w,{className:"w-4 h-4 ml-1"})]})]})}),e.jsx(N,{className:"space-y-3",children:c.myRecentRequests.length===0?e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx($,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-xs",children:"ìŠ¹ì¸ ì§„í–‰ì¤‘ ì—†ìŒ"}),e.jsx(g,{size:"sm",variant:"outline",className:"mt-2 h-7 text-xs",onClick:()=>d("/purchase/new"),children:"ìƒˆ ìš”ì²­"})]}):c.myRecentRequests.map(a=>e.jsxs("div",{className:"border rounded-lg p-4 hover:shadow-sm transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-sm",children:a.vendor_name}),e.jsx(p,{className:"bg-yellow-100 text-yellow-800",variant:"outline",children:a.middle_manager_status==="pending"?"ì¤‘ê°„ ìŠ¹ì¸ ëŒ€ê¸°":"ìµœì¢… ìŠ¹ì¸ ëŒ€ê¸°"})]}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(a.created_at).toLocaleDateString("ko-KR")})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"ìŠ¹ì¸ ì§„í–‰ë¥ "}),e.jsx("span",{className:"font-medium",children:a.middle_manager_status==="pending"?"25%":"50%"})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-yellow-500 h-2 rounded-full transition-all duration-300",style:{width:a.middle_manager_status==="pending"?"25%":"50%"}})})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-600",children:a.next_action}),e.jsxs(g,{size:"sm",variant:"ghost",onClick:()=>d(`/purchase?highlight=${a.id}`),children:["ìƒì„¸ë³´ê¸° ",e.jsx(w,{className:"w-3 h-3 ml-1"})]})]})]},a.id))})]}),z&&e.jsxs(y,{children:[e.jsx(j,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(b,{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4 text-orange-500"}),"ìŠ¹ì¸ ëŒ€ê¸°",c.pendingApprovals.length>0&&e.jsx(p,{variant:"destructive",className:"text-xs h-5 px-1.5",children:c.pendingApprovals.length})]}),c.pendingApprovals.length>0&&e.jsxs(g,{size:"sm",variant:"ghost",onClick:()=>d("/purchase"),className:"text-xs",children:["ì „ì²´ë³´ê¸°",e.jsx(w,{className:"w-3 h-3 ml-1"})]})]})}),e.jsx(N,{className:"space-y-2",children:c.pendingApprovals.length===0?e.jsxs("div",{className:"text-center py-4 text-gray-400",children:[e.jsx(A,{className:"w-6 h-6 mx-auto mb-1"}),e.jsx("p",{className:"text-xs",children:"ëŒ€ê¸° í•­ëª© ì—†ìŒ"})]}):e.jsx("div",{className:"max-h-80 overflow-y-auto space-y-2",children:c.pendingApprovals.map(a=>e.jsx("div",{className:"border rounded-lg p-3 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-sm truncate",children:a.requester_name}),e.jsx(p,{variant:"outline",className:`text-xs h-4 px-1 ${a.middle_manager_status==="approved"?"bg-blue-50 text-blue-700 border-blue-200":"bg-yellow-50 text-yellow-700 border-yellow-200"}`,children:a.middle_manager_status==="approved"?"ìµœì¢…":"1ì°¨"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:[e.jsx("span",{className:"truncate",children:a.vendor_name||"ì—…ì²´ ë¯¸ì§€ì •"}),e.jsxs("span",{className:"font-medium",children:[a.total_amount?.toLocaleString(),"ì›"]}),e.jsx("span",{children:new Date(a.created_at).toLocaleDateString("ko-KR",{month:"numeric",day:"numeric"})})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(g,{size:"sm",variant:"ghost",onClick:()=>d(`/purchase/requests/${a.id}`),className:"h-7 w-7 p-0",children:e.jsx(R,{className:"w-3.5 h-3.5"})}),e.jsx(g,{size:"sm",onClick:()=>_(a.id),disabled:s===a.id,className:"h-7 px-2 bg-green-600 hover:bg-green-700 text-white",children:s===a.id?e.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"w-3 h-3 mr-1"}),"ìŠ¹ì¸"]})})]})]})},a.id))})})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("h2",{className:"text-base font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4 text-gray-600"}),c.employee.name,"ë‹˜ì˜ ë°œì£¼ ì²˜ë¦¬ í˜„í™©"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-3",children:[e.jsxs(y,{children:[e.jsx(j,{className:"pb-3",children:e.jsxs(b,{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(C,{className:"w-4 h-4 text-yellow-600"}),"êµ¬ë§¤ ëŒ€ê¸°",c.myPurchaseStatus.waitingPurchase.length>0&&e.jsx(p,{variant:"outline",className:"text-xs bg-yellow-50",children:c.myPurchaseStatus.waitingPurchase.length})]})}),e.jsx(N,{className:"space-y-3",children:c.myPurchaseStatus.waitingPurchase.length===0?e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx(C,{className:"w-6 h-6 mx-auto mb-1 text-gray-400"}),e.jsx("p",{className:"text-xs",children:"êµ¬ë§¤ ëŒ€ê¸° ì—†ìŒ"})]}):c.myPurchaseStatus.waitingPurchase.map(a=>{const o=a.purchase_request_items||[],u=o.reduce((x,v)=>x+(Number(v.amount_value)||0),0),m=o.reduce((x,v)=>x+(Number(v.quantity)||0),0),h=o[0];return e.jsxs("div",{className:"border rounded-lg p-3 hover:shadow-sm transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:"font-medium text-sm truncate",children:a.vendor_name||"ì—…ì²´ëª… ì—†ìŒ"}),e.jsx(p,{variant:"outline",className:"text-xs bg-yellow-50 text-yellow-700 shrink-0",children:"êµ¬ë§¤ ëŒ€ê¸°"})]}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[h&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"truncate",children:["í’ˆëª…: ",h.item_name||"-"]}),e.jsxs("div",{className:"truncate",children:["ê·œê²©: ",h.specification||"-"]})]}),e.jsxs("div",{children:["í’ˆëª©: ",o.length,"ê°œ / ìˆ˜ëŸ‰: ",m]}),e.jsxs("div",{className:"font-medium text-gray-900",children:["ì´ì•¡: ",u.toLocaleString(),"ì›"]})]}),e.jsxs(g,{size:"sm",variant:"ghost",className:"w-full mt-2",onClick:()=>d(`/purchase?highlight=${a.id}`),children:["ìƒì„¸ë³´ê¸° ",e.jsx(w,{className:"w-3 h-3 ml-1"})]})]},a.id)})})]}),e.jsxs(y,{children:[e.jsx(j,{className:"pb-3",children:e.jsxs(b,{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(T,{className:"w-4 h-4 text-blue-600"}),"ì…ê³  ëŒ€ê¸°",c.myPurchaseStatus.waitingDelivery.length>0&&e.jsx(p,{variant:"outline",className:"text-xs bg-blue-50",children:c.myPurchaseStatus.waitingDelivery.length})]})}),e.jsx(N,{className:"space-y-3",children:c.myPurchaseStatus.waitingDelivery.length===0?e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx(T,{className:"w-6 h-6 mx-auto mb-1 text-gray-400"}),e.jsx("p",{className:"text-xs",children:"ì…ê³  ëŒ€ê¸° ì—†ìŒ"})]}):c.myPurchaseStatus.waitingDelivery.map(a=>{const o=a.purchase_request_items?.length||0,u=a.purchase_request_items?.filter(h=>h.is_received).length||0,m=u>0&&u<o;return e.jsxs("div",{className:"border rounded-lg p-3 hover:shadow-sm transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:"font-medium text-sm truncate",children:a.vendor_name||"ì—…ì²´ëª… ì—†ìŒ"}),e.jsx(p,{variant:"outline",className:`text-xs shrink-0 ${m?"bg-orange-50 text-orange-700":"bg-blue-50 text-blue-700"}`,children:m?"ë¶€ë¶„ì…ê³ ":"ì…ê³  ëŒ€ê¸°"})]}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[a.purchase_request_items?.[0]&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"truncate",children:["í’ˆëª…: ",a.purchase_request_items[0].item_name||"-"]}),e.jsxs("div",{className:"truncate",children:["ê·œê²©: ",a.purchase_request_items[0].specification||"-"]})]}),e.jsxs("div",{children:["í’ˆëª©: ",o,"ê°œ / ì…ê³ : ",u,"/",o]}),e.jsxs("div",{className:"font-medium text-gray-900",children:["ì´ì•¡: ",(a.purchase_request_items?.reduce((h,x)=>h+(Number(x.amount_value)||0),0)||0).toLocaleString(),"ì›"]})]}),m&&e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:"bg-blue-500 h-1.5 rounded-full",style:{width:`${u/o*100}%`}})})}),e.jsxs(g,{size:"sm",variant:"ghost",className:"w-full mt-2",onClick:()=>d(`/purchase?highlight=${a.id}`),children:["ìƒì„¸ë³´ê¸° ",e.jsx(w,{className:"w-3 h-3 ml-1"})]})]},a.id)})})]}),e.jsxs(y,{children:[e.jsx(j,{className:"pb-3",children:e.jsxs(b,{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4 text-green-600"}),"ìµœê·¼ ì™„ë£Œ",c.myPurchaseStatus.recentCompleted.length>0&&e.jsx(p,{variant:"outline",className:"text-xs bg-green-50",children:c.myPurchaseStatus.recentCompleted.length})]})}),e.jsx(N,{className:"space-y-3",children:c.myPurchaseStatus.recentCompleted.length===0?e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx(P,{className:"w-6 h-6 mx-auto mb-1 text-gray-400"}),e.jsx("p",{className:"text-xs",children:"ìµœê·¼ ì™„ë£Œ ì—†ìŒ"})]}):c.myPurchaseStatus.recentCompleted.map(a=>{const o=a.purchase_request_items||[],u=o.reduce((x,v)=>x+(Number(v.amount_value)||0),0),m=o.reduce((x,v)=>x+(Number(v.quantity)||0),0),h=o[0];return e.jsxs("div",{className:"border rounded-lg p-3 hover:shadow-sm transition-shadow bg-green-50/30",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:"font-medium text-sm truncate",children:a.vendor_name||"ì—…ì²´ëª… ì—†ìŒ"}),e.jsxs(p,{className:"text-xs bg-green-100 text-green-800 shrink-0",children:[e.jsx(A,{className:"w-3 h-3 mr-1"}),"ì™„ë£Œ"]})]}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[h&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"truncate",children:["í’ˆëª…: ",h.item_name||"-"]}),e.jsxs("div",{className:"truncate",children:["ê·œê²©: ",h.specification||"-"]})]}),e.jsxs("div",{children:["í’ˆëª©: ",o.length,"ê°œ / ìˆ˜ëŸ‰: ",m]}),e.jsxs("div",{className:"font-medium text-gray-900",children:["ì´ì•¡: ",u.toLocaleString(),"ì›"]})]}),e.jsxs(g,{size:"sm",variant:"ghost",className:"w-full mt-2",onClick:()=>d(`/purchase?highlight=${a.id}`),children:["ìƒì„¸ë³´ê¸° ",e.jsx(w,{className:"w-3 h-3 ml-1"})]})]},a.id)})})]})]})]})]})})}export{X as default};
//# sourceMappingURL=DashboardMain-BQcrdEQc.js.map
