const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/exceljs.min-CucAydNS.js","assets/index-BSunsSFw.js","assets/index-DcxUL4H8.css"])))=>i.map(i=>d[i]);
import{_ as e,r as a,j as t,o as l,m as r,n as s,K as n,k as c,L as i,a as d,l as o}from"./index-BSunsSFw.js";import{B as m,t as p}from"./index-D1X8P_li.js";import{P as x}from"./PurchaseDetailModal-DpLQRgPv.js";import{a as h}from"./helpers-C_CnFjYT.js";import{E as u}from"./eye-D5SK7KQL.js";import{j as g,R as y,P as _,W as j,C as f,T as w,k as b,l as v,O as N,m as C}from"./input-Cgv8IQYd.js";import"./format-DHKmDYfm.js";import"./chevron-left-DvyegcoG.js";import"./chevron-down-C2j52g2p.js";import"./popover-Dvl0zKFu.js";import"./calendar-DiFEfomt.js";import"./package-DRmyEQWG.js";import"./credit-card-C9DR-OqD.js";import"./trash-2-DXvssGJW.js";import"./plus-Bi58451Y.js";import"./save-DESjqfQg.js";function $(e){if(!e)return"";const a=new Date(e);return isNaN(a.getTime())?e:`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`}function k(e){return e?["KRW","원","₩"].includes(e)?"₩":["USD","$","달러"].includes(e)?"$":["EUR","€"].includes(e)?"€":["JPY","엔","¥"].includes(e)||["CNY","위안","元"].includes(e)?"¥":e:""}const A=a.memo(({purchase:e})=>{const a=e.is_received?"completed":"approved"===e.middle_manager_status&&"approved"===e.final_manager_status?"inProgress":"rejected"===e.middle_manager_status||"rejected"===e.final_manager_status?"rejected":"pending",{text:l,className:r}={completed:{text:"입고완료",className:"badge-success"},inProgress:{text:"구매진행",className:"badge-primary"},rejected:{text:"반려",className:"badge-danger"},pending:{text:"승인대기",className:"badge-warning"}}[a];return t.jsx(m,{variant:null,className:r,children:l})});A.displayName="StatusBadge";const R=a.memo(({purchase:e,onClick:a})=>{const l=(e=>{if(!e.items||0===e.items.length)return{received:0,total:0,percentage:0};const a=e.items.length,t=e.items.filter(e=>e.is_received||"received"===e.delivery_status).length;return{received:t,total:a,percentage:a>0?Math.round(t/a*100):0}})(e),r="선진행"===e.progress_type||e.progress_type?.includes("선진행");return t.jsxs("div",{className:"bg-white rounded-lg border p-4 space-y-3 cursor-pointer transition-all hover:shadow-md "+(r?"border-red-400 bg-red-50 hover:bg-red-100":"hover:bg-gray-50"),onClick:()=>a(e),children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2",children:[r?t.jsx(m,{variant:null,className:"badge-danger",children:"선진행"}):t.jsx(m,{variant:null,className:"badge-secondary",children:"일반"}),t.jsx("span",{className:"card-title text-gray-900",children:e.purchase_order_number||"-"})]}),t.jsxs("div",{className:"badge-text text-gray-500 mt-1",children:[h(e.request_date)," 요청"]})]}),t.jsx(A,{purchase:e})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[t.jsx("span",{className:"text-gray-600",children:"요청자"}),t.jsx("span",{className:"card-title",children:e.requester_name})]}),t.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[t.jsx("span",{className:"text-gray-600",children:"업체"}),t.jsx("span",{className:"card-title",children:e.vendor_name})]}),e.project_vendor&&t.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[t.jsx("span",{className:"text-gray-600",children:"PJ업체"}),t.jsx("span",{className:"card-title truncate max-w-[150px]",children:e.project_vendor})]}),e.project_item&&t.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[t.jsx("span",{className:"text-gray-600",children:"PJ ITEM"}),t.jsx("span",{className:"card-title truncate max-w-[150px]",children:e.project_item})]}),e.sales_order_number&&t.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[t.jsx("span",{className:"text-gray-600",children:"수주번호"}),t.jsx("span",{className:"card-title truncate max-w-[150px]",children:e.sales_order_number})]}),e.item_name&&t.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[t.jsx("span",{className:"text-gray-600",children:"품목"}),t.jsx("span",{className:"card-title truncate max-w-[150px]",children:e.item_name})]}),t.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[t.jsx("span",{className:"text-gray-600",children:"금액"}),t.jsxs("span",{className:"font-semibold text-gray-900",children:[(e.amount_value||e.total_amount)?.toLocaleString()," ",e.currency]})]})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"flex items-center justify-between badge-text",children:[t.jsx("span",{className:"text-gray-600",children:"입고현황"}),t.jsxs("span",{className:"text-gray-700",children:[l.received,"/",l.total," (",l.percentage,"%)"]})]}),t.jsx("div",{className:"bg-gray-200 rounded-full h-2",children:t.jsx("div",{className:"h-2 rounded-full transition-all "+(100===l.percentage?"bg-green-500":l.percentage>0?"bg-hansl-500":"bg-gray-300"),style:{width:`${l.percentage}%`}})})]}),void 0!==e.is_payment_completed&&t.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[t.jsx("span",{className:"text-gray-600",children:"결제"}),e.is_payment_completed?t.jsx(m,{variant:null,className:"badge-success",children:"완료"}):t.jsx(m,{variant:null,className:"badge-secondary",children:"대기"})]}),t.jsx("div",{className:"pt-2 border-t",children:t.jsxs("div",{className:"flex items-center justify-center badge-text text-gray-500",children:[t.jsx(u,{className:"w-3 h-3 mr-1"}),"클릭하여 상세보기"]})})]})});R.displayName="MobilePurchaseCard";var D="AlertDialog",[q,E]=r(D,[g]),F=g(),S=e=>{const{__scopeAlertDialog:a,...l}=e,r=F(a);return t.jsx(y,{...r,...l,modal:!0})};S.displayName=D;a.forwardRef((e,a)=>{const{__scopeAlertDialog:l,...r}=e,s=F(l);return t.jsx(C,{...s,...r,ref:a})}).displayName="AlertDialogTrigger";var P=e=>{const{__scopeAlertDialog:a,...l}=e,r=F(a);return t.jsx(_,{...r,...l})};P.displayName="AlertDialogPortal";var T=a.forwardRef((e,a)=>{const{__scopeAlertDialog:l,...r}=e,s=F(l);return t.jsx(N,{...s,...r,ref:a})});T.displayName="AlertDialogOverlay";var z="AlertDialogContent",[B,L]=q(z),M=n("AlertDialogContent"),W=a.forwardRef((e,r)=>{const{__scopeAlertDialog:n,children:c,...i}=e,d=F(n),o=a.useRef(null),m=l(r,o),p=a.useRef(null);return t.jsx(j,{contentName:z,titleName:I,docsSlug:"alert-dialog",children:t.jsx(B,{scope:n,cancelRef:p,children:t.jsxs(f,{role:"alertdialog",...d,...i,ref:m,onOpenAutoFocus:s(i.onOpenAutoFocus,e=>{e.preventDefault(),p.current?.focus({preventScroll:!0})}),onPointerDownOutside:e=>e.preventDefault(),onInteractOutside:e=>e.preventDefault(),children:[t.jsx(M,{children:c}),t.jsx(H,{contentRef:o})]})})})});W.displayName=z;var I="AlertDialogTitle",G=a.forwardRef((e,a)=>{const{__scopeAlertDialog:l,...r}=e,s=F(l);return t.jsx(w,{...s,...r,ref:a})});G.displayName=I;var K="AlertDialogDescription",O=a.forwardRef((e,a)=>{const{__scopeAlertDialog:l,...r}=e,s=F(l);return t.jsx(b,{...s,...r,ref:a})});O.displayName=K;var U=a.forwardRef((e,a)=>{const{__scopeAlertDialog:l,...r}=e,s=F(l);return t.jsx(v,{...s,...r,ref:a})});U.displayName="AlertDialogAction";var J="AlertDialogCancel",Y=a.forwardRef((e,a)=>{const{__scopeAlertDialog:r,...s}=e,{cancelRef:n}=L(J,r),c=F(r),i=l(a,n);return t.jsx(v,{...c,...s,ref:i})});Y.displayName=J;var H=({contentRef:e})=>{const t=`\`${z}\` requires a description for the component to be accessible for screen reader users.\n\nYou can add a description to the \`${z}\` by passing a \`${K}\` component as a child, which also benefits sighted users by adding visible context to the dialog.\n\nAlternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${z}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.\n\nFor more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return a.useEffect(()=>{document.getElementById(e.current?.getAttribute("aria-describedby"))},[t,e]),null},X=T,V=W,Q=U,Z=Y,ee=G,ae=O;const te=S,le=P,re=a.forwardRef(({className:e,...a},l)=>t.jsx(X,{className:c("fixed inset-0 z-50 bg-black/40 backdrop-blur-sm","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...a,ref:l}));re.displayName=X.displayName;const se=a.forwardRef(({className:e,...a},l)=>t.jsxs(le,{children:[t.jsx(re,{}),t.jsx(V,{ref:l,className:c("fixed left-[50%] top-[50%] z-50","w-full max-w-md translate-x-[-50%] translate-y-[-50%]","grid gap-4 bg-white border border-gray-200","rounded-lg p-6 shadow-professional-xl","duration-200","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0","data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95","data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%]","data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%]",e),...a})]}));se.displayName=V.displayName;const ne=({className:e,...a})=>t.jsx("div",{className:c("flex flex-col space-y-2 text-left",e),...a});ne.displayName="AlertDialogHeader";const ce=({className:e,...a})=>t.jsx("div",{className:c("flex flex-col-reverse sm:flex-row sm:justify-end gap-3",e),...a});ce.displayName="AlertDialogFooter";const ie=a.forwardRef(({className:e,...a},l)=>t.jsx(ee,{ref:l,className:c("text-lg font-semibold text-gray-800 tracking-tight",e),...a}));ie.displayName=ee.displayName;const de=a.forwardRef(({className:e,...a},l)=>t.jsx(ae,{ref:l,className:c("text-sm text-gray-600",e),...a}));de.displayName=ae.displayName;const oe=a.forwardRef(({className:e,...a},l)=>t.jsx(Q,{ref:l,className:c(i(),e),...a}));oe.displayName=Q.displayName;const me=a.forwardRef(({className:e,...a},l)=>t.jsx(Z,{ref:l,className:c(i({variant:"outline"}),"mt-2 sm:mt-0",e),...a}));me.displayName=Z.displayName;const pe=a.memo(({purchase:e})=>{const a=e.is_received?"completed":"approved"===e.middle_manager_status&&"approved"===e.final_manager_status?"inProgress":"rejected"===e.middle_manager_status||"rejected"===e.final_manager_status?"rejected":"pending",{text:l,className:r}={completed:{text:"입고완료",className:"badge-success"},inProgress:{text:"구매진행",className:"badge-primary"},rejected:{text:"반려",className:"badge-danger"},pending:{text:"승인대기",className:"badge-warning"}}[a];return t.jsx(m,{className:r,children:l})});pe.displayName="StatusBadge";const xe=e=>e?["KRW","원","₩"].includes(e)?"₩":["USD","$","달러"].includes(e)?"$":["EUR","€"].includes(e)?"€":["JPY","엔","¥"].includes(e)||["CNY","위안","元"].includes(e)?"¥":e:"₩",he="text-center w-20 min-w-[85px] max-w-[85px]",ue="pl-2 w-36 min-w-[145px] max-w-[145px]",ge="text-center w-20 min-w-[85px] max-w-[85px]",ye="w-16 min-w-[68px] max-w-[68px]",_e="w-20 min-w-[85px] max-w-[85px]",je="w-28 min-w-[115px] max-w-[115px]",fe="w-16 min-w-[68px] max-w-[68px]",we="w-20 min-w-[85px] max-w-[85px]",be="w-20 min-w-[85px] max-w-[85px]",ve="w-28 min-w-[120px] max-w-[120px]",Ne="w-64 min-w-[260px] max-w-[260px]",Ce="text-center w-14 min-w-[60px] max-w-[60px]",$e="text-right w-24 min-w-[100px] max-w-[100px]",ke="text-right w-24 min-w-[100px] max-w-[100px]",Ae="w-28 min-w-[115px] max-w-[115px]",Re="w-24 min-w-[100px] max-w-[100px]",De="w-24 min-w-[105px] max-w-[105px]",qe="w-28 min-w-[115px] max-w-[115px]",Ee="w-44 min-w-[180px] max-w-[180px]",Fe="text-center w-20 min-w-[85px] max-w-[85px]",Se="text-center w-20 min-w-[85px] max-w-[85px]",Pe="text-center w-16 min-w-[70px] max-w-[70px]",Te="text-center w-16 min-w-[70px] max-w-[70px]",ze="w-20 min-w-[85px] max-w-[85px]",Be=a.memo(({purchase:e})=>{const a="approved"===e.middle_manager_status,l="rejected"===e.middle_manager_status,r="approved"===e.final_manager_status,s="rejected"===e.final_manager_status;return l||s?t.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[t.jsx("div",{className:"flex items-center gap-0.5",children:t.jsx("div",{className:"w-1.5 h-1.5 bg-red-500 rounded-full animate-pulse"})}),t.jsx(m,{variant:null,className:"badge-danger",children:"반려"})]}):a&&r?t.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[t.jsx("div",{className:"flex items-center gap-0.5",children:t.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"})}),t.jsx(m,{variant:null,className:"badge-success",children:"승인완료"})]}):!a||r||s?t.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full"}),t.jsx("div",{className:"w-3 h-0.5 bg-gray-300"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full"})]}),t.jsx(m,{variant:null,className:"badge-secondary",children:"승인대기"})]}):t.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),t.jsx("div",{className:"w-3 h-0.5 bg-gray-300"}),t.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full"})]}),t.jsx(m,{variant:null,className:"badge-warning",children:"1차 승인"})]})});Be.displayName="ApprovalStatusBadge";a.memo(({type:e})=>"선진행"===e||e?.includes("선진행")?t.jsx(m,{variant:null,className:"badge-danger",children:"선진행"}):t.jsx(m,{variant:null,className:"badge-secondary",children:"일반"})).displayName="ProgressTypeBadge";const Le=a.memo(({purchase:e,onClick:a,activeTab:l,isLeadBuyer:r,onPaymentComplete:s,onReceiptComplete:n,onExcelDownload:c})=>{const i=(e=>{if(e.is_received)return{received:1,total:1,percentage:100};if(!e.items||0===e.items.length)return{received:0,total:1,percentage:0};const a=e.items.length,t=e.items.filter(e=>!0===e.is_received).length;return{received:t,total:a,percentage:a>0?Math.round(t/a*100):0}})(e),d=(e=>{if(e.is_payment_completed)return{completed:1,total:1,percentage:100};if(!e.items||0===e.items.length)return{completed:0,total:1,percentage:0};const a=e.items.length,t=e.items.filter(e=>!0===e.is_payment_completed).length;return{completed:t,total:a,percentage:a>0?Math.round(t/a*100):0}})(e);(e=>{if(!e.items||0===e.items.length){if(e.is_received)return{percentage:100};if(e.is_payment_completed)return{percentage:80};const a="rejected"===e.middle_manager_status,t="rejected"===e.final_manager_status;if(a||t)return{percentage:0};const l="approved"===e.middle_manager_status,r="approved"===e.final_manager_status;return l&&r?{percentage:40}:{percentage:20}}const a=e.items.length,t=e.items.filter(e=>!0===e.is_received).length,l=e.items.filter(e=>!0===e.is_payment_completed).length;if(t===a)return{percentage:100};if(t>0){const e=Math.round(t/a*100);return{percentage:Math.min(80+Math.round(.2*e),99)}}if(l===a)return{percentage:80};if(l>0){const e=Math.round(l/a*100);return{percentage:Math.min(40+Math.round(.4*e),79)}}const r="rejected"===e.middle_manager_status,s="rejected"===e.final_manager_status;if(r||s)return{percentage:0};const n="approved"===e.middle_manager_status,c="approved"===e.final_manager_status})(e);const o="선진행"===e.progress_type||e.progress_type?.includes("선진행");return t.jsxs("tr",{className:"border-b hover:bg-gray-100 cursor-pointer transition-colors "+(o?"bg-red-50 hover:bg-red-100":""),onClick:()=>a(e),children:["pending"===l&&t.jsx("td",{className:`px-2 py-1.5 whitespace-nowrap ${he}`,children:t.jsx(Be,{purchase:e})}),"purchase"===l&&t.jsx("td",{className:`px-2 py-1.5 ${Fe}`,children:t.jsxs("div",{className:"flex items-center justify-center gap-1",children:[t.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:t.jsx("div",{className:"h-1.5 rounded-full "+(100===d.percentage?"bg-blue-500":d.percentage>0?"bg-blue-400":"bg-gray-300"),style:{width:`${d.percentage}%`}})}),t.jsxs("span",{className:"card-title text-gray-600",children:[d.percentage,"%"]})]})}),"receipt"===l&&t.jsx("td",{className:`px-2 py-1.5 ${Fe}`,children:t.jsxs("div",{className:"flex items-center justify-center gap-1",children:[t.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:t.jsx("div",{className:"h-1.5 rounded-full "+(100===i.percentage?"bg-green-500":i.percentage>0?"bg-hansl-500":"bg-gray-300"),style:{width:`${i.percentage}%`}})}),t.jsxs("span",{className:"card-title text-gray-600",children:[i.percentage,"%"]})]})}),t.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${ue}`,children:t.jsxs("div",{className:"flex items-center gap-1",children:[c&&t.jsx("img",{src:"/excels-icon.svg",alt:"엑셀 다운로드",width:"16",height:"16",className:`inline-block align-middle transition-transform p-0.5 rounded\n                ${e.is_po_download?"border border-gray-400":""}\n                ${"선진행"===e.progress_type||e.progress_type?.includes("선진행")||"approved"===e.middle_manager_status&&"approved"===e.final_manager_status?e.is_po_download?"cursor-pointer":"cursor-pointer hover:scale-110":"opacity-40 grayscale cursor-not-allowed"}`,onClick:async a=>{("선진행"===e.progress_type||e.progress_type?.includes("선진행")||"approved"===e.middle_manager_status&&"approved"===e.final_manager_status)&&(a.stopPropagation(),await c(e))},style:{pointerEvents:"선진행"===e.progress_type||e.progress_type?.includes("선진행")||"approved"===e.middle_manager_status&&"approved"===e.final_manager_status?"auto":"none"},title:e.is_po_download?"다운로드 완료":"엑셀 발주서 다운로드"}),t.jsxs("span",{className:"block truncate",title:e.purchase_order_number||"",children:[e.purchase_order_number||"-",e.items&&e.items.length>1&&t.jsxs("span",{className:"text-gray-500 ml-0.5",children:["(",e.items.length,")"]})]})]})}),("pending"===l||"receipt"===l||"done"===l||!l)&&t.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${ge}`,children:t.jsx(m,{variant:null,className:"구매요청"===e.payment_category||"구매 요청"===e.payment_category?"badge-primary":"발주"===e.payment_category?"badge-success":("현장결제"===e.payment_category||"현장 결제"===e.payment_category||e.payment_category,"badge-secondary"),children:"발주"===e.payment_category?"발주요청":"구매 요청"===e.payment_category?"구매요청":"현장 결제"===e.payment_category?"현장결제":e.payment_category||"-"})}),t.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${ye}`,children:t.jsx("span",{className:"block truncate",title:e.requester_name||"",children:e.requester_name||"-"})}),t.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${_e}`,children:h(e.request_date)}),t.jsx("td",{className:`px-2 py-1.5 card-title ${je}`,children:t.jsx("span",{className:"block truncate",title:e.vendor_name||"",children:e.vendor_name||"-"})}),t.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${fe}`,children:t.jsx("span",{className:"block truncate",title:e.contact_name||"",children:e.contact_name||"-"})}),t.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${we}`,children:h(e.delivery_request_date)}),t.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${be}`,children:h(e.revised_delivery_request_date)}),t.jsx("td",{className:`px-2 py-1.5 card-title ${ve}`,children:t.jsx("span",{className:"block truncate",title:e.item_name||"",children:e.item_name||"-"})}),t.jsx("td",{className:`px-2 py-1.5 card-title ${Ne}`,children:t.jsx("span",{className:"block truncate",title:e.specification||"",children:e.specification||"-"})}),t.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${Ce}`,children:e.quantity||0}),t.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${$e}`,children:e.unit_price_value?`${e.unit_price_value.toLocaleString()} ${xe(e.currency||"KRW")}`:`0 ${xe(e.currency||"KRW")}`}),t.jsx("td",{className:`px-2 py-1.5 card-amount whitespace-nowrap ${ke}`,children:e.amount_value?`${e.amount_value.toLocaleString()} ${xe(e.currency||"KRW")}`:e.total_amount?`${e.total_amount.toLocaleString()} ${xe(e.currency||"KRW")}`:`0 ${xe(e.currency||"KRW")}`}),"pending"===l&&t.jsxs(t.Fragment,{children:[t.jsx("td",{className:`px-2 py-1.5 card-title ${Ae}`,children:t.jsx("span",{className:"block truncate",title:e.remark||"",children:e.remark||"-"})}),t.jsx("td",{className:`px-2 py-1.5 card-title ${De}`,children:t.jsx("span",{className:"block truncate",title:e.project_vendor||"",children:e.project_vendor||"-"})}),t.jsx("td",{className:`px-2 py-1.5 card-title ${Ee}`,children:t.jsx("span",{className:"block truncate",title:e.project_item||"",children:e.project_item||"-"})}),t.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${qe}`,children:t.jsx("span",{className:"block truncate",title:e.sales_order_number||"",children:e.sales_order_number||"-"})})]}),"purchase"===l&&t.jsxs(t.Fragment,{children:[t.jsx("td",{className:`px-2 py-1.5 card-title ${Ae}`,children:t.jsx("span",{className:"block truncate",title:e.remark||"",children:e.remark||"-"})}),t.jsx("td",{className:`px-2 py-1.5 card-title ${ze}`,children:e.link?t.jsx("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline truncate block",title:e.link,children:"링크 보기"}):t.jsx("span",{className:"text-gray-400",children:"-"})}),t.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${Re}`,children:t.jsx("span",{className:"block truncate",title:e.vendor_payment_schedule||"",children:e.vendor_payment_schedule||"-"})})]}),"receipt"===l&&t.jsxs(t.Fragment,{children:[t.jsx("td",{className:`px-2 py-1.5 card-title ${Ae}`,children:t.jsx("span",{className:"block truncate",title:e.remark||"",children:e.remark||"-"})}),t.jsx("td",{className:`px-2 py-1.5 card-title ${De}`,children:t.jsx("span",{className:"block truncate",title:e.project_vendor||"",children:e.project_vendor||"-"})}),t.jsx("td",{className:`px-2 py-1.5 card-title ${Ee}`,children:t.jsx("span",{className:"block truncate",title:e.project_item||"",children:e.project_item||"-"})}),t.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${qe}`,children:t.jsx("span",{className:"block truncate",title:e.sales_order_number||"",children:e.sales_order_number||"-"})}),t.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${Re}`,children:t.jsx("span",{className:"block truncate",title:e.vendor_payment_schedule||"",children:e.vendor_payment_schedule||"-"})})]}),("done"===l||!l)&&t.jsxs(t.Fragment,{children:[t.jsx("td",{className:`px-2 py-1.5 card-title ${Ae}`,children:t.jsx("span",{className:"block truncate",title:e.remark||"",children:e.remark||"-"})}),t.jsx("td",{className:`px-2 py-1.5 card-title ${ze}`,children:e.link?t.jsx("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline truncate block",title:e.link,children:"링크 보기"}):t.jsx("span",{className:"text-gray-400",children:"-"})}),t.jsx("td",{className:`px-2 py-1.5 card-title ${De}`,children:t.jsx("span",{className:"block truncate",title:e.project_vendor||"",children:e.project_vendor||"-"})}),t.jsx("td",{className:`px-2 py-1.5 card-title ${Ee}`,children:t.jsx("span",{className:"block truncate",title:e.project_item||"",children:e.project_item||"-"})}),t.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${qe}`,children:t.jsx("span",{className:"block truncate",title:e.sales_order_number||"",children:e.sales_order_number||"-"})}),t.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${Re}`,children:t.jsx("span",{className:"block truncate",title:e.vendor_payment_schedule||"",children:e.vendor_payment_schedule||"-"})}),t.jsx("td",{className:`px-2 py-1.5 ${Se}`,children:t.jsx("span",{className:"text-gray-400 card-title",children:"-"})}),t.jsx("td",{className:`px-2 py-1.5 ${Pe}`,children:t.jsxs("div",{className:"flex items-center justify-center gap-1",children:[t.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:t.jsx("div",{className:"h-1.5 rounded-full "+(100===i.percentage?"bg-green-500":i.percentage>0?"bg-hansl-500":"bg-gray-300"),style:{width:`${i.percentage}%`}})}),t.jsxs("span",{className:"card-title text-gray-600",children:[i.percentage,"%"]})]})}),t.jsx("td",{className:`px-2 py-1.5 ${Te}`,children:e.is_payment_completed?t.jsx(m,{variant:null,className:"badge-success",children:"완료"}):t.jsx(m,{variant:null,className:"badge-secondary",children:"대기"})})]})]})});Le.displayName="TableRow";const Me=a.memo(({purchases:l,activeTab:r="done",currentUserRoles:s=[],onRefresh:n,onPaymentComplete:c,onReceiptComplete:i})=>{const[m,h]=a.useState(null),[u,g]=a.useState(!1),[y,_]=a.useState(!1),[j,f]=a.useState(null),w=d(),b=s&&(s.includes("lead buyer")||s.includes("app_admin"));s.includes("final_approver")||s.includes("app_admin")||s.includes("ceo");const v=e=>{h(e.id),g(!0)},N=async a=>{try{const{data:r,error:c}=await w.from("purchase_requests").select("*").eq("purchase_order_number",a.purchase_order_number).single();if(c||!r)return void p.error("해당 발주요청번호의 데이터를 찾을 수 없습니다.");const{data:i,error:d}=await w.from("purchase_request_items").select("*").eq("purchase_order_number",a.purchase_order_number).order("line_number");if(d||!i||0===i.length)return void p.error("해당 발주요청번호의 품목 데이터를 찾을 수 없습니다.");const o={vendor_name:a.vendor_name,vendor_phone:"",vendor_fax:"",vendor_contact_name:"",vendor_payment_schedule:""};try{const e=r.vendor_id||a.vendor_id,t=r.contact_id||a.contact_id;if(e){const{data:a}=await w.from("vendors").select("vendor_phone, vendor_fax, vendor_payment_schedule").eq("id",e).single();a&&(o.vendor_phone=a.vendor_phone||"",o.vendor_fax=a.vendor_fax||"",o.vendor_payment_schedule=a.vendor_payment_schedule||"")}if(t){const{data:e}=await w.from("vendor_contacts").select("contact_name, contact_phone, contact_email").eq("id",t).single();e&&(o.vendor_contact_name=e.contact_name||"")}}catch(t){}const m={purchase_order_number:r.purchase_order_number||"",request_date:r.request_date,delivery_request_date:r.delivery_request_date,requester_name:r.requester_name,vendor_name:o.vendor_name||"",vendor_contact_name:o.vendor_contact_name,vendor_phone:o.vendor_phone,vendor_fax:o.vendor_fax,project_vendor:r.project_vendor,sales_order_number:r.sales_order_number,project_item:r.project_item,vendor_payment_schedule:o.vendor_payment_schedule,items:i.map(e=>({line_number:e.line_number,item_name:e.item_name,specification:e.specification,quantity:e.quantity,unit_price_value:e.unit_price_value,amount_value:e.amount_value,remark:e.remark,currency:r.currency||"KRW"}))},x=await async function(a){const t=new((await e(()=>import("./exceljs.min-CucAydNS.js").then(e=>e.e),__vite__mapDeps([0,1,2]))).Workbook),l=t.addWorksheet("발주서",{pageSetup:{paperSize:9,orientation:"portrait",fitToPage:!0,fitToWidth:1,fitToHeight:1,horizontalCentered:!0,verticalCentered:!0,margins:{left:.3,right:.3,top:.5,bottom:.5,header:.2,footer:.2}}});l.getRow(1).height=29.8;for(let e=2;e<=60;e++)l.getRow(e).height=15.75;l.getRow(1).eachCell(e=>{e.font={...e.font||{},name:"맑은 고딕",size:20}});for(let e=2;e<=60;e++)l.getRow(e).eachCell(e=>{e.font={...e.font||{},name:"맑은 고딕",size:11}});l.mergeCells("A1:G1"),l.mergeCells("A2:B2"),l.mergeCells("C2:D2"),l.mergeCells("F2:G2"),l.mergeCells("A3:B3"),l.mergeCells("C3:D3"),l.mergeCells("F3:G3"),l.mergeCells("A4:B4"),l.mergeCells("C4:D4"),l.mergeCells("F4:G4"),l.mergeCells("A5:B5"),l.mergeCells("C5:D5"),l.mergeCells("F5:G5"),l.mergeCells("A6:B6"),l.mergeCells("C6:D6"),l.mergeCells("F6:G6"),l.mergeCells("A7:B7"),l.mergeCells("C7:D7"),l.mergeCells("F7:G7");try{const e=await fetch("/logo_KOR.png"),a=await e.arrayBuffer(),r=t.addImage({buffer:a,extension:"png"}),s=l.getColumn("D").width||22,n=Math.max(1,7.2*s*.58)+4,c=34,i=3,d=.3;l.addImage(r,{tl:{col:i,row:d},ext:{width:n,height:c}})}catch(x){}l.getCell("D1").value="                발 주 서",l.getCell("D1").alignment={horizontal:"left",vertical:"middle",indent:1},l.getCell("D1").font={bold:!0,size:20},l.getCell("A2").value="업   체   명",l.getCell("A2").font={bold:!0},l.getCell("A3").value="담   당   자",l.getCell("A3").font={bold:!0},l.getCell("A4").value="청   구   일",l.getCell("A4").font={bold:!0},l.getCell("A5").value="TEL.",l.getCell("A5").font={bold:!0},l.getCell("A6").value="FAX.",l.getCell("A6").font={bold:!0},l.getCell("A7").value="입고요청일",l.getCell("A7").font={bold:!0},l.getCell("E2").value="구매요청자",l.getCell("E2").font={bold:!0},l.getCell("E3").value="주         소",l.getCell("E3").font={bold:!0},l.getCell("E4").value="발 주 번 호",l.getCell("E4").font={bold:!0},l.getCell("E5").value="TEL.",l.getCell("E5").font={bold:!0},l.getCell("E6").value="FAX.",l.getCell("E6").font={bold:!0},l.getCell("E7").value="지출 예정일",l.getCell("E7").font={bold:!0},l.getCell("F7").value=a.vendor_payment_schedule||"",l.getCell("C2").value=a.vendor_name,l.getCell("C3").value=a.vendor_contact_name||"",l.getCell("C4").value=$(a.request_date),l.getCell("C5").value=a.vendor_phone||"",l.getCell("C6").value=a.vendor_fax||"",l.getCell("C7").value=$(a.delivery_request_date),l.getCell("F2").value=a.requester_name,l.getCell("F3").value="대구광역시 달서구 성서공단북로305",l.getCell("F4").value=a.purchase_order_number,l.getCell("F5").value="(053) 626-7805",l.getCell("F6").value="(053) 657-7905",l.getCell("F5").alignment={horizontal:"center",vertical:"middle"},l.getCell("F6").alignment={horizontal:"center",vertical:"middle"};const r=["No","품명","규격","수량","단가","금액","비고"];for(let e=0;e<r.length;e++)l.getCell(String.fromCharCode(65+e)+"8").value=r[e],l.getCell(String.fromCharCode(65+e)+"8").font={bold:!0},6===e&&(l.getCell("G8").alignment={horizontal:"center",vertical:"middle"});const s=[...a.items].sort((e,a)=>e.line_number-a.line_number),n=s.length,c=9+Math.max(n,45);for(let e=0;e<s.length;e++){const a=s[e],t=9+e;l.getCell("A"+t).value=a.line_number;const r=l.getCell("B"+t);r.value=a.item_name,r.alignment={horizontal:"left",vertical:"middle"},l.getCell("C"+t).value=a.specification,l.getCell("C"+t).alignment={horizontal:"left",vertical:"middle"},l.getCell("D"+t).value=a.quantity;const n=k(a.currency),c=void 0!==a.unit_price_value&&null!==a.unit_price_value?`${a.unit_price_value.toLocaleString()} ${n}`.trim():"";l.getCell("E"+t).value=c,l.getCell("E"+t).alignment={horizontal:"right",vertical:"middle"};const i=k(a.currency),d=void 0!==a.amount_value&&null!==a.amount_value?`${a.amount_value.toLocaleString()} ${i}`.trim():"";l.getCell("F"+t).value=d,l.getCell("F"+t).alignment={horizontal:"right",vertical:"middle"};const o=l.getCell("G"+t);o.value=void 0!==a.remark&&null!==a.remark?String(a.remark):"",o.alignment={horizontal:"left",vertical:"middle",wrapText:!1,shrinkToFit:!0}}for(let e=n;e<45;e++){const a=9+e;for(let e=0;e<7;e++)l.getCell(String.fromCharCode(65+e)+a).value=""}l.mergeCells(`A${c}:E${c}`),l.getCell("A"+c).value="합계",l.getCell("A"+c).font={bold:!0};const i=k(a.items[0]?.currency),d=a.items.reduce((e,a)=>e+(a.amount_value||0),0);l.getCell("F"+c).value=`${d.toLocaleString()} ${i}`.trim(),l.getCell("F"+c).alignment={horizontal:"right",vertical:"middle"};const o=c;for(let e=1;e<=o;e++)for(let a=1;a<=7;a++){const t=String.fromCharCode(64+a)+e,r=l.getCell(t),s=e>=9&&e<c;(5===a||6===a)&&(s||e===c)||3===a&&s||(r.alignment={horizontal:"center",vertical:"middle"}),r.border={top:{style:1===e||2===e||8===e||e===c?"medium":"thin"},left:{style:1===a?"medium":"thin"},right:{style:7===a?"medium":"thin"},bottom:{style:8===e||e===c||e===o?"medium":"thin"}}}for(let e=0;e<n;e++){const a=9+e;l.getCell("C"+a).alignment={horizontal:"left",vertical:"middle"}}for(let e=2;e<=7;e++)l.getCell("B"+e).border={...l.getCell("B"+e).border,right:{style:"medium"}},l.getCell("D"+e).border={...l.getCell("D"+e).border,right:{style:"medium"}},e<=6&&(l.getCell("E"+e).border={...l.getCell("E"+e).border,right:{style:"medium"}});l.getCell("E7").border={...l.getCell("E7").border,top:{style:"thin"},right:{style:"medium"}},l.getCell("G7").border={...l.getCell("G7").border,top:{style:"thin"}};for(let e=1;e<=7;e++){const a=l.getCell("A"+e).border||{};l.getCell("A"+e).border={...a,left:{style:"medium"}}}const m=l.getCell("A"+c).border||{};l.getCell("A"+c).border={...m,left:{style:"medium"}},Object.entries({A:4.7,B:23,C:30,D:11,E:15,F:16,G:37}).forEach(([e,a])=>{l.getColumn(e).width=a}),l.getRow(1).height=29.8,l.getRow(1).eachCell(e=>{e.font={...e.font||{},name:"맑은 고딕",size:20}});for(let e=2;e<=o;e++){const a=l.getRow(e);a.height=15.75,a.eachCell(e=>{e.font={...e.font||{},name:"맑은 고딕",size:11}})}for(let e=9;e<=o;e++)l.getCell("G"+e).alignment={horizontal:"left",vertical:"middle",wrapText:!1,shrinkToFit:!0},l.getCell("B"+e).alignment={horizontal:"left",vertical:"middle"};const p=await t.xlsx.writeBuffer();return new Blob([p],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})}(m),h=`발주서_${m.vendor_name}_${m.purchase_order_number}.xlsx`,u=window.URL.createObjectURL(x),g=document.createElement("a");g.href=u,g.download=h,document.body.appendChild(g),g.click(),document.body.removeChild(g),window.URL.revokeObjectURL(u),p.success("엑셀 파일이 다운로드되었습니다.");try{if(s&&s.includes("lead buyer")){const{error:e}=await w.from("purchase_requests").update({is_po_download:!0}).eq("purchase_order_number",a.purchase_order_number);e||n?.()}}catch(l){}}catch(t){p.error("엑셀 다운로드에 실패했습니다.")}},C=a.useMemo(()=>{if("pending"===r)return t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${he}`,children:"승인상태"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${ue}`,children:"발주번호"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${ge}`,children:"결제종류"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${ye}`,children:"요청자"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${_e}`,children:"청구일"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${je}`,children:"업체"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${fe}`,children:"담당자"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${we}`,children:"입고요청일"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${be}`,children:"변경 입고일"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${ve}`,children:"품명"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${Ne}`,children:"규격"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Ce}`,children:"수량"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${$e}`,children:"단가"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${ke}`,children:"합계"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ae}`,children:"비고"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${De}`,children:"PJ업체"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ee}`,children:"PJ ITEM"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${qe}`,children:"수주번호"})]})});const e=t.jsxs(t.Fragment,{children:[t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${ue}`,children:"발주번호"}),("receipt"===r||"done"===r||!r)&&t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${ge}`,children:"결제종류"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${ye}`,children:"요청자"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${_e}`,children:"청구일"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${je}`,children:"업체"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${fe}`,children:"담당자"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${we}`,children:"입고요청일"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${be}`,children:"변경 입고일"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${ve}`,children:"품명"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${Ne}`,children:"규격"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Ce}`,children:"수량"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${$e}`,children:"단가"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${ke}`,children:"합계"})]});let a=null;return a="purchase"===r?t.jsxs(t.Fragment,{children:[t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ae}`,children:"비고"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${ze}`,children:"링크"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Re}`,children:"지출예정일"})]}):"receipt"===r?t.jsxs(t.Fragment,{children:[t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ae}`,children:"비고"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${De}`,children:"PJ업체"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ee}`,children:"PJ ITEM"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${qe}`,children:"수주번호"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Re}`,children:"지출예정일"})]}):t.jsxs(t.Fragment,{children:[t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ae}`,children:"비고"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${ze}`,children:"링크"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${De}`,children:"PJ업체"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ee}`,children:"PJ ITEM"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${qe}`,children:"수주번호"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Re}`,children:"지출예정일"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Se}`,children:"구매진행"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Pe}`,children:"입고진행"}),t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Te}`,children:"결제"})]}),t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:["purchase"===r&&t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Fe}`,children:"구매진행"}),"receipt"===r&&t.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Fe}`,children:"입고진행"}),e,a]})})},[r]);return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"hidden md:block w-full",children:t.jsx("div",{className:"overflow-x-auto border rounded-lg",children:t.jsxs("table",{className:"w-full min-w-[1760px]",children:[C,t.jsx("tbody",{children:l.map(e=>t.jsx(Le,{purchase:e,onClick:v,activeTab:r,isLeadBuyer:b,onPaymentComplete:c,onReceiptComplete:i,onExcelDownload:N},e.id))})]})})}),t.jsx("div",{className:"hidden sm:block md:hidden w-full",children:t.jsx("div",{className:"overflow-x-auto border rounded-lg",children:t.jsxs("table",{className:"w-full min-w-[600px] card-title",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-left p-2 modal-label text-gray-900 w-24",children:"발주번호"}),t.jsx("th",{className:"text-left p-2 modal-label text-gray-900 w-16",children:"요청자"}),t.jsx("th",{className:"text-left p-2 modal-label text-gray-900 w-20",children:"업체"}),t.jsx("th",{className:"text-left p-2 modal-label text-gray-900 w-32",children:"품명"}),t.jsx("th",{className:"text-right p-2 modal-label text-gray-900 w-20",children:"금액"}),t.jsx("th",{className:"text-center p-2 modal-label text-gray-900 w-16",children:"상태"})]})}),t.jsx("tbody",{children:l.map(e=>t.jsxs("tr",{className:"border-b hover:bg-gray-50 cursor-pointer",onClick:()=>v(e),children:[t.jsx("td",{className:"p-2 modal-value",children:e.purchase_order_number||"-"}),t.jsx("td",{className:"p-2",children:e.requester_name}),t.jsx("td",{className:"p-2 truncate",title:e.vendor_name,children:e.vendor_name}),t.jsx("td",{className:"p-2 truncate",title:e.item_name,children:e.item_name||"-"}),t.jsx("td",{className:"p-2 text-right card-amount",children:e.amount_value?`${e.amount_value.toLocaleString()} ${xe(e.currency||"KRW")}`:e.total_amount?`${e.total_amount.toLocaleString()} ${xe(e.currency||"KRW")}`:`0 ${xe(e.currency||"KRW")}`}),t.jsx("td",{className:"p-2 text-center",children:t.jsx(pe,{purchase:e})})]},e.id))})]})})}),t.jsx("div",{className:"sm:hidden space-y-3",children:l.map(e=>t.jsx(R,{purchase:e,onClick:()=>v(e)},e.id))}),t.jsx(x,{purchaseId:m,isOpen:u,onClose:()=>{g(!1),h(null)},currentUserRoles:s,activeTab:r,onRefresh:n,onDelete:e=>{f(e),_(!0)}}),t.jsx(te,{open:y,onOpenChange:_,children:t.jsxs(se,{children:[t.jsxs(ne,{children:[t.jsx(ie,{children:"발주요청 내역 삭제"}),t.jsxs(de,{children:["발주요청번호 ",j?.purchase_order_number,"를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."]})]}),t.jsxs(ce,{children:[t.jsx(me,{children:"취소"}),t.jsx(oe,{onClick:async()=>{if(j){o.debug("발주 삭제 확인",{id:j.id,purchase_order_number:j.purchase_order_number,requester_name:j.requester_name,final_manager_status:j.final_manager_status});try{const{data:{user:e},error:a}=await w.auth.getUser();if(a||!e)return void p.error("로그인이 필요합니다.");const{data:t,error:l}=await w.from("employees").select("name, email, purchase_role").eq("email",e.email).single();if(o.debug("사용자 권한 확인",{employee:t?.name,roles:t?.purchase_role,email:t?.email}),l||!t)return void p.error("사용자 권한을 확인할 수 없습니다.");let r=[];if(t.purchase_role)if(Array.isArray(t.purchase_role))r=t.purchase_role.map(e=>String(e).trim());else{r=String(t.purchase_role).split(",").map(e=>e.trim()).filter(e=>e.length>0)}const s=r.includes("final_approver")||r.includes("app_admin")||r.includes("ceo"),c="approved"===j.final_manager_status,i=j.requester_name===t.name,d=c?s:s||i;if(o.debug("삭제 권한 확인",{canEdit:s,isApproved:c,isRequester:i,canDeleteThis:d,userRoles:r}),!d)return void p.error("삭제 권한이 없습니다.");const{data:m,error:x}=await w.from("purchase_request_items").delete().eq("purchase_request_id",j.id).select();if(x)throw o.error("아이템 삭제 중 오류 발생",x,{code:x.code,message:x.message,details:x.details,hint:x.hint}),x;o.debug("아이템 삭제 완료",{deletedItemsCount:m?.length||0,purchaseRequestId:j.id});const{data:h,error:u}=await w.from("purchase_requests").delete().eq("id",j.id).select();if(u)throw o.error("발주요청 삭제 중 오류 발생",u,{code:u.code,message:u.message,details:u.details,hint:u.hint}),u;o.debug("발주요청 삭제 완료",{deletedRequestId:j.id,purchase_order_number:j.purchase_order_number}),p.success("발주요청 내역이 삭제되었습니다."),n?.()}catch(e){const a=e;o.error("발주요청 삭제 중 예외 발생",a,{name:a?.name,message:a?.message,code:a?.code,details:a?.details,hint:a?.hint,stack:a?.stack}),p.error(`삭제 중 오류가 발생했습니다: ${a?.message||"알 수 없는 오류"}`)}_(!1),f(null)}},className:"bg-red-600 hover:bg-red-700",children:"삭제"})]})]})})]})});Me.displayName="FastPurchaseTable";export{Me as default};
//# sourceMappingURL=FastPurchaseTable-CjxBuf_V.js.map
