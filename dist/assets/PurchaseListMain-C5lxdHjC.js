const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/exceljs.min-Ce1bD3rJ.js","assets/index-CD_u5Bin.js","assets/index-DNH5yCxE.css","assets/PurchaseItemsModal-B4iN-Ihx.js","assets/input-sI-J72rr.js","assets/table-BEplqxsP.js","assets/index-B44fxLX9.js","assets/format-CcPdmJ_4.js","assets/plus-CcE_9mfB.js","assets/save-2deH4jhQ.js","assets/card-CuvKrWRY.js"])))=>i.map(i=>d[i]);
import{c as He,r as n,a as je,l as Se,j as e,_ as We,f as Ye,g as Zt,h as er,i as tr,k as K,m as Ke,n as pe,P as oe,o as _e,b as Xe,u as rr,p as ar}from"./index-CD_u5Bin.js";import{t as te,B as Y}from"./index-B44fxLX9.js";import{a as lr,b as nr,c as sr,d as ir,P as or}from"./PurchaseDetailModal-Ba0VRtxg.js";import{E as cr,C as Ie,a as dr,b as mr,c as Re}from"./card-CuvKrWRY.js";import{g as Qe,R as Ue,P as Ze,W as ur,C as et,T as pr,h as xr,i as tt,O as rt,j as gr,I as ve}from"./input-sI-J72rr.js";import{C as hr,S as qe,a as Me,b as Ge,c as Oe,d as de}from"./select-BmJIoX1C.js";import{S as at}from"./search-BUzKpYKF.js";import{P as fr}from"./plus-CcE_9mfB.js";import"./format-CcPdmJ_4.js";import"./calendar-B0jFEiam.js";import"./save-2deH4jhQ.js";/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vr=[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]],yr=He("chevrons-up-down",vr);/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _r=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],wr=He("funnel",_r),jr=()=>{const[t,l]=n.useState([]),[a,r]=n.useState([]),[s,x]=n.useState([]),[g,h]=n.useState(!0),[C,d]=n.useState([]),[y,A]=n.useState(""),[$,P]=n.useState(""),[F,Q]=n.useState(""),c=je();n.useEffect(()=>{(async()=>{try{const[M,I,p]=await Promise.all([c.from("vendors").select("*"),c.from("employees").select("*"),c.auth.getUser()]);if(M.error)throw M.error;if(r(M.data||[]),I.error)throw I.error;if(x(I.data||[]),p.data.user&&!p.error){let u=null;if(p.data.user.email&&(u=(await c.from("employees").select("*").eq("email",p.data.user.email).maybeSingle()).data),u){let E=[];u.purchase_role&&(Array.isArray(u.purchase_role)?E=u.purchase_role.map(j=>String(j).trim()):E=String(u.purchase_role).split(",").map(O=>O.trim()).filter(O=>O.length>0)),d(E),A(u.name||u.full_name||""),P(u.email||""),Q(u.id||"")}}}catch(M){Se.error("초기 데이터 로드 실패",M)}})()},[]);const w=n.useCallback(async()=>{h(!0);try{let N=s;if(N.length===0){const{data:j}=await c.from("employees").select("*");N=j||[]}const{data:{user:M},error:I}=await c.auth.getUser();if(I||!M){Se.error("사용자 인증 실패",I),te.error("로그인이 필요합니다."),h(!1);return}const{data:p,error:u}=await c.from("purchase_requests").select("*,vendors(vendor_name,vendor_payment_schedule),vendor_contacts(contact_name),purchase_request_items(*)").order("request_date",{ascending:!1}).limit(2e3);if(u)throw u;const E=(p||[]).map(j=>{const O=j.purchase_request_items?.[0]||{},G=N.find(R=>R.id===j.requester_id);return{id:Number(j.id),purchase_order_number:j.purchase_order_number,request_date:j.request_date,delivery_request_date:j.delivery_request_date,progress_type:j.progress_type,payment_completed_at:j.payment_completed_at,payment_category:j.payment_category,currency:j.currency,request_type:j.request_type,vendor:j.vendors||null,vendor_name:j.vendors?.vendor_name||"",vendor_payment_schedule:j.vendors?.vendor_payment_schedule||"",vendor_contacts:j.vendor_contacts||[],requester_id:j.requester_id,requester_name:j.requester_name,requester_full_name:G?.full_name||G?.name||j.requester_name||"",item_name:O.item_name||"",specification:O.specification||"",quantity:Number(O.quantity)||0,unit_price_value:Number(O.unit_price_value)||0,amount_value:Number(O.amount_value)||0,remark:O.remark||"",project_vendor:j.project_vendor,sales_order_number:j.sales_order_number,project_item:j.project_item,line_number:Number(O.line_number)||1,contact_name:j.vendor_contacts?.contact_name||"",middle_manager_status:j.middle_manager_status,final_manager_status:j.final_manager_status,is_received:!!j.is_received,received_at:j.received_at,is_payment_completed:!!j.is_payment_completed,is_po_download:!!j.is_po_download,link:O.link,items:j.purchase_request_items||[],total_amount:j.purchase_request_items?.reduce((R,ee)=>R+(Number(ee.amount_value)||0),0)||0,purchase_status:j.purchase_status||"pending"}});l(E)}catch(N){Se.error("발주 목록 로드 실패",N),te.error("발주 목록을 불러올 수 없습니다.")}finally{h(!1)}},[s]);return n.useEffect(()=>{w()},[w]),{purchases:t,vendors:a,employees:s,loading:g,currentUserRoles:C,currentUserName:y,currentUserEmail:$,currentUserId:F,refreshPurchases:w}};function br(t,l=500){const[a,r]=n.useState(t);return n.useEffect(()=>{const s=setTimeout(()=>{r(t)},l);return()=>{clearTimeout(s)}},[t,l]),a}const Nr=["정희웅"],Cr=(t,l,a,r,s)=>{const x=je(),[g,h]=n.useState("pending"),[C,d]=n.useState(""),[y,A]=n.useState(""),[$,P]=n.useState(""),[F,Q]=n.useState(""),[c,w]=n.useState(""),[N,M]=n.useState(""),[I,p]=n.useState(""),[u,E]=n.useState(""),j=new Date().getFullYear(),O=new Date(j,0,1).toISOString().split("T")[0],G=new Date().toISOString().split("T")[0],[R,ee]=n.useState(O),[B,W]=n.useState(G),V=br(C,300),q=l?.includes("app_admin");l?.includes("final_approver"),l?.includes("middle_manager");const U=l?.includes("purchase_manager"),J=l?.includes("raw_material_manager")||l?.includes("consumable_manager")||l?.includes("purchase_manager"),re=n.useMemo(()=>!l||l.length===0?1:U?2:l.some(_=>["middle_manager","final_approver","app_admin","ceo"].includes(_))?3:1,[l,U]),ae=n.useCallback(_=>{if(!a)return"all";if(_==="purchase")return J||q?"all":a;switch(re){case 1:return _==="done"?"all":a;case 2:return _==="done"?"all":a;case 3:return"all";default:return a}},[a,re,J,q]);n.useEffect(()=>{if(!a)return;const _=ae(g);P(_)},[g,a,re,ae]);const le=n.useMemo(()=>l.includes("purchase_manager")||l.includes("app_admin")?t:t.filter(_=>!Nr.includes(_.requester_name)),[t,l]),i=n.useMemo(()=>le.filter(_=>{const v=_.request_date?_.request_date.split("T")[0]:"",S=!R||v>=R,L=!B||v<=B;return S&&L}),[le,R,B]),b=n.useMemo(()=>i.filter(v=>{let S=!1;switch(g){case"pending":return S=["pending","대기","",null].includes(v.final_manager_status),S;case"purchase":{const L=v.payment_category==="구매 요청",ge=!v.is_payment_completed,he=(v.progress_type||"").includes("선진행"),Ne=(v.progress_type||"").includes("일반"),Ce=v.final_manager_status==="approved";return!L||!ge?S=!1:S=he||Ne&&Ce,S}case"receipt":{const L=!v.is_received,ge=(v.progress_type||"").includes("선진행"),he=v.final_manager_status==="approved";return S=L&&(ge||he),S}case"done":return S=!0,S;default:return!0}}),[i,g]),k=n.useMemo(()=>$&&$!=="all"&&$!=="전체"?b.filter(v=>v.requester_name===$):b,[b,$]),f=n.useMemo(()=>y?k.filter(_=>_.vendor_name===y):k,[k,y]),D=n.useMemo(()=>{let _=f;if(F){const v=F.trim().toLowerCase();_=_.filter(S=>S.purchase_order_number?.toLowerCase().includes(v))}if(c){const v=c.trim().toLowerCase();_=_.filter(S=>S.items&&S.items.length>0?S.items.some(L=>L.item_name?.toLowerCase().includes(v)):!1)}if(N){const v=N.trim().toLowerCase();_=_.filter(S=>S.items&&S.items.length>0?S.items.some(L=>L.specification?.toLowerCase().includes(v)):!1)}if(I&&I!=="all"&&(_=_.filter(v=>{switch(I){case"pending":return!v.final_manager_status||v.final_manager_status==="pending"||v.final_manager_status==="대기";case"approved":return v.final_manager_status==="approved";case"rejected":return v.final_manager_status==="rejected"||v.middle_manager_status==="rejected";default:return!0}})),u){const v=u.trim().toLowerCase();_=_.filter(S=>S.items&&S.items.length>0?S.items.some(L=>L.remark?.toLowerCase().includes(v)):!1)}return _},[f,F,c,N,I,u]),m=n.useMemo(()=>{if(!V)return D;const _=V.trim().toLowerCase();return D.filter(v=>v.purchase_order_number?.toLowerCase().includes(_)||v.vendor_name?.toLowerCase().includes(_)||v.requester_name?.toLowerCase().includes(_)||v.project_vendor?.toLowerCase().includes(_)?!0:v.items&&v.items.length>0?v.items.some(S=>S.item_name&&S.item_name.toLowerCase().includes(_)||S.specification&&S.specification.toLowerCase().includes(_)):!1)},[D,V]),z=n.useMemo(()=>[...m].sort((_,v)=>{const S=_.request_date?new Date(_.request_date).getTime():0;return(v.request_date?new Date(v.request_date).getTime():0)-S}),[m]),H=n.useMemo(()=>{const v=le.filter(T=>{const Z=T.request_date?T.request_date.split("T")[0]:"",ne=!R||Z>=R,fe=!B||Z<=B;return ne&&fe}),S=T=>new Set(T.map(Z=>Z.purchase_order_number)).size,L=T=>{if(T==="purchase")return J||q?v:v.filter(ne=>ne.requester_name===a);const Z=ae(T);return Z==="all"||Z==="전체"?v:v.filter(ne=>ne.requester_name===Z)},ge=L("pending"),he=L("purchase"),Ne=L("receipt"),Ce=L("done"),Yt=ge.filter(T=>["pending","대기","",null].includes(T.final_manager_status)),Kt=he.filter(T=>{const Z=T.payment_category==="구매 요청",ne=!T.is_payment_completed;if(!Z||!ne)return!1;const fe=(T.progress_type||"").includes("선진행"),Qt=(T.progress_type||"").includes("일반"),Ut=T.final_manager_status==="approved";return fe||Qt&&Ut}),Xt=Ne.filter(T=>{const Z=!T.is_received,ne=(T.progress_type||"").includes("선진행"),fe=T.final_manager_status==="approved";return Z&&(ne||fe)});return{pending:S(Yt),purchase:S(Kt),receipt:S(Xt),done:S(Ce)}},[le,R,B,re,a,ae,J,q]);return n.useEffect(()=>{(async()=>{const{data:{user:_}}=await x.auth.getUser();if(!_)return;const{data:v}=await x.from("user_preferences").select("period_start, period_end").eq("user_id",_.id).single();if(v){const S=v.period_start?new Date(v.period_start).toISOString().split("T")[0]:O,L=v.period_end?new Date(v.period_end).toISOString().split("T")[0]:G;ee(S),W(L)}})()},[]),n.useEffect(()=>{(async()=>{const{data:{user:_}}=await x.auth.getUser();_&&(!R||!B||await x.from("user_preferences").upsert({user_id:_.id,period_start:R,period_end:B,updated_at:new Date().toISOString()}))})()},[R,B]),{activeTab:g,searchTerm:C,vendorFilter:y,dateFromFilter:R,dateToFilter:B,selectedEmployee:$,purchaseNumberFilter:F,itemNameFilter:c,specificationFilter:N,approvalStatusFilter:I,remarkFilter:u,setActiveTab:h,setSearchTerm:d,setVendorFilter:A,setDateFromFilter:ee,setDateToFilter:W,setSelectedEmployee:P,setPurchaseNumberFilter:Q,setItemNameFilter:w,setSpecificationFilter:M,setApprovalStatusFilter:p,setRemarkFilter:E,filteredPurchases:z,tabCounts:H}},Sr=t=>{if(!t)return"-";const l=new Date(t);return`${String(l.getMonth()+1).padStart(2,"0")}-${String(l.getDate()).padStart(2,"0")}`},kr=t=>{if(!t.items||t.items.length===0)return{received:0,total:0,percentage:0};const l=t.items.length,a=t.items.filter(s=>s.is_received||s.delivery_status==="received").length,r=l>0?Math.round(a/l*100):0;return{received:a,total:l,percentage:r}},lt=n.memo(({purchase:t})=>{const l=t.is_received?"completed":t.middle_manager_status==="approved"&&t.final_manager_status==="approved"?"inProgress":t.middle_manager_status==="rejected"||t.final_manager_status==="rejected"?"rejected":"pending",a={completed:{text:"입고완료",className:"bg-green-100 text-green-800"},inProgress:{text:"구매진행",className:"bg-hansl-100 text-hansl-800"},rejected:{text:"반려",className:"bg-red-100 text-red-800"},pending:{text:"승인대기",className:"bg-yellow-100 text-yellow-800"}},{text:r,className:s}=a[l];return e.jsx(Y,{className:`${s} text-xs`,children:r})});lt.displayName="StatusBadge";const nt=n.memo(({purchase:t,onClick:l})=>{const a=kr(t),r=t.progress_type==="선진행"||t.progress_type?.includes("선진행");return e.jsxs("div",{className:`bg-white rounded-lg border p-4 space-y-3 cursor-pointer transition-all hover:shadow-md ${r?"border-red-400 bg-red-50 hover:bg-red-100":"hover:bg-gray-50"}`,onClick:()=>l(t),children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[r?e.jsx(Y,{className:"bg-red-500 text-white font-bold text-xs px-2 py-0.5",children:"선진행"}):e.jsx(Y,{className:"bg-gray-200 text-gray-700 text-xs px-2 py-0.5",children:"일반"}),e.jsx("span",{className:"font-semibold text-sm text-gray-900",children:t.purchase_order_number||"-"})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[Sr(t.request_date)," 요청"]})]}),e.jsx(lt,{purchase:t})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"요청자"}),e.jsx("span",{className:"font-medium",children:t.requester_name})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"업체"}),e.jsx("span",{className:"font-medium",children:t.vendor_name})]}),t.project_vendor&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"PJ업체"}),e.jsx("span",{className:"font-medium truncate max-w-[150px]",children:t.project_vendor})]}),t.project_item&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"PJ ITEM"}),e.jsx("span",{className:"font-medium truncate max-w-[150px]",children:t.project_item})]}),t.sales_order_number&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"수주번호"}),e.jsx("span",{className:"font-medium truncate max-w-[150px]",children:t.sales_order_number})]}),t.item_name&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"품목"}),e.jsx("span",{className:"font-medium truncate max-w-[150px]",children:t.item_name})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"금액"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[(t.amount_value||t.total_amount)?.toLocaleString()," ",t.currency]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"입고현황"}),e.jsxs("span",{className:"text-gray-700",children:[a.received,"/",a.total," (",a.percentage,"%)"]})]}),e.jsx("div",{className:"bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${a.percentage===100?"bg-green-500":a.percentage>0?"bg-hansl-500":"bg-gray-300"}`,style:{width:`${a.percentage}%`}})})]}),t.is_payment_completed!==void 0&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"결제"}),t.is_payment_completed?e.jsx(Y,{className:"bg-green-100 text-green-800 text-xs",children:"완료"}):e.jsx(Y,{className:"bg-gray-100 text-gray-800 text-xs",children:"대기"})]}),e.jsx("div",{className:"pt-2 border-t",children:e.jsxs("div",{className:"flex items-center justify-center text-xs text-gray-500",children:[e.jsx(cr,{className:"w-3 h-3 mr-1"}),"클릭하여 상세보기"]})})]})});nt.displayName="MobilePurchaseCard";function Le(t){if(!t)return"";const l=new Date(t);return isNaN(l.getTime())?t:`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}-${String(l.getDate()).padStart(2,"0")}`}function ke(t){return t?["KRW","원","₩"].includes(t)?"₩":["USD","$","달러"].includes(t)?"$":["EUR","€"].includes(t)?"€":["JPY","엔","¥"].includes(t)||["CNY","위안","元"].includes(t)?"¥":t:""}async function Ar(t){const l=await We(()=>import("./exceljs.min-Ce1bD3rJ.js").then(c=>c.e),__vite__mapDeps([0,1,2])),a=new l.default.Workbook,r=a.addWorksheet("발주서",{pageSetup:{paperSize:9,orientation:"portrait",fitToPage:!0,fitToWidth:1,fitToHeight:1,horizontalCentered:!0,verticalCentered:!0,margins:{left:.3,right:.3,top:.5,bottom:.5,header:.2,footer:.2}}});r.getRow(1).height=39.75;for(let c=2;c<=60;c++)r.getRow(c).height=15.75;r.mergeCells("A1:G1"),r.mergeCells("A2:B2"),r.mergeCells("C2:D2"),r.mergeCells("F2:G2"),r.mergeCells("A3:B3"),r.mergeCells("C3:D3"),r.mergeCells("F3:G3"),r.mergeCells("A4:B4"),r.mergeCells("C4:D4"),r.mergeCells("F4:G4"),r.mergeCells("A5:B5"),r.mergeCells("C5:D5"),r.mergeCells("F5:G5"),r.mergeCells("A6:B6"),r.mergeCells("C6:D6"),r.mergeCells("F6:G6"),r.mergeCells("A7:B7"),r.mergeCells("C7:D7"),r.mergeCells("E7:F7"),r.getCell("A1").value="             발 주 서",r.getCell("A1").alignment={horizontal:"center",vertical:"middle"},r.getCell("A1").font={name:"GulimChe",size:25,bold:!0},r.getCell("A2").value="업 체 명",r.getCell("A2").font={name:"GulimChe",size:11},r.getCell("A2").alignment={horizontal:"center",vertical:"middle"},r.getCell("A3").value="담 당 자",r.getCell("A3").font={name:"GulimChe",size:11},r.getCell("A3").alignment={horizontal:"center",vertical:"middle"},r.getCell("A4").value="청 구 일",r.getCell("A4").font={name:"GulimChe",size:11},r.getCell("A4").alignment={horizontal:"center",vertical:"middle"},r.getCell("A5").value="전화 번호",r.getCell("A5").font={name:"GulimChe",size:11},r.getCell("A5").alignment={horizontal:"center",vertical:"middle"},r.getCell("A6").value="팩스 번호",r.getCell("A6").font={name:"GulimChe",size:11},r.getCell("A6").alignment={horizontal:"center",vertical:"middle"},r.getCell("A7").value="입고 요청일",r.getCell("A7").font={name:"GulimChe",size:11},r.getCell("A7").alignment={horizontal:"center",vertical:"middle"},r.getCell("E2").value="구매요구자",r.getCell("E2").font={name:"GulimChe",size:11},r.getCell("E2").alignment={horizontal:"center",vertical:"middle"},r.getCell("E3").value="주  소",r.getCell("E3").font={name:"GulimChe",size:11},r.getCell("E3").alignment={horizontal:"center",vertical:"middle"},r.getCell("E4").value="발주 번호",r.getCell("E4").font={name:"GulimChe",size:11},r.getCell("E4").alignment={horizontal:"center",vertical:"middle"},r.getCell("E5").value="전화 번호",r.getCell("E5").font={name:"GulimChe",size:11},r.getCell("E5").alignment={horizontal:"center",vertical:"middle"},r.getCell("E6").value="팩스 번호",r.getCell("E6").font={name:"GulimChe",size:11},r.getCell("E6").alignment={horizontal:"center",vertical:"middle"},r.getCell("E7").value="지출 예정일",r.getCell("E7").font={name:"GulimChe",size:11},r.getCell("E7").alignment={horizontal:"center",vertical:"middle"},r.getCell("F7").value=t.vendor_payment_schedule||"익월말 결제",r.getCell("F7").font={name:"GulimChe",size:11},r.getCell("F7").alignment={horizontal:"center",vertical:"middle"},r.getCell("C2").value=t.vendor_name,r.getCell("C2").font={name:"GulimChe",size:11},r.getCell("C2").alignment={horizontal:"center",vertical:"middle"},r.getCell("C3").value=t.vendor_contact_name||"",r.getCell("C3").font={name:"GulimChe",size:11},r.getCell("C3").alignment={horizontal:"center",vertical:"middle"},r.getCell("C4").value=Le(t.request_date),r.getCell("C4").font={name:"GulimChe",size:11},r.getCell("C4").alignment={horizontal:"center",vertical:"middle"},r.getCell("C5").value=t.vendor_phone||"",r.getCell("C5").font={name:"GulimChe",size:11},r.getCell("C5").alignment={horizontal:"center",vertical:"middle"},r.getCell("C6").value=t.vendor_fax||"",r.getCell("C6").font={name:"GulimChe",size:11},r.getCell("C6").alignment={horizontal:"center",vertical:"middle"},r.getCell("C7").value=Le(t.delivery_request_date),r.getCell("C7").font={name:"GulimChe",size:11},r.getCell("C7").alignment={horizontal:"center",vertical:"middle"},r.getCell("F2").value=t.requester_name,r.getCell("F2").font={name:"GulimChe",size:11},r.getCell("F2").alignment={horizontal:"center",vertical:"middle"},r.getCell("F3").value="대구광역시 달서구 성서공단북로 305",r.getCell("F3").font={name:"GulimChe",size:11},r.getCell("F3").alignment={horizontal:"center",vertical:"middle"},r.getCell("F4").value=t.purchase_order_number,r.getCell("F4").font={name:"GulimChe",size:11},r.getCell("F4").alignment={horizontal:"center",vertical:"middle"},r.getCell("F5").value="(053) 626 - 7805",r.getCell("F5").font={name:"GulimChe",size:11},r.getCell("F5").alignment={horizontal:"center",vertical:"middle"},r.getCell("F6").value="(053) 657 - 7905",r.getCell("F6").font={name:"GulimChe",size:11},r.getCell("F6").alignment={horizontal:"center",vertical:"middle"},r.getCell("A8").value="번호",r.getCell("A8").font={name:"GulimChe",size:11},r.getCell("A8").alignment={horizontal:"center",vertical:"middle"},r.getCell("B8").value="품명",r.getCell("B8").font={name:"GulimChe",size:11},r.getCell("B8").alignment={horizontal:"center",vertical:"middle"},r.getCell("C8").value="규  격",r.getCell("C8").font={name:"GulimChe",size:11},r.getCell("C8").alignment={horizontal:"center",vertical:"middle"},r.getCell("D8").value="수 량",r.getCell("D8").font={name:"GulimChe",size:11},r.getCell("D8").alignment={horizontal:"center",vertical:"middle"},r.getCell("E8").value="단  가",r.getCell("E8").font={name:"GulimChe",size:11},r.getCell("E8").alignment={horizontal:"center",vertical:"middle"},r.getCell("F8").value="금  액",r.getCell("F8").font={name:"GulimChe",size:11},r.getCell("F8").alignment={horizontal:"center",vertical:"middle"},r.getCell("G8").value="비고 (사용 용도)",r.getCell("G8").font={name:"GulimChe",size:11},r.getCell("G8").alignment={horizontal:"center",vertical:"middle"};const s=9,x=38,g=[...t.items].sort((c,w)=>c.line_number-w.line_number),h=g.length,C=s+Math.max(h,x);for(let c=0;c<g.length;c++){const w=g[c],N=s+c;r.getCell("A"+N).value=w.line_number,r.getCell("A"+N).font={name:"GulimChe",size:11},r.getCell("A"+N).alignment={horizontal:"center",vertical:"middle"},r.getCell("B"+N).value=w.item_name,r.getCell("B"+N).font={name:"GulimChe",size:11},r.getCell("B"+N).alignment={horizontal:"left",vertical:"middle"},r.getCell("C"+N).value=w.specification,r.getCell("C"+N).font={name:"GulimChe",size:11},r.getCell("C"+N).alignment={horizontal:"left",vertical:"middle"},r.getCell("D"+N).value=w.quantity,r.getCell("D"+N).font={name:"GulimChe",size:11},r.getCell("D"+N).alignment={horizontal:"center",vertical:"middle"};const M=ke(w.currency),I=w.unit_price_value!==void 0&&w.unit_price_value!==null?`${w.unit_price_value.toLocaleString()} ${M}`.trim():"";r.getCell("E"+N).value=I,r.getCell("E"+N).font={name:"GulimChe",size:11},r.getCell("E"+N).alignment={horizontal:"right",vertical:"middle"};const p=ke(w.currency),u=w.amount_value!==void 0&&w.amount_value!==null?`${w.amount_value.toLocaleString()} ${p}`.trim():"";r.getCell("F"+N).value=u,r.getCell("F"+N).font={name:"GulimChe",size:11},r.getCell("F"+N).alignment={horizontal:"right",vertical:"middle"},r.getCell("G"+N).value=w.remark!==void 0&&w.remark!==null?String(w.remark):"",r.getCell("G"+N).font={name:"GulimChe",size:11},r.getCell("G"+N).alignment={horizontal:"center",vertical:"middle"}}for(let c=h;c<x;c++){const w=s+c;for(let N=0;N<7;N++)r.getCell(String.fromCharCode(65+N)+w).value=""}const d=h<38?"A47:E47":`A${C}:E${C}`;r.mergeCells(d);const y=h<38?47:C;r.getCell("A"+y).value="합계",r.getCell("A"+y).font={name:"GulimChe",size:11,bold:!0},r.getCell("A"+y).alignment={horizontal:"center",vertical:"middle"};const A=ke(t.items[0]?.currency),$=t.items.reduce((c,w)=>c+(w.amount_value||0),0);r.getCell("F"+y).value=`${$.toLocaleString()} ${A}`.trim(),r.getCell("F"+y).font={name:"GulimChe",size:11},r.getCell("F"+y).alignment={horizontal:"right",vertical:"middle"};const P=y;for(let c=1;c<=P;c++)for(let w=1;w<=7;w++){const M=String.fromCharCode(64+w)+c,I=r.getCell(M),p=w===5||w===6,u=w===3,E=c>=s&&c<C;p&&(E||c===C)||u&&E||(I.alignment={horizontal:"center",vertical:"middle"}),I.border={top:{style:c===1||c===2||c===8||c===y?"medium":"thin"},left:{style:w===1?"medium":"thin"},right:{style:w===7?"medium":"thin"},bottom:{style:c===8||c===y||c===P?"medium":"thin"}}}for(let c=2;c<=7;c++)r.getCell("B"+c).border={...r.getCell("B"+c).border,right:{style:"medium"}},r.getCell("D"+c).border={...r.getCell("D"+c).border,right:{style:"medium"}},c<=6&&(r.getCell("E"+c).border={...r.getCell("E"+c).border,right:{style:"medium"}});r.getCell("E7").border={...r.getCell("E7").border,top:{style:"thin"},right:{style:"medium"}},r.getCell("G7").border={...r.getCell("G7").border,top:{style:"thin"}};for(let c=1;c<=7;c++){const w=r.getCell("A"+c).border||{};r.getCell("A"+c).border={...w,left:{style:"medium"}}}const F=r.getCell("A"+y).border||{};r.getCell("A"+y).border={...F,left:{style:"medium"}},r.getColumn("A").width=6.33203125,r.getColumn("B").width=12.6640625,r.getColumn("C").width=31.6640625,r.getColumn("D").width=12.6640625,r.getColumn("E").width=15.6640625,r.getColumn("F").width=17.6640625,r.getColumn("G").width=39,r.getRow(1).height=39.75;for(let c=2;c<=P;c++)r.getRow(c).height=15.75;const Q=await a.xlsx.writeBuffer();return new Blob([Q],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})}var st="AlertDialog",[Dr,Fa]=Zt(st,[Qe]),se=Qe(),it=t=>{const{__scopeAlertDialog:l,...a}=t,r=se(l);return e.jsx(Ue,{...r,...a,modal:!0})};it.displayName=st;var $r="AlertDialogTrigger",Er=n.forwardRef((t,l)=>{const{__scopeAlertDialog:a,...r}=t,s=se(a);return e.jsx(gr,{...s,...r,ref:l})});Er.displayName=$r;var Pr="AlertDialogPortal",ot=t=>{const{__scopeAlertDialog:l,...a}=t,r=se(l);return e.jsx(Ze,{...r,...a})};ot.displayName=Pr;var Fr="AlertDialogOverlay",ct=n.forwardRef((t,l)=>{const{__scopeAlertDialog:a,...r}=t,s=se(a);return e.jsx(rt,{...s,...r,ref:l})});ct.displayName=Fr;var xe="AlertDialogContent",[zr,Ir]=Dr(xe),Rr=tr("AlertDialogContent"),dt=n.forwardRef((t,l)=>{const{__scopeAlertDialog:a,children:r,...s}=t,x=se(a),g=n.useRef(null),h=Ye(l,g),C=n.useRef(null);return e.jsx(ur,{contentName:xe,titleName:mt,docsSlug:"alert-dialog",children:e.jsx(zr,{scope:a,cancelRef:C,children:e.jsxs(et,{role:"alertdialog",...x,...s,ref:h,onOpenAutoFocus:er(s.onOpenAutoFocus,d=>{d.preventDefault(),C.current?.focus({preventScroll:!0})}),onPointerDownOutside:d=>d.preventDefault(),onInteractOutside:d=>d.preventDefault(),children:[e.jsx(Rr,{children:r}),e.jsx(Mr,{contentRef:g})]})})})});dt.displayName=xe;var mt="AlertDialogTitle",ut=n.forwardRef((t,l)=>{const{__scopeAlertDialog:a,...r}=t,s=se(a);return e.jsx(pr,{...s,...r,ref:l})});ut.displayName=mt;var pt="AlertDialogDescription",xt=n.forwardRef((t,l)=>{const{__scopeAlertDialog:a,...r}=t,s=se(a);return e.jsx(xr,{...s,...r,ref:l})});xt.displayName=pt;var qr="AlertDialogAction",gt=n.forwardRef((t,l)=>{const{__scopeAlertDialog:a,...r}=t,s=se(a);return e.jsx(tt,{...s,...r,ref:l})});gt.displayName=qr;var ht="AlertDialogCancel",ft=n.forwardRef((t,l)=>{const{__scopeAlertDialog:a,...r}=t,{cancelRef:s}=Ir(ht,a),x=se(a),g=Ye(l,s);return e.jsx(tt,{...x,...r,ref:g})});ft.displayName=ht;var Mr=({contentRef:t})=>{const l=`\`${xe}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${xe}\` by passing a \`${pt}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${xe}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return n.useEffect(()=>{document.getElementById(t.current?.getAttribute("aria-describedby"))||console.warn(l)},[l,t]),null},Gr=it,Or=ot,vt=ct,yt=dt,_t=gt,wt=ft,jt=ut,bt=xt;const Lr=Gr,Tr=Or,Nt=n.forwardRef(({className:t,...l},a)=>e.jsx(vt,{className:K("fixed inset-0 z-50 bg-black/40 backdrop-blur-sm","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...l,ref:a}));Nt.displayName=vt.displayName;const Ct=n.forwardRef(({className:t,...l},a)=>e.jsxs(Tr,{children:[e.jsx(Nt,{}),e.jsx(yt,{ref:a,className:K("fixed left-[50%] top-[50%] z-50","w-full max-w-md translate-x-[-50%] translate-y-[-50%]","grid gap-4 bg-white border border-gray-200","rounded-lg p-6 shadow-professional-xl","duration-200","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0","data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95","data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%]","data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%]",t),...l})]}));Ct.displayName=yt.displayName;const St=({className:t,...l})=>e.jsx("div",{className:K("flex flex-col space-y-2 text-left",t),...l});St.displayName="AlertDialogHeader";const kt=({className:t,...l})=>e.jsx("div",{className:K("flex flex-col-reverse sm:flex-row sm:justify-end gap-3",t),...l});kt.displayName="AlertDialogFooter";const At=n.forwardRef(({className:t,...l},a)=>e.jsx(jt,{ref:a,className:K("text-lg font-semibold text-gray-800 tracking-tight",t),...l}));At.displayName=jt.displayName;const Dt=n.forwardRef(({className:t,...l},a)=>e.jsx(bt,{ref:a,className:K("text-sm text-gray-600",t),...l}));Dt.displayName=bt.displayName;const $t=n.forwardRef(({className:t,...l},a)=>e.jsx(_t,{ref:a,className:K(Ke(),t),...l}));$t.displayName=_t.displayName;const Et=n.forwardRef(({className:t,...l},a)=>e.jsx(wt,{ref:a,className:K(Ke({variant:"outline"}),"mt-2 sm:mt-0",t),...l}));Et.displayName=wt.displayName;const Fe=n.memo(({purchase:t})=>{const l=t.is_received?"completed":t.middle_manager_status==="approved"&&t.final_manager_status==="approved"?"inProgress":t.middle_manager_status==="rejected"||t.final_manager_status==="rejected"?"rejected":"pending",a={completed:{text:"입고완료",className:"bg-green-100 text-green-800"},inProgress:{text:"구매진행",className:"bg-hansl-100 text-hansl-800"},rejected:{text:"반려",className:"bg-red-100 text-red-800"},pending:{text:"승인대기",className:"bg-yellow-100 text-yellow-800"}},{text:r,className:s}=a[l];return e.jsx(Y,{className:s,children:r})});Fe.displayName="StatusBadge";const o={approvalStatus:"text-center w-20 min-w-[70px]",purchaseOrderNumber:"pl-2 w-32 min-w-[110px] sm:w-36 lg:w-40 xl:w-44",paymentCategory:"text-center w-20 min-w-[70px]",requesterName:"w-20 min-w-[60px]",requestDate:"w-20 min-w-[70px] lg:w-24",vendorName:"w-28 min-w-[90px] lg:w-32",contactName:"w-20 min-w-[60px]",deliveryRequestDate:"w-20 min-w-[70px] lg:w-24",itemName:"w-36 min-w-[120px] lg:w-44 xl:w-48",specification:"w-40 min-w-[140px] lg:w-48 xl:w-52",quantity:"text-center w-14 min-w-[45px]",unitPrice:"text-right w-20 min-w-[70px]",amount:"text-right w-24 min-w-[80px]",remark:"min-w-[150px] lg:min-w-[200px]",paymentSchedule:"w-20 min-w-[70px]",projectVendor:"w-28 min-w-[90px] lg:w-32",salesOrderNumber:"w-24 min-w-[80px] lg:w-28",projectItem:"w-28 min-w-[90px] lg:w-32",receiptProgress:"text-center w-20 min-w-[70px]",status:"text-center w-20 min-w-[70px]",receipt:"text-center w-20 min-w-[70px]",paymentStatus:"text-center w-16 min-w-[60px]",link:"w-20 min-w-[70px]"},Pt=n.memo(({purchase:t})=>{const l=t.middle_manager_status==="approved",a=t.middle_manager_status==="rejected",r=t.final_manager_status==="approved",s=t.final_manager_status==="rejected";return a||s?e.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[e.jsx("div",{className:"flex items-center gap-0.5",children:e.jsx("div",{className:"w-1.5 h-1.5 bg-red-500 rounded-full animate-pulse"})}),e.jsx(Y,{className:"bg-red-100 text-red-800 text-[11px] font-medium px-1.5 py-0",children:"반려"})]}):l&&r?e.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[e.jsx("div",{className:"flex items-center gap-0.5",children:e.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"})}),e.jsx(Y,{className:"bg-green-100 text-green-800 text-[11px] font-medium px-1.5 py-0",children:"승인완료"})]}):l&&!r&&!s?e.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),e.jsx("div",{className:"w-3 h-0.5 bg-gray-300"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full"})]}),e.jsx(Y,{className:"bg-yellow-100 text-yellow-800 text-[11px] font-medium px-1.5 py-0",children:"1차 승인"})]}):e.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full"}),e.jsx("div",{className:"w-3 h-0.5 bg-gray-300"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full"})]}),e.jsx(Y,{className:"bg-gray-100 text-gray-600 text-[11px] font-medium px-1.5 py-0",children:"승인대기"})]})});Pt.displayName="ApprovalStatusBadge";const Br=t=>{if(t.is_received)return{received:1,total:1,percentage:100};if(!t.items||t.items.length===0)return{received:0,total:1,percentage:0};const l=t.items.length,a=t.items.filter(s=>s.is_received===!0).length,r=l>0?Math.round(a/l*100):0;return{received:a,total:l,percentage:r}},Vr=t=>{if(t.is_payment_completed)return{completed:1,total:1,percentage:100};if(!t.items||t.items.length===0)return{completed:0,total:1,percentage:0};const l=t.items.length,a=t.items.filter(s=>s.is_payment_completed===!0).length,r=l>0?Math.round(a/l*100):0;return{completed:a,total:l,percentage:r}},Te=t=>{if(!t)return"-";const l=new Date(t);return`${String(l.getMonth()+1).padStart(2,"0")}-${String(l.getDate()).padStart(2,"0")}`},Jr=n.memo(({type:t})=>t==="선진행"||t?.includes("선진행")?e.jsx(Y,{className:"bg-red-500 text-white font-bold text-[11px] px-2 py-0.5",children:"선진행"}):e.jsx(Y,{className:"bg-gray-200 text-gray-700 text-[11px] px-2 py-0.5",children:"일반"}));Jr.displayName="ProgressTypeBadge";const Ft=n.memo(({purchase:t,onClick:l,activeTab:a,isLeadBuyer:r,onPaymentComplete:s,onReceiptComplete:x,onExcelDownload:g})=>{const h=Br(t),C=Vr(t),d=t.progress_type==="선진행"||t.progress_type?.includes("선진행");return e.jsxs("tr",{className:`border-b hover:bg-gray-100 cursor-pointer transition-colors ${d?"bg-red-50 hover:bg-red-100":""}`,onClick:()=>l(t),children:[a==="pending"&&e.jsx("td",{className:`px-2 py-1.5 whitespace-nowrap ${o.approvalStatus}`,children:e.jsx(Pt,{purchase:t})}),a==="purchase"&&e.jsx("td",{className:`px-2 py-1.5 ${o.receiptProgress}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:e.jsx("div",{className:`h-1.5 rounded-full ${C.percentage===100?"bg-blue-500":C.percentage>0?"bg-blue-400":"bg-gray-300"}`,style:{width:`${C.percentage}%`}})}),e.jsxs("span",{className:"text-[11px] text-gray-600",children:[C.percentage,"%"]})]})}),a==="receipt"&&e.jsx("td",{className:`px-2 py-1.5 ${o.receiptProgress}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:e.jsx("div",{className:`h-1.5 rounded-full ${h.percentage===100?"bg-green-500":h.percentage>0?"bg-hansl-500":"bg-gray-300"}`,style:{width:`${h.percentage}%`}})}),e.jsxs("span",{className:"text-[11px] text-gray-600",children:[h.percentage,"%"]})]})}),e.jsx("td",{className:`px-2 py-1.5 font-medium text-[11px] whitespace-nowrap ${o.purchaseOrderNumber}`,children:e.jsxs("div",{className:"flex items-center gap-1",children:[g&&e.jsx("img",{src:"/excels-icon.svg",alt:"엑셀 다운로드",width:"16",height:"16",className:`inline-block align-middle transition-transform p-0.5 rounded
                ${t.is_po_download?"border border-gray-400":""}
                ${t.progress_type==="선진행"||t.progress_type?.includes("선진행")||t.middle_manager_status==="approved"&&t.final_manager_status==="approved"?t.is_po_download?"cursor-pointer":"cursor-pointer hover:scale-110":"opacity-40 grayscale cursor-not-allowed"}`,onClick:async y=>{(t.progress_type==="선진행"||t.progress_type?.includes("선진행")||t.middle_manager_status==="approved"&&t.final_manager_status==="approved")&&(y.stopPropagation(),await g(t))},style:{pointerEvents:t.progress_type==="선진행"||t.progress_type?.includes("선진행")||t.middle_manager_status==="approved"&&t.final_manager_status==="approved"?"auto":"none"},title:t.is_po_download?"다운로드 완료":"엑셀 발주서 다운로드"}),e.jsx("span",{className:"block truncate",title:t.purchase_order_number||"",children:t.purchase_order_number||"-"})]})}),(a==="pending"||a==="receipt"||a==="done"||!a)&&e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${o.paymentCategory}`,children:e.jsx(Y,{className:`text-[11px] ${t.payment_category==="구매 요청"?"bg-blue-100 text-blue-800":t.payment_category==="발주"?"bg-green-100 text-green-800":t.payment_category==="경비 청구"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:t.payment_category==="구매 요청"?"구매요청":t.payment_category==="발주"?"발주요청":t.payment_category||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${o.requesterName}`,children:e.jsx("span",{className:"block truncate",title:t.requester_name||"",children:t.requester_name||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${o.requestDate}`,children:Te(t.request_date)}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${o.vendorName}`,children:e.jsx("span",{className:"block truncate",title:t.vendor_name||"",children:t.vendor_name||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${o.contactName}`,children:e.jsx("span",{className:"block truncate",title:t.contact_name||"",children:t.contact_name||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${o.deliveryRequestDate}`,children:Te(t.delivery_request_date)}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${o.itemName}`,children:e.jsx("span",{className:"block truncate",title:t.item_name||"",children:t.item_name||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${o.specification}`,children:e.jsx("span",{className:"block truncate",title:t.specification||"",children:t.specification||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${o.quantity}`,children:t.quantity||0}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${o.unitPrice}`,children:t.unit_price_value?.toLocaleString()||0}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] font-medium whitespace-nowrap ${o.amount}`,children:t.amount_value?.toLocaleString()||t.total_amount?.toLocaleString()||0}),a==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${o.remark}`,children:e.jsx("span",{className:"block truncate",title:t.remark||"",children:t.remark||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${o.projectVendor}`,children:e.jsx("span",{className:"block truncate",title:t.project_vendor||"",children:t.project_vendor||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${o.projectItem}`,children:e.jsx("span",{className:"block truncate",title:t.project_item||"",children:t.project_item||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${o.salesOrderNumber}`,children:e.jsx("span",{className:"block truncate",title:t.sales_order_number||"",children:t.sales_order_number||"-"})})]}),a==="purchase"&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${o.remark}`,children:e.jsx("span",{className:"block truncate",title:t.remark||"",children:t.remark||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${o.link}`,children:t.link?e.jsx("a",{href:t.link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline truncate block",title:t.link,children:"링크 보기"}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${o.paymentSchedule}`,children:e.jsx("span",{className:"block truncate",title:t.vendor_payment_schedule||"",children:t.vendor_payment_schedule||"-"})})]}),a==="receipt"&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${o.remark}`,children:e.jsx("span",{className:"block truncate",title:t.remark||"",children:t.remark||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${o.projectVendor}`,children:e.jsx("span",{className:"block truncate",title:t.project_vendor||"",children:t.project_vendor||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${o.projectItem}`,children:e.jsx("span",{className:"block truncate",title:t.project_item||"",children:t.project_item||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${o.salesOrderNumber}`,children:e.jsx("span",{className:"block truncate",title:t.sales_order_number||"",children:t.sales_order_number||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${o.paymentSchedule}`,children:e.jsx("span",{className:"block truncate",title:t.vendor_payment_schedule||"",children:t.vendor_payment_schedule||"-"})})]}),(a==="done"||!a)&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${o.remark}`,children:e.jsx("span",{className:"block truncate",title:t.remark||"",children:t.remark||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${o.link}`,children:t.link?e.jsx("a",{href:t.link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline truncate block",title:t.link,children:"링크 보기"}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${o.projectVendor}`,children:e.jsx("span",{className:"block truncate",title:t.project_vendor||"",children:t.project_vendor||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${o.projectItem}`,children:e.jsx("span",{className:"block truncate",title:t.project_item||"",children:t.project_item||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${o.salesOrderNumber}`,children:e.jsx("span",{className:"block truncate",title:t.sales_order_number||"",children:t.sales_order_number||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${o.paymentSchedule}`,children:e.jsx("span",{className:"block truncate",title:t.vendor_payment_schedule||"",children:t.vendor_payment_schedule||"-"})}),e.jsx("td",{className:`px-2 py-1.5 ${o.status}`,children:e.jsx(Fe,{purchase:t})}),e.jsx("td",{className:`px-2 py-1.5 ${o.receipt}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:e.jsx("div",{className:`h-1.5 rounded-full ${h.percentage===100?"bg-green-500":h.percentage>0?"bg-hansl-500":"bg-gray-300"}`,style:{width:`${h.percentage}%`}})}),e.jsxs("span",{className:"text-[11px] text-gray-600",children:[h.percentage,"%"]})]})}),e.jsx("td",{className:`px-2 py-1.5 ${o.paymentStatus}`,children:t.is_payment_completed?e.jsx(Y,{className:"bg-green-100 text-green-800 text-[11px]",children:"완료"}):e.jsx(Y,{className:"bg-gray-100 text-gray-800 text-[11px]",children:"대기"})})]})]})});Ft.displayName="TableRow";const zt=n.memo(({purchases:t,activeTab:l="done",currentUserRoles:a=[],onRefresh:r,onPaymentComplete:s,onReceiptComplete:x})=>{const[g,h]=n.useState(null),[C,d]=n.useState(!1),[y,A]=n.useState(!1),[$,P]=n.useState(null),F=je(),Q=a&&(a.includes("raw_material_manager")||a.includes("consumable_manager")||a.includes("purchase_manager")||a.includes("app_admin"));a.includes("final_approver")||a.includes("app_admin")||a.includes("ceo");const c=p=>{h(p.id),d(!0)},w=()=>{d(!1),h(null)},N=async p=>{try{const{data:u,error:E}=await F.from("purchase_requests").select("*").eq("purchase_order_number",p.purchase_order_number).single();if(E||!u){te.error("해당 발주요청번호의 데이터를 찾을 수 없습니다.");return}const{data:j,error:O}=await F.from("purchase_request_items").select("*").eq("purchase_order_number",p.purchase_order_number).order("line_number");if(O||!j||j.length===0){te.error("해당 발주요청번호의 품목 데이터를 찾을 수 없습니다.");return}const G={vendor_name:p.vendor_name,vendor_phone:"",vendor_fax:"",vendor_contact_name:"",vendor_payment_schedule:""};try{const q=u.vendor_id||p.vendor_id,U=u.contact_id||p.contact_id;if(q){const{data:J}=await F.from("vendors").select("vendor_phone, vendor_fax, vendor_payment_schedule").eq("id",q).single();J&&(G.vendor_phone=J.vendor_phone||"",G.vendor_fax=J.vendor_fax||"",G.vendor_payment_schedule=J.vendor_payment_schedule||"")}if(U){const{data:J}=await F.from("vendor_contacts").select("contact_name, contact_phone, contact_email").eq("id",U).single();J&&(G.vendor_contact_name=J.contact_name||"")}}catch{}const R={purchase_order_number:u.purchase_order_number||"",request_date:u.request_date,delivery_request_date:u.delivery_request_date,requester_name:u.requester_name,vendor_name:G.vendor_name||"",vendor_contact_name:G.vendor_contact_name,vendor_phone:G.vendor_phone,vendor_fax:G.vendor_fax,project_vendor:u.project_vendor,sales_order_number:u.sales_order_number,project_item:u.project_item,vendor_payment_schedule:G.vendor_payment_schedule,items:j.map(q=>({line_number:q.line_number,item_name:q.item_name,specification:q.specification,quantity:q.quantity,unit_price_value:q.unit_price_value,amount_value:q.amount_value,remark:q.remark,currency:u.currency||"KRW"}))},ee=await Ar(R),B=`발주서_${R.vendor_name}_${R.purchase_order_number}.xlsx`,W=window.URL.createObjectURL(ee),V=document.createElement("a");V.href=W,V.download=B,document.body.appendChild(V),V.click(),document.body.removeChild(V),window.URL.revokeObjectURL(W),te.success("엑셀 파일이 다운로드되었습니다.");try{if(a&&a.includes("lead buyer")){const{error:U}=await F.from("purchase_requests").update({is_po_download:!0}).eq("purchase_order_number",p.purchase_order_number);U||r?.()}}catch{}}catch{te.error("엑셀 다운로드에 실패했습니다.")}},M=async()=>{if($){try{const{error:p}=await F.from("purchase_request_items").delete().eq("purchase_request_id",$.id);if(p)throw p;const{error:u}=await F.from("purchase_requests").delete().eq("id",$.id);if(u)throw u;te.success("발주요청 내역이 삭제되었습니다."),r?.()}catch{te.error("삭제 중 오류가 발생했습니다.")}A(!1),P(null)}},I=n.useMemo(()=>{if(l==="pending")return e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${o.approvalStatus}`,children:"승인상태"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${o.purchaseOrderNumber}`,children:"발주번호"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${o.paymentCategory}`,children:"결제종류"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${o.requesterName}`,children:"요청자"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${o.requestDate}`,children:"청구일"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] text-left ${o.vendorName}`,children:"업체"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${o.contactName}`,children:"담당자"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${o.deliveryRequestDate}`,children:"입고요청일"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] text-left ${o.itemName}`,children:"품명"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] text-left ${o.specification}`,children:"규격"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${o.quantity}`,children:"수량"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${o.unitPrice}`,children:"단가"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${o.amount}`,children:"금액"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${o.remark}`,children:"비고"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${o.projectVendor}`,children:"PJ업체"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${o.projectItem}`,children:"PJ ITEM"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${o.salesOrderNumber}`,children:"수주번호"})]})});const p=e.jsxs(e.Fragment,{children:[e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${o.purchaseOrderNumber}`,children:"발주번호"}),(l==="receipt"||l==="done"||!l)&&e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${o.paymentCategory}`,children:"결제종류"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${o.requesterName}`,children:"요청자"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${o.requestDate}`,children:"청구일"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${o.vendorName}`,children:"업체"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${o.contactName}`,children:"담당자"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${o.deliveryRequestDate}`,children:"입고요청일"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] text-left ${o.itemName}`,children:"품명"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] text-left ${o.specification}`,children:"규격"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${o.quantity}`,children:"수량"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${o.unitPrice}`,children:"단가"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${o.amount}`,children:"금액"})]});let u=null;return l==="purchase"?u=e.jsxs(e.Fragment,{children:[e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${o.remark}`,children:"비고"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${o.link}`,children:"링크"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${o.paymentSchedule}`,children:"지출예정일"})]}):l==="receipt"?u=e.jsxs(e.Fragment,{children:[e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${o.remark}`,children:"비고"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${o.projectVendor}`,children:"PJ업체"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${o.projectItem}`,children:"PJ ITEM"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${o.salesOrderNumber}`,children:"수주번호"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${o.paymentSchedule}`,children:"지출예정일"})]}):u=e.jsxs(e.Fragment,{children:[e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${o.remark}`,children:"비고"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${o.link}`,children:"링크"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${o.projectVendor}`,children:"PJ업체"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${o.projectItem}`,children:"PJ ITEM"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${o.salesOrderNumber}`,children:"수주번호"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${o.paymentSchedule}`,children:"지출예정일"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${o.status}`,children:"상태"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${o.receipt}`,children:"입고"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${o.paymentStatus}`,children:"결제"})]}),e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[l==="purchase"&&e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${o.receiptProgress}`,children:"구매진행"}),l==="receipt"&&e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${o.receiptProgress}`,children:"입고진행"}),p,u]})})},[l]);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:block w-full",children:e.jsx("div",{className:"overflow-x-auto border rounded-lg",children:e.jsxs("table",{className:"w-full min-w-fit",children:[I,e.jsx("tbody",{children:t.map(p=>e.jsx(Ft,{purchase:p,onClick:c,activeTab:l,isLeadBuyer:Q,onPaymentComplete:s,onReceiptComplete:x,onExcelDownload:N},p.id))})]})})}),e.jsx("div",{className:"hidden sm:block md:hidden w-full",children:e.jsx("div",{className:"overflow-x-auto border rounded-lg",children:e.jsxs("table",{className:"w-full min-w-[640px] text-[11px]",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-2 font-medium text-gray-900 w-20 sm:w-24",children:"발주번호"}),e.jsx("th",{className:"text-left p-2 font-medium text-gray-900 w-16 sm:w-20",children:"요청자"}),e.jsx("th",{className:"text-left p-2 font-medium text-gray-900 w-24 sm:w-28",children:"업체"}),e.jsx("th",{className:"text-left p-2 font-medium text-gray-900 min-w-[100px]",children:"품명"}),e.jsx("th",{className:"text-right p-2 font-medium text-gray-900 w-20 sm:w-24",children:"금액"}),e.jsx("th",{className:"text-center p-2 font-medium text-gray-900 w-16 sm:w-20",children:"상태"})]})}),e.jsx("tbody",{children:t.map(p=>e.jsxs("tr",{className:"border-b hover:bg-gray-50 cursor-pointer",onClick:()=>c(p),children:[e.jsx("td",{className:"p-2 font-medium",children:p.purchase_order_number||"-"}),e.jsx("td",{className:"p-2",children:p.requester_name}),e.jsx("td",{className:"p-2 truncate",title:p.vendor_name,children:p.vendor_name}),e.jsx("td",{className:"p-2 truncate",title:p.item_name,children:p.item_name||"-"}),e.jsx("td",{className:"p-2 text-right font-medium",children:p.amount_value?.toLocaleString()||p.total_amount?.toLocaleString()||0}),e.jsx("td",{className:"p-2 text-center",children:e.jsx(Fe,{purchase:p})})]},p.id))})]})})}),e.jsx("div",{className:"sm:hidden space-y-3",children:t.map(p=>e.jsx(nt,{purchase:p,onClick:()=>c(p)},p.id))}),e.jsx(lr,{purchaseId:g,isOpen:C,onClose:w,currentUserRoles:a,activeTab:l,onRefresh:r,onDelete:p=>{P(p),A(!0)}}),e.jsx(Lr,{open:y,onOpenChange:A,children:e.jsxs(Ct,{children:[e.jsxs(St,{children:[e.jsx(At,{children:"발주요청 내역 삭제"}),e.jsxs(Dt,{children:["발주요청번호 ",$?.purchase_order_number,"를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."]})]}),e.jsxs(kt,{children:[e.jsx(Et,{children:"취소"}),e.jsx($t,{onClick:M,className:"bg-red-600 hover:bg-red-700",children:"삭제"})]})]})})]})});zt.displayName="FastPurchaseTable";var Be=1,Hr=.9,Wr=.8,Yr=.17,Ae=.1,De=.999,Kr=.9999,Xr=.99,Qr=/[\\\/_+.#"@\[\(\{&]/,Ur=/[\\\/_+.#"@\[\(\{&]/g,Zr=/[\s-]/,It=/[\s-]/g;function Ee(t,l,a,r,s,x,g){if(x===l.length)return s===t.length?Be:Xr;var h=`${s},${x}`;if(g[h]!==void 0)return g[h];for(var C=r.charAt(x),d=a.indexOf(C,s),y=0,A,$,P,F;d>=0;)A=Ee(t,l,a,r,d+1,x+1,g),A>y&&(d===s?A*=Be:Qr.test(t.charAt(d-1))?(A*=Wr,P=t.slice(s,d-1).match(Ur),P&&s>0&&(A*=Math.pow(De,P.length))):Zr.test(t.charAt(d-1))?(A*=Hr,F=t.slice(s,d-1).match(It),F&&s>0&&(A*=Math.pow(De,F.length))):(A*=Yr,s>0&&(A*=Math.pow(De,d-s))),t.charAt(d)!==l.charAt(x)&&(A*=Kr)),(A<Ae&&a.charAt(d-1)===r.charAt(x+1)||r.charAt(x+1)===r.charAt(x)&&a.charAt(d-1)!==r.charAt(x))&&($=Ee(t,l,a,r,d+1,x+2,g),$*Ae>A&&(A=$*Ae)),A>y&&(y=A),d=a.indexOf(C,d+1);return g[h]=y,y}function Ve(t){return t.toLowerCase().replace(It," ")}function ea(t,l,a){return t=a&&a.length>0?`${t+" "+a.join(" ")}`:t,Ee(t,l,Ve(t),Ve(l),0,0,{})}var ye='[cmdk-group=""]',$e='[cmdk-group-items=""]',ta='[cmdk-group-heading=""]',Rt='[cmdk-item=""]',Je=`${Rt}:not([aria-disabled="true"])`,Pe="cmdk-item-select",me="data-value",ra=(t,l,a)=>ea(t,l,a),qt=n.createContext(void 0),we=()=>n.useContext(qt),Mt=n.createContext(void 0),ze=()=>n.useContext(Mt),Gt=n.createContext(void 0),Ot=n.forwardRef((t,l)=>{let a=ue(()=>{var i,b;return{search:"",value:(b=(i=t.value)!=null?i:t.defaultValue)!=null?b:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),r=ue(()=>new Set),s=ue(()=>new Map),x=ue(()=>new Map),g=ue(()=>new Set),h=Lt(t),{label:C,children:d,value:y,onValueChange:A,filter:$,shouldFilter:P,loop:F,disablePointerSelection:Q=!1,vimBindings:c=!0,...w}=t,N=pe(),M=pe(),I=pe(),p=n.useRef(null),u=pa();ce(()=>{if(y!==void 0){let i=y.trim();a.current.value=i,E.emit()}},[y]),ce(()=>{u(6,B)},[]);let E=n.useMemo(()=>({subscribe:i=>(g.current.add(i),()=>g.current.delete(i)),snapshot:()=>a.current,setState:(i,b,k)=>{var f,D,m,z;if(!Object.is(a.current[i],b)){if(a.current[i]=b,i==="search")ee(),G(),u(1,R);else if(i==="value"){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let H=document.getElementById(I);H?H.focus():(f=document.getElementById(N))==null||f.focus()}if(u(7,()=>{var H;a.current.selectedItemId=(H=W())==null?void 0:H.id,E.emit()}),k||u(5,B),((D=h.current)==null?void 0:D.value)!==void 0){let H=b??"";(z=(m=h.current).onValueChange)==null||z.call(m,H);return}}E.emit()}},emit:()=>{g.current.forEach(i=>i())}}),[]),j=n.useMemo(()=>({value:(i,b,k)=>{var f;b!==((f=x.current.get(i))==null?void 0:f.value)&&(x.current.set(i,{value:b,keywords:k}),a.current.filtered.items.set(i,O(b,k)),u(2,()=>{G(),E.emit()}))},item:(i,b)=>(r.current.add(i),b&&(s.current.has(b)?s.current.get(b).add(i):s.current.set(b,new Set([i]))),u(3,()=>{ee(),G(),a.current.value||R(),E.emit()}),()=>{x.current.delete(i),r.current.delete(i),a.current.filtered.items.delete(i);let k=W();u(4,()=>{ee(),k?.getAttribute("id")===i&&R(),E.emit()})}),group:i=>(s.current.has(i)||s.current.set(i,new Set),()=>{x.current.delete(i),s.current.delete(i)}),filter:()=>h.current.shouldFilter,label:C||t["aria-label"],getDisablePointerSelection:()=>h.current.disablePointerSelection,listId:N,inputId:I,labelId:M,listInnerRef:p}),[]);function O(i,b){var k,f;let D=(f=(k=h.current)==null?void 0:k.filter)!=null?f:ra;return i?D(i,a.current.search,b):0}function G(){if(!a.current.search||h.current.shouldFilter===!1)return;let i=a.current.filtered.items,b=[];a.current.filtered.groups.forEach(f=>{let D=s.current.get(f),m=0;D.forEach(z=>{let H=i.get(z);m=Math.max(H,m)}),b.push([f,m])});let k=p.current;V().sort((f,D)=>{var m,z;let H=f.getAttribute("id"),_=D.getAttribute("id");return((m=i.get(_))!=null?m:0)-((z=i.get(H))!=null?z:0)}).forEach(f=>{let D=f.closest($e);D?D.appendChild(f.parentElement===D?f:f.closest(`${$e} > *`)):k.appendChild(f.parentElement===k?f:f.closest(`${$e} > *`))}),b.sort((f,D)=>D[1]-f[1]).forEach(f=>{var D;let m=(D=p.current)==null?void 0:D.querySelector(`${ye}[${me}="${encodeURIComponent(f[0])}"]`);m?.parentElement.appendChild(m)})}function R(){let i=V().find(k=>k.getAttribute("aria-disabled")!=="true"),b=i?.getAttribute(me);E.setState("value",b||void 0)}function ee(){var i,b,k,f;if(!a.current.search||h.current.shouldFilter===!1){a.current.filtered.count=r.current.size;return}a.current.filtered.groups=new Set;let D=0;for(let m of r.current){let z=(b=(i=x.current.get(m))==null?void 0:i.value)!=null?b:"",H=(f=(k=x.current.get(m))==null?void 0:k.keywords)!=null?f:[],_=O(z,H);a.current.filtered.items.set(m,_),_>0&&D++}for(let[m,z]of s.current)for(let H of z)if(a.current.filtered.items.get(H)>0){a.current.filtered.groups.add(m);break}a.current.filtered.count=D}function B(){var i,b,k;let f=W();f&&(((i=f.parentElement)==null?void 0:i.firstChild)===f&&((k=(b=f.closest(ye))==null?void 0:b.querySelector(ta))==null||k.scrollIntoView({block:"nearest"})),f.scrollIntoView({block:"nearest"}))}function W(){var i;return(i=p.current)==null?void 0:i.querySelector(`${Rt}[aria-selected="true"]`)}function V(){var i;return Array.from(((i=p.current)==null?void 0:i.querySelectorAll(Je))||[])}function q(i){let b=V()[i];b&&E.setState("value",b.getAttribute(me))}function U(i){var b;let k=W(),f=V(),D=f.findIndex(z=>z===k),m=f[D+i];(b=h.current)!=null&&b.loop&&(m=D+i<0?f[f.length-1]:D+i===f.length?f[0]:f[D+i]),m&&E.setState("value",m.getAttribute(me))}function J(i){let b=W(),k=b?.closest(ye),f;for(;k&&!f;)k=i>0?ma(k,ye):ua(k,ye),f=k?.querySelector(Je);f?E.setState("value",f.getAttribute(me)):U(i)}let re=()=>q(V().length-1),ae=i=>{i.preventDefault(),i.metaKey?re():i.altKey?J(1):U(1)},le=i=>{i.preventDefault(),i.metaKey?q(0):i.altKey?J(-1):U(-1)};return n.createElement(oe.div,{ref:l,tabIndex:-1,...w,"cmdk-root":"",onKeyDown:i=>{var b;(b=w.onKeyDown)==null||b.call(w,i);let k=i.nativeEvent.isComposing||i.keyCode===229;if(!(i.defaultPrevented||k))switch(i.key){case"n":case"j":{c&&i.ctrlKey&&ae(i);break}case"ArrowDown":{ae(i);break}case"p":case"k":{c&&i.ctrlKey&&le(i);break}case"ArrowUp":{le(i);break}case"Home":{i.preventDefault(),q(0);break}case"End":{i.preventDefault(),re();break}case"Enter":{i.preventDefault();let f=W();if(f){let D=new Event(Pe);f.dispatchEvent(D)}}}}},n.createElement("label",{"cmdk-label":"",htmlFor:j.inputId,id:j.labelId,style:ga},C),be(t,i=>n.createElement(Mt.Provider,{value:E},n.createElement(qt.Provider,{value:j},i))))}),aa=n.forwardRef((t,l)=>{var a,r;let s=pe(),x=n.useRef(null),g=n.useContext(Gt),h=we(),C=Lt(t),d=(r=(a=C.current)==null?void 0:a.forceMount)!=null?r:g?.forceMount;ce(()=>{if(!d)return h.item(s,g?.id)},[d]);let y=Tt(s,x,[t.value,t.children,x],t.keywords),A=ze(),$=ie(u=>u.value&&u.value===y.current),P=ie(u=>d||h.filter()===!1?!0:u.search?u.filtered.items.get(s)>0:!0);n.useEffect(()=>{let u=x.current;if(!(!u||t.disabled))return u.addEventListener(Pe,F),()=>u.removeEventListener(Pe,F)},[P,t.onSelect,t.disabled]);function F(){var u,E;Q(),(E=(u=C.current).onSelect)==null||E.call(u,y.current)}function Q(){A.setState("value",y.current,!0)}if(!P)return null;let{disabled:c,value:w,onSelect:N,forceMount:M,keywords:I,...p}=t;return n.createElement(oe.div,{ref:_e(x,l),...p,id:s,"cmdk-item":"",role:"option","aria-disabled":!!c,"aria-selected":!!$,"data-disabled":!!c,"data-selected":!!$,onPointerMove:c||h.getDisablePointerSelection()?void 0:Q,onClick:c?void 0:F},t.children)}),la=n.forwardRef((t,l)=>{let{heading:a,children:r,forceMount:s,...x}=t,g=pe(),h=n.useRef(null),C=n.useRef(null),d=pe(),y=we(),A=ie(P=>s||y.filter()===!1?!0:P.search?P.filtered.groups.has(g):!0);ce(()=>y.group(g),[]),Tt(g,h,[t.value,t.heading,C]);let $=n.useMemo(()=>({id:g,forceMount:s}),[s]);return n.createElement(oe.div,{ref:_e(h,l),...x,"cmdk-group":"",role:"presentation",hidden:A?void 0:!0},a&&n.createElement("div",{ref:C,"cmdk-group-heading":"","aria-hidden":!0,id:d},a),be(t,P=>n.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":a?d:void 0},n.createElement(Gt.Provider,{value:$},P))))}),na=n.forwardRef((t,l)=>{let{alwaysRender:a,...r}=t,s=n.useRef(null),x=ie(g=>!g.search);return!a&&!x?null:n.createElement(oe.div,{ref:_e(s,l),...r,"cmdk-separator":"",role:"separator"})}),sa=n.forwardRef((t,l)=>{let{onValueChange:a,...r}=t,s=t.value!=null,x=ze(),g=ie(d=>d.search),h=ie(d=>d.selectedItemId),C=we();return n.useEffect(()=>{t.value!=null&&x.setState("search",t.value)},[t.value]),n.createElement(oe.input,{ref:l,...r,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":C.listId,"aria-labelledby":C.labelId,"aria-activedescendant":h,id:C.inputId,type:"text",value:s?t.value:g,onChange:d=>{s||x.setState("search",d.target.value),a?.(d.target.value)}})}),ia=n.forwardRef((t,l)=>{let{children:a,label:r="Suggestions",...s}=t,x=n.useRef(null),g=n.useRef(null),h=ie(d=>d.selectedItemId),C=we();return n.useEffect(()=>{if(g.current&&x.current){let d=g.current,y=x.current,A,$=new ResizeObserver(()=>{A=requestAnimationFrame(()=>{let P=d.offsetHeight;y.style.setProperty("--cmdk-list-height",P.toFixed(1)+"px")})});return $.observe(d),()=>{cancelAnimationFrame(A),$.unobserve(d)}}},[]),n.createElement(oe.div,{ref:_e(x,l),...s,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":h,"aria-label":r,id:C.listId},be(t,d=>n.createElement("div",{ref:_e(g,C.listInnerRef),"cmdk-list-sizer":""},d)))}),oa=n.forwardRef((t,l)=>{let{open:a,onOpenChange:r,overlayClassName:s,contentClassName:x,container:g,...h}=t;return n.createElement(Ue,{open:a,onOpenChange:r},n.createElement(Ze,{container:g},n.createElement(rt,{"cmdk-overlay":"",className:s}),n.createElement(et,{"aria-label":t.label,"cmdk-dialog":"",className:x},n.createElement(Ot,{ref:l,...h}))))}),ca=n.forwardRef((t,l)=>ie(a=>a.filtered.count===0)?n.createElement(oe.div,{ref:l,...t,"cmdk-empty":"",role:"presentation"}):null),da=n.forwardRef((t,l)=>{let{progress:a,children:r,label:s="Loading...",...x}=t;return n.createElement(oe.div,{ref:l,...x,"cmdk-loading":"",role:"progressbar","aria-valuenow":a,"aria-valuemin":0,"aria-valuemax":100,"aria-label":s},be(t,g=>n.createElement("div",{"aria-hidden":!0},g)))}),X=Object.assign(Ot,{List:ia,Item:aa,Input:sa,Group:la,Separator:na,Dialog:oa,Empty:ca,Loading:da});function ma(t,l){let a=t.nextElementSibling;for(;a;){if(a.matches(l))return a;a=a.nextElementSibling}}function ua(t,l){let a=t.previousElementSibling;for(;a;){if(a.matches(l))return a;a=a.previousElementSibling}}function Lt(t){let l=n.useRef(t);return ce(()=>{l.current=t}),l}var ce=typeof window>"u"?n.useEffect:n.useLayoutEffect;function ue(t){let l=n.useRef();return l.current===void 0&&(l.current=t()),l}function ie(t){let l=ze(),a=()=>t(l.snapshot());return n.useSyncExternalStore(l.subscribe,a,a)}function Tt(t,l,a,r=[]){let s=n.useRef(),x=we();return ce(()=>{var g;let h=(()=>{var d;for(let y of a){if(typeof y=="string")return y.trim();if(typeof y=="object"&&"current"in y)return y.current?(d=y.current.textContent)==null?void 0:d.trim():s.current}})(),C=r.map(d=>d.trim());x.value(t,h,C),(g=l.current)==null||g.setAttribute(me,h),s.current=h}),s}var pa=()=>{let[t,l]=n.useState(),a=ue(()=>new Map);return ce(()=>{a.current.forEach(r=>r()),a.current=new Map},[t]),(r,s)=>{a.current.set(r,s),l({})}};function xa(t){let l=t.type;return typeof l=="function"?l(t.props):"render"in l?l.render(t.props):t}function be({asChild:t,children:l},a){return t&&n.isValidElement(l)?n.cloneElement(xa(l),{ref:l.ref},a(l.props.children)):a(l)}var ga={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const Bt=n.forwardRef(({className:t,...l},a)=>e.jsx(X,{ref:a,className:K("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",t),...l}));Bt.displayName=X.displayName;const Vt=n.forwardRef(({className:t,...l},a)=>e.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[e.jsx(at,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),e.jsx(X.Input,{ref:a,className:K("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",t),...l})]}));Vt.displayName=X.Input.displayName;const ha=n.forwardRef(({className:t,...l},a)=>e.jsx(X.List,{ref:a,className:K("max-h-[300px] overflow-y-auto overflow-x-hidden",t),...l}));ha.displayName=X.List.displayName;const Jt=n.forwardRef((t,l)=>e.jsx(X.Empty,{ref:l,className:"py-6 text-center text-sm",...t}));Jt.displayName=X.Empty.displayName;const Ht=n.forwardRef(({className:t,...l},a)=>e.jsx(X.Group,{ref:a,className:K("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",t),...l}));Ht.displayName=X.Group.displayName;const fa=n.forwardRef(({className:t,...l},a)=>e.jsx(X.Separator,{ref:a,className:K("-mx-1 h-px bg-border",t),...l}));fa.displayName=X.Separator.displayName;const Wt=n.forwardRef(({className:t,...l},a)=>e.jsx(X.Item,{ref:a,className:K("relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t),...l}));Wt.displayName=X.Item.displayName;function va({options:t,value:l,onValueChange:a,placeholder:r="선택...",searchPlaceholder:s="검색...",emptyText:x="결과가 없습니다.",className:g}){const[h,C]=n.useState(!1);return e.jsxs(nr,{open:h,onOpenChange:C,children:[e.jsx(sr,{asChild:!0,children:e.jsxs(Xe,{variant:"outline",role:"combobox","aria-expanded":h,className:K("w-full justify-between h-9 text-sm font-normal",g),children:[l?t.find(d=>d.value===l)?.label:r,e.jsx(yr,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(ir,{className:"w-full p-0",align:"start",children:e.jsxs(Bt,{children:[e.jsx(Vt,{placeholder:s,className:"h-9"}),e.jsx(Jt,{children:x}),e.jsx(Ht,{className:"max-h-[300px] overflow-auto",children:t.map(d=>e.jsxs(Wt,{value:d.label,onSelect:()=>{a(d.value===l?"":d.value),C(!1)},children:[e.jsx(hr,{className:K("mr-2 h-4 w-4",l===d.value?"opacity-100":"opacity-0")}),d.label]},d.value))})]})})]})}const ya=n.lazy(()=>We(()=>import("./PurchaseItemsModal-B4iN-Ihx.js"),__vite__mapDeps([3,1,2,4,5,6,7,8,9,10]))),_a=[{key:"pending",label:"승인대기"},{key:"purchase",label:"구매 현황"},{key:"receipt",label:"입고 현황"},{key:"done",label:"전체 항목"}];function za({onEmailToggle:t,showEmailButton:l=!0}){const a=rr(),r=ar(),s=je(),[x,g]=n.useState(null),[h,C]=n.useState({}),[d,y]=n.useState(null),[A,$]=n.useState(!1),{purchases:P,vendors:F,employees:Q,loading:c,currentUserRoles:w,currentUserName:N,refreshPurchases:M}=jr(),I=w?.includes("app_admin"),{activeTab:p,searchTerm:u,vendorFilter:E,dateFromFilter:j,dateToFilter:O,selectedEmployee:G,purchaseNumberFilter:R,itemNameFilter:ee,approvalStatusFilter:B,setActiveTab:W,setSearchTerm:V,setVendorFilter:q,setDateFromFilter:U,setDateToFilter:J,setSelectedEmployee:re,setPurchaseNumberFilter:ae,setItemNameFilter:le,setApprovalStatusFilter:i,filteredPurchases:b,tabCounts:k}=Cr(P,w,N);n.useEffect(()=>{new URLSearchParams(r.search).get("tab")==="purchase"&&W("purchase")},[r.search,W]);const f=async m=>{try{const{error:z}=await s.from("purchase_requests").update({is_received:!0,received_at:new Date().toISOString()}).eq("id",m);if(z)throw z;await s.from("purchase_request_items").update({is_received:!0,delivery_status:"received"}).eq("purchase_request_id",m),te.success("입고완료 처리되었습니다."),await M()}catch{te.error("처리 중 오류가 발생했습니다.")}},D=async m=>{try{const{error:z}=await s.from("purchase_requests").update({is_payment_completed:!0,payment_completed_at:new Date().toISOString()}).eq("id",m);if(z)throw z;te.success("구매완료 처리되었습니다."),await M()}catch{te.error("처리 중 오류가 발생했습니다.")}};return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"발주요청 관리"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"발주요청서를 관리하고 승인 처리를 할 수 있습니다"})]}),e.jsxs(Xe,{onClick:()=>a("/purchase/new"),className:"mt-4 sm:mt-0 bg-hansl-500 hover:bg-hansl-600",children:[e.jsx(fr,{className:"w-4 h-4 mr-2"}),"새 발주요청 작성"]})]}),e.jsxs(Ie,{className:"mb-4 border border-gray-200",children:[e.jsx(dr,{className:"bg-white border-b border-gray-200 py-3",children:e.jsxs(mr,{className:"flex items-center text-gray-900 text-sm font-medium",children:[e.jsx(wr,{className:"w-4 h-4 mr-2"}),"검색 필터"]})}),e.jsx(Re,{className:"py-3",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"시작일"}),e.jsx(ve,{type:"date",value:j,onChange:m=>U(m.target.value),className:"text-sm h-9"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"종료일"}),e.jsx(ve,{type:"date",value:O,onChange:m=>J(m.target.value),className:"text-sm h-9"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"요청자"}),e.jsx(va,{value:G||"all",onValueChange:m=>{re(m)},options:[{value:"all",label:"전체"},...Q.filter(m=>m.name&&m.name.trim()!=="").sort((m,z)=>(m.name||"").localeCompare(z.name||"")).map(m=>({value:m.name||"",label:`${m.name}${m.name===N?" (나)":""}`}))],placeholder:G==="all"?"전체":G||"선택",searchPlaceholder:"직원 이름 검색...",emptyText:"일치하는 직원이 없습니다",className:"text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"업체"}),e.jsxs(qe,{value:E||"all",onValueChange:m=>q(m==="all"?"":m),children:[e.jsx(Me,{className:"h-9 text-sm",children:e.jsx(Ge,{placeholder:"전체"})}),e.jsxs(Oe,{children:[e.jsx(de,{value:"all",children:"전체"}),F.map(m=>e.jsx(de,{value:m.vendor_name,children:m.vendor_name},m.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"발주번호"}),e.jsx(ve,{placeholder:"번호",value:R,onChange:m=>ae(m.target.value),className:"text-sm h-9"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"품명"}),e.jsx(ve,{placeholder:"품명",value:ee,onChange:m=>le(m.target.value),className:"text-sm h-9"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"승인상태"}),e.jsxs(qe,{value:B||"all",onValueChange:m=>i(m==="all"?"":m),children:[e.jsx(Me,{className:"h-9 text-sm",children:e.jsx(Ge,{placeholder:"전체"})}),e.jsxs(Oe,{children:[e.jsx(de,{value:"all",children:"전체"}),e.jsx(de,{value:"pending",children:"대기"}),e.jsx(de,{value:"approved",children:"승인"}),e.jsx(de,{value:"rejected",children:"반려"})]})]})]}),e.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"통합검색"}),e.jsxs("div",{className:"relative",children:[e.jsx(at,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 w-3 h-3 text-gray-400"}),e.jsx(ve,{placeholder:"검색...",value:u,onChange:m=>V(m.target.value),className:"pl-7 text-sm h-9"})]})]})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:space-x-1 space-y-1 sm:space-y-0 bg-gray-50 p-1 rounded-lg border border-gray-200",children:_a.map(m=>e.jsxs("button",{onClick:()=>W(m.key),className:`flex-1 flex items-center justify-center space-x-2 py-2.5 px-3 sm:px-4 rounded-md text-xs sm:text-sm font-medium transition-colors ${p===m.key?"text-hansl-600 bg-white shadow-sm border border-gray-200":"text-gray-600 bg-transparent hover:text-gray-900 hover:bg-white/50"}`,children:[e.jsx("span",{className:"whitespace-nowrap",children:m.label}),e.jsx(Y,{variant:"secondary",className:`text-[10px] sm:text-xs ${p===m.key?"bg-hansl-50 text-hansl-700":"bg-gray-100 text-gray-600"}`,children:k[m.key]})]},m.key))}),e.jsx(Ie,{className:"overflow-hidden border border-gray-200",children:e.jsx(Re,{className:"p-0",children:c?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-hansl-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"로딩 중..."})]}):b.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(or,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"발주요청서가 없습니다"}),e.jsx("p",{className:"text-gray-600",children:"새로운 발주요청서를 작성해보세요."})]}):e.jsx(zt,{purchases:b,activeTab:p,currentUserRoles:w,onRefresh:M,onPaymentComplete:D,onReceiptComplete:f})})})]}),d&&e.jsx(n.Suspense,{fallback:e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"})}),children:e.jsx(ya,{isOpen:A,onClose:()=>{$(!1),y(null)},purchase:{...d,vendor_name:d.vendor_name||"",project_vendor:d.project_vendor||"",sales_order_number:d.sales_order_number||"",project_item:d.project_item||""},isAdmin:I||!1,onUpdate:M})})]})}export{za as default};
//# sourceMappingURL=PurchaseListMain-C5lxdHjC.js.map
