{"version":3,"file":"SupportMain-Dc0cfGHS.js","sources":["../../node_modules/lucide-react/dist/esm/icons/image-plus.js","../../node_modules/lucide-react/dist/esm/icons/send.js","../../src/components/ui/date-range-picker.tsx","../../src/components/support/SupportMain.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M16 5h6\", key: \"1vod17\" }],\n  [\"path\", { d: \"M19 2v6\", key: \"4bpg5p\" }],\n  [\"path\", { d: \"M21 11.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7.5\", key: \"1ue2ih\" }],\n  [\"path\", { d: \"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21\", key: \"1xmnt7\" }],\n  [\"circle\", { cx: \"9\", cy: \"9\", r: \"2\", key: \"af1f0g\" }]\n];\nconst ImagePlus = createLucideIcon(\"image-plus\", __iconNode);\n\nexport { __iconNode, ImagePlus as default };\n//# sourceMappingURL=image-plus.js.map\n","/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z\",\n      key: \"1ffxy3\"\n    }\n  ],\n  [\"path\", { d: \"m21.854 2.147-10.94 10.939\", key: \"12cjpa\" }]\n];\nconst Send = createLucideIcon(\"send\", __iconNode);\n\nexport { __iconNode, Send as default };\n//# sourceMappingURL=send.js.map\n","import * as React from \"react\"\nimport { CalendarIcon, X } from \"lucide-react\"\nimport { DateRange } from \"react-day-picker\"\nimport { ko } from \"date-fns/locale\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Calendar } from \"@/components/ui/calendar\"\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\"\n\ninterface DateRangePickerProps extends React.HTMLAttributes<HTMLDivElement> {\n  date?: DateRange\n  onDateChange?: (date: DateRange | undefined) => void\n  placeholder?: string\n  disabled?: boolean\n  triggerClassName?: string\n}\n\nexport function DateRangePicker({\n  className,\n  date,\n  onDateChange,\n  placeholder = \"기간을 선택하세요\",\n  disabled = false,\n  triggerClassName,\n  ...props\n}: DateRangePickerProps) {\n  const [open, setOpen] = React.useState(false)\n\n  const formatDateRange = (range: DateRange | undefined) => {\n    if (!range?.from) {\n      return placeholder\n    }\n\n    const formatDate = (date: Date) => {\n      return date.toLocaleDateString('ko-KR', {\n        year: 'numeric',\n        month: 'long',\n        day: 'numeric'\n      })\n    }\n\n    if (range.from && range.to) {\n      // 같은 달인지 확인\n      const isSameMonth = range.from.getFullYear() === range.to.getFullYear() && \n                         range.from.getMonth() === range.to.getMonth()\n      \n      if (isSameMonth) {\n        const year = range.from.getFullYear()\n        const month = range.from.toLocaleDateString('ko-KR', { month: 'long' })\n        const fromDay = range.from.getDate()\n        const toDay = range.to.getDate()\n        return `${year}년 ${month} ${fromDay}일 - ${toDay}일`\n      }\n      \n      return `${formatDate(range.from)} - ${formatDate(range.to)}`\n    }\n\n    return formatDate(range.from)\n  }\n\n  return (\n    <div className={cn(\"grid gap-2\", className)} {...props}>\n      <Popover open={open} onOpenChange={setOpen}>\n        <PopoverTrigger asChild>\n          <Button\n            id=\"date\"\n            className={cn(\n              \"button-base w-full justify-start text-left font-normal border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 transition-colors\",\n              !date && \"text-gray-500\",\n              date && \"text-gray-900\",\n              triggerClassName\n            )}\n            disabled={disabled}\n          >\n            <CalendarIcon className=\"mr-2 h-4 w-4 text-gray-400\" />\n            <span className=\"truncate\">{formatDateRange(date)}</span>\n            {date && (\n              <X \n                className=\"ml-auto h-4 w-4 text-gray-400 hover:text-gray-600 transition-colors\" \n                onClick={(e) => {\n                  e.stopPropagation()\n                  onDateChange?.(undefined)\n                  setOpen(false)\n                }}\n              />\n            )}\n          </Button>\n        </PopoverTrigger>\n        <PopoverContent className=\"w-auto p-0 shadow-lg border border-gray-200 business-radius-card\" align=\"start\">\n          <div className=\"bg-white business-radius-card overflow-hidden\">\n            <div className=\"bg-gray-50 border-b border-gray-100 px-4 py-3\">\n              <h4 className=\"text-[11px] font-semibold text-gray-900\">기간 선택</h4>\n              <p className=\"text-[10px] text-gray-500 mt-1\">시작일과 종료일을 선택하세요</p>\n            </div>\n            <div className=\"p-4\">\n              <Calendar\n                initialFocus\n                mode=\"range\"\n                defaultMonth={date?.from}\n                selected={date}\n                onSelect={(newDate) => {\n                  onDateChange?.(newDate)\n                  // 종료일이 선택되면 자동으로 팝오버 닫기\n                  if (newDate?.from && newDate?.to) {\n                    setOpen(false)\n                  }\n                }}\n                numberOfMonths={2}\n                disabled={disabled}\n                locale={ko}\n                className=\"business-radius-card\"\n                classNames={{\n                  months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n                  month: \"space-y-4\",\n                  caption: \"flex justify-center pt-1 relative items-center text-[11px] font-medium\",\n                  caption_label: \"text-[11px] font-medium text-gray-900\",\n                  nav: \"space-x-1 flex items-center\",\n                  nav_button: \"inline-flex items-center justify-center rounded-md text-[11px] font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none border border-input bg-background hover:bg-accent hover:text-accent-foreground h-6 w-6\",\n                  nav_button_previous: \"absolute left-1\",\n                  nav_button_next: \"absolute right-1\",\n                  table: \"w-full border-collapse space-y-1\",\n                  head_row: \"flex\",\n                  head_cell: \"text-gray-500 rounded-md w-7 font-normal text-[10px]\",\n                  row: \"flex w-full mt-2\",\n                  cell: \"h-7 w-7 text-center text-[11px] p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n                  day: \"inline-flex items-center justify-center rounded-md text-[11px] font-normal ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 aria-selected:opacity-100 h-7 w-7 hover:bg-gray-100 hover:text-gray-900 text-gray-900\",\n                  day_range_start: \"day-range-start bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n                  day_range_end: \"day-range-end bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n                  day_selected: \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n                  day_today: \"bg-accent text-accent-foreground font-semibold\",\n                  outside: \"!text-gray-400 !opacity-40 hover:!text-gray-500 hover:bg-gray-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30\",\n                  day_disabled: \"!text-gray-400 !opacity-40\",\n                  day_range_middle: \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n                  day_hidden: \"invisible\",\n                }}\n              />\n            </div>\n            {date && (\n              <div className=\"bg-gray-50 border-t border-gray-100 px-4 py-3\">\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"badge-text text-gray-600\">\n                    선택된 기간: {formatDateRange(date)}\n                  </span>\n                  <Button\n                    onClick={() => {\n                      onDateChange?.(undefined)\n                      setOpen(false)\n                    }}\n                    className=\"button-action-secondary\"\n                  >\n                    지우기\n                  </Button>\n                </div>\n              </div>\n            )}\n          </div>\n        </PopoverContent>\n      </Popover>\n    </div>\n  )\n}","import React, { useState, useEffect, useLayoutEffect, useRef } from 'react'\nimport { useLocation, useNavigate } from 'react-router-dom'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Textarea } from '@/components/ui/textarea'\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'\nimport { MessageCircle, Send, Calendar, Search, CheckCircle, Clock, AlertCircle, ChevronRight, ChevronLeft, ChevronDown, ChevronUp, Eye, X, Edit2, Trash2, Save, ImagePlus, Loader2, Plus } from 'lucide-react'\nimport { supportService, type SupportInquiry, type SupportAttachment, type SupportInquiryMessage, type SupportInquiryPayload } from '@/services/supportService'\nimport { createClient } from '@/lib/supabase/client'\nimport { toast } from 'sonner'\nimport { removePurchaseFromMemory, updatePurchaseInMemory, notifyCacheListeners } from '@/stores/purchaseMemoryStore'\nimport { format } from 'date-fns'\nimport { ko } from 'date-fns/locale'\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog'\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from '@/components/ui/alert-dialog'\nimport { DateRangePicker } from '@/components/ui/date-range-picker'\nimport { DatePickerPopover } from '@/components/ui/date-picker-popover'\nimport { DateRange } from 'react-day-picker'\nimport PurchaseDetailModal from '@/components/purchase/PurchaseDetailModal'\nimport ReactSelect from 'react-select'\n\ntype QuantityChangeRow = {\n  id: string\n  itemId: string\n  newQuantity: string\n}\n\ntype QuantityChangePayloadItem = {\n  item_id: string\n  line_number?: number | null\n  item_name: string\n  specification?: string | null\n  current_quantity?: number | null\n  new_quantity: number\n}\n\ntype PriceChangeType = 'unit_price' | 'amount'\n\ntype PriceChangeRow = {\n  id: string\n  itemId: string\n  changeType: PriceChangeType\n  newValue: string\n}\n\ntype PriceChangePayloadItem = {\n  item_id: string\n  line_number?: number | null\n  item_name: string\n  specification?: string | null\n  change_type: PriceChangeType\n  current_unit_price?: number | null\n  new_unit_price?: number | null\n  current_amount?: number | null\n  new_amount?: number | null\n}\n\nexport default function SupportMain() {\n  const location = useLocation()\n  const navigate = useNavigate()\n  const [inquiryType, setInquiryType] = useState('')\n  const [message, setMessage] = useState('')\n  const [loading, setLoading] = useState(false)\n  \n  // 첨부파일 관련\n  const [attachments, setAttachments] = useState<SupportAttachment[]>([])\n  const [uploadingImage, setUploadingImage] = useState(false)\n  const fileInputRef = useRef<HTMLInputElement>(null)\n  const textMeasureCanvasRef = useRef<HTMLCanvasElement | null>(null)\n  \n  // 발주요청 선택 관련\n  const [showPurchaseSelect, setShowPurchaseSelect] = useState(false)\n  const [dateRange, setDateRange] = useState<DateRange | undefined>()\n  const [purchaseRequests, setPurchaseRequests] = useState<any[]>([])\n  const [selectedPurchase, setSelectedPurchase] = useState<any>(null)\n  const [searchingPurchase, setSearchingPurchase] = useState(false)\n  const [requestedDeliveryDate, setRequestedDeliveryDate] = useState<Date | undefined>()\n  const [quantityChangeRows, setQuantityChangeRows] = useState<QuantityChangeRow[]>([])\n  const [priceChangeRows, setPriceChangeRows] = useState<PriceChangeRow[]>([])\n  const purchaseLinkedInquiryTypes = ['modify', 'delete', 'delivery_date_change', 'quantity_change', 'price_change']\n  const purchaseSelectLabel = inquiryType === 'delete' ? '삭제할 발주요청 선택' : '발주요청 선택'\n  const messageLabel = inquiryType === 'delete' ? '삭제 사유' : '내용'\n\n  // ✅ 입고 지연 알림(DeliveryDateWarningModal)에서 진입한 경우: 입고일 변경 요청으로 화면 고정\n  const [lockedInquiryType, setLockedInquiryType] = useState<string | null>(null)\n  const [lockedPurchaseId, setLockedPurchaseId] = useState<number | null>(null)\n  const [entrySource, setEntrySource] = useState<string | null>(null)\n  const [returnTo, setReturnTo] = useState<string | null>(null)\n\n  const createRowId = () => `row-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`\n  \n  // 문의 목록 관련\n  const [inquiries, setInquiries] = useState<SupportInquiry[]>([])\n  const [isAdmin, setIsAdmin] = useState<boolean | null>(null)\n  const [currentUserEmail, setCurrentUserEmail] = useState('')\n  const [currentUserId, setCurrentUserId] = useState<string>('')\n  const [currentUserRoles, setCurrentUserRoles] = useState<string[]>([])\n  const [loadingInquiries, setLoadingInquiries] = useState(true)\n  const [expandedInquiry, setExpandedInquiry] = useState<number | null>(null)\n  \n  // 모달 관련\n  const [showDetailModal, setShowDetailModal] = useState(false)\n  const [selectedInquiryDetail, setSelectedInquiryDetail] = useState<any>(null)\n  const [loadingDetail, setLoadingDetail] = useState(false)\n  const [editingItemId, setEditingItemId] = useState<string | null>(null)\n  const [editingItem, setEditingItem] = useState<any>(null)\n\n  // 전체항목 탭 상세모달(PurchaseDetailModal) 재사용\n  const [purchaseDetailModalOpen, setPurchaseDetailModalOpen] = useState(false)\n  const [purchaseDetailId, setPurchaseDetailId] = useState<number | null>(null)\n  const [deleteConfirmOpen, setDeleteConfirmOpen] = useState(false)\n  const [purchaseToDelete, setPurchaseToDelete] = useState<any>(null)\n  const [purchaseMissingOpen, setPurchaseMissingOpen] = useState(false)\n  const [purchaseMissingMessage, setPurchaseMissingMessage] = useState('발주내역이 삭제 되었거나 없습니다.')\n\n  // 채팅(대화) 드롭다운(확장 영역 내)\n  const [chatMessages, setChatMessages] = useState<SupportInquiryMessage[]>([])\n  const [chatLoading, setChatLoading] = useState(false)\n  const [chatRefreshing, setChatRefreshing] = useState(false)\n  const [chatText, setChatText] = useState('')\n  const [chatSending, setChatSending] = useState(false)\n  const chatScrollRef = useRef<HTMLDivElement>(null)\n  const chatScrollRestoreRef = useRef<{ atBottom: boolean; prevTop: number } | null>(null)\n  const chatFirstLoadInquiryIdRef = useRef<number | null>(null)\n  const chatForceBottomOnOpenRef = useRef(false)\n  const chatMessagesCacheRef = useRef<Map<number, SupportInquiryMessage[]>>(new Map())\n\n  // 초기 권한/목록 로드는 마운트 1회만 (드롭다운 토글로 재실행되면 깜빡임 발생)\n  useEffect(() => {\n    checkUserRole()\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  // 실시간 구독은 권한/사용자 정보가 준비된 후에만 세팅 (expandedInquiry 변화로는 재구독하지 않음)\n  useEffect(() => {\n    if (isAdmin === null) return\n    // 실시간 구독 설정\n    const subscription = supportService.subscribeToInquiries((payload) => {\n      const eventType = payload?.eventType as 'INSERT' | 'UPDATE' | 'DELETE' | undefined\n      const newRow = payload?.new as SupportInquiry | undefined\n      const oldRow = payload?.old as SupportInquiry | undefined\n\n      const isRelevantRow = (row?: SupportInquiry) => {\n        if (!row) return false\n        if (isAdmin) return true\n        return !!currentUserId && row.user_id === currentUserId\n      }\n\n      // 이벤트에 따라 inquiries state를 직접 갱신 (페이지 새로고침 없이 실시간 반영)\n      if (eventType === 'DELETE') {\n        const deletedId = oldRow?.id\n        if (!deletedId) return\n        setInquiries(prev => {\n          const next = prev.filter(i => i.id !== deletedId)\n          return next\n        })\n        if (expandedInquiry === deletedId) {\n          setExpandedInquiry(null)\n        }\n        return\n      }\n\n      // INSERT/UPDATE\n      const row = newRow\n      if (!row?.id) return\n\n      setInquiries(prev => {\n        // 비관리자는 내 문의만 유지\n        const relevant = isRelevantRow(row)\n        const idx = prev.findIndex(i => i.id === row.id)\n\n        // 관련 없는 row면 기존에 있던 것만 제거\n        if (!relevant) {\n          if (idx === -1) return prev\n          const next = prev.filter(i => i.id !== row.id)\n          return next\n        }\n\n        // upsert\n        const next = [...prev]\n        if (idx >= 0) {\n          next[idx] = row\n        } else {\n          next.unshift(row)\n        }\n\n        // 최신순 정렬 (created_at 내림차순)\n        next.sort((a, b) => {\n          const at = a.created_at ? new Date(a.created_at).getTime() : 0\n          const bt = b.created_at ? new Date(b.created_at).getTime() : 0\n          return bt - at\n        })\n        return next\n      })\n    })\n    \n    return () => {\n      subscription.unsubscribe()\n    }\n  }, [isAdmin, currentUserId])\n\n  // 사용자 권한 확인\n  const checkUserRole = async () => {\n    const supabase = createClient()\n    const { data: { user } } = await supabase.auth.getUser()\n    if (!user) return\n\n    setCurrentUserEmail(user.email || '')\n    setCurrentUserId(user.id)\n\n    const { data: employee } = await supabase\n      .from('employees')\n      .select('purchase_role')\n      .eq('email', user.email)\n      .single()\n\n    if (employee) {\n      const roles = Array.isArray(employee.purchase_role)\n        ? employee.purchase_role\n        : employee.purchase_role?.split(',').map((r: string) => r.trim()) || []\n      \n      setCurrentUserRoles(roles)\n      const adminStatus = roles.includes('app_admin')\n      setIsAdmin(adminStatus)\n      \n      // 권한 확인 후 바로 목록 로드\n      loadInquiriesWithRole(adminStatus)\n    }\n  }\n  \n  // 역할에 따라 문의 목록 로드 (내부 함수)\n  const loadInquiriesWithRole = async (adminStatus: boolean) => {\n    setLoadingInquiries(true)\n    \n    const result = adminStatus \n      ? await supportService.getAllInquiries()\n      : await supportService.getMyInquiries()\n    \n    \n    if (result.success) {\n      setInquiries(result.data)\n    } else {\n      toast.error(result.error || '문의 목록 로드 실패')\n    }\n    \n    setLoadingInquiries(false)\n  }\n\n  // 문의 목록 로드\n  const loadInquiries = async () => {\n    // 권한 확인이 완료되지 않았으면 대기\n    if (isAdmin === null) {\n      return;\n    }\n    \n    setLoadingInquiries(true)\n    \n    // 관리자면 모든 문의, 아니면 내 문의만\n    const result = isAdmin \n      ? await supportService.getAllInquiries()\n      : await supportService.getMyInquiries()\n    \n    \n    if (result.success) {\n      setInquiries(result.data)\n    } else {\n      toast.error(result.error || '문의 목록 로드 실패')\n    }\n    \n    setLoadingInquiries(false)\n  }\n\n  // 문의 유형 변경 시\n  useEffect(() => {\n    const needsPurchase = purchaseLinkedInquiryTypes.includes(inquiryType)\n    if (needsPurchase) {\n      setShowPurchaseSelect(true)\n    } else {\n      setShowPurchaseSelect(false)\n      setSelectedPurchase(null)\n    }\n\n    setRequestedDeliveryDate(undefined)\n    setQuantityChangeRows([])\n    setPriceChangeRows([])\n  }, [inquiryType])\n\n  // ✅ URL 파라미터 기반 진입 처리: /support?type=delivery_date_change&purchaseId=123&source=delivery-warning&returnTo=...\n  useEffect(() => {\n    const params = new URLSearchParams(location.search)\n    const typeParam = params.get('type')\n    const purchaseIdParam = params.get('purchaseId')\n    const sourceParam = params.get('source')\n    const returnToParam = params.get('returnTo')\n\n    if (returnToParam) setReturnTo(returnToParam)\n    if (sourceParam) setEntrySource(sourceParam)\n\n    // 입고 지연 알림에서만 '입고일 변경 요청'으로 고정\n    if (sourceParam === 'delivery-warning' && typeParam === 'delivery_date_change') {\n      setLockedInquiryType('delivery_date_change')\n      setInquiryType('delivery_date_change')\n    } else {\n      setLockedInquiryType(null)\n    }\n\n    if (purchaseIdParam) {\n      const n = Number(purchaseIdParam)\n      setLockedPurchaseId(Number.isFinite(n) ? n : null)\n    } else {\n      setLockedPurchaseId(null)\n    }\n  }, [location.search])\n\n  // ✅ 고정 purchaseId가 있으면 바로 상세를 불러와 자동 선택\n  useEffect(() => {\n    const run = async () => {\n      if (!lockedPurchaseId) return\n      // inquiryType이 아직 설정되기 전이면 대기\n      if (lockedInquiryType === 'delivery_date_change' && inquiryType !== 'delivery_date_change') return\n\n      const result = await supportService.getPurchaseRequestDetail(String(lockedPurchaseId))\n      if (!result.success || !result.data) {\n        toast.error(result.error || '발주요청 정보를 불러오지 못했습니다.')\n        return\n      }\n\n      setSelectedPurchase(result.data)\n      setPurchaseRequests([result.data])\n      // 날짜 입력들은 새로운 발주 선택에 맞춰 초기화\n      setRequestedDeliveryDate(undefined)\n      setQuantityChangeRows([])\n      setPriceChangeRows([])\n    }\n\n    run()\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [lockedPurchaseId, lockedInquiryType, inquiryType])\n\n  useEffect(() => {\n    setRequestedDeliveryDate(undefined)\n    setQuantityChangeRows([])\n    setPriceChangeRows([])\n  }, [selectedPurchase?.id])\n\n  useEffect(() => {\n    if (inquiryType === 'quantity_change' && quantityChangeRows.length === 0) {\n      setQuantityChangeRows([{ id: createRowId(), itemId: '', newQuantity: '' }])\n    }\n    if (inquiryType === 'price_change' && priceChangeRows.length === 0) {\n      setPriceChangeRows([{ id: createRowId(), itemId: '', changeType: 'unit_price', newValue: '' }])\n    }\n  }, [inquiryType, quantityChangeRows.length, priceChangeRows.length])\n\n  useEffect(() => {\n    if (!showPurchaseSelect) return\n    if (!dateRange?.from || !dateRange?.to) return\n    searchPurchaseRequests()\n  }, [showPurchaseSelect, dateRange?.from, dateRange?.to])\n\n  // 발주요청 검색\n  const searchPurchaseRequests = async () => {\n    setSearchingPurchase(true)\n    \n    const startDate = dateRange?.from ? dateRange.from.toISOString().split('T')[0] : undefined\n    const endDate = dateRange?.to ? dateRange.to.toISOString().split('T')[0] : undefined\n    \n    const result = await supportService.getMyPurchaseRequests(startDate, endDate)\n    \n    if (result.success) {\n      setPurchaseRequests(result.data)\n    } else {\n      toast.error(result.error || '발주요청 조회 실패')\n    }\n    \n    setSearchingPurchase(false)\n  }\n\n  // 기본 기간: 최근 2개월\n  useEffect(() => {\n    if (!dateRange) {\n      const today = new Date()\n      const from = new Date()\n      from.setMonth(from.getMonth() - 2)\n      setDateRange({ from, to: today })\n    }\n  }, [dateRange])\n\n  const purchaseOptions = [...purchaseRequests]\n    .sort((a, b) => {\n      const aTime = a.request_date || a.created_at\n      const bTime = b.request_date || b.created_at\n      const aValue = aTime ? new Date(aTime).getTime() : 0\n      const bValue = bTime ? new Date(bTime).getTime() : 0\n      return bValue - aValue\n    })\n    .map((pr) => {\n    const orderNumber = pr.purchase_order_number || '(승인대기)'\n    const vendorName = pr.vendor_name || ''\n    const firstItem = pr.purchase_request_items?.[0]?.item_name || '품목 없음'\n    const extraCount = pr.purchase_request_items?.length > 1\n      ? ` 외 ${pr.purchase_request_items.length - 1}건`\n      : ''\n    const label = `${orderNumber} · ${vendorName} · ${firstItem}${extraCount}`.trim()\n    const searchText = `${orderNumber} ${vendorName} ${pr.requester_name || ''} ${firstItem}`.toLowerCase()\n    return {\n      value: String(pr.id),\n      label,\n      data: pr,\n      searchText\n    }\n  })\n\n  const inquiryTypeOptions = [\n    { value: 'delivery_date_change', label: '입고일 변경 요청' },\n    { value: 'quantity_change', label: '수량 변경 요청' },\n    { value: 'price_change', label: '단가/합계 금액 변경 요청' },\n    { value: 'bug', label: '오류 신고' },\n    { value: 'modify', label: '수정 요청' },\n    { value: 'delete', label: '삭제 요청' },\n    { value: 'other', label: '기타 문의' }\n  ]\n\n  const selectedPurchaseItems = Array.isArray(selectedPurchase?.purchase_request_items)\n    ? [...selectedPurchase.purchase_request_items].sort((a: any, b: any) => {\n        const aLine = a.line_number ?? Number.MAX_SAFE_INTEGER\n        const bLine = b.line_number ?? Number.MAX_SAFE_INTEGER\n        return aLine - bLine\n      })\n    : []\n  const itemOptions = selectedPurchaseItems.map((item: any) => ({\n    value: String(item.id),\n    label: `${item.line_number ? `${item.line_number}.` : ''} ${item.item_name} (${item.specification || '-'})`.trim()\n  }))\n\n  const getMeasureFont = () => {\n    if (typeof document === 'undefined') {\n      return '11px Pretendard, -apple-system, BlinkMacSystemFont, \"Segoe UI\", \"Noto Sans KR\", sans-serif'\n    }\n\n    const bodyStyle = window.getComputedStyle(document.body)\n    const fontFamily = bodyStyle.fontFamily || 'Pretendard, -apple-system, BlinkMacSystemFont, \"Segoe UI\", \"Noto Sans KR\", sans-serif'\n    const fontWeight = bodyStyle.fontWeight || '400'\n    return `${fontWeight} 11px ${fontFamily}`\n  }\n\n  const measureTextWidthPx = (text: string) => {\n    if (typeof document === 'undefined') {\n      return text.length * 7\n    }\n\n    if (!textMeasureCanvasRef.current) {\n      textMeasureCanvasRef.current = document.createElement('canvas')\n    }\n\n    const context = textMeasureCanvasRef.current.getContext('2d')\n    if (!context) {\n      return text.length * 7\n    }\n\n    context.font = getMeasureFont()\n    return Math.ceil(context.measureText(text).width)\n  }\n\n  const getLabelWidthEm = (label: string, padding = 4, min = 12) =>\n    Math.max(label.length + padding, min)\n\n  const SELECT_OPTION_PADDING_PX = 24\n  const SELECT_INDICATOR_PX = 30\n  const SELECT_SCROLLBAR_PX = 14\n  const getSelectLabelMaxPx = (options: Array<{ label?: string }>) =>\n    options.reduce((max, option) => {\n      const label = option.label ?? ''\n      return Math.max(max, measureTextWidthPx(label))\n    }, 0)\n  const getSelectControlWidthPx = (options: Array<{ label?: string }>, placeholder: string) => {\n    const maxLabelPx = getSelectLabelMaxPx(options)\n    const base = Math.max(maxLabelPx, measureTextWidthPx(placeholder))\n    return Math.ceil(base + SELECT_OPTION_PADDING_PX + SELECT_INDICATOR_PX)\n  }\n  const getMenuWidthPx = (options: Array<{ label?: string }>, placeholder: string) => {\n    const maxLabelPx = getSelectLabelMaxPx(options)\n    const base = Math.max(maxLabelPx, measureTextWidthPx(placeholder))\n    return Math.ceil(base + SELECT_OPTION_PADDING_PX + SELECT_INDICATOR_PX + SELECT_SCROLLBAR_PX)\n  }\n\n  const inquiryTypePlaceholder = '문의 유형을 선택해주세요'\n  const inquiryTypeControlWidthEm = getLabelWidthEm(inquiryTypePlaceholder, 3, 14)\n  const inquiryTypeMenuWidthEm = getLabelWidthEm(\n    inquiryTypeOptions.reduce((max, option) => {\n      const label = option.label || ''\n      return label.length > max.length ? label : max\n    }, inquiryTypePlaceholder),\n    3,\n    inquiryTypeControlWidthEm\n  )\n  const purchaseSelectPlaceholder = '발주번호 선택/검색'\n  const purchaseControlWidthPx = getSelectControlWidthPx(purchaseOptions, purchaseSelectPlaceholder)\n  const purchaseMenuWidthPx = getMenuWidthPx(purchaseOptions, purchaseSelectPlaceholder)\n\n  const itemSelectPlaceholder = '품목 선택/검색'\n  const itemControlWidthPx = getSelectControlWidthPx(itemOptions, itemSelectPlaceholder) + 16\n  const itemMenuWidthPx = getMenuWidthPx(itemOptions, itemSelectPlaceholder)\n  const priceChangeTypeOptions = [\n    { value: 'unit_price', label: '단가' },\n    { value: 'amount', label: '합계액' }\n  ]\n\n  const formatNumericInput = (value: string) => {\n    if (!value) return ''\n    const numericValue = Number(value)\n    return Number.isFinite(numericValue) ? numericValue.toLocaleString('ko-KR') : value\n  }\n\n  const normalizeNumericInput = (value: string) => value.replace(/[^\\d]/g, '')\n\n  const dateRangeWidthEm = Math.max('발주요청 기간을 선택하세요'.length + 5, 22)\n\n  const getCompactSelectStyles = (controlWidthPx?: number, menuWidthPx?: number) => ({\n    control: (base: any) => ({\n      ...base,\n      minHeight: '28px',\n      height: '28px',\n      fontSize: '11px',\n      borderRadius: '8px',\n      borderColor: '#e5e7eb',\n      boxShadow: 'none'\n    }),\n    container: (base: any) => ({\n      ...base,\n      width: controlWidthPx ? `${controlWidthPx}px` : base.width,\n      maxWidth: '100%'\n    }),\n    valueContainer: (base: any) => ({\n      ...base,\n      padding: '0 8px'\n    }),\n    input: (base: any) => ({\n      ...base,\n      margin: 0,\n      padding: 0,\n      fontSize: '11px'\n    }),\n    indicatorsContainer: (base: any) => ({\n      ...base,\n      height: '28px'\n    }),\n    option: (base: any) => ({\n      ...base,\n      fontSize: '11px',\n      whiteSpace: 'nowrap',\n      overflow: 'visible',\n      textOverflow: 'clip'\n    }),\n    placeholder: (base: any) => ({\n      ...base,\n      fontSize: '11px',\n      color: '#9ca3af'\n    }),\n    singleValue: (base: any) => ({\n      ...base,\n      fontSize: '11px',\n      overflow: 'visible',\n      textOverflow: 'clip',\n      maxWidth: 'none'\n    }),\n    menu: (base: any) => ({\n      ...base,\n      width: menuWidthPx ? `${menuWidthPx}px` : base.width,\n      minWidth: menuWidthPx ? `${menuWidthPx}px` : base.minWidth,\n      maxWidth: menuWidthPx ? `${menuWidthPx}px` : '90vw'\n    }),\n    menuList: (base: any) => ({\n      ...base,\n      width: menuWidthPx ? `${menuWidthPx}px` : base.width,\n      minWidth: menuWidthPx ? `${menuWidthPx}px` : base.minWidth,\n      maxWidth: menuWidthPx ? `${menuWidthPx}px` : base.maxWidth\n    })\n  })\n\n  const addQuantityRow = () => {\n    setQuantityChangeRows(prev => [\n      ...prev,\n      { id: createRowId(), itemId: '', newQuantity: '' }\n    ])\n  }\n\n  const addPriceRow = () => {\n    setPriceChangeRows(prev => [\n      ...prev,\n      { id: createRowId(), itemId: '', changeType: 'unit_price', newValue: '' }\n    ])\n  }\n\n  const updateQuantityRow = (rowId: string, updates: Partial<QuantityChangeRow>) => {\n    setQuantityChangeRows(prev =>\n      prev.map(row => row.id === rowId ? { ...row, ...updates } : row)\n    )\n  }\n\n  const removeQuantityRow = (rowId: string) => {\n    setQuantityChangeRows(prev => prev.filter(row => row.id !== rowId))\n  }\n\n  const updatePriceRow = (rowId: string, updates: Partial<PriceChangeRow>) => {\n    setPriceChangeRows(prev =>\n      prev.map(row => row.id === rowId ? { ...row, ...updates } : row)\n    )\n  }\n\n  const removePriceRow = (rowId: string) => {\n    setPriceChangeRows(prev => prev.filter(row => row.id !== rowId))\n  }\n\n  // 문의 제출\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    // #region agent log\n    fetch('http://127.0.0.1:7242/ingest/b22edbac-a44c-4882-a88d-47f6cafc7628',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'SupportMain.tsx:handleSubmit:start',message:'submit_start',data:{inquiryType,messageLength:message.length,loading,uploadingImage,selectedPurchaseId:selectedPurchase?.id ?? null,showPurchaseSelect},timestamp:Date.now(),sessionId:'debug-session',runId:'pre-fix',hypothesisId:'H1'})}).catch(()=>{});\n    // #endregion\n    \n    if (!inquiryType || !message) {\n      // #region agent log\n      fetch('http://127.0.0.1:7242/ingest/b22edbac-a44c-4882-a88d-47f6cafc7628',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'SupportMain.tsx:handleSubmit:validation',message:'missing_required',data:{inquiryType,hasMessage:!!message},timestamp:Date.now(),sessionId:'debug-session',runId:'pre-fix',hypothesisId:'H2'})}).catch(()=>{});\n      // #endregion\n      toast.error('모든 필드를 입력해주세요.')\n      return\n    }\n    \n    const requiresPurchase = purchaseLinkedInquiryTypes.includes(inquiryType)\n    if (requiresPurchase && !selectedPurchase) {\n      // #region agent log\n      fetch('http://127.0.0.1:7242/ingest/b22edbac-a44c-4882-a88d-47f6cafc7628',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'SupportMain.tsx:handleSubmit:validation',message:'missing_purchase',data:{inquiryType,requiresPurchase},timestamp:Date.now(),sessionId:'debug-session',runId:'pre-fix',hypothesisId:'H2'})}).catch(()=>{});\n      // #endregion\n      toast.error('발주요청을 선택해주세요.')\n      return\n    }\n\n    setLoading(true)\n    \n    const subjectText = getInquiryTypeLabel(inquiryType) || inquiryType\n\n    // 발주 정보를 텍스트로 구성\n    let finalMessage = message;\n    let purchaseInfo = '';\n    let inquiryPayload: SupportInquiryPayload | null = null\n    const summaryLines: string[] = []\n\n    if (inquiryType === 'delivery_date_change') {\n      if (!requestedDeliveryDate) {\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/b22edbac-a44c-4882-a88d-47f6cafc7628',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'SupportMain.tsx:handleSubmit:validation',message:'missing_requested_delivery_date',data:{inquiryType},timestamp:Date.now(),sessionId:'debug-session',runId:'pre-fix',hypothesisId:'H2'})}).catch(()=>{});\n        // #endregion\n        toast.error('변경 입고일을 입력해주세요.')\n        setLoading(false)\n        return\n      }\n      const currentDateText = selectedPurchase?.delivery_request_date\n        ? format(new Date(selectedPurchase.delivery_request_date), 'yyyy-MM-dd')\n        : '-'\n      const requestedDateText = format(requestedDeliveryDate, 'yyyy-MM-dd')\n\n      inquiryPayload = {\n        requested_date: requestedDateText,\n        current_date: selectedPurchase?.delivery_request_date || null\n      }\n      summaryLines.push(`현재 입고요청일: ${currentDateText}`)\n      summaryLines.push(`변경 입고일: ${requestedDateText}`)\n    }\n\n    if (inquiryType === 'quantity_change') {\n      const activeRows = quantityChangeRows.filter(row => row.itemId || row.newQuantity.trim())\n      if (activeRows.length === 0) {\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/b22edbac-a44c-4882-a88d-47f6cafc7628',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'SupportMain.tsx:handleSubmit:validation',message:'missing_quantity_rows',data:{inquiryType,rows:quantityChangeRows.length},timestamp:Date.now(),sessionId:'debug-session',runId:'pre-fix',hypothesisId:'H2'})}).catch(()=>{});\n        // #endregion\n        toast.error('수량 변경할 품목을 추가해주세요.')\n        setLoading(false)\n        return\n      }\n\n      const itemsPayload: QuantityChangePayloadItem[] = []\n      for (const row of activeRows) {\n        if (!row.itemId || !row.newQuantity.trim()) {\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/b22edbac-a44c-4882-a88d-47f6cafc7628',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'SupportMain.tsx:handleSubmit:validation',message:'invalid_quantity_row',data:{itemId:row.itemId,hasQuantity:!!row.newQuantity.trim()},timestamp:Date.now(),sessionId:'debug-session',runId:'pre-fix',hypothesisId:'H2'})}).catch(()=>{});\n          // #endregion\n          toast.error('수량 변경 항목을 모두 입력해주세요.')\n          setLoading(false)\n          return\n        }\n        const newQuantity = Number(row.newQuantity)\n        if (!Number.isFinite(newQuantity)) {\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/b22edbac-a44c-4882-a88d-47f6cafc7628',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'SupportMain.tsx:handleSubmit:validation',message:'invalid_quantity_value',data:{value:row.newQuantity},timestamp:Date.now(),sessionId:'debug-session',runId:'pre-fix',hypothesisId:'H2'})}).catch(()=>{});\n          // #endregion\n          toast.error('변경 수량이 올바르지 않습니다.')\n          setLoading(false)\n          return\n        }\n\n        const targetItem = selectedPurchaseItems.find((item: any) => String(item.id) === row.itemId)\n        if (!targetItem) {\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/b22edbac-a44c-4882-a88d-47f6cafc7628',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'SupportMain.tsx:handleSubmit:validation',message:'missing_target_item',data:{itemId:row.itemId},timestamp:Date.now(),sessionId:'debug-session',runId:'pre-fix',hypothesisId:'H2'})}).catch(()=>{});\n          // #endregion\n          toast.error('선택한 품목을 찾을 수 없습니다.')\n          setLoading(false)\n          return\n        }\n\n        itemsPayload.push({\n          item_id: String(targetItem.id),\n          line_number: targetItem.line_number ?? null,\n          item_name: targetItem.item_name,\n          specification: targetItem.specification ?? null,\n          current_quantity: targetItem.quantity ?? null,\n          new_quantity: newQuantity\n        })\n        summaryLines.push(\n          `${targetItem.line_number ?? '-'}번 ${targetItem.item_name} (${targetItem.specification || '-'}) ` +\n          `${targetItem.quantity ?? 0} → ${newQuantity}`\n        )\n      }\n\n      inquiryPayload = { items: itemsPayload }\n    }\n\n    if (inquiryType === 'price_change') {\n      const activeRows = priceChangeRows.filter(row => row.itemId || row.newValue.trim())\n      if (activeRows.length === 0) {\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/b22edbac-a44c-4882-a88d-47f6cafc7628',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'SupportMain.tsx:handleSubmit:validation',message:'missing_price_rows',data:{inquiryType,rows:priceChangeRows.length},timestamp:Date.now(),sessionId:'debug-session',runId:'pre-fix',hypothesisId:'H2'})}).catch(()=>{});\n        // #endregion\n        toast.error('단가/합계 금액 변경할 품목을 추가해주세요.')\n        setLoading(false)\n        return\n      }\n\n      const itemsPayload: PriceChangePayloadItem[] = []\n      for (const row of activeRows) {\n        if (!row.itemId || !row.newValue.trim()) {\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/b22edbac-a44c-4882-a88d-47f6cafc7628',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'SupportMain.tsx:handleSubmit:validation',message:'invalid_price_row',data:{itemId:row.itemId,hasValue:!!row.newValue.trim(),changeType:row.changeType},timestamp:Date.now(),sessionId:'debug-session',runId:'pre-fix',hypothesisId:'H2'})}).catch(()=>{});\n          // #endregion\n          toast.error('단가/합계 금액 변경 항목을 모두 입력해주세요.')\n          setLoading(false)\n          return\n        }\n        const newValue = Number(row.newValue)\n        if (!Number.isFinite(newValue)) {\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/b22edbac-a44c-4882-a88d-47f6cafc7628',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'SupportMain.tsx:handleSubmit:validation',message:'invalid_price_value',data:{value:row.newValue,changeType:row.changeType},timestamp:Date.now(),sessionId:'debug-session',runId:'pre-fix',hypothesisId:'H2'})}).catch(()=>{});\n          // #endregion\n          toast.error('변경 값이 올바르지 않습니다.')\n          setLoading(false)\n          return\n        }\n\n        const targetItem = selectedPurchaseItems.find((item: any) => String(item.id) === row.itemId)\n        if (!targetItem) {\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/b22edbac-a44c-4882-a88d-47f6cafc7628',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'SupportMain.tsx:handleSubmit:validation',message:'missing_target_item_price',data:{itemId:row.itemId},timestamp:Date.now(),sessionId:'debug-session',runId:'pre-fix',hypothesisId:'H2'})}).catch(()=>{});\n          // #endregion\n          toast.error('선택한 품목을 찾을 수 없습니다.')\n          setLoading(false)\n          return\n        }\n\n        const currentUnitPrice = Number(targetItem.unit_price_value ?? targetItem.unit_price ?? 0)\n        const currentAmount = Number(targetItem.amount_value ?? (currentUnitPrice * (targetItem.quantity ?? 0)))\n        const quantityValue = Number(targetItem.quantity ?? 0)\n\n        if (row.changeType === 'amount') {\n          const newAmount = newValue\n          const newUnitPrice = quantityValue > 0 ? newAmount / quantityValue : 0\n\n          itemsPayload.push({\n            item_id: String(targetItem.id),\n            line_number: targetItem.line_number ?? null,\n            item_name: targetItem.item_name,\n            specification: targetItem.specification ?? null,\n            change_type: 'amount',\n            current_unit_price: currentUnitPrice,\n            new_unit_price: newUnitPrice,\n            current_amount: currentAmount,\n            new_amount: newAmount\n          })\n          summaryLines.push(\n            `${targetItem.line_number ?? '-'}번 ${targetItem.item_name} (${targetItem.specification || '-'}) ` +\n            `합계 ${currentAmount.toLocaleString('ko-KR')} → ${newAmount.toLocaleString('ko-KR')}`\n          )\n        } else {\n          const newUnitPrice = newValue\n          const newAmount = quantityValue * newUnitPrice\n\n          itemsPayload.push({\n            item_id: String(targetItem.id),\n            line_number: targetItem.line_number ?? null,\n            item_name: targetItem.item_name,\n            specification: targetItem.specification ?? null,\n            change_type: 'unit_price',\n            current_unit_price: currentUnitPrice,\n            new_unit_price: newUnitPrice,\n            current_amount: currentAmount,\n            new_amount: newAmount\n          })\n          summaryLines.push(\n            `${targetItem.line_number ?? '-'}번 ${targetItem.item_name} (${targetItem.specification || '-'}) ` +\n            `단가 ${currentUnitPrice.toLocaleString('ko-KR')} → ${newUnitPrice.toLocaleString('ko-KR')} ` +\n            `합계 ${currentAmount.toLocaleString('ko-KR')} → ${newAmount.toLocaleString('ko-KR')}`\n          )\n        }\n      }\n\n      inquiryPayload = { items: itemsPayload }\n    }\n\n    if (inquiryType === 'delete') {\n      inquiryPayload = { reason: message.trim() }\n    }\n    \n    if (selectedPurchase) {\n      const items = selectedPurchase.purchase_request_items || [];\n      const itemsText = items.map((item: any, index: number) => \n        `- ${item.line_number ?? index + 1}. ${item.item_name} (${item.specification || '-'}) ${item.quantity}개`\n      ).join('\\n');\n      \n      const poNumberText = selectedPurchase.purchase_order_number || '(승인대기)'\n      purchaseInfo = `발주번호: ${poNumberText}\n업체: ${selectedPurchase.vendor_name}\n요청자: ${selectedPurchase.requester_name}\n요청일: ${selectedPurchase.request_date || selectedPurchase.created_at || '-'}\n품목:\n${itemsText}`;\n    }\n\n    const messageSections = [message.trim()]\n    if (summaryLines.length > 0) {\n      messageSections.push(`[요청 상세]\\n${summaryLines.join('\\n')}`)\n    }\n    if (purchaseInfo) {\n      messageSections.push(`[관련 발주 정보]\\n${purchaseInfo}`)\n    }\n    finalMessage = messageSections.join('\\n\\n')\n\n    const result = await supportService.createInquiry({\n      inquiry_type: inquiryType as any,\n      subject: subjectText,\n      message: finalMessage,\n      purchase_request_id: selectedPurchase?.id,\n      purchase_info: purchaseInfo,\n      purchase_order_number: selectedPurchase?.purchase_order_number,\n      attachments: attachments,\n      inquiry_payload: inquiryPayload\n    })\n    // #region agent log\n    fetch('http://127.0.0.1:7242/ingest/b22edbac-a44c-4882-a88d-47f6cafc7628',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'SupportMain.tsx:handleSubmit:createInquiry',message:'submit_result',data:{success:result.success,error:result.error || null,inquiryId:result.inquiryId || null},timestamp:Date.now(),sessionId:'debug-session',runId:'pre-fix',hypothesisId:'H3'})}).catch(()=>{});\n    // #endregion\n\n    if (result.success) {\n      // ✅ 입고 지연 알림 경로로 들어온 \"입고일 변경 요청\"은 차단 해제 플래그도 함께 올림\n      if (\n        entrySource === 'delivery-warning' &&\n        inquiryType === 'delivery_date_change' &&\n        selectedPurchase?.id\n      ) {\n        try {\n          const supabase = createClient()\n          const nowIso = new Date().toISOString()\n          const { data: { user } } = await supabase.auth.getUser()\n          const userEmail = user?.email || null\n\n          // 가능한 경우 employees에서 이름 조회 (없으면 기존 selectedPurchase.requester_name fallback)\n          let byName: string | null = null\n          if (userEmail) {\n            const { data: emp } = await supabase\n              .from('employees')\n              .select('name')\n              .eq('email', userEmail)\n              .maybeSingle()\n            byName = (emp as any)?.name || null\n          }\n\n          const { error } = await supabase\n            .from('purchase_requests')\n            .update({\n              delivery_revision_requested: true,\n              delivery_revision_requested_at: nowIso,\n              delivery_revision_requested_by: byName || userEmail || 'unknown'\n            })\n            .eq('id', selectedPurchase.id)\n\n          if (!error) {\n            const updated = updatePurchaseInMemory(selectedPurchase.id, (p) => ({\n              ...p,\n              delivery_revision_requested: true,\n              delivery_revision_requested_at: nowIso,\n              delivery_revision_requested_by: byName || userEmail || 'unknown'\n            }))\n            if (updated) notifyCacheListeners()\n          }\n        } catch {\n          // 플래그 업데이트 실패는 문의 접수 자체를 막지 않음\n        }\n      }\n\n      toast.success('문의가 접수되었습니다.')\n      const createdId = result.inquiryId\n      // 폼 초기화\n      // 고정 타입이면 초기화하지 않음 (뒤로 돌아왔을 때 UX 안정)\n      if (!lockedInquiryType) setInquiryType('')\n      setMessage('')\n      setSelectedPurchase(null)\n      setPurchaseRequests([])\n      setDateRange(undefined)\n      setAttachments([])\n      // 목록 새로고침\n      loadInquiries()\n\n      // ✅ 생성된 문의를 펼쳐서(드롭다운) 바로 대화창이 보이게\n      if (createdId) {\n        setExpandedInquiry(createdId)\n      }\n\n      // ✅ returnTo가 있으면 해당 화면으로 복귀 (open redirect 방지: 내부 경로만 허용)\n      if (returnTo && returnTo.startsWith('/')) {\n        navigate(returnTo)\n      }\n    } else {\n      toast.error(result.error || '문의 접수에 실패했습니다.')\n    }\n    \n    setLoading(false)\n  }\n\n  // 이미지 첨부 핸들러\n  const handleImageSelect = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = e.target.files\n    if (!files || files.length === 0) return\n\n    // 최대 5개 제한\n    if (attachments.length >= 5) {\n      toast.error('첨부파일은 최대 5개까지 가능합니다.')\n      return\n    }\n\n    const file = files[0]\n    \n    // 파일 크기 제한 (5MB)\n    if (file.size > 5 * 1024 * 1024) {\n      toast.error('파일 크기는 5MB 이하만 가능합니다.')\n      return\n    }\n\n    // 이미지 타입 확인\n    if (!file.type.startsWith('image/')) {\n      toast.error('이미지 파일만 첨부 가능합니다.')\n      return\n    }\n\n    setUploadingImage(true)\n    const result = await supportService.uploadAttachment(file)\n    \n    if (result.success && result.data) {\n      setAttachments(prev => [...prev, result.data!])\n      toast.success('이미지가 첨부되었습니다.')\n    } else {\n      toast.error(result.error || '이미지 업로드 실패')\n    }\n    \n    setUploadingImage(false)\n    \n    // input 초기화 (같은 파일 다시 선택 가능하도록)\n    if (fileInputRef.current) {\n      fileInputRef.current.value = ''\n    }\n  }\n\n  // 첨부파일 삭제 핸들러\n  const handleRemoveAttachment = async (index: number) => {\n    const attachment = attachments[index]\n    \n    // Storage에서 삭제\n    await supportService.deleteAttachment(attachment.path)\n    \n    // state에서 제거\n    setAttachments(prev => prev.filter((_, i) => i !== index))\n    toast.success('첨부파일이 삭제되었습니다.')\n  }\n\n  // 문의 상태 업데이트 (관리자용)\n  const handleStatusUpdate = async (inquiryId: number, newStatus: 'in_progress' | 'resolved' | 'closed', resolutionNote?: string) => {\n    if (newStatus === 'resolved') {\n      // ✅ 입력 없이 완료 처리 + 사용자에게 \"완료되었습니다\" 알림 + 로그 기록(DB 함수)\n      const result = await supportService.resolveInquiry(inquiryId)\n      if (result.success) {\n        toast.success('문의가 완료 처리되었습니다.')\n        loadInquiries()\n      } else {\n        toast.error(result.error || '완료 처리 실패')\n      }\n    } else {\n      const result = await supportService.updateInquiryStatus(inquiryId, newStatus)\n      \n      if (result.success) {\n        toast.success('상태가 업데이트되었습니다.')\n        loadInquiries()\n      } else {\n        toast.error(result.error || '상태 업데이트 실패')\n      }\n    }\n  }\n\n  const expandedInquiryObj = inquiries.find((i) => i.id === expandedInquiry) || null\n\n  // 확장된 문의에 대해 메시지 로드 + 실시간 구독 + (사용자) 알림 읽음 처리\n  useEffect(() => {\n    if (!expandedInquiryObj?.id) return\n    const inquiryId = expandedInquiryObj.id!\n\n    let cancelled = false\n    // 드롭다운 첫 오픈 시에는 무조건 맨 아래로\n    chatForceBottomOnOpenRef.current = true\n    const cached = chatMessagesCacheRef.current.get(inquiryId)\n    if (cached && cached.length > 0) {\n      // 캐시가 있으면 즉시 표시(깜빡임/빈 화면 없음)\n      setChatMessages(cached)\n      setChatLoading(false)\n      setChatRefreshing(true)\n    } else {\n      // 캐시가 없으면 초기 로딩 스피너\n      setChatMessages([])\n      setChatLoading(true)\n      setChatRefreshing(false)\n    }\n\n    const load = async () => {\n      // 캐시가 있을 때는 UI를 유지한 채로 백그라운드 갱신만 표시\n      const hasCached = (chatMessagesCacheRef.current.get(inquiryId)?.length ?? 0) > 0\n      if (hasCached) setChatRefreshing(true)\n      else setChatLoading(true)\n\n      const result = await supportService.getInquiryMessages(inquiryId)\n      if (!cancelled) {\n        if (result.success) {\n          const el = chatScrollRef.current\n          const prevTop = el?.scrollTop ?? 0\n          const isFirstLoad = chatFirstLoadInquiryIdRef.current !== inquiryId\n          chatFirstLoadInquiryIdRef.current = inquiryId\n\n          const atBottom = isFirstLoad\n            ? true\n            : (el ? (el.scrollHeight - el.scrollTop - el.clientHeight) < 80 : true)\n\n          chatScrollRestoreRef.current = { atBottom, prevTop }\n\n          setChatMessages(result.data)\n          chatMessagesCacheRef.current.set(inquiryId, result.data)\n          setChatLoading(false)\n          setChatRefreshing(false)\n        } else {\n          toast.error(result.error || '대화 내용을 불러오지 못했습니다.')\n          setChatLoading(false)\n          setChatRefreshing(false)\n        }\n      }\n    }\n\n    // 사용자: 해당 문의 알림(안읽음) 처리\n    const markAsRead = async () => {\n      if (isAdmin) return\n      if (!currentUserEmail) return\n      const supabase = createClient()\n      await supabase\n        .from('notifications')\n        .update({ is_read: true, read_at: new Date().toISOString() })\n        .eq('user_email', currentUserEmail)\n        .eq('is_read', false)\n        .in('type', ['inquiry_message', 'inquiry_resolved'])\n        .eq('data->>inquiryId', String(inquiryId))\n    }\n\n    load()\n    markAsRead()\n\n    const subscription = supportService.subscribeToInquiryMessages(inquiryId, () => {\n      load()\n    })\n\n    return () => {\n      cancelled = true\n      subscription.unsubscribe()\n    }\n  }, [expandedInquiryObj?.id, isAdmin, currentUserEmail])\n\n  // chatMessages가 DOM에 반영된 직후(useLayoutEffect)에 스크롤을 보정\n  // NOTE: expandedInquiryObj 선언 이후에 위치해야 TDZ(초기화 전 참조) 에러가 나지 않음\n  useLayoutEffect(() => {\n    if (!expandedInquiryObj?.id) return\n    const el = chatScrollRef.current\n    if (!el) return\n\n    if (chatForceBottomOnOpenRef.current) {\n      el.scrollTop = el.scrollHeight\n      // 실제 콘텐츠가 렌더된 상태(또는 로딩 종료)에서만 강제 플래그를 내림\n      // 너무 일찍 false가 되면, 이후 메시지 DOM이 붙을 때 다시 맨 위로 남는 문제가 생김\n      if (chatMessages.length > 0 || !chatLoading) {\n        chatForceBottomOnOpenRef.current = false\n      }\n    } else {\n      const restore = chatScrollRestoreRef.current\n      if (!restore) return\n      if (restore.atBottom) el.scrollTop = el.scrollHeight\n      else el.scrollTop = restore.prevTop\n    }\n  }, [expandedInquiryObj?.id, chatMessages, chatLoading])\n\n  const handleSendChat = async () => {\n    if (!expandedInquiryObj?.id) return\n    if (!chatText.trim()) {\n      toast.error('메시지를 입력해주세요.')\n      return\n    }\n    if (expandedInquiryObj.status === 'resolved' || expandedInquiryObj.status === 'closed') {\n      toast.error('완료된 문의에는 메시지를 보낼 수 없습니다.')\n      return\n    }\n\n    setChatSending(true)\n    const result = await supportService.sendInquiryMessage({\n      inquiryId: expandedInquiryObj.id!,\n      message: chatText.trim(),\n      senderRole: isAdmin ? 'admin' : 'user'\n    })\n\n    if (result.success) {\n      setChatText('')\n    } else {\n      toast.error(result.error || '메시지 전송 실패')\n    }\n    setChatSending(false)\n  }\n\n  const handleResolveFromChat = async () => {\n    if (!expandedInquiryObj?.id) return\n    const result = await supportService.resolveInquiry(expandedInquiryObj.id!)\n    if (result.success) {\n      toast.success('문의가 완료 처리되었습니다.')\n      setChatText('')\n      setExpandedInquiry(null)\n      loadInquiries()\n    } else {\n      toast.error(result.error || '완료 처리 실패')\n    }\n  }\n\n  // 문의 삭제\n  const handleDeleteInquiry = async (inquiryId: number) => {\n    if (!confirm('정말로 이 문의를 삭제하시겠습니까?\\n삭제된 문의는 복구할 수 없습니다.')) return\n\n    const result = await supportService.deleteInquiry(inquiryId)\n    \n    if (result.success) {\n      toast.success('문의가 삭제되었습니다.')\n      loadInquiries()\n    } else {\n      toast.error(result.error || '문의 삭제 실패')\n    }\n  }\n\n  // 문의 상세 보기\n  const viewInquiryDetail = (inquiry: SupportInquiry) => {\n    setSelectedInquiryDetail(inquiry)\n    setShowDetailModal(true)\n  }\n\n  const openPurchaseDetailFromInquiry = async (inquiry: SupportInquiry) => {\n    try {\n      // 1) 가장 정확한 값: purchase_request_id (신규 문의부터 저장됨)\n      if (inquiry.purchase_request_id) {\n        setPurchaseDetailId(inquiry.purchase_request_id)\n        setPurchaseDetailModalOpen(true)\n        return\n      }\n\n      // 2) 과거 데이터 호환: purchase_order_number로 purchase_requests에서 id 조회\n      const orderNumber = inquiry.purchase_order_number?.trim()\n      if (!orderNumber) {\n        setPurchaseMissingMessage('발주내역이 삭제 되었거나 없습니다.')\n        setPurchaseMissingOpen(true)\n        return\n      }\n\n      const supabase = createClient()\n      const { data, error } = await supabase\n        .from('purchase_requests')\n        .select('id')\n        .eq('purchase_order_number', orderNumber)\n        .limit(1)\n        .maybeSingle()\n\n      if (error) throw error\n      if (!data?.id) {\n        setPurchaseMissingMessage('발주내역이 삭제 되었거나 없습니다.')\n        setPurchaseMissingOpen(true)\n        return\n      }\n\n      setPurchaseDetailId(data.id)\n      setPurchaseDetailModalOpen(true)\n    } catch (e) {\n      setPurchaseMissingMessage('발주내역이 삭제 되었거나 없습니다.')\n      setPurchaseMissingOpen(true)\n    }\n  }\n\n  // 품목 수정 시작\n  const startEditItem = (item: any) => {\n    setEditingItemId(item.id)\n    setEditingItem({\n      item_name: item.item_name,\n      specification: item.specification,\n      quantity: item.quantity,\n      unit_price_value: item.unit_price_value,\n      remark: item.remark\n    })\n  }\n\n  // 품목 수정 취소\n  const cancelEditItem = () => {\n    setEditingItemId(null)\n    setEditingItem(null)\n  }\n\n  // 품목 수정 저장\n  const saveEditItem = async (itemId: string) => {\n    if (!editingItem) return\n\n    const totalPrice = (editingItem.quantity || 0) * (editingItem.unit_price_value || 0)\n    const result = await supportService.updatePurchaseRequestItem(itemId, {\n      item_name: editingItem.item_name,\n      specification: editingItem.specification,\n      quantity: editingItem.quantity,\n      unit_price_value: editingItem.unit_price_value,\n      amount_value: totalPrice,\n      remark: editingItem.remark\n    })\n\n    if (result.success) {\n      toast.success('품목이 수정되었습니다.')\n      // 목록 새로고침 - 상세 정보가 있다면 다시 로드\n      if (selectedInquiryDetail?.id) {\n        // Refresh logic can be implemented here if needed\n      }\n      cancelEditItem()\n    } else {\n      toast.error(result.error || '품목 수정 실패')\n    }\n  }\n\n  // 품목 삭제\n  const deleteItem = async (itemId: string) => {\n    if (!confirm('이 품목을 삭제하시겠습니까?')) return\n\n    const result = await supportService.deletePurchaseRequestItem(itemId)\n\n    if (result.success) {\n      toast.success('품목이 삭제되었습니다.')\n      // 목록 새로고침 - 상세 정보가 있다면 다시 로드\n      if (selectedInquiryDetail?.id) {\n        // Refresh logic can be implemented here if needed\n      }\n    } else {\n      toast.error(result.error || '품목 삭제 실패')\n    }\n  }\n\n  // 발주요청 전체 삭제\n  const deletePurchaseRequest = async () => {\n    if (!selectedInquiryDetail?.id) return\n    if (!confirm('이 발주요청 전체를 삭제하시겠습니까?\\n모든 품목이 함께 삭제됩니다.')) return\n\n    const result = await supportService.deletePurchaseRequest(selectedInquiryDetail.id)\n\n    if (result.success) {\n      // 🚀 메모리 캐시에서 즉시 삭제 (실시간 반영)\n      const memoryUpdated = removePurchaseFromMemory(selectedInquiryDetail.id)\n      if (!memoryUpdated) {\n        console.warn('[deletePurchaseRequest] 메모리 캐시에서 발주서 삭제 실패', { \n          purchaseId: selectedInquiryDetail.id \n        })\n      } else {\n        console.info('✅ [deletePurchaseRequest] 메모리 캐시에서 발주서 삭제 성공', { \n          purchaseId: selectedInquiryDetail.id \n        })\n      }\n\n      toast.success('발주요청이 삭제되었습니다.')\n      setShowDetailModal(false)\n      setSelectedInquiryDetail(null)\n      // 문의 목록 새로고침\n      loadInquiries()\n    } else {\n      toast.error(result.error || '발주요청 삭제 실패')\n    }\n  }\n\n  const handleConfirmDeleteFromPurchaseModal = async () => {\n    if (!purchaseToDelete?.id) {\n      toast.error('삭제할 발주 정보가 없습니다.')\n      return\n    }\n\n    const supabase = createClient()\n\n    try {\n      const purchaseIdForDelete =\n        typeof purchaseToDelete.id === 'string' ? parseInt(purchaseToDelete.id, 10) : purchaseToDelete.id\n\n      if (!purchaseIdForDelete || Number.isNaN(purchaseIdForDelete)) {\n        toast.error('발주 ID가 올바르지 않습니다.')\n        return\n      }\n\n      // 1) 문의 기록 보존: support_inquires에서 purchase_request_id만 null로 변경\n      const { error: inquiryUpdateError } = await supabase\n        .from('support_inquires')\n        .update({ purchase_request_id: null })\n        .eq('purchase_request_id', purchaseIdForDelete)\n\n      if (inquiryUpdateError) {\n        // 여기서 막지 않고 계속 진행하면 FK로 삭제가 실패할 수 있어 중단하는 편이 안전\n        throw inquiryUpdateError\n      }\n\n      // 2) 품목 삭제\n      const { error: itemsError } = await supabase\n        .from('purchase_request_items')\n        .delete()\n        .eq('purchase_request_id', purchaseIdForDelete)\n      if (itemsError) throw itemsError\n\n      // 3) 발주요청 삭제\n      const { error: requestError } = await supabase\n        .from('purchase_requests')\n        .delete()\n        .eq('id', purchaseIdForDelete)\n      if (requestError) throw requestError\n\n      // 4) 메모리 캐시 즉시 반영\n      removePurchaseFromMemory(purchaseIdForDelete)\n\n      toast.success('발주요청이 삭제되었습니다. (문의 기록은 보존됩니다)')\n\n      // UI 정리\n      setDeleteConfirmOpen(false)\n      setPurchaseToDelete(null)\n      setPurchaseDetailModalOpen(false)\n      setPurchaseDetailId(null)\n\n      // 문의 목록 갱신\n      loadInquiries()\n    } catch (e) {\n      toast.error(e instanceof Error ? e.message : '삭제 중 오류가 발생했습니다.')\n    } finally {\n      setDeleteConfirmOpen(false)\n      setPurchaseToDelete(null)\n    }\n  }\n\n  // 상태 배지 스타일\n  const getStatusBadge = (status?: string) => {\n    switch (status) {\n      case 'open':\n        return <span className=\"badge-stats bg-yellow-100 text-yellow-800\">대기</span>\n      case 'in_progress':\n        return <span className=\"badge-stats bg-blue-100 text-blue-800\">처리중</span>\n      case 'resolved':\n        return <span className=\"badge-stats bg-green-100 text-green-800\">완료</span>\n      case 'closed':\n        return <span className=\"badge-stats bg-gray-100 text-gray-800\">종료</span>\n      default:\n        return <span className=\"badge-stats border border-gray-300 bg-white text-gray-600\">-</span>\n    }\n  }\n\n  // 문의 유형 라벨\n  const getInquiryTypeLabel = (type: string) => {\n    switch (type) {\n      case 'bug': return '오류 신고'\n      case 'modify': return '수정 요청'\n      case 'delivery_date_change': return '입고일 변경 요청'\n      case 'quantity_change': return '수량 변경 요청'\n      case 'price_change': return '단가/합계 금액 변경 요청'\n      case 'delete': return '삭제 요청'\n      case 'annual_leave': return '연차 문의'\n      case 'attendance': return '근태 문의'\n      case 'other': return '기타 문의'\n      default: return type\n    }\n  }\n\n  const renderInquiryPayloadSummary = (inquiry: SupportInquiry) => {\n    const payload = inquiry.inquiry_payload as any\n    if (!payload || typeof payload !== 'object') return null\n\n    if (inquiry.inquiry_type === 'delivery_date_change') {\n      return (\n        <div>\n          <span className=\"modal-value text-gray-700\">입고일 변경 요청:</span>\n          <div className=\"mt-1 text-gray-600\">\n            <div>현재 입고요청일: {payload.current_date || '-'}</div>\n            <div>변경 입고일: {payload.requested_date || '-'}</div>\n          </div>\n        </div>\n      )\n    }\n\n    if (inquiry.inquiry_type === 'quantity_change') {\n      const items = Array.isArray(payload.items) ? payload.items : []\n      if (items.length === 0) return null\n      return (\n        <div>\n          <span className=\"modal-value text-gray-700\">수량 변경 요청:</span>\n          <div className=\"mt-1 text-gray-600 space-y-1\">\n            {items.map((item: any, index: number) => (\n              <div key={`${item.item_id}-${index}`}>\n                {item.line_number ?? '-'}번 {item.item_name} ({item.specification || '-'}) {item.current_quantity ?? '-'} → {item.new_quantity}\n              </div>\n            ))}\n          </div>\n        </div>\n      )\n    }\n\n    if (inquiry.inquiry_type === 'price_change') {\n      const items = Array.isArray(payload.items) ? payload.items : []\n      if (items.length === 0) return null\n      return (\n        <div>\n          <span className=\"modal-value text-gray-700\">단가/합계 금액 변경 요청:</span>\n          <div className=\"mt-1 text-gray-600 space-y-1\">\n            {items.map((item: any, index: number) => (\n              <div key={`${item.item_id}-${index}`}>\n                {item.line_number ?? '-'}번 {item.item_name} ({item.specification || '-'}){' '}\n                {item.change_type === 'amount'\n                  ? `합계 ${item.current_amount ?? '-'} → ${item.new_amount ?? '-'}`\n                  : `단가 ${item.current_unit_price ?? '-'} → ${item.new_unit_price ?? '-'} 합계 ${item.current_amount ?? '-'} → ${item.new_amount ?? '-'}`}\n              </div>\n            ))}\n          </div>\n        </div>\n      )\n    }\n\n    if (inquiry.inquiry_type === 'delete') {\n      if (!payload.reason) return null\n      return (\n        <div>\n          <span className=\"modal-value text-gray-700\">삭제 사유:</span>\n          <p className=\"text-gray-600 mt-1 whitespace-pre-wrap\">{payload.reason}</p>\n        </div>\n      )\n    }\n\n    return null\n  }\n\n  // 권한 확인 중일 때 로딩 표시\n  if (isAdmin === null) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4\"></div>\n          <p className=\"text-gray-600\">권한 확인 중...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <div className=\"w-full max-w-none mx-0 px-3 sm:px-4 lg:px-5 pb-6\">\n        {/* 헤더 */}\n        <div className=\"mb-4\">\n          <h1 className=\"page-title text-gray-900\">문의하기</h1>\n          <p className=\"page-subtitle text-gray-600 mt-1\">\n            {isAdmin \n              ? '모든 문의를 관리하고 답변할 수 있습니다'\n              : '시스템 사용 중 궁금하신 점이나 개선사항을 알려주세요'}\n          </p>\n        </div>\n\n        <div className={`${isAdmin ? 'w-full' : 'grid grid-cols-1 xl:grid-cols-2 gap-4'}`}>\n          {/* 문의 작성 폼 - app_admin이 아닌 경우에만 표시 */}\n          {!isAdmin && (\n            <Card className=\"business-radius-card border border-gray-200 shadow-sm\">\n              <CardHeader className=\"pb-3 pt-4 px-4\">\n                <CardTitle className=\"section-title flex items-center gap-2 text-gray-900\">\n                  <MessageCircle className=\"w-4 h-4 text-gray-600\" />\n                  문의 내용\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"px-4 pb-4\">\n                <form onSubmit={handleSubmit} className=\"space-y-4\">\n                <div>\n                  <label className=\"block modal-label text-gray-700 mb-1\">\n                    문의 유형 <span className=\"text-red-500\">*</span>\n                  </label>\n                  {lockedInquiryType === 'delivery_date_change' ? (\n                    <div className=\"button-base business-radius-input border border-gray-300 bg-white text-gray-700 inline-flex items-center !h-7 !px-2.5 !text-[11px]\">\n                      입고일 변경 요청\n                    </div>\n                  ) : (\n                    <Select value={inquiryType} onValueChange={setInquiryType}>\n                      <SelectTrigger\n                        size=\"sm\"\n                        className=\"button-base business-radius-input border border-gray-300 bg-white text-gray-700 w-auto !h-7 !px-2.5 !text-[11px]\"\n                        style={{ width: `${inquiryTypeControlWidthEm}em`, maxWidth: '100%' }}\n                      >\n                        <SelectValue placeholder={inquiryTypePlaceholder} />\n                      </SelectTrigger>\n                      <SelectContent\n                        className=\"text-[11px] business-radius-card\"\n                        style={{ minWidth: `${inquiryTypeMenuWidthEm}em` }}\n                      >\n                        {inquiryTypeOptions.map((option) => (\n                          <SelectItem\n                            key={option.value}\n                            className=\"text-[11px] py-1.5\"\n                            value={option.value}\n                          >\n                            {option.label}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  )}\n                </div>\n\n                {/* 발주요청 선택 */}\n                {showPurchaseSelect && (\n                  <div className=\"space-y-3 p-4 bg-gray-50 business-radius-card border border-gray-200\">\n                    <div className=\"modal-section-title text-gray-900\">\n                      {purchaseSelectLabel}\n                    </div>\n\n                    {lockedInquiryType === 'delivery_date_change' && lockedPurchaseId ? (\n                      <div className=\"space-y-2\">\n                        <div className=\"card-description text-gray-600\">\n                          이 화면은 <span className=\"font-medium\">입고일 변경 요청</span> 전용입니다.\n                        </div>\n                        {selectedPurchase ? (\n                          <div className=\"px-3 py-2 bg-white border border-gray-200 business-radius-card\">\n                            <div className=\"flex items-center gap-2\">\n                              <span className=\"card-title\">{selectedPurchase.purchase_order_number || '(승인대기)'}</span>\n                              <span className=\"card-subtitle\">{selectedPurchase.vendor_name}</span>\n                              <span className=\"card-date\">\n                                {(selectedPurchase.request_date || selectedPurchase.created_at) &&\n                                  format(new Date(selectedPurchase.request_date || selectedPurchase.created_at), 'MM/dd')}\n                              </span>\n                            </div>\n                            {selectedPurchaseItems.length > 0 && (\n                              <div className=\"mt-2 space-y-1\">\n                                <div className=\"modal-label text-gray-600\">품목 상세</div>\n                                {selectedPurchaseItems.map((item: any, index: number) => (\n                                  <div key={item.id || index} className=\"flex items-center gap-2 pl-2\">\n                                    <span className=\"card-description text-gray-400\">{item.line_number ?? index + 1}.</span>\n                                    <span className=\"card-description\">{item.item_name}</span>\n                                    {item.specification && (\n                                      <span className=\"card-description text-gray-500\">({item.specification})</span>\n                                    )}\n                                    <span className=\"card-description text-gray-500\">- {item.quantity}개</span>\n                                  </div>\n                                ))}\n                              </div>\n                            )}\n                          </div>\n                        ) : (\n                          <div className=\"badge-text text-gray-500\">발주 정보를 불러오는 중…</div>\n                        )}\n                      </div>\n                    ) : (\n                      <>\n                        <div>\n                          <label className=\"modal-label text-gray-600 mb-2 block\">기간 선택</label>\n                          <DateRangePicker\n                            date={dateRange}\n                            onDateChange={setDateRange}\n                            placeholder=\"발주요청 기간을 선택하세요\"\n                            className=\"inline-grid w-fit\"\n                            style={{ width: `${dateRangeWidthEm}em`, maxWidth: '100%' }}\n                            triggerClassName=\"button-base w-fit justify-start border border-gray-300 bg-white text-gray-700 business-radius-input\"\n                          />\n                        </div>\n\n                        <div className=\"space-y-3\">\n                          <div className=\"flex items-center justify-between\">\n                            <div className=\"modal-label text-gray-600\">\n                              발주요청 선택 (총 {purchaseRequests.length}건)\n                            </div>\n                            {searchingPurchase && (\n                              <span className=\"badge-text text-gray-400\">조회 중…</span>\n                            )}\n                          </div>\n                          <ReactSelect\n                            value={purchaseOptions.find(option => option.value === String(selectedPurchase?.id)) || null}\n                            onChange={(option) => setSelectedPurchase((option as any)?.data || null)}\n                            options={purchaseOptions}\n                            placeholder=\"발주번호 선택/검색\"\n                            isSearchable\n                            isLoading={searchingPurchase}\n                            noOptionsMessage={() => '일치하는 발주가 없습니다'}\n                            filterOption={(option, inputValue) => {\n                              const keyword = inputValue.toLowerCase()\n                              const label = option.label.toLowerCase()\n                              const searchText = option.data?.searchText || ''\n                              return label.includes(keyword) || searchText.includes(keyword)\n                            }}\n                            styles={getCompactSelectStyles(purchaseControlWidthPx, purchaseMenuWidthPx)}\n                          />\n                          {!searchingPurchase && purchaseRequests.length === 0 && (\n                            <div className=\"card-description text-gray-500\">\n                              선택한 기간 내 발주요청이 없습니다.\n                            </div>\n                          )}\n\n                          {selectedPurchase && (\n                            <div className=\"px-3 py-2 bg-white border border-gray-200 business-radius-card\">\n                              <div className=\"flex items-center gap-2\">\n                                <span className=\"card-title\">{selectedPurchase.purchase_order_number || '(승인대기)'}</span>\n                                <span className=\"card-subtitle\">{selectedPurchase.vendor_name}</span>\n                                <span className=\"card-date\">\n                                  {(selectedPurchase.request_date || selectedPurchase.created_at) &&\n                                    format(new Date(selectedPurchase.request_date || selectedPurchase.created_at), 'MM/dd')}\n                                </span>\n                              </div>\n                              {selectedPurchaseItems.length > 0 && (\n                                <div className=\"mt-2 space-y-1\">\n                                  <div className=\"modal-label text-gray-600\">품목 상세</div>\n                                  {selectedPurchaseItems.map((item: any, index: number) => (\n                                    <div key={item.id || index} className=\"flex items-center gap-2 pl-2\">\n                                      <span className=\"card-description text-gray-400\">{item.line_number ?? index + 1}.</span>\n                                      <span className=\"card-description\">{item.item_name}</span>\n                                      {item.specification && (\n                                        <span className=\"card-description text-gray-500\">({item.specification})</span>\n                                      )}\n                                      <span className=\"card-description text-gray-500\">- {item.quantity}개</span>\n                                    </div>\n                                  ))}\n                                </div>\n                              )}\n                            </div>\n                          )}\n                        </div>\n                      </>\n                    )}\n                  </div>\n                )}\n\n                {inquiryType === 'delivery_date_change' && (\n                  <div className=\"space-y-3 p-4 bg-gray-50 business-radius-card border border-gray-200\">\n                    <div className=\"modal-section-title text-gray-900\">입고일 변경 요청</div>\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                      <div>\n                        <label className=\"modal-label text-gray-600 mb-1 block\">현재 입고요청일</label>\n                        <div className=\"modal-value text-gray-700\">\n                          {selectedPurchase?.delivery_request_date\n                            ? format(new Date(selectedPurchase.delivery_request_date), 'yyyy-MM-dd')\n                            : '-'}\n                        </div>\n                      </div>\n                      <div>\n                        <label className=\"modal-label text-gray-600 mb-1 block\">변경 입고일</label>\n                        <DatePickerPopover\n                          onDateSelect={(date) => setRequestedDeliveryDate(date)}\n                          placeholder=\"변경 입고일 선택\"\n                          align=\"start\"\n                          side=\"bottom\"\n                        >\n                          <Button\n                            type=\"button\"\n                            className=\"button-base w-full justify-start border border-gray-300 bg-white text-gray-700 business-radius-input\"\n                            disabled={!selectedPurchase}\n                          >\n                            <Calendar className=\"mr-2 h-4 w-4\" />\n                            {requestedDeliveryDate\n                              ? format(requestedDeliveryDate, 'yyyy-MM-dd')\n                              : '날짜 선택'}\n                          </Button>\n                        </DatePickerPopover>\n                      </div>\n                    </div>\n                  </div>\n                )}\n\n                {inquiryType === 'quantity_change' && (\n                  <div className=\"space-y-3 p-4 bg-gray-50 business-radius-card border border-gray-200\">\n                    <div className=\"modal-section-title text-gray-900\">수량 변경 요청</div>\n\n                    <div className=\"space-y-2\">\n                      {quantityChangeRows.map((row) => {\n                        const selectedItem = selectedPurchaseItems.find((item: any) => String(item.id) === row.itemId)\n\n                        return (\n                          <div key={row.id} className=\"flex flex-col sm:flex-row sm:items-center gap-2\">\n                            <div className=\"flex-1\">\n                              <ReactSelect\n                                value={itemOptions.find(option => option.value === row.itemId) || null}\n                                onChange={(option) => updateQuantityRow(row.id, { itemId: (option as any)?.value || '' })}\n                                options={itemOptions}\n                                placeholder=\"품목 선택/검색\"\n                                isSearchable\n                                isDisabled={!selectedPurchase}\n                                noOptionsMessage={() => '일치하는 품목이 없습니다'}\n                                filterOption={(option, inputValue) =>\n                                  option.label.toLowerCase().includes(inputValue.toLowerCase())\n                                }\n                                styles={getCompactSelectStyles(itemControlWidthPx, itemMenuWidthPx)}\n                              />\n                            </div>\n                            <div className=\"badge-text text-gray-600 sm:w-24 text-right\">\n                              변경 수량 :\n                            </div>\n                            <Input\n                              type=\"number\"\n                              value={row.newQuantity}\n                              onChange={(e) => updateQuantityRow(row.id, { newQuantity: e.target.value })}\n                              placeholder={`입고 수량 : ${selectedItem?.quantity ?? '-'}`}\n                              className=\"sm:w-28 business-radius-input h-7 !text-[11px] !leading-tight\"\n                              min={0}\n                              disabled={!selectedPurchase}\n                            />\n                            <button\n                              type=\"button\"\n                              onClick={() => removeQuantityRow(row.id)}\n                              className=\"button-action-danger\"\n                            >\n                              <Trash2 className=\"w-3.5 h-3.5 mr-1\" />\n                              삭제\n                            </button>\n                          </div>\n                        )\n                      })}\n                    </div>\n\n                    <button\n                      type=\"button\"\n                      onClick={addQuantityRow}\n                      className=\"button-action-secondary\"\n                      disabled={!selectedPurchase}\n                    >\n                      <Plus className=\"w-3.5 h-3.5 mr-1\" />\n                      품목 추가\n                    </button>\n                  </div>\n                )}\n\n                {inquiryType === 'price_change' && (\n                  <div className=\"space-y-3 p-4 bg-gray-50 business-radius-card border border-gray-200\">\n                    <div className=\"modal-section-title text-gray-900\">단가/합계 금액 변경 요청</div>\n\n                    <div className=\"space-y-2\">\n                      {priceChangeRows.map((row) => {\n                        const selectedItem = selectedPurchaseItems.find((item: any) => String(item.id) === row.itemId)\n                        const currentUnitPrice = Number(selectedItem?.unit_price_value ?? selectedItem?.unit_price ?? 0)\n                        const currentAmount = Number(selectedItem?.amount_value ?? (currentUnitPrice * (selectedItem?.quantity ?? 0)))\n                        const currentUnitPriceLabel = selectedItem ? currentUnitPrice.toLocaleString('ko-KR') : '-'\n                        const currentAmountLabel = selectedItem ? currentAmount.toLocaleString('ko-KR') : '-'\n                        const placeholderText = row.changeType === 'amount'\n                          ? `현재 합계액: ${currentAmountLabel}`\n                          : `현재 단가: ${currentUnitPriceLabel}`\n\n                        return (\n                          <div key={row.id} className=\"flex flex-col lg:flex-row lg:items-center gap-2\">\n                            <div className=\"flex-1\">\n                              <ReactSelect\n                                value={itemOptions.find(option => option.value === row.itemId) || null}\n                                onChange={(option) => updatePriceRow(row.id, { itemId: (option as any)?.value || '' })}\n                                options={itemOptions}\n                                placeholder=\"품목 선택/검색\"\n                                isSearchable\n                                isDisabled={!selectedPurchase}\n                                noOptionsMessage={() => '일치하는 품목이 없습니다'}\n                                filterOption={(option, inputValue) =>\n                                  option.label.toLowerCase().includes(inputValue.toLowerCase())\n                                }\n                                styles={getCompactSelectStyles(itemControlWidthPx, itemMenuWidthPx)}\n                              />\n                            </div>\n                            <div className=\"flex items-center gap-2\">\n                              <span className=\"badge-text text-gray-600\">변경 요청</span>\n                              <Select\n                                value={row.changeType}\n                                onValueChange={(value) =>\n                                  updatePriceRow(row.id, { changeType: value as PriceChangeType, newValue: '' })\n                                }\n                                disabled={!selectedPurchase}\n                              >\n                                <SelectTrigger\n                                  size=\"sm\"\n                                  className=\"button-base business-radius-input border border-gray-300 bg-white text-gray-700 w-auto !h-7 !px-2.5 !text-[11px]\"\n                                >\n                                  <SelectValue />\n                                </SelectTrigger>\n                                <SelectContent className=\"text-[11px] business-radius-card\">\n                                  {priceChangeTypeOptions.map((option) => (\n                                    <SelectItem\n                                      key={option.value}\n                                      className=\"text-[11px] py-1.5\"\n                                      value={option.value}\n                                    >\n                                      {option.label}\n                                    </SelectItem>\n                                  ))}\n                                </SelectContent>\n                              </Select>\n                            </div>\n                            <Input\n                              type=\"text\"\n                              inputMode=\"numeric\"\n                              value={formatNumericInput(row.newValue)}\n                              onChange={(e) => updatePriceRow(row.id, { newValue: normalizeNumericInput(e.target.value) })}\n                              placeholder={placeholderText}\n                              className=\"lg:w-40 business-radius-input h-7 !text-[11px] !leading-tight\"\n                              min={0}\n                              disabled={!selectedPurchase}\n                            />\n                            <button\n                              type=\"button\"\n                              onClick={() => removePriceRow(row.id)}\n                              className=\"button-action-danger\"\n                            >\n                              <Trash2 className=\"w-3.5 h-3.5 mr-1\" />\n                              삭제\n                            </button>\n                          </div>\n                        )\n                      })}\n                    </div>\n\n                    <button\n                      type=\"button\"\n                      onClick={addPriceRow}\n                      className=\"button-action-secondary\"\n                      disabled={!selectedPurchase}\n                    >\n                      <Plus className=\"w-3.5 h-3.5 mr-1\" />\n                      품목 추가\n                    </button>\n                  </div>\n                )}\n\n                <div>\n                  <label className=\"block modal-label text-gray-700 mb-1\">\n                    {messageLabel} <span className=\"text-red-500\">*</span>\n                  </label>\n                  <Textarea\n                    value={message}\n                    onChange={(e) => setMessage(e.target.value)}\n                    placeholder={inquiryType === 'delete' ? '삭제 사유를 입력해주세요' : '문의 내용을 자세히 입력해주세요'}\n                    rows={6}\n                    maxLength={1000}\n                    className=\"business-radius-input text-[11px]\"\n                  />\n                  <p className=\"badge-text text-gray-500 mt-1\">\n                    {message.length}/1000\n                  </p>\n                </div>\n\n                {/* 사진 첨부 영역 */}\n                <div>\n                  <label className=\"block modal-label text-gray-700 mb-2\">\n                    사진 첨부 <span className=\"badge-text text-gray-400\">(선택, 최대 5개)</span>\n                  </label>\n                  \n                  {/* 첨부된 이미지 미리보기 */}\n                  {attachments.length > 0 && (\n                    <div className=\"flex flex-wrap gap-2 mb-3\">\n                      {attachments.map((attachment, index) => (\n                        <div key={index} className=\"relative group\">\n                          <img\n                            src={attachment.url}\n                            alt={attachment.name}\n                            className=\"w-20 h-20 object-cover business-radius-card border border-gray-200\"\n                          />\n                          <button\n                            type=\"button\"\n                            onClick={() => handleRemoveAttachment(index)}\n                            className=\"button-base absolute -top-2 -right-2 bg-red-500 text-white business-radius-badge opacity-0 group-hover:opacity-100 transition-opacity\"\n                            title=\"삭제\"\n                          >\n                            <X className=\"w-3 h-3\" />\n                          </button>\n                          <p className=\"text-[10px] text-gray-500 mt-1 truncate w-20 text-center\">\n                            {attachment.name}\n                          </p>\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                  \n                  {/* 이미지 추가 버튼 */}\n                  {attachments.length < 5 && (\n                    <div className=\"flex items-center gap-2\">\n                      <input\n                        ref={fileInputRef}\n                        type=\"file\"\n                        accept=\"image/*\"\n                        onChange={handleImageSelect}\n                        className=\"hidden\"\n                      />\n                      <button\n                        type=\"button\"\n                        onClick={() => fileInputRef.current?.click()}\n                        disabled={uploadingImage}\n                        className=\"button-action-secondary disabled:opacity-50 disabled:cursor-not-allowed\"\n                      >\n                        {uploadingImage ? (\n                          <>\n                            <Loader2 className=\"w-3.5 h-3.5 animate-spin\" />\n                            업로드 중...\n                          </>\n                        ) : (\n                          <>\n                            <ImagePlus className=\"w-3.5 h-3.5\" />\n                            사진 추가\n                          </>\n                        )}\n                      </button>\n                      <span className=\"badge-text text-gray-400\">\n                        {attachments.length}/5\n                      </span>\n                    </div>\n                  )}\n                </div>\n\n                <div className=\"flex justify-end\">\n                  <button\n                    type=\"submit\"\n                    className=\"button-action-primary\"\n                    disabled={loading || uploadingImage}\n                    onClick={() => {\n                      // #region agent log\n                      fetch('http://127.0.0.1:7242/ingest/b22edbac-a44c-4882-a88d-47f6cafc7628',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'SupportMain.tsx:submitButton:onClick',message:'submit_click',data:{disabled:loading || uploadingImage},timestamp:Date.now(),sessionId:'debug-session',runId:'pre-fix',hypothesisId:'H1'})}).catch(()=>{});\n                      // #endregion\n                    }}\n                  >\n                    {loading ? (\n                      <>\n                        <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2\" />\n                        전송 중...\n                      </>\n                    ) : (\n                      <>\n                        <Send className=\"w-4 h-4 mr-2\" />\n                        문의 보내기\n                      </>\n                    )}\n                  </button>\n                </div>\n              </form>\n            </CardContent>\n          </Card>\n          )}\n\n          {/* 문의 목록 */}\n          <Card className=\"business-radius-card border border-gray-200 shadow-sm\">\n            <CardHeader className=\"pb-3 pt-4 px-4\">\n              <CardTitle className=\"section-title flex items-center justify-between text-gray-900\">\n                <span className=\"flex items-center gap-2\">\n                  <AlertCircle className=\"w-4 h-4 text-orange-500\" />\n                  {isAdmin ? '전체 문의 목록' : '내 문의 내역'}\n                </span>\n                <span className=\"badge-stats border border-gray-300 bg-white text-gray-600\">\n                  {inquiries.length}건\n                </span>\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"px-4 pb-4\">\n              {loadingInquiries ? (\n                <div className=\"flex items-center justify-center py-8\">\n                  <div className=\"w-6 h-6 border-2 border-gray-300 border-t-transparent rounded-full animate-spin\" />\n                </div>\n              ) : inquiries.length === 0 ? (\n                <div className=\"text-center py-8 text-gray-500\">\n                  <MessageCircle className=\"w-10 h-10 mx-auto mb-3 text-gray-300\" />\n                  <p className=\"card-description text-gray-500\">문의 내역이 없습니다</p>\n                </div>\n              ) : (\n                <div className=\"space-y-2 max-h-[600px] overflow-y-auto\">\n                  {inquiries.map((inquiry) => (\n                    <div key={inquiry.id!} className=\"border border-gray-200 business-radius-card overflow-hidden bg-white\">\n                      {/* 문의 요약 (한 줄) */}\n                      <div \n                        className=\"px-4 py-1.5 hover:bg-gray-50 transition-colors cursor-pointer\"\n                        onClick={() => {\n                          setExpandedInquiry(expandedInquiry === inquiry.id ? null : inquiry.id!)\n                        }}\n                      >\n                        <div className=\"flex items-center justify-between gap-2\">\n                          <div className=\"flex items-center gap-2 flex-1 min-w-0 flex-nowrap\">\n                            <span className=\"badge-stats border border-gray-300 bg-white text-gray-600 whitespace-nowrap flex-shrink-0\">\n                              {getInquiryTypeLabel(inquiry.inquiry_type)}\n                            </span>\n                            <span className=\"flex-shrink-0\">{getStatusBadge(inquiry.status)}</span>\n                            {inquiry.purchase_order_number ? (\n                              <button\n                                type=\"button\"\n                                className=\"card-title truncate flex-1 min-w-0 text-blue-600 hover:underline text-left\"\n                                onClick={(e) => {\n                                  e.stopPropagation()\n                                  openPurchaseDetailFromInquiry(inquiry)\n                                }}\n                                title=\"발주 상세 열기\"\n                              >\n                                {inquiry.purchase_order_number}\n                              </button>\n                            ) : (\n                              <span className=\"card-title truncate flex-1 min-w-0\">\n                                {inquiry.subject}\n                              </span>\n                            )}\n                            {isAdmin && (\n                              <span className=\"badge-text text-gray-500 whitespace-nowrap flex-shrink-0\">\n                                {inquiry.user_name || inquiry.user_email}\n                              </span>\n                            )}\n                            <span className=\"badge-text text-gray-400 ml-auto whitespace-nowrap flex-shrink-0\">\n                              {inquiry.created_at && format(new Date(inquiry.created_at), 'MM/dd HH:mm')}\n                            </span>\n                          </div>\n                          <div className=\"flex items-center gap-1 flex-shrink-0\">\n                            {isAdmin && inquiry.status === 'open' && (\n                              <button\n                                type=\"button\"\n                                onClick={(e) => {\n                                  e.stopPropagation()\n                                  handleStatusUpdate(inquiry.id!, 'in_progress')\n                                }}\n                                className=\"button-waiting-active\"\n                              >\n                                처리중\n                              </button>\n                            )}\n                            {isAdmin && (inquiry.status === 'open' || inquiry.status === 'in_progress') && (\n                              <button\n                                type=\"button\"\n                                onClick={(e) => {\n                                  e.stopPropagation()\n                                  handleStatusUpdate(inquiry.id!, 'resolved')\n                                }}\n                                className=\"button-action-success\"\n                              >\n                                완료\n                              </button>\n                            )}\n                            {/* 삭제 버튼 - 관리자는 모든 문의 삭제 가능, 일반 사용자는 본인의 open 상태만 */}\n                            {(isAdmin || (inquiry.status === 'open' && !inquiry.resolution_note && inquiry.user_email === currentUserEmail)) && (\n                              <button\n                                type=\"button\"\n                                onClick={(e) => {\n                                  e.stopPropagation()\n                                  handleDeleteInquiry(inquiry.id!)\n                                }}\n                                className=\"button-base border border-red-200 bg-white text-red-600 hover:bg-red-50\"\n                                title=\"문의 삭제\"\n                              >\n                                <Trash2 className=\"w-3.5 h-3.5\" />\n                              </button>\n                            )}\n                            <button\n                              type=\"button\"\n                              className=\"button-action-secondary\"\n                            >\n                              {expandedInquiry === inquiry.id ? (\n                                <ChevronUp className=\"w-4 h-4\" />\n                              ) : (\n                                <ChevronDown className=\"w-4 h-4\" />\n                              )}\n                            </button>\n                          </div>\n                        </div>\n                      </div>\n                      \n                      {/* 상세 내역 */}\n                      {expandedInquiry === inquiry.id && (\n                        <div className=\"px-3 py-3 bg-gray-50 border-t\">\n                          <div className=\"space-y-2\">\n                            <div>\n                              <span className=\"modal-value text-gray-700\">내용:</span>\n                              <p className=\"card-description text-gray-600 mt-1 whitespace-pre-wrap\">{inquiry.message}</p>\n                            </div>\n                            {renderInquiryPayloadSummary(inquiry)}\n                            {inquiry.handled_by && (\n                              <div>\n                                <span className=\"modal-value text-gray-700\">처리자:</span>\n                                <span className=\"text-green-600 ml-2\">\n                                  {inquiry.handled_by}\n                                  {inquiry.processed_at && ` (${format(new Date(inquiry.processed_at), 'yyyy-MM-dd HH:mm')})`}\n                                </span>\n                              </div>\n                            )}\n                            {/* 첨부 이미지 */}\n                            {inquiry.attachments && inquiry.attachments.length > 0 && (\n                              <div>\n                                <span className=\"modal-value text-gray-700\">첨부 이미지:</span>\n                                <div className=\"flex flex-wrap gap-2 mt-2\">\n                                  {inquiry.attachments.map((attachment, index) => (\n                                    <a\n                                      key={index}\n                                      href={attachment.url}\n                                      target=\"_blank\"\n                                      rel=\"noopener noreferrer\"\n                                      className=\"block\"\n                                      onClick={(e) => e.stopPropagation()}\n                                    >\n                                      <img\n                                        src={attachment.url}\n                                        alt={attachment.name}\n                                        className=\"w-24 h-24 object-cover business-radius-card border border-gray-200 hover:border-blue-400 transition-colors cursor-pointer\"\n                                      />\n                                    </a>\n                                  ))}\n                                </div>\n                              </div>\n                            )}\n\n                            {/* 대화(드롭다운) */}\n                            <div className=\"mt-3 border-t pt-3\">\n                              <div className=\"flex items-center justify-between\">\n                                <div className=\"modal-value text-gray-800\">대화</div>\n                                {isAdmin && inquiry.status !== 'resolved' && inquiry.status !== 'closed' && (\n                                  <button\n                                    type=\"button\"\n                                    onClick={(e) => {\n                                      e.stopPropagation()\n                                      handleResolveFromChat()\n                                    }}\n                                    className=\"button-action-success\"\n                                  >\n                                    완료\n                                  </button>\n                                )}\n                              </div>\n\n                              <div className=\"mt-2 border border-gray-200 business-radius-card bg-white relative\">\n                                {chatRefreshing && (\n                                  <div\n                                    className=\"absolute top-2 right-2 badge-text text-gray-400 bg-white/80 backdrop-blur px-2 py-1 business-radius-badge border pointer-events-none\"\n                                    aria-hidden=\"true\"\n                                  >\n                                    업데이트 중…\n                                  </div>\n                                )}\n                                <div ref={chatScrollRef} className=\"max-h-[260px] overflow-y-auto p-3 space-y-2\">\n                                  {chatLoading && chatMessages.length === 0 ? (\n                                    <div className=\"flex items-center justify-center py-8\">\n                                      <div className=\"w-6 h-6 border-2 border-gray-300 border-t-transparent rounded-full animate-spin\" />\n                                    </div>\n                                  ) : chatMessages.length === 0 ? (\n                                    <div className=\"text-center text-gray-500 py-8 card-description\">\n                                      대화 내용이 없습니다.\n                                    </div>\n                                  ) : (\n                                    chatMessages.map((m) => {\n                                      const isSystem = m.sender_role === 'system'\n                                      const isMine = !isSystem && m.sender_email === currentUserEmail\n                                      return (\n                                        <div key={m.id} className={isSystem ? 'text-center' : `flex ${isMine ? 'justify-end' : 'justify-start'}`}>\n                                          <div className={isSystem ? 'inline-block badge-text text-gray-500 px-3 py-1 business-radius-badge bg-gray-50 border' : `max-w-[80%] business-radius-card px-3 py-2 ${isMine ? 'bg-blue-600 text-white' : 'bg-gray-50 border text-gray-800'}`}>\n                                            {!isSystem && (\n                                              <div className={`badge-text mb-1 ${isMine ? 'text-white/80' : 'text-gray-500'}`}>\n                                                {m.sender_role === 'admin' ? '관리자' : '문의자'}\n                                                {m.created_at && ` · ${format(new Date(m.created_at), 'MM/dd HH:mm')}`}\n                                              </div>\n                                            )}\n                                            <div className=\"whitespace-pre-wrap card-description\">{m.message}</div>\n                                            {m.attachments && m.attachments.length > 0 && (\n                                              <div className=\"flex flex-wrap gap-2 mt-2\">\n                                                {m.attachments.map((a, idx) => (\n                                                  <a\n                                                    key={idx}\n                                                    href={a.url}\n                                                    target=\"_blank\"\n                                                    rel=\"noopener noreferrer\"\n                                                    className=\"block\"\n                                                    onClick={(e) => e.stopPropagation()}\n                                                  >\n                                                    <img\n                                                      src={a.url}\n                                                      alt={a.name}\n                                                      className=\"w-20 h-20 object-cover business-radius-card border\"\n                                                    />\n                                                  </a>\n                                                ))}\n                                              </div>\n                                            )}\n                                          </div>\n                                        </div>\n                                      )\n                                    })\n                                  )}\n                                </div>\n\n                                <div className=\"border-t p-2\">\n                                  {(inquiry.status === 'resolved' || inquiry.status === 'closed') ? (\n                                    <div className=\"card-description text-gray-500 text-center py-1\">\n                                      완료된 문의입니다. 추가 대화가 필요하면 새 문의를 등록해주세요.\n                                    </div>\n                                  ) : (\n                                    <div className=\"flex items-end gap-2\">\n                                      <Textarea\n                                        value={chatText}\n                                        onChange={(e) => setChatText(e.target.value)}\n                                        placeholder=\"메시지를 입력하세요\"\n                                        rows={2}\n                                        maxLength={1000}\n                                        disabled={chatSending}\n                                        onClick={(e) => e.stopPropagation()}\n                                        className=\"business-radius-input text-[11px]\"\n                                      />\n                                      <button\n                                        type=\"button\"\n                                        onClick={(e) => {\n                                          e.stopPropagation()\n                                          handleSendChat()\n                                        }}\n                                        disabled={chatSending || !chatText.trim()}\n                                        className=\"button-action-primary disabled:opacity-50 disabled:cursor-not-allowed\"\n                                      >\n                                        {chatSending ? '전송중' : '전송'}\n                                      </button>\n                                    </div>\n                                  )}\n                                </div>\n                              </div>\n                            </div>\n                          </div>\n                        </div>\n                      )}\n                    </div>\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n\n      {/* 발주요청 상세 모달 */}\n      <Dialog open={showDetailModal} onOpenChange={setShowDetailModal}>\n        <DialogContent className=\"max-w-6xl max-h-[90vh] overflow-y-auto business-radius-modal\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center justify-between modal-title text-gray-900\">\n              <div className=\"flex items-center gap-2\">\n                <span>발주요청 상세</span>\n                {selectedInquiryDetail?.purchase_order_number && (\n                  <span className=\"badge-stats border border-gray-300 bg-white text-gray-600 font-normal\">\n                    {selectedInquiryDetail.purchase_order_number}\n                  </span>\n                )}\n              </div>\n              {isAdmin && selectedInquiryDetail && (\n                <Button\n                  onClick={deletePurchaseRequest}\n                  className=\"button-action-danger\"\n                >\n                  <Trash2 className=\"w-4 h-4 mr-1\" />\n                  전체 삭제\n                </Button>\n              )}\n            </DialogTitle>\n          </DialogHeader>\n          \n          {loadingDetail ? (\n            <div className=\"flex items-center justify-center py-8\">\n              <div className=\"w-6 h-6 border-2 border-gray-300 border-t-transparent rounded-full animate-spin\" />\n            </div>\n          ) : selectedInquiryDetail && (\n            <div className=\"space-y-6\">\n              {/* 기본 정보 */}\n              <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 p-4 bg-gray-50 border border-gray-200 business-radius-card\">\n                <div>\n                  <span className=\"modal-label text-gray-500\">발주번호</span>\n                  <p className=\"modal-value mt-1\">{selectedInquiryDetail.purchase_order_number || 'N/A'}</p>\n                </div>\n                <div>\n                  <span className=\"modal-label text-gray-500\">업체명</span>\n                  <p className=\"modal-value mt-1\">{selectedInquiryDetail.vendor_name}</p>\n                </div>\n                <div>\n                  <span className=\"modal-label text-gray-500\">요청자</span>\n                  <p className=\"modal-value mt-1\">{selectedInquiryDetail.requester_name}</p>\n                </div>\n                <div>\n                  <span className=\"modal-label text-gray-500\">요청일</span>\n                  <p className=\"modal-value mt-1\">\n                    {selectedInquiryDetail.request_date && \n                      format(new Date(selectedInquiryDetail.request_date), 'yyyy-MM-dd')}\n                  </p>\n                </div>\n              </div>\n\n              {/* 품목 목록 - 개선된 디자인 */}\n              <div>\n                <h3 className=\"modal-section-title mb-3\">품목 상세</h3>\n                <div className=\"border border-gray-200 business-radius-card overflow-x-auto\">\n                  <table className=\"w-full\">\n                    <thead className=\"bg-gray-50 border-b\">\n                      <tr>\n                        <th className=\"text-left badge-text modal-value text-gray-700 px-3 py-3 w-12\">번호</th>\n                        <th className=\"text-left badge-text modal-value text-gray-700 px-3 py-3 min-w-[180px]\">품명</th>\n                        <th className=\"text-left badge-text modal-value text-gray-700 px-3 py-3 min-w-[150px]\">규격</th>\n                        <th className=\"text-center badge-text modal-value text-gray-700 px-3 py-3 w-20\">수량</th>\n                        <th className=\"text-right badge-text modal-value text-gray-700 px-3 py-3 w-28\">단가</th>\n                        <th className=\"text-right badge-text modal-value text-gray-700 px-3 py-3 w-32\">금액</th>\n                        <th className=\"text-left badge-text modal-value text-gray-700 px-3 py-3 min-w-[150px]\">비고</th>\n                        <th className=\"text-center badge-text modal-value text-gray-700 px-3 py-3 w-16\">링크</th>\n                        {isAdmin && <th className=\"text-center badge-text modal-value text-gray-700 px-3 py-3 w-24\">작업</th>}\n                      </tr>\n                    </thead>\n                    <tbody className=\"divide-y divide-gray-200\">\n                      {selectedInquiryDetail.purchase_request_items?.map((item: any, index: number) => (\n                        <tr key={item.id} className=\"hover:bg-gray-50 transition-colors\">\n                          <td className=\"px-3 py-3 text-center modal-value text-gray-600\">\n                            {item.line_number || index + 1}\n                          </td>\n                          <td className=\"px-3 py-3\">\n                            {editingItemId === item.id ? (\n                              <Input\n                                value={editingItem?.item_name || ''}\n                                onChange={(e) => setEditingItem({...editingItem, item_name: e.target.value})}\n                                className=\"business-radius-input h-7 text-[11px] w-full\"\n                                autoFocus\n                              />\n                            ) : (\n                              <span className=\"modal-value text-gray-900\">{item.item_name}</span>\n                            )}\n                          </td>\n                          <td className=\"px-3 py-3\">\n                            {editingItemId === item.id ? (\n                              <Input\n                                value={editingItem?.specification || ''}\n                                onChange={(e) => setEditingItem({...editingItem, specification: e.target.value})}\n                                className=\"business-radius-input h-7 text-[11px] w-full\"\n                              />\n                            ) : (\n                              <span className=\"text-gray-600\">{item.specification || '-'}</span>\n                            )}\n                          </td>\n                          <td className=\"text-center px-3 py-3\">\n                            {editingItemId === item.id ? (\n                              <Input\n                                type=\"number\"\n                                value={editingItem?.quantity || ''}\n                                onChange={(e) => setEditingItem({...editingItem, quantity: parseInt(e.target.value)})}\n                                className=\"business-radius-input h-7 text-[11px] text-center w-full\"\n                              />\n                            ) : (\n                              <span className=\"modal-value\">{item.quantity}</span>\n                            )}\n                          </td>\n                          <td className=\"text-right px-3 py-3\">\n                            {editingItemId === item.id ? (\n                              <Input\n                                type=\"number\"\n                                value={editingItem?.unit_price_value || ''}\n                                onChange={(e) => setEditingItem({...editingItem, unit_price_value: parseInt(e.target.value)})}\n                                className=\"business-radius-input h-7 text-[11px] text-right w-full\"\n                              />\n                            ) : (\n                              <span className=\"modal-value\">\n                                {item.unit_price_value ? `${parseFloat(item.unit_price_value).toLocaleString()}` : '-'}\n                              </span>\n                            )}\n                          </td>\n                          <td className=\"text-right px-3 py-3\">\n                            {editingItemId === item.id ? (\n                              <span className=\"font-semibold text-blue-600\">\n                                {((editingItem?.quantity || 0) * (editingItem?.unit_price_value || 0)).toLocaleString()}\n                              </span>\n                            ) : (\n                              <span className=\"font-semibold text-blue-600\">\n                                {item.amount_value ? `${parseFloat(item.amount_value).toLocaleString()}` : '-'}\n                              </span>\n                            )}\n                          </td>\n                          <td className=\"px-3 py-3\">\n                            {editingItemId === item.id ? (\n                              <Textarea\n                                value={editingItem?.remark || ''}\n                                onChange={(e) => setEditingItem({...editingItem, remark: e.target.value})}\n                                className=\"business-radius-input h-7 text-[11px] w-full resize-none\"\n                                rows={1}\n                              />\n                            ) : (\n                              <span className=\"text-gray-600 badge-text\">{item.remark || '-'}</span>\n                            )}\n                          </td>\n                          <td className=\"text-center px-3 py-3\">\n                            {item.link ? (\n                              <a \n                                href={item.link} \n                                target=\"_blank\" \n                                rel=\"noopener noreferrer\" \n                                className=\"inline-flex items-center justify-center w-8 h-8 business-radius-badge hover:bg-blue-50 text-blue-600\"\n                              >\n                                <Eye className=\"w-4 h-4\" />\n                              </a>\n                            ) : (\n                              <span className=\"text-gray-400\">-</span>\n                            )}\n                          </td>\n                          {isAdmin && (\n                            <td className=\"text-center px-3 py-3\">\n                              {editingItemId === item.id ? (\n                                <div className=\"flex justify-center gap-1\">\n                                  <Button\n                                    onClick={() => saveEditItem(item.id)}\n                                      className=\"button-action-success\"\n                                  >\n                                    <Save className=\"w-4 h-4 mr-1\" />\n                                    저장\n                                  </Button>\n                                  <Button\n                                    onClick={cancelEditItem}\n                                      className=\"button-action-secondary\"\n                                  >\n                                    취소\n                                  </Button>\n                                </div>\n                              ) : (\n                                <div className=\"flex justify-center gap-1\">\n                                  <Button\n                                    onClick={() => startEditItem(item)}\n                                      className=\"button-action-secondary\"\n                                  >\n                                    <Edit2 className=\"w-4 h-4 text-blue-600\" />\n                                  </Button>\n                                  <Button\n                                    onClick={() => deleteItem(item.id)}\n                                      className=\"button-action-danger\"\n                                  >\n                                    <Trash2 className=\"w-4 h-4 text-red-600\" />\n                                  </Button>\n                                </div>\n                              )}\n                            </td>\n                          )}\n                        </tr>\n                      ))}\n                    </tbody>\n                    <tfoot className=\"bg-gray-50 border-t-2\">\n                      <tr>\n                        <td colSpan={5} className=\"modal-value text-right px-3 py-3\">\n                          합계\n                        </td>\n                        <td className=\"modal-value text-right px-3 py-3 text-blue-600\">\n                          {selectedInquiryDetail.purchase_request_items\n                            ?.reduce((sum: number, item: any) => sum + (parseFloat(item.amount_value) || 0), 0)\n                            .toLocaleString()}\n                        </td>\n                        <td colSpan={isAdmin ? 3 : 2} className=\"px-3 py-3\"></td>\n                      </tr>\n                    </tfoot>\n                  </table>\n                </div>\n              </div>\n\n              {/* 비고 */}\n              {selectedInquiryDetail.notes && (\n                <div>\n                  <h3 className=\"modal-section-title mb-2\">비고</h3>\n                  <p className=\"card-description text-gray-600 p-3 bg-gray-50 border border-gray-200 business-radius-card\">\n                    {selectedInquiryDetail.notes}\n                  </p>\n                </div>\n              )}\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      {/* 전체항목 탭 상세모달(재사용) */}\n      <PurchaseDetailModal\n        purchaseId={purchaseDetailId}\n        isOpen={purchaseDetailModalOpen}\n        onClose={() => {\n          setPurchaseDetailModalOpen(false)\n          setPurchaseDetailId(null)\n        }}\n        currentUserRoles={currentUserRoles}\n        activeTab=\"done\"\n        onDelete={(purchase) => {\n          setPurchaseToDelete(purchase)\n          setDeleteConfirmOpen(true)\n        }}\n      />\n\n      {/* 삭제 확인 다이얼로그 (PurchaseDetailModal 연동) */}\n      <AlertDialog\n        open={deleteConfirmOpen}\n        onOpenChange={(open) => {\n          setDeleteConfirmOpen(open)\n          if (!open) setPurchaseToDelete(null)\n        }}\n      >\n        <AlertDialogContent className=\"business-radius-modal\">\n          <AlertDialogHeader>\n            <AlertDialogTitle className=\"modal-title\">발주요청 내역 삭제</AlertDialogTitle>\n            <AlertDialogDescription>\n              발주요청번호 <strong>{purchaseToDelete?.purchase_order_number || '알 수 없음'}</strong>를 삭제하시겠습니까?\n              <br />\n              이 작업은 되돌릴 수 없습니다.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel className=\"button-action-secondary\">취소</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={handleConfirmDeleteFromPurchaseModal}\n              className=\"button-action-danger\"\n            >\n              삭제\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n\n      {/* 삭제/없음 안내 모달 (문의에서 발주를 못 찾는 경우) */}\n      <Dialog open={purchaseMissingOpen} onOpenChange={setPurchaseMissingOpen}>\n        <DialogContent\n          showCloseButton={false}\n          maxWidth=\"sm:max-w-md\"\n          className=\"p-0 overflow-hidden business-radius-modal\"\n        >\n          <div className=\"px-8 py-10 text-center\">\n            <div className=\"modal-title text-gray-900\">안내</div>\n            <div className=\"mt-4 modal-value text-gray-700 whitespace-pre-wrap\">\n              {purchaseMissingMessage}\n            </div>\n            <div className=\"mt-6 badge-text text-gray-400\">\n              화면을 클릭하거나 ESC로 닫을 수 있습니다.\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  )\n}"],"names":["ImagePlus","createLucideIcon","d","key","cx","cy","r","Send","DateRangePicker","className","date","onDateChange","placeholder","disabled","triggerClassName","props","open","setOpen","React.useState","formatDateRange","range","from","formatDate","toLocaleDateString","year","month","day","to","getFullYear","getMonth","getDate","jsx","cn","children","jsxs","Popover","onOpenChange","PopoverTrigger","asChild","Button","id","CalendarIcon","X","onClick","e","stopPropagation","PopoverContent","align","Calendar","initialFocus","mode","defaultMonth","selected","onSelect","newDate","numberOfMonths","locale","ko","classNames","months","caption","caption_label","nav","nav_button","nav_button_previous","nav_button_next","table","head_row","head_cell","row","cell","day_range_start","day_range_end","day_selected","day_today","outside","day_disabled","day_range_middle","day_hidden","SupportMain","location","useLocation","navigate","useNavigate","inquiryType","setInquiryType","useState","message","setMessage","loading","setLoading","attachments","setAttachments","uploadingImage","setUploadingImage","fileInputRef","useRef","textMeasureCanvasRef","showPurchaseSelect","setShowPurchaseSelect","dateRange","setDateRange","purchaseRequests","setPurchaseRequests","selectedPurchase","setSelectedPurchase","searchingPurchase","setSearchingPurchase","requestedDeliveryDate","setRequestedDeliveryDate","quantityChangeRows","setQuantityChangeRows","priceChangeRows","setPriceChangeRows","purchaseLinkedInquiryTypes","purchaseSelectLabel","messageLabel","lockedInquiryType","setLockedInquiryType","lockedPurchaseId","setLockedPurchaseId","entrySource","setEntrySource","returnTo","setReturnTo","createRowId","Date","now","Math","random","toString","slice","inquiries","setInquiries","isAdmin","setIsAdmin","currentUserEmail","setCurrentUserEmail","currentUserId","setCurrentUserId","currentUserRoles","setCurrentUserRoles","loadingInquiries","setLoadingInquiries","expandedInquiry","setExpandedInquiry","showDetailModal","setShowDetailModal","selectedInquiryDetail","setSelectedInquiryDetail","loadingDetail","setLoadingDetail","editingItemId","setEditingItemId","editingItem","setEditingItem","purchaseDetailModalOpen","setPurchaseDetailModalOpen","purchaseDetailId","setPurchaseDetailId","deleteConfirmOpen","setDeleteConfirmOpen","purchaseToDelete","setPurchaseToDelete","purchaseMissingOpen","setPurchaseMissingOpen","purchaseMissingMessage","setPurchaseMissingMessage","chatMessages","setChatMessages","chatLoading","setChatLoading","chatRefreshing","setChatRefreshing","chatText","setChatText","chatSending","setChatSending","chatScrollRef","chatScrollRestoreRef","chatFirstLoadInquiryIdRef","chatForceBottomOnOpenRef","chatMessagesCacheRef","Map","useEffect","checkUserRole","subscription","supportService","subscribeToInquiries","payload","eventType","newRow","new","oldRow","old","deletedId","prev","filter","i","relevant","user_id","idx","findIndex","next","unshift","sort","a","b","at","created_at","getTime","unsubscribe","async","supabase","createClient","data","user","auth","getUser","email","employee","select","eq","single","roles","Array","isArray","purchase_role","split","map","trim","adminStatus","includes","loadInquiriesWithRole","result","getAllInquiries","getMyInquiries","success","toast","error","loadInquiries","params","URLSearchParams","search","typeParam","get","purchaseIdParam","sourceParam","returnToParam","n","Number","isFinite","getPurchaseRequestDetail","String","run","length","itemId","newQuantity","changeType","newValue","searchPurchaseRequests","startDate","toISOString","endDate","getMyPurchaseRequests","today","setMonth","purchaseOptions","aTime","request_date","bTime","aValue","pr","orderNumber","purchase_order_number","vendorName","vendor_name","firstItem","purchase_request_items","item_name","label","searchText","requester_name","toLowerCase","value","inquiryTypeOptions","selectedPurchaseItems","line_number","MAX_SAFE_INTEGER","itemOptions","item","specification","measureTextWidthPx","text","document","current","createElement","context","getContext","font","bodyStyle","window","getComputedStyle","body","fontFamily","fontWeight","getMeasureFont","ceil","measureText","width","getLabelWidthEm","padding","min","max","getSelectLabelMaxPx","options","reduce","option","getSelectControlWidthPx","maxLabelPx","base","getMenuWidthPx","inquiryTypePlaceholder","inquiryTypeControlWidthEm","inquiryTypeMenuWidthEm","purchaseSelectPlaceholder","purchaseControlWidthPx","purchaseMenuWidthPx","itemSelectPlaceholder","itemControlWidthPx","itemMenuWidthPx","priceChangeTypeOptions","formatNumericInput","numericValue","toLocaleString","dateRangeWidthEm","getCompactSelectStyles","controlWidthPx","menuWidthPx","control","minHeight","height","fontSize","borderRadius","borderColor","boxShadow","container","maxWidth","valueContainer","input","margin","indicatorsContainer","whiteSpace","overflow","textOverflow","color","singleValue","menu","minWidth","menuList","updateQuantityRow","rowId","updates","updatePriceRow","handleStatusUpdate","inquiryId","newStatus","resolutionNote","resolveInquiry","updateInquiryStatus","expandedInquiryObj","find","cancelled","cached","load","getInquiryMessages","el","prevTop","scrollTop","isFirstLoad","atBottom","scrollHeight","clientHeight","set","update","is_read","read_at","in","markAsRead","subscribeToInquiryMessages","useLayoutEffect","restore","cancelEditItem","getStatusBadge","status","getInquiryTypeLabel","type","renderInquiryPayloadSummary","inquiry","inquiry_payload","inquiry_type","current_date","requested_date","items","index","current_quantity","new_quantity","item_id","change_type","current_amount","new_amount","current_unit_price","new_unit_price","reason","Card","CardHeader","CardTitle","MessageCircle","CardContent","onSubmit","preventDefault","fetch","method","headers","JSON","stringify","messageLength","selectedPurchaseId","timestamp","sessionId","runId","hypothesisId","catch","hasMessage","requiresPurchase","subjectText","finalMessage","purchaseInfo","inquiryPayload","summaryLines","currentDateText","delivery_request_date","format","requestedDateText","push","activeRows","rows","itemsPayload","hasQuantity","targetItem","quantity","hasValue","currentUnitPrice","unit_price_value","unit_price","currentAmount","amount_value","quantityValue","newAmount","newUnitPrice","itemsText","join","messageSections","createInquiry","subject","purchase_request_id","purchase_info","nowIso","userEmail","byName","emp","maybeSingle","name","delivery_revision_requested","delivery_revision_requested_at","delivery_revision_requested_by","updatePurchaseInMemory","p","notifyCacheListeners","createdId","startsWith","Select","onValueChange","SelectTrigger","size","style","SelectValue","SelectContent","SelectItem","Fragment","ReactSelect","onChange","isSearchable","isLoading","noOptionsMessage","filterOption","inputValue","keyword","styles","DatePickerPopover","onDateSelect","side","selectedItem","isDisabled","Input","target","removeQuantityRow","Trash2","Plus","currentUnitPriceLabel","currentAmountLabel","placeholderText","inputMode","replace","removePriceRow","Textarea","maxLength","attachment","src","url","alt","deleteAttachment","path","_","handleRemoveAttachment","title","ref","accept","files","file","uploadAttachment","click","Loader2","AlertCircle","limit","openPurchaseDetailFromInquiry","user_name","user_email","resolution_note","confirm","deleteInquiry","handleDeleteInquiry","ChevronUp","ChevronDown","handled_by","processed_at","href","rel","handleResolveFromChat","m","isSystem","sender_role","isMine","sender_email","sendInquiryMessage","senderRole","handleSendChat","Dialog","DialogContent","DialogHeader","DialogTitle","deletePurchaseRequest","removePurchaseFromMemory","autoFocus","parseInt","parseFloat","remark","link","Eye","totalPrice","updatePurchaseRequestItem","saveEditItem","Save","startEditItem","Edit2","deletePurchaseRequestItem","deleteItem","colSpan","sum","notes","PurchaseDetailModal","purchaseId","isOpen","onClose","activeTab","onDelete","purchase","AlertDialog","AlertDialogContent","AlertDialogHeader","AlertDialogTitle","AlertDialogDescription","AlertDialogFooter","AlertDialogCancel","AlertDialogAction","purchaseIdForDelete","isNaN","inquiryUpdateError","itemsError","delete","requestError","Error","showCloseButton"],"mappings":"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","x_google_ignoreList":[0,1]}