import{e,j as t,r as n,E as r,y as a,D as i,W as s,x as o,Y as l,R as c,Z as d,B as u,c as m,l as p,$ as h,a0 as g,a1 as v,a2 as x,a3 as f,d as _,a4 as b,X as y,a5 as w,u as N,w as j,a6 as S,P as C,a7 as D,a8 as q,g as k,a9 as I,aa as R,ab as O}from"./index-B0aFbCDa.js";import{g as E,i as M,j as T,W as A,C as $,T as W,k as P,l as L,O as z,m as F,I as B,P as K,D as U,a as H,b as V,c as Y}from"./dialog-B9JpRg3-.js";import{b as X}from"./helpers-CsHcdtkA.js";import{C as Q,k as J,D as G,f as Z,S as ee}from"./react-select.esm-BC1txWwb.js";import{P as te,a as ne,b as re}from"./popover-DZeKSEjt.js";import{T as ae}from"./textarea-C0QyP4q-.js";import{L as ie}from"./label-tQeQKrVk.js";import{t as se}from"./index-DqxGfJS2.js";import{t as oe,C as le,I as ce}from"./transactionStatementService-CwTePWPx.js";import{C as de}from"./calendar-gkyAGM11.js";import{C as ue}from"./check-BFmJFwUt.js";import{C as me}from"./credit-card-KOaGmOFp.js";import{T as pe}from"./card-rzhbDXoW.js";import{L as he}from"./loader-circle-Yppxpi33.js";import{S as ge}from"./save-xm8dx6KV.js";
/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=e("dollar-sign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),xe=e("grip-vertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]),fe=e("message-square-plus",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}],["path",{d:"M12 8v6",key:"1ib9pf"}],["path",{d:"M9 11h6",key:"1fldmi"}]]),_e=e("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),be=e("truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]);var ye="AlertDialog",[we,Ne]=a(ye,[E]),je=E(),Se=e=>{const{__scopeAlertDialog:n,...r}=e,a=je(n);return t.jsx(M,{...a,...r,modal:!0})};Se.displayName=ye;n.forwardRef((e,n)=>{const{__scopeAlertDialog:r,...a}=e,i=je(r);return t.jsx(F,{...i,...a,ref:n})}).displayName="AlertDialogTrigger";var Ce=e=>{const{__scopeAlertDialog:n,...r}=e,a=je(n);return t.jsx(T,{...a,...r})};Ce.displayName="AlertDialogPortal";var De=n.forwardRef((e,n)=>{const{__scopeAlertDialog:r,...a}=e,i=je(r);return t.jsx(z,{...i,...a,ref:n})});De.displayName="AlertDialogOverlay";var qe="AlertDialogContent",[ke,Ie]=we(qe),Re=s("AlertDialogContent"),Oe=n.forwardRef((e,a)=>{const{__scopeAlertDialog:s,children:o,...l}=e,c=je(s),d=n.useRef(null),u=r(a,d),m=n.useRef(null);return t.jsx(A,{contentName:qe,titleName:Ee,docsSlug:"alert-dialog",children:t.jsx(ke,{scope:s,cancelRef:m,children:t.jsxs($,{role:"alertdialog",...c,...l,ref:u,onOpenAutoFocus:i(l.onOpenAutoFocus,e=>{e.preventDefault(),m.current?.focus({preventScroll:!0})}),onPointerDownOutside:e=>e.preventDefault(),onInteractOutside:e=>e.preventDefault(),children:[t.jsx(Re,{children:o}),t.jsx(Le,{contentRef:d})]})})})});Oe.displayName=qe;var Ee="AlertDialogTitle",Me=n.forwardRef((e,n)=>{const{__scopeAlertDialog:r,...a}=e,i=je(r);return t.jsx(W,{...i,...a,ref:n})});Me.displayName=Ee;var Te="AlertDialogDescription",Ae=n.forwardRef((e,n)=>{const{__scopeAlertDialog:r,...a}=e,i=je(r);return t.jsx(P,{...i,...a,ref:n})});Ae.displayName=Te;var $e=n.forwardRef((e,n)=>{const{__scopeAlertDialog:r,...a}=e,i=je(r);return t.jsx(L,{...i,...a,ref:n})});$e.displayName="AlertDialogAction";var We="AlertDialogCancel",Pe=n.forwardRef((e,n)=>{const{__scopeAlertDialog:a,...i}=e,{cancelRef:s}=Ie(We,a),o=je(a),l=r(n,s);return t.jsx(L,{...o,...i,ref:l})});Pe.displayName=We;var Le=({contentRef:e})=>{const t=`\`${qe}\` requires a description for the component to be accessible for screen reader users.\n\nYou can add a description to the \`${qe}\` by passing a \`${Te}\` component as a child, which also benefits sighted users by adding visible context to the dialog.\n\nAlternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${qe}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.\n\nFor more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return n.useEffect(()=>{document.getElementById(e.current?.getAttribute("aria-describedby"))},[t,e]),null},ze=De,Fe=Oe,Be=$e,Ke=Pe,Ue=Me,He=Ae;const Ve=Se,Ye=Ce,Xe=n.forwardRef(({className:e,...n},r)=>t.jsx(ze,{className:o("fixed inset-0 z-50 bg-black/40 backdrop-blur-sm","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...n,ref:r}));Xe.displayName=ze.displayName;const Qe=n.forwardRef(({className:e,...n},r)=>t.jsxs(Ye,{children:[t.jsx(Xe,{}),t.jsx(Fe,{ref:r,className:o("fixed left-[50%] top-[50%] z-50","w-full max-w-md translate-x-[-50%] translate-y-[-50%]","grid gap-4 bg-white border border-gray-200","rounded-lg p-6 shadow-professional-xl","duration-200","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0","data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95","data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%]","data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%]",e),...n})]}));Qe.displayName=Fe.displayName;const Je=({className:e,...n})=>t.jsx("div",{className:o("flex flex-col space-y-2 text-left",e),...n});Je.displayName="AlertDialogHeader";const Ge=({className:e,...n})=>t.jsx("div",{className:o("flex flex-col-reverse sm:flex-row sm:justify-end gap-3",e),...n});Ge.displayName="AlertDialogFooter";const Ze=n.forwardRef(({className:e,...n},r)=>t.jsx(Ue,{ref:r,className:o("text-lg font-semibold text-gray-800 tracking-tight",e),...n}));Ze.displayName=Ue.displayName;const et=n.forwardRef(({className:e,...n},r)=>t.jsx(He,{ref:r,className:o("text-sm text-gray-600",e),...n}));et.displayName=He.displayName;const tt=n.forwardRef(({className:e,...n},r)=>t.jsx(Be,{ref:r,className:o(l(),e),...n}));tt.displayName=Be.displayName;const nt=n.forwardRef(({className:e,...n},r)=>t.jsx(Ke,{ref:r,className:o(l({variant:"outline"}),"mt-2 sm:mt-0",e),...n}));nt.displayName=Ke.displayName;const rt="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement;function at(e){const t=Object.prototype.toString.call(e);return"[object Window]"===t||"[object global]"===t}function it(e){return"nodeType"in e}function st(e){var t,n;return e?at(e)?e:it(e)&&null!=(t=null==(n=e.ownerDocument)?void 0:n.defaultView)?t:window:window}function ot(e){const{Document:t}=st(e);return e instanceof t}function lt(e){return!at(e)&&e instanceof st(e).HTMLElement}function ct(e){return e instanceof st(e).SVGElement}function dt(e){return e?at(e)?e.document:it(e)?ot(e)?e:lt(e)||ct(e)?e.ownerDocument:document:document:document}const ut=rt?n.useLayoutEffect:n.useEffect;function mt(e){const t=n.useRef(e);return ut(()=>{t.current=e}),n.useCallback(function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return null==t.current?void 0:t.current(...n)},[])}function pt(e,t){void 0===t&&(t=[e]);const r=n.useRef(e);return ut(()=>{r.current!==e&&(r.current=e)},t),r}function ht(e,t){const r=n.useRef();return n.useMemo(()=>{const t=e(r.current);return r.current=t,t},[...t])}function gt(e){const t=mt(e),r=n.useRef(null),a=n.useCallback(e=>{e!==r.current&&(null==t||t(e,r.current)),r.current=e},[]);return[r,a]}function vt(e){const t=n.useRef();return n.useEffect(()=>{t.current=e},[e]),t.current}let xt={};function ft(e,t){return n.useMemo(()=>{if(t)return t;const n=null==xt[e]?0:xt[e]+1;return xt[e]=n,e+"-"+n},[e,t])}function _t(e){return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return r.reduce((t,n)=>{const r=Object.entries(n);for(const[a,i]of r){const n=t[a];null!=n&&(t[a]=n+e*i)}return t},{...t})}}const bt=_t(1),yt=_t(-1);function wt(e){if(!e)return!1;const{KeyboardEvent:t}=st(e.target);return t&&e instanceof t}function Nt(e){if(function(e){if(!e)return!1;const{TouchEvent:t}=st(e.target);return t&&e instanceof t}(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:n}=e.touches[0];return{x:t,y:n}}if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:n}=e.changedTouches[0];return{x:t,y:n}}}return function(e){return"clientX"in e&&"clientY"in e}(e)?{x:e.clientX,y:e.clientY}:null}const jt=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:n}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:n}=e;return"scaleX("+t+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[jt.Translate.toString(e),jt.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:n,easing:r}=e;return t+" "+n+"ms "+r}}}),St="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function Ct(e){return e.matches(St)?e:e.querySelector(St)}const Dt={display:"none"};function qt(e){let{id:t,value:n}=e;return c.createElement("div",{id:t,style:Dt},n)}function kt(e){let{id:t,announcement:n,ariaLiveType:r="assertive"}=e;return c.createElement("div",{id:t,style:{position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"},role:"status","aria-live":r,"aria-atomic":!0},n)}const It=n.createContext(null);const Rt={draggable:"\n    To pick up a draggable item, press the space bar.\n    While dragging, use the arrow keys to move the item.\n    Press space again to drop the item in its new position, or press escape to cancel.\n  "},Ot={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was moved over droppable area "+n.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was dropped over droppable area "+n.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function Et(e){let{announcements:t=Ot,container:r,hiddenTextDescribedById:a,screenReaderInstructions:i=Rt}=e;const{announce:s,announcement:o}=function(){const[e,t]=n.useState("");return{announce:n.useCallback(e=>{null!=e&&t(e)},[]),announcement:e}}(),l=ft("DndLiveRegion"),[u,m]=n.useState(!1);if(n.useEffect(()=>{m(!0)},[]),function(e){const t=n.useContext(It);n.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}(n.useMemo(()=>({onDragStart(e){let{active:n}=e;s(t.onDragStart({active:n}))},onDragMove(e){let{active:n,over:r}=e;t.onDragMove&&s(t.onDragMove({active:n,over:r}))},onDragOver(e){let{active:n,over:r}=e;s(t.onDragOver({active:n,over:r}))},onDragEnd(e){let{active:n,over:r}=e;s(t.onDragEnd({active:n,over:r}))},onDragCancel(e){let{active:n,over:r}=e;s(t.onDragCancel({active:n,over:r}))}}),[s,t])),!u)return null;const p=c.createElement(c.Fragment,null,c.createElement(qt,{id:a,value:i.draggable}),c.createElement(kt,{id:l,announcement:o}));return r?d.createPortal(p,r):p}var Mt,Tt;function At(){}(Tt=Mt||(Mt={})).DragStart="dragStart",Tt.DragMove="dragMove",Tt.DragEnd="dragEnd",Tt.DragCancel="dragCancel",Tt.DragOver="dragOver",Tt.RegisterDroppable="registerDroppable",Tt.SetDroppableDisabled="setDroppableDisabled",Tt.UnregisterDroppable="unregisterDroppable";const $t=Object.freeze({x:0,y:0});function Wt(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Pt(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return n-r}function Lt(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return r-n}function zt(e,t,n){return void 0===t&&(t=e.left),void 0===n&&(n=e.top),{x:t+.5*e.width,y:n+.5*e.height}}const Ft=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const a=zt(t,t.left,t.top),i=[];for(const s of r){const{id:e}=s,t=n.get(e);if(t){const n=Wt(zt(t),a);i.push({id:e,data:{droppableContainer:s,value:n}})}}return i.sort(Pt)};function Bt(e,t){const n=Math.max(t.top,e.top),r=Math.max(t.left,e.left),a=Math.min(t.left+t.width,e.left+e.width),i=Math.min(t.top+t.height,e.top+e.height),s=a-r,o=i-n;if(r<a&&n<i){const n=t.width*t.height,r=e.width*e.height,a=s*o;return Number((a/(n+r-a)).toFixed(4))}return 0}const Kt=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const a=[];for(const i of r){const{id:e}=i,r=n.get(e);if(r){const n=Bt(r,t);n>0&&a.push({id:e,data:{droppableContainer:i,value:n}})}}return a.sort(Lt)};function Ut(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:$t}function Ht(e){return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return r.reduce((t,n)=>({...t,top:t.top+e*n.y,bottom:t.bottom+e*n.y,left:t.left+e*n.x,right:t.right+e*n.x}),{...t})}}const Vt=Ht(1);const Yt={ignoreTransform:!1};function Xt(e,t){void 0===t&&(t=Yt);let n=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:t,transformOrigin:r}=st(e).getComputedStyle(e);t&&(n=function(e,t,n){const r=function(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}(t);if(!r)return e;const{scaleX:a,scaleY:i,x:s,y:o}=r,l=e.left-s-(1-a)*parseFloat(n),c=e.top-o-(1-i)*parseFloat(n.slice(n.indexOf(" ")+1)),d=a?e.width/a:e.width,u=i?e.height/i:e.height;return{width:d,height:u,top:c,right:l+d,bottom:c+u,left:l}}(n,t,r))}const{top:r,left:a,width:i,height:s,bottom:o,right:l}=n;return{top:r,left:a,width:i,height:s,bottom:o,right:l}}function Qt(e){return Xt(e,{ignoreTransform:!0})}function Jt(e,t){const n=[];return e?function r(a){if(null!=t&&n.length>=t)return n;if(!a)return n;if(ot(a)&&null!=a.scrollingElement&&!n.includes(a.scrollingElement))return n.push(a.scrollingElement),n;if(!lt(a)||ct(a))return n;if(n.includes(a))return n;const i=st(e).getComputedStyle(a);return a!==e&&function(e,t){void 0===t&&(t=st(e).getComputedStyle(e));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(e=>{const r=t[e];return"string"==typeof r&&n.test(r)})}(a,i)&&n.push(a),function(e,t){return void 0===t&&(t=st(e).getComputedStyle(e)),"fixed"===t.position}(a,i)?n:r(a.parentNode)}(e):n}function Gt(e){const[t]=Jt(e,1);return null!=t?t:null}function Zt(e){return rt&&e?at(e)?e:it(e)?ot(e)||e===dt(e).scrollingElement?window:lt(e)?e:null:null:null}function en(e){return at(e)?e.scrollX:e.scrollLeft}function tn(e){return at(e)?e.scrollY:e.scrollTop}function nn(e){return{x:en(e),y:tn(e)}}var rn,an;function sn(e){return!(!rt||!e)&&e===document.scrollingElement}function on(e){const t={x:0,y:0},n=sn(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height};return{isTop:e.scrollTop<=t.y,isLeft:e.scrollLeft<=t.x,isBottom:e.scrollTop>=r.y,isRight:e.scrollLeft>=r.x,maxScroll:r,minScroll:t}}(an=rn||(rn={}))[an.Forward=1]="Forward",an[an.Backward=-1]="Backward";const ln={x:.2,y:.2};function cn(e,t,n,r,a){let{top:i,left:s,right:o,bottom:l}=n;void 0===r&&(r=10),void 0===a&&(a=ln);const{isTop:c,isBottom:d,isLeft:u,isRight:m}=on(e),p={x:0,y:0},h={x:0,y:0},g=t.height*a.y,v=t.width*a.x;return!c&&i<=t.top+g?(p.y=rn.Backward,h.y=r*Math.abs((t.top+g-i)/g)):!d&&l>=t.bottom-g&&(p.y=rn.Forward,h.y=r*Math.abs((t.bottom-g-l)/g)),!m&&o>=t.right-v?(p.x=rn.Forward,h.x=r*Math.abs((t.right-v-o)/v)):!u&&s<=t.left+v&&(p.x=rn.Backward,h.x=r*Math.abs((t.left+v-s)/v)),{direction:p,speed:h}}function dn(e){if(e===document.scrollingElement){const{innerWidth:e,innerHeight:t}=window;return{top:0,left:0,right:e,bottom:t,width:e,height:t}}const{top:t,left:n,right:r,bottom:a}=e.getBoundingClientRect();return{top:t,left:n,right:r,bottom:a,width:e.clientWidth,height:e.clientHeight}}function un(e){return e.reduce((e,t)=>bt(e,nn(t)),$t)}const mn=[["x",["left","right"],function(e){return e.reduce((e,t)=>e+en(t),0)}],["y",["top","bottom"],function(e){return e.reduce((e,t)=>e+tn(t),0)}]];class pn{constructor(e,t){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const n=Jt(t),r=un(n);this.rect={...e},this.width=e.width,this.height=e.height;for(const[a,i,s]of mn)for(const e of i)Object.defineProperty(this,e,{get:()=>{const t=s(n),i=r[a]-t;return this.rect[e]+i},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class hn{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(e=>{var t;return null==(t=this.target)?void 0:t.removeEventListener(...e)})},this.target=e}add(e,t,n){var r;null==(r=this.target)||r.addEventListener(e,t,n),this.listeners.push([e,t,n])}}function gn(e,t){const n=Math.abs(e.x),r=Math.abs(e.y);return"number"==typeof t?Math.sqrt(n**2+r**2)>t:"x"in t&&"y"in t?n>t.x&&r>t.y:"x"in t?n>t.x:"y"in t&&r>t.y}var vn,xn,fn,_n;function bn(e){e.preventDefault()}function yn(e){e.stopPropagation()}(xn=vn||(vn={})).Click="click",xn.DragStart="dragstart",xn.Keydown="keydown",xn.ContextMenu="contextmenu",xn.Resize="resize",xn.SelectionChange="selectionchange",xn.VisibilityChange="visibilitychange",(_n=fn||(fn={})).Space="Space",_n.Down="ArrowDown",_n.Right="ArrowRight",_n.Left="ArrowLeft",_n.Up="ArrowUp",_n.Esc="Escape",_n.Enter="Enter",_n.Tab="Tab";const wn={start:[fn.Space,fn.Enter],cancel:[fn.Esc],end:[fn.Space,fn.Enter,fn.Tab]},Nn=(e,t)=>{let{currentCoordinates:n}=t;switch(e.code){case fn.Right:return{...n,x:n.x+25};case fn.Left:return{...n,x:n.x-25};case fn.Down:return{...n,y:n.y+25};case fn.Up:return{...n,y:n.y-25}}};class jn{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:t}}=e;this.props=e,this.listeners=new hn(dt(t)),this.windowListeners=new hn(st(t)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(vn.Resize,this.handleCancel),this.windowListeners.add(vn.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(vn.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:e,onStart:t}=this.props,n=e.node.current;n&&function(e,t){if(void 0===t&&(t=Xt),!e)return;const{top:n,left:r,bottom:a,right:i}=t(e);Gt(e)&&(a<=0||i<=0||n>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}(n),t($t)}handleKeyDown(e){if(wt(e)){const{active:t,context:n,options:r}=this.props,{keyboardCodes:a=wn,coordinateGetter:i=Nn,scrollBehavior:s="smooth"}=r,{code:o}=e;if(a.end.includes(o))return void this.handleEnd(e);if(a.cancel.includes(o))return void this.handleCancel(e);const{collisionRect:l}=n.current,c=l?{x:l.left,y:l.top}:$t;this.referenceCoordinates||(this.referenceCoordinates=c);const d=i(e,{active:t,context:n.current,currentCoordinates:c});if(d){const t=yt(d,c),r={x:0,y:0},{scrollableAncestors:a}=n.current;for(const n of a){const a=e.code,{isTop:i,isRight:o,isLeft:l,isBottom:c,maxScroll:u,minScroll:m}=on(n),p=dn(n),h={x:Math.min(a===fn.Right?p.right-p.width/2:p.right,Math.max(a===fn.Right?p.left:p.left+p.width/2,d.x)),y:Math.min(a===fn.Down?p.bottom-p.height/2:p.bottom,Math.max(a===fn.Down?p.top:p.top+p.height/2,d.y))},g=a===fn.Right&&!o||a===fn.Left&&!l,v=a===fn.Down&&!c||a===fn.Up&&!i;if(g&&h.x!==d.x){const e=n.scrollLeft+t.x,i=a===fn.Right&&e<=u.x||a===fn.Left&&e>=m.x;if(i&&!t.y)return void n.scrollTo({left:e,behavior:s});r.x=i?n.scrollLeft-e:a===fn.Right?n.scrollLeft-u.x:n.scrollLeft-m.x,r.x&&n.scrollBy({left:-r.x,behavior:s});break}if(v&&h.y!==d.y){const e=n.scrollTop+t.y,i=a===fn.Down&&e<=u.y||a===fn.Up&&e>=m.y;if(i&&!t.x)return void n.scrollTo({top:e,behavior:s});r.y=i?n.scrollTop-e:a===fn.Down?n.scrollTop-u.y:n.scrollTop-m.y,r.y&&n.scrollBy({top:-r.y,behavior:s});break}}this.handleMove(e,bt(yt(d,this.referenceCoordinates),r))}}}handleMove(e,t){const{onMove:n}=this.props;e.preventDefault(),n(t)}handleEnd(e){const{onEnd:t}=this.props;e.preventDefault(),this.detach(),t()}handleCancel(e){const{onCancel:t}=this.props;e.preventDefault(),this.detach(),t()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}function Sn(e){return Boolean(e&&"distance"in e)}function Cn(e){return Boolean(e&&"delay"in e)}jn.activators=[{eventName:"onKeyDown",handler:(e,t,n)=>{let{keyboardCodes:r=wn,onActivation:a}=t,{active:i}=n;const{code:s}=e.nativeEvent;if(r.start.includes(s)){const t=i.activatorNode.current;return(!t||e.target===t)&&(e.preventDefault(),null==a||a({event:e.nativeEvent}),!0)}return!1}}];class Dn{constructor(e,t,n){var r;void 0===n&&(n=function(e){const{EventTarget:t}=st(e);return e instanceof t?e:dt(e)}(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=t;const{event:a}=e,{target:i}=a;this.props=e,this.events=t,this.document=dt(i),this.documentListeners=new hn(this.document),this.listeners=new hn(n),this.windowListeners=new hn(st(i)),this.initialCoordinates=null!=(r=Nt(a))?r:$t,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:e,props:{options:{activationConstraint:t,bypassActivationConstraint:n}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(vn.Resize,this.handleCancel),this.windowListeners.add(vn.DragStart,bn),this.windowListeners.add(vn.VisibilityChange,this.handleCancel),this.windowListeners.add(vn.ContextMenu,bn),this.documentListeners.add(vn.Keydown,this.handleKeydown),t){if(null!=n&&n({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(Cn(t))return this.timeoutId=setTimeout(this.handleStart,t.delay),void this.handlePending(t);if(Sn(t))return void this.handlePending(t)}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),null!==this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,t){const{active:n,onPending:r}=this.props;r(n,e,this.initialCoordinates,t)}handleStart(){const{initialCoordinates:e}=this,{onStart:t}=this.props;e&&(this.activated=!0,this.documentListeners.add(vn.Click,yn,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(vn.SelectionChange,this.removeTextSelection),t(e))}handleMove(e){var t;const{activated:n,initialCoordinates:r,props:a}=this,{onMove:i,options:{activationConstraint:s}}=a;if(!r)return;const o=null!=(t=Nt(e))?t:$t,l=yt(r,o);if(!n&&s){if(Sn(s)){if(null!=s.tolerance&&gn(l,s.tolerance))return this.handleCancel();if(gn(l,s.distance))return this.handleStart()}return Cn(s)&&gn(l,s.tolerance)?this.handleCancel():void this.handlePending(s,l)}e.cancelable&&e.preventDefault(),i(o)}handleEnd(){const{onAbort:e,onEnd:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleCancel(){const{onAbort:e,onCancel:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleKeydown(e){e.code===fn.Esc&&this.handleCancel()}removeTextSelection(){var e;null==(e=this.document.getSelection())||e.removeAllRanges()}}const qn={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class kn extends Dn{constructor(e){const{event:t}=e,n=dt(t.target);super(e,qn,n)}}kn.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return!(!n.isPrimary||0!==n.button)&&(null==r||r({event:n}),!0)}}];const In={move:{name:"mousemove"},end:{name:"mouseup"}};var Rn,On;(On=Rn||(Rn={}))[On.RightClick=2]="RightClick";(class extends Dn{constructor(e){super(e,In,dt(e.event.target))}}).activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return n.button!==Rn.RightClick&&(null==r||r({event:n}),!0)}}];const En={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};var Mn,Tn,An,$n;function Wn(e){let{acceleration:t,activator:r=Mn.Pointer,canScroll:a,draggingRect:i,enabled:s,interval:o=5,order:l=An.TreeOrder,pointerCoordinates:c,scrollableAncestors:d,scrollableAncestorRects:u,delta:m,threshold:p}=e;const h=function(e){let{delta:t,disabled:n}=e;const r=vt(t);return ht(e=>{if(n||!r||!e)return Pn;const a={x:Math.sign(t.x-r.x),y:Math.sign(t.y-r.y)};return{x:{[rn.Backward]:e.x[rn.Backward]||-1===a.x,[rn.Forward]:e.x[rn.Forward]||1===a.x},y:{[rn.Backward]:e.y[rn.Backward]||-1===a.y,[rn.Forward]:e.y[rn.Forward]||1===a.y}}},[n,t,r])}({delta:m,disabled:!s}),[g,v]=function(){const e=n.useRef(null);return[n.useCallback((t,n)=>{e.current=setInterval(t,n)},[]),n.useCallback(()=>{null!==e.current&&(clearInterval(e.current),e.current=null)},[])]}(),x=n.useRef({x:0,y:0}),f=n.useRef({x:0,y:0}),_=n.useMemo(()=>{switch(r){case Mn.Pointer:return c?{top:c.y,bottom:c.y,left:c.x,right:c.x}:null;case Mn.DraggableRect:return i}},[r,i,c]),b=n.useRef(null),y=n.useCallback(()=>{const e=b.current;if(!e)return;const t=x.current.x*f.current.x,n=x.current.y*f.current.y;e.scrollBy(t,n)},[]),w=n.useMemo(()=>l===An.TreeOrder?[...d].reverse():d,[l,d]);n.useEffect(()=>{if(s&&d.length&&_){for(const e of w){if(!1===(null==a?void 0:a(e)))continue;const n=d.indexOf(e),r=u[n];if(!r)continue;const{direction:i,speed:s}=cn(e,r,_,t,p);for(const e of["x","y"])h[e][i[e]]||(s[e]=0,i[e]=0);if(s.x>0||s.y>0)return v(),b.current=e,g(y,o),x.current=s,void(f.current=i)}x.current={x:0,y:0},f.current={x:0,y:0},v()}else v()},[t,y,a,v,s,o,JSON.stringify(_),JSON.stringify(h),g,d,w,u,JSON.stringify(p)])}(class extends Dn{constructor(e){super(e,En)}static setup(){return window.addEventListener(En.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(En.move.name,e)};function e(){}}}).activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;const{touches:a}=n;return!(a.length>1)&&(null==r||r({event:n}),!0)}}],(Tn=Mn||(Mn={}))[Tn.Pointer=0]="Pointer",Tn[Tn.DraggableRect=1]="DraggableRect",($n=An||(An={}))[$n.TreeOrder=0]="TreeOrder",$n[$n.ReversedTreeOrder=1]="ReversedTreeOrder";const Pn={x:{[rn.Backward]:!1,[rn.Forward]:!1},y:{[rn.Backward]:!1,[rn.Forward]:!1}};var Ln,zn,Fn;(zn=Ln||(Ln={}))[zn.Always=0]="Always",zn[zn.BeforeDragging=1]="BeforeDragging",zn[zn.WhileDragging=2]="WhileDragging",(Fn||(Fn={})).Optimized="optimized";const Bn=new Map;function Kn(e,t){return ht(n=>e?n||("function"==typeof t?t(e):e):null,[t,e])}function Un(e){let{callback:t,disabled:r}=e;const a=mt(t),i=n.useMemo(()=>{if(r||"undefined"==typeof window||void 0===window.ResizeObserver)return;const{ResizeObserver:e}=window;return new e(a)},[r]);return n.useEffect(()=>()=>null==i?void 0:i.disconnect(),[i]),i}function Hn(e){return new pn(Xt(e),e)}function Vn(e,t,r){void 0===t&&(t=Hn);const[a,i]=n.useState(null);function s(){i(n=>{if(!e)return null;var a;if(!1===e.isConnected)return null!=(a=null!=n?n:r)?a:null;const i=t(e);return JSON.stringify(n)===JSON.stringify(i)?n:i})}const o=function(e){let{callback:t,disabled:r}=e;const a=mt(t),i=n.useMemo(()=>{if(r||"undefined"==typeof window||void 0===window.MutationObserver)return;const{MutationObserver:e}=window;return new e(a)},[a,r]);return n.useEffect(()=>()=>null==i?void 0:i.disconnect(),[i]),i}({callback(t){if(e)for(const n of t){const{type:t,target:r}=n;if("childList"===t&&r instanceof HTMLElement&&r.contains(e)){s();break}}}}),l=Un({callback:s});return ut(()=>{s(),e?(null==l||l.observe(e),null==o||o.observe(document.body,{childList:!0,subtree:!0})):(null==l||l.disconnect(),null==o||o.disconnect())},[e]),a}const Yn=[];function Xn(e,t){void 0===t&&(t=[]);const r=n.useRef(null);return n.useEffect(()=>{r.current=null},t),n.useEffect(()=>{const t=e!==$t;t&&!r.current&&(r.current=e),!t&&r.current&&(r.current=null)},[e]),r.current?yt(e,r.current):$t}function Qn(e){return n.useMemo(()=>e?function(e){const t=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:t,bottom:n,width:t,height:n}}(e):null,[e])}const Jn=[];function Gn(e){let{measure:t}=e;const[r,a]=n.useState(null),i=Un({callback:n.useCallback(e=>{for(const{target:n}of e)if(lt(n)){a(e=>{const r=t(n);return e?{...e,width:r.width,height:r.height}:r});break}},[t])}),s=n.useCallback(e=>{const n=function(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return lt(t)?t:e}(e);null==i||i.disconnect(),n&&(null==i||i.observe(n)),a(n?t(n):null)},[t,i]),[o,l]=gt(s);return n.useMemo(()=>({nodeRef:o,rect:r,setRef:l}),[r,o,l])}const Zn=[{sensor:kn,options:{}},{sensor:jn,options:{}}],er={current:{}},tr={draggable:{measure:Qt},droppable:{measure:Qt,strategy:Ln.WhileDragging,frequency:Fn.Optimized},dragOverlay:{measure:Xt}};class nr extends Map{get(e){var t;return null!=e&&null!=(t=super.get(e))?t:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:t}=e;return!t})}getNodeFor(e){var t,n;return null!=(t=null==(n=this.get(e))?void 0:n.node.current)?t:void 0}}const rr={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new nr,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:At},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:tr,measureDroppableContainers:At,windowRect:null,measuringScheduled:!1},ar={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:At,draggableNodes:new Map,over:null,measureDroppableContainers:At},ir=n.createContext(ar),sr=n.createContext(rr);function or(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new nr}}}function lr(e,t){switch(t.type){case Mt.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case Mt.DragMove:return null==e.draggable.active?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case Mt.DragEnd:case Mt.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case Mt.RegisterDroppable:{const{element:n}=t,{id:r}=n,a=new nr(e.droppable.containers);return a.set(r,n),{...e,droppable:{...e.droppable,containers:a}}}case Mt.SetDroppableDisabled:{const{id:n,key:r,disabled:a}=t,i=e.droppable.containers.get(n);if(!i||r!==i.key)return e;const s=new nr(e.droppable.containers);return s.set(n,{...i,disabled:a}),{...e,droppable:{...e.droppable,containers:s}}}case Mt.UnregisterDroppable:{const{id:n,key:r}=t,a=e.droppable.containers.get(n);if(!a||r!==a.key)return e;const i=new nr(e.droppable.containers);return i.delete(n),{...e,droppable:{...e.droppable,containers:i}}}default:return e}}function cr(e){let{disabled:t}=e;const{active:r,activatorEvent:a,draggableNodes:i}=n.useContext(ir),s=vt(a),o=vt(null==r?void 0:r.id);return n.useEffect(()=>{if(!t&&!a&&s&&null!=o){if(!wt(s))return;if(document.activeElement===s.target)return;const e=i.get(o);if(!e)return;const{activatorNode:t,node:n}=e;if(!t.current&&!n.current)return;requestAnimationFrame(()=>{for(const e of[t.current,n.current]){if(!e)continue;const t=Ct(e);if(t){t.focus();break}}})}},[a,t,i,o,s]),null}const dr=n.createContext({...$t,scaleX:1,scaleY:1});var ur,mr;(mr=ur||(ur={}))[mr.Uninitialized=0]="Uninitialized",mr[mr.Initializing=1]="Initializing",mr[mr.Initialized=2]="Initialized";const pr=n.memo(function(e){var t,r,a,i;let{id:s,accessibility:o,autoScroll:l=!0,children:u,sensors:m=Zn,collisionDetection:p=Kt,measuring:h,modifiers:g,...v}=e;const x=n.useReducer(lr,void 0,or),[f,_]=x,[b,y]=function(){const[e]=n.useState(()=>new Set),t=n.useCallback(t=>(e.add(t),()=>e.delete(t)),[e]);return[n.useCallback(t=>{let{type:n,event:r}=t;e.forEach(e=>{var t;return null==(t=e[n])?void 0:t.call(e,r)})},[e]),t]}(),[w,N]=n.useState(ur.Uninitialized),j=w===ur.Initialized,{draggable:{active:S,nodes:C,translate:D},droppable:{containers:q}}=f,k=null!=S?C.get(S):null,I=n.useRef({initial:null,translated:null}),R=n.useMemo(()=>{var e;return null!=S?{id:S,data:null!=(e=null==k?void 0:k.data)?e:er,rect:I}:null},[S,k]),O=n.useRef(null),[E,M]=n.useState(null),[T,A]=n.useState(null),$=pt(v,Object.values(v)),W=ft("DndDescribedBy",s),P=n.useMemo(()=>q.getEnabled(),[q]),L=(z=h,n.useMemo(()=>({draggable:{...tr.draggable,...null==z?void 0:z.draggable},droppable:{...tr.droppable,...null==z?void 0:z.droppable},dragOverlay:{...tr.dragOverlay,...null==z?void 0:z.dragOverlay}}),[null==z?void 0:z.draggable,null==z?void 0:z.droppable,null==z?void 0:z.dragOverlay]));var z;const{droppableRects:F,measureDroppableContainers:B,measuringScheduled:K}=function(e,t){let{dragging:r,dependencies:a,config:i}=t;const[s,o]=n.useState(null),{frequency:l,measure:c,strategy:d}=i,u=n.useRef(e),m=function(){switch(d){case Ln.Always:return!1;case Ln.BeforeDragging:return r;default:return!r}}(),p=pt(m),h=n.useCallback(function(e){void 0===e&&(e=[]),p.current||o(t=>null===t?e:t.concat(e.filter(e=>!t.includes(e))))},[p]),g=n.useRef(null),v=ht(t=>{if(m&&!r)return Bn;if(!t||t===Bn||u.current!==e||null!=s){const t=new Map;for(let n of e){if(!n)continue;if(s&&s.length>0&&!s.includes(n.id)&&n.rect.current){t.set(n.id,n.rect.current);continue}const e=n.node.current,r=e?new pn(c(e),e):null;n.rect.current=r,r&&t.set(n.id,r)}return t}return t},[e,s,r,m,c]);return n.useEffect(()=>{u.current=e},[e]),n.useEffect(()=>{m||h()},[r,m]),n.useEffect(()=>{s&&s.length>0&&o(null)},[JSON.stringify(s)]),n.useEffect(()=>{m||"number"!=typeof l||null!==g.current||(g.current=setTimeout(()=>{h(),g.current=null},l))},[l,m,h,...a]),{droppableRects:v,measureDroppableContainers:h,measuringScheduled:null!=s}}(P,{dragging:j,dependencies:[D.x,D.y],config:L.droppable}),U=function(e,t){const n=null!=t?e.get(t):void 0,r=n?n.node.current:null;return ht(e=>{var n;return null==t?null:null!=(n=null!=r?r:e)?n:null},[r,t])}(C,S),H=n.useMemo(()=>T?Nt(T):null,[T]),V=function(){const e=!1===(null==E?void 0:E.autoScrollEnabled),t="object"==typeof l?!1===l.enabled:!1===l,n=j&&!e&&!t;if("object"==typeof l)return{...l,enabled:n};return{enabled:n}}(),Y=function(e,t){return Kn(e,t)}(U,L.draggable.measure);!function(e){let{activeNode:t,measure:r,initialRect:a,config:i=!0}=e;const s=n.useRef(!1),{x:o,y:l}="boolean"==typeof i?{x:i,y:i}:i;ut(()=>{if(!o&&!l||!t)return void(s.current=!1);if(s.current||!a)return;const e=null==t?void 0:t.node.current;if(!e||!1===e.isConnected)return;const n=Ut(r(e),a);if(o||(n.x=0),l||(n.y=0),s.current=!0,Math.abs(n.x)>0||Math.abs(n.y)>0){const t=Gt(e);t&&t.scrollBy({top:n.y,left:n.x})}},[t,o,l,a,r])}({activeNode:null!=S?C.get(S):null,config:V.layoutShiftCompensation,initialRect:Y,measure:L.draggable.measure});const X=Vn(U,L.draggable.measure,Y),Q=Vn(U?U.parentElement:null),J=n.useRef({activatorEvent:null,active:null,activeNode:U,collisionRect:null,collisions:null,droppableRects:F,draggableNodes:C,draggingNode:null,draggingNodeRect:null,droppableContainers:q,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),G=q.getNodeFor(null==(t=J.current.over)?void 0:t.id),Z=Gn({measure:L.dragOverlay.measure}),ee=null!=(r=Z.nodeRef.current)?r:U,te=j?null!=(a=Z.rect)?a:X:null,ne=Boolean(Z.nodeRef.current&&Z.rect),re=Ut(ae=ne?null:X,Kn(ae));var ae;const ie=Qn(ee?st(ee):null),se=function(e){const t=n.useRef(e),r=ht(n=>e?n&&n!==Yn&&e&&t.current&&e.parentNode===t.current.parentNode?n:Jt(e):Yn,[e]);return n.useEffect(()=>{t.current=e},[e]),r}(j?null!=G?G:U:null),oe=function(e,t){void 0===t&&(t=Xt);const[r]=e,a=Qn(r?st(r):null),[i,s]=n.useState(Jn);function o(){s(()=>e.length?e.map(e=>sn(e)?a:new pn(t(e),e)):Jn)}const l=Un({callback:o});return ut(()=>{null==l||l.disconnect(),o(),e.forEach(e=>null==l?void 0:l.observe(e))},[e]),i}(se),le=function(e,t){let{transform:n,...r}=t;return null!=e&&e.length?e.reduce((e,t)=>t({transform:e,...r}),n):n}(g,{transform:{x:D.x-re.x,y:D.y-re.y,scaleX:1,scaleY:1},activatorEvent:T,active:R,activeNodeRect:X,containerNodeRect:Q,draggingNodeRect:te,over:J.current.over,overlayNodeRect:Z.rect,scrollableAncestors:se,scrollableAncestorRects:oe,windowRect:ie}),ce=H?bt(H,D):null,de=function(e){const[t,r]=n.useState(null),a=n.useRef(e),i=n.useCallback(e=>{const t=Zt(e.target);t&&r(e=>e?(e.set(t,nn(t)),new Map(e)):null)},[]);return n.useEffect(()=>{const t=a.current;if(e!==t){n(t);const s=e.map(e=>{const t=Zt(e);return t?(t.addEventListener("scroll",i,{passive:!0}),[t,nn(t)]):null}).filter(e=>null!=e);r(s.length?new Map(s):null),a.current=e}return()=>{n(e),n(t)};function n(e){e.forEach(e=>{const t=Zt(e);null==t||t.removeEventListener("scroll",i)})}},[i,e]),n.useMemo(()=>e.length?t?Array.from(t.values()).reduce((e,t)=>bt(e,t),$t):un(e):$t,[e,t])}(se),ue=Xn(de),me=Xn(de,[X]),pe=bt(le,ue),he=te?Vt(te,le):null,ge=R&&he?p({active:R,collisionRect:he,droppableRects:F,droppableContainers:P,pointerCoordinates:ce}):null,ve=function(e,t){if(!e||0===e.length)return null;const[n]=e;return n[t]}(ge,"id"),[xe,fe]=n.useState(null),_e=function(e,t,n){return{...e,scaleX:t&&n?t.width/n.width:1,scaleY:t&&n?t.height/n.height:1}}(ne?le:bt(le,me),null!=(i=null==xe?void 0:xe.rect)?i:null,X),be=n.useRef(null),ye=n.useCallback((e,t)=>{let{sensor:n,options:r}=t;if(null==O.current)return;const a=C.get(O.current);if(!a)return;const i=e.nativeEvent,s=new n({active:O.current,activeNode:a,event:i,options:r,context:J,onAbort(e){if(!C.get(e))return;const{onDragAbort:t}=$.current,n={id:e};null==t||t(n),b({type:"onDragAbort",event:n})},onPending(e,t,n,r){if(!C.get(e))return;const{onDragPending:a}=$.current,i={id:e,constraint:t,initialCoordinates:n,offset:r};null==a||a(i),b({type:"onDragPending",event:i})},onStart(e){const t=O.current;if(null==t)return;const n=C.get(t);if(!n)return;const{onDragStart:r}=$.current,a={activatorEvent:i,active:{id:t,data:n.data,rect:I}};d.unstable_batchedUpdates(()=>{null==r||r(a),N(ur.Initializing),_({type:Mt.DragStart,initialCoordinates:e,active:t}),b({type:"onDragStart",event:a}),M(be.current),A(i)})},onMove(e){_({type:Mt.DragMove,coordinates:e})},onEnd:o(Mt.DragEnd),onCancel:o(Mt.DragCancel)});function o(e){return async function(){const{active:t,collisions:n,over:r,scrollAdjustedTranslate:a}=J.current;let s=null;if(t&&a){const{cancelDrop:o}=$.current;if(s={activatorEvent:i,active:t,collisions:n,delta:a,over:r},e===Mt.DragEnd&&"function"==typeof o){await Promise.resolve(o(s))&&(e=Mt.DragCancel)}}O.current=null,d.unstable_batchedUpdates(()=>{_({type:e}),N(ur.Uninitialized),fe(null),M(null),A(null),be.current=null;const t=e===Mt.DragEnd?"onDragEnd":"onDragCancel";if(s){const e=$.current[t];null==e||e(s),b({type:t,event:s})}})}}be.current=s},[C]),we=function(e,t){return n.useMemo(()=>e.reduce((e,n)=>{const{sensor:r}=n;return[...e,...r.activators.map(e=>({eventName:e.eventName,handler:t(e.handler,n)}))]},[]),[e,t])}(m,n.useCallback((e,t)=>(n,r)=>{const a=n.nativeEvent,i=C.get(r);if(null!==O.current||!i||a.dndKit||a.defaultPrevented)return;const s={active:i};!0===e(n,t.options,s)&&(a.dndKit={capturedBy:t.sensor},O.current=r,ye(n,t))},[C,ye]));!function(e){n.useEffect(()=>{if(!rt)return;const t=e.map(e=>{let{sensor:t}=e;return null==t.setup?void 0:t.setup()});return()=>{for(const e of t)null==e||e()}},e.map(e=>{let{sensor:t}=e;return t}))}(m),ut(()=>{X&&w===ur.Initializing&&N(ur.Initialized)},[X,w]),n.useEffect(()=>{const{onDragMove:e}=$.current,{active:t,activatorEvent:n,collisions:r,over:a}=J.current;if(!t||!n)return;const i={active:t,activatorEvent:n,collisions:r,delta:{x:pe.x,y:pe.y},over:a};d.unstable_batchedUpdates(()=>{null==e||e(i),b({type:"onDragMove",event:i})})},[pe.x,pe.y]),n.useEffect(()=>{const{active:e,activatorEvent:t,collisions:n,droppableContainers:r,scrollAdjustedTranslate:a}=J.current;if(!e||null==O.current||!t||!a)return;const{onDragOver:i}=$.current,s=r.get(ve),o=s&&s.rect.current?{id:s.id,rect:s.rect.current,data:s.data,disabled:s.disabled}:null,l={active:e,activatorEvent:t,collisions:n,delta:{x:a.x,y:a.y},over:o};d.unstable_batchedUpdates(()=>{fe(o),null==i||i(l),b({type:"onDragOver",event:l})})},[ve]),ut(()=>{J.current={activatorEvent:T,active:R,activeNode:U,collisionRect:he,collisions:ge,droppableRects:F,draggableNodes:C,draggingNode:ee,draggingNodeRect:te,droppableContainers:q,over:xe,scrollableAncestors:se,scrollAdjustedTranslate:pe},I.current={initial:te,translated:he}},[R,U,ge,he,C,ee,te,F,q,xe,se,pe]),Wn({...V,delta:D,draggingRect:he,pointerCoordinates:ce,scrollableAncestors:se,scrollableAncestorRects:oe});const Ne=n.useMemo(()=>({active:R,activeNode:U,activeNodeRect:X,activatorEvent:T,collisions:ge,containerNodeRect:Q,dragOverlay:Z,draggableNodes:C,droppableContainers:q,droppableRects:F,over:xe,measureDroppableContainers:B,scrollableAncestors:se,scrollableAncestorRects:oe,measuringConfiguration:L,measuringScheduled:K,windowRect:ie}),[R,U,X,T,ge,Q,Z,C,q,F,xe,B,se,oe,L,K,ie]),je=n.useMemo(()=>({activatorEvent:T,activators:we,active:R,activeNodeRect:X,ariaDescribedById:{draggable:W},dispatch:_,draggableNodes:C,over:xe,measureDroppableContainers:B}),[T,we,R,X,_,W,C,xe,B]);return c.createElement(It.Provider,{value:y},c.createElement(ir.Provider,{value:je},c.createElement(sr.Provider,{value:Ne},c.createElement(dr.Provider,{value:_e},u)),c.createElement(cr,{disabled:!1===(null==o?void 0:o.restoreFocus)})),c.createElement(Et,{...o,hiddenTextDescribedById:W}))}),hr=n.createContext(null),gr="button";function vr(e){let{id:t,data:r,disabled:a=!1,attributes:i}=e;const s=ft("Draggable"),{activators:o,activatorEvent:l,active:c,activeNodeRect:d,ariaDescribedById:u,draggableNodes:m,over:p}=n.useContext(ir),{role:h=gr,roleDescription:g="draggable",tabIndex:v=0}=null!=i?i:{},x=(null==c?void 0:c.id)===t,f=n.useContext(x?dr:hr),[_,b]=gt(),[y,w]=gt(),N=function(e,t){return n.useMemo(()=>e.reduce((e,n)=>{let{eventName:r,handler:a}=n;return e[r]=e=>{a(e,t)},e},{}),[e,t])}(o,t),j=pt(r);ut(()=>(m.set(t,{id:t,key:s,node:_,activatorNode:y,data:j}),()=>{const e=m.get(t);e&&e.key===s&&m.delete(t)}),[m,t]);return{active:c,activatorEvent:l,activeNodeRect:d,attributes:n.useMemo(()=>({role:h,tabIndex:v,"aria-disabled":a,"aria-pressed":!(!x||h!==gr)||void 0,"aria-roledescription":g,"aria-describedby":u.draggable}),[a,h,v,x,g,u.draggable]),isDragging:x,listeners:a?void 0:N,node:_,over:p,setNodeRef:b,setActivatorNodeRef:w,transform:f}}const xr={timeout:25};function fr(e,t,n){const r=e.slice();return r.splice(n<0?r.length+n:n,0,r.splice(t,1)[0]),r}function _r(e,t){return e.reduce((e,n,r)=>{const a=t.get(n);return a&&(e[r]=a),e},Array(e.length))}function br(e){return null!==e&&e>=0}const yr=e=>{let{rects:t,activeIndex:n,overIndex:r,index:a}=e;const i=fr(t,r,n),s=t[a],o=i[a];return o&&s?{x:o.left-s.left,y:o.top-s.top,scaleX:o.width/s.width,scaleY:o.height/s.height}:null},wr={scaleX:1,scaleY:1},Nr=e=>{var t;let{activeIndex:n,activeNodeRect:r,index:a,rects:i,overIndex:s}=e;const o=null!=(t=i[n])?t:r;if(!o)return null;if(a===n){const e=i[s];return e?{x:0,y:n<s?e.top+e.height-(o.top+o.height):e.top-o.top,...wr}:null}const l=function(e,t,n){const r=e[t],a=e[t-1],i=e[t+1];if(!r)return 0;if(n<t)return a?r.top-(a.top+a.height):i?i.top-(r.top+r.height):0;return i?i.top-(r.top+r.height):a?r.top-(a.top+a.height):0}(i,a,n);return a>n&&a<=s?{x:0,y:-o.height-l,...wr}:a<n&&a>=s?{x:0,y:o.height+l,...wr}:{x:0,y:0,...wr}};const jr="Sortable",Sr=c.createContext({activeIndex:-1,containerId:jr,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:yr,disabled:{draggable:!1,droppable:!1}});function Cr(e){let{children:t,id:r,items:a,strategy:i=yr,disabled:s=!1}=e;const{active:o,dragOverlay:l,droppableRects:d,over:u,measureDroppableContainers:m}=n.useContext(sr),p=ft(jr,r),h=Boolean(null!==l.rect),g=n.useMemo(()=>a.map(e=>"object"==typeof e&&"id"in e?e.id:e),[a]),v=null!=o,x=o?g.indexOf(o.id):-1,f=u?g.indexOf(u.id):-1,_=n.useRef(g),b=!function(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}(g,_.current),y=-1!==f&&-1===x||b,w=function(e){return"boolean"==typeof e?{draggable:e,droppable:e}:e}(s);ut(()=>{b&&v&&m(g)},[b,g,v,m]),n.useEffect(()=>{_.current=g},[g]);const N=n.useMemo(()=>({activeIndex:x,containerId:p,disabled:w,disableTransforms:y,items:g,overIndex:f,useDragOverlay:h,sortedRects:_r(g,d),strategy:i}),[x,p,w.draggable,w.droppable,y,g,f,d,h,i]);return c.createElement(Sr.Provider,{value:N},t)}const Dr=e=>{let{id:t,items:n,activeIndex:r,overIndex:a}=e;return fr(n,r,a).indexOf(t)},qr=e=>{let{containerId:t,isSorting:n,wasDragging:r,index:a,items:i,newIndex:s,previousItems:o,previousContainerId:l,transition:c}=e;return!(!c||!r)&&((o===i||a!==s)&&(!!n||s!==a&&t===l))},kr={duration:200,easing:"ease"},Ir="transform",Rr=jt.Transition.toString({property:Ir,duration:0,easing:"linear"}),Or={roleDescription:"sortable"};function Er(e){let{animateLayoutChanges:t=qr,attributes:r,disabled:a,data:i,getNewIndex:s=Dr,id:o,strategy:l,resizeObserverConfig:c,transition:d=kr}=e;const{items:u,containerId:m,activeIndex:p,disabled:h,disableTransforms:g,sortedRects:v,overIndex:x,useDragOverlay:f,strategy:_}=n.useContext(Sr),b=function(e,t){var n,r;if("boolean"==typeof e)return{draggable:e,droppable:!1};return{draggable:null!=(n=null==e?void 0:e.draggable)?n:t.draggable,droppable:null!=(r=null==e?void 0:e.droppable)?r:t.droppable}}(a,h),y=u.indexOf(o),w=n.useMemo(()=>({sortable:{containerId:m,index:y,items:u},...i}),[m,i,y,u]),N=n.useMemo(()=>u.slice(u.indexOf(o)),[u,o]),{rect:j,node:S,isOver:C,setNodeRef:D}=function(e){let{data:t,disabled:r=!1,id:a,resizeObserverConfig:i}=e;const s=ft("Droppable"),{active:o,dispatch:l,over:c,measureDroppableContainers:d}=n.useContext(ir),u=n.useRef({disabled:r}),m=n.useRef(!1),p=n.useRef(null),h=n.useRef(null),{disabled:g,updateMeasurementsFor:v,timeout:x}={...xr,...i},f=pt(null!=v?v:a),_=Un({callback:n.useCallback(()=>{m.current?(null!=h.current&&clearTimeout(h.current),h.current=setTimeout(()=>{d(Array.isArray(f.current)?f.current:[f.current]),h.current=null},x)):m.current=!0},[x]),disabled:g||!o}),b=n.useCallback((e,t)=>{_&&(t&&(_.unobserve(t),m.current=!1),e&&_.observe(e))},[_]),[y,w]=gt(b),N=pt(t);return n.useEffect(()=>{_&&y.current&&(_.disconnect(),m.current=!1,_.observe(y.current))},[y,_]),n.useEffect(()=>(l({type:Mt.RegisterDroppable,element:{id:a,key:s,disabled:r,node:y,rect:p,data:N}}),()=>l({type:Mt.UnregisterDroppable,key:s,id:a})),[a]),n.useEffect(()=>{r!==u.current.disabled&&(l({type:Mt.SetDroppableDisabled,id:a,key:s,disabled:r}),u.current.disabled=r)},[a,s,r,l]),{active:o,rect:p,isOver:(null==c?void 0:c.id)===a,node:y,over:c,setNodeRef:w}}({id:o,data:w,disabled:b.droppable,resizeObserverConfig:{updateMeasurementsFor:N,...c}}),{active:q,activatorEvent:k,activeNodeRect:I,attributes:R,setNodeRef:O,listeners:E,isDragging:M,over:T,setActivatorNodeRef:A,transform:$}=vr({id:o,data:w,attributes:{...Or,...r},disabled:b.draggable}),W=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return n.useMemo(()=>e=>{t.forEach(t=>t(e))},t)}(D,O),P=Boolean(q),L=P&&!g&&br(p)&&br(x),z=!f&&M,F=z&&L?$:null,B=L?null!=F?F:(null!=l?l:_)({rects:v,activeNodeRect:I,activeIndex:p,overIndex:x,index:y}):null,K=br(p)&&br(x)?s({id:o,items:u,activeIndex:p,overIndex:x}):y,U=null==q?void 0:q.id,H=n.useRef({activeId:U,items:u,newIndex:K,containerId:m}),V=u!==H.current.items,Y=t({active:q,containerId:m,isDragging:M,isSorting:P,id:o,index:y,items:u,newIndex:H.current.newIndex,previousItems:H.current.items,previousContainerId:H.current.containerId,transition:d,wasDragging:null!=H.current.activeId}),X=function(e){let{disabled:t,index:r,node:a,rect:i}=e;const[s,o]=n.useState(null),l=n.useRef(r);return ut(()=>{if(!t&&r!==l.current&&a.current){const e=i.current;if(e){const t=Xt(a.current,{ignoreTransform:!0}),n={x:e.left-t.left,y:e.top-t.top,scaleX:e.width/t.width,scaleY:e.height/t.height};(n.x||n.y)&&o(n)}}r!==l.current&&(l.current=r)},[t,r,a,i]),n.useEffect(()=>{s&&o(null)},[s]),s}({disabled:!Y,index:y,node:S,rect:j});return n.useEffect(()=>{P&&H.current.newIndex!==K&&(H.current.newIndex=K),m!==H.current.containerId&&(H.current.containerId=m),u!==H.current.items&&(H.current.items=u)},[P,K,m,u]),n.useEffect(()=>{if(U===H.current.activeId)return;if(null!=U&&null==H.current.activeId)return void(H.current.activeId=U);const e=setTimeout(()=>{H.current.activeId=U},50);return()=>clearTimeout(e)},[U]),{active:q,activeIndex:p,attributes:R,data:w,rect:j,index:y,newIndex:K,items:u,isOver:C,isSorting:P,isDragging:M,listeners:E,node:S,overIndex:x,over:T,setNodeRef:W,setActivatorNodeRef:A,setDroppableNodeRef:D,setDraggableNodeRef:O,transform:null!=X?X:B,transition:function(){if(X||V&&H.current.newIndex===y)return Rr;if(z&&!wt(k)||!d)return;if(P||Y)return jt.Transition.toString({...d,property:Ir});return}()}}function Mr({children:e,onConfirm:r,disabled:a=!1,placeholder:i="  ",align:s="center",side:o="bottom",defaultDate:l,defaultAmount:c}){const[d,m]=n.useState(!1),[p,h]=n.useState(l),[g,v]=n.useState(c?.toString()||"");return t.jsxs(te,{open:d,onOpenChange:m,children:[t.jsx(ne,{asChild:!0,disabled:a,children:e}),t.jsx(re,{className:"w-auto p-0 border-gray-200 shadow-lg",align:s,side:o,sideOffset:8,children:t.jsxs("div",{className:"bg-white business-radius-card p-3",children:[t.jsx("div",{className:"mb-2 px-1",children:t.jsx("div",{className:"modal-label text-gray-600 text-center",children:i})}),t.jsx(Q,{mode:"single",selected:p,onSelect:h,locale:J,initialFocus:!0,className:"compact-calendar",disabled:!1,fromDate:new Date("2020-01-01"),toDate:new Date("2030-12-31"),defaultMonth:p||new Date,modifiers:{today:new Date},modifiersClassNames:{today:"bg-blue-500 text-white font-semibold cursor-pointer hover:bg-blue-600 rounded-md"}}),t.jsxs("div",{className:"mt-3 px-1",children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:""}),t.jsx(B,{type:"text",value:g,onChange:e=>{const t=e.target.value.replace(/[^0-9]/g,"");if(t){const e=parseInt(t,10);v(e.toLocaleString())}else v("")},placeholder:" ",className:"w-full"})]}),t.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[t.jsx(u,{variant:"outline",size:"sm",onClick:()=>m(!1),children:""}),t.jsx(u,{size:"sm",onClick:()=>{if(!p)return;const e=parseFloat(g.replace(/,/g,""));isNaN(e)||e<=0||(r(p,e),m(!1),h(l),v(c?.toString()||""))},disabled:!p||!g||parseFloat(g.replace(/,/g,""))<=0,className:"button-base button-action-primary",children:""})]})]})})]})}function Tr({children:e,onConfirm:r,disabled:a=!1,placeholder:i="  ",align:s="center",side:o="bottom",defaultDate:l,defaultQuantity:c,maxQuantity:d,hideQuantityInput:m=!1,quantityInfoText:p="   "}){const[h,g]=n.useState(!1),[v,x]=n.useState(l),[f,_]=n.useState(c?.toString()||"");return t.jsxs(te,{open:h,onOpenChange:g,children:[t.jsx(ne,{asChild:!0,disabled:a,children:e}),t.jsx(re,{className:"w-auto p-0 border-gray-200 shadow-lg",align:s,side:o,sideOffset:8,children:t.jsxs("div",{className:"bg-white business-radius-card p-3",children:[t.jsx("div",{className:"mb-2 px-1",children:t.jsx("div",{className:"modal-label text-gray-600 text-center",children:i})}),m&&t.jsx("div",{className:"mb-2 px-1",children:t.jsxs("div",{className:"text-[10px] text-gray-500 text-center leading-tight",children:[t.jsx("div",{children:" "}),t.jsx("div",{children:" "})]})}),t.jsx(Q,{mode:"single",selected:v,onSelect:x,locale:J,initialFocus:!0,className:"compact-calendar",disabled:!1,fromDate:new Date("2020-01-01"),toDate:new Date("2030-12-31"),defaultMonth:v||new Date,modifiers:{today:new Date},modifiersClassNames:{today:"bg-blue-500 text-white font-semibold cursor-pointer hover:bg-blue-600 rounded-md"}}),!m&&t.jsxs("div",{className:"mt-3 px-1",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1 gap-2",children:[t.jsx("label",{className:"block text-xs font-medium text-gray-700",children:p?.includes("")?"":""}),void 0!==d&&t.jsx(u,{type:"button",variant:"outline",size:"sm",onClick:()=>{void 0!==d&&_(d.toString())},className:"h-6 px-2 text-[10px] border-gray-200 text-hansl-600",children:p?.includes("")?"  ":" "})]}),t.jsx(B,{type:"number",value:f,onChange:e=>{const t=e.target.value.replace(/[^0-9]/g,"");_(t)},placeholder:" ",className:"border-gray-200 rounded-lg text-center w-full !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400",min:"0",max:d}),d&&t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:p?.includes("")?p:`: ${d.toLocaleString()}`})]}),t.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[t.jsx(u,{variant:"outline",size:"sm",onClick:()=>g(!1),className:"button-base",children:""}),t.jsx(u,{size:"sm",onClick:()=>{if(!v)return;if(m)return r(v,void 0),g(!1),x(l),void _(c?.toString()||"");const e=parseFloat(f.replace(/,/g,""));isNaN(e)||e<0||d&&e>d||(r(v,e),g(!1),x(l),_(c?.toString()||""))},disabled:!v||!m&&(!f||parseFloat(f.replace(/,/g,""))<0||void 0!==d&&parseFloat(f.replace(/,/g,""))>d),className:"button-base button-action-primary",children:""})]})]})})]})}function Ar({config:e,currentUserName:t,canPerformAction:r,purchaseId:a,onUpdate:i,onOptimisticUpdate:s}){const o=m(),l=n.useCallback(async(n,l,c,d)=>{if(!r)return p.warn("  ",{canPerformAction:r,currentUserName:t}),void se.error(("statement_received"===e.field?"":"")+"   .");const u="number"==typeof n?n:Number(n);if(Number.isNaN(u))return p.error("  ID",{itemId:n,numericId:u}),void se.error("   ID .");if(c){const t=`: ${c.item_name||"-"}\n: ${c.specification||"-"}\n: ${c.quantity?.toLocaleString()||0}\n: ${c.unit_price_value?.toLocaleString()||0}\n: ${c.amount_value?.toLocaleString()||0}\n: ${c.remark||"-"}\n\n${e.confirmMessage.confirm}`;if(!window.confirm(t))return}try{let n;if("statement_received"===e.field)n={is_statement_received:!0,statement_received_date:l.toISOString(),statement_received_by_name:t};else if("actual_received"===e.field){const e=c?.quantity||0,r=c?.received_quantity||0,a=void 0!==d?d:e,i=r+a,{data:s}=await o.from("purchase_request_items").select("receipt_history").eq("id",u).single(),m=s?.receipt_history||[],h={seq:m.length+1,qty:a,date:l.toISOString(),by:t||""},g=[...m,h],v=i>=e;n={actual_received_date:l.toISOString(),is_received:v,received_quantity:i,delivery_status:0===i?"pending":v?"received":"partial",receipt_history:g},p.debug("   :",{requestedQuantity:e,currentReceivedQuantity:r,newReceivedQuantity:a,totalReceivedQuantity:i,isFullyReceived:v,historyCount:g.length})}p.debug("  :",n);const{data:r,error:m}=await o.from("purchase_request_items").update(n).eq("id",u).select();if(p.debug(" DB  :",{data:r,error:m}),m)throw p.error(" DB  ",m),m;if(p.info(" DB  ",r),a)if("actual_received"===e.field){h(a,u,l.toISOString(),d)||p.warn("[useConfirmDateAction]     ",{purchaseId:a,itemId:u})}else if("statement_received"===e.field){g(a,u,l.toISOString(),t||void 0)||p.warn("[useConfirmDateAction]      ",{purchaseId:a,itemId:u})}s&&s({itemId:u,selectedDate:l,action:"confirm",receivedQuantity:void 0!==d?d:c?.received_quantity,itemInfo:c}),i&&i(),se.success(e.successMessage.confirm)}catch(m){p.error("   ",m),se.error(("statement_received"===e.field?"":"")+"     .")}},[e,t,r,a,i,s,o]),c=n.useCallback(async(n,l)=>{if(!r)return p.warn("   ",{canPerformAction:r,currentUserName:t}),void se.error(("statement_received"===e.field?"":"")+"   .");const c="number"==typeof n?n:Number(n);if(Number.isNaN(c))se.error("   ID .");else{if(l){const t=`: ${l.item_name||"-"}\n: ${l.specification||"-"}\n: ${l.quantity?.toLocaleString()||0}\n: ${l.unit_price_value?.toLocaleString()||0}\n: ${l.amount_value?.toLocaleString()||0}\n: ${l.remark||"-"}\n\n${e.confirmMessage.cancel}`;if(!window.confirm(t))return}try{let t;p.debug(` ${e.field}   `,{itemId:n,itemName:l?.item_name}),"statement_received"===e.field?t={is_statement_received:!1,statement_received_date:null,statement_received_by_name:null}:"actual_received"===e.field&&(t={actual_received_date:null,is_received:!1,received_quantity:0,delivery_status:"pending",receipt_history:[]}),p.debug("   :",t);const{data:r,error:d}=await o.from("purchase_request_items").update(t).eq("id",c).select();if(p.debug("  DB  :",{data:r,error:d}),d)throw p.error(" DB  ",d),d;if(p.info(` ${e.field}   `,r),a)if("actual_received"===e.field){v(a,c)||p.warn("[useConfirmDateAction]     ",{purchaseId:a,itemId:c})}else if("statement_received"===e.field){x(a,c)||p.warn("[useConfirmDateAction]      ",{purchaseId:a,itemId:c})}s&&s({itemId:c,action:"cancel",itemInfo:l}),i&&i(),se.success(e.successMessage.cancel)}catch(d){p.error(` ${e.field}   `,d),se.error(("statement_received"===e.field?"":"")+"     .")}}},[e,r,a,i,s,o]),d=n.useCallback(t=>"statement_received"===e.field?t.is_statement_received:"actual_received"===e.field&&t.is_received,[e.field]),u=n.useCallback(t=>{if("actual_received"===e.field){const e=t.received_quantity||0,n=t.quantity||0;return e>0&&e<n}return!1},[e.field]),f=n.useCallback(e=>{const t=e.received_quantity||0,n=e.quantity||0;return Math.max(0,n-t)},[]),_=n.useCallback(t=>"statement_received"===e.field?t.statement_received_date:"actual_received"===e.field?t.actual_received_date:null,[e.field]),b=n.useCallback(t=>"statement_received"===e.field?t.statement_received_by_name:(e.field,null),[e.field]);return{config:e,handleConfirm:l,handleCancel:c,isCompleted:d,isPartiallyReceived:u,getRemainingQuantity:f,getCompletedDate:_,getCompletedByName:b}}fn.Down,fn.Right,fn.Up,fn.Left;const $r=[{id:"statement_progress",label:"",description:"  ",defaultVisible:!0},{id:"purchase_order_number",label:"",description:" ",defaultVisible:!0},{id:"payment_category",label:"",description:"  (, ,  )",defaultVisible:!0},{id:"requester_name",label:"",description:"  ",defaultVisible:!0},{id:"request_date",label:"",description:"  ",defaultVisible:!0},{id:"utk_status",label:"UTK",description:"UTK  ",defaultVisible:!0},{id:"vendor_name",label:"",description:"",defaultVisible:!0},{id:"contact_name",label:"",description:" ",defaultVisible:!0},{id:"delivery_request_date",label:"",description:"  ",defaultVisible:!0},{id:"revised_delivery_date",label:"",description:"  ",defaultVisible:!0},{id:"item_name",label:"",description:" ",defaultVisible:!0},{id:"specification",label:"",description:"  ",defaultVisible:!0},{id:"quantity",label:"",description:" ",defaultVisible:!0},{id:"unit_price",label:"",description:" ",defaultVisible:!0},{id:"amount",label:"",description:" ",defaultVisible:!0},{id:"remark",label:"",description:"  ",defaultVisible:!0},{id:"link",label:"",description:" ",defaultVisible:!0},{id:"project_vendor",label:"PJ",description:" ",defaultVisible:!0},{id:"project_item",label:"PJ ITEM",description:" ",defaultVisible:!0},{id:"sales_order_number",label:"",description:" ",defaultVisible:!0},{id:"purchase_progress",label:"",description:" ",defaultVisible:!0},{id:"receipt_progress",label:"",description:" ",defaultVisible:!0}],Wr=$r.reduce((e,t)=>(e[t.id]=t.defaultVisible,e),{});$r.reduce((e,t)=>(e[t.id]=t,e),{});const Pr=["purchase_order_number","vendor_name","item_name","specification"],Lr=["statement_progress","utk_status","unit_price","amount"],zr=["app_admin","ceo","final_approver","purchase_manager","lead buyer","accounting"],Fr=[{title:" ",columns:["statement_progress","purchase_order_number","payment_category","requester_name","request_date","utk_status"]},{title:" ",columns:["vendor_name","contact_name","delivery_request_date","revised_delivery_date"]},{title:" ",columns:["item_name","specification","quantity","unit_price","amount","remark","link"]},{title:" ",columns:["project_vendor","project_item","sales_order_number"]},{title:" ",columns:["purchase_progress","receipt_progress"]}],Br=({id:e,children:n})=>{const{attributes:r,listeners:a,setNodeRef:i,transform:s,transition:o,isDragging:l}=Er({id:e}),c={transform:jt.Transform.toString(s),transition:o};return t.jsx(t.Fragment,{children:n({setNodeRef:i,attributes:r,listeners:a,isDragging:l,style:c})})};const Kr=n.memo(function({purchaseId:e,isOpen:r,onClose:a,embedded:i=!1,currentUserRoles:s=[],activeTab:o,onRefresh:l,onOptimisticUpdate:c,onDelete:d}){const{allPurchases:v,lastFetch:x}=f(),[E,M]=n.useState(!1),[T,A]=n.useState(null),[$,W]=n.useState(!1),[P,L]=n.useState(null),[z,F]=n.useState([]),[Q,J]=n.useState([]),[ye,we]=n.useState([]),[Ne,je]=n.useState(""),[Se,Ce]=n.useState([]),[De,qe]=n.useState(null),[ke,Ie]=n.useState([]),[Re,Oe]=n.useState(""),[Ee,Me]=n.useState(!1),[Te,Ae]=n.useState(""),[$e,We]=n.useState(""),[Pe,Le]=n.useState(!1),[ze,Fe]=n.useState(!1),[Be,Ke]=n.useState([]),[Ue,He]=n.useState(!1),[Ve,Ye]=n.useState(""),Xe=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return n.useMemo(()=>[...t].filter(e=>null!=e),[...t])}((Qe=kn,Je={activationConstraint:{distance:4}},n.useMemo(()=>({sensor:Qe,options:null!=Je?Je:{}}),[Qe,Je])));var Qe,Je;const Ge=n.useCallback((e,t)=>e?.stableKey??(null!=e?.id?`sk-item-${e.id}`:e?.tempId?`sk-tmp-${e.tempId}`:null!=e?.line_number?`sk-line-${e.line_number}-${t}`:`sk-idx-${t}`),[]),Ze=n.useCallback((e=[])=>e.map((e,t)=>{const n={...e,tempId:e?.tempId??`tmp-${e?.id??e?.line_number??t}-${t}`};return{...n,stableKey:Ge(n,t)}}),[Ge]),et=n.useCallback((e,t)=>e?.stableKey?e.stableKey:null!=e?.id?`item-${e.id}`:e?.tempId?`tmp-${e.tempId}`:null!=e?.line_number?`line-${e.line_number}`:`temp-${t}`,[]),tt=n.useCallback(e=>{const{active:t,over:n}=e;n&&t.id!==n.id&&F(e=>{const r=e.findIndex((e,n)=>et(e,n)===t.id),a=e.findIndex((e,t)=>et(e,t)===n.id);if(-1===r||-1===a)return e;return fr(e,r,a).map((e,t)=>({...e,line_number:t+1,stableKey:e.stableKey??Ge(e,t)}))})},[et,Ge]);n.useEffect(()=>{Ee&&T&&(Ae(`[]  ${T.purchase_order_number}  .`),We(""))},[Ee,T]);const nt=n.useRef($);n.useEffect(()=>{nt.current=$},[$]);const rt=n.useRef(!0);n.useEffect(()=>{if(!r||!e)return;const t=_(()=>{if(rt.current)return void(rt.current=!1);if(nt.current)return;const t=b(e);if(t){const e=t.items||t.purchase_request_items||[];A(n=>{const r=n?.items||n?.purchase_request_items||[],a=r.length>0&&0===e.length?r:e;return{...t,id:String(t.id),is_po_generated:!1,items:a,purchase_request_items:a}})}});return()=>t()},[r,e]);const at=n.useRef([]),it=n.useMemo(()=>{let t=[];if(T?.items&&T.items.length>0)t=Ze(T.items);else if(T?.purchase_request_items&&T.purchase_request_items.length>0)t=Ze(T.purchase_request_items);else if(e&&v){const n=v.find(t=>t.id===e);if(n){const e=n.items&&n.items.length>0?n.items:n.purchase_request_items||[];t=Ze(e)}}return 0===t.length&&at.current.length>0?at.current:(t.length>0&&(at.current=t),t)},[T,e,v,x,Ze]),st=n.useMemo(()=>{if($)return z||[];return[...it||[]].sort((e,t)=>{const n=e?.line_number??999999,r=t?.line_number??999999;if(n!==r)return n-r;const a=e?.created_at?new Date(e.created_at).getTime():0,i=t?.created_at?new Date(t.created_at).getTime():0;if(a!==i)return a-i;const s=e?.id??0,o=t?.id??0;if(s!==o)return s-o;const l=e?.tempId??"",c=t?.tempId??"";return l<c?-1:l>c?1:0})},[$,z,it]),ot=n.useMemo(()=>(z||[]).map((e,t)=>et(e,t)),[z,et]);n.useMemo(()=>{if(Se.length>0){const e=Se.length>1?12*(Se.length-1):0,t=24,n=Se.reduce((e,t)=>e+t,0)+e+t;return Math.max(n,720)}const e=[120,200,70,90,100,150,80];"purchase"===o&&e.push(120),"receipt"!==o&&"done"!==o||e.push(120),"receipt"===o&&e.push(140),"done"===o&&e.push(100,80,110),$&&e.push(110);const t=e.length>1?12*(e.length-1):0,n=e.reduce((e,t)=>e+t,0)+t+48;return Math.max(n,720)},[Se,o,$]);const lt=n.useRef(null),ct=m();n.useEffect(()=>{r&&(async()=>{try{const e="https://qvhbigvdfyvhoegkhvef.supabase.co";if(!e||e.includes("placeholder"))return void p.warn("Supabase     - PurchaseDetailModal");const{data:{user:t}}=await ct.auth.getUser();if(t){let{data:e}=await ct.from("employees").select("*").eq("id",t.id).maybeSingle();if(!e&&t.email){const{data:n}=await ct.from("employees").select("*").eq("email",t.email).maybeSingle();e=n}if(e?.name&&je(e.name),e?.purchase_role){let t=[];t=Array.isArray(e.purchase_role)?e.purchase_role.map(e=>String(e).trim()):String(e.purchase_role).split(",").map(e=>e.trim()).filter(e=>e.length>0),we(t)}}}catch(e){}})()},[r]),n.useEffect(()=>{r&&(async()=>{try{const{data:e,error:t}=await ct.from("vendors").select("*").order("vendor_name",{ascending:!0});if(t)throw t;e&&Ie(e)}catch(e){p.error("   :",e)}})()},[r]);const dt=Array.isArray(s)&&s.length>0?s:ye,ut=dt.includes("final_approver")||dt.includes("app_admin")||dt.includes("ceo"),mt=dt.includes("lead buyer"),pt=ut||mt,ht=dt.some(e=>zr.includes(e)),gt=""===T?.payment_category&&("done"===o||"receipt"===o&&dt.includes("lead buyer")),vt=""===T?.payment_category&&"done"===o,xt="approved"===T?.final_manager_status?ut:ut||T?.requester_name===Ne,ft=dt.includes("app_admin")||dt.includes("lead buyer")||dt.includes("lead buyer"),_t=dt.includes("app_admin")||T?.requester_name===Ne,bt=dt.includes("final_approver")||dt.includes("app_admin")||dt.includes("ceo"),yt=T?.requester_name===Ne,wt=dt.includes("app_admin")||dt.includes("lead buyer")||dt.includes("accounting"),Nt=dt.includes("app_admin")||yt,jt=n.useCallback(async()=>{if(e)try{const t=m(),{data:n,error:r}=await t.from("purchase_requests").select("\n          *,\n          vendors:vendor_id(id, vendor_name, is_active),\n          purchase_request_items(*),\n          contact:contact_id(id, contact_name, contact_email, contact_phone, position)\n        ").eq("id",e).single();if(r)throw r;let a=[];if(n&&n.vendor_id){const{data:e}=await t.from("vendor_contacts").select("id, contact_name, contact_email, contact_phone, position").eq("vendor_id",n.vendor_id).order("contact_name");if(e&&e.length>0){if(n.contact_id){const t=e.find(e=>e.id===n.contact_id),r=e.filter(e=>e.id!==n.contact_id);a=t?[t,...r]:e}else a=e;p.info("    :",{vendor_id:n.vendor_id,contact_id:n.contact_id,allContacts_count:e.length,vendorContacts:a})}}else n&&n.contact&&(a=[n.contact]);if(n){const e=Ze((n.purchase_request_items||[]).sort((e,t)=>(e.line_number||999999)-(t.line_number||999999))),t={...n,items:e,vendor:n.vendors||null,vendor_contacts:a,contact_id:n.contact_id,contact_name:a[0]?.contact_name||n.contact?.contact_name||null};A({...t,items:e}),L(t),F(e),p.info(" refreshModalData DB  :",{vendor_contacts:t.vendor_contacts,vendorContacts_from_query:a,purchase_updated:!0,vendor_id:n.vendor_id,has_vendor_contacts:a&&a.length>0})}}catch(t){p.error("   ",t)}},[e]);n.useEffect(()=>{if(!e||!v||!T)return;if($)return;const t=v.find(t=>t.id===e);if(t){const e=Ze(t.items&&t.items.length>0?t.items:t.purchase_request_items||[]),n={...T,...t,id:String(t.id),items:e,purchase_request_items:e};A(n),L(n),F(e.length>0?e:[])}},[v,x,$]),n.useEffect(()=>{if(!r||!e||!v)return;if($)return;const t=v.find(t=>t.id===e);if(t){const e=Ze(t.items&&t.items.length>0?t.items:t.purchase_request_items||[]),n={...t,id:String(t.id),is_po_generated:!1,items:e,purchase_request_items:e,vendor:{id:t.vendor_id,vendor_name:t.vendor_name||"  ",is_active:!0,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},vendor_contacts:[]};A(n),L(n),F(e.length>0?e:[])}},[r,e,v,$]);const[St,Ct]=n.useState(!0),Dt=e?Number(e):T?Number(T.id):NaN,qt=n.useCallback(({itemId:e,selectedDate:t,action:n,receivedQuantity:r})=>{const a=String(e),i=(new Date).toISOString(),s=t?t.toISOString():void 0,o=e=>e?e.map(e=>String(e.id)!==a?e:"confirm"===n?{...e,is_received:!0,actual_received_date:s,received_at:i,received_quantity:void 0!==r?r:e.received_quantity}:{...e,is_received:!1,actual_received_date:void 0,received_at:void 0,received_quantity:void 0}):e;A(e=>{if(!e)return e;const t=o(e.items)||[],n=o(e.purchase_request_items)||[],r=t.length,a=t.filter(e=>e.is_received).length,s=r>0&&a===r;return{...e,items:t,purchase_request_items:n,is_received:s,received_at:s?e.received_at||i:void 0,updated_at:(new Date).toISOString()}}),L(e=>{if(!e)return e;const t=o(e.items)||[],n=o(e.purchase_request_items)||[];return{...e,items:t,purchase_request_items:n}}),F(e=>e&&0!==e.length?e.map(e=>e.id&&String(e.id)===a?"confirm"===n?{...e,is_received:!0,actual_received_date:s,received_at:i,received_quantity:void 0!==r?r:e.received_quantity}:{...e,is_received:!1,actual_received_date:void 0,received_at:void 0,received_quantity:void 0}:e):e),Number.isNaN(Dt)||c?.(Dt,e=>{const t=o(e.items)||e.items||[],n=o(e.purchase_request_items)||e.purchase_request_items||[],r=t.length||e.items?.length||0,a=t.filter(e=>e.is_received).length,s=r>0&&a===r;return{...e,items:t,purchase_request_items:n,is_received:s,received_at:s?e.received_at||i:void 0,updated_at:(new Date).toISOString()}})},[c,Dt]),kt=n.useCallback(({itemId:e,selectedDate:t,action:n})=>{const r=String(e),a=t?t.toISOString():void 0;let i=!1,s=null;if(A(e=>{if(!e)return e;const t=(e.items||[]).map(e=>String(e.id)!==r?e:"confirm"===n?{...e,is_statement_received:!0,statement_received_date:a,statement_received_by_name:Ne}:{...e,is_statement_received:!1,statement_received_date:null,statement_received_by_name:null});return i=t.length>0&&t.every(e=>e.is_statement_received),s=i?a||e.statement_received_at||(new Date).toISOString():null,{...e,items:t,is_statement_received:i,statement_received_at:s}}),L(e=>{if(!e)return e;const t=(e.items||[]).map(e=>String(e.id)!==r?e:"confirm"===n?{...e,is_statement_received:!0,statement_received_date:a,statement_received_by_name:Ne}:{...e,is_statement_received:!1,statement_received_date:null,statement_received_by_name:null});return{...e,items:t,is_statement_received:i,statement_received_at:s}}),F(e=>e?e.map(e=>String(e.id)!==r?e:"confirm"===n?{...e,is_statement_received:!0,statement_received_date:a,statement_received_by_name:Ne}:{...e,is_statement_received:!1,statement_received_date:null,statement_received_by_name:null}):e),Number.isNaN(Dt)||c?.(Dt,e=>{const t=(e.items||[]).map(e=>String(e.id)!==r?e:"confirm"===n?{...e,is_statement_received:!0,statement_received_date:a,statement_received_by_name:Ne}:{...e,is_statement_received:!1,statement_received_date:null,statement_received_by_name:null}),i=t.length>0&&t.every(e=>e.is_statement_received);return{...e,items:t,is_statement_received:i}}),T&&void 0!==i){m().from("purchase_requests").update({is_statement_received:i,statement_received_at:s}).eq("id",T.id).then(({error:e})=>{e&&p.error("  purchase_requests  ",e)})}},[Ne,c,Dt,T]),It=Ar({config:{field:"statement_received",confirmMessage:{confirm:"  ?",cancel:"  ?"},successMessage:{confirm:"  .",cancel:"  ."},completedText:" ",waitingText:""},currentUserName:Ne,canPerformAction:wt,purchaseId:T?.id,onUpdate:jt,onOptimisticUpdate:kt}),Rt=Ar({config:{field:"actual_received",confirmMessage:{confirm:"   ?",cancel:"   ?"},successMessage:{confirm:"   .",cancel:"   ."},completedText:"",waitingText:""},currentUserName:Ne,canPerformAction:Nt,purchaseId:T?.id,onUpdate:jt,onOptimisticUpdate:qt}),Ot=dt.includes("middle_manager")||dt.includes("app_admin")||dt.includes("ceo"),Et=dt.includes("final_approver")||dt.includes("app_admin")||dt.includes("ceo"),Mt="inline-flex items-center gap-1 business-radius-badge !h-auto !min-h-0 !px-2.5 !py-0.5 badge-text leading-tight",Tt="inline-flex items-center gap-1 business-radius-badge px-2.5 py-0.5 badge-text leading-tight";n.useEffect(()=>{if(e&&r){const t=b(e);if(t){const e={...t,id:String(t.id),is_po_generated:!1,vendor:t.vendor||(t.vendor_id?{id:t.vendor_id,vendor_name:t.vendor_name||"  ",is_active:!0,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}:null),vendor_contacts:t.vendor_contacts||[]};A(e),L(e),F(t.items||[])}else zt(e.toString());W(!1),At(e)}},[e,r]);const At=async e=>{try{const t=await oe.getStatementsByPurchaseId(e);t.success&&t.data&&Ke(t.data)}catch(t){Ke([])}},$t=n.useCallback(()=>{const e=T?.items&&T.items.length>0?T.items:T?.purchase_request_items&&T.purchase_request_items.length>0?T.purchase_request_items:[];if(0===e.length)return[];const t=[{key:"line_number",minWidth:32,maxWidth:32,baseWidth:32,isFixed:!0},{key:"item_name",minWidth:80,maxWidth:500,baseWidth:80},{key:"specification",minWidth:80,maxWidth:200,baseWidth:150,isFixed:!1},{key:"quantity",minWidth:70,maxWidth:120,baseWidth:70},{key:"unit_price",minWidth:90,maxWidth:150,baseWidth:90},{key:"total_price",minWidth:100,maxWidth:180,baseWidth:100}];""===T?.payment_category&&t.push({key:"tax_amount",minWidth:80,maxWidth:150,baseWidth:80}),t.push({key:"link",minWidth:60,maxWidth:80,baseWidth:60,isFixed:!0}),t.push({key:"remarks",minWidth:150,maxWidth:150,baseWidth:150,isFixed:!0}),"pending"!==o&&t.push({key:"status",minWidth:70,maxWidth:100,baseWidth:70}),"receipt"===o&&(t.push({key:"actual_receipt_date",minWidth:100,maxWidth:160,baseWidth:100,isFixed:!1}),gt&&t.push({key:"transaction_confirm",minWidth:85,maxWidth:120,baseWidth:85,isFixed:!1},{key:"accounting_date",minWidth:70,maxWidth:70,baseWidth:70,isFixed:!0})),"done"===o&&""===T?.payment_category&&t.push({key:"transaction_confirm",minWidth:85,maxWidth:120,baseWidth:85,isFixed:!1},{key:"accounting_date",minWidth:70,maxWidth:70,baseWidth:70,isFixed:!0},{key:"expenditure_info",minWidth:90,maxWidth:150,baseWidth:90,isFixed:!1});const n=t.map((t,n)=>{let r=4;const a=(()=>{const e="purchase"===o?"":"receipt"===o||"done"===o?"":"",t="receipt"===o||"done"===o?"/ ":"",n="pending"===o?["#","","",t,"","",""===T?.payment_category?"":null,""].filter(e=>null!==e):["#","","",t,"","",""===T?.payment_category?"":null,"",e].filter(e=>null!==e);if("receipt"===o){const e=[...n,""];return gt&&e.push(" "," "),e}if("done"===o){const e=[...n];return gt&&(e.push(" "," "),vt&&e.push("")),e}return n})();if(a[n]&&(r=Math.max(r,a[n].length)),e.forEach(e=>{let n="";switch(t.key){case"line_number":n=e.line_number?.toString()||"";break;case"item_name":n=e.item_name||"";break;case"specification":n=e.specification||"";break;case"quantity":if("receipt"===o||"done"===o){const t=e.quantity||0,r=e.received_quantity??0;n=t>=100||r>=100?`${t}`:`${t}/${r}`}else n=e.quantity?.toString()||"";break;case"unit_price":n=null!=e.unit_price_value?e.unit_price_value.toLocaleString():"";break;case"total_price":n=null!=e.amount_value?e.amount_value.toLocaleString():null!=e.quantity&&null!=e.unit_price_value?(Number(e.quantity)*Number(e.unit_price_value)).toLocaleString():"";break;case"tax_amount":n=null!=e.tax_amount_value?e.tax_amount_value.toLocaleString():"";break;case"remarks":n=e.remark||"";break;case"status":n=Wt(e)||"";break;case"actual_receipt_date":n=e.actual_received_date?X(e.actual_received_date):"";break;case"transaction_confirm":n=e.is_statement_received?"":"";break;case"accounting_date":n=e.statement_received_date?X(e.statement_received_date):"";break;case"expenditure_info":n=e.expenditure_date&&null!==e.expenditure_amount&&void 0!==e.expenditure_amount?"2025. 11. 25.":""}const a=n.split("").reduce((e,t)=>e+(/[-]/.test(t)?1.5:1),0);r=Math.max(r,Math.ceil(a))}),t.isFixed)return t.baseWidth;let i=Math.max(t.minWidth,Math.min(t.maxWidth,7*r+20));return"expenditure_info"===t.key&&(i=110),i});return Ce(n),n},[T,o,gt,vt]),Wt=e=>"purchase"===o?e.is_payment_completed?"":"":"receipt"===o?e.is_received?"":"":e.is_payment_completed?"":"",Pt=()=>{if(Se.length>0){return Se.map(e=>`${e}px`).join(" ")}let e=["32px","minmax(80px, 1fr)","200px","70px","90px","100px"];if(""===T?.payment_category&&e.push("100px"),e.push("60px"),e.push("150px"),"pending"!==o&&e.push("80px"),"receipt"===o){const t=[...e,"100px"];return gt&&t.push("100px","80px"),t.join(" ")}if("done"===o){const t=[...e];return gt&&(t.push("100px","80px"),vt&&t.push("110px")),t.join(" ")}return e.join(" ")};n.useEffect(()=>{const e=T?.items&&T.items.length>0||T?.purchase_request_items&&T.purchase_request_items.length>0;T&&e&&!$&&requestAnimationFrame(()=>{$t()})},[T,$,o,$t]);const Lt=e=>{if(e&&!$){L(T);const e=[...it||[]].sort((e,t)=>(e?.line_number??999999)-(t?.line_number??999999));F(e),J([]),$t()}W(e)},zt=async e=>{try{const t=b(e);if(t){const e={...t,id:String(t.id),is_po_generated:!1,vendor:t.vendor||(t.vendor_id?{id:t.vendor_id,vendor_name:t.vendor_name||"  ",is_active:!0,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}:null),vendor_contacts:t.vendor_contacts||[]};return A({...e,items:Ze(t.items||e.items||[])}),L(e),void F(Ze(t.items||[]))}M(!0);const n=m(),{data:r,error:a}=await n.from("purchase_requests").select("\n          *,\n          vendors:vendor_id(id, vendor_name, is_active),\n          purchase_request_items(*),\n          contact:contact_id(id, contact_name, contact_email, contact_phone, position)\n        ").eq("id",e).single();if(a)throw a;let i=[];if(r&&r.vendor_id){const{data:e}=await n.from("vendor_contacts").select("id, contact_name, contact_email, contact_phone, position").eq("vendor_id",r.vendor_id).order("contact_name");if(e&&e.length>0){if(r.contact_id){const t=e.find(e=>e.id===r.contact_id),n=e.filter(e=>e.id!==r.contact_id);i=t?[t,...n]:e}else i=e;p.info(" loadPurchaseDetail -    :",{vendor_id:r.vendor_id,contact_id:r.contact_id,allContacts_count:e.length,vendorContacts:i})}}else r&&r.contact&&(i=[r.contact]);if(r){const e=Ze((r.purchase_request_items||[]).sort((e,t)=>(e.line_number||999999)-(t.line_number||999999))),t={...r,items:e,vendor:r.vendors||null,vendor_contacts:i,contact_id:r.contact_id,contact_name:i[0]?.contact_name||r.contact?.contact_name||null};A({...t,items:e}),L(t),F(e)}}catch(t){p.error("[PurchaseDetailModal]    :",t),se.error("    .")}finally{M(!1)}},Bt=e=>new Intl.NumberFormat("ko-KR").format(e),Kt=(e,t,n)=>{const r=[...z];if("quantity"===t||"unit_price_value"===t){const a=(("quantity"===t?n:r[e].quantity)||0)*(("unit_price_value"===t?n:r[e].unit_price_value)||0),i=""===T?.payment_category?Math.round(.1*a):0;r[e]={...r[e],[t]:n,amount_value:a,tax_amount_value:i}}else if("amount_value"===t){const t=Number(n)||0,a=""===T?.payment_category?Math.round(.1*t):0;r[e]={...r[e],amount_value:t,tax_amount_value:a}}else r[e]={...r[e],[t]:n};F(r)},Ut=async(e,t)=>{if(!ft)return p.warn("[handlePaymentToggle]  ",{canPurchase:ft,currentUserRoles:s}),void se.error("   .");const n=String(e),r="number"==typeof e?e:Number(e);if(Number.isNaN(r))return p.error("[handlePaymentToggle]  ID",{itemId:e,numericId:r}),void se.error("   ID .");if(!T)return;const a=T.items&&T.items.length>0?T.items:[],i=T.purchase_request_items&&T.purchase_request_items.length>0?T.purchase_request_items:[],o=(a.length>0?a:i).find(e=>String(e.id)===n);if(!o)return;const d=`: ${o.item_name}\n: ${o.specification||""}\n: ${o.quantity?.toLocaleString()||0}${o.unit||""}\n: ${o.unit_price_value?.toLocaleString()||0}\n: ${o.amount_value?.toLocaleString()||0}`,u=t?`   ?\n\n${d}`:`   ?\n\n${d}`;if(window.confirm(u))try{const{error:e}=await ct.from("purchase_request_items").update({is_payment_completed:t,payment_completed_at:t?(new Date).toISOString():null}).eq("id",r);if(e)throw e;if(T){(t?D(T.id,r):R(T.id,r))||p.warn("[PurchaseDetailModal]     ",{purchaseId:T.id,itemId:r,isCompleted:t})}if(A(e=>{if(!e)return null;const r=e.items&&e.items.length>0?e.items:[],a=e.purchase_request_items&&e.purchase_request_items.length>0?e.purchase_request_items:[],i=(r.length>0?r:a).map(e=>String(e.id)===n?{...e,is_payment_completed:t,payment_completed_at:t?(new Date).toISOString():null}:e);return{...e,items:e.items?i:e.items,purchase_request_items:e.purchase_request_items?i:e.purchase_request_items}}),T){const e=Number(T.id);Number.isNaN(e)||c?.(e,e=>{const r=(e.items||[]).map(e=>String(e.id)===n?{...e,is_payment_completed:t}:e),a=r.length||e.items?.length||0,i=r.filter(e=>e.is_payment_completed).length,s=a>0&&i===a;return{...e,items:r,is_payment_completed:s,payment_completed_at:s?(new Date).toISOString():null,payment_completed_by_name:s&&Ne||e.payment_completed_by_name}})}se.success(t?" .":" ."),await jt();const a=l?.(!0,{silent:!0});a instanceof Promise&&await a}catch(m){se.error("    .")}},Ht=async(e,t,n)=>{if(!_t)return void se.error("   .");const r=String(e),a="number"==typeof e?e:Number(e);if(Number.isNaN(a))return void se.error("   ID .");const i=T?.items?.find(e=>String(e.id)===r)||T?.purchase_request_items?.find(e=>String(e.id)===r),s=i?.quantity||0,o=void 0!==n?n:s,d=(i?.received_quantity||0)+o,u=d>=s,m=0===d?"pending":u?"received":"partial",g=i?.receipt_history||[],v={seq:g.length+1,qty:o,date:t.toISOString(),by:Ne||""},x=[...g,v],f=T?Number(T.id):NaN;try{const{error:e}=await ct.from("purchase_request_items").update({is_received:u,delivery_status:m,received_at:(new Date).toISOString(),actual_received_date:t.toISOString(),received_quantity:d,receipt_history:x}).eq("id",a);if(e)throw e;if(T){h(T.id,a,t.toISOString(),d)||p.warn("[PurchaseDetailModal]       ",{purchaseId:T.id,itemId:a})}A(e=>{if(!e)return null;const n=e.items?.map(e=>String(e.id)===r?{...e,is_received:u,delivery_status:m,received_at:(new Date).toISOString(),actual_received_date:t.toISOString(),received_quantity:d,receipt_history:x}:e),a=e.purchase_request_items?.map(e=>String(e.id)===r?{...e,is_received:u,delivery_status:m,received_at:(new Date).toISOString(),actual_received_date:t.toISOString(),received_quantity:d,receipt_history:x}:e);return{...e,items:n,purchase_request_items:a,updated_at:(new Date).toISOString()}}),Number.isNaN(f)||c?.(f,e=>{const n=(e.items||[]).map(e=>String(e.id)===r?{...e,is_received:u,delivery_status:m,actual_received_date:t.toISOString(),received_quantity:d,receipt_history:x}:e),a=n.length||e.items?.length||0,i=n.filter(e=>e.is_received).length,s=a>0&&i===a;return{...e,items:n,is_received:s,received_at:s?(new Date).toISOString():e.received_at}});const n=T?.items?.find(e=>String(e.id)===r);se.success(`"${n?.item_name}"   .`),await jt();const i=l?.(!0,{silent:!0});i instanceof Promise&&await i}catch(_){se.error("    .")}},Vt=async e=>{if(!T)return;const t="middle"===e?"1 ":" ",n=`: ${T.purchase_order_number}\n\n${t} ?`;if(window.confirm(n))try{const t="middle"===e?{middle_manager_status:"approved"}:{final_manager_status:"approved"},{error:n}=await ct.from("purchase_requests").update(t).eq("id",T.id);if(n)throw n;if(A("middle"===e?e=>e?{...e,middle_manager_status:"approved"}:null:e=>e?{...e,final_manager_status:"approved"}:null),N(String(T.id),t=>({...t,..."middle"===e?{middle_manager_status:"approved"}:{final_manager_status:"approved"}})),T&&c){const t=Number(T.id);Number.isNaN(t)||c(t,t=>"middle"===e?{...t,middle_manager_status:"approved"}:{...t,final_manager_status:"approved"})}se.success(("middle"===e?"":"")+"  ."),await jt();const r=l?.(!0,{silent:!0});r instanceof Promise&&await r}catch(r){se.error("    .")}},Yt=async(e,t,n)=>{if(!T||!wt)return void se.error("    .");const r=String(e),a="number"==typeof e?e:Number(e);if(Number.isNaN(a))return void p.error("  itemId",{itemId:e});const i=T.items?.find(e=>String(e.id)===r);if(!i)return;const s=T?Number(T.id):NaN;try{Number.isNaN(s)||c?.(s,e=>{const a=(e.items||[]).map(e=>String(e.id)===r?{...e,expenditure_date:t.toISOString(),expenditure_amount:n}:e);return{...e,items:a}}),A(e=>{if(!e)return null;const a=(e.items||e.purchase_request_items||[]).map(e=>String(e.id)===r?{...e,expenditure_date:t.toISOString(),expenditure_amount:n}:e),i=a.reduce((e,t)=>e+(t.expenditure_amount||0),0);return{...e,items:a,purchase_request_items:a,total_expenditure_amount:i,updated_at:(new Date).toISOString()}});const{error:e}=await ct.from("purchase_request_items").update({expenditure_date:t.toISOString(),expenditure_amount:n}).eq("id",a);if(e)throw p.error("  DB  ",{error:e,itemId:a}),e;const o=(T.items||T.purchase_request_items||[]).reduce((e,t)=>String(t.id)===r?e+n:e+(t.expenditure_amount||0),0);if(await ct.from("purchase_requests").update({total_expenditure_amount:o}).eq("id",s),T?.id){O(T.id,a,t.toISOString(),n)||p.warn("[PurchaseDetailModal]      ",{purchaseId:T.id,itemId:a})}se.success(`"${i.item_name}"    .`),await jt();const d=l?.(!0,{silent:!0});d instanceof Promise&&await d}catch(o){p.error("    ",o),se.error("     .")}},Xt=(e,n,r,a)=>{const i=a||e?.stableKey||et(e,n),s={className:`px-2 sm:px-3 py-1 border-b border-gray-50 hover:bg-gray-50/50 relative overflow-visible w-fit ${$?"pl-7 sm:pl-8":""} ${r?.isDragging?"shadow-lg ring-2 ring-blue-200 bg-white":""}`,key:i};return r?.setNodeRef&&(s.ref=r.setNodeRef),r?.style&&(s.style=r.style),t.jsxs("div",{...s,children:[$&&r&&t.jsx("button",{className:"absolute left-1 top-2 sm:top-3 text-gray-400 hover:text-gray-600 p-1 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-200",...r.attributes,...r.listeners,"aria-label":"   ",children:t.jsx(xe,{className:"w-3.5 h-3.5"})}),t.jsxs("div",{className:"hidden sm:grid items-center gap-1 overflow-visible w-fit",style:{gridTemplateColumns:Pt()},children:[t.jsx("div",{className:"flex justify-center items-center text-[11px] text-gray-500 font-medium -ml-2 sm:-ml-3",children:e.line_number||n+1}),t.jsx("div",{className:"min-w-0 relative overflow-visible flex items-center",children:$?t.jsx(B,{value:e.item_name,onChange:e=>Kt(n,"item_name",e.target.value),onFocus:()=>qe(`item_name_${n}`),onBlur:()=>qe(null),className:"modal-label border-gray-200 rounded-lg w-full !px-1.5 !py-0.5 !text-[10px] focus:border-blue-400 transition-all duration-200 "+(De===`item_name_${n}`?"!h-auto !min-h-[20px] !absolute !z-[9999] !bg-white !shadow-lg !left-0 !right-0 !-translate-y-1/2 !top-1/2 !whitespace-normal":"!h-5 !truncate"),placeholder:""}):t.jsx("div",{className:"modal-value",style:{whiteSpace:"normal",wordBreak:"break-all",overflowWrap:"break-word",hyphens:"none",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none",lineHeight:"1.4",maxHeight:"2.8em",overflow:"hidden",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},title:e.item_name||" ",children:e.item_name||" "})}),t.jsx("div",{className:"min-w-0 relative overflow-visible flex items-center w-full",children:$?t.jsx(B,{value:e.specification,onChange:e=>Kt(n,"specification",e.target.value),onFocus:()=>qe(`specification_${n}`),onBlur:()=>qe(null),className:"modal-label border-gray-200 rounded-lg w-full !px-1.5 !py-0.5 !text-[10px] focus:border-blue-400 transition-all duration-200 "+(De===`specification_${n}`?"!h-auto !min-h-[20px] !absolute !z-[9999] !bg-white !shadow-lg !left-0 !right-0 !-translate-y-1/2 !top-1/2 !whitespace-normal":"!h-5 !truncate"),placeholder:""}):t.jsx("div",{className:"text-[11px] text-gray-600 font-medium",style:{whiteSpace:"normal",wordBreak:"break-all",overflowWrap:"break-word",hyphens:"none",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none",lineHeight:"1.4",maxHeight:"2.8em",overflow:"hidden",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},title:e.specification||"-",children:e.specification||"-"})}),t.jsx("div",{className:"text-center min-w-0 flex items-center justify-center",children:$?"receipt"===o||"done"===o?t.jsxs("div",{className:"flex flex-col items-center gap-0.5 w-full",children:[t.jsx(B,{type:"number",value:e.quantity,onChange:e=>Kt(n,"quantity",Number(e.target.value)),className:"border-gray-200 rounded-lg text-center w-full !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400",placeholder:"",max:"99999",disabled:mt&&!ut}),t.jsxs("div",{className:"flex items-center gap-0.5 w-full",children:[t.jsx("span",{className:"text-[9px] text-gray-500",children:"/"}),t.jsx(B,{type:"number",value:e.received_quantity??"",onChange:e=>Kt(n,"received_quantity",e.target.value?Number(e.target.value):null),className:"border-gray-200 rounded-lg text-center flex-1 !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400",placeholder:"",max:"99999",disabled:mt&&!ut})]})]}):t.jsx(B,{type:"number",value:e.quantity,onChange:e=>Kt(n,"quantity",Number(e.target.value)),className:"border-gray-200 rounded-lg text-center w-full !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400",placeholder:"",max:"99999",disabled:mt&&!ut}):"receipt"===o||"done"===o?(()=>{const n=e.quantity||0,r=e.received_quantity??0,a=r>0;return n>=100||r>=100?t.jsxs("div",{className:"flex flex-col items-center leading-tight",children:[t.jsx("div",{className:"modal-subtitle "+(a?"text-gray-400":""),children:n}),t.jsxs("div",{className:"modal-subtitle "+(a?"":"text-gray-400"),children:["/",r]})]}):t.jsxs("span",{className:"modal-subtitle",children:[t.jsx("span",{className:a?"text-gray-400":"",children:n}),t.jsxs("span",{className:a?"":"text-gray-400",children:["/",r]})]})})():t.jsx("span",{className:"modal-subtitle",children:e.quantity||0})}),t.jsx("div",{className:"text-right min-w-0 flex items-center justify-end",children:$?t.jsx(B,{type:"number",value:e.unit_price_value,onChange:e=>Kt(n,"unit_price_value",Number(e.target.value)),className:"border-gray-200 rounded-lg text-right w-full !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400",placeholder:"",max:"100000000000"}):t.jsx("span",{className:"modal-subtitle",children:"done"!==o||ht?`${Bt(e.unit_price_value)}`:"-"})}),t.jsx("div",{className:"text-right min-w-0 flex items-center justify-end",children:$?t.jsx(B,{type:"number",value:e.amount_value||0,onChange:e=>Kt(n,"amount_value",Number(e.target.value)),className:"border-gray-200 rounded-lg w-full !h-6 !px-1.5 !py-0.5 !text-[10px] font-normal text-gray-600 focus:border-blue-400 text-right",placeholder:""}):t.jsx("span",{className:"modal-value",children:"done"!==o||ht?`${Bt(e.amount_value||0)}`:"-"})}),""===T?.payment_category&&t.jsx("div",{className:"text-right min-w-0 flex items-center justify-end",children:t.jsx("span",{className:$?"modal-subtitle":"modal-value",children:"done"!==o||ht?`${Bt(e.tax_amount_value||0)}`:"-"})}),t.jsx("div",{className:"text-center min-w-0 flex items-center justify-center",children:e.link?t.jsx("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline text-[11px]",onClick:e=>e.stopPropagation(),children:""}):t.jsx("span",{className:"text-gray-400 text-[11px]",children:"-"})}),t.jsx("div",{className:"min-w-0 flex justify-center items-center text-center relative overflow-visible",style:{width:"150px",maxWidth:"150px",minWidth:"150px"},children:$?t.jsx(B,{value:e.remark||"",disabled:mt&&!ut,onChange:e=>Kt(n,"remark",e.target.value),onFocus:()=>qe(`remark_${n}`),onBlur:()=>qe(null),className:"modal-label border-gray-200 rounded-lg text-center w-full !px-1.5 !py-0.5 !text-[10px] focus:border-blue-400 transition-all duration-200 "+(De===`remark_${n}`?"!h-auto !min-h-[20px] !absolute !z-[9999] !bg-white !shadow-lg !left-0 !right-0 !-translate-y-1/2 !top-1/2 !whitespace-normal !text-left":"!h-5 !truncate"),placeholder:""}):t.jsx("div",{className:"text-[11px] text-gray-600 font-medium",style:{width:"150px",maxWidth:"150px",minWidth:"150px",boxSizing:"border-box",whiteSpace:"normal",wordBreak:"break-all",overflowWrap:"break-word",hyphens:"none",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none",lineHeight:"1.4",maxHeight:"2.8em",overflow:"hidden",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},title:e.remark||"-",children:e.remark||"-"})}),"pending"!==o&&t.jsx("div",{className:"text-center flex justify-center items-center",children:$?t.jsx(u,{size:"sm",variant:"ghost",onClick:()=>(e=>{const t=z[e];t.id&&J([...Q,t.id]);const n=z.filter((t,n)=>n!==e).sort((e,t)=>(e.line_number||999999)-(t.line_number||999999)).map((e,t)=>({...e,line_number:t+1,stableKey:e.stableKey??Ge(e,t)}));F(n)})(n),className:"text-red-600 hover:bg-red-50 rounded-lg p-1 h-6 w-6",disabled:mt&&!ut,children:t.jsx(pe,{className:"w-3 h-3"})}):t.jsxs(t.Fragment,{children:["purchase"===o&&t.jsx("div",{className:"flex justify-center",children:ft?t.jsx("button",{onClick:()=>Ut(e.id,!e.is_payment_completed),className:""+(e.is_payment_completed?"button-toggle-active bg-orange-500 hover:bg-orange-600 text-white":"button-toggle-inactive"),children:e.is_payment_completed?"":""}):t.jsx("span",{className:""+(e.is_payment_completed?"button-toggle-active bg-orange-500 text-white":"button-waiting-inactive"),children:e.is_payment_completed?"":""})}),"receipt"===o&&t.jsx("div",{className:"flex justify-center",children:_t?Rt.isCompleted(e)?t.jsx("button",{onClick:()=>{Rt.handleCancel(e.id,{item_name:e.item_name,specification:e.specification,quantity:e.quantity,unit_price_value:e.unit_price_value,amount_value:e.amount_value,remark:e.remark})},className:"button-action-primary",children:Rt.config.completedText}):Rt.isPartiallyReceived(e)?t.jsx(Tr,{onConfirm:(t,n)=>{Ht(e.id,t,n)},placeholder:"  ",align:"center",side:"bottom",maxQuantity:Rt.getRemainingQuantity(e),quantityInfoText:`: ${Rt.getRemainingQuantity(e)}`,children:t.jsx("button",{className:"button-base bg-blue-300 hover:bg-blue-400 text-white",children:""})}):t.jsx(Tr,{onConfirm:(t,n)=>{Ht(e.id,t,n)},placeholder:"  ",align:"center",side:"bottom",defaultQuantity:e.received_quantity??void 0,maxQuantity:e.quantity,children:t.jsx("button",{className:"button-toggle-inactive",children:Rt.config.waitingText})}):t.jsx("span",{className:""+(Rt.isCompleted(e)?"button-action-primary":Rt.isPartiallyReceived(e)?"button-base bg-blue-300 text-white":"button-waiting-inactive"),children:Rt.isCompleted(e)?Rt.config.completedText:Rt.isPartiallyReceived(e)?"":Rt.config.waitingText})}),"done"===o&&t.jsx("div",{className:"flex justify-center",children:t.jsx("span",{className:"button-base "+(Rt.isCompleted(e)?"bg-blue-500 hover:bg-blue-600 text-white":Rt.isPartiallyReceived(e)?"bg-blue-300 text-white":"border border-gray-300 text-gray-600 bg-white hover:bg-gray-50"),children:Rt.isCompleted(e)?"":Rt.isPartiallyReceived(e)?"":""})}),"purchase"!==o&&"receipt"!==o&&"done"!==o&&t.jsx("div",{className:"flex justify-center",children:t.jsx("span",{className:"badge-text",children:"-"})})]})}),"receipt"===o&&t.jsx("div",{className:"text-center flex justify-center items-center pl-2",children:Rt.getCompletedDate(e)?t.jsx("div",{className:"modal-subtitle text-green-700",children:new Date(Rt.getCompletedDate(e)).toLocaleDateString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit"})}):t.jsx("span",{className:"modal-subtitle text-gray-400",children:"-"})}),gt&&t.jsx("div",{className:"text-center flex justify-center items-center",children:wt?It.isCompleted(e)?t.jsx("button",{onClick:()=>{It.handleCancel(e.id,{item_name:e.item_name,specification:e.specification,quantity:e.quantity,unit_price_value:e.unit_price_value,amount_value:e.amount_value,remark:e.remark})},className:"button-action-primary hover:bg-green-600",title:"   ",children:It.config.completedText}):t.jsx(G,{onDateSelect:t=>{It.handleConfirm(e.id,t,{item_name:e.item_name,specification:e.specification,quantity:e.quantity,unit_price_value:e.unit_price_value,amount_value:e.amount_value,remark:e.remark})},placeholder:"  ",align:"center",side:"bottom",children:t.jsx("button",{className:"button-toggle-inactive",onClick:()=>{},children:It.config.waitingText})}):t.jsx("span",{className:""+(It.isCompleted(e)?"button-action-primary":"button-waiting-inactive"),children:It.isCompleted(e)?It.config.completedText:It.config.waitingText})}),gt&&t.jsx("div",{className:"text-center flex justify-center items-center",children:It.getCompletedDate(e)?t.jsx("div",{className:"modal-subtitle text-blue-700",children:new Date(It.getCompletedDate(e)).toLocaleDateString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit"})}):t.jsx("span",{className:"modal-subtitle text-gray-400",children:"-"})}),vt&&t.jsx("div",{className:"text-center flex justify-center items-center",children:(()=>{const n=!!e.expenditure_date,r=null!==e.expenditure_amount&&void 0!==e.expenditure_amount;return wt?n?t.jsxs("div",{className:"w-full px-1 leading-none",children:[t.jsx("div",{className:"text-blue-700 text-[9px] leading-[1.1] font-normal",children:(()=>{const t=new Date(e.expenditure_date);return`${t.getFullYear().toString().slice(-2)}.${(t.getMonth()+1).toString().padStart(2,"0")}.${t.getDate().toString().padStart(2,"0")}`})()}),t.jsx("div",{className:"text-gray-700 text-[9px] leading-[1.1] font-normal",children:ht?r?`${Number(e.expenditure_amount).toLocaleString()}`:"":"-"})]}):t.jsx(Mr,{onConfirm:(t,n)=>Yt(e.id,t,n),placeholder:"   ",align:"center",side:"bottom",children:t.jsx("button",{className:"button-toggle-inactive",children:""})}):n?t.jsxs("div",{className:"w-full px-1 leading-none",children:[t.jsx("div",{className:"text-blue-700 text-[9px] leading-[1.1] font-normal",children:(()=>{const t=new Date(e.expenditure_date);return`${t.getFullYear().toString().slice(-2)}.${(t.getMonth()+1).toString().padStart(2,"0")}.${t.getDate().toString().padStart(2,"0")}`})()}),t.jsx("div",{className:"text-gray-700 text-[9px] leading-[1.1] font-normal",children:ht?r?`${Number(e.expenditure_amount).toLocaleString()}`:"":"-"})]}):t.jsx("span",{className:"modal-subtitle text-gray-400",children:"-"})})()})]}),t.jsxs("div",{className:"block sm:hidden space-y-2",children:[t.jsxs("div",{className:"flex justify-between items-start",children:[t.jsxs("div",{className:"flex-1 min-w-0 relative",children:[$?t.jsx(B,{value:e.item_name,onChange:e=>Kt(n,"item_name",e.target.value),onFocus:()=>qe(`m_item_name_${n}`),onBlur:()=>qe(null),className:"modal-label border-gray-200 rounded-lg w-full !px-1.5 !py-0.5 !text-[10px] focus:border-blue-400 transition-all duration-200 "+(De===`m_item_name_${n}`?"!h-auto !min-h-[20px] !absolute !z-[9999] !bg-white !shadow-lg !left-0 !right-0 !-translate-y-1/2 !top-1/2 !whitespace-normal":"!h-5 !truncate"),placeholder:""}):t.jsx("div",{className:"modal-value font-medium",children:e.item_name||" "}),$?t.jsx(B,{value:e.specification,onChange:e=>Kt(n,"specification",e.target.value),onFocus:()=>qe(`m_specification_${n}`),onBlur:()=>qe(null),className:"modal-label border-gray-200 rounded-lg mt-1 w-full !px-1.5 !py-0.5 !text-[10px] focus:border-blue-400 transition-all duration-200 "+(De===`m_specification_${n}`?"!h-auto !min-h-[20px] !absolute !z-[9999] !bg-white !shadow-lg !left-0 !right-0 !-translate-y-1/2 !top-1/2 !whitespace-normal !w-full":"!h-5 !truncate"),placeholder:""}):t.jsx("div",{className:"modal-subtitle text-gray-500",children:e.specification||"-"})]}),t.jsxs("div",{className:"ml-3 text-right flex-shrink-0",children:[$?t.jsx(B,{type:"number",value:e.amount_value||0,onChange:e=>Kt(n,"amount_value",Number(e.target.value)),className:"border-gray-200 rounded-lg w-24 !h-6 !px-1.5 !py-0.5 !text-[10px] font-normal text-gray-600 focus:border-blue-400 text-right",placeholder:""}):t.jsxs("div",{className:"modal-value font-semibold",children:["",Bt(e.amount_value||0)]}),t.jsxs("div",{className:"text-[10px] text-gray-500 mt-0.5",children:["done"!==o||ht?`${Bt(e.unit_price_value||0)}`:"-"," / "]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500 text-xs",children:""}),$?"receipt"===o||"done"===o?t.jsxs("div",{className:"grid grid-cols-2 gap-1 mt-1",children:[t.jsx(B,{type:"number",value:e.quantity,onChange:e=>Kt(n,"quantity",Number(e.target.value)),className:"border-gray-200 rounded-lg text-center w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400",placeholder:"",max:"99999"}),t.jsx(B,{type:"number",value:e.received_quantity??"",onChange:e=>Kt(n,"received_quantity",e.target.value?Number(e.target.value):null),className:"border-gray-200 rounded-lg text-center w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400",placeholder:"",max:"99999"})]}):t.jsx(B,{type:"number",value:e.quantity,onChange:e=>Kt(n,"quantity",Number(e.target.value)),className:"border-gray-200 rounded-lg text-center w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400 mt-1",placeholder:"",max:"99999"}):t.jsx("div",{className:"modal-subtitle mt-1",children:"receipt"===o||"done"===o?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-gray-500",children:e.quantity||0}),t.jsxs("span",{className:"text-gray-400",children:["/",e.received_quantity??0]})]}):e.quantity||0})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500 text-xs",children:""}),t.jsx("div",{className:"mt-1",children:e.link?t.jsx("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline text-[11px] break-all",onClick:e=>e.stopPropagation(),children:e.link}):t.jsx("span",{className:"text-gray-400 text-[11px]",children:"-"})})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-2 items-center",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500 text-xs",children:""}),t.jsx("div",{className:"mt-1",children:"pending"===o?t.jsx("span",{className:"text-xs text-gray-400",children:"-"}):t.jsxs(t.Fragment,{children:["purchase"===o&&t.jsx("div",{className:"flex items-center gap-2",children:ft?t.jsx("button",{onClick:()=>Ut(e.id,!e.is_payment_completed),className:"text-xs px-2 py-1 rounded "+(e.is_payment_completed?"button-action-primary":"bg-gray-100 text-gray-600"),children:e.is_payment_completed?"":""}):t.jsx("span",{className:"text-xs px-2 py-1 rounded "+(e.is_payment_completed?"button-action-primary":"bg-gray-100 text-gray-400"),children:e.is_payment_completed?"":""})}),"receipt"===o&&t.jsx("div",{className:"flex items-center gap-2",children:_t?Rt.isCompleted(e)?t.jsx("button",{onClick:()=>{Rt.handleCancel(e.id,{item_name:e.item_name,specification:e.specification,quantity:e.quantity,unit_price_value:e.unit_price_value,amount_value:e.amount_value,remark:e.remark})},className:"text-xs px-2 py-1 rounded button-action-primary",children:Rt.config.completedText}):t.jsx(G,{onDateSelect:t=>{Rt.handleConfirm(e.id,t,{item_name:e.item_name,specification:e.specification,quantity:e.quantity,unit_price_value:e.unit_price_value,amount_value:e.amount_value,remark:e.remark})},placeholder:"   ",align:"center",side:"bottom",children:t.jsx("button",{className:"text-xs px-2 py-1 rounded bg-gray-100 text-gray-600",children:Rt.config.waitingText})}):t.jsx("span",{className:"text-xs px-2 py-1 rounded "+(Rt.isCompleted(e)?"button-action-primary":"bg-gray-100 text-gray-400"),children:Rt.isCompleted(e)?Rt.config.completedText:Rt.config.waitingText})}),"done"===o&&t.jsx(t.Fragment,{children:t.jsx("span",{className:"button-base "+(Rt.isCompleted(e)?"bg-green-500 text-white":"border border-gray-300 text-gray-600 bg-white"),children:Rt.isCompleted(e)?"":""})}),"purchase"!==o&&"receipt"!==o&&"done"!==o&&t.jsx("span",{className:"text-xs text-gray-400",children:"-"})]})})]}),(e.remark||$)&&t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500 text-xs",children:":"}),$?t.jsx(B,{value:e.remark||"",onChange:e=>Kt(n,"remark",e.target.value),className:"modal-label border-gray-200 rounded-lg mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400",placeholder:""}):t.jsx("div",{className:"modal-subtitle text-gray-500 mt-1",children:e.remark||"-"})]})]}),!$&&"receipt"===o&&Rt.getCompletedDate(e)&&t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500 text-xs",children:":"}),t.jsxs("div",{className:"mt-1",children:[t.jsx("div",{className:"modal-subtitle text-green-700",children:new Date(Rt.getCompletedDate(e)).toLocaleDateString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit"})}),t.jsx("div",{className:"text-[9px] text-gray-500",children:new Date(Rt.getCompletedDate(e)).toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit"})})]})]}),!$&&gt&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-500 text-xs",children:" :"}),t.jsx("div",{className:"flex items-center gap-2",children:wt?It.isCompleted(e)?t.jsx("button",{onClick:()=>{It.handleCancel(e.id,{item_name:e.item_name,specification:e.specification,quantity:e.quantity,unit_price_value:e.unit_price_value,amount_value:e.amount_value,remark:e.remark})},className:"text-xs px-2 py-1 rounded button-action-primary",children:It.config.completedText}):t.jsx(G,{onDateSelect:t=>{It.handleConfirm(e.id,t,{item_name:e.item_name,specification:e.specification,quantity:e.quantity,unit_price_value:e.unit_price_value,amount_value:e.amount_value,remark:e.remark})},placeholder:"  ",align:"center",side:"bottom",children:t.jsx("button",{className:"text-xs px-2 py-1 rounded bg-gray-100 text-gray-600",children:It.config.waitingText})}):t.jsx("span",{className:"text-xs px-2 py-1 rounded "+(It.isCompleted(e)?"button-action-primary":"bg-gray-100 text-gray-400"),children:It.isCompleted(e)?It.config.completedText:It.config.waitingText})})]}),!$&&gt&&It.getCompletedDate(e)&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-500 text-xs",children:" :"}),t.jsx("span",{className:"modal-subtitle text-blue-700",children:new Date(It.getCompletedDate(e)).toLocaleDateString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit"})})]}),!$&&vt&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-gray-500 text-xs",children:":"}),t.jsx("div",{className:"text-right",children:e.expenditure_date?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-blue-700 text-[11px]",children:(()=>{const t=new Date(e.expenditure_date);return`${t.getFullYear().toString().slice(-2)}.${(t.getMonth()+1).toString().padStart(2,"0")}.${t.getDate().toString().padStart(2,"0")}`})()}),t.jsx("div",{className:"text-gray-700 text-[11px]",children:ht?null!==e.expenditure_amount&&void 0!==e.expenditure_amount?`${Number(e.expenditure_amount).toLocaleString()}`:"":"-"})]}):t.jsx("span",{className:"text-gray-400 text-[11px]",children:"-"})})]})]})]})},Qt=t.jsx("div",{className:"space-y-1 sm:space-y-4",children:E?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-hansl-600"})}):T?t.jsxs("div",{children:[t.jsx("div",{className:"bg-gray-50 rounded-lg p-2 sm:p-3 mb-1 sm:mb-2 border border-gray-100",children:t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 items-center gap-3 sm:gap-0",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[(()=>{if(!T)return null;if(T.payment_category){const e=T.payment_category.trim();return""===e?t.jsx("span",{className:"badge-stats bg-green-500 text-white",children:""}):""===e?t.jsx("span",{className:"badge-stats bg-blue-500 text-white",children:""}):""===e?t.jsx("span",{className:"badge-stats bg-gray-500 text-white",children:""}):t.jsx("span",{className:"badge-stats bg-blue-500 text-white",children:e})}return t.jsx("span",{className:"badge-stats bg-blue-500 text-white",children:""})})(),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"modal-label",children:":"}),t.jsx("span",{className:"modal-value",children:T.requester_name})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(de,{className:"w-3 h-3 text-gray-500"}),t.jsxs("span",{className:"modal-subtitle",children:[": ",X(T.request_date)]})]})]}),t.jsxs("div",{className:"flex items-center justify-center gap-2 sm:gap-3 flex-wrap",children:[Ot&&"pending"===T.middle_manager_status&&t.jsx(u,{size:"sm",variant:"outline",onClick:()=>Vt("middle"),className:`${Mt} border border-gray-400 bg-white hover:bg-gray-50 hover:border-gray-500`,children:"1  "}),"approved"===T.middle_manager_status&&t.jsxs("div",{className:"button-approved badge-text shadow-sm",children:[t.jsx(ue,{className:"w-3 h-3"}),"1 "]}),"rejected"===T.middle_manager_status&&t.jsxs("div",{className:"button-rejected badge-text",children:[t.jsx(y,{className:"w-3 h-3"}),"1 "]}),"pending"===T.middle_manager_status&&!Ot&&t.jsx("div",{className:`${Tt} border border-gray-300 text-gray-600 bg-white`,children:"1 "}),Et&&"approved"===T.middle_manager_status&&"pending"===T.final_manager_status&&t.jsxs(u,{size:"sm",variant:"outline",onClick:()=>Vt("final"),className:`${Mt} border border-gray-400 bg-white hover:bg-gray-50 hover:border-gray-500`,children:[t.jsx(ue,{className:"w-3 h-3"})," "]}),"approved"===T.final_manager_status&&t.jsxs("div",{className:"button-approved badge-text",children:[t.jsx(ue,{className:"w-3 h-3"})," "]}),"rejected"===T.final_manager_status&&t.jsxs("div",{className:"button-rejected badge-text",children:[t.jsx(y,{className:"w-3 h-3"})," "]}),"approved"!==T.middle_manager_status&&"pending"===T.final_manager_status&&t.jsx("div",{className:`${Tt} border border-gray-300 text-gray-600 bg-white`,children:" "})]}),t.jsx("div",{})]})}),t.jsxs("div",{className:"flex flex-col lg:flex-row gap-3 sm:gap-6",children:[t.jsxs("div",{className:"lg:w-80 lg:flex-shrink-0 space-y-1 sm:space-y-4 relative",children:[t.jsxs("div",{className:"bg-white rounded-lg p-2 sm:p-3 border border-gray-100 shadow-sm",children:[t.jsx("div",{className:"mb-3",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("h3",{className:"modal-section-title flex items-center",children:[t.jsx(w,{className:"w-4 h-4 mr-2 text-gray-600"}),T?.purchase_order_number||"PO "]}),wt&&ht&&"done"===o&&t.jsxs("button",{onClick:async()=>{if(!T)return;const e=!(T.is_utk_checked||!1),t=e?`: ${T.purchase_order_number}\n\nUTK  ?`:`: ${T.purchase_order_number}\n\nUTK  ?`;if(window.confirm(t))try{const t=m(),{error:n}=await t.from("purchase_requests").update({is_utk_checked:e}).eq("id",T.id);if(n)return p.error("UTK  DB  ",{error:n,purchaseId:T.id}),void se.error("UTK     .");A(t=>t?{...t,is_utk_checked:e,updated_at:(new Date).toISOString()}:null),T.id&&N(T.id,t=>({...t,is_utk_checked:e})),se.success(e?"UTK  .":"UTK  ."),await jt();const r=l?.(!0,{silent:!0});r instanceof Promise&&await r}catch(n){p.error("UTK    ",n),se.error("UTK     .")}},className:"button-base text-xs px-2 py-1 flex items-center "+(T?.is_utk_checked?"button-toggle-active bg-orange-500 hover:bg-orange-600 text-white":"button-toggle-inactive"),title:T?.is_utk_checked?"UTK  ":"UTK ",children:[t.jsx(le,{className:"w-3 h-3 mr-1"}),"UTK ",T?.is_utk_checked?"":""]})]})}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"grid grid-cols-1 sm:flex sm:gap-8",children:[t.jsxs("div",{className:"w-32",children:[t.jsx("span",{className:"modal-label",children:" "}),$?t.jsx(B,{value:P?.request_type||"",onChange:e=>L(t=>t?{...t,request_type:e.target.value}:null),className:"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]",placeholder:"",disabled:mt&&!ut}):t.jsx("p",{className:"modal-value",children:T.request_type||""})]}),t.jsxs("div",{className:"w-32",children:[t.jsx("span",{className:"modal-label",children:" "}),$?t.jsx(B,{value:P?.payment_category||"",onChange:e=>L(t=>t?{...t,payment_category:e.target.value}:null),className:"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]",placeholder:"//",disabled:mt&&!ut}):t.jsx("p",{className:"modal-value",children:T.payment_category||"-"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:flex sm:gap-8",children:[t.jsxs("div",{className:"w-32",children:[t.jsx("span",{className:"modal-label",children:" "}),$?t.jsx(G,{onDateSelect:e=>{L(t=>t?{...t,delivery_request_date:Z(e,"yyyy-MM-dd")}:null)},placeholder:"  ",align:"start",side:"bottom",children:t.jsxs(u,{variant:"outline",className:"mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] justify-start text-left font-normal business-radius-input",disabled:mt&&!ut,children:[t.jsx(de,{className:"mr-1 h-3 w-3"}),P?.delivery_request_date?X(P.delivery_request_date):" "]})}):t.jsx("p",{className:"modal-subtitle",children:X(T.delivery_request_date)})]}),t.jsxs("div",{className:"w-32",children:[t.jsx("span",{className:"modal-label text-orange-500",children:" "}),$?t.jsx(G,{onDateSelect:e=>{L(t=>t?{...t,revised_delivery_request_date:Z(e,"yyyy-MM-dd")}:null)},placeholder:"  ",align:"start",side:"bottom",children:t.jsxs(u,{variant:"outline",className:"mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] justify-start text-left font-normal business-radius-input",disabled:mt&&!ut,children:[t.jsx(de,{className:"mr-1 h-3 w-3"}),P?.revised_delivery_request_date?X(P.revised_delivery_request_date):" "]})}):t.jsx("p",{className:"modal-subtitle text-orange-700",children:T.revised_delivery_request_date?X(T.revised_delivery_request_date):""})]})]})]})]}),t.jsxs("div",{className:"bg-white rounded-lg p-2 sm:p-3 border border-gray-100 shadow-sm",children:[t.jsxs("h3",{className:"modal-section-title mb-3 flex items-center",children:[t.jsx(j,{className:"w-4 h-4 mr-2 text-gray-600"})," "]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"grid grid-cols-1 sm:flex sm:gap-8",children:[t.jsxs("div",{className:"w-32",children:[t.jsx("span",{className:"modal-label",children:""}),$?t.jsx(ee,{options:ke.map(e=>({value:e.id.toString(),label:e.vendor_name})),value:P?.vendor_id?{value:P.vendor_id.toString(),label:P.vendor_name||ke.find(e=>e.id===P.vendor_id)?.vendor_name||""}:null,isDisabled:mt&&!ut,onChange:e=>{if(p.info("ReactSelect onChange:",{option:e}),e){const t=ke.find(t=>t.id.toString()===e.value);if(p.info("Selected vendor:",{selectedVendor:t}),t){m().from("vendor_contacts").select("id, contact_name, contact_email, contact_phone, position").eq("vendor_id",t.id).then(({data:e,error:n})=>{n&&p.error("    :",n),p.info("   -   :",{vendor_id:t.id,vendor_name:t.vendor_name,contactsData:e,contactsCount:e?.length||0}),L(n=>{const r=n?{...n,vendor_id:t.id,vendor_name:t.vendor_name,vendor:t,vendor_contacts:Array.isArray(e)?e:[],contact_id:void 0,contact_name:void 0}:null;return p.info("   - editedPurchase  :",{vendor_id:t.id,vendor_name:t.vendor_name,contactsData:e,updated_vendor_contacts:r?.vendor_contacts,updated_full:r}),r})})}}else L(e=>e?{...e,vendor_id:void 0,vendor_name:"",vendor:void 0,vendor_contacts:[],contact_id:void 0,contact_name:void 0}:null)},placeholder:" ",isClearable:!0,isSearchable:!0,menuPortalTarget:document.body,styles:{control:e=>({...e,minHeight:"20px",height:"20px",fontSize:"10px",borderRadius:"8px",borderColor:"#e5e7eb",borderWidth:"1px",backgroundColor:"#ffffff",boxShadow:"none",paddingLeft:"6px",paddingRight:"6px","&:hover":{borderColor:"#e5e7eb"},"&:focus-within":{borderColor:"#60a5fa",boxShadow:"none",outline:"none"}}),valueContainer:e=>({...e,height:"18px",padding:"0 2px",margin:"0"}),input:e=>({...e,margin:"0",padding:"0",fontSize:"10px"}),indicatorsContainer:e=>({...e,height:"18px",padding:"0"}),indicatorSeparator:()=>({display:"none"}),dropdownIndicator:e=>({...e,padding:"0 2px",svg:{width:"12px",height:"12px"}}),clearIndicator:e=>({...e,padding:"0 2px",svg:{width:"12px",height:"12px"}}),option:e=>({...e,fontSize:"10px",padding:"4px 8px"}),menuPortal:e=>({...e,zIndex:9999})},classNamePrefix:"vendor-select"}):t.jsx("p",{className:"modal-value",children:T.vendor?.vendor_name||"-"})]}),t.jsxs("div",{className:"w-32",children:[t.jsx("span",{className:"modal-label",children:" "}),$?P?.vendor_id?t.jsx(ee,{isDisabled:mt&&!ut,options:(()=>{const e=Array.isArray(P.vendor_contacts)?P.vendor_contacts:[],t=e.filter((e,t,n)=>n.findIndex(t=>t.id===e.id)===t),n=t.filter((e,t,n)=>n.findIndex(t=>t.contact_name===e.contact_name)===t),r=n.map(e=>({value:e.id.toString(),label:e.contact_name||""}))||[];return p.info("   :",{vendor_id:P.vendor_id,vendor_contacts_raw:P.vendor_contacts,vendor_contacts_count:e.length,unique_by_id_count:t.length,final_unique_count:n.length,options:r}),r})(),value:(()=>{const e=(Array.isArray(P.vendor_contacts)?P.vendor_contacts:[])[0];return e?.id?{value:e.id.toString(),label:e.contact_name||""}:null})(),onChange:e=>{if(p.info("   :",{option:e}),e){const t=Array.isArray(P.vendor_contacts)?P.vendor_contacts:[],n=t.find(t=>t.id.toString()===e.value);n&&L(e=>e?{...e,contact_id:n.id,contact_name:n.contact_name,vendor_contacts:[n,...t.filter(e=>e.id!==n.id)]}:null)}else L(e=>e?{...e,contact_id:void 0,contact_name:void 0,vendor_contacts:Array.isArray(P.vendor_contacts)?P.vendor_contacts:[]}:null)},placeholder:" ",isClearable:!0,isSearchable:!0,noOptionsMessage:()=>" ",menuPortalTarget:document.body,styles:{control:e=>({...e,minHeight:"20px",height:"20px",fontSize:"10px",borderRadius:"8px",borderColor:"#e5e7eb",borderWidth:"1px",backgroundColor:"#ffffff",boxShadow:"none",paddingLeft:"6px",paddingRight:"6px","&:hover":{borderColor:"#e5e7eb"},"&:focus-within":{borderColor:"#60a5fa",boxShadow:"none",outline:"none"}}),valueContainer:e=>({...e,height:"18px",padding:"0 2px",margin:"0"}),input:e=>({...e,margin:"0",padding:"0",fontSize:"10px"}),indicatorsContainer:e=>({...e,height:"18px",padding:"0"}),indicatorSeparator:()=>({display:"none"}),dropdownIndicator:e=>({...e,padding:"0 2px",svg:{width:"12px",height:"12px"}}),clearIndicator:e=>({...e,padding:"0 2px",svg:{width:"12px",height:"12px"}}),option:e=>({...e,fontSize:"10px",padding:"4px 8px"}),menuPortal:e=>({...e,zIndex:9999})},classNamePrefix:"contact-select"}):t.jsx(B,{value:"",disabled:!0,className:"mt-1 rounded-lg border-gray-200 w-full h-5 px-1.5 py-0.5 text-[10px]",placeholder:"  "}):t.jsx("p",{className:"modal-value",children:(()=>{const e=Array.isArray(T.vendor_contacts)?T.vendor_contacts:[],t=T.contact_name||e[0]?.contact_name||"-";return p.info(" vendor_contacts display :",{purchase_id:T?.id,vendor_id:T?.vendor_id,contact_id:T?.contact_id,vendor_contacts:T.vendor_contacts,purchase_contact_name:T.contact_name,contactName:t,purchase_full:T}),t})()})]})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:flex sm:gap-8",children:[t.jsxs("div",{className:"w-32",children:[t.jsx("span",{className:"modal-label",children:"PJ"}),$?t.jsx(B,{value:P?.project_vendor||"",onChange:e=>L(t=>t?{...t,project_vendor:e.target.value}:null),className:"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]",placeholder:"",disabled:mt&&!ut}):t.jsx("p",{className:"modal-value",children:T.project_vendor||"-"})]}),t.jsxs("div",{className:"w-32",children:[t.jsx("span",{className:"modal-label",children:"Item"}),$?t.jsx(B,{value:P?.project_item||"",onChange:e=>L(t=>t?{...t,project_item:e.target.value}:null),className:"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]",placeholder:"",disabled:mt&&!ut}):t.jsx("p",{className:"modal-subtitle break-all whitespace-pre-wrap",style:{whiteSpace:"pre-wrap",wordBreak:"break-all"},children:T.project_item||"-"})]})]}),t.jsx("div",{className:"grid grid-cols-1 sm:flex sm:gap-8",children:t.jsxs("div",{className:"w-32",children:[t.jsx("span",{className:"modal-label",children:""}),$?t.jsx(B,{value:P?.sales_order_number||"",onChange:e=>L(t=>t?{...t,sales_order_number:e.target.value}:null),className:"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]",placeholder:"",disabled:mt&&!ut}):t.jsx("p",{className:"modal-subtitle",children:T.sales_order_number||"-"})]})})]})]}),Be.length>0&&t.jsxs("div",{className:"bg-white rounded-lg p-2 sm:p-3 border border-gray-100 shadow-sm mt-3",children:[t.jsx("div",{className:"mb-2",children:t.jsxs("h3",{className:"modal-section-title flex items-center",children:[t.jsx(S,{className:"w-4 h-4 mr-2 text-gray-600"})," ",t.jsxs("span",{className:"ml-2 badge-stats bg-green-500 text-white text-[10px]",children:[Be.length,""]})]})}),t.jsx("div",{className:"space-y-2",children:Be.map(e=>t.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors",onClick:()=>{return t=e.image_url,Ye(t),void He(!0);var t},children:[t.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[t.jsx(ce,{className:"w-4 h-4 text-gray-400 flex-shrink-0"}),t.jsxs("div",{className:"min-w-0",children:[t.jsx("p",{className:"text-xs font-medium text-gray-900 truncate",children:e.vendor_name||e.file_name||""}),t.jsxs("p",{className:"text-[10px] text-gray-500",children:[e.statement_date?X(e.statement_date):X(e.uploaded_at),e.grand_total&&t.jsxs("span",{className:"ml-2 text-gray-700",children:[e.grand_total.toLocaleString(),""]})]})]})]}),t.jsx(u,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 flex-shrink-0",title:" ",children:t.jsx(ce,{className:"w-3 h-3"})})]},e.id))})]})]}),t.jsx("div",{className:"lg:w-fit lg:min-w-0 relative overflow-visible",children:t.jsxs("div",{className:"bg-white rounded-lg border border-gray-100 shadow-sm",children:[t.jsxs("div",{className:"p-2 sm:p-3 bg-gray-50 border-b border-gray-100 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-0",children:[t.jsxs("h3",{className:"modal-section-title flex items-center",children:[t.jsx(C,{className:"w-4 h-4 mr-2 text-gray-600"})," ",t.jsxs("span",{className:"ml-2 badge-stats bg-gray-500 text-white",children:[it?.length||0,""]}),$?t.jsx(ee,{isDisabled:mt&&!ut,options:[{value:"KRW",label:"KRW"},{value:"USD",label:"USD"},{value:"EUR",label:"EUR"},{value:"JPY",label:"JPY"},{value:"CNY",label:"CNY"}],value:P?.currency?{value:P.currency,label:P.currency}:{value:"KRW",label:"KRW"},onChange:e=>{e&&L(t=>t?{...t,currency:e.value}:null)},menuPortalTarget:document.body,styles:{control:e=>({...e,minHeight:"20px",height:"20px",width:"75px",fontSize:"10px",borderRadius:"8px",borderColor:"#e5e7eb",marginLeft:"8px"}),valueContainer:e=>({...e,padding:"0 6px",height:"20px"}),singleValue:e=>({...e,margin:0,position:"absolute",top:"50%",transform:"translateY(-50%)"}),input:e=>({...e,margin:0,padding:0}),indicatorsContainer:e=>({...e,height:"20px"}),indicatorSeparator:()=>({display:"none"}),dropdownIndicator:e=>({...e,padding:"0 4px"}),option:e=>({...e,fontSize:"10px",padding:"4px 8px"}),menuPortal:e=>({...e,zIndex:9999})}}):t.jsx("span",{className:"ml-2 badge-stats bg-blue-500 text-white",children:T.currency||"KRW"})]}),!$&&t.jsxs(t.Fragment,{children:["purchase"===o&&ft&&t.jsxs(u,{size:"sm",onClick:async()=>{if(!T||!ft)return;const e=`: ${T.purchase_order_number}\n\n  ?`;if(window.confirm(e)){T&&Number(T.id);try{const e=T.purchase_request_items||[],t=e.filter(e=>!e.is_payment_completed);if(0===t.length)return void se.info("   .");p.info(`  : ${t.length}  ( ${e.length} )`);for(const r of t){const e={is_payment_completed:!0,payment_completed_at:(new Date).toISOString()},{error:t}=await ct.from("purchase_request_items").update(e).eq("id",r.id);if(t)throw t;D(T.id,r.id)||p.warn("[PurchaseDetailModal]       ",{purchaseId:T.id,itemId:r.id})}se.success(`${t.length}   .`),await jt();const n=l?.(!0,{silent:!0});n instanceof Promise&&await n}catch(t){p.error("   ",t),se.error("    .")}}},className:"button-base bg-orange-500 hover:bg-orange-600 text-white",children:[t.jsx(me,{className:"w-3 h-3 mr-1"})," "]}),"receipt"===o&&_t&&t.jsx(Tr,{onConfirm:async(e,t)=>{if(!T||!_t)return;const n=`: ${T.purchase_order_number}\n\n  ?`;if(!window.confirm(n))return;const r=T?Number(T.id):NaN;try{const n=T.purchase_request_items||[],a=n.filter(e=>!e.is_received),i=()=>{Number.isNaN(r)||c?.(r,n=>{const r=(n.items||[]).map(n=>a.find(e=>String(e.id)===String(n.id))?{...n,is_received:!0,actual_received_date:n.actual_received_date||e.toISOString(),received_quantity:void 0!==t?t:n.quantity}:n),i=(n.purchase_request_items||[]).map(n=>a.find(e=>String(e.id)===String(n.id))?{...n,is_received:!0,actual_received_date:n.actual_received_date||e.toISOString(),received_quantity:void 0!==t?t:n.quantity}:n);return{...n,items:r,purchase_request_items:i,is_received:!0,received_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}})};if(0===a.length)return void se.info("   .");p.info(`  : ${a.length}  ( ${n.length} )`),i(),A(n=>{if(!n)return null;const r=n.items?.map(n=>a.find(e=>String(e.id)===String(n.id))?{...n,is_received:!0,received_at:(new Date).toISOString(),actual_received_date:e.toISOString(),received_quantity:void 0!==t?t:n.quantity}:n)||[],i=n.purchase_request_items?.map(n=>a.find(e=>String(e.id)===String(n.id))?{...n,is_received:!0,received_at:(new Date).toISOString(),actual_received_date:e.toISOString(),received_quantity:void 0!==t?t:n.quantity}:n)||[],s=r.length,o=r.filter(e=>e.is_received).length,l=s>0&&o===s;return{...n,items:r,purchase_request_items:i,is_received:l,received_at:l?(new Date).toISOString():n.received_at,updated_at:(new Date).toISOString()}});for(const r of a){const n={actual_received_date:e.toISOString(),is_received:!0,received_quantity:void 0!==t?t:r.quantity},{error:a}=await ct.from("purchase_request_items").update(n).eq("id",r.id);if(a)throw a;const i=void 0!==t?t:r.quantity;h(T.id,r.id,e.toISOString(),i)||p.warn("[PurchaseDetailModal]       ",{purchaseId:T.id,itemId:r.id})}se.success(`${a.length}   .`),await jt();const s=l?.(!0,{silent:!0});s instanceof Promise&&await s}catch(a){p.error("   ",a),se.error("    .")}},placeholder:" ",align:"end",side:"bottom",hideQuantityInput:!0,quantityInfoText:"   ",children:t.jsxs(u,{size:"sm",className:"button-base button-action-primary",children:[t.jsx(be,{className:"w-3 h-3 mr-1"})," "]})}),gt&&wt&&ht&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(G,{onDateSelect:async e=>{if(!T||!wt)return;e.toLocaleDateString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit"});const t=`: ${T.purchase_order_number}\n\n   ?`;if(!window.confirm(t))return;const n=e.toISOString();T&&Number(T.id);try{const e=T.purchase_request_items||[],t=e.filter(e=>!e.is_statement_received);if(0===t.length)return void se.info("    .");p.info(`   : ${t.length}  ( ${e.length} )`);for(const a of t){const e={is_statement_received:!0,statement_received_date:n,statement_received_by_name:Ne||null},{error:t}=await ct.from("purchase_request_items").update(e).eq("id",a.id);if(t)throw t;g(T.id,a.id,n,Ne||void 0)||p.warn("[PurchaseDetailModal]        ",{purchaseId:T.id,itemId:a.id})}se.success(`${t.length}    .`),await jt();const r=l?.(!0,{silent:!0});r instanceof Promise&&await r}catch(r){p.error("    ",r),se.error("     .")}},placeholder:"   ",align:"end",side:"bottom",children:t.jsxs(u,{size:"sm",className:"button-base button-action-primary",children:[t.jsx(w,{className:"w-3 h-3 mr-1"})," "]})}),"done"===o&&""===T.payment_category&&t.jsx(Mr,{onConfirm:async(e,t)=>{if(!T||!wt)return void se.error("    .");const n=`: ${T.purchase_order_number}\n\n   ?\n: ${e.toLocaleDateString("ko-KR")}\n : ${t.toLocaleString()}\n\n* :        ,    .`;if(!window.confirm(n))return;const r=T?Number(T.id):NaN;try{Number.isNaN(r)||c?.(r,n=>{const r=(n.items||[]).map(t=>({...t,expenditure_date:e.toISOString(),expenditure_amount:null}));return{...n,items:r,total_expenditure_amount:t}});const n=T.items||T.purchase_request_items||[];if(0===n.length)return void se.error(" .");A(n=>{if(!n)return null;const r=(n.items||n.purchase_request_items||[]).map(t=>({...t,expenditure_date:e.toISOString(),expenditure_amount:null}));return{...n,items:r,purchase_request_items:r,total_expenditure_amount:t,updated_at:(new Date).toISOString()}});const{error:a}=await ct.from("purchase_request_items").update({expenditure_date:e.toISOString(),expenditure_amount:null}).in("id",n.map(e=>e.id));if(a)throw p.error("    DB  ",{error:a}),a;const{error:i}=await ct.from("purchase_requests").update({total_expenditure_amount:t}).eq("id",r);if(i)throw p.error("    DB  ",{error:i}),i;q(T.id,e.toISOString(),t),se.success("   .")}catch(a){p.error("     ",a),se.error("      .")}},placeholder:"    ",align:"end",side:"bottom",children:t.jsxs(u,{size:"sm",className:"button-base button-action-primary",children:[t.jsx(ve,{className:"w-3 h-3 mr-1"}),""]})})]})]})]}),t.jsx("div",{className:"block sm:hidden bg-gray-50 px-2 py-1 border-b border-gray-100",children:t.jsx("div",{className:"text-xs font-medium text-gray-600",children:"  ( )"})}),t.jsx("div",{className:"max-h-[50vh] sm:max-h-[40vh] overflow-auto",children:t.jsxs("div",{className:"w-fit",children:[t.jsx("div",{className:"bg-gray-50 px-2 sm:px-3 py-1 border-b border-gray-100 sticky top-0 z-10 w-fit "+($?"pl-7 sm:pl-8":""),children:t.jsxs("div",{ref:lt,className:"hidden sm:grid gap-1 modal-label w-fit",style:{gridTemplateColumns:Pt()},children:[t.jsx("div",{className:"text-center -ml-2 sm:-ml-3",children:"#"}),t.jsx("div",{children:""}),t.jsx("div",{children:""}),t.jsx("div",{className:"text-center",children:"receipt"!==o&&"done"!==o||$?"":t.jsxs("div",{className:"flex flex-col items-center leading-tight",children:[t.jsx("div",{className:"text-[9px]",children:"/"}),t.jsx("div",{className:"text-[10px]",children:""})]})}),t.jsx("div",{className:"text-right",children:""}),t.jsx("div",{className:"text-right",children:""}),""===T.payment_category&&t.jsx("div",{className:"text-right",children:""}),t.jsx("div",{className:"text-center",children:""}),t.jsx("div",{className:"text-center",children:""}),"pending"!==o&&($?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-center",children:""}),"receipt"===o&&t.jsx(t.Fragment,{children:t.jsx("div",{className:"text-center",children:""})}),gt&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-center",children:" "}),t.jsx("div",{className:"text-center",children:" "}),vt&&t.jsx("div",{className:"text-center",children:""})]})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-center",children:"purchase"===o?"":"receipt"===o||"done"===o?"":""}),"receipt"===o&&t.jsx(t.Fragment,{children:t.jsx("div",{className:"text-center",children:""})}),gt&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-center",children:" "}),t.jsx("div",{className:"text-center",children:" "}),vt&&t.jsx("div",{className:"text-center",children:""})]})]}))]})}),$&&t.jsx(pr,{sensors:Xe,collisionDetection:Ft,onDragEnd:tt,children:t.jsx(Cr,{items:ot,strategy:Nr,children:(z||[]).map((e,n)=>t.jsx(Br,{id:et(e,n),children:t=>Xt(e,n,t,et(e,n))},et(e,n)))})}),!$&&t.jsx("div",{className:"divide-y divide-gray-100 overflow-visible w-fit",children:st?.map((e,t)=>Xt(e,t,void 0,et(e,t)))})]})}),t.jsxs("div",{className:"bg-gray-50 px-2 sm:px-3 border-t border-gray-100",children:[t.jsxs("div",{className:"hidden sm:grid items-center gap-1 py-2 w-fit",style:{gridTemplateColumns:Pt()},children:[t.jsx("div",{className:"-ml-2 sm:-ml-3"}),t.jsx("div",{}),t.jsx("div",{}),t.jsx("div",{}),t.jsx("div",{className:"text-right flex items-center justify-end",children:t.jsx("span",{className:"text-[11px] text-gray-600 font-medium",children:""})}),t.jsx("div",{className:"text-right flex items-center justify-end",children:t.jsx("span",{className:"text-[12px] font-bold text-gray-900",children:"done"!==o||ht?`${"USD"===($?P?.currency:T.currency)?"$":""}${Bt(st?.reduce((e,t)=>e+(t.amount_value||0),0)||0)}`:"-"})}),""===T.payment_category&&t.jsx("div",{className:"text-right flex items-center justify-end",children:t.jsx("span",{className:"text-[12px] font-bold text-gray-900",children:"done"!==o||ht?`${"USD"===($?P?.currency:T.currency)?"$":""}${Bt(st?.reduce((e,t)=>e+(t.tax_amount_value||0),0)||0)}`:"-"})}),t.jsx("div",{}),t.jsx("div",{}),"pending"!==o&&($?t.jsx("div",{}):t.jsx("div",{className:"done"===o&&""===T.payment_category?"text-right flex items-center justify-end":"",children:"done"===o&&""===T.payment_category&&t.jsx("span",{className:"text-[11px] text-gray-600 font-medium",children:""})})),"receipt"===o&&t.jsx("div",{}),"done"===o&&t.jsx(t.Fragment,{children:""===T.payment_category&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-right flex items-center justify-end",children:t.jsx("div",{className:"text-[12px] font-bold text-blue-700",children:ht?`${Bt(T.total_expenditure_amount??(($?z:it)?.reduce((e,t)=>e+(Number(t.expenditure_amount)||0),0)||0))}`:"-"})}),t.jsx("div",{}),t.jsx("div",{})]})})]}),""===T.payment_category&&t.jsxs("div",{className:"hidden sm:grid items-center gap-1 py-2 w-fit border-t border-gray-300",style:{gridTemplateColumns:Pt()},children:[t.jsx("div",{className:"-ml-2 sm:-ml-3"}),t.jsx("div",{}),t.jsx("div",{}),t.jsx("div",{}),t.jsx("div",{}),t.jsx("div",{className:"text-right flex items-center justify-end",children:t.jsx("span",{className:"text-[11px] text-gray-600 font-medium",children:""})}),t.jsx("div",{className:"text-right flex items-center justify-end",children:t.jsx("span",{className:"text-[12px] font-bold text-blue-600",children:"done"!==o||ht?`${Bt(($?z:it)?.reduce((e,t)=>e+(t.amount_value||0)+(t.tax_amount_value||0),0)||0)}`:"-"})}),t.jsx("div",{}),t.jsx("div",{}),t.jsx("div",{}),"receipt"===o&&t.jsx("div",{}),"done"===o&&""===T.payment_category&&t.jsxs(t.Fragment,{children:[t.jsx("div",{}),t.jsx("div",{}),t.jsx("div",{})]})]}),t.jsxs("div",{className:"block sm:hidden py-2 space-y-1",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-[12px] text-gray-500",children:" "}),t.jsx("span",{className:"text-[13px] font-bold text-gray-900",children:"done"!==o||ht?`${Bt(($?z:it)?.reduce((e,t)=>e+(t.amount_value||0),0)||0)}`:"-"})]}),""===T.payment_category&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-[12px] text-gray-500",children:" "}),t.jsx("span",{className:"text-[13px] font-bold text-gray-900",children:"done"!==o||ht?`${Bt(($?z:it)?.reduce((e,t)=>e+(t.tax_amount_value||0),0)||0)}`:"-"})]}),t.jsxs("div",{className:"flex justify-between items-center border-t pt-1",children:[t.jsx("span",{className:"text-[12px] text-gray-500",children:"+"}),t.jsx("span",{className:"text-[13px] font-bold text-blue-600",children:"done"!==o||ht?`${Bt(($?z:it)?.reduce((e,t)=>e+(t.amount_value||0)+(t.tax_amount_value||0),0)||0)}`:"-"})]})]}),"done"===o&&""===T.payment_category&&t.jsxs("div",{className:"flex justify-between items-center border-t pt-1",children:[t.jsx("span",{className:"text-[12px] text-gray-500",children:" "}),t.jsx("span",{className:"text-[13px] font-bold text-blue-700",children:ht?`${Bt(T.total_expenditure_amount??(($?z:it)?.reduce((e,t)=>e+(Number(t.expenditure_amount)||0),0)||0))}`:"-"})]})]})]}),$&&t.jsx("div",{className:"p-2 sm:p-3 border-t border-gray-100",children:t.jsxs(u,{size:"sm",variant:"outline",onClick:()=>{const e={item_name:"",specification:"",quantity:1,unit_price_value:0,amount_value:0,remark:"",line_number:z.reduce((e,t)=>{const n=t.line_number||0;return n>e?n:e},0)+1,tempId:`tmp-new-${Date.now()}-${Math.random()}`},t=[...z,e].sort((e,t)=>(e.line_number||999999)-(t.line_number||999999)).map((e,t)=>({...e,line_number:t+1,stableKey:e.stableKey??Ge(e,t)}));F(t)},className:"w-full rounded-lg border-dashed border-2 border-gray-300 hover:border-gray-400 py-2 badge-text",children:[t.jsx(K,{className:"w-4 h-4 mr-1"})," "]})})]})})]})]}):t.jsx("div",{className:"text-center py-12",children:E?t.jsxs("div",{className:"flex items-center justify-center gap-2",children:[t.jsx("div",{className:"w-5 h-5 border-2 border-gray-300 border-t-transparent rounded-full animate-spin"}),t.jsx("span",{className:"modal-subtitle",children:" ..."})]}):t.jsxs("div",{className:"space-y-3",children:[t.jsx("span",{className:"modal-subtitle",children:"   ."}),!i&&t.jsx("div",{children:t.jsx(u,{size:"sm",variant:"outline",onClick:a,className:"button-base button-action-secondary",children:""})})]})})});return i?Qt:t.jsxs(t.Fragment,{children:[t.jsx(U,{open:r,onOpenChange:a,children:t.jsxs(H,{className:"overflow-hidden bg-white rounded-lg shadow-sm border-0 w-full sm:w-auto max-w-[calc(100vw-48px)] sm:max-w-[calc(100vw-80px)] lg:max-w-[90vw] xl:max-w-[85vw] h-[95vh] sm:h-auto sm:max-h-[90vh] lg:max-h-[85vh] sm:rounded-lg flex flex-col",showCloseButton:!1,children:[t.jsx(V,{className:"sr-only",children:t.jsx(Y,{children:"  "})}),t.jsxs("div",{className:"relative px-3 sm:px-6 pt-0 sm:pt-3 lg:pt-4 pb-0 sm:pb-2 lg:pb-3 flex-shrink-0",children:[t.jsxs("div",{className:"absolute right-3 sm:right-6 top-3 sm:top-3 lg:top-4 flex items-center gap-2 z-10",children:[!$&&pt&&t.jsxs(u,{size:"sm",variant:"outline",onClick:()=>Lt(!0),className:"button-base button-action-secondary h-8 text-xs px-3",children:[t.jsx(_e,{className:"w-3.5 h-3.5 mr-1.5"}),""]}),!$&&xt&&d&&t.jsxs(u,{size:"sm",variant:"outline",onClick:()=>{T&&d(T)},className:"button-base button-action-danger h-8 text-xs px-3",children:[t.jsx(pe,{className:"w-3.5 h-3.5 mr-1.5"}),""]}),!bt&&!$&&t.jsxs(te,{open:Ee,onOpenChange:Me,children:[t.jsx(ne,{asChild:!0,children:t.jsxs(u,{variant:"outline",size:"sm",className:"button-base button-action-secondary h-8 text-xs px-3 gap-1.5",title:" ",children:[t.jsx(fe,{className:"w-3.5 h-3.5 text-gray-500"}),t.jsx("span",{children:" "})]})}),t.jsx(re,{className:"w-80 sm:w-96 p-4",align:"end",onOpenAutoFocus:e=>e.preventDefault(),children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("h4",{className:"font-medium leading-none",children:" "}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"     ."})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsx(ie,{htmlFor:"subject",className:"text-xs",children:""}),t.jsx(B,{id:"subject",value:Te,onChange:e=>Ae(e.target.value),className:"h-8 text-xs",placeholder:" "})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx(ie,{htmlFor:"message",className:"text-xs",children:""}),t.jsx("div",{className:"relative",onWheel:e=>e.stopPropagation(),children:t.jsx(ae,{id:"message",value:$e,onChange:e=>We(e.target.value),className:"min-h-[150px] text-xs font-mono overflow-auto",placeholder:"  ",style:{resize:"none"}})})]})]}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx(u,{variant:"outline",size:"sm",onClick:()=>Me(!1),className:"h-8 text-xs",children:""}),t.jsx(u,{size:"sm",onClick:async()=>{if(Te.trim()&&$e.trim()){Le(!0);try{const{data:{user:e}}=await ct.auth.getUser();if(!e)return void se.error(" .");const{error:t}=await ct.from("support_inquires").insert({user_id:e.id,user_email:e.email,user_name:Ne,inquiry_type:"modify",subject:Te,message:$e,status:"open",purchase_request_id:T?.id,purchase_order_number:T?.purchase_order_number,requester_id:T?.requester_id,purchase_info:JSON.stringify({vendor_name:T?.vendor_name,total_amount:T?.total_amount,item_count:T?.purchase_request_items?.length||0})});if(t)throw t;se.success("  ."),Me(!1),Ae(""),We("")}catch(e){p.error("   ",e),se.error("     .")}finally{Le(!1)}}else se.error("   .")},disabled:Pe,className:"h-8 text-xs bg-blue-600 hover:bg-blue-700",children:Pe?" ...":" "})]})]})})]}),t.jsx("button",{onClick:a,className:"button-base button-action-secondary w-8 h-8 rounded-full flex items-center justify-center",children:t.jsx(y,{className:"w-4 h-4 text-gray-500"})})]}),t.jsx("div",{className:"pr-8 sm:pr-16",children:t.jsxs("div",{className:"flex items-start gap-4 mb-0 sm:mb-3",children:[t.jsx("div",{className:"min-w-0 flex-1",children:t.jsx("h1",{className:"page-title mb-0 sm:mb-1",children:" "})}),t.jsx("div",{className:"flex items-center gap-3",children:$&&t.jsxs(t.Fragment,{children:[t.jsxs(u,{size:"sm",variant:"outline",onClick:()=>{Lt(!1),L(T),F(T?.items||[]),J([])},className:"button-base button-action-secondary",children:[t.jsx(y,{className:"w-4 h-4 mr-2"}),""]}),t.jsx(u,{size:"sm",onClick:async()=>{if(T&&P){Fe(!0),p.info("handleSave :",{purchaseId:T.id,vendor_id:P.vendor_id,vendor_name:P.vendor_name,vendor:P.vendor,editedPurchase:P});try{const e=m(),t=z.reduce((e,t)=>e+(t.amount_value||0),0);p.info("Update payload:",{purchase_order_number:P.purchase_order_number||null,requester_name:P.requester_name||null,vendor_id:P.vendor_id||null,vendor_name:P.vendor_name||null,delivery_request_date:P.delivery_request_date||null,revised_delivery_request_date:P.revised_delivery_request_date||null,payment_category:P.payment_category||null,project_vendor:P.project_vendor||null,project_item:P.project_item||null,sales_order_number:P.sales_order_number||null,total_amount:Number(t),updated_at:(new Date).toISOString()});let n=null;P.contact_id?n=P.contact_id:Array.isArray(P.vendor_contacts)&&P.vendor_contacts.length>0&&(n=P.vendor_contacts[0].id||null);const{error:r}=await e.from("purchase_requests").update({purchase_order_number:P.purchase_order_number||null,requester_name:P.requester_name||null,vendor_id:P.vendor_id||null,vendor_name:P.vendor_name||null,contact_id:n,delivery_request_date:P.delivery_request_date||null,revised_delivery_request_date:P.revised_delivery_request_date||null,payment_category:P.payment_category||null,project_vendor:P.project_vendor||null,project_item:P.project_item||null,sales_order_number:P.sales_order_number||null,total_amount:Number(t),updated_at:(new Date).toISOString()}).eq("id",T.id);if(r)throw p.error("Purchase update error:",r),r;let i=null;if(p.info("  :",{vendor_id:P.vendor_id,vendor_contacts:P.vendor_contacts,isArray:Array.isArray(P.vendor_contacts)}),P.vendor_id&&Array.isArray(P.vendor_contacts)&&P.vendor_contacts.length>0){const t=P.vendor_contacts[0];if(p.info(" :",{contact:t}),t.id){i=t.id;const{error:n}=await e.from("vendor_contacts").update({contact_name:t.contact_name||"",contact_email:t.contact_email||"",contact_phone:t.contact_phone||"",position:t.position||""}).eq("id",t.id);n?p.error("  :",n):A(e=>{const n=e?{...e,vendor_contacts:[t],contact_id:t.id,contact_name:t.contact_name}:null;return p.info("    setPurchase:",{prev_vendor_contacts:e?.vendor_contacts,new_vendor_contacts:[t],updated_purchase:n}),n})}else if(t.contact_name){const{data:n,error:r}=await e.from("vendor_contacts").insert({vendor_id:P.vendor_id,contact_name:t.contact_name,contact_email:t.contact_email||"",contact_phone:t.contact_phone||"",position:t.position||""}).select().single();if(r)p.error("  :",r);else if(n){i=n.id,P.vendor_contacts=[n],p.info("  :",n),A(e=>{const t=e?{...e,vendor_contacts:[n],contact_id:n.id,contact_name:n.contact_name}:null;return p.info("     setPurchase:",{prev_vendor_contacts:e?.vendor_contacts,new_vendor_contacts:[n],newContact_full:n,updated_purchase:t}),t});const{error:t}=await e.from("purchase_requests").update({contact_id:n.id}).eq("id",T.id);t&&p.error("purchase_requests contact_id  :",t)}}}if(Q.length>0){const{error:t}=await e.from("purchase_request_items").delete().in("id",Q);if(t)throw t}if(0===z.length){p.info("     ",{purchaseId:T.id,deletedItemIds:Q});const{error:t}=await e.from("purchase_requests").delete().eq("id",T.id);if(t)throw p.error("  ",t),t;const n=Number(T.id);if(!Number.isNaN(n)){k(n)?p.info(" [handleSave]      ",{purchaseId:n}):p.warn("[handleSave]      ",{purchaseId:n})}se.success("    ."),Lt(!1),J([]),a();const r=l?.(!0,{silent:!1});return void(r instanceof Promise&&await r)}for(const a of z){if(!a.item_name||!a.item_name.trim())throw new Error(" .");if(!a.quantity||a.quantity<=0)throw new Error(" 0  .");if(null!==a.unit_price_value&&void 0!==a.unit_price_value&&a.unit_price_value<0)throw new Error(" 0  .");if(null!==a.amount_value&&void 0!==a.amount_value&&a.amount_value<0)throw new Error(" 0  .");if(a.id){const{error:t}=await e.from("purchase_request_items").update({item_name:a.item_name.trim(),specification:a.specification||null,quantity:Number(a.quantity),received_quantity:null!==a.received_quantity&&void 0!==a.received_quantity?Number(a.received_quantity):null,unit_price_value:Number(a.unit_price_value),unit_price_currency:T.currency||"KRW",amount_value:Number(a.amount_value),amount_currency:T.currency||"KRW",remark:a.remark||null,updated_at:(new Date).toISOString()}).eq("id",a.id);if(t)throw p.error("   ",t),t}else{const t={purchase_request_id:T.id,item_name:a.item_name.trim(),specification:a.specification||null,quantity:Number(a.quantity),received_quantity:null!==a.received_quantity&&void 0!==a.received_quantity?Number(a.received_quantity):null,unit_price_value:Number(a.unit_price_value),unit_price_currency:T.currency||"KRW",amount_value:Number(a.amount_value),amount_currency:T.currency||"KRW",remark:a.remark||null,line_number:a.line_number||z.indexOf(a)+1,created_at:(new Date).toISOString()},{data:n,error:r}=await e.from("purchase_request_items").insert(t).select().single();if(r)throw p.error("   ",r),r;if(n){const e=z.indexOf(a);-1!==e&&(z[e]={...z[e],...n},p.info("   ID :",{id:n.id,itemIndex:e}))}}}const s=T?Number(T.id):NaN,o=P||T;if(!Number.isNaN(s)&&Q.length>0&&(p.info(" [ ]     ",{purchaseId:s,deletedItemIds:Q,deletedCount:Q.length}),Q.forEach(e=>{I(s,e)?p.info(" [handleSave]       ",{purchaseId:s,itemId:e}):p.warn("[handleSave]       ",{purchaseId:s,itemId:e})})),!Number.isNaN(s)){const e=N(s,e=>{const t=z.reduce((e,t)=>e+(t.amount_value||0),0);return p.info(" [ ]    ",{purchaseId:s,newTotalAmount:t,itemsCount:z.length}),{...e,purchase_order_number:o?.purchase_order_number||e.purchase_order_number,requester_name:o?.requester_name||e.requester_name,vendor_id:o?.vendor_id||e.vendor_id,vendor_name:o?.vendor_name||e.vendor_name,vendor:o?.vendor||e.vendor,vendor_contacts:o?.vendor_contacts||e.vendor_contacts,delivery_request_date:o?.delivery_request_date||e.delivery_request_date,revised_delivery_request_date:o?.revised_delivery_request_date||e.revised_delivery_request_date,payment_category:o?.payment_category||e.payment_category,project_vendor:o?.project_vendor||e.project_vendor,project_item:o?.project_item||e.project_item,total_amount:t,items:z,purchase_request_items:z,updated_at:(new Date).toISOString()}});p.info(" [ ]    :",{memoryUpdated:e})}(()=>{!Number.isNaN(s)&&c&&c(s,e=>{const t=z,n=t.reduce((e,t)=>e+(t.amount_value||0),0);return p.info(" [onOptimisticUpdate]  UI ",{originalItemsCount:e.items?.length||e.purchase_request_items?.length||0,finalItemsCount:t.length,deletedItemsCount:Q.length}),{...e,purchase_order_number:o?.purchase_order_number||e.purchase_order_number,requester_name:o?.requester_name||e.requester_name,vendor_id:o?.vendor_id||e.vendor_id,vendor_name:o?.vendor_name||e.vendor_name,vendor:o?.vendor||e.vendor,vendor_contacts:o?.vendor_contacts||e.vendor_contacts,delivery_request_date:o?.delivery_request_date||e.delivery_request_date,revised_delivery_request_date:o?.revised_delivery_request_date||e.revised_delivery_request_date,payment_category:o?.payment_category||e.payment_category,project_vendor:o?.project_vendor||e.project_vendor,project_item:o?.project_item||e.project_item,total_amount:n,items:t,purchase_request_items:t,updated_at:(new Date).toISOString()}})})(),se.success("   ."),Lt(!1),J([]),await jt(),p.info(" refreshModalData   purchase:",{purchaseId:T?.id});const d=l?.(!0,{silent:!0});d instanceof Promise&&await d}catch(e){p.error("   ",e);const t=e instanceof Error?e.message:"    ";se.error(` : ${t}`)}finally{Fe(!1)}}else se.error("  .")},disabled:ze,className:"button-base button-action-primary",children:ze?t.jsxs(t.Fragment,{children:[t.jsx(he,{className:"w-4 h-4 mr-2 animate-spin"})," ..."]}):t.jsxs(t.Fragment,{children:[t.jsx(ge,{className:"w-4 h-4 mr-2"}),""]})})]})})]})})]}),t.jsx("div",{className:"overflow-y-auto flex-1 px-3 sm:px-6 pb-1 sm:pb-6 mt-0",children:Qt})]})}),t.jsx(U,{open:Ue,onOpenChange:He,children:t.jsxs(H,{className:"max-w-[90vw] max-h-[90vh] p-0 bg-black/90 border-none",children:[t.jsx("div",{className:"absolute top-4 right-4 z-50",children:t.jsx(u,{size:"sm",variant:"ghost",onClick:()=>He(!1),className:"text-white hover:bg-white/20",children:t.jsx(y,{className:"w-5 h-5"})})}),t.jsx("div",{className:"flex items-center justify-center w-full h-[80vh] overflow-auto p-4",children:Ve&&t.jsx("img",{src:Ve,alt:"",className:"max-w-full max-h-full object-contain"})})]})})]})}),Ur=Object.freeze(Object.defineProperty({__proto__:null,default:Kr},Symbol.toStringTag,{value:"Module"}));export{Ve as A,Fr as C,Wr as D,fe as M,Kr as P,Pr as R,be as T,Qe as a,Je as b,Ze as c,et as d,Ge as e,nt as f,tt as g,Lr as h,zr as i,ve as j,_e as k,Ur as l,Ar as u};
//# sourceMappingURL=PurchaseDetailModal-D_hFDaXe.js.map
