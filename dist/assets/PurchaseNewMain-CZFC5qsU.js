const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/react-select.esm-CLLcTgQc.js","assets/index-Cwj1VDZQ.js","assets/index-DNH5yCxE.css"])))=>i.map(i=>d[i]);
import{u as De,a as ze,r as n,j as e,b as j,X as le,_ as Ie}from"./index-Cwj1VDZQ.js";import{I as h,D as Ee,a as Te,b as Oe,c as $e,e as Ke,f as Pe}from"./input-DpPMYmYR.js";import{u as Fe,a as We,L as p}from"./index.esm-2eICt5Uc.js";import{S,a as C,b as q,c as k,d as _}from"./select-C9layrVS.js";import{B as Le,t as V}from"./index-ByU51ANB.js";import{P as ie}from"./plus-BibPN1y3.js";import{S as Me}from"./save-CgZPTSfb.js";const ce=n.lazy(()=>Ie(()=>import("./react-select.esm-CLLcTgQc.js"),__vite__mapDeps([0,1,2])));function tt(){const J=De(),f=ze(),[x,de]=n.useState(null),[u,R]=n.useState(""),[K,w]=n.useState([]),[D,z]=n.useState(!1),[Q,me]=n.useState(1),[Ue,Be]=n.useState("");n.useEffect(()=>{(async()=>{const{data:{user:a}}=await f.auth.getUser();de(a)})()},[]),n.useEffect(()=>{(async()=>{try{const{data:a,error:s}=await f.from("employees").select("id, name, email, phone, address, position, department").order("name");if(a&&!s&&a.length>0){if(w(a.map(r=>({id:r.id,name:r.name,email:r.email||"",phone:r.phone||"",address:r.address||"",position:r.position||"",department:r.department||""}))),u&&!a.find(r=>r.name===u)){const r={id:x?.id||"current-user",name:u,email:x?.email||"",phone:"",address:"",position:"",department:""};w([...a.map(o=>({id:o.id,name:o.name,email:o.email||"",phone:o.phone||"",address:o.address||"",position:o.position||"",department:o.department||""})),r])}}else w(u?[{id:x?.id||"current-user",name:u,email:x?.email||"",phone:"",address:"",position:"",department:""}]:[])}catch{w(u?[{id:x?.id||"current-user",name:u,email:x?.email||"",phone:"",address:"",position:"",department:""}]:[])}})()},[u,x]);const[P,ue]=n.useState([]),[X,I]=n.useState([]),[F,W]=n.useState(""),[Ae,he]=n.useState([]),[m,L]=n.useState("KRW"),[G,M]=n.useState(!1),[Y,E]=n.useState(""),[pe,Z]=n.useState({}),[xe,U]=n.useState(!1),[B,T]=n.useState([]),[ge,O]=n.useState(!1),A=n.useRef(!1),{control:_e,handleSubmit:fe,watch:c,setValue:l,reset:ve,getValues:ee}=Fe({defaultValues:{progress_type:"",payment_category:"",currency:"KRW",po_template_type:"일반",request_type:"",contacts:[],sales_order_number:"",project_vendor:"",project_item:"",delivery_request_date:"",vendor_id:0,requester_name:"",items:[{line_number:1,item_name:"",specification:"",quantity:1,unit_price_value:0,unit_price_currency:"KRW",amount_value:0,amount_currency:"KRW",remark:"",link:""}],request_date:new Date().toISOString().slice(0,10)}}),{fields:g,append:te,remove:se,update:b}=We({control:_e,name:"items"});n.useEffect(()=>{if(!x?.email||D)return;(async()=>{const{data:a}=await f.from("employees").select("name").eq("email",x.email).single();a?.name&&(R(a.name),l("requester_name",a.name),z(!0))})()},[x,f,l,D]),n.useEffect(()=>{(async()=>{if(x?.email&&l&&!D)try{const{data:a,error:s}=await f.from("employees").select("name").eq("email",x.email).single();if(a&&!s)R(a.name),setTimeout(()=>{l("requester_name",a.name,{shouldValidate:!0,shouldDirty:!0})},100),z(!0);else{const r=x.email.split("@")[0]||"사용자";R(r),setTimeout(()=>{l("requester_name",r,{shouldValidate:!0,shouldDirty:!0})},100),z(!0)}}catch{const s=x.email?.split("@")[0]||"사용자";R(s),setTimeout(()=>{l("requester_name",s,{shouldValidate:!0,shouldDirty:!0})},100),z(!0)}})()},[x,l,D]),n.useEffect(()=>{(async()=>{try{const{data:a,error:s}=await f.from("vendors").select("*").order("vendor_name");if(s)throw s;ue(a||[])}catch{V.error("업체 목록을 불러올 수 없습니다.")}})()},[]);const N=c("vendor_id");n.useEffect(()=>{(async()=>{if(N)try{const{data:a,error:s}=await f.from("vendor_contacts").select("id, contact_name, contact_email, contact_phone, position").eq("vendor_id",N);if(s)throw s;I(a||[])}catch{I([])}else I([])})()},[N]),n.useEffect(()=>{const a=ee("items").map(s=>({...s,unit_price_currency:m,amount_currency:m}));l("items",a),L(m)},[m,l,ee]),n.useEffect(()=>{g.forEach((t,a)=>{const s=Number(t.quantity)*Number(t.unit_price_value);t.amount_value!==s&&b(a,{...t,amount_value:s})})},[g.map(t=>`${t.quantity}-${t.unit_price_value}`).join(",")]);const ae=()=>{const t=c("request_type"),a=c("progress_type"),s=c("payment_category"),r=c("vendor_id");return!!(t&&a&&s&&r&&r!==0&&g.length>0)},[ye,je]=n.useState(!1);n.useEffect(()=>{je(ae())},[c("request_type"),c("progress_type"),c("payment_category"),c("vendor_id"),g]);const be=async()=>{const t=new Date,r=`F${new Date(t.getTime()+540*60*1e3).toISOString().slice(0,10).replace(/-/g,"")}_`,{data:o,error:v}=await f.from("purchase_requests").select("purchase_order_number").like("purchase_order_number",`${r}%`).order("purchase_order_number",{ascending:!1});let d=1,i=0;if(o&&o.length>0){for(const Re of o){const oe=Re.purchase_order_number.split("_");if(oe.length>=2){const Ve=oe[1],H=parseInt(Ve,10);!isNaN(H)&&H>i&&(i=H)}}d=i+1}const y=isNaN(d)?1:d;return`${r}${String(y).padStart(3,"0")}`},we=async t=>{const a=K.find(s=>s.name===t.requester_name);if(!A.current){if(!a){E("구매요청자 이름에 해당하는 직원이 없습니다. 이름을 정확히 입력해 주세요.");return}if(ae()){A.current=!0,M(!0),E("");try{let s=0,r="";const o=5;let v=0;for(;v<o;)try{r=await be();const{data:d,error:i}=await f.from("purchase_requests").insert({requester_id:a.id,purchase_order_number:r,requester_name:t.requester_name,requester_phone:a?.phone,requester_fax:null,requester_address:a?.address,vendor_id:t.vendor_id,sales_order_number:t.sales_order_number,project_vendor:t.project_vendor,project_item:t.project_item,request_date:t.request_date,delivery_request_date:t.delivery_request_date||null,request_type:t.request_type,progress_type:t.progress_type,is_payment_completed:!1,payment_category:t.payment_category,currency:m,total_amount:g.reduce((y,ne)=>y+ne.amount_value,0),unit_price_currency:g[0]?.unit_price_currency||m,po_template_type:t.po_template_type,contact_id:t.contact_id?Number(t.contact_id):null}).select("id").single();if(i&&!i.message.includes("duplicate key value violates unique constraint"))throw i;if(i&&i.message.includes("duplicate key value violates unique constraint")){if(v++,v>=o)throw new Error(`발주요청번호 생성에 ${o}번 실패했습니다. 잠시 후 다시 시도해주세요.`);await new Promise(y=>setTimeout(y,100+Math.random()*200));continue}if(!d)throw new Error("등록 실패");s=d.id;break}catch(d){if(!d.message.includes("duplicate key value violates unique constraint"))throw d;if(v++,v>=o)throw new Error(`발주요청번호 생성에 ${o}번 실패했습니다. 잠시 후 다시 시도해주세요.`);await new Promise(i=>setTimeout(i,100+Math.random()*200))}for(const[d,i]of g.entries()){const{error:y}=await f.from("purchase_request_items").insert({purchase_request_id:s,line_number:d+1,item_name:i.item_name,specification:i.specification,quantity:i.quantity,unit_price_value:i.unit_price_value,unit_price_currency:m,amount_value:i.amount_value,amount_currency:m,remark:i.remark,link:i.link||null});if(y)throw y}try{const d=await fetch(`/api/purchase/${s}/notify-middle-manager`,{method:"POST",headers:{"Content-Type":"application/json"}});if(d.ok){const i=await d.json()}else{const i=await d.text()}}catch{}ve({progress_type:"",payment_category:"",currency:"KRW",po_template_type:"일반",request_type:"",contacts:[],sales_order_number:"",project_vendor:"",project_item:"",delivery_request_date:"",vendor_id:0,requester_name:u,items:[{line_number:1,item_name:"",specification:"",quantity:1,unit_price_value:0,unit_price_currency:"KRW",amount_value:0,amount_currency:"KRW",remark:"",link:""}],request_date:new Date().toISOString().slice(0,10)}),W(""),he([]),L("KRW"),E(""),M(!1),V.success("발주요청서가 성공적으로 생성되었습니다.");try{await J("/purchase/list")}catch{window.location.href="/purchase/list"}return}catch(s){E(s.message||"오류가 발생했습니다."),V.error(s.message||"발주요청서 저장에 실패했습니다.")}finally{M(!1),A.current=!1}}}},Ne=g.reduce((t,a)=>t+a.amount_value,0),Se=()=>{const t=X.map(s=>({...s,isNew:!1})),a={contact_name:"",contact_email:"",contact_phone:"",position:"",isNew:!0};T([...t,a]),O(!1),U(!0)},$=(t,a,s)=>{T(r=>r.map((o,v)=>v===t?{...o,[a]:s}:o)),O(!0)},Ce=()=>{T(t=>[...t,{contact_name:"",contact_email:"",contact_phone:"",position:"",isNew:!0}]),O(!0)},qe=t=>{T(a=>a.filter((s,r)=>r!==t)),O(!0)},ke=async()=>{if(N)try{if(B.filter(s=>s.contact_email&&s.contact_email.endsWith("@hansl.io")).length>0){alert("한슬 직원 이메일은 업체 담당자로 등록할 수 없습니다.");return}for(const s of B)s.contact_name&&s.contact_email&&(!s.isNew&&s.id?await f.from("vendor_contacts").update({contact_name:s.contact_name,contact_email:s.contact_email,contact_phone:s.contact_phone||"",position:s.position||""}).eq("id",s.id):s.isNew&&await f.from("vendor_contacts").insert({vendor_id:N,contact_name:s.contact_name,contact_email:s.contact_email,contact_phone:s.contact_phone||"",position:s.position||""}));const{data:a}=await f.from("vendor_contacts").select("id, contact_name, contact_email, contact_phone, position").eq("vendor_id",N);a&&I(a),U(!1),V.success("담당자 정보가 저장되었습니다.")}catch{V.error("담당자 저장에 실패했습니다.")}},re=c("payment_category");return e.jsxs("form",{onSubmit:t=>{t.preventDefault(),fe(we)(t)},onKeyDown:t=>{(t.key==="Enter"||t.keyCode===13)&&t.preventDefault()},children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 lg:gap-6",children:[e.jsxs("div",{className:"w-full lg:w-1/4 relative bg-muted/20 border border-border rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300 p-4 lg:p-5 space-y-4",children:[e.jsxs("div",{className:"flex flex-row items-start justify-between w-full mb-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h4",{className:"font-semibold text-foreground",children:"발주 기본 정보"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:"Basic Information"})]}),e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsxs(p,{className:"mb-1 block text-xs",children:["발주서 종류",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsxs(S,{value:c("po_template_type"),onValueChange:t=>l("po_template_type",t),children:[e.jsx(C,{className:"h-9 w-28 bg-white border border-[#d2d2d7] rounded-md text-xs shadow-sm hover:shadow-md transition-shadow duration-200",children:e.jsx(q,{placeholder:"종류 선택"})}),e.jsxs(k,{position:"popper",className:"z-[9999]",children:[e.jsx(_,{value:"일반",children:"일반"}),e.jsx(_,{value:"PCB",children:"PCB"}),e.jsx(_,{value:"소모품",children:"소모품"}),e.jsx(_,{value:"기타",children:"기타"})]})]})]})]}),c("po_template_type")==="일반"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-1.5 sm:gap-2",children:[e.jsxs("div",{children:[e.jsxs(p,{className:"mb-0.5 block text-[10px] sm:text-xs",children:["요청 유형",e.jsx("span",{className:"text-red-500 ml-0.5",children:"*"})]}),e.jsxs(S,{value:c("request_type"),onValueChange:t=>l("request_type",t),children:[e.jsx(C,{className:"h-7 sm:h-8 lg:h-9 bg-white border border-[#d2d2d7] rounded-md text-[11px] sm:text-xs shadow-sm hover:shadow-md transition-shadow duration-200",children:e.jsx(q,{placeholder:"선택"})}),e.jsxs(k,{position:"popper",className:"z-[9999]",children:[e.jsx(_,{value:"원자재",children:"원자재"}),e.jsx(_,{value:"소모품",children:"소모품"})]})]})]}),e.jsxs("div",{children:[e.jsxs(p,{className:"mb-0.5 block text-[10px] sm:text-xs",children:["진행 종류",e.jsx("span",{className:"text-red-500 ml-0.5",children:"*"})]}),e.jsxs(S,{value:c("progress_type"),onValueChange:t=>l("progress_type",t),children:[e.jsx(C,{className:"h-7 sm:h-8 lg:h-9 bg-white border border-[#d2d2d7] rounded-md text-[11px] sm:text-xs shadow-sm hover:shadow-md transition-shadow duration-200",children:e.jsx(q,{placeholder:"선택"})}),e.jsxs(k,{position:"popper",className:"z-[9999]",children:[e.jsx(_,{value:"일반",children:"일반"}),e.jsx(_,{value:"선진행",children:"선진행"})]})]})]}),e.jsxs("div",{children:[e.jsxs(p,{className:"mb-0.5 block text-[10px] sm:text-xs",children:["결제 종류",e.jsx("span",{className:"text-red-500 ml-0.5",children:"*"})]}),e.jsxs(S,{value:c("payment_category"),onValueChange:t=>l("payment_category",t),children:[e.jsx(C,{className:"h-7 sm:h-8 lg:h-9 bg-white border border-[#d2d2d7] rounded-md text-[11px] sm:text-xs shadow-sm hover:shadow-md transition-shadow duration-200",children:e.jsx(q,{placeholder:"선택"})}),e.jsxs(k,{position:"popper",className:"z-[9999]",children:[e.jsx(_,{value:"발주",children:"발주"}),e.jsx(_,{value:"구매 요청",children:"구매 요청"}),e.jsx(_,{value:"현장 결제",children:"현장 결제"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-1.5 sm:gap-2 lg:grid-cols-2",children:[e.jsxs("div",{children:[e.jsxs(p,{className:"mb-0.5 block text-[10px] sm:text-xs",children:["업체명",e.jsx("span",{className:"text-red-500 ml-0.5",children:"*"})]}),e.jsx(n.Suspense,{fallback:e.jsx("div",{className:"h-7 sm:h-8 lg:h-9 bg-gray-100 animate-pulse rounded-md"}),children:e.jsx(ce,{options:P.map(t=>({value:t.id.toString(),label:t.vendor_name})),value:P.find(t=>t.id.toString()===F)?{value:F,label:P.find(t=>t.id.toString()===F)?.vendor_name}:null,onChange:t=>{const a=t;a?(W(a.value),l("vendor_id",Number(a.value))):(W(""),l("vendor_id",0))},placeholder:"업체 선택",isClearable:!0,isSearchable:!0,closeMenuOnSelect:!1,classNamePrefix:"vendor-select",blurInputOnSelect:!1,openMenuOnFocus:!1,openMenuOnClick:!0,tabSelectsValue:!1,captureMenuScroll:!1,pageSize:20,styles:{container:t=>({...t,width:"100%"}),control:t=>({...t,height:36,minHeight:36,background:"#fff",border:"1px solid #d2d2d7",borderRadius:6,fontSize:"0.75rem",boxShadow:"0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1)","&:hover":{boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1)"}}),valueContainer:t=>({...t,height:34,padding:"0 8px",fontSize:"0.75rem"}),input:t=>({...t,margin:0,padding:0,fontSize:"0.75rem"}),indicatorsContainer:t=>({...t,height:36}),indicatorSeparator:()=>({display:"none"}),dropdownIndicator:t=>({...t,padding:6}),clearIndicator:t=>({...t,padding:6}),menuPortal:t=>({...t,zIndex:1400})}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-0.5 sm:mb-1",children:[e.jsx(p,{className:"text-[10px] sm:text-xs",children:"업체 담당자"}),e.jsxs("span",{className:"text-primary text-[9px] sm:text-[10px] cursor-pointer hover:underline select-none flex items-center",onClick:Se,children:[e.jsx("span",{className:"-translate-y-px",children:"+"}),e.jsx("span",{className:"ml-0.5",children:"추가/수정"})]})]}),e.jsxs(S,{value:c("contacts")[0]||"",onValueChange:t=>{l("contacts",[t]),l("contact_id",t?Number(t):void 0)},children:[e.jsx(C,{className:"h-7 sm:h-8 lg:h-9 bg-white border border-[#d2d2d7] rounded-md text-[11px] sm:text-xs shadow-sm hover:shadow-md transition-shadow duration-200",children:e.jsx(q,{placeholder:"담당자 선택"})}),e.jsx(k,{position:"popper",className:"z-[9999]",children:X.map(t=>e.jsx(_,{value:t.id.toString(),children:t.contact_name||t.contact_email||t.contact_phone||t.position||""},t.id))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-1.5 sm:gap-2",children:[e.jsxs("div",{children:[e.jsx(p,{className:"mb-0.5 block text-[10px] sm:text-xs",children:"구매요구자"}),e.jsx(n.Suspense,{fallback:e.jsx("div",{className:"h-7 sm:h-8 lg:h-9 bg-gray-100 animate-pulse rounded-md"}),children:e.jsx(ce,{value:u?{value:u,label:u}:null,defaultValue:u?{value:u,label:u}:null,onChange:t=>{const a=t?.value||"";l("requester_name",a),R(a)},options:K.map(t=>({value:t.name,label:t.name})),placeholder:"선택",isSearchable:!0,isClearable:!1,noOptionsMessage:()=>"일치하는 직원이 없습니다",filterOption:(t,a)=>{const s=K.find(o=>o.name===t.value);return`${s?.name||""} ${s?.position||""} ${s?.email||""}`.toLowerCase().includes(a.toLowerCase())},styles:{control:t=>({...t,minHeight:"36px",height:"36px",fontSize:"0.75rem",borderColor:"#d2d2d7",borderRadius:"6px",boxShadow:"0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1)","&:hover":{borderColor:"#d2d2d7",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1)"}}),valueContainer:t=>({...t,height:"34px",padding:"0 8px",fontSize:"0.75rem"}),input:t=>({...t,margin:"0px",padding:"0px",fontSize:"0.75rem"}),indicatorSeparator:()=>({display:"none"}),indicatorsContainer:t=>({...t,height:"36px"}),dropdownIndicator:t=>({...t,padding:6}),clearIndicator:t=>({...t,padding:6}),menu:t=>({...t,fontSize:"0.75rem",zIndex:9999}),option:t=>({...t,fontSize:"0.75rem",padding:"6px 10px"})}},`employee-select-${u}`)})]}),e.jsxs("div",{children:[e.jsx(p,{className:"mb-0.5 block text-[10px] sm:text-xs",children:"청구일"}),e.jsx(h,{type:"date",value:c("request_date"),onChange:t=>l("request_date",t.target.value),className:"h-9 bg-white border border-[#d2d2d7] rounded-md text-xs shadow-sm hover:shadow-md transition-shadow duration-200"})]}),e.jsxs("div",{children:[e.jsx(p,{className:"mb-0.5 block text-[10px] sm:text-xs",children:"입고 요청일"}),e.jsx(h,{type:"date",value:c("delivery_request_date"),onChange:t=>l("delivery_request_date",t.target.value),className:"h-9 bg-white border border-[#d2d2d7] rounded-md text-xs shadow-sm hover:shadow-md transition-shadow duration-200"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-1.5 sm:gap-2",children:[e.jsxs("div",{children:[e.jsx(p,{className:"mb-0.5 block text-[10px] sm:text-xs",children:"PJ업체"}),e.jsx(h,{type:"text",value:c("project_vendor"),onChange:t=>l("project_vendor",t.target.value),placeholder:"입력",className:"h-9 bg-white border border-[#d2d2d7] rounded-md text-xs shadow-sm hover:shadow-md focus:shadow-md transition-shadow duration-200"})]}),e.jsxs("div",{children:[e.jsx(p,{className:"mb-0.5 block text-[10px] sm:text-xs",children:"수주번호"}),e.jsx(h,{type:"text",value:c("sales_order_number"),onChange:t=>l("sales_order_number",t.target.value),placeholder:"입력",className:"h-9 bg-white border border-[#d2d2d7] rounded-md text-xs shadow-sm hover:shadow-md focus:shadow-md transition-shadow duration-200"})]}),e.jsxs("div",{children:[e.jsx(p,{className:"mb-0.5 block text-[10px] sm:text-xs",children:"Item"}),e.jsx(h,{type:"text",value:c("project_item"),onChange:t=>l("project_item",t.target.value),placeholder:"입력",className:"h-9 bg-white border border-[#d2d2d7] rounded-md text-xs shadow-sm hover:shadow-md focus:shadow-md transition-shadow duration-200"})]})]})]})]}),e.jsxs("div",{className:"w-full lg:w-3/4 space-y-4",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsxs("div",{className:"flex flex-col justify-center",children:[e.jsx("h4",{className:"font-semibold text-foreground",children:"품목 목록"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:"Purchase Items"})]}),e.jsx("div",{className:"ml-[15px]",children:e.jsxs(S,{value:m,onValueChange:L,children:[e.jsx(C,{className:"w-20 h-8 text-xs border-border rounded-md shadow-sm hover:shadow-md transition-shadow duration-200 bg-white",children:e.jsx(q,{})}),e.jsxs(k,{className:"rounded-md",children:[e.jsx(_,{value:"KRW",children:"KRW"}),e.jsx(_,{value:"USD",children:"USD"})]})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm sm:text-base font-semibold text-gray-900",children:"품목 정보"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"품목 입력 가능"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(Le,{variant:"secondary",className:"text-hansl-500",children:["총 금액: ",Ne.toLocaleString("ko-KR")," ",m]}),e.jsx(j,{type:"button",size:"sm",variant:"outline",className:"bg-white text-gray-600 hover:text-red-600 hover:bg-red-50",onClick:()=>{confirm("모든 품목을 삭제하시겠습니까?")&&(g.forEach((t,a)=>se(g.length-1-a)),te({line_number:1,item_name:"",specification:"",quantity:1,unit_price_value:0,unit_price_currency:m,amount_value:0,amount_currency:m,remark:"",link:""}))},children:"전체삭제"}),e.jsx(h,{type:"number",min:1,value:Q,onChange:t=>me(Math.max(1,Number(t.target.value.replace(/[^0-9]/g,"")))),className:"w-16 sm:w-20 h-8 text-xs"}),e.jsxs(j,{type:"button",onClick:()=>{for(let t=0;t<Q;t++)te({line_number:g.length+1+t,item_name:"",specification:"",quantity:1,unit_price_value:0,unit_price_currency:m,amount_value:0,amount_currency:m,remark:"",link:""})},size:"sm",className:"bg-hansl-500 hover:bg-hansl-600 text-white",children:[e.jsx(ie,{className:"w-4 h-4 mr-1"}),"품목 추가"]})]})]}),e.jsx("div",{className:"relative border border-gray-200 rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"max-h-[500px] overflow-y-auto",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10",children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"px-2 py-2 text-left font-medium text-gray-700 w-10",children:"#"}),e.jsxs("th",{className:"px-2 py-2 text-left font-medium text-gray-700 min-w-[120px] sm:min-w-[150px]",children:["품목",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("th",{className:"px-2 py-2 text-left font-medium text-gray-700 min-w-[140px] sm:min-w-[180px]",children:"규격"}),e.jsxs("th",{className:"px-2 py-2 text-center font-medium text-gray-700 w-20",children:["수량",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("th",{className:"px-2 py-2 text-right font-medium text-gray-700 min-w-[110px] sm:min-w-[120px]",children:["단가 (",m,")"]}),e.jsxs("th",{className:"px-2 py-2 text-right font-medium text-gray-700 min-w-[100px] sm:min-w-[120px]",children:["합계 (",m,")"]}),re==="구매요청"&&e.jsx("th",{className:"px-2 py-2 text-left font-medium text-gray-700 min-w-[120px] sm:min-w-[150px]",children:"링크"}),e.jsx("th",{className:"px-2 py-2 text-left font-medium text-gray-700 min-w-[100px] sm:min-w-[150px]",children:"비고"}),e.jsx("th",{className:"px-2 py-2 text-center font-medium text-gray-700 w-10"})]})}),e.jsx("tbody",{className:"bg-white",children:g.map((t,a)=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-2 py-1 text-center text-gray-500",children:a+1}),e.jsx("td",{className:"px-2 py-1",children:e.jsx(h,{value:t.item_name,onChange:s=>b(a,{...t,item_name:s.target.value}),className:"h-7 w-full bg-white border border-gray-200 text-xs",placeholder:"품목명 입력"})}),e.jsx("td",{className:"px-2 py-1",children:e.jsx(h,{value:t.specification,onChange:s=>b(a,{...t,specification:s.target.value}),className:"h-7 w-full bg-white border border-gray-200 text-xs",placeholder:"규격 입력"})}),e.jsx("td",{className:"px-2 py-1",children:e.jsx(h,{type:"number",min:"1",value:t.quantity||"",className:"h-7 w-20 bg-white border border-gray-200 text-xs text-center",placeholder:"0",onChange:s=>{const r=parseInt(s.target.value)||0;b(a,{...t,quantity:r})}})}),e.jsx("td",{className:"px-2 py-1",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(h,{type:"text",inputMode:"decimal",value:pe[`${a}_unit_price_value`]??(t.unit_price_value===0?"":t.unit_price_value?.toLocaleString("ko-KR")||""),onChange:s=>{const o=s.target.value.replace(/,/g,"").replace(/[^0-9.]/g,""),v=o.split("."),d=v.length>2?v[0]+"."+v.slice(1).join(""):o;Z(y=>({...y,[`${a}_unit_price_value`]:d}));const i=d===""?0:parseFloat(d)||0;b(a,{...t,unit_price_value:i})},onBlur:()=>{Z(s=>{const r={...s};return delete r[`${a}_unit_price_value`],r})},className:"h-7 w-full bg-white border border-gray-200 text-xs text-right",placeholder:"0"}),e.jsx("span",{className:"ml-1 text-xs text-gray-500",children:m==="KRW"?"₩":"$"})]})}),e.jsx("td",{className:"px-2 py-1",children:e.jsxs("div",{className:"flex items-center justify-end",children:[e.jsx("span",{className:"text-xs text-right font-medium",children:(t.amount_value||0).toLocaleString("ko-KR")}),e.jsx("span",{className:"ml-1 text-xs text-gray-500",children:m==="KRW"?"₩":"$"})]})}),re==="구매요청"&&e.jsx("td",{className:"px-2 py-1",children:e.jsx(h,{value:t.link||"",onChange:s=>b(a,{...t,link:s.target.value}),type:"url",className:"h-7 w-full bg-white border border-gray-200 text-xs",placeholder:"https://..."})}),e.jsx("td",{className:"px-2 py-1",children:e.jsx(h,{value:t.remark||"",onChange:s=>b(a,{...t,remark:s.target.value}),className:"h-7 w-full bg-white border border-gray-200 text-xs",placeholder:"비고"})}),e.jsx("td",{className:"px-2 py-1 text-center",children:g.length>1&&e.jsx(j,{type:"button",onClick:()=>se(a),size:"sm",variant:"ghost",className:"h-6 w-6 p-0 hover:bg-red-50",children:e.jsx(le,{className:"w-3 h-3 text-red-600"})})})]},a))})]})})})}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500 text-right",children:["총 ",g.length,"개 품목"]})]})]}),Y&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-700 text-sm",children:Y}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx(j,{type:"button",variant:"outline",onClick:()=>J(-1),children:"취소"}),e.jsx(j,{type:"submit",disabled:G||!ye,className:"bg-hansl-600 hover:bg-hansl-700 text-white",children:G?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"처리 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),"발주요청"]})})]}),e.jsx(Ee,{open:xe,onOpenChange:U,children:e.jsxs(Te,{className:"w-full max-w-[95vw] sm:max-w-3xl max-h-[80vh] overflow-y-auto",children:[e.jsx(Oe,{children:e.jsx($e,{children:"담당자 관리"})}),e.jsx("div",{className:"space-y-4",children:B.map((t,a)=>e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(p,{className:"text-xs",children:"이름"}),e.jsx(h,{value:t.contact_name,onChange:s=>$(a,"contact_name",s.target.value),placeholder:"담당자 이름",className:"h-9"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(p,{className:"text-xs",children:"이메일"}),e.jsx(h,{value:t.contact_email,onChange:s=>$(a,"contact_email",s.target.value),placeholder:"이메일",className:"h-9"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(p,{className:"text-xs",children:"전화번호"}),e.jsx(h,{value:t.contact_phone,onChange:s=>$(a,"contact_phone",s.target.value),placeholder:"전화번호",className:"h-9"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(p,{className:"text-xs",children:"직책"}),e.jsx(h,{value:t.position,onChange:s=>$(a,"position",s.target.value),placeholder:"직책",className:"h-9"})]}),e.jsx(j,{type:"button",size:"sm",variant:"ghost",onClick:()=>qe(a),className:"h-9 px-2",children:e.jsx(le,{className:"h-4 w-4"})})]},a))}),e.jsxs(Ke,{className:"gap-2",children:[e.jsxs(j,{type:"button",variant:"outline",onClick:Ce,size:"sm",children:[e.jsx(ie,{className:"h-4 w-4 mr-1"}),"담당자 추가"]}),e.jsx(Pe,{asChild:!0,children:e.jsx(j,{type:"button",variant:"outline",size:"sm",children:"취소"})}),e.jsx(j,{type:"button",onClick:ke,disabled:!ge,size:"sm",children:"저장"})]})]})})]})}export{tt as default};
//# sourceMappingURL=PurchaseNewMain-CZFC5qsU.js.map
