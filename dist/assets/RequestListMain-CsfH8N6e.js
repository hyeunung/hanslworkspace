const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PurchaseItemsModal-DY5LH0d3.js","assets/index-DsAL4iro.js","assets/index-KGwR_3LG.css","assets/dialog-B22Nto94.js","assets/index-Dz8943Z0.js","assets/react-select.esm-xf0YyH9B.js","assets/chevron-left-DiNSaEMF.js","assets/chevron-right-3Zn4N5p9.js","assets/select-8avWESM0.js","assets/index-dVjxNOkf.js","assets/check-B6iIntpq.js","assets/popover-CdBmGBMH.js","assets/PurchaseDetailModal-C-yD7klJ.js","assets/helpers-CmqE03mo.js","assets/textarea-CLkwskUf.js","assets/calendar-TX1shQE9.js","assets/credit-card-jVf85E50.js","assets/card-C_LMoGjm.js","assets/loader-circle-FAMWboDr.js"])))=>i.map(i=>d[i]);
import{e,r as a,c as t,l as s,j as r,B as l,R as n,X as i,u as c,g as d,h as o,U as m,P as u,a as p,k as h,n as x,o as g,q as y,t as b,v as _,p as j,f,_ as v}from"./index-DsAL4iro.js";import{t as w}from"./index-Dz8943Z0.js";import{D as N,a as k,R as C,b as q,A as $,P as S,U as M,c as D,C as P}from"./PurchaseDetailModal-C-yD7klJ.js";import{D as T,a as I,b as F,c as E,d as U}from"./dropdown-menu-SziJVaKh.js";import{R}from"./rotate-ccw-DdxgAANC.js";import{E as O}from"./eye-DcY-_gws.js";import{C as L}from"./check-B6iIntpq.js";import{f as B,d as W}from"./helpers-CmqE03mo.js";import{g as z,u as V,D as Y}from"./DeliveryDateWarningModal-XZQDoAgi.js";import{A as J,a as A,b as K,c as H,d as Z,e as G,f as Q,g as X}from"./alert-dialog-D8jr5qZZ.js";import{I as ee}from"./dialog-B22Nto94.js";import{P as ae,a as te,b as se}from"./popover-CdBmGBMH.js";import{S as re,a as le,b as ne,c as ie,d as ce}from"./select-8avWESM0.js";import{f as de,C as oe}from"./react-select.esm-xf0YyH9B.js";import{C as me}from"./calendar-TX1shQE9.js";import{A as ue}from"./arrow-up-down-Bn06tBgN.js";import{S as pe}from"./search-8TWKvsJc.js";import{C as he,a as xe,b as ge,c as ye}from"./card-C_LMoGjm.js";import{B as be}from"./badge-BcwTsY_e.js";import"./textarea-CLkwskUf.js";import"./credit-card-jVf85E50.js";import"./loader-circle-FAMWboDr.js";import"./index-dVjxNOkf.js";import"./chevron-right-3Zn4N5p9.js";import"./progress-ohZ0qYWf.js";import"./chevron-left-DiNSaEMF.js";
/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=e("building",[["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3",key:"cabbwy"}],["rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",key:"1uxh74"}]]),je=e("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),fe=e("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),ve=e("sliders-vertical",[["line",{x1:"4",x2:"4",y1:"21",y2:"14",key:"1p332r"}],["line",{x1:"4",x2:"4",y1:"10",y2:"3",key:"gb41h5"}],["line",{x1:"12",x2:"12",y1:"21",y2:"12",key:"hf2csr"}],["line",{x1:"12",x2:"12",y1:"8",y2:"3",key:"1kfi7u"}],["line",{x1:"20",x2:"20",y1:"21",y2:"16",key:"1lhrwl"}],["line",{x1:"20",x2:"20",y1:"12",y2:"3",key:"16vvfq"}],["line",{x1:"2",x2:"6",y1:"14",y2:"14",key:"1uebub"}],["line",{x1:"10",x2:"14",y1:"8",y2:"8",key:"1yglbp"}],["line",{x1:"18",x2:"22",y1:"16",y2:"16",key:"1jxqpz"}]]),we=e("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Ne=a.memo(({isVisible:e=!0,className:t="",columnVisibility:s,applyColumnSettings:c,resetToDefault:d,isLoading:o=!1,currentUserRoles:m=[]})=>{const[u,p]=a.useState(s),[h,x]=a.useState(!1),g=e=>!q.includes(e)||m.some(e=>$.includes(e));if(a.useEffect(()=>{h&&p(s)},[h,s]),!e)return null;const y=Object.values(s).filter(Boolean).length,b=Object.keys(s).length,_=Object.values(u).filter(Boolean).length;return r.jsxs(T,{open:h,onOpenChange:x,children:[r.jsx(I,{asChild:!0,children:r.jsxs(l,{variant:"outline",size:"sm",className:`button-base ${t}`,disabled:o,children:[r.jsx(fe,{className:"w-4 h-4 mr-2"}),r.jsx("span",{className:"button-text",children:o?"ë¡œë”© ì¤‘...":`ì¹¼ëŸ¼ ì„¤ì • (${y}/${b})`})]})}),r.jsxs(F,{className:"w-[320px] overflow-x-hidden",align:"end",onInteractOutside:()=>{p(s),x(!1)},children:[r.jsxs("div",{className:"max-h-[min(600px,80vh)] overflow-y-auto overflow-x-hidden",children:[r.jsxs(E,{className:"flex items-center justify-between py-1.5",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"modal-section-title",children:"ì¹¼ëŸ¼ í‘œì‹œ ì„¤ì •"}),r.jsxs("span",{className:"card-description",children:["(",_,"/",b,")"]})]}),r.jsx(l,{variant:"ghost",size:"sm",onClick:()=>{d(),x(!1)},className:"h-5 px-1.5",title:"ê¸°ë³¸ê°’ìœ¼ë¡œ ì¬ì„¤ì •",children:r.jsx(R,{className:"w-3 h-3"})})]}),r.jsx(U,{}),k.map((e,a)=>r.jsxs(n.Fragment,{children:[r.jsx("div",{className:"px-3 py-1",children:r.jsx("div",{className:"modal-label",children:e.title})}),r.jsx("div",{className:"grid grid-cols-2 gap-x-1 px-2",children:e.columns.map(e=>{const a=u[e],t=C.includes(e),s=g(e);return r.jsxs("div",{className:"flex items-center gap-1 py-1 rounded overflow-hidden "+(s?t&&a?"opacity-75":"cursor-pointer hover:bg-gray-50":"opacity-50 cursor-not-allowed"),onClick:()=>{s&&(t&&a||(e=>{C.includes(e)&&u[e]||g(e)&&p(a=>({...a,[e]:!a[e]}))})(e))},title:s?"":"ì´ ì¹¼ëŸ¼ì„ ë³´ë ¤ë©´ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤",children:[r.jsx("div",{className:"p-0.5 "+(s?t&&a?"":"hover:bg-gray-100 rounded transition-colors":""),children:a?r.jsx(O,{className:"w-3.5 h-3.5 "+(s?"text-green-600":"text-gray-400")}):r.jsx(je,{className:"w-3.5 h-3.5 text-gray-400"})}),r.jsx("div",{className:"flex-1 min-w-0",children:r.jsxs("div",{className:"modal-value truncate "+(s?a?"":"text-gray-500":"text-gray-400"),children:[{statement_progress:"ê±°ë˜ëª…ì„¸ì„œ",purchase_order_number:"ë°œì£¼ë²ˆí˜¸",payment_category:"ê²°ì œì¢…ë¥˜",requester_name:"ìš”ì²­ì",request_date:"ì²­êµ¬ì¼",utk_status:"UTK",vendor_name:"ì—…ì²´",contact_name:"ë‹´ë‹¹ì",delivery_request_date:"ì…ê³ ìš”ì²­ì¼",revised_delivery_date:"ë³€ê²½ì…ê³ ì¼",item_name:"í’ˆëª…",specification:"ê·œê²©",quantity:"ìˆ˜ëŸ‰",unit_price:"ë‹¨ê°€",amount:"í•©ê³„",remark:"ë¹„ê³ ",link:"ë§í¬",project_vendor:"PJì—…ì²´",project_item:"PJ ITEM",sales_order_number:"ìˆ˜ì£¼ë²ˆí˜¸",purchase_progress:"êµ¬ë§¤ì§„í–‰",receipt_progress:"ì…ê³ ì§„í–‰",received_quantity:"ì‹¤ì œ ì…ê³ ìˆ˜ëŸ‰"}[e],t&&r.jsx("span",{className:"ml-1 text-red-500",title:"í•„ìˆ˜ ì¹¼ëŸ¼",children:"*"}),!s&&r.jsx("span",{className:"ml-1 text-gray-400",title:"ê¶Œí•œ í•„ìš”",children:"ğŸ”’"})]})})]},e)})}),a<k.length-1&&r.jsx(U,{})]},e.title)),r.jsx(U,{}),r.jsx("div",{className:"px-3 py-2",children:r.jsxs("div",{className:"card-description space-y-1",children:[r.jsx("div",{children:"â€¢ í•„ìˆ˜ ì¹¼ëŸ¼(*)ì€ ìˆ¨ê¸¸ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"}),r.jsx("div",{children:"â€¢ ë³€ê²½ì‚¬í•­ì€ ì ìš© ë²„íŠ¼ì„ ëˆŒëŸ¬ì•¼ ë°˜ì˜ë©ë‹ˆë‹¤"}),r.jsx("div",{children:"â€¢ ìƒˆë¡œê³ ì¹¨ ì‹œì—ë„ ì„¤ì •ì´ ìœ ì§€ë©ë‹ˆë‹¤"})]})})]}),r.jsx(U,{}),r.jsxs("div",{className:"px-3 py-3 flex gap-2 border-t bg-white",children:[r.jsxs(l,{onClick:()=>{c(u),x(!1)},className:"button-base bg-blue-500 text-white hover:bg-blue-600 flex-1",children:[r.jsx(L,{className:"w-4 h-4 mr-1"}),"ì ìš©"]}),r.jsxs(l,{onClick:()=>{p(s),x(!1)},variant:"outline",className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 flex-1",children:[r.jsx(i,{className:"w-4 h-4 mr-1"}),"ì·¨ì†Œ"]})]})]})]})});Ne.displayName="ColumnSettingsDropdown";const ke=a.memo(({purchase:e})=>{const a=e.is_received?"completed":"approved"===e.middle_manager_status&&"approved"===e.final_manager_status?"inProgress":"rejected"===e.middle_manager_status||"rejected"===e.final_manager_status?"rejected":"pending",{text:t,className:s}={completed:{text:"ì…ê³ ì™„ë£Œ",className:"badge-success"},inProgress:{text:"êµ¬ë§¤ì§„í–‰",className:"badge-primary"},rejected:{text:"ë°˜ë ¤",className:"badge-danger"},pending:{text:"ìŠ¹ì¸ëŒ€ê¸°",className:"badge-warning"}}[a];return r.jsx("span",{className:`badge-stats ${s}`,children:t})});ke.displayName="StatusBadge";const Ce=a.memo(({purchase:e,onClick:a})=>{const t=(e=>{if(!e.purchase_request_items||0===e.purchase_request_items.length)return{received:0,total:0,percentage:0};const a=e.purchase_request_items.length,t=e.purchase_request_items.filter(e=>null!==e.actual_received_date&&void 0!==e.actual_received_date).length;return{received:t,total:a,percentage:a>0?Math.round(t/a*100):0}})(e),s="ì„ ì§„í–‰"===e.progress_type||e.progress_type?.includes("ì„ ì§„í–‰");return r.jsxs("div",{className:"bg-white rounded-lg border p-4 space-y-3 cursor-pointer transition-all hover:shadow-md "+(s?"border-red-400 bg-red-50 hover:bg-red-100":"hover:bg-gray-50"),onClick:()=>a(e),children:[r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center gap-2",children:[s?r.jsx("span",{className:"badge-stats bg-red-500 text-white",children:"ì„ ì§„í–‰"}):r.jsx("span",{className:"badge-stats bg-gray-500 text-white",children:"ì¼ë°˜"}),r.jsx("span",{className:"card-title text-gray-900",children:e.purchase_order_number||"-"})]}),r.jsxs("div",{className:"badge-text text-gray-500 mt-1",children:[B(e.request_date)," ìš”ì²­"]})]}),r.jsx(ke,{purchase:e})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[r.jsx("span",{className:"text-gray-600",children:"ìš”ì²­ì"}),r.jsx("span",{className:"card-title",children:e.requester_name})]}),r.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[r.jsx("span",{className:"text-gray-600",children:"ì—…ì²´"}),r.jsx("span",{className:"card-title",children:e.vendor_name})]}),e.project_vendor&&r.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[r.jsx("span",{className:"text-gray-600",children:"PJì—…ì²´"}),r.jsx("span",{className:"card-title truncate max-w-[150px]",children:e.project_vendor})]}),e.project_item&&r.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[r.jsx("span",{className:"text-gray-600",children:"PJ ITEM"}),r.jsx("span",{className:"text-[11px] font-medium text-gray-900 max-w-[150px] break-all whitespace-pre-wrap text-right leading-snug",style:{whiteSpace:"pre-wrap",wordBreak:"break-all"},children:e.project_item})]}),e.sales_order_number&&r.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[r.jsx("span",{className:"text-gray-600",children:"ìˆ˜ì£¼ë²ˆí˜¸"}),r.jsx("span",{className:"card-title truncate max-w-[150px]",children:e.sales_order_number})]}),e.item_name&&r.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[r.jsx("span",{className:"text-gray-600",children:"í’ˆëª©"}),r.jsx("span",{className:"card-title truncate max-w-[150px]",children:e.item_name})]}),r.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[r.jsx("span",{className:"text-gray-600",children:"ê¸ˆì•¡"}),r.jsxs("span",{className:"font-semibold text-gray-900",children:[(e.amount_value||e.total_amount)?.toLocaleString()," ",e.currency]})]})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsxs("div",{className:"flex items-center justify-between badge-text",children:[r.jsx("span",{className:"text-gray-600",children:"ì…ê³ í˜„í™©"}),r.jsxs("span",{className:"text-gray-700",children:[t.received,"/",t.total," (",t.percentage,"%)"]})]}),r.jsx("div",{className:"bg-gray-200 rounded-full h-2",children:r.jsx("div",{className:"h-2 rounded-full transition-all "+(100===t.percentage?"bg-green-500":t.percentage>0?"bg-hansl-500":"bg-gray-300"),style:{width:`${t.percentage}%`}})})]}),void 0!==e.is_payment_completed&&r.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[r.jsx("span",{className:"text-gray-600",children:"ê²°ì œ"}),e.is_payment_completed?r.jsx("span",{className:"badge-stats bg-green-500 text-white",children:"ì™„ë£Œ"}):r.jsx("span",{className:"badge-stats bg-gray-500 text-white",children:"ëŒ€ê¸°"})]}),r.jsx("div",{className:"pt-2 border-t",children:r.jsxs("div",{className:"flex items-center justify-center badge-text text-gray-500",children:[r.jsx(O,{className:"w-3 h-3 mr-1"}),"í´ë¦­í•˜ì—¬ ìƒì„¸ë³´ê¸°"]})})]})});Ce.displayName="MobilePurchaseCard";const qe=a.memo(({purchases:e,activeTab:t,onRowClick:s,isLeadBuyer:l,onPaymentComplete:n,onReceiptComplete:i,onExcelDownload:c,onToggleUtkCheck:d,columnVisibility:o,vendorColumnWidth:m,tableHeader:u,TableRowComponent:p,height:h=600,shouldUseFitLayout:x=!1,currentUserRoles:g})=>{const y=a.useRef(null),[b,_]=a.useState(0),[j,f]=a.useState(h),[v,w]=a.useState(h),{startIndex:N,endIndex:k,visibleItems:C,totalHeight:q}=a.useMemo(()=>{const a=e.length,t=Math.ceil(j/30),s=Math.floor(b/30),r=Math.min(s+t+5,a),l=Math.max(0,s-5);return{startIndex:l,endIndex:r,visibleItems:e.slice(l,r),totalHeight:30*a}},[e,b,j]),$=a.useCallback(e=>{const a=Math.max(0,e.currentTarget.scrollTop-30);_(a)},[]);return a.useEffect(()=>{const e=()=>{const e=window.innerHeight;let a;a=e<=800?Math.min(450,.6*e):e<=1080?Math.min(725,.7*e):e<=1440?Math.min(1e3,.75*e):Math.min(1200,.8*e),w(a),f(a)},a=()=>{if(y.current){const e=y.current.getBoundingClientRect();f(Math.min(v,e.height))}},t=setTimeout(()=>{e(),a()},100),s=()=>{e(),a()};return window.addEventListener("resize",s),()=>{clearTimeout(t),window.removeEventListener("resize",s)}},[v]),r.jsx("div",{className:x?"table-container-fit-left":"border rounded-lg",children:r.jsxs("div",{ref:y,className:"virtual-scroll-body",style:{height:`${v}px`,overflow:"auto",position:"relative"},onScroll:$,children:[r.jsx("div",{className:"sticky-header-container",style:{position:"sticky",top:0,zIndex:30,backgroundColor:"#f9fafb",borderBottom:"1px solid #e5e7eb",willChange:"transform"},children:r.jsx("table",{className:x?`table-fit-left ${t}-tab`:"w-full min-w-[1790px] border-collapse",children:u})}),r.jsx("div",{style:{height:`${q}px`,position:"relative"},children:r.jsx("div",{style:{transform:`translateY(${30*N}px)`,position:"absolute",top:0,left:0,right:0},children:r.jsx("table",{className:(x?`table-fit-left ${t}-tab`:"w-full min-w-[1790px] border-collapse")+" virtual-scroll-table",children:r.jsx("tbody",{children:C.map((e,a)=>r.jsx(p,{purchase:e,onClick:s,activeTab:t,isLeadBuyer:l,onPaymentComplete:n,onReceiptComplete:i,onExcelDownload:c,onToggleUtkCheck:d,vendorColumnWidth:m,columnVisibility:o,currentUserRoles:g},e.id))})})})}),0===e.length&&r.jsx("div",{className:"text-center py-12 bg-white",children:r.jsx("p",{className:"card-subtitle",children:"ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤."})})]})})});qe.displayName="VirtualScrollTable";const $e=a.memo(({purchase:e})=>{const a=e.is_received?"completed":"approved"===e.middle_manager_status&&"approved"===e.final_manager_status?"inProgress":"rejected"===e.middle_manager_status||"rejected"===e.final_manager_status?"rejected":"pending",{text:t,className:s}={completed:{text:"ì…ê³ ì™„ë£Œ",className:"badge-success"},inProgress:{text:"êµ¬ë§¤ì§„í–‰",className:"badge-primary"},rejected:{text:"ë°˜ë ¤",className:"badge-danger"},pending:{text:"ìŠ¹ì¸ëŒ€ê¸°",className:"badge-warning"}}[a];return r.jsx("span",{className:`badge-stats ${s}`,children:t})});$e.displayName="StatusBadge";const Se=e=>e?["KRW","ì›","â‚©"].includes(e)?"â‚©":["USD","$","ë‹¬ëŸ¬"].includes(e)?"$":["EUR","â‚¬"].includes(e)?"â‚¬":["JPY","ì—”","Â¥"].includes(e)||["CNY","ìœ„ì•ˆ","å…ƒ"].includes(e)?"Â¥":e:"â‚©",Me="text-center w-20 min-w-[85px] max-w-[85px]",De="pl-2 w-[155px] min-w-[155px] max-w-[155px] purchase-order-number-column",Pe="text-center w-20 min-w-[85px] max-w-[85px]",Te="w-12 min-w-[48px] max-w-[48px]",Ie="text-center px-2 w-16 min-w-[64px] max-w-[68px]",Fe="pl-3 pr-2 w-32 min-w-[128px] max-w-[128px]",Ee="w-16 min-w-[68px] max-w-[68px]",Ue="w-20 min-w-[85px] max-w-[85px]",Re="w-20 min-w-[85px] max-w-[85px]",Oe="w-44 min-w-[176px] max-w-[176px]",Le="w-64 min-w-[260px] max-w-[260px]",Be="text-center w-14 min-w-[60px] max-w-[60px]",We="text-right w-24 min-w-[100px] max-w-[100px]",ze="text-right w-24 min-w-[100px] max-w-[100px]",Ve="w-[165px] min-w-[165px] max-w-[165px]",Ye="w-24 min-w-[105px] max-w-[105px]",Je="w-28 min-w-[115px] max-w-[115px]",Ae="w-44 min-w-[180px] max-w-[180px]",Ke="text-center w-20 min-w-[85px] max-w-[85px]",He="text-center w-24 min-w-[100px] max-w-[100px]",Ze="text-center w-24 min-w-[100px] max-w-[100px]",Ge="w-20 min-w-[85px] max-w-[85px]",Qe="text-center w-14 min-w-[56px] max-w-[60px]",Xe=a.memo(({purchase:e})=>{const{allPurchases:a}=o(),t=a?.find(a=>a.id===e.id)||e,s="approved"===t.middle_manager_status,l="rejected"===t.middle_manager_status,n="approved"===t.final_manager_status,i="rejected"===t.final_manager_status;return l||i?r.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[r.jsx("div",{className:"flex items-center gap-0.5",children:r.jsx("div",{className:"w-1.5 h-1.5 bg-red-500 rounded-full animate-pulse"})}),r.jsx("span",{className:"badge-stats bg-red-500 text-white",children:"ë°˜ë ¤"})]}):s&&n?r.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[r.jsx("div",{className:"flex items-center gap-0.5",children:r.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"})}),r.jsx("span",{className:"badge-stats bg-green-500 text-white",children:"ìŠ¹ì¸ì™„ë£Œ"})]}):!s||n||i?r.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full"}),r.jsx("div",{className:"w-3 h-0.5 bg-gray-300"}),r.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full"})]}),r.jsx("span",{className:"badge-stats bg-gray-500 text-white",children:"ìŠ¹ì¸ëŒ€ê¸°"})]}):r.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),r.jsx("div",{className:"w-3 h-0.5 bg-gray-300"}),r.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full"})]}),r.jsx("span",{className:"badge-stats bg-yellow-500 text-white",children:"1ì°¨ ìŠ¹ì¸"})]})});Xe.displayName="ApprovalStatusBadge";const ea=a.memo(({purchase:e,activeTab:a})=>{const{allPurchases:t}=o(),s=t?.find(a=>a.id===e.id)||e;if("done"===a&&"êµ¬ë§¤ ìš”ì²­"!==s.payment_category)return r.jsx("div",{className:"flex items-center justify-center",children:r.jsx("span",{className:"card-title text-gray-500",children:"-"})});if(s.is_payment_completed)return r.jsxs("div",{className:"flex items-center justify-center gap-1",children:[r.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:r.jsx("div",{className:"h-1.5 rounded-full bg-orange-500",style:{width:"100%"}})}),r.jsx("span",{className:"card-title text-gray-600",children:"100%"})]});if(!s.purchase_request_items||0===s.purchase_request_items.length)return r.jsxs("div",{className:"flex items-center justify-center gap-1",children:[r.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:r.jsx("div",{className:"h-1.5 rounded-full bg-gray-300",style:{width:"0%"}})}),r.jsx("span",{className:"card-title text-gray-600",children:"0%"})]});const l=s.purchase_request_items.length,n=s.purchase_request_items.filter(e=>!0===e.is_payment_completed).length,i=l>0?Math.round(n/l*100):0;return r.jsxs("div",{className:"flex items-center justify-center gap-1",children:[r.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:r.jsx("div",{className:"h-1.5 rounded-full "+(100===i?"bg-orange-500":i>0?"bg-orange-400":"bg-gray-300"),style:{width:`${i}%`}})}),r.jsxs("span",{className:"card-title text-gray-600",children:[i,"%"]})]})});ea.displayName="PaymentProgressBar";const aa=a.memo(({purchase:e})=>{const{allPurchases:a}=o(),t=a?.find(a=>a.id===e.id)||e;if(!t.purchase_request_items||0===t.purchase_request_items.length)return r.jsxs("div",{className:"flex items-center justify-center gap-1",children:[r.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:r.jsx("div",{className:"h-1.5 rounded-full bg-gray-300",style:{width:"0%"}})}),r.jsx("span",{className:"card-title text-gray-600",children:"0%"})]});const s=t.purchase_request_items.length,l=t.purchase_request_items.filter(e=>!0===e.is_received).length,n=s>0?Math.round(l/s*100):0;return r.jsxs("div",{className:"flex items-center justify-center gap-1",children:[r.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:r.jsx("div",{className:"h-1.5 rounded-full "+(100===n?"bg-blue-500":n>0?"bg-blue-400":"bg-gray-300"),style:{width:`${n}%`}})}),r.jsxs("span",{className:"card-title text-gray-600",children:[n,"%"]})]})});aa.displayName="ReceiptProgressBar";const ta=a.memo(({purchase:e})=>{const{allPurchases:t}=o(),s=a.useMemo(()=>{if(!t)return e;return t.find(a=>a.id===e.id)||e},[t,e.id,e]),l=a.useMemo(()=>{const e=s.purchase_request_items||s.items||[];if(0===e.length)return{completed:0,total:1,percentage:0};const a=e.length,t=e.filter(e=>!0===e.is_statement_received).length;return{completed:t,total:a,percentage:a>0?Math.round(t/a*100):0}},[s]);return r.jsxs("div",{className:"flex items-center justify-center gap-1",children:[r.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:r.jsx("div",{className:"h-1.5 rounded-full "+(100===l.percentage?"bg-green-500":l.percentage>0?"bg-green-400":"bg-gray-300"),style:{width:`${l.percentage}%`}})}),r.jsxs("span",{className:"card-title text-gray-600",children:[l.percentage,"%"]})]})});ta.displayName="StatementProgressBar";a.memo(({type:e})=>"ì„ ì§„í–‰"===e||e?.includes("ì„ ì§„í–‰")?r.jsx("span",{className:"badge-stats bg-red-500 text-white",children:"ì„ ì§„í–‰"}):r.jsx("span",{className:"badge-stats bg-gray-500 text-white",children:"ì¼ë°˜"})).displayName="ProgressTypeBadge";const sa=a.memo(({purchase:e,onClick:a,activeTab:t,isLeadBuyer:s,onPaymentComplete:l,onReceiptComplete:n,onExcelDownload:i,onToggleUtkCheck:c,columnVisibility:d,vendorColumnWidth:o,currentUserRoles:m})=>{const u="ì„ ì§„í–‰"===e.progress_type||e.progress_type?.includes("ì„ ì§„í–‰"),p=e=>{if(!d)return!0;if("done"===t&&q.includes(e)){if(!("utk_status"===e?m?.some(e=>M.includes(e)):m?.some(e=>$.includes(e))))return!1}return!1!==d[e]},h=m?.some(e=>M.includes(e))??!1;return r.jsxs("tr",{className:"border-b hover:bg-gray-100 cursor-pointer transition-colors "+(u?"bg-red-50 hover:bg-red-100":""),onClick:()=>a(e),children:["pending"===t&&r.jsx("td",{className:`px-2 py-1.5 whitespace-nowrap ${Me}`,children:r.jsx(Xe,{purchase:e})}),"purchase"===t&&r.jsx("td",{className:`px-2 py-1.5 ${Ke}`,children:r.jsx(ea,{purchase:e,activeTab:t})}),"receipt"===t&&p("receipt_progress")&&r.jsx("td",{className:`px-2 py-1.5 ${Ke}`,children:r.jsx(aa,{purchase:e})}),"done"===t&&p("statement_progress")&&r.jsx("td",{className:`px-2 py-1.5 ${Ke}`,children:r.jsx(ta,{purchase:e})}),p("purchase_order_number")&&r.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${De}`,children:r.jsxs("div",{className:"flex items-center gap-1",children:[i&&r.jsx("img",{src:"/excels-icon.svg",alt:"ì—‘ì…€ ë‹¤ìš´ë¡œë“œ",width:"16",height:"16",className:`inline-block align-middle transition-transform p-0.5 rounded\n                ${e.is_po_download?"border border-gray-400":""}\n                ${"ì„ ì§„í–‰"===e.progress_type||e.progress_type?.includes("ì„ ì§„í–‰")||"approved"===e.middle_manager_status&&"approved"===e.final_manager_status?e.is_po_download?"cursor-pointer":"cursor-pointer hover:scale-110":"opacity-40 grayscale cursor-not-allowed"}`,onClick:async a=>{("ì„ ì§„í–‰"===e.progress_type||e.progress_type?.includes("ì„ ì§„í–‰")||"approved"===e.middle_manager_status&&"approved"===e.final_manager_status)&&(a.stopPropagation(),await i(e))},style:{pointerEvents:"ì„ ì§„í–‰"===e.progress_type||e.progress_type?.includes("ì„ ì§„í–‰")||"approved"===e.middle_manager_status&&"approved"===e.final_manager_status?"auto":"none"},title:e.is_po_download?"ë‹¤ìš´ë¡œë“œ ì™„ë£Œ":"ì—‘ì…€ ë°œì£¼ì„œ ë‹¤ìš´ë¡œë“œ"}),r.jsxs("span",{className:"block truncate",title:e.purchase_order_number||"",children:[e.purchase_order_number||"-",e.purchase_request_items&&e.purchase_request_items.length>1&&r.jsxs("span",{className:"text-gray-500 ml-0.5",children:["(",e.purchase_request_items.length,")"]})]})]})}),p("payment_category")&&r.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${Pe}`,children:r.jsx("span",{className:"badge-stats "+("êµ¬ë§¤ìš”ì²­"===e.payment_category||"êµ¬ë§¤ ìš”ì²­"===e.payment_category?"bg-blue-500 text-white":"ë°œì£¼"===e.payment_category?"bg-green-500 text-white":("í˜„ì¥ê²°ì œ"===e.payment_category||"í˜„ì¥ ê²°ì œ"===e.payment_category||e.payment_category,"bg-gray-500 text-white")),children:"ë°œì£¼"===e.payment_category?"ë°œì£¼ìš”ì²­":"êµ¬ë§¤ ìš”ì²­"===e.payment_category?"êµ¬ë§¤ìš”ì²­":"í˜„ì¥ ê²°ì œ"===e.payment_category?"í˜„ì¥ê²°ì œ":e.payment_category||"-"})}),p("requester_name")&&r.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${Te}`,children:r.jsx("span",{className:"block truncate",title:e.requester_name||"",children:e.requester_name||"-"})}),p("request_date")&&r.jsx("td",{className:`py-1.5 card-title whitespace-nowrap ${Ie}`,children:B(e.request_date)}),"done"===t&&p("utk_status")&&r.jsx("td",{className:`pl-2 pr-3 py-1.5 card-title whitespace-nowrap text-center overflow-visible text-clip ${Qe}`,children:h?r.jsx("button",{type:"button",onClick:async a=>{a.stopPropagation(),await(c?.(e))},className:(e.is_utk_checked?"badge-utk-complete":"badge-utk-pending")+" mx-auto cursor-pointer",title:e.is_utk_checked?"UTK í™•ì¸ ì·¨ì†Œ":"UTK í™•ì¸",children:e.is_utk_checked?"ì™„ë£Œ":"ëŒ€ê¸°"}):r.jsx("span",{className:e.is_utk_checked?"badge-utk-complete":"badge-utk-pending",children:e.is_utk_checked?"ì™„ë£Œ":"ëŒ€ê¸°"})}),p("vendor_name")&&r.jsx("td",{className:`pl-3 pr-2 py-1.5 card-title ${"done"===t?Fe:"vendor-dynamic-column"}`,style:"done"===t?void 0:{width:`${o||80}px`,minWidth:`${o||80}px`,maxWidth:`${o||80}px`},children:r.jsx("span",{className:"block truncate",title:e.vendor_name||"",children:e.vendor_name||"-"})}),p("contact_name")&&r.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${Ee}`,children:r.jsx("span",{className:"block truncate",title:e.contact_name||"",children:e.contact_name||"-"})}),p("delivery_request_date")&&r.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${Ue} ${e.revised_delivery_request_date?"text-gray-400":""}`,children:B(e.delivery_request_date)}),("receipt"===t||"done"===t)&&p("revised_delivery_date")&&r.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${Re}`,children:B(e.revised_delivery_request_date)}),p("item_name")&&r.jsx("td",{className:`px-2 py-1.5 card-title ${Oe}`,children:r.jsx("span",{className:"block truncate",title:e.purchase_request_items?.[0]?.item_name||"",children:e.purchase_request_items?.[0]?.item_name||"-"})}),p("specification")&&r.jsx("td",{className:`px-2 py-1.5 card-title ${Le}`,children:r.jsx("span",{className:"block truncate",title:e.purchase_request_items?.[0]?.specification||"",children:e.purchase_request_items?.[0]?.specification||"-"})}),p("quantity")&&(()=>{const a=e.purchase_request_items?.reduce((e,a)=>e+(a.quantity||0),0)||0,s=e.purchase_request_items?.reduce((e,a)=>e+(a.received_quantity||0),0)||0,l=a===s&&s>0,n=("receipt"===t||"done"===t)&&(a>=100||s>=100)&&!l;return r.jsx("td",{className:`px-2 card-title ${Be} ${n?"py-0.5":"py-1.5"}`,children:"receipt"===t||"done"===t?(()=>{if(l)return r.jsx("span",{className:"text-gray-900",children:s});const e=s>0;return n?r.jsxs("div",{className:"flex flex-col items-center justify-center gap-px leading-tight text-[10px]",children:[r.jsx("div",{className:e?"text-gray-400":"",children:a}),r.jsxs("div",{className:e?"":"text-gray-400",children:["/",s]})]}):r.jsxs("span",{className:"whitespace-nowrap",children:[r.jsx("span",{className:e?"text-gray-400":"",children:a}),r.jsxs("span",{className:e?"":"text-gray-400",children:["/",s]})]})})():a||0})})(),p("unit_price")&&r.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${We}`,children:(()=>{if((e.purchase_request_items?.length||0)>1)return"-";const a=e.purchase_request_items?.[0]?.unit_price_value||0,t=e.purchase_request_items?.[0]?.unit_price_currency||"KRW";return`${a.toLocaleString()} ${Se(t)}`})()}),p("amount")&&r.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${ze}`,children:(()=>{const a=e.purchase_request_items?.reduce((a,t)=>a+(t.amount_value||0)+("ë°œì£¼"===e.payment_category&&t.tax_amount_value?t.tax_amount_value:0),0)||0,t=e.purchase_request_items?.[0]?.amount_currency||e.currency||"KRW";return`${a.toLocaleString()} ${Se(t)}`})()}),("pending"===t||"purchase"===t)&&r.jsxs(r.Fragment,{children:[p("remark")&&r.jsx("td",{className:`px-2 py-1.5 card-title ${Ve}`,children:r.jsx("span",{className:"block truncate",title:e.purchase_request_items?.[0]?.remark||"",children:e.purchase_request_items?.[0]?.remark||"-"})}),"purchase"===t&&p("link")&&r.jsx("td",{className:`px-2 py-1.5 card-title ${Ge}`,children:e.purchase_request_items?.[0]?.link?r.jsx("a",{href:e.purchase_request_items?.[0]?.link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline truncate block",title:e.purchase_request_items?.[0]?.link,children:"ë§í¬ ë³´ê¸°"}):r.jsx("span",{className:"text-gray-400",children:"-"})}),p("project_vendor")&&r.jsx("td",{className:`px-2 py-1.5 card-title ${Ye}`,children:r.jsx("span",{className:"block truncate",title:e.project_vendor||"",children:e.project_vendor||"-"})}),p("project_item")&&r.jsx("td",{className:`px-2 py-1.5 card-title ${Ae}`,children:r.jsx("span",{className:"block truncate",title:e.project_item||"",children:e.project_item||"-"})}),p("sales_order_number")&&r.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${Je}`,children:r.jsx("span",{className:"block truncate",title:e.sales_order_number||"",children:e.sales_order_number||"-"})})]}),"receipt"===t&&r.jsxs(r.Fragment,{children:[p("remark")&&r.jsx("td",{className:`px-2 py-1.5 card-title ${Ve}`,children:r.jsx("span",{className:"block truncate",title:e.purchase_request_items?.[0]?.remark||"",children:e.purchase_request_items?.[0]?.remark||"-"})}),p("project_vendor")&&r.jsx("td",{className:`px-2 py-1.5 card-title ${Ye}`,children:r.jsx("span",{className:"block truncate",title:e.project_vendor||"",children:e.project_vendor||"-"})}),p("project_item")&&r.jsx("td",{className:`px-2 py-1.5 card-title ${Ae}`,children:r.jsx("span",{className:"block truncate",title:e.project_item||"",children:e.project_item||"-"})}),p("sales_order_number")&&r.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${Je}`,children:r.jsx("span",{className:"block truncate",title:e.sales_order_number||"",children:e.sales_order_number||"-"})})]}),("done"===t||!t)&&r.jsxs(r.Fragment,{children:[p("remark")&&r.jsx("td",{className:`px-2 py-1.5 card-title ${Ve}`,children:r.jsx("span",{className:"block truncate",title:e.purchase_request_items?.[0]?.remark||"",children:e.purchase_request_items?.[0]?.remark||"-"})}),p("link")&&r.jsx("td",{className:`px-2 py-1.5 card-title ${Ge}`,children:e.purchase_request_items?.[0]?.link?r.jsx("a",{href:e.purchase_request_items?.[0]?.link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline truncate block",title:e.purchase_request_items?.[0]?.link,children:"ë§í¬ ë³´ê¸°"}):r.jsx("span",{className:"text-gray-400",children:"-"})}),p("project_vendor")&&r.jsx("td",{className:`px-2 py-1.5 card-title ${Ye}`,children:r.jsx("span",{className:"block truncate",title:e.project_vendor||"",children:e.project_vendor||"-"})}),p("project_item")&&r.jsx("td",{className:`px-2 py-1.5 card-title ${Ae}`,children:r.jsx("span",{className:"block truncate",title:e.project_item||"",children:e.project_item||"-"})}),p("sales_order_number")&&r.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${Je}`,children:r.jsx("span",{className:"block truncate",title:e.sales_order_number||"",children:e.sales_order_number||"-"})}),p("purchase_progress")&&"purchase"!==t&&r.jsx("td",{className:`px-2 py-1.5 ${He}`,children:r.jsx(ea,{purchase:e,activeTab:t})}),p("receipt_progress")&&r.jsx("td",{className:`px-2 py-1.5 ${Ze} ${"done"===t?"column-progress":""}`,children:r.jsx(aa,{purchase:e})})]})]})});sa.displayName="TableRow";const ra=({purchases:e,activeTab:l="done",currentUserRoles:n=[],onRefresh:i,onOptimisticUpdate:o,onPaymentComplete:m,onReceiptComplete:u,columnVisibility:p})=>{const[h,x]=a.useState(null),[g,y]=a.useState(!1),[b,_]=a.useState(!1),[j,f]=a.useState(null),v=t(),N=n&&(n.includes("lead buyer")||n.includes("app_admin"));n.includes("final_approver")||n.includes("app_admin")||n.includes("ceo");const k=a.useMemo(()=>{if(!e||0===e.length)return 80;e.length;let a=2;const t=Math.min(e.length,100);e.slice(0,t).forEach(e=>{const t=(e.vendor_name||"").split("").reduce((e,a)=>e+(/[ê°€-í£]/.test(a)?1.5:1),0);a=Math.max(a,Math.ceil(t))});return Math.max(80,Math.min(200,7*a+20))},[e,l]),C=a.useCallback(e=>{x(e.id),y(!0)},[]),M=a.useCallback(()=>{y(!1),x(null)},[]),D=a.useCallback(async e=>{if(!e?.id)return;const a=!(e.is_utk_checked||!1),t=a?`ë°œì£¼ë²ˆí˜¸: ${e.purchase_order_number}\n\nUTK í™•ì¸ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`:`ë°œì£¼ë²ˆí˜¸: ${e.purchase_order_number}\n\nUTK í™•ì¸ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;if(window.confirm(t))try{const{error:t}=await v.from("purchase_requests").update({is_utk_checked:a}).eq("id",e.id);if(t)return s.error("UTK í™•ì¸ DB ì—…ë°ì´íŠ¸ ì‹¤íŒ¨",{error:t,purchaseId:e.id}),void w.error("UTK í™•ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");c(e.id,e=>({...e,is_utk_checked:a})),w.success(a?"UTK í™•ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.":"UTK í™•ì¸ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.");const r=i?.(!0,{silent:!0});r instanceof Promise&&await r}catch(r){s.error("UTK í™•ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜",r),w.error("UTK í™•ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},[v,i]),P=a.useCallback(async e=>{try{const{data:s,error:r}=await v.from("purchase_requests").select("*").eq("purchase_order_number",e.purchase_order_number).single();if(r||!s)return void w.error("í•´ë‹¹ ë°œì£¼ìš”ì²­ë²ˆí˜¸ì˜ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");const{data:l,error:c}=await v.from("purchase_request_items").select("*").eq("purchase_order_number",e.purchase_order_number).order("line_number");if(c||!l||0===l.length)return void w.error("í•´ë‹¹ ë°œì£¼ìš”ì²­ë²ˆí˜¸ì˜ í’ˆëª© ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");const d={vendor_name:e.vendor_name,vendor_phone:"",vendor_fax:"",vendor_contact_name:"",vendor_payment_schedule:""};try{const a=s.vendor_id||e.vendor_id,t=s.contact_id||e.contact_id;if(a){const{data:e}=await v.from("vendors").select("vendor_phone, vendor_fax, vendor_payment_schedule").eq("id",a).single();e&&(d.vendor_phone=e.vendor_phone||"",d.vendor_fax=e.vendor_fax||"",d.vendor_payment_schedule=e.vendor_payment_schedule||"")}if(t){const{data:e}=await v.from("vendor_contacts").select("contact_name, contact_phone, contact_email").eq("id",t).single();e&&(d.vendor_contact_name=e.contact_name||"")}}catch(a){}const o={purchase_order_number:s.purchase_order_number||"",request_date:s.request_date,delivery_request_date:s.delivery_request_date,requester_name:s.requester_name,vendor_name:d.vendor_name||"",vendor_contact_name:d.vendor_contact_name,vendor_phone:d.vendor_phone,vendor_fax:d.vendor_fax,project_vendor:s.project_vendor,sales_order_number:s.sales_order_number,project_item:s.project_item,vendor_payment_schedule:d.vendor_payment_schedule,items:l.map(e=>({line_number:e.line_number,item_name:e.item_name,specification:e.specification,quantity:e.quantity,unit_price_value:e.unit_price_value,amount_value:e.amount_value,remark:e.remark,currency:s.currency||"KRW"}))},m=await z(o),u=`ë°œì£¼ì„œ_${o.vendor_name}_${o.purchase_order_number}.xlsx`,p=window.URL.createObjectURL(m),h=document.createElement("a");h.href=p,h.download=u,document.body.appendChild(h),h.click(),document.body.removeChild(h),window.URL.revokeObjectURL(p),w.success("ì—‘ì…€ íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.");try{if(n&&n.includes("lead buyer")){const{error:a}=await v.from("purchase_requests").update({is_po_download:!0}).eq("purchase_order_number",e.purchase_order_number);a||i?.()}}catch(t){}}catch(a){w.error("ì—‘ì…€ ë‹¤ìš´ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}},[v]),T=a.useCallback(async()=>{if(!j)return s.error("[handleConfirmDelete] purchaseToDeleteê°€ nullì…ë‹ˆë‹¤"),void w.error("ì‚­ì œí•  ë°œì£¼ìš”ì²­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");s.info("ğŸš€ [handleConfirmDelete] ì‚­ì œ ì‹œì‘",{purchaseId:j.id,purchaseOrderNumber:j.purchase_order_number,type:typeof j.id});try{const t="https://qvhbigvdfyvhoegkhvef.supabase.co";if(!t||!"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF2aGJpZ3ZkZnl2aG9lZ2todmVmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc4MTQzNjAsImV4cCI6MjA2MzM5MDM2MH0.7VZlSwnNuE0MaQpDjuzeZFgjJrDBQOWA_COyqaM8Rbg"||t.includes("placeholder"))return s.warn("Supabase í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•ŠìŒ - FastPurchaseTable"),void w.error("í™˜ê²½ ì„¤ì • ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");const{data:{user:r},error:l}=await v.auth.getUser();if(l||!r)return void w.error("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");const{data:n,error:c}=await v.from("employees").select("name, email, purchase_role").eq("email",r.email).single();if(c||!n)return void w.error("ì‚¬ìš©ì ê¶Œí•œì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");let o=[];if(n.purchase_role)if(Array.isArray(n.purchase_role))o=n.purchase_role.map(e=>String(e).trim());else{o=String(n.purchase_role).split(",").map(e=>e.trim()).filter(e=>e.length>0)}const m=o.includes("final_approver")||o.includes("app_admin")||o.includes("ceo"),u="approved"===j.final_manager_status,p=j.requester_name===n.name;if(!(u?m:m||p))return s.warn("[handleConfirmDelete] ì‚­ì œ ê¶Œí•œ ì—†ìŒ",{canEdit:m,isApproved:u,isRequester:p,roles:o,employeeName:n.name}),void w.error("ì‚­ì œ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");s.info("âœ… [handleConfirmDelete] ê¶Œí•œ í™•ì¸ ì™„ë£Œ, ì‚­ì œ ì§„í–‰",{purchaseId:j.id}),s.info("ğŸ—‘ï¸ [handleConfirmDelete] í’ˆëª© ì‚­ì œ ì‹œì‘",{purchaseId:j.id});const{data:h,error:g}=await v.from("purchase_request_items").delete().eq("purchase_request_id",j.id).select();if(g)throw s.error("âŒ [handleConfirmDelete] ì•„ì´í…œ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ",g,{code:g.code,message:g.message,details:g.details,hint:g.hint,purchaseId:j.id}),g;s.info("âœ… [handleConfirmDelete] í’ˆëª© ì‚­ì œ ì™„ë£Œ",{purchaseId:j.id,deletedItemsCount:h?.length||0});const b="string"==typeof j.id?parseInt(j.id,10):j.id;if(isNaN(b))throw s.error("âŒ [handleConfirmDelete] purchaseId ë³€í™˜ ì‹¤íŒ¨",{originalId:j.id,type:typeof j.id}),new Error("ë°œì£¼ìš”ì²­ IDê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");s.info("ğŸ—‘ï¸ [handleConfirmDelete] support_inquires ê´€ë ¨ ë ˆì½”ë“œ ì²˜ë¦¬ ì‹œì‘ (ë¬¸ì˜ ê¸°ë¡ ë³´ì¡´)",{purchaseId:b});let N=!1,k=0;try{const{data:e,error:a}=await v.from("support_inquires").select("id, purchase_order_number").eq("purchase_request_id",b);if(a)s.warn("[handleConfirmDelete] support_inquires ì¡°íšŒ ì‹¤íŒ¨ (ë¬´ì‹œí•˜ê³  ê³„ì† ì§„í–‰)",{error:a,purchaseId:b});else if(e&&e.length>0){k=e.length,s.info("ğŸ—‘ï¸ [handleConfirmDelete] support_inquires ë ˆì½”ë“œ ì—…ë°ì´íŠ¸ í•„ìš” (ë¬¸ì˜ ê¸°ë¡ ë³´ì¡´)",{purchaseId:b,inquiriesCount:e.length,inquiryIds:e.map(e=>e.id),note:"ë¬¸ì˜ ê¸°ë¡ì€ ì‚­ì œí•˜ì§€ ì•Šê³  purchase_request_idë§Œ nullë¡œ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤."});const{data:a,error:t}=await v.from("support_inquires").update({purchase_request_id:null}).eq("purchase_request_id",b).select();if(t)throw s.error("âŒ [handleConfirmDelete] support_inquires ì—…ë°ì´íŠ¸ ì‹¤íŒ¨",{error:t,purchaseId:b,code:t.code,message:t.message,details:t.details}),new Error(`ë¬¸ì˜ ê¸°ë¡(${e.length}ê°œ)ì˜ ì°¸ì¡°ë¥¼ ì œê±°í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì‚­ì œë¥¼ ì¤‘ë‹¨í•©ë‹ˆë‹¤.`);N=!0,s.info("âœ… [handleConfirmDelete] support_inquires ì—…ë°ì´íŠ¸ ì™„ë£Œ (ë¬¸ì˜ ê¸°ë¡ ë³´ì¡´)",{purchaseId:b,updatedCount:a?.length||e.length,updatedInquiryIds:a?.map(e=>e.id)||e.map(e=>e.id),note:"ë¬¸ì˜ ê¸°ë¡ì€ ê·¸ëŒ€ë¡œ ë³´ì¡´ë˜ì—ˆê³ , purchase_request_idë§Œ nullë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤."}),await new Promise(e=>setTimeout(e,100))}else s.info("âœ… [handleConfirmDelete] support_inquires ê´€ë ¨ ë ˆì½”ë“œ ì—†ìŒ",{purchaseId:b})}catch(e){throw s.error("âŒ [handleConfirmDelete] support_inquires ì²˜ë¦¬ ì¤‘ ì˜ˆì™¸ ë°œìƒ",{error:e,purchaseId:b}),w.error(`ë¬¸ì˜ ê¸°ë¡ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${e instanceof Error?e.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}`),e}s.info("ğŸ—‘ï¸ [handleConfirmDelete] ë°œì£¼ê¸°ë³¸ì •ë³´ ì‚­ì œ ì‹œì‘",{purchaseId:b,idType:typeof j.id,idValue:j.id});const{error:C}=await v.from("purchase_requests").delete().eq("id",b);if(C){if(s.error("âŒ [handleConfirmDelete] ë°œì£¼ìš”ì²­ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ",C,{code:C.code,message:C.message,details:C.details,hint:C.hint,purchaseId:b,originalId:j.id,note:"í’ˆëª©ì€ ì´ë¯¸ ì‚­ì œë˜ì—ˆì§€ë§Œ ë°œì£¼ìš”ì²­ì€ ì‚­ì œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ í…Œì´ë¸”ì—ì„œ ì°¸ì¡°í•˜ê³  ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤."}),"409"!==C.code&&"23503"!==C.code&&!C.message?.includes("409")&&!C.message?.includes("foreign key"))throw C;{const e=C.details||C.message||"ë‹¤ë¥¸ ë°ì´í„°ì—ì„œ ì°¸ì¡°í•˜ê³  ìˆìŠµë‹ˆë‹¤.";s.error("âŒ [handleConfirmDelete] Foreign key constraint ìœ„ë°˜",{code:C.code,message:C.message,details:C.details,hint:C.hint,purchaseId:b}),w.error(`ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${e} ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.`)}return}s.info("âœ… [handleConfirmDelete] ë°œì£¼ê¸°ë³¸ì •ë³´ ì‚­ì œ ì™„ë£Œ",{purchaseId:b,originalId:j.id,inquiriesPreserved:N?`${k}ê°œ ë¬¸ì˜ ê¸°ë¡ ë³´ì¡´ë¨`:"ë¬¸ì˜ ê¸°ë¡ ì—†ìŒ"});const q=b;if(d(q)?s.info("âœ… [handleConfirmDelete] ë©”ëª¨ë¦¬ ìºì‹œì—ì„œ ë°œì£¼ì„œ ì‚­ì œ ì„±ê³µ",{purchaseId:q,originalId:j.id}):s.warn("[handleConfirmDelete] ë©”ëª¨ë¦¬ ìºì‹œì—ì„œ ë°œì£¼ì„œ ì‚­ì œ ì‹¤íŒ¨",{purchaseId:q,originalId:j.id}),N&&k>0?w.success(`ë°œì£¼ìš”ì²­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤. (${k}ê°œì˜ ë¬¸ì˜ ê¸°ë¡ì€ ë³´ì¡´ë˜ì—ˆìŠµë‹ˆë‹¤)`):w.success("ë°œì£¼ìš”ì²­ ë‚´ì—­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤."),y(!1),x(null),_(!1),f(null),i)try{await i(!0,{silent:!1}),s.info("âœ… [handleConfirmDelete] ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ")}catch(a){s.error("âŒ [handleConfirmDelete] ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨",a)}}catch(t){const e=t;s.error("âŒ [handleConfirmDelete] ë°œì£¼ìš”ì²­ ì‚­ì œ ì¤‘ ì˜ˆì™¸ ë°œìƒ",e,{name:e?.name,message:e?.message,code:e?.code,details:e?.details,hint:e?.hint,stack:e?.stack,purchaseId:j?.id,purchaseOrderNumber:j?.purchase_order_number}),w.error(`ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${e?.message||"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}`)}finally{_(!1),f(null)}},[v,j,i]),I=a.useCallback(e=>{if(!p)return!0;if("done"===l&&q.includes(e)){const e=n?.some(e=>$.includes(e));if(!e)return!1}return!1!==p[e]},[p,l,n]),F=a.useMemo(()=>{if("pending"===l)return r.jsx("thead",{className:"sticky top-0 z-30 bg-gray-50",style:{boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},children:r.jsxs("tr",{children:[r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Me}`,children:"ìŠ¹ì¸ìƒíƒœ"}),I("purchase_order_number")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${De}`,children:"ë°œì£¼ë²ˆí˜¸"}),I("payment_category")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Pe}`,children:"ê²°ì œì¢…ë¥˜"}),I("requester_name")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Te}`,children:"ìš”ì²­ì"}),I("request_date")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ie}`,children:"ì²­êµ¬ì¼"}),I("vendor_name")&&r.jsx("th",{className:"px-2 py-1.5 modal-label text-gray-900 text-left vendor-dynamic-column",style:{width:`${k||80}px`,minWidth:`${k||80}px`,maxWidth:`${k||80}px`},children:"ì—…ì²´"}),I("contact_name")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ee}`,children:"ë‹´ë‹¹ì"}),I("delivery_request_date")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ue}`,children:"ì…ê³ ìš”ì²­ì¼"}),I("item_name")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${Oe}`,children:"í’ˆëª…"}),I("specification")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${Le}`,children:"ê·œê²©"}),I("quantity")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Be}`,children:"ìš”ì²­ìˆ˜ëŸ‰"}),I("unit_price")&&r.jsx("th",{className:`px-2 py-1.5 table-header-text text-gray-900 whitespace-nowrap ${We}`,children:"ë‹¨ê°€"}),I("amount")&&r.jsx("th",{className:`px-2 py-1.5 table-header-text text-gray-900 whitespace-nowrap ${ze}`,children:"í•©ê³„"}),I("remark")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ve}`,children:"ë¹„ê³ "}),I("project_vendor")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ye}`,children:"PJì—…ì²´"}),I("project_item")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ae}`,children:"PJ ITEM"}),I("sales_order_number")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Je}`,children:"ìˆ˜ì£¼ë²ˆí˜¸"})]})});if("purchase"===l)return r.jsx("thead",{className:"sticky top-0 z-30 bg-gray-50",style:{boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},children:r.jsxs("tr",{children:[r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Ke}`,children:"êµ¬ë§¤ì§„í–‰"}),I("purchase_order_number")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${De}`,children:"ë°œì£¼ë²ˆí˜¸"}),I("payment_category")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Pe}`,children:"ê²°ì œì¢…ë¥˜"}),I("requester_name")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Te}`,children:"ìš”ì²­ì"}),I("request_date")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ie}`,children:"ì²­êµ¬ì¼"}),I("vendor_name")&&r.jsx("th",{className:"px-2 py-1.5 modal-label text-gray-900 text-left vendor-dynamic-column",style:{width:`${k||80}px`,minWidth:`${k||80}px`,maxWidth:`${k||80}px`},children:"ì—…ì²´"}),I("contact_name")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ee}`,children:"ë‹´ë‹¹ì"}),I("delivery_request_date")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ue}`,children:"ì…ê³ ìš”ì²­ì¼"}),I("item_name")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${Oe}`,children:"í’ˆëª…"}),I("specification")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${Le}`,children:"ê·œê²©"}),I("quantity")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Be}`,children:"ìš”ì²­ìˆ˜ëŸ‰"}),I("unit_price")&&r.jsx("th",{className:`px-2 py-1.5 table-header-text text-gray-900 whitespace-nowrap ${We}`,children:"ë‹¨ê°€"}),I("amount")&&r.jsx("th",{className:`px-2 py-1.5 table-header-text text-gray-900 whitespace-nowrap ${ze}`,children:"í•©ê³„"}),I("remark")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ve}`,children:"ë¹„ê³ "}),"purchase"===l&&I("link")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ge}`,children:"ë§í¬"}),I("project_vendor")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ye}`,children:"PJì—…ì²´"}),I("project_item")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ae}`,children:"PJ ITEM"}),I("sales_order_number")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Je}`,children:"ìˆ˜ì£¼ë²ˆí˜¸"})]})});const e=r.jsxs(r.Fragment,{children:[I("purchase_order_number")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${De}`,children:"ë°œì£¼ë²ˆí˜¸"}),I("payment_category")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Pe}`,children:"ê²°ì œì¢…ë¥˜"}),I("requester_name")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Te}`,children:"ìš”ì²­ì"}),I("request_date")&&r.jsx("th",{className:`py-1.5 modal-label text-gray-900 whitespace-nowrap ${Ie}`,children:"ì²­êµ¬ì¼"}),"done"===l&&I("utk_status")&&r.jsx("th",{className:`pl-2 pr-3 py-1.5 modal-label text-gray-900 whitespace-nowrap text-center ${Qe}`,children:"UTK"}),I("vendor_name")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${"done"===l?Fe:"vendor-dynamic-column"}`,style:"done"===l?void 0:{width:`${k||80}px`,minWidth:`${k||80}px`,maxWidth:`${k||80}px`},children:"ì—…ì²´"}),I("contact_name")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ee}`,children:"ë‹´ë‹¹ì"}),I("delivery_request_date")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ue}`,children:"ì…ê³ ìš”ì²­ì¼"}),("receipt"===l||"done"===l)&&I("revised_delivery_date")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Re}`,children:"ë³€ê²½ ì…ê³ ì¼"}),I("item_name")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${Oe}`,children:"í’ˆëª…"}),I("specification")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${Le}`,children:"ê·œê²©"}),I("quantity")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 ${Be}`,children:"receipt"===l||"done"===l?r.jsxs("div",{className:"flex flex-col items-center leading-tight",children:[r.jsx("div",{className:"text-[9px]",children:"ìš”ì²­/ì‹¤ì œ"}),r.jsx("div",{className:"text-[10px]",children:"ì…ê³ ìˆ˜ëŸ‰"})]}):"ìš”ì²­ìˆ˜ëŸ‰"}),I("unit_price")&&r.jsx("th",{className:`px-2 py-1.5 table-header-text text-gray-900 whitespace-nowrap ${We}`,children:"ë‹¨ê°€"}),I("amount")&&r.jsx("th",{className:`px-2 py-1.5 table-header-text text-gray-900 whitespace-nowrap ${ze}`,children:"(ì´ í’ˆëª©)í•©ê³„"})]});let a=null;return"receipt"===l?a=r.jsxs(r.Fragment,{children:[I("remark")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ve}`,children:"ë¹„ê³ "}),I("project_vendor")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ye}`,children:"PJì—…ì²´"}),I("project_item")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ae}`,children:"PJ ITEM"}),I("sales_order_number")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Je}`,children:"ìˆ˜ì£¼ë²ˆí˜¸"})]}):"done"===l&&(a=r.jsxs(r.Fragment,{children:[I("remark")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ve}`,children:"ë¹„ê³ "}),I("link")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ge}`,children:"ë§í¬"}),I("project_vendor")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ye}`,children:"PJì—…ì²´"}),I("project_item")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ae}`,children:"PJ ITEM"}),I("sales_order_number")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Je}`,children:"ìˆ˜ì£¼ë²ˆí˜¸"}),I("purchase_progress")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${He}`,children:"êµ¬ë§¤ì§„í–‰"}),I("receipt_progress")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Ze}`,children:"ì…ê³ ì§„í–‰"})]})),r.jsx("thead",{className:"sticky top-0 z-30 bg-gray-50",style:{boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},children:r.jsxs("tr",{children:["receipt"===l&&I("receipt_progress")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Ke}`,children:"ì…ê³ ì§„í–‰"}),"done"===l&&I("statement_progress")&&r.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Ke}`,children:"ê±°ë˜ëª…ì„¸ì„œ"}),e,a]})})},[l,I,k]),E=a.useMemo(()=>{if(!p)return!1;return!!Object.values(p).some(e=>!e)},[p]),U=a.useMemo(()=>e.length>=100,[e.length]);return r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"hidden md:block w-full max-w-full",children:U?r.jsx(qe,{purchases:e,activeTab:l,onRowClick:C,isLeadBuyer:N,onPaymentComplete:m,onReceiptComplete:u,onExcelDownload:P,onToggleUtkCheck:D,columnVisibility:p,vendorColumnWidth:k,tableHeader:F,TableRowComponent:sa,shouldUseFitLayout:E,currentUserRoles:n}):r.jsx("div",{className:E?"table-container-fit-left max-h-[70vh] overflow-auto":"overflow-x-auto overflow-y-auto max-h-[70vh] border rounded-lg",children:r.jsxs("table",{className:E?`table-fit-left ${l}-tab`:"w-full min-w-[1790px] border-collapse",children:[F,r.jsx("tbody",{children:e.map(e=>r.jsx(sa,{purchase:e,onClick:C,activeTab:l,isLeadBuyer:N,onPaymentComplete:m,onReceiptComplete:u,onExcelDownload:P,onToggleUtkCheck:D,vendorColumnWidth:k,columnVisibility:p,currentUserRoles:n},e.id))})]})})}),r.jsx("div",{className:"hidden sm:block md:hidden w-full",children:r.jsx("div",{className:"overflow-x-auto border rounded-lg",children:r.jsxs("table",{className:"w-full min-w-[600px] card-title",children:[r.jsx("thead",{className:"sticky top-0 z-30 bg-gray-50",style:{boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},children:r.jsxs("tr",{children:[r.jsx("th",{className:"text-left p-2 modal-label text-gray-900 w-24",children:"ë°œì£¼ë²ˆí˜¸"}),r.jsx("th",{className:"text-left p-2 modal-label text-gray-900 w-16",children:"ìš”ì²­ì"}),r.jsx("th",{className:"text-left p-2 modal-label text-gray-900 vendor-dynamic-column",style:{width:`${k||80}px`},children:"ì—…ì²´"}),r.jsx("th",{className:"text-left p-2 modal-label text-gray-900 w-32",children:"í’ˆëª…"}),r.jsx("th",{className:"text-right p-2 modal-label text-gray-900 w-20",children:"ê¸ˆì•¡"}),r.jsx("th",{className:"text-center p-2 modal-label text-gray-900 w-16",children:"ìƒíƒœ"})]})}),r.jsx("tbody",{children:e.map(e=>r.jsxs("tr",{className:"border-b hover:bg-gray-50 cursor-pointer",onClick:()=>C(e),children:[r.jsx("td",{className:"p-2 modal-value",children:e.purchase_order_number||"-"}),r.jsx("td",{className:"p-2",children:e.requester_name}),r.jsx("td",{className:"p-2 truncate",title:e.vendor_name,children:e.vendor_name}),r.jsx("td",{className:"p-2 truncate",title:e.purchase_request_items?.[0]?.item_name,children:e.purchase_request_items?.[0]?.item_name||"-"}),r.jsx("td",{className:"p-2 text-right card-amount",children:e.purchase_request_items?.[0]?.amount_value?`${e.purchase_request_items[0].amount_value.toLocaleString()} ${Se(e.purchase_request_items[0]?.amount_currency||"KRW")}`:e.total_amount?`${e.total_amount.toLocaleString()} ${Se(e.currency||"KRW")}`:`0 ${Se(e.currency||"KRW")}`}),r.jsx("td",{className:"p-2 text-center",children:r.jsx($e,{purchase:e})})]},e.id))})]})})}),r.jsx("div",{className:"sm:hidden space-y-3",children:e.map(e=>r.jsx(Ce,{purchase:e,onClick:()=>C(e)},e.id))}),r.jsx(S,{purchaseId:h,isOpen:g,onClose:M,currentUserRoles:n,activeTab:l,onRefresh:i,onOptimisticUpdate:o,onDelete:e=>{s.info("ğŸ—‘ï¸ [FastPurchaseTable] ì‚­ì œ ë²„íŠ¼ í´ë¦­",{purchaseId:e.id,purchaseOrderNumber:e.purchase_order_number,type:typeof e.id}),f(e),_(!0)}}),r.jsx(J,{open:b,onOpenChange:e=>{_(e),e||f(null)},children:r.jsxs(A,{children:[r.jsxs(K,{children:[r.jsx(H,{children:"ë°œì£¼ìš”ì²­ ë‚´ì—­ ì‚­ì œ"}),r.jsxs(Z,{children:["ë°œì£¼ìš”ì²­ë²ˆí˜¸ ",r.jsx("strong",{children:j?.purchase_order_number||"ì•Œ ìˆ˜ ì—†ìŒ"}),"ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?",r.jsx("br",{}),"ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."]})]}),r.jsxs(G,{children:[r.jsx(Q,{children:"ì·¨ì†Œ"}),r.jsx(X,{onClick:async()=>{s.info("âœ… [FastPurchaseTable] ì‚­ì œ í™•ì¸ ë²„íŠ¼ í´ë¦­",{purchaseId:j?.id,purchaseOrderNumber:j?.purchase_order_number}),await T()},className:"bg-red-600 hover:bg-red-700",children:"ì‚­ì œ"})]})]})})]})};ra.displayName="FastPurchaseTable";const la=[{key:"date_range",label:"ê¸°ê°„ë³„",type:"date_range",icon:me,category:"ë‚ ì§œ"},{key:"date_month",label:"ì›”ë³„",type:"date_month",icon:me,category:"ë‚ ì§œ"},{key:"requester_name",label:"ìš”ì²­ì",type:"searchable_select",icon:m,category:"ì‚¬ìš©ì"},{key:"vendor_name",label:"ì—…ì²´",type:"searchable_select",icon:_e,category:"ì‚¬ìš©ì"},{key:"contact_name",label:"ë‹´ë‹¹ì",type:"searchable_select",icon:m,category:"ì‚¬ìš©ì"},{key:"purchase_order_number",label:"ë°œì£¼ë²ˆí˜¸",type:"text",icon:u,category:"í…ìŠ¤íŠ¸"},{key:"item_name",label:"í’ˆëª…",type:"text",icon:u,category:"í…ìŠ¤íŠ¸"},{key:"specification",label:"ê·œê²©",type:"text",icon:u,category:"í…ìŠ¤íŠ¸"},{key:"remark",label:"ë¹„ê³ ",type:"text",icon:u,category:"í…ìŠ¤íŠ¸"},{key:"project_vendor",label:"PJì—…ì²´",type:"text",icon:_e,category:"í…ìŠ¤íŠ¸"},{key:"project_item",label:"PJ ITEM",type:"text",icon:u,category:"í…ìŠ¤íŠ¸"},{key:"sales_order_number",label:"ìˆ˜ì£¼ë²ˆí˜¸",type:"text",icon:u,category:"í…ìŠ¤íŠ¸"},{key:"quantity",label:"ìˆ˜ëŸ‰",type:"number",icon:D,category:"ìˆ«ì"},{key:"unit_price_value",label:"ë‹¨ê°€",type:"number",icon:D,category:"ìˆ«ì"},{key:"total_amount",label:"í•©ê³„",type:"number",icon:D,category:"ìˆ«ì"},{key:"payment_category",label:"ê²°ì œì¢…ë¥˜",type:"select",icon:P,category:"ìƒíƒœ",options:["í˜„ì¥ê²°ì œ","êµ¬ë§¤ ìš”ì²­","ë°œì£¼","í˜„ê¸ˆ","ì¹´ë“œ"]},{key:"payment_schedule",label:"ì§€ì¶œì˜ˆì •ì¼",type:"select_with_empty",icon:me,category:"ìƒíƒœ"},{key:"is_payment_completed",label:"êµ¬ë§¤í˜„í™©",type:"select",icon:L,category:"ìƒíƒœ",options:["ëŒ€ê¸°","ì™„ë£Œ"]},{key:"is_received",label:"ì…ê³ í˜„í™©",type:"select",icon:L,category:"ìƒíƒœ",options:["ëŒ€ê¸°","ì™„ë£Œ"]},{key:"is_statement_received",label:"ê±°ë˜ëª…ì„¸ì„œ í™•ì¸",type:"select",icon:L,category:"ìƒíƒœ",options:["ëŒ€ê¸°","ì™„ë£Œ"]},{key:"is_utk_checked",label:"UTK í™•ì¸",type:"select",icon:P,category:"ìƒíƒœ",options:["ëŒ€ê¸°","ì™„ë£Œ"]},{key:"approval_status",label:"ìŠ¹ì¸ìƒíƒœ",type:"select",icon:P,category:"ìƒíƒœ",options:["ìŠ¹ì¸ëŒ€ê¸°","1ì°¨ìŠ¹ì¸","ìµœì¢…ìŠ¹ì¸","ë°˜ë ¤"]}],na=[{value:"request_date",label:"ì²­êµ¬ì¼"},{value:"delivery_request_date",label:"ì…ê³ ìš”ì²­ì¼"},{value:"payment_completed_at",label:"êµ¬ë§¤ì™„ë£Œì¼"},{value:"received_at",label:"ì…ê³ ì™„ë£Œì¼"},{value:"created_at",label:"ìƒì„±ì¼"},{value:"statement_received_at",label:"ê±°ë˜ëª…ì„¸ì„œì…ê³ ì¼"}],ia=[{value:"request_date",label:"ìš”ì²­ì¼"},{value:"purchase_order_number",label:"ë°œì£¼ë²ˆí˜¸"},{value:"vendor_name",label:"ì—…ì²´ëª…"},{value:"requester_name",label:"ìš”ì²­ì"},{value:"total_amount",label:"í•©ê³„"},{value:"delivery_request_date",label:"ì…ê³ ìš”ì²­ì¼"},{value:"created_at",label:"ìƒì„±ì¼"}];function ca({activeFilters:e,sortConfig:t,searchTerm:s,onFiltersChange:n,onSortChange:c,onSearchChange:d,availableEmployees:o=[],availableVendors:m=[],availableContacts:u=[],availablePaymentSchedules:p=[],children:h}){const[x,g]=a.useState(!1),[y,b]=a.useState(!1),[_,j]=a.useState(!1),[f,v]=a.useState({}),[w,N]=a.useState(!1),[k,C]=a.useState(!1),[q,$]=a.useState({}),[S,M]=a.useState(),[D,P]=a.useState({}),[T,I]=a.useState({}),[F,E]=a.useState(""),U=a.useRef(null);a.useEffect(()=>{_&&U.current&&U.current.focus()},[_]),a.useEffect(()=>{y&&I({field:t?.field||"",direction:t?.direction||"asc"})},[y,t]);const R=a=>{n(e.filter(e=>e.id!==a))},O=()=>{const e=la.find(e=>e.key===f.field);if(!e)return null;switch(e.type){case"text":return r.jsx(ee,{placeholder:"ê°’ ì…ë ¥",value:String(f.value||""),onChange:e=>v(a=>({...a,value:e.target.value})),className:"w-full business-radius-input border border-gray-300 bg-white text-gray-700 card-description h-auto",style:{padding:"2px 10px",fontSize:"10px",fontWeight:"500"}});case"number":return r.jsx(ee,{type:"number",placeholder:"ìˆ«ì ì…ë ¥",value:String(f.value||""),onChange:e=>v(a=>({...a,value:e.target.value})),className:"w-full business-radius-input border border-gray-300 bg-white text-gray-700 card-description h-auto",style:{padding:"2px 10px",fontSize:"10px",fontWeight:"500"}});case"searchable_select":{let a=[],t="ì„ íƒ";"requester_name"===e.key?(a=o,t="ìš”ì²­ì"):"vendor_name"===e.key?(a=m,t="ì—…ì²´"):"contact_name"===e.key&&(a=u,t="ë‹´ë‹¹ì");const s=a.filter(e=>e.toLowerCase().includes(F.toLowerCase()));return r.jsxs(ae,{onOpenChange:e=>{e||E("")},children:[r.jsx(te,{asChild:!0,children:r.jsxs(l,{variant:"outline",role:"combobox",className:"w-full button-base business-radius-button border border-gray-300 bg-white text-gray-700 justify-between [&>svg]:hidden",children:[r.jsx("span",{className:"truncate text-left",style:{fontSize:"12px",fontWeight:"500"},children:String(f.value||t)}),r.jsx(pe,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),r.jsx(se,{className:"w-[200px] p-1 border-0 shadow-lg",align:"start",children:r.jsxs("div",{className:"space-y-1",children:[r.jsx(ee,{placeholder:`${t} ê²€ìƒ‰...`,className:"h-auto border-0 focus:ring-0 focus:outline-none card-description placeholder:card-description",style:{padding:"2px 10px"},value:F,onChange:e=>E(e.target.value),autoFocus:!0}),r.jsx("div",{className:"max-h-[200px] overflow-y-auto",children:0===s.length?r.jsx("div",{className:"p-2 text-sm text-gray-500",children:F?"ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤":`${t}ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤`}):s.map(e=>r.jsxs(l,{variant:"ghost",onClick:()=>{v(a=>({...a,value:e})),E("")},className:"w-full justify-start p-2 h-auto hover:bg-gray-100 text-left",children:[r.jsx(L,{className:"mr-2 h-3 w-3 "+(f.value===e?"opacity-100":"opacity-0")}),r.jsx("span",{className:"card-description",children:e})]},e))})]})})]})}case"select":return r.jsxs(re,{value:String(f.value||""),onValueChange:e=>v(a=>({...a,value:e})),children:[r.jsx(le,{className:"button-base business-radius-button border border-gray-300 bg-white text-gray-700 [&>svg]:hidden text-center",children:r.jsx(ne,{placeholder:"ì„ íƒ"})}),r.jsx(ie,{children:e.options?.map(e=>r.jsx(ce,{value:e,children:r.jsx("span",{className:"card-description",children:e})},e))})]});case"select_with_empty":{const e=["ê³µë€",...p];return r.jsxs(re,{value:String(f.value||""),onValueChange:e=>v(a=>({...a,value:e})),children:[r.jsx(le,{className:"button-base business-radius-button border border-gray-300 bg-white text-gray-700 [&>svg]:hidden text-center",children:r.jsx(ne,{placeholder:"ì§€ì¶œì˜ˆì •ì¼"})}),r.jsx(ie,{children:e.map(e=>r.jsx(ce,{value:e,children:r.jsx("span",{className:"card-description",children:e})},e))})]})}case"date_range":return r.jsxs(ae,{open:w,onOpenChange:e=>{if(e)if(f.value&&"string"==typeof f.value)if(f.value.includes("~")){const[e,a]=f.value.split("~");$({from:new Date(e),to:new Date(a)})}else $({from:new Date(f.value),to:void 0});else $({});N(e)},children:[r.jsx(te,{asChild:!0,children:r.jsx(l,{variant:"outline",className:"w-full button-base business-radius-button border border-gray-300 bg-white text-gray-700 justify-between h-auto",children:r.jsxs("div",{className:"flex items-center gap-1.5 min-h-[32px]",children:[r.jsx(me,{className:"w-3 h-3 flex-shrink-0"}),r.jsx("span",{className:"card-description leading-tight whitespace-pre-line",children:f.value&&"string"==typeof f.value?(()=>{if(f.value.includes("~")){const[e,a]=f.value.split("~");return`${de(new Date(e),"yy/MM/dd")}\n~ ${de(new Date(a),"yy/MM/dd")}`}return de(new Date(String(f.value)),"yy/MM/dd")})():"ë‚ ì§œ ì„ íƒ"})]})})}),r.jsx(se,{className:"w-auto p-0",align:"start",children:r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"p-3 pb-0",children:[r.jsx("div",{className:"text-xs font-medium text-gray-600 mb-2",children:"ë‚ ì§œ ë²”ìœ„ ì„ íƒ"}),r.jsx(oe,{mode:"range",selected:q,onSelect:e=>{e&&$(e)},numberOfMonths:1,initialFocus:!0,className:"compact-calendar"})]}),r.jsxs("div",{className:"flex gap-2 p-3 pt-0",children:[r.jsx(l,{onClick:()=>{$({}),N(!1)},variant:"outline",className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 flex-1",children:"ì·¨ì†Œ"}),r.jsx(l,{onClick:()=>{if(q.from){if(q.to){const e=`${de(q.from,"yyyy-MM-dd")}~${de(q.to,"yyyy-MM-dd")}`;v(a=>({...a,value:e}))}else v(e=>({...e,value:de(q.from,"yyyy-MM-dd")}));N(!1)}},disabled:!q.from,className:"button-base bg-blue-500 text-white hover:bg-blue-600 flex-1",children:"í™•ì¸"})]})]})})]});case"date_month":return r.jsxs(ae,{open:k,onOpenChange:e=>{if(e)if(f.value&&"string"==typeof f.value)if(f.value.includes("~")){const[e,a]=f.value.split("~");P({from:new Date(`${e}-01`),to:new Date(`${a}-01`)})}else P({from:new Date(`${f.value}-01`),to:void 0});else P({});C(e)},children:[r.jsx(te,{asChild:!0,children:r.jsx(l,{variant:"outline",className:"w-full button-base business-radius-button border border-gray-300 bg-white text-gray-700 justify-between h-auto",children:r.jsxs("div",{className:"flex items-center gap-1.5",children:[r.jsx(me,{className:"w-3 h-3 flex-shrink-0"}),r.jsx("span",{className:"card-description leading-tight whitespace-pre-line",children:f.value&&"string"==typeof f.value?(()=>{if(f.value.includes("~")){const[e,a]=f.value.split("~"),[t,s]=e.split("-"),[r,l]=a.split("-");return`${t.slice(-2)}/${s}\n~ ${r.slice(-2)}/${l}`}{const[e,a]=String(f.value).split("-");return`${e.slice(-2)}/${a}`}})():"ì›” ì„ íƒ"})]})})}),r.jsx(se,{className:"w-auto p-0",align:"start",children:r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"p-3 pb-0",children:[r.jsx("div",{className:"text-xs font-medium text-gray-600 mb-3",children:"ì›” ì„ íƒ"}),r.jsxs("div",{className:"flex gap-4",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"ì‹œì‘ ì›” ì„ íƒ"}),r.jsx("div",{className:"mb-3",children:r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx(l,{onClick:()=>{const e=D.from?D.from.getFullYear():(new Date).getFullYear(),a=new Date(e-1,D.from?.getMonth()||0,1);P(e=>({...e,from:a}))},variant:"outline",size:"sm",className:"button-base border border-gray-300 bg-white text-gray-600 hover:bg-gray-50",children:"â€¹"}),r.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[D.from?D.from.getFullYear():(new Date).getFullYear(),"ë…„"]}),r.jsx(l,{onClick:()=>{const e=D.from?D.from.getFullYear():(new Date).getFullYear(),a=new Date(e+1,D.from?D.from.getMonth():0,1);P(e=>({...e,from:a}))},variant:"outline",size:"sm",className:"button-base border border-gray-300 bg-white text-gray-600 hover:bg-gray-50",children:"â€º"})]})}),r.jsx("div",{className:"grid grid-cols-3 gap-2",children:Array.from({length:12},(e,a)=>{const t=D.from?D.from.getFullYear():(new Date).getFullYear(),s=new Date(t,a,1),n=D.from&&D.from.getFullYear()===t&&D.from.getMonth()===a;return r.jsxs(l,{onClick:()=>{P(e=>({...e,from:s}))},variant:"outline",className:"button-base text-xs h-8 "+(n?"bg-blue-500 text-white border-blue-500 hover:bg-blue-600":"border-gray-300 bg-white text-gray-700 hover:bg-gray-50"),children:[a+1,"ì›”"]},a)})})]}),D.from&&r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"ì¢…ë£Œ ì›” ì„ íƒ (ì„ íƒì‚¬í•­)"}),r.jsx("div",{className:"mb-3",children:r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx(l,{onClick:()=>{const e=D.to?D.to.getFullYear():D.from.getFullYear(),a=new Date(e-1,D.to?.getMonth()||11,1);P(e=>({...e,to:a}))},variant:"outline",size:"sm",className:"button-base border border-gray-300 bg-white text-gray-600 hover:bg-gray-50",children:"â€¹"}),r.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[D.to?D.to.getFullYear():D.from.getFullYear(),"ë…„"]}),r.jsx(l,{onClick:()=>{const e=D.to?D.to.getFullYear():D.from.getFullYear(),a=new Date(e+1,D.to?.getMonth()||11,1);P(e=>({...e,to:a}))},variant:"outline",size:"sm",className:"button-base border border-gray-300 bg-white text-gray-600 hover:bg-gray-50",children:"â€º"})]})}),r.jsx("div",{className:"grid grid-cols-3 gap-2",children:Array.from({length:12},(e,a)=>{const t=D.to?D.to.getFullYear():D.from.getFullYear(),s=new Date(t,a,1),n=D.to&&D.to.getFullYear()===t&&D.to.getMonth()===a,i=!!D.from&&s<D.from;return r.jsxs(l,{onClick:()=>{i||P(e=>({...e,to:s}))},variant:"outline",disabled:i,className:"button-base text-xs h-8 "+(n?"bg-blue-500 text-white border-blue-500 hover:bg-blue-600":i?"border-gray-200 bg-gray-100 text-gray-400 cursor-not-allowed":"border-gray-300 bg-white text-gray-700 hover:bg-gray-50"),children:[a+1,"ì›”"]},a)})}),r.jsx("div",{className:"mt-3",children:r.jsx(l,{onClick:()=>{P(e=>({...e,to:void 0}))},variant:"outline",size:"sm",className:"button-base border border-gray-300 bg-white text-gray-600 hover:bg-gray-50 text-xs",children:"ì¢…ë£Œ ì›” ì œê±°"})})]})]})]}),r.jsxs("div",{className:"flex gap-2 p-3 pt-0",children:[r.jsx(l,{onClick:()=>{P({}),C(!1)},variant:"outline",className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 flex-1",children:"ì·¨ì†Œ"}),r.jsx(l,{onClick:()=>{if(D.from){if(D.to){const e=`${de(D.from,"yyyy-MM")}~${de(D.to,"yyyy-MM")}`;v(a=>({...a,value:e}))}else v(e=>({...e,value:de(D.from,"yyyy-MM")}));C(!1)}},disabled:!D.from,className:"button-base bg-blue-500 text-white hover:bg-blue-600 flex-1",children:"í™•ì¸"})]})]})})]});default:return null}};return r.jsx("div",{className:"w-full",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[r.jsxs(ae,{open:x,onOpenChange:g,children:[r.jsx(te,{asChild:!0,children:r.jsxs(l,{variant:"outline",className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50",children:[r.jsx(ve,{className:"w-4 h-4 mr-1"}),r.jsx("span",{className:"button-text",children:"í•„í„°"}),e.length>0&&r.jsx("span",{className:"ml-1 badge-stats bg-blue-50 text-blue-700",children:e.length})]})}),r.jsx(se,{className:"w-64 p-3",align:"start",children:r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("h4",{className:"card-title",children:"í•„í„°"}),e.length>0&&r.jsx(l,{variant:"ghost",onClick:()=>{n([]),g(!1)},className:"button-base text-red-600 hover:text-red-700 hover:bg-red-50",children:r.jsx("span",{className:"button-text",children:"ëª¨ë‘ ì§€ìš°ê¸°"})})]}),e.length>0&&r.jsxs("div",{className:"space-y-2",children:[e.map(e=>r.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 business-radius",children:[r.jsxs("span",{className:"card-description",children:[e.label,e.dateField&&r.jsxs("span",{className:"text-blue-600",children:["(",na.find(a=>a.value===e.dateField)?.label,")"]}),": ",String(e.value)]}),r.jsx(l,{variant:"ghost",onClick:()=>R(e.id),className:"button-base h-6 w-6 p-0 hover:bg-red-50",children:r.jsx(i,{className:"w-3 h-3"})})]},e.id)),r.jsx("div",{className:"border-t border-gray-200 my-2"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs(re,{onValueChange:e=>{const a=la.find(a=>a.key===e);if(!a)return;let t="contains";"date_range"!==a.type&&"date_month"!==a.type||(t="equals"),v({id:`${e}_${Date.now()}`,field:e,condition:t,value:"",label:a.label})},children:[r.jsx(le,{className:"button-base business-radius-button border border-gray-300 bg-white text-gray-700 [&>svg]:hidden text-center",children:r.jsx(ne,{placeholder:"+ í•„í„° ì¶”ê°€"})}),r.jsx(ie,{className:"w-64 max-h-80 overflow-y-auto",style:{scrollbarWidth:"auto",scrollbarColor:"#9ca3af #f3f4f6"},children:Object.entries(la.reduce((e,a)=>(e[a.category]||(e[a.category]=[]),e[a.category].push(a),e),{})).map(([e,a])=>r.jsxs("div",{children:[r.jsx("div",{className:"px-2 py-1 card-description uppercase",children:e}),a.map(e=>r.jsx(ce,{value:e.key,children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(e.icon,{className:"w-4 h-4"}),r.jsx("span",{className:"card-description",children:e.label})]})},e.key))]},e))})]}),f.field&&r.jsxs("div",{className:"space-y-2 p-3 border business-radius bg-white",children:[r.jsx("div",{className:"flex items-center gap-2",children:r.jsxs("span",{className:"card-title",children:[f.label," í•„í„°"]})}),"date_range"===f.field||"date_month"===f.field?r.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[r.jsx("div",{className:"flex items-start",children:r.jsxs(re,{value:f.dateField||"",onValueChange:e=>v(a=>({...a,dateField:e})),children:[r.jsx(le,{className:"w-full button-base business-radius-button border border-gray-300 bg-white text-gray-700 [&>svg]:hidden text-center justify-center",children:r.jsx(ne,{placeholder:"ë‚ ì§œ í•­ëª©",className:"text-center"})}),r.jsx(ie,{children:na.map(e=>r.jsx(ce,{value:e.value,children:r.jsx("span",{className:"card-description",children:e.label})},e.value))})]})}),r.jsx("div",{className:"flex items-start",children:O()})]}):r.jsx("div",{children:O()}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(l,{onClick:()=>{const a="date_range"===f.field||"date_month"===f.field,t=a&&!f.dateField;let s=f.condition;if(!s)if(a)s="equals";else{const e=la.find(e=>e.key===f.field);s="select"===e?.type||"select_with_empty"===e?.type||"searchable_select"===e?.type?"equals":"contains"}if(f.field&&void 0!==s&&void 0!==f.value&&""!==f.value&&!t){const a={id:f.id,field:f.field,condition:s,value:f.value,label:f.label,dateField:f.dateField};n([...e,a]),v({}),g(!1)}},disabled:!f.field||""===f.value||("date_range"===f.field||"date_month"===f.field)&&!f.dateField,className:"button-base bg-blue-500 text-white hover:bg-blue-600 flex-1",children:"ì ìš©"}),r.jsx(l,{variant:"outline",onClick:()=>v({}),className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 flex-1",children:"ì·¨ì†Œ"})]})]})]})]})})]}),r.jsxs(ae,{open:y,onOpenChange:b,children:[r.jsx(te,{asChild:!0,children:r.jsxs(l,{variant:"outline",className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50",children:[r.jsx(ue,{className:"w-4 h-4 mr-1"}),r.jsx("span",{className:"button-text",children:"ì •ë ¬"}),t&&r.jsxs("span",{className:"ml-1 card-description",children:["(","asc"===t.direction?"â†‘":"â†“",")"]})]})}),r.jsx(se,{className:"w-56 p-3",align:"start",children:r.jsxs("div",{className:"space-y-3",children:[r.jsx("h4",{className:"card-title",children:"ì •ë ¬ ì„¤ì •"}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"ì •ë ¬ ê¸°ì¤€"}),r.jsxs(re,{value:T.field||"",onValueChange:e=>{I(a=>({...a,field:e}))},children:[r.jsx(le,{className:"button-base business-radius-button border border-gray-300 bg-white text-gray-700 [&>svg]:hidden",children:r.jsx(ne,{placeholder:"ì„ íƒí•˜ì„¸ìš”"})}),r.jsx(ie,{children:ia.map(e=>r.jsx(ce,{value:e.value,children:r.jsx("span",{className:"card-description",children:e.label})},e.value))})]})]}),T.field&&r.jsxs("div",{children:[r.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"ì •ë ¬ ë°©í–¥"}),r.jsxs(re,{value:T.direction||"",onValueChange:e=>{I(a=>({...a,direction:e}))},children:[r.jsx(le,{className:"button-base business-radius-button border border-gray-300 bg-white text-gray-700 [&>svg]:hidden",children:r.jsx(ne,{placeholder:"ì„ íƒí•˜ì„¸ìš”"})}),r.jsxs(ie,{children:[r.jsx(ce,{value:"asc",children:r.jsx("span",{className:"card-description",children:"ì˜¤ë¦„ì°¨ìˆœ â†‘"})}),r.jsx(ce,{value:"desc",children:r.jsx("span",{className:"card-description",children:"ë‚´ë¦¼ì°¨ìˆœ â†“"})})]})]})]}),r.jsxs("div",{className:"flex gap-2 pt-2",children:[r.jsx(l,{onClick:()=>{if(T.field&&T.direction){const e=ia.find(e=>e.value===T.field);e&&c({field:T.field,direction:T.direction,label:e.label})}b(!1),I({})},disabled:!T.field||!T.direction,className:"button-base bg-blue-500 hover:bg-blue-600 text-white flex-1",children:"ì ìš©"}),r.jsx(l,{onClick:()=>{c(null),I({}),b(!1)},className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50",children:"ì´ˆê¸°í™”"})]})]}),t&&r.jsx("div",{className:"border-t pt-2",children:r.jsx(l,{variant:"outline",onClick:()=>c(null),className:"button-base w-full border border-gray-300 text-gray-700",children:r.jsx("span",{className:"button-text",children:"ì •ë ¬ í•´ì œ"})})})]})})]}),r.jsx("div",{className:"flex items-center gap-2",children:_?r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(ee,{ref:U,placeholder:"ì „ì²´ ê²€ìƒ‰...",value:s,onChange:e=>d(e.target.value),className:"w-64 business-radius-input button-base border border-gray-300 bg-white text-gray-700"}),r.jsx(l,{variant:"ghost",onClick:()=>{j(!1),d("")},className:"button-base h-8 w-8 p-0",children:r.jsx(i,{className:"w-4 h-4"})})]}):r.jsxs(l,{variant:"outline",onClick:()=>j(!0),className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50",children:[r.jsx(pe,{className:"w-4 h-4 mr-1"}),r.jsx("span",{className:"button-text",children:"ê²€ìƒ‰"})]})}),r.jsxs(l,{variant:"outline",onClick:()=>{d(""),n([]),c({field:"created_at",direction:"desc",label:"ìƒì„±ì¼"}),j(!1)},className:"button-base border border-gray-300 bg-white text-blue-600 hover:bg-blue-50 hover:border-blue-300",children:["â†» ",r.jsx("span",{className:"button-text text-blue-600",children:"ì´ˆê¸°í™”"})]}),e.length>0&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"h-6 w-px bg-gray-300 mx-3"}),r.jsx("div",{className:"flex items-center gap-2 flex-nowrap overflow-x-auto",children:e.map(e=>r.jsxs("span",{className:"badge-stats flex items-center gap-1 bg-blue-50 text-blue-700 border border-blue-200 whitespace-nowrap",children:[e.label,e.dateField&&r.jsxs("span",{className:"text-blue-600",children:["(",na.find(a=>a.value===e.dateField)?.label,")"]}),": ",String(e.value),r.jsx(l,{variant:"ghost",size:"sm",onClick:()=>R(e.id),className:"h-4 w-4 p-0 hover:bg-blue-100 ml-1",children:r.jsx(i,{className:"w-3 h-3"})})]},e.id))})]})]}),r.jsx("div",{className:"flex items-center gap-2",children:h})]})})}const da=["purchase_manager","app_admin","raw_material_manager","consumable_manager"],oa=["ì •í¬ì›…"];function ma(e,a){return t=a,da.some(e=>t.includes(e))?e:e.filter(e=>!oa.includes(e.requester_name));var t}const ua=a.lazy(()=>v(()=>import("./PurchaseItemsModal-DY5LH0d3.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]))),pa=[{key:"pending",label:"ìŠ¹ì¸ëŒ€ê¸°"},{key:"purchase",label:"êµ¬ë§¤ í˜„í™©"},{key:"receipt",label:"ì…ê³  í˜„í™©"},{key:"done",label:"ì „ì²´ í•­ëª©"}];function ha({showEmailButton:e=!0}){const n=p(),i=h(),c=t(),[d,m]=a.useState(null),[v,k]=a.useState(!1),[C,q]=a.useState(!1),$=a.useRef(!1);a.useEffect(()=>(s.info("ğŸ” [PurchaseListMain] ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ë¨, hasShownWarning ë¦¬ì…‹"),$.current=!1,()=>{s.info("ğŸ” [PurchaseListMain] ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸ë¨")}),[]);const[S,M]=a.useState([]),[D,P]=a.useState({field:"created_at",direction:"desc",label:"ìƒì„±ì¼"}),[T,I]=a.useState(""),[F,E]=a.useState([]),[U,R]=a.useState([]),[O,L]=a.useState([]),[B,z]=a.useState([]),{allPurchases:J,loading:A,currentUser:K,getFilteredPurchases:H}=o(),{columnVisibility:Z,isLoading:G,applyColumnSettings:Q,resetToDefault:X}=(()=>{const[e,r]=a.useState(N),[l,n]=a.useState(!0),[i,c]=a.useState(null),[,d]=a.useState(0),o=t(),m=a.useCallback(async()=>{try{n(!0),c(null);const{data:{user:e},error:a}=await o.auth.getUser();if(a||!e?.email)return s.warn("[useColumnSettings] ì‚¬ìš©ì ì¸ì¦ ì •ë³´ ì—†ìŒ",{authError:a}),void r(N);const{data:t,error:l}=await o.from("user_ui_settings").select("setting_value").eq("user_email",e.email).eq("setting_type","column_visibility").eq("setting_key","purchase_list_done").maybeSingle();if(l)return s.error("[useColumnSettings] ì„¤ì • ì¡°íšŒ ì‹¤íŒ¨",l,{userEmail:e.email}),c("ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."),void r(N);if(t?.setting_value){const a=t.setting_value,l={...N,...a};r(l),s.debug("[useColumnSettings] ì‚¬ìš©ì ì„¤ì • ë¡œë“œ ì™„ë£Œ",{userEmail:e.email,settingsCount:Object.keys(l).length})}else r(N),s.debug("[useColumnSettings] ê¸°ë³¸ ì„¤ì • ì‚¬ìš©",{userEmail:e.email})}catch(e){s.error("[useColumnSettings] ì„¤ì • ë¡œë“œ ì¤‘ ì˜ˆì™¸ ë°œìƒ",e),c("ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."),r(N)}finally{n(!1)}},[o]),u=a.useCallback(async e=>{try{const{data:{user:a},error:t}=await o.auth.getUser();if(t||!a?.email)return void s.warn("[useColumnSettings] ì‚¬ìš©ì ì¸ì¦ ì •ë³´ ì—†ìŒ - ì €ì¥ ì‹¤íŒ¨",{authError:t});const{error:r}=await o.from("user_ui_settings").upsert({user_email:a.email,setting_type:"column_visibility",setting_key:"purchase_list_done",setting_value:e},{onConflict:"user_email,setting_type,setting_key"});if(r)throw s.error("[useColumnSettings] ì„¤ì • ì €ì¥ ì‹¤íŒ¨",r,{userEmail:a.email,settings:e}),r;s.info("[useColumnSettings] ì„¤ì • ì €ì¥ ì„±ê³µ",{userEmail:a.email,settingsCount:Object.keys(e).length,visibleColumns:Object.entries(e).filter(([,e])=>e).length})}catch(a){throw s.error("[useColumnSettings] ì„¤ì • ì €ì¥ ì¤‘ ì˜ˆì™¸ ë°œìƒ",a),a}},[o]),p=a.useCallback(e=>{r(a=>{const t={...a,[e]:!a[e]};return u(t).catch(e=>{r(a),w.error("ì„¤ì • ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."),s.error("[useColumnSettings] í† ê¸€ ì €ì¥ ì‹¤íŒ¨, ë¡¤ë°± ì²˜ë¦¬",e)}),t})},[u]),h=a.useCallback(e=>{s.info("[useColumnSettings] applyColumnSettings í˜¸ì¶œ",{newSettings:e,keys:Object.keys(e),values:Object.values(e)}),r(e),d(e=>e+1),s.info("[useColumnSettings] setColumnVisibility í˜¸ì¶œë¨",{newSettings:e}),u(e).then(()=>{w.success("ì¹¼ëŸ¼ ì„¤ì •ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤."),s.info("[useColumnSettings] DB ì €ì¥ ì„±ê³µ")}).catch(e=>{s.error("[useColumnSettings] ì„¤ì • ì €ì¥ ì‹¤íŒ¨",e),w.error("ì„¤ì • ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")})},[u]),x=a.useCallback(()=>{r(N),u(N).catch(e=>{w.error("ê¸°ë³¸ ì„¤ì • ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."),s.error("[useColumnSettings] ê¸°ë³¸ê°’ ì €ì¥ ì‹¤íŒ¨",e)}),w.success("ì¹¼ëŸ¼ ì„¤ì •ì´ ê¸°ë³¸ê°’ìœ¼ë¡œ ì¬ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.")},[u]);return a.useEffect(()=>{m()},[m]),{columnVisibility:e,toggleColumn:p,applyColumnSettings:h,resetToDefault:x,isLoading:l,error:i}})();a.useMemo(()=>!!Z&&Object.values(Z).some(e=>!e),[Z]);const ee=a.useMemo(()=>Array.isArray(K?.purchase_role)?K.purchase_role.map(e=>e.trim()):"string"==typeof K?.purchase_role?K.purchase_role.split(",").map(e=>e.trim()):[],[K?.purchase_role]),ae=K?.name||null,[te,se]=a.useState(0),[re,le]=a.useState({pending:0,purchase:0,receipt:0,done:0}),ne=a.useCallback(async()=>{s.debug("ğŸ”„ [loadPurchases] ê°•ì œ ìƒˆë¡œê³ ì¹¨ íŠ¸ë¦¬ê±°"),se(e=>e+1)},[]),ie=a.useCallback((e,a)=>{x(e,a)},[]),ce=ee?.includes("app_admin"),de=a.useMemo(()=>{return(e=ee)&&0!==e.length?e.includes("app_admin")||e.includes("ceo")?3:e.includes("consumable_manager")||e.includes("raw_material_manager")||e.includes("purchase_manager")||e.includes("lead buyer")||e.includes("middle_manager")?2:1:1;var e},[ee]),oe=a.useMemo(()=>{if(!ae)return s.warn("[defaultEmployeeByTab] currentUserNameì´ ì—†ìŒ",{currentUser:K,currentUserRoles:ee}),{pending:"all",purchase:"all",receipt:"all",done:"all"};const e=ee.includes("hr"),a=ee.includes("purchase_manager"),t=ee.some(e=>["app_admin","ceo","lead buyer","finance_team","raw_material_manager","consumable_manager","purchase_manager","hr"].includes(e));return{pending:3===de?"all":ae,purchase:t||3===de?"all":ae,receipt:e||a||3===de?"all":ae,done:"all"}},[ae,de,ee]),me=(()=>{const e=new URLSearchParams(i.search).get("tab");return e&&["pending","purchase","receipt","done"].includes(e)?e:"pending"})(),[ue,pe]=a.useState(me),[_e,je]=a.useState("all"),[fe,ve]=a.useTransition(),ke=a.useMemo(()=>ma(J,ee),[J,ee]),Ce=V(ke,ae);a.useEffect(()=>{if(!A&&ke.length>0){const e=ke.find(e=>"F20251226_003"===e.purchase_order_number);if(e){const a=new Date;a.setHours(0,0,0,0);const t=e.delivery_request_date?new Date(e.delivery_request_date):null,r=e.revised_delivery_request_date?new Date(e.revised_delivery_request_date):null;t&&t.setHours(0,0,0,0),r&&r.setHours(0,0,0,0);const l={check1_isReceived:!(e.is_received||"completed"===e.delivery_status),check2_approved:"approved"===e.middle_manager_status&&"approved"===e.final_manager_status,check3_requesterMatch:!ae||e.requester_name===ae,check4_notRevisionRequested:!0!==e.delivery_revision_requested,check5_dateOverdue:r&&r<a||t&&t<a&&!r},n=Object.values(l).every(e=>!0===e);s.info("ğŸ” [ì…ê³ ì§€ì—°ì•Œë¦¼ ìƒì„¸ ë¶„ì„] F20251226_003",{...l,allChecksPass:n,deliveryWarningCount:Ce,hasShownWarning:$.current,deliveryDate:t?W(t):void 0,revisedDate:r?W(r):void 0,today:a.toISOString(),deliveryDateOverdue:!!t&&t<a,revisedDateOverdue:!!r&&r<a})}}},[A,ke,ae,Ce]),a.useEffect(()=>{if(!A&&ke.length>0){const e=ke.find(e=>"F20251226_003"===e.purchase_order_number);e?s.info("ğŸ” [ì…ê³ ì§€ì—°ì•Œë¦¼ ë””ë²„ê¹…] F20251226_003 í•­ëª© ë°œê²¬",{purchase_order_number:e.purchase_order_number,requester_name:e.requester_name,currentUserName:ae,nameMatch:e.requester_name===ae,is_received:e.is_received,delivery_status:e.delivery_status,middle_manager_status:e.middle_manager_status,final_manager_status:e.final_manager_status,delivery_revision_requested:e.delivery_revision_requested,delivery_request_date:e.delivery_request_date,revised_delivery_request_date:e.revised_delivery_request_date,deliveryWarningCount:Ce,visiblePurchasesCount:ke.length,hasShownWarning:$.current,loading:A}):s.warn("ğŸ” [ì…ê³ ì§€ì—°ì•Œë¦¼ ë””ë²„ê¹…] F20251226_003 í•­ëª©ì„ visiblePurchasesì—ì„œ ì°¾ì„ ìˆ˜ ì—†ìŒ",{visiblePurchasesCount:ke.length,purchaseOrderNumbers:ke.slice(0,5).map(e=>e.purchase_order_number)})}},[A,ke,ae,Ce]),a.useEffect(()=>{if($.current)s.debug("ğŸ” [ì…ê³ ì§€ì—°ì•Œë¦¼] ì´ë¯¸ í‘œì‹œí–ˆìœ¼ë¯€ë¡œ ìŠ¤í‚µ",{hasShownWarning:$.current,deliveryWarningCount:Ce,loading:A,visiblePurchasesLength:ke.length});else if(s.debug("ğŸ” [ì…ê³ ì§€ì—°ì•Œë¦¼] ëª¨ë‹¬ í‘œì‹œ ì¡°ê±´ ì²´í¬",{loading:A,deliveryWarningCount:Ce,visiblePurchasesLength:ke.length,currentUserName:ae,shouldShow:!A&&Ce>0&&ke.length>0}),!A&&Ce>0&&ke.length>0){const e=setTimeout(()=>{$.current||($.current=!0,s.info("ğŸ” [ì…ê³ ì§€ì—°ì•Œë¦¼] ëª¨ë‹¬ í‘œì‹œ íŠ¸ë¦¬ê±°",{deliveryWarningCount:Ce,visiblePurchasesLength:ke.length}),q(!0))},500);return()=>clearTimeout(e)}},[A,Ce,ke.length,ae]),a.useEffect(()=>{if(oe&&null!==ae){const e=oe[ue];void 0!==e&&(je(e),s.info("[ì´ˆê¸° selectedEmployee ì„¤ì •]",{activeTab:ue,initialEmployeeValue:e,defaultEmployeeByTab:oe}))}},[]),a.useEffect(()=>{const e=new URLSearchParams(i.search).get("tab");e&&["pending","purchase","receipt","done"].includes(e)&&pe(e)},[i.search]),a.useEffect(()=>{const e=oe[ue];void 0!==e&&je(e)},[ue,oe]),a.useEffect(()=>{(async()=>{if(!_()||!j.allPurchases){s.info("ğŸ”„ [PurchaseListMain] ìºì‹œ ë¬´íš¨í™” ê°ì§€, ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì¤‘...",{isCacheValid:_(),hasData:!!j.allPurchases,lastFetch:j.lastFetch});try{await f(K?.id),s.info("âœ… [PurchaseListMain] ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ")}catch(e){s.error("âŒ [PurchaseListMain] ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨:",e)}}})()},[K?.id,i.key]),a.useEffect(()=>{(async()=>{try{const{data:e}=await c.from("employees").select("name");if(e){const a=[...new Set(e.map(e=>e.name).filter(Boolean))];E(a)}const{data:a}=await c.from("vendors").select("vendor_name");if(a){const e=[...new Set(a.map(e=>e.vendor_name).filter(Boolean))];R(e)}const{data:t}=await c.from("vendor_contacts").select("contact_name");if(t){const e=[...new Set(t.map(e=>e.contact_name).filter(Boolean))];L(e)}const{data:s}=await c.from("vendors").select("vendor_payment_schedule");if(s){const e=[...new Set(s.map(e=>e.vendor_payment_schedule).filter(Boolean))];z(e)}}catch(e){s.error("í•„í„° ì˜µì…˜ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨",e)}})()},[c]),a.useCallback(e=>e.is_received?r.jsx("span",{className:"badge-stats bg-green-500 text-white",children:"ì…ê³ ì™„ë£Œ"}):"approved"===e.middle_manager_status&&"approved"===e.final_manager_status?r.jsx("span",{className:"badge-stats bg-blue-500 text-white",children:"êµ¬ë§¤ì§„í–‰"}):"rejected"===e.middle_manager_status||"rejected"===e.final_manager_status?r.jsx("span",{className:"badge-stats bg-red-500 text-white",children:"ë°˜ë ¤"}):r.jsx("span",{className:"badge-stats bg-yellow-500 text-white",children:"ìŠ¹ì¸ëŒ€ê¸°"}),[]),a.useCallback((e,a)=>{switch(a){case"purchase_order_number":return e.purchase_order_number;case"payment_category":return e.payment_category;case"requester_name":return e.requester_name;case"vendor_name":return e.vendor_name;case"contact_name":case"payment_schedule":return"-";case"item_name":return e.purchase_request_items?.[0]?.item_name||"";case"specification":return e.purchase_request_items?.[0]?.specification||"";case"quantity":return e.purchase_request_items?.[0]?.quantity||0;case"unit_price_value":return e.purchase_request_items?.[0]?.unit_price_value||0;case"total_amount":return e.total_amount;case"remark":return e.purchase_request_items?.[0]?.remark||"";case"project_vendor":return e.project_vendor;case"project_item":return e.project_item;case"sales_order_number":return e.sales_order_number;case"is_payment_completed":return e.is_payment_completed?"ì™„ë£Œ":"ëŒ€ê¸°";case"is_received":return e.is_received?"ì™„ë£Œ":"ëŒ€ê¸°";case"is_statement_received":return e.is_statement_received?"ì™„ë£Œ":"ëŒ€ê¸°";case"is_utk_checked":return e.is_utk_checked?"ì™„ë£Œ":"ëŒ€ê¸°";case"request_date":return e.request_date;case"delivery_request_date":return e.delivery_request_date;case"payment_completed_at":return e.payment_completed_at;case"received_at":return e.received_at;case"created_at":return e.created_at;case"statement_received_at":return e.purchase_request_items?.[0]?.statement_received_date||null;default:return null}},[]),a.useCallback((e,a,t,r)=>{if(null==e)return"is_empty"===a;if("date_range"===r&&t&&"string"==typeof t&&t.includes("~")){if(!e)return!1;const[a,s]=t.split("~"),r=new Date(e),l=new Date(a),n=new Date(s);return r>=l&&r<=n}if("date_month"===r&&t&&"string"==typeof t&&t.includes("~")){if(!e)return!1;const[a,s]=t.split("~"),r=new Date(e),l=new Date(`${a}-01`),n=new Date(`${s}-01`),i=new Date(n.getFullYear(),n.getMonth()+1,0,23,59,59);return r>=l&&r<=i}if(r&&("date_month"===r||r.endsWith("_month"))){if(!t)return!0;const a=new Date(e),[s,r]=t.split("-");return a.getFullYear()===parseInt(s)&&a.getMonth()+1===parseInt(r)}const l=String(e).toLowerCase(),n=String(t).toLowerCase();switch(a){case"contains":return l.includes(n);case"equals":if("date_range"===r||t.match(/^[0-9]{4}-[0-9]{2}-[0-9]{2}/)){if(!e)return!1;try{const a=new Date(e).toISOString().split("T")[0];return a===t.split("T")[0]}catch(i){return s.error("ë‚ ì§œ ë¹„êµ ì˜¤ë¥˜:",i),!1}}return l===n;case"starts_with":return l.startsWith(n);case"ends_with":return l.endsWith(n);case"is_empty":return!e||""===l.trim();case"is_not_empty":return!!e&&""!==l.trim();case"greater_than":return Number(e)>Number(t);case"less_than":return Number(e)<Number(t);case"between":default:return!0;case"after":return new Date(e)>new Date(t);case"before":return new Date(e)<new Date(t);case"not_equals":return l!==n}},[]);const qe=a.useMemo(()=>H({tab:ue,employeeName:"all"===_e||"ì „ì²´"===_e?null:_e,searchTerm:T,advancedFilters:S,sortConfig:D?{key:D.field,direction:D.direction}:void 0}),[H,ue,_e,T,S,D,J]),$e=a.useMemo(()=>qe.filter(e=>{const a=e.po_template_type;return!a||"ë°œì£¼/êµ¬ë§¤"===a||"ì¼ë°˜"===a}),[qe]);a.useEffect(()=>{if(J&&J.length>0){const e=g(J,K);le(e)}else if(j.allPurchases&&j.allPurchases.length>0){const e=g(j.allPurchases,K);le(e)}},[J,K]);const Se=re,Me=a.useMemo(()=>{if(!T&&0===S.length)return Se;const e={pending:0,purchase:0,receipt:0,done:0};return["pending","purchase","receipt","done"].forEach(a=>{const t=H({tab:a,employeeName:"all"===oe[a]?null:oe[a],searchTerm:T,advancedFilters:S,sortConfig:D?{key:D.field,direction:D.direction}:void 0});e[a]=t.length}),e},[T,S,Se,H,oe,D]),De=a.useCallback(e=>T||S.length>0?Me[e].toString():"done"===e?"ì „ì²´":Se[e].toString(),[T,S.length,Me,Se]),Pe=a.useMemo(()=>{const e=S.filter(e=>"date_month"===e.field||"date_range"===e.field&&e.dateField&&e.dateField.includes("_month"));if(0===e.length)return null;const a=$e.reduce((e,a)=>{if(a.purchase_request_items?.length){return e+a.purchase_request_items.reduce((e,t)=>e+(t.amount_value||0)+("ë°œì£¼"===a.payment_category&&t.tax_amount_value?t.tax_amount_value:0),0)}const t=a.total_amount||0;return e+t+("ë°œì£¼"===a.payment_category?.1*t:0)},0),t=e[0].value;if(t&&"string"==typeof t&&t.includes("~")){const[e,s]=t.split("~"),r=new Date(`${e}-01`),l=new Date(`${s}-01`),n=[];let i=0;const c=new Date(r);for(;c<=l;){const e=c.getFullYear(),a=c.getMonth()+1,t=`${e}-${a.toString().padStart(2,"0")}`,s=$e.filter(t=>{const s=new Date(t.request_date);return s.getFullYear()===e&&s.getMonth()+1===a}),r=s.reduce((e,a)=>{if(a.purchase_request_items?.length){return e+a.purchase_request_items.reduce((e,t)=>e+(t.amount_value||0)+("ë°œì£¼"===a.payment_category&&t.tax_amount_value?t.tax_amount_value:0),0)}const t=a.total_amount||0;return e+t+("ë°œì£¼"===a.payment_category?.1*t:0)},0);n.push({year:e,month:a,monthStr:t,total:r,count:s.length}),i+=r,c.setMonth(c.getMonth()+1)}return{type:"range",months:n,grandTotal:i,totalFilteredAmount:a}}{const[e,s]=("string"==typeof t?t:"").split("-"),r=$e.filter(a=>{const t=new Date(a.request_date);return t.getFullYear()===parseInt(e)&&t.getMonth()+1===parseInt(s)}),l=r.reduce((e,a)=>{if(a.purchase_request_items?.length){return e+a.purchase_request_items.reduce((e,t)=>e+(t.amount_value||0)+("ë°œì£¼"===a.payment_category&&t.tax_amount_value?t.tax_amount_value:0),0)}const t=a.total_amount||0;return e+t+("ë°œì£¼"===a.payment_category?.1*t:0)},0);return{type:"single",year:parseInt(e),month:parseInt(s),total:l,count:r.length,totalFilteredAmount:a}}},[S,$e]),Te=a.useCallback(async e=>{try{const a=(new Date).toISOString(),[t,r]=await Promise.all([c.from("purchase_requests").update({is_received:!0,received_at:a}).eq("id",e),c.from("purchase_request_items").update({is_received:!0,delivery_status:"received"}).eq("purchase_request_id",e)]);if(t.error)throw t.error;if(r.error)throw r.error;y(e)||s.warn("[PurchaseListMain] ë©”ëª¨ë¦¬ ìºì‹œ ì…ê³ ì™„ë£Œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨",{purchaseId:e}),w.success("ì…ê³ ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤."),await ne()}catch(a){w.error("ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},[c,ne]),Ie=a.useCallback(async e=>{try{const a=(new Date).toISOString(),[t,r]=await Promise.all([c.from("purchase_requests").update({is_payment_completed:!0,payment_completed_at:a}).eq("id",e),c.from("purchase_request_items").update({is_payment_completed:!0,payment_completed_at:a}).eq("purchase_request_id",e)]);if(t.error)throw t.error;if(r.error)throw r.error;b(e)||(s.warn("[PurchaseListMain] ë©”ëª¨ë¦¬ ìºì‹œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨, ë°ì´í„° ì¬ë¡œë“œ",{purchaseId:e}),await ne()),w.success("êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.")}catch(a){s.error("[PurchaseListMain] êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ ì‹¤íŒ¨:",a),w.error("ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},[c,ne]);a.useCallback(e=>{m(e),k(!0)},[]);const Fe=a.useMemo(()=>d?{...d,vendor_name:d.vendor_name||"",project_vendor:d.project_vendor||"",sales_order_number:d.sales_order_number||"",project_item:d.project_item||""}:null,[d]);return a.useCallback(e=>{q(!1),m(e),k(!0)},[]),r.jsxs("div",{className:"w-full",children:[r.jsx("div",{className:"mb-4",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"page-title",children:"ë°œì£¼ìš”ì²­ ê´€ë¦¬"}),r.jsx("p",{className:"page-subtitle",style:{marginTop:"-2px",marginBottom:"-4px"},children:"Purchase Management"})]}),Ce>0&&r.jsxs(l,{onClick:()=>q(!0),variant:"outline",className:"flex items-center gap-2 border-orange-300 bg-orange-50 text-orange-700 hover:bg-orange-100 hover:border-orange-400",children:[r.jsx(we,{className:"w-4 h-4"}),r.jsx("span",{className:"text-xs font-medium",children:"ì…ê³  ì§€ì—°"}),r.jsxs(be,{variant:"outline",className:"bg-orange-100 text-orange-700 border-orange-300 text-[10px] px-1.5 py-0",children:[Ce,"ê±´"]})]})]})}),r.jsx("div",{className:"mb-3",children:r.jsx(ca,{activeFilters:S,sortConfig:D,searchTerm:T,onFiltersChange:M,onSortChange:P,onSearchChange:I,availableEmployees:F,availableVendors:U,availableContacts:O,availablePaymentSchedules:B,children:r.jsx(Ne,{isVisible:!0,columnVisibility:Z,applyColumnSettings:Q,resetToDefault:X,isLoading:G,currentUserRoles:ee})})}),r.jsxs("div",{className:"space-y-3",children:[r.jsx("div",{className:"flex flex-col sm:flex-row sm:space-x-1 space-y-1 sm:space-y-0 bg-gray-50 p-1 business-radius-card border border-gray-200",children:pa.map(e=>r.jsxs("button",{onClick:()=>{s.info("[íƒ­ í´ë¦­ ì´ë²¤íŠ¸]",{tab:e.key,currentActiveTab:ue,currentUser:K?.name,currentUserRoles:ee,defaultEmployeeByTab:oe,isPending:fe});const a=new URLSearchParams(i.search);a.set("tab",e.key),n({search:a.toString()},{replace:!0});try{const a=oe[e.key];void 0===a?(s.error("[íƒ­ ì „í™˜ ì˜¤ë¥˜] defaultEmployeeByTabì—ì„œ ê°’ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ",{tabKey:e.key,defaultEmployeeByTab:oe,availableKeys:Object.keys(oe)}),pe(e.key),je("all")):(pe(e.key),je(a)),s.info("[íƒ­ ì „í™˜ ì„±ê³µ]",{newTab:e.key,newEmployee:a||"all",actualNewEmployee:a})}catch(t){s.error("[íƒ­ ì „í™˜ ì‹¤íŒ¨]",t)}},className:"flex-1 flex items-center justify-center space-x-2 py-1.5 px-3 sm:px-4 business-radius-button button-text font-medium transition-colors "+(ue===e.key?"text-hansl-600 bg-white shadow-sm border border-gray-200":"text-gray-600 bg-transparent hover:text-gray-900 hover:bg-white/50"),children:[r.jsx("span",{className:"whitespace-nowrap",children:e.label}),r.jsx("span",{className:"badge-stats "+(ue===e.key?"bg-hansl-50 text-hansl-700":"bg-gray-100 text-gray-600"),children:De(e.key)})]},e.key))}),Pe&&r.jsx("div",{className:"mb-3",children:"single"===Pe.type?r.jsxs("div",{className:"inline-flex items-center gap-2 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 business-radius-badge px-3 py-2 shadow-sm",children:[r.jsxs("div",{className:"flex items-center gap-1.5",children:[r.jsx("div",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full"}),r.jsxs("span",{className:"card-subtitle text-gray-700",children:[Pe.year,"ë…„ ",Pe.month,"ì›”"]}),r.jsxs("span",{className:"badge-text text-gray-500",children:[Pe.count,"ê±´"]})]}),r.jsx("div",{className:"h-4 w-px bg-blue-300"}),r.jsxs("span",{className:"modal-value text-blue-700 font-semibold",children:["â‚©",Pe.totalFilteredAmount?.toLocaleString()||"0"]})]}):r.jsxs(he,{className:"business-radius-card border border-gray-200 shadow-sm",children:[r.jsx(xe,{className:"pb-3 pt-4 px-4",children:r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full"}),r.jsx(ge,{className:"section-title text-gray-800",children:"ì›”ë³„ ë°œì£¼ìš”ì²­ ì´ì•¡"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("span",{className:"badge-text text-gray-600",children:["(",Pe.months?.reduce((e,a)=>e+a.count,0)||0,"ê±´)"]}),r.jsx("div",{className:"h-4 w-px bg-gray-300"}),r.jsxs("span",{className:"modal-value text-gray-500 font-bold",children:["â‚©",Pe.totalFilteredAmount?.toLocaleString()||"0"]})]})]})}),r.jsx(ye,{className:"px-4 pb-4",children:r.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:Pe.months?.map(e=>r.jsx("div",{className:"bg-gray-50 business-radius-card px-3 py-1.5 border border-gray-200 hover:border-blue-300 hover:bg-blue-50 transition-all flex-shrink-0",children:r.jsxs("div",{className:"flex items-baseline gap-1.5",children:[r.jsxs("span",{className:"modal-value font-bold text-gray-800 whitespace-nowrap",children:[e.month,"ì›”"]}),r.jsxs("span",{className:"text-[9px] text-gray-500 whitespace-nowrap",children:["(",e.count,")"]}),r.jsxs("span",{className:"modal-value text-gray-500 font-bold whitespace-nowrap ml-1",children:["â‚©",e.total.toLocaleString()]})]})},e.monthStr))})})]})}),r.jsx(he,{className:"overflow-hidden border border-gray-200 w-full max-w-full",children:r.jsx(ye,{className:"p-0",children:A?r.jsxs("div",{className:"flex items-center justify-center py-12",children:[r.jsx("div",{className:"w-8 h-8 border-2 border-hansl-500 border-t-transparent rounded-full animate-spin"}),r.jsx("span",{className:"ml-3 card-subtitle",children:"ë¡œë”© ì¤‘..."})]}):0===$e.length?r.jsxs("div",{className:"text-center py-12",children:[r.jsx(u,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"ë°œì£¼ìš”ì²­ì„œê°€ ì—†ìŠµë‹ˆë‹¤"}),r.jsx("p",{className:"card-subtitle",children:"ìƒˆë¡œìš´ ë°œì£¼ìš”ì²­ì„œë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”."})]}):r.jsx(ra,{purchases:$e,activeTab:ue,currentUserRoles:ee,onRefresh:ne,onOptimisticUpdate:ie,onPaymentComplete:Ie,onReceiptComplete:Te,columnVisibility:Z})})})]}),Fe&&r.jsx(a.Suspense,{fallback:r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"})}),children:r.jsx(ua,{isOpen:v,onClose:()=>{k(!1),m(null)},purchase:Fe,isAdmin:ce||!1,onUpdate:ne,activeTab:ue})}),r.jsx(Y,{isOpen:C,onClose:()=>{q(!1),window.location.reload()},purchases:ke,currentUserName:ae})]})}function xa(){return r.jsxs("div",{className:"w-full",children:[r.jsxs("div",{className:"mb-4",children:[r.jsx("h1",{className:"page-title",children:"ì¹´ë“œì‚¬ìš© ê´€ë¦¬"}),r.jsx("p",{className:"page-subtitle",style:{marginTop:"-2px",marginBottom:"-4px"},children:"Card Usage Management"})]}),r.jsxs("div",{className:"business-radius-card border border-gray-200 bg-white p-8 text-center",children:[r.jsx("p",{className:"section-title text-gray-700",children:"ì¹´ë“œì‚¬ìš© íƒ­ ì¤€ë¹„ ì¤‘"}),r.jsx("p",{className:"card-subtitle mt-1",children:"ì¹´ë“œì‚¬ìš© ì „ìš© ëª©ë¡/í•„í„°/ìƒì„¸ ê¸°ëŠ¥ì„ ì´ íƒ­ì— ë¶„ë¦¬ êµ¬í˜„í•©ë‹ˆë‹¤."})]})]})}function ga(){return r.jsxs("div",{className:"w-full",children:[r.jsxs("div",{className:"mb-4",children:[r.jsx("h1",{className:"page-title",children:"ì¶œì¥ ê´€ë¦¬"}),r.jsx("p",{className:"page-subtitle",style:{marginTop:"-2px",marginBottom:"-4px"},children:"Business Trip Management"})]}),r.jsxs("div",{className:"business-radius-card border border-gray-200 bg-white p-8 text-center",children:[r.jsx("p",{className:"section-title text-gray-700",children:"ì¶œì¥ íƒ­ ì¤€ë¹„ ì¤‘"}),r.jsx("p",{className:"card-subtitle mt-1",children:"ì¶œì¥ ì „ìš© ëª©ë¡/ê²°ì¬/ì •ì‚° ê¸°ëŠ¥ì„ ì´ íƒ­ì— ë¶„ë¦¬ êµ¬í˜„í•©ë‹ˆë‹¤."})]})]})}function ya(){return r.jsxs("div",{className:"w-full",children:[r.jsxs("div",{className:"mb-4",children:[r.jsx("h1",{className:"page-title",children:"ì°¨ëŸ‰ ê´€ë¦¬"}),r.jsx("p",{className:"page-subtitle",style:{marginTop:"-2px",marginBottom:"-4px"},children:"Vehicle Management"})]}),r.jsxs("div",{className:"business-radius-card border border-gray-200 bg-white p-8 text-center",children:[r.jsx("p",{className:"section-title text-gray-700",children:"ì°¨ëŸ‰ íƒ­ ì¤€ë¹„ ì¤‘"}),r.jsx("p",{className:"card-subtitle mt-1",children:"ì°¨ëŸ‰ì‚¬ìš© ì „ìš© ëª©ë¡/ë°°ì°¨/ìŠ¹ì¸ ê¸°ëŠ¥ì„ ì´ íƒ­ì— ë¶„ë¦¬ êµ¬í˜„í•©ë‹ˆë‹¤."})]})]})}const ba=[{key:"ë°œì£¼/êµ¬ë§¤",label:"ë°œì£¼/êµ¬ë§¤"},{key:"ì¹´ë“œì‚¬ìš©",label:"ì¹´ë“œì‚¬ìš©"},{key:"ì¶œì¥",label:"ì¶œì¥"},{key:"ì°¨ëŸ‰",label:"ì°¨ëŸ‰"}];function _a({showEmailButton:e=!0}){const[t,s]=a.useState("ë°œì£¼/êµ¬ë§¤");return r.jsxs("div",{className:"w-full",children:[r.jsx("div",{className:"flex space-x-6 border-b border-gray-200 mb-4",children:ba.map(e=>r.jsxs("button",{onClick:()=>s(e.key),className:"pb-2 text-xs font-medium transition-colors relative "+(t===e.key?"text-hansl-600":"text-gray-400 hover:text-gray-600"),children:[e.label,t===e.key&&r.jsx("span",{className:"absolute bottom-0 left-0 right-0 h-[2px] bg-hansl-600 rounded-full"})]},e.key))}),"ë°œì£¼/êµ¬ë§¤"===t&&r.jsx(ha,{showEmailButton:e}),"ì¹´ë“œì‚¬ìš©"===t&&r.jsx(xa,{}),"ì¶œì¥"===t&&r.jsx(ga,{}),"ì°¨ëŸ‰"===t&&r.jsx(ya,{})]})}export{_a as default};
//# sourceMappingURL=RequestListMain-CsfH8N6e.js.map
