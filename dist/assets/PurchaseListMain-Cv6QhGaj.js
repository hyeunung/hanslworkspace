const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FastPurchaseTable-BXP_hR0W.js","assets/index-d-YGDSGA.js","assets/index-DwAX_oWx.css","assets/index-CNk7Iw9X.js","assets/PurchaseDetailModal-xl6QxeOk.js","assets/helpers-rpoH-KHf.js","assets/useConfirmDateAction-MX0CpOAp.js","assets/calendar-D_-CL7g0.js","assets/eye-Cq2s9kwQ.js","assets/chevron-down-BzEf6ksk.js","assets/popover-MjWsbupH.js","assets/input-DMm87VL4.js","assets/dialog-Nk2I26Sn.js","assets/calendar-kz-_ZBo8.js","assets/package-B6K8jaOK.js","assets/credit-card-DHNLn2OS.js","assets/trash-2-Dw_COKQZ.js","assets/plus-BpYcF9KC.js","assets/pen-iHq7KMaq.js","assets/save-a4_aInh3.js","assets/PurchaseItemsModal-DfqcWyqg.js"])))=>i.map(i=>d[i]);
import{c as e,r as a,a as t,l as s,j as r,_ as l,B as n,X as i,U as c,C as d,u as o,e as u}from"./index-d-YGDSGA.js";import{t as m,B as h}from"./index-CNk7Iw9X.js";import{f as x}from"./helpers-rpoH-KHf.js";import{A as p,a as b}from"./arrow-up-Cv7fCtQG.js";import{I as g}from"./input-DMm87VL4.js";import{P as y,a as f,b as v}from"./popover-MjWsbupH.js";import{S as _,a as j,b as N,c as w,d as C}from"./select-Besjo4l_.js";import{C as k,f as S,a as M}from"./calendar-D_-CL7g0.js";import{C as L,a as D,b as T,c as q,d as R}from"./command-8C0pCrf1.js";import{C as $}from"./calendar-kz-_ZBo8.js";import{P as F}from"./package-B6K8jaOK.js";import{C as z,a as P}from"./chevron-down-BzEf6ksk.js";import{S as E,C as I,c as O}from"./card-CzDHbIHw.js";import{R as U}from"./rotate-ccw-badpKUz-.js";import{T as A}from"./triangle-alert-BSqK_HxW.js";import{E as B}from"./eye-Cq2s9kwQ.js";import{P as Y}from"./plus-BpYcF9KC.js";
/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=e("building",[["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3",key:"cabbwy"}],["rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",key:"1uxh74"}]]),V=e("dollar-sign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),H=e("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),K=e("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),J=e("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),G=e("sliders-vertical",[["line",{x1:"4",x2:"4",y1:"21",y2:"14",key:"1p332r"}],["line",{x1:"4",x2:"4",y1:"10",y2:"3",key:"gb41h5"}],["line",{x1:"12",x2:"12",y1:"21",y2:"12",key:"hf2csr"}],["line",{x1:"12",x2:"12",y1:"8",y2:"3",key:"1kfi7u"}],["line",{x1:"20",x2:"20",y1:"21",y2:"16",key:"1lhrwl"}],["line",{x1:"20",x2:"20",y1:"12",y2:"3",key:"16vvfq"}],["line",{x1:"2",x2:"6",y1:"14",y2:"14",key:"1uebub"}],["line",{x1:"10",x2:"14",y1:"8",y2:"8",key:"1yglbp"}],["line",{x1:"18",x2:"22",y1:"16",y2:"16",key:"1jxqpz"}]]),Q=e("table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]),X=e("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),Z={purchases:null,lastFetch:0,userInfo:null,CACHE_DURATION:3e5,filteredData:new Map,FILTER_CACHE_DURATION:3e4},ee=e=>{Z.filteredData.clear()},ae=[{key:"30d",label:"ìµœê·¼ 30ì¼",days:30,description:"ìµœê·¼ 30ì¼ê°„ ë°ì´í„°"},{key:"90d",label:"ìµœê·¼ 90ì¼",days:90,description:"ìµœê·¼ 90ì¼ê°„ ë°ì´í„°"},{key:"180d",label:"ìµœê·¼ 180ì¼",days:180,description:"ìµœê·¼ 180ì¼ê°„ ë°ì´í„°"},{key:"all",label:"ì „ì²´",days:null,description:"ëª¨ë“  ë°ì´í„°"}],te=["ì •í¬ì›…"],se=(e,s,r,l,n)=>{t();const[i,c]=a.useState("pending"),[d,o]=a.useState(""),u=((e="30d")=>{const[t,s]=a.useState(e),r=a.useMemo(()=>ae.find(e=>e.key===t)||ae[0],[t]),l=a.useCallback(()=>{const e=ae.findIndex(e=>e.key===t)+1;return e<ae.length?ae[e]:null},[t]),n=a.useCallback(()=>r.days?new Date((new Date).getTime()-24*r.days*60*60*1e3).toISOString().split("T")[0]:null,[r]),i=a.useCallback(e=>{s(e.key)},[]),c=a.useMemo(()=>null!==l(),[l]),d=a.useMemo(()=>null===r.days,[r]),o=a.useCallback((e,a)=>d?`ì´ ${e.toLocaleString()}ê°œ`:e===a?`${r.label} (${a.toLocaleString()}ê°œ)`:`${r.label} (${a.toLocaleString()}ê°œ / ì „ì²´ ${e.toLocaleString()}ê°œ+)`,[r,d]);return{currentLimit:r,setDateLimit:i,getNextLimit:l,hasNextLimit:c,isFullyLoaded:d,getDateThreshold:n,getTotalCountMessage:o}})("done"===i?"30d":"all"),m=s?.includes("app_admin");s?.includes("final_approver"),s?.includes("middle_manager");const h=s?.includes("purchase_manager"),x=s?.includes("raw_material_manager")||s?.includes("consumable_manager")||s?.includes("purchase_manager"),p=s?.includes("hr"),b=a.useMemo(()=>s&&0!==s.length?h?2:s.some(e=>["middle_manager","final_approver","app_admin","ceo"].includes(e))?3:1:1,[s,h]),g=a.useCallback(e=>{if(!r)return"all";if("purchase"===e)return x||p||m?"all":r;if("receipt"===e)return x||p||m?"all":r;switch(b){case 1:case 2:return"done"===e?"all":r;case 3:return"all";default:return r}},[r,b,x,p,m]);a.useEffect(()=>{if(!r)return;const e=g(i);o(e),"done"===i?u.setDateLimit(ae[0]):u.setDateLimit(ae[3])},[i,r,b,g,u]);const y=a.useMemo(()=>s.includes("purchase_manager")||s.includes("app_admin")?e:e.filter(e=>!te.includes(e.requester_name)),[e,s]),f=a.useMemo(()=>{if("done"!==i)return y;const e=u.getDateThreshold();return((e,a)=>a?e.filter(e=>{const t=e.request_date?.split("T")[0];return t&&t>=a}):e)(y,e)},[y,i,u]),v=a.useMemo(()=>{(new Date).toISOString().split("T")[0];return f.filter(e=>{let a=!1;switch(i){case"pending":const t=["pending","ëŒ€ê¸°","",null,void 0].includes(e.middle_manager_status),s=["pending","ëŒ€ê¸°","",null,void 0].includes(e.final_manager_status),r="rejected"===e.middle_manager_status,l="rejected"===e.final_manager_status;if(r||l)return!1;const n="approved"===e.middle_manager_status,i="approved"===e.final_manager_status;return(!n||!i)&&(a=t||s,a);case"purchase":{const t="êµ¬ë§¤ ìš”ì²­"===e.payment_category,s=(e.progress_type||"").includes("ì„ ì§„í–‰"),r=(e.progress_type||"").includes("ì¼ë°˜"),l="approved"===e.final_manager_status;return!e.is_payment_completed&&(a=!!t&&(s||r&&l),a)}case"receipt":{const t=(e.progress_type||"").includes("ì„ ì§„í–‰"),s="approved"===e.final_manager_status;return!e.is_received&&(a=t||s,a)}case"done":return a=!0,a;default:return!0}})},[f,i]),_=a.useMemo(()=>{let e;return e=d&&"all"!==d&&"ì „ì²´"!==d?v.filter(e=>e.requester_name===d):v,e},[v,d]),j=a.useMemo(()=>[..._].sort((e,a)=>{const t=e.request_date?new Date(e.request_date).getTime():0;return(a.request_date?new Date(a.request_date).getTime():0)-t}),[_]),N=a.useMemo(()=>{const e=y,a=e=>new Set(e.map(e=>e.purchase_order_number)).size,t=a=>{if("purchase"===a)return x||p||m?e:e.filter(e=>e.requester_name===r);if("receipt"===a)return x||p||m?e:e.filter(e=>e.requester_name===r);const t=g(a);return"all"===t||"ì „ì²´"===t?e:e.filter(e=>e.requester_name===t)},s=t("pending"),l=t("purchase"),n=t("receipt"),i=t("done"),c=s.filter(e=>{(new Date).toISOString().split("T")[0];const a=["pending","ëŒ€ê¸°","",null,void 0].includes(e.middle_manager_status),t=["pending","ëŒ€ê¸°","",null,void 0].includes(e.final_manager_status),s="rejected"===e.middle_manager_status,r="rejected"===e.final_manager_status;if(s||r)return!1;const l="approved"===e.middle_manager_status,n="approved"===e.final_manager_status;return(!l||!n)&&(a||t)}),d=l.filter(e=>{(new Date).toISOString().split("T")[0];const a="êµ¬ë§¤ ìš”ì²­"===e.payment_category,t=(e.progress_type||"").includes("ì„ ì§„í–‰"),s=(e.progress_type||"").includes("ì¼ë°˜"),r="approved"===e.final_manager_status;return!e.is_payment_completed&&(!!a&&(t||s&&r))}),o=n.filter(e=>{(new Date).toISOString().split("T")[0];const a=(e.progress_type||"").includes("ì„ ì§„í–‰"),t="approved"===e.final_manager_status;return!e.is_received&&(a||t)});return{pending:a(c),purchase:a(d),receipt:a(o),done:a(i)}},[y,b,r,g,x,p,m]);return{activeTab:i,selectedEmployee:d,setActiveTab:c,setSelectedEmployee:o,filteredPurchases:j,tabCounts:N,dateLimit:u,totalDataCount:y.length,displayedDataCount:f.length}},re=a.lazy(()=>l(()=>import("./FastPurchaseTable-BXP_hR0W.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]))),le=a.memo(()=>r.jsx("div",{className:"p-4 space-y-4",children:[...Array(5)].map((e,a)=>r.jsxs("div",{className:"flex space-x-4 animate-pulse",children:[r.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),r.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),r.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),r.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"})]},a))}));le.displayName="TableSkeleton";const ne=a.memo(({purchases:e,activeTab:t,currentUserRoles:s,onRefresh:l,onOptimisticUpdate:n,onPaymentComplete:i,onReceiptComplete:c})=>r.jsx(a.Suspense,{fallback:r.jsx(le,{}),children:r.jsx(re,{purchases:e,activeTab:t,currentUserRoles:s,onRefresh:l,onOptimisticUpdate:n,onPaymentComplete:i,onReceiptComplete:c})}));ne.displayName="LazyPurchaseTable";const ie=a.memo(({index:e,style:t,data:s})=>{const{purchases:l,activeTab:n,currentUserRoles:i,onPaymentComplete:c,onReceiptComplete:d}=s,o=l[e];i?.includes("app_admin");const u=i?.includes("raw_material_manager")||i?.includes("consumable_manager")||i?.includes("purchase_manager"),m=a.useCallback(e=>e.is_received?r.jsx(h,{className:"badge-success",children:"ì…ê³ ì™„ë£Œ"}):"approved"===e.middle_manager_status&&"approved"===e.final_manager_status?r.jsx(h,{className:"badge-primary",children:"êµ¬ë§¤ì§„í–‰"}):"rejected"===e.middle_manager_status||"rejected"===e.final_manager_status?r.jsx(h,{className:"badge-danger",children:"ë°˜ë ¤"}):r.jsx(h,{className:"badge-warning",children:"ìŠ¹ì¸ëŒ€ê¸°"}),[]),p=a.useCallback(e=>e?["KRW","ì›","â‚©"].includes(e)?"â‚©":["USD","$","ë‹¬ëŸ¬"].includes(e)?"$":e:"â‚©",[]),b=a.useCallback((e,a="KRW")=>`${p(a)}${e.toLocaleString()}`,[p]);return o?r.jsxs("div",{style:t,className:"flex items-center border-b border-gray-100 hover:bg-gray-50 transition-colors px-4",children:[r.jsxs("div",{className:"w-32 min-w-[128px] flex-shrink-0",children:[r.jsx("div",{className:"card-title truncate",children:o.purchase_order_number}),r.jsxs("div",{className:"card-description",children:[o.items?.length||1,"ê°œ í’ˆëª©"]})]}),r.jsx("div",{className:"w-20 min-w-[80px] flex-shrink-0",children:r.jsx("div",{className:"card-subtitle truncate",children:o.requester_name})}),r.jsx("div",{className:"w-28 min-w-[112px] flex-shrink-0",children:r.jsx("div",{className:"card-subtitle truncate",children:o.vendor_name})}),r.jsx("div",{className:"w-32 min-w-[128px] flex-shrink-0",children:r.jsx("div",{className:"card-description truncate",children:o.item_name})}),r.jsx("div",{className:"w-40 min-w-[160px] flex-shrink-0",children:r.jsx("div",{className:"card-description truncate",children:o.specification})}),r.jsx("div",{className:"w-16 min-w-[64px] flex-shrink-0 text-center",children:r.jsx("div",{className:"card-description",children:o.quantity?.toLocaleString()||0})}),r.jsx("div",{className:"w-24 min-w-[96px] flex-shrink-0 text-right",children:r.jsx("div",{className:"card-amount",children:b(o.unit_price_value||0,o.currency)})}),r.jsx("div",{className:"w-24 min-w-[96px] flex-shrink-0 text-right",children:r.jsx("div",{className:"card-amount-large",children:b(o.total_amount||0,o.currency)})}),r.jsx("div",{className:"w-20 min-w-[80px] flex-shrink-0",children:r.jsx("div",{className:"card-date",children:x(o.request_date)})}),r.jsx("div",{className:"w-20 min-w-[80px] flex-shrink-0 text-center",children:m(o)}),r.jsxs("div",{className:"w-24 min-w-[96px] flex-shrink-0 flex gap-1",children:["purchase"===n&&u&&!o.is_payment_completed&&r.jsx("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),c?.(o.id)},className:"button-base bg-green-500 hover:bg-green-600 text-white",title:"êµ¬ë§¤ì™„ë£Œ",children:"êµ¬ë§¤"}),"receipt"===n&&u&&!o.is_received&&r.jsx("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),d?.(o.id)},className:"button-base bg-blue-500 hover:bg-blue-600 text-white",title:"ì…ê³ ì™„ë£Œ",children:"ì…ê³ "})]})]}):r.jsx("div",{style:t,className:"flex items-center justify-center",children:r.jsx("div",{className:"card-description",children:"ë°ì´í„° ì—†ìŒ"})})});ie.displayName="VirtualizedTableRow";const ce=a.memo(()=>r.jsxs("div",{className:"flex items-center bg-gray-50 border-b-2 border-gray-200 px-4 py-3 text-sm font-medium text-gray-700",children:[r.jsx("div",{className:"w-32 min-w-[128px] flex-shrink-0",children:"ë°œì£¼ë²ˆí˜¸"}),r.jsx("div",{className:"w-20 min-w-[80px] flex-shrink-0",children:"ìš”ì²­ì"}),r.jsx("div",{className:"w-28 min-w-[112px] flex-shrink-0",children:"ì—…ì²´ëª…"}),r.jsx("div",{className:"w-32 min-w-[128px] flex-shrink-0",children:"í’ˆëª©ëª…"}),r.jsx("div",{className:"w-40 min-w-[160px] flex-shrink-0",children:"ê·œê²©"}),r.jsx("div",{className:"w-16 min-w-[64px] flex-shrink-0 text-center",children:"ìˆ˜ëŸ‰"}),r.jsx("div",{className:"w-24 min-w-[96px] flex-shrink-0 text-right",children:"ë‹¨ê°€"}),r.jsx("div",{className:"w-24 min-w-[96px] flex-shrink-0 text-right",children:"ì´ì•¡"}),r.jsx("div",{className:"w-20 min-w-[80px] flex-shrink-0",children:"ìš”ì²­ì¼"}),r.jsx("div",{className:"w-20 min-w-[80px] flex-shrink-0 text-center",children:"ìƒíƒœ"}),r.jsx("div",{className:"w-24 min-w-[96px] flex-shrink-0 text-center",children:"ì•¡ì…˜"})]}));ce.displayName="VirtualizedTableHeader";const de=a.forwardRef(({purchases:e,activeTab:t,currentUserRoles:s,onRefresh:l,onOptimisticUpdate:n,onPaymentComplete:i,onReceiptComplete:c,height:d=600,itemHeight:o=64,overscanCount:u=10,className:m=""},h)=>{const x=a.useRef(null);a.useImperativeHandle(h,()=>({scrollToItem:(e,a="auto")=>{x.current?.scrollToItem(e,a)},scrollToTop:()=>{x.current?.scrollToItem(0,"start")},scrollToBottom:()=>{x.current?.scrollToItem(e.length-1,"end")}}),[e.length]);const p=a.useMemo(()=>({purchases:e,activeTab:t,currentUserRoles:s,onPaymentComplete:i,onReceiptComplete:c}),[e,t,s,i,c]),b=a.useCallback(({scrollOffset:e,scrollDirection:a})=>{},[e.length]);return r.jsxs("div",{className:`${m}`,children:[r.jsx(ce,{}),r.jsx("div",{className:"border border-gray-200 rounded-b-lg overflow-hidden",children:0===e.length?r.jsx("div",{className:"flex items-center justify-center py-12",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx("span",{className:"text-gray-400",children:"ğŸ“„"})}),r.jsx("div",{className:"card-subtitle",children:"í‘œì‹œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤"})]})}):r.jsx(void 0,{ref:x,height:d,itemCount:e.length,itemSize:o,itemData:p,overscanCount:u,onScroll:b,className:"virtualized-table-list",children:ie})}),!1]})});de.displayName="VirtualizedPurchaseTable";const oe=a.memo(({purchases:e,activeTab:t,currentUserRoles:l,onRefresh:i,onOptimisticUpdate:c,onPaymentComplete:d,onReceiptComplete:o,virtualizationThreshold:u=200,forceVirtualization:m=!1,forceTraditional:h=!1,virtualizedHeight:x=600})=>{const b=a.useRef(null),g=a.useMemo(()=>{if(h)return!1;if(m)return!0;const a=e.length>=u;return a&&s.info("ê°€ìƒí™” í…Œì´ë¸” í™œì„±í™”",{itemCount:e.length,threshold:u,activeTab:t}),a},[e.length,u,m,h,t]),y=a.useMemo(()=>{const a=e.length;return{itemCount:a,estimatedMemoryMB:g?Math.ceil(.001*a):Math.ceil(.1*a),estimatedRenderTime:g?"< 100ms":a>500?"> 1s":"< 500ms",mode:g?"virtualized":"traditional"}},[e.length,g]);return r.jsxs("div",{className:"space-y-3",children:[e.length>100&&r.jsxs("div",{className:"flex items-center justify-between bg-blue-50 border border-blue-200 rounded-lg p-3",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[g?r.jsx(X,{className:"w-4 h-4 text-blue-500"}):r.jsx(Q,{className:"w-4 h-4 text-blue-500"}),r.jsxs("div",{className:"text-sm",children:[r.jsx("div",{className:"font-medium text-blue-800",children:g?"ğŸš€ ê³ ì„±ëŠ¥ ê°€ìƒí™” ëª¨ë“œ":"ğŸ“‹ í‘œì¤€ í…Œì´ë¸” ëª¨ë“œ"}),r.jsxs("div",{className:"text-blue-600 text-xs mt-1",children:[y.itemCount.toLocaleString(),"ê°œ í•­ëª© â€¢ ì˜ˆìƒ ë©”ëª¨ë¦¬: ",y.estimatedMemoryMB,"MB â€¢ ë Œë”ë§: ",y.estimatedRenderTime]})]})]}),g&&e.length>20&&r.jsxs(n,{onClick:()=>{g?b.current?.scrollToTop():window.scrollTo({top:0,behavior:"smooth"})},className:"button-base border border-blue-300 bg-white text-blue-600 hover:bg-blue-50",children:[r.jsx(p,{className:"w-4 h-4 mr-1"}),"ë§¨ìœ„ë¡œ"]})]}),g?r.jsx(de,{ref:b,purchases:e,activeTab:t,currentUserRoles:l,onRefresh:i,onOptimisticUpdate:c,onPaymentComplete:d,onReceiptComplete:o,height:x,itemHeight:64,overscanCount:10,className:"border border-gray-200 rounded-lg overflow-hidden"}):r.jsx(ne,{purchases:e,activeTab:t,currentUserRoles:l,onRefresh:i,onOptimisticUpdate:c,onPaymentComplete:d,onReceiptComplete:o}),e.length>1e3&&!g&&r.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(X,{className:"w-5 h-5 text-yellow-500 flex-shrink-0 mt-0.5"}),r.jsxs("div",{className:"text-sm",children:[r.jsx("div",{className:"font-medium text-yellow-800 mb-1",children:"ì„±ëŠ¥ ìµœì í™” ê¶Œì¥"}),r.jsxs("div",{className:"text-yellow-700",children:[e.length.toLocaleString(),"ê°œì˜ í•­ëª©ì´ ìˆìŠµë‹ˆë‹¤. ë” ë‚˜ì€ ì„±ëŠ¥ì„ ìœ„í•´ í•„í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ê²°ê³¼ë¥¼ ì¤„ì´ê±°ë‚˜ ê°€ìƒí™” ëª¨ë“œë¥¼ í™œì„±í™”í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤."]})]})]})}),!1]})});oe.displayName="AdaptiveTableWrapper";const ue=[{key:"date_range",label:"ê¸°ê°„ë³„",type:"date_range",icon:$,category:"ë‚ ì§œ"},{key:"date_month",label:"ì›”ë³„",type:"date_month",icon:$,category:"ë‚ ì§œ"},{key:"requester_name",label:"ìš”ì²­ì",type:"searchable_select",icon:c,category:"ì‚¬ìš©ì"},{key:"vendor_name",label:"ì—…ì²´",type:"searchable_select",icon:W,category:"ì‚¬ìš©ì"},{key:"contact_name",label:"ë‹´ë‹¹ì",type:"searchable_select",icon:c,category:"ì‚¬ìš©ì"},{key:"purchase_order_number",label:"ë°œì£¼ë²ˆí˜¸",type:"text",icon:F,category:"í…ìŠ¤íŠ¸"},{key:"item_name",label:"í’ˆëª…",type:"text",icon:F,category:"í…ìŠ¤íŠ¸"},{key:"specification",label:"ê·œê²©",type:"text",icon:F,category:"í…ìŠ¤íŠ¸"},{key:"remark",label:"ë¹„ê³ ",type:"text",icon:F,category:"í…ìŠ¤íŠ¸"},{key:"project_vendor",label:"PJì—…ì²´",type:"text",icon:W,category:"í…ìŠ¤íŠ¸"},{key:"project_item",label:"PJ ITEM",type:"text",icon:F,category:"í…ìŠ¤íŠ¸"},{key:"sales_order_number",label:"ìˆ˜ì£¼ë²ˆí˜¸",type:"text",icon:F,category:"í…ìŠ¤íŠ¸"},{key:"quantity",label:"ìˆ˜ëŸ‰",type:"number",icon:V,category:"ìˆ«ì"},{key:"unit_price_value",label:"ë‹¨ê°€",type:"number",icon:V,category:"ìˆ«ì"},{key:"total_amount",label:"í•©ê³„",type:"number",icon:V,category:"ìˆ«ì"},{key:"payment_category",label:"ê²°ì œì¢…ë¥˜",type:"select",icon:k,category:"ìƒíƒœ",options:["í˜„ì¥ê²°ì œ","êµ¬ë§¤ìš”ì²­","ë°œì£¼ìš”ì²­"]},{key:"payment_schedule",label:"ì§€ì¶œì˜ˆì •ì¼",type:"select_with_empty",icon:$,category:"ìƒíƒœ"},{key:"is_payment_completed",label:"êµ¬ë§¤í˜„í™©",type:"select",icon:z,category:"ìƒíƒœ",options:["ëŒ€ê¸°","ì™„ë£Œ"]},{key:"is_received",label:"ì…ê³ í˜„í™©",type:"select",icon:z,category:"ìƒíƒœ",options:["ëŒ€ê¸°","ì™„ë£Œ"]},{key:"is_statement_received",label:"ê±°ë˜ëª…ì„¸ì„œ í™•ì¸",type:"select",icon:z,category:"ìƒíƒœ",options:["ëŒ€ê¸°","ì™„ë£Œ"]},{key:"is_utk_checked",label:"UTK í™•ì¸",type:"select",icon:k,category:"ìƒíƒœ",options:["ëŒ€ê¸°","ì™„ë£Œ"]}],me=[{value:"request_date",label:"ì²­êµ¬ì¼"},{value:"delivery_request_date",label:"ì…ê³ ìš”ì²­ì¼"},{value:"payment_completed_at",label:"êµ¬ë§¤ì™„ë£Œì¼"},{value:"received_at",label:"ì…ê³ ì™„ë£Œì¼"},{value:"created_at",label:"ìƒì„±ì¼"},{value:"statement_received_at",label:"ê±°ë˜ëª…ì„¸ì„œì…ê³ ì¼"}],he=[{value:"request_date",label:"ìš”ì²­ì¼"},{value:"purchase_order_number",label:"ë°œì£¼ë²ˆí˜¸"},{value:"vendor_name",label:"ì—…ì²´ëª…"},{value:"requester_name",label:"ìš”ì²­ì"},{value:"total_amount",label:"í•©ê³„"},{value:"delivery_request_date",label:"ì…ê³ ìš”ì²­ì¼"},{value:"created_at",label:"ìƒì„±ì¼"}];function xe({activeFilters:e,sortConfig:t,searchTerm:s,onFiltersChange:l,onSortChange:c,onSearchChange:d,availableEmployees:o=[],availableVendors:u=[],availableContacts:m=[],availablePaymentSchedules:x=[]}){const[p,k]=a.useState(!1),[F,P]=a.useState(!1),[I,O]=a.useState(!1),[U,A]=a.useState({}),[B,Y]=a.useState(!1),[W,V]=a.useState(!1),[H,K]=a.useState({}),[J,Q]=a.useState(),[X,Z]=a.useState({}),[ee,ae]=a.useState({}),te=a.useRef(null);a.useEffect(()=>{I&&te.current&&te.current.focus()},[I]),a.useEffect(()=>{F&&ae({field:t?.field||"",direction:t?.direction||"asc"})},[F,t]);const se=a=>{l(e.filter(e=>e.id!==a))},re=()=>{const e=ue.find(e=>e.key===U.field);if(!e)return null;switch(e.type){case"text":return r.jsx(g,{placeholder:"ê°’ ì…ë ¥",value:U.value||"",onChange:e=>A(a=>({...a,value:e.target.value})),className:"w-full business-radius-input border border-gray-300 bg-white text-gray-700 card-description h-auto",style:{padding:"2px 10px",fontSize:"10px",fontWeight:"500"}});case"number":return r.jsx(g,{type:"number",placeholder:"ìˆ«ì ì…ë ¥",value:U.value||"",onChange:e=>A(a=>({...a,value:e.target.value})),className:"w-full business-radius-input border border-gray-300 bg-white text-gray-700 card-description h-auto",style:{padding:"2px 10px",fontSize:"10px",fontWeight:"500"}});case"searchable_select":let a=[],t="ì„ íƒ";return"requester_name"===e.key?(a=o,t="ìš”ì²­ì"):"vendor_name"===e.key?(a=u,t="ì—…ì²´"):"contact_name"===e.key&&(a=m,t="ë‹´ë‹¹ì"),r.jsxs(y,{children:[r.jsx(f,{asChild:!0,children:r.jsxs(n,{variant:"outline",role:"combobox",className:"w-full button-base business-radius-button border border-gray-300 bg-white text-gray-700 justify-between [&>svg]:hidden",children:[r.jsx("span",{className:"truncate text-left",style:{fontSize:"12px",fontWeight:"500"},children:U.value||t}),r.jsx(E,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),r.jsx(v,{className:"w-[200px] p-0 border-0 shadow-lg",align:"start",children:r.jsxs(L,{className:"border-0",children:[r.jsx(D,{placeholder:`${t} ê²€ìƒ‰...`,className:"h-auto border-0 focus:ring-0 focus:outline-none card-description placeholder:card-description",style:{padding:"2px 10px"}}),r.jsxs(T,{children:[t,"ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."]}),r.jsx(q,{className:"max-h-[200px] overflow-y-auto",children:a.map(e=>r.jsxs(R,{value:e,onSelect:e=>{A(a=>({...a,value:e}))},className:"cursor-pointer",children:[r.jsx(z,{className:"mr-2 h-3 w-3 "+(U.value===e?"opacity-100":"opacity-0")}),r.jsx("span",{className:"card-description",children:e})]},e))})]})})]});case"select":return r.jsxs(_,{value:U.value||"",onValueChange:e=>A(a=>({...a,value:e})),children:[r.jsx(j,{className:"button-base business-radius-button border border-gray-300 bg-white text-gray-700 [&>svg]:hidden text-center",children:r.jsx(N,{placeholder:"ì„ íƒ"})}),r.jsx(w,{children:e.options?.map(e=>r.jsx(C,{value:e,children:r.jsx("span",{className:"card-description",children:e})},e))})]});case"select_with_empty":const s=["ê³µë€",...x];return r.jsxs(_,{value:U.value||"",onValueChange:e=>A(a=>({...a,value:e})),children:[r.jsx(j,{className:"button-base business-radius-button border border-gray-300 bg-white text-gray-700 [&>svg]:hidden text-center",children:r.jsx(N,{placeholder:"ì§€ì¶œì˜ˆì •ì¼"})}),r.jsx(w,{children:s.map(e=>r.jsx(C,{value:e,children:r.jsx("span",{className:"card-description",children:e})},e))})]});case"date_range":return r.jsxs(y,{open:B,onOpenChange:e=>{if(e)if(U.value)if(U.value.includes("~")){const[e,a]=U.value.split("~");K({from:new Date(e),to:new Date(a)})}else K({from:new Date(U.value),to:void 0});else K({});Y(e)},children:[r.jsx(f,{asChild:!0,children:r.jsx(n,{variant:"outline",className:"w-full button-base business-radius-button border border-gray-300 bg-white text-gray-700 justify-between h-auto",children:r.jsxs("div",{className:"flex items-center gap-1.5 min-h-[32px]",children:[r.jsx($,{className:"w-3 h-3 flex-shrink-0"}),r.jsx("span",{className:"card-description leading-tight whitespace-pre-line",children:U.value?(()=>{if(U.value.includes("~")){const[e,a]=U.value.split("~");return`${S(new Date(e),"yy/MM/dd")}\n~ ${S(new Date(a),"yy/MM/dd")}`}return S(new Date(U.value),"yy/MM/dd")})():"ë‚ ì§œ ì„ íƒ"})]})})}),r.jsx(v,{className:"w-auto p-0",align:"start",children:r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"p-3 pb-0",children:[r.jsx("div",{className:"text-xs font-medium text-gray-600 mb-2",children:"ë‚ ì§œ ë²”ìœ„ ì„ íƒ"}),r.jsx(M,{mode:"range",selected:H,onSelect:e=>{e&&K(e)},numberOfMonths:1,initialFocus:!0,className:"compact-calendar"})]}),r.jsxs("div",{className:"flex gap-2 p-3 pt-0",children:[r.jsx(n,{onClick:()=>{K({}),Y(!1)},variant:"outline",className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 flex-1",children:"ì·¨ì†Œ"}),r.jsx(n,{onClick:()=>{if(H.from){if(H.to){const e=`${S(H.from,"yyyy-MM-dd")}~${S(H.to,"yyyy-MM-dd")}`;A(a=>({...a,value:e}))}else A(e=>({...e,value:S(H.from,"yyyy-MM-dd")}));Y(!1)}},disabled:!H.from,className:"button-base bg-blue-500 text-white hover:bg-blue-600 flex-1",children:"í™•ì¸"})]})]})})]});case"date_month":return r.jsxs(y,{open:W,onOpenChange:e=>{if(e)if(U.value)if(U.value.includes("~")){const[e,a]=U.value.split("~");Z({from:new Date(`${e}-01`),to:new Date(`${a}-01`)})}else Z({from:new Date(`${U.value}-01`),to:void 0});else Z({});V(e)},children:[r.jsx(f,{asChild:!0,children:r.jsx(n,{variant:"outline",className:"w-full button-base business-radius-button border border-gray-300 bg-white text-gray-700 justify-between h-auto",children:r.jsxs("div",{className:"flex items-center gap-1.5",children:[r.jsx($,{className:"w-3 h-3 flex-shrink-0"}),r.jsx("span",{className:"card-description leading-tight whitespace-pre-line",children:U.value?(()=>{if(U.value.includes("~")){const[e,a]=U.value.split("~"),[t,s]=e.split("-"),[r,l]=a.split("-");return`${t.slice(-2)}/${s}\n~ ${r.slice(-2)}/${l}`}{const[e,a]=U.value.split("-");return`${e.slice(-2)}/${a}`}})():"ì›” ì„ íƒ"})]})})}),r.jsx(v,{className:"w-auto p-0",align:"start",children:r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"p-3 pb-0",children:[r.jsx("div",{className:"text-xs font-medium text-gray-600 mb-3",children:"ì›” ì„ íƒ"}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{children:[r.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"ì‹œì‘ ì›” ì„ íƒ"}),r.jsx("div",{className:"mb-3",children:r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx(n,{onClick:()=>{const e=X.from?X.from.getFullYear():(new Date).getFullYear(),a=new Date(e-1,X.from?X.from.getMonth():0,1);Z(e=>({...e,from:a}))},variant:"outline",size:"sm",className:"button-base border border-gray-300 bg-white text-gray-600 hover:bg-gray-50",children:"â€¹"}),r.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[X.from?X.from.getFullYear():(new Date).getFullYear(),"ë…„"]}),r.jsx(n,{onClick:()=>{const e=X.from?X.from.getFullYear():(new Date).getFullYear(),a=new Date(e+1,X.from?X.from.getMonth():0,1);Z(e=>({...e,from:a}))},variant:"outline",size:"sm",className:"button-base border border-gray-300 bg-white text-gray-600 hover:bg-gray-50",children:"â€º"})]})}),r.jsx("div",{className:"grid grid-cols-3 gap-2",children:Array.from({length:12},(e,a)=>{const t=X.from?X.from.getFullYear():(new Date).getFullYear(),s=new Date(t,a,1),l=X.from&&X.from.getFullYear()===t&&X.from.getMonth()===a;return r.jsxs(n,{onClick:()=>{Z(e=>({...e,from:s}))},variant:"outline",className:"button-base text-xs h-8 "+(l?"bg-blue-500 text-white border-blue-500 hover:bg-blue-600":"border-gray-300 bg-white text-gray-700 hover:bg-gray-50"),children:[a+1,"ì›”"]},a)})})]}),X.from&&r.jsxs("div",{children:[r.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"ì¢…ë£Œ ì›” ì„ íƒ (ì„ íƒì‚¬í•­)"}),r.jsx("div",{className:"mb-3",children:r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx(n,{onClick:()=>{const e=X.to?X.to.getFullYear():X.from.getFullYear(),a=new Date(e-1,X.to?X.to.getMonth():11,1);Z(e=>({...e,to:a}))},variant:"outline",size:"sm",className:"button-base border border-gray-300 bg-white text-gray-600 hover:bg-gray-50",children:"â€¹"}),r.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[X.to?X.to.getFullYear():X.from.getFullYear(),"ë…„"]}),r.jsx(n,{onClick:()=>{const e=X.to?X.to.getFullYear():X.from.getFullYear(),a=new Date(e+1,X.to?X.to.getMonth():11,1);Z(e=>({...e,to:a}))},variant:"outline",size:"sm",className:"button-base border border-gray-300 bg-white text-gray-600 hover:bg-gray-50",children:"â€º"})]})}),r.jsx("div",{className:"grid grid-cols-3 gap-2",children:Array.from({length:12},(e,a)=>{const t=X.to?X.to.getFullYear():X.from.getFullYear(),s=new Date(t,a,1),l=X.to&&X.to.getFullYear()===t&&X.to.getMonth()===a,i=s<X.from;return r.jsxs(n,{onClick:()=>{i||Z(e=>({...e,to:s}))},variant:"outline",disabled:i,className:"button-base text-xs h-8 "+(l?"bg-blue-500 text-white border-blue-500 hover:bg-blue-600":i?"border-gray-200 bg-gray-100 text-gray-400 cursor-not-allowed":"border-gray-300 bg-white text-gray-700 hover:bg-gray-50"),children:[a+1,"ì›”"]},a)})}),r.jsx("div",{className:"mt-3",children:r.jsx(n,{onClick:()=>{Z(e=>({...e,to:void 0}))},variant:"outline",size:"sm",className:"button-base border border-gray-300 bg-white text-gray-600 hover:bg-gray-50 text-xs",children:"ì¢…ë£Œ ì›” ì œê±°"})})]})]})]}),r.jsxs("div",{className:"flex gap-2 p-3 pt-0",children:[r.jsx(n,{onClick:()=>{Z({}),V(!1)},variant:"outline",className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 flex-1",children:"ì·¨ì†Œ"}),r.jsx(n,{onClick:()=>{if(X.from){if(X.to){const e=`${S(X.from,"yyyy-MM")}~${S(X.to,"yyyy-MM")}`;A(a=>({...a,value:e}))}else A(e=>({...e,value:S(X.from,"yyyy-MM")}));V(!1)}},disabled:!X.from,className:"button-base bg-blue-500 text-white hover:bg-blue-600 flex-1",children:"í™•ì¸"})]})]})})]});default:return null}};return r.jsxs("div",{className:"w-full space-y-3",children:[r.jsx("div",{className:"flex items-center justify-between",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs(y,{open:p,onOpenChange:k,children:[r.jsx(f,{asChild:!0,children:r.jsxs(n,{variant:"outline",className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50",children:[r.jsx(G,{className:"w-4 h-4 mr-1"}),r.jsx("span",{className:"button-text",children:"í•„í„°"}),e.length>0&&r.jsx(h,{variant:"secondary",className:"ml-1 badge-stats-primary",children:e.length})]})}),r.jsx(v,{className:"w-64 p-3",align:"start",children:r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("h4",{className:"card-title",children:"í•„í„°"}),e.length>0&&r.jsx(n,{variant:"ghost",onClick:()=>{l([]),k(!1)},className:"button-base text-red-600 hover:text-red-700 hover:bg-red-50",children:r.jsx("span",{className:"button-text",children:"ëª¨ë‘ ì§€ìš°ê¸°"})})]}),e.length>0&&r.jsxs("div",{className:"space-y-2",children:[e.map(e=>r.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 business-radius",children:[r.jsxs("span",{className:"card-description",children:[e.label,e.dateField&&r.jsxs("span",{className:"text-blue-600",children:["(",me.find(a=>a.value===e.dateField)?.label,")"]}),": ",e.value]}),r.jsx(n,{variant:"ghost",onClick:()=>se(e.id),className:"button-base h-6 w-6 p-0 hover:bg-red-50",children:r.jsx(i,{className:"w-3 h-3"})})]},e.id)),r.jsx("div",{className:"border-t border-gray-200 my-2"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs(_,{onValueChange:e=>{const a=ue.find(a=>a.key===e);if(!a)return;let t="contains";"date_range"!==a.type&&"date_month"!==a.type||(t="equals"),A({id:`${e}_${Date.now()}`,field:e,condition:t,value:"",label:a.label})},children:[r.jsx(j,{className:"button-base business-radius-button border border-gray-300 bg-white text-gray-700 [&>svg]:hidden text-center",children:r.jsx(N,{placeholder:"+ í•„í„° ì¶”ê°€"})}),r.jsx(w,{className:"w-64 max-h-80 overflow-y-auto",style:{scrollbarWidth:"auto",scrollbarColor:"#9ca3af #f3f4f6",WebkitScrollbarWidth:"8px"},children:Object.entries(ue.reduce((e,a)=>(e[a.category]||(e[a.category]=[]),e[a.category].push(a),e),{})).map(([e,a])=>r.jsxs("div",{children:[r.jsx("div",{className:"px-2 py-1 card-description uppercase",children:e}),a.map(e=>r.jsx(C,{value:e.key,children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(e.icon,{className:"w-4 h-4"}),r.jsx("span",{className:"card-description",children:e.label})]})},e.key))]},e))})]}),U.field&&r.jsxs("div",{className:"space-y-2 p-3 border business-radius bg-white",children:[r.jsx("div",{className:"flex items-center gap-2",children:r.jsxs("span",{className:"card-title",children:[U.label," í•„í„°"]})}),"date_range"===U.field||"date_month"===U.field?r.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[r.jsx("div",{className:"flex items-start",children:r.jsxs(_,{value:U.dateField||"",onValueChange:e=>A(a=>({...a,dateField:e})),children:[r.jsx(j,{className:"w-full button-base business-radius-button border border-gray-300 bg-white text-gray-700 [&>svg]:hidden text-center justify-center",children:r.jsx(N,{placeholder:"ë‚ ì§œ í•­ëª©",className:"text-center"})}),r.jsx(w,{children:me.map(e=>r.jsx(C,{value:e.value,children:r.jsx("span",{className:"card-description",children:e.label})},e.value))})]})}),r.jsx("div",{className:"flex items-start",children:re()})]}):r.jsx("div",{children:re()}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(n,{onClick:()=>{const a="date_range"===U.field||"date_month"===U.field,t=a&&!U.dateField;let s=U.condition;if(!s)if(a)s="equals";else{const e=ue.find(e=>e.key===U.field);s="select"===e?.type||"select_with_empty"===e?.type||"searchable_select"===e?.type?"equals":"contains"}if(U.field&&void 0!==s&&""!==U.value&&!t){const a={id:U.id,field:U.field,condition:s,value:U.value,label:U.label,dateField:U.dateField};l([...e,a]),A({}),k(!1)}},disabled:!U.field||""===U.value||("date_range"===U.field||"date_month"===U.field)&&!U.dateField,className:"button-base bg-blue-500 text-white hover:bg-blue-600 flex-1",children:"ì ìš©"}),r.jsx(n,{variant:"outline",onClick:()=>A({}),className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 flex-1",children:"ì·¨ì†Œ"})]})]})]})]})})]}),r.jsxs(y,{open:F,onOpenChange:P,children:[r.jsx(f,{asChild:!0,children:r.jsxs(n,{variant:"outline",className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50",children:[r.jsx(b,{className:"w-4 h-4 mr-1"}),r.jsx("span",{className:"button-text",children:"ì •ë ¬"}),t&&r.jsxs("span",{className:"ml-1 card-description",children:["(","asc"===t.direction?"â†‘":"â†“",")"]})]})}),r.jsx(v,{className:"w-56 p-3",align:"start",children:r.jsxs("div",{className:"space-y-3",children:[r.jsx("h4",{className:"card-title",children:"ì •ë ¬ ì„¤ì •"}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"ì •ë ¬ ê¸°ì¤€"}),r.jsxs(_,{value:ee.field||"",onValueChange:e=>{ae(a=>({...a,field:e}))},children:[r.jsx(j,{className:"button-base business-radius-button border border-gray-300 bg-white text-gray-700 [&>svg]:hidden",children:r.jsx(N,{placeholder:"ì„ íƒí•˜ì„¸ìš”"})}),r.jsx(w,{children:he.map(e=>r.jsx(C,{value:e.value,children:r.jsx("span",{className:"card-description",children:e.label})},e.value))})]})]}),ee.field&&r.jsxs("div",{children:[r.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"ì •ë ¬ ë°©í–¥"}),r.jsxs(_,{value:ee.direction||"",onValueChange:e=>{ae(a=>({...a,direction:e}))},children:[r.jsx(j,{className:"button-base business-radius-button border border-gray-300 bg-white text-gray-700 [&>svg]:hidden",children:r.jsx(N,{placeholder:"ì„ íƒí•˜ì„¸ìš”"})}),r.jsxs(w,{children:[r.jsx(C,{value:"asc",children:r.jsx("span",{className:"card-description",children:"ì˜¤ë¦„ì°¨ìˆœ â†‘"})}),r.jsx(C,{value:"desc",children:r.jsx("span",{className:"card-description",children:"ë‚´ë¦¼ì°¨ìˆœ â†“"})})]})]})]}),r.jsxs("div",{className:"flex gap-2 pt-2",children:[r.jsx(n,{onClick:()=>{if(ee.field&&ee.direction){const e=he.find(e=>e.value===ee.field);e&&c({field:ee.field,direction:ee.direction,label:e.label})}P(!1),ae({})},disabled:!ee.field||!ee.direction,className:"button-base bg-blue-500 hover:bg-blue-600 text-white flex-1",children:"ì ìš©"}),r.jsx(n,{onClick:()=>{c(null),ae({}),P(!1)},className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50",children:"ì´ˆê¸°í™”"})]})]}),t&&r.jsx("div",{className:"border-t pt-2",children:r.jsx(n,{variant:"outline",onClick:()=>c(null),className:"button-base w-full border border-gray-300 text-gray-700",children:r.jsx("span",{className:"button-text",children:"ì •ë ¬ í•´ì œ"})})})]})})]}),r.jsx("div",{className:"flex items-center gap-2",children:I?r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(g,{ref:te,placeholder:"ì „ì²´ ê²€ìƒ‰...",value:s,onChange:e=>d(e.target.value),className:"w-64 business-radius-input button-base border border-gray-300 bg-white text-gray-700"}),r.jsx(n,{variant:"ghost",onClick:()=>{O(!1),d("")},className:"button-base h-8 w-8 p-0",children:r.jsx(i,{className:"w-4 h-4"})})]}):r.jsxs(n,{variant:"outline",onClick:()=>O(!0),className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50",children:[r.jsx(E,{className:"w-4 h-4 mr-1"}),r.jsx("span",{className:"button-text",children:"ê²€ìƒ‰"})]})}),r.jsxs(n,{variant:"outline",onClick:()=>{d(""),l([]),c({field:"created_at",direction:"desc",label:"ìƒì„±ì¼"}),O(!1)},className:"button-base border border-gray-300 bg-white text-blue-600 hover:bg-blue-50 hover:border-blue-300",children:["â†» ",r.jsx("span",{className:"button-text text-blue-600",children:"ì´ˆê¸°í™”"})]})]})}),e.length>0&&r.jsx("div",{className:"flex flex-wrap gap-2",children:e.map(e=>r.jsxs(h,{variant:"secondary",className:"badge-base flex items-center gap-1 bg-blue-50 text-blue-700 border-blue-200",children:[e.label,e.dateField&&r.jsxs("span",{className:"text-blue-600",children:["(",me.find(a=>a.value===e.dateField)?.label,")"]}),": ",e.value,r.jsx(n,{variant:"ghost",size:"sm",onClick:()=>se(e.id),className:"h-4 w-4 p-0 hover:bg-blue-100 ml-1",children:r.jsx(i,{className:"w-3 h-3"})})]},e.id))})]})}const pe=a.memo(({state:e,onLoadMore:t,isNearEnd:s=!1,className:l="",mode:i="both"})=>{const[c,o]=a.useState(!1);a.useEffect(()=>{"button"!==i&&s&&e.hasMore&&!e.isLoading&&!c&&(o(!0),t().finally(()=>{o(!1)}))},[s,e.hasMore,e.isLoading,c,t,i]);const u=()=>0===e.totalCount?0:Math.min(100,Math.round(e.loadedCount/e.totalCount*100)),m=()=>{if(e.isLoading)return`ë°ì´í„° ë¡œë”© ì¤‘... (${e.loadedCount}/${e.totalCount})`;if(!e.hasMore)return`ëª¨ë“  ë°ì´í„° ë¡œë“œ ì™„ë£Œ (${e.totalCount}ê°œ)`;return`${(e.totalCount-e.loadedCount).toLocaleString()}ê°œ ë” ë³´ê¸°`};return e.hasMore||e.isLoading||e.error?r.jsxs("div",{className:`flex flex-col items-center gap-3 py-6 ${l}`,ref:void 0,children:[r.jsxs("div",{className:"w-full max-w-md",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsxs("span",{className:"card-description",children:[e.loadedCount.toLocaleString()," / ",e.totalCount.toLocaleString()]}),r.jsxs("span",{className:"card-description",children:[u(),"%"]})]}),r.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:r.jsx("div",{className:"bg-hansl-500 h-2 rounded-full transition-all duration-300",style:{width:`${u()}%`}})})]}),e.error&&r.jsxs("div",{className:"flex items-center gap-2 text-red-600",children:[r.jsx(d,{className:"w-4 h-4"}),r.jsx("span",{className:"card-description",children:e.error})]}),e.isLoading?r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(K,{className:"w-5 h-5 animate-spin text-hansl-500"}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"card-subtitle",children:m()}),r.jsxs("div",{className:"card-description",children:["ë°°ì¹˜ ",e.currentBatch," ë¡œë”© ì¤‘..."]})]})]}):!e.hasMore||"button"!==i&&"both"!==i?null:r.jsxs("div",{className:"flex flex-col items-center gap-2",children:[r.jsxs(n,{onClick:t,className:"button-base border border-hansl-200 bg-white text-hansl-600 hover:bg-hansl-50 hover:border-hansl-300",disabled:e.isLoading,children:[r.jsx(P,{className:"w-4 h-4 mr-2"}),m(),r.jsx("span",{className:"ml-2 card-description",children:(()=>{const a=Math.min(e.batchSize,e.totalCount-e.loadedCount);return a>0?`(ë‹¤ìŒ: ${a}ê°œ)`:""})()})]}),"both"===i&&r.jsx("div",{className:"card-description text-center",children:"ë˜ëŠ” ìŠ¤í¬ë¡¤í•˜ì—¬ ìë™ ë¡œë”©"})]}),"button"!==i&&e.hasMore&&r.jsx("div",{className:"card-description text-center",children:s?"ìë™ ë¡œë”© ì¤‘...":"ìŠ¤í¬ë¡¤í•˜ì—¬ ë” ë³´ê¸°"}),!e.hasMore&&!e.isLoading&&r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"card-subtitle text-green-600",children:"âœ… ëª¨ë“  ë°ì´í„° ë¡œë“œ ì™„ë£Œ"}),r.jsxs("div",{className:"card-description",children:["ì´ ",e.totalCount.toLocaleString(),"ê°œ í•­ëª©ì„ ",e.currentBatch,"ë²ˆì˜ ë°°ì¹˜ë¡œ ë¡œë“œ"]})]})]}):null});pe.displayName="ProgressiveLoadingIndicator";const be=a.memo(({currentLimit:e,nextLimit:t,totalCount:s,displayedCount:l,hasNextLimit:i,isFullyLoaded:c,onLoadMore:d,onReset:o,className:u="",progressiveState:m,onProgressiveLoadMore:h,enableProgressive:x=!1,isNearEnd:p=!1})=>{const[b,g]=a.useState(!1);return x&&m&&h?r.jsx("div",{className:u,children:r.jsx(pe,{state:m,onLoadMore:h,isNearEnd:p,mode:"both"})}):r.jsxs("div",{className:`flex flex-col items-center gap-3 py-6 ${u}`,children:[r.jsxs("div",{className:"text-center",children:[r.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[r.jsx($,{className:"w-4 h-4 text-gray-400"}),r.jsx("span",{className:"card-subtitle",children:c?`ì „ì²´ ${s.toLocaleString()}ê°œ í‘œì‹œì¤‘`:`${e.label} (${l.toLocaleString()}ê°œ)`}),c&&s>100&&r.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[r.jsx(X,{className:"w-3 h-3 text-hansl-500"}),r.jsx("span",{className:"card-description text-hansl-600",children:"ìŠ¤ë§ˆíŠ¸ ë¡œë”©"})]})]}),!c&&r.jsxs("div",{className:"card-description",children:[l<s&&r.jsxs("span",{children:["ì „ì²´ ",s.toLocaleString(),"ê°œ ì¤‘ ì¼ë¶€ í‘œì‹œ"]}),l===s&&i&&r.jsx("span",{children:"ì´ì „ ë°ì´í„°ê°€ ë” ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤"})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[i&&!c&&r.jsxs(n,{onClick:async()=>{if(t&&!b){g(!0);try{d(t)}finally{g(!1)}}},disabled:b,className:"button-base border border-hansl-200 bg-white text-hansl-600 hover:bg-hansl-50 hover:border-hansl-300",children:[b?r.jsx("div",{className:"w-4 h-4 border-2 border-hansl-500 border-t-transparent rounded-full animate-spin mr-2"}):r.jsx(P,{className:"w-4 h-4 mr-2"}),t?.label," ë³´ê¸°",i&&r.jsx("span",{className:"ml-2 card-description",children:(()=>{if(c)return"";if(l===s)return"ë” ë§ì€ ë°ì´í„°";return`+${Math.max(0,s-l).toLocaleString()}ê°œ+`})()})]}),!b&&"30d"!==e.key&&o&&r.jsxs(n,{onClick:async()=>{if(o&&!b){g(!0);try{o()}finally{g(!1)}}},className:"button-base border border-gray-300 bg-white text-gray-600 hover:bg-gray-50",children:[r.jsx(U,{className:"w-4 h-4 mr-2"}),"30ì¼ë¡œ ëŒì•„ê°€ê¸°"]})]}),b&&r.jsx("div",{className:"text-center",children:r.jsx("div",{className:"card-description",children:"ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘..."})})]})});be.displayName="LoadMoreButton";const ge={maxResults:500,warningThreshold:300,enableAutoLimit:!0},ye=a.memo(({smartFilter:e,className:t="",onConfigChange:s})=>{const[l,c]=a.useState(!1),[d,o]=a.useState(!1),u=e.getWarningMessage();if(!u||l)return null;const m=(()=>{switch(e.isLimited?"error":e.isOverThreshold?"warning":"info"){case"error":return{containerClass:"bg-red-50 border-red-200",iconClass:"text-red-500",textClass:"text-red-800",badgeClass:"badge-danger"};case"warning":return{containerClass:"bg-yellow-50 border-yellow-200",iconClass:"text-yellow-500",textClass:"text-yellow-800",badgeClass:"badge-warning"};default:return{containerClass:"bg-blue-50 border-blue-200",iconClass:"text-blue-500",textClass:"text-blue-800",badgeClass:"badge-primary"}}})();return r.jsx("div",{className:`rounded-lg border p-4 ${m.containerClass} ${t}`,children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(A,{className:`w-5 h-5 flex-shrink-0 mt-0.5 ${m.iconClass}`}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("div",{className:`text-sm font-medium ${m.textClass} mb-2`,children:"ìŠ¤ë§ˆíŠ¸ í•„í„° ì•Œë¦¼"}),r.jsx("div",{className:`text-sm ${m.textClass} mb-3`,children:u}),r.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[r.jsx(h,{className:m.badgeClass,children:e.getLimitMessage()}),e.isLimited&&r.jsxs(h,{className:"badge-secondary",children:["ì œí•œ ëª¨ë“œ: ",e.limitConfig.maxResults.toLocaleString(),"ê°œ"]})]}),r.jsx("div",{className:"mb-3",children:r.jsxs("button",{onClick:()=>o(!d),className:`inline-flex items-center gap-2 text-xs ${m.textClass} hover:underline`,children:[d?r.jsx(H,{className:"w-3 h-3"}):r.jsx(B,{className:"w-3 h-3"}),d?"ìƒì„¸ ì •ë³´ ìˆ¨ê¸°ê¸°":"ìƒì„¸ ì •ë³´ ë³´ê¸°"]})}),d&&r.jsxs("div",{className:`text-xs ${m.textClass} bg-white/50 rounded p-3 mb-3 space-y-2`,children:[r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("span",{className:"font-medium",children:"ì´ ê²€ìƒ‰ ê²°ê³¼:"}),r.jsxs("span",{className:"ml-2",children:[e.totalCount.toLocaleString(),"ê°œ"]})]}),r.jsxs("div",{children:[r.jsx("span",{className:"font-medium",children:"í‘œì‹œëœ í•­ëª©:"}),r.jsxs("span",{className:"ml-2",children:[e.displayedCount.toLocaleString(),"ê°œ"]})]}),r.jsxs("div",{children:[r.jsx("span",{className:"font-medium",children:"ì œí•œ ì„ê³„ê°’:"}),r.jsxs("span",{className:"ml-2",children:[e.limitConfig.maxResults.toLocaleString(),"ê°œ"]})]}),r.jsxs("div",{children:[r.jsx("span",{className:"font-medium",children:"ê²½ê³  ì„ê³„ê°’:"}),r.jsxs("span",{className:"ml-2",children:[e.limitConfig.warningThreshold.toLocaleString(),"ê°œ"]})]})]}),r.jsxs("div",{className:"pt-2 border-t border-white/20",children:[r.jsx("span",{className:"font-medium",children:"ê¶Œì¥ ì‚¬í•­:"}),r.jsxs("ul",{className:"mt-1 space-y-1 list-disc list-inside ml-2",children:[r.jsx("li",{children:"ë” êµ¬ì²´ì ì¸ ê²€ìƒ‰ì–´ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”"}),r.jsx("li",{children:"ë‚ ì§œ ë²”ìœ„ë¥¼ ì¢í˜€ë³´ì„¸ìš”"}),r.jsx("li",{children:"ì¶”ê°€ í•„í„°ë¥¼ ì ìš©í•˜ì—¬ ê²°ê³¼ë¥¼ ì¤„ì´ì„¸ìš”"}),e.isLimited&&r.jsx("li",{children:"ëª¨ë“  ê²°ê³¼ë¥¼ ë³´ë ¤ë©´ ë” êµ¬ì²´ì ì¸ ì¡°ê±´ì„ ì„¤ì •í•˜ì„¸ìš”"})]})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[s&&r.jsxs(n,{onClick:s,size:"sm",className:"button-base border border-gray-300 bg-white text-gray-600 hover:bg-gray-50",children:[r.jsx(J,{className:"w-4 h-4 mr-2"}),"ì„¤ì •"]}),e.isLimited&&r.jsx(n,{onClick:()=>e.setLimitConfig({enableAutoLimit:!1}),size:"sm",className:"button-base border "+(m.iconClass.includes("red")?"border-red-300 text-red-600 hover:bg-red-50":"border-yellow-300 text-yellow-600 hover:bg-yellow-50"),children:"ì œí•œ í•´ì œ"})]})]}),r.jsx("button",{onClick:()=>c(!0),className:`p-1 hover:bg-white/20 rounded transition-colors ${m.iconClass}`,"aria-label":"ê²½ê³  ë‹«ê¸°",children:r.jsx(i,{className:"w-4 h-4"})})]})})});ye.displayName="SmartFilterWarning";const fe=a.lazy(()=>l(()=>import("./PurchaseItemsModal-DfqcWyqg.js"),__vite__mapDeps([20,1,2,12,11,3,6,7,8,9,10,18,17,19,16]))),ve=[{key:"pending",label:"ìŠ¹ì¸ëŒ€ê¸°"},{key:"purchase",label:"êµ¬ë§¤ í˜„í™©"},{key:"receipt",label:"ì…ê³  í˜„í™©"},{key:"done",label:"ì „ì²´ í•­ëª©"}];function _e({showEmailButton:e=!0}){const l=o(),i=u(),c=t(),[d,x]=a.useState(null),[p,b]=a.useState(!1),[g,y]=a.useState([]),[f,v]=a.useState({field:"created_at",direction:"desc",label:"ìƒì„±ì¼"}),[_,j]=a.useState(""),[N,w]=a.useState([]),[C,k]=a.useState([]),[S,M]=a.useState([]),[L,D]=a.useState([]),{purchases:T,loading:q,currentUserRoles:R,currentUserName:$,refreshPurchases:z,updatePurchaseOptimistic:P}=(()=>{const[e,r]=a.useState([]),[l,n]=a.useState(!0),[i,c]=a.useState([]),[d,o]=a.useState(""),[u,h]=a.useState(""),[x,p]=a.useState(""),b=t(),g=a.useRef(!1);a.useEffect(()=>{(async()=>{if(g.current)return;g.current=!0;const e=Date.now(),a=Z.lastFetch&&e-Z.lastFetch<Z.CACHE_DURATION;try{if(a&&Z.userInfo)try{const e=Z.userInfo;if(e){let a=[];e.purchase_role&&(a=Array.isArray(e.purchase_role)?e.purchase_role.map(e=>String(e).trim()):String(e.purchase_role).split(",").map(e=>e.trim()).filter(e=>e.length>0)),c(a),o(e.name||e.full_name||""),h(e.email||""),p(e.id||"")}return}catch(t){s.error("ìºì‹œ ë°ì´í„° ì‚¬ìš© ì¤‘ ì˜¤ë¥˜",t),Z.purchases=null,Z.userInfo=null,Z.lastFetch=0}const r=await b.auth.getUser();if(r.data.user&&!r.error){let a=null;if(r.data.user.email&&(a=(await b.from("employees").select("*").eq("email",r.data.user.email).maybeSingle()).data),a){Z.userInfo=a;let e=[];a.purchase_role&&(e=Array.isArray(a.purchase_role)?a.purchase_role.map(e=>String(e).trim()):String(a.purchase_role).split(",").map(e=>e.trim()).filter(e=>e.length>0)),c(e),o(a.name||a.full_name||""),h(a.email||""),p(a.id||"")}Z.lastFetch=e}}catch(t){s.error("ì´ˆê¸° ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨",t)}})()},[]);const y=a.useCallback(async(e,a)=>{const t=!a?.silent;t&&n(!0);try{const a=Date.now(),i=Z.lastFetch&&a-Z.lastFetch<Z.CACHE_DURATION;if(e&&(ee(),Z.purchases=null,Z.lastFetch=0),!e&&i&&Z.purchases)try{return r(Z.purchases),void(t&&n(!1))}catch(l){s.error("ë°œì£¼ ë°ì´í„° ìºì‹œ ì‚¬ìš© ì¤‘ ì˜¤ë¥˜",l),Z.purchases=null,Z.lastFetch=0,ee()}const{data:{user:c},error:d}=await b.auth.getUser();if(d||!c)return s.error("ì‚¬ìš©ì ì¸ì¦ ì‹¤íŒ¨",d),m.error("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤."),void(t&&n(!1));const{data:o,error:u}=await b.from("purchase_requests").select("\n          *,\n          purchase_request_items(*)\n        ").order("request_date",{ascending:!1}).limit(1e3);if(u)throw u;let h=[],x=[],p=[];if(o&&o.length>0){const[e,a,t]=await Promise.all([b.from("employees").select("id, name, email"),b.from("vendors").select("id, vendor_name, vendor_payment_schedule"),b.from("vendor_contacts").select("id, contact_name")]);h=e.data||[],x=a.data||[],p=t.data||[]}const g=(new Date).toISOString().split("T")[0],y=((o||[]).filter(e=>e.request_date?.startsWith(g)),(o||[]).map(e=>{const a=e.purchase_request_items?.[0]||{},t=h.find(a=>a.id===e.requester_id),s=x.find(a=>a.id===e.vendor_id),r=p.find(a=>a.id===e.contact_id);return{id:Number(e.id),purchase_order_number:e.purchase_order_number,request_date:e.request_date,delivery_request_date:e.delivery_request_date??null,revised_delivery_request_date:e.revised_delivery_request_date??null,progress_type:e.progress_type,payment_completed_at:e.payment_completed_at,payment_completed_by_name:e.payment_completed_by_name,payment_category:e.payment_category,currency:e.currency,request_type:e.request_type,vendor:void 0,vendor_name:e.vendor_name||"",vendor_payment_schedule:s?.vendor_payment_schedule||"",vendor_contacts:[],requester_id:e.requester_id,requester_name:e.requester_name,requester_full_name:t?.name||e.requester_name||"",item_name:a.item_name||"",specification:a.specification||"",quantity:Number(a.quantity)||0,unit_price_value:Number(a.unit_price_value)||0,amount_value:Number(a.amount_value)||0,remark:a.remark||"",project_vendor:e.project_vendor,sales_order_number:e.sales_order_number,project_item:e.project_item,line_number:Number(a.line_number)||1,contact_name:r?.contact_name||"",middle_manager_status:e.middle_manager_status,final_manager_status:e.final_manager_status,is_received:!!e.is_received,received_at:e.received_at,is_payment_completed:!!e.is_payment_completed,is_utk_checked:!!e.is_utk_checked,is_statement_received:!!e.is_statement_received,is_po_download:!!e.is_po_download,link:a.link,items:(e.purchase_request_items||[]).sort((e,a)=>(e.line_number||0)-(a.line_number||0)),total_amount:e.purchase_request_items?.reduce((e,a)=>e+(Number(a.amount_value)||0),0)||0,purchase_status:e.purchase_status||"pending"}}));r(y),Z.purchases=y,Z.lastFetch=a}catch(i){s.error("ë°œì£¼ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨",i),m.error("ë°œì£¼ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")}finally{t&&n(!1)}},[b]),f=a.useCallback((e,a)=>{r(t=>{const s=t.map(t=>t.id===e?a(t):t);return Z.purchases=s,s})},[]);return a.useEffect(()=>{y()},[y]),{purchases:e,loading:l,currentUserRoles:i,currentUserName:d,currentUserEmail:u,currentUserId:x,refreshPurchases:y,updatePurchaseOptimistic:f}})(),E=R?.includes("app_admin"),{activeTab:U,selectedEmployee:A,setActiveTab:B,filteredPurchases:W,tabCounts:V,dateLimit:H,totalDataCount:K,displayedDataCount:J}=se(T,R,$);a.useEffect(()=>{"purchase"===new URLSearchParams(i.search).get("tab")&&B("purchase")},[i.search,B]),a.useEffect(()=>{(async()=>{try{const{data:e}=await c.from("employees").select("name");if(e){const a=[...new Set(e.map(e=>e.name).filter(Boolean))];w(a)}const{data:a}=await c.from("vendors").select("vendor_name");if(a){const e=[...new Set(a.map(e=>e.vendor_name).filter(Boolean))];k(e)}const{data:t}=await c.from("vendor_contacts").select("contact_name");if(t){const e=[...new Set(t.map(e=>e.contact_name).filter(Boolean))];M(e)}const{data:s}=await c.from("vendors").select("vendor_payment_schedule");if(s){const e=[...new Set(s.map(e=>e.vendor_payment_schedule).filter(Boolean))];D(e)}}catch(e){s.error("í•„í„° ì˜µì…˜ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨",e)}})()},[c]);const G=a.useRef(!1);a.useEffect(()=>{if(!G.current)return void(G.current=!0);(async()=>{try{await z(!0,{silent:!0})}catch(e){s.error("íƒ­ ì „í™˜ ì‹œ ë°œì£¼ ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨",e)}})()},[U,z]),a.useCallback(e=>e.is_received?r.jsx(h,{variant:null,className:"badge-success",children:"ì…ê³ ì™„ë£Œ"}):"approved"===e.middle_manager_status&&"approved"===e.final_manager_status?r.jsx(h,{variant:null,className:"badge-primary",children:"êµ¬ë§¤ì§„í–‰"}):"rejected"===e.middle_manager_status||"rejected"===e.final_manager_status?r.jsx(h,{variant:null,className:"badge-danger",children:"ë°˜ë ¤"}):r.jsx(h,{variant:null,className:"badge-warning",children:"ìŠ¹ì¸ëŒ€ê¸°"}),[]);const Q=a.useCallback(e=>{let a=[...e];if(_.trim()){const e=_.toLowerCase().trim();a=a.filter(a=>a.purchase_order_number?.toLowerCase().includes(e)||a.vendor_name?.toLowerCase().includes(e)||a.requester_name?.toLowerCase().includes(e)||a.item_name?.toLowerCase().includes(e)||a.specification?.toLowerCase().includes(e)||a.remark?.toLowerCase().includes(e)||a.project_vendor?.toLowerCase().includes(e)||a.project_item?.toLowerCase().includes(e)||a.sales_order_number?.toLowerCase().includes(e))}return g.forEach(e=>{a=a.filter(a=>{const t=("date_range"===e.field||"date_month"===e.field)&&e.dateField||e.field,s=X(a,t),r="date_month"===e.field?"date_month":"date_range"===e.field?"date_range":void 0;return te(s,e.condition,e.value,r)})}),a},[_,g]),X=(e,a)=>{switch(a){case"purchase_order_number":return e.purchase_order_number;case"payment_category":return e.payment_category;case"requester_name":return e.requester_name;case"vendor_name":return e.vendor_name;case"contact_name":return e.contact_name;case"item_name":return e.item_name;case"specification":return e.specification;case"quantity":return e.quantity;case"unit_price_value":return e.unit_price_value;case"total_amount":return e.total_amount;case"remark":return e.remark;case"project_vendor":return e.project_vendor;case"project_item":return e.project_item;case"sales_order_number":return e.sales_order_number;case"payment_schedule":return e.vendor_payment_schedule;case"is_payment_completed":return e.is_payment_completed?"ì™„ë£Œ":"ëŒ€ê¸°";case"is_received":return e.is_received?"ì™„ë£Œ":"ëŒ€ê¸°";case"is_statement_received":return e.is_statement_received?"ì™„ë£Œ":"ëŒ€ê¸°";case"is_utk_checked":return e.is_utk_checked?"ì™„ë£Œ":"ëŒ€ê¸°";case"request_date":return e.request_date;case"delivery_request_date":return e.delivery_request_date;case"payment_completed_at":return e.payment_completed_at;case"received_at":return e.received_at;case"created_at":return e.created_at;case"statement_received_at":return e.statement_received_at;default:return null}},te=(e,a,t,r)=>{if(null==e)return"is_empty"===a;if("date_range"===r&&t&&t.includes("~")){if(!e)return!1;const[a,s]=t.split("~"),r=new Date(e),l=new Date(a),n=new Date(s);return r>=l&&r<=n}if("date_month"===r&&t&&t.includes("~")){if(!e)return!1;const[a,s]=t.split("~"),r=new Date(e),l=new Date(`${a}-01`),n=new Date(`${s}-01`),i=new Date(n.getFullYear(),n.getMonth()+1,0,23,59,59);return r>=l&&r<=i}if(r&&("date_month"===r||r.endsWith("_month"))){if(!t)return!0;const a=new Date(e),[s,r]=t.split("-");return a.getFullYear()===parseInt(s)&&a.getMonth()+1===parseInt(r)}const l=String(e).toLowerCase(),n=String(t).toLowerCase();switch(a){case"contains":return l.includes(n);case"equals":if("date_range"===r||t.match(/^\d{4}-\d{2}-\d{2}/)){if(!e)return!1;try{const a=new Date(e).toISOString().split("T")[0];return a===t.split("T")[0]}catch(i){return s.error("ë‚ ì§œ ë¹„êµ ì˜¤ë¥˜:",i),!1}}return l===n;case"starts_with":return l.startsWith(n);case"ends_with":return l.endsWith(n);case"is_empty":return!e||""===l.trim();case"is_not_empty":return!!e&&""!==l.trim();case"greater_than":return Number(e)>Number(t);case"less_than":return Number(e)<Number(t);case"between":default:return!0;case"after":return new Date(e)>new Date(t);case"before":return new Date(e)<new Date(t);case"not_equals":return l!==n}},re=a.useCallback(e=>f?[...e].sort((e,a)=>{const t=X(e,f.field),s=X(a,f.field);if(null==t)return 1;if(null==s)return-1;let r=0;return r="number"==typeof t&&"number"==typeof s?t-s:t instanceof Date&&s instanceof Date?t.getTime()-s.getTime():String(t).localeCompare(String(s)),"desc"===f.direction?-r:r}):e,[f]),le=a.useMemo(()=>{let e=Q(W);return e=re(e),e},[W,Q,re]),ne=a.useMemo(()=>((e,a,t)=>e.length>0||a.trim().length>0||t&&"all"!==t&&"ì „ì²´"!==t)(g,_,A),[g,_,A]),ie=((e,t,s=[],r="")=>{const[l,n]=a.useState(ge),i=a.useMemo(()=>l.enableAutoLimit&&t&&(s.length>0||r.trim().length>0),[l.enableAutoLimit,t,s.length,r]),c=a.useMemo(()=>i?e.length<=l.maxResults?e:e.slice(0,l.maxResults):e,[e,i,l.maxResults]),d=e.length,o=c.length,u=i&&d>l.maxResults,m=d>l.warningThreshold,h=i&&m,x=a.useCallback(()=>{if(!u)return`${d.toLocaleString()}ê°œ í•­ëª©`;const e=d-o;return`${o.toLocaleString()}ê°œ í‘œì‹œ (${e.toLocaleString()}ê°œ ìˆ¨ê¹€)`},[u,d,o]),p=a.useCallback(()=>{if(!h)return null;if(u){const e=d-o;return`ê²€ìƒ‰ ê²°ê³¼ê°€ ë§ìŠµë‹ˆë‹¤. ì„±ëŠ¥ì„ ìœ„í•´ ìƒìœ„ ${o.toLocaleString()}ê°œë§Œ í‘œì‹œí•©ë‹ˆë‹¤. ${e.toLocaleString()}ê°œ í•­ëª©ì´ ìˆ¨ê²¨ì¡ŒìŠµë‹ˆë‹¤.`}return d>l.warningThreshold&&d<=l.maxResults?`ê²€ìƒ‰ ê²°ê³¼ê°€ ${d.toLocaleString()}ê°œì…ë‹ˆë‹¤. ì„±ëŠ¥ì„ ìœ„í•´ ë” êµ¬ì²´ì ì¸ í•„í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.`:null},[h,u,d,o,l.warningThreshold,l.maxResults]),b=a.useCallback(e=>{n(a=>({...a,...e}))},[]),g=a.useCallback(()=>{n(ge)},[]);return{limitedData:c,totalCount:d,displayedCount:o,isLimited:u,isOverThreshold:m,limitConfig:l,setLimitConfig:b,getLimitMessage:x,getWarningMessage:p,shouldShowWarning:h,resetLimit:g}})(le,ne,g,_),ce=ie.limitedData,de=a.useMemo(()=>"done"===U&&H.isFullyLoaded&&!ie.isLimited&&ce.length>100,[U,H.isFullyLoaded,ie.isLimited,ce.length]),ue=((e,t={})=>{const{initialBatchSize:r=50,maxBatchSize:l=200,prefetchThreshold:n=.8,enablePrefetch:i=!0}=t,[c,d]=a.useState({isLoading:!1,hasMore:!0,loadedCount:0,totalCount:e.length,error:null,batchSize:r,currentBatch:0}),[o,u]=a.useState([]),[m,h]=a.useState(!1),x=a.useRef(null),p=a.useRef(!1);a.useEffect(()=>{d(a=>({...a,totalCount:e.length,hasMore:a.loadedCount<e.length}))},[e.length,c.loadedCount]),a.useEffect(()=>{e.length>0&&0===o.length&&b()},[e]);const b=a.useCallback(()=>{const a=e.slice(0,r);u(a),d(t=>({...t,loadedCount:a.length,hasMore:a.length<e.length,currentBatch:1,isLoading:!1,error:null}))},[e,r]),g=a.useCallback(async()=>{if(!c.isLoading&&c.hasMore&&0!==e.length){d(e=>({...e,isLoading:!0,error:null}));try{await new Promise(e=>setTimeout(e,300));const a=c.currentBatch,t=c.loadedCount,r=Math.min(t+c.batchSize,e.length),n=e.slice(t,r);n.length>0?(u(e=>[...e,...n]),d(a=>({...a,loadedCount:a.loadedCount+n.length,hasMore:a.loadedCount+n.length<e.length,currentBatch:a.currentBatch+1,isLoading:!1,batchSize:Math.min(1.2*a.batchSize,l)})),s.debug(`ì ì§„ì  ë¡œë”©: ${n.length}ê°œ í•­ëª© ì¶”ê°€ ë¡œë“œ`,{total:t+n.length,batch:a+1})):d(e=>({...e,hasMore:!1,isLoading:!1}))}catch(a){s.error("ì ì§„ì  ë¡œë”© ì˜¤ë¥˜",a),d(e=>({...e,isLoading:!1,error:"ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."}))}}},[c,e,l]),y=a.useCallback(async()=>{if(!p.current&&i&&c.hasMore&&!c.isLoading){p.current=!0;try{const a=c.loadedCount,t=Math.min(a+c.batchSize,e.length);a<e.length&&s.debug("ë°±ê·¸ë¼ìš´ë“œ í”„ë¦¬í˜ì¹­ ì¤€ë¹„",{nextBatch:c.currentBatch+1,range:[a,t]})}catch(a){s.error("í”„ë¦¬í˜ì¹­ ì˜¤ë¥˜",a)}finally{p.current=!1}}},[c,e,i]);a.useEffect(()=>{if(!i||!x.current)return;const e=new IntersectionObserver(e=>{const a=e[0],t=a.isIntersecting,s=a.intersectionRatio;h(t||s>n),t&&c.hasMore&&y()},{threshold:[0,n,1],rootMargin:"100px"});return e.observe(x.current),()=>e.disconnect()},[i,n,c.hasMore,y]);const f=a.useCallback(()=>{u([]),d({isLoading:!1,hasMore:!0,loadedCount:0,totalCount:e.length,error:null,batchSize:r,currentBatch:0}),h(!1),p.current=!1},[e.length,r]),v=a.useCallback(e=>{u(e),d(a=>({...a,loadedCount:e.length,totalCount:e.length,hasMore:!1,currentBatch:1,isLoading:!1,error:null}))},[]);return{state:c,loadedData:o,loadMore:g,reset:f,setData:v,isNearEnd:m,loadingRef:x}})(de?ce:[],{initialBatchSize:50,maxBatchSize:200,enablePrefetch:!0,prefetchThreshold:.8}),me=a.useMemo(()=>de?ue.loadedData:ce,[de,ue.loadedData,ce]);a.useEffect(()=>{de?ue.reset():ue.setData(ce)},[de,ce]);const he=a.useCallback(async e=>{try{const a=(new Date).toISOString(),[t,s]=await Promise.all([c.from("purchase_requests").update({is_received:!0,received_at:a}).eq("id",e),c.from("purchase_request_items").update({is_received:!0,delivery_status:"received"}).eq("purchase_request_id",e)]);if(t.error)throw t.error;if(s.error)throw s.error;m.success("ì…ê³ ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤."),await z()}catch(a){m.error("ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},[c,z]),pe=a.useCallback(async e=>{try{const a=(new Date).toISOString(),[t,s]=await Promise.all([c.from("purchase_requests").update({is_payment_completed:!0,payment_completed_at:a}).eq("id",e),c.from("purchase_request_items").update({is_payment_completed:!0}).eq("purchase_request_id",e)]);if(t.error)throw t.error;if(s.error)throw s.error;m.success("êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤."),await z()}catch(a){m.error("ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},[c,z]);a.useCallback(e=>{x(e),b(!0)},[]);const _e=a.useCallback(e=>{H.setDateLimit(e)},[H]),je=a.useCallback(()=>{H.setDateLimit(ae[0])},[H]),Ne=a.useMemo(()=>d?{...d,vendor_name:d.vendor_name||"",project_vendor:d.project_vendor||"",sales_order_number:d.sales_order_number||"",project_item:d.project_item||""}:null,[d]);return r.jsxs("div",{className:"w-full",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"page-title",children:"ë°œì£¼ìš”ì²­ ê´€ë¦¬"}),r.jsx("p",{className:"page-subtitle",style:{marginTop:"-2px",marginBottom:"-4px"},children:"Purchase Management"})]}),r.jsxs(n,{onClick:()=>l("/purchase/new"),className:"mt-4 sm:mt-0 bg-hansl-500 hover:bg-hansl-600",children:[r.jsx(Y,{className:"w-4 h-4 mr-2"}),"ìƒˆ ë°œì£¼ìš”ì²­ ì‘ì„±"]})]}),r.jsx("div",{className:"mb-3",children:r.jsx(xe,{activeFilters:g,sortConfig:f,searchTerm:_,onFiltersChange:y,onSortChange:v,onSearchChange:j,availableEmployees:N,availableVendors:C,availableContacts:S,availablePaymentSchedules:L})}),ie.shouldShowWarning&&r.jsx("div",{className:"mb-4",children:r.jsx(ye,{smartFilter:ie})}),r.jsxs("div",{className:"space-y-3",children:[r.jsx("div",{className:"flex flex-col sm:flex-row sm:space-x-1 space-y-1 sm:space-y-0 bg-gray-50 p-1 business-radius-card border border-gray-200",children:ve.map(e=>r.jsxs("button",{onClick:()=>{B(e.key)},className:"flex-1 flex items-center justify-center space-x-2 py-1.5 px-3 sm:px-4 business-radius-button button-text font-medium transition-colors "+(U===e.key?"text-hansl-600 bg-white shadow-sm border border-gray-200":"text-gray-600 bg-transparent hover:text-gray-900 hover:bg-white/50"),children:[r.jsx("span",{className:"whitespace-nowrap",children:e.label}),r.jsx(h,{variant:"secondary",className:U===e.key?"badge-stats-active":"badge-stats-secondary",children:e.key===U&&ie.isLimited?`${ie.displayedCount.toLocaleString()}/${ie.totalCount.toLocaleString()}`:V[e.key]})]},e.key))}),r.jsx(I,{className:"overflow-hidden border border-gray-200",children:r.jsx(O,{className:"p-0",children:q?r.jsxs("div",{className:"flex items-center justify-center py-12",children:[r.jsx("div",{className:"w-8 h-8 border-2 border-hansl-500 border-t-transparent rounded-full animate-spin"}),r.jsx("span",{className:"ml-3 card-subtitle",children:"ë¡œë”© ì¤‘..."})]}):0===le.length?r.jsxs("div",{className:"text-center py-12",children:[r.jsx(F,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"ë°œì£¼ìš”ì²­ì„œê°€ ì—†ìŠµë‹ˆë‹¤"}),r.jsx("p",{className:"card-subtitle",children:"ìƒˆë¡œìš´ ë°œì£¼ìš”ì²­ì„œë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”."})]}):r.jsxs(r.Fragment,{children:[r.jsx(oe,{purchases:me,activeTab:U,currentUserRoles:R,onRefresh:z,onOptimisticUpdate:P,onPaymentComplete:pe,onReceiptComplete:he,virtualizationThreshold:200,virtualizedHeight:600}),"done"===U&&r.jsxs(r.Fragment,{children:[r.jsx(be,{currentLimit:H.currentLimit,nextLimit:H.getNextLimit(),totalCount:K,displayedCount:de?ue.loadedData.length:J,hasNextLimit:H.hasNextLimit,isFullyLoaded:H.isFullyLoaded,onLoadMore:_e,onReset:je,className:"border-t border-gray-100",enableProgressive:de,progressiveState:ue.state,onProgressiveLoadMore:ue.loadMore,isNearEnd:ue.isNearEnd}),de&&r.jsx("div",{ref:ue.loadingRef,className:"h-1 w-full invisible","aria-hidden":"true"})]})]})})})]}),Ne&&r.jsx(a.Suspense,{fallback:r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"})}),children:r.jsx(fe,{isOpen:p,onClose:()=>{b(!1),x(null)},purchase:Ne,isAdmin:E||!1,onUpdate:z,activeTab:U})})]})}export{_e as default};
//# sourceMappingURL=PurchaseListMain-Cv6QhGaj.js.map
