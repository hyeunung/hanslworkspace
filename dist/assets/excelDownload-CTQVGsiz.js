const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/exceljs.min-CKEsdgy_.js","assets/index-BBqlRFcp.js","assets/index-Dlw3QP5I.css"])))=>i.map(i=>d[i]);
import{_ as e,a as t}from"./index-BBqlRFcp.js";import{a as l}from"./helpers-CsHcdtkA.js";import{t as r}from"./index-BwPoDD6m.js";const o=l;function n(e){return e?["KRW","원","₩"].includes(e)?"₩":["USD","$","달러"].includes(e)?"$":["EUR","€"].includes(e)?"€":["JPY","엔","¥"].includes(e)||["CNY","위안","元"].includes(e)?"¥":e:""}async function a(t){const l=new((await e(()=>import("./exceljs.min-CKEsdgy_.js").then(e=>e.e),__vite__mapDeps([0,1,2]))).Workbook),r=l.addWorksheet("발주서",{pageSetup:{paperSize:9,orientation:"portrait",fitToPage:!0,fitToWidth:1,fitToHeight:1,horizontalCentered:!0,verticalCentered:!0,margins:{left:.3,right:.3,top:.5,bottom:.5,header:.2,footer:.2}}});r.getRow(1).height=29.8;for(let e=2;e<=60;e++)r.getRow(e).height=15.75;r.getRow(1).eachCell(e=>{e.font={...e.font||{},name:"맑은 고딕",size:20}});for(let e=2;e<=60;e++)r.getRow(e).eachCell(e=>{e.font={...e.font||{},name:"맑은 고딕",size:11}});r.mergeCells("A1:G1"),r.mergeCells("A2:B2"),r.mergeCells("C2:D2"),r.mergeCells("F2:G2"),r.mergeCells("A3:B3"),r.mergeCells("C3:D3"),r.mergeCells("F3:G3"),r.mergeCells("A4:B4"),r.mergeCells("C4:D4"),r.mergeCells("F4:G4"),r.mergeCells("A5:B5"),r.mergeCells("C5:D5"),r.mergeCells("F5:G5"),r.mergeCells("A6:B6"),r.mergeCells("C6:D6"),r.mergeCells("F6:G6"),r.mergeCells("A7:B7"),r.mergeCells("C7:D7"),r.mergeCells("F7:G7");try{const e=await fetch("/logo_KOR.png"),t=await e.arrayBuffer(),o=l.addImage({buffer:t,extension:"png"}),n=r.getColumn("D").width||22,a=Math.max(1,7.2*n*.58)+4,i=34,d=3,m=.3;r.addImage(o,{tl:{col:d,row:m},ext:{width:a,height:i}})}catch(_){}r.getCell("D1").value="                발 주 서",r.getCell("D1").alignment={horizontal:"left",vertical:"middle",indent:1},r.getCell("D1").font={bold:!0,size:20},r.getCell("A2").value="업   체   명",r.getCell("A2").font={bold:!0},r.getCell("A3").value="담   당   자",r.getCell("A3").font={bold:!0},r.getCell("A4").value="청   구   일",r.getCell("A4").font={bold:!0},r.getCell("A5").value="TEL.",r.getCell("A5").font={bold:!0},r.getCell("A6").value="FAX.",r.getCell("A6").font={bold:!0},r.getCell("A7").value="입고요청일",r.getCell("A7").font={bold:!0},r.getCell("E2").value="구매요청자",r.getCell("E2").font={bold:!0},r.getCell("E3").value="주         소",r.getCell("E3").font={bold:!0},r.getCell("E4").value="발 주 번 호",r.getCell("E4").font={bold:!0},r.getCell("E5").value="TEL.",r.getCell("E5").font={bold:!0},r.getCell("E6").value="FAX.",r.getCell("E6").font={bold:!0},r.getCell("E7").value="지출 예정일",r.getCell("E7").font={bold:!0},r.getCell("F7").value=t.vendor_payment_schedule||"",r.getCell("C2").value=t.vendor_name,r.getCell("C3").value=t.vendor_contact_name||"",r.getCell("C4").value=o(t.request_date),r.getCell("C5").value=t.vendor_phone||"",r.getCell("C6").value=t.vendor_fax||"",r.getCell("C7").value=o(t.delivery_request_date),r.getCell("F2").value=t.requester_name,r.getCell("F3").value="대구광역시 달서구 성서공단북로305",r.getCell("F4").value=t.purchase_order_number,r.getCell("F5").value="(053) 626-7805",r.getCell("F6").value="(053) 657-7905",r.getCell("F5").alignment={horizontal:"center",vertical:"middle"},r.getCell("F6").alignment={horizontal:"center",vertical:"middle"};const a=["No","품명","규격","수량","단가","금액","비고"];for(let e=0;e<a.length;e++)r.getCell(String.fromCharCode(65+e)+"8").value=a[e],r.getCell(String.fromCharCode(65+e)+"8").font={bold:!0},6===e&&(r.getCell("G8").alignment={horizontal:"center",vertical:"middle"});const i=[...t.items].sort((e,t)=>e.line_number-t.line_number),d=i.length,m=9+Math.max(d,45);for(let e=0;e<i.length;e++){const t=i[e],l=9+e;r.getCell("A"+l).value=t.line_number;const o=r.getCell("B"+l);o.value=t.item_name,o.alignment={horizontal:"left",vertical:"middle"},r.getCell("C"+l).value=t.specification,r.getCell("C"+l).alignment={horizontal:"left",vertical:"middle"},r.getCell("D"+l).value=t.quantity;const a=n(t.currency),d=void 0!==t.unit_price_value&&null!==t.unit_price_value?`${t.unit_price_value.toLocaleString()} ${a}`.trim():"";r.getCell("E"+l).value=d,r.getCell("E"+l).alignment={horizontal:"right",vertical:"middle"};const m=n(t.currency),c=void 0!==t.amount_value&&null!==t.amount_value?`${t.amount_value.toLocaleString()} ${m}`.trim():"";r.getCell("F"+l).value=c,r.getCell("F"+l).alignment={horizontal:"right",vertical:"middle"};const g=r.getCell("G"+l);g.value=void 0!==t.remark&&null!==t.remark?String(t.remark):"",g.alignment={horizontal:"left",vertical:"middle",wrapText:!1,shrinkToFit:!0}}for(let e=d;e<45;e++){const t=9+e;for(let e=0;e<7;e++)r.getCell(String.fromCharCode(65+e)+t).value=""}r.mergeCells(`A${m}:E${m}`),r.getCell("A"+m).value="합계",r.getCell("A"+m).font={bold:!0};const c=n(t.items[0]?.currency),g=t.items.reduce((e,t)=>e+(t.amount_value||0),0);r.getCell("F"+m).value=`${g.toLocaleString()} ${c}`.trim(),r.getCell("F"+m).alignment={horizontal:"right",vertical:"middle"};const s=m;for(let e=1;e<=s;e++)for(let t=1;t<=7;t++){const l=String.fromCharCode(64+t)+e,o=r.getCell(l),n=e>=9&&e<m;(5===t||6===t)&&(n||e===m)||3===t&&n||(o.alignment={horizontal:"center",vertical:"middle"}),o.border={top:{style:1===e||2===e||8===e||e===m?"medium":"thin"},left:{style:1===t?"medium":"thin"},right:{style:7===t?"medium":"thin"},bottom:{style:8===e||e===m||e===s?"medium":"thin"}}}for(let e=0;e<d;e++){const t=9+e;r.getCell("C"+t).alignment={horizontal:"left",vertical:"middle"}}for(let e=2;e<=7;e++)r.getCell("B"+e).border={...r.getCell("B"+e).border,right:{style:"medium"}},r.getCell("D"+e).border={...r.getCell("D"+e).border,right:{style:"medium"}},e<=6&&(r.getCell("E"+e).border={...r.getCell("E"+e).border,right:{style:"medium"}});r.getCell("E7").border={...r.getCell("E7").border,top:{style:"thin"},right:{style:"medium"}},r.getCell("G7").border={...r.getCell("G7").border,top:{style:"thin"}};for(let e=1;e<=7;e++){const t=r.getCell("A"+e).border||{};r.getCell("A"+e).border={...t,left:{style:"medium"}}}const u=r.getCell("A"+m).border||{};r.getCell("A"+m).border={...u,left:{style:"medium"}};Object.entries({A:4.7,B:23,C:30,D:11,E:15,F:16,G:37}).forEach(([e,t])=>{r.getColumn(e).width=t}),r.getRow(1).height=29.8,r.getRow(1).eachCell(e=>{e.font={...e.font||{},name:"맑은 고딕",size:20}});for(let e=2;e<=s;e++){const t=r.getRow(e);t.height=15.75,t.eachCell(e=>{e.font={...e.font||{},name:"맑은 고딕",size:11}})}for(let e=9;e<=s;e++)r.getCell("G"+e).alignment={horizontal:"left",vertical:"middle",wrapText:!1,shrinkToFit:!0},r.getCell("B"+e).alignment={horizontal:"left",vertical:"middle"};const C=await l.xlsx.writeBuffer();return new Blob([C],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})}const i=t(),d=async(e,t,l)=>{try{const{data:d,error:m}=await i.from("purchase_requests").select("*").eq("purchase_order_number",e.purchase_order_number).single();if(m||!d)return void r.error("해당 발주요청번호의 데이터를 찾을 수 없습니다.");const{data:c,error:g}=await i.from("purchase_request_items").select("*").eq("purchase_order_number",e.purchase_order_number).order("line_number");if(g||!c||0===c.length)return void r.error("해당 발주요청번호의 품목 데이터를 찾을 수 없습니다.");const s={vendor_name:e.vendor_name,vendor_phone:"",vendor_fax:"",vendor_contact_name:""};try{const t=d.vendor_id||e.vendor_id,l=d.contact_id||e.contact_id;if(t){const{data:e,error:l}=await i.from("vendors").select("vendor_phone, vendor_fax").eq("id",t).single();e&&!l&&(s.vendor_phone=e.vendor_phone||"",s.vendor_fax=e.vendor_fax||"")}if(l){const{data:e,error:t}=await i.from("vendor_contacts").select("contact_name, contact_phone, contact_email").eq("id",l).single();e&&!t&&(s.vendor_contact_name=e.contact_name||"")}}catch(o){}const u={purchase_order_number:d.purchase_order_number||"",request_date:d.request_date,delivery_request_date:d.delivery_request_date,requester_name:d.requester_name,vendor_name:s.vendor_name||"",vendor_contact_name:s.vendor_contact_name,vendor_phone:s.vendor_phone,vendor_fax:s.vendor_fax,project_vendor:d.project_vendor,sales_order_number:d.sales_order_number,project_item:d.project_item,items:c.map(e=>({line_number:e.line_number,item_name:e.item_name,specification:e.specification,quantity:e.quantity,unit_price_value:e.unit_price_value,amount_value:e.amount_value,remark:e.remark,currency:d.currency||"KRW"}))},C=await a(u),_=`발주서_${u.vendor_name}_${u.purchase_order_number}.xlsx`,v=window.URL.createObjectURL(C),h=document.createElement("a");h.href=v,h.download=_,document.body.appendChild(h),h.click(),document.body.removeChild(h),window.URL.revokeObjectURL(v),r.success("엑셀 파일이 다운로드되었습니다.");try{if(t&&t.includes("lead buyer")){const{error:t}=await i.from("purchase_requests").update({is_po_download:!0}).eq("purchase_order_number",e.purchase_order_number);t||l?.()}}catch(n){}}catch(o){throw r.error("엑셀 다운로드에 실패했습니다."),o}};export{d,a as g};
//# sourceMappingURL=excelDownload-CTQVGsiz.js.map
