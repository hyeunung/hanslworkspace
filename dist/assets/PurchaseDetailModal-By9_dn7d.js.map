{"version":3,"mappings":"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","names":["DollarSign","createLucideIcon","x1","x2","y1","y2","key","d","Truck","cx","cy","r","formatDate","formatDateISO","getCurrencySymbol","currency","includes","async","generatePurchaseOrderExcelJS","data","workbook","__vitePreload","import","then","n","e","__VITE_PRELOAD__","Workbook","sheet","addWorksheet","pageSetup","paperSize","orientation","fitToPage","fitToWidth","fitToHeight","horizontalCentered","verticalCentered","margins","left","right","top","bottom","header","footer","getRow","height","eachCell","cell","font","name","size","mergeCells","response","fetch","arrayBuffer","imageId","addImage","buffer","extension","dWidth","getColumn","width","logoWidth","Math","max","logoHeight","logoCol","logoRow","tl","col","row","ext","_e","getCell","value","alignment","horizontal","vertical","indent","bold","vendor_payment_schedule","vendor_name","vendor_contact_name","request_date","vendor_phone","vendor_fax","delivery_request_date","requester_name","purchase_order_number","tableHeaders","i","length","String","fromCharCode","sortedItems","items","sort","a","b","line_number","itemRows","sumRow","item","rowIdx","bCell","item_name","specification","quantity","unitSymbol","unitWithCurrency","unit_price_value","toLocaleString","trim","amountSymbol","amountWithCurrency","amount_value","gCell","remark","wrapText","shrinkToFit","c","totalSymbol","totalAmount","reduce","sum","lastRow","cellAddr","isItemRow","border","style","currentBorder","sumCellBorder","Object","entries","A","B","C","D","E","F","G","forEach","xlsx","writeBuffer","Blob","type","supabase","createClient","downloadPurchaseOrderExcel","purchase","currentUserRoles","onSuccessCallback","purchaseRequest","error","requestError","from","select","eq","single","toast","orderItems","itemsError","order","vendorInfo","vendorId","vendor_id","contactId","contact_id","vendorData","vendorError","contactData","contactError","contact_name","excelData","project_vendor","sales_order_number","project_item","map","blob","downloadFilename","url","window","URL","createObjectURL","document","createElement","href","download","body","appendChild","click","removeChild","revokeObjectURL","success","downloadFlagErr","update","is_po_download","flagErr","DatePickerPopover","children","onDateSelect","disabled","placeholder","align","side","open","setOpen","useState","jsxs","Popover","onOpenChange","jsx","PopoverTrigger","asChild","PopoverContent","className","sideOffset","Calendar","mode","selected","onSelect","date","logger","debug","isToday","Date","toDateString","dateValue","getTime","todayValue","dateString","todayString","handleDateSelect","locale","ko","initialFocus","fromDate","toDate","defaultMonth","modifiers","today","modifiersClassNames","DateAmountPickerPopover","onConfirm","defaultDate","defaultAmount","selectedDate","setSelectedDate","amount","setAmount","toString","Input","onChange","target","replace","numValue","parseInt","Button","variant","onClick","amountNum","parseFloat","isNaN","DateQuantityPickerPopover","defaultQuantity","maxQuantity","hideQuantityInput","quantityInfoText","setQuantity","min","quantityNum","useConfirmDateAction","config","currentUserName","canPerformAction","purchaseId","onUpdate","onOptimisticUpdate","handleConfirm","useCallback","itemId","itemInfo","receivedQuantity","warn","field","numericId","Number","confirmMessage","confirm","updateData","is_statement_received","statement_received_date","toISOString","statement_received_by_name","actual_received_date","is_received","received_quantity","info","markItemAsReceived","markItemAsStatementReceived","action","successMessage","handleCancel","cancel","itemName","markItemAsReceiptCanceled","markItemAsStatementCanceled","isCompleted","getCompletedDate","getCompletedByName","DONE_TAB_COLUMNS","id","label","description","defaultVisible","DEFAULT_COLUMN_VISIBILITY","acc","column","REQUIRED_COLUMNS","RESTRICTED_COLUMNS","AUTHORIZED_ROLES","COLUMN_GROUPS","title","columns","PurchaseDetailModal$1","memo","isOpen","onClose","embedded","activeTab","onRefresh","onDelete","allPurchases","lastFetch","usePurchaseMemory","loading","setLoading","setPurchase","isEditing","setIsEditing","editedPurchase","setEditedPurchase","editedItems","setEditedItems","deletedItemIds","setDeletedItemIds","userRoles","setUserRoles","setCurrentUserName","columnWidths","setColumnWidths","focusedInput","setFocusedInput","currentItems","useMemo","purchase_request_items","memoryPurchase","find","p","columnGap","padding","total","baseColumns","push","headerRowRef","useRef","useEffect","supabaseUrl","user","auth","getUser","employeeData","maybeSingle","email","employeeByEmail","purchase_role","roles","Array","isArray","split","filter","loadUserRoles","effectiveRoles","canEditAll","canEditLimited","canEdit","canViewFinancialInfo","some","role","canDelete","final_manager_status","canPurchase","canReceiveItems","isRequester","canReceiptCheck","canProcessReceipt","refreshModalData","findPurchaseInMemory","normalizedItems","purchaseData","is_po_generated","vendor","is_active","vendor_contacts","vendors","updatedPurchase","isInitialLoad","setIsInitialLoad","purchaseIdNumber","NaN","handleActualReceiptOptimisticUpdate","itemIdStr","nowIso","selectedDateIso","updateItems","received_at","prev","updatedItems","updatedRequestItems","completed","allReceived","updated_at","prevItems","prevPurchase","handleStatementReceivedOptimisticUpdate","nextAllCompleted","nextStatementAt","every","statement_received_at","allCompleted","statementReceivedAction","completedText","waitingText","actualReceivedAction","canApproveMiddle","canApproveFinal","approvalButtonClass","approvalWaitingPillClass","loadPurchaseDetail","calculateOptimalColumnWidths","columnConfigs","minWidth","maxWidth","baseWidth","isFixed","calculatedWidths","index","maxLength","headers","quantityHeader","baseHeaders","getHeaders","cellValue","getStatusDisplay","expenditure_date","expenditure_amount","adjustedLength","char","test","ceil","calculatedWidth","is_payment_completed","getGridTemplateColumns","join","hasItems","requestAnimationFrame","handleEditToggle","editing","formatCurrency","Intl","NumberFormat","format","handleItemChange","newItems","unitPrice","handleRemoveItem","_","handlePaymentToggle","purchaseItems","requestItems","targetItem","unit","payment_completed_at","markItemAsPaymentCompleted","markItemAsPaymentCanceled","prevRequestItems","payment_completed_by_name","refreshResult","silent","Promise","handleItemReceiptToggle","handleApprove","approvalType","middle_manager_status","handleItemExpenditure","totalExpenditure","total_expenditure_amount","markItemAsExpenditureSet","content","payment_category","category","getStatusBadge","Check","X","FileText","newStatus","is_utk_checked","updatePurchaseInMemory","CheckCircle","request_type","formatDateInput","revised_delivery_request_date","Building2","updatedContacts","order_number","Package","Fragment","allItems","pendingItems","CreditCard","applyOptimisticUpdate","itemReceivedQuantity","toLocaleDateString","year","month","day","pi","ref","gridTemplateColumns","onFocus","onBlur","whiteSpace","wordBreak","overflowWrap","hyphens","WebkitHyphens","MozHyphens","msHyphens","lineHeight","maxHeight","overflow","display","WebkitLineClamp","WebkitBoxOrient","hasReceived","boxSizing","Trash2","hasExpenditure","toLocaleTimeString","hour","minute","newItem","lineNum","Plus","Dialog","DialogContent","showCloseButton","DialogHeader","DialogTitle","Edit2","updateError","total_amount","deleteError","delete","in","Error","unit_price_currency","amount_currency","insertData","purchase_request_id","indexOf","created_at","insert","sourceData","deletedCount","removeItemFromMemory","memoryUpdated","newTotalAmount","itemsCount","finalItems","originalItemsCount","finalItemsCount","deletedItemsCount","errorMessage","message","Save"],"ignoreList":[0,1],"sources":["../../node_modules/lucide-react/dist/esm/icons/dollar-sign.js","../../node_modules/lucide-react/dist/esm/icons/truck.js","../../src/utils/exceljs/generatePurchaseOrderExcel.ts","../../src/utils/excelDownload.ts","../../src/components/ui/date-picker-popover.tsx","../../src/components/ui/date-amount-picker-popover.tsx","../../src/components/ui/date-quantity-picker-popover.tsx","../../src/hooks/useConfirmDateAction.ts","../../src/constants/columnSettings.ts","../../src/components/purchase/PurchaseDetailModal.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"line\", { x1: \"12\", x2: \"12\", y1: \"2\", y2: \"22\", key: \"7eqyqh\" }],\n  [\"path\", { d: \"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6\", key: \"1b0p4s\" }]\n];\nconst DollarSign = createLucideIcon(\"dollar-sign\", __iconNode);\n\nexport { __iconNode, DollarSign as default };\n//# sourceMappingURL=dollar-sign.js.map\n","/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2\", key: \"wrbu53\" }],\n  [\"path\", { d: \"M15 18H9\", key: \"1lyqi6\" }],\n  [\n    \"path\",\n    {\n      d: \"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14\",\n      key: \"lysw3i\"\n    }\n  ],\n  [\"circle\", { cx: \"17\", cy: \"18\", r: \"2\", key: \"332jqn\" }],\n  [\"circle\", { cx: \"7\", cy: \"18\", r: \"2\", key: \"19iecd\" }]\n];\nconst Truck = createLucideIcon(\"truck\", __iconNode);\n\nexport { __iconNode, Truck as default };\n//# sourceMappingURL=truck.js.map\n","// hanslwebapp    Excel \nimport { formatDateISO } from '@/utils/helpers';\n\nexport interface PurchaseOrderData {\n  purchase_order_number: string;\n  request_date: string;\n  delivery_request_date: string;\n  requester_name: string;\n  vendor_name: string;\n  vendor_contact_name?: string;\n  vendor_phone?: string;\n  vendor_fax?: string;\n  project_vendor: string;\n  sales_order_number: string;\n  project_item: string;\n  items: PurchaseOrderItem[];\n  vendor_payment_schedule?: string;\n}\n\nexport interface PurchaseOrderItem {\n  line_number: number;\n  item_name: string;\n  specification: string;\n  quantity: number;\n  unit_price_value: number;\n  amount_value: number;\n  remark: string;\n  currency: string;\n}\n\nconst formatDate = formatDateISO;\n\n// Helper: currency code to symbol\nfunction getCurrencySymbol(currency: string) {\n  if (!currency) return '';\n  if (['KRW', '', ''].includes(currency)) return '';\n  if (['USD', '$', ''].includes(currency)) return '$';\n  if (['EUR', ''].includes(currency)) return '';\n  if (['JPY', '', ''].includes(currency)) return '';\n  if (['CNY', '', ''].includes(currency)) return '';\n  return currency;\n}\n\n/**\n *    (ExcelJS) - hanslwebapp  \n * @param data PurchaseOrderData\n * @returns Blob (xlsx)\n */\nexport async function generatePurchaseOrderExcelJS(data: PurchaseOrderData): Promise<Blob> {\n  // ExcelJS  import    \n  const ExcelJS = await import('exceljs');\n  const workbook = new ExcelJS.Workbook();\n  \n  const sheet = workbook.addWorksheet('', {\n    pageSetup: {\n      paperSize: 9, // A4\n      orientation: 'portrait',\n      fitToPage: true,\n      fitToWidth: 1,\n      fitToHeight: 1,\n      horizontalCentered: true,\n      verticalCentered: true,\n      margins: {\n        left: 0.3,\n        right: 0.3,\n        top: 0.5,\n        bottom: 0.5,\n        header: 0.2,\n        footer: 0.2\n      }\n    }\n  });\n\n  //   : 1 39.75px(29.8pt), 2 18px(13.5pt)\n  sheet.getRow(1).height = 29.8; // 39.75px\n  for (let r = 2; r <= 60; r++) {\n    sheet.getRow(r).height = 15.75; // 21px15.75pt\n  }\n  //  : ,  11 (2), 1 20\n  // 1\n  sheet.getRow(1).eachCell(cell => {\n    cell.font = { ...(cell.font || {}), name: ' ', size: 20 };\n  });\n\n  //      (     bold )\n  for (let r = 2; r <= 60; r++) {\n    sheet.getRow(r).eachCell(cell => {\n      cell.font = { ...(cell.font || {}), name: ' ', size: 11 };\n    });\n  }\n\n  // 1.    1:1 \n  sheet.mergeCells('A1:G1');\n  sheet.mergeCells('A2:B2'); sheet.mergeCells('C2:D2'); sheet.mergeCells('F2:G2');\n  sheet.mergeCells('A3:B3'); sheet.mergeCells('C3:D3'); sheet.mergeCells('F3:G3');\n  sheet.mergeCells('A4:B4'); sheet.mergeCells('C4:D4'); sheet.mergeCells('F4:G4');\n  sheet.mergeCells('A5:B5'); sheet.mergeCells('C5:D5'); sheet.mergeCells('F5:G5');\n  sheet.mergeCells('A6:B6'); sheet.mergeCells('C6:D6'); sheet.mergeCells('F6:G6');\n  sheet.mergeCells('A7:B7'); sheet.mergeCells('C7:D7'); sheet.mergeCells('F7:G7');\n  // 8~46(//)  \n  //        \n  // ( sumRow   )\n\n  try {\n    const response = await fetch('/logo_KOR.png');\n    const arrayBuffer = await response.arrayBuffer();\n    const imageId = workbook.addImage({\n      buffer: arrayBuffer,\n      extension: 'png',\n    });\n    // ()  0.58col, ''      \n    // D width undefined/null/0  22 \n    const dWidth = sheet.getColumn('D').width || 22;\n    const logoWidth = Math.max(1, dWidth * 7.2 * 0.58) + 4; //  4px  \n    const logoHeight = 30 + 4; //  30 4px  \n    // D1  (3.5, 0.5)  2px(0.28col),  2px(0.13row) \n    const logoCol = 3.5 - 0.50;\n    const logoRow = 0.5 - 0.20;\n    sheet.addImage(imageId, {\n      tl: { col: logoCol, row: logoRow }, // D1    2px,  2px \n      ext: { width: logoWidth, height: logoHeight },\n    });\n  } catch (_e) {\n    // Logo loading failed, continue without logo\n  }\n\n  // 2.  (B1:H1 , )\n  sheet.getCell('D1').value = '                  ';\n  sheet.getCell('D1').alignment = { horizontal: 'left', vertical: 'middle', indent: 1 };\n  sheet.getCell('D1').font = { bold: true, size: 20 };\n\n  // 3.      ( )\n  sheet.getCell('A2').value = '      ';\n  sheet.getCell('A2').font = { bold: true };\n  sheet.getCell('A3').value = '      ';\n  sheet.getCell('A3').font = { bold: true };\n  sheet.getCell('A4').value = '      ';\n  sheet.getCell('A4').font = { bold: true };\n  sheet.getCell('A5').value = 'TEL.';\n  sheet.getCell('A5').font = { bold: true };\n  sheet.getCell('A6').value = 'FAX.';\n  sheet.getCell('A6').font = { bold: true };\n  sheet.getCell('A7').value = '';\n  sheet.getCell('A7').font = { bold: true };\n\n  sheet.getCell('E2').value = '';\n  sheet.getCell('E2').font = { bold: true };\n  sheet.getCell('E3').value = '         ';\n  sheet.getCell('E3').font = { bold: true };\n  sheet.getCell('E4').value = '   ';\n  sheet.getCell('E4').font = { bold: true };\n  sheet.getCell('E5').value = 'TEL.';\n  sheet.getCell('E5').font = { bold: true };\n  sheet.getCell('E6').value = 'FAX.';\n  sheet.getCell('E6').font = { bold: true };\n  sheet.getCell('E7').value = ' ';\n  sheet.getCell('E7').font = { bold: true };\n\n  sheet.getCell('F7').value = data.vendor_payment_schedule || '';\n\n  //  ()\n  sheet.getCell('C2').value = data.vendor_name;\n  sheet.getCell('C3').value = data.vendor_contact_name || '';\n  sheet.getCell('C4').value = formatDate(data.request_date);\n  sheet.getCell('C5').value = data.vendor_phone || '';\n  sheet.getCell('C6').value = data.vendor_fax || '';\n  sheet.getCell('C7').value = formatDate(data.delivery_request_date);\n\n  sheet.getCell('F2').value = data.requester_name;\n  sheet.getCell('F3').value = '  305';\n  sheet.getCell('F4').value = data.purchase_order_number;\n  sheet.getCell('F5').value = '(053) 626-7805';\n  sheet.getCell('F6').value = '(053) 657-7905';\n  sheet.getCell('F5').alignment = { horizontal: 'center', vertical: 'middle' };\n  sheet.getCell('F6').alignment = { horizontal: 'center', vertical: 'middle' };\n\n  // 8:  \n  const tableHeaders = ['No', '', '', '', '', '', ''];\n  for (let i = 0; i < tableHeaders.length; i++) {\n    sheet.getCell(String.fromCharCode(65 + i) + '8').value = tableHeaders[i];\n    sheet.getCell(String.fromCharCode(65 + i) + '8').font = { bold: true };\n    if(i===6){\n       sheet.getCell('G8').alignment = { horizontal:'center', vertical:'middle' };\n    }\n  }\n\n  //  45    /  \n  const baseRow = 9;\n  const minRows = 45;\n  // ---   line_number   ---\n  const sortedItems = [...data.items].sort((a, b) => a.line_number - b.line_number);\n  const itemRows = sortedItems.length;\n  const sumRow = baseRow + Math.max(itemRows, minRows); //  \n\n  //  \n  for (let i = 0; i < sortedItems.length; i++) {\n    const item = sortedItems[i];\n    const rowIdx = baseRow + i;\n    sheet.getCell('A' + rowIdx).value = item.line_number;\n    const bCell = sheet.getCell('B' + rowIdx);\n    bCell.value = item.item_name;\n    bCell.alignment = { horizontal: 'left', vertical: 'middle' };\n    sheet.getCell('C' + rowIdx).value = item.specification;\n    sheet.getCell('C' + rowIdx).alignment = { horizontal: 'left', vertical: 'middle' };\n    sheet.getCell('D' + rowIdx).value = item.quantity;\n    // (E) -   \n    const unitSymbol = getCurrencySymbol(item.currency);\n    const unitWithCurrency = (item.unit_price_value !== undefined && item.unit_price_value !== null)\n      ? `${item.unit_price_value.toLocaleString()} ${unitSymbol}`.trim()\n      : '';\n    sheet.getCell('E' + rowIdx).value = unitWithCurrency;\n    sheet.getCell('E' + rowIdx).alignment = { horizontal: 'right', vertical: 'middle' };\n\n    // (F) -   \n    const amountSymbol = getCurrencySymbol(item.currency);\n    const amountWithCurrency = (item.amount_value !== undefined && item.amount_value !== null)\n      ? `${item.amount_value.toLocaleString()} ${amountSymbol}`.trim()\n      : '';\n    sheet.getCell('F' + rowIdx).value = amountWithCurrency;\n    sheet.getCell('F' + rowIdx).alignment = { horizontal: 'right', vertical: 'middle' };\n    // G \n    const gCell = sheet.getCell('G' + rowIdx);\n    gCell.value = (item.remark !== undefined && item.remark !== null) ? String(item.remark) : '';\n    gCell.alignment = { horizontal: 'left', vertical: 'middle', wrapText: false, shrinkToFit: true };\n  }\n\n  //  45    \n  for (let i = itemRows; i < minRows; i++) {\n    const rowIdx = baseRow + i;\n    for (let c = 0; c < 7; c++) {\n      sheet.getCell(String.fromCharCode(65 + c) + rowIdx).value = '';\n    }\n  }\n\n  // \n  sheet.mergeCells(`A${sumRow}:E${sumRow}`);\n  sheet.getCell('A' + sumRow).value = '';\n  sheet.getCell('A' + sumRow).font = { bold: true };\n  const totalSymbol = getCurrencySymbol(data.items[0]?.currency);\n  const totalAmount = data.items.reduce((sum, item) => sum + (item.amount_value || 0), 0);\n  sheet.getCell('F' + sumRow).value = `${totalAmount.toLocaleString()} ${totalSymbol}`.trim();\n  sheet.getCell('F' + sumRow).alignment = { horizontal: 'right', vertical: 'middle' };\n\n  //         ()\n  const lastRow = sumRow;\n  for (let r = 1; r <= lastRow; r++) {\n    for (let c = 1; c <= 7; c++) {\n      const col = String.fromCharCode(64 + c); // A~G\n      const cellAddr = col + r;\n      const cell = sheet.getCell(cellAddr);\n      // E(5), F(6)   (/) , C(3)   () alignment  \n      const isPriceCol = (c === 5 || c === 6);\n      const isSpecCol = (c === 3);\n      const isItemRow = (r >= baseRow && r < sumRow);\n      const isSumRow = (r === sumRow);\n      if (!((isPriceCol && (isItemRow || isSumRow)) || (isSpecCol && isItemRow))) {\n        //    \n        cell.alignment = { horizontal: 'center', vertical: 'middle' };\n      }\n      //  : 2/8/(sumRow) , 8 ,  \n      cell.border = {\n        top:    { style: (r === 1) ? 'medium' : (r === 2 || r === 8 || r === sumRow) ? 'medium' : 'thin' },\n        left:   { style: c === 1 ? 'medium' : 'thin' },\n        right:  { style: c === 7 ? 'medium' : 'thin' },\n        bottom: { style: (r === 8 || r === sumRow || r === lastRow) ? 'medium' : 'thin' }\n      };\n    }\n  }\n  // (C) (  )    \n  for (let i = 0; i < itemRows; i++) {\n    const rowIdx = baseRow + i;\n    sheet.getCell('C' + rowIdx).alignment = { horizontal: 'left', vertical: 'middle' };\n  }\n\n  // B2:B7, D2:D7, E2:E6   \n  for (let r = 2; r <= 7; r++) {\n    sheet.getCell('B' + r).border = {\n      ...sheet.getCell('B' + r).border,\n      right: { style: 'medium' }\n    };\n    sheet.getCell('D' + r).border = {\n      ...sheet.getCell('D' + r).border,\n      right: { style: 'medium' }\n    };\n    if (r <= 6) {\n      sheet.getCell('E' + r).border = {\n        ...sheet.getCell('E' + r).border,\n        right: { style: 'medium' }\n      };\n    }\n  }\n  // E7, G7   ()\n  sheet.getCell('E7').border = {\n    ...sheet.getCell('E7').border,\n    top: { style: 'thin' },\n    right: { style: 'medium' }\n  };\n  sheet.getCell('G7').border = {\n    ...sheet.getCell('G7').border,\n    top: { style: 'thin' }\n  };\n\n  // A1~A7      ( )\n  for (let r = 1; r <= 7; r++) {\n    const currentBorder = sheet.getCell('A' + r).border || {};\n    sheet.getCell('A' + r).border = {\n      ...currentBorder,\n      left: { style: 'medium' }\n    };\n  }\n\n  //  (A)     \n  const sumCellBorder = sheet.getCell('A' + sumRow).border || {};\n  sheet.getCell('A' + sumRow).border = {\n    ...sumCellBorder,\n    left: { style: 'medium' }\n  };\n\n  //   ( )\n  const colWidths = { A:4.7, B:23, C:30, D:11, E:15, F:16, G:37 };\n  Object.entries(colWidths).forEach(([col, width]) => {\n    sheet.getColumn(col).width = width;\n  });\n\n  /* -----------------------------------\n        /  \n      1 : 39.75pt\n      2~lastRow : 18pt\n  ----------------------------------- */\n  sheet.getRow(1).height = 29.8; // 39.75px29.8pt\n  sheet.getRow(1).eachCell(c => { c.font = { ...(c.font || {}), name: ' ', size: 20 }; });\n\n  for (let r = 2; r <= lastRow; r++) {\n    const row = sheet.getRow(r);\n    row.height = 15.75; // 21px15.75pt\n    row.eachCell(c => {\n      c.font = { ...(c.font || {}), name: ' ', size: 11 };\n    });\n  }\n\n  // G       \n  for (let r = 9; r <= lastRow; r++) {\n    sheet.getCell('G' + r).alignment = { horizontal: 'left', vertical: 'middle', wrapText: false, shrinkToFit: true };\n    sheet.getCell('B' + r).alignment = { horizontal: 'left', vertical: 'middle' };\n  }\n\n  // 9.  \n  const buffer = await workbook.xlsx.writeBuffer();\n  return new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });\n}","//  Excel   -   \nimport { createClient } from '@/lib/supabase/client'\n\nconst supabase = createClient()\nimport { generatePurchaseOrderExcelJS } from '@/utils/exceljs/generatePurchaseOrderExcel'\nimport type { PurchaseOrderData } from '@/utils/exceljs/generatePurchaseOrderExcel'\nimport { toast } from 'sonner'\n\nexport interface Purchase {\n  id?: number\n  purchase_order_number: string\n  vendor_name: string\n  vendor_id?: string\n  contact_id?: string\n}\n\n/**\n *  Excel   -    \n *  handleExcelDownload    \n */\nexport const downloadPurchaseOrderExcel = async (\n  purchase: Purchase, \n  currentUserRoles?: string[],\n  onSuccessCallback?: () => void\n) => {\n  try {\n    // DB    \n    const { data: purchaseRequest, error: requestError } = await supabase\n      .from('purchase_requests')\n      .select('*')\n      .eq('purchase_order_number', purchase.purchase_order_number)\n      .single();\n\n    if (requestError || !purchaseRequest) {\n      toast.error('     .');\n      return;\n    }\n\n    //   \n    const { data: orderItems, error: itemsError } = await supabase\n      .from('purchase_request_items')\n      .select('*')\n      .eq('purchase_order_number', purchase.purchase_order_number)\n      .order('line_number');\n\n    if (itemsError || !orderItems || orderItems.length === 0) {\n      toast.error('      .');\n      return;\n    }\n\n    //       \n    const vendorInfo = {\n      vendor_name: purchase.vendor_name,\n      vendor_phone: '',\n      vendor_fax: '',\n      vendor_contact_name: ''\n    };\n\n    try {\n      const vendorId = purchaseRequest.vendor_id || purchase.vendor_id;\n      const contactId = purchaseRequest.contact_id || purchase.contact_id;\n      \n      // vendor  \n      if (vendorId) {\n        const { data: vendorData, error: vendorError } = await supabase\n          .from('vendors')\n          .select('vendor_phone, vendor_fax')\n          .eq('id', vendorId)\n          .single();\n\n        if (vendorData && !vendorError) {\n          vendorInfo.vendor_phone = vendorData.vendor_phone || '';\n          vendorInfo.vendor_fax = vendorData.vendor_fax || '';\n        }\n      }\n\n      // vendor_contacts contact_id   \n      if (contactId) {\n        const { data: contactData, error: contactError } = await supabase\n          .from('vendor_contacts')\n          .select('contact_name, contact_phone, contact_email')\n          .eq('id', contactId)\n          .single();\n        if (contactData && !contactError) {\n          vendorInfo.vendor_contact_name = contactData.contact_name || '';\n        }\n      }\n    } catch (error) {\n      //       \n    }\n\n    const excelData: PurchaseOrderData = {\n      purchase_order_number: purchaseRequest.purchase_order_number || '',\n      request_date: purchaseRequest.request_date,\n      delivery_request_date: purchaseRequest.delivery_request_date,\n      requester_name: purchaseRequest.requester_name,\n      vendor_name: vendorInfo.vendor_name || '',\n      vendor_contact_name: vendorInfo.vendor_contact_name,\n      vendor_phone: vendorInfo.vendor_phone,\n      vendor_fax: vendorInfo.vendor_fax,\n      project_vendor: purchaseRequest.project_vendor,\n      sales_order_number: purchaseRequest.sales_order_number,\n      project_item: purchaseRequest.project_item,\n      items: orderItems.map((item: any) => ({\n        line_number: item.line_number,\n        item_name: item.item_name,\n        specification: item.specification,\n        quantity: item.quantity,\n        unit_price_value: item.unit_price_value,\n        amount_value: item.amount_value,\n        remark: item.remark,\n        currency: purchaseRequest.currency || 'KRW'\n      }))\n    };\n\n    //   ExcelJS  (    )\n    const blob = await generatePurchaseOrderExcelJS(excelData);\n    \n    //  : _{}_\n    const downloadFilename = `_${excelData.vendor_name}_${excelData.purchase_order_number}.xlsx`;\n\n    //    \n    const url = window.URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = downloadFilename;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    window.URL.revokeObjectURL(url);\n    \n    toast.success('  .');\n    \n    // DB   (is_po_download)  - lead buyer \n    try {\n      const isLeadBuyer = currentUserRoles && currentUserRoles.includes('lead buyer');\n\n      if (isLeadBuyer) {\n        const { error: downloadFlagErr } = await supabase\n          .from('purchase_requests')\n          .update({ is_po_download: true })\n          .eq('purchase_order_number', purchase.purchase_order_number);\n        \n        if (!downloadFlagErr) {\n          //    (UI )\n          onSuccessCallback?.();\n        }\n      }\n    } catch (flagErr) {\n      //      \n    }\n  } catch (error) {\n    console.error(' Excel  :', error);\n    toast.error('  .');\n    throw error;\n  }\n};","import { useState } from 'react'\nimport { Calendar } from '@/components/ui/calendar'\nimport { Button } from '@/components/ui/button'\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from '@/components/ui/popover'\nimport { Calendar as CalendarIcon } from 'lucide-react'\nimport { format } from 'date-fns'\nimport { ko } from 'date-fns/locale'\nimport { cn } from '@/lib/utils'\nimport { logger } from '@/lib/logger'\n\ninterface DatePickerPopoverProps {\n  children: React.ReactNode\n  onDateSelect: (date: Date) => void\n  disabled?: boolean\n  placeholder?: string\n  align?: \"center\" | \"start\" | \"end\"\n  side?: \"top\" | \"right\" | \"bottom\" | \"left\"\n}\n\nexport function DatePickerPopover({\n  children,\n  onDateSelect,\n  disabled = false,\n  placeholder = \" \",\n  align = \"center\",\n  side = \"bottom\"\n}: DatePickerPopoverProps) {\n  const [open, setOpen] = useState(false)\n\n  const handleDateSelect = (date: Date | undefined) => {\n    logger.debug(' DatePickerPopover handleDateSelect :', { \n      date, \n      isToday: date && new Date().toDateString() === date.toDateString(),\n      dateString: date?.toDateString(),\n      todayString: new Date().toDateString()\n    });\n    if (date) {\n      logger.debug('  , onDateSelect  ');\n      onDateSelect(date)\n      setOpen(false) //     \n      logger.debug(' DatePickerPopover  ');\n    } else {\n      logger.debug('  undefined');\n    }\n  }\n\n  return (\n    <Popover open={open} onOpenChange={setOpen}>\n      <PopoverTrigger asChild disabled={disabled}>\n        {children}\n      </PopoverTrigger>\n      <PopoverContent \n        className=\"w-auto p-0 border-gray-200 shadow-lg\" \n        align={align}\n        side={side}\n        sideOffset={8}\n      >\n        <div className=\"bg-white business-radius-card p-2\">\n          <div className=\"mb-2 px-1\">\n            <div className=\"modal-label text-gray-600 text-center\">\n              {placeholder}\n            </div>\n          </div>\n          <Calendar\n            mode=\"single\"\n            selected={undefined}\n            onSelect={(date) => {\n              logger.debug(' Calendar onSelect  :', { \n                date, \n                isToday: date && new Date().toDateString() === date.toDateString(),\n                dateValue: date?.getTime(),\n                todayValue: new Date().getTime()\n              });\n              handleDateSelect(date);\n            }}\n            locale={ko}\n            initialFocus\n            className=\"compact-calendar\"\n            disabled={false}\n            fromDate={new Date('2020-01-01')}\n            toDate={new Date('2030-12-31')}\n            defaultMonth={new Date()}\n            modifiers={{\n              today: new Date()\n            }}\n            modifiersClassNames={{\n              today: \"bg-blue-500 text-white font-semibold cursor-pointer hover:bg-blue-600 rounded-md\"\n            }}\n          />\n        </div>\n      </PopoverContent>\n    </Popover>\n  )\n}","import { useState } from 'react'\nimport { Calendar } from '@/components/ui/calendar'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from '@/components/ui/popover'\nimport { Calendar as CalendarIcon } from 'lucide-react'\nimport { format } from 'date-fns'\nimport { ko } from 'date-fns/locale'\nimport { cn } from '@/lib/utils'\nimport { logger } from '@/lib/logger'\n\ninterface DateAmountPickerPopoverProps {\n  children: React.ReactNode\n  onConfirm: (date: Date, amount: number) => void\n  disabled?: boolean\n  placeholder?: string\n  align?: \"center\" | \"start\" | \"end\"\n  side?: \"top\" | \"right\" | \"bottom\" | \"left\"\n  defaultDate?: Date\n  defaultAmount?: number\n}\n\nexport function DateAmountPickerPopover({\n  children,\n  onConfirm,\n  disabled = false,\n  placeholder = \"  \",\n  align = \"center\",\n  side = \"bottom\",\n  defaultDate,\n  defaultAmount\n}: DateAmountPickerPopoverProps) {\n  const [open, setOpen] = useState(false)\n  const [selectedDate, setSelectedDate] = useState<Date | undefined>(defaultDate)\n  const [amount, setAmount] = useState<string>(defaultAmount?.toString() || '')\n\n  const handleConfirm = () => {\n    if (!selectedDate) {\n      return\n    }\n    \n    const amountNum = parseFloat(amount.replace(/,/g, ''))\n    if (isNaN(amountNum) || amountNum <= 0) {\n      return\n    }\n\n    onConfirm(selectedDate, amountNum)\n    setOpen(false)\n    // Reset after close\n    setSelectedDate(defaultDate)\n    setAmount(defaultAmount?.toString() || '')\n  }\n\n  const handleAmountChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const value = e.target.value.replace(/[^0-9]/g, '')\n    if (value) {\n      const numValue = parseInt(value, 10)\n      setAmount(numValue.toLocaleString())\n    } else {\n      setAmount('')\n    }\n  }\n\n  return (\n    <Popover open={open} onOpenChange={setOpen}>\n      <PopoverTrigger asChild disabled={disabled}>\n        {children}\n      </PopoverTrigger>\n      <PopoverContent \n        className=\"w-auto p-0 border-gray-200 shadow-lg\" \n        align={align}\n        side={side}\n        sideOffset={8}\n      >\n        <div className=\"bg-white business-radius-card p-3\">\n          <div className=\"mb-2 px-1\">\n            <div className=\"modal-label text-gray-600 text-center\">\n              {placeholder}\n            </div>\n          </div>\n          <Calendar\n            mode=\"single\"\n            selected={selectedDate}\n            onSelect={setSelectedDate}\n            locale={ko}\n            initialFocus\n            className=\"compact-calendar\"\n            disabled={false}\n            fromDate={new Date('2020-01-01')}\n            toDate={new Date('2030-12-31')}\n            defaultMonth={selectedDate || new Date()}\n            modifiers={{\n              today: new Date()\n            }}\n            modifiersClassNames={{\n              today: \"bg-blue-500 text-white font-semibold cursor-pointer hover:bg-blue-600 rounded-md\"\n            }}\n          />\n          <div className=\"mt-3 px-1\">\n            <label className=\"block text-xs font-medium text-gray-700 mb-1\">\n              \n            </label>\n            <Input\n              type=\"text\"\n              value={amount}\n              onChange={handleAmountChange}\n              placeholder=\" \"\n              className=\"w-full\"\n            />\n          </div>\n          <div className=\"mt-3 flex justify-end gap-2\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => setOpen(false)}\n            >\n              \n            </Button>\n            <Button\n              size=\"sm\"\n              onClick={handleConfirm}\n              disabled={!selectedDate || !amount || parseFloat(amount.replace(/,/g, '')) <= 0}\n              className=\"button-base button-action-primary\"\n            >\n              \n            </Button>\n          </div>\n        </div>\n      </PopoverContent>\n    </Popover>\n  )\n}\n\n","import { useState } from 'react'\nimport { Calendar } from '@/components/ui/calendar'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from '@/components/ui/popover'\nimport { Calendar as CalendarIcon } from 'lucide-react'\nimport { format } from 'date-fns'\nimport { ko } from 'date-fns/locale'\nimport { cn } from '@/lib/utils'\nimport { logger } from '@/lib/logger'\n\ninterface DateQuantityPickerPopoverProps {\n  children: React.ReactNode\n  onConfirm: (date: Date, quantity?: number) => void\n  disabled?: boolean\n  placeholder?: string\n  align?: \"center\" | \"start\" | \"end\"\n  side?: \"top\" | \"right\" | \"bottom\" | \"left\"\n  defaultDate?: Date\n  defaultQuantity?: number\n  maxQuantity?: number\n  hideQuantityInput?: boolean\n  quantityInfoText?: string\n}\n\nexport function DateQuantityPickerPopover({\n  children,\n  onConfirm,\n  disabled = false,\n  placeholder = \"  \",\n  align = \"center\",\n  side = \"bottom\",\n  defaultDate,\n  defaultQuantity,\n  maxQuantity,\n  hideQuantityInput = false,\n  quantityInfoText = \"   \"\n}: DateQuantityPickerPopoverProps) {\n  const [open, setOpen] = useState(false)\n  const [selectedDate, setSelectedDate] = useState<Date | undefined>(defaultDate)\n  const [quantity, setQuantity] = useState<string>(defaultQuantity?.toString() || '')\n\n  const handleConfirm = () => {\n    if (!selectedDate) {\n      return\n    }\n    \n    if (hideQuantityInput) {\n      //     ( ), quantity undefined \n      onConfirm(selectedDate, undefined)\n      setOpen(false)\n      // Reset after close\n      setSelectedDate(defaultDate)\n      setQuantity(defaultQuantity?.toString() || '')\n      return\n    }\n    \n    const quantityNum = parseFloat(quantity.replace(/,/g, ''))\n    if (isNaN(quantityNum) || quantityNum < 0) {\n      return\n    }\n\n    if (maxQuantity && quantityNum > maxQuantity) {\n      return\n    }\n\n    onConfirm(selectedDate, quantityNum)\n    setOpen(false)\n    // Reset after close\n    setSelectedDate(defaultDate)\n    setQuantity(defaultQuantity?.toString() || '')\n  }\n\n  const handleQuantityChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const value = e.target.value.replace(/[^0-9]/g, '')\n    setQuantity(value)\n  }\n\n  return (\n    <Popover open={open} onOpenChange={setOpen}>\n      <PopoverTrigger asChild disabled={disabled}>\n        {children}\n      </PopoverTrigger>\n      <PopoverContent \n        className=\"w-auto p-0 border-gray-200 shadow-lg\" \n        align={align}\n        side={side}\n        sideOffset={8}\n      >\n        <div className=\"bg-white business-radius-card p-3\">\n          <div className=\"mb-2 px-1\">\n            <div className=\"modal-label text-gray-600 text-center\">\n              {placeholder}\n            </div>\n          </div>\n          {hideQuantityInput && (\n            <div className=\"mb-2 px-1\">\n              <div className=\"text-[10px] text-gray-500 text-center leading-tight\">\n                <div> </div>\n                <div> </div>\n              </div>\n            </div>\n          )}\n          <Calendar\n            mode=\"single\"\n            selected={selectedDate}\n            onSelect={setSelectedDate}\n            locale={ko}\n            initialFocus\n            className=\"compact-calendar\"\n            disabled={false}\n            fromDate={new Date('2020-01-01')}\n            toDate={new Date('2030-12-31')}\n            defaultMonth={selectedDate || new Date()}\n            modifiers={{\n              today: new Date()\n            }}\n            modifiersClassNames={{\n              today: \"bg-blue-500 text-white font-semibold cursor-pointer hover:bg-blue-600 rounded-md\"\n            }}\n          />\n          {!hideQuantityInput && (\n            <div className=\"mt-3 px-1\">\n              <label className=\"block text-xs font-medium text-gray-700 mb-1\">\n                \n              </label>\n              <Input\n                type=\"number\"\n                value={quantity}\n                onChange={handleQuantityChange}\n                placeholder=\" \"\n                className=\"border-gray-200 rounded-lg text-center w-full !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400\"\n                min=\"0\"\n                max={maxQuantity}\n              />\n              {maxQuantity && (\n                <p className=\"text-xs text-gray-500 mt-1\">: {maxQuantity.toLocaleString()}</p>\n              )}\n            </div>\n          )}\n          <div className=\"mt-3 flex justify-end gap-2\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => setOpen(false)}\n              className=\"button-base\"\n            >\n              \n            </Button>\n            <Button\n              size=\"sm\"\n              onClick={handleConfirm}\n              disabled={!selectedDate || (!hideQuantityInput && (!quantity || parseFloat(quantity.replace(/,/g, '')) < 0 || (maxQuantity !== undefined && parseFloat(quantity.replace(/,/g, '')) > maxQuantity)))}\n              className=\"button-base button-action-primary\"\n            >\n              \n            </Button>\n          </div>\n        </div>\n      </PopoverContent>\n    </Popover>\n  )\n}\n\n","import { useCallback } from 'react'\nimport { createClient } from '@/lib/supabase/client'\nimport { toast } from 'sonner'\nimport { logger } from '@/lib/logger'\nimport { markItemAsReceived, markItemAsReceiptCanceled, markItemAsStatementReceived, markItemAsStatementCanceled } from '@/stores/purchaseMemoryStore'\n\nexport interface ConfirmDateActionConfig {\n  field: 'statement_received' | 'actual_received'\n  confirmMessage: {\n    confirm: string\n    cancel: string\n  }\n  successMessage: {\n    confirm: string\n    cancel: string\n  }\n  completedText: string\n  waitingText: string\n}\n\nexport interface UseConfirmDateActionProps {\n  config: ConfirmDateActionConfig\n  currentUserName: string | null\n  canPerformAction: boolean\n  purchaseId?: number | string  //     purchase ID\n  onUpdate?: () => void\n  onOptimisticUpdate?: (params: {\n    itemId: number\n    selectedDate?: Date\n    action: 'confirm' | 'cancel'\n    receivedQuantity?: number\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n      received_quantity?: number\n    }\n  }) => void\n}\n\nexport function useConfirmDateAction({\n  config,\n  currentUserName,\n  canPerformAction,\n  purchaseId,\n  onUpdate,\n  onOptimisticUpdate\n}: UseConfirmDateActionProps) {\n  const supabase = createClient()\n\n  const handleConfirm = useCallback(async (\n    itemId: number | string,\n    selectedDate: Date,\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n      received_quantity?: number\n    },\n    receivedQuantity?: number\n  ) => {\n    \n    if (!canPerformAction) {\n      logger.warn(`  `, { canPerformAction, currentUserName })\n      toast.error(`${config.field === 'statement_received' ? '' : ''}   .`)\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      logger.error('  ID', { itemId, numericId })\n      toast.error('   ID .')\n      return\n    }\n\n    //   \n    if (itemInfo) {\n      const confirmMessage = `: ${itemInfo.item_name || '-'}\n: ${itemInfo.specification || '-'}\n: ${itemInfo.quantity?.toLocaleString() || 0}\n: ${itemInfo.unit_price_value?.toLocaleString() || 0}\n: ${itemInfo.amount_value?.toLocaleString() || 0}\n: ${itemInfo.remark || '-'}\n\n${config.confirmMessage.confirm}`\n      \n      if (!window.confirm(confirmMessage)) {\n        return\n      }\n    }\n\n    try {\n      let updateData: any\n\n      if (config.field === 'statement_received') {\n        updateData = {\n          is_statement_received: true,\n          statement_received_date: selectedDate.toISOString(),\n          statement_received_by_name: currentUserName\n        }\n      } else if (config.field === 'actual_received') {\n        updateData = {\n          actual_received_date: selectedDate.toISOString(),\n          is_received: true,\n          received_quantity: receivedQuantity !== undefined ? receivedQuantity : (itemInfo?.received_quantity !== undefined ? itemInfo.received_quantity : null)\n        }\n      }\n\n      logger.debug('  :', updateData)\n\n      const { data, error } = await supabase\n        .from('purchase_request_items')\n        .update(updateData)\n        .eq('id', numericId)\n        .select()\n\n      logger.debug(' DB  :', { data, error })\n\n      if (error) {\n        logger.error(' DB  ', error)\n        throw error\n      }\n\n      logger.info(' DB  ', data)\n\n      //     \n      if (purchaseId) {\n        if (config.field === 'actual_received') {\n          const memoryUpdated = markItemAsReceived(purchaseId, numericId, selectedDate.toISOString(), receivedQuantity)\n          if (!memoryUpdated) {\n            logger.warn('[useConfirmDateAction]     ', { \n              purchaseId, \n              itemId: numericId \n            })\n          }\n        } else if (config.field === 'statement_received') {\n          const memoryUpdated = markItemAsStatementReceived(purchaseId, numericId, selectedDate.toISOString(), currentUserName || undefined)\n          if (!memoryUpdated) {\n            logger.warn('[useConfirmDateAction]      ', { \n              purchaseId, \n              itemId: numericId \n            })\n          }\n        }\n      }\n\n      if (onOptimisticUpdate) {\n        onOptimisticUpdate({\n          itemId: numericId,\n          selectedDate,\n          action: 'confirm',\n          receivedQuantity: receivedQuantity !== undefined ? receivedQuantity : itemInfo?.received_quantity,\n          itemInfo\n        })\n      }\n\n      //    onUpdate \n      if (onUpdate) {\n        onUpdate()\n      }\n      \n      toast.success(config.successMessage.confirm)\n    } catch (error) {\n      logger.error('   ', error)\n      toast.error(`${config.field === 'statement_received' ? '' : ''}     .`)\n    }\n  }, [config, currentUserName, canPerformAction, purchaseId, onUpdate, onOptimisticUpdate, supabase])\n\n  const handleCancel = useCallback(async (\n    itemId: number | string,\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n    }\n  ) => {\n    if (!canPerformAction) {\n      logger.warn(`   `, { canPerformAction, currentUserName })\n      toast.error(`${config.field === 'statement_received' ? '' : ''}   .`)\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      toast.error('   ID .')\n      return\n    }\n\n    //   \n    if (itemInfo) {\n      const confirmMessage = `: ${itemInfo.item_name || '-'}\n: ${itemInfo.specification || '-'}\n: ${itemInfo.quantity?.toLocaleString() || 0}\n: ${itemInfo.unit_price_value?.toLocaleString() || 0}\n: ${itemInfo.amount_value?.toLocaleString() || 0}\n: ${itemInfo.remark || '-'}\n\n${config.confirmMessage.cancel}`\n      \n      if (!window.confirm(confirmMessage)) {\n        return\n      }\n    }\n\n    try {\n      logger.debug(` ${config.field}   `, { \n        itemId, \n        itemName: itemInfo?.item_name \n      })\n\n      let updateData: any\n\n      if (config.field === 'statement_received') {\n        updateData = {\n          is_statement_received: false,\n          statement_received_date: null,\n          statement_received_by_name: null\n        }\n      } else if (config.field === 'actual_received') {\n        updateData = {\n          actual_received_date: null,\n          is_received: false\n        }\n      }\n\n      logger.debug('   :', updateData)\n\n      const { data, error } = await supabase\n        .from('purchase_request_items')\n        .update(updateData)\n        .eq('id', numericId)\n        .select()\n\n      logger.debug('  DB  :', { data, error })\n\n      if (error) {\n        logger.error(' DB  ', error)\n        throw error\n      }\n\n      logger.info(` ${config.field}   `, data)\n\n      //     \n      if (purchaseId) {\n        if (config.field === 'actual_received') {\n          const memoryUpdated = markItemAsReceiptCanceled(purchaseId, numericId)\n          if (!memoryUpdated) {\n            logger.warn('[useConfirmDateAction]     ', { \n              purchaseId, \n              itemId: numericId \n            })\n          }\n        } else if (config.field === 'statement_received') {\n          const memoryUpdated = markItemAsStatementCanceled(purchaseId, numericId)\n          if (!memoryUpdated) {\n            logger.warn('[useConfirmDateAction]      ', { \n              purchaseId, \n              itemId: numericId \n            })\n          }\n        }\n      }\n\n      if (onOptimisticUpdate) {\n        onOptimisticUpdate({\n          itemId: numericId,\n          action: 'cancel',\n          itemInfo\n        })\n      }\n\n      //    onUpdate \n      if (onUpdate) {\n        onUpdate()\n      }\n      \n      toast.success(config.successMessage.cancel)\n    } catch (error) {\n      logger.error(` ${config.field}   `, error)\n      toast.error(`${config.field === 'statement_received' ? '' : ''}     .`)\n    }\n  }, [config, canPerformAction, purchaseId, onUpdate, onOptimisticUpdate, supabase])\n\n  const isCompleted = useCallback((item: any) => {\n    if (config.field === 'statement_received') {\n      return item.is_statement_received\n    } else if (config.field === 'actual_received') {\n      return item.is_received // actual_received_date  is_received  \n    }\n    return false\n  }, [config.field])\n\n  const getCompletedDate = useCallback((item: any) => {\n    if (config.field === 'statement_received') {\n      return item.statement_received_date\n    } else if (config.field === 'actual_received') {\n      return item.actual_received_date\n    }\n    return null\n  }, [config.field])\n\n  const getCompletedByName = useCallback((item: any) => {\n    if (config.field === 'statement_received') {\n      return item.statement_received_by_name\n    } else if (config.field === 'actual_received') {\n      //     \n      return null\n    }\n    return null\n  }, [config.field])\n\n  return {\n    config,\n    handleConfirm,\n    handleCancel,\n    isCompleted,\n    getCompletedDate,\n    getCompletedByName\n  }\n}","import { ColumnInfo, DoneTabColumnId, ColumnVisibility } from '@/types/columnSettings';\n\n/**\n *     \n * 22     \n */\n\n//     ( )\nexport const DONE_TAB_COLUMNS: ColumnInfo[] = [\n  {\n    id: 'statement_progress',\n    label: '',\n    description: '  ',\n    defaultVisible: true,\n  },\n  {\n    id: 'purchase_order_number',\n    label: '',\n    description: ' ',\n    defaultVisible: true,\n  },\n  {\n    id: 'payment_category',\n    label: '',\n    description: '  (, ,  )',\n    defaultVisible: true,\n  },\n  {\n    id: 'requester_name',\n    label: '',\n    description: '  ',\n    defaultVisible: true,\n  },\n  {\n    id: 'request_date',\n    label: '',\n    description: '  ',\n    defaultVisible: true,\n  },\n  {\n    id: 'utk_status',\n    label: 'UTK',\n    description: 'UTK  ',\n    defaultVisible: true,\n  },\n  {\n    id: 'vendor_name',\n    label: '',\n    description: '',\n    defaultVisible: true,\n  },\n  {\n    id: 'contact_name',\n    label: '',\n    description: ' ',\n    defaultVisible: true,\n  },\n  {\n    id: 'delivery_request_date',\n    label: '',\n    description: '  ',\n    defaultVisible: true,\n  },\n  {\n    id: 'revised_delivery_date',\n    label: '',\n    description: '  ',\n    defaultVisible: true,\n  },\n  {\n    id: 'item_name',\n    label: '',\n    description: ' ',\n    defaultVisible: true,\n  },\n  {\n    id: 'specification',\n    label: '',\n    description: '  ',\n    defaultVisible: true,\n  },\n  {\n    id: 'quantity',\n    label: '',\n    description: ' ',\n    defaultVisible: true,\n  },\n  {\n    id: 'unit_price',\n    label: '',\n    description: ' ',\n    defaultVisible: true,\n  },\n  {\n    id: 'amount',\n    label: '',\n    description: ' ',\n    defaultVisible: true,\n  },\n  {\n    id: 'remark',\n    label: '',\n    description: '  ',\n    defaultVisible: true,\n  },\n  {\n    id: 'link',\n    label: '',\n    description: ' ',\n    defaultVisible: true,\n  },\n  {\n    id: 'project_vendor',\n    label: 'PJ',\n    description: ' ',\n    defaultVisible: true,\n  },\n  {\n    id: 'project_item',\n    label: 'PJ ITEM',\n    description: ' ',\n    defaultVisible: true,\n  },\n  {\n    id: 'sales_order_number',\n    label: '',\n    description: ' ',\n    defaultVisible: true,\n  },\n  {\n    id: 'purchase_progress',\n    label: '',\n    description: ' ',\n    defaultVisible: true,\n  },\n  {\n    id: 'receipt_progress',\n    label: '',\n    description: ' ',\n    defaultVisible: true,\n  },\n];\n\n//     (  )\nexport const DEFAULT_COLUMN_VISIBILITY: ColumnVisibility = DONE_TAB_COLUMNS.reduce(\n  (acc, column) => {\n    acc[column.id] = column.defaultVisible;\n    return acc;\n  },\n  {} as ColumnVisibility\n);\n\n//  ID    \nexport const COLUMN_INFO_MAP: Record<DoneTabColumnId, ColumnInfo> = DONE_TAB_COLUMNS.reduce(\n  (acc, column) => {\n    acc[column.id] = column;\n    return acc;\n  },\n  {} as Record<DoneTabColumnId, ColumnInfo>\n);\n\n//   (   )\nexport const REQUIRED_COLUMNS: DoneTabColumnId[] = [\n  'purchase_order_number',\n  'vendor_name',\n  'item_name',\n  'specification',\n];\n\n//    (     )\nexport const RESTRICTED_COLUMNS: DoneTabColumnId[] = [\n  'statement_progress',  // \n  'utk_status',         // UTK\n  'unit_price',         // \n  'amount',            // ( )\n];\n\n//   \nexport const AUTHORIZED_ROLES = [\n  'app_admin',\n  'ceo',\n  'final_approver',\n  'purchase_manager',\n];\n\n//   ( UI )\nexport const COLUMN_GROUPS = [\n  {\n    title: ' ',\n    columns: [\n      'statement_progress',\n      'purchase_order_number',\n      'payment_category',\n      'requester_name',\n      'request_date',\n      'utk_status',\n    ] as DoneTabColumnId[],\n  },\n  {\n    title: ' ',\n    columns: [\n      'vendor_name',\n      'contact_name',\n      'delivery_request_date',\n      'revised_delivery_date',\n    ] as DoneTabColumnId[],\n  },\n  {\n    title: ' ',\n    columns: [\n      'item_name',\n      'specification',\n      'quantity',\n      'unit_price',\n      'amount',\n      'remark',\n      'link',\n    ] as DoneTabColumnId[],\n  },\n  {\n    title: ' ',\n    columns: [\n      'project_vendor',\n      'project_item',\n      'sales_order_number',\n    ] as DoneTabColumnId[],\n  },\n  {\n    title: ' ',\n    columns: [\n      'purchase_progress',\n      'receipt_progress',\n    ] as DoneTabColumnId[],\n  },\n] as const;","import { useEffect, useState, useRef, useCallback, useMemo, memo } from 'react'\nimport { createClient } from '@/lib/supabase/client'\nimport { PurchaseRequestWithDetails, Purchase, Vendor } from '@/types/purchase'\nimport { findPurchaseInMemory, markItemAsPaymentCompleted, markPurchaseAsPaymentCompleted, markItemAsReceived, markPurchaseAsReceived, markItemAsPaymentCanceled, markItemAsStatementReceived, markItemAsStatementCanceled, usePurchaseMemory, updatePurchaseInMemory, removeItemFromMemory, markItemAsExpenditureSet } from '@/stores/purchaseMemoryStore'\nimport { formatDate } from '@/utils/helpers'\nimport { DatePickerPopover } from '@/components/ui/date-picker-popover'\nimport { DateAmountPickerPopover } from '@/components/ui/date-amount-picker-popover'\nimport { DateQuantityPickerPopover } from '@/components/ui/date-quantity-picker-popover'\nimport { \n  Calendar, \n  User, \n  Building2, \n  Package, \n  CreditCard,\n  X,\n  FileText,\n  DollarSign,\n  Edit2,\n  Trash2,\n  Save,\n  Plus,\n  CheckCircle,\n  XCircle,\n  Check,\n  Truck\n} from 'lucide-react'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog'\nimport { toast } from 'sonner'\nimport { logger } from '@/lib/logger'\nimport { useConfirmDateAction } from '@/hooks/useConfirmDateAction'\nimport { format as formatDateInput } from 'date-fns'\nimport { AUTHORIZED_ROLES } from '@/constants/columnSettings'\n\ninterface PurchaseDetailModalProps {\n  purchaseId: number | null\n  isOpen: boolean\n  onClose: () => void\n  embedded?: boolean  // Dialog   \n  currentUserRoles?: string[]\n  activeTab?: string\n  onRefresh?: (forceRefresh?: boolean, options?: { silent?: boolean }) => void | Promise<void>\n  onOptimisticUpdate?: (purchaseId: number, updater: (prev: Purchase) => Purchase) => void\n  onDelete?: (purchase: PurchaseRequestWithDetails) => void\n}\n\nfunction PurchaseDetailModal({ \n  purchaseId, \n  isOpen, \n  onClose, \n  embedded = false,\n  currentUserRoles = [],\n  activeTab,\n  onRefresh,\n  onOptimisticUpdate,\n  onDelete\n}: PurchaseDetailModalProps) {\n  const { allPurchases, lastFetch } = usePurchaseMemory(); //     \n  \n  const [loading, setLoading] = useState(false)\n  const [purchase, setPurchase] = useState<PurchaseRequestWithDetails | null>(null)\n  const [isEditing, setIsEditing] = useState(false)\n  const [editedPurchase, setEditedPurchase] = useState<PurchaseRequestWithDetails | null>(null)\n  const [editedItems, setEditedItems] = useState<any[]>([])\n  const [deletedItemIds, setDeletedItemIds] = useState<number[]>([])\n  const [userRoles, setUserRoles] = useState<string[]>([])\n  const [currentUserName, setCurrentUserName] = useState<string>('')\n  const [columnWidths, setColumnWidths] = useState<number[]>([])\n  const [focusedInput, setFocusedInput] = useState<string | null>(null)\n  \n  //    useEffect \n\n  //   items  ( purchase state  )\n  const currentItems = useMemo(() => {\n    // purchase state   (   )\n    if (purchase?.items && purchase.items.length > 0) {\n      return purchase.items;\n    }\n    if (purchase?.purchase_request_items && purchase.purchase_request_items.length > 0) {\n      return purchase.purchase_request_items;\n    }\n    \n    // purchase state    \n    if (purchaseId && allPurchases) {\n      const memoryPurchase = allPurchases.find(p => p.id === purchaseId);\n      if (memoryPurchase) {\n        return (memoryPurchase.items && memoryPurchase.items.length > 0) ? memoryPurchase.items : (memoryPurchase.purchase_request_items || []);\n      }\n    }\n    \n    return [];\n  }, [purchase, purchaseId, allPurchases, lastFetch]); // purchase       \n\n  const tableMinWidth = useMemo(() => {\n    if (columnWidths.length > 0) {\n      const columnGap = columnWidths.length > 1 ? (columnWidths.length - 1) * 12 : 0\n      const padding = 24\n      const total = columnWidths.reduce((sum, width) => sum + width, 0) + columnGap + padding\n      return Math.max(total, 720)\n    }\n\n    const baseColumns: number[] = [120, 200, 70, 90, 100, 150, 80] // , , , , , , \n\n    if (activeTab === 'purchase') {\n      baseColumns.push(120)\n    }\n\n    if (activeTab === 'receipt' || activeTab === 'done') {\n      baseColumns.push(120)\n    }\n\n    if (activeTab === 'receipt') {\n      baseColumns.push(140)\n    }\n\n    if (activeTab === 'done') {\n      baseColumns.push(100, 80, 110) // (100), (80), (110)\n    }\n\n    if (isEditing) {\n      baseColumns.push(110)\n    }\n\n    const columnGap = baseColumns.length > 1 ? (baseColumns.length - 1) * 12 : 0\n    const total = baseColumns.reduce((sum, width) => sum + width, 0) + columnGap + 48\n    return Math.max(total, 720)\n  }, [columnWidths, activeTab, isEditing])\n  const headerRowRef = useRef<HTMLDivElement>(null)\n  const supabase = createClient()\n  \n  //      \n  useEffect(() => {\n    const loadUserRoles = async () => {\n      try {\n        // Supabase   \n        const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\n        const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;\n        \n        if (!supabaseUrl || !supabaseAnonKey || supabaseUrl.includes('placeholder')) {\n          logger.warn('Supabase     - PurchaseDetailModal');\n          return;\n        }\n\n        const { data: { user } } = await supabase.auth.getUser()\n        if (user) {\n          //  ID \n          let { data: employeeData } = await supabase\n            .from('employees')\n            .select('*')\n            .eq('id', user.id)\n            .maybeSingle()\n          \n          // ID    \n          if (!employeeData && user.email) {\n            const { data: employeeByEmail } = await supabase\n              .from('employees')\n              .select('*')\n              .eq('email', user.email)\n              .maybeSingle()\n            \n            employeeData = employeeByEmail\n          }\n          \n          //   \n          if (employeeData?.name) {\n            setCurrentUserName(employeeData.name)\n          }\n          \n          if (employeeData?.purchase_role) {\n            let roles: string[] = []\n            if (Array.isArray(employeeData.purchase_role)) {\n              roles = employeeData.purchase_role.map((r: any) => String(r).trim())\n            } else {\n              const roleString = String(employeeData.purchase_role)\n              roles = roleString\n                .split(',')\n                .map((r: string) => r.trim())\n                .filter((r: string) => r.length > 0)\n            }\n            setUserRoles(roles)\n          }\n        }\n      } catch (error) {\n      }\n    }\n    \n    if (isOpen) {\n      loadUserRoles()\n    }\n  }, [isOpen])\n  \n  // currentUserRoles   userRoles \n  const effectiveRoles = Array.isArray(currentUserRoles) && currentUserRoles.length > 0 \n    ? currentUserRoles \n    : userRoles\n  \n  //  \n  //    (   )\n  const canEditAll = effectiveRoles.includes('final_approver') || \n                     effectiveRoles.includes('app_admin') || \n                     effectiveRoles.includes('ceo')\n  \n  // lead buyer    (/  )\n  const canEditLimited = effectiveRoles.includes('lead buyer')\n  \n  //    (      )\n  const canEdit = canEditAll || canEditLimited\n  \n  //     \n  const canViewFinancialInfo = effectiveRoles.some(role => AUTHORIZED_ROLES.includes(role))\n  \n  //  :     (,   , lead buyer  )\n  const isApproved = purchase?.final_manager_status === 'approved';\n  const canDelete = isApproved \n    ? canEditAll  //      (lead buyer )\n    : (canEditAll || (purchase?.requester_name === currentUserName))  //  lead buyer \n  \n  //   : app_admin + lead buyer (  )\n  const canPurchase = effectiveRoles.includes('app_admin') || \n                     effectiveRoles.includes('lead buyer') || \n                     effectiveRoles.includes('lead buyer')\n  \n  //    \n  // 1.      \n  // 2.      \n  const canReceiveItems = effectiveRoles.includes('app_admin') || \n                         (purchase?.requester_name === currentUserName)\n  // 2.        \n  const isAdmin = effectiveRoles.includes('final_approver') || \n                  effectiveRoles.includes('app_admin') || \n                  effectiveRoles.includes('ceo')\n  const isRequester = purchase?.requester_name === currentUserName\n  \n  //   & UTK  : app_admin lead buyer \n  const canReceiptCheck = effectiveRoles.includes('app_admin') || \n                         effectiveRoles.includes('lead buyer')\n  \n  //   : app_admin    \n  const canProcessReceipt = effectiveRoles.includes('app_admin') || isRequester\n  \n\n  //      (  )\n  const refreshModalData = useCallback(async () => {\n    if (!purchaseId) return\n    \n    try {\n      //     ( )\n      const memoryPurchase = findPurchaseInMemory(purchaseId)\n      if (memoryPurchase) {\n        \n        // items  : purchase_request_items items \n        const normalizedItems = (memoryPurchase.items && memoryPurchase.items.length > 0)\n          ? memoryPurchase.items \n          : (memoryPurchase.purchase_request_items || [])\n        \n        //   PurchaseRequestWithDetails  \n        const purchaseData = {\n          ...memoryPurchase,\n          id: String(memoryPurchase.id), // PurchaseRequest id string\n          is_po_generated: false, // Purchase   PurchaseRequest \n          items: normalizedItems, //  items \n          purchase_request_items: normalizedItems, //      \n          vendor: {\n            id: memoryPurchase.vendor_id,\n            vendor_name: memoryPurchase.vendor_name || '  ',\n            is_active: true\n          } as Vendor,\n          vendor_contacts: []\n        } as PurchaseRequestWithDetails\n        \n        setPurchase(purchaseData)\n        setEditedPurchase(purchaseData)\n        setEditedItems(normalizedItems.length > 0 ? normalizedItems : [])\n        return\n      }\n      \n      //    DB  (fallback)\n      const supabase = createClient()\n      //     \n      const { data, error } = await supabase\n        .from('purchase_requests')\n        .select(`\n          *,\n          vendors(id, vendor_name),\n          purchase_request_items(*)\n        `)\n        .eq('id', purchaseId)\n        .single()\n      \n      if (error) throw error\n\n      if (data) {\n        //   \n        const sortedItems = (data.purchase_request_items || []).sort((a: any, b: any) => {\n          const lineA = a.line_number || 999999;\n          const lineB = b.line_number || 999999;\n          return lineA - lineB;\n        });\n\n        const purchaseData = {\n          ...data,\n          items: sortedItems,\n          vendor: data.vendors || { id: 0, vendor_name: '  ' },\n          vendor_contacts: []\n        } as PurchaseRequestWithDetails\n\n        setPurchase(purchaseData)\n        setEditedPurchase(purchaseData)\n        setEditedItems(sortedItems)\n      }\n    } catch (error) {\n      logger.error('   ', error)\n    }\n  }, [purchaseId])\n\n  //          \n  useEffect(() => {\n    if (!purchaseId || !allPurchases || !purchase) return;\n\n    const memoryPurchase = allPurchases.find(p => p.id === purchaseId);\n    if (memoryPurchase) {\n      //   purchase state  (   )\n      const normalizedItems = (memoryPurchase.items && memoryPurchase.items.length > 0) \n        ? memoryPurchase.items \n        : (memoryPurchase.purchase_request_items || []);\n      \n      const updatedPurchase = {\n        ...purchase,\n        ...memoryPurchase,\n        id: String(memoryPurchase.id),\n        items: normalizedItems,\n        purchase_request_items: normalizedItems\n      } as PurchaseRequestWithDetails;\n\n      setPurchase(updatedPurchase);\n      setEditedPurchase(updatedPurchase);\n      setEditedItems(normalizedItems.length > 0 ? normalizedItems : []);\n    }\n  }, [allPurchases, lastFetch]); // lastFetch     \n\n  //         \n  useEffect(() => {\n    if (!isOpen || !purchaseId || !allPurchases) return;\n\n    const memoryPurchase = allPurchases.find(p => p.id === purchaseId);\n    if (memoryPurchase) {\n      const normalizedItems = (memoryPurchase.items && memoryPurchase.items.length > 0) \n        ? memoryPurchase.items \n        : (memoryPurchase.purchase_request_items || []);\n      \n      const updatedPurchase = {\n        ...memoryPurchase,\n        id: String(memoryPurchase.id),\n        is_po_generated: false,\n        items: normalizedItems,\n        purchase_request_items: normalizedItems,\n        vendor: {\n          id: memoryPurchase.vendor_id,\n          vendor_name: memoryPurchase.vendor_name || '  ',\n          is_active: true\n        } as Vendor,\n        vendor_contacts: []\n      } as PurchaseRequestWithDetails;\n\n      setPurchase(updatedPurchase);\n      setEditedPurchase(updatedPurchase);\n      setEditedItems(normalizedItems.length > 0 ? normalizedItems : []);\n    }\n  }, [isOpen, purchaseId, allPurchases]); //    \n  \n  //       \n  const [isInitialLoad, setIsInitialLoad] = useState(true)\n  \n  //   \n  const purchaseIdNumber = purchaseId ? Number(purchaseId) : (purchase ? Number(purchase.id) : NaN)\n\n  const handleActualReceiptOptimisticUpdate = useCallback(({ itemId, selectedDate, action, receivedQuantity }: {\n    itemId: number\n    selectedDate?: Date\n    action: 'confirm' | 'cancel'\n    receivedQuantity?: number\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n      received_quantity?: number\n    }\n  }) => {\n    const itemIdStr = String(itemId)\n    const nowIso = new Date().toISOString()\n    const selectedDateIso = selectedDate ? selectedDate.toISOString() : undefined\n\n    const updateItems = (items?: any[]) => {\n      if (!items) return items\n      return items.map(item => {\n        if (String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_received: true,\n            actual_received_date: selectedDateIso,\n            received_at: nowIso,\n            received_quantity: receivedQuantity !== undefined ? receivedQuantity : item.received_quantity\n          }\n        }\n\n        return {\n          ...item,\n          is_received: false,\n          actual_received_date: undefined,\n          received_at: undefined,\n          received_quantity: undefined\n        }\n      })\n    }\n\n    setPurchase(prev => {\n      if (!prev) return prev\n      const updatedItems = updateItems(prev.items) || []\n      const updatedRequestItems = updateItems(prev.purchase_request_items) || []\n      const total = updatedItems.length\n      const completed = updatedItems.filter(item => item.is_received).length\n      const allReceived = total > 0 && completed === total\n\n      return {\n        ...prev,\n        items: updatedItems,\n        purchase_request_items: updatedRequestItems,\n        is_received: allReceived,\n        received_at: allReceived ? (prev.received_at || nowIso) : undefined,\n        updated_at: new Date().toISOString()\n      }\n    })\n\n    setEditedPurchase(prev => {\n      if (!prev) return prev\n      const updatedItems = updateItems(prev.items) || []\n      const updatedRequestItems = updateItems(prev.purchase_request_items) || []\n      return {\n        ...prev,\n        items: updatedItems,\n        purchase_request_items: updatedRequestItems\n      }\n    })\n\n    setEditedItems(prevItems => {\n      if (!prevItems || prevItems.length === 0) return prevItems\n      return prevItems.map(item => {\n        if (!item.id || String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_received: true,\n            actual_received_date: selectedDateIso,\n            received_at: nowIso,\n            received_quantity: receivedQuantity !== undefined ? receivedQuantity : item.received_quantity\n          }\n        }\n\n        return {\n          ...item,\n          is_received: false,\n          actual_received_date: undefined,\n          received_at: undefined,\n          received_quantity: undefined\n        }\n      })\n    })\n\n    if (!Number.isNaN(purchaseIdNumber)) {\n      onOptimisticUpdate?.(purchaseIdNumber, prevPurchase => {\n        const updatedItems = updateItems(prevPurchase.items) || prevPurchase.items || []\n        const updatedRequestItems = updateItems(prevPurchase.purchase_request_items) || prevPurchase.purchase_request_items || []\n        const total = updatedItems.length || prevPurchase.items?.length || 0\n        const completed = updatedItems.filter(item => item.is_received).length\n        const allReceived = total > 0 && completed === total\n\n        return {\n          ...prevPurchase,\n          items: updatedItems,\n          purchase_request_items: updatedRequestItems,\n          is_received: allReceived,\n          received_at: allReceived ? (prevPurchase.received_at || nowIso) : undefined,\n          updated_at: new Date().toISOString()\n        }\n      })\n    }\n  }, [onOptimisticUpdate, purchaseIdNumber])\n\n  const handleStatementReceivedOptimisticUpdate = useCallback(({ itemId, selectedDate, action }: {\n    itemId: number\n    selectedDate?: Date\n    action: 'confirm' | 'cancel'\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n    }\n  }) => {\n    const itemIdStr = String(itemId)\n    const selectedDateIso = selectedDate ? selectedDate.toISOString() : undefined\n\n    let nextAllCompleted = false\n    let nextStatementAt: string | null = null\n\n    setPurchase(prev => {\n      if (!prev) return prev\n\n      const updatedItems = (prev.items || []).map(item => {\n        if (String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_statement_received: true,\n            statement_received_date: selectedDateIso,\n            statement_received_by_name: currentUserName\n          }\n        }\n\n        return {\n          ...item,\n          is_statement_received: false,\n          statement_received_date: null,\n          statement_received_by_name: null\n        }\n      })\n\n      nextAllCompleted = updatedItems.length > 0 && updatedItems.every(item => item.is_statement_received)\n      nextStatementAt = nextAllCompleted\n        ? (selectedDateIso || prev.statement_received_at || new Date().toISOString())\n        : null\n\n      return {\n        ...prev,\n        items: updatedItems,\n        is_statement_received: nextAllCompleted,\n        statement_received_at: nextStatementAt\n      }\n    })\n\n    setEditedPurchase(prev => {\n      if (!prev) return prev\n\n      const updatedItems = (prev.items || []).map(item => {\n        if (String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_statement_received: true,\n            statement_received_date: selectedDateIso,\n            statement_received_by_name: currentUserName\n          }\n        }\n\n        return {\n          ...item,\n          is_statement_received: false,\n          statement_received_date: null,\n          statement_received_by_name: null\n        }\n      })\n\n      return {\n        ...prev,\n        items: updatedItems,\n        is_statement_received: nextAllCompleted,\n        statement_received_at: nextStatementAt\n      }\n    })\n\n    setEditedItems(prevItems => {\n      if (!prevItems) return prevItems\n      return prevItems.map(item => {\n        if (String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_statement_received: true,\n            statement_received_date: selectedDateIso,\n            statement_received_by_name: currentUserName\n          }\n        }\n\n        return {\n          ...item,\n          is_statement_received: false,\n          statement_received_date: null,\n          statement_received_by_name: null\n        }\n      })\n    })\n\n    if (!Number.isNaN(purchaseIdNumber)) {\n      onOptimisticUpdate?.(purchaseIdNumber, prevPurchase => {\n        const updatedItems = (prevPurchase.items || []).map(item => {\n          if (String(item.id) !== itemIdStr) return item\n\n          if (action === 'confirm') {\n            return {\n              ...item,\n              is_statement_received: true,\n              statement_received_date: selectedDateIso,\n              statement_received_by_name: currentUserName\n            }\n          }\n\n          return {\n            ...item,\n            is_statement_received: false,\n            statement_received_date: null,\n            statement_received_by_name: null\n          }\n        })\n\n        const allCompleted = updatedItems.length > 0 && updatedItems.every(item => item.is_statement_received)\n\n        return {\n          ...prevPurchase,\n          items: updatedItems,\n          is_statement_received: allCompleted\n        }\n      })\n    }\n\n    // purchase_requests   \n    if (purchase && nextAllCompleted !== undefined) {\n      const supabase = createClient()\n      supabase\n        .from('purchase_requests')\n        .update({\n          is_statement_received: nextAllCompleted,\n          statement_received_at: nextStatementAt\n        })\n        .eq('id', purchase.id)\n        .then(({ error }: { error: any }) => {\n          if (error) {\n            logger.error('  purchase_requests  ', error)\n          }\n        })\n    }\n  }, [currentUserName, onOptimisticUpdate, purchaseIdNumber, purchase])\n\n  const statementReceivedAction = useConfirmDateAction({\n    config: {\n      field: 'statement_received',\n      confirmMessage: {\n        confirm: '  ?',\n        cancel: '  ?'\n      },\n      successMessage: {\n        confirm: '  .',\n        cancel: '  .'\n      },\n      completedText: ' ',\n      waitingText: ''\n    },\n    currentUserName,\n    canPerformAction: canReceiptCheck,\n    purchaseId: purchase?.id,\n    onUpdate: refreshModalData,\n    onOptimisticUpdate: handleStatementReceivedOptimisticUpdate\n  })\n\n  const actualReceivedAction = useConfirmDateAction({\n    config: {\n      field: 'actual_received',\n      confirmMessage: {\n        confirm: '   ?',\n        cancel: '   ?'\n      },\n      successMessage: {\n        confirm: '   .',\n        cancel: '   .'\n      },\n      completedText: '',\n      waitingText: ''\n    },\n    currentUserName,\n    canPerformAction: canProcessReceipt,\n    purchaseId: purchase?.id,\n    onUpdate: refreshModalData,\n    onOptimisticUpdate: handleActualReceiptOptimisticUpdate\n  })\n  \n  //   \n  \n  \n  //   \n const canApproveMiddle = effectiveRoles.includes('middle_manager') || \n                          effectiveRoles.includes('app_admin') || \n                          effectiveRoles.includes('ceo')\n \n const canApproveFinal = effectiveRoles.includes('final_approver') || \n                         effectiveRoles.includes('app_admin') || \n                         effectiveRoles.includes('ceo')\n \n const approvalPillClass = 'inline-flex items-center gap-1 business-radius-badge px-2 py-0.5 badge-text leading-tight'\n const approvalButtonClass = 'inline-flex items-center gap-1 business-radius-badge !h-auto !min-h-0 !px-2.5 !py-0.5 badge-text leading-tight'\n const approvalWaitingPillClass = 'inline-flex items-center gap-1 business-radius-badge px-2.5 py-0.5 badge-text leading-tight'\n \n \n  useEffect(() => {\n    if (purchaseId && isOpen) {\n      //       \n      const memoryPurchase = findPurchaseInMemory(purchaseId)\n      if (memoryPurchase) {\n        //     (loading  )\n        const purchaseData = {\n          ...memoryPurchase,\n          id: String(memoryPurchase.id), // PurchaseRequest id string\n          is_po_generated: false, // Purchase   PurchaseRequest \n          vendor: {\n            id: memoryPurchase.vendor_id,\n            vendor_name: memoryPurchase.vendor_name || '  ',\n            is_active: true\n          } as Vendor,\n          vendor_contacts: []\n        } as PurchaseRequestWithDetails\n        \n        setPurchase(purchaseData)\n        setEditedPurchase(purchaseData)\n        setEditedItems(memoryPurchase.items || [])\n      } else {\n        //     \n        loadPurchaseDetail(purchaseId.toString())\n      }\n      setIsEditing(false) //      \n    }\n  }, [purchaseId, isOpen])\n\n  //    (  )\n  const calculateOptimalColumnWidths = useCallback(() => {\n    // items purchase_request_items   \n    const items = (purchase?.items && purchase.items.length > 0) \n      ? purchase.items \n      : (purchase?.purchase_request_items && purchase.purchase_request_items.length > 0)\n      ? purchase.purchase_request_items\n      : []\n    \n    if (items.length === 0) return []\n\n    const columnConfigs = [\n      { key: 'item_name', minWidth: 80, maxWidth: 500, baseWidth: 80 },\n      { key: 'specification', minWidth: 200, maxWidth: 200, baseWidth: 200, isFixed: true }, //   200px\n      { key: 'quantity', minWidth: 70, maxWidth: 120, baseWidth: 70 }, // 100/0   maxWidth \n      { key: 'unit_price', minWidth: 90, maxWidth: 150, baseWidth: 90 },\n      { key: 'total_price', minWidth: 100, maxWidth: 180, baseWidth: 100 },\n      { key: 'remarks', minWidth: 150, maxWidth: 150, baseWidth: 150, isFixed: true }, //   150px\n      { key: 'status', minWidth: 80, maxWidth: 120, baseWidth: 80 }\n    ]\n\n      //   ()\n      if (activeTab === 'receipt') {\n        columnConfigs.push(\n          { key: 'actual_receipt_date', minWidth: 100, maxWidth: 160, baseWidth: 100, isFixed: false }\n        )\n      }\n      if (activeTab === 'done') {\n        columnConfigs.push(\n          { key: 'transaction_confirm', minWidth: 100, maxWidth: 160, baseWidth: 100, isFixed: false },\n          { key: 'accounting_date', minWidth: 80, maxWidth: 80, baseWidth: 80, isFixed: true },\n          { key: 'expenditure_info', minWidth: 100, maxWidth: 200, baseWidth: 100, isFixed: false }\n        )\n      }\n\n    const calculatedWidths = columnConfigs.map((config, index) => {\n      let maxLength = 4 //  4\n\n      //     ()\n      const getHeaders = () => {\n        const statusHeader = activeTab === 'purchase'\n          ? ''\n          : (activeTab === 'receipt' || activeTab === 'done')\n          ? ''\n          : ''\n\n        //    \n        // receipt, done  '/ '    \n        const quantityHeader = (activeTab === 'receipt' || activeTab === 'done') \n          ? '/ ' \n          : ''\n        const baseHeaders = activeTab === 'pending' \n          ? ['', '', quantityHeader, '', '', '']\n          : ['', '', quantityHeader, '', '', '', statusHeader]\n        if (activeTab === 'receipt') {\n          return [...baseHeaders, '']\n        } else if (activeTab === 'done') {\n          return [...baseHeaders, ' ', ' ', '']\n        }\n        return baseHeaders\n      }\n      \n      const headers = getHeaders()\n      if (headers[index]) {\n        maxLength = Math.max(maxLength, headers[index].length)\n      }\n\n      //     \n      items.forEach(item => {\n        let cellValue = ''\n        switch (config.key) {\n          case 'item_name':\n            cellValue = item.item_name || ''\n            break\n          case 'specification':\n            cellValue = item.specification || ''\n            break\n          case 'quantity':\n            // receipt, done  /  \n            if (activeTab === 'receipt' || activeTab === 'done') {\n              const quantity = item.quantity || 0\n              const receivedQuantity = item.received_quantity ?? 0\n              // 100  2      \n              //       (   /  )\n              cellValue = quantity >= 100 || receivedQuantity >= 100 \n                ? `${quantity}` // 2     \n                : `${quantity}/${receivedQuantity}` // 1   \n            } else {\n              cellValue = item.quantity?.toString() || ''\n            }\n            break\n          case 'unit_price':\n            cellValue = item.unit_price_value != null ? item.unit_price_value.toLocaleString() : ''\n            break\n          case 'total_price':\n            if (item.amount_value != null) {\n              cellValue = item.amount_value.toLocaleString()\n            } else if (item.quantity != null && item.unit_price_value != null) {\n              cellValue = (Number(item.quantity) * Number(item.unit_price_value)).toLocaleString()\n            } else {\n              cellValue = ''\n            }\n            break\n          case 'remarks':\n            cellValue = item.remark || ''\n            break\n          case 'status':\n            cellValue = getStatusDisplay(item) || ''\n            break\n          case 'actual_receipt_date':\n            cellValue = item.actual_received_date ? formatDate(item.actual_received_date) : ''\n            break\n          case 'transaction_confirm':\n            cellValue = item.is_statement_received ? '' : ''\n            break\n          case 'accounting_date':\n            cellValue = item.statement_received_date ? formatDate(item.statement_received_date) : ''\n            break\n          case 'expenditure_info':\n            //    2   \n            if (item.expenditure_date && item.expenditure_amount !== null && item.expenditure_amount !== undefined) {\n              //   : \"2025. 11. 25.\" ( 14)\n              cellValue = '2025. 11. 25.' //    \n            } else {\n              cellValue = '' //  \n            }\n            break\n        }\n        \n        // /     ( 1.5 )\n        const adjustedLength = cellValue.split('').reduce((acc, char) => {\n          return acc + (/[-]/.test(char) ? 1.5 : 1)\n        }, 0)\n        \n        maxLength = Math.max(maxLength, Math.ceil(adjustedLength))\n      })\n\n      //     \n      if (config.isFixed) {\n        return config.baseWidth\n      }\n      \n      //    (  7px +  20px)\n      let calculatedWidth = Math.max(\n        config.minWidth,\n        Math.min(config.maxWidth, maxLength * 7 + 20)\n      )\n      \n      //      2   \n      if (config.key === 'expenditure_info') {\n        //   \"2025. 11. 25.\"  \n        // 2     \n        calculatedWidth = 110 //   \n      }\n\n      return calculatedWidth\n    })\n\n    setColumnWidths(calculatedWidths)\n    return calculatedWidths\n  }, [purchase, activeTab])\n\n  //     \n  const getStatusDisplay = (item: any) => {\n    if (activeTab === 'purchase') {\n      return item.is_payment_completed ? '' : ''\n    } else if (activeTab === 'receipt') {\n      return item.is_received ? '' : ''\n    }\n    return item.is_payment_completed ? '' : ''\n  }\n\n  //  gridTemplateColumns \n  const getGridTemplateColumns = () => {\n    //      (,    )\n    if (columnWidths.length > 0) {\n      const widths = columnWidths.map(width => `${width}px`)\n      \n      //      ( )\n      //      \n      \n      return widths.join(' ')\n    }\n    \n    //  (  )\n    // [, , , , , ]\n    let baseColumns = ['minmax(80px, 1fr)', '200px', '70px', '90px', '100px', '150px']\n    \n    // isEditing      \n    if (isEditing) {\n      baseColumns.push('80px') // \n    } else {\n      baseColumns.push('80px') // \n    }\n    \n    //   \n    if (activeTab === 'receipt') {\n      return [...baseColumns, '100px'].join(' ')\n    } else if (activeTab === 'done') {\n      return [...baseColumns, '100px', '80px', '110px'].join(' ') // , , \n    }\n    \n    return baseColumns.join(' ')\n  }\n\n  //  measureColumnWidths  ( )\n  const measureColumnWidths = () => {\n    calculateOptimalColumnWidths()\n  }\n\n  // View     (  )\n  //      \n  useEffect(() => {\n    // items purchase_request_items   \n    const hasItems = (purchase?.items && purchase.items.length > 0) || \n                     (purchase?.purchase_request_items && purchase.purchase_request_items.length > 0)\n    \n    if (purchase && hasItems && !isEditing) {\n      // requestAnimationFrame       \n      requestAnimationFrame(() => {\n        calculateOptimalColumnWidths()\n      })\n    }\n  }, [purchase, isEditing, activeTab, calculateOptimalColumnWidths])\n\n  // Edit     \n  const handleEditToggle = (editing: boolean) => {\n    if (editing && !isEditing) {\n      // Edit      \n      setEditedPurchase(purchase)\n      setEditedItems(currentItems || [])\n      setDeletedItemIds([])\n      // Edit      \n      calculateOptimalColumnWidths()\n    }\n    setIsEditing(editing)\n  }\n\n  const loadPurchaseDetail = async (id: string) => {\n    try {\n      //     (    )\n      const memoryPurchase = findPurchaseInMemory(id)\n      if (memoryPurchase) {\n        //   PurchaseRequestWithDetails  \n        const purchaseData = {\n          ...memoryPurchase,\n          id: String(memoryPurchase.id), // PurchaseRequest id string\n          is_po_generated: false, // Purchase   PurchaseRequest \n          vendor: {\n            id: memoryPurchase.vendor_id,\n            vendor_name: memoryPurchase.vendor_name || '  ',\n            is_active: true\n          } as Vendor,\n          vendor_contacts: []\n        } as PurchaseRequestWithDetails\n        \n        setPurchase(purchaseData)\n        setEditedPurchase(purchaseData)\n        setEditedItems(memoryPurchase.items || [])\n        return\n      }\n      \n      //        DB  (fallback)\n      setLoading(true)\n      const supabase = createClient()\n      \n      const { data, error } = await supabase\n        .from('purchase_requests')\n        .select(`\n          *,\n          vendors(id, vendor_name),\n          purchase_request_items(*)\n        `)\n        .eq('id', id)\n        .single()\n\n      if (error) throw error\n\n      if (data) {\n        //   \n        const sortedItems = (data.purchase_request_items || []).sort((a: any, b: any) => {\n          const lineA = a.line_number || 999999;\n          const lineB = b.line_number || 999999;\n          return lineA - lineB;\n        });\n\n        const purchaseData = {\n          ...data,\n          items: sortedItems,\n          vendor: data.vendors || { id: 0, vendor_name: '  ' },\n          vendor_contacts: []\n        } as PurchaseRequestWithDetails\n        setPurchase(purchaseData)\n        setEditedPurchase(purchaseData)\n        setEditedItems(sortedItems)\n      }\n    } catch (error) {\n      logger.error('[PurchaseDetailModal]    :', error)\n      toast.error('    .')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const getStatusBadge = () => {\n    if (!purchase) return null\n    \n    // payment_category  \n    if (purchase.payment_category) {\n      const category = purchase.payment_category.trim()\n      \n      if (category === '') {\n        return <span className=\"badge-stats bg-green-500 text-white\"></span>\n      } else if (category === '') {\n        return <span className=\"badge-stats bg-blue-500 text-white\"></span>\n      } else if (category === '') {\n        return <span className=\"badge-stats bg-gray-500 text-white\"></span>\n      } else {\n        // payment_category      \n        return <span className=\"badge-stats bg-blue-500 text-white\">{category}</span>\n      }\n    }\n    \n    // payment_category  \n    return <span className=\"badge-stats bg-blue-500 text-white\"></span>\n  }\n\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat('ko-KR').format(amount)\n  }\n\n  const handleSave = async () => {\n    if (!purchase || !editedPurchase) {\n      toast.error('  .')\n      return\n    }\n    \n    try {\n      \n      //    \n      const totalAmount = editedItems.reduce((sum, item) => sum + (item.amount_value || 0), 0)\n      \n      const { error: updateError } = await supabase\n        .from('purchase_requests')\n        .update({\n          purchase_order_number: editedPurchase.purchase_order_number || null,\n          requester_name: editedPurchase.requester_name || null,\n          delivery_request_date: editedPurchase.delivery_request_date || null,\n          revised_delivery_request_date: editedPurchase.revised_delivery_request_date || null,\n          payment_category: editedPurchase.payment_category || null,\n          project_vendor: editedPurchase.project_vendor || null,\n          total_amount: Number(totalAmount),\n          updated_at: new Date().toISOString()\n        })\n        .eq('id', purchase.id)\n\n      if (updateError) throw updateError\n\n      //   \n      if (deletedItemIds.length > 0) {\n        const { error: deleteError } = await supabase\n          .from('purchase_request_items')\n          .delete()\n          .in('id', deletedItemIds)\n\n        if (deleteError) throw deleteError\n      }\n\n      //     \n      \n      for (const item of editedItems) {\n        \n        //   \n        if (!item.item_name || !item.item_name.trim()) {\n          throw new Error(' .');\n        }\n        if (!item.quantity || item.quantity <= 0) {\n          throw new Error(' 0  .');\n        }\n        if (item.unit_price_value !== null && item.unit_price_value !== undefined && item.unit_price_value < 0) {\n          throw new Error(' 0  .');\n        }\n        if (item.amount_value !== null && item.amount_value !== undefined && item.amount_value < 0) {\n          throw new Error(' 0  .');\n        }\n        \n        if (item.id) {\n          //   \n          const { error } = await supabase\n            .from('purchase_request_items')\n            .update({\n              item_name: item.item_name.trim(),\n              specification: item.specification || null,\n              quantity: Number(item.quantity),\n              received_quantity: item.received_quantity !== null && item.received_quantity !== undefined ? Number(item.received_quantity) : null,\n              unit_price_value: Number(item.unit_price_value),\n              unit_price_currency: purchase.currency || 'KRW',\n              amount_value: Number(item.amount_value),\n              amount_currency: purchase.currency || 'KRW',\n              remark: item.remark || null,\n              updated_at: new Date().toISOString()\n            })\n            .eq('id', item.id)\n\n          if (error) {\n            logger.error('   ', error);\n            throw error;\n          }\n        } else {\n          //   \n          const insertData = {\n            purchase_request_id: purchase.id,\n            item_name: item.item_name.trim(),\n            specification: item.specification || null,\n            quantity: Number(item.quantity),\n            received_quantity: item.received_quantity !== null && item.received_quantity !== undefined ? Number(item.received_quantity) : null,\n            unit_price_value: Number(item.unit_price_value),\n            unit_price_currency: purchase.currency || 'KRW',\n            amount_value: Number(item.amount_value),\n            amount_currency: purchase.currency || 'KRW',\n            remark: item.remark || null,\n            line_number: item.line_number || editedItems.indexOf(item) + 1,\n            created_at: new Date().toISOString()\n          };\n          \n          const { error } = await supabase\n            .from('purchase_request_items')\n            .insert(insertData)\n\n          if (error) {\n            logger.error('   ', error);\n            throw error;\n          }\n        }\n      }\n\n      //        (  )\n      const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n      const sourceData = editedPurchase || purchase\n      \n      // 1.         (  )\n      if (!Number.isNaN(purchaseIdNumber) && deletedItemIds.length > 0) {\n        logger.info(' [ ]     ', {\n          purchaseId: purchaseIdNumber,\n          deletedItemIds: deletedItemIds,\n          deletedCount: deletedItemIds.length\n        })\n        \n        //         (   )\n        deletedItemIds.forEach(itemId => {\n          const memoryUpdated = removeItemFromMemory(purchaseIdNumber, itemId)\n          if (!memoryUpdated) {\n            logger.warn('[handleSave]       ', { \n              purchaseId: purchaseIdNumber, \n              itemId: itemId \n            })\n          } else {\n            logger.info(' [handleSave]       ', { \n              purchaseId: purchaseIdNumber, \n              itemId: itemId \n            })\n          }\n        })\n      }\n      \n      // 2.       ( )\n      if (!Number.isNaN(purchaseIdNumber)) {\n        const memoryUpdated = updatePurchaseInMemory(purchaseIdNumber, (prev) => {\n          const totalAmount = editedItems.reduce((sum, item) => sum + (item.amount_value || 0), 0)\n          \n          logger.info(' [ ]    ', {\n            purchaseId: purchaseIdNumber,\n            newTotalAmount: totalAmount,\n            itemsCount: editedItems.length\n          })\n          \n          return {\n            ...prev,\n            //    \n            purchase_order_number: sourceData?.purchase_order_number || prev.purchase_order_number,\n            requester_name: sourceData?.requester_name || prev.requester_name,\n            delivery_request_date: sourceData?.delivery_request_date || prev.delivery_request_date,\n            revised_delivery_request_date: sourceData?.revised_delivery_request_date || prev.revised_delivery_request_date,\n            payment_category: sourceData?.payment_category || prev.payment_category,\n            project_vendor: sourceData?.project_vendor || prev.project_vendor,\n            total_amount: totalAmount,\n            updated_at: new Date().toISOString()\n          } as Purchase\n        })\n        \n        logger.info(' [ ]    :', { memoryUpdated })\n      }\n      \n      // 3. applyOptimisticUpdate   (  )\n      const applyOptimisticUpdate = () => {\n        if (!Number.isNaN(purchaseIdNumber) && onOptimisticUpdate) {\n          onOptimisticUpdate(purchaseIdNumber, prev => {\n            const finalItems = editedItems //    \n            const totalAmount = finalItems.reduce((sum, item) => sum + (item.amount_value || 0), 0)\n            \n            logger.info(' [onOptimisticUpdate]  UI ', {\n              originalItemsCount: prev.items?.length || prev.purchase_request_items?.length || 0,\n              finalItemsCount: finalItems.length,\n              deletedItemsCount: deletedItemIds.length\n            })\n            \n            return {\n              ...prev,\n              //    \n              purchase_order_number: sourceData?.purchase_order_number || prev.purchase_order_number,\n              requester_name: sourceData?.requester_name || prev.requester_name,\n              delivery_request_date: sourceData?.delivery_request_date || prev.delivery_request_date,\n              revised_delivery_request_date: sourceData?.revised_delivery_request_date || prev.revised_delivery_request_date,\n              payment_category: sourceData?.payment_category || prev.payment_category,\n              project_vendor: sourceData?.project_vendor || prev.project_vendor,\n              total_amount: totalAmount,\n              //    -   \n              items: finalItems,\n              purchase_request_items: finalItems,\n              updated_at: new Date().toISOString()\n            } as Purchase\n          })\n        }\n      }\n      \n      // 4.  UI   (  )\n      applyOptimisticUpdate()\n\n      toast.success('   .')\n      handleEditToggle(false)\n      setDeletedItemIds([])\n      \n      // 5.   : refreshModalData ,   onRefresh\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      logger.error('   ', error);\n      const errorMessage = error instanceof Error ? error.message : '    '\n      toast.error(` : ${errorMessage}`)\n    }\n  }\n\n  const handleItemChange = (index: number, field: string, value: any) => {\n    const newItems = [...editedItems]\n    \n    if (field === 'quantity' || field === 'unit_price_value') {\n      //       \n      const quantity = field === 'quantity' ? value : newItems[index].quantity\n      const unitPrice = field === 'unit_price_value' ? value : newItems[index].unit_price_value\n      newItems[index] = {\n        ...newItems[index],\n        [field]: value,\n        amount_value: (quantity || 0) * (unitPrice || 0)  // null  \n      }\n    } else {\n      //    (amount_value   )\n      newItems[index] = {\n        ...newItems[index],\n        [field]: value\n      }\n    }\n    \n    setEditedItems(newItems)\n  }\n\n  const handleAddItem = () => {\n    //    \n    const maxLineNumber = editedItems.reduce((max, item) => {\n      const lineNum = item.line_number || 0;\n      return lineNum > max ? lineNum : max;\n    }, 0);\n\n    const newItem = {\n      item_name: '',\n      specification: '',\n      quantity: 1,\n      unit_price_value: 0,\n      amount_value: 0,\n      remark: '',\n      line_number: maxLineNumber + 1\n    }\n    \n    //       \n    const newItems = [...editedItems, newItem].sort((a, b) => {\n      const lineA = a.line_number || 999999;\n      const lineB = b.line_number || 999999;\n      return lineA - lineB;\n    });\n    \n    setEditedItems(newItems)\n  }\n\n  const handleRemoveItem = (index: number) => {\n    const item = editedItems[index]\n    if (item.id) {\n      setDeletedItemIds([...deletedItemIds, item.id])\n    }\n    const newItems = editedItems.filter((_, i) => i !== index).sort((a, b) => {\n      const lineA = a.line_number || 999999;\n      const lineB = b.line_number || 999999;\n      return lineA - lineB;\n    });\n    setEditedItems(newItems)\n  }\n\n  //   \n  const handlePaymentToggle = async (itemId: number | string, isCompleted: boolean) => {\n    \n    if (!canPurchase) {\n      logger.warn('[handlePaymentToggle]  ', { canPurchase, currentUserRoles })\n      toast.error('   .')\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n\n    if (Number.isNaN(numericId)) {\n      logger.error('[handlePaymentToggle]  ID', { itemId, numericId })\n      toast.error('   ID .')\n      return\n    }\n\n    //     -   \n    \n    // items purchase_request_items    - length    \n    if (!purchase) return\n    \n    const purchaseItems = (purchase.items && purchase.items.length > 0) ? purchase.items : []\n    const requestItems = (purchase.purchase_request_items && purchase.purchase_request_items.length > 0) ? purchase.purchase_request_items : []\n    const items = purchaseItems.length > 0 ? purchaseItems : requestItems\n    \n    \n    const targetItem = items.find(item => String(item.id) === itemIdStr)\n    \n    \n    if (!targetItem) {\n      return\n    }\n\n    const itemInfo = `: ${targetItem.item_name}\n: ${targetItem.specification || ''}\n: ${targetItem.quantity?.toLocaleString() || 0}${targetItem.unit || ''}\n: ${targetItem.unit_price_value?.toLocaleString() || 0}\n: ${targetItem.amount_value?.toLocaleString() || 0}`\n\n    const confirmMessage = isCompleted \n      ? `   ?\\n\\n${itemInfo}` \n      : `   ?\\n\\n${itemInfo}`\n    \n    const confirm = window.confirm(confirmMessage)\n    \n    if (!confirm) {\n      return\n    }\n\n    try {\n      \n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_payment_completed: isCompleted,\n          payment_completed_at: isCompleted ? new Date().toISOString() : null\n        })\n        .eq('id', numericId)\n\n      if (error) {\n        throw error\n      }\n      \n\n      //      (/  )\n      if (purchase) {\n        \n        const memoryUpdated = isCompleted \n          ? markItemAsPaymentCompleted(purchase.id, numericId)\n          : markItemAsPaymentCanceled(purchase.id, numericId);\n          \n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal]     ', { \n            purchaseId: purchase.id, \n            itemId: numericId,\n            isCompleted\n          });\n        }\n      }\n\n      //     (UI  )\n      setPurchase(prev => {\n        if (!prev) {\n          return null\n        }\n        \n        // items purchase_request_items     - length    \n        const prevItems = (prev.items && prev.items.length > 0) ? prev.items : []\n        const prevRequestItems = (prev.purchase_request_items && prev.purchase_request_items.length > 0) ? prev.purchase_request_items : []\n        const currentItems = prevItems.length > 0 ? prevItems : prevRequestItems\n        const updatedItems = currentItems.map(item => \n          String(item.id) === itemIdStr \n            ? { ...item, is_payment_completed: isCompleted, payment_completed_at: isCompleted ? new Date().toISOString() : null }\n            : item\n        )\n        \n        \n        //    \n        const result = {\n          ...prev,\n          items: prev.items ? updatedItems : prev.items,\n          purchase_request_items: prev.purchase_request_items ? updatedItems : prev.purchase_request_items\n        }\n        \n        return result\n      })\n\n      if (purchase) {\n        const purchaseIdNumber = Number(purchase.id)\n        if (!Number.isNaN(purchaseIdNumber)) {\n          onOptimisticUpdate?.(purchaseIdNumber, prev => {\n            const updatedItems = (prev.items || []).map(item =>\n              String(item.id) === itemIdStr\n                ? { ...item, is_payment_completed: isCompleted }\n                : item\n            )\n            const total = updatedItems.length || prev.items?.length || 0\n            const completed = updatedItems.filter(item => item.is_payment_completed).length\n            const allCompleted = total > 0 && completed === total\n            return {\n              ...prev,\n              items: updatedItems,\n              is_payment_completed: allCompleted,\n              payment_completed_at: allCompleted ? new Date().toISOString() : null,\n              payment_completed_by_name: allCompleted ? (currentUserName || prev.payment_completed_by_name) : prev.payment_completed_by_name\n            }\n          })\n        }\n      }\n      \n      toast.success(isCompleted ? ' .' : ' .')\n\n      //         \n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      toast.error('    .')\n    }\n  }\n\n  //     (  + )\n  const handleItemReceiptToggle = async (itemId: number | string, selectedDate: Date, receivedQuantity?: number) => {\n    if (!canReceiveItems) {\n      toast.error('   .')\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      toast.error('   ID .')\n      return\n    }\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item =>\n            String(item.id) === itemIdStr\n              ? {\n                  ...item,\n                  is_received: true,\n                  actual_received_date: selectedDate.toISOString(),\n                  received_quantity: receivedQuantity !== undefined ? receivedQuantity : item.received_quantity\n                }\n              : item\n          )\n          const total = updatedItems.length || prev.items?.length || 0\n          const completed = updatedItems.filter(item => item.is_received).length\n          const allReceived = total > 0 && completed === total\n\n          return {\n            ...prev,\n            items: updatedItems,\n            is_received: allReceived,\n            received_at: allReceived ? new Date().toISOString() : prev.received_at\n          }\n        })\n      }\n    }\n\n    try {\n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_received: true,\n          received_at: new Date().toISOString(),\n          actual_received_date: selectedDate.toISOString(),\n          received_quantity: receivedQuantity !== undefined ? receivedQuantity : null\n        })\n        .eq('id', numericId)\n\n      if (error) throw error\n\n      //      (  )\n      if (purchase) {\n        const memoryUpdated = markItemAsReceived(purchase.id, numericId, selectedDate.toISOString(), receivedQuantity);\n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal]       ', { \n            purchaseId: purchase.id, \n            itemId: numericId \n          });\n        }\n      }\n\n      //    \n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          String(item.id) === itemIdStr \n            ? { \n                ...item, \n                is_received: true, \n                received_at: new Date().toISOString(),\n                actual_received_date: selectedDate.toISOString(),\n                received_quantity: receivedQuantity !== undefined ? receivedQuantity : item.received_quantity\n              }\n            : item\n        )\n        const updatedRequestItems = prev.purchase_request_items?.map(item => \n          String(item.id) === itemIdStr \n            ? { \n                ...item, \n                is_received: true, \n                received_at: new Date().toISOString(),\n                actual_received_date: selectedDate.toISOString(),\n                received_quantity: receivedQuantity !== undefined ? receivedQuantity : item.received_quantity\n              }\n            : item\n        )\n        return { \n          ...prev, \n          items: updatedItems,\n          purchase_request_items: updatedRequestItems,\n          updated_at: new Date().toISOString()\n        }\n      })\n\n      applyOptimisticUpdate()\n      \n      const targetItem = purchase?.items?.find(item => String(item.id) === itemIdStr)\n      toast.success(`\"${targetItem?.item_name}\"   .`)\n\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      toast.error('    .')\n    }\n  }\n\n  //   \n  const handleReceiptCancel = async (itemId: number | string) => {\n    if (!canProcessReceipt) {\n      toast.error('   .')\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      toast.error('   ID .')\n      return\n    }\n\n    const targetItem = purchase?.items?.find(item => String(item.id) === itemIdStr)\n    if (!targetItem) return\n\n    const confirm = window.confirm(`\"${targetItem.item_name}\"   ?`)\n    if (!confirm) return\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item =>\n            String(item.id) === itemIdStr\n              ? {\n                  ...item,\n                  is_received: false,\n                  actual_received_date: undefined\n                }\n              : item\n          )\n          const total = updatedItems.length || prev.items?.length || 0\n          const completed = updatedItems.filter(item => item.is_received).length\n          const allReceived = total > 0 && completed === total\n\n          return {\n            ...prev,\n            items: updatedItems,\n            is_received: allReceived,\n            received_at: allReceived ? prev.received_at : null\n          }\n        })\n      }\n    }\n\n    try {\n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_received: false,\n          received_at: null,\n          actual_received_date: null,\n          actual_received_by_name: null\n        })\n        .eq('id', numericId)\n\n      if (error) throw error\n\n      //    \n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          String(item.id) === itemIdStr \n            ? { ...item, is_received: false, received_at: null, actual_received_date: undefined, actual_received_by_name: undefined }\n            : item\n        )\n        return { ...prev, items: updatedItems }\n      })\n      \n      applyOptimisticUpdate()\n\n      toast.success(' .')\n\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      toast.error('    .')\n    }\n  }\n\n\n  //  \n  const handleApprove = async (type: 'middle' | 'final') => {\n    if (!purchase) return\n    \n    const approvalType = type === 'middle' ? '1 ' : ' '\n    const confirmMessage = `: ${purchase.purchase_order_number}\\n\\n${approvalType} ?`\n    const confirm = window.confirm(confirmMessage)\n    if (!confirm) return\n    \n    try {\n      const updateData = type === 'middle' \n        ? { \n            middle_manager_status: 'approved'\n          }\n        : { \n            final_manager_status: 'approved'\n          }\n\n      const { error } = await supabase\n        .from('purchase_requests')\n        .update(updateData)\n        .eq('id', purchase.id)\n      \n      if (error) {\n        throw error\n      }\n\n      //     (UI  )\n      if (type === 'middle') {\n        setPurchase(prev => prev ? { ...prev, middle_manager_status: 'approved' } : null)\n      } else {\n        setPurchase(prev => prev ? { ...prev, final_manager_status: 'approved' } : null)\n      }\n\n      // Optimistic Update    (/  )\n      if (purchase && onOptimisticUpdate) {\n        const purchaseIdNumber = Number(purchase.id)\n        if (!Number.isNaN(purchaseIdNumber)) {\n          onOptimisticUpdate(purchaseIdNumber, prev => {\n            if (type === 'middle') {\n              return {\n                ...prev,\n                middle_manager_status: 'approved' as any\n              }\n            } else {\n              return {\n                ...prev,\n                final_manager_status: 'approved' as any\n              }\n            }\n          })\n        }\n      }\n      \n      toast.success(`${type === 'middle' ? '' : ''}  .`)\n\n      //      \n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      toast.error('    .')\n    }\n  }\n  \n  //    (   )\n  const handleCompleteAllPayment = async () => {\n    \n    if (!purchase || !canPurchase) {\n      return\n    }\n    \n    const confirmMessage = `: ${purchase.purchase_order_number}\\n\\n  ?`\n    const confirm = window.confirm(confirmMessage)\n    if (!confirm) {\n      return\n    }\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const allItems = prev.purchase_request_items || [];\n          const pendingItems = allItems.filter(item => !item.is_payment_completed);\n          \n          const updatedItems = allItems.map(item => \n            !item.is_payment_completed \n              ? { ...item, is_payment_completed: true, payment_completed_at: new Date().toISOString() }\n              : item\n          );\n          \n          return {\n            ...prev,\n            purchase_request_items: updatedItems,\n            items: prev.items ? updatedItems : prev.items,\n            is_payment_completed: updatedItems.every(item => item.is_payment_completed)\n          }\n        })\n      }\n    }\n    \n    try {\n      //     (   )\n      const allItems = purchase.purchase_request_items || [];\n      const pendingItems = allItems.filter(item => !item.is_payment_completed);\n      \n      if (pendingItems.length === 0) {\n        toast.info('   .');\n        return;\n      }\n\n      logger.info(`  : ${pendingItems.length}  ( ${allItems.length} )`);\n      \n      for (const item of pendingItems) {\n        //   DB  (   )\n        const updateData = {\n          is_payment_completed: true,\n          payment_completed_at: new Date().toISOString()\n        };\n\n        const { error } = await supabase\n          .from('purchase_request_items')\n          .update(updateData)\n          .eq('id', item.id);\n\n        if (error) throw error;\n\n        //       (  )\n        const memoryUpdated = markItemAsPaymentCompleted(purchase.id, item.id);\n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal]       ', { \n            purchaseId: purchase.id, \n            itemId: item.id \n          });\n        }\n      }\n\n      toast.success(`${pendingItems.length}   .`);\n\n      //   (  )\n      await refreshModalData();\n      const refreshResult = onRefresh?.(true, { silent: true });\n      if (refreshResult instanceof Promise) {\n        await refreshResult;\n      }\n    } catch (error) {\n      logger.error('   ', error);\n      toast.error('    .')\n    }\n  }\n\n  //     \n  const handleItemExpenditure = async (itemId: number | string, date: Date, amount: number) => {\n    if (!purchase || !canReceiptCheck) {\n      toast.error('    .')\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      logger.error('  itemId', { itemId })\n      return\n    }\n\n    const targetItem = purchase.items?.find(item => String(item.id) === itemIdStr)\n    if (!targetItem) return\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item =>\n            String(item.id) === itemIdStr\n              ? {\n                  ...item,\n                  expenditure_date: date.toISOString(),\n                  expenditure_amount: amount\n                }\n              : item\n          )\n          return { ...prev, items: updatedItems }\n        })\n      }\n    }\n\n    try {\n      applyOptimisticUpdate()\n\n      //     (items purchase_request_items  ) -    \n      setPurchase(prev => {\n        if (!prev) return null\n        const currentItems = prev.items || prev.purchase_request_items || []\n        const updatedItems = currentItems.map(item => \n          String(item.id) === itemIdStr\n            ? {\n                ...item,\n                expenditure_date: date.toISOString(),\n                expenditure_amount: amount\n              }\n            : item\n        )\n        const totalExpenditure = updatedItems.reduce((sum, item) => sum + (item.expenditure_amount || 0), 0)\n        //    React   \n        return { \n          ...prev, \n          items: updatedItems,\n          purchase_request_items: updatedItems,\n          total_expenditure_amount: totalExpenditure,\n          updated_at: new Date().toISOString() //    \n        }\n      })\n\n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          expenditure_date: date.toISOString(),\n          expenditure_amount: amount\n        })\n        .eq('id', numericId)\n\n      if (error) {\n        logger.error('  DB  ', { error, itemId: numericId })\n        throw error\n      }\n\n      // purchase_requests total_expenditure_amount \n      const allItemsForTotal = purchase.items || purchase.purchase_request_items || []\n      const totalExpenditure = allItemsForTotal.reduce((sum, item) => {\n        if (String(item.id) === itemIdStr) {\n          return sum + amount\n        }\n        return sum + (item.expenditure_amount || 0)\n      }, 0)\n\n      await supabase\n        .from('purchase_requests')\n        .update({ total_expenditure_amount: totalExpenditure })\n        .eq('id', purchaseIdNumber)\n\n      //      ( UI ) - DB   \n      if (purchase?.id) {\n        const memoryUpdated = markItemAsExpenditureSet(purchase.id, numericId, date.toISOString(), amount)\n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal]      ', { \n            purchaseId: purchase.id, \n            itemId: numericId \n          })\n        }\n      }\n\n      toast.success(`\"${targetItem.item_name}\"    .`)\n\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      logger.error('    ', error)\n      toast.error('     .')\n    }\n  }\n\n  //     \n  const handleBulkExpenditure = async (date: Date, amount: number) => {\n    if (!purchase || !canReceiptCheck) {\n      toast.error('    .')\n      return\n    }\n\n    const confirmMessage = `: ${purchase.purchase_order_number}\\n\\n   ?\\n: ${date.toLocaleDateString('ko-KR')}\\n: ${amount.toLocaleString()}`\n    \n    if (!window.confirm(confirmMessage)) {\n      return\n    }\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item =>\n            //     \n            item.expenditure_date && item.expenditure_amount\n              ? item\n              : {\n                  ...item,\n                  expenditure_date: date.toISOString(),\n                  expenditure_amount: amount\n                }\n          )\n          return { ...prev, items: updatedItems }\n        })\n      }\n    }\n\n    try {\n      applyOptimisticUpdate()\n\n      //       \n      const allItems = purchase.items || purchase.purchase_request_items || []\n      const pendingItems = allItems.filter(item => !item.expenditure_date || !item.expenditure_amount)\n      \n      if (pendingItems.length === 0) {\n        toast.info('      .')\n        return\n      }\n\n      //     (items purchase_request_items  )\n      setPurchase(prev => {\n        if (!prev) return null\n        const allItems = prev.items || prev.purchase_request_items || []\n        const updatedItems = allItems.map(item =>\n          //     \n          item.expenditure_date && item.expenditure_amount\n            ? item\n            : {\n                ...item,\n                expenditure_date: date.toISOString(),\n                expenditure_amount: amount\n              }\n        )\n        const totalExpenditure = updatedItems.reduce((sum, item) => sum + (item.expenditure_amount || 0), 0)\n        //    React   \n        return { \n          ...prev, \n          items: updatedItems,\n          purchase_request_items: updatedItems,\n          total_expenditure_amount: totalExpenditure,\n          updated_at: new Date().toISOString() //    \n        }\n      })\n\n      for (const item of pendingItems) {\n        const { error } = await supabase\n          .from('purchase_request_items')\n          .update({\n            expenditure_date: date.toISOString(),\n            expenditure_amount: amount\n          })\n          .eq('id', item.id)\n\n        if (error) {\n          logger.error('   DB  ', { error, itemId: item.id })\n          throw error\n        }\n      }\n\n      // purchase_requests total_expenditure_amount \n      const totalExpenditure = allItems.reduce((sum, item) => {\n        if (pendingItems.find(pi => pi.id === item.id)) {\n          return sum + amount\n        }\n        return sum + (item.expenditure_amount || 0)\n      }, 0)\n\n      await supabase\n        .from('purchase_requests')\n        .update({ total_expenditure_amount: totalExpenditure })\n        .eq('id', purchaseIdNumber)\n\n      //      ( UI ) - DB   \n      for (const item of pendingItems) {\n        const memoryUpdated = markItemAsExpenditureSet(purchase.id, item.id, date.toISOString(), amount)\n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal]       ', { \n            purchaseId: purchase.id, \n            itemId: item.id \n          })\n        }\n      }\n\n      //         ( )\n      const memoryPurchase = findPurchaseInMemory(purchase.id)\n      if (memoryPurchase) {\n        const normalizedItems = (memoryPurchase.items && memoryPurchase.items.length > 0) \n          ? memoryPurchase.items \n          : (memoryPurchase.purchase_request_items || [])\n        const totalExpenditure = normalizedItems.reduce((sum, item) => sum + (item.expenditure_amount || 0), 0)\n        setPurchase(prev => ({\n          ...prev!,\n          items: normalizedItems,\n          purchase_request_items: normalizedItems,\n          total_expenditure_amount: totalExpenditure\n        }))\n      }\n\n      toast.success(`${pendingItems.length}     .`)\n\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      logger.error('     ', error)\n      toast.error('      .')\n    }\n  }\n\n  //     (   )\n  const handleCompleteAllStatement = async (selectedDate: Date) => {\n    if (!purchase || !canReceiptCheck) {\n      return\n    }\n\n    const formattedDate = selectedDate.toLocaleDateString('ko-KR', {\n      year: 'numeric',\n      month: '2-digit',\n      day: '2-digit'\n    })\n\n    const confirmMessage = `: ${purchase.purchase_order_number}\n\n   ?`\n    \n    if (!window.confirm(confirmMessage)) {\n      return\n    }\n\n    const selectedDateIso = selectedDate.toISOString()\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const allItems = prev.purchase_request_items || [];\n          const pendingItems = allItems.filter(item => !item.is_statement_received);\n          \n          const updatedItems = allItems.map(item => \n            !item.is_statement_received \n              ? { \n                  ...item, \n                  is_statement_received: true, \n                  statement_received_date: selectedDateIso,\n                  statement_received_by_name: currentUserName || null\n                }\n              : item\n          );\n          \n          return {\n            ...prev,\n            purchase_request_items: updatedItems,\n            items: prev.items ? updatedItems : prev.items,\n            is_statement_received: updatedItems.every(item => item.is_statement_received),\n            statement_received_at: selectedDateIso\n          }\n        })\n      }\n    }\n\n    try {\n      //     (    )\n      const allItems = purchase.purchase_request_items || [];\n      const pendingItems = allItems.filter(item => !item.is_statement_received);\n      \n      if (pendingItems.length === 0) {\n        toast.info('    .');\n        return;\n      }\n\n      logger.info(`   : ${pendingItems.length}  ( ${allItems.length} )`);\n      \n      for (const item of pendingItems) {\n        //   DB  (   )\n        const updateData = {\n          is_statement_received: true,\n          statement_received_date: selectedDateIso,\n          statement_received_by_name: currentUserName || null\n        };\n\n        const { error } = await supabase\n          .from('purchase_request_items')\n          .update(updateData)\n          .eq('id', item.id);\n\n        if (error) throw error;\n\n        //       (  )\n        const memoryUpdated = markItemAsStatementReceived(purchase.id, item.id, selectedDateIso, currentUserName || undefined);\n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal]        ', { \n            purchaseId: purchase.id, \n            itemId: item.id \n          });\n        }\n      }\n\n      toast.success(`${pendingItems.length}    .`);\n\n      //   (  )\n      await refreshModalData();\n      const refreshResult = onRefresh?.(true, { silent: true });\n      if (refreshResult instanceof Promise) {\n        await refreshResult;\n      }\n    } catch (error) {\n      logger.error('    ', error)\n      toast.error('     .')\n    }\n  }\n\n  //    (  + )\n  const handleCompleteAllReceipt = async (selectedDate: Date, receivedQuantity?: number) => {\n    if (!purchase || !canReceiveItems) {\n      return\n    }\n\n    //   \n    const confirmMessage = `: ${purchase.purchase_order_number}\n\n  ?`\n    \n    if (!window.confirm(confirmMessage)) {\n      return\n    }\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    try {\n      //     (   )\n      const allItems = purchase.purchase_request_items || [];\n      const pendingItems = allItems.filter(item => !item.is_received);\n      \n      const applyOptimisticUpdate = () => {\n        if (!Number.isNaN(purchaseIdNumber)) {\n          onOptimisticUpdate?.(purchaseIdNumber, prev => {\n            const updatedItems = (prev.items || []).map(item => {\n              const pendingItem = pendingItems.find((p: any) => String(p.id) === String(item.id))\n              if (pendingItem) {\n                //   , receivedQuantity  (quantity)  \n                return {\n                  ...item,\n                  is_received: true,\n                  actual_received_date: item.actual_received_date || selectedDate.toISOString(),\n                  received_quantity: receivedQuantity !== undefined ? receivedQuantity : item.quantity\n                }\n              }\n              return item\n            })\n            const updatedRequestItems = (prev.purchase_request_items || []).map(item => {\n              const pendingItem = pendingItems.find((p: any) => String(p.id) === String(item.id))\n              if (pendingItem) {\n                //   , receivedQuantity  (quantity)  \n                return {\n                  ...item,\n                  is_received: true,\n                  actual_received_date: item.actual_received_date || selectedDate.toISOString(),\n                  received_quantity: receivedQuantity !== undefined ? receivedQuantity : item.quantity\n                }\n              }\n              return item\n            })\n\n            return {\n              ...prev,\n              items: updatedItems,\n              purchase_request_items: updatedRequestItems,\n              is_received: true,\n              received_at: new Date().toISOString(),\n              updated_at: new Date().toISOString()\n            }\n          })\n        }\n      }\n      \n      if (pendingItems.length === 0) {\n        toast.info('   .');\n        return;\n      }\n\n      logger.info(`  : ${pendingItems.length}  ( ${allItems.length} )`);\n      \n      // Optimistic Update  \n      applyOptimisticUpdate()\n      \n      //    \n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => {\n          const pendingItem = pendingItems.find(p => String(p.id) === String(item.id))\n          if (pendingItem) {\n            // receivedQuantity  (quantity)  \n            return {\n              ...item,\n              is_received: true,\n              received_at: new Date().toISOString(),\n              actual_received_date: selectedDate.toISOString(),\n              received_quantity: receivedQuantity !== undefined ? receivedQuantity : item.quantity\n            }\n          }\n          return item\n        }) || []\n        const updatedRequestItems = prev.purchase_request_items?.map(item => {\n          const pendingItem = pendingItems.find(p => String(p.id) === String(item.id))\n          if (pendingItem) {\n            // receivedQuantity  (quantity)  \n            return {\n              ...item,\n              is_received: true,\n              received_at: new Date().toISOString(),\n              actual_received_date: selectedDate.toISOString(),\n              received_quantity: receivedQuantity !== undefined ? receivedQuantity : item.quantity\n            }\n          }\n          return item\n        }) || []\n        const total = updatedItems.length\n        const completed = updatedItems.filter(item => item.is_received).length\n        const allReceived = total > 0 && completed === total\n        \n        return {\n          ...prev,\n          items: updatedItems,\n          purchase_request_items: updatedRequestItems,\n          is_received: allReceived,\n          received_at: allReceived ? new Date().toISOString() : prev.received_at,\n          updated_at: new Date().toISOString()\n        }\n      })\n      \n      for (const item of pendingItems) {\n        //   DB  (   )\n        // receivedQuantity  (quantity)  \n        const updateData = {\n          actual_received_date: selectedDate.toISOString(),\n          is_received: true,\n          received_quantity: receivedQuantity !== undefined ? receivedQuantity : item.quantity //     \n        };\n\n        const { error } = await supabase\n          .from('purchase_request_items')\n          .update(updateData)\n          .eq('id', item.id);\n\n        if (error) throw error;\n\n        //       (  )\n        // receivedQuantity  (quantity)  \n        const itemReceivedQuantity = receivedQuantity !== undefined ? receivedQuantity : item.quantity\n        const memoryUpdated = markItemAsReceived(purchase.id, item.id, selectedDate.toISOString(), itemReceivedQuantity);\n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal]       ', { \n            purchaseId: purchase.id, \n            itemId: item.id \n          });\n        }\n      }\n\n      toast.success(`${pendingItems.length}   .`);\n\n      //   (  )\n      await refreshModalData();\n      const refreshResult = onRefresh?.(true, { silent: true });\n      if (refreshResult instanceof Promise) {\n        await refreshResult;\n      }\n    } catch (error) {\n      logger.error('   ', error)\n      toast.error('    .')\n    }\n  }\n  \n\n  //  \n  const handleReject = async (type: 'middle' | 'final') => {\n    if (!purchase) return\n    \n    const reason = window.prompt('  :')\n    if (!reason) return\n    \n    try {\n      const updateData = type === 'middle'\n        ? {\n            middle_manager_status: 'rejected'\n          }\n        : {\n            final_manager_status: 'rejected'\n          }\n      \n      const { error } = await supabase\n        .from('purchase_requests')\n        .update(updateData)\n        .eq('id', purchase.id)\n      \n      if (error) {\n        throw error\n      }\n      \n      //     (UI  )\n      if (type === 'middle') {\n        setPurchase(prev => prev ? { ...prev, middle_manager_status: 'rejected' } : null)\n      } else {\n        setPurchase(prev => prev ? { ...prev, final_manager_status: 'rejected' } : null)\n      }\n      \n      toast.success(`${type === 'middle' ? '' : ''}  .`)\n    } catch (error) {\n      toast.error('    .')\n    }\n  }\n\n  const content = (\n    <div className=\"space-y-1 sm:space-y-4\">\n      {loading ? (\n        <div className=\"flex items-center justify-center py-12\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-hansl-600\"></div>\n        </div>\n      ) : purchase ? (\n        <div>\n          {/* Compact Info Header */}\n          <div className=\"bg-gray-50 rounded-lg p-2 sm:p-3 mb-1 sm:mb-2 border border-gray-100\">\n            <div className=\"grid grid-cols-1 sm:grid-cols-3 items-center gap-3 sm:gap-0\">\n              <div className=\"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-4\">\n                <div className=\"flex items-center gap-3\">\n                  {getStatusBadge()}\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"modal-label\">:</span>\n                    <span className=\"modal-value\">{purchase.requester_name}</span>\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Calendar className=\"w-3 h-3 text-gray-500\" />\n                  <span className=\"modal-subtitle\">: {formatDate(purchase.request_date)}</span>\n                </div>\n              </div>\n              \n              {/*     */}\n              <div className=\"flex items-center justify-center gap-2 sm:gap-3 flex-wrap\">\n                {/* 1   */}\n                {(() => {\n                  const shouldShow = canApproveMiddle && purchase.middle_manager_status === 'pending';\n                  return shouldShow;\n                })() && (\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => handleApprove('middle')}\n                    className={`${approvalButtonClass} border border-gray-400 bg-white hover:bg-gray-50 hover:border-gray-500`}\n                  >\n                    1  \n                  </Button>\n                )}\n                {purchase.middle_manager_status === 'approved' && (\n                  <div className=\"button-approved badge-text shadow-sm\">\n                    <Check className=\"w-3 h-3\" />\n                    1 \n                  </div>\n                )}\n                {purchase.middle_manager_status === 'rejected' && (\n                  <div className=\"button-rejected badge-text\">\n                    <X className=\"w-3 h-3\" />\n                    1 \n                  </div>\n                )}\n                {purchase.middle_manager_status === 'pending' && !canApproveMiddle && (\n                  <div className={`${approvalWaitingPillClass} border border-gray-300 text-gray-600 bg-white`}>\n                    1 \n                  </div>\n                )}\n\n                {/*    */}\n                {(() => {\n                  const shouldShow = canApproveFinal && purchase.middle_manager_status === 'approved' && purchase.final_manager_status === 'pending';\n                  return shouldShow;\n                })() && (\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => handleApprove('final')}\n                    className={`${approvalButtonClass} border border-gray-400 bg-white hover:bg-gray-50 hover:border-gray-500`}\n                  >\n                    <Check className=\"w-3 h-3\" />\n                     \n                  </Button>\n                )}\n                {purchase.final_manager_status === 'approved' && (\n                  <div className=\"button-approved badge-text\">\n                    <Check className=\"w-3 h-3\" />\n                     \n                  </div>\n                )}\n                {purchase.final_manager_status === 'rejected' && (\n                  <div className=\"button-rejected badge-text\">\n                    <X className=\"w-3 h-3\" />\n                     \n                  </div>\n                )}\n                {purchase.middle_manager_status !== 'approved' && purchase.final_manager_status === 'pending' && (\n                  <div className={`${approvalWaitingPillClass} border border-gray-300 text-gray-600 bg-white`}>\n                     \n                  </div>\n                )}\n              </div>\n              \n              {/*    */}\n              <div></div>\n            </div>\n          </div>\n\n          {/* Main 2-Column Layout */}\n          <div className=\"flex flex-col lg:flex-row gap-3 sm:gap-6\">\n            {/* Left Column - Basic Info (Fixed Width) */}\n            <div className=\"lg:w-80 lg:flex-shrink-0 space-y-1 sm:space-y-4 relative\">\n              \n              {/*   */}\n              <div className=\"bg-white rounded-lg p-2 sm:p-3 border border-gray-100 shadow-sm\">\n                <div className=\"mb-3\">\n                  <div className=\"flex items-center justify-between\">\n                    <h3 className=\"modal-section-title flex items-center\">\n                      <FileText className=\"w-4 h-4 mr-2 text-gray-600\" />\n                      {purchase?.purchase_order_number || 'PO '}\n                    </h3>\n                    {canReceiptCheck && canViewFinancialInfo && activeTab === 'done' && (\n                      <button\n                        onClick={async () => {\n                          if (!purchase) return\n                          const isCurrentlyChecked = purchase.is_utk_checked || false\n                          const newStatus = !isCurrentlyChecked\n                          \n                          const confirmMessage = newStatus\n                            ? `: ${purchase.purchase_order_number}\\n\\nUTK  ?`\n                            : `: ${purchase.purchase_order_number}\\n\\nUTK  ?`\n                          \n                          if (!window.confirm(confirmMessage)) return\n                          \n                          try {\n                            const supabase = createClient()\n                            const { error } = await supabase\n                              .from('purchase_requests')\n                              .update({ is_utk_checked: newStatus })\n                              .eq('id', purchase.id)\n                            \n                            if (error) {\n                              logger.error('UTK  DB  ', { error, purchaseId: purchase.id })\n                              toast.error('UTK     .')\n                              return\n                            }\n                            \n                            //     (   React  )\n                            setPurchase(prev => prev ? { \n                              ...prev, \n                              is_utk_checked: newStatus,\n                              updated_at: new Date().toISOString() //    \n                            } : null)\n                            \n                            //   \n                            if (purchase.id) {\n                              updatePurchaseInMemory(purchase.id, (prev) => ({\n                                ...prev,\n                                is_utk_checked: newStatus\n                              }))\n                            }\n                            \n                            toast.success(newStatus ? 'UTK  .' : 'UTK  .')\n                            \n                            await refreshModalData()\n                            const refreshResult = onRefresh?.(true, { silent: true })\n                            if (refreshResult instanceof Promise) {\n                              await refreshResult\n                            }\n                          } catch (error) {\n                            logger.error('UTK    ', error)\n                            toast.error('UTK     .')\n                          }\n                        }}\n                        className={`button-base text-xs px-2 py-1 flex items-center ${\n                          purchase?.is_utk_checked\n                            ? 'button-toggle-active bg-orange-500 hover:bg-orange-600 text-white'\n                            : 'button-toggle-inactive'\n                        }`}\n                        title={purchase?.is_utk_checked ? 'UTK  ' : 'UTK '}\n                      >\n                        <CheckCircle className=\"w-3 h-3 mr-1\" />\n                        UTK {purchase?.is_utk_checked ? '' : ''}\n                      </button>\n                    )}\n                  </div>\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\"> </span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.request_type || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, request_type: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.request_type || ''}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\"> </span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.payment_category || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, payment_category: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"//\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.payment_category || '-'}</p>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\"> </span>\n                      {isEditing ? (\n                        <DatePickerPopover\n                          onDateSelect={(date) => {\n                            setEditedPurchase(prev => prev ? {\n                              ...prev,\n                              delivery_request_date: formatDateInput(date, 'yyyy-MM-dd')\n                            } : null)\n                          }}\n                          placeholder=\"  \"\n                          align=\"start\"\n                          side=\"bottom\"\n                        >\n                          <Button\n                            variant=\"outline\"\n                            className=\"mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] justify-start text-left font-normal business-radius-input\"\n                          >\n                            <Calendar className=\"mr-1 h-3 w-3\" />\n                            {editedPurchase?.delivery_request_date ? \n                              formatDate(editedPurchase.delivery_request_date) : \n                              ' '\n                            }\n                          </Button>\n                        </DatePickerPopover>\n                      ) : (\n                        <p className=\"modal-subtitle\">{formatDate(purchase.delivery_request_date)}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label text-orange-500\"> </span>\n                      {isEditing ? (\n                        <DatePickerPopover\n                          onDateSelect={(date) => {\n                            setEditedPurchase(prev => prev ? {\n                              ...prev,\n                              revised_delivery_request_date: formatDateInput(date, 'yyyy-MM-dd')\n                            } : null)\n                          }}\n                          placeholder=\"  \"\n                          align=\"start\"\n                          side=\"bottom\"\n                        >\n                          <Button\n                            variant=\"outline\"\n                            className=\"mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] justify-start text-left font-normal business-radius-input\"\n                          >\n                            <Calendar className=\"mr-1 h-3 w-3\" />\n                            {editedPurchase?.revised_delivery_request_date ? \n                              formatDate(editedPurchase.revised_delivery_request_date) : \n                              ' '\n                            }\n                          </Button>\n                        </DatePickerPopover>\n                      ) : (\n                        <p className=\"modal-subtitle text-orange-700\">\n                          {purchase.revised_delivery_request_date ? formatDate(purchase.revised_delivery_request_date) : ''}\n                        </p>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/*   */}\n              <div className=\"bg-white rounded-lg p-2 sm:p-3 border border-gray-100 shadow-sm\">\n                <h3 className=\"modal-section-title mb-3 flex items-center\">\n                  <Building2 className=\"w-4 h-4 mr-2 text-gray-600\" />\n                   \n                </h3>\n                \n                <div className=\"space-y-2\">\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\"></span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.vendor?.vendor_name || editedPurchase?.vendor_name || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, vendor_name: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\" \"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.vendor?.vendor_name || '-'}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\"> </span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.vendor_contacts?.[0]?.contact_name || ''}\n                          onChange={(e) => {\n                            setEditedPurchase(prev => {\n                              if (!prev) return null;\n                              const contacts = prev.vendor_contacts || [];\n                              const updatedContacts = [...contacts];\n                              if (updatedContacts[0]) {\n                                updatedContacts[0] = { ...updatedContacts[0], contact_name: e.target.value };\n                              } else {\n                                updatedContacts[0] = { contact_name: e.target.value } as any;\n                              }\n                              return { ...prev, vendor_contacts: updatedContacts };\n                            })\n                          }}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\" \"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.vendor_contacts?.[0]?.contact_name || '-'}</p>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">PJ</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.project_vendor || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, project_vendor: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.project_vendor || '-'}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">Item</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.project_item || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, project_item: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"\"\n                        />\n                      ) : (\n                        <p className=\"modal-subtitle\">{purchase.project_item || '-'}</p>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\"></span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.order_number || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, order_number: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"\"\n                        />\n                      ) : (\n                        <p className=\"modal-subtitle\">{purchase.order_number || '-'}</p>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n            </div>\n\n            {/* Right Column - Items List (Fit Width) */}\n            <div className=\"lg:w-fit lg:min-w-0 relative overflow-visible\">\n              \n              <div className=\"bg-white rounded-lg border border-gray-100 shadow-sm\">\n                <div className=\"p-2 sm:p-3 bg-gray-50 border-b border-gray-100 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-0\">\n                  <h3 className=\"modal-section-title flex items-center\">\n                    <Package className=\"w-4 h-4 mr-2 text-gray-600\" />\n                     \n                    <span className=\"ml-2 badge-stats bg-gray-500 text-white\">\n                      {currentItems?.length || 0}\n                    </span>\n                  </h3>\n                  {!isEditing && (\n                    <>\n                      {activeTab === 'purchase' && canPurchase && (\n                        <Button\n                          size=\"sm\"\n                          onClick={handleCompleteAllPayment}\n                          className=\"button-base bg-orange-500 hover:bg-orange-600 text-white\"\n                        >\n                          <CreditCard className=\"w-3 h-3 mr-1\" />\n                           \n                        </Button>\n                      )}\n                      {activeTab === 'receipt' && canReceiveItems && (\n                        <DateQuantityPickerPopover\n                          onConfirm={handleCompleteAllReceipt}\n                          placeholder=\" \"\n                          align=\"end\"\n                          side=\"bottom\"\n                          hideQuantityInput={true}\n                          quantityInfoText=\"   \"\n                        >\n                          <Button\n                            size=\"sm\"\n                            className=\"button-base button-action-primary\"\n                          >\n                            <Truck className=\"w-3 h-3 mr-1\" />\n                             \n                          </Button>\n                        </DateQuantityPickerPopover>\n                      )}\n                      {activeTab === 'done' && canReceiptCheck && canViewFinancialInfo && (\n                        <div className=\"flex items-center gap-2\">\n                          <DatePickerPopover\n                            onDateSelect={handleCompleteAllStatement}\n                            placeholder=\"   \"\n                            align=\"end\"\n                            side=\"bottom\"\n                          >\n                            <Button\n                              size=\"sm\"\n                              className=\"button-base button-action-primary\"\n                            >\n                              <FileText className=\"w-3 h-3 mr-1\" />\n                               \n                            </Button>\n                          </DatePickerPopover>\n                          <DateAmountPickerPopover\n                            onConfirm={handleBulkExpenditure}\n                            placeholder=\"    \"\n                            align=\"end\"\n                            side=\"bottom\"\n                          >\n                            <Button\n                              size=\"sm\"\n                              className=\"button-base button-action-primary\"\n                            >\n                              <DollarSign className=\"w-3 h-3 mr-1\" />\n                              \n                            </Button>\n                          </DateAmountPickerPopover>\n                        </div>\n                      )}\n                    </>\n                  )}\n                </div>\n                \n                {/* Mobile Table Header */}\n                <div className=\"block sm:hidden bg-gray-50 px-2 py-1 border-b border-gray-100\">\n                  <div className=\"text-xs font-medium text-gray-600\">  ( )</div>\n                </div>\n                \n                {/* Items List with Header Inside Scrollable Container */}\n                <div className=\"max-h-[50vh] sm:max-h-[40vh] overflow-auto\">\n                  <div className=\"w-fit\">\n                    {/* Items Table Header - Sticky inside scroll container */}\n                    <div className=\"bg-gray-50 px-2 sm:px-3 py-1 border-b border-gray-100 sticky top-0 z-10 w-fit\">\n                      <div \n                        ref={headerRowRef}\n                         className=\"hidden sm:grid gap-2 modal-label w-fit\"\n                        style={{\n                          gridTemplateColumns: getGridTemplateColumns()\n                        }}\n                      >\n                        <div></div>\n                        <div></div>\n                        <div className=\"text-center\">\n                          {(activeTab === 'receipt' || activeTab === 'done') && !isEditing ? (\n                            <div className=\"flex flex-col items-center leading-tight\">\n                              <div className=\"text-[9px]\">/</div>\n                              <div className=\"text-[10px]\"></div>\n                            </div>\n                          ) : (\n                            ''\n                          )}\n                        </div>\n                        <div className=\"text-right\"></div>\n                        <div className=\"text-right\"></div>\n                        <div className=\"text-center\"></div>\n                        {isEditing ? (\n                          <>\n                            <div className=\"text-center\"></div>\n                            {activeTab === 'receipt' && (\n                              <>\n                                <div className=\"text-center\"></div>\n                              </>\n                            )}\n                            {activeTab === 'done' && (\n                              <>\n                                <div className=\"text-center\"> </div>\n                                <div className=\"text-center\"> </div>\n                                <div className=\"text-center\"></div>\n                              </>\n                            )}\n                          </>\n                        ) : (\n                          <>\n                            <div className=\"text-center\">\n                              {activeTab === 'purchase'\n                                ? ''\n                                : (activeTab === 'receipt' || activeTab === 'done')\n                                ? ''\n                                : ''}\n                            </div>\n                            {activeTab === 'done' && (\n                              <>\n                                <div className=\"text-center\"> </div>\n                                <div className=\"text-center\"> </div>\n                                <div className=\"text-center\"></div>\n                              </>\n                            )}\n                            {activeTab === 'receipt' && (\n                              <>\n                                <div className=\"text-center\"></div>\n                              </>\n                            )}\n                          </>\n                        )}\n                      </div>\n                    </div>\n                    <div className=\"divide-y divide-gray-100 overflow-visible w-fit\">\n                      {(isEditing ? editedItems : currentItems)?.map((item, index) => (\n                        <div key={index} className=\"px-2 sm:px-3 py-1 border-b border-gray-50 hover:bg-gray-50/50 relative overflow-visible\">\n                          {/* Desktop Layout */}\n                          <div className={`hidden sm:grid items-center gap-2 overflow-visible w-fit`} style={{\n                            gridTemplateColumns: getGridTemplateColumns()\n                          }}>\n                            {/*  */}\n                            <div className=\"min-w-0 relative overflow-visible flex items-center\">\n                              {isEditing ? (\n                                <Input\n                                  value={item.item_name}\n                                  onChange={(e) => handleItemChange(index, 'item_name', e.target.value)}\n                                  onFocus={() => setFocusedInput(`item_name_${index}`)}\n                                  onBlur={() => setFocusedInput(null)}\n                                  className={`modal-label border-gray-200 rounded-lg w-full !px-1.5 !py-0.5 !text-[10px] focus:border-blue-400 transition-all duration-200 ${\n                                    focusedInput === `item_name_${index}` \n                                      ? '!h-auto !min-h-[20px] !absolute !z-[9999] !bg-white !shadow-lg !left-0 !right-0 !-translate-y-1/2 !top-1/2 !whitespace-normal' \n                                      : '!h-5 !truncate'\n                                  }`}\n                                  placeholder=\"\"\n                                  disabled={canEditLimited && !canEditAll}  // lead buyer   \n                                />\n                              ) : (\n                                <div \n                                  className=\"modal-value\" \n                                  style={{\n                                    whiteSpace: 'normal',\n                                    wordBreak: 'break-all', //    ( )\n                                    overflowWrap: 'break-word',\n                                    hyphens: 'none', //    \n                                    WebkitHyphens: 'none',\n                                    MozHyphens: 'none',\n                                    msHyphens: 'none',\n                                    lineHeight: '1.4',\n                                    maxHeight: '2.8em', //  2 \n                                    overflow: 'hidden',\n                                    display: '-webkit-box',\n                                    WebkitLineClamp: 2,\n                                    WebkitBoxOrient: 'vertical'\n                                  }}\n                                  title={item.item_name || ' '}\n                                >\n                                  {item.item_name || ' '}\n                                </div>\n                              )}\n                            </div>\n                            \n                            {/*  */}\n                            <div className=\"min-w-0 relative overflow-visible flex items-center\" style={{ width: '200px', maxWidth: '200px', minWidth: '200px' }}>\n                              {isEditing ? (\n                                <Input\n                                  value={item.specification}\n                                  onChange={(e) => handleItemChange(index, 'specification', e.target.value)}\n                                  onFocus={() => setFocusedInput(`specification_${index}`)}\n                                  onBlur={() => setFocusedInput(null)}\n                                  className={`modal-label border-gray-200 rounded-lg w-full !px-1.5 !py-0.5 !text-[10px] focus:border-blue-400 transition-all duration-200 ${\n                                    focusedInput === `specification_${index}` \n                                      ? '!h-auto !min-h-[20px] !absolute !z-[9999] !bg-white !shadow-lg !left-1/2 !-translate-x-1/2 !-translate-y-1/2 !top-1/2 !whitespace-normal !w-[300px]' \n                                      : '!h-5 !truncate'\n                                  }`}\n                                  placeholder=\"\"\n                                  disabled={canEditLimited && !canEditAll}  // lead buyer   \n                                />\n                              ) : (\n                                <div \n                                  className=\"text-[11px] text-gray-600 font-medium\" \n                                  style={{\n                                    whiteSpace: 'normal',\n                                    wordBreak: 'break-all', //    ( )\n                                    overflowWrap: 'break-word',\n                                    hyphens: 'none', //    \n                                    WebkitHyphens: 'none', // Safari \n                                    MozHyphens: 'none', // Firefox \n                                    msHyphens: 'none', // IE \n                                    lineHeight: '1.4',\n                                    maxHeight: '2.8em', //  2 \n                                    overflow: 'hidden',\n                                    display: '-webkit-box',\n                                    WebkitLineClamp: 2, //  2 \n                                    WebkitBoxOrient: 'vertical'\n                                  }}\n                                  title={item.specification || '-'}\n                                >\n                                  {item.specification || '-'}\n                                </div>\n                              )}\n                            </div>\n                            \n                            {/*  */}\n                            <div className=\"text-center min-w-0 flex items-center justify-center\">\n                              {isEditing ? (\n                                (activeTab === 'receipt' || activeTab === 'done') ? (\n                                  <div className=\"flex flex-col items-center gap-0.5 w-full\">\n                                    <Input\n                                      type=\"number\"\n                                      value={item.quantity}\n                                      onChange={(e) => handleItemChange(index, 'quantity', Number(e.target.value))}\n                                      className=\"border-gray-200 rounded-lg text-center w-full !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400\"\n                                      placeholder=\"\"\n                                      max=\"99999\"\n                                    />\n                                    <div className=\"flex items-center gap-0.5 w-full\">\n                                      <span className=\"text-[9px] text-gray-500\">/</span>\n                                      <Input\n                                        type=\"number\"\n                                        value={item.received_quantity ?? ''}\n                                        onChange={(e) => handleItemChange(index, 'received_quantity', e.target.value ? Number(e.target.value) : null)}\n                                        className=\"border-gray-200 rounded-lg text-center flex-1 !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400\"\n                                        placeholder=\"\"\n                                        max=\"99999\"\n                                      />\n                                    </div>\n                                  </div>\n                                ) : (\n                                  <Input\n                                    type=\"number\"\n                                    value={item.quantity}\n                                    onChange={(e) => handleItemChange(index, 'quantity', Number(e.target.value))}\n                                    className=\"border-gray-200 rounded-lg text-center w-full !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400\"\n                                    placeholder=\"\"\n                                    max=\"99999\"\n                                  />\n                                )\n                              ) : (\n                                (activeTab === 'receipt' || activeTab === 'done') ? (\n                                  (() => {\n                                    const quantity = item.quantity || 0\n                                    const receivedQuantity = item.received_quantity ?? 0\n                                    const shouldWrap = quantity >= 100 || receivedQuantity >= 100\n                                    const hasReceived = receivedQuantity > 0\n                                    \n                                    if (shouldWrap) {\n                                      return (\n                                        <div className=\"flex flex-col items-center leading-tight\">\n                                          <div className={`modal-subtitle ${hasReceived ? 'text-gray-400' : ''}`}>{quantity}</div>\n                                          <div className={`modal-subtitle ${hasReceived ? '' : 'text-gray-400'}`}>/{receivedQuantity}</div>\n                                        </div>\n                                      )\n                                    } else {\n                                      return (\n                                        <span className=\"modal-subtitle\">\n                                          <span className={hasReceived ? 'text-gray-400' : ''}>{quantity}</span>\n                                          <span className={hasReceived ? '' : 'text-gray-400'}>/{receivedQuantity}</span>\n                                        </span>\n                                      )\n                                    }\n                                  })()\n                                ) : (\n                                  <span className=\"modal-subtitle\">{item.quantity || 0}</span>\n                                )\n                              )}\n                            </div>\n                            \n                            {/*  */}\n                            <div className=\"text-right min-w-0 flex items-center justify-end\">\n                              {isEditing ? (\n                                <Input\n                                  type=\"number\"\n                                  value={item.unit_price_value}\n                                  onChange={(e) => handleItemChange(index, 'unit_price_value', Number(e.target.value))}\n                                  className=\"border-gray-200 rounded-lg text-right w-full !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400\"\n                                  placeholder=\"\"\n                                  max=\"100000000000\"\n                                />\n                              ) : (\n                                <span className=\"modal-subtitle\">\n                                  {activeTab === 'done' && !canViewFinancialInfo \n                                    ? '-' \n                                    : `${formatCurrency(item.unit_price_value)}`}\n                                </span>\n                              )}\n                            </div>\n                            \n                            {/*  (,  ) */}\n                            <div className=\"text-right min-w-0 flex items-center justify-end\">\n                              <span className={isEditing ? \"modal-subtitle\" : \"modal-value\"}>\n                                {activeTab === 'done' && !canViewFinancialInfo \n                                  ? '-' \n                                  : `${formatCurrency(item.amount_value || 0)}`}\n                              </span>\n                            </div>\n                            \n                            {/*  */}\n                            <div className=\"min-w-0 flex justify-center items-center text-center relative overflow-visible\" style={{ width: '150px', maxWidth: '150px', minWidth: '150px' }}>\n                              {isEditing ? (\n                                <Input\n                                  value={item.remark || ''}\n                                  disabled={canEditLimited && !canEditAll}  // lead buyer   \n                                  onChange={(e) => handleItemChange(index, 'remark', e.target.value)}\n                                  onFocus={() => setFocusedInput(`remark_${index}`)}\n                                  onBlur={() => setFocusedInput(null)}\n                                  className={`modal-label border-gray-200 rounded-lg text-center w-full !px-1.5 !py-0.5 !text-[10px] focus:border-blue-400 transition-all duration-200 ${\n                                    focusedInput === `remark_${index}` \n                                      ? '!h-auto !min-h-[20px] !absolute !z-[9999] !bg-white !shadow-lg !left-0 !right-0 !-translate-y-1/2 !top-1/2 !whitespace-normal !text-left' \n                                      : '!h-5 !truncate'\n                                  }`}\n                                  placeholder=\"\"\n                                />\n                              ) : (\n                                <div \n                                  className=\"text-[11px] text-gray-600 font-medium\"\n                                  style={{\n                                    width: '150px',\n                                    maxWidth: '150px',\n                                    minWidth: '150px',\n                                    boxSizing: 'border-box',\n                                    whiteSpace: 'normal',\n                                    wordBreak: 'break-all',\n                                    overflowWrap: 'break-word',\n                                    hyphens: 'none',\n                                    WebkitHyphens: 'none',\n                                    MozHyphens: 'none',\n                                    msHyphens: 'none',\n                                    lineHeight: '1.4',\n                                    maxHeight: '2.8em',\n                                    overflow: 'hidden',\n                                    display: '-webkit-box',\n                                    WebkitLineClamp: 2,\n                                    WebkitBoxOrient: 'vertical'\n                                  }}\n                                  title={item.remark || '-'}\n                                >\n                                  {item.remark || '-'}\n                                </div>\n                              )}\n                            </div>\n                            \n                            {/* / -   */}\n                            {activeTab !== 'pending' && (\n                              <div className=\"text-center flex justify-center items-center\">\n                                {isEditing ? (\n                                  <Button\n                                    size=\"sm\"\n                                    variant=\"ghost\"\n                                    onClick={() => handleRemoveItem(index)}\n                                    className=\"text-red-600 hover:bg-red-50 rounded-lg p-1 h-6 w-6\"\n                                  >\n                                    <Trash2 className=\"w-3 h-3\" />\n                                  </Button>\n                                ) : (\n                                  <>\n                                    {/*     */}\n                                    {activeTab === 'purchase' && (\n                                    <div className=\"flex justify-center\">\n                                      {canPurchase ? (\n                                        <button\n                                          onClick={() => handlePaymentToggle(item.id, !item.is_payment_completed)}\n                                          className={`${\n                                            item.is_payment_completed\n                                              ? 'button-toggle-active bg-orange-500 hover:bg-orange-600 text-white'\n                                              : 'button-toggle-inactive'\n                                          }`}\n                                        >\n                                          {item.is_payment_completed ? '' : ''}\n                                        </button>\n                                      ) : (\n                                        <span className={`${\n                                          item.is_payment_completed \n                                            ? 'button-toggle-active bg-orange-500 text-white' \n                                            : 'button-waiting-inactive'\n                                        }`}>\n                                          {item.is_payment_completed ? '' : ''}\n                                        </span>\n                                      )}\n                                    </div>\n                                  )}\n                                  \n                                  {/*     */}\n                                  {activeTab === 'receipt' && (\n                                    <div className=\"flex justify-center\">\n                                      {canReceiveItems ? (\n                                        actualReceivedAction.isCompleted(item) ? (\n                                          <button\n                                            onClick={() => {\n                                              actualReceivedAction.handleCancel(item.id, {\n                                                item_name: item.item_name,\n                                                specification: item.specification,\n                                                quantity: item.quantity,\n                                                unit_price_value: item.unit_price_value,\n                                                amount_value: item.amount_value,\n                                                remark: item.remark\n                                              })\n                                            }}\n                                            className=\"button-action-primary\"\n                                          >\n                                            {actualReceivedAction.config.completedText}\n                                          </button>\n                                        ) : (\n                                          <DateQuantityPickerPopover\n                                            onConfirm={(date, quantity) => {\n                                              handleItemReceiptToggle(item.id, date, quantity)\n                                            }}\n                                            placeholder=\"  \"\n                                            align=\"center\"\n                                            side=\"bottom\"\n                                            defaultQuantity={item.received_quantity ?? undefined}\n                                            maxQuantity={item.quantity}\n                                          >\n                                            <button className=\"button-toggle-inactive\">\n                                              {actualReceivedAction.config.waitingText}\n                                            </button>\n                                          </DateQuantityPickerPopover>\n                                        )\n                                      ) : (\n                                        <span className={`${\n                                          actualReceivedAction.isCompleted(item)\n                                            ? 'button-action-primary' \n                                            : 'button-waiting-inactive'\n                                        }`}>\n                                          {actualReceivedAction.isCompleted(item) ? actualReceivedAction.config.completedText : actualReceivedAction.config.waitingText}\n                                        </span>\n                                      )}\n                                    </div>\n                                  )}\n                                  \n                                  {/*       ( ) */}\n                                  {activeTab === 'done' && (\n                                    <div className=\"flex justify-center\">\n                                      <span className={`button-base ${\n                                        actualReceivedAction.isCompleted(item)\n                                          ? 'bg-blue-500 hover:bg-blue-600 text-white' \n                                          : 'border border-gray-300 text-gray-600 bg-white hover:bg-gray-50'\n                                      }`}>\n                                        {actualReceivedAction.isCompleted(item) ? '' : ''}\n                                      </span>\n                                    </div>\n                                  )}\n                                  \n                                  {/*      */}\n                                  {activeTab !== 'purchase' && activeTab !== 'receipt' && activeTab !== 'done' && (\n                                    <div className=\"flex justify-center\">\n                                      <span className=\"badge-text\">-</span>\n                                    </div>\n                                  )}\n                                </>\n                              )}\n                              </div>\n                            )}\n                            \n                            {/*    -    (  ) */}\n                            {activeTab === 'receipt' && (\n                              <div className=\"text-center flex justify-center items-center pl-2\">\n                                {actualReceivedAction.getCompletedDate(item) ? (\n                                  <div className=\"modal-subtitle text-green-700\">\n                                    {new Date(actualReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                                      year: 'numeric',\n                                      month: '2-digit',\n                                      day: '2-digit'\n                                    })}\n                                  </div>\n                                ) : (\n                                  <span className=\"modal-subtitle text-gray-400\">-</span>\n                                )}\n                              </div>\n                            )}\n\n                            {/*   -    */}\n                            {activeTab === 'done' && (\n                              <div className=\"text-center flex justify-center items-center\">\n                                {canReceiptCheck ? (\n                                  statementReceivedAction.isCompleted(item) ? (\n                                    <button\n                                      onClick={() => {\n                                        statementReceivedAction.handleCancel(item.id, {\n                                          item_name: item.item_name,\n                                          specification: item.specification,\n                                          quantity: item.quantity,\n                                          unit_price_value: item.unit_price_value,\n                                          amount_value: item.amount_value,\n                                          remark: item.remark\n                                        })\n                                      }}\n                                      className=\"button-action-primary hover:bg-green-600\"\n                                      title=\"   \"\n                                    >\n                                      {statementReceivedAction.config.completedText}\n                                    </button>\n                                  ) : (\n                                    <DatePickerPopover\n                                      onDateSelect={(date) => {\n                                        statementReceivedAction.handleConfirm(item.id, date, {\n                                          item_name: item.item_name,\n                                          specification: item.specification,\n                                          quantity: item.quantity,\n                                          unit_price_value: item.unit_price_value,\n                                          amount_value: item.amount_value,\n                                          remark: item.remark\n                                        })\n                                      }}\n                                      placeholder=\"  \"\n                                      align=\"center\"\n                                      side=\"bottom\"\n                                    >\n                                      <button \n                                        className=\"button-toggle-inactive\"\n                                        onClick={() => {}}\n                                      >\n                                        {statementReceivedAction.config.waitingText}\n                                      </button>\n                                    </DatePickerPopover>\n                                  )\n                                ) : (\n                                  <span className={`${\n                                    statementReceivedAction.isCompleted(item)\n                                      ? 'button-action-primary' \n                                      : 'button-waiting-inactive'\n                                  }`}>\n                                    {statementReceivedAction.isCompleted(item) ? statementReceivedAction.config.completedText : statementReceivedAction.config.waitingText}\n                                  </span>\n                                )}\n                              </div>\n                            )}\n\n                            {/*   -    */}\n                            {activeTab === 'done' && (\n                              <div className=\"text-center flex justify-center items-center\">\n                                {statementReceivedAction.getCompletedDate(item) ? (\n                                  <div className=\"modal-subtitle text-blue-700\">\n                                    {new Date(statementReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                                      year: 'numeric',\n                                      month: '2-digit',\n                                      day: '2-digit'\n                                    })}\n                                  </div>\n                                ) : (\n                                  <span className=\"modal-subtitle text-gray-400\">-</span>\n                                )}\n                              </div>\n                            )}\n\n                            {/*  -    */}\n                            {activeTab === 'done' && (\n                              <div className=\"text-center flex justify-center items-center\">\n                                {(() => {\n                                  const hasExpenditure = item.expenditure_date && \n                                                        item.expenditure_amount !== null && \n                                                        item.expenditure_amount !== undefined\n                                  \n                                  if (canReceiptCheck) {\n                                    return hasExpenditure ? (\n                                      <div className=\"w-full px-1 leading-none\">\n                                        <div className=\"text-blue-700 text-[9px] leading-[1.1] font-normal\">\n                                          {new Date(item.expenditure_date).toLocaleDateString('ko-KR', {\n                                            year: 'numeric',\n                                            month: '2-digit',\n                                            day: '2-digit'\n                                          })}\n                                        </div>\n                                        <div className=\"text-gray-700 text-[9px] leading-[1.1] font-normal\">\n                                          {!canViewFinancialInfo \n                                            ? '-' \n                                            : `${Number(item.expenditure_amount).toLocaleString()}`}\n                                        </div>\n                                      </div>\n                                    ) : (\n                                      <DateAmountPickerPopover\n                                        onConfirm={(date, amount) => handleItemExpenditure(item.id, date, amount)}\n                                        placeholder=\"   \"\n                                        align=\"center\"\n                                        side=\"bottom\"\n                                      >\n                                        <button className=\"button-toggle-inactive\">\n                                          \n                                        </button>\n                                      </DateAmountPickerPopover>\n                                    )\n                                  } else {\n                                    return hasExpenditure ? (\n                                      <div className=\"w-full px-1 leading-none\">\n                                        <div className=\"text-blue-700 text-[9px] leading-[1.1] font-normal\">\n                                          {new Date(item.expenditure_date).toLocaleDateString('ko-KR', {\n                                            year: 'numeric',\n                                            month: '2-digit',\n                                            day: '2-digit'\n                                          })}\n                                        </div>\n                                        <div className=\"text-gray-700 text-[9px] leading-[1.1] font-normal\">\n                                          {!canViewFinancialInfo \n                                            ? '-' \n                                            : `${Number(item.expenditure_amount).toLocaleString()}`}\n                                        </div>\n                                      </div>\n                                    ) : (\n                                      <span className=\"modal-subtitle text-gray-400\">-</span>\n                                    )\n                                  }\n                                })()}\n                              </div>\n                            )}\n\n                          </div>\n                          \n                          {/* Mobile Layout */}\n                          <div className=\"block sm:hidden space-y-2\">\n                            <div className=\"flex justify-between items-start\">\n                              <div className=\"flex-1 min-w-0 relative\">\n                                {isEditing ? (\n                                  <Input\n                                    value={item.item_name}\n                                    onChange={(e) => handleItemChange(index, 'item_name', e.target.value)}\n                                    onFocus={() => setFocusedInput(`m_item_name_${index}`)}\n                                    onBlur={() => setFocusedInput(null)}\n                                    className={`modal-label border-gray-200 rounded-lg w-full !px-1.5 !py-0.5 !text-[10px] focus:border-blue-400 transition-all duration-200 ${\n                                      focusedInput === `m_item_name_${index}` \n                                        ? '!h-auto !min-h-[20px] !absolute !z-[9999] !bg-white !shadow-lg !left-0 !right-0 !-translate-y-1/2 !top-1/2 !whitespace-normal' \n                                        : '!h-5 !truncate'\n                                    }`}\n                                    placeholder=\"\"\n                                    disabled={canEditLimited && !canEditAll}  // lead buyer   \n                                  />\n                                ) : (\n                                  <div className=\"modal-value font-medium\">{item.item_name || ' '}</div>\n                                )}\n                                {isEditing ? (\n                                  <Input\n                                    value={item.specification}\n                                    onChange={(e) => handleItemChange(index, 'specification', e.target.value)}\n                                    onFocus={() => setFocusedInput(`m_specification_${index}`)}\n                                    onBlur={() => setFocusedInput(null)}\n                                    className={`modal-label border-gray-200 rounded-lg mt-1 w-full !px-1.5 !py-0.5 !text-[10px] focus:border-blue-400 transition-all duration-200 ${\n                                      focusedInput === `m_specification_${index}` \n                                        ? '!h-auto !min-h-[20px] !absolute !z-[9999] !bg-white !shadow-lg !left-0 !right-0 !-translate-y-1/2 !top-1/2 !whitespace-normal !w-full' \n                                        : '!h-5 !truncate'\n                                    }`}\n                                    placeholder=\"\"\n                                    disabled={canEditLimited && !canEditAll}  // lead buyer   \n                                  />\n                                ) : (\n                                  <div className=\"modal-subtitle text-gray-500\">{item.specification || '-'}</div>\n                                )}\n                              </div>\n                              <div className=\"ml-3 text-right flex-shrink-0\">\n                                <div className={`${isEditing ? \"modal-subtitle\" : \"modal-value\"} font-semibold`}>{formatCurrency(item.amount_value || 0)}</div>\n                              </div>\n                            </div>\n                            \n                            <div className=\"grid grid-cols-3 gap-2 text-sm\">\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">:</span>\n                                {isEditing ? (\n                                  <Input\n                                    type=\"number\"\n                                    value={item.quantity}\n                                    onChange={(e) => handleItemChange(index, 'quantity', Number(e.target.value))}\n                                    className=\"border-gray-200 rounded-lg mt-1 w-full !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400\"\n                                    placeholder=\"\"\n                                  />\n                                ) : (\n                                  <div className=\"modal-subtitle\">{item.quantity || 0}</div>\n                                )}\n                              </div>\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">:</span>\n                                {isEditing ? (\n                                  <Input\n                                    type=\"number\"\n                                    value={item.unit_price_value}\n                                    onChange={(e) => handleItemChange(index, 'unit_price_value', Number(e.target.value))}\n                                    className=\"border-gray-200 rounded-lg mt-1 w-full !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400\"\n                                    placeholder=\"\"\n                                  />\n                                ) : (\n                                  <div className=\"modal-subtitle\">\n                                    {activeTab === 'done' && !canViewFinancialInfo \n                                      ? '-' \n                                      : `${formatCurrency(item.unit_price_value)}`}\n                                  </div>\n                                )}\n                              </div>\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">:</span>\n                                <div className=\"mt-1\">\n                                  {isEditing ? (\n                                    <Button\n                                      size=\"sm\"\n                                      variant=\"ghost\"\n                                      onClick={() => handleRemoveItem(index)}\n                                      className=\"text-red-600 hover:bg-red-50 rounded-lg p-1 h-6 w-6\"\n                                    >\n                                      <Trash2 className=\"w-3 h-3\" />\n                                    </Button>\n                                  ) : (\n                                    <>\n                                      {activeTab === 'purchase' && (\n                                        <>\n                                          {canPurchase ? (\n                                            <button\n                                              onClick={() => handlePaymentToggle(item.id, !item.is_payment_completed)}\n                                              className={`text-xs px-2 py-1 rounded ${\n                                                item.is_payment_completed\n                                                  ? 'bg-orange-500 text-white hover:bg-orange-600'\n                                                  : 'bg-gray-100 text-gray-600'\n                                              }`}\n                                            >\n                                              {item.is_payment_completed ? '' : ''}\n                                            </button>\n                                          ) : (\n                                            <span className={`text-xs px-2 py-1 rounded ${\n                                              item.is_payment_completed \n                                                ? 'bg-orange-500 text-white' \n                                                : 'bg-gray-100 text-gray-400'\n                                            }`}>\n                                              {item.is_payment_completed ? '' : ''}\n                                            </span>\n                                          )}\n                                        </>\n                                      )}\n                                      \n                                      {activeTab === 'receipt' && (\n                                        <>\n                                          {canProcessReceipt ? (\n                                            actualReceivedAction.isCompleted(item) ? (\n                                              <button\n                                                onClick={() => {\n                                                  actualReceivedAction.handleCancel(item.id, {\n                                                    item_name: item.item_name,\n                                                    specification: item.specification,\n                                                    quantity: item.quantity,\n                                                    unit_price_value: item.unit_price_value,\n                                                    amount_value: item.amount_value,\n                                                    remark: item.remark\n                                                  })\n                                                }}\n                                                className=\"text-xs px-2 py-1 rounded button-action-primary\"\n                                              >\n                                                {actualReceivedAction.config.completedText}\n                                              </button>\n                                            ) : (\n                                              <DatePickerPopover\n                                                onDateSelect={(date) => {\n                                                  actualReceivedAction.handleConfirm(item.id, date, {\n                                                    item_name: item.item_name,\n                                                    specification: item.specification,\n                                                    quantity: item.quantity,\n                                                    unit_price_value: item.unit_price_value,\n                                                    amount_value: item.amount_value,\n                                                    remark: item.remark\n                                                  })\n                                                }}\n                                                placeholder=\"   \"\n                                                align=\"center\"\n                                                side=\"bottom\"\n                                              >\n                                                <button className=\"text-xs px-2 py-1 rounded bg-gray-100 text-gray-600\">\n                                                  {actualReceivedAction.config.waitingText}\n                                                </button>\n                                              </DatePickerPopover>\n                                            )\n                                          ) : (\n                                            <span className={`text-xs px-2 py-1 rounded ${\n                                              actualReceivedAction.isCompleted(item)\n                                                ? 'button-action-primary' \n                                                : 'bg-gray-100 text-gray-400'\n                                            }`}>\n                                              {actualReceivedAction.isCompleted(item) ? actualReceivedAction.config.completedText : actualReceivedAction.config.waitingText}\n                                            </span>\n                                          )}\n                                        </>\n                                      )}\n                                      \n                                      {activeTab === 'done' && (\n                                        <>\n                                          {/*       ( ) */}\n                                          <span className={`button-base ${\n                                            actualReceivedAction.isCompleted(item)\n                                              ? 'bg-green-500 text-white' \n                                              : 'border border-gray-300 text-gray-600 bg-white'\n                                          }`}>\n                                            {actualReceivedAction.isCompleted(item) ? '' : ''}\n                                          </span>\n                                        </>\n                                      )}\n                                      \n                                      {activeTab !== 'purchase' && activeTab !== 'receipt' && activeTab !== 'done' && (\n                                        <span className=\"text-xs text-gray-400\">-</span>\n                                      )}\n                                    </>\n                                  )}\n                                </div>\n                              </div>\n                            </div>\n                            \n                            {(item.remark || isEditing) && (\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">:</span>\n                                {isEditing ? (\n                                  <Input\n                                    value={item.remark || ''}\n                                    onChange={(e) => handleItemChange(index, 'remark', e.target.value)}\n                                    className=\"modal-label border-gray-200 rounded-lg mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                    placeholder=\"\"\n                                  />\n                                ) : (\n                                  <div className=\"modal-subtitle text-gray-500 mt-1\">{item.remark || '-'}</div>\n                                )}\n                              </div>\n                            )}\n                            \n                            {/*      */}\n                            {!isEditing && activeTab === 'receipt' && actualReceivedAction.getCompletedDate(item) && (\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">:</span>\n                                <div className=\"mt-1\">\n                                  <div className=\"modal-subtitle text-green-700\">\n                                    {new Date(actualReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                                      year: 'numeric',\n                                      month: '2-digit',\n                                      day: '2-digit'\n                                    })}\n                                  </div>\n                                  <div className=\"text-[9px] text-gray-500\">\n                                    {new Date(actualReceivedAction.getCompletedDate(item)).toLocaleTimeString('ko-KR', {\n                                      hour: '2-digit',\n                                      minute: '2-digit'\n                                    })}\n                                  </div>\n                                </div>\n                              </div>\n                            )}\n\n                            {/*     -   */}\n                            {!isEditing && activeTab === 'done' && (\n                              <div className=\"flex items-center justify-between\">\n                                <span className=\"text-gray-500 text-xs\"> :</span>\n                                <div className=\"flex items-center gap-2\">\n                                  {canReceiptCheck ? (\n                                    statementReceivedAction.isCompleted(item) ? (\n                                      <button\n                                        onClick={() => {\n                                          statementReceivedAction.handleCancel(item.id, {\n                                            item_name: item.item_name,\n                                            specification: item.specification,\n                                            quantity: item.quantity,\n                                            unit_price_value: item.unit_price_value,\n                                            amount_value: item.amount_value,\n                                            remark: item.remark\n                                          })\n                                        }}\n                                        className=\"text-xs px-2 py-1 rounded button-action-primary hover:bg-green-600\"\n                                        title=\"   \"\n                                      >\n                                        {statementReceivedAction.config.completedText}\n                                      </button>\n                                    ) : (\n                                      <DatePickerPopover\n                                        onDateSelect={(date) => {\n                                          statementReceivedAction.handleConfirm(item.id, date, {\n                                            item_name: item.item_name,\n                                            specification: item.specification,\n                                            quantity: item.quantity,\n                                            unit_price_value: item.unit_price_value,\n                                            amount_value: item.amount_value,\n                                            remark: item.remark\n                                          })\n                                        }}\n                                        placeholder=\"  \"\n                                        align=\"end\"\n                                        side=\"bottom\"\n                                      >\n                                        <button \n                                          className=\"text-xs px-2 py-1 rounded bg-gray-100 text-gray-600\"\n                                          onClick={() => {}}\n                                        >\n                                          {statementReceivedAction.config.waitingText}\n                                        </button>\n                                      </DatePickerPopover>\n                                    )\n                                  ) : (\n                                    <span className={`text-xs px-2 py-1 rounded ${\n                                      statementReceivedAction.isCompleted(item)\n                                        ? 'button-action-primary' \n                                        : 'bg-gray-100 text-gray-400'\n                                    }`}>\n                                      {statementReceivedAction.isCompleted(item) ? statementReceivedAction.config.completedText : statementReceivedAction.config.waitingText}\n                                    </span>\n                                  )}\n                                </div>\n                              </div>\n                            )}\n\n                            {/*     -   */}\n                            {!isEditing && activeTab === 'done' && statementReceivedAction.getCompletedDate(item) && (\n                              <div>\n                                <span className=\"text-gray-500 text-xs\"> :</span>\n                                <div className=\"mt-1\">\n                                  <div className=\"modal-subtitle text-blue-700\">\n                                    {new Date(statementReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                                      year: 'numeric',\n                                      month: '2-digit',\n                                      day: '2-digit'\n                                    })}\n                                  </div>\n                                </div>\n                              </div>\n                            )}\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                </div>\n                \n                {/*  */}\n                <div className=\"bg-gray-50 px-2 sm:px-3 border-t border-gray-100\">\n                  <div className=\"hidden sm:grid items-center gap-2 py-0.5 w-fit\" style={{\n                    gridTemplateColumns: getGridTemplateColumns()\n                  }}>\n                    {/*  */}\n                    <div></div>\n                    {/*  */}\n                    <div></div>\n                    {/*  */}\n                    <div></div>\n                    {/*  */}\n                    <div className=\"text-right\">\n                      <span className=\"text-[12px] font-bold text-gray-900\"></span>\n                    </div>\n                    {/*  */}\n                    <div className=\"text-right\">\n                      <span className=\"text-[12px] font-bold text-gray-600\">\n                        {activeTab === 'done' && !canViewFinancialInfo \n                          ? '-' \n                          : `${formatCurrency(\n                              (isEditing ? editedItems : currentItems)?.reduce((sum, item) => sum + (item.amount_value || 0), 0) || 0\n                            )}`}\n                      </span>\n                    </div>\n                    {/*    */}\n                    <div></div>\n                    {isEditing ? (\n                      <div></div>\n                    ) : (\n                      <div></div>\n                    )}\n                    {activeTab === 'receipt' && <div></div>}\n                    {activeTab === 'done' && (\n                      <>\n                        <div></div>\n                        <div></div>\n                        <div className=\"text-center\">\n                          <div className=\"text-[10px] font-medium text-gray-500 mb-0.5\"> </div>\n                          <div className=\"text-[12px] font-bold text-gray-600\">\n                            {!canViewFinancialInfo \n                              ? '-' \n                              : `${formatCurrency(\n                                  (isEditing ? editedItems : currentItems)?.reduce((sum: number, item: any) => {\n                                    return sum + (Number(item.expenditure_amount) || 0)\n                                  }, 0) || 0\n                                )}`}\n                          </div>\n                        </div>\n                      </>\n                    )}\n                  </div>\n                  \n                  {/* Mobile  */}\n                  <div className=\"block sm:hidden py-0.5\">\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-[13px] font-bold text-gray-900\"></span>\n                      <span className=\"text-[13px] font-bold text-gray-600\">\n                        {activeTab === 'done' && !canViewFinancialInfo \n                          ? '-' \n                          : `${formatCurrency(\n                              (isEditing ? editedItems : currentItems)?.reduce((sum, item) => sum + (item.amount_value || 0), 0) || 0\n                            )}`}\n                      </span>\n                    </div>\n                    {/* Mobile   -    */}\n                    {activeTab === 'done' && (\n                      <div className=\"flex justify-between items-center mt-1\">\n                        <span className=\"text-[13px] font-bold text-gray-900\"> </span>\n                        <span className=\"text-[13px] font-bold text-gray-600\">\n                          {!canViewFinancialInfo \n                            ? '-' \n                            : `${formatCurrency(\n                                (isEditing ? editedItems : currentItems)?.reduce((sum: number, item: any) => {\n                                  return sum + (Number(item.expenditure_amount) || 0)\n                                }, 0) || 0\n                              )}`}\n                        </span>\n                      </div>\n                    )}\n                  </div>\n                </div>\n                \n                {/*    */}\n                {isEditing && (\n                  <div className=\"p-2 sm:p-3 border-t border-gray-100\">\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={handleAddItem}\n                      className=\"w-full rounded-lg border-dashed border-2 border-gray-300 hover:border-gray-400 py-2 badge-text\"\n                    >\n                      <Plus className=\"w-4 h-4 mr-1\" />\n                       \n                    </Button>\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n      ) : (\n        <div className=\"text-center py-12\">\n          <span className=\"modal-subtitle\">\n                .\n          </span>\n        </div>\n      )}\n    </div>\n  )\n\n  // embedded true Dialog   \n  if (embedded) {\n    return content\n  }\n\n  // embedded false Dialog  \n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent \n        className=\"overflow-hidden bg-white rounded-lg shadow-sm border-0 w-full sm:w-auto max-w-[calc(100vw-48px)] sm:max-w-[calc(100vw-80px)] lg:max-w-[90vw] xl:max-w-[85vw] h-[95vh] sm:h-auto sm:max-h-[90vh] lg:max-h-[85vh] sm:rounded-lg flex flex-col\" \n        showCloseButton={false}\n      >\n        <DialogHeader className=\"sr-only\">\n          <DialogTitle>  </DialogTitle>\n        </DialogHeader>\n        {/* Apple-style Header */}\n        <div className=\"relative px-3 sm:px-6 pt-0 sm:pt-3 lg:pt-4 pb-0 sm:pb-2 lg:pb-3 flex-shrink-0\">\n          <button\n            onClick={onClose}\n            className=\"button-base button-action-secondary absolute right-3 sm:right-6 top-0 sm:top-3 lg:top-4 w-6 h-6 sm:w-8 sm:h-8 rounded-full\"\n          >\n            <X className=\"w-4 h-4 text-gray-500\" />\n          </button>\n          \n          <div className=\"pr-8 sm:pr-16\">\n            <div className=\"flex items-start gap-4 mb-0 sm:mb-3\">\n              <div className=\"min-w-0 flex-1\">\n                <h1 className=\"page-title mb-0 sm:mb-1\">\n                   \n                </h1>\n              </div>\n              <div className=\"flex items-center gap-3\">\n                {!isEditing && canEdit && (\n                  <>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => handleEditToggle(true)}\n                      className=\"button-base button-action-secondary\"\n                    >\n                      <Edit2 className=\"w-4 h-4 mr-2\" />\n                      \n                    </Button>\n                    {canDelete && onDelete && (\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={async () => {\n                          if (purchase) {\n                            try {\n                              await onDelete(purchase);\n                              \n                              //      \n                              onClose();\n                              if (onRefresh) {\n                                await onRefresh(true); //  \n                              }\n                            } catch (error) {\n                              logger.error('    ', error);\n                              toast.error('   .');\n                            }\n                          }\n                        }}\n                        className=\"button-base button-action-danger\"\n                      >\n                        <Trash2 className=\"w-4 h-4 mr-2\" />\n                        \n                      </Button>\n                    )}\n                  </>\n                )}\n                {isEditing && (\n                  <>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => {\n                        handleEditToggle(false)\n                        setEditedPurchase(purchase)\n                        setEditedItems(purchase?.items || [])\n                        setDeletedItemIds([])\n                      }}\n                      className=\"button-base button-action-secondary\"\n                    >\n                      <X className=\"w-4 h-4 mr-2\" />\n                      \n                    </Button>\n                    <Button\n                      size=\"sm\"\n                      onClick={handleSave}\n                      className=\"button-base button-action-primary\"\n                    >\n                      <Save className=\"w-4 h-4 mr-2\" />\n                      \n                    </Button>\n                  </>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Apple-style Content */}\n        <div className=\"overflow-y-auto flex-1 px-3 sm:px-6 pb-1 sm:pb-6 mt-0\">\n          {content}\n        </div>\n      </DialogContent>\n      \n    </Dialog>\n  )\n}\n\nexport default memo(PurchaseDetailModal)"],"file":"assets/PurchaseDetailModal-By9_dn7d.js"}