const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PurchaseItemsModal-DMNgumyX.js","assets/index-C0CYxAcP.js","assets/index-BxgBoBzQ.css","assets/dialog-BFKDgtHD.js","assets/index-kq8byAH5.js","assets/PurchaseDetailModal-BCQcnNSo.js","assets/helpers-CsHcdtkA.js","assets/calendar-sG7zPd6T.js","assets/chevron-right-B9jvK340.js","assets/chevron-down-OWnBlQg2.js","assets/popover-CAajBqF5.js","assets/calendar-DSSMeVsb.js","assets/package-m9H25yBN.js","assets/credit-card-DLaEaaL7.js","assets/card-D9ntLE1g.js","assets/plus-DXEnHDYo.js","assets/save-BKOMOrqE.js"])))=>i.map(i=>d[i]);
import{c as e,l as a,p as t,r as s,a as r,j as l,B as n,g as i,X as c,h as d,k as o,m,n as u,o as p,q as h,s as x,U as g,u as b,t as _,d as y,v as f,w as j,x as v,y as w,_ as N}from"./index-C0CYxAcP.js";import{t as k}from"./index-kq8byAH5.js";import{D as C,a as q,b as $,c as S,d as M,A as D}from"./dropdown-menu-CIN4U4HB.js";import{R as P}from"./rotate-ccw-CpNc6xo1.js";import{E as F}from"./eye-C1Xyeyad.js";import{C as R}from"./chevron-down-OWnBlQg2.js";import{g as T,P as V,D as I}from"./PurchaseDetailModal-BCQcnNSo.js";import{f as L}from"./helpers-CsHcdtkA.js";import{f as E,R as A,P as O,W,C as U,T as z,g as Y,h as B,O as J,i as K,I as Z}from"./dialog-BFKDgtHD.js";import{P as H,a as Q,b as G}from"./popover-CAajBqF5.js";import{S as X,a as ee,b as ae,c as te,d as se}from"./select-DQsWs738.js";import{C as re,f as le,a as ne}from"./calendar-sG7zPd6T.js";import{C as ie}from"./calendar-DSSMeVsb.js";import{P as ce}from"./package-m9H25yBN.js";import{S as de,C as oe,a as me,b as ue,c as pe}from"./card-D9ntLE1g.js";import"./chevron-right-B9jvK340.js";import"./credit-card-DLaEaaL7.js";import"./plus-DXEnHDYo.js";import"./save-BKOMOrqE.js";
/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=e("building",[["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3",key:"cabbwy"}],["rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",key:"1uxh74"}]]),xe=e("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),ge=e("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),be=e("sliders-vertical",[["line",{x1:"4",x2:"4",y1:"21",y2:"14",key:"1p332r"}],["line",{x1:"4",x2:"4",y1:"10",y2:"3",key:"gb41h5"}],["line",{x1:"12",x2:"12",y1:"21",y2:"12",key:"hf2csr"}],["line",{x1:"12",x2:"12",y1:"8",y2:"3",key:"1kfi7u"}],["line",{x1:"20",x2:"20",y1:"21",y2:"16",key:"1lhrwl"}],["line",{x1:"20",x2:"20",y1:"12",y2:"3",key:"16vvfq"}],["line",{x1:"2",x2:"6",y1:"14",y2:"14",key:"1uebub"}],["line",{x1:"10",x2:"14",y1:"8",y2:"8",key:"1yglbp"}],["line",{x1:"18",x2:"22",y1:"16",y2:"16",key:"1jxqpz"}]]),_e=["ì •í¬ì›…"],ye=(e,t,s)=>{if(!e||!s)return[];const r=Array.isArray(s.purchase_role)?s.purchase_role.map(e=>e.trim()):"string"==typeof s.purchase_role?s.purchase_role.split(",").map(e=>e.trim()):[];switch(t){case"pending":return e.filter(e=>{if("approved"===e.middle_manager_status&&"approved"===e.final_manager_status)return!1;if("rejected"===e.middle_manager_status||"rejected"===e.final_manager_status)return!1;if(r.includes("consumable_manager")&&"êµ¬ë§¤ ìš”ì²­"!==e.payment_category)return!1;if(r.includes("raw_material_manager")&&"ë°œì£¼"!==e.payment_category)return!1;if(r.includes("app_admin")||r.includes("ceo"))return a.debug("ğŸ”¥ App Admin detected! Showing all items for:",{purchase_order_number:e.purchase_order_number}),!0;if(r.includes("middle_manager")){return["pending","ëŒ€ê¸°","",null,void 0].includes(e.middle_manager_status)}return e.requester_name===s?.name});case"purchase":{const a=r.some(e=>["app_admin","ceo","lead buyer","finance_team","raw_material_manager","consumable_manager","purchase_manager","hr"].includes(e));return e.filter(e=>{const t="êµ¬ë§¤ ìš”ì²­"===e.payment_category,r=!e.is_payment_completed;if(!t||!r)return!1;const l=(e.progress_type||"").includes("ì„ ì§„í–‰"),n=(e.progress_type||"").includes("ì¼ë°˜")||!e.progress_type||""===e.progress_type,i="approved"===e.final_manager_status;return!!(l||n&&i)&&(!!a||e.requester_name===s?.name)})}case"receipt":{const a=r.includes("hr"),t=r.some(e=>["app_admin","ceo","lead buyer","finance_team","raw_material_manager","consumable_manager","purchase_manager"].includes(e));return e.filter(e=>{if(e.is_received)return!1;if(a||t){const a=(e.progress_type||"").includes("ì„ ì§„í–‰"),t="approved"===e.final_manager_status;return a||t}const r=(e.progress_type||"").includes("ì„ ì§„í–‰"),l="approved"===e.final_manager_status,n=e.requester_name===s?.name;return(r||l)&&n})}default:return e}},fe=(e,a)=>{if("is_payment_completed"===a){return!0===e.is_payment_completed?"ì™„ë£Œ":"ëŒ€ê¸°"}if("is_received"===a){return!0===e.is_received?"ì™„ë£Œ":"ëŒ€ê¸°"}if("is_statement_received"===a){return!0===e.is_statement_received?"ì™„ë£Œ":"ëŒ€ê¸°"}if("is_utk_checked"===a){return!0===e.is_utk_checked?"ì™„ë£Œ":"ëŒ€ê¸°"}const t=a.split(".");let s=e;for(const r of t){if(null==s)return null;s=s[r]}return s},je=(e,a)=>({pending:ye(e,"pending",a).length,purchase:ye(e,"purchase",a).length,receipt:ye(e,"receipt",a).length,done:ye(e,"done",a).length}),ve=(e,a,t)=>{let s=e;return a.tab&&(s=ye(s,a.tab,t)),a.employeeName&&(s=((e,a,t)=>{if(!e||!a||"ì „ì²´"===a)return e;const s=(Array.isArray(t?.purchase_role)?t.purchase_role.map(e=>e.trim()):"string"==typeof t?.purchase_role?t.purchase_role.split(",").map(e=>e.trim()):[]).some(e=>["lead buyer","ceo","finance_team","raw_material_manager","consumable_manager"].includes(e));return e.filter(e=>{const t=e.requester_name||"";return!(_e.includes(t)&&!s)&&t===a})})(s,a.employeeName,t)),a.searchTerm&&(s=((e,a)=>{if(!a||""===a.trim())return e;const t=a.toLowerCase().trim();return e.filter(e=>[e.purchase_order_number,e.requester_name,e.vendor_name,e.contact_name,...(e.purchase_request_items||[]).map(e=>[e.item_name,e.item_detail,e.manufacturer,e.model,e.specification,e.spec]).flat()].some(e=>e&&String(e).toLowerCase().includes(t)))})(s,a.searchTerm)),a.advancedFilters&&(s=((e,a)=>a&&0!==a.length?e.filter(e=>a.every(a=>{const{field:t,condition:s,value:r,dateField:l}=a,n=fe(e,l||t);switch(s){case"contains":return String(n).toLowerCase().includes(String(r).toLowerCase());case"equals":if("string"==typeof r&&r.includes("~")){const[e,a]=r.split("~"),t=new Date(n).toISOString().split("T")[0];return t>=e&&t<=a}if("string"==typeof r&&(r.match(/^\d{4}-\d{2}$/)||r.match(/^\d{4}-\d{2}~\d{4}-\d{2}$/))){if(r.includes("~")){const[e,a]=r.split("~"),t=new Date(n).toISOString().slice(0,7);return t>=e&&t<=a}return new Date(n).toISOString().slice(0,7)===r}return n===r;case"not_equals":return n!==r;case"starts_with":return String(n).toLowerCase().startsWith(String(r).toLowerCase());case"ends_with":return String(n).toLowerCase().endsWith(String(r).toLowerCase());case"greater_than":return Number(n)>Number(r);case"less_than":return Number(n)<Number(r);case"after":return new Date(n)>new Date(r);case"before":return new Date(n)<new Date(r);case"is_empty":return!n||""===n||null===n;case"is_not_empty":return n&&""!==n&&null!==n;case"between":{const[e,a]=r.split(",").map(Number),t=Number(n);return t>=e&&t<=a}case"in":return r.split(",").map(e=>e.trim()).includes(String(n));default:return!0}})):e)(s,a.advancedFilters)),(a.startDate||a.endDate)&&(s=((e,a,t)=>a||t?e.filter(e=>{const s=new Date(e.request_date);return!(a&&s<new Date(a)||t&&s>new Date(t))}):e)(s,a.startDate,a.endDate)),a.sortConfig&&(s=((e,a)=>a?[...e].sort((e,t)=>{const s=fe(e,a.key),r=fe(t,a.key);if(null==s)return 1;if(null==r)return-1;let l=0;return s>r&&(l=1),s<r&&(l=-1),"desc"===a.direction?-l:l}):e)(s,a.sortConfig)),s};function we(){const e=t.allPurchases?[...t.allPurchases]:[],a=!t.allPurchases&&t.isLoading,[r,l]=s.useState(e),[n,i]=s.useState(a),[c,d]=s.useState(t.error),o=t.currentUser;s.useEffect(()=>{let e=t.allPurchases,a=t.lastFetch;const s=()=>{const s=t.allPurchases!==e,n=t.lastFetch!==a;(s||n||0===r.length)&&(t.allPurchases?(l([...t.allPurchases]),i(!1),e=t.allPurchases,a=t.lastFetch):i(t.isLoading),d(t.error))};s();const n=setInterval(s,10);return()=>clearInterval(n)},[r.length]);const m=s.useCallback(e=>t.allPurchases?ve(t.allPurchases,e,o):[],[o]),u=s.useMemo(()=>r&&0!==r.length?je(r,o):{pending:0,purchase:0,receipt:0,done:0},[r,o]),p=s.useMemo(()=>({total:r.length,loaded:t.stats?.loadedCount||0,memoryUsage:t.stats?.memoryUsage||0,lastFetch:t.lastFetch}),[r]);return{allPurchases:r,getFilteredPurchases:m,loading:n,error:c,tabCounts:u,stats:p,currentUser:o}}const Ne=[{id:"statement_progress",label:"ê±°ë˜ëª…ì„¸ì„œ",description:"ê±°ë˜ëª…ì„¸ì„œ ìˆ˜ë ¹ ì§„í–‰ë¥ ",defaultVisible:!0},{id:"purchase_order_number",label:"ë°œì£¼ë²ˆí˜¸",description:"ë°œì£¼ìš”ì²­ ë²ˆí˜¸",defaultVisible:!0},{id:"payment_category",label:"ê²°ì œì¢…ë¥˜",description:"ê²°ì œ ë°©ì‹ (êµ¬ë§¤ìš”ì²­, ë°œì£¼, í˜„ì¥ê²°ì œ ë“±)",defaultVisible:!0},{id:"requester_name",label:"ìš”ì²­ì",description:"ë°œì£¼ë¥¼ ìš”ì²­í•œ ì‚¬ìš©ì",defaultVisible:!0},{id:"request_date",label:"ì²­êµ¬ì¼",description:"ë°œì£¼ ìš”ì²­ ë‚ ì§œ",defaultVisible:!0},{id:"utk_status",label:"UTK",description:"UTK í™•ì¸ ìƒíƒœ",defaultVisible:!0},{id:"vendor_name",label:"ì—…ì²´",description:"ê³µê¸‰ì—…ì²´ëª…",defaultVisible:!0},{id:"contact_name",label:"ë‹´ë‹¹ì",description:"ì—…ì²´ ë‹´ë‹¹ìëª…",defaultVisible:!0},{id:"delivery_request_date",label:"ì…ê³ ìš”ì²­ì¼",description:"ì…ê³  ìš”ì²­ ë‚ ì§œ",defaultVisible:!0},{id:"revised_delivery_date",label:"ë³€ê²½ì…ê³ ì¼",description:"ìˆ˜ì •ëœ ì…ê³  ë‚ ì§œ",defaultVisible:!0},{id:"item_name",label:"í’ˆëª…",description:"êµ¬ë§¤ í’ˆëª©ëª…",defaultVisible:!0},{id:"specification",label:"ê·œê²©",description:"í’ˆëª© ê·œê²© ì •ë³´",defaultVisible:!0},{id:"quantity",label:"ìˆ˜ëŸ‰",description:"êµ¬ë§¤ ìˆ˜ëŸ‰",defaultVisible:!0},{id:"unit_price",label:"ë‹¨ê°€",description:"í’ˆëª© ë‹¨ê°€",defaultVisible:!0},{id:"amount",label:"í•©ê³„",description:"ì´ ê¸ˆì•¡",defaultVisible:!0},{id:"remark",label:"ë¹„ê³ ",description:"ì¶”ê°€ ë©”ëª¨ ì‚¬í•­",defaultVisible:!0},{id:"link",label:"ë§í¬",description:"ê´€ë ¨ ë§í¬",defaultVisible:!0},{id:"project_vendor",label:"PJì—…ì²´",description:"í”„ë¡œì íŠ¸ ì—…ì²´",defaultVisible:!0},{id:"project_item",label:"PJ ITEM",description:"í”„ë¡œì íŠ¸ ì•„ì´í…œ",defaultVisible:!0},{id:"sales_order_number",label:"ìˆ˜ì£¼ë²ˆí˜¸",description:"ìˆ˜ì£¼ ë²ˆí˜¸",defaultVisible:!0},{id:"purchase_progress",label:"êµ¬ë§¤ì§„í–‰",description:"êµ¬ë§¤ ì§„í–‰ë¥ ",defaultVisible:!0},{id:"receipt_progress",label:"ì…ê³ ì§„í–‰",description:"ì…ê³  ì§„í–‰ë¥ ",defaultVisible:!0}],ke=Ne.reduce((e,a)=>(e[a.id]=a.defaultVisible,e),{});Ne.reduce((e,a)=>(e[a.id]=a,e),{});const Ce=["purchase_order_number","vendor_name","item_name","amount"],qe=[{title:"ê¸°ë³¸ ì •ë³´",columns:["statement_progress","purchase_order_number","payment_category","requester_name","request_date","utk_status"]},{title:"ì—…ì²´ ì •ë³´",columns:["vendor_name","contact_name","delivery_request_date","revised_delivery_date"]},{title:"í’ˆëª© ì •ë³´",columns:["item_name","specification","quantity","unit_price","amount","remark","link"]},{title:"í”„ë¡œì íŠ¸ ì •ë³´",columns:["project_vendor","project_item","sales_order_number"]},{title:"ì§„í–‰ ìƒíƒœ",columns:["purchase_progress","receipt_progress"]}],$e=s.memo(({isVisible:e=!0,className:a="",columnVisibility:t,applyColumnSettings:r,resetToDefault:d,isLoading:o=!1})=>{const[m,u]=s.useState(t),[p,h]=s.useState(!1);if(s.useEffect(()=>{p&&u(t)},[p,t]),!e)return null;const x=Object.values(t).filter(Boolean).length,g=Object.keys(t).length,b=Object.values(m).filter(Boolean).length;return l.jsxs(C,{open:p,onOpenChange:h,children:[l.jsx(q,{asChild:!0,children:l.jsxs(n,{variant:"outline",size:"sm",className:`button-base ${a}`,disabled:o,children:[l.jsx(ge,{className:"w-4 h-4 mr-2"}),l.jsx("span",{className:"button-text",children:o?"ë¡œë”© ì¤‘...":`ì¹¼ëŸ¼ ì„¤ì • (${x}/${g})`})]})}),l.jsxs($,{className:"w-[320px] overflow-x-hidden",align:"end",onInteractOutside:()=>{u(t),h(!1)},children:[l.jsxs("div",{className:"max-h-[min(600px,80vh)] overflow-y-auto overflow-x-hidden",children:[l.jsxs(S,{className:"flex items-center justify-between py-1.5",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"modal-section-title",children:"ì¹¼ëŸ¼ í‘œì‹œ ì„¤ì •"}),l.jsxs("span",{className:"card-description",children:["(",b,"/",g,")"]})]}),l.jsx(n,{variant:"ghost",size:"sm",onClick:()=>{d(),h(!1)},className:"h-5 px-1.5",title:"ê¸°ë³¸ê°’ìœ¼ë¡œ ì¬ì„¤ì •",children:l.jsx(P,{className:"w-3 h-3"})})]}),l.jsx(M,{}),qe.map((e,a)=>l.jsxs(i.Fragment,{children:[l.jsx("div",{className:"px-3 py-1",children:l.jsx("div",{className:"modal-label",children:e.title})}),l.jsx("div",{className:"grid grid-cols-2 gap-x-1 px-2",children:e.columns.map(e=>{const a=m[e],t=Ce.includes(e);return l.jsxs("div",{className:"flex items-center gap-1 py-1 rounded overflow-hidden "+(t&&a?"opacity-75":"cursor-pointer hover:bg-gray-50"),onClick:()=>{t&&a||(e=>{Ce.includes(e)&&m[e]||u(a=>({...a,[e]:!a[e]}))})(e)},children:[l.jsx("div",{className:"p-0.5 "+(t&&a?"":"hover:bg-gray-100 rounded transition-colors"),children:a?l.jsx(F,{className:"w-3.5 h-3.5 text-green-600"}):l.jsx(xe,{className:"w-3.5 h-3.5 text-gray-400"})}),l.jsx("div",{className:"flex-1 min-w-0",children:l.jsxs("div",{className:"modal-value truncate "+(a?"":"text-gray-500"),children:[{statement_progress:"ê±°ë˜ëª…ì„¸ì„œ",purchase_order_number:"ë°œì£¼ë²ˆí˜¸",payment_category:"ê²°ì œì¢…ë¥˜",requester_name:"ìš”ì²­ì",request_date:"ì²­êµ¬ì¼",utk_status:"UTK",vendor_name:"ì—…ì²´",contact_name:"ë‹´ë‹¹ì",delivery_request_date:"ì…ê³ ìš”ì²­ì¼",revised_delivery_date:"ë³€ê²½ì…ê³ ì¼",item_name:"í’ˆëª…",specification:"ê·œê²©",quantity:"ìˆ˜ëŸ‰",unit_price:"ë‹¨ê°€",amount:"í•©ê³„",remark:"ë¹„ê³ ",link:"ë§í¬",project_vendor:"PJì—…ì²´",project_item:"PJ ITEM",sales_order_number:"ìˆ˜ì£¼ë²ˆí˜¸",purchase_progress:"êµ¬ë§¤ì§„í–‰",receipt_progress:"ì…ê³ ì§„í–‰"}[e],t&&l.jsx("span",{className:"ml-1 text-red-500",title:"í•„ìˆ˜ ì¹¼ëŸ¼",children:"*"})]})})]},e)})}),a<qe.length-1&&l.jsx(M,{})]},e.title)),l.jsx(M,{}),l.jsx("div",{className:"px-3 py-2",children:l.jsxs("div",{className:"card-description space-y-1",children:[l.jsx("div",{children:"â€¢ í•„ìˆ˜ ì¹¼ëŸ¼(*)ì€ ìˆ¨ê¸¸ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"}),l.jsx("div",{children:"â€¢ ë³€ê²½ì‚¬í•­ì€ ì ìš© ë²„íŠ¼ì„ ëˆŒëŸ¬ì•¼ ë°˜ì˜ë©ë‹ˆë‹¤"}),l.jsx("div",{children:"â€¢ ìƒˆë¡œê³ ì¹¨ ì‹œì—ë„ ì„¤ì •ì´ ìœ ì§€ë©ë‹ˆë‹¤"})]})})]}),l.jsx(M,{}),l.jsxs("div",{className:"px-3 py-3 flex gap-2 border-t bg-white",children:[l.jsxs(n,{onClick:()=>{r(m),h(!1)},className:"button-base bg-blue-500 text-white hover:bg-blue-600 flex-1",children:[l.jsx(R,{className:"w-4 h-4 mr-1"}),"ì ìš©"]}),l.jsxs(n,{onClick:()=>{u(t),h(!1)},variant:"outline",className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 flex-1",children:[l.jsx(c,{className:"w-4 h-4 mr-1"}),"ì·¨ì†Œ"]})]})]})]})});$e.displayName="ColumnSettingsDropdown";const Se=s.memo(({purchase:e})=>{const a=e.is_received?"completed":"approved"===e.middle_manager_status&&"approved"===e.final_manager_status?"inProgress":"rejected"===e.middle_manager_status||"rejected"===e.final_manager_status?"rejected":"pending",{text:t,className:s}={completed:{text:"ì…ê³ ì™„ë£Œ",className:"badge-success"},inProgress:{text:"êµ¬ë§¤ì§„í–‰",className:"badge-primary"},rejected:{text:"ë°˜ë ¤",className:"badge-danger"},pending:{text:"ìŠ¹ì¸ëŒ€ê¸°",className:"badge-warning"}}[a];return l.jsx("span",{className:`badge-stats ${s}`,children:t})});Se.displayName="StatusBadge";const Me=s.memo(({purchase:e,onClick:a})=>{const t=(e=>{if(!e.purchase_request_items||0===e.purchase_request_items.length)return{received:0,total:0,percentage:0};const a=e.purchase_request_items.length,t=e.purchase_request_items.filter(e=>null!==e.actual_received_date&&void 0!==e.actual_received_date).length;return{received:t,total:a,percentage:a>0?Math.round(t/a*100):0}})(e),s="ì„ ì§„í–‰"===e.progress_type||e.progress_type?.includes("ì„ ì§„í–‰");return l.jsxs("div",{className:"bg-white rounded-lg border p-4 space-y-3 cursor-pointer transition-all hover:shadow-md "+(s?"border-red-400 bg-red-50 hover:bg-red-100":"hover:bg-gray-50"),onClick:()=>a(e),children:[l.jsxs("div",{className:"flex items-start justify-between",children:[l.jsxs("div",{children:[l.jsxs("div",{className:"flex items-center gap-2",children:[s?l.jsx("span",{className:"badge-stats bg-red-500 text-white",children:"ì„ ì§„í–‰"}):l.jsx("span",{className:"badge-stats bg-gray-500 text-white",children:"ì¼ë°˜"}),l.jsx("span",{className:"card-title text-gray-900",children:e.purchase_order_number||"-"})]}),l.jsxs("div",{className:"badge-text text-gray-500 mt-1",children:[L(e.request_date)," ìš”ì²­"]})]}),l.jsx(Se,{purchase:e})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[l.jsx("span",{className:"text-gray-600",children:"ìš”ì²­ì"}),l.jsx("span",{className:"card-title",children:e.requester_name})]}),l.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[l.jsx("span",{className:"text-gray-600",children:"ì—…ì²´"}),l.jsx("span",{className:"card-title",children:e.vendor_name})]}),e.project_vendor&&l.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[l.jsx("span",{className:"text-gray-600",children:"PJì—…ì²´"}),l.jsx("span",{className:"card-title truncate max-w-[150px]",children:e.project_vendor})]}),e.project_item&&l.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[l.jsx("span",{className:"text-gray-600",children:"PJ ITEM"}),l.jsx("span",{className:"card-title truncate max-w-[150px]",children:e.project_item})]}),e.sales_order_number&&l.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[l.jsx("span",{className:"text-gray-600",children:"ìˆ˜ì£¼ë²ˆí˜¸"}),l.jsx("span",{className:"card-title truncate max-w-[150px]",children:e.sales_order_number})]}),e.item_name&&l.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[l.jsx("span",{className:"text-gray-600",children:"í’ˆëª©"}),l.jsx("span",{className:"card-title truncate max-w-[150px]",children:e.item_name})]}),l.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[l.jsx("span",{className:"text-gray-600",children:"ê¸ˆì•¡"}),l.jsxs("span",{className:"font-semibold text-gray-900",children:[(e.amount_value||e.total_amount)?.toLocaleString()," ",e.currency]})]})]}),l.jsxs("div",{className:"space-y-1",children:[l.jsxs("div",{className:"flex items-center justify-between badge-text",children:[l.jsx("span",{className:"text-gray-600",children:"ì…ê³ í˜„í™©"}),l.jsxs("span",{className:"text-gray-700",children:[t.received,"/",t.total," (",t.percentage,"%)"]})]}),l.jsx("div",{className:"bg-gray-200 rounded-full h-2",children:l.jsx("div",{className:"h-2 rounded-full transition-all "+(100===t.percentage?"bg-green-500":t.percentage>0?"bg-hansl-500":"bg-gray-300"),style:{width:`${t.percentage}%`}})})]}),void 0!==e.is_payment_completed&&l.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[l.jsx("span",{className:"text-gray-600",children:"ê²°ì œ"}),e.is_payment_completed?l.jsx("span",{className:"badge-stats bg-green-500 text-white",children:"ì™„ë£Œ"}):l.jsx("span",{className:"badge-stats bg-gray-500 text-white",children:"ëŒ€ê¸°"})]}),l.jsx("div",{className:"pt-2 border-t",children:l.jsxs("div",{className:"flex items-center justify-center badge-text text-gray-500",children:[l.jsx(F,{className:"w-3 h-3 mr-1"}),"í´ë¦­í•˜ì—¬ ìƒì„¸ë³´ê¸°"]})})]})});Me.displayName="MobilePurchaseCard";const De=s.memo(({purchases:e,activeTab:a,onRowClick:t,isLeadBuyer:r,onPaymentComplete:n,onReceiptComplete:i,onExcelDownload:c,columnVisibility:d,vendorColumnWidth:o,tableHeader:m,TableRowComponent:u,height:p=600,shouldUseFitLayout:h=!1})=>{const x=s.useRef(null),[g,b]=s.useState(0),[_,y]=s.useState(p),[f,j]=s.useState(p),{startIndex:v,endIndex:w,visibleItems:N,totalHeight:k}=s.useMemo(()=>{const a=e.length,t=Math.ceil(_/30),s=Math.floor(g/30),r=Math.min(s+t+5,a),l=Math.max(0,s-5);return{startIndex:l,endIndex:r,visibleItems:e.slice(l,r),totalHeight:30*a}},[e,g,_]),C=s.useCallback(e=>{const a=Math.max(0,e.currentTarget.scrollTop-30);b(a)},[]);return s.useEffect(()=>{const e=()=>{const e=window.innerHeight;let a;a=e<=800?Math.min(450,.6*e):e<=1080?Math.min(725,.7*e):e<=1440?Math.min(1e3,.75*e):Math.min(1200,.8*e),j(a),y(a)},a=()=>{if(x.current){const e=x.current.getBoundingClientRect();y(Math.min(f,e.height))}},t=setTimeout(()=>{e(),a()},100),s=()=>{e(),a()};return window.addEventListener("resize",s),()=>{clearTimeout(t),window.removeEventListener("resize",s)}},[f]),l.jsx("div",{className:h?"table-container-fit-left":"border rounded-lg",children:l.jsxs("div",{ref:x,className:"virtual-scroll-body",style:{height:`${f}px`,overflow:"auto",position:"relative"},onScroll:C,children:[l.jsx("div",{style:{position:"sticky",top:0,zIndex:10,backgroundColor:"white",borderBottom:"1px solid #e5e7eb"},children:l.jsx("table",{className:h?`table-fit-left ${a}-tab`:"w-full min-w-[1790px] border-collapse",children:m})}),l.jsx("div",{style:{height:`${k}px`,position:"relative"},children:l.jsx("div",{style:{transform:`translateY(${30*v}px)`,position:"absolute",top:0,left:0,right:0},children:l.jsx("table",{className:(h?`table-fit-left ${a}-tab`:"w-full min-w-[1790px] border-collapse")+" virtual-scroll-table",children:l.jsx("tbody",{children:N.map((e,s)=>l.jsx(u,{purchase:e,onClick:t,activeTab:a,isLeadBuyer:r,onPaymentComplete:n,onReceiptComplete:i,onExcelDownload:c,vendorColumnWidth:o,columnVisibility:d},e.id))})})})}),0===e.length&&l.jsx("div",{className:"text-center py-12 bg-white",children:l.jsx("p",{className:"card-subtitle",children:"ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤."})})]})})});De.displayName="VirtualScrollTable";var Pe="AlertDialog",[Fe,Re]=o(Pe,[E]),Te=E(),Ve=e=>{const{__scopeAlertDialog:a,...t}=e,s=Te(a);return l.jsx(A,{...s,...t,modal:!0})};Ve.displayName=Pe;s.forwardRef((e,a)=>{const{__scopeAlertDialog:t,...s}=e,r=Te(t);return l.jsx(K,{...r,...s,ref:a})}).displayName="AlertDialogTrigger";var Ie=e=>{const{__scopeAlertDialog:a,...t}=e,s=Te(a);return l.jsx(O,{...s,...t})};Ie.displayName="AlertDialogPortal";var Le=s.forwardRef((e,a)=>{const{__scopeAlertDialog:t,...s}=e,r=Te(t);return l.jsx(J,{...r,...s,ref:a})});Le.displayName="AlertDialogOverlay";var Ee="AlertDialogContent",[Ae,Oe]=Fe(Ee),We=u("AlertDialogContent"),Ue=s.forwardRef((e,a)=>{const{__scopeAlertDialog:t,children:r,...n}=e,i=Te(t),c=s.useRef(null),o=d(a,c),u=s.useRef(null);return l.jsx(W,{contentName:Ee,titleName:ze,docsSlug:"alert-dialog",children:l.jsx(Ae,{scope:t,cancelRef:u,children:l.jsxs(U,{role:"alertdialog",...i,...n,ref:o,onOpenAutoFocus:m(n.onOpenAutoFocus,e=>{e.preventDefault(),u.current?.focus({preventScroll:!0})}),onPointerDownOutside:e=>e.preventDefault(),onInteractOutside:e=>e.preventDefault(),children:[l.jsx(We,{children:r}),l.jsx(Qe,{contentRef:c})]})})})});Ue.displayName=Ee;var ze="AlertDialogTitle",Ye=s.forwardRef((e,a)=>{const{__scopeAlertDialog:t,...s}=e,r=Te(t);return l.jsx(z,{...r,...s,ref:a})});Ye.displayName=ze;var Be="AlertDialogDescription",Je=s.forwardRef((e,a)=>{const{__scopeAlertDialog:t,...s}=e,r=Te(t);return l.jsx(Y,{...r,...s,ref:a})});Je.displayName=Be;var Ke=s.forwardRef((e,a)=>{const{__scopeAlertDialog:t,...s}=e,r=Te(t);return l.jsx(B,{...r,...s,ref:a})});Ke.displayName="AlertDialogAction";var Ze="AlertDialogCancel",He=s.forwardRef((e,a)=>{const{__scopeAlertDialog:t,...s}=e,{cancelRef:r}=Oe(Ze,t),n=Te(t),i=d(a,r);return l.jsx(B,{...n,...s,ref:i})});He.displayName=Ze;var Qe=({contentRef:e})=>{const a=`\`${Ee}\` requires a description for the component to be accessible for screen reader users.\n\nYou can add a description to the \`${Ee}\` by passing a \`${Be}\` component as a child, which also benefits sighted users by adding visible context to the dialog.\n\nAlternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${Ee}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.\n\nFor more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return s.useEffect(()=>{document.getElementById(e.current?.getAttribute("aria-describedby"))},[a,e]),null},Ge=Le,Xe=Ue,ea=Ke,aa=He,ta=Ye,sa=Je;const ra=Ve,la=Ie,na=s.forwardRef(({className:e,...a},t)=>l.jsx(Ge,{className:p("fixed inset-0 z-50 bg-black/40 backdrop-blur-sm","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...a,ref:t}));na.displayName=Ge.displayName;const ia=s.forwardRef(({className:e,...a},t)=>l.jsxs(la,{children:[l.jsx(na,{}),l.jsx(Xe,{ref:t,className:p("fixed left-[50%] top-[50%] z-50","w-full max-w-md translate-x-[-50%] translate-y-[-50%]","grid gap-4 bg-white border border-gray-200","rounded-lg p-6 shadow-professional-xl","duration-200","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0","data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95","data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%]","data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%]",e),...a})]}));ia.displayName=Xe.displayName;const ca=({className:e,...a})=>l.jsx("div",{className:p("flex flex-col space-y-2 text-left",e),...a});ca.displayName="AlertDialogHeader";const da=({className:e,...a})=>l.jsx("div",{className:p("flex flex-col-reverse sm:flex-row sm:justify-end gap-3",e),...a});da.displayName="AlertDialogFooter";const oa=s.forwardRef(({className:e,...a},t)=>l.jsx(ta,{ref:t,className:p("text-lg font-semibold text-gray-800 tracking-tight",e),...a}));oa.displayName=ta.displayName;const ma=s.forwardRef(({className:e,...a},t)=>l.jsx(sa,{ref:t,className:p("text-sm text-gray-600",e),...a}));ma.displayName=sa.displayName;const ua=s.forwardRef(({className:e,...a},t)=>l.jsx(ea,{ref:t,className:p(h(),e),...a}));ua.displayName=ea.displayName;const pa=s.forwardRef(({className:e,...a},t)=>l.jsx(aa,{ref:t,className:p(h({variant:"outline"}),"mt-2 sm:mt-0",e),...a}));pa.displayName=aa.displayName;const ha=s.memo(({purchase:e})=>{const a=e.is_received?"completed":"approved"===e.middle_manager_status&&"approved"===e.final_manager_status?"inProgress":"rejected"===e.middle_manager_status||"rejected"===e.final_manager_status?"rejected":"pending",{text:t,className:s}={completed:{text:"ì…ê³ ì™„ë£Œ",className:"badge-success"},inProgress:{text:"êµ¬ë§¤ì§„í–‰",className:"badge-primary"},rejected:{text:"ë°˜ë ¤",className:"badge-danger"},pending:{text:"ìŠ¹ì¸ëŒ€ê¸°",className:"badge-warning"}}[a];return l.jsx("span",{className:`badge-stats ${s}`,children:t})});ha.displayName="StatusBadge";const xa=e=>e?["KRW","ì›","â‚©"].includes(e)?"â‚©":["USD","$","ë‹¬ëŸ¬"].includes(e)?"$":["EUR","â‚¬"].includes(e)?"â‚¬":["JPY","ì—”","Â¥"].includes(e)||["CNY","ìœ„ì•ˆ","å…ƒ"].includes(e)?"Â¥":e:"â‚©",ga="text-center w-20 min-w-[85px] max-w-[85px]",ba="pl-2 w-[155px] min-w-[155px] max-w-[155px] purchase-order-number-column",_a="text-center w-20 min-w-[85px] max-w-[85px]",ya="w-12 min-w-[48px] max-w-[48px]",fa="text-center px-2 w-16 min-w-[64px] max-w-[68px]",ja="pl-3 pr-2 w-32 min-w-[128px] max-w-[128px]",va="w-16 min-w-[68px] max-w-[68px]",wa="w-20 min-w-[85px] max-w-[85px]",Na="w-20 min-w-[85px] max-w-[85px]",ka="w-44 min-w-[176px] max-w-[176px]",Ca="w-64 min-w-[260px] max-w-[260px]",qa="text-center w-14 min-w-[60px] max-w-[60px]",$a="text-right w-24 min-w-[100px] max-w-[100px]",Sa="text-right w-24 min-w-[100px] max-w-[100px]",Ma="w-[165px] min-w-[165px] max-w-[165px]",Da="w-24 min-w-[105px] max-w-[105px]",Pa="w-28 min-w-[115px] max-w-[115px]",Fa="w-44 min-w-[180px] max-w-[180px]",Ra="text-center w-20 min-w-[85px] max-w-[85px]",Ta="text-center w-24 min-w-[100px] max-w-[100px]",Va="text-center w-24 min-w-[100px] max-w-[100px]",Ia="w-20 min-w-[85px] max-w-[85px]",La="text-center w-14 min-w-[56px] max-w-[60px]",Ea=s.memo(({purchase:e})=>{const{allPurchases:a}=we(),t=a?.find(a=>a.id===e.id)||e,s="approved"===t.middle_manager_status,r="rejected"===t.middle_manager_status,n="approved"===t.final_manager_status,i="rejected"===t.final_manager_status;return r||i?l.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[l.jsx("div",{className:"flex items-center gap-0.5",children:l.jsx("div",{className:"w-1.5 h-1.5 bg-red-500 rounded-full animate-pulse"})}),l.jsx("span",{className:"badge-stats bg-red-500 text-white",children:"ë°˜ë ¤"})]}):s&&n?l.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[l.jsx("div",{className:"flex items-center gap-0.5",children:l.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"})}),l.jsx("span",{className:"badge-stats bg-green-500 text-white",children:"ìŠ¹ì¸ì™„ë£Œ"})]}):!s||n||i?l.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full"}),l.jsx("div",{className:"w-3 h-0.5 bg-gray-300"}),l.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full"})]}),l.jsx("span",{className:"badge-stats bg-gray-500 text-white",children:"ìŠ¹ì¸ëŒ€ê¸°"})]}):l.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),l.jsx("div",{className:"w-3 h-0.5 bg-gray-300"}),l.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full"})]}),l.jsx("span",{className:"badge-stats bg-yellow-500 text-white",children:"1ì°¨ ìŠ¹ì¸"})]})});Ea.displayName="ApprovalStatusBadge";const Aa=s.memo(({purchase:e,activeTab:a})=>{const{allPurchases:t}=we(),s=t?.find(a=>a.id===e.id)||e;if("done"===a){if("ì„ ì§„í–‰"===s.payment_category||s.payment_category?.includes("ì„ ì§„í–‰"))return l.jsx("div",{className:"flex items-center justify-center",children:l.jsx("span",{className:"card-title text-gray-500",children:"-"})})}if(s.is_payment_completed)return l.jsxs("div",{className:"flex items-center justify-center gap-1",children:[l.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:l.jsx("div",{className:"h-1.5 rounded-full bg-orange-500",style:{width:"100%"}})}),l.jsx("span",{className:"card-title text-gray-600",children:"100%"})]});if(!s.purchase_request_items||0===s.purchase_request_items.length)return l.jsxs("div",{className:"flex items-center justify-center gap-1",children:[l.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:l.jsx("div",{className:"h-1.5 rounded-full bg-gray-300",style:{width:"0%"}})}),l.jsx("span",{className:"card-title text-gray-600",children:"0%"})]});const r=s.purchase_request_items.length,n=s.purchase_request_items.filter(e=>!0===e.is_payment_completed).length,i=r>0?Math.round(n/r*100):0;return l.jsxs("div",{className:"flex items-center justify-center gap-1",children:[l.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:l.jsx("div",{className:"h-1.5 rounded-full "+(100===i?"bg-orange-500":i>0?"bg-orange-400":"bg-gray-300"),style:{width:`${i}%`}})}),l.jsxs("span",{className:"card-title text-gray-600",children:[i,"%"]})]})});Aa.displayName="PaymentProgressBar";const Oa=s.memo(({purchase:e})=>{const{allPurchases:a}=we(),t=a?.find(a=>a.id===e.id)||e;if(!t.purchase_request_items||0===t.purchase_request_items.length)return l.jsxs("div",{className:"flex items-center justify-center gap-1",children:[l.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:l.jsx("div",{className:"h-1.5 rounded-full bg-gray-300",style:{width:"0%"}})}),l.jsx("span",{className:"card-title text-gray-600",children:"0%"})]});const s=t.purchase_request_items.length,r=t.purchase_request_items.filter(e=>!0===e.is_received).length,n=s>0?Math.round(r/s*100):0;return l.jsxs("div",{className:"flex items-center justify-center gap-1",children:[l.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:l.jsx("div",{className:"h-1.5 rounded-full "+(100===n?"bg-blue-500":n>0?"bg-blue-400":"bg-gray-300"),style:{width:`${n}%`}})}),l.jsxs("span",{className:"card-title text-gray-600",children:[n,"%"]})]})});Oa.displayName="ReceiptProgressBar";const Wa=s.memo(({purchase:e})=>{const{allPurchases:a}=we(),t=s.useMemo(()=>{if(!a)return e;return a.find(a=>a.id===e.id)||e},[a,e.id,e]),r=s.useMemo(()=>{const e=t.purchase_request_items||t.items||[];if(0===e.length)return{completed:0,total:1,percentage:0};const a=e.length,s=e.filter(e=>!0===e.is_statement_received).length;return{completed:s,total:a,percentage:a>0?Math.round(s/a*100):0}},[t]);return l.jsxs("div",{className:"flex items-center justify-center gap-1",children:[l.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:l.jsx("div",{className:"h-1.5 rounded-full "+(100===r.percentage?"bg-green-500":r.percentage>0?"bg-green-400":"bg-gray-300"),style:{width:`${r.percentage}%`}})}),l.jsxs("span",{className:"card-title text-gray-600",children:[r.percentage,"%"]})]})});Wa.displayName="StatementProgressBar";s.memo(({type:e})=>"ì„ ì§„í–‰"===e||e?.includes("ì„ ì§„í–‰")?l.jsx("span",{className:"badge-stats bg-red-500 text-white",children:"ì„ ì§„í–‰"}):l.jsx("span",{className:"badge-stats bg-gray-500 text-white",children:"ì¼ë°˜"})).displayName="ProgressTypeBadge";const Ua=s.memo(({purchase:e,onClick:a,activeTab:t,isLeadBuyer:s,onPaymentComplete:r,onReceiptComplete:n,onExcelDownload:i,columnVisibility:c,vendorColumnWidth:d})=>{const o="ì„ ì§„í–‰"===e.progress_type||e.progress_type?.includes("ì„ ì§„í–‰"),m=e=>!c||!1!==c[e];return l.jsxs("tr",{className:"border-b hover:bg-gray-100 cursor-pointer transition-colors "+(o?"bg-red-50 hover:bg-red-100":""),onClick:()=>a(e),children:[("pending"===t||"purchase"===t)&&l.jsx("td",{className:`px-2 py-1.5 whitespace-nowrap ${ga}`,children:l.jsx(Ea,{purchase:e})}),"receipt"===t&&m("receipt_progress")&&l.jsx("td",{className:`px-2 py-1.5 ${Ra}`,children:l.jsx(Oa,{purchase:e})}),"done"===t&&m("statement_progress")&&l.jsx("td",{className:`px-2 py-1.5 ${Ra}`,children:l.jsx(Wa,{purchase:e})}),m("purchase_order_number")&&l.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${ba}`,children:l.jsxs("div",{className:"flex items-center gap-1",children:[i&&l.jsx("img",{src:"/excels-icon.svg",alt:"ì—‘ì…€ ë‹¤ìš´ë¡œë“œ",width:"16",height:"16",className:`inline-block align-middle transition-transform p-0.5 rounded\n                ${e.is_po_download?"border border-gray-400":""}\n                ${"ì„ ì§„í–‰"===e.progress_type||e.progress_type?.includes("ì„ ì§„í–‰")||"approved"===e.middle_manager_status&&"approved"===e.final_manager_status?e.is_po_download?"cursor-pointer":"cursor-pointer hover:scale-110":"opacity-40 grayscale cursor-not-allowed"}`,onClick:async a=>{("ì„ ì§„í–‰"===e.progress_type||e.progress_type?.includes("ì„ ì§„í–‰")||"approved"===e.middle_manager_status&&"approved"===e.final_manager_status)&&(a.stopPropagation(),await i(e))},style:{pointerEvents:"ì„ ì§„í–‰"===e.progress_type||e.progress_type?.includes("ì„ ì§„í–‰")||"approved"===e.middle_manager_status&&"approved"===e.final_manager_status?"auto":"none"},title:e.is_po_download?"ë‹¤ìš´ë¡œë“œ ì™„ë£Œ":"ì—‘ì…€ ë°œì£¼ì„œ ë‹¤ìš´ë¡œë“œ"}),l.jsxs("span",{className:"block truncate",title:e.purchase_order_number||"",children:[e.purchase_order_number||"-",e.purchase_request_items&&e.purchase_request_items.length>1&&l.jsxs("span",{className:"text-gray-500 ml-0.5",children:["(",e.purchase_request_items.length,")"]})]})]})}),m("payment_category")&&l.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${_a}`,children:l.jsx("span",{className:"badge-stats "+("êµ¬ë§¤ìš”ì²­"===e.payment_category||"êµ¬ë§¤ ìš”ì²­"===e.payment_category?"bg-blue-500 text-white":"ë°œì£¼"===e.payment_category?"bg-green-500 text-white":("í˜„ì¥ê²°ì œ"===e.payment_category||"í˜„ì¥ ê²°ì œ"===e.payment_category||e.payment_category,"bg-gray-500 text-white")),children:"ë°œì£¼"===e.payment_category?"ë°œì£¼ìš”ì²­":"êµ¬ë§¤ ìš”ì²­"===e.payment_category?"êµ¬ë§¤ìš”ì²­":"í˜„ì¥ ê²°ì œ"===e.payment_category?"í˜„ì¥ê²°ì œ":e.payment_category||"-"})}),m("requester_name")&&l.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${ya}`,children:l.jsx("span",{className:"block truncate",title:e.requester_name||"",children:e.requester_name||"-"})}),m("request_date")&&l.jsx("td",{className:`py-1.5 card-title whitespace-nowrap ${fa}`,children:L(e.request_date)}),"done"===t&&m("utk_status")&&l.jsx("td",{className:`pl-2 pr-3 py-1.5 card-title whitespace-nowrap text-center overflow-visible text-clip ${La}`,children:l.jsx("span",{className:e.is_utk_checked?"badge-utk-complete":"badge-utk-pending",children:e.is_utk_checked?"ì™„ë£Œ":"ëŒ€ê¸°"})}),m("vendor_name")&&l.jsx("td",{className:`pl-3 pr-2 py-1.5 card-title ${"done"===t?ja:"vendor-dynamic-column"}`,style:"done"===t?void 0:{width:`${d||80}px`,minWidth:`${d||80}px`,maxWidth:`${d||80}px`},children:l.jsx("span",{className:"block truncate",title:e.vendor_name||"",children:e.vendor_name||"-"})}),m("contact_name")&&l.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${va}`,children:l.jsx("span",{className:"block truncate",title:e.contact_name||"",children:e.contact_name||"-"})}),m("delivery_request_date")&&l.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${wa} ${e.revised_delivery_request_date?"text-gray-400":""}`,children:L(e.delivery_request_date)}),("receipt"===t||"done"===t)&&m("revised_delivery_date")&&l.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${Na}`,children:L(e.revised_delivery_request_date)}),m("item_name")&&l.jsx("td",{className:`px-2 py-1.5 card-title ${ka}`,children:l.jsx("span",{className:"block truncate",title:e.purchase_request_items?.[0]?.item_name||"",children:e.purchase_request_items?.[0]?.item_name||"-"})}),m("specification")&&l.jsx("td",{className:`px-2 py-1.5 card-title ${Ca}`,children:l.jsx("span",{className:"block truncate",title:e.purchase_request_items?.[0]?.specification||"",children:e.purchase_request_items?.[0]?.specification||"-"})}),m("quantity")&&l.jsx("td",{className:`px-2 py-1.5 card-title ${qa}`,children:"receipt"===t||"done"===t?(()=>{const a=e.purchase_request_items?.[0]?.quantity||0,t=e.purchase_request_items?.[0]?.received_quantity??0,s=t>0;return a>=100||t>=100?l.jsxs("div",{className:"flex flex-col items-center leading-tight",children:[l.jsx("div",{className:s?"text-gray-400":"",children:a}),l.jsxs("div",{className:s?"":"text-gray-400",children:["/",t]})]}):l.jsxs("span",{children:[l.jsx("span",{className:s?"text-gray-400":"",children:a}),l.jsxs("span",{className:s?"":"text-gray-400",children:["/",t]})]})})():e.purchase_request_items?.[0]?.quantity||0}),m("unit_price")&&l.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${$a}`,children:e.purchase_request_items?.[0]?.unit_price_value?`${e.purchase_request_items[0].unit_price_value.toLocaleString()} ${xa(e.purchase_request_items[0]?.unit_price_currency||"KRW")}`:`0 ${xa(e.purchase_request_items?.[0]?.unit_price_currency||"KRW")}`}),m("amount")&&l.jsx("td",{className:`px-2 py-1.5 card-amount whitespace-nowrap ${Sa}`,children:e.purchase_request_items?.[0]?.amount_value?`${e.purchase_request_items[0].amount_value.toLocaleString()} ${xa(e.purchase_request_items[0]?.amount_currency||"KRW")}`:e.total_amount?`${e.total_amount.toLocaleString()} ${xa(e.currency||"KRW")}`:`0 ${xa(e.currency||"KRW")}`}),("pending"===t||"purchase"===t)&&l.jsxs(l.Fragment,{children:[m("remark")&&l.jsx("td",{className:`px-2 py-1.5 card-title ${Ma}`,children:l.jsx("span",{className:"block truncate",title:e.purchase_request_items?.[0]?.remark||"",children:e.purchase_request_items?.[0]?.remark||"-"})}),"purchase"===t&&m("link")&&l.jsx("td",{className:`px-2 py-1.5 card-title ${Ia}`,children:e.purchase_request_items?.[0]?.link?l.jsx("a",{href:e.purchase_request_items?.[0]?.link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline truncate block",title:e.purchase_request_items?.[0]?.link,children:"ë§í¬ ë³´ê¸°"}):l.jsx("span",{className:"text-gray-400",children:"-"})}),m("project_vendor")&&l.jsx("td",{className:`px-2 py-1.5 card-title ${Da}`,children:l.jsx("span",{className:"block truncate",title:e.project_vendor||"",children:e.project_vendor||"-"})}),m("project_item")&&l.jsx("td",{className:`px-2 py-1.5 card-title ${Fa}`,children:l.jsx("span",{className:"block truncate",title:e.project_item||"",children:e.project_item||"-"})}),m("sales_order_number")&&l.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${Pa}`,children:l.jsx("span",{className:"block truncate",title:e.sales_order_number||"",children:e.sales_order_number||"-"})})]}),"receipt"===t&&l.jsxs(l.Fragment,{children:[m("remark")&&l.jsx("td",{className:`px-2 py-1.5 card-title ${Ma}`,children:l.jsx("span",{className:"block truncate",title:e.purchase_request_items?.[0]?.remark||"",children:e.purchase_request_items?.[0]?.remark||"-"})}),m("project_vendor")&&l.jsx("td",{className:`px-2 py-1.5 card-title ${Da}`,children:l.jsx("span",{className:"block truncate",title:e.project_vendor||"",children:e.project_vendor||"-"})}),m("project_item")&&l.jsx("td",{className:`px-2 py-1.5 card-title ${Fa}`,children:l.jsx("span",{className:"block truncate",title:e.project_item||"",children:e.project_item||"-"})}),m("sales_order_number")&&l.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${Pa}`,children:l.jsx("span",{className:"block truncate",title:e.sales_order_number||"",children:e.sales_order_number||"-"})})]}),("done"===t||!t)&&l.jsxs(l.Fragment,{children:[m("remark")&&l.jsx("td",{className:`px-2 py-1.5 card-title ${Ma}`,children:l.jsx("span",{className:"block truncate",title:e.purchase_request_items?.[0]?.remark||"",children:e.purchase_request_items?.[0]?.remark||"-"})}),m("link")&&l.jsx("td",{className:`px-2 py-1.5 card-title ${Ia}`,children:e.purchase_request_items?.[0]?.link?l.jsx("a",{href:e.purchase_request_items?.[0]?.link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline truncate block",title:e.purchase_request_items?.[0]?.link,children:"ë§í¬ ë³´ê¸°"}):l.jsx("span",{className:"text-gray-400",children:"-"})}),m("project_vendor")&&l.jsx("td",{className:`px-2 py-1.5 card-title ${Da}`,children:l.jsx("span",{className:"block truncate",title:e.project_vendor||"",children:e.project_vendor||"-"})}),m("project_item")&&l.jsx("td",{className:`px-2 py-1.5 card-title ${Fa}`,children:l.jsx("span",{className:"block truncate",title:e.project_item||"",children:e.project_item||"-"})}),m("sales_order_number")&&l.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${Pa}`,children:l.jsx("span",{className:"block truncate",title:e.sales_order_number||"",children:e.sales_order_number||"-"})}),m("purchase_progress")&&"purchase"!==t&&l.jsx("td",{className:`px-2 py-1.5 ${Ta}`,children:l.jsx(Aa,{purchase:e,activeTab:t})}),m("receipt_progress")&&l.jsx("td",{className:`px-2 py-1.5 ${Va} ${"done"===t?"column-progress":""}`,children:l.jsx(Oa,{purchase:e})})]})]})});Ua.displayName="TableRow";const za=({purchases:e,activeTab:t="done",currentUserRoles:n=[],onRefresh:i,onOptimisticUpdate:c,onPaymentComplete:d,onReceiptComplete:o,columnVisibility:m})=>{s.useEffect(()=>{a.info("[FastPurchaseTable] columnVisibility ë³€ê²½ë¨",{columnVisibility:m})},[m]);const[u,p]=s.useState(null),[h,g]=s.useState(!1),[b,_]=s.useState(!1),[y,f]=s.useState(null),j=r(),v=n&&(n.includes("lead buyer")||n.includes("app_admin"));n.includes("final_approver")||n.includes("app_admin")||n.includes("ceo");const w=s.useMemo(()=>{if(!e||0===e.length)return 80;e.length;let a=2;const t=Math.min(e.length,100);e.slice(0,t).forEach(e=>{const t=(e.vendor_name||"").split("").reduce((e,a)=>e+(/[ê°€-í£]/.test(a)?1.5:1),0);a=Math.max(a,Math.ceil(t))});return Math.max(80,Math.min(200,7*a+20))},[e,t]),N=s.useCallback(e=>{p(e.id),g(!0)},[]),C=s.useCallback(()=>{g(!1),p(null)},[]),q=s.useCallback(async e=>{try{const{data:s,error:r}=await j.from("purchase_requests").select("*").eq("purchase_order_number",e.purchase_order_number).single();if(r||!s)return void k.error("í•´ë‹¹ ë°œì£¼ìš”ì²­ë²ˆí˜¸ì˜ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");const{data:l,error:c}=await j.from("purchase_request_items").select("*").eq("purchase_order_number",e.purchase_order_number).order("line_number");if(c||!l||0===l.length)return void k.error("í•´ë‹¹ ë°œì£¼ìš”ì²­ë²ˆí˜¸ì˜ í’ˆëª© ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");const d={vendor_name:e.vendor_name,vendor_phone:"",vendor_fax:"",vendor_contact_name:"",vendor_payment_schedule:""};try{const a=s.vendor_id||e.vendor_id,t=s.contact_id||e.contact_id;if(a){const{data:e}=await j.from("vendors").select("vendor_phone, vendor_fax, vendor_payment_schedule").eq("id",a).single();e&&(d.vendor_phone=e.vendor_phone||"",d.vendor_fax=e.vendor_fax||"",d.vendor_payment_schedule=e.vendor_payment_schedule||"")}if(t){const{data:e}=await j.from("vendor_contacts").select("contact_name, contact_phone, contact_email").eq("id",t).single();e&&(d.vendor_contact_name=e.contact_name||"")}}catch(a){}const o={purchase_order_number:s.purchase_order_number||"",request_date:s.request_date,delivery_request_date:s.delivery_request_date,requester_name:s.requester_name,vendor_name:d.vendor_name||"",vendor_contact_name:d.vendor_contact_name,vendor_phone:d.vendor_phone,vendor_fax:d.vendor_fax,project_vendor:s.project_vendor,sales_order_number:s.sales_order_number,project_item:s.project_item,vendor_payment_schedule:d.vendor_payment_schedule,items:l.map(e=>({line_number:e.line_number,item_name:e.item_name,specification:e.specification,quantity:e.quantity,unit_price_value:e.unit_price_value,amount_value:e.amount_value,remark:e.remark,currency:s.currency||"KRW"}))},m=await T(o),u=`ë°œì£¼ì„œ_${o.vendor_name}_${o.purchase_order_number}.xlsx`,p=window.URL.createObjectURL(m),h=document.createElement("a");h.href=p,h.download=u,document.body.appendChild(h),h.click(),document.body.removeChild(h),window.URL.revokeObjectURL(p),k.success("ì—‘ì…€ íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.");try{if(n&&n.includes("lead buyer")){const{error:a}=await j.from("purchase_requests").update({is_po_download:!0}).eq("purchase_order_number",e.purchase_order_number);a||i?.()}}catch(t){}}catch(a){k.error("ì—‘ì…€ ë‹¤ìš´ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}},[j]),$=s.useCallback(async()=>{if(y){try{const e="https://qvhbigvdfyvhoegkhvef.supabase.co";if(!e||!"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF2aGJpZ3ZkZnl2aG9lZ2todmVmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc4MTQzNjAsImV4cCI6MjA2MzM5MDM2MH0.7VZlSwnNuE0MaQpDjuzeZFgjJrDBQOWA_COyqaM8Rbg"||e.includes("placeholder"))return a.warn("Supabase í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•ŠìŒ - FastPurchaseTable"),void k.error("í™˜ê²½ ì„¤ì • ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");const{data:{user:t},error:s}=await j.auth.getUser();if(s||!t)return void k.error("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");const{data:r,error:l}=await j.from("employees").select("name, email, purchase_role").eq("email",t.email).single();if(l||!r)return void k.error("ì‚¬ìš©ì ê¶Œí•œì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");let n=[];if(r.purchase_role)if(Array.isArray(r.purchase_role))n=r.purchase_role.map(e=>String(e).trim());else{n=String(r.purchase_role).split(",").map(e=>e.trim()).filter(e=>e.length>0)}const c=n.includes("final_approver")||n.includes("app_admin")||n.includes("ceo"),d="approved"===y.final_manager_status,o=y.requester_name===r.name;if(!(d?c:c||o))return void k.error("ì‚­ì œ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");const{data:m,error:u}=await j.from("purchase_request_items").delete().eq("purchase_request_id",y.id).select();if(u)throw a.error("ì•„ì´í…œ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ",u,{code:u.code,message:u.message,details:u.details,hint:u.hint}),u;const{data:p,error:h}=await j.from("purchase_requests").delete().eq("id",y.id).select();if(h)throw a.error("ë°œì£¼ìš”ì²­ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ",h,{code:h.code,message:h.message,details:h.details,hint:h.hint}),h;x(y.id)?a.info("âœ… [handleConfirmDelete] ë©”ëª¨ë¦¬ ìºì‹œì—ì„œ ë°œì£¼ì„œ ì‚­ì œ ì„±ê³µ",{purchaseId:y.id}):a.warn("[handleConfirmDelete] ë©”ëª¨ë¦¬ ìºì‹œì—ì„œ ë°œì£¼ì„œ ì‚­ì œ ì‹¤íŒ¨",{purchaseId:y.id}),k.success("ë°œì£¼ìš”ì²­ ë‚´ì—­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤."),i?.()}catch(e){const t=e;a.error("ë°œì£¼ìš”ì²­ ì‚­ì œ ì¤‘ ì˜ˆì™¸ ë°œìƒ",t,{name:t?.name,message:t?.message,code:t?.code,details:t?.details,hint:t?.hint,stack:t?.stack}),k.error(`ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${t?.message||"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}`)}_(!1),f(null)}},[j,y,i]),S=s.useCallback(e=>!m||!1!==m[e],[m]),M=s.useMemo(()=>{if("pending"===t||"purchase"===t)return l.jsx("thead",{className:"bg-gray-50",children:l.jsxs("tr",{children:[l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${ga}`,children:"ìŠ¹ì¸ìƒíƒœ"}),S("purchase_order_number")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${ba}`,children:"ë°œì£¼ë²ˆí˜¸"}),S("payment_category")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${_a}`,children:"ê²°ì œì¢…ë¥˜"}),S("requester_name")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${ya}`,children:"ìš”ì²­ì"}),S("request_date")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${fa}`,children:"ì²­êµ¬ì¼"}),S("vendor_name")&&l.jsx("th",{className:"px-2 py-1.5 modal-label text-gray-900 text-left vendor-dynamic-column",style:{width:`${w||80}px`,minWidth:`${w||80}px`,maxWidth:`${w||80}px`},children:"ì—…ì²´"}),S("contact_name")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${va}`,children:"ë‹´ë‹¹ì"}),S("delivery_request_date")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${wa}`,children:"ì…ê³ ìš”ì²­ì¼"}),S("item_name")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${ka}`,children:"í’ˆëª…"}),S("specification")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${Ca}`,children:"ê·œê²©"}),S("quantity")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${qa}`,children:"ìš”ì²­ìˆ˜ëŸ‰"}),S("unit_price")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${$a}`,children:"ë‹¨ê°€"}),S("amount")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Sa}`,children:"í•©ê³„"}),S("remark")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ma}`,children:"ë¹„ê³ "}),"purchase"===t&&S("link")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ia}`,children:"ë§í¬"}),S("project_vendor")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Da}`,children:"PJì—…ì²´"}),S("project_item")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Fa}`,children:"PJ ITEM"}),S("sales_order_number")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Pa}`,children:"ìˆ˜ì£¼ë²ˆí˜¸"})]})});const e=l.jsxs(l.Fragment,{children:[S("purchase_order_number")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${ba}`,children:"ë°œì£¼ë²ˆí˜¸"}),S("payment_category")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${_a}`,children:"ê²°ì œì¢…ë¥˜"}),S("requester_name")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${ya}`,children:"ìš”ì²­ì"}),S("request_date")&&l.jsx("th",{className:`py-1.5 modal-label text-gray-900 whitespace-nowrap ${fa}`,children:"ì²­êµ¬ì¼"}),"done"===t&&S("utk_status")&&l.jsx("th",{className:`pl-2 pr-3 py-1.5 modal-label text-gray-900 whitespace-nowrap text-center ${La}`,children:"UTK"}),S("vendor_name")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${"done"===t?ja:"vendor-dynamic-column"}`,style:"done"===t?void 0:{width:`${w||80}px`,minWidth:`${w||80}px`,maxWidth:`${w||80}px`},children:"ì—…ì²´"}),S("contact_name")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${va}`,children:"ë‹´ë‹¹ì"}),S("delivery_request_date")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${wa}`,children:"ì…ê³ ìš”ì²­ì¼"}),("receipt"===t||"done"===t)&&S("revised_delivery_date")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Na}`,children:"ë³€ê²½ ì…ê³ ì¼"}),S("item_name")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${ka}`,children:"í’ˆëª…"}),S("specification")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${Ca}`,children:"ê·œê²©"}),S("quantity")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 ${qa}`,children:"receipt"===t||"done"===t?l.jsxs("div",{className:"flex flex-col items-center leading-tight",children:[l.jsx("div",{className:"text-[9px]",children:"ìš”ì²­/ì‹¤ì œ"}),l.jsx("div",{className:"text-[10px]",children:"ì…ê³ ìˆ˜ëŸ‰"})]}):"ìš”ì²­ìˆ˜ëŸ‰"}),S("unit_price")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${$a}`,children:"ë‹¨ê°€"}),S("amount")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Sa}`,children:"í•©ê³„"})]});let a=null;return"receipt"===t?a=l.jsxs(l.Fragment,{children:[S("remark")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ma}`,children:"ë¹„ê³ "}),S("project_vendor")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Da}`,children:"PJì—…ì²´"}),S("project_item")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Fa}`,children:"PJ ITEM"}),S("sales_order_number")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Pa}`,children:"ìˆ˜ì£¼ë²ˆí˜¸"})]}):"done"===t&&(a=l.jsxs(l.Fragment,{children:[S("remark")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ma}`,children:"ë¹„ê³ "}),S("link")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ia}`,children:"ë§í¬"}),S("project_vendor")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Da}`,children:"PJì—…ì²´"}),S("project_item")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Fa}`,children:"PJ ITEM"}),S("sales_order_number")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Pa}`,children:"ìˆ˜ì£¼ë²ˆí˜¸"}),S("purchase_progress")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Ta}`,children:"êµ¬ë§¤ì§„í–‰"}),S("receipt_progress")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Va}`,children:"ì…ê³ ì§„í–‰"})]})),l.jsx("thead",{className:"bg-gray-50",children:l.jsxs("tr",{children:["receipt"===t&&S("receipt_progress")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Ra}`,children:"ì…ê³ ì§„í–‰"}),"done"===t&&S("statement_progress")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Ra}`,children:"ê±°ë˜ëª…ì„¸ì„œ"}),e,a]})})},[t,S,w]),D=s.useMemo(()=>{if(!m)return!1;return!!Object.values(m).some(e=>!e)},[m]),P=s.useMemo(()=>e.length>=100,[e.length]);return l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"hidden md:block "+(D?"w-fit":"w-full"),children:P?l.jsx(De,{purchases:e,activeTab:t,onRowClick:N,isLeadBuyer:v,onPaymentComplete:d,onReceiptComplete:o,onExcelDownload:q,columnVisibility:m,vendorColumnWidth:w,tableHeader:M,TableRowComponent:Ua,shouldUseFitLayout:D}):l.jsx("div",{className:D?"table-container-fit-left":"overflow-x-auto border rounded-lg",children:l.jsxs("table",{className:D?`table-fit-left ${t}-tab`:"w-full min-w-[1790px] border-collapse",children:[M,l.jsx("tbody",{children:e.map(e=>l.jsx(Ua,{purchase:e,onClick:N,activeTab:t,isLeadBuyer:v,onPaymentComplete:d,onReceiptComplete:o,onExcelDownload:q,vendorColumnWidth:w,columnVisibility:m},e.id))})]})})}),l.jsx("div",{className:"hidden sm:block md:hidden w-full",children:l.jsx("div",{className:"overflow-x-auto border rounded-lg",children:l.jsxs("table",{className:"w-full min-w-[600px] card-title",children:[l.jsx("thead",{className:"bg-gray-50",children:l.jsxs("tr",{children:[l.jsx("th",{className:"text-left p-2 modal-label text-gray-900 w-24",children:"ë°œì£¼ë²ˆí˜¸"}),l.jsx("th",{className:"text-left p-2 modal-label text-gray-900 w-16",children:"ìš”ì²­ì"}),l.jsx("th",{className:"text-left p-2 modal-label text-gray-900 vendor-dynamic-column",style:{width:`${w||80}px`},children:"ì—…ì²´"}),l.jsx("th",{className:"text-left p-2 modal-label text-gray-900 w-32",children:"í’ˆëª…"}),l.jsx("th",{className:"text-right p-2 modal-label text-gray-900 w-20",children:"ê¸ˆì•¡"}),l.jsx("th",{className:"text-center p-2 modal-label text-gray-900 w-16",children:"ìƒíƒœ"})]})}),l.jsx("tbody",{children:e.map(e=>l.jsxs("tr",{className:"border-b hover:bg-gray-50 cursor-pointer",onClick:()=>N(e),children:[l.jsx("td",{className:"p-2 modal-value",children:e.purchase_order_number||"-"}),l.jsx("td",{className:"p-2",children:e.requester_name}),l.jsx("td",{className:"p-2 truncate",title:e.vendor_name,children:e.vendor_name}),l.jsx("td",{className:"p-2 truncate",title:e.purchase_request_items?.[0]?.item_name,children:e.purchase_request_items?.[0]?.item_name||"-"}),l.jsx("td",{className:"p-2 text-right card-amount",children:e.purchase_request_items?.[0]?.amount_value?`${e.purchase_request_items[0].amount_value.toLocaleString()} ${xa(e.purchase_request_items[0]?.amount_currency||"KRW")}`:e.total_amount?`${e.total_amount.toLocaleString()} ${xa(e.currency||"KRW")}`:`0 ${xa(e.currency||"KRW")}`}),l.jsx("td",{className:"p-2 text-center",children:l.jsx(ha,{purchase:e})})]},e.id))})]})})}),l.jsx("div",{className:"sm:hidden space-y-3",children:e.map(e=>l.jsx(Me,{purchase:e,onClick:()=>N(e)},e.id))}),l.jsx(V,{purchaseId:u,isOpen:h,onClose:C,currentUserRoles:n,activeTab:t,onRefresh:i,onOptimisticUpdate:c,onDelete:e=>{f(e),_(!0)}}),l.jsx(ra,{open:b,onOpenChange:_,children:l.jsxs(ia,{children:[l.jsxs(ca,{children:[l.jsx(oa,{children:"ë°œì£¼ìš”ì²­ ë‚´ì—­ ì‚­ì œ"}),l.jsxs(ma,{children:["ë°œì£¼ìš”ì²­ë²ˆí˜¸ ",y?.purchase_order_number,"ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."]})]}),l.jsxs(da,{children:[l.jsx(pa,{children:"ì·¨ì†Œ"}),l.jsx(ua,{onClick:$,className:"bg-red-600 hover:bg-red-700",children:"ì‚­ì œ"})]})]})})]})};za.displayName="FastPurchaseTable";const Ya=[{key:"date_range",label:"ê¸°ê°„ë³„",type:"date_range",icon:ie,category:"ë‚ ì§œ"},{key:"date_month",label:"ì›”ë³„",type:"date_month",icon:ie,category:"ë‚ ì§œ"},{key:"requester_name",label:"ìš”ì²­ì",type:"searchable_select",icon:g,category:"ì‚¬ìš©ì"},{key:"vendor_name",label:"ì—…ì²´",type:"searchable_select",icon:he,category:"ì‚¬ìš©ì"},{key:"contact_name",label:"ë‹´ë‹¹ì",type:"searchable_select",icon:g,category:"ì‚¬ìš©ì"},{key:"purchase_order_number",label:"ë°œì£¼ë²ˆí˜¸",type:"text",icon:ce,category:"í…ìŠ¤íŠ¸"},{key:"item_name",label:"í’ˆëª…",type:"text",icon:ce,category:"í…ìŠ¤íŠ¸"},{key:"specification",label:"ê·œê²©",type:"text",icon:ce,category:"í…ìŠ¤íŠ¸"},{key:"remark",label:"ë¹„ê³ ",type:"text",icon:ce,category:"í…ìŠ¤íŠ¸"},{key:"project_vendor",label:"PJì—…ì²´",type:"text",icon:he,category:"í…ìŠ¤íŠ¸"},{key:"project_item",label:"PJ ITEM",type:"text",icon:ce,category:"í…ìŠ¤íŠ¸"},{key:"sales_order_number",label:"ìˆ˜ì£¼ë²ˆí˜¸",type:"text",icon:ce,category:"í…ìŠ¤íŠ¸"},{key:"quantity",label:"ìˆ˜ëŸ‰",type:"number",icon:I,category:"ìˆ«ì"},{key:"unit_price_value",label:"ë‹¨ê°€",type:"number",icon:I,category:"ìˆ«ì"},{key:"total_amount",label:"í•©ê³„",type:"number",icon:I,category:"ìˆ«ì"},{key:"payment_category",label:"ê²°ì œì¢…ë¥˜",type:"select",icon:re,category:"ìƒíƒœ",options:["í˜„ì¥ê²°ì œ","êµ¬ë§¤ìš”ì²­","ë°œì£¼ìš”ì²­"]},{key:"payment_schedule",label:"ì§€ì¶œì˜ˆì •ì¼",type:"select_with_empty",icon:ie,category:"ìƒíƒœ"},{key:"is_payment_completed",label:"êµ¬ë§¤í˜„í™©",type:"select",icon:R,category:"ìƒíƒœ",options:["ëŒ€ê¸°","ì™„ë£Œ"]},{key:"is_received",label:"ì…ê³ í˜„í™©",type:"select",icon:R,category:"ìƒíƒœ",options:["ëŒ€ê¸°","ì™„ë£Œ"]},{key:"is_statement_received",label:"ê±°ë˜ëª…ì„¸ì„œ í™•ì¸",type:"select",icon:R,category:"ìƒíƒœ",options:["ëŒ€ê¸°","ì™„ë£Œ"]},{key:"is_utk_checked",label:"UTK í™•ì¸",type:"select",icon:re,category:"ìƒíƒœ",options:["ëŒ€ê¸°","ì™„ë£Œ"]}],Ba=[{value:"request_date",label:"ì²­êµ¬ì¼"},{value:"delivery_request_date",label:"ì…ê³ ìš”ì²­ì¼"},{value:"payment_completed_at",label:"êµ¬ë§¤ì™„ë£Œì¼"},{value:"received_at",label:"ì…ê³ ì™„ë£Œì¼"},{value:"created_at",label:"ìƒì„±ì¼"},{value:"statement_received_at",label:"ê±°ë˜ëª…ì„¸ì„œì…ê³ ì¼"}],Ja=[{value:"request_date",label:"ìš”ì²­ì¼"},{value:"purchase_order_number",label:"ë°œì£¼ë²ˆí˜¸"},{value:"vendor_name",label:"ì—…ì²´ëª…"},{value:"requester_name",label:"ìš”ì²­ì"},{value:"total_amount",label:"í•©ê³„"},{value:"delivery_request_date",label:"ì…ê³ ìš”ì²­ì¼"},{value:"created_at",label:"ìƒì„±ì¼"}];function Ka({activeFilters:e,sortConfig:a,searchTerm:t,onFiltersChange:r,onSortChange:i,onSearchChange:d,availableEmployees:o=[],availableVendors:m=[],availableContacts:u=[],availablePaymentSchedules:p=[],children:h}){const[x,g]=s.useState(!1),[b,_]=s.useState(!1),[y,f]=s.useState(!1),[j,v]=s.useState({}),[w,N]=s.useState(!1),[k,C]=s.useState(!1),[q,$]=s.useState({}),[S,M]=s.useState(),[P,F]=s.useState({}),[T,V]=s.useState({}),[I,L]=s.useState(""),E=s.useRef(null);s.useEffect(()=>{y&&E.current&&E.current.focus()},[y]),s.useEffect(()=>{b&&V({field:a?.field||"",direction:a?.direction||"asc"})},[b,a]);const A=a=>{r(e.filter(e=>e.id!==a))},O=()=>{const e=Ya.find(e=>e.key===j.field);if(!e)return null;switch(e.type){case"text":return l.jsx(Z,{placeholder:"ê°’ ì…ë ¥",value:j.value||"",onChange:e=>v(a=>({...a,value:e.target.value})),className:"w-full business-radius-input border border-gray-300 bg-white text-gray-700 card-description h-auto",style:{padding:"2px 10px",fontSize:"10px",fontWeight:"500"}});case"number":return l.jsx(Z,{type:"number",placeholder:"ìˆ«ì ì…ë ¥",value:j.value||"",onChange:e=>v(a=>({...a,value:e.target.value})),className:"w-full business-radius-input border border-gray-300 bg-white text-gray-700 card-description h-auto",style:{padding:"2px 10px",fontSize:"10px",fontWeight:"500"}});case"searchable_select":let a=[],t="ì„ íƒ";"requester_name"===e.key?(a=o,t="ìš”ì²­ì"):"vendor_name"===e.key?(a=m,t="ì—…ì²´"):"contact_name"===e.key&&(a=u,t="ë‹´ë‹¹ì");const s=a.filter(e=>e.toLowerCase().includes(I.toLowerCase()));return l.jsxs(H,{onOpenChange:e=>{e||L("")},children:[l.jsx(Q,{asChild:!0,children:l.jsxs(n,{variant:"outline",role:"combobox",className:"w-full button-base business-radius-button border border-gray-300 bg-white text-gray-700 justify-between [&>svg]:hidden",children:[l.jsx("span",{className:"truncate text-left",style:{fontSize:"12px",fontWeight:"500"},children:j.value||t}),l.jsx(de,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),l.jsx(G,{className:"w-[200px] p-1 border-0 shadow-lg",align:"start",children:l.jsxs("div",{className:"space-y-1",children:[l.jsx(Z,{placeholder:`${t} ê²€ìƒ‰...`,className:"h-auto border-0 focus:ring-0 focus:outline-none card-description placeholder:card-description",style:{padding:"2px 10px"},value:I,onChange:e=>L(e.target.value),autoFocus:!0}),l.jsx("div",{className:"max-h-[200px] overflow-y-auto",children:0===s.length?l.jsx("div",{className:"p-2 text-sm text-gray-500",children:I?"ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤":`${t}ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤`}):s.map(e=>l.jsxs(n,{variant:"ghost",onClick:()=>{v(a=>({...a,value:e})),L("")},className:"w-full justify-start p-2 h-auto hover:bg-gray-100 text-left",children:[l.jsx(R,{className:"mr-2 h-3 w-3 "+(j.value===e?"opacity-100":"opacity-0")}),l.jsx("span",{className:"card-description",children:e})]},e))})]})})]});case"select":return l.jsxs(X,{value:j.value||"",onValueChange:e=>v(a=>({...a,value:e})),children:[l.jsx(ee,{className:"button-base business-radius-button border border-gray-300 bg-white text-gray-700 [&>svg]:hidden text-center",children:l.jsx(ae,{placeholder:"ì„ íƒ"})}),l.jsx(te,{children:e.options?.map(e=>l.jsx(se,{value:e,children:l.jsx("span",{className:"card-description",children:e})},e))})]});case"select_with_empty":const r=["ê³µë€",...p];return l.jsxs(X,{value:j.value||"",onValueChange:e=>v(a=>({...a,value:e})),children:[l.jsx(ee,{className:"button-base business-radius-button border border-gray-300 bg-white text-gray-700 [&>svg]:hidden text-center",children:l.jsx(ae,{placeholder:"ì§€ì¶œì˜ˆì •ì¼"})}),l.jsx(te,{children:r.map(e=>l.jsx(se,{value:e,children:l.jsx("span",{className:"card-description",children:e})},e))})]});case"date_range":return l.jsxs(H,{open:w,onOpenChange:e=>{if(e)if(j.value)if(j.value.includes("~")){const[e,a]=j.value.split("~");$({from:new Date(e),to:new Date(a)})}else $({from:new Date(j.value),to:void 0});else $({});N(e)},children:[l.jsx(Q,{asChild:!0,children:l.jsx(n,{variant:"outline",className:"w-full button-base business-radius-button border border-gray-300 bg-white text-gray-700 justify-between h-auto",children:l.jsxs("div",{className:"flex items-center gap-1.5 min-h-[32px]",children:[l.jsx(ie,{className:"w-3 h-3 flex-shrink-0"}),l.jsx("span",{className:"card-description leading-tight whitespace-pre-line",children:j.value?(()=>{if(j.value.includes("~")){const[e,a]=j.value.split("~");return`${le(new Date(e),"yy/MM/dd")}\n~ ${le(new Date(a),"yy/MM/dd")}`}return le(new Date(j.value),"yy/MM/dd")})():"ë‚ ì§œ ì„ íƒ"})]})})}),l.jsx(G,{className:"w-auto p-0",align:"start",children:l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{className:"p-3 pb-0",children:[l.jsx("div",{className:"text-xs font-medium text-gray-600 mb-2",children:"ë‚ ì§œ ë²”ìœ„ ì„ íƒ"}),l.jsx(ne,{mode:"range",selected:q,onSelect:e=>{e&&$(e)},numberOfMonths:1,initialFocus:!0,className:"compact-calendar"})]}),l.jsxs("div",{className:"flex gap-2 p-3 pt-0",children:[l.jsx(n,{onClick:()=>{$({}),N(!1)},variant:"outline",className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 flex-1",children:"ì·¨ì†Œ"}),l.jsx(n,{onClick:()=>{if(q.from){if(q.to){const e=`${le(q.from,"yyyy-MM-dd")}~${le(q.to,"yyyy-MM-dd")}`;v(a=>({...a,value:e}))}else v(e=>({...e,value:le(q.from,"yyyy-MM-dd")}));N(!1)}},disabled:!q.from,className:"button-base bg-blue-500 text-white hover:bg-blue-600 flex-1",children:"í™•ì¸"})]})]})})]});case"date_month":return l.jsxs(H,{open:k,onOpenChange:e=>{if(e)if(j.value)if(j.value.includes("~")){const[e,a]=j.value.split("~");F({from:new Date(`${e}-01`),to:new Date(`${a}-01`)})}else F({from:new Date(`${j.value}-01`),to:void 0});else F({});C(e)},children:[l.jsx(Q,{asChild:!0,children:l.jsx(n,{variant:"outline",className:"w-full button-base business-radius-button border border-gray-300 bg-white text-gray-700 justify-between h-auto",children:l.jsxs("div",{className:"flex items-center gap-1.5",children:[l.jsx(ie,{className:"w-3 h-3 flex-shrink-0"}),l.jsx("span",{className:"card-description leading-tight whitespace-pre-line",children:j.value?(()=>{if(j.value.includes("~")){const[e,a]=j.value.split("~"),[t,s]=e.split("-"),[r,l]=a.split("-");return`${t.slice(-2)}/${s}\n~ ${r.slice(-2)}/${l}`}{const[e,a]=j.value.split("-");return`${e.slice(-2)}/${a}`}})():"ì›” ì„ íƒ"})]})})}),l.jsx(G,{className:"w-auto p-0",align:"start",children:l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{className:"p-3 pb-0",children:[l.jsx("div",{className:"text-xs font-medium text-gray-600 mb-3",children:"ì›” ì„ íƒ"}),l.jsxs("div",{className:"flex gap-4",children:[l.jsxs("div",{className:"flex-1",children:[l.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"ì‹œì‘ ì›” ì„ íƒ"}),l.jsx("div",{className:"mb-3",children:l.jsxs("div",{className:"flex items-center justify-between mb-2",children:[l.jsx(n,{onClick:()=>{const e=P.from?P.from.getFullYear():(new Date).getFullYear(),a=new Date(e-1,P.from?P.from.getMonth():0,1);F(e=>({...e,from:a}))},variant:"outline",size:"sm",className:"button-base border border-gray-300 bg-white text-gray-600 hover:bg-gray-50",children:"â€¹"}),l.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[P.from?P.from.getFullYear():(new Date).getFullYear(),"ë…„"]}),l.jsx(n,{onClick:()=>{const e=P.from?P.from.getFullYear():(new Date).getFullYear(),a=new Date(e+1,P.from?P.from.getMonth():0,1);F(e=>({...e,from:a}))},variant:"outline",size:"sm",className:"button-base border border-gray-300 bg-white text-gray-600 hover:bg-gray-50",children:"â€º"})]})}),l.jsx("div",{className:"grid grid-cols-3 gap-2",children:Array.from({length:12},(e,a)=>{const t=P.from?P.from.getFullYear():(new Date).getFullYear(),s=new Date(t,a,1),r=P.from&&P.from.getFullYear()===t&&P.from.getMonth()===a;return l.jsxs(n,{onClick:()=>{F(e=>({...e,from:s}))},variant:"outline",className:"button-base text-xs h-8 "+(r?"bg-blue-500 text-white border-blue-500 hover:bg-blue-600":"border-gray-300 bg-white text-gray-700 hover:bg-gray-50"),children:[a+1,"ì›”"]},a)})})]}),P.from&&l.jsxs("div",{className:"flex-1",children:[l.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"ì¢…ë£Œ ì›” ì„ íƒ (ì„ íƒì‚¬í•­)"}),l.jsx("div",{className:"mb-3",children:l.jsxs("div",{className:"flex items-center justify-between mb-2",children:[l.jsx(n,{onClick:()=>{const e=P.to?P.to.getFullYear():P.from.getFullYear(),a=new Date(e-1,P.to?P.to.getMonth():11,1);F(e=>({...e,to:a}))},variant:"outline",size:"sm",className:"button-base border border-gray-300 bg-white text-gray-600 hover:bg-gray-50",children:"â€¹"}),l.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[P.to?P.to.getFullYear():P.from.getFullYear(),"ë…„"]}),l.jsx(n,{onClick:()=>{const e=P.to?P.to.getFullYear():P.from.getFullYear(),a=new Date(e+1,P.to?P.to.getMonth():11,1);F(e=>({...e,to:a}))},variant:"outline",size:"sm",className:"button-base border border-gray-300 bg-white text-gray-600 hover:bg-gray-50",children:"â€º"})]})}),l.jsx("div",{className:"grid grid-cols-3 gap-2",children:Array.from({length:12},(e,a)=>{const t=P.to?P.to.getFullYear():P.from.getFullYear(),s=new Date(t,a,1),r=P.to&&P.to.getFullYear()===t&&P.to.getMonth()===a,i=s<P.from;return l.jsxs(n,{onClick:()=>{i||F(e=>({...e,to:s}))},variant:"outline",disabled:i,className:"button-base text-xs h-8 "+(r?"bg-blue-500 text-white border-blue-500 hover:bg-blue-600":i?"border-gray-200 bg-gray-100 text-gray-400 cursor-not-allowed":"border-gray-300 bg-white text-gray-700 hover:bg-gray-50"),children:[a+1,"ì›”"]},a)})}),l.jsx("div",{className:"mt-3",children:l.jsx(n,{onClick:()=>{F(e=>({...e,to:void 0}))},variant:"outline",size:"sm",className:"button-base border border-gray-300 bg-white text-gray-600 hover:bg-gray-50 text-xs",children:"ì¢…ë£Œ ì›” ì œê±°"})})]})]})]}),l.jsxs("div",{className:"flex gap-2 p-3 pt-0",children:[l.jsx(n,{onClick:()=>{F({}),C(!1)},variant:"outline",className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 flex-1",children:"ì·¨ì†Œ"}),l.jsx(n,{onClick:()=>{if(P.from){if(P.to){const e=`${le(P.from,"yyyy-MM")}~${le(P.to,"yyyy-MM")}`;v(a=>({...a,value:e}))}else v(e=>({...e,value:le(P.from,"yyyy-MM")}));C(!1)}},disabled:!P.from,className:"button-base bg-blue-500 text-white hover:bg-blue-600 flex-1",children:"í™•ì¸"})]})]})})]});default:return null}};return l.jsxs("div",{className:"w-full space-y-3",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsxs(H,{open:x,onOpenChange:g,children:[l.jsx(Q,{asChild:!0,children:l.jsxs(n,{variant:"outline",className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50",children:[l.jsx(be,{className:"w-4 h-4 mr-1"}),l.jsx("span",{className:"button-text",children:"í•„í„°"}),e.length>0&&l.jsx("span",{className:"ml-1 badge-stats bg-blue-50 text-blue-700",children:e.length})]})}),l.jsx(G,{className:"w-64 p-3",align:"start",children:l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("h4",{className:"card-title",children:"í•„í„°"}),e.length>0&&l.jsx(n,{variant:"ghost",onClick:()=>{r([]),g(!1)},className:"button-base text-red-600 hover:text-red-700 hover:bg-red-50",children:l.jsx("span",{className:"button-text",children:"ëª¨ë‘ ì§€ìš°ê¸°"})})]}),e.length>0&&l.jsxs("div",{className:"space-y-2",children:[e.map(e=>l.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 business-radius",children:[l.jsxs("span",{className:"card-description",children:[e.label,e.dateField&&l.jsxs("span",{className:"text-blue-600",children:["(",Ba.find(a=>a.value===e.dateField)?.label,")"]}),": ",e.value]}),l.jsx(n,{variant:"ghost",onClick:()=>A(e.id),className:"button-base h-6 w-6 p-0 hover:bg-red-50",children:l.jsx(c,{className:"w-3 h-3"})})]},e.id)),l.jsx("div",{className:"border-t border-gray-200 my-2"})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs(X,{onValueChange:e=>{const a=Ya.find(a=>a.key===e);if(!a)return;let t="contains";"date_range"!==a.type&&"date_month"!==a.type||(t="equals"),v({id:`${e}_${Date.now()}`,field:e,condition:t,value:"",label:a.label})},children:[l.jsx(ee,{className:"button-base business-radius-button border border-gray-300 bg-white text-gray-700 [&>svg]:hidden text-center",children:l.jsx(ae,{placeholder:"+ í•„í„° ì¶”ê°€"})}),l.jsx(te,{className:"w-64 max-h-80 overflow-y-auto",style:{scrollbarWidth:"auto",scrollbarColor:"#9ca3af #f3f4f6",WebkitScrollbarWidth:"8px"},children:Object.entries(Ya.reduce((e,a)=>(e[a.category]||(e[a.category]=[]),e[a.category].push(a),e),{})).map(([e,a])=>l.jsxs("div",{children:[l.jsx("div",{className:"px-2 py-1 card-description uppercase",children:e}),a.map(e=>l.jsx(se,{value:e.key,children:l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(e.icon,{className:"w-4 h-4"}),l.jsx("span",{className:"card-description",children:e.label})]})},e.key))]},e))})]}),j.field&&l.jsxs("div",{className:"space-y-2 p-3 border business-radius bg-white",children:[l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("span",{className:"card-title",children:[j.label," í•„í„°"]})}),"date_range"===j.field||"date_month"===j.field?l.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[l.jsx("div",{className:"flex items-start",children:l.jsxs(X,{value:j.dateField||"",onValueChange:e=>v(a=>({...a,dateField:e})),children:[l.jsx(ee,{className:"w-full button-base business-radius-button border border-gray-300 bg-white text-gray-700 [&>svg]:hidden text-center justify-center",children:l.jsx(ae,{placeholder:"ë‚ ì§œ í•­ëª©",className:"text-center"})}),l.jsx(te,{children:Ba.map(e=>l.jsx(se,{value:e.value,children:l.jsx("span",{className:"card-description",children:e.label})},e.value))})]})}),l.jsx("div",{className:"flex items-start",children:O()})]}):l.jsx("div",{children:O()}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx(n,{onClick:()=>{const a="date_range"===j.field||"date_month"===j.field,t=a&&!j.dateField;let s=j.condition;if(!s)if(a)s="equals";else{const e=Ya.find(e=>e.key===j.field);s="select"===e?.type||"select_with_empty"===e?.type||"searchable_select"===e?.type?"equals":"contains"}if(j.field&&void 0!==s&&""!==j.value&&!t){const a={id:j.id,field:j.field,condition:s,value:j.value,label:j.label,dateField:j.dateField};r([...e,a]),v({}),g(!1)}},disabled:!j.field||""===j.value||("date_range"===j.field||"date_month"===j.field)&&!j.dateField,className:"button-base bg-blue-500 text-white hover:bg-blue-600 flex-1",children:"ì ìš©"}),l.jsx(n,{variant:"outline",onClick:()=>v({}),className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 flex-1",children:"ì·¨ì†Œ"})]})]})]})]})})]}),l.jsxs(H,{open:b,onOpenChange:_,children:[l.jsx(Q,{asChild:!0,children:l.jsxs(n,{variant:"outline",className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50",children:[l.jsx(D,{className:"w-4 h-4 mr-1"}),l.jsx("span",{className:"button-text",children:"ì •ë ¬"}),a&&l.jsxs("span",{className:"ml-1 card-description",children:["(","asc"===a.direction?"â†‘":"â†“",")"]})]})}),l.jsx(G,{className:"w-56 p-3",align:"start",children:l.jsxs("div",{className:"space-y-3",children:[l.jsx("h4",{className:"card-title",children:"ì •ë ¬ ì„¤ì •"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{children:[l.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"ì •ë ¬ ê¸°ì¤€"}),l.jsxs(X,{value:T.field||"",onValueChange:e=>{V(a=>({...a,field:e}))},children:[l.jsx(ee,{className:"button-base business-radius-button border border-gray-300 bg-white text-gray-700 [&>svg]:hidden",children:l.jsx(ae,{placeholder:"ì„ íƒí•˜ì„¸ìš”"})}),l.jsx(te,{children:Ja.map(e=>l.jsx(se,{value:e.value,children:l.jsx("span",{className:"card-description",children:e.label})},e.value))})]})]}),T.field&&l.jsxs("div",{children:[l.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"ì •ë ¬ ë°©í–¥"}),l.jsxs(X,{value:T.direction||"",onValueChange:e=>{V(a=>({...a,direction:e}))},children:[l.jsx(ee,{className:"button-base business-radius-button border border-gray-300 bg-white text-gray-700 [&>svg]:hidden",children:l.jsx(ae,{placeholder:"ì„ íƒí•˜ì„¸ìš”"})}),l.jsxs(te,{children:[l.jsx(se,{value:"asc",children:l.jsx("span",{className:"card-description",children:"ì˜¤ë¦„ì°¨ìˆœ â†‘"})}),l.jsx(se,{value:"desc",children:l.jsx("span",{className:"card-description",children:"ë‚´ë¦¼ì°¨ìˆœ â†“"})})]})]})]}),l.jsxs("div",{className:"flex gap-2 pt-2",children:[l.jsx(n,{onClick:()=>{if(T.field&&T.direction){const e=Ja.find(e=>e.value===T.field);e&&i({field:T.field,direction:T.direction,label:e.label})}_(!1),V({})},disabled:!T.field||!T.direction,className:"button-base bg-blue-500 hover:bg-blue-600 text-white flex-1",children:"ì ìš©"}),l.jsx(n,{onClick:()=>{i(null),V({}),_(!1)},className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50",children:"ì´ˆê¸°í™”"})]})]}),a&&l.jsx("div",{className:"border-t pt-2",children:l.jsx(n,{variant:"outline",onClick:()=>i(null),className:"button-base w-full border border-gray-300 text-gray-700",children:l.jsx("span",{className:"button-text",children:"ì •ë ¬ í•´ì œ"})})})]})})]}),l.jsx("div",{className:"flex items-center gap-2",children:y?l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(Z,{ref:E,placeholder:"ì „ì²´ ê²€ìƒ‰...",value:t,onChange:e=>d(e.target.value),className:"w-64 business-radius-input button-base border border-gray-300 bg-white text-gray-700"}),l.jsx(n,{variant:"ghost",onClick:()=>{f(!1),d("")},className:"button-base h-8 w-8 p-0",children:l.jsx(c,{className:"w-4 h-4"})})]}):l.jsxs(n,{variant:"outline",onClick:()=>f(!0),className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50",children:[l.jsx(de,{className:"w-4 h-4 mr-1"}),l.jsx("span",{className:"button-text",children:"ê²€ìƒ‰"})]})}),l.jsxs(n,{variant:"outline",onClick:()=>{d(""),r([]),i({field:"created_at",direction:"desc",label:"ìƒì„±ì¼"}),f(!1)},className:"button-base border border-gray-300 bg-white text-blue-600 hover:bg-blue-50 hover:border-blue-300",children:["â†» ",l.jsx("span",{className:"button-text text-blue-600",children:"ì´ˆê¸°í™”"})]})]}),l.jsx("div",{className:"flex items-center gap-2",children:h})]}),e.length>0&&l.jsx("div",{className:"flex flex-wrap gap-2",children:e.map(e=>l.jsxs("span",{className:"badge-stats flex items-center gap-1 bg-blue-50 text-blue-700 border border-blue-200",children:[e.label,e.dateField&&l.jsxs("span",{className:"text-blue-600",children:["(",Ba.find(a=>a.value===e.dateField)?.label,")"]}),": ",e.value,l.jsx(n,{variant:"ghost",size:"sm",onClick:()=>A(e.id),className:"h-4 w-4 p-0 hover:bg-blue-100 ml-1",children:l.jsx(c,{className:"w-3 h-3"})})]},e.id))})]})}const Za=["purchase_manager","app_admin","raw_material_manager","consumable_manager"],Ha=["ì •í¬ì›…"];function Qa(e,a){return t=a,Za.some(e=>t.includes(e))?e:e.filter(e=>!Ha.includes(e.requester_name));var t}const Ga=s.lazy(()=>N(()=>import("./PurchaseItemsModal-DMNgumyX.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]))),Xa=[{key:"pending",label:"ìŠ¹ì¸ëŒ€ê¸°"},{key:"purchase",label:"êµ¬ë§¤ í˜„í™©"},{key:"receipt",label:"ì…ê³  í˜„í™©"},{key:"done",label:"ì „ì²´ í•­ëª©"}];function et({showEmailButton:e=!0}){b();const n=_(),i=r(),[c,d]=s.useState(null),[o,m]=s.useState(!1),[u,p]=s.useState([]),[h,x]=s.useState({field:"created_at",direction:"desc",label:"ìƒì„±ì¼"}),[g,N]=s.useState(""),[C,q]=s.useState([]),[$,S]=s.useState([]),[M,D]=s.useState([]),[P,F]=s.useState([]),{allPurchases:R,loading:T,currentUser:V,getFilteredPurchases:I}=we(),{columnVisibility:L,isLoading:E,applyColumnSettings:A,resetToDefault:O}=(()=>{const[e,t]=s.useState(ke),[l,n]=s.useState(!0),[i,c]=s.useState(null),[,d]=s.useState(0),o=r(),m=s.useCallback(async()=>{try{n(!0),c(null);const{data:{user:e},error:s}=await o.auth.getUser();if(s||!e?.email)return a.warn("[useColumnSettings] ì‚¬ìš©ì ì¸ì¦ ì •ë³´ ì—†ìŒ",{authError:s}),void t(ke);const{data:r,error:l}=await o.from("user_ui_settings").select("setting_value").eq("user_email",e.email).eq("setting_type","column_visibility").eq("setting_key","purchase_list_done").maybeSingle();if(l)return a.error("[useColumnSettings] ì„¤ì • ì¡°íšŒ ì‹¤íŒ¨",l,{userEmail:e.email}),c("ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."),void t(ke);if(r?.setting_value){const s=r.setting_value,l={...ke,...s};t(l),a.debug("[useColumnSettings] ì‚¬ìš©ì ì„¤ì • ë¡œë“œ ì™„ë£Œ",{userEmail:e.email,settingsCount:Object.keys(l).length})}else t(ke),a.debug("[useColumnSettings] ê¸°ë³¸ ì„¤ì • ì‚¬ìš©",{userEmail:e.email})}catch(e){a.error("[useColumnSettings] ì„¤ì • ë¡œë“œ ì¤‘ ì˜ˆì™¸ ë°œìƒ",e),c("ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."),t(ke)}finally{n(!1)}},[o]),u=s.useCallback(async e=>{try{const{data:{user:t},error:s}=await o.auth.getUser();if(s||!t?.email)return void a.warn("[useColumnSettings] ì‚¬ìš©ì ì¸ì¦ ì •ë³´ ì—†ìŒ - ì €ì¥ ì‹¤íŒ¨",{authError:s});const{error:r}=await o.from("user_ui_settings").upsert({user_email:t.email,setting_type:"column_visibility",setting_key:"purchase_list_done",setting_value:e},{onConflict:"user_email,setting_type,setting_key"});if(r)throw a.error("[useColumnSettings] ì„¤ì • ì €ì¥ ì‹¤íŒ¨",r,{userEmail:t.email,settings:e}),r;a.info("[useColumnSettings] ì„¤ì • ì €ì¥ ì„±ê³µ",{userEmail:t.email,settingsCount:Object.keys(e).length,visibleColumns:Object.entries(e).filter(([,e])=>e).length})}catch(t){throw a.error("[useColumnSettings] ì„¤ì • ì €ì¥ ì¤‘ ì˜ˆì™¸ ë°œìƒ",t),t}},[o]),p=s.useCallback(e=>{t(s=>{const r={...s,[e]:!s[e]};return u(r).catch(e=>{t(s),k.error("ì„¤ì • ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."),a.error("[useColumnSettings] í† ê¸€ ì €ì¥ ì‹¤íŒ¨, ë¡¤ë°± ì²˜ë¦¬",e)}),r})},[u]),h=s.useCallback(e=>{a.info("[useColumnSettings] applyColumnSettings í˜¸ì¶œ",{newSettings:e,keys:Object.keys(e),values:Object.values(e)}),t(e),d(e=>e+1),a.info("[useColumnSettings] setColumnVisibility í˜¸ì¶œë¨",{newSettings:e}),u(e).then(()=>{k.success("ì¹¼ëŸ¼ ì„¤ì •ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤."),a.info("[useColumnSettings] DB ì €ì¥ ì„±ê³µ")}).catch(e=>{a.error("[useColumnSettings] ì„¤ì • ì €ì¥ ì‹¤íŒ¨",e),k.error("ì„¤ì • ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")})},[u]),x=s.useCallback(()=>{t(ke),u(ke).catch(e=>{k.error("ê¸°ë³¸ ì„¤ì • ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."),a.error("[useColumnSettings] ê¸°ë³¸ê°’ ì €ì¥ ì‹¤íŒ¨",e)}),k.success("ì¹¼ëŸ¼ ì„¤ì •ì´ ê¸°ë³¸ê°’ìœ¼ë¡œ ì¬ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.")},[u]);return s.useEffect(()=>{m()},[m]),{columnVisibility:e,toggleColumn:p,applyColumnSettings:h,resetToDefault:x,isLoading:l,error:i}})(),W=s.useMemo(()=>!!L&&Object.values(L).some(e=>!e),[L]);s.useEffect(()=>{a.info("[PurchaseListMain] columnVisibility ìƒíƒœ",{columnVisibility:L})},[L]);const U=Array.isArray(V?.purchase_role)?V.purchase_role.map(e=>e.trim()):"string"==typeof V?.purchase_role?V.purchase_role.split(",").map(e=>e.trim()):[],z=V?.name||null,[Y,B]=s.useState(0),[J,K]=s.useState({pending:0,purchase:0,receipt:0,done:0}),Z=s.useCallback(async()=>{a.debug("ğŸ”„ [loadPurchases] ê°•ì œ ìƒˆë¡œê³ ì¹¨ íŠ¸ë¦¬ê±°"),B(e=>e+1)},[]),H=s.useCallback((e,a)=>{y(e,a)},[]),Q=U?.includes("app_admin"),G=s.useMemo(()=>{return(e=U)&&0!==e.length?e.includes("app_admin")||e.includes("ceo")?3:e.includes("consumable_manager")||e.includes("raw_material_manager")||e.includes("purchase_manager")||e.includes("middle_manager")?2:1:1;var e},[U]),X=s.useMemo(()=>{if(!z)return{pending:"all",purchase:"all",receipt:"all",done:"all"};const e=U.includes("hr"),a=U.includes("purchase_manager"),t=U.some(e=>["app_admin","ceo","lead buyer","finance_team","raw_material_manager","consumable_manager","purchase_manager","hr"].includes(e));return{pending:3===G?"all":z,purchase:t||3===G?"all":z,receipt:e||a||3===G?"all":z,done:"all"}},[z,G,U]),ee=(()=>{const e=new URLSearchParams(n.search).get("tab");return e&&["pending","purchase","receipt","done"].includes(e)?e:"pending"})(),[ae,te]=s.useState(ee),[se,re]=s.useState(()=>X[ee]||"all"),[le,ne]=s.useTransition();s.useMemo(()=>Qa(R,U),[R,U]),s.useEffect(()=>{const e=new URLSearchParams(n.search).get("tab");e&&["pending","purchase","receipt","done"].includes(e)&&(te(e),re(X[e]||"all"))},[n.search,X]),s.useEffect(()=>{(async()=>{if(!v()||!t.allPurchases){a.info("ğŸ”„ [PurchaseListMain] ìºì‹œ ë¬´íš¨í™” ê°ì§€, ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì¤‘...",{isCacheValid:v(),hasData:!!t.allPurchases,lastFetch:t.lastFetch});try{await w(V?.id),a.info("âœ… [PurchaseListMain] ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ")}catch(e){a.error("âŒ [PurchaseListMain] ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨:",e)}}})()},[V?.id]),s.useEffect(()=>{(async()=>{try{const{data:e}=await i.from("employees").select("name");if(e){const a=[...new Set(e.map(e=>e.name).filter(Boolean))];q(a)}const{data:a}=await i.from("vendors").select("vendor_name");if(a){const e=[...new Set(a.map(e=>e.vendor_name).filter(Boolean))];S(e)}const{data:t}=await i.from("vendor_contacts").select("contact_name");if(t){const e=[...new Set(t.map(e=>e.contact_name).filter(Boolean))];D(e)}const{data:s}=await i.from("vendors").select("vendor_payment_schedule");if(s){const e=[...new Set(s.map(e=>e.vendor_payment_schedule).filter(Boolean))];F(e)}}catch(e){a.error("í•„í„° ì˜µì…˜ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨",e)}})()},[i]),s.useCallback(e=>e.is_received?l.jsx("span",{className:"badge-stats bg-green-500 text-white",children:"ì…ê³ ì™„ë£Œ"}):"approved"===e.middle_manager_status&&"approved"===e.final_manager_status?l.jsx("span",{className:"badge-stats bg-blue-500 text-white",children:"êµ¬ë§¤ì§„í–‰"}):"rejected"===e.middle_manager_status||"rejected"===e.final_manager_status?l.jsx("span",{className:"badge-stats bg-red-500 text-white",children:"ë°˜ë ¤"}):l.jsx("span",{className:"badge-stats bg-yellow-500 text-white",children:"ìŠ¹ì¸ëŒ€ê¸°"}),[]),s.useCallback((e,a)=>{switch(a){case"purchase_order_number":return e.purchase_order_number;case"payment_category":return e.payment_category;case"requester_name":return e.requester_name;case"vendor_name":return e.vendor_name;case"contact_name":case"payment_schedule":return"-";case"item_name":return e.purchase_request_items?.[0]?.item_name||"";case"specification":return e.purchase_request_items?.[0]?.specification||"";case"quantity":return e.purchase_request_items?.[0]?.quantity||0;case"unit_price_value":return e.purchase_request_items?.[0]?.unit_price_value||0;case"total_amount":return e.total_amount;case"remark":return e.purchase_request_items?.[0]?.remark||"";case"project_vendor":return e.project_vendor;case"project_item":return e.project_item;case"sales_order_number":return e.sales_order_number;case"is_payment_completed":return e.is_payment_completed?"ì™„ë£Œ":"ëŒ€ê¸°";case"is_received":return e.is_received?"ì™„ë£Œ":"ëŒ€ê¸°";case"is_statement_received":return e.is_statement_received?"ì™„ë£Œ":"ëŒ€ê¸°";case"is_utk_checked":return e.is_utk_checked?"ì™„ë£Œ":"ëŒ€ê¸°";case"request_date":return e.request_date;case"delivery_request_date":return e.delivery_request_date;case"payment_completed_at":return e.payment_completed_at;case"received_at":return e.received_at;case"created_at":return e.created_at;case"statement_received_at":return e.purchase_request_items?.[0]?.statement_received_date||null;default:return null}},[]),s.useCallback((e,t,s,r)=>{if(null==e)return"is_empty"===t;if("date_range"===r&&s&&"string"==typeof s&&s.includes("~")){if(!e)return!1;const[a,t]=s.split("~"),r=new Date(e),l=new Date(a),n=new Date(t);return r>=l&&r<=n}if("date_month"===r&&s&&"string"==typeof s&&s.includes("~")){if(!e)return!1;const[a,t]=s.split("~"),r=new Date(e),l=new Date(`${a}-01`),n=new Date(`${t}-01`),i=new Date(n.getFullYear(),n.getMonth()+1,0,23,59,59);return r>=l&&r<=i}if(r&&("date_month"===r||r.endsWith("_month"))){if(!s)return!0;const a=new Date(e),[t,r]=s.split("-");return a.getFullYear()===parseInt(t)&&a.getMonth()+1===parseInt(r)}const l=String(e).toLowerCase(),n=String(s).toLowerCase();switch(t){case"contains":return l.includes(n);case"equals":if("date_range"===r||s.match(/^[0-9]{4}-[0-9]{2}-[0-9]{2}/)){if(!e)return!1;try{const a=new Date(e).toISOString().split("T")[0];return a===s.split("T")[0]}catch(i){return a.error("ë‚ ì§œ ë¹„êµ ì˜¤ë¥˜:",i),!1}}return l===n;case"starts_with":return l.startsWith(n);case"ends_with":return l.endsWith(n);case"is_empty":return!e||""===l.trim();case"is_not_empty":return!!e&&""!==l.trim();case"greater_than":return Number(e)>Number(s);case"less_than":return Number(e)<Number(s);case"between":default:return!0;case"after":return new Date(e)>new Date(s);case"before":return new Date(e)<new Date(s);case"not_equals":return l!==n}},[]);const ie=s.useMemo(()=>I({tab:ae,employeeName:"all"===se||"ì „ì²´"===se?null:se,searchTerm:g,advancedFilters:u,sortConfig:h?{key:h.field,direction:h.direction}:void 0}),[I,ae,se,g,u,h,R]);s.useEffect(()=>{if(R&&R.length>0){const e=je(R,V);K(e)}else if(t.allPurchases&&t.allPurchases.length>0){const e=je(t.allPurchases,V);K(e)}},[R,V]);const de=J,he=s.useCallback(e=>{if("done"===e){return u.length>0?ie.length.toString():"ì „ì²´"}return de[e].toString()},[u.length,ie.length,de]),xe=s.useMemo(()=>{const e=u.filter(e=>"date_month"===e.field||"date_range"===e.field&&e.dateField&&e.dateField.includes("_month"));if(0===e.length)return null;const a=e[0].value;if(a&&"string"==typeof a&&a.includes("~")){const[e,t]=a.split("~"),s=new Date(`${e}-01`),r=new Date(`${t}-01`),l=[];let n=0;const i=new Date(s);for(;i<=r;){const e=i.getFullYear(),a=i.getMonth()+1,t=`${e}-${a.toString().padStart(2,"0")}`,s=ie.filter(t=>{const s=new Date(t.request_date);return s.getFullYear()===e&&s.getMonth()+1===a}),r=s.reduce((e,a)=>{if(a.purchase_request_items?.length){return e+a.purchase_request_items.reduce((e,a)=>e+(a.amount_value||0),0)}return e+(a.total_amount||0)},0);l.push({year:e,month:a,monthStr:t,total:r,count:s.length}),n+=r,i.setMonth(i.getMonth()+1)}return{type:"range",months:l,grandTotal:n}}{const[e,t]=("string"==typeof a?a:"").split("-"),s=ie.filter(a=>{const s=new Date(a.request_date);return s.getFullYear()===parseInt(e)&&s.getMonth()+1===parseInt(t)}),r=s.reduce((e,a)=>{if(a.purchase_request_items?.length){return e+a.purchase_request_items.reduce((e,a)=>e+(a.amount_value||0),0)}return e+(a.total_amount||0)},0);return{type:"single",year:parseInt(e),month:parseInt(t),total:r,count:s.length}}},[u,ie]),ge=s.useCallback(async e=>{try{const t=(new Date).toISOString(),[s,r]=await Promise.all([i.from("purchase_requests").update({is_received:!0,received_at:t}).eq("id",e),i.from("purchase_request_items").update({is_received:!0,delivery_status:"received"}).eq("purchase_request_id",e)]);if(s.error)throw s.error;if(r.error)throw r.error;f(e)||a.warn("[PurchaseListMain] ë©”ëª¨ë¦¬ ìºì‹œ ì…ê³ ì™„ë£Œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨",{purchaseId:e}),k.success("ì…ê³ ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤."),await Z()}catch(t){k.error("ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},[i,Z]),be=s.useCallback(async e=>{try{const t=(new Date).toISOString(),[s,r]=await Promise.all([i.from("purchase_requests").update({is_payment_completed:!0,payment_completed_at:t}).eq("id",e),i.from("purchase_request_items").update({is_payment_completed:!0,payment_completed_at:t}).eq("purchase_request_id",e)]);if(s.error)throw s.error;if(r.error)throw r.error;j(e)||(a.warn("[PurchaseListMain] ë©”ëª¨ë¦¬ ìºì‹œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨, ë°ì´í„° ì¬ë¡œë“œ",{purchaseId:e}),await Z()),k.success("êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.")}catch(t){a.error("[PurchaseListMain] êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ ì‹¤íŒ¨:",t),k.error("ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},[i,Z]);s.useCallback(e=>{d(e),m(!0)},[]);const _e=s.useMemo(()=>c?{...c,vendor_name:c.vendor_name||"",project_vendor:c.project_vendor||"",sales_order_number:c.sales_order_number||"",project_item:c.project_item||""}:null,[c]);return l.jsxs("div",{className:"w-full",children:[l.jsx("div",{className:"mb-4",children:l.jsxs("div",{children:[l.jsx("h1",{className:"page-title",children:"ë°œì£¼ìš”ì²­ ê´€ë¦¬"}),l.jsx("p",{className:"page-subtitle",style:{marginTop:"-2px",marginBottom:"-4px"},children:"Purchase Management"})]})}),l.jsx("div",{className:"mb-3",children:l.jsx(Ka,{activeFilters:u,sortConfig:h,searchTerm:g,onFiltersChange:p,onSortChange:x,onSearchChange:N,availableEmployees:C,availableVendors:$,availableContacts:M,availablePaymentSchedules:P,children:l.jsx($e,{isVisible:!0,columnVisibility:L,applyColumnSettings:A,resetToDefault:O,isLoading:E})})}),l.jsxs("div",{className:"space-y-3",children:[l.jsx("div",{className:"flex flex-col sm:flex-row sm:space-x-1 space-y-1 sm:space-y-0 bg-gray-50 p-1 business-radius-card border border-gray-200",children:Xa.map(e=>l.jsxs("button",{onClick:()=>{ne(()=>{te(e.key),re(X[e.key]||"all")})},className:"flex-1 flex items-center justify-center space-x-2 py-1.5 px-3 sm:px-4 business-radius-button button-text font-medium transition-colors "+(ae===e.key?"text-hansl-600 bg-white shadow-sm border border-gray-200":"text-gray-600 bg-transparent hover:text-gray-900 hover:bg-white/50"),children:[l.jsx("span",{className:"whitespace-nowrap",children:e.label}),l.jsx("span",{className:"badge-stats "+(ae===e.key?"bg-hansl-50 text-hansl-700":"bg-gray-100 text-gray-600"),children:he(e.key)})]},e.key))}),xe&&l.jsx("div",{className:"mb-3",children:"single"===xe.type?l.jsxs("div",{className:"inline-flex items-center gap-2 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 business-radius-badge px-3 py-2 shadow-sm",children:[l.jsxs("div",{className:"flex items-center gap-1.5",children:[l.jsx("div",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full"}),l.jsxs("span",{className:"card-subtitle text-gray-700",children:[xe.year,"ë…„ ",xe.month,"ì›”"]}),l.jsxs("span",{className:"badge-text text-gray-500",children:[xe.count,"ê±´"]})]}),l.jsx("div",{className:"h-4 w-px bg-blue-300"}),l.jsxs("span",{className:"modal-value text-blue-700 font-semibold",children:["â‚©",xe.total?.toLocaleString()||"0"]})]}):l.jsxs(oe,{className:"business-radius-card border border-gray-200 shadow-sm",children:[l.jsx(me,{className:"pb-3 pt-4 px-4",children:l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full"}),l.jsx(ue,{className:"section-title text-gray-800",children:"ì›”ë³„ ë°œì£¼ìš”ì²­ ì´ì•¡"})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsxs("span",{className:"badge-text text-gray-600",children:["(",xe.months?.reduce((e,a)=>e+a.count,0)||0,"ê±´)"]}),l.jsx("div",{className:"h-4 w-px bg-gray-300"}),l.jsxs("span",{className:"modal-value text-gray-500 font-bold",children:["â‚©",xe.grandTotal?.toLocaleString()||"0"]})]})]})}),l.jsx(pe,{className:"px-4 pb-4",children:l.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:xe.months?.map(e=>l.jsx("div",{className:"bg-gray-50 business-radius-card px-3 py-1.5 border border-gray-200 hover:border-blue-300 hover:bg-blue-50 transition-all flex-shrink-0",children:l.jsxs("div",{className:"flex items-baseline gap-1.5",children:[l.jsxs("span",{className:"modal-value font-bold text-gray-800 whitespace-nowrap",children:[e.month,"ì›”"]}),l.jsxs("span",{className:"text-[9px] text-gray-500 whitespace-nowrap",children:["(",e.count,")"]}),l.jsxs("span",{className:"modal-value text-gray-500 font-bold whitespace-nowrap ml-1",children:["â‚©",e.total.toLocaleString()]})]})},e.monthStr))})})]})}),l.jsx(oe,{className:"overflow-hidden border border-gray-200 "+(W?"w-fit":""),children:l.jsx(pe,{className:"p-0",children:T?l.jsxs("div",{className:"flex items-center justify-center py-12",children:[l.jsx("div",{className:"w-8 h-8 border-2 border-hansl-500 border-t-transparent rounded-full animate-spin"}),l.jsx("span",{className:"ml-3 card-subtitle",children:"ë¡œë”© ì¤‘..."})]}):0===ie.length?l.jsxs("div",{className:"text-center py-12",children:[l.jsx(ce,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),l.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"ë°œì£¼ìš”ì²­ì„œê°€ ì—†ìŠµë‹ˆë‹¤"}),l.jsx("p",{className:"card-subtitle",children:"ìƒˆë¡œìš´ ë°œì£¼ìš”ì²­ì„œë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”."})]}):l.jsx(za,{purchases:ie,activeTab:ae,currentUserRoles:U,onRefresh:Z,onOptimisticUpdate:H,onPaymentComplete:be,onReceiptComplete:ge,columnVisibility:L})})})]}),_e&&l.jsx(s.Suspense,{fallback:l.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:l.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"})}),children:l.jsx(Ga,{isOpen:o,onClose:()=>{m(!1),d(null)},purchase:_e,isAdmin:Q||!1,onUpdate:Z,activeTab:ae})})]})}export{et as default};
//# sourceMappingURL=PurchaseListMain-Cmgvego2.js.map
