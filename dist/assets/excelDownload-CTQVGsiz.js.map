{"version":3,"mappings":"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","names":["formatDate","formatDateISO","getCurrencySymbol","currency","includes","async","generatePurchaseOrderExcelJS","data","workbook","__vitePreload","import","then","n","e","__VITE_PRELOAD__","Workbook","sheet","addWorksheet","pageSetup","paperSize","orientation","fitToPage","fitToWidth","fitToHeight","horizontalCentered","verticalCentered","margins","left","right","top","bottom","header","footer","getRow","height","r","eachCell","cell","font","name","size","mergeCells","response","fetch","arrayBuffer","imageId","addImage","buffer","extension","dWidth","getColumn","width","logoWidth","Math","max","logoHeight","logoCol","logoRow","tl","col","row","ext","_e","getCell","value","alignment","horizontal","vertical","indent","bold","vendor_payment_schedule","vendor_name","vendor_contact_name","request_date","vendor_phone","vendor_fax","delivery_request_date","requester_name","purchase_order_number","tableHeaders","i","length","String","fromCharCode","sortedItems","items","sort","a","b","line_number","itemRows","sumRow","item","rowIdx","bCell","item_name","specification","quantity","unitSymbol","unitWithCurrency","unit_price_value","toLocaleString","trim","amountSymbol","amountWithCurrency","amount_value","gCell","remark","wrapText","shrinkToFit","c","totalSymbol","totalAmount","reduce","sum","lastRow","cellAddr","isItemRow","border","style","currentBorder","sumCellBorder","Object","entries","A","B","C","D","E","F","G","forEach","xlsx","writeBuffer","Blob","type","supabase","createClient","downloadPurchaseOrderExcel","purchase","currentUserRoles","onSuccessCallback","purchaseRequest","error","requestError","from","select","eq","single","toast","orderItems","itemsError","order","vendorInfo","vendorId","vendor_id","contactId","contact_id","vendorData","vendorError","contactData","contactError","contact_name","excelData","project_vendor","sales_order_number","project_item","map","blob","downloadFilename","url","window","URL","createObjectURL","document","createElement","href","download","body","appendChild","click","removeChild","revokeObjectURL","success","downloadFlagErr","update","is_po_download","flagErr"],"ignoreList":[],"sources":["../../src/utils/exceljs/generatePurchaseOrderExcel.ts","../../src/utils/excelDownload.ts"],"sourcesContent":["// hanslwebapp과 동일한 코드 기반 Excel 생성\nimport { formatDateISO } from '@/utils/helpers';\n\nexport interface PurchaseOrderData {\n  purchase_order_number: string;\n  request_date: string;\n  delivery_request_date: string;\n  requester_name: string;\n  vendor_name: string;\n  vendor_contact_name?: string;\n  vendor_phone?: string;\n  vendor_fax?: string;\n  project_vendor: string;\n  sales_order_number: string;\n  project_item: string;\n  items: PurchaseOrderItem[];\n  vendor_payment_schedule?: string;\n}\n\nexport interface PurchaseOrderItem {\n  line_number: number;\n  item_name: string;\n  specification: string;\n  quantity: number;\n  unit_price_value: number;\n  amount_value: number;\n  remark: string;\n  currency: string;\n}\n\nconst formatDate = formatDateISO;\n\n// Helper: currency code to symbol\nfunction getCurrencySymbol(currency: string) {\n  if (!currency) return '';\n  if (['KRW', '원', '₩'].includes(currency)) return '₩';\n  if (['USD', '$', '달러'].includes(currency)) return '$';\n  if (['EUR', '€'].includes(currency)) return '€';\n  if (['JPY', '엔', '¥'].includes(currency)) return '¥';\n  if (['CNY', '위안', '元'].includes(currency)) return '¥';\n  return currency;\n}\n\n/**\n * 엑셀 발주서 생성 (ExcelJS) - hanslwebapp과 동일한 방식\n * @param data PurchaseOrderData\n * @returns Blob (xlsx)\n */\nexport async function generatePurchaseOrderExcelJS(data: PurchaseOrderData): Promise<Blob> {\n  // ExcelJS를 동적으로 import하여 초기 번들 크기 감소\n  const ExcelJS = await import('exceljs');\n  const workbook = new ExcelJS.Workbook();\n  \n  const sheet = workbook.addWorksheet('발주서', {\n    pageSetup: {\n      paperSize: 9, // A4\n      orientation: 'portrait',\n      fitToPage: true,\n      fitToWidth: 1,\n      fitToHeight: 1,\n      horizontalCentered: true,\n      verticalCentered: true,\n      margins: {\n        left: 0.3,\n        right: 0.3,\n        top: 0.5,\n        bottom: 0.5,\n        header: 0.2,\n        footer: 0.2\n      }\n    }\n  });\n\n  // 행 높이 고정: 1행 39.75px(≈29.8pt), 2행부터 18px(≈13.5pt)\n  sheet.getRow(1).height = 29.8; // 39.75px\n  for (let r = 2; r <= 60; r++) {\n    sheet.getRow(r).height = 15.75; // 21px≈15.75pt\n  }\n  // 폰트 기본값: 맑은고딕, 크기 11 (2행부터), 1행은 20\n  // 1행\n  sheet.getRow(1).eachCell(cell => {\n    cell.font = { ...(cell.font || {}), name: '맑은 고딕', size: 20 };\n  });\n\n  // 나머지 행 기본 폰트 설정 (필요시 뒤에서 개별 셀에서 다시 bold 지정)\n  for (let r = 2; r <= 60; r++) {\n    sheet.getRow(r).eachCell(cell => {\n      cell.font = { ...(cell.font || {}), name: '맑은 고딕', size: 11 };\n    });\n  }\n\n  // 1. 병합 범위 템플릿과 1:1 적용\n  sheet.mergeCells('A1:G1');\n  sheet.mergeCells('A2:B2'); sheet.mergeCells('C2:D2'); sheet.mergeCells('F2:G2');\n  sheet.mergeCells('A3:B3'); sheet.mergeCells('C3:D3'); sheet.mergeCells('F3:G3');\n  sheet.mergeCells('A4:B4'); sheet.mergeCells('C4:D4'); sheet.mergeCells('F4:G4');\n  sheet.mergeCells('A5:B5'); sheet.mergeCells('C5:D5'); sheet.mergeCells('F5:G5');\n  sheet.mergeCells('A6:B6'); sheet.mergeCells('C6:D6'); sheet.mergeCells('F6:G6');\n  sheet.mergeCells('A7:B7'); sheet.mergeCells('C7:D7'); sheet.mergeCells('F7:G7');\n  // 8~46행(헤더/품목/합계) 병합 없음\n  // 합계가 들어가는 행에 맞춰 병합 범위도 동적으로 이동\n  // (아래에서 sumRow 계산 후 병합)\n\n  try {\n    const response = await fetch('/logo_KOR.png');\n    const arrayBuffer = await response.arrayBuffer();\n    const imageId = workbook.addImage({\n      buffer: arrayBuffer,\n      extension: 'png',\n    });\n    // 로고(이모티콘)는 너비 0.58col, '발주서' 글자 바로 왼쪽에 딱 붙게 배치\n    // D열 width가 undefined/null/0이면 기본값 22로 대체\n    const dWidth = sheet.getColumn('D').width || 22;\n    const logoWidth = Math.max(1, dWidth * 7.2 * 0.58) + 4; // 기존보다 4px 더 크게\n    const logoHeight = 30 + 4; // 기존 30에서 4px 더 크게\n    // D1 셀 중앙(3.5, 0.5)에서 왼쪽 2px(0.28col), 위로 2px(0.13row) 이동\n    const logoCol = 3.5 - 0.50;\n    const logoRow = 0.5 - 0.20;\n    sheet.addImage(imageId, {\n      tl: { col: logoCol, row: logoRow }, // D1 셀 중앙에서 왼쪽 2px, 위로 2px 이동\n      ext: { width: logoWidth, height: logoHeight },\n    });\n  } catch (_e) {\n    // Logo loading failed, continue without logo\n  }\n\n  // 2. 제목 (B1:H1 병합, 중앙정렬)\n  sheet.getCell('D1').value = '                발 주 서';\n  sheet.getCell('D1').alignment = { horizontal: 'left', vertical: 'middle', indent: 1 };\n  sheet.getCell('D1').font = { bold: true, size: 20 };\n\n  // 3. 상단 정보 고정 라벨 적용 (공백 포함)\n  sheet.getCell('A2').value = '업   체   명';\n  sheet.getCell('A2').font = { bold: true };\n  sheet.getCell('A3').value = '담   당   자';\n  sheet.getCell('A3').font = { bold: true };\n  sheet.getCell('A4').value = '청   구   일';\n  sheet.getCell('A4').font = { bold: true };\n  sheet.getCell('A5').value = 'TEL.';\n  sheet.getCell('A5').font = { bold: true };\n  sheet.getCell('A6').value = 'FAX.';\n  sheet.getCell('A6').font = { bold: true };\n  sheet.getCell('A7').value = '입고요청일';\n  sheet.getCell('A7').font = { bold: true };\n\n  sheet.getCell('E2').value = '구매요청자';\n  sheet.getCell('E2').font = { bold: true };\n  sheet.getCell('E3').value = '주         소';\n  sheet.getCell('E3').font = { bold: true };\n  sheet.getCell('E4').value = '발 주 번 호';\n  sheet.getCell('E4').font = { bold: true };\n  sheet.getCell('E5').value = 'TEL.';\n  sheet.getCell('E5').font = { bold: true };\n  sheet.getCell('E6').value = 'FAX.';\n  sheet.getCell('E6').font = { bold: true };\n  sheet.getCell('E7').value = '지출 예정일';\n  sheet.getCell('E7').font = { bold: true };\n\n  sheet.getCell('F7').value = data.vendor_payment_schedule || '';\n\n  // 데이터 매핑(예시)\n  sheet.getCell('C2').value = data.vendor_name;\n  sheet.getCell('C3').value = data.vendor_contact_name || '';\n  sheet.getCell('C4').value = formatDate(data.request_date);\n  sheet.getCell('C5').value = data.vendor_phone || '';\n  sheet.getCell('C6').value = data.vendor_fax || '';\n  sheet.getCell('C7').value = formatDate(data.delivery_request_date);\n\n  sheet.getCell('F2').value = data.requester_name;\n  sheet.getCell('F3').value = '대구광역시 달서구 성서공단북로305';\n  sheet.getCell('F4').value = data.purchase_order_number;\n  sheet.getCell('F5').value = '(053) 626-7805';\n  sheet.getCell('F6').value = '(053) 657-7905';\n  sheet.getCell('F5').alignment = { horizontal: 'center', vertical: 'middle' };\n  sheet.getCell('F6').alignment = { horizontal: 'center', vertical: 'middle' };\n\n  // 8행: 테이블 헤더\n  const tableHeaders = ['No', '품명', '규격', '수량', '단가', '금액', '비고'];\n  for (let i = 0; i < tableHeaders.length; i++) {\n    sheet.getCell(String.fromCharCode(65 + i) + '8').value = tableHeaders[i];\n    sheet.getCell(String.fromCharCode(65 + i) + '8').font = { bold: true };\n    if(i===6){\n       sheet.getCell('G8').alignment = { horizontal:'center', vertical:'middle' };\n    }\n  }\n\n  // 품목이 45개를 넘으면 아래로 밀어서 합계/하단 정보 출력\n  const baseRow = 9;\n  const minRows = 45;\n  // --- 품목 데이터 line_number 기준 정렬 ---\n  const sortedItems = [...data.items].sort((a, b) => a.line_number - b.line_number);\n  const itemRows = sortedItems.length;\n  const sumRow = baseRow + Math.max(itemRows, minRows); // 합계 위치\n\n  // 품목 데이터\n  for (let i = 0; i < sortedItems.length; i++) {\n    const item = sortedItems[i];\n    const rowIdx = baseRow + i;\n    sheet.getCell('A' + rowIdx).value = item.line_number;\n    const bCell = sheet.getCell('B' + rowIdx);\n    bCell.value = item.item_name;\n    bCell.alignment = { horizontal: 'left', vertical: 'middle' };\n    sheet.getCell('C' + rowIdx).value = item.specification;\n    sheet.getCell('C' + rowIdx).alignment = { horizontal: 'left', vertical: 'middle' };\n    sheet.getCell('D' + rowIdx).value = item.quantity;\n    // 단가(E열) - 통화 기호 포함\n    const unitSymbol = getCurrencySymbol(item.currency);\n    const unitWithCurrency = (item.unit_price_value !== undefined && item.unit_price_value !== null)\n      ? `${item.unit_price_value.toLocaleString()} ${unitSymbol}`.trim()\n      : '';\n    sheet.getCell('E' + rowIdx).value = unitWithCurrency;\n    sheet.getCell('E' + rowIdx).alignment = { horizontal: 'right', vertical: 'middle' };\n\n    // 금액(F열) - 통화 기호 포함\n    const amountSymbol = getCurrencySymbol(item.currency);\n    const amountWithCurrency = (item.amount_value !== undefined && item.amount_value !== null)\n      ? `${item.amount_value.toLocaleString()} ${amountSymbol}`.trim()\n      : '';\n    sheet.getCell('F' + rowIdx).value = amountWithCurrency;\n    sheet.getCell('F' + rowIdx).alignment = { horizontal: 'right', vertical: 'middle' };\n    // G열은 비워둠\n    const gCell = sheet.getCell('G' + rowIdx);\n    gCell.value = (item.remark !== undefined && item.remark !== null) ? String(item.remark) : '';\n    gCell.alignment = { horizontal: 'left', vertical: 'middle', wrapText: false, shrinkToFit: true };\n  }\n\n  // 품목이 45개보다 적으면 빈 행 추가\n  for (let i = itemRows; i < minRows; i++) {\n    const rowIdx = baseRow + i;\n    for (let c = 0; c < 7; c++) {\n      sheet.getCell(String.fromCharCode(65 + c) + rowIdx).value = '';\n    }\n  }\n\n  // 합계\n  sheet.mergeCells(`A${sumRow}:E${sumRow}`);\n  sheet.getCell('A' + sumRow).value = '합계';\n  sheet.getCell('A' + sumRow).font = { bold: true };\n  const totalSymbol = getCurrencySymbol(data.items[0]?.currency);\n  const totalAmount = data.items.reduce((sum, item) => sum + (item.amount_value || 0), 0);\n  sheet.getCell('F' + sumRow).value = `${totalAmount.toLocaleString()} ${totalSymbol}`.trim();\n  sheet.getCell('F' + sumRow).alignment = { horizontal: 'right', vertical: 'middle' };\n\n  // 실제 마지막 데이터가 들어간 행까지 동적으로 테두리 적용 (합계까지만)\n  const lastRow = sumRow;\n  for (let r = 1; r <= lastRow; r++) {\n    for (let c = 1; c <= 7; c++) {\n      const col = String.fromCharCode(64 + c); // A~G\n      const cellAddr = col + r;\n      const cell = sheet.getCell(cellAddr);\n      // E(5), F(6)열의 품목 데이터 행(단가/금액)과 합계행, C(3)열의 품목 데이터 행(규격)은 alignment를 덮어쓰지 않음\n      const isPriceCol = (c === 5 || c === 6);\n      const isSpecCol = (c === 3);\n      const isItemRow = (r >= baseRow && r < sumRow);\n      const isSumRow = (r === sumRow);\n      if (!((isPriceCol && (isItemRow || isSumRow)) || (isSpecCol && isItemRow))) {\n        // 나머지 셀만 중앙 정렬\n        cell.alignment = { horizontal: 'center', vertical: 'middle' };\n      }\n      // 기존 스타일: 2행/8행/합계행(sumRow) 위, 8행 아래, 마지막행만 굵은선\n      cell.border = {\n        top:    { style: (r === 1) ? 'medium' : (r === 2 || r === 8 || r === sumRow) ? 'medium' : 'thin' },\n        left:   { style: c === 1 ? 'medium' : 'thin' },\n        right:  { style: c === 7 ? 'medium' : 'thin' },\n        bottom: { style: (r === 8 || r === sumRow || r === lastRow) ? 'medium' : 'thin' }\n      };\n    }\n  }\n  // 규격(C열) 입력란(품목 데이터 행)은 마지막에 좌측 정렬로 덮어쓴다\n  for (let i = 0; i < itemRows; i++) {\n    const rowIdx = baseRow + i;\n    sheet.getCell('C' + rowIdx).alignment = { horizontal: 'left', vertical: 'middle' };\n  }\n\n  // B2:B7, D2:D7, E2:E6 오른쪽 테두리 굵게\n  for (let r = 2; r <= 7; r++) {\n    sheet.getCell('B' + r).border = {\n      ...sheet.getCell('B' + r).border,\n      right: { style: 'medium' }\n    };\n    sheet.getCell('D' + r).border = {\n      ...sheet.getCell('D' + r).border,\n      right: { style: 'medium' }\n    };\n    if (r <= 6) {\n      sheet.getCell('E' + r).border = {\n        ...sheet.getCell('E' + r).border,\n        right: { style: 'medium' }\n      };\n    }\n  }\n  // E7, G7 위쪽 테두리 일반(얇게)\n  sheet.getCell('E7').border = {\n    ...sheet.getCell('E7').border,\n    top: { style: 'thin' },\n    right: { style: 'medium' }\n  };\n  sheet.getCell('G7').border = {\n    ...sheet.getCell('G7').border,\n    top: { style: 'thin' }\n  };\n\n  // A1~A7 왼쪽 테두리 굵게 명시적 설정 (덮어쓰기 방지)\n  for (let r = 1; r <= 7; r++) {\n    const currentBorder = sheet.getCell('A' + r).border || {};\n    sheet.getCell('A' + r).border = {\n      ...currentBorder,\n      left: { style: 'medium' }\n    };\n  }\n\n  // 합계 행(A열) 왼쪽 테두리 굵게 명시적 설정\n  const sumCellBorder = sheet.getCell('A' + sumRow).border || {};\n  sheet.getCell('A' + sumRow).border = {\n    ...sumCellBorder,\n    left: { style: 'medium' }\n  };\n\n  // 열 너비 (템플릿 기준)\n  const colWidths = { A:4.7, B:23, C:30, D:11, E:15, F:16, G:37 };\n  Object.entries(colWidths).forEach(([col, width]) => {\n    sheet.getColumn(col).width = width;\n  });\n\n  /* -----------------------------------\n      최종 행 높이/폰트 일괄 적용\n      1행 : 39.75pt\n      2행~lastRow : 18pt\n  ----------------------------------- */\n  sheet.getRow(1).height = 29.8; // 39.75px≈29.8pt\n  sheet.getRow(1).eachCell(c => { c.font = { ...(c.font || {}), name: '맑은 고딕', size: 20 }; });\n\n  for (let r = 2; r <= lastRow; r++) {\n    const row = sheet.getRow(r);\n    row.height = 15.75; // 21px≈15.75pt\n    row.eachCell(c => {\n      c.font = { ...(c.font || {}), name: '맑은 고딕', size: 11 };\n    });\n  }\n\n  // G열 전체 좌측 정렬 및 자동 줄바꿈 보장\n  for (let r = 9; r <= lastRow; r++) {\n    sheet.getCell('G' + r).alignment = { horizontal: 'left', vertical: 'middle', wrapText: false, shrinkToFit: true };\n    sheet.getCell('B' + r).alignment = { horizontal: 'left', vertical: 'middle' };\n  }\n\n  // 9. 파일 생성\n  const buffer = await workbook.xlsx.writeBuffer();\n  return new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });\n}","// 공통 Excel 다운로드 유틸리티 - 관리탭과 대시보드에서 공유\nimport { createClient } from '@/lib/supabase/client'\n\nconst supabase = createClient()\nimport { generatePurchaseOrderExcelJS } from '@/utils/exceljs/generatePurchaseOrderExcel'\nimport type { PurchaseOrderData } from '@/utils/exceljs/generatePurchaseOrderExcel'\nimport { toast } from 'sonner'\n\nexport interface Purchase {\n  id?: number\n  purchase_order_number: string\n  vendor_name: string\n  vendor_id?: string\n  contact_id?: string\n}\n\n/**\n * 공통 Excel 다운로드 함수 - 관리탭과 대시보드 모두에서 사용\n * 관리탭의 handleExcelDownload 로직을 그대로 유틸리티로 분리\n */\nexport const downloadPurchaseOrderExcel = async (\n  purchase: Purchase, \n  currentUserRoles?: string[],\n  onSuccessCallback?: () => void\n) => {\n  try {\n    // DB에서 직접 모든 품목 조회\n    const { data: purchaseRequest, error: requestError } = await supabase\n      .from('purchase_requests')\n      .select('*')\n      .eq('purchase_order_number', purchase.purchase_order_number)\n      .single();\n\n    if (requestError || !purchaseRequest) {\n      toast.error('해당 발주요청번호의 데이터를 찾을 수 없습니다.');\n      return;\n    }\n\n    // 품목 데이터 조회\n    const { data: orderItems, error: itemsError } = await supabase\n      .from('purchase_request_items')\n      .select('*')\n      .eq('purchase_order_number', purchase.purchase_order_number)\n      .order('line_number');\n\n    if (itemsError || !orderItems || orderItems.length === 0) {\n      toast.error('해당 발주요청번호의 품목 데이터를 찾을 수 없습니다.');\n      return;\n    }\n\n    // 업체 상세 정보 및 담당자 정보 조회\n    const vendorInfo = {\n      vendor_name: purchase.vendor_name,\n      vendor_phone: '',\n      vendor_fax: '',\n      vendor_contact_name: ''\n    };\n\n    try {\n      const vendorId = purchaseRequest.vendor_id || purchase.vendor_id;\n      const contactId = purchaseRequest.contact_id || purchase.contact_id;\n      \n      // vendor 정보 조회\n      if (vendorId) {\n        const { data: vendorData, error: vendorError } = await supabase\n          .from('vendors')\n          .select('vendor_phone, vendor_fax')\n          .eq('id', vendorId)\n          .single();\n\n        if (vendorData && !vendorError) {\n          vendorInfo.vendor_phone = vendorData.vendor_phone || '';\n          vendorInfo.vendor_fax = vendorData.vendor_fax || '';\n        }\n      }\n\n      // vendor_contacts에서 contact_id로 담당자 정보 조회\n      if (contactId) {\n        const { data: contactData, error: contactError } = await supabase\n          .from('vendor_contacts')\n          .select('contact_name, contact_phone, contact_email')\n          .eq('id', contactId)\n          .single();\n        if (contactData && !contactError) {\n          vendorInfo.vendor_contact_name = contactData.contact_name || '';\n        }\n      }\n    } catch (error) {\n      // 업체 정보 조회 실패 시에도 계속 진행\n    }\n\n    const excelData: PurchaseOrderData = {\n      purchase_order_number: purchaseRequest.purchase_order_number || '',\n      request_date: purchaseRequest.request_date,\n      delivery_request_date: purchaseRequest.delivery_request_date,\n      requester_name: purchaseRequest.requester_name,\n      vendor_name: vendorInfo.vendor_name || '',\n      vendor_contact_name: vendorInfo.vendor_contact_name,\n      vendor_phone: vendorInfo.vendor_phone,\n      vendor_fax: vendorInfo.vendor_fax,\n      project_vendor: purchaseRequest.project_vendor,\n      sales_order_number: purchaseRequest.sales_order_number,\n      project_item: purchaseRequest.project_item,\n      items: orderItems.map((item: any) => ({\n        line_number: item.line_number,\n        item_name: item.item_name,\n        specification: item.specification,\n        quantity: item.quantity,\n        unit_price_value: item.unit_price_value,\n        amount_value: item.amount_value,\n        remark: item.remark,\n        currency: purchaseRequest.currency || 'KRW'\n      }))\n    };\n\n    // 코드 기반 ExcelJS 생성 (템플릿 없이 서식 직접 정의)\n    const blob = await generatePurchaseOrderExcelJS(excelData);\n    \n    // 다운로드용 파일명: 발주서_{업체명}_발주요청번호\n    const downloadFilename = `발주서_${excelData.vendor_name}_${excelData.purchase_order_number}.xlsx`;\n\n    // 사용자에게 즉시 다운로드 제공\n    const url = window.URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = downloadFilename;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    window.URL.revokeObjectURL(url);\n    \n    toast.success('엑셀 파일이 다운로드되었습니다.');\n    \n    // DB에 다운로드 완료 플래그(is_po_download) 업데이트 - lead buyer만 해당\n    try {\n      const isLeadBuyer = currentUserRoles && currentUserRoles.includes('lead buyer');\n\n      if (isLeadBuyer) {\n        const { error: downloadFlagErr } = await supabase\n          .from('purchase_requests')\n          .update({ is_po_download: true })\n          .eq('purchase_order_number', purchase.purchase_order_number);\n        \n        if (!downloadFlagErr) {\n          // 성공 콜백 실행 (UI 업데이트용)\n          onSuccessCallback?.();\n        }\n      }\n    } catch (flagErr) {\n      // 플래그 업데이트 실패는 무시하고 계속 진행\n    }\n  } catch (error) {\n    console.error('❌ Excel 다운로드 실패:', error);\n    toast.error('엑셀 다운로드에 실패했습니다.');\n    throw error;\n  }\n};"],"file":"assets/excelDownload-CTQVGsiz.js"}