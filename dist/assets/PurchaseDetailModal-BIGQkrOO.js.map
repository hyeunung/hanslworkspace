{"version":3,"file":"PurchaseDetailModal-BIGQkrOO.js","sources":["../../node_modules/lucide-react/dist/esm/icons/truck.js","../../src/components/ui/date-picker-popover.tsx","../../src/hooks/useConfirmDateAction.ts","../../src/components/purchase/PurchaseDetailModal.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2\", key: \"wrbu53\" }],\n  [\"path\", { d: \"M15 18H9\", key: \"1lyqi6\" }],\n  [\n    \"path\",\n    {\n      d: \"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14\",\n      key: \"lysw3i\"\n    }\n  ],\n  [\"circle\", { cx: \"17\", cy: \"18\", r: \"2\", key: \"332jqn\" }],\n  [\"circle\", { cx: \"7\", cy: \"18\", r: \"2\", key: \"19iecd\" }]\n];\nconst Truck = createLucideIcon(\"truck\", __iconNode);\n\nexport { __iconNode, Truck as default };\n//# sourceMappingURL=truck.js.map\n","import { useState } from 'react'\nimport { Calendar } from '@/components/ui/calendar'\nimport { Button } from '@/components/ui/button'\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from '@/components/ui/popover'\nimport { Calendar as CalendarIcon } from 'lucide-react'\nimport { format } from 'date-fns'\nimport { ko } from 'date-fns/locale'\nimport { cn } from '@/lib/utils'\nimport { logger } from '@/lib/logger'\n\ninterface DatePickerPopoverProps {\n  children: React.ReactNode\n  onDateSelect: (date: Date) => void\n  disabled?: boolean\n  placeholder?: string\n  align?: \"center\" | \"start\" | \"end\"\n  side?: \"top\" | \"right\" | \"bottom\" | \"left\"\n}\n\nexport function DatePickerPopover({\n  children,\n  onDateSelect,\n  disabled = false,\n  placeholder = \"ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”\",\n  align = \"center\",\n  side = \"bottom\"\n}: DatePickerPopoverProps) {\n  const [open, setOpen] = useState(false)\n\n  const handleDateSelect = (date: Date | undefined) => {\n    logger.debug('ğŸ“… DatePickerPopover handleDateSelect í˜¸ì¶œ:', { \n      date, \n      isToday: date && new Date().toDateString() === date.toDateString(),\n      dateString: date?.toDateString(),\n      todayString: new Date().toDateString()\n    });\n    if (date) {\n      logger.debug('âœ… ë‚ ì§œ ì„ íƒë¨, onDateSelect í˜¸ì¶œ ì˜ˆì •');\n      onDateSelect(date)\n      setOpen(false) // ë‚ ì§œ ì„ íƒ í›„ íŒì˜¤ë²„ ë‹«ê¸°\n      logger.debug('ğŸ”š DatePickerPopover ì²˜ë¦¬ ì™„ë£Œ');\n    } else {\n      logger.debug('âŒ ë‚ ì§œê°€ undefinedì„');\n    }\n  }\n\n  return (\n    <Popover open={open} onOpenChange={setOpen}>\n      <PopoverTrigger asChild disabled={disabled}>\n        {children}\n      </PopoverTrigger>\n      <PopoverContent \n        className=\"w-auto p-0 border-gray-200 shadow-lg\" \n        align={align}\n        side={side}\n        sideOffset={8}\n      >\n        <div className=\"bg-white business-radius-card p-2\">\n          <div className=\"mb-2 px-1\">\n            <div className=\"modal-label text-gray-600 text-center\">\n              {placeholder}\n            </div>\n          </div>\n          <Calendar\n            mode=\"single\"\n            selected={undefined}\n            onSelect={(date) => {\n              logger.debug('ğŸ—“ï¸ Calendar onSelect ì§ì ‘ í˜¸ì¶œ:', { \n                date, \n                isToday: date && new Date().toDateString() === date.toDateString(),\n                dateValue: date?.getTime(),\n                todayValue: new Date().getTime()\n              });\n              handleDateSelect(date);\n            }}\n            locale={ko}\n            initialFocus\n            className=\"compact-calendar\"\n            disabled={false}\n            fromDate={new Date('2020-01-01')}\n            toDate={new Date('2030-12-31')}\n            defaultMonth={new Date()}\n            modifiers={{\n              today: new Date()\n            }}\n            modifiersClassNames={{\n              today: \"bg-blue-500 text-white font-semibold cursor-pointer hover:bg-blue-600 rounded-md\"\n            }}\n          />\n        </div>\n      </PopoverContent>\n    </Popover>\n  )\n}","import { useCallback } from 'react'\nimport { createClient } from '@/lib/supabase/client'\nimport { toast } from 'sonner'\nimport { logger } from '@/lib/logger'\nimport { markItemAsReceived, markItemAsReceiptCanceled, markItemAsStatementReceived, markItemAsStatementCanceled } from '@/stores/purchaseMemoryStore'\n\nexport interface ConfirmDateActionConfig {\n  field: 'statement_received' | 'actual_received'\n  confirmMessage: {\n    confirm: string\n    cancel: string\n  }\n  successMessage: {\n    confirm: string\n    cancel: string\n  }\n  completedText: string\n  waitingText: string\n}\n\nexport interface UseConfirmDateActionProps {\n  config: ConfirmDateActionConfig\n  currentUserName: string | null\n  canPerformAction: boolean\n  purchaseId?: number | string  // ë©”ëª¨ë¦¬ ìºì‹œ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•œ purchase ID\n  onUpdate?: () => void\n  onOptimisticUpdate?: (params: {\n    itemId: number\n    selectedDate?: Date\n    action: 'confirm' | 'cancel'\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n    }\n  }) => void\n}\n\nexport function useConfirmDateAction({\n  config,\n  currentUserName,\n  canPerformAction,\n  purchaseId,\n  onUpdate,\n  onOptimisticUpdate\n}: UseConfirmDateActionProps) {\n  const supabase = createClient()\n\n  const handleConfirm = useCallback(async (\n    itemId: number | string,\n    selectedDate: Date,\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n    }\n  ) => {\n    \n    if (!canPerformAction) {\n      logger.warn(`âŒ ê¶Œí•œ ì—†ìŒ`, { canPerformAction, currentUserName })\n      toast.error(`${config.field === 'statement_received' ? 'ê±°ë˜ëª…ì„¸ì„œ' : 'ì…ê³ '} í™•ì¸ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.`)\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      logger.error('âŒ ì˜ëª»ëœ ID', { itemId, numericId })\n      toast.error('ìœ íš¨í•˜ì§€ ì•Šì€ í•­ëª© ID ì…ë‹ˆë‹¤.')\n      return\n    }\n\n    // í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ\n    if (itemInfo) {\n      const confirmMessage = `í’ˆëª©ëª…: ${itemInfo.item_name || '-'}\nê·œê²©: ${itemInfo.specification || '-'}\nìˆ˜ëŸ‰: ${itemInfo.quantity?.toLocaleString() || 0}\në‹¨ê°€: â‚©${itemInfo.unit_price_value?.toLocaleString() || 0}\ní•©ê³„: â‚©${itemInfo.amount_value?.toLocaleString() || 0}\në¹„ê³ : ${itemInfo.remark || '-'}\n\n${config.confirmMessage.confirm}`\n      \n      if (!window.confirm(confirmMessage)) {\n        return\n      }\n    }\n\n    try {\n      let updateData: any\n\n      if (config.field === 'statement_received') {\n        updateData = {\n          is_statement_received: true,\n          statement_received_date: selectedDate.toISOString(),\n          statement_received_by_name: currentUserName\n        }\n      } else if (config.field === 'actual_received') {\n        updateData = {\n          actual_received_date: selectedDate.toISOString(),\n          is_received: true\n        }\n      }\n\n      logger.debug('ğŸ“ ì—…ë°ì´íŠ¸í•  ë°ì´í„°:', updateData)\n\n      const { data, error } = await supabase\n        .from('purchase_request_items')\n        .update(updateData)\n        .eq('id', numericId)\n        .select()\n\n      logger.debug('ğŸ“ DB ì—…ë°ì´íŠ¸ ê²°ê³¼:', { data, error })\n\n      if (error) {\n        logger.error('âŒ DB ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', error)\n        throw error\n      }\n\n      logger.info('âœ… DB ì—…ë°ì´íŠ¸ ì„±ê³µ', data)\n\n      // ğŸš€ ë©”ëª¨ë¦¬ ìºì‹œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸\n      if (purchaseId) {\n        if (config.field === 'actual_received') {\n          const memoryUpdated = markItemAsReceived(purchaseId, numericId, selectedDate.toISOString())\n          if (!memoryUpdated) {\n            logger.warn('[useConfirmDateAction] ë©”ëª¨ë¦¬ ìºì‹œ ì…ê³ ì™„ë£Œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { \n              purchaseId, \n              itemId: numericId \n            })\n          }\n        } else if (config.field === 'statement_received') {\n          const memoryUpdated = markItemAsStatementReceived(purchaseId, numericId, selectedDate.toISOString(), currentUserName || undefined)\n          if (!memoryUpdated) {\n            logger.warn('[useConfirmDateAction] ë©”ëª¨ë¦¬ ìºì‹œ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { \n              purchaseId, \n              itemId: numericId \n            })\n          }\n        }\n      }\n\n      if (onOptimisticUpdate) {\n        onOptimisticUpdate({\n          itemId: numericId,\n          selectedDate,\n          action: 'confirm',\n          itemInfo\n        })\n      }\n\n      // ê°•ì œ ìƒˆë¡œê³ ì¹¨ì„ ìœ„í•´ onUpdate í˜¸ì¶œ\n      if (onUpdate) {\n        onUpdate()\n      }\n      \n      toast.success(config.successMessage.confirm)\n    } catch (error) {\n      logger.error('âŒ ì „ì²´ ì²˜ë¦¬ ì‹¤íŒ¨', error)\n      toast.error(`${config.field === 'statement_received' ? 'ê±°ë˜ëª…ì„¸ì„œ' : 'ì…ê³ '} í™•ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.`)\n    }\n  }, [config, currentUserName, canPerformAction, purchaseId, onUpdate, onOptimisticUpdate, supabase])\n\n  const handleCancel = useCallback(async (\n    itemId: number | string,\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n    }\n  ) => {\n    if (!canPerformAction) {\n      logger.warn(`âŒ ì·¨ì†Œ ê¶Œí•œ ì—†ìŒ`, { canPerformAction, currentUserName })\n      toast.error(`${config.field === 'statement_received' ? 'ê±°ë˜ëª…ì„¸ì„œ' : 'ì…ê³ '} í™•ì¸ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.`)\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      toast.error('ìœ íš¨í•˜ì§€ ì•Šì€ í•­ëª© ID ì…ë‹ˆë‹¤.')\n      return\n    }\n\n    // í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ\n    if (itemInfo) {\n      const confirmMessage = `í’ˆëª©ëª…: ${itemInfo.item_name || '-'}\nê·œê²©: ${itemInfo.specification || '-'}\nìˆ˜ëŸ‰: ${itemInfo.quantity?.toLocaleString() || 0}\në‹¨ê°€: â‚©${itemInfo.unit_price_value?.toLocaleString() || 0}\ní•©ê³„: â‚©${itemInfo.amount_value?.toLocaleString() || 0}\në¹„ê³ : ${itemInfo.remark || '-'}\n\n${config.confirmMessage.cancel}`\n      \n      if (!window.confirm(confirmMessage)) {\n        return\n      }\n    }\n\n    try {\n      logger.debug(`ğŸ”„ ${config.field} í™•ì¸ ì·¨ì†Œ ì‹œì‘`, { \n        itemId, \n        itemName: itemInfo?.item_name \n      })\n\n      let updateData: any\n\n      if (config.field === 'statement_received') {\n        updateData = {\n          is_statement_received: false,\n          statement_received_date: null,\n          statement_received_by_name: null\n        }\n      } else if (config.field === 'actual_received') {\n        updateData = {\n          actual_received_date: null,\n          is_received: false\n        }\n      }\n\n      logger.debug('ğŸ”„ ì·¨ì†Œ ì—…ë°ì´íŠ¸í•  ë°ì´í„°:', updateData)\n\n      const { data, error } = await supabase\n        .from('purchase_request_items')\n        .update(updateData)\n        .eq('id', numericId)\n        .select()\n\n      logger.debug('ğŸ”„ ì·¨ì†Œ DB ì—…ë°ì´íŠ¸ ê²°ê³¼:', { data, error })\n\n      if (error) {\n        logger.error('âŒ DB ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', error)\n        throw error\n      }\n\n      logger.info(`âœ… ${config.field} í™•ì¸ ì·¨ì†Œ ì„±ê³µ`, data)\n\n      // ğŸš€ ë©”ëª¨ë¦¬ ìºì‹œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸\n      if (purchaseId) {\n        if (config.field === 'actual_received') {\n          const memoryUpdated = markItemAsReceiptCanceled(purchaseId, numericId)\n          if (!memoryUpdated) {\n            logger.warn('[useConfirmDateAction] ë©”ëª¨ë¦¬ ìºì‹œ ì…ê³ ì·¨ì†Œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { \n              purchaseId, \n              itemId: numericId \n            })\n          }\n        } else if (config.field === 'statement_received') {\n          const memoryUpdated = markItemAsStatementCanceled(purchaseId, numericId)\n          if (!memoryUpdated) {\n            logger.warn('[useConfirmDateAction] ë©”ëª¨ë¦¬ ìºì‹œ ê±°ë˜ëª…ì„¸ì„œ ì·¨ì†Œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { \n              purchaseId, \n              itemId: numericId \n            })\n          }\n        }\n      }\n\n      if (onOptimisticUpdate) {\n        onOptimisticUpdate({\n          itemId: numericId,\n          action: 'cancel',\n          itemInfo\n        })\n      }\n\n      // ê°•ì œ ìƒˆë¡œê³ ì¹¨ì„ ìœ„í•´ onUpdate í˜¸ì¶œ\n      if (onUpdate) {\n        onUpdate()\n      }\n      \n      toast.success(config.successMessage.cancel)\n    } catch (error) {\n      logger.error(`âŒ ${config.field} í™•ì¸ ì·¨ì†Œ ì‹¤íŒ¨`, error)\n      toast.error(`${config.field === 'statement_received' ? 'ê±°ë˜ëª…ì„¸ì„œ' : 'ì…ê³ '} í™•ì¸ ì·¨ì†Œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.`)\n    }\n  }, [config, canPerformAction, purchaseId, onUpdate, onOptimisticUpdate, supabase])\n\n  const isCompleted = useCallback((item: any) => {\n    if (config.field === 'statement_received') {\n      return item.is_statement_received\n    } else if (config.field === 'actual_received') {\n      return item.is_received // actual_received_date ëŒ€ì‹  is_received í•„ë“œ ì‚¬ìš©\n    }\n    return false\n  }, [config.field])\n\n  const getCompletedDate = useCallback((item: any) => {\n    if (config.field === 'statement_received') {\n      return item.statement_received_date\n    } else if (config.field === 'actual_received') {\n      return item.actual_received_date\n    }\n    return null\n  }, [config.field])\n\n  const getCompletedByName = useCallback((item: any) => {\n    if (config.field === 'statement_received') {\n      return item.statement_received_by_name\n    } else if (config.field === 'actual_received') {\n      // ì…ê³ ì™„ë£ŒëŠ” ì²˜ë¦¬ì ì •ë³´ë¥¼ ê¸°ë¡í•˜ì§€ ì•ŠìŒ\n      return null\n    }\n    return null\n  }, [config.field])\n\n  return {\n    config,\n    handleConfirm,\n    handleCancel,\n    isCompleted,\n    getCompletedDate,\n    getCompletedByName\n  }\n}","import { useEffect, useState, useRef, useCallback, useMemo, memo } from 'react'\nimport { createClient } from '@/lib/supabase/client'\nimport { PurchaseRequestWithDetails, Purchase, Vendor } from '@/types/purchase'\nimport { findPurchaseInMemory, markItemAsPaymentCompleted, markPurchaseAsPaymentCompleted, markItemAsReceived, markPurchaseAsReceived, markItemAsPaymentCanceled, markItemAsStatementReceived, markItemAsStatementCanceled, markItemAsUtkChecked, usePurchaseMemory, updatePurchaseInMemory, removeItemFromMemory } from '@/stores/purchaseMemoryStore'\nimport { formatDate } from '@/utils/helpers'\nimport { DatePickerPopover } from '@/components/ui/date-picker-popover'\nimport { \n  Calendar, \n  User, \n  Building2, \n  Package, \n  CreditCard,\n  X,\n  FileText,\n  DollarSign,\n  Edit2,\n  Trash2,\n  Save,\n  Plus,\n  CheckCircle,\n  XCircle,\n  Check,\n  Truck\n} from 'lucide-react'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog'\nimport { toast } from 'sonner'\nimport { logger } from '@/lib/logger'\nimport { useConfirmDateAction } from '@/hooks/useConfirmDateAction'\nimport { format as formatDateInput } from 'date-fns'\n\ninterface PurchaseDetailModalProps {\n  purchaseId: number | null\n  isOpen: boolean\n  onClose: () => void\n  embedded?: boolean  // Dialog ì—†ì´ ë‚´ìš©ë§Œ ë Œë”ë§\n  currentUserRoles?: string[]\n  activeTab?: string\n  onRefresh?: (forceRefresh?: boolean, options?: { silent?: boolean }) => void | Promise<void>\n  onOptimisticUpdate?: (purchaseId: number, updater: (prev: Purchase) => Purchase) => void\n  onDelete?: (purchase: PurchaseRequestWithDetails) => void\n}\n\nfunction PurchaseDetailModal({ \n  purchaseId, \n  isOpen, \n  onClose, \n  embedded = false,\n  currentUserRoles = [],\n  activeTab,\n  onRefresh,\n  onOptimisticUpdate,\n  onDelete\n}: PurchaseDetailModalProps) {\n  const { allPurchases } = usePurchaseMemory(); // ğŸš€ ë©”ëª¨ë¦¬ ìºì‹œ ì‹¤ì‹œê°„ ë™ê¸°í™”\n  \n  const [loading, setLoading] = useState(false)\n  const [purchase, setPurchase] = useState<PurchaseRequestWithDetails | null>(null)\n  const [isEditing, setIsEditing] = useState(false)\n  const [editedPurchase, setEditedPurchase] = useState<PurchaseRequestWithDetails | null>(null)\n  const [editedItems, setEditedItems] = useState<any[]>([])\n  const [deletedItemIds, setDeletedItemIds] = useState<number[]>([])\n  const [userRoles, setUserRoles] = useState<string[]>([])\n  const [currentUserName, setCurrentUserName] = useState<string>('')\n  const [columnWidths, setColumnWidths] = useState<number[]>([])\n  const [focusedInput, setFocusedInput] = useState<string | null>(null)\n  \n  // ë©”ëª¨ë¦¬ ìºì‹œ ë™ê¸°í™”ëŠ” useEffectì—ì„œ ì²˜ë¦¬\n\n  // ğŸš€ ì‹¤ì‹œê°„ items ë°ì´í„° (ë©”ëª¨ë¦¬ ìºì‹œì—ì„œ ìµœì‹  ë°ì´í„° ì‚¬ìš©)\n  // ë©”ëª¨ë¦¬ ìºì‹œì™€ ë™ì¼í•œ ë¡œì§ ì‚¬ìš©: items ìš°ì„ , ì—†ìœ¼ë©´ purchase_request_items\n  const currentItems = useMemo(() => {\n    if (!purchaseId || !allPurchases) {\n      const purchaseItems = (purchase?.items && purchase.items.length > 0) ? purchase.items : (purchase?.purchase_request_items || []);\n      return purchaseItems;\n    }\n    \n    const memoryPurchase = allPurchases.find(p => p.id === purchaseId);\n    if (memoryPurchase) {\n      // ğŸš€ ë©”ëª¨ë¦¬ ìºì‹œì™€ ë™ì¼í•œ ë¡œì§: items ìš°ì„ , ì—†ìœ¼ë©´ purchase_request_items\n      return (memoryPurchase.items && memoryPurchase.items.length > 0) ? memoryPurchase.items : (memoryPurchase.purchase_request_items || []);\n    }\n    \n    const purchaseItems = (purchase?.items && purchase.items.length > 0) ? purchase.items : (purchase?.purchase_request_items || []);\n    return purchaseItems;\n  }, [purchaseId, allPurchases, purchase?.items, purchase?.purchase_request_items]);\n\n  const tableMinWidth = useMemo(() => {\n    if (columnWidths.length > 0) {\n      const columnGap = columnWidths.length > 1 ? (columnWidths.length - 1) * 12 : 0\n      const padding = 48\n      const total = columnWidths.reduce((sum, width) => sum + width, 0) + columnGap + padding\n      return Math.max(total, 720)\n    }\n\n    const baseColumns: number[] = [120, 140, 80, 110, 130, 110, 120]\n\n    if (activeTab === 'purchase') {\n      baseColumns.push(120)\n    }\n\n    if (activeTab === 'receipt' || activeTab === 'done') {\n      baseColumns.push(120)\n    }\n\n    if (activeTab === 'receipt') {\n      baseColumns.push(140)\n    }\n\n    if (activeTab === 'done') {\n      baseColumns.push(140, 140, 110)\n    }\n\n    if (isEditing) {\n      baseColumns.push(110)\n    }\n\n    const columnGap = baseColumns.length > 1 ? (baseColumns.length - 1) * 12 : 0\n    const total = baseColumns.reduce((sum, width) => sum + width, 0) + columnGap + 48\n    return Math.max(total, 720)\n  }, [columnWidths, activeTab, isEditing])\n  const headerRowRef = useRef<HTMLDivElement>(null)\n  const supabase = createClient()\n  \n  // ì‚¬ìš©ì ê¶Œí•œ ë° ì´ë¦„ ì§ì ‘ ë¡œë“œ\n  useEffect(() => {\n    const loadUserRoles = async () => {\n      try {\n        // Supabase í™˜ê²½ ë³€ìˆ˜ í™•ì¸\n        const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\n        const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;\n        \n        if (!supabaseUrl || !supabaseAnonKey || supabaseUrl.includes('placeholder')) {\n          logger.warn('Supabase í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•ŠìŒ - PurchaseDetailModal');\n          return;\n        }\n\n        const { data: { user } } = await supabase.auth.getUser()\n        if (user) {\n          // ë¨¼ì € IDë¡œ ì‹œë„\n          let { data: employeeData } = await supabase\n            .from('employees')\n            .select('*')\n            .eq('id', user.id)\n            .maybeSingle()\n          \n          // IDë¡œ ëª» ì°¾ì•˜ìœ¼ë©´ ì´ë©”ì¼ë¡œ ì‹œë„\n          if (!employeeData && user.email) {\n            const { data: employeeByEmail } = await supabase\n              .from('employees')\n              .select('*')\n              .eq('email', user.email)\n              .maybeSingle()\n            \n            employeeData = employeeByEmail\n          }\n          \n          // ì‚¬ìš©ì ì´ë¦„ ì €ì¥\n          if (employeeData?.name) {\n            setCurrentUserName(employeeData.name)\n          }\n          \n          if (employeeData?.purchase_role) {\n            let roles: string[] = []\n            if (Array.isArray(employeeData.purchase_role)) {\n              roles = employeeData.purchase_role.map((r: any) => String(r).trim())\n            } else {\n              const roleString = String(employeeData.purchase_role)\n              roles = roleString\n                .split(',')\n                .map((r: string) => r.trim())\n                .filter((r: string) => r.length > 0)\n            }\n            setUserRoles(roles)\n          }\n        }\n      } catch (error) {\n      }\n    }\n    \n    if (isOpen) {\n      loadUserRoles()\n    }\n  }, [isOpen])\n  \n  // currentUserRolesê°€ ë°°ì—´ì´ ì•„ë‹ˆë©´ userRoles ì‚¬ìš©\n  const effectiveRoles = Array.isArray(currentUserRoles) && currentUserRoles.length > 0 \n    ? currentUserRoles \n    : userRoles\n  \n  // ê¶Œí•œ ì²´í¬\n  // ì „ì²´ ìˆ˜ì • ê¶Œí•œ (ëª¨ë“  í•„ë“œ ìˆ˜ì • ê°€ëŠ¥)\n  const canEditAll = effectiveRoles.includes('final_approver') || \n                     effectiveRoles.includes('app_admin') || \n                     effectiveRoles.includes('ceo')\n  \n  // lead buyer ì œí•œì  ìˆ˜ì • ê¶Œí•œ (ê¸ˆì•¡/ìˆ˜ëŸ‰ë§Œ ìˆ˜ì • ê°€ëŠ¥)\n  const canEditLimited = effectiveRoles.includes('lead buyer')\n  \n  // í†µí•© ìˆ˜ì • ê¶Œí•œ (ë‘˜ ì¤‘ í•˜ë‚˜ë¼ë„ ìˆìœ¼ë©´ ìˆ˜ì • ëª¨ë“œ í™œì„±í™”)\n  const canEdit = canEditAll || canEditLimited\n  \n  // ì‚­ì œ ê¶Œí•œ: ê´€ë¦¬ì ë˜ëŠ” ìš”ì²­ì ë³¸ì¸ (ë‹¨, ìŠ¹ì¸ëœ ìš”ì²­ì€ ê´€ë¦¬ìë§Œ, lead buyerëŠ” ì‚­ì œ ë¶ˆê°€)\n  const isApproved = purchase?.final_manager_status === 'approved';\n  const canDelete = isApproved \n    ? canEditAll  // ìŠ¹ì¸ëœ ìš”ì²­ì€ ê´€ë¦¬ìë§Œ ì‚­ì œ ê°€ëŠ¥ (lead buyer ì œì™¸)\n    : (canEditAll || (purchase?.requester_name === currentUserName))  // ë¯¸ìŠ¹ì¸ë„ lead buyer ì œì™¸\n  \n  // êµ¬ë§¤ ê¶Œí•œ ì²´í¬: app_admin + lead buyerë§Œ (ìš”ì²­ì ë³¸ì¸ ì œì™¸)\n  const canPurchase = effectiveRoles.includes('app_admin') || \n                     effectiveRoles.includes('lead buyer') || \n                     effectiveRoles.includes('lead buyer')\n  \n  // ì…ê³  ê¶Œí•œ ì²´í¬ \n  // 1. ê´€ë¦¬ìëŠ” ëª¨ë“  ê±´ ì…ê³  ì²˜ë¦¬ ê°€ëŠ¥\n  // 2. ìš”ì²­ìëŠ” ìì‹ ì˜ ìš”ì²­ê±´ë§Œ ì…ê³  ì²˜ë¦¬ ê°€ëŠ¥\n  const canReceiveItems = effectiveRoles.includes('app_admin') || \n                         (purchase?.requester_name === currentUserName)\n  // 2. ì¼ë°˜ ì§ì›ì€ ë³¸ì¸ì´ ìš”ì²­í•œ ê±´ë§Œ ì…ê³  ì²˜ë¦¬ ê°€ëŠ¥\n  const isAdmin = effectiveRoles.includes('final_approver') || \n                  effectiveRoles.includes('app_admin') || \n                  effectiveRoles.includes('ceo')\n  const isRequester = purchase?.requester_name === currentUserName\n  \n  // ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ & UTK í™•ì¸ ê¶Œí•œ: app_adminê³¼ lead buyerë§Œ ê°€ëŠ¥\n  const canReceiptCheck = effectiveRoles.includes('app_admin') || \n                         effectiveRoles.includes('lead buyer')\n  \n\n  // ëª¨ë‹¬ ë‚´ë¶€ ë°ì´í„°ë§Œ ìƒˆë¡œê³ ì¹¨í•˜ëŠ” í•¨ìˆ˜ (ëª¨ë‹¬ ë‹«ì§€ ì•ŠìŒ)\n  const refreshModalData = useCallback(async () => {\n    if (!purchaseId) return\n    \n    try {\n      // ğŸš€ ë©”ëª¨ë¦¬ì—ì„œ ë¨¼ì € ì°¾ê¸° (ì¦‰ì‹œ ìƒˆë¡œê³ ì¹¨)\n      const memoryPurchase = findPurchaseInMemory(purchaseId)\n      if (memoryPurchase) {\n        \n        // items í•„ë“œ ì •ê·œí™”: purchase_request_itemsë¥¼ itemsë¡œ ë³µì‚¬\n        const normalizedItems = (memoryPurchase.items && memoryPurchase.items.length > 0)\n          ? memoryPurchase.items \n          : (memoryPurchase.purchase_request_items || [])\n        \n        // ë©”ëª¨ë¦¬ ë°ì´í„°ë¥¼ PurchaseRequestWithDetails í˜•íƒœë¡œ ë³€í™˜\n        const purchaseData = {\n          ...memoryPurchase,\n          id: String(memoryPurchase.id), // PurchaseRequestëŠ” idê°€ string\n          is_po_generated: false, // Purchase íƒ€ì…ì—ëŠ” ì—†ì§€ë§Œ PurchaseRequestì— í•„ìˆ˜\n          items: normalizedItems, // ì •ê·œí™”ëœ items ì‚¬ìš©\n          purchase_request_items: normalizedItems, // í•˜ìœ„ í˜¸í™˜ì„±ì„ ìœ„í•´ ì–‘ìª½ ëª¨ë‘ ì„¤ì •\n          vendor: {\n            id: memoryPurchase.vendor_id,\n            vendor_name: memoryPurchase.vendor_name || 'ì•Œ ìˆ˜ ì—†ìŒ',\n            is_active: true\n          } as Vendor,\n          vendor_contacts: []\n        } as PurchaseRequestWithDetails\n        \n        setPurchase(purchaseData)\n        setEditedPurchase(purchaseData)\n        setEditedItems(normalizedItems.length > 0 ? normalizedItems : [])\n        return\n      }\n      \n      // ë©”ëª¨ë¦¬ì— ì—†ëŠ” ê²½ìš°ì—ë§Œ DBì—ì„œ ë¡œë“œ (fallback)\n      const supabase = createClient()\n      // ìµœì‹  êµ¬ë§¤ ìš”ì²­ ë°ì´í„° ë¡œë“œ\n      const { data, error } = await supabase\n        .from('purchase_requests')\n        .select(`\n          *,\n          vendors(id, vendor_name),\n          purchase_request_items(*)\n        `)\n        .eq('id', purchaseId)\n        .single()\n      \n      if (error) throw error\n\n      if (data) {\n        // ë¼ì¸ë„˜ë²„ ìˆœì„œëŒ€ë¡œ ì •ë ¬\n        const sortedItems = (data.purchase_request_items || []).sort((a: any, b: any) => {\n          const lineA = a.line_number || 999999;\n          const lineB = b.line_number || 999999;\n          return lineA - lineB;\n        });\n\n        const purchaseData = {\n          ...data,\n          items: sortedItems,\n          vendor: data.vendors || { id: 0, vendor_name: 'ì•Œ ìˆ˜ ì—†ìŒ' },\n          vendor_contacts: []\n        } as PurchaseRequestWithDetails\n\n        setPurchase(purchaseData)\n        setEditedPurchase(purchaseData)\n        setEditedItems(sortedItems)\n      }\n    } catch (error) {\n      logger.error('ëª¨ë‹¬ ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨', error)\n    }\n  }, [purchaseId])\n\n  // ğŸš€ ë©”ëª¨ë¦¬ ìºì‹œ ë³€ê²½ ì‹¤ì‹œê°„ ê°ì§€ ë° ëª¨ë‹¬ ë°ì´í„° ë™ê¸°í™”\n  useEffect(() => {\n    if (!purchaseId || !allPurchases || !purchase) return;\n\n    const memoryPurchase = allPurchases.find(p => p.id === purchaseId);\n    if (memoryPurchase) {\n      // ë©”ëª¨ë¦¬ ë°ì´í„°ë¡œ purchase state ì—…ë°ì´íŠ¸ (ê¹œë¹¡ì„ ì—†ì´ ì‹¤ì‹œê°„ ë°˜ì˜)\n      const normalizedItems = (memoryPurchase.items && memoryPurchase.items.length > 0) \n        ? memoryPurchase.items \n        : (memoryPurchase.purchase_request_items || []);\n      \n      const updatedPurchase = {\n        ...purchase,\n        ...memoryPurchase,\n        id: String(memoryPurchase.id),\n        items: normalizedItems,\n        purchase_request_items: normalizedItems\n      } as PurchaseRequestWithDetails;\n\n      setPurchase(updatedPurchase);\n      setEditedPurchase(updatedPurchase);\n      setEditedItems(normalizedItems.length > 0 ? normalizedItems : []);\n    }\n  }, [allPurchases]); // purchase?.id ì œê±°í•´ì„œ ë¬´í•œë£¨í”„ ë°©ì§€, allPurchases ë³€ê²½ë§Œ ê°ì§€\n\n  // ğŸš€ ëª¨ë‹¬ì´ ì—´ë¦´ ë•Œë§ˆë‹¤ ë©”ëª¨ë¦¬ì—ì„œ ìµœì‹  ë°ì´í„° ê°•ì œ ë™ê¸°í™”\n  useEffect(() => {\n    if (!isOpen || !purchaseId || !allPurchases) return;\n\n    const memoryPurchase = allPurchases.find(p => p.id === purchaseId);\n    if (memoryPurchase) {\n      const normalizedItems = (memoryPurchase.items && memoryPurchase.items.length > 0) \n        ? memoryPurchase.items \n        : (memoryPurchase.purchase_request_items || []);\n      \n      const updatedPurchase = {\n        ...memoryPurchase,\n        id: String(memoryPurchase.id),\n        is_po_generated: false,\n        items: normalizedItems,\n        purchase_request_items: normalizedItems,\n        vendor: {\n          id: memoryPurchase.vendor_id,\n          vendor_name: memoryPurchase.vendor_name || 'ì•Œ ìˆ˜ ì—†ìŒ',\n          is_active: true\n        } as Vendor,\n        vendor_contacts: []\n      } as PurchaseRequestWithDetails;\n\n      setPurchase(updatedPurchase);\n      setEditedPurchase(updatedPurchase);\n      setEditedItems(normalizedItems.length > 0 ? normalizedItems : []);\n    }\n  }, [isOpen, purchaseId, allPurchases]); // ëª¨ë‹¬ì´ ì—´ë¦´ ë•Œë§ˆë‹¤ ì‹¤í–‰\n  \n  // ì»´í¬ë„ŒíŠ¸ê°€ ë§ˆìš´íŠ¸ë  ë•Œ ì™¸ë¶€ ìƒˆë¡œê³ ì¹¨ì„ ë°©ì§€í•˜ëŠ” í”Œë˜ê·¸\n  const [isInitialLoad, setIsInitialLoad] = useState(true)\n  \n  // ì»¤ìŠ¤í…€ í›… ì„¤ì •\n  const purchaseIdNumber = purchaseId ? Number(purchaseId) : (purchase ? Number(purchase.id) : NaN)\n\n  const handleActualReceiptOptimisticUpdate = useCallback(({ itemId, selectedDate, action }: {\n    itemId: number\n    selectedDate?: Date\n    action: 'confirm' | 'cancel'\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n    }\n  }) => {\n    const itemIdStr = String(itemId)\n    const nowIso = new Date().toISOString()\n    const selectedDateIso = selectedDate ? selectedDate.toISOString() : undefined\n\n    const updateItems = (items?: any[]) => {\n      if (!items) return items\n      return items.map(item => {\n        if (String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_received: true,\n            actual_received_date: selectedDateIso,\n            received_at: nowIso\n          }\n        }\n\n        return {\n          ...item,\n          is_received: false,\n          actual_received_date: undefined,\n          received_at: undefined\n        }\n      })\n    }\n\n    setPurchase(prev => {\n      if (!prev) return prev\n      const updatedItems = updateItems(prev.items) || []\n      const total = updatedItems.length\n      const completed = updatedItems.filter(item => item.is_received).length\n      const allReceived = total > 0 && completed === total\n\n      return {\n        ...prev,\n        items: updatedItems,\n        is_received: allReceived,\n        received_at: allReceived ? (prev.received_at || nowIso) : undefined\n      }\n    })\n\n    setEditedPurchase(prev => {\n      if (!prev) return prev\n      const updatedItems = updateItems(prev.items) || []\n      return {\n        ...prev,\n        items: updatedItems\n      }\n    })\n\n    setEditedItems(prevItems => {\n      if (!prevItems || prevItems.length === 0) return prevItems\n      return prevItems.map(item => {\n        if (!item.id || String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_received: true,\n            actual_received_date: selectedDateIso,\n            received_at: nowIso\n          }\n        }\n\n        return {\n          ...item,\n          is_received: false,\n          actual_received_date: undefined,\n          received_at: undefined\n        }\n      })\n    })\n\n    if (!Number.isNaN(purchaseIdNumber)) {\n      onOptimisticUpdate?.(purchaseIdNumber, prevPurchase => {\n        const updatedItems = updateItems(prevPurchase.items) || prevPurchase.items || []\n        const total = updatedItems.length || prevPurchase.items?.length || 0\n        const completed = updatedItems.filter(item => item.is_received).length\n        const allReceived = total > 0 && completed === total\n\n        return {\n          ...prevPurchase,\n          items: updatedItems,\n          is_received: allReceived,\n          received_at: allReceived ? (prevPurchase.received_at || nowIso) : undefined\n        }\n      })\n    }\n  }, [onOptimisticUpdate, purchaseIdNumber])\n\n  const handleStatementReceivedOptimisticUpdate = useCallback(({ itemId, selectedDate, action }: {\n    itemId: number\n    selectedDate?: Date\n    action: 'confirm' | 'cancel'\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n    }\n  }) => {\n    const itemIdStr = String(itemId)\n    const selectedDateIso = selectedDate ? selectedDate.toISOString() : undefined\n\n    let nextAllCompleted = false\n    let nextStatementAt: string | null = null\n\n    setPurchase(prev => {\n      if (!prev) return prev\n\n      const updatedItems = (prev.items || []).map(item => {\n        if (String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_statement_received: true,\n            statement_received_date: selectedDateIso,\n            statement_received_by_name: currentUserName\n          }\n        }\n\n        return {\n          ...item,\n          is_statement_received: false,\n          statement_received_date: null,\n          statement_received_by_name: null\n        }\n      })\n\n      nextAllCompleted = updatedItems.length > 0 && updatedItems.every(item => item.is_statement_received)\n      nextStatementAt = nextAllCompleted\n        ? (selectedDateIso || prev.statement_received_at || new Date().toISOString())\n        : null\n\n      return {\n        ...prev,\n        items: updatedItems,\n        is_statement_received: nextAllCompleted,\n        statement_received_at: nextStatementAt\n      }\n    })\n\n    setEditedPurchase(prev => {\n      if (!prev) return prev\n\n      const updatedItems = (prev.items || []).map(item => {\n        if (String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_statement_received: true,\n            statement_received_date: selectedDateIso,\n            statement_received_by_name: currentUserName\n          }\n        }\n\n        return {\n          ...item,\n          is_statement_received: false,\n          statement_received_date: null,\n          statement_received_by_name: null\n        }\n      })\n\n      return {\n        ...prev,\n        items: updatedItems,\n        is_statement_received: nextAllCompleted,\n        statement_received_at: nextStatementAt\n      }\n    })\n\n    setEditedItems(prevItems => {\n      if (!prevItems) return prevItems\n      return prevItems.map(item => {\n        if (String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_statement_received: true,\n            statement_received_date: selectedDateIso,\n            statement_received_by_name: currentUserName\n          }\n        }\n\n        return {\n          ...item,\n          is_statement_received: false,\n          statement_received_date: null,\n          statement_received_by_name: null\n        }\n      })\n    })\n\n    if (!Number.isNaN(purchaseIdNumber)) {\n      onOptimisticUpdate?.(purchaseIdNumber, prevPurchase => {\n        const updatedItems = (prevPurchase.items || []).map(item => {\n          if (String(item.id) !== itemIdStr) return item\n\n          if (action === 'confirm') {\n            return {\n              ...item,\n              is_statement_received: true,\n              statement_received_date: selectedDateIso,\n              statement_received_by_name: currentUserName\n            }\n          }\n\n          return {\n            ...item,\n            is_statement_received: false,\n            statement_received_date: null,\n            statement_received_by_name: null\n          }\n        })\n\n        const allCompleted = updatedItems.length > 0 && updatedItems.every(item => item.is_statement_received)\n\n        return {\n          ...prevPurchase,\n          items: updatedItems,\n          is_statement_received: allCompleted\n        }\n      })\n    }\n\n    // purchase_requests ë ˆë²¨ í”Œë˜ê·¸ë„ ì—…ë°ì´íŠ¸\n    if (purchase && nextAllCompleted !== undefined) {\n      const supabase = createClient()\n      supabase\n        .from('purchase_requests')\n        .update({\n          is_statement_received: nextAllCompleted,\n          statement_received_at: nextStatementAt\n        })\n        .eq('id', purchase.id)\n        .then(({ error }: { error: any }) => {\n          if (error) {\n            logger.error('ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ purchase_requests ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', error)\n          }\n        })\n    }\n  }, [currentUserName, onOptimisticUpdate, purchaseIdNumber, purchase])\n\n  const statementReceivedAction = useConfirmDateAction({\n    config: {\n      field: 'statement_received',\n      confirmMessage: {\n        confirm: 'ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ì„ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?',\n        cancel: 'ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?'\n      },\n      successMessage: {\n        confirm: 'ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.',\n        cancel: 'ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.'\n      },\n      completedText: 'âœ“ ì™„ë£Œ',\n      waitingText: 'ëŒ€ê¸°'\n    },\n    currentUserName,\n    canPerformAction: canReceiptCheck,\n    purchaseId: purchase?.id,\n    onUpdate: refreshModalData,\n    onOptimisticUpdate: handleStatementReceivedOptimisticUpdate\n  })\n\n  const actualReceivedAction = useConfirmDateAction({\n    config: {\n      field: 'actual_received',\n      confirmMessage: {\n        confirm: 'ì‹¤ì œ ì…ê³  ì²˜ë¦¬ë¥¼ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?',\n        cancel: 'ì‹¤ì œ ì…ê³  ì²˜ë¦¬ë¥¼ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?'\n      },\n      successMessage: {\n        confirm: 'ì‹¤ì œ ì…ê³  ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.',\n        cancel: 'ì‹¤ì œ ì…ê³  ì²˜ë¦¬ê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.'\n      },\n      completedText: 'ì…ê³ ì™„ë£Œ',\n      waitingText: 'ì…ê³ ëŒ€ê¸°'\n    },\n    currentUserName,\n    canPerformAction: canReceiptCheck,\n    purchaseId: purchase?.id,\n    onUpdate: refreshModalData,\n    onOptimisticUpdate: handleActualReceiptOptimisticUpdate\n  })\n  \n  // ë‚ ì§œ ì„ íƒ í•¸ë“¤ëŸ¬ë“¤\n  \n  \n  // ìŠ¹ì¸ ê¶Œí•œ ì²´í¬\n const canApproveMiddle = effectiveRoles.includes('middle_manager') || \n                          effectiveRoles.includes('app_admin') || \n                          effectiveRoles.includes('ceo')\n \n const canApproveFinal = effectiveRoles.includes('final_approver') || \n                         effectiveRoles.includes('app_admin') || \n                         effectiveRoles.includes('ceo')\n \n const approvalPillClass = 'inline-flex items-center gap-1 business-radius-badge px-2 py-0.5 badge-text leading-tight'\n const approvalButtonClass = 'inline-flex items-center gap-1 business-radius-badge !h-auto !min-h-0 !px-2.5 !py-0.5 badge-text leading-tight'\n const approvalWaitingPillClass = 'inline-flex items-center gap-1 business-radius-badge px-2.5 py-0.5 badge-text leading-tight'\n \n \n  useEffect(() => {\n    if (purchaseId && isOpen) {\n      // ğŸš€ ë©”ëª¨ë¦¬ì—ì„œ ì¦‰ì‹œ ë°ì´í„° í™•ì¸ í›„ ë¡œë“œ\n      const memoryPurchase = findPurchaseInMemory(purchaseId)\n      if (memoryPurchase) {\n        // ë©”ëª¨ë¦¬ì— ìˆìœ¼ë©´ ì¦‰ì‹œ ë¡œë“œ (loading ìƒíƒœ ì—†ìŒ)\n        const purchaseData = {\n          ...memoryPurchase,\n          id: String(memoryPurchase.id), // PurchaseRequestëŠ” idê°€ string\n          is_po_generated: false, // Purchase íƒ€ì…ì—ëŠ” ì—†ì§€ë§Œ PurchaseRequestì— í•„ìˆ˜\n          vendor: {\n            id: memoryPurchase.vendor_id,\n            vendor_name: memoryPurchase.vendor_name || 'ì•Œ ìˆ˜ ì—†ìŒ',\n            is_active: true\n          } as Vendor,\n          vendor_contacts: []\n        } as PurchaseRequestWithDetails\n        \n        setPurchase(purchaseData)\n        setEditedPurchase(purchaseData)\n        setEditedItems(memoryPurchase.items || [])\n      } else {\n        // ë©”ëª¨ë¦¬ì— ì—†ìœ¼ë©´ ê¸°ì¡´ ë°©ì‹ìœ¼ë¡œ ë¡œë“œ\n        loadPurchaseDetail(purchaseId.toString())\n      }\n      setIsEditing(false) // ëª¨ë‹¬ ì—´ ë•Œë§ˆë‹¤ í¸ì§‘ ëª¨ë“œ ì´ˆê¸°í™”\n    }\n  }, [purchaseId, isOpen])\n\n  // ì¹¼ëŸ¼ ë„ˆë¹„ ê³„ì‚° (í…ìŠ¤íŠ¸ ê¸¸ì´ ê¸°ë°˜)\n  const calculateOptimalColumnWidths = useCallback(() => {\n    if (!purchase?.purchase_request_items || purchase.purchase_request_items.length === 0) return []\n\n    const items = purchase.purchase_request_items ?? []\n\n    const columnConfigs = [\n      { key: 'item_name', minWidth: 80, maxWidth: 500, baseWidth: 80 },\n      { key: 'specification', minWidth: 200, maxWidth: 200, baseWidth: 200, isFixed: true }, // ê³ ì • ë„ˆë¹„ 200px\n      { key: 'quantity', minWidth: 70, maxWidth: 100, baseWidth: 70 },\n      { key: 'unit_price', minWidth: 90, maxWidth: 150, baseWidth: 90 },\n      { key: 'total_price', minWidth: 100, maxWidth: 180, baseWidth: 100 },\n      { key: 'remarks', minWidth: 150, maxWidth: 150, baseWidth: 150, isFixed: true }, // ê³ ì • ë„ˆë¹„ 150px\n      { key: 'status', minWidth: 80, maxWidth: 120, baseWidth: 80 }\n    ]\n\n      // ì¶”ê°€ ì¹¼ëŸ¼ë“¤ (íƒ­ë³„)\n      if (activeTab === 'receipt') {\n        columnConfigs.push({ key: 'actual_receipt_date', minWidth: 100, maxWidth: 160, baseWidth: 100, isFixed: false })\n      }\n      if (activeTab === 'done') {\n        columnConfigs.push(\n          { key: 'transaction_confirm', minWidth: 100, maxWidth: 160, baseWidth: 100, isFixed: false },\n          { key: 'accounting_date', minWidth: 80, maxWidth: 80, baseWidth: 80, isFixed: true },\n          { key: 'utk_confirm', minWidth: 50, maxWidth: 50, baseWidth: 50, isFixed: true }\n        )\n      }\n\n    const calculatedWidths = columnConfigs.map((config, index) => {\n      let maxLength = 4 // ìµœì†Œ 4ì\n\n      // í—¤ë” í…ìŠ¤íŠ¸ ê¸¸ì´ ê³ ë ¤ (íƒ­ë³„)\n      const getHeaders = () => {\n        const statusHeader = activeTab === 'purchase'\n          ? 'êµ¬ë§¤ìƒíƒœ'\n          : (activeTab === 'receipt' || activeTab === 'done')\n          ? 'ì…ê³ ìƒíƒœ'\n          : 'ìƒíƒœ'\n\n        // ìŠ¹ì¸ëŒ€ê¸°íƒ­ì—ì„œëŠ” ìƒíƒœ ì¹¼ëŸ¼ ì œì™¸\n        const baseHeaders = activeTab === 'pending' \n          ? ['í’ˆëª©ëª…', 'ê·œê²©', 'ìˆ˜ëŸ‰', 'ë‹¨ê°€', 'í•©ê³„', 'ë¹„ê³ ']\n          : ['í’ˆëª©ëª…', 'ê·œê²©', 'ìˆ˜ëŸ‰', 'ë‹¨ê°€', 'í•©ê³„', 'ë¹„ê³ ', statusHeader]\n        if (activeTab === 'receipt') {\n          return [...baseHeaders, 'ì‹¤ì œì…ê³ ì¼']\n        } else if (activeTab === 'done') {\n          return [...baseHeaders, 'ê±°ë˜ëª…ì„¸ì„œ í™•ì¸', 'íšŒê³„ìƒ ì…ê³ ì¼', 'UTK']\n        }\n        return baseHeaders\n      }\n      \n      const headers = getHeaders()\n      if (headers[index]) {\n        maxLength = Math.max(maxLength, headers[index].length)\n      }\n\n      // ì‹¤ì œ ë°ì´í„°ì—ì„œ ìµœëŒ€ ê¸¸ì´ ì°¾ê¸°\n      items.forEach(item => {\n        let cellValue = ''\n        switch (config.key) {\n          case 'item_name':\n            cellValue = item.item_name || ''\n            break\n          case 'specification':\n            cellValue = item.specification || ''\n            break\n          case 'quantity':\n            cellValue = item.quantity?.toString() || ''\n            break\n          case 'unit_price':\n            cellValue = item.unit_price_value != null ? item.unit_price_value.toLocaleString() : ''\n            break\n          case 'total_price':\n            if (item.amount_value != null) {\n              cellValue = item.amount_value.toLocaleString()\n            } else if (item.quantity != null && item.unit_price_value != null) {\n              cellValue = (Number(item.quantity) * Number(item.unit_price_value)).toLocaleString()\n            } else {\n              cellValue = ''\n            }\n            break\n          case 'remarks':\n            cellValue = item.remark || ''\n            break\n          case 'status':\n            cellValue = getStatusDisplay(item) || ''\n            break\n          case 'actual_receipt_date':\n            cellValue = item.actual_received_date ? formatDate(item.actual_received_date) : ''\n            break\n          case 'transaction_confirm':\n            cellValue = item.is_statement_received ? 'í™•ì¸ì™„ë£Œ' : 'ë¯¸í™•ì¸'\n            break\n          case 'accounting_date':\n            cellValue = item.statement_received_date ? formatDate(item.statement_received_date) : ''\n            break\n          case 'processor':\n            cellValue = item.statement_received_by_name || ''\n            break\n          case 'utk_confirm':\n            cellValue = item.is_utk_checked ? 'ì™„ë£Œ' : 'ëŒ€ê¸°'\n            break\n        }\n        \n        // í•œê¸€/ì˜ë¬¸ í˜¼í•© í…ìŠ¤íŠ¸ ê¸¸ì´ ê³„ì‚° (í•œê¸€ì€ 1.5ë°° ê°€ì¤‘ì¹˜)\n        const adjustedLength = cellValue.split('').reduce((acc, char) => {\n          return acc + (/[ê°€-í£]/.test(char) ? 1.5 : 1)\n        }, 0)\n        \n        maxLength = Math.max(maxLength, Math.ceil(adjustedLength))\n      })\n\n      // ê³ ì • ë„ˆë¹„ ì¹¼ëŸ¼ì€ ë°”ë¡œ ë°˜í™˜\n      if (config.isFixed) {\n        return config.baseWidth\n      }\n      \n      // ê¸¸ì´ë¥¼ í”½ì…€ë¡œ ë³€í™˜ (ê¸€ìë‹¹ ì•½ 7px + ì—¬ë°± 20px)\n      const calculatedWidth = Math.max(\n        config.minWidth,\n        Math.min(config.maxWidth, maxLength * 7 + 20)\n      )\n\n\n      return calculatedWidth\n    })\n\n    setColumnWidths(calculatedWidths)\n    return calculatedWidths\n  }, [purchase, activeTab])\n\n  // ìƒíƒœ í‘œì‹œ í…ìŠ¤íŠ¸ ë°˜í™˜ í•¨ìˆ˜\n  const getStatusDisplay = (item: any) => {\n    if (activeTab === 'purchase') {\n      return item.is_payment_completed ? 'êµ¬ë§¤ì™„ë£Œ' : 'êµ¬ë§¤ìš”ì²­'\n    } else if (activeTab === 'receipt') {\n      return item.is_received ? 'ì…ê³ ' : 'ì…ê³ ëŒ€ê¸°'\n    }\n    return item.is_payment_completed ? 'êµ¬ë§¤ì™„ë£Œ' : 'êµ¬ë§¤ìš”ì²­'\n  }\n\n  // ë™ì  gridTemplateColumns ìƒì„±\n  const getGridTemplateColumns = () => {\n    // ë™ì  ê³„ì‚°ëœ ë„ˆë¹„ê°€ ìˆìœ¼ë©´ ì‚¬ìš© (ë‹¨, íŠ¹ì • ì»¬ëŸ¼ì€ ê³ ì •ê°’ ê°•ì œ)\n    if (columnWidths.length > 0) {\n      const widths = columnWidths.map(width => `${width}px`)\n      \n      // ê·œê²©, ë¹„ê³ ëŠ” í•­ìƒ ê³ ì •\n      if (widths.length >= 2) {\n        widths[1] = '200px' // ê·œê²©\n      }\n      if (widths.length >= 6) {\n        widths[5] = '150px' // ë¹„ê³ \n      }\n      \n      // ì „ì²´í•­ëª© íƒ­: íšŒê³„ìƒ ì…ê³ ì¼, UTK ì»¬ëŸ¼ ê°•ì œ ê³ ì •\n      if (activeTab === 'done') {\n        // [í’ˆëª©ëª…, ê·œê²©, ìˆ˜ëŸ‰, ë‹¨ê°€, í•©ê³„, ë¹„ê³ , ìƒíƒœ, ê±°ë˜ëª…ì„¸ì„œ, íšŒê³„ìƒì…ê³ ì¼, UTK]\n        // ì¸ë±ìŠ¤: 0     1     2     3     4      5     6      7          8            9\n        if (widths.length >= 9) {\n          widths[7] = '100px' // ê±°ë˜ëª…ì„¸ì„œ\n          widths[8] = '80px'  // íšŒê³„ìƒ ì…ê³ ì¼\n        }\n        if (widths.length >= 10) {\n          widths[9] = '50px'  // UTK\n        }\n      }\n      \n      return widths.join(' ')\n    }\n    \n    // ê¸°ë³¸ê°’ (ë°ì´í„° ë¡œë“œ ì „)\n    // [í’ˆëª©ëª…, ê·œê²©, ìˆ˜ëŸ‰, ë‹¨ê°€, í•©ê³„, ë¹„ê³ , ìƒíƒœ/ì‚­ì œ]\n    const baseColumns = ['minmax(180px, 1fr)', '200px', '70px', '90px', '100px', '150px', '80px']\n    \n    // íƒ­ë³„ ì¶”ê°€ ì¹¼ëŸ¼\n    if (activeTab === 'receipt') {\n      return [...baseColumns, '100px'].join(' ')\n    } else if (activeTab === 'done') {\n      return [...baseColumns, '100px', '80px', '50px'].join(' ')\n    }\n    \n    return baseColumns.join(' ')\n  }\n\n  // ë ˆê±°ì‹œ measureColumnWidths í•¨ìˆ˜ (í˜¸í™˜ì„± ìœ ì§€)\n  const measureColumnWidths = () => {\n    calculateOptimalColumnWidths()\n  }\n\n  // View ëª¨ë“œì—ì„œ ì¹¼ëŸ¼ ë„ˆë¹„ ê³„ì‚° (ë°ì´í„° ë¡œë“œ í›„)\n  // ë¹„ë™ê¸°ë¡œ ì²˜ë¦¬í•˜ì—¬ ëª¨ë‹¬ì´ ë¨¼ì € í‘œì‹œë˜ë„ë¡ í•¨\n  useEffect(() => {\n    if (purchase && purchase.purchase_request_items && purchase.purchase_request_items.length > 0 && !isEditing) {\n      // requestAnimationFrameìœ¼ë¡œ ë‹¤ìŒ í”„ë ˆì„ì— ê³„ì‚°í•˜ì—¬ ëª¨ë‹¬ ë Œë”ë§ì„ ë¸”ë¡œí‚¹í•˜ì§€ ì•ŠìŒ\n      requestAnimationFrame(() => {\n        calculateOptimalColumnWidths()\n      })\n    }\n  }, [purchase, isEditing, activeTab, calculateOptimalColumnWidths])\n\n  // Edit ëª¨ë“œ ì „í™˜ ì‹œ ë„ˆë¹„ ê³„ì‚°\n  const handleEditToggle = (editing: boolean) => {\n    if (editing && !isEditing) {\n      // Edit ëª¨ë“œë¡œ ì „í™˜í•  ë•Œ í˜„ì¬ ë°ì´í„°ë¡œ ì´ˆê¸°í™”\n      setEditedPurchase(purchase)\n      setEditedItems(currentItems || [])\n      setDeletedItemIds([])\n      // Edit ëª¨ë“œë¡œ ì „í™˜í•˜ê¸° ì „ì— í˜„ì¬ ë„ˆë¹„ ê³„ì‚°\n      calculateOptimalColumnWidths()\n    }\n    setIsEditing(editing)\n  }\n\n  const loadPurchaseDetail = async (id: string) => {\n    try {\n      // ğŸš€ ë©”ëª¨ë¦¬ì—ì„œ ë¨¼ì € ì°¾ê¸° (ë¡œë”© ìƒíƒœ ì—†ì´ ì¦‰ì‹œ ë¡œë“œ)\n      const memoryPurchase = findPurchaseInMemory(id)\n      if (memoryPurchase) {\n        // ë©”ëª¨ë¦¬ ë°ì´í„°ë¥¼ PurchaseRequestWithDetails í˜•íƒœë¡œ ë³€í™˜\n        const purchaseData = {\n          ...memoryPurchase,\n          id: String(memoryPurchase.id), // PurchaseRequestëŠ” idê°€ string\n          is_po_generated: false, // Purchase íƒ€ì…ì—ëŠ” ì—†ì§€ë§Œ PurchaseRequestì— í•„ìˆ˜\n          vendor: {\n            id: memoryPurchase.vendor_id,\n            vendor_name: memoryPurchase.vendor_name || 'ì•Œ ìˆ˜ ì—†ìŒ',\n            is_active: true\n          } as Vendor,\n          vendor_contacts: []\n        } as PurchaseRequestWithDetails\n        \n        setPurchase(purchaseData)\n        setEditedPurchase(purchaseData)\n        setEditedItems(memoryPurchase.items || [])\n        return\n      }\n      \n      // ë©”ëª¨ë¦¬ì— ì—†ëŠ” ê²½ìš°ì—ë§Œ ë¡œë”© ìƒíƒœ í‘œì‹œ í›„ DBì—ì„œ ë¡œë“œ (fallback)\n      setLoading(true)\n      const supabase = createClient()\n      \n      const { data, error } = await supabase\n        .from('purchase_requests')\n        .select(`\n          *,\n          vendors(id, vendor_name),\n          purchase_request_items(*)\n        `)\n        .eq('id', id)\n        .single()\n\n      if (error) throw error\n\n      if (data) {\n        // ë¼ì¸ë„˜ë²„ ìˆœì„œëŒ€ë¡œ ì •ë ¬\n        const sortedItems = (data.purchase_request_items || []).sort((a: any, b: any) => {\n          const lineA = a.line_number || 999999;\n          const lineB = b.line_number || 999999;\n          return lineA - lineB;\n        });\n\n        const purchaseData = {\n          ...data,\n          items: sortedItems,\n          vendor: data.vendors || { id: 0, vendor_name: 'ì•Œ ìˆ˜ ì—†ìŒ' },\n          vendor_contacts: []\n        } as PurchaseRequestWithDetails\n        setPurchase(purchaseData)\n        setEditedPurchase(purchaseData)\n        setEditedItems(sortedItems)\n      }\n    } catch (error) {\n      logger.error('[PurchaseDetailModal] ë°œì£¼ ìƒì„¸ ë¡œë“œ ì‹¤íŒ¨:', error)\n      toast.error('ë°œì£¼ ìƒì„¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const getStatusBadge = () => {\n    if (!purchase) return null\n    \n    // payment_category ìš°ì„  í™•ì¸\n    if (purchase.payment_category) {\n      const category = purchase.payment_category.trim()\n      \n      if (category === 'ë°œì£¼') {\n        return <span className=\"badge-stats bg-green-500 text-white\">ë°œì£¼</span>\n      } else if (category === 'êµ¬ë§¤ìš”ì²­') {\n        return <span className=\"badge-stats bg-blue-500 text-white\">êµ¬ë§¤ìš”ì²­</span>\n      } else if (category === 'í˜„ì¥ê²°ì œ') {\n        return <span className=\"badge-stats bg-gray-500 text-white\">í˜„ì¥ê²°ì œ</span>\n      } else {\n        // payment_category ê°’ì´ ìˆì§€ë§Œ ì•Œë ¤ì§„ ê°’ì´ ì•„ë‹Œ ê²½ìš°\n        return <span className=\"badge-stats bg-blue-500 text-white\">{category}</span>\n      }\n    }\n    \n    // payment_categoryê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’\n    return <span className=\"badge-stats bg-blue-500 text-white\">êµ¬ë§¤ìš”ì²­</span>\n  }\n\n  // formatDateëŠ” utils/helpers.tsì—ì„œ import\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat('ko-KR').format(amount)\n  }\n\n  const handleSave = async () => {\n    if (!purchase || !editedPurchase) {\n      toast.error('ì €ì¥í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.')\n      return\n    }\n    \n    try {\n      \n      // ë°œì£¼ ê¸°ë³¸ ì •ë³´ ì—…ë°ì´íŠ¸\n      const totalAmount = editedItems.reduce((sum, item) => sum + (item.amount_value || 0), 0)\n      \n      const { error: updateError } = await supabase\n        .from('purchase_requests')\n        .update({\n          purchase_order_number: editedPurchase.purchase_order_number || null,\n          requester_name: editedPurchase.requester_name || null,\n          delivery_request_date: editedPurchase.delivery_request_date || null,\n          revised_delivery_request_date: editedPurchase.revised_delivery_request_date || null,\n          payment_category: editedPurchase.payment_category || null,\n          project_vendor: editedPurchase.project_vendor || null,\n          total_amount: Number(totalAmount),\n          updated_at: new Date().toISOString()\n        })\n        .eq('id', purchase.id)\n\n      if (updateError) throw updateError\n\n      // ì‚­ì œëœ í•­ëª©ë“¤ ì²˜ë¦¬\n      if (deletedItemIds.length > 0) {\n        const { error: deleteError } = await supabase\n          .from('purchase_request_items')\n          .delete()\n          .in('id', deletedItemIds)\n\n        if (deleteError) throw deleteError\n      }\n\n      // ê° ì•„ì´í…œ ì—…ë°ì´íŠ¸ ë˜ëŠ” ìƒì„±\n      \n      for (const item of editedItems) {\n        \n        // í•„ìˆ˜ í•„ë“œ ê²€ì¦\n        if (!item.item_name || !item.item_name.trim()) {\n          throw new Error('í’ˆëª©ëª…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.');\n        }\n        if (!item.quantity || item.quantity <= 0) {\n          throw new Error('ìˆ˜ëŸ‰ì€ 0ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤.');\n        }\n        if (item.unit_price_value !== null && item.unit_price_value !== undefined && item.unit_price_value < 0) {\n          throw new Error('ë‹¨ê°€ëŠ” 0 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');\n        }\n        if (item.amount_value !== null && item.amount_value !== undefined && item.amount_value < 0) {\n          throw new Error('í•©ê³„ëŠ” 0 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');\n        }\n        \n        if (item.id) {\n          // ê¸°ì¡´ í•­ëª© ì—…ë°ì´íŠ¸\n          const { error } = await supabase\n            .from('purchase_request_items')\n            .update({\n              item_name: item.item_name.trim(),\n              specification: item.specification || null,\n              quantity: Number(item.quantity),\n              unit_price_value: Number(item.unit_price_value),\n              unit_price_currency: purchase.currency || 'KRW',\n              amount_value: Number(item.amount_value),\n              amount_currency: purchase.currency || 'KRW',\n              remark: item.remark || null,\n              updated_at: new Date().toISOString()\n            })\n            .eq('id', item.id)\n\n          if (error) {\n            logger.error('ê¸°ì¡´ í•­ëª© ì—…ë°ì´íŠ¸ ì˜¤ë¥˜', error);\n            throw error;\n          }\n        } else {\n          // ìƒˆ í•­ëª© ìƒì„±\n          const insertData = {\n            purchase_request_id: purchase.id,\n            item_name: item.item_name.trim(),\n            specification: item.specification || null,\n            quantity: Number(item.quantity),\n            unit_price_value: Number(item.unit_price_value),\n            unit_price_currency: purchase.currency || 'KRW',\n            amount_value: Number(item.amount_value),\n            amount_currency: purchase.currency || 'KRW',\n            remark: item.remark || null,\n            line_number: item.line_number || editedItems.indexOf(item) + 1,\n            created_at: new Date().toISOString()\n          };\n          \n          const { error } = await supabase\n            .from('purchase_request_items')\n            .insert(insertData)\n\n          if (error) {\n            logger.error('ìƒˆ í•­ëª© ìƒì„± ì˜¤ë¥˜', error);\n            throw error;\n          }\n        }\n      }\n\n      // ğŸš€ ì „ì²´ì™„ë£Œ í•¨ìˆ˜ì™€ ì •í™•íˆ ë™ì¼í•œ íŒ¨í„´ ì ìš© (ë©”ëª¨ë¦¬ ìºì‹œ í¬í•¨)\n      const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n      const sourceData = editedPurchase || purchase\n      \n      // 1. ğŸš€ ì‚­ì œëœ í’ˆëª©ë“¤ì— ëŒ€í•´ ê°œë³„ ë©”ëª¨ë¦¬ ìºì‹œ ì²˜ë¦¬ (êµ¬ë§¤ì™„ë£Œì™€ ë™ì¼í•œ ë°©ì‹)\n      if (!Number.isNaN(purchaseIdNumber) && deletedItemIds.length > 0) {\n        logger.info('ğŸš€ [ë©”ëª¨ë¦¬ ìºì‹œ] ê°œë³„ í’ˆëª© ì‚­ì œ ì²˜ë¦¬ ì‹œì‘', {\n          purchaseId: purchaseIdNumber,\n          deletedItemIds: deletedItemIds,\n          deletedCount: deletedItemIds.length\n        })\n        \n        // ê° ì‚­ì œëœ í’ˆëª©ì— ëŒ€í•´ ê°œë³„ ë©”ëª¨ë¦¬ ìºì‹œ ì—…ë°ì´íŠ¸ (êµ¬ë§¤ì™„ë£Œì™€ ì •í™•íˆ ë™ì¼í•œ íŒ¨í„´)\n        deletedItemIds.forEach(itemId => {\n          const memoryUpdated = removeItemFromMemory(purchaseIdNumber, itemId)\n          if (!memoryUpdated) {\n            logger.warn('[handleSave] ê°œë³„ í’ˆëª© ì‚­ì œ ë©”ëª¨ë¦¬ ìºì‹œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { \n              purchaseId: purchaseIdNumber, \n              itemId: itemId \n            })\n          } else {\n            logger.info('âœ… [handleSave] ê°œë³„ í’ˆëª© ì‚­ì œ ë©”ëª¨ë¦¬ ìºì‹œ ì—…ë°ì´íŠ¸ ì„±ê³µ', { \n              purchaseId: purchaseIdNumber, \n              itemId: itemId \n            })\n          }\n        })\n      }\n      \n      // 2. ë°œì£¼ ê¸°ë³¸ ì •ë³´ ë©”ëª¨ë¦¬ ìºì‹œ ì—…ë°ì´íŠ¸ (ìˆ˜ì •ëœ í•„ë“œë“¤ë§Œ)\n      if (!Number.isNaN(purchaseIdNumber)) {\n        const memoryUpdated = updatePurchaseInMemory(purchaseIdNumber, (prev) => {\n          const totalAmount = editedItems.reduce((sum, item) => sum + (item.amount_value || 0), 0)\n          \n          logger.info('ğŸš€ [ë©”ëª¨ë¦¬ ìºì‹œ] ë°œì£¼ ê¸°ë³¸ ì •ë³´ ì—…ë°ì´íŠ¸', {\n            purchaseId: purchaseIdNumber,\n            newTotalAmount: totalAmount,\n            itemsCount: editedItems.length\n          })\n          \n          return {\n            ...prev,\n            // ë°œì£¼ ê¸°ë³¸ ì •ë³´ ì—…ë°ì´íŠ¸\n            purchase_order_number: sourceData?.purchase_order_number || prev.purchase_order_number,\n            requester_name: sourceData?.requester_name || prev.requester_name,\n            delivery_request_date: sourceData?.delivery_request_date || prev.delivery_request_date,\n            revised_delivery_request_date: sourceData?.revised_delivery_request_date || prev.revised_delivery_request_date,\n            payment_category: sourceData?.payment_category || prev.payment_category,\n            project_vendor: sourceData?.project_vendor || prev.project_vendor,\n            total_amount: totalAmount,\n            updated_at: new Date().toISOString()\n          } as Purchase\n        })\n        \n        logger.info('ğŸš€ [ë©”ëª¨ë¦¬ ìºì‹œ] ê¸°ë³¸ ì •ë³´ ì—…ë°ì´íŠ¸ ê²°ê³¼:', { memoryUpdated })\n      }\n      \n      // 3. applyOptimisticUpdate í•¨ìˆ˜ ì •ì˜ (ì „ì²´ì™„ë£Œ í•¨ìˆ˜ íŒ¨í„´)\n      const applyOptimisticUpdate = () => {\n        if (!Number.isNaN(purchaseIdNumber) && onOptimisticUpdate) {\n          onOptimisticUpdate(purchaseIdNumber, prev => {\n            const finalItems = editedItems // ì‚­ì œëœ í•­ëª©ì´ ì´ë¯¸ ì œì™¸ë¨\n            const totalAmount = finalItems.reduce((sum, item) => sum + (item.amount_value || 0), 0)\n            \n            logger.info('ğŸš€ [onOptimisticUpdate] ì¦‰ì‹œ UI ì—…ë°ì´íŠ¸', {\n              originalItemsCount: prev.items?.length || prev.purchase_request_items?.length || 0,\n              finalItemsCount: finalItems.length,\n              deletedItemsCount: deletedItemIds.length\n            })\n            \n            return {\n              ...prev,\n              // ë°œì£¼ ê¸°ë³¸ ì •ë³´ ì—…ë°ì´íŠ¸\n              purchase_order_number: sourceData?.purchase_order_number || prev.purchase_order_number,\n              requester_name: sourceData?.requester_name || prev.requester_name,\n              delivery_request_date: sourceData?.delivery_request_date || prev.delivery_request_date,\n              revised_delivery_request_date: sourceData?.revised_delivery_request_date || prev.revised_delivery_request_date,\n              payment_category: sourceData?.payment_category || prev.payment_category,\n              project_vendor: sourceData?.project_vendor || prev.project_vendor,\n              total_amount: totalAmount,\n              // í’ˆëª© ë°ì´í„° ì—…ë°ì´íŠ¸ - ì‚­ì œëœ í•­ëª© ì œì™¸\n              items: finalItems,\n              purchase_request_items: finalItems,\n              updated_at: new Date().toISOString()\n            } as Purchase\n          })\n        }\n      }\n      \n      // 4. ì¦‰ì‹œ UI ì—…ë°ì´íŠ¸ ì‹¤í–‰ (ì „ì²´ì™„ë£Œ í•¨ìˆ˜ íŒ¨í„´)\n      applyOptimisticUpdate()\n\n      toast.success('ë°œì£¼ ë‚´ì—­ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.')\n      handleEditToggle(false)\n      setDeletedItemIds([])\n      \n      // 5. ì „ì²´ì™„ë£Œ í•¨ìˆ˜ íŒ¨í„´: refreshModalData ë¨¼ì €, ê·¸ ë‹¤ìŒ onRefresh\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      logger.error('ì €ì¥ ì¤‘ ì „ì²´ ì˜¤ë¥˜', error);\n      const errorMessage = error instanceof Error ? error.message : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤'\n      toast.error(`ì €ì¥ ì‹¤íŒ¨: ${errorMessage}`)\n    }\n  }\n\n  const handleItemChange = (index: number, field: string, value: any) => {\n    const newItems = [...editedItems]\n    \n    if (field === 'quantity' || field === 'unit_price_value') {\n      // ìˆ˜ëŸ‰ì´ë‚˜ ë‹¨ê°€ë¥¼ ìˆ˜ì •í•œ ê²½ìš° ê¸ˆì•¡ ìë™ ê³„ì‚°\n      const quantity = field === 'quantity' ? value : newItems[index].quantity\n      const unitPrice = field === 'unit_price_value' ? value : newItems[index].unit_price_value\n      newItems[index] = {\n        ...newItems[index],\n        [field]: value,\n        amount_value: (quantity || 0) * (unitPrice || 0)  // null ì²´í¬ ì¶”ê°€\n      }\n    } else {\n      // ê¸°íƒ€ í•„ë“œ ìˆ˜ì • (amount_value ì§ì ‘ ìˆ˜ì •ì€ ì œê±°ë¨)\n      newItems[index] = {\n        ...newItems[index],\n        [field]: value\n      }\n    }\n    \n    setEditedItems(newItems)\n  }\n\n  const handleAddItem = () => {\n    // í˜„ì¬ ìµœëŒ€ ë¼ì¸ë„˜ë²„ ì°¾ê¸°\n    const maxLineNumber = editedItems.reduce((max, item) => {\n      const lineNum = item.line_number || 0;\n      return lineNum > max ? lineNum : max;\n    }, 0);\n\n    const newItem = {\n      item_name: '',\n      specification: '',\n      quantity: 1,\n      unit_price_value: 0,\n      amount_value: 0,\n      remark: '',\n      line_number: maxLineNumber + 1\n    }\n    \n    // ìƒˆ ì•„ì´í…œ ì¶”ê°€ í›„ ë¼ì¸ë„˜ë²„ ìˆœì„œëŒ€ë¡œ ì •ë ¬\n    const newItems = [...editedItems, newItem].sort((a, b) => {\n      const lineA = a.line_number || 999999;\n      const lineB = b.line_number || 999999;\n      return lineA - lineB;\n    });\n    \n    setEditedItems(newItems)\n  }\n\n  const handleRemoveItem = (index: number) => {\n    const item = editedItems[index]\n    if (item.id) {\n      setDeletedItemIds([...deletedItemIds, item.id])\n    }\n    const newItems = editedItems.filter((_, i) => i !== index).sort((a, b) => {\n      const lineA = a.line_number || 999999;\n      const lineB = b.line_number || 999999;\n      return lineA - lineB;\n    });\n    setEditedItems(newItems)\n  }\n\n  // êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ í•¨ìˆ˜\n  const handlePaymentToggle = async (itemId: number | string, isCompleted: boolean) => {\n    \n    if (!canPurchase) {\n      logger.warn('[handlePaymentToggle] ê¶Œí•œ ì—†ìŒ', { canPurchase, currentUserRoles })\n      toast.error('êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.')\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n\n    if (Number.isNaN(numericId)) {\n      logger.error('[handlePaymentToggle] ì˜ëª»ëœ ID', { itemId, numericId })\n      toast.error('ìœ íš¨í•˜ì§€ ì•Šì€ í•­ëª© ID ì…ë‹ˆë‹¤.')\n      return\n    }\n\n    // í•´ë‹¹ í’ˆëª© ì •ë³´ ì°¾ê¸° - ë°ì´í„° êµ¬ì¡° ë””ë²„ê¹…\n    \n    // itemsì™€ purchase_request_items ë‘˜ ë‹¤ í™•ì¸ - lengthë¡œ ì‹¤ì œ ë°ì´í„° ìœ ë¬´ íŒë‹¨\n    if (!purchase) return\n    \n    const purchaseItems = (purchase.items && purchase.items.length > 0) ? purchase.items : []\n    const requestItems = (purchase.purchase_request_items && purchase.purchase_request_items.length > 0) ? purchase.purchase_request_items : []\n    const items = purchaseItems.length > 0 ? purchaseItems : requestItems\n    \n    \n    const targetItem = items.find(item => String(item.id) === itemIdStr)\n    \n    \n    if (!targetItem) {\n      return\n    }\n\n    const itemInfo = `í’ˆëª…: ${targetItem.item_name}\nê·œê²©: ${targetItem.specification || 'ë¯¸ì…ë ¥'}\nìˆ˜ëŸ‰: ${targetItem.quantity?.toLocaleString() || 0}${targetItem.unit || ''}\në‹¨ê°€: â‚©${targetItem.unit_price_value?.toLocaleString() || 0}\ní•©ê³„: â‚©${targetItem.amount_value?.toLocaleString() || 0}`\n\n    const confirmMessage = isCompleted \n      ? `ë‹¤ìŒ í’ˆëª©ì„ êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\\n\\n${itemInfo}` \n      : `ë‹¤ìŒ í’ˆëª©ì˜ êµ¬ë§¤ì™„ë£Œë¥¼ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\\n\\n${itemInfo}`\n    \n    const confirm = window.confirm(confirmMessage)\n    \n    if (!confirm) {\n      return\n    }\n\n    try {\n      \n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_payment_completed: isCompleted,\n          payment_completed_at: isCompleted ? new Date().toISOString() : null\n        })\n        .eq('id', numericId)\n\n      if (error) {\n        throw error\n      }\n      \n\n      // ğŸš€ ë©”ëª¨ë¦¬ ìºì‹œ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (êµ¬ë§¤ì™„ë£Œ/ì·¨ì†Œ ëª¨ë‘ ì²˜ë¦¬)\n      if (purchase) {\n        \n        const memoryUpdated = isCompleted \n          ? markItemAsPaymentCompleted(purchase.id, numericId)\n          : markItemAsPaymentCanceled(purchase.id, numericId);\n          \n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal] ë©”ëª¨ë¦¬ ìºì‹œ í’ˆëª© ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { \n            purchaseId: purchase.id, \n            itemId: numericId,\n            isCompleted\n          });\n        }\n      }\n\n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (UI ì¦‰ì‹œ ë°˜ì˜)\n      setPurchase(prev => {\n        if (!prev) {\n          return null\n        }\n        \n        // itemsì™€ purchase_request_items ë‘˜ ë‹¤ í™•ì¸í•˜ì—¬ ì—…ë°ì´íŠ¸ - lengthë¡œ ì‹¤ì œ ë°ì´í„° ìœ ë¬´ íŒë‹¨\n        const prevItems = (prev.items && prev.items.length > 0) ? prev.items : []\n        const prevRequestItems = (prev.purchase_request_items && prev.purchase_request_items.length > 0) ? prev.purchase_request_items : []\n        const currentItems = prevItems.length > 0 ? prevItems : prevRequestItems\n        const updatedItems = currentItems.map(item => \n          String(item.id) === itemIdStr \n            ? { ...item, is_payment_completed: isCompleted, payment_completed_at: isCompleted ? new Date().toISOString() : null }\n            : item\n        )\n        \n        \n        // ë°ì´í„° êµ¬ì¡°ì— ë§ê²Œ ì—…ë°ì´íŠ¸\n        const result = {\n          ...prev,\n          items: prev.items ? updatedItems : prev.items,\n          purchase_request_items: prev.purchase_request_items ? updatedItems : prev.purchase_request_items\n        }\n        \n        return result\n      })\n\n      if (purchase) {\n        const purchaseIdNumber = Number(purchase.id)\n        if (!Number.isNaN(purchaseIdNumber)) {\n          onOptimisticUpdate?.(purchaseIdNumber, prev => {\n            const updatedItems = (prev.items || []).map(item =>\n              String(item.id) === itemIdStr\n                ? { ...item, is_payment_completed: isCompleted }\n                : item\n            )\n            const total = updatedItems.length || prev.items?.length || 0\n            const completed = updatedItems.filter(item => item.is_payment_completed).length\n            const allCompleted = total > 0 && completed === total\n            return {\n              ...prev,\n              items: updatedItems,\n              is_payment_completed: allCompleted,\n              payment_completed_at: allCompleted ? new Date().toISOString() : null,\n              payment_completed_by_name: allCompleted ? (currentUserName || prev.payment_completed_by_name) : prev.payment_completed_by_name\n            }\n          })\n        }\n      }\n      \n      toast.success(isCompleted ? 'êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'êµ¬ë§¤ì™„ë£Œê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.')\n\n      // ìƒì„¸ ëª¨ë‹¬ ë° ìƒìœ„ ë¦¬ìŠ¤íŠ¸ ëª¨ë‘ ìµœì‹  ìƒíƒœë¡œ ë™ê¸°í™”\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      toast.error('êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n\n  // ê°œë³„ í’ˆëª© ì…ê³ ì™„ë£Œ ì²˜ë¦¬ (ë‚ ì§œ ì„ íƒ)\n  const handleItemReceiptToggle = async (itemId: number | string, selectedDate: Date) => {\n    if (!canReceiptCheck) {\n      toast.error('ì…ê³  ì²˜ë¦¬ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.')\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      toast.error('ìœ íš¨í•˜ì§€ ì•Šì€ í•­ëª© ID ì…ë‹ˆë‹¤.')\n      return\n    }\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item =>\n            String(item.id) === itemIdStr\n              ? {\n                  ...item,\n                  is_received: true,\n                  actual_received_date: selectedDate.toISOString()\n                }\n              : item\n          )\n          const total = updatedItems.length || prev.items?.length || 0\n          const completed = updatedItems.filter(item => item.is_received).length\n          const allReceived = total > 0 && completed === total\n\n          return {\n            ...prev,\n            items: updatedItems,\n            is_received: allReceived,\n            received_at: allReceived ? new Date().toISOString() : prev.received_at\n          }\n        })\n      }\n    }\n\n    try {\n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_received: true,\n          received_at: new Date().toISOString(),\n          actual_received_date: selectedDate.toISOString()\n        })\n        .eq('id', numericId)\n\n      if (error) throw error\n\n      // ğŸš€ ë©”ëª¨ë¦¬ ìºì‹œ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (ê°œë³„ í’ˆëª© ì…ê³ ì™„ë£Œ)\n      if (purchase) {\n        const memoryUpdated = markItemAsReceived(purchase.id, numericId);\n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal] ë©”ëª¨ë¦¬ ìºì‹œ ê°œë³„ í’ˆëª© ì…ê³ ì™„ë£Œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { \n            purchaseId: purchase.id, \n            itemId: numericId \n          });\n        }\n      }\n\n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          String(item.id) === itemIdStr \n            ? { \n                ...item, \n                is_received: true, \n                received_at: new Date().toISOString(),\n                actual_received_date: selectedDate.toISOString()\n              }\n            : item\n        )\n        return { ...prev, items: updatedItems }\n      })\n\n      applyOptimisticUpdate()\n      \n      const targetItem = purchase?.items?.find(item => String(item.id) === itemIdStr)\n      toast.success(`\"${targetItem?.item_name}\" í’ˆëª©ì´ ì…ê³ ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.`)\n\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      toast.error('ì…ê³ ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n\n  // ì…ê³ ì™„ë£Œ ì·¨ì†Œ ì²˜ë¦¬\n  const handleReceiptCancel = async (itemId: number | string) => {\n    if (!canReceiptCheck) {\n      toast.error('ì…ê³  ì²˜ë¦¬ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.')\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      toast.error('ìœ íš¨í•˜ì§€ ì•Šì€ í•­ëª© ID ì…ë‹ˆë‹¤.')\n      return\n    }\n\n    const targetItem = purchase?.items?.find(item => String(item.id) === itemIdStr)\n    if (!targetItem) return\n\n    const confirm = window.confirm(`\"${targetItem.item_name}\" í’ˆëª©ì˜ ì…ê³ ì™„ë£Œë¥¼ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)\n    if (!confirm) return\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item =>\n            String(item.id) === itemIdStr\n              ? {\n                  ...item,\n                  is_received: false,\n                  actual_received_date: undefined\n                }\n              : item\n          )\n          const total = updatedItems.length || prev.items?.length || 0\n          const completed = updatedItems.filter(item => item.is_received).length\n          const allReceived = total > 0 && completed === total\n\n          return {\n            ...prev,\n            items: updatedItems,\n            is_received: allReceived,\n            received_at: allReceived ? prev.received_at : null\n          }\n        })\n      }\n    }\n\n    try {\n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_received: false,\n          received_at: null,\n          actual_received_date: null,\n          actual_received_by_name: null\n        })\n        .eq('id', numericId)\n\n      if (error) throw error\n\n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          String(item.id) === itemIdStr \n            ? { ...item, is_received: false, received_at: null, actual_received_date: undefined, actual_received_by_name: undefined }\n            : item\n        )\n        return { ...prev, items: updatedItems }\n      })\n      \n      applyOptimisticUpdate()\n\n      toast.success('ì…ê³ ì™„ë£Œê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.')\n\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      toast.error('ì…ê³ ì™„ë£Œ ì·¨ì†Œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n\n\n  // ìŠ¹ì¸ ì²˜ë¦¬\n  const handleApprove = async (type: 'middle' | 'final') => {\n    if (!purchase) return\n    \n    const approvalType = type === 'middle' ? '1ì°¨ ìŠ¹ì¸' : 'ìµœì¢… ìŠ¹ì¸'\n    const confirmMessage = `ë°œì£¼ë²ˆí˜¸: ${purchase.purchase_order_number}\\n\\n${approvalType}ì„ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`\n    const confirm = window.confirm(confirmMessage)\n    if (!confirm) return\n    \n    try {\n      const updateData = type === 'middle' \n        ? { \n            middle_manager_status: 'approved'\n          }\n        : { \n            final_manager_status: 'approved'\n          }\n\n      const { error } = await supabase\n        .from('purchase_requests')\n        .update(updateData)\n        .eq('id', purchase.id)\n      \n      if (error) {\n        throw error\n      }\n\n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (UI ì¦‰ì‹œ ë°˜ì˜)\n      if (type === 'middle') {\n        setPurchase(prev => prev ? { ...prev, middle_manager_status: 'approved' } : null)\n      } else {\n        setPurchase(prev => prev ? { ...prev, final_manager_status: 'approved' } : null)\n      }\n\n      // Optimistic Updateë¡œ ë¦¬ìŠ¤íŠ¸ ì¦‰ì‹œ ë°˜ì˜ (êµ¬ë§¤ì™„ë£Œ/ì…ê³ ì™„ë£Œì™€ ë™ì¼í•œ íŒ¨í„´)\n      if (purchase && onOptimisticUpdate) {\n        const purchaseIdNumber = Number(purchase.id)\n        if (!Number.isNaN(purchaseIdNumber)) {\n          onOptimisticUpdate(purchaseIdNumber, prev => {\n            if (type === 'middle') {\n              return {\n                ...prev,\n                middle_manager_status: 'approved' as any\n              }\n            } else {\n              return {\n                ...prev,\n                final_manager_status: 'approved' as any\n              }\n            }\n          })\n        }\n      }\n      \n      toast.success(`${type === 'middle' ? 'ì¤‘ê°„' : 'ìµœì¢…'} ìŠ¹ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`)\n\n      // ìƒì„¸ ëª¨ë‹¬ ë° ë¦¬ìŠ¤íŠ¸ ëª¨ë‘ ìƒˆë¡œê³ ì¹¨\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      toast.error('ìŠ¹ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n  \n  // ì „ì²´ êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ (ê°œë³„ í’ˆëª©ë³„ ì²˜ë¦¬ ë°©ì‹)\n  const handleCompleteAllPayment = async () => {\n    \n    if (!purchase || !canPurchase) {\n      return\n    }\n    \n    const confirmMessage = `ë°œì£¼ë²ˆí˜¸: ${purchase.purchase_order_number}\\n\\nì „ì²´ êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`\n    const confirm = window.confirm(confirmMessage)\n    if (!confirm) {\n      return\n    }\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const allItems = prev.purchase_request_items || [];\n          const pendingItems = allItems.filter(item => !item.is_payment_completed);\n          \n          const updatedItems = allItems.map(item => \n            !item.is_payment_completed \n              ? { ...item, is_payment_completed: true, payment_completed_at: new Date().toISOString() }\n              : item\n          );\n          \n          return {\n            ...prev,\n            purchase_request_items: updatedItems,\n            items: prev.items ? updatedItems : prev.items,\n            is_payment_completed: updatedItems.every(item => item.is_payment_completed)\n          }\n        })\n      }\n    }\n    \n    try {\n      // ğŸš€ ë¯¸ì™„ë£Œ í’ˆëª©ë§Œ í•„í„°ë§ (ì´ë¯¸ êµ¬ë§¤ì™„ë£Œëœ í’ˆëª© ì œì™¸)\n      const allItems = purchase.purchase_request_items || [];\n      const pendingItems = allItems.filter(item => !item.is_payment_completed);\n      \n      if (pendingItems.length === 0) {\n        toast.info('ëª¨ë“  í’ˆëª©ì´ ì´ë¯¸ êµ¬ë§¤ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');\n        return;\n      }\n\n      logger.info(`ì „ì²´ êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬: ${pendingItems.length}ê°œ í’ˆëª© (ì´ ${allItems.length}ê°œ ì¤‘)`);\n      \n      for (const item of pendingItems) {\n        // ê° í’ˆëª©ë³„ë¡œ DB ì—…ë°ì´íŠ¸ (ê°œë³„ í’ˆëª©ê³¼ ë™ì¼í•œ ë°©ì‹)\n        const updateData = {\n          is_payment_completed: true,\n          payment_completed_at: new Date().toISOString()\n        };\n\n        const { error } = await supabase\n          .from('purchase_request_items')\n          .update(updateData)\n          .eq('id', item.id);\n\n        if (error) throw error;\n\n        // ğŸš€ ê°œë³„ í’ˆëª© ë©”ëª¨ë¦¬ ìºì‹œ ì—…ë°ì´íŠ¸ (ê°œë³„ ì²˜ë¦¬ì™€ ë™ì¼)\n        const memoryUpdated = markItemAsPaymentCompleted(purchase.id, item.id);\n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal] ë©”ëª¨ë¦¬ ìºì‹œ ê°œë³„ í’ˆëª© êµ¬ë§¤ì™„ë£Œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { \n            purchaseId: purchase.id, \n            itemId: item.id \n          });\n        }\n      }\n\n      toast.success(`${pendingItems.length}ê°œ í’ˆëª©ì´ êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.`);\n\n      // ğŸš€ ìƒˆë¡œê³ ì¹¨ (ê°œë³„ í’ˆëª©ê³¼ ë™ì¼)\n      await refreshModalData();\n      const refreshResult = onRefresh?.(true, { silent: true });\n      if (refreshResult instanceof Promise) {\n        await refreshResult;\n      }\n    } catch (error) {\n      logger.error('ì „ì²´ êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ ì˜¤ë¥˜', error);\n      toast.error('êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n\n  // UTK í™•ì¸ ì²˜ë¦¬ í•¨ìˆ˜\n  const handleUtkToggle = async (itemId: number | string, isChecked: boolean) => {\n    if (!canReceiptCheck) {\n      toast.error('UTK í™•ì¸ ì²˜ë¦¬ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.')\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      toast.error('ìœ íš¨í•˜ì§€ ì•Šì€ í•­ëª© ID ì…ë‹ˆë‹¤.')\n      return\n    }\n\n    // í•´ë‹¹ í’ˆëª© ì •ë³´ ì°¾ê¸°\n    const targetItem = purchase?.items?.find(item => String(item.id) === itemIdStr)\n    if (!targetItem) return\n\n    const itemInfo = `í’ˆëª…: ${targetItem.item_name}\nê·œê²©: ${targetItem.specification || 'ë¯¸ì…ë ¥'}\nìˆ˜ëŸ‰: ${targetItem.quantity?.toLocaleString() || 0}${targetItem.unit || ''}\në‹¨ê°€: â‚©${targetItem.unit_price_value?.toLocaleString() || 0}\ní•©ê³„: â‚©${targetItem.amount_value?.toLocaleString() || 0}`\n\n    const confirmMessage = isChecked \n      ? `ë‹¤ìŒ í’ˆëª©ì„ UTK í™•ì¸ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\\n\\n${itemInfo}` \n      : `ë‹¤ìŒ í’ˆëª©ì˜ UTK í™•ì¸ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\\n\\n${itemInfo}`\n    \n    const confirm = window.confirm(confirmMessage)\n    if (!confirm) return\n\n    try {\n      const supabase = createClient()\n      \n      const { data, error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_utk_checked: isChecked\n        })\n        .eq('id', numericId)\n        .select()\n\n      if (error) {\n        logger.error('UTK í™•ì¸ DB ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { error, itemId: numericId, isChecked })\n        throw error\n      }\n      \n      // ğŸš€ ë©”ëª¨ë¦¬ ìºì‹œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸\n      if (purchase?.id) {\n        const memoryUpdated = markItemAsUtkChecked(purchase.id, numericId, isChecked)\n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal] ë©”ëª¨ë¦¬ ìºì‹œ UTK í™•ì¸ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { \n            purchaseId: purchase.id, \n            itemId: numericId,\n            isChecked\n          })\n        }\n      }\n\n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (UI ì¦‰ì‹œ ë°˜ì˜)\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          String(item.id) === itemIdStr \n            ? { ...item, is_utk_checked: isChecked }\n            : item\n        )\n        return { ...prev, items: updatedItems }\n      })\n\n      if (purchase) {\n        const purchaseIdNumber = Number(purchase.id)\n        if (!Number.isNaN(purchaseIdNumber)) {\n          onOptimisticUpdate?.(purchaseIdNumber, prev => {\n            const updatedItems = (prev.items || []).map(item =>\n              String(item.id) === itemIdStr\n                ? { ...item, is_utk_checked: isChecked }\n                : item\n            )\n            const total = updatedItems.length || prev.items?.length || 0\n            const checked = updatedItems.filter(item => item.is_utk_checked).length\n            const allChecked = total > 0 && checked === total\n            return {\n              ...prev,\n              items: updatedItems,\n              is_utk_checked: allChecked\n            }\n          })\n        }\n      }\n\n      // ëª¨ë“  í’ˆëª©ì´ í™•ì¸ë˜ë©´ purchase_requestsì—ë„ ì—…ë°ì´íŠ¸\n      const allChecked = purchase?.items?.every(item => {\n        if (String(item.id) === itemIdStr) {\n          return isChecked\n        }\n        return item.is_utk_checked === true\n      })\n\n      if (allChecked !== undefined && purchase) {\n        const { error: updateError } = await supabase\n          .from('purchase_requests')\n          .update({ is_utk_checked: allChecked })\n          .eq('id', purchase.id)\n          .select()\n        \n        if (updateError) {\n          logger.error('purchase_requests ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { error: updateError, purchaseId: purchase.id, allChecked })\n        }\n      }\n      \n      toast.success(isChecked ? 'UTK í™•ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.' : 'UTK í™•ì¸ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.')\n\n      // ìƒì„¸ ëª¨ë‹¬ ë° ìƒìœ„ ë¦¬ìŠ¤íŠ¸ ëª¨ë‘ ìµœì‹  ìƒíƒœë¡œ ë™ê¸°í™”\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      logger.error('UTK í™•ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜', error)\n      toast.error('UTK í™•ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n\n  // ì „ì²´ UTK í™•ì¸ ì²˜ë¦¬ (ê°œë³„ í’ˆëª©ë³„ ì²˜ë¦¬ ë°©ì‹)\n  const handleCompleteAllUtk = async () => {\n    if (!purchase || !canReceiptCheck) return\n    \n    const confirmMessage = `ë°œì£¼ë²ˆí˜¸: ${purchase.purchase_order_number}\\n\\nì „ì²´ UTK í™•ì¸ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`\n    const confirm = window.confirm(confirmMessage)\n    if (!confirm) return\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const allItems = prev.purchase_request_items || [];\n          const pendingItems = allItems.filter(item => !item.is_utk_checked);\n          \n          const updatedItems = allItems.map(item => \n            !item.is_utk_checked \n              ? { ...item, is_utk_checked: true }\n              : item\n          );\n          \n          return {\n            ...prev,\n            purchase_request_items: updatedItems,\n            items: prev.items ? updatedItems : prev.items,\n            is_utk_checked: updatedItems.every(item => item.is_utk_checked)\n          }\n        })\n      }\n    }\n    \n    try {\n      // ğŸš€ ë¯¸ì™„ë£Œ í’ˆëª©ë§Œ í•„í„°ë§ (ì´ë¯¸ UTK í™•ì¸ëœ í’ˆëª© ì œì™¸)\n      const allItems = purchase.purchase_request_items || [];\n      const pendingItems = allItems.filter(item => !item.is_utk_checked);\n      \n      if (pendingItems.length === 0) {\n        toast.info('ëª¨ë“  í’ˆëª©ì´ ì´ë¯¸ UTK í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.');\n        return;\n      }\n\n      logger.info(`ì „ì²´ UTK í™•ì¸ ì²˜ë¦¬: ${pendingItems.length}ê°œ í’ˆëª© (ì´ ${allItems.length}ê°œ ì¤‘)`);\n      \n      for (const item of pendingItems) {\n        // ê° í’ˆëª©ë³„ë¡œ DB ì—…ë°ì´íŠ¸ (ê°œë³„ í’ˆëª©ê³¼ ë™ì¼í•œ ë°©ì‹)\n        const updateData = {\n          is_utk_checked: true\n        };\n\n        const { error } = await supabase\n          .from('purchase_request_items')\n          .update(updateData)\n          .eq('id', item.id);\n\n        if (error) throw error;\n\n        // ğŸš€ ê°œë³„ í’ˆëª© ë©”ëª¨ë¦¬ ìºì‹œ ì—…ë°ì´íŠ¸ (ê°œë³„ ì²˜ë¦¬ì™€ ë™ì¼)\n        const memoryUpdated = markItemAsUtkChecked(purchase.id, item.id, true);\n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal] ë©”ëª¨ë¦¬ ìºì‹œ ê°œë³„ í’ˆëª© UTK í™•ì¸ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { \n            purchaseId: purchase.id, \n            itemId: item.id \n          });\n        }\n      }\n\n      toast.success(`${pendingItems.length}ê°œ í’ˆëª©ì˜ UTK í™•ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`);\n\n      // ğŸš€ ìƒˆë¡œê³ ì¹¨ (ê°œë³„ í’ˆëª©ê³¼ ë™ì¼)\n      await refreshModalData();\n      const refreshResult = onRefresh?.(true, { silent: true });\n      if (refreshResult instanceof Promise) {\n        await refreshResult;\n      }\n    } catch (error) {\n      logger.error('ì „ì²´ UTK í™•ì¸ ì²˜ë¦¬ ì˜¤ë¥˜', error);\n      toast.error('UTK í™•ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n\n  // ì „ì²´ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ì²˜ë¦¬ (ê°œë³„ í’ˆëª©ë³„ ì²˜ë¦¬ ë°©ì‹)\n  const handleCompleteAllStatement = async (selectedDate: Date) => {\n    if (!purchase || !canReceiptCheck) {\n      return\n    }\n\n    const formattedDate = selectedDate.toLocaleDateString('ko-KR', {\n      year: 'numeric',\n      month: '2-digit',\n      day: '2-digit'\n    })\n\n    const confirmMessage = `ë°œì£¼ë²ˆí˜¸: ${purchase.purchase_order_number}\n\nì „ì²´ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`\n    \n    if (!window.confirm(confirmMessage)) {\n      return\n    }\n\n    const selectedDateIso = selectedDate.toISOString()\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const allItems = prev.purchase_request_items || [];\n          const pendingItems = allItems.filter(item => !item.is_statement_received);\n          \n          const updatedItems = allItems.map(item => \n            !item.is_statement_received \n              ? { \n                  ...item, \n                  is_statement_received: true, \n                  statement_received_date: selectedDateIso,\n                  statement_received_by_name: currentUserName || null\n                }\n              : item\n          );\n          \n          return {\n            ...prev,\n            purchase_request_items: updatedItems,\n            items: prev.items ? updatedItems : prev.items,\n            is_statement_received: updatedItems.every(item => item.is_statement_received),\n            statement_received_at: selectedDateIso\n          }\n        })\n      }\n    }\n\n    try {\n      // ğŸš€ ë¯¸ì™„ë£Œ í’ˆëª©ë§Œ í•„í„°ë§ (ì´ë¯¸ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ëœ í’ˆëª© ì œì™¸)\n      const allItems = purchase.purchase_request_items || [];\n      const pendingItems = allItems.filter(item => !item.is_statement_received);\n      \n      if (pendingItems.length === 0) {\n        toast.info('ëª¨ë“  í’ˆëª©ì˜ ê±°ë˜ëª…ì„¸ì„œê°€ ì´ë¯¸ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.');\n        return;\n      }\n\n      logger.info(`ì „ì²´ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ì²˜ë¦¬: ${pendingItems.length}ê°œ í’ˆëª© (ì´ ${allItems.length}ê°œ ì¤‘)`);\n      \n      for (const item of pendingItems) {\n        // ê° í’ˆëª©ë³„ë¡œ DB ì—…ë°ì´íŠ¸ (ê°œë³„ í’ˆëª©ê³¼ ë™ì¼í•œ ë°©ì‹)\n        const updateData = {\n          is_statement_received: true,\n          statement_received_date: selectedDateIso,\n          statement_received_by_name: currentUserName || null\n        };\n\n        const { error } = await supabase\n          .from('purchase_request_items')\n          .update(updateData)\n          .eq('id', item.id);\n\n        if (error) throw error;\n\n        // ğŸš€ ê°œë³„ í’ˆëª© ë©”ëª¨ë¦¬ ìºì‹œ ì—…ë°ì´íŠ¸ (ê°œë³„ ì²˜ë¦¬ì™€ ë™ì¼)\n        const memoryUpdated = markItemAsStatementReceived(purchase.id, item.id, selectedDateIso, currentUserName || undefined);\n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal] ë©”ëª¨ë¦¬ ìºì‹œ ê°œë³„ í’ˆëª© ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { \n            purchaseId: purchase.id, \n            itemId: item.id \n          });\n        }\n      }\n\n      toast.success(`${pendingItems.length}ê°œ í’ˆëª©ì˜ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`);\n\n      // ğŸš€ ìƒˆë¡œê³ ì¹¨ (ê°œë³„ í’ˆëª©ê³¼ ë™ì¼)\n      await refreshModalData();\n      const refreshResult = onRefresh?.(true, { silent: true });\n      if (refreshResult instanceof Promise) {\n        await refreshResult;\n      }\n    } catch (error) {\n      logger.error('ì „ì²´ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ì²˜ë¦¬ ì˜¤ë¥˜', error)\n      toast.error('ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n\n  // ì „ì²´ ì…ê³ ì™„ë£Œ ì²˜ë¦¬ (ë‚ ì§œ ì„ íƒ)\n  const handleCompleteAllReceipt = async (selectedDate: Date) => {\n    if (!purchase || !canReceiveItems) {\n      return\n    }\n\n    // í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ\n    const confirmMessage = `ë°œì£¼ë²ˆí˜¸: ${purchase.purchase_order_number}\n\nì „ì²´ ì…ê³ ì™„ë£Œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`\n    \n    if (!window.confirm(confirmMessage)) {\n      return\n    }\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item => ({\n            ...item,\n            is_received: true,\n            actual_received_date: item.actual_received_date || selectedDate.toISOString()\n          }))\n\n          return {\n            ...prev,\n            items: updatedItems,\n            is_received: true,\n            received_at: new Date().toISOString()\n          }\n        })\n      }\n    }\n\n    try {\n      // ğŸš€ ë¯¸ì™„ë£Œ í’ˆëª©ë§Œ í•„í„°ë§ (ì´ë¯¸ ì…ê³ ì™„ë£Œëœ í’ˆëª© ì œì™¸)\n      const allItems = purchase.purchase_request_items || [];\n      const pendingItems = allItems.filter(item => !item.is_received);\n      \n      if (pendingItems.length === 0) {\n        toast.info('ëª¨ë“  í’ˆëª©ì´ ì´ë¯¸ ì…ê³ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');\n        return;\n      }\n\n      logger.info(`ì „ì²´ ì…ê³ ì™„ë£Œ ì²˜ë¦¬: ${pendingItems.length}ê°œ í’ˆëª© (ì´ ${allItems.length}ê°œ ì¤‘)`);\n      \n      for (const item of pendingItems) {\n        // ê° í’ˆëª©ë³„ë¡œ DB ì—…ë°ì´íŠ¸ (ê°œë³„ í’ˆëª©ê³¼ ë™ì¼í•œ ë°©ì‹)\n        const updateData = {\n          actual_received_date: selectedDate.toISOString(),\n          is_received: true\n        };\n\n        const { error } = await supabase\n          .from('purchase_request_items')\n          .update(updateData)\n          .eq('id', item.id);\n\n        if (error) throw error;\n\n        // ğŸš€ ê°œë³„ í’ˆëª© ë©”ëª¨ë¦¬ ìºì‹œ ì—…ë°ì´íŠ¸ (ê°œë³„ ì²˜ë¦¬ì™€ ë™ì¼)\n        const memoryUpdated = markItemAsReceived(purchase.id, item.id, selectedDate.toISOString());\n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal] ë©”ëª¨ë¦¬ ìºì‹œ ê°œë³„ í’ˆëª© ì…ê³ ì™„ë£Œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨', { \n            purchaseId: purchase.id, \n            itemId: item.id \n          });\n        }\n      }\n\n      toast.success(`${pendingItems.length}ê°œ í’ˆëª©ì´ ì…ê³ ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.`);\n\n      // ğŸš€ ìƒˆë¡œê³ ì¹¨ (ê°œë³„ í’ˆëª©ê³¼ ë™ì¼)\n      await refreshModalData();\n      const refreshResult = onRefresh?.(true, { silent: true });\n      if (refreshResult instanceof Promise) {\n        await refreshResult;\n      }\n    } catch (error) {\n      logger.error('ì „ì²´ ì…ê³ ì™„ë£Œ ì²˜ë¦¬ ì˜¤ë¥˜', error)\n      toast.error('ì…ê³ ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n  \n\n  // ë°˜ë ¤ ì²˜ë¦¬\n  const handleReject = async (type: 'middle' | 'final') => {\n    if (!purchase) return\n    \n    const reason = window.prompt('ë°˜ë ¤ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”:')\n    if (!reason) return\n    \n    try {\n      const updateData = type === 'middle'\n        ? {\n            middle_manager_status: 'rejected'\n          }\n        : {\n            final_manager_status: 'rejected'\n          }\n      \n      const { error } = await supabase\n        .from('purchase_requests')\n        .update(updateData)\n        .eq('id', purchase.id)\n      \n      if (error) {\n        throw error\n      }\n      \n      // ë¡œì»¬ ìƒíƒœ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (UI ì¦‰ì‹œ ë°˜ì˜)\n      if (type === 'middle') {\n        setPurchase(prev => prev ? { ...prev, middle_manager_status: 'rejected' } : null)\n      } else {\n        setPurchase(prev => prev ? { ...prev, final_manager_status: 'rejected' } : null)\n      }\n      \n      toast.success(`${type === 'middle' ? 'ì¤‘ê°„' : 'ìµœì¢…'} ë°˜ë ¤ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`)\n    } catch (error) {\n      toast.error('ë°˜ë ¤ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    }\n  }\n\n  const content = (\n    <div className=\"space-y-1 sm:space-y-4\">\n      {loading ? (\n        <div className=\"flex items-center justify-center py-12\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-hansl-600\"></div>\n        </div>\n      ) : purchase ? (\n        <div>\n          {/* Compact Info Header */}\n          <div className=\"bg-gray-50 rounded-lg p-2 sm:p-3 mb-1 sm:mb-2 border border-gray-100\">\n            <div className=\"grid grid-cols-1 sm:grid-cols-3 items-center gap-3 sm:gap-0\">\n              <div className=\"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-4\">\n                <div className=\"flex items-center gap-3\">\n                  {getStatusBadge()}\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"modal-label\">ìš”ì²­ì:</span>\n                    <span className=\"modal-value\">{purchase.requester_name}</span>\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Calendar className=\"w-3 h-3 text-gray-500\" />\n                  <span className=\"modal-subtitle\">ì²­êµ¬ì¼: {formatDate(purchase.request_date)}</span>\n                </div>\n              </div>\n              \n              {/* ìŠ¹ì¸ ë²„íŠ¼ë“¤ì„ ì¤‘ì•™ì— ë°°ì¹˜ */}\n              <div className=\"flex items-center justify-center gap-2 sm:gap-3 flex-wrap\">\n                {/* 1ì°¨ ìŠ¹ì¸ ë²„íŠ¼ */}\n                {(() => {\n                  const shouldShow = canApproveMiddle && purchase.middle_manager_status === 'pending';\n                  return shouldShow;\n                })() && (\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => handleApprove('middle')}\n                    className={`${approvalButtonClass} border border-gray-400 bg-white hover:bg-gray-50 hover:border-gray-500`}\n                  >\n                    1ì°¨ ìŠ¹ì¸ ëŒ€ê¸°\n                  </Button>\n                )}\n                {purchase.middle_manager_status === 'approved' && (\n                  <div className=\"button-approved badge-text shadow-sm\">\n                    <Check className=\"w-3 h-3\" />\n                    1ì°¨ ìŠ¹ì¸ì™„ë£Œ\n                  </div>\n                )}\n                {purchase.middle_manager_status === 'rejected' && (\n                  <div className=\"button-rejected badge-text\">\n                    <X className=\"w-3 h-3\" />\n                    1ì°¨ ë°˜ë ¤\n                  </div>\n                )}\n                {purchase.middle_manager_status === 'pending' && !canApproveMiddle && (\n                  <div className={`${approvalWaitingPillClass} border border-gray-300 text-gray-600 bg-white`}>\n                    1ì°¨ ìŠ¹ì¸ëŒ€ê¸°\n                  </div>\n                )}\n\n                {/* ìµœì¢… ìŠ¹ì¸ ë²„íŠ¼ */}\n                {(() => {\n                  const shouldShow = canApproveFinal && purchase.middle_manager_status === 'approved' && purchase.final_manager_status === 'pending';\n                  return shouldShow;\n                })() && (\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => handleApprove('final')}\n                    className={`${approvalButtonClass} border border-gray-400 bg-white hover:bg-gray-50 hover:border-gray-500`}\n                  >\n                    <Check className=\"w-3 h-3\" />\n                    ìµœì¢… ìŠ¹ì¸\n                  </Button>\n                )}\n                {purchase.final_manager_status === 'approved' && (\n                  <div className=\"button-approved badge-text\">\n                    <Check className=\"w-3 h-3\" />\n                    ìµœì¢… ìŠ¹ì¸ì™„ë£Œ\n                  </div>\n                )}\n                {purchase.final_manager_status === 'rejected' && (\n                  <div className=\"button-rejected badge-text\">\n                    <X className=\"w-3 h-3\" />\n                    ìµœì¢… ë°˜ë ¤\n                  </div>\n                )}\n                {purchase.middle_manager_status !== 'approved' && purchase.final_manager_status === 'pending' && (\n                  <div className={`${approvalWaitingPillClass} border border-gray-300 text-gray-600 bg-white`}>\n                    ìµœì¢… ìŠ¹ì¸ëŒ€ê¸°\n                  </div>\n                )}\n              </div>\n              \n              {/* ìš°ì¸¡ ë¹ˆ ì˜ì—­ */}\n              <div></div>\n            </div>\n          </div>\n\n          {/* Main 2-Column Layout */}\n          <div className=\"flex flex-col lg:flex-row gap-3 sm:gap-6\">\n            {/* Left Column - Basic Info (Fixed Width) */}\n            <div className=\"lg:w-80 lg:flex-shrink-0 space-y-1 sm:space-y-4 relative\">\n              \n              {/* ë°œì£¼ ê¸°ë³¸ì •ë³´ */}\n              <div className=\"bg-white rounded-lg p-2 sm:p-3 border border-gray-100 shadow-sm\">\n                <div className=\"mb-3\">\n                  <h3 className=\"modal-section-title flex items-center\">\n                    <FileText className=\"w-4 h-4 mr-2 text-gray-600\" />\n                    {purchase?.purchase_order_number || 'POë²ˆí˜¸ ì—†ìŒ'}\n                  </h3>\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">ë°œì£¼ì„œ ì¢…ë¥˜</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.request_type || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, request_type: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"ì¼ë°˜\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.request_type || 'ì¼ë°˜'}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">ê²°ì œ ì¢…ë¥˜</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.payment_category || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, payment_category: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"ë°œì£¼/êµ¬ë§¤ìš”ì²­/í˜„ì¥ê²°ì œ\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.payment_category || '-'}</p>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">ì…ê³  ìš”ì²­ì¼</span>\n                      {isEditing ? (\n                        <DatePickerPopover\n                          onDateSelect={(date) => {\n                            setEditedPurchase(prev => prev ? {\n                              ...prev,\n                              delivery_request_date: formatDateInput(date, 'yyyy-MM-dd')\n                            } : null)\n                          }}\n                          placeholder=\"ì…ê³  ìš”ì²­ì¼ì„ ì„ íƒí•˜ì„¸ìš”\"\n                          align=\"start\"\n                          side=\"bottom\"\n                        >\n                          <Button\n                            variant=\"outline\"\n                            className=\"mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] justify-start text-left font-normal business-radius-input\"\n                          >\n                            <Calendar className=\"mr-1 h-3 w-3\" />\n                            {editedPurchase?.delivery_request_date ? \n                              formatDate(editedPurchase.delivery_request_date) : \n                              'ë‚ ì§œ ì„ íƒ'\n                            }\n                          </Button>\n                        </DatePickerPopover>\n                      ) : (\n                        <p className=\"modal-subtitle\">{formatDate(purchase.delivery_request_date)}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label text-orange-500\">ë³€ê²½ ì…ê³ ì¼</span>\n                      {isEditing ? (\n                        <DatePickerPopover\n                          onDateSelect={(date) => {\n                            setEditedPurchase(prev => prev ? {\n                              ...prev,\n                              revised_delivery_request_date: formatDateInput(date, 'yyyy-MM-dd')\n                            } : null)\n                          }}\n                          placeholder=\"ë³€ê²½ ì…ê³ ì¼ì„ ì„ íƒí•˜ì„¸ìš”\"\n                          align=\"start\"\n                          side=\"bottom\"\n                        >\n                          <Button\n                            variant=\"outline\"\n                            className=\"mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] justify-start text-left font-normal business-radius-input\"\n                          >\n                            <Calendar className=\"mr-1 h-3 w-3\" />\n                            {editedPurchase?.revised_delivery_request_date ? \n                              formatDate(editedPurchase.revised_delivery_request_date) : \n                              'ë‚ ì§œ ì„ íƒ'\n                            }\n                          </Button>\n                        </DatePickerPopover>\n                      ) : (\n                        <p className=\"modal-subtitle text-orange-700\">\n                          {purchase.revised_delivery_request_date ? formatDate(purchase.revised_delivery_request_date) : 'ë¯¸ì„¤ì •'}\n                        </p>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/* ì—…ì²´ ì •ë³´ */}\n              <div className=\"bg-white rounded-lg p-2 sm:p-3 border border-gray-100 shadow-sm\">\n                <h3 className=\"modal-section-title mb-3 flex items-center\">\n                  <Building2 className=\"w-4 h-4 mr-2 text-gray-600\" />\n                  ì—…ì²´ ì •ë³´\n                </h3>\n                \n                <div className=\"space-y-2\">\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">ì—…ì²´ëª…</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.vendor?.vendor_name || editedPurchase?.vendor_name || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, vendor_name: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"ì—…ì²´ ì„ íƒ\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.vendor?.vendor_name || '-'}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">ì—…ì²´ ë‹´ë‹¹ì</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.vendor_contacts?.[0]?.contact_name || ''}\n                          onChange={(e) => {\n                            setEditedPurchase(prev => {\n                              if (!prev) return null;\n                              const contacts = prev.vendor_contacts || [];\n                              const updatedContacts = [...contacts];\n                              if (updatedContacts[0]) {\n                                updatedContacts[0] = { ...updatedContacts[0], contact_name: e.target.value };\n                              } else {\n                                updatedContacts[0] = { contact_name: e.target.value } as any;\n                              }\n                              return { ...prev, vendor_contacts: updatedContacts };\n                            })\n                          }}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"ë‹´ë‹¹ì ì„ íƒ\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.vendor_contacts?.[0]?.contact_name || '-'}</p>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">PJì—…ì²´</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.project_vendor || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, project_vendor: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"ì…ë ¥\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.project_vendor || '-'}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">Item</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.project_item || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, project_item: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"ì…ë ¥\"\n                        />\n                      ) : (\n                        <p className=\"modal-subtitle\">{purchase.project_item || '-'}</p>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">ìˆ˜ì£¼ë²ˆí˜¸</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.order_number || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, order_number: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"ì…ë ¥\"\n                        />\n                      ) : (\n                        <p className=\"modal-subtitle\">{purchase.order_number || '-'}</p>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n            </div>\n\n            {/* Right Column - Items List (Flexible Width) */}\n            <div className=\"lg:flex-1 lg:min-w-0 relative overflow-visible\">\n              \n              <div className=\"bg-white rounded-lg border border-gray-100 overflow-hidden shadow-sm\">\n                <div className=\"p-2 sm:p-3 bg-gray-50 border-b border-gray-100 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-0\">\n                  <h3 className=\"modal-section-title flex items-center\">\n                    <Package className=\"w-4 h-4 mr-2 text-gray-600\" />\n                    í’ˆëª© ë¦¬ìŠ¤íŠ¸\n                    <span className=\"ml-2 badge-stats bg-gray-500 text-white\">\n                      {currentItems?.length || 0}ê°œ\n                    </span>\n                  </h3>\n                  {!isEditing && (\n                    <>\n                      {activeTab === 'purchase' && canPurchase && (\n                        <Button\n                          size=\"sm\"\n                          onClick={handleCompleteAllPayment}\n                          className=\"button-base bg-orange-500 hover:bg-orange-600 text-white\"\n                        >\n                          <CreditCard className=\"w-3 h-3 mr-1\" />\n                          ì „ì²´ êµ¬ë§¤ì™„ë£Œ\n                        </Button>\n                      )}\n                      {activeTab === 'receipt' && canReceiveItems && (\n                        <DatePickerPopover\n                          onDateSelect={handleCompleteAllReceipt}\n                          placeholder=\"ì „ì²´ ì…ê³ ì™„ë£Œ ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”\"\n                          align=\"end\"\n                          side=\"bottom\"\n                        >\n                          <Button\n                            size=\"sm\"\n                            className=\"button-base button-action-primary\"\n                          >\n                            <Truck className=\"w-3 h-3 mr-1\" />\n                            ì „ì²´ ì…ê³ ì™„ë£Œ\n                          </Button>\n                        </DatePickerPopover>\n                      )}\n                      {activeTab === 'done' && canReceiptCheck && (\n                        <div className=\"flex items-center gap-2\">\n                          <DatePickerPopover\n                            onDateSelect={handleCompleteAllStatement}\n                            placeholder=\"ì „ì²´ íšŒê³„ìƒ ì…ê³ ì¼ì„ ì„ íƒí•˜ì„¸ìš”\"\n                            align=\"end\"\n                            side=\"bottom\"\n                          >\n                            <Button\n                              size=\"sm\"\n                              className=\"button-base button-action-primary\"\n                            >\n                              <FileText className=\"w-3 h-3 mr-1\" />\n                              ê±°ë˜ëª…ì„¸ì„œ í™•ì¸\n                            </Button>\n                          </DatePickerPopover>\n                          <Button\n                            size=\"sm\"\n                            onClick={handleCompleteAllUtk}\n                            className=\"button-base bg-orange-500 hover:bg-orange-600 text-white\"\n                          >\n                            <CheckCircle className=\"w-3 h-3 mr-1\" />\n                            UTK í™•ì¸\n                          </Button>\n                        </div>\n                      )}\n                    </>\n                  )}\n                </div>\n                \n                {/* Mobile Table Header */}\n                <div className=\"block sm:hidden bg-gray-50 px-2 py-1 border-b border-gray-100\">\n                  <div className=\"text-xs font-medium text-gray-600\">í’ˆëª© ëª©ë¡ (í„°ì¹˜í•˜ì—¬ ìŠ¤í¬ë¡¤)</div>\n                </div>\n                \n                {/* Items List with Header Inside Scrollable Container */}\n                <div className=\"max-h-[50vh] sm:max-h-[40vh] w-full min-w-0 overflow-auto\">\n                  <div style={{ minWidth: `${tableMinWidth}px` }}>\n                    {/* Items Table Header - Sticky inside scroll container */}\n                    <div className=\"bg-gray-50 px-2 sm:px-3 py-1 border-b border-gray-100 sticky top-0 z-10\">\n                      <div \n                        ref={headerRowRef}\n                         className=\"hidden sm:grid gap-2 modal-label\"\n                        style={{\n                          gridTemplateColumns: getGridTemplateColumns()\n                        }}\n                      >\n                        <div>í’ˆëª©ëª…</div>\n                        <div>ê·œê²©</div>\n                        <div className=\"text-center\">ìˆ˜ëŸ‰</div>\n                        <div className=\"text-right\">ë‹¨ê°€</div>\n                        <div className=\"text-right\">í•©ê³„</div>\n                        <div className=\"text-center\">ë¹„ê³ </div>\n                        {isEditing ? (\n                          <>\n                            <div className=\"text-center\">ì‚­ì œ</div>\n                            {activeTab === 'receipt' && (\n                              <>\n                                <div className=\"text-center\">ì‹¤ì œì…ê³ ì¼</div>\n                              </>\n                            )}\n                            {activeTab === 'done' && (\n                              <>\n                                <div className=\"text-center\">ê±°ë˜ëª…ì„¸ì„œ í™•ì¸</div>\n                                <div className=\"text-center\">íšŒê³„ìƒ ì…ê³ ì¼</div>\n                                <div className=\"text-center\">UTK</div>\n                              </>\n                            )}\n                          </>\n                        ) : (\n                          <>\n                            <div className=\"text-center\">\n                              {activeTab === 'purchase'\n                                ? 'êµ¬ë§¤ìƒíƒœ'\n                                : (activeTab === 'receipt' || activeTab === 'done')\n                                ? 'ì…ê³ ìƒíƒœ'\n                                : 'ìƒíƒœ'}\n                            </div>\n                            {activeTab === 'done' && (\n                              <>\n                                <div className=\"text-center\">ê±°ë˜ëª…ì„¸ì„œ í™•ì¸</div>\n                                <div className=\"text-center\">íšŒê³„ìƒ ì…ê³ ì¼</div>\n                                <div className=\"text-center\">UTK</div>\n                              </>\n                            )}\n                            {activeTab === 'receipt' && (\n                              <>\n                                <div className=\"text-center\">ì‹¤ì œì…ê³ ì¼</div>\n                              </>\n                            )}\n                          </>\n                        )}\n                      </div>\n                    </div>\n                    <div className=\"divide-y divide-gray-100 overflow-visible\">\n                      {(isEditing ? editedItems : currentItems)?.map((item, index) => (\n                        <div key={index} className=\"px-2 sm:px-3 py-1 border-b border-gray-50 hover:bg-gray-50/50 relative overflow-visible\">\n                          {/* Desktop Layout */}\n                          <div className={`hidden sm:grid items-center gap-2 overflow-visible`} style={{\n                            gridTemplateColumns: getGridTemplateColumns()\n                          }}>\n                            {/* í’ˆëª©ëª… */}\n                            <div className=\"min-w-0 relative overflow-visible flex items-center\">\n                              {isEditing ? (\n                                <Input\n                                  value={item.item_name}\n                                  onChange={(e) => handleItemChange(index, 'item_name', e.target.value)}\n                                  onFocus={() => setFocusedInput(`item_name_${index}`)}\n                                  onBlur={() => setFocusedInput(null)}\n                                  className={`modal-label border-gray-200 rounded-lg w-full !px-1.5 !py-0.5 !text-[10px] focus:border-blue-400 transition-all duration-200 ${\n                                    focusedInput === `item_name_${index}` \n                                      ? '!h-auto !min-h-[20px] !absolute !z-[9999] !bg-white !shadow-lg !left-0 !right-0 !-translate-y-1/2 !top-1/2 !whitespace-normal' \n                                      : '!h-5 !truncate'\n                                  }`}\n                                  placeholder=\"í’ˆëª©ëª…\"\n                                  disabled={canEditLimited && !canEditAll}  // lead buyerëŠ” í’ˆëª©ëª… ìˆ˜ì • ë¶ˆê°€\n                                />\n                              ) : (\n                                <div \n                                  className=\"modal-value\" \n                                  style={{\n                                    whiteSpace: 'normal',\n                                    wordBreak: 'break-all', // ì–´ë””ì„œë“  ì¤„ë°”ê¿ˆ ê°€ëŠ¥ (í•˜ì´í”ˆ ë¬´ì‹œ)\n                                    overflowWrap: 'break-word',\n                                    hyphens: 'none', // í•˜ì´í”ˆì—ì„œ ìë™ ì¤„ë°”ê¿ˆ ë°©ì§€\n                                    WebkitHyphens: 'none',\n                                    MozHyphens: 'none',\n                                    msHyphens: 'none',\n                                    lineHeight: '1.4',\n                                    maxHeight: '2.8em', // ìµœëŒ€ 2í–‰ ë†’ì´\n                                    overflow: 'hidden',\n                                    display: '-webkit-box',\n                                    WebkitLineClamp: 2,\n                                    WebkitBoxOrient: 'vertical'\n                                  }}\n                                  title={item.item_name || 'í’ˆëª©ëª… ì—†ìŒ'}\n                                >\n                                  {item.item_name || 'í’ˆëª©ëª… ì—†ìŒ'}\n                                </div>\n                              )}\n                            </div>\n                            \n                            {/* ê·œê²© */}\n                            <div className=\"min-w-0 relative overflow-visible flex items-center\" style={{ width: '200px', maxWidth: '200px', minWidth: '200px' }}>\n                              {isEditing ? (\n                                <Input\n                                  value={item.specification}\n                                  onChange={(e) => handleItemChange(index, 'specification', e.target.value)}\n                                  onFocus={() => setFocusedInput(`specification_${index}`)}\n                                  onBlur={() => setFocusedInput(null)}\n                                  className={`modal-label border-gray-200 rounded-lg w-full !px-1.5 !py-0.5 !text-[10px] focus:border-blue-400 transition-all duration-200 ${\n                                    focusedInput === `specification_${index}` \n                                      ? '!h-auto !min-h-[20px] !absolute !z-[9999] !bg-white !shadow-lg !left-1/2 !-translate-x-1/2 !-translate-y-1/2 !top-1/2 !whitespace-normal !w-[300px]' \n                                      : '!h-5 !truncate'\n                                  }`}\n                                  placeholder=\"ê·œê²©\"\n                                  disabled={canEditLimited && !canEditAll}  // lead buyerëŠ” ê·œê²© ìˆ˜ì • ë¶ˆê°€\n                                />\n                              ) : (\n                                <div \n                                  className=\"text-[11px] text-gray-600 font-medium\" \n                                  style={{\n                                    whiteSpace: 'normal',\n                                    wordBreak: 'break-all', // ì–´ë””ì„œë“  ì¤„ë°”ê¿ˆ ê°€ëŠ¥ (í•˜ì´í”ˆ ë¬´ì‹œ)\n                                    overflowWrap: 'break-word',\n                                    hyphens: 'none', // í•˜ì´í”ˆì—ì„œ ìë™ ì¤„ë°”ê¿ˆ ë°©ì§€\n                                    WebkitHyphens: 'none', // Safari ì§€ì›\n                                    MozHyphens: 'none', // Firefox ì§€ì›\n                                    msHyphens: 'none', // IE ì§€ì›\n                                    lineHeight: '1.4',\n                                    maxHeight: '2.8em', // ìµœëŒ€ 2í–‰ ë†’ì´\n                                    overflow: 'hidden',\n                                    display: '-webkit-box',\n                                    WebkitLineClamp: 2, // ìµœëŒ€ 2í–‰ê¹Œì§€ë§Œ í‘œì‹œ\n                                    WebkitBoxOrient: 'vertical'\n                                  }}\n                                  title={item.specification || '-'}\n                                >\n                                  {item.specification || '-'}\n                                </div>\n                              )}\n                            </div>\n                            \n                            {/* ìˆ˜ëŸ‰ */}\n                            <div className=\"text-center min-w-0 flex items-center justify-center\">\n                              {isEditing ? (\n                                <Input\n                                  type=\"number\"\n                                  value={item.quantity}\n                                  onChange={(e) => handleItemChange(index, 'quantity', Number(e.target.value))}\n                                  className=\"border-gray-200 rounded-lg text-center w-full !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400\"\n                                  placeholder=\"ìˆ˜ëŸ‰\"\n                                  max=\"99999\"\n                                />\n                              ) : (\n                                <span className=\"modal-subtitle\">{item.quantity || 0}</span>\n                              )}\n                            </div>\n                            \n                            {/* ë‹¨ê°€ */}\n                            <div className=\"text-right min-w-0 flex items-center justify-end\">\n                              {isEditing ? (\n                                <Input\n                                  type=\"number\"\n                                  value={item.unit_price_value}\n                                  onChange={(e) => handleItemChange(index, 'unit_price_value', Number(e.target.value))}\n                                  className=\"border-gray-200 rounded-lg text-right w-full !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400\"\n                                  placeholder=\"ë‹¨ê°€\"\n                                  max=\"100000000000\"\n                                />\n                              ) : (\n                                <span className=\"modal-subtitle\">â‚©{formatCurrency(item.unit_price_value)}</span>\n                              )}\n                            </div>\n                            \n                            {/* í•©ê³„ (ìë™ê³„ì‚°, ìˆ˜ì • ë¶ˆê°€) */}\n                            <div className=\"text-right min-w-0 flex items-center justify-end\">\n                              <span className={isEditing ? \"modal-subtitle\" : \"modal-value\"}>â‚©{formatCurrency(item.amount_value || 0)}</span>\n                            </div>\n                            \n                            {/* ë¹„ê³  */}\n                            <div className=\"min-w-0 flex justify-center items-center text-center relative overflow-visible\" style={{ width: '150px', maxWidth: '150px', minWidth: '150px' }}>\n                              {isEditing ? (\n                                <Input\n                                  value={item.remark || ''}\n                                  disabled={canEditLimited && !canEditAll}  // lead buyerëŠ” ë¹„ê³  ìˆ˜ì • ë¶ˆê°€\n                                  onChange={(e) => handleItemChange(index, 'remark', e.target.value)}\n                                  onFocus={() => setFocusedInput(`remark_${index}`)}\n                                  onBlur={() => setFocusedInput(null)}\n                                  className={`modal-label border-gray-200 rounded-lg text-center w-full !px-1.5 !py-0.5 !text-[10px] focus:border-blue-400 transition-all duration-200 ${\n                                    focusedInput === `remark_${index}` \n                                      ? '!h-auto !min-h-[20px] !absolute !z-[9999] !bg-white !shadow-lg !left-0 !right-0 !-translate-y-1/2 !top-1/2 !whitespace-normal !text-left' \n                                      : '!h-5 !truncate'\n                                  }`}\n                                  placeholder=\"ë¹„ê³ \"\n                                />\n                              ) : (\n                                <div \n                                  className=\"text-[11px] text-gray-600 font-medium\"\n                                  style={{\n                                    width: '150px',\n                                    maxWidth: '150px',\n                                    minWidth: '150px',\n                                    boxSizing: 'border-box',\n                                    whiteSpace: 'normal',\n                                    wordBreak: 'break-all',\n                                    overflowWrap: 'break-word',\n                                    hyphens: 'none',\n                                    WebkitHyphens: 'none',\n                                    MozHyphens: 'none',\n                                    msHyphens: 'none',\n                                    lineHeight: '1.4',\n                                    maxHeight: '2.8em',\n                                    overflow: 'hidden',\n                                    display: '-webkit-box',\n                                    WebkitLineClamp: 2,\n                                    WebkitBoxOrient: 'vertical'\n                                  }}\n                                  title={item.remark || '-'}\n                                >\n                                  {item.remark || '-'}\n                                </div>\n                              )}\n                            </div>\n                            \n                            {/* ìƒíƒœ/ì•¡ì…˜ - ìŠ¹ì¸ëŒ€ê¸°íƒ­ì—ì„œëŠ” ì œì™¸ */}\n                            {activeTab !== 'pending' && (\n                              <div className=\"text-center flex justify-center items-center\">\n                                {isEditing ? (\n                                  <Button\n                                    size=\"sm\"\n                                    variant=\"ghost\"\n                                    onClick={() => handleRemoveItem(index)}\n                                    className=\"text-red-600 hover:bg-red-50 rounded-lg p-1 h-6 w-6\"\n                                  >\n                                    <Trash2 className=\"w-3 h-3\" />\n                                  </Button>\n                                ) : (\n                                  <>\n                                    {/* êµ¬ë§¤ íƒ­ì—ì„œì˜ êµ¬ë§¤ì™„ë£Œ ìƒíƒœ */}\n                                    {activeTab === 'purchase' && (\n                                    <div className=\"flex justify-center\">\n                                      {canPurchase ? (\n                                        <button\n                                          onClick={() => handlePaymentToggle(item.id, !item.is_payment_completed)}\n                                          className={`${\n                                            item.is_payment_completed\n                                              ? 'button-toggle-active bg-orange-500 hover:bg-orange-600 text-white'\n                                              : 'button-toggle-inactive'\n                                          }`}\n                                        >\n                                          {item.is_payment_completed ? 'êµ¬ë§¤ì™„ë£Œ' : 'êµ¬ë§¤ëŒ€ê¸°'}\n                                        </button>\n                                      ) : (\n                                        <span className={`${\n                                          item.is_payment_completed \n                                            ? 'button-toggle-active bg-orange-500 text-white' \n                                            : 'button-waiting-inactive'\n                                        }`}>\n                                          {item.is_payment_completed ? 'êµ¬ë§¤ì™„ë£Œ' : 'êµ¬ë§¤ëŒ€ê¸°'}\n                                        </span>\n                                      )}\n                                    </div>\n                                  )}\n                                  \n                                  {/* ì…ê³  íƒ­ì—ì„œì˜ ì…ê³ ì™„ë£Œ ìƒíƒœ */}\n                                  {activeTab === 'receipt' && (\n                                    <div className=\"flex justify-center\">\n                                      {canReceiptCheck ? (\n                                        actualReceivedAction.isCompleted(item) ? (\n                                          <button\n                                            onClick={() => {\n                                              actualReceivedAction.handleCancel(item.id, {\n                                                item_name: item.item_name,\n                                                specification: item.specification,\n                                                quantity: item.quantity,\n                                                unit_price_value: item.unit_price_value,\n                                                amount_value: item.amount_value,\n                                                remark: item.remark\n                                              })\n                                            }}\n                                            className=\"button-action-primary\"\n                                          >\n                                            {actualReceivedAction.config.completedText}\n                                          </button>\n                                        ) : (\n                                          <DatePickerPopover\n                                            onDateSelect={(date) => {\n                                              actualReceivedAction.handleConfirm(item.id, date, {\n                                                item_name: item.item_name,\n                                                specification: item.specification,\n                                                quantity: item.quantity,\n                                                unit_price_value: item.unit_price_value,\n                                                amount_value: item.amount_value,\n                                                remark: item.remark\n                                              })\n                                            }}\n                                            placeholder=\"ì‹¤ì œ ì…ê³ ëœ ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”\"\n                                            align=\"center\"\n                                            side=\"bottom\"\n                                          >\n                                            <button className=\"button-toggle-inactive\">\n                                              {actualReceivedAction.config.waitingText}\n                                            </button>\n                                          </DatePickerPopover>\n                                        )\n                                      ) : (\n                                        <span className={`${\n                                          actualReceivedAction.isCompleted(item)\n                                            ? 'button-action-primary' \n                                            : 'button-waiting-inactive'\n                                        }`}>\n                                          {actualReceivedAction.isCompleted(item) ? actualReceivedAction.config.completedText : actualReceivedAction.config.waitingText}\n                                        </span>\n                                      )}\n                                    </div>\n                                  )}\n                                  \n                                  {/* ì „ì²´ í•­ëª© íƒ­ì—ì„œëŠ” ì…ê³  ìƒíƒœë§Œ í‘œì‹œ (í´ë¦­ ë¶ˆê°€) */}\n                                  {activeTab === 'done' && (\n                                    <div className=\"flex justify-center\">\n                                      <span className={`button-base ${\n                                        actualReceivedAction.isCompleted(item)\n                                          ? 'bg-green-500 hover:bg-green-600 text-white' \n                                          : 'border border-gray-300 text-gray-600 bg-white hover:bg-gray-50'\n                                      }`}>\n                                        {actualReceivedAction.isCompleted(item) ? 'ì…ê³ ì™„ë£Œ' : 'ì…ê³ ëŒ€ê¸°'}\n                                      </span>\n                                    </div>\n                                  )}\n                                  \n                                  {/* ê¸°íƒ€ íƒ­ì—ì„œëŠ” ê¸°ë³¸ ìƒíƒœ í‘œì‹œ */}\n                                  {activeTab !== 'purchase' && activeTab !== 'receipt' && activeTab !== 'done' && (\n                                    <div className=\"flex justify-center\">\n                                      <span className=\"badge-text\">-</span>\n                                    </div>\n                                  )}\n                                </>\n                              )}\n                              </div>\n                            )}\n                            \n                            {/* ì‹¤ì œ ì…ê³  ë‚ ì§œ - ì…ê³  íƒ­ì—ì„œë§Œ í‘œì‹œ (ìƒíƒœ ì»¬ëŸ¼ ì˜¤ë¥¸ìª½) */}\n                            {activeTab === 'receipt' && (\n                              <div className=\"text-center flex justify-center items-center pl-2\">\n                                {actualReceivedAction.getCompletedDate(item) ? (\n                                  <div className=\"modal-subtitle text-green-700\">\n                                    {new Date(actualReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                                      year: 'numeric',\n                                      month: '2-digit',\n                                      day: '2-digit'\n                                    })}\n                                  </div>\n                                ) : (\n                                  <span className=\"modal-subtitle text-gray-400\">-</span>\n                                )}\n                              </div>\n                            )}\n\n                            {/* ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ - ì „ì²´í•­ëª© íƒ­ì—ì„œë§Œ í‘œì‹œ */}\n                            {activeTab === 'done' && (\n                              <div className=\"text-center flex justify-center items-center\">\n                                {canReceiptCheck ? (\n                                  statementReceivedAction.isCompleted(item) ? (\n                                    <button\n                                      onClick={() => {\n                                        statementReceivedAction.handleCancel(item.id, {\n                                          item_name: item.item_name,\n                                          specification: item.specification,\n                                          quantity: item.quantity,\n                                          unit_price_value: item.unit_price_value,\n                                          amount_value: item.amount_value,\n                                          remark: item.remark\n                                        })\n                                      }}\n                                      className=\"button-action-primary hover:bg-green-600\"\n                                      title=\"í´ë¦­í•˜ì—¬ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ì·¨ì†Œ\"\n                                    >\n                                      {statementReceivedAction.config.completedText}\n                                    </button>\n                                  ) : (\n                                    <DatePickerPopover\n                                      onDateSelect={(date) => {\n                                        statementReceivedAction.handleConfirm(item.id, date, {\n                                          item_name: item.item_name,\n                                          specification: item.specification,\n                                          quantity: item.quantity,\n                                          unit_price_value: item.unit_price_value,\n                                          amount_value: item.amount_value,\n                                          remark: item.remark\n                                        })\n                                      }}\n                                      placeholder=\"íšŒê³„ìƒ ì…ê³ ì¼ì„ ì„ íƒí•˜ì„¸ìš”\"\n                                      align=\"center\"\n                                      side=\"bottom\"\n                                    >\n                                      <button \n                                        className=\"button-toggle-inactive\"\n                                        onClick={() => {}}\n                                      >\n                                        {statementReceivedAction.config.waitingText}\n                                      </button>\n                                    </DatePickerPopover>\n                                  )\n                                ) : (\n                                  <span className={`${\n                                    statementReceivedAction.isCompleted(item)\n                                      ? 'button-action-primary' \n                                      : 'button-waiting-inactive'\n                                  }`}>\n                                    {statementReceivedAction.isCompleted(item) ? statementReceivedAction.config.completedText : statementReceivedAction.config.waitingText}\n                                  </span>\n                                )}\n                              </div>\n                            )}\n\n                            {/* íšŒê³„ìƒ ì…ê³ ì¼ - ì „ì²´í•­ëª© íƒ­ì—ì„œë§Œ í‘œì‹œ */}\n                            {activeTab === 'done' && (\n                              <div className=\"text-center flex justify-center items-center\">\n                                {statementReceivedAction.getCompletedDate(item) ? (\n                                  <div className=\"modal-subtitle text-blue-700\">\n                                    {new Date(statementReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                                      year: 'numeric',\n                                      month: '2-digit',\n                                      day: '2-digit'\n                                    })}\n                                  </div>\n                                ) : (\n                                  <span className=\"modal-subtitle text-gray-400\">-</span>\n                                )}\n                              </div>\n                            )}\n\n                            {/* UTK í™•ì¸ - ì „ì²´í•­ëª© íƒ­ì—ì„œë§Œ í‘œì‹œ (ë§¨ ì˜¤ë¥¸ìª½ ë) */}\n                            {activeTab === 'done' && (\n                              <div className=\"text-center flex justify-center items-center\">\n                                {canReceiptCheck ? (\n                                  <button\n                                    onClick={() => handleUtkToggle(item.id, !item.is_utk_checked)}\n                                    className={`button-base ${\n                                      item.is_utk_checked\n                                        ? 'button-toggle-active bg-orange-500 hover:bg-orange-600 text-white'\n                                        : 'button-toggle-inactive'\n                                    }`}\n                                    title={item.is_utk_checked ? 'UTK í™•ì¸ ì·¨ì†Œ' : 'UTK í™•ì¸ ì²˜ë¦¬'}\n                                  >\n                                    {item.is_utk_checked ? 'ì™„ë£Œ' : 'ëŒ€ê¸°'}\n                                  </button>\n                                ) : (\n                                  <span className={`${\n                                    item.is_utk_checked \n                                      ? 'button-toggle-active bg-orange-500 text-white' \n                                      : 'button-waiting-inactive'\n                                  }`}>\n                                    {item.is_utk_checked ? 'ì™„ë£Œ' : 'ëŒ€ê¸°'}\n                                  </span>\n                                )}\n                              </div>\n                            )}\n                          </div>\n                          \n                          {/* Mobile Layout */}\n                          <div className=\"block sm:hidden space-y-2\">\n                            <div className=\"flex justify-between items-start\">\n                              <div className=\"flex-1 min-w-0 relative\">\n                                {isEditing ? (\n                                  <Input\n                                    value={item.item_name}\n                                    onChange={(e) => handleItemChange(index, 'item_name', e.target.value)}\n                                    onFocus={() => setFocusedInput(`m_item_name_${index}`)}\n                                    onBlur={() => setFocusedInput(null)}\n                                    className={`modal-label border-gray-200 rounded-lg w-full !px-1.5 !py-0.5 !text-[10px] focus:border-blue-400 transition-all duration-200 ${\n                                      focusedInput === `m_item_name_${index}` \n                                        ? '!h-auto !min-h-[20px] !absolute !z-[9999] !bg-white !shadow-lg !left-0 !right-0 !-translate-y-1/2 !top-1/2 !whitespace-normal' \n                                        : '!h-5 !truncate'\n                                    }`}\n                                    placeholder=\"í’ˆëª©ëª…\"\n                                    disabled={canEditLimited && !canEditAll}  // lead buyerëŠ” í’ˆëª©ëª… ìˆ˜ì • ë¶ˆê°€\n                                  />\n                                ) : (\n                                  <div className=\"modal-value font-medium\">{item.item_name || 'í’ˆëª©ëª… ì—†ìŒ'}</div>\n                                )}\n                                {isEditing ? (\n                                  <Input\n                                    value={item.specification}\n                                    onChange={(e) => handleItemChange(index, 'specification', e.target.value)}\n                                    onFocus={() => setFocusedInput(`m_specification_${index}`)}\n                                    onBlur={() => setFocusedInput(null)}\n                                    className={`modal-label border-gray-200 rounded-lg mt-1 w-full !px-1.5 !py-0.5 !text-[10px] focus:border-blue-400 transition-all duration-200 ${\n                                      focusedInput === `m_specification_${index}` \n                                        ? '!h-auto !min-h-[20px] !absolute !z-[9999] !bg-white !shadow-lg !left-0 !right-0 !-translate-y-1/2 !top-1/2 !whitespace-normal !w-full' \n                                        : '!h-5 !truncate'\n                                    }`}\n                                    placeholder=\"ê·œê²©\"\n                                    disabled={canEditLimited && !canEditAll}  // lead buyerëŠ” ê·œê²© ìˆ˜ì • ë¶ˆê°€\n                                  />\n                                ) : (\n                                  <div className=\"modal-subtitle text-gray-500\">{item.specification || '-'}</div>\n                                )}\n                              </div>\n                              <div className=\"ml-3 text-right flex-shrink-0\">\n                                <div className={`${isEditing ? \"modal-subtitle\" : \"modal-value\"} font-semibold`}>â‚©{formatCurrency(item.amount_value || 0)}</div>\n                              </div>\n                            </div>\n                            \n                            <div className=\"grid grid-cols-3 gap-2 text-sm\">\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">ìˆ˜ëŸ‰:</span>\n                                {isEditing ? (\n                                  <Input\n                                    type=\"number\"\n                                    value={item.quantity}\n                                    onChange={(e) => handleItemChange(index, 'quantity', Number(e.target.value))}\n                                    className=\"border-gray-200 rounded-lg mt-1 w-full !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400\"\n                                    placeholder=\"ìˆ˜ëŸ‰\"\n                                  />\n                                ) : (\n                                  <div className=\"modal-subtitle\">{item.quantity || 0}</div>\n                                )}\n                              </div>\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">ë‹¨ê°€:</span>\n                                {isEditing ? (\n                                  <Input\n                                    type=\"number\"\n                                    value={item.unit_price_value}\n                                    onChange={(e) => handleItemChange(index, 'unit_price_value', Number(e.target.value))}\n                                    className=\"border-gray-200 rounded-lg mt-1 w-full !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400\"\n                                    placeholder=\"ë‹¨ê°€\"\n                                  />\n                                ) : (\n                                  <div className=\"modal-subtitle\">â‚©{formatCurrency(item.unit_price_value)}</div>\n                                )}\n                              </div>\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">ìƒíƒœ:</span>\n                                <div className=\"mt-1\">\n                                  {isEditing ? (\n                                    <Button\n                                      size=\"sm\"\n                                      variant=\"ghost\"\n                                      onClick={() => handleRemoveItem(index)}\n                                      className=\"text-red-600 hover:bg-red-50 rounded-lg p-1 h-6 w-6\"\n                                    >\n                                      <Trash2 className=\"w-3 h-3\" />\n                                    </Button>\n                                  ) : (\n                                    <>\n                                      {activeTab === 'purchase' && (\n                                        <>\n                                          {canPurchase ? (\n                                            <button\n                                              onClick={() => handlePaymentToggle(item.id, !item.is_payment_completed)}\n                                              className={`text-xs px-2 py-1 rounded ${\n                                                item.is_payment_completed\n                                                  ? 'bg-orange-500 text-white hover:bg-orange-600'\n                                                  : 'bg-gray-100 text-gray-600'\n                                              }`}\n                                            >\n                                              {item.is_payment_completed ? 'êµ¬ë§¤ì™„ë£Œ' : 'êµ¬ë§¤ëŒ€ê¸°'}\n                                            </button>\n                                          ) : (\n                                            <span className={`text-xs px-2 py-1 rounded ${\n                                              item.is_payment_completed \n                                                ? 'bg-orange-500 text-white' \n                                                : 'bg-gray-100 text-gray-400'\n                                            }`}>\n                                              {item.is_payment_completed ? 'êµ¬ë§¤ì™„ë£Œ' : 'êµ¬ë§¤ëŒ€ê¸°'}\n                                            </span>\n                                          )}\n                                        </>\n                                      )}\n                                      \n                                      {activeTab === 'receipt' && (\n                                        <>\n                                          {canReceiptCheck ? (\n                                            actualReceivedAction.isCompleted(item) ? (\n                                              <button\n                                                onClick={() => {\n                                                  actualReceivedAction.handleCancel(item.id, {\n                                                    item_name: item.item_name,\n                                                    specification: item.specification,\n                                                    quantity: item.quantity,\n                                                    unit_price_value: item.unit_price_value,\n                                                    amount_value: item.amount_value,\n                                                    remark: item.remark\n                                                  })\n                                                }}\n                                                className=\"text-xs px-2 py-1 rounded button-action-primary\"\n                                              >\n                                                {actualReceivedAction.config.completedText}\n                                              </button>\n                                            ) : (\n                                              <DatePickerPopover\n                                                onDateSelect={(date) => {\n                                                  actualReceivedAction.handleConfirm(item.id, date, {\n                                                    item_name: item.item_name,\n                                                    specification: item.specification,\n                                                    quantity: item.quantity,\n                                                    unit_price_value: item.unit_price_value,\n                                                    amount_value: item.amount_value,\n                                                    remark: item.remark\n                                                  })\n                                                }}\n                                                placeholder=\"ì‹¤ì œ ì…ê³ ëœ ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”\"\n                                                align=\"center\"\n                                                side=\"bottom\"\n                                              >\n                                                <button className=\"text-xs px-2 py-1 rounded bg-gray-100 text-gray-600\">\n                                                  {actualReceivedAction.config.waitingText}\n                                                </button>\n                                              </DatePickerPopover>\n                                            )\n                                          ) : (\n                                            <span className={`text-xs px-2 py-1 rounded ${\n                                              actualReceivedAction.isCompleted(item)\n                                                ? 'button-action-primary' \n                                                : 'bg-gray-100 text-gray-400'\n                                            }`}>\n                                              {actualReceivedAction.isCompleted(item) ? actualReceivedAction.config.completedText : actualReceivedAction.config.waitingText}\n                                            </span>\n                                          )}\n                                        </>\n                                      )}\n                                      \n                                      {activeTab === 'done' && (\n                                        <>\n                                          {/* ì „ì²´ í•­ëª© íƒ­ì—ì„œëŠ” ì…ê³  ìƒíƒœë§Œ í‘œì‹œ (í´ë¦­ ë¶ˆê°€) */}\n                                          <span className={`button-base ${\n                                            actualReceivedAction.isCompleted(item)\n                                              ? 'bg-green-500 text-white' \n                                              : 'border border-gray-300 text-gray-600 bg-white'\n                                          }`}>\n                                            {actualReceivedAction.isCompleted(item) ? 'ì…ê³ ì™„ë£Œ' : 'ì…ê³ ëŒ€ê¸°'}\n                                          </span>\n                                        </>\n                                      )}\n                                      \n                                      {activeTab !== 'purchase' && activeTab !== 'receipt' && activeTab !== 'done' && (\n                                        <span className=\"text-xs text-gray-400\">-</span>\n                                      )}\n                                    </>\n                                  )}\n                                </div>\n                              </div>\n                            </div>\n                            \n                            {(item.remark || isEditing) && (\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">ë¹„ê³ :</span>\n                                {isEditing ? (\n                                  <Input\n                                    value={item.remark || ''}\n                                    onChange={(e) => handleItemChange(index, 'remark', e.target.value)}\n                                    className=\"modal-label border-gray-200 rounded-lg mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                    placeholder=\"ë¹„ê³ \"\n                                  />\n                                ) : (\n                                  <div className=\"modal-subtitle text-gray-500 mt-1\">{item.remark || '-'}</div>\n                                )}\n                              </div>\n                            )}\n                            \n                            {/* ëª¨ë°”ì¼ì—ì„œ ì‹¤ì œ ì…ê³  ë‚ ì§œ í‘œì‹œ */}\n                            {!isEditing && activeTab === 'receipt' && actualReceivedAction.getCompletedDate(item) && (\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">ì‹¤ì œì…ê³ ì¼:</span>\n                                <div className=\"mt-1\">\n                                  <div className=\"modal-subtitle text-green-700\">\n                                    {new Date(actualReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                                      year: 'numeric',\n                                      month: '2-digit',\n                                      day: '2-digit'\n                                    })}\n                                  </div>\n                                  <div className=\"text-[9px] text-gray-500\">\n                                    {new Date(actualReceivedAction.getCompletedDate(item)).toLocaleTimeString('ko-KR', {\n                                      hour: '2-digit',\n                                      minute: '2-digit'\n                                    })}\n                                  </div>\n                                </div>\n                              </div>\n                            )}\n\n                            {/* ëª¨ë°”ì¼ì—ì„œ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ í‘œì‹œ - ì „ì²´í•­ëª© íƒ­ì—ì„œë§Œ */}\n                            {!isEditing && activeTab === 'done' && (\n                              <div className=\"flex items-center justify-between\">\n                                <span className=\"text-gray-500 text-xs\">ê±°ë˜ëª…ì„¸ì„œ í™•ì¸:</span>\n                                <div className=\"flex items-center gap-2\">\n                                  {canReceiptCheck ? (\n                                    statementReceivedAction.isCompleted(item) ? (\n                                      <button\n                                        onClick={() => {\n                                          statementReceivedAction.handleCancel(item.id, {\n                                            item_name: item.item_name,\n                                            specification: item.specification,\n                                            quantity: item.quantity,\n                                            unit_price_value: item.unit_price_value,\n                                            amount_value: item.amount_value,\n                                            remark: item.remark\n                                          })\n                                        }}\n                                        className=\"text-xs px-2 py-1 rounded button-action-primary hover:bg-green-600\"\n                                        title=\"í´ë¦­í•˜ì—¬ ê±°ë˜ëª…ì„¸ì„œ í™•ì¸ ì·¨ì†Œ\"\n                                      >\n                                        {statementReceivedAction.config.completedText}\n                                      </button>\n                                    ) : (\n                                      <DatePickerPopover\n                                        onDateSelect={(date) => {\n                                          statementReceivedAction.handleConfirm(item.id, date, {\n                                            item_name: item.item_name,\n                                            specification: item.specification,\n                                            quantity: item.quantity,\n                                            unit_price_value: item.unit_price_value,\n                                            amount_value: item.amount_value,\n                                            remark: item.remark\n                                          })\n                                        }}\n                                        placeholder=\"íšŒê³„ìƒ ì…ê³ ì¼ì„ ì„ íƒí•˜ì„¸ìš”\"\n                                        align=\"end\"\n                                        side=\"bottom\"\n                                      >\n                                        <button \n                                          className=\"text-xs px-2 py-1 rounded bg-gray-100 text-gray-600\"\n                                          onClick={() => {}}\n                                        >\n                                          {statementReceivedAction.config.waitingText}\n                                        </button>\n                                      </DatePickerPopover>\n                                    )\n                                  ) : (\n                                    <span className={`text-xs px-2 py-1 rounded ${\n                                      statementReceivedAction.isCompleted(item)\n                                        ? 'button-action-primary' \n                                        : 'bg-gray-100 text-gray-400'\n                                    }`}>\n                                      {statementReceivedAction.isCompleted(item) ? statementReceivedAction.config.completedText : statementReceivedAction.config.waitingText}\n                                    </span>\n                                  )}\n                                </div>\n                              </div>\n                            )}\n\n                            {/* ëª¨ë°”ì¼ì—ì„œ íšŒê³„ìƒ ì…ê³ ì¼ í‘œì‹œ - ì „ì²´í•­ëª© íƒ­ì—ì„œë§Œ */}\n                            {!isEditing && activeTab === 'done' && statementReceivedAction.getCompletedDate(item) && (\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">íšŒê³„ìƒ ì…ê³ ì¼:</span>\n                                <div className=\"mt-1\">\n                                  <div className=\"modal-subtitle text-blue-700\">\n                                    {new Date(statementReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                                      year: 'numeric',\n                                      month: '2-digit',\n                                      day: '2-digit'\n                                    })}\n                                  </div>\n                                </div>\n                              </div>\n                            )}\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                </div>\n                \n                {/* í•©ê³„ */}\n                <div className=\"bg-gray-50 px-2 sm:px-3 border-t border-gray-100\">\n                  <div className=\"hidden sm:grid items-center gap-3 py-0.5\" style={{\n                    gridTemplateColumns: getGridTemplateColumns()\n                  }}>\n                    {/* í’ˆëª©ëª… */}\n                    <div></div>\n                    {/* ê·œê²© */}\n                    <div></div>\n                    {/* ìˆ˜ëŸ‰ */}\n                    <div></div>\n                    {/* ë‹¨ê°€ */}\n                    <div className=\"text-right\">\n                      <span className=\"text-[12px] font-bold text-gray-900\">ì´ì•¡</span>\n                    </div>\n                    {/* í•©ê³„ */}\n                    <div className=\"text-right\">\n                      <span className=\"text-[12px] font-bold text-gray-900\">\n                        â‚©{formatCurrency(\n                          (isEditing ? editedItems : currentItems)?.reduce((sum, item) => sum + (item.amount_value || 0), 0) || 0\n                        )}\n                      </span>\n                    </div>\n                    {/* ë‚˜ë¨¸ì§€ ì¹¼ëŸ¼ë“¤ */}\n                    <div></div>\n                    <div></div>\n                    {activeTab === 'receipt' && <div></div>}\n                    {activeTab === 'done' && (\n                      <>\n                        <div></div>\n                        <div></div>\n                        <div></div>\n                      </>\n                    )}\n                  </div>\n                  \n                  {/* Mobile ì´ì•¡ */}\n                  <div className=\"block sm:hidden py-0.5\">\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-[13px] font-bold text-gray-900\">ì´ì•¡</span>\n                      <span className=\"text-[13px] font-bold text-gray-900\">\n                        â‚©{formatCurrency(\n                          (isEditing ? editedItems : currentItems)?.reduce((sum, item) => sum + (item.amount_value || 0), 0) || 0\n                        )}\n                      </span>\n                    </div>\n                  </div>\n                </div>\n                \n                {/* í•­ëª© ì¶”ê°€ ë²„íŠ¼ */}\n                {isEditing && (\n                  <div className=\"p-2 sm:p-3 border-t border-gray-100\">\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={handleAddItem}\n                      className=\"w-full rounded-lg border-dashed border-2 border-gray-300 hover:border-gray-400 py-2 badge-text\"\n                    >\n                      <Plus className=\"w-4 h-4 mr-1\" />\n                      í•­ëª© ì¶”ê°€\n                    </Button>\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n      ) : (\n        <div className=\"text-center py-12\">\n          <span className=\"modal-subtitle\">\n            ë°œì£¼ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n          </span>\n        </div>\n      )}\n    </div>\n  )\n\n  // embeddedê°€ trueë©´ Dialog ì—†ì´ ë‚´ìš©ë§Œ ë°˜í™˜\n  if (embedded) {\n    return content\n  }\n\n  // embeddedê°€ falseë©´ Dialogë¡œ ê°ì‹¸ì„œ ë°˜í™˜\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent \n        className=\"overflow-hidden bg-white rounded-lg shadow-sm border-0 w-full sm:w-auto max-w-[calc(100vw-48px)] sm:max-w-[calc(100vw-80px)] lg:max-w-[90vw] xl:max-w-[85vw] h-[95vh] sm:h-auto sm:max-h-[90vh] lg:max-h-[85vh] sm:rounded-lg flex flex-col\" \n        showCloseButton={false}\n      >\n        <DialogHeader className=\"sr-only\">\n          <DialogTitle>ë°œì£¼ ìƒì„¸ ì •ë³´</DialogTitle>\n        </DialogHeader>\n        {/* Apple-style Header */}\n        <div className=\"relative px-3 sm:px-6 pt-0 sm:pt-3 lg:pt-4 pb-0 sm:pb-2 lg:pb-3 flex-shrink-0\">\n          <button\n            onClick={onClose}\n            className=\"button-base button-action-secondary absolute right-3 sm:right-6 top-0 sm:top-3 lg:top-4 w-6 h-6 sm:w-8 sm:h-8 rounded-full\"\n          >\n            <X className=\"w-4 h-4 text-gray-500\" />\n          </button>\n          \n          <div className=\"pr-8 sm:pr-16\">\n            <div className=\"flex items-start gap-4 mb-0 sm:mb-3\">\n              <div className=\"min-w-0 flex-1\">\n                <h1 className=\"page-title mb-0 sm:mb-1\">\n                  ë°œì£¼ ê¸°ë³¸ì •ë³´\n                </h1>\n              </div>\n              <div className=\"flex items-center gap-3\">\n                {!isEditing && canEdit && (\n                  <>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => handleEditToggle(true)}\n                      className=\"button-base button-action-secondary\"\n                    >\n                      <Edit2 className=\"w-4 h-4 mr-2\" />\n                      ìˆ˜ì •\n                    </Button>\n                    {canDelete && onDelete && (\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={async () => {\n                          if (purchase) {\n                            try {\n                              await onDelete(purchase);\n                              \n                              // ì‚­ì œ í›„ ëª¨ë‹¬ ë‹«ê¸° ë° ìƒˆë¡œê³ ì¹¨\n                              onClose();\n                              if (onRefresh) {\n                                await onRefresh(true); // ê°•ì œ ìƒˆë¡œê³ ì¹¨\n                              }\n                            } catch (error) {\n                              logger.error('ë°œì£¼ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ', error);\n                              toast.error('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');\n                            }\n                          }\n                        }}\n                        className=\"button-base button-action-danger\"\n                      >\n                        <Trash2 className=\"w-4 h-4 mr-2\" />\n                        ì‚­ì œ\n                      </Button>\n                    )}\n                  </>\n                )}\n                {isEditing && (\n                  <>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => {\n                        handleEditToggle(false)\n                        setEditedPurchase(purchase)\n                        setEditedItems(purchase?.items || [])\n                        setDeletedItemIds([])\n                      }}\n                      className=\"button-base button-action-secondary\"\n                    >\n                      <X className=\"w-4 h-4 mr-2\" />\n                      ì·¨ì†Œ\n                    </Button>\n                    <Button\n                      size=\"sm\"\n                      onClick={handleSave}\n                      className=\"button-base button-action-primary\"\n                    >\n                      <Save className=\"w-4 h-4 mr-2\" />\n                      ì €ì¥\n                    </Button>\n                  </>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Apple-style Content */}\n        <div className=\"overflow-y-auto flex-1 px-3 sm:px-6 pb-1 sm:pb-6 mt-0\">\n          {content}\n        </div>\n      </DialogContent>\n      \n    </Dialog>\n  )\n}\n\nexport default memo(PurchaseDetailModal)"],"names":["Truck","createLucideIcon","d","key","cx","cy","r","DatePickerPopover","children","onDateSelect","disabled","placeholder","align","side","open","setOpen","useState","jsxs","Popover","onOpenChange","jsx","PopoverTrigger","asChild","PopoverContent","className","sideOffset","Calendar","mode","selected","onSelect","date","logger","debug","isToday","Date","toDateString","dateValue","getTime","todayValue","dateString","todayString","handleDateSelect","locale","ko","initialFocus","fromDate","toDate","defaultMonth","modifiers","today","modifiersClassNames","useConfirmDateAction","config","currentUserName","canPerformAction","purchaseId","onUpdate","onOptimisticUpdate","supabase","createClient","handleConfirm","useCallback","async","itemId","selectedDate","itemInfo","warn","toast","error","field","numericId","Number","isNaN","confirmMessage","item_name","specification","quantity","toLocaleString","unit_price_value","amount_value","remark","confirm","window","updateData","is_statement_received","statement_received_date","toISOString","statement_received_by_name","actual_received_date","is_received","data","from","update","eq","select","info","markItemAsReceived","markItemAsStatementReceived","action","success","successMessage","handleCancel","cancel","itemName","markItemAsReceiptCanceled","markItemAsStatementCanceled","isCompleted","item","getCompletedDate","getCompletedByName","PurchaseDetailModal$1","memo","isOpen","onClose","embedded","currentUserRoles","activeTab","onRefresh","onDelete","allPurchases","usePurchaseMemory","loading","setLoading","purchase","setPurchase","isEditing","setIsEditing","editedPurchase","setEditedPurchase","editedItems","setEditedItems","deletedItemIds","setDeletedItemIds","userRoles","setUserRoles","setCurrentUserName","columnWidths","setColumnWidths","focusedInput","setFocusedInput","currentItems","useMemo","items","length","purchase_request_items","memoryPurchase","find","p","id","tableMinWidth","columnGap","padding","total","reduce","sum","width","Math","max","baseColumns","push","headerRowRef","useRef","useEffect","supabaseUrl","includes","user","auth","getUser","employeeData","maybeSingle","email","employeeByEmail","name","purchase_role","roles","Array","isArray","map","String","trim","split","filter","loadUserRoles","effectiveRoles","canEditAll","canEditLimited","canEdit","canDelete","final_manager_status","requester_name","canPurchase","canReceiveItems","canReceiptCheck","refreshModalData","findPurchaseInMemory","normalizedItems","purchaseData","is_po_generated","vendor","vendor_id","vendor_name","is_active","vendor_contacts","single","sortedItems","sort","a","b","line_number","vendors","updatedPurchase","isInitialLoad","setIsInitialLoad","purchaseIdNumber","NaN","handleActualReceiptOptimisticUpdate","itemIdStr","nowIso","selectedDateIso","updateItems","received_at","prev","updatedItems","completed","allReceived","prevItems","prevPurchase","handleStatementReceivedOptimisticUpdate","nextAllCompleted","nextStatementAt","every","statement_received_at","allCompleted","then","statementReceivedAction","completedText","waitingText","actualReceivedAction","canApproveMiddle","canApproveFinal","approvalButtonClass","approvalWaitingPillClass","loadPurchaseDetail","toString","calculateOptimalColumnWidths","columnConfigs","minWidth","maxWidth","baseWidth","isFixed","calculatedWidths","index","maxLength","headers","baseHeaders","getHeaders","forEach","cellValue","getStatusDisplay","formatDate","is_utk_checked","adjustedLength","acc","char","test","ceil","min","is_payment_completed","getGridTemplateColumns","widths","join","requestAnimationFrame","handleEditToggle","editing","formatCurrency","amount","Intl","NumberFormat","format","handleItemChange","value","newItems","unitPrice","handleRemoveItem","_","i","handlePaymentToggle","purchaseItems","requestItems","targetItem","unit","payment_completed_at","markItemAsPaymentCompleted","markItemAsPaymentCanceled","prevRequestItems","payment_completed_by_name","refreshResult","silent","Promise","handleApprove","type","approvalType","purchase_order_number","middle_manager_status","content","payment_category","category","getStatusBadge","request_date","Button","size","variant","onClick","Check","X","FileText","Input","request_type","onChange","e","target","delivery_request_date","formatDateInput","revised_delivery_request_date","Building2","contact_name","updatedContacts","project_vendor","project_item","order_number","Package","Fragment","allItems","pendingItems","CreditCard","toLocaleDateString","year","month","day","markItemAsUtkChecked","CheckCircle","style","ref","gridTemplateColumns","onFocus","onBlur","whiteSpace","wordBreak","overflowWrap","hyphens","WebkitHyphens","MozHyphens","msHyphens","lineHeight","maxHeight","overflow","display","WebkitLineClamp","WebkitBoxOrient","title","boxSizing","Trash2","isChecked","checked","allChecked","updateError","handleUtkToggle","toLocaleTimeString","hour","minute","newItem","lineNum","Plus","Dialog","DialogContent","showCloseButton","DialogHeader","DialogTitle","Edit2","totalAmount","total_amount","updated_at","deleteError","delete","in","Error","unit_price_currency","currency","amount_currency","insertData","purchase_request_id","indexOf","created_at","insert","sourceData","deletedCount","removeItemFromMemory","memoryUpdated","updatePurchaseInMemory","newTotalAmount","itemsCount","finalItems","originalItemsCount","finalItemsCount","deletedItemsCount","applyOptimisticUpdate","errorMessage","message","Save"],"mappings":"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","x_google_ignoreList":[0]}