{"version":3,"mappings":"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","names":["Building","createLucideIcon","d","key","x","y","width","height","rx","DollarSign","x1","x2","y1","y2","globalCache","purchases","lastFetch","userInfo","CACHE_DURATION","filteredData","Map","FILTER_CACHE_DURATION","invalidateFilterCache","tabKey","clear","HIDDEN_EMPLOYEES","FastPurchaseTable","lazy","__vitePreload","import","__VITE_PRELOAD__","TableSkeleton","memo","jsx","className","children","Array","map","_","i","jsxs","displayName","LazyPurchaseTable","activeTab","currentUserRoles","onRefresh","onOptimisticUpdate","onPaymentComplete","onReceiptComplete","Suspense","fallback","FILTER_FIELDS","label","type","icon","Calendar","category","User","Package","CheckCircle","options","TEXT_CONDITIONS","value","NUMBER_CONDITIONS","DATE_CONDITIONS","SELECT_CONDITIONS","SORT_FIELDS","FilterToolbar","activeFilters","sortConfig","searchTerm","onFiltersChange","onSortChange","onSearchChange","availableEmployees","availableVendors","availableContacts","availablePaymentSchedules","isFilterOpen","setIsFilterOpen","useState","isSortOpen","setIsSortOpen","isSearchExpanded","setIsSearchExpanded","newFilter","setNewFilter","searchInputRef","useRef","useEffect","current","focus","handleRemoveFilter","filterId","filter","f","id","handleSortChange","field","direction","fieldConfig","find","Popover","open","onOpenChange","PopoverTrigger","asChild","Button","variant","size","Filter","length","Badge","PopoverContent","align","onClick","X","Select","onValueChange","Date","now","condition","SelectTrigger","SelectValue","placeholder","SelectContent","Object","entries","reduce","acc","push","fields","SelectItem","prev","fieldType","getConditionOptions","Input","onChange","e","target","option","scheduleOptions","renderValueInput","disabled","ArrowUpDown","ref","Search","PurchaseItemsModal","NAV_TABS","PurchaseListMain","onEmailToggle","showEmailButton","navigate","useNavigate","location","useLocation","supabase","createClient","selectedPurchase","setSelectedPurchase","isModalOpen","setIsModalOpen","setActiveFilters","setSortConfig","setSearchTerm","setAvailableEmployees","setAvailableVendors","setAvailableContacts","setAvailablePaymentSchedules","loading","currentUserName","refreshPurchases","loadPurchases","updatePurchaseOptimistic","setPurchases","setLoading","setCurrentUserRoles","setCurrentUserName","currentUserEmail","setCurrentUserEmail","currentUserId","setCurrentUserId","initializationRef","async","cacheValid","employeeData","roles","purchase_role","isArray","r","String","trim","split","name","full_name","email","error","logger","userResult","auth","getUser","data","user","from","select","eq","maybeSingle","loadInitialData","useCallback","forceRefresh","showSpinner","silent","authError","toast","order","ascending","limit","employeeList","vendorList","employeesResult","vendorsResult","Promise","all","today","toISOString","processedData","request_date","startsWith","request","firstItem","purchase_request_items","requesterEmployee","emp","requester_id","vendorInfo","vendor","vendor_id","Number","purchase_order_number","delivery_request_date","revised_delivery_request_date","progress_type","payment_completed_at","payment_completed_by_name","payment_category","currency","request_type","vendor_name","vendor_payment_schedule","vendor_contacts","requester_name","requester_full_name","item_name","specification","quantity","unit_price_value","amount_value","remark","project_vendor","sales_order_number","project_item","line_number","contact_name","middle_manager_status","final_manager_status","is_received","received_at","is_payment_completed","is_po_download","link","items","sort","a","b","total_amount","sum","item","purchase_status","purchaseId","updater","next","purchase","usePurchaseData","isAdmin","includes","setActiveTab","filteredPurchases","tabCounts","selectedEmployee","setSelectedEmployee","isPurchaseManager","isLeadBuyer","isHr","roleCase","useMemo","some","computeDefaultEmployee","defaultEmployee","visiblePurchases","p","tabFilteredPurchases","matches","middlePending","finalPending","middleRejected","finalRejected","middleApproved","finalApproved","isRequest","isSeonJin","isIlban","employeeFilteredPurchases","result","dateA","getTime","countPurchases","getUniqueOrderCount","filtered","Set","getFilteredDataForTab","pendingData","purchaseData","receiptData","doneData","pendingFiltered","purchaseFiltered","receiptFiltered","pending","receipt","done","useFastPurchaseFilters","URLSearchParams","search","get","employees","not","employeeNames","Boolean","vendors","vendorNames","v","contacts","contactNames","c","schedules","scheduleNames","s","payment_schedule","loadFilterOptions","hasInitializedTabRefresh","refreshLatestData","applyAdvancedFilters","searchLower","toLowerCase","forEach","fieldValue","getFieldValue","applyFilterCondition","is_statement_received","filterValue","fieldStr","filterStr","endsWith","applySorting","aValue","bValue","comparison","localeCompare","advancedFilteredPurchases","handleReceiptComplete","currentTime","requestResult","itemsResult","update","delivery_status","success","handlePaymentComplete","modalPurchaseData","style","marginTop","marginBottom","Plus","tab","Card","CardContent","isOpen","onClose","onUpdate"],"ignoreList":[0,1],"sources":["../../node_modules/lucide-react/dist/esm/icons/building.js","../../node_modules/lucide-react/dist/esm/icons/dollar-sign.js","../../src/hooks/usePurchaseData.ts","../../src/hooks/useFastPurchaseFilters.ts","../../src/components/purchase/LazyPurchaseTable.tsx","../../src/components/purchase/FilterToolbar.tsx","../../src/components/purchase/PurchaseListMain.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M12 10h.01\", key: \"1nrarc\" }],\n  [\"path\", { d: \"M12 14h.01\", key: \"1etili\" }],\n  [\"path\", { d: \"M12 6h.01\", key: \"1vi96p\" }],\n  [\"path\", { d: \"M16 10h.01\", key: \"1m94wz\" }],\n  [\"path\", { d: \"M16 14h.01\", key: \"1gbofw\" }],\n  [\"path\", { d: \"M16 6h.01\", key: \"1x0f13\" }],\n  [\"path\", { d: \"M8 10h.01\", key: \"19clt8\" }],\n  [\"path\", { d: \"M8 14h.01\", key: \"6423bh\" }],\n  [\"path\", { d: \"M8 6h.01\", key: \"1dz90k\" }],\n  [\"path\", { d: \"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3\", key: \"cabbwy\" }],\n  [\"rect\", { x: \"4\", y: \"2\", width: \"16\", height: \"20\", rx: \"2\", key: \"1uxh74\" }]\n];\nconst Building = createLucideIcon(\"building\", __iconNode);\n\nexport { __iconNode, Building as default };\n//# sourceMappingURL=building.js.map\n","/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"line\", { x1: \"12\", x2: \"12\", y1: \"2\", y2: \"22\", key: \"7eqyqh\" }],\n  [\"path\", { d: \"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6\", key: \"1b0p4s\" }]\n];\nconst DollarSign = createLucideIcon(\"dollar-sign\", __iconNode);\n\nexport { __iconNode, DollarSign as default };\n//# sourceMappingURL=dollar-sign.js.map\n","import { useState, useEffect, useCallback, useRef } from 'react';\nimport { createClient } from '@/lib/supabase/client';\nimport { logger } from '@/lib/logger';\nimport { toast } from 'sonner';\n\nexport interface Purchase {\n  id: number;\n  purchase_order_number?: string;\n  request_date: string;\n  delivery_request_date?: string | null;\n  revised_delivery_request_date?: string | null;\n  progress_type: string;\n  is_payment_completed: boolean;\n  payment_category: string;\n  payment_completed_at?: string;\n  payment_completed_by_name?: string;\n  currency: string;\n  request_type: string;\n  vendor?: {\n    vendor_name: string;\n    vendor_payment_schedule?: string;\n  };\n  vendor_name: string;\n  vendor_payment_schedule?: string;\n  vendor_id?: number;\n  contact_id?: number;\n  vendor_contacts?: {\n    contact_name: string;\n  } | Array<{\n    contact_name: string;\n  }>;\n  contact_name?: string;\n  requester_id: string;\n  requester_name: string;\n  requester_full_name: string;\n  project_vendor: string;\n  sales_order_number: string;\n  project_item: string;\n  middle_manager_status?: string;\n  final_manager_status?: string;\n  total_amount: number;\n  is_received: boolean;\n  received_at?: string;\n\n  is_po_download?: boolean;\n  items?: any[];\n  purchase_request_items?: any[];\n  item_name?: string;\n  specification?: string;\n  quantity?: number;\n  unit_price_value?: number;\n  amount_value?: number;\n  remark?: string;\n  line_number?: number;\n  link?: string;\n  purchase_status?: string;\n}\n\n\n// 향상된 캐시 관리\nconst globalCache = {\n  purchases: null as Purchase[] | null,\n  lastFetch: 0,\n  userInfo: null as any,\n  CACHE_DURATION: 5 * 60 * 1000, // 5분 캐싱으로 연장\n  // 탭별 필터링 결과 캐시\n  filteredData: new Map<string, { data: Purchase[]; timestamp: number }>(),\n  FILTER_CACHE_DURATION: 30 * 1000 // 30초 필터 캐시\n};\n\n// 향상된 캐시 관리 함수들\nexport const clearPurchaseCache = () => {\n  globalCache.purchases = null;\n  globalCache.userInfo = null;\n  globalCache.lastFetch = 0;\n  globalCache.filteredData.clear();\n};\n\n// 부분 캐시 무효화 (탭별)\nexport const invalidateFilterCache = (tabKey?: string) => {\n  if (tabKey) {\n    for (const [key] of globalCache.filteredData.entries()) {\n      if (key.includes(tabKey)) {\n        globalCache.filteredData.delete(key);\n      }\n    }\n  } else {\n    globalCache.filteredData.clear();\n  }\n};\n\nexport const usePurchaseData = () => {\n  const [purchases, setPurchases] = useState<Purchase[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [currentUserRoles, setCurrentUserRoles] = useState<string[]>([]);\n  const [currentUserName, setCurrentUserName] = useState<string>('');\n  const [currentUserEmail, setCurrentUserEmail] = useState<string>('');\n  const [currentUserId, setCurrentUserId] = useState<string>('');\n  \n  const supabase = createClient();\n  const initializationRef = useRef(false);\n\n  // 초기 데이터 로드 (업체 목록, 사용자 권한) - 캐싱 적용\n  useEffect(() => {\n    const loadInitialData = async () => {\n      if (initializationRef.current) return;\n      initializationRef.current = true;\n      \n      const now = Date.now();\n      const cacheValid = globalCache.lastFetch && (now - globalCache.lastFetch) < globalCache.CACHE_DURATION;\n      \n      try {\n        // 캐시된 데이터가 유효한 경우 사용\n        if (cacheValid && globalCache.userInfo) {\n          try {\n            const employeeData = globalCache.userInfo;\n            if (employeeData) {\n              let roles: string[] = [];\n              if (employeeData.purchase_role) {\n                if (Array.isArray(employeeData.purchase_role)) {\n                  roles = employeeData.purchase_role.map((r: any) => String(r).trim());\n                } else {\n                  const roleString = String(employeeData.purchase_role);\n                  roles = roleString\n                    .split(',')\n                    .map((r: string) => r.trim())\n                    .filter((r: string) => r.length > 0);\n                }\n              }\n              \n              setCurrentUserRoles(roles);\n              setCurrentUserName(employeeData.name || employeeData.full_name || '');\n              setCurrentUserEmail(employeeData.email || '');\n              setCurrentUserId(employeeData.id || '');\n            }\n            return;\n          } catch (error) {\n            logger.error('캐시 데이터 사용 중 오류', error);\n            // 캐시 초기화\n            globalCache.purchases = null;\n            globalCache.userInfo = null;\n            globalCache.lastFetch = 0;\n          }\n        }\n        \n        // 캐시가 없거나 만료된 경우 새로 로드\n        const userResult = await supabase.auth.getUser();\n\n        // 사용자 권한 및 이름 로드\n        if (userResult.data.user && !userResult.error) {\n          // email로 직원 정보 찾기 (올바른 방법)\n          let employeeData = null;\n          if (userResult.data.user.email) {\n            const emailResult = await supabase\n              .from('employees')\n              .select('*')\n              .eq('email', userResult.data.user.email)\n              .maybeSingle();\n            \n            employeeData = emailResult.data;\n          }\n          \n          if (employeeData) {\n            globalCache.userInfo = employeeData;\n            \n            let roles: string[] = [];\n            if (employeeData.purchase_role) {\n              if (Array.isArray(employeeData.purchase_role)) {\n                roles = employeeData.purchase_role.map((r: any) => String(r).trim());\n              } else {\n                const roleString = String(employeeData.purchase_role);\n                roles = roleString\n                  .split(',')\n                  .map((r: string) => r.trim())\n                  .filter((r: string) => r.length > 0);\n              }\n            }\n            \n            setCurrentUserRoles(roles);\n            setCurrentUserName(employeeData.name || employeeData.full_name || '');\n            setCurrentUserEmail(employeeData.email || '');\n            setCurrentUserId(employeeData.id || '');\n          }\n          \n          globalCache.lastFetch = now;\n        }\n      } catch (error) {\n        logger.error('초기 데이터 로드 실패', error);\n      }\n    };\n\n    loadInitialData();\n  }, []);\n\n  // 발주 목록 로드 - 향상된 캐싱 및 최적화\n  const loadPurchases = useCallback(async (forceRefresh?: boolean, options?: { silent?: boolean }) => {\n    const showSpinner = !options?.silent;\n\n    if (showSpinner) {\n      setLoading(true);\n    }\n    \n    try {\n      // 캐시 확인\n      const now = Date.now();\n      const cacheValid = globalCache.lastFetch && (now - globalCache.lastFetch) < globalCache.CACHE_DURATION;\n      \n      // 강제 새로고침 시 필터 캐시도 무효화\n      if (forceRefresh) {\n        invalidateFilterCache();\n        globalCache.purchases = null;\n        globalCache.lastFetch = 0;\n      }\n      \n      if (!forceRefresh && cacheValid && globalCache.purchases) {\n        try {\n          setPurchases(globalCache.purchases);\n          if (showSpinner) {\n            setLoading(false);\n          }\n          return;\n        } catch (error) {\n          logger.error('발주 데이터 캐시 사용 중 오류', error);\n          // 캐시 초기화\n          globalCache.purchases = null;\n          globalCache.lastFetch = 0;\n          invalidateFilterCache();\n        }\n      }\n      \n      const { data: { user }, error: authError } = await supabase.auth.getUser();\n      \n      if (authError || !user) {\n        logger.error('사용자 인증 실패', authError);\n        toast.error('로그인이 필요합니다.');\n        if (showSpinner) {\n          setLoading(false);\n        }\n        return;\n      }\n\n      // 승인대기 항목을 놓치지 않기 위해 시간 제한 제거\n      \n      // 먼저 purchase_requests만 가져오기 (vendors JOIN 제거)\n      const { data, error } = await supabase\n        .from('purchase_requests')\n        .select(`\n          *,\n          purchase_request_items(*)\n        `)\n        .order('request_date', { ascending: false })\n        .limit(1000); // 성능 최적화: 최대 1000건\n\n      if (error) {\n        throw error;\n      }\n\n      // 필요시에만 employees와 vendors 데이터 조회 (캐시된 데이터 우선 사용)\n      let employeeList: any[] = [];\n      let vendorList: any[] = [];\n      \n      // 데이터 변환에서 필요한 경우에만 조회\n      if (data && data.length > 0) {\n        // 병렬로 조회하여 성능 개선 (쿼리 필드명 수정)\n        const [employeesResult, vendorsResult] = await Promise.all([\n          supabase.from('employees').select('id, name, email'),\n          supabase.from('vendors').select('id, vendor_name, vendor_payment_schedule')\n        ]);\n        \n        employeeList = employeesResult.data || [];\n        vendorList = vendorsResult.data || [];\n      }\n\n      \n      // 오늘 발주 항목 확인\n      const today = new Date().toISOString().split('T')[0];\n      const todayItems = (data || []).filter((d: any) => d.request_date?.startsWith(today));\n\n      // 데이터 변환 (hanslwebapp과 동일)\n      const processedData = (data || []).map((request: any) => {\n        // 첫 번째 품목 정보 (기존 방식과 호환성 유지)\n        const firstItem = request.purchase_request_items?.[0] || {};\n        \n        // requester_id로 employee 찾기\n        const requesterEmployee = employeeList.find(emp => emp.id === request.requester_id);\n        \n        // vendor_id로 vendor 찾기\n        const vendorInfo = vendorList.find(vendor => vendor.id === request.vendor_id);\n        \n        return {\n          id: Number(request.id),\n          purchase_order_number: request.purchase_order_number as string,\n          request_date: request.request_date as string,\n          delivery_request_date: request.delivery_request_date ?? null,\n          revised_delivery_request_date: request.revised_delivery_request_date ?? null,\n          progress_type: request.progress_type as string,\n          payment_completed_at: request.payment_completed_at as string,\n          payment_completed_by_name: request.payment_completed_by_name as string,\n          payment_category: request.payment_category as string,\n          currency: request.currency as string,\n          request_type: request.request_type as string,\n          vendor: undefined, // vendors JOIN 제거됨\n          vendor_name: request.vendor_name || '', // purchase_requests 테이블의 vendor_name 사용\n          vendor_payment_schedule: vendorInfo?.vendor_payment_schedule || '', // vendors 테이블에서 조회\n          vendor_contacts: [], // vendors JOIN 없으므로 빈배열\n          requester_id: request.requester_id as string,\n          requester_name: request.requester_name as string,\n          requester_full_name: requesterEmployee?.name || request.requester_name || '',\n          item_name: firstItem.item_name as string || '',\n          specification: firstItem.specification as string || '',\n          quantity: Number(firstItem.quantity) || 0,\n          unit_price_value: Number(firstItem.unit_price_value) || 0,\n          amount_value: Number(firstItem.amount_value) || 0,\n          remark: firstItem.remark as string || '',\n          project_vendor: request.project_vendor as string,\n          sales_order_number: request.sales_order_number as string,\n          project_item: request.project_item as string,\n          line_number: Number(firstItem.line_number) || 1,\n          contact_name: '', // vendor_contacts JOIN 없으므로 빈값\n          middle_manager_status: request.middle_manager_status,\n          final_manager_status: request.final_manager_status,\n          is_received: !!request.is_received,\n          received_at: request.received_at as string,\n          is_payment_completed: !!request.is_payment_completed,\n          is_po_download: !!request.is_po_download,\n          link: firstItem.link as string | undefined,\n          // 전체 품목 리스트 추가 (hanslwebapp과 동일하게 items로 통일) - line_number로 정렬\n          items: (request.purchase_request_items || []).sort((a: any, b: any) => \n            (a.line_number || 0) - (b.line_number || 0)),\n          // 총 금액 계산\n          total_amount: request.purchase_request_items?.reduce((sum: number, item: any) => \n            sum + (Number(item.amount_value) || 0), 0) || 0,\n          purchase_status: request.purchase_status || 'pending'\n        };\n      });\n\n\n      // 데이터 로드 완료 및 캐싱\n      setPurchases(processedData);\n      globalCache.purchases = processedData;\n      globalCache.lastFetch = now;\n    } catch (error) {\n      logger.error('발주 목록 로드 실패', error);\n      toast.error('발주 목록을 불러올 수 없습니다.');\n    } finally {\n      if (showSpinner) {\n        setLoading(false);\n      }\n    }\n  }, [supabase]);\n\n  const updatePurchaseOptimistic = useCallback((purchaseId: number, updater: (prev: Purchase) => Purchase) => {\n    setPurchases(prev => {\n      const next = prev.map(purchase => (purchase.id === purchaseId ? updater(purchase) : purchase));\n      globalCache.purchases = next;\n      return next;\n    });\n  }, []);\n\n  useEffect(() => {\n    loadPurchases();\n  }, [loadPurchases]);\n\n  return {\n    purchases,\n    loading,\n    currentUserRoles,\n    currentUserName,\n    currentUserEmail,\n    currentUserId,\n    refreshPurchases: loadPurchases,\n    updatePurchaseOptimistic\n  };\n};\n","import { useState, useMemo, useEffect, useCallback } from 'react';\nimport { createClient } from '@/lib/supabase/client';\nimport { Purchase } from './usePurchaseData';\n\n// 상수 정의 - 특정 직원의 발주요청 숨김 (본인이 아닌 경우에만)\nconst HIDDEN_EMPLOYEES = ['정희웅'];  // 정현웅 제거\n\nexport const useFastPurchaseFilters = (purchases: Purchase[], currentUserRoles: string[], currentUserName: string, currentUserId?: string, currentUserEmail?: string) => {\n  const supabase = createClient();\n  const [activeTab, setActiveTab] = useState('pending');\n  // 초기값 설정 - hanslwebapp과 동일하게 빈 문자열로 시작\n  const [selectedEmployee, setSelectedEmployee] = useState<string>('');\n\n  // 권한별 로직 계산\n  const isAdmin = currentUserRoles?.includes('app_admin');\n  const isFinalApprover = currentUserRoles?.includes('final_approver');\n  const isMiddleManager = currentUserRoles?.includes('middle_manager');\n  const isPurchaseManager = currentUserRoles?.includes('purchase_manager');\n  const hasApprovalRole = isAdmin || isFinalApprover || isMiddleManager;\n  \n  // lead buyer 권한 체크 추가\n  const isLeadBuyer = currentUserRoles?.includes('raw_material_manager') || \n                      currentUserRoles?.includes('consumable_manager') || \n                      currentUserRoles?.includes('purchase_manager');\n                      \n  // HR 권한 체크 추가\n  const isHr = currentUserRoles?.includes('hr');\n\n  // hanslwebapp과 동일한 로직 - roleCase 계산 (lead buyer 추가)\n  const roleCase = useMemo(() => {\n    if (!currentUserRoles || currentUserRoles.length === 0) return 1; // null\n    if (isPurchaseManager) return 2; // purchase_manager\n    if (currentUserRoles.some(r => ['middle_manager', 'final_approver', 'app_admin', 'ceo'].includes(r))) return 3;\n    return 1;\n  }, [currentUserRoles, isPurchaseManager]);\n  \n  // 탭별 기본 직원 필터 계산 (구매현황, 입고현황은 lead buyer, HR, app_admin만 전체 보기)\n  const computeDefaultEmployee = useCallback(\n    (tabKey: string): string => {\n      if (!currentUserName) return 'all';\n      \n      // 구매현황 탭은 lead buyer, HR, app_admin만 전체 보기\n      if (tabKey === 'purchase') {\n        if (isLeadBuyer || isHr || isAdmin) {\n          return 'all';\n        }\n        return currentUserName;\n      }\n      \n      // 입고현황 탭은 lead buyer, HR, app_admin만 전체 보기\n      if (tabKey === 'receipt') {\n        if (isLeadBuyer || isHr || isAdmin) {\n          return 'all';\n        }\n        return currentUserName;\n      }\n      \n      switch (roleCase) {\n        case 1: // role null\n          if (tabKey === 'done') return 'all';\n          return currentUserName;\n        case 2: // purchase_manager\n          if (tabKey === 'done') return 'all';\n          return currentUserName; // pending & receipt\n        case 3: // 관리자 권한\n          return 'all';\n        default:\n          return currentUserName;\n      }\n    },\n    [currentUserName, roleCase, isLeadBuyer, isHr, isAdmin]\n  );\n  \n  // 탭 변경 또는 사용자/역할 로딩 시 기본값 설정 (hanslwebapp과 동일)\n  useEffect(() => {\n    if (!currentUserName) return;\n    const defaultEmployee = computeDefaultEmployee(activeTab);\n    setSelectedEmployee(defaultEmployee);\n  }, [activeTab, currentUserName, roleCase, computeDefaultEmployee]);\n  \n  // 1단계: 권한별 필터링 (실시간 반영)\n  const visiblePurchases = useMemo(() => {\n    // 권한 체크 최적화 - 한 번만 계산\n    const hasManagerRole = currentUserRoles.includes('purchase_manager') || currentUserRoles.includes('app_admin');\n    \n    const result = hasManagerRole \n      ? purchases \n      : purchases.filter(p => !HIDDEN_EMPLOYEES.includes(p.requester_name));\n    return result;\n  }, [purchases, currentUserRoles]);\n\n\n  // 2단계: 탭별 필터링\n  const tabFilteredPurchases = useMemo(() => {\n    // 오늘 날짜 계산 (한국 시간 기준)\n    const today = new Date().toISOString().split('T')[0];\n    \n    const result = visiblePurchases.filter((purchase: Purchase) => {\n      let matches = false;\n      \n      switch (activeTab) {\n        case 'pending':\n          // 중간승인자나 최종승인자 중 하나라도 pending이면 승인대기\n          const middlePending = ['pending', '대기', '', null, undefined].includes(purchase.middle_manager_status as any);\n          const finalPending = ['pending', '대기', '', null, undefined].includes(purchase.final_manager_status as any);\n          \n          // 반려된 경우는 제외\n          const middleRejected = purchase.middle_manager_status === 'rejected';\n          const finalRejected = purchase.final_manager_status === 'rejected';\n          \n          if (middleRejected || finalRejected) return false;\n          \n          // 승인 완료된 경우 즉시 제거\n          const middleApproved = purchase.middle_manager_status === 'approved';\n          const finalApproved = purchase.final_manager_status === 'approved';\n          \n          if (middleApproved && finalApproved) {\n            return false; // 최종 승인 완료된 항목은 즉시 제거\n          }\n          \n          // 중간승인 대기 또는 최종승인 대기\n          matches = middlePending || finalPending;\n          \n          return matches;\n          \n        case 'purchase': {\n          // DB 확인 결과: '구매 요청' (띄어쓰기 있음) 또는 '발주'\n          const isRequest = purchase.payment_category === '구매 요청';\n          const isSeonJin = (purchase.progress_type || '').includes('선진행');\n          const isIlban = (purchase.progress_type || '').includes('일반');\n          const finalApproved = purchase.final_manager_status === 'approved';\n          \n          // 구매 완료된 경우 즉시 제거\n          if (purchase.is_payment_completed) {\n            return false; // 구매완료된 항목은 즉시 제거\n          }\n          \n          // 기본 구매현황 조건: 요청 유형이고 아직 결제되지 않음\n          if (!isRequest) {\n            matches = false;\n          } else {\n            matches = (isSeonJin) || (isIlban && finalApproved);\n          }\n          \n          return matches;\n        }\n        \n        case 'receipt': {\n          // 입고현황: 미입고 & (선진행 or 최종승인)\n          const isSeonJin = (purchase.progress_type || '').includes('선진행');\n          const finalApproved = purchase.final_manager_status === 'approved';\n          \n          // 입고 완료된 경우 즉시 제거\n          if (purchase.is_received) {\n            return false; // 입고완료된 항목은 즉시 제거\n          }\n          \n          // 기본 입고현황 조건: (선진행 or 최종승인)\n          matches = (isSeonJin || finalApproved);\n          return matches;\n        }\n        \n        case 'done':\n          matches = true;\n          return matches;\n          \n        default:\n          return true;\n      }\n    });\n    return result;\n  }, [visiblePurchases, activeTab]);\n\n  // 3단계: 직원 필터링\n  const employeeFilteredPurchases = useMemo(() => {\n    let result;\n    if (selectedEmployee && selectedEmployee !== 'all' && selectedEmployee !== '전체') {\n      result = tabFilteredPurchases.filter((purchase: Purchase) => purchase.requester_name === selectedEmployee);\n    } else {\n      result = tabFilteredPurchases;\n    }\n    return result;\n  }, [tabFilteredPurchases, selectedEmployee]);\n\n  // 4단계: 최종 정렬 및 결과 캐싱 - 최신순 (내림차순)\n  const filteredPurchases = useMemo(() => {\n    return [...employeeFilteredPurchases].sort((a, b) => {\n      const dateA = a.request_date ? new Date(a.request_date).getTime() : 0\n      const dateB = b.request_date ? new Date(b.request_date).getTime() : 0\n      return dateB - dateA\n    })\n  }, [employeeFilteredPurchases]);\n\n  // 탭 카운트 (hanslwebapp과 동일한 조건)\n  const tabCounts = useMemo(() => {\n    // 특정 직원 발주요청 숨김 처리\n    const countPurchases = visiblePurchases;\n    \n    // 날짜 필터 제거 - 전체 데이터 사용\n    const dateFilteredForCount = countPurchases;\n    \n    // 각 탭의 고유 발주요청번호 카운트 (중복 제거)\n    const getUniqueOrderCount = (filtered: Purchase[]) => {\n      return new Set(filtered.map(p => p.purchase_order_number)).size;\n    };\n    \n    // 각 탭별로 기본 직원 필터 계산 (카운트용)\n    const getFilteredDataForTab = (tabKey: string) => {\n      // 구매현황 탭은 특별 처리\n      if (tabKey === 'purchase') {\n        if (isLeadBuyer || isHr || isAdmin) {\n          return countPurchases;\n        } else {\n          return countPurchases.filter((p: Purchase) => p.requester_name === currentUserName);\n        }\n      }\n      \n      // 입고현황 탭은 특별 처리\n      if (tabKey === 'receipt') {\n        if (isLeadBuyer || isHr || isAdmin) {\n          return countPurchases;\n        } else {\n          return countPurchases.filter((p: Purchase) => p.requester_name === currentUserName);\n        }\n      }\n      \n      const defaultEmployee = computeDefaultEmployee(tabKey);\n      \n      if (defaultEmployee === 'all' || defaultEmployee === '전체') {\n        return countPurchases;\n      } else {\n        return countPurchases.filter((p: Purchase) => p.requester_name === defaultEmployee);\n      }\n    };\n    \n    // 각 탭별 데이터 필터링\n    const pendingData = getFilteredDataForTab('pending');\n    const purchaseData = getFilteredDataForTab('purchase');\n    const receiptData = getFilteredDataForTab('receipt');\n    const doneData = getFilteredDataForTab('done');\n    \n    const pendingFiltered = pendingData.filter((p: Purchase) => {\n      // 오늘 날짜\n      const today = new Date().toISOString().split('T')[0];\n      \n      // 중간승인자나 최종승인자 중 하나라도 pending이면 승인대기\n      const middlePending = ['pending', '대기', '', null, undefined].includes(p.middle_manager_status as any);\n      const finalPending = ['pending', '대기', '', null, undefined].includes(p.final_manager_status as any);\n      \n      // 반려된 경우는 제외\n      const middleRejected = p.middle_manager_status === 'rejected';\n      const finalRejected = p.final_manager_status === 'rejected';\n      \n      if (middleRejected || finalRejected) return false;\n      \n      // 승인 완료된 경우 즉시 제거\n      const middleApproved = p.middle_manager_status === 'approved';\n      const finalApproved = p.final_manager_status === 'approved';\n      \n      if (middleApproved && finalApproved) {\n        return false; // 최종 승인 완료된 항목은 즉시 제거\n      }\n      \n      // 중간승인 대기 또는 최종승인 대기\n      return middlePending || finalPending;\n    });\n    \n    const purchaseFiltered = purchaseData.filter((p: Purchase) => {\n      // 오늘 날짜\n      const today = new Date().toISOString().split('T')[0];\n      \n      const isRequest = p.payment_category === '구매 요청';\n      const isSeonJin = (p.progress_type || '').includes('선진행');\n      const isIlban = (p.progress_type || '').includes('일반');\n      const finalApproved = p.final_manager_status === 'approved';\n      \n      // 구매 완료된 경우 즉시 제거\n      if (p.is_payment_completed) {\n        return false; // 구매완료된 항목은 즉시 제거\n      }\n      \n      if (!isRequest) return false;\n      return (isSeonJin) || (isIlban && finalApproved);\n    });\n    \n    const receiptFiltered = receiptData.filter((p: Purchase) => {\n      // 오늘 날짜\n      const today = new Date().toISOString().split('T')[0];\n      \n      const isSeonJin = (p.progress_type || '').includes('선진행');\n      const finalApproved = p.final_manager_status === 'approved';\n      \n      // 입고 완료된 경우 즉시 제거\n      if (p.is_received) {\n        return false; // 입고완료된 항목은 즉시 제거\n      }\n      \n      return (isSeonJin || finalApproved);\n    });\n    \n    const counts = {\n      pending: getUniqueOrderCount(pendingFiltered),\n      purchase: getUniqueOrderCount(purchaseFiltered),\n      receipt: getUniqueOrderCount(receiptFiltered),\n      done: getUniqueOrderCount(doneData)  // 전체 항목\n    };\n    \n    return counts;\n  }, [visiblePurchases, roleCase, currentUserName, computeDefaultEmployee, isLeadBuyer, isHr, isAdmin]);\n\n\n  return {\n    // States\n    activeTab,\n    selectedEmployee,\n    \n    // Setters\n    setActiveTab,\n    setSelectedEmployee,\n    \n    // Computed values\n    filteredPurchases,\n    tabCounts\n  };\n};","import { memo, lazy, Suspense } from 'react';\nimport { Purchase } from '@/hooks/usePurchaseData';\n\n// Lazy load the heavy table component\nconst FastPurchaseTable = lazy(() => import('./FastPurchaseTable'));\n\ninterface LazyPurchaseTableProps {\n  purchases: Purchase[];\n  activeTab: string;\n  currentUserRoles: string[];\n  onRefresh: (forceRefresh?: boolean, options?: { silent?: boolean }) => Promise<void> | void;\n  onOptimisticUpdate: (purchaseId: number, updater: (prev: Purchase) => Purchase) => void;\n  onPaymentComplete: (id: number) => Promise<void>;\n  onReceiptComplete: (id: number) => Promise<void>;\n}\n\n// Memoized loading component\nconst TableSkeleton = memo(() => (\n  <div className=\"p-4 space-y-4\">\n    {[...Array(5)].map((_, i) => (\n      <div key={i} className=\"flex space-x-4 animate-pulse\">\n        <div className=\"h-4 bg-gray-200 rounded w-1/4\"></div>\n        <div className=\"h-4 bg-gray-200 rounded w-1/4\"></div>\n        <div className=\"h-4 bg-gray-200 rounded w-1/4\"></div>\n        <div className=\"h-4 bg-gray-200 rounded w-1/4\"></div>\n      </div>\n    ))}\n  </div>\n));\nTableSkeleton.displayName = 'TableSkeleton';\n\n// Main component with memoization\nconst LazyPurchaseTable = memo<LazyPurchaseTableProps>(({\n  purchases,\n  activeTab,\n  currentUserRoles,\n  onRefresh,\n  onOptimisticUpdate,\n  onPaymentComplete,\n  onReceiptComplete\n}) => (\n  <Suspense fallback={<TableSkeleton />}>\n    <FastPurchaseTable\n      purchases={purchases}\n      activeTab={activeTab}\n      currentUserRoles={currentUserRoles}\n      onRefresh={onRefresh}\n      onOptimisticUpdate={onOptimisticUpdate}\n      onPaymentComplete={onPaymentComplete}\n      onReceiptComplete={onReceiptComplete}\n    />\n  </Suspense>\n));\n\nLazyPurchaseTable.displayName = 'LazyPurchaseTable';\n\nexport default LazyPurchaseTable;","import { useState, useRef, useEffect } from 'react'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { \n  Filter, \n  ArrowUpDown, \n  Search, \n  X, \n  Plus,\n  Calendar,\n  User,\n  Building,\n  Package,\n  DollarSign,\n  CheckCircle\n} from 'lucide-react'\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from '@/components/ui/popover'\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select'\nimport { Badge } from '@/components/ui/badge'\n\n// 필터 타입 정의\nexport interface FilterRule {\n  id: string\n  field: string\n  condition: string\n  value: any\n  label: string\n}\n\nexport interface SortRule {\n  field: string\n  direction: 'asc' | 'desc'\n  label: string\n}\n\ninterface FilterToolbarProps {\n  activeFilters: FilterRule[]\n  sortConfig: SortRule | null\n  searchTerm: string\n  onFiltersChange: (filters: FilterRule[]) => void\n  onSortChange: (sort: SortRule | null) => void\n  onSearchChange: (search: string) => void\n  availableEmployees?: string[]\n  availableVendors?: string[]\n  availableContacts?: string[]\n  availablePaymentSchedules?: string[]\n}\n\n// 필터 항목 정의\nconst FILTER_FIELDS = [\n  // 날짜 필터\n  { \n    key: 'date_range', \n    label: '기간별', \n    type: 'date_range',\n    icon: Calendar,\n    category: '날짜'\n  },\n  { \n    key: 'date_month', \n    label: '월별', \n    type: 'date_month',\n    icon: Calendar,\n    category: '날짜'\n  },\n  \n  // 검색&드롭다운 필터\n  { \n    key: 'requester_name', \n    label: '요청자', \n    type: 'searchable_select',\n    icon: User,\n    category: '사용자'\n  },\n  { \n    key: 'vendor_name', \n    label: '업체', \n    type: 'searchable_select',\n    icon: Building,\n    category: '사용자'\n  },\n  { \n    key: 'contact_name', \n    label: '담당자', \n    type: 'searchable_select',\n    icon: User,\n    category: '사용자'\n  },\n  \n  // 텍스트 필터\n  { \n    key: 'purchase_order_number', \n    label: '발주번호', \n    type: 'text',\n    icon: Package,\n    category: '텍스트'\n  },\n  { \n    key: 'item_name', \n    label: '품명', \n    type: 'text',\n    icon: Package,\n    category: '텍스트'\n  },\n  { \n    key: 'specification', \n    label: '규격', \n    type: 'text',\n    icon: Package,\n    category: '텍스트'\n  },\n  { \n    key: 'remark', \n    label: '비고', \n    type: 'text',\n    icon: Package,\n    category: '텍스트'\n  },\n  { \n    key: 'project_vendor', \n    label: 'PJ업체', \n    type: 'text',\n    icon: Building,\n    category: '텍스트'\n  },\n  { \n    key: 'project_item', \n    label: 'PJ ITEM', \n    type: 'text',\n    icon: Package,\n    category: '텍스트'\n  },\n  { \n    key: 'sales_order_number', \n    label: '수주번호', \n    type: 'text',\n    icon: Package,\n    category: '텍스트'\n  },\n  \n  // 숫자 필터\n  { \n    key: 'quantity', \n    label: '수량', \n    type: 'number',\n    icon: DollarSign,\n    category: '숫자'\n  },\n  { \n    key: 'unit_price_value', \n    label: '단가', \n    type: 'number',\n    icon: DollarSign,\n    category: '숫자'\n  },\n  { \n    key: 'total_amount', \n    label: '합계', \n    type: 'number',\n    icon: DollarSign,\n    category: '숫자'\n  },\n  \n  // 상태 필터\n  { \n    key: 'payment_category', \n    label: '결제종류', \n    type: 'select',\n    icon: CheckCircle,\n    category: '상태',\n    options: ['현장결제', '구매요청', '발주요청']\n  },\n  { \n    key: 'payment_schedule', \n    label: '지출예정일', \n    type: 'select_with_empty',\n    icon: Calendar,\n    category: '상태'\n  },\n  { \n    key: 'is_payment_completed', \n    label: '구매현황', \n    type: 'select',\n    icon: CheckCircle,\n    category: '상태',\n    options: ['대기', '완료']\n  },\n  { \n    key: 'is_received', \n    label: '입고현황', \n    type: 'select',\n    icon: CheckCircle,\n    category: '상태',\n    options: ['대기', '완료']\n  },\n  { \n    key: 'is_statement_received', \n    label: '거래명세서 확인', \n    type: 'select',\n    icon: CheckCircle,\n    category: '상태',\n    options: ['대기', '완료']\n  }\n]\n\n// 조건 옵션 정의\nconst TEXT_CONDITIONS = [\n  { value: 'contains', label: '포함' },\n  { value: 'equals', label: '같음' },\n  { value: 'starts_with', label: '시작함' },\n  { value: 'ends_with', label: '끝남' },\n  { value: 'is_empty', label: '비어있음' },\n  { value: 'is_not_empty', label: '비어있지 않음' }\n]\n\nconst NUMBER_CONDITIONS = [\n  { value: 'equals', label: '같음' },\n  { value: 'greater_than', label: '이상' },\n  { value: 'less_than', label: '이하' },\n  { value: 'between', label: '범위' },\n  { value: 'is_empty', label: '비어있음' },\n  { value: 'is_not_empty', label: '비어있지 않음' }\n]\n\nconst DATE_CONDITIONS = [\n  { value: 'equals', label: '같음' },\n  { value: 'after', label: '이후' },\n  { value: 'before', label: '이전' },\n  { value: 'between', label: '범위' },\n  { value: 'is_empty', label: '비어있음' },\n  { value: 'is_not_empty', label: '비어있지 않음' }\n]\n\nconst SELECT_CONDITIONS = [\n  { value: 'equals', label: '같음' },\n  { value: 'not_equals', label: '아님' }\n]\n\n// 정렬 옵션 정의\nconst SORT_FIELDS = [\n  { value: 'request_date', label: '요청일' },\n  { value: 'purchase_order_number', label: '발주번호' },\n  { value: 'vendor_name', label: '업체명' },\n  { value: 'requester_name', label: '요청자' },\n  { value: 'total_amount', label: '합계' },\n  { value: 'delivery_request_date', label: '입고요청일' },\n  { value: 'created_at', label: '생성일' }\n]\n\nexport default function FilterToolbar({\n  activeFilters,\n  sortConfig,\n  searchTerm,\n  onFiltersChange,\n  onSortChange,\n  onSearchChange,\n  availableEmployees = [],\n  availableVendors = [],\n  availableContacts = [],\n  availablePaymentSchedules = []\n}: FilterToolbarProps) {\n  const [isFilterOpen, setIsFilterOpen] = useState(false)\n  const [isSortOpen, setIsSortOpen] = useState(false)\n  const [isSearchExpanded, setIsSearchExpanded] = useState(false)\n  const [newFilter, setNewFilter] = useState<Partial<FilterRule>>({})\n  const searchInputRef = useRef<HTMLInputElement>(null)\n\n  // 검색 확장 시 포커스\n  useEffect(() => {\n    if (isSearchExpanded && searchInputRef.current) {\n      searchInputRef.current.focus()\n    }\n  }, [isSearchExpanded])\n\n  const handleAddFilter = (field: string) => {\n    const fieldConfig = FILTER_FIELDS.find(f => f.key === field)\n    if (!fieldConfig) return\n\n    setNewFilter({\n      id: `${field}_${Date.now()}`,\n      field,\n      condition: 'contains',\n      value: '',\n      label: fieldConfig.label\n    })\n  }\n\n  const handleApplyFilter = () => {\n    if (newFilter.field && newFilter.condition !== undefined && newFilter.value !== '') {\n      const filter: FilterRule = {\n        id: newFilter.id!,\n        field: newFilter.field,\n        condition: newFilter.condition,\n        value: newFilter.value,\n        label: newFilter.label!\n      }\n      onFiltersChange([...activeFilters, filter])\n      setNewFilter({})\n      setIsFilterOpen(false)\n    }\n  }\n\n  const handleRemoveFilter = (filterId: string) => {\n    onFiltersChange(activeFilters.filter(f => f.id !== filterId))\n  }\n\n  const handleClearAllFilters = () => {\n    onFiltersChange([])\n    setIsFilterOpen(false)\n  }\n\n  const handleSortChange = (field: string, direction: 'asc' | 'desc') => {\n    const fieldConfig = SORT_FIELDS.find(f => f.value === field)\n    if (!fieldConfig) return\n\n    onSortChange({\n      field,\n      direction,\n      label: fieldConfig.label\n    })\n    setIsSortOpen(false)\n  }\n\n  const getConditionOptions = (fieldType: string) => {\n    switch (fieldType) {\n      case 'text':\n      case 'searchable_select':\n        return TEXT_CONDITIONS\n      case 'number':\n        return NUMBER_CONDITIONS\n      case 'date_range':\n      case 'date_month':\n        return DATE_CONDITIONS\n      case 'select':\n      case 'select_with_empty':\n        return SELECT_CONDITIONS\n      default:\n        return TEXT_CONDITIONS\n    }\n  }\n\n  const renderValueInput = () => {\n    const fieldConfig = FILTER_FIELDS.find(f => f.key === newFilter.field)\n    if (!fieldConfig) return null\n\n    switch (fieldConfig.type) {\n      case 'text':\n        return (\n          <Input\n            placeholder=\"값 입력\"\n            value={newFilter.value || ''}\n            onChange={(e) => setNewFilter(prev => ({ ...prev, value: e.target.value }))}\n            className=\"w-full\"\n          />\n        )\n      \n      case 'number':\n        return (\n          <Input\n            type=\"number\"\n            placeholder=\"숫자 입력\"\n            value={newFilter.value || ''}\n            onChange={(e) => setNewFilter(prev => ({ ...prev, value: e.target.value }))}\n            className=\"w-full\"\n          />\n        )\n\n      case 'searchable_select':\n        let options: string[] = []\n        if (fieldConfig.key === 'requester_name') options = availableEmployees\n        else if (fieldConfig.key === 'vendor_name') options = availableVendors\n        else if (fieldConfig.key === 'contact_name') options = availableContacts\n\n        return (\n          <Select value={newFilter.value || ''} onValueChange={(value) => setNewFilter(prev => ({ ...prev, value }))}>\n            <SelectTrigger>\n              <SelectValue placeholder=\"선택하세요\" />\n            </SelectTrigger>\n            <SelectContent>\n              {options.map(option => (\n                <SelectItem key={option} value={option}>{option}</SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        )\n\n      case 'select':\n        return (\n          <Select value={newFilter.value || ''} onValueChange={(value) => setNewFilter(prev => ({ ...prev, value }))}>\n            <SelectTrigger>\n              <SelectValue placeholder=\"선택하세요\" />\n            </SelectTrigger>\n            <SelectContent>\n              {fieldConfig.options?.map(option => (\n                <SelectItem key={option} value={option}>{option}</SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        )\n\n      case 'select_with_empty':\n        const scheduleOptions = ['공란', ...availablePaymentSchedules]\n        return (\n          <Select value={newFilter.value || ''} onValueChange={(value) => setNewFilter(prev => ({ ...prev, value }))}>\n            <SelectTrigger>\n              <SelectValue placeholder=\"선택하세요\" />\n            </SelectTrigger>\n            <SelectContent>\n              {scheduleOptions.map(option => (\n                <SelectItem key={option} value={option}>{option}</SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        )\n\n      default:\n        return null\n    }\n  }\n\n  return (\n    <div className=\"w-full space-y-3\">\n      {/* 필터 툴바 */}\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-2\">\n          {/* 필터 버튼 */}\n          <Popover open={isFilterOpen} onOpenChange={setIsFilterOpen}>\n            <PopoverTrigger asChild>\n              <Button \n                variant=\"outline\" \n                size=\"sm\"\n                className=\"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50\"\n              >\n                <Filter className=\"w-4 h-4 mr-1\" />\n                필터\n                {activeFilters.length > 0 && (\n                  <Badge variant=\"secondary\" className=\"ml-1 badge-stats-primary\">\n                    {activeFilters.length}\n                  </Badge>\n                )}\n              </Button>\n            </PopoverTrigger>\n            <PopoverContent className=\"w-80 p-4\" align=\"start\">\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center justify-between\">\n                  <h4 className=\"modal-subtitle\">필터</h4>\n                  {activeFilters.length > 0 && (\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={handleClearAllFilters}\n                      className=\"button-base text-red-600 hover:text-red-700 hover:bg-red-50\"\n                    >\n                      모든 필터 지우기\n                    </Button>\n                  )}\n                </div>\n\n                {/* 활성 필터 목록 */}\n                {activeFilters.length > 0 && (\n                  <div className=\"space-y-2\">\n                    {activeFilters.map(filter => (\n                      <div key={filter.id} className=\"flex items-center justify-between p-2 bg-gray-50 business-radius\">\n                        <span className=\"card-description\">\n                          {filter.label}: {filter.value}\n                        </span>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => handleRemoveFilter(filter.id)}\n                          className=\"button-base h-6 w-6 p-0 hover:bg-red-50\"\n                        >\n                          <X className=\"w-3 h-3\" />\n                        </Button>\n                      </div>\n                    ))}\n                    <div className=\"border-t border-gray-200 my-2\" />\n                  </div>\n                )}\n\n                {/* 새 필터 추가 */}\n                <div className=\"space-y-3\">\n                  <Select onValueChange={handleAddFilter}>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"+ 필터 추가\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {Object.entries(\n                        FILTER_FIELDS.reduce((acc, field) => {\n                          if (!acc[field.category]) acc[field.category] = []\n                          acc[field.category].push(field)\n                          return acc\n                        }, {} as Record<string, typeof FILTER_FIELDS>)\n                      ).map(([category, fields]) => (\n                        <div key={category}>\n                          <div className=\"px-2 py-1 text-xs font-semibold text-gray-500 uppercase\">\n                            {category}\n                          </div>\n                          {fields.map(field => (\n                            <SelectItem key={field.key} value={field.key}>\n                              <div className=\"flex items-center gap-2\">\n                                <field.icon className=\"w-4 h-4\" />\n                                {field.label}\n                              </div>\n                            </SelectItem>\n                          ))}\n                        </div>\n                      ))}\n                    </SelectContent>\n                  </Select>\n\n                  {/* 필터 설정 UI */}\n                  {newFilter.field && (\n                    <div className=\"space-y-3 p-3 border business-radius bg-white\">\n                      <div className=\"flex items-center gap-2\">\n                        <span className=\"card-title\">{newFilter.label} 필터</span>\n                      </div>\n                      \n                      <div className=\"grid grid-cols-2 gap-2\">\n                        <Select \n                          value={newFilter.condition || ''} \n                          onValueChange={(value) => setNewFilter(prev => ({ ...prev, condition: value }))}\n                        >\n                          <SelectTrigger>\n                            <SelectValue placeholder=\"조건\" />\n                          </SelectTrigger>\n                          <SelectContent>\n                            {getConditionOptions(\n                              FILTER_FIELDS.find(f => f.key === newFilter.field)?.type || 'text'\n                            ).map(condition => (\n                              <SelectItem key={condition.value} value={condition.value}>\n                                {condition.label}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n\n                        <div>\n                          {renderValueInput()}\n                        </div>\n                      </div>\n\n                      <div className=\"flex gap-2\">\n                        <Button\n                          size=\"sm\"\n                          onClick={handleApplyFilter}\n                          disabled={!newFilter.field || !newFilter.condition || newFilter.value === ''}\n                          className=\"button-base bg-blue-500 text-white hover:bg-blue-600\"\n                        >\n                          적용\n                        </Button>\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => setNewFilter({})}\n                          className=\"button-base border border-gray-300 bg-white text-gray-700\"\n                        >\n                          취소\n                        </Button>\n                      </div>\n                    </div>\n                  )}\n                </div>\n              </div>\n            </PopoverContent>\n          </Popover>\n\n          {/* 정렬 버튼 */}\n          <Popover open={isSortOpen} onOpenChange={setIsSortOpen}>\n            <PopoverTrigger asChild>\n              <Button \n                variant=\"outline\" \n                size=\"sm\"\n                className=\"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50\"\n              >\n                <ArrowUpDown className=\"w-4 h-4 mr-1\" />\n                정렬\n                {sortConfig && (\n                  <span className=\"ml-1 card-description\">\n                    ({sortConfig.direction === 'asc' ? '↑' : '↓'})\n                  </span>\n                )}\n              </Button>\n            </PopoverTrigger>\n            <PopoverContent className=\"w-64 p-4\" align=\"start\">\n              <div className=\"space-y-4\">\n                <h4 className=\"modal-subtitle\">정렬</h4>\n                \n                <div className=\"space-y-2\">\n                  {SORT_FIELDS.map(field => (\n                    <div key={field.value} className=\"space-y-1\">\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={() => handleSortChange(field.value, 'asc')}\n                        className={`button-base w-full justify-start ${\n                          sortConfig?.field === field.value && sortConfig?.direction === 'asc'\n                            ? 'bg-blue-50 text-blue-700'\n                            : 'text-gray-700 hover:bg-gray-50'\n                        }`}\n                      >\n                        {field.label} (오름차순) ↑\n                      </Button>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={() => handleSortChange(field.value, 'desc')}\n                        className={`button-base w-full justify-start ${\n                          sortConfig?.field === field.value && sortConfig?.direction === 'desc'\n                            ? 'bg-blue-50 text-blue-700'\n                            : 'text-gray-700 hover:bg-gray-50'\n                        }`}\n                      >\n                        {field.label} (내림차순) ↓\n                      </Button>\n                    </div>\n                  ))}\n                </div>\n\n                {sortConfig && (\n                  <div className=\"border-t pt-2\">\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => onSortChange(null)}\n                      className=\"button-base w-full border border-gray-300 text-gray-700\"\n                    >\n                      정렬 해제\n                    </Button>\n                  </div>\n                )}\n              </div>\n            </PopoverContent>\n          </Popover>\n\n          {/* 검색 버튼 */}\n          <div className=\"flex items-center gap-2\">\n            {!isSearchExpanded ? (\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => setIsSearchExpanded(true)}\n                className=\"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50\"\n              >\n                <Search className=\"w-4 h-4 mr-1\" />\n                검색\n              </Button>\n            ) : (\n              <div className=\"flex items-center gap-2\">\n                <Input\n                  ref={searchInputRef}\n                  placeholder=\"전체 검색...\"\n                  value={searchTerm}\n                  onChange={(e) => onSearchChange(e.target.value)}\n                  className=\"w-64\"\n                />\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => {\n                    setIsSearchExpanded(false)\n                    onSearchChange('')\n                  }}\n                  className=\"button-base h-8 w-8 p-0\"\n                >\n                  <X className=\"w-4 h-4\" />\n                </Button>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* 활성 필터 태그 */}\n      {activeFilters.length > 0 && (\n        <div className=\"flex flex-wrap gap-2\">\n          {activeFilters.map(filter => (\n            <Badge\n              key={filter.id}\n              variant=\"secondary\"\n              className=\"badge-base flex items-center gap-1 bg-blue-50 text-blue-700 border-blue-200\"\n            >\n              {filter.label}: {filter.value}\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => handleRemoveFilter(filter.id)}\n                className=\"h-4 w-4 p-0 hover:bg-blue-100 ml-1\"\n              >\n                <X className=\"w-3 h-3\" />\n              </Button>\n            </Badge>\n          ))}\n        </div>\n      )}\n    </div>\n  )\n}","\nimport { useState, lazy, Suspense, useEffect, useCallback, useMemo, useRef } from \"react\";\nimport { useNavigate, useLocation } from \"react-router-dom\";\nimport { usePurchaseData, clearPurchaseCache } from \"@/hooks/usePurchaseData\";\nimport { useFastPurchaseFilters } from \"@/hooks/useFastPurchaseFilters\";\nimport LazyPurchaseTable from \"@/components/purchase/LazyPurchaseTable\";\nimport FilterToolbar, { FilterRule, SortRule } from \"@/components/purchase/FilterToolbar\";\n\nimport { Plus, Package } from \"lucide-react\";\nimport { generatePurchaseOrderExcelJS, PurchaseOrderData } from \"@/utils/exceljs/generatePurchaseOrderExcel\";\n\n// Lazy load modal for better performance\nconst PurchaseItemsModal = lazy(() => import(\"@/components/purchase/PurchaseItemsModal\"));\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\n// Tabs 컴포넌트를 제거하고 직접 구현 (hanslwebapp 방식)\nimport { Button } from \"@/components/ui/button\";\nimport { createClient } from \"@/lib/supabase/client\";\nimport { toast } from \"sonner\";\nimport { Purchase } from \"@/hooks/usePurchaseData\";\nimport { logger } from \"@/lib/logger\";\n\ninterface PurchaseListMainProps {\n  onEmailToggle?: () => void;\n  showEmailButton?: boolean;\n}\n\n// 화면 상단의 탭(진행상태별) 목록\nconst NAV_TABS: { key: string; label: string }[] = [\n  { key: 'pending', label: '승인대기' },\n  { key: 'purchase', label: '구매 현황' },\n  { key: 'receipt', label: '입고 현황' },\n  { key: 'done', label: '전체 항목' },\n];\n\n// 발주 목록 메인 컴포넌트\nexport default function PurchaseListMain({ onEmailToggle, showEmailButton = true }: PurchaseListMainProps) {\n  const navigate = useNavigate();\n  const location = useLocation();\n  const supabase = createClient();\n  const [selectedPurchase, setSelectedPurchase] = useState<Purchase | null>(null);\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  \n  // 고급 필터 상태 관리\n  const [activeFilters, setActiveFilters] = useState<FilterRule[]>([]);\n  const [sortConfig, setSortConfig] = useState<SortRule | null>(null);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [availableEmployees, setAvailableEmployees] = useState<string[]>([]);\n  const [availableVendors, setAvailableVendors] = useState<string[]>([]);\n  const [availableContacts, setAvailableContacts] = useState<string[]>([]);\n  const [availablePaymentSchedules, setAvailablePaymentSchedules] = useState<string[]>([]);\n  \n  // 발주 데이터 및 사용자 정보\n  const {\n    purchases,\n    loading,\n    currentUserRoles,\n    currentUserName,\n    currentUserEmail,\n    currentUserId,\n    refreshPurchases: loadPurchases,\n    updatePurchaseOptimistic\n  } = usePurchaseData();\n  \n  const isAdmin = currentUserRoles?.includes('app_admin');\n  \n\n  // 필터링 및 탭 관리\n  const {\n    activeTab,\n    selectedEmployee,\n    setActiveTab,\n    setSelectedEmployee,\n    filteredPurchases,\n    tabCounts\n  } = useFastPurchaseFilters(purchases, currentUserRoles, currentUserName, currentUserId, currentUserEmail);\n  \n  // URL 쿼리 파라미터에서 탭 설정\n  useEffect(() => {\n    const searchParams = new URLSearchParams(location.search);\n    const tab = searchParams.get('tab');\n    if (tab === 'purchase') {\n      setActiveTab('purchase');\n    }\n  }, [location.search, setActiveTab]);\n\n  // 필터 옵션 데이터 로드\n  useEffect(() => {\n    const loadFilterOptions = async () => {\n      try {\n        // 요청자 목록 (employees 테이블)\n        const { data: employees } = await supabase\n          .from('employees')\n          .select('name')\n          .not('name', 'is', null);\n        \n        if (employees) {\n          const employeeNames = [...new Set(employees.map((e: any) => e.name).filter(Boolean))];\n          setAvailableEmployees(employeeNames as string[]);\n        }\n\n        // 업체 목록 (vendors 테이블)\n        const { data: vendors } = await supabase\n          .from('vendors')\n          .select('vendor_name')\n          .not('vendor_name', 'is', null);\n        \n        if (vendors) {\n          const vendorNames = [...new Set(vendors.map((v: any) => v.vendor_name).filter(Boolean))];\n          setAvailableVendors(vendorNames as string[]);\n        }\n\n        // 담당자 목록 (vendor_contacts 테이블)\n        const { data: contacts } = await supabase\n          .from('vendor_contacts')\n          .select('contact_name')\n          .not('contact_name', 'is', null);\n        \n        if (contacts) {\n          const contactNames = [...new Set(contacts.map((c: any) => c.contact_name).filter(Boolean))];\n          setAvailableContacts(contactNames as string[]);\n        }\n\n        // 지출예정일 목록 (vendors 테이블의 payment_schedule)\n        const { data: schedules } = await supabase\n          .from('vendors')\n          .select('payment_schedule')\n          .not('payment_schedule', 'is', null);\n        \n        if (schedules) {\n          const scheduleNames = [...new Set(schedules.map((s: any) => s.payment_schedule).filter(Boolean))];\n          setAvailablePaymentSchedules(scheduleNames as string[]);\n        }\n      } catch (error) {\n        logger.error('필터 옵션 데이터 로드 실패', error);\n      }\n    };\n\n    loadFilterOptions();\n  }, [supabase]);\n  \n  // 탭 이동 시 최신 데이터 무음 새로고침\n  const hasInitializedTabRefresh = useRef(false);\n  useEffect(() => {\n    if (!hasInitializedTabRefresh.current) {\n      hasInitializedTabRefresh.current = true;\n      return;\n    }\n\n    const refreshLatestData = async () => {\n      try {\n        await loadPurchases(true, { silent: true });\n      } catch (error) {\n        console.error('탭 전환 시 발주 데이터 새로고침 실패', error);\n      }\n    };\n\n    refreshLatestData();\n  }, [activeTab, loadPurchases]);\n\n\n  // 상태에 따른 배지 생성 - 메모이제이션 적용\n  const getStatusBadge = useCallback((purchase: Purchase) => {\n    if (purchase.is_received) {\n      return <Badge variant={null} className=\"badge-success\">입고완료</Badge>;\n    } else if (purchase.middle_manager_status === 'approved' && purchase.final_manager_status === 'approved') {\n      return <Badge variant={null} className=\"badge-primary\">구매진행</Badge>;\n    } else if (purchase.middle_manager_status === 'rejected' || purchase.final_manager_status === 'rejected') {\n      return <Badge variant={null} className=\"badge-danger\">반려</Badge>;\n    } else {\n      return <Badge variant={null} className=\"badge-warning\">승인대기</Badge>;\n    }\n  }, []);\n\n  // 입고 현황 계산\n  const getReceiptProgress = (purchase: Purchase) => {\n    if (!purchase.items || purchase.items.length === 0) return { received: 0, total: 0, percentage: 0 };\n    \n    const total = purchase.items.length;\n    const received = purchase.items.filter(item => \n      item.actual_received_date !== null && item.actual_received_date !== undefined\n    ).length;\n    const percentage = total > 0 ? Math.round((received / total) * 100) : 0;\n    \n    return { received, total, percentage };\n  };\n\n  // 선진행 체크 함수\n  const isAdvancePayment = (progress_type?: string) => {\n    return progress_type === '선진행' || progress_type?.trim() === '선진행' || progress_type?.includes('선진행');\n  };\n\n  // 고급 필터링 로직\n  const applyAdvancedFilters = useCallback((purchases: Purchase[]) => {\n    let filtered = [...purchases];\n\n    // 검색어 필터링\n    if (searchTerm.trim()) {\n      const searchLower = searchTerm.toLowerCase().trim();\n      filtered = filtered.filter(purchase => \n        purchase.purchase_order_number?.toLowerCase().includes(searchLower) ||\n        purchase.vendor_name?.toLowerCase().includes(searchLower) ||\n        purchase.requester_name?.toLowerCase().includes(searchLower) ||\n        purchase.item_name?.toLowerCase().includes(searchLower) ||\n        purchase.specification?.toLowerCase().includes(searchLower) ||\n        purchase.remark?.toLowerCase().includes(searchLower) ||\n        purchase.project_vendor?.toLowerCase().includes(searchLower) ||\n        purchase.project_item?.toLowerCase().includes(searchLower) ||\n        purchase.sales_order_number?.toLowerCase().includes(searchLower)\n      );\n    }\n\n    // 개별 필터 적용\n    activeFilters.forEach(filter => {\n      filtered = filtered.filter(purchase => {\n        const fieldValue = getFieldValue(purchase, filter.field);\n        return applyFilterCondition(fieldValue, filter.condition, filter.value);\n      });\n    });\n\n    return filtered;\n  }, [searchTerm, activeFilters]);\n\n  // 필드 값 추출 함수\n  const getFieldValue = (purchase: Purchase, field: string): any => {\n    switch (field) {\n      case 'purchase_order_number':\n        return purchase.purchase_order_number;\n      case 'payment_category':\n        return purchase.payment_category;\n      case 'requester_name':\n        return purchase.requester_name;\n      case 'vendor_name':\n        return purchase.vendor_name;\n      case 'contact_name':\n        return purchase.contact_name;\n      case 'item_name':\n        return purchase.item_name;\n      case 'specification':\n        return purchase.specification;\n      case 'quantity':\n        return purchase.quantity;\n      case 'unit_price_value':\n        return purchase.unit_price_value;\n      case 'total_amount':\n        return purchase.total_amount;\n      case 'remark':\n        return purchase.remark;\n      case 'project_vendor':\n        return purchase.project_vendor;\n      case 'project_item':\n        return purchase.project_item;\n      case 'sales_order_number':\n        return purchase.sales_order_number;\n      case 'payment_schedule':\n        return (purchase as any).payment_schedule;\n      case 'is_payment_completed':\n        return purchase.is_payment_completed ? '완료' : '대기';\n      case 'is_received':\n        return purchase.is_received ? '완료' : '대기';\n      case 'is_statement_received':\n        return (purchase as any).is_statement_received ? '완료' : '대기';\n      case 'request_date':\n        return purchase.request_date;\n      case 'delivery_request_date':\n        return purchase.delivery_request_date;\n      case 'payment_completed_at':\n        return purchase.payment_completed_at;\n      default:\n        return null;\n    }\n  };\n\n  // 필터 조건 적용 함수\n  const applyFilterCondition = (fieldValue: any, condition: string, filterValue: any): boolean => {\n    if (fieldValue === null || fieldValue === undefined) {\n      return condition === 'is_empty';\n    }\n\n    const fieldStr = String(fieldValue).toLowerCase();\n    const filterStr = String(filterValue).toLowerCase();\n\n    switch (condition) {\n      case 'contains':\n        return fieldStr.includes(filterStr);\n      case 'equals':\n        return fieldStr === filterStr;\n      case 'starts_with':\n        return fieldStr.startsWith(filterStr);\n      case 'ends_with':\n        return fieldStr.endsWith(filterStr);\n      case 'is_empty':\n        return !fieldValue || fieldStr.trim() === '';\n      case 'is_not_empty':\n        return !!fieldValue && fieldStr.trim() !== '';\n      case 'greater_than':\n        return Number(fieldValue) > Number(filterValue);\n      case 'less_than':\n        return Number(fieldValue) < Number(filterValue);\n      case 'between':\n        // 범위 필터는 추후 구현\n        return true;\n      case 'after':\n        return new Date(fieldValue) > new Date(filterValue);\n      case 'before':\n        return new Date(fieldValue) < new Date(filterValue);\n      case 'not_equals':\n        return fieldStr !== filterStr;\n      default:\n        return true;\n    }\n  };\n\n  // 정렬 적용 함수\n  const applySorting = useCallback((purchases: Purchase[]) => {\n    if (!sortConfig) return purchases;\n\n    return [...purchases].sort((a, b) => {\n      const aValue = getFieldValue(a, sortConfig.field);\n      const bValue = getFieldValue(b, sortConfig.field);\n\n      if (aValue === null || aValue === undefined) return 1;\n      if (bValue === null || bValue === undefined) return -1;\n\n      let comparison = 0;\n      if (typeof aValue === 'number' && typeof bValue === 'number') {\n        comparison = aValue - bValue;\n      } else if (aValue instanceof Date && bValue instanceof Date) {\n        comparison = aValue.getTime() - bValue.getTime();\n      } else {\n        comparison = String(aValue).localeCompare(String(bValue));\n      }\n\n      return sortConfig.direction === 'desc' ? -comparison : comparison;\n    });\n  }, [sortConfig]);\n\n  // 고급 필터가 적용된 최종 구매 목록\n  const advancedFilteredPurchases = useMemo(() => {\n    let result = applyAdvancedFilters(filteredPurchases);\n    result = applySorting(result);\n    return result;\n  }, [filteredPurchases, applyAdvancedFilters, applySorting]);\n\n\n  // 엑셀 다운로드\n  const handleExcelDownload = async (purchase: Purchase) => {\n    try {\n      // DB에서 직접 모든 품목 조회\n      const { data: purchaseRequest, error: requestError } = await supabase\n        .from('purchase_requests')\n        .select('*')\n        .eq('purchase_order_number', purchase.purchase_order_number)\n        .single();\n\n      if (requestError || !purchaseRequest) {\n        toast.error('해당 발주요청번호의 데이터를 찾을 수 없습니다.');\n        return;\n      }\n\n      // 품목 데이터 조회\n      const { data: orderItems, error: itemsError } = await supabase\n        .from('purchase_request_items')\n        .select('*')\n        .eq('purchase_order_number', purchase.purchase_order_number)\n        .order('line_number');\n\n      if (itemsError || !orderItems || orderItems.length === 0) {\n        toast.error('해당 발주요청번호의 품목 데이터를 찾을 수 없습니다.');\n        return;\n      }\n\n      // 업체 상세 정보 및 담당자 정보 조회\n      const vendorInfo = {\n        vendor_name: purchase.vendor_name,\n        vendor_phone: '',\n        vendor_fax: '',\n        vendor_contact_name: ''\n      };\n\n      try {\n        const vendorId = purchaseRequest.vendor_id || purchase.vendor_id;\n        const contactId = purchaseRequest.contact_id || purchase.contact_id;\n        \n        // vendor 정보 조회\n        if (vendorId) {\n          const { data: vendorData, error: vendorError } = await supabase\n            .from('vendors')\n            .select('vendor_phone, vendor_fax')\n            .eq('id', vendorId)\n            .single();\n\n          if (vendorData && !vendorError) {\n            vendorInfo.vendor_phone = vendorData.vendor_phone || '';\n            vendorInfo.vendor_fax = vendorData.vendor_fax || '';\n          }\n        }\n\n        // vendor_contacts에서 contact_id로 담당자 정보 조회\n        if (contactId) {\n          const { data: contactData, error: contactError } = await supabase\n            .from('vendor_contacts')\n            .select('contact_name, contact_phone, contact_email')\n            .eq('id', contactId)\n            .single();\n          if (contactData && !contactError) {\n            vendorInfo.vendor_contact_name = contactData.contact_name || '';\n          }\n        }\n      } catch (error) {\n      }\n\n      const excelData: PurchaseOrderData = {\n        purchase_order_number: purchaseRequest.purchase_order_number || '',\n        request_date: purchaseRequest.request_date,\n        delivery_request_date: purchaseRequest.delivery_request_date,\n        requester_name: purchaseRequest.requester_name,\n        vendor_name: vendorInfo.vendor_name || '',\n        vendor_contact_name: vendorInfo.vendor_contact_name,\n        vendor_phone: vendorInfo.vendor_phone,\n        vendor_fax: vendorInfo.vendor_fax,\n        project_vendor: purchaseRequest.project_vendor,\n        sales_order_number: purchaseRequest.sales_order_number,\n        project_item: purchaseRequest.project_item,\n        items: orderItems.map((item: any) => ({\n          line_number: item.line_number,\n          item_name: item.item_name,\n          specification: item.specification,\n          quantity: item.quantity,\n          unit_price_value: item.unit_price_value,\n          amount_value: item.amount_value,\n          remark: item.remark,\n          currency: purchaseRequest.currency || 'KRW'\n        }))\n      };\n\n      // 코드 기반 ExcelJS 생성 (템플릿 없이 서식 직접 정의)\n      const blob = await generatePurchaseOrderExcelJS(excelData);\n      \n      // 다운로드용 파일명: 발주서_{업체명}_발주요청번호\n      const downloadFilename = `발주서_${excelData.vendor_name}_${excelData.purchase_order_number}.xlsx`;\n\n      // 사용자에게 즉시 다운로드 제공\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = downloadFilename;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      window.URL.revokeObjectURL(url);\n      \n      toast.success('엑셀 파일이 다운로드되었습니다.');\n      \n      // DB에 다운로드 완료 플래그(is_po_download) 업데이트 - lead buyer만 해당\n      try {\n        const isLeadBuyer = currentUserRoles && currentUserRoles.includes('lead buyer');\n\n        if (isLeadBuyer) {\n          const { error: downloadFlagErr } = await supabase\n            .from('purchase_requests')\n            .update({ is_po_download: true })\n            .eq('purchase_order_number', purchase.purchase_order_number);\n          if (downloadFlagErr) {\n          } else {\n            // 화면 업데이트\n            await loadPurchases();\n          }\n        }\n      } catch (flagErr) {\n      }\n    } catch (error) {\n      toast.error('엑셀 다운로드에 실패했습니다.');\n    }\n  };\n\n  // 최적화된 핸들러들 - 메모이제이션 및 배치 처리\n  const handleReceiptComplete = useCallback(async (purchaseId: number) => {\n    try {\n      const currentTime = new Date().toISOString();\n      \n      // 병렬 처리로 성능 개선\n      const [requestResult, itemsResult] = await Promise.all([\n        supabase\n          .from('purchase_requests')\n          .update({ \n            is_received: true,\n            received_at: currentTime\n          })\n          .eq('id', purchaseId),\n        supabase\n          .from('purchase_request_items')\n          .update({ \n            is_received: true,\n            delivery_status: 'received'\n          })\n          .eq('purchase_request_id', purchaseId)\n      ]);\n\n      if (requestResult.error) throw requestResult.error;\n      if (itemsResult.error) throw itemsResult.error;\n      \n      toast.success('입고완료 처리되었습니다.');\n      await loadPurchases();\n    } catch (error) {\n      toast.error('처리 중 오류가 발생했습니다.');\n    }\n  }, [supabase, loadPurchases]);\n\n  const handlePaymentComplete = useCallback(async (purchaseId: number) => {\n    try {\n      const currentTime = new Date().toISOString();\n      \n      // 병렬 처리로 성능 개선\n      const [requestResult, itemsResult] = await Promise.all([\n        supabase\n          .from('purchase_requests')\n          .update({ \n            is_payment_completed: true,\n            payment_completed_at: currentTime\n          })\n          .eq('id', purchaseId),\n        supabase\n          .from('purchase_request_items')\n          .update({ \n            is_payment_completed: true\n          })\n          .eq('purchase_request_id', purchaseId)\n      ]);\n\n      if (requestResult.error) throw requestResult.error;\n      if (itemsResult.error) throw itemsResult.error;\n      \n      toast.success('구매완료 처리되었습니다.');\n      await loadPurchases();\n    } catch (error) {\n      toast.error('처리 중 오류가 발생했습니다.');\n    }\n  }, [supabase, loadPurchases]);\n\n  const handleItemsClick = useCallback((purchase: Purchase) => {\n    setSelectedPurchase(purchase);\n    setIsModalOpen(true);\n  }, []);\n  \n  // 모달 데이터 메모이제이션 - 불필요한 재계산 방지\n  const modalPurchaseData = useMemo(() => {\n    if (!selectedPurchase) return null;\n    return {\n      ...selectedPurchase,\n      vendor_name: selectedPurchase.vendor_name || '',\n      project_vendor: selectedPurchase.project_vendor || '',\n      sales_order_number: selectedPurchase.sales_order_number || '',\n      project_item: selectedPurchase.project_item || ''\n    };\n  }, [selectedPurchase]);\n\n  return (\n    <div className=\"w-full\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4\">\n        <div>\n          <h1 className=\"page-title\">발주요청 관리</h1>\n          <p className=\"page-subtitle\" style={{marginTop:'-2px',marginBottom:'-4px'}}>Purchase Management</p>\n        </div>\n        <Button \n          onClick={() => navigate('/purchase/new')}\n          className=\"mt-4 sm:mt-0 bg-hansl-500 hover:bg-hansl-600\"\n        >\n          <Plus className=\"w-4 h-4 mr-2\" />\n          새 발주요청 작성\n        </Button>\n      </div>\n\n      {/* 고급 필터 툴바 - 탭바 위 왼쪽 상단 */}\n      <FilterToolbar\n        activeFilters={activeFilters}\n        sortConfig={sortConfig}\n        searchTerm={searchTerm}\n        onFiltersChange={setActiveFilters}\n        onSortChange={setSortConfig}\n        onSearchChange={setSearchTerm}\n        availableEmployees={availableEmployees}\n        availableVendors={availableVendors}\n        availableContacts={availableContacts}\n        availablePaymentSchedules={availablePaymentSchedules}\n      />\n\n      {/* 직접 구현한 탭 (hanslwebapp 방식) - 빠른 성능 */}\n      <div className=\"space-y-3\">\n        {/* 탭 버튼들 - 모바일 반응형 개선 */}\n        <div className=\"flex flex-col sm:flex-row sm:space-x-1 space-y-1 sm:space-y-0 bg-gray-50 p-1 business-radius-card border border-gray-200\">\n          {NAV_TABS.map((tab) => (\n            <button\n              key={tab.key}\n              onClick={() => {\n                setActiveTab(tab.key);\n              }}\n              className={`flex-1 flex items-center justify-center space-x-2 py-1.5 px-3 sm:px-4 business-radius-button button-text font-medium transition-colors ${\n                activeTab === tab.key\n                  ? 'text-hansl-600 bg-white shadow-sm border border-gray-200'\n                  : 'text-gray-600 bg-transparent hover:text-gray-900 hover:bg-white/50'\n              }`}\n            >\n              <span className=\"whitespace-nowrap\">{tab.label}</span>\n              <Badge \n                variant=\"secondary\" \n                className={\n                  activeTab === tab.key \n                    ? 'badge-stats-active' \n                    : 'badge-stats-secondary'\n                }\n              >\n                {tabCounts[tab.key as keyof typeof tabCounts]}\n              </Badge>\n            </button>\n          ))}\n        </div>\n\n        {/* 탭 콘텐츠 */}\n        <Card className=\"overflow-hidden border border-gray-200\">\n          <CardContent className=\"p-0\">\n            {loading ? (\n              <div className=\"flex items-center justify-center py-12\">\n                <div className=\"w-8 h-8 border-2 border-hansl-500 border-t-transparent rounded-full animate-spin\" />\n                <span className=\"ml-3 card-subtitle\">로딩 중...</span>\n              </div>\n            ) : advancedFilteredPurchases.length === 0 ? (\n              <div className=\"text-center py-12\">\n                <Package className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" />\n                <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">발주요청서가 없습니다</h3>\n                <p className=\"card-subtitle\">새로운 발주요청서를 작성해보세요.</p>\n              </div>\n            ) : (\n              <LazyPurchaseTable \n                purchases={advancedFilteredPurchases} \n                activeTab={activeTab}\n                currentUserRoles={currentUserRoles}\n                onRefresh={loadPurchases}\n                onOptimisticUpdate={updatePurchaseOptimistic}\n                onPaymentComplete={handlePaymentComplete}\n                onReceiptComplete={handleReceiptComplete}\n              />\n            )}\n          </CardContent>\n        </Card>\n      </div>\n      \n      {/* 세부항목 모달 - 성능 최적화된 데이터 사용 */}\n      {modalPurchaseData && (\n        <Suspense fallback={<div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\"><div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-white\"></div></div>}>\n          <PurchaseItemsModal\n            isOpen={isModalOpen}\n            onClose={() => {\n              setIsModalOpen(false);\n              setSelectedPurchase(null);\n            }}\n            purchase={modalPurchaseData}\n            isAdmin={isAdmin || false}\n            onUpdate={loadPurchases}\n            activeTab={activeTab}\n          />\n        </Suspense>\n      )}\n    </div>\n  );\n}"],"file":"PurchaseListMain-BebeV6gh.js"}