{"version":3,"mappings":"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AgB,GAElB,CACEH,GAAI,gBACJC,MAAO,KACPC,YAAa,WACbC,gBAAgB,GAElB,CACEH,GAAI,WACJC,MAAO,KACPC,YAAa,QACbC,gBAAgB,GAElB,CACEH,GAAI,aACJC,MAAO,KACPC,YAAa,QACbC,gBAAgB,GAElB,CACEH,GAAI,SACJC,MAAO,KACPC,YAAa,OACbC,gBAAgB,GAElB,CACEH,GAAI,SACJC,MAAO,KACPC,YAAa,WACbC,gBAAgB,GAElB,CACEH,GAAI,OACJC,MAAO,KACPC,YAAa,QACbC,gBAAgB,GAElB,CACEH,GAAI,iBACJC,MAAO,OACPC,YAAa,UACbC,gBAAgB,GAElB,CACEH,GAAI,eACJC,MAAO,UACPC,YAAa,WACbC,gBAAgB,GAElB,CACEH,GAAI,qBACJC,MAAO,OACPC,YAAa,QACbC,gBAAgB,GAElB,CACEH,GAAI,oBACJC,MAAO,OACPC,YAAa,SACbC,gBAAgB,GAElB,CACEH,GAAI,mBACJC,MAAO,OACPC,YAAa,SACbC,gBAAgB,IAKPC,GAA8CL,GAAiB3L,OAC1E,CAACiM,EAAKC,KACJD,EAAIC,EAAON,IAAMM,EAAOH,eACjBE,GAET,IAIkEN,GAAiB3L,OACnF,CAACiM,EAAKC,KACJD,EAAIC,EAAON,IAAMM,EACVD,GAET,IAIK,MAAME,GAAsC,CACjD,wBACA,cACA,YACA,iBAIWC,GAAwC,CACnD,qBACA,aACA,aACA,UAIWC,GAAmB,CAC9B,YACA,MACA,iBACA,oBAIWC,GAAgB,CAC3B,CACEC,MAAO,QACPC,QAAS,CACP,qBACA,wBACA,mBACA,iBACA,eACA,eAGJ,CACED,MAAO,QACPC,QAAS,CACP,cACA,eACA,wBACA,0BAGJ,CACED,MAAO,QACPC,QAAS,CACP,YACA,gBACA,WACA,aACA,SACA,SACA,SAGJ,CACED,MAAO,UACPC,QAAS,CACP,iBACA,eACA,uBAGJ,CACED,MAAO,QACPC,QAAS,CACP,oBACA,sBC87IN,MAAAC,GAAeC,OAjnJf,UAA6BlD,WAC3BA,EAAAmD,OACAA,EAAAC,QACAA,EAAAC,SACAA,GAAW,EAAAlL,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","names":["DollarSign","createLucideIcon","x1","x2","y1","y2","key","d","MessageSquarePlus","Truck","cx","cy","r","formatDate","formatDateISO","getCurrencySymbol","currency","includes","async","generatePurchaseOrderExcelJS","data","workbook","__vitePreload","import","then","n","e","__VITE_PRELOAD__","Workbook","sheet","addWorksheet","pageSetup","paperSize","orientation","fitToPage","fitToWidth","fitToHeight","horizontalCentered","verticalCentered","margins","left","right","top","bottom","header","footer","getRow","height","eachCell","cell","font","name","size","mergeCells","response","fetch","arrayBuffer","imageId","addImage","buffer","extension","dWidth","getColumn","width","logoWidth","Math","max","logoHeight","logoCol","logoRow","tl","col","row","ext","_e","getCell","value","alignment","horizontal","vertical","indent","bold","vendor_payment_schedule","vendor_name","vendor_contact_name","request_date","vendor_phone","vendor_fax","delivery_request_date","requester_name","purchase_order_number","tableHeaders","i","length","String","fromCharCode","sortedItems","items","sort","a","b","line_number","itemRows","sumRow","item","rowIdx","bCell","item_name","specification","quantity","unitSymbol","unitWithCurrency","unit_price_value","toLocaleString","trim","amountSymbol","amountWithCurrency","amount_value","gCell","remark","wrapText","shrinkToFit","c","totalSymbol","totalAmount","reduce","sum","lastRow","cellAddr","isItemRow","border","style","currentBorder","sumCellBorder","Object","entries","A","B","C","D","E","F","G","forEach","xlsx","writeBuffer","Blob","type","supabase","createClient","downloadPurchaseOrderExcel","purchase","currentUserRoles","onSuccessCallback","purchaseRequest","error","requestError","from","select","eq","single","toast","orderItems","itemsError","order","vendorInfo","vendorId","vendor_id","contactId","contact_id","vendorData","vendorError","contactData","contactError","contact_name","excelData","project_vendor","sales_order_number","project_item","map","blob","downloadFilename","url","window","URL","createObjectURL","document","createElement","href","download","body","appendChild","click","removeChild","revokeObjectURL","success","downloadFlagErr","update","is_po_download","flagErr","DatePickerPopover","children","onDateSelect","disabled","placeholder","align","side","open","setOpen","useState","jsxs","Popover","onOpenChange","jsx","PopoverTrigger","asChild","PopoverContent","className","sideOffset","Calendar","mode","selected","onSelect","date","logger","debug","isToday","Date","toDateString","dateValue","getTime","todayValue","dateString","todayString","handleDateSelect","locale","ko","initialFocus","fromDate","toDate","defaultMonth","modifiers","today","modifiersClassNames","DateAmountPickerPopover","onConfirm","defaultDate","defaultAmount","selectedDate","setSelectedDate","amount","setAmount","toString","Input","onChange","target","replace","numValue","parseInt","Button","variant","onClick","amountNum","parseFloat","isNaN","DateQuantityPickerPopover","defaultQuantity","maxQuantity","hideQuantityInput","quantityInfoText","setQuantity","min","quantityNum","useConfirmDateAction","config","currentUserName","canPerformAction","purchaseId","onUpdate","onOptimisticUpdate","handleConfirm","useCallback","itemId","itemInfo","receivedQuantity","warn","field","numericId","Number","confirmMessage","confirm","updateData","is_statement_received","statement_received_date","toISOString","statement_received_by_name","actual_received_date","is_received","received_quantity","info","markItemAsReceived","markItemAsStatementReceived","action","successMessage","handleCancel","cancel","itemName","markItemAsReceiptCanceled","markItemAsStatementCanceled","isCompleted","getCompletedDate","getCompletedByName","DONE_TAB_COLUMNS","id","label","description","defaultVisible","DEFAULT_COLUMN_VISIBILITY","acc","column","REQUIRED_COLUMNS","RESTRICTED_COLUMNS","AUTHORIZED_ROLES","COLUMN_GROUPS","title","columns","PurchaseDetailModal$1","memo","isOpen","onClose","embedded","activeTab","onRefresh","onDelete","allPurchases","lastFetch","usePurchaseMemory","loading","setLoading","setPurchase","isEditing","setIsEditing","editedPurchase","setEditedPurchase","editedItems","setEditedItems","deletedItemIds","setDeletedItemIds","userRoles","setUserRoles","setCurrentUserName","columnWidths","setColumnWidths","focusedInput","setFocusedInput","vendors","setVendors","vendorSearchTerm","setVendorSearchTerm","isModifyRequestOpen","setIsModifyRequestOpen","modifySubject","setModifySubject","modifyMessage","setModifyMessage","isSendingModify","setIsSendingModify","useEffect","currentItems","useMemo","purchase_request_items","memoryPurchase","find","p","columnGap","padding","total","baseColumns","push","headerRowRef","useRef","supabaseUrl","user","auth","getUser","employeeData","maybeSingle","email","employeeByEmail","purchase_role","roles","Array","isArray","split","filter","loadUserRoles","vendorsData","ascending","loadVendors","effectiveRoles","canEditAll","canEditLimited","canEdit","canViewFinancialInfo","some","role","canDelete","final_manager_status","canPurchase","canReceiveItems","isAdmin","isRequester","canReceiptCheck","canProcessReceipt","refreshModalData","vendorContacts","allContacts","currentContact","otherContacts","allContacts_count","contact","purchaseData","vendor","vendor_contacts","vendorContacts_from_query","purchase_updated","has_vendor_contacts","normalizedItems","updatedPurchase","is_po_generated","is_active","isInitialLoad","setIsInitialLoad","purchaseIdNumber","NaN","handleActualReceiptOptimisticUpdate","itemIdStr","nowIso","selectedDateIso","updateItems","received_at","prev","updatedItems","updatedRequestItems","completed","allReceived","updated_at","prevItems","prevPurchase","handleStatementReceivedOptimisticUpdate","nextAllCompleted","nextStatementAt","every","statement_received_at","allCompleted","statementReceivedAction","completedText","waitingText","actualReceivedAction","canApproveMiddle","canApproveFinal","approvalButtonClass","approvalWaitingPillClass","findPurchaseInMemory","loadPurchaseDetail","calculateOptimalColumnWidths","columnConfigs","minWidth","maxWidth","baseWidth","isFixed","payment_category","calculatedWidths","index","maxLength","headers","statusHeader","quantityHeader","baseHeaders","h","doneHeaders","getHeaders","cellValue","tax_amount_value","getStatusDisplay","expenditure_date","expenditure_amount","adjustedLength","char","test","ceil","calculatedWidth","is_payment_completed","getGridTemplateColumns","join","doneColumns","hasItems","requestAnimationFrame","handleEditToggle","editing","formatCurrency","Intl","NumberFormat","format","handleItemChange","newItems","unitPrice","handleRemoveItem","_","handlePaymentToggle","purchaseItems","requestItems","targetItem","unit","payment_completed_at","markItemAsPaymentCompleted","markItemAsPaymentCanceled","prevRequestItems","payment_completed_by_name","refreshResult","silent","Promise","handleItemReceiptToggle","handleApprove","approvalType","middle_manager_status","handleItemExpenditure","totalExpenditure","total_expenditure_amount","markItemAsExpenditureSet","content","category","getStatusBadge","Check","X","FileText","newStatus","is_utk_checked","updatePurchaseInMemory","CheckCircle","request_type","formatDateInput","revised_delivery_request_date","Building2","ReactSelect","options","v","option","selectedVendor","contactsData","contactsCount","updated","updated_vendor_contacts","updated_full","isClearable","isSearchable","menuPortalTarget","styles","control","base","minHeight","fontSize","borderRadius","borderColor","borderWidth","backgroundColor","boxShadow","paddingLeft","paddingRight","outline","valueContainer","margin","input","indicatorsContainer","indicatorSeparator","display","dropdownIndicator","svg","clearIndicator","menuPortal","zIndex","classNamePrefix","contacts","uniqueContacts","arr","findIndex","finalUniqueContacts","vendor_contacts_raw","vendor_contacts_count","unique_by_id_count","final_unique_count","firstContact","selectedContact","noOptionsMessage","contactName","purchase_id","purchase_contact_name","purchase_full","Package","Fragment","allItems","pendingItems","CreditCard","applyOptimisticUpdate","itemReceivedQuantity","toLocaleDateString","year","month","day","pi","ref","gridTemplateColumns","onFocus","onBlur","whiteSpace","wordBreak","overflowWrap","hyphens","WebkitHyphens","MozHyphens","msHyphens","lineHeight","maxHeight","overflow","WebkitLineClamp","WebkitBoxOrient","hasReceived","boxSizing","Trash2","hasExpenditure","getFullYear","slice","getMonth","padStart","getDate","toLocaleTimeString","hour","minute","newItem","lineNum","Plus","Dialog","DialogContent","showCloseButton","DialogHeader","DialogTitle","onOpenAutoFocus","preventDefault","Label","htmlFor","onWheel","stopPropagation","Textarea","resize","insert","user_id","user_email","user_name","inquiry_type","subject","message","status","purchase_request_id","requester_id","purchase_info","JSON","stringify","total_amount","item_count","Edit2","updateError","finalContactId","contactUpdateError","contact_email","contact_phone","position","prev_vendor_contacts","new_vendor_contacts","updated_purchase","newContact","contactInsertError","newContact_full","purchaseUpdateError","deleteError","delete","in","Error","unit_price_currency","amount_currency","insertData","indexOf","created_at","sourceData","deletedCount","removeItemFromMemory","memoryUpdated","newTotalAmount","itemsCount","finalItems","originalItemsCount","finalItemsCount","deletedItemsCount","errorMessage","Save"],"ignoreList":[0,1,2],"sources":["../../node_modules/lucide-react/dist/esm/icons/dollar-sign.js","../../node_modules/lucide-react/dist/esm/icons/message-square-plus.js","../../node_modules/lucide-react/dist/esm/icons/truck.js","../../src/utils/exceljs/generatePurchaseOrderExcel.ts","../../src/utils/excelDownload.ts","../../src/components/ui/date-picker-popover.tsx","../../src/components/ui/date-amount-picker-popover.tsx","../../src/components/ui/date-quantity-picker-popover.tsx","../../src/hooks/useConfirmDateAction.ts","../../src/constants/columnSettings.ts","../../src/components/purchase/PurchaseDetailModal.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"line\", { x1: \"12\", x2: \"12\", y1: \"2\", y2: \"22\", key: \"7eqyqh\" }],\n  [\"path\", { d: \"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6\", key: \"1b0p4s\" }]\n];\nconst DollarSign = createLucideIcon(\"dollar-sign\", __iconNode);\n\nexport { __iconNode, DollarSign as default };\n//# sourceMappingURL=dollar-sign.js.map\n","/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z\",\n      key: \"18887p\"\n    }\n  ],\n  [\"path\", { d: \"M12 8v6\", key: \"1ib9pf\" }],\n  [\"path\", { d: \"M9 11h6\", key: \"1fldmi\" }]\n];\nconst MessageSquarePlus = createLucideIcon(\"message-square-plus\", __iconNode);\n\nexport { __iconNode, MessageSquarePlus as default };\n//# sourceMappingURL=message-square-plus.js.map\n","/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2\", key: \"wrbu53\" }],\n  [\"path\", { d: \"M15 18H9\", key: \"1lyqi6\" }],\n  [\n    \"path\",\n    {\n      d: \"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14\",\n      key: \"lysw3i\"\n    }\n  ],\n  [\"circle\", { cx: \"17\", cy: \"18\", r: \"2\", key: \"332jqn\" }],\n  [\"circle\", { cx: \"7\", cy: \"18\", r: \"2\", key: \"19iecd\" }]\n];\nconst Truck = createLucideIcon(\"truck\", __iconNode);\n\nexport { __iconNode, Truck as default };\n//# sourceMappingURL=truck.js.map\n","// hanslwebapp    Excel \nimport { formatDateISO } from '@/utils/helpers';\n\nexport interface PurchaseOrderData {\n  purchase_order_number: string;\n  request_date: string;\n  delivery_request_date: string;\n  requester_name: string;\n  vendor_name: string;\n  vendor_contact_name?: string;\n  vendor_phone?: string;\n  vendor_fax?: string;\n  project_vendor: string;\n  sales_order_number: string;\n  project_item: string;\n  items: PurchaseOrderItem[];\n  vendor_payment_schedule?: string;\n}\n\nexport interface PurchaseOrderItem {\n  line_number: number;\n  item_name: string;\n  specification: string;\n  quantity: number;\n  unit_price_value: number;\n  amount_value: number;\n  remark: string;\n  currency: string;\n}\n\nconst formatDate = formatDateISO;\n\n// Helper: currency code to symbol\nfunction getCurrencySymbol(currency: string) {\n  if (!currency) return '';\n  if (['KRW', '', ''].includes(currency)) return '';\n  if (['USD', '$', ''].includes(currency)) return '$';\n  if (['EUR', ''].includes(currency)) return '';\n  if (['JPY', '', ''].includes(currency)) return '';\n  if (['CNY', '', ''].includes(currency)) return '';\n  return currency;\n}\n\n/**\n *    (ExcelJS) - hanslwebapp  \n * @param data PurchaseOrderData\n * @returns Blob (xlsx)\n */\nexport async function generatePurchaseOrderExcelJS(data: PurchaseOrderData): Promise<Blob> {\n  // ExcelJS  import    \n  const ExcelJS = await import('exceljs');\n  const workbook = new ExcelJS.Workbook();\n  \n  const sheet = workbook.addWorksheet('', {\n    pageSetup: {\n      paperSize: 9, // A4\n      orientation: 'portrait',\n      fitToPage: true,\n      fitToWidth: 1,\n      fitToHeight: 1,\n      horizontalCentered: true,\n      verticalCentered: true,\n      margins: {\n        left: 0.3,\n        right: 0.3,\n        top: 0.5,\n        bottom: 0.5,\n        header: 0.2,\n        footer: 0.2\n      }\n    }\n  });\n\n  //   : 1 39.75px(29.8pt), 2 18px(13.5pt)\n  sheet.getRow(1).height = 29.8; // 39.75px\n  for (let r = 2; r <= 60; r++) {\n    sheet.getRow(r).height = 15.75; // 21px15.75pt\n  }\n  //  : ,  11 (2), 1 20\n  // 1\n  sheet.getRow(1).eachCell(cell => {\n    cell.font = { ...(cell.font || {}), name: ' ', size: 20 };\n  });\n\n  //      (     bold )\n  for (let r = 2; r <= 60; r++) {\n    sheet.getRow(r).eachCell(cell => {\n      cell.font = { ...(cell.font || {}), name: ' ', size: 11 };\n    });\n  }\n\n  // 1.    1:1 \n  sheet.mergeCells('A1:G1');\n  sheet.mergeCells('A2:B2'); sheet.mergeCells('C2:D2'); sheet.mergeCells('F2:G2');\n  sheet.mergeCells('A3:B3'); sheet.mergeCells('C3:D3'); sheet.mergeCells('F3:G3');\n  sheet.mergeCells('A4:B4'); sheet.mergeCells('C4:D4'); sheet.mergeCells('F4:G4');\n  sheet.mergeCells('A5:B5'); sheet.mergeCells('C5:D5'); sheet.mergeCells('F5:G5');\n  sheet.mergeCells('A6:B6'); sheet.mergeCells('C6:D6'); sheet.mergeCells('F6:G6');\n  sheet.mergeCells('A7:B7'); sheet.mergeCells('C7:D7'); sheet.mergeCells('F7:G7');\n  // 8~46(//)  \n  //        \n  // ( sumRow   )\n\n  try {\n    const response = await fetch('/logo_KOR.png');\n    const arrayBuffer = await response.arrayBuffer();\n    const imageId = workbook.addImage({\n      buffer: arrayBuffer,\n      extension: 'png',\n    });\n    // ()  0.58col, ''      \n    // D width undefined/null/0  22 \n    const dWidth = sheet.getColumn('D').width || 22;\n    const logoWidth = Math.max(1, dWidth * 7.2 * 0.58) + 4; //  4px  \n    const logoHeight = 30 + 4; //  30 4px  \n    // D1  (3.5, 0.5)  2px(0.28col),  2px(0.13row) \n    const logoCol = 3.5 - 0.50;\n    const logoRow = 0.5 - 0.20;\n    sheet.addImage(imageId, {\n      tl: { col: logoCol, row: logoRow }, // D1    2px,  2px \n      ext: { width: logoWidth, height: logoHeight },\n    });\n  } catch (_e) {\n    // Logo loading failed, continue without logo\n  }\n\n  // 2.  (B1:H1 , )\n  sheet.getCell('D1').value = '                  ';\n  sheet.getCell('D1').alignment = { horizontal: 'left', vertical: 'middle', indent: 1 };\n  sheet.getCell('D1').font = { bold: true, size: 20 };\n\n  // 3.      ( )\n  sheet.getCell('A2').value = '      ';\n  sheet.getCell('A2').font = { bold: true };\n  sheet.getCell('A3').value = '      ';\n  sheet.getCell('A3').font = { bold: true };\n  sheet.getCell('A4').value = '      ';\n  sheet.getCell('A4').font = { bold: true };\n  sheet.getCell('A5').value = 'TEL.';\n  sheet.getCell('A5').font = { bold: true };\n  sheet.getCell('A6').value = 'FAX.';\n  sheet.getCell('A6').font = { bold: true };\n  sheet.getCell('A7').value = '';\n  sheet.getCell('A7').font = { bold: true };\n\n  sheet.getCell('E2').value = '';\n  sheet.getCell('E2').font = { bold: true };\n  sheet.getCell('E3').value = '         ';\n  sheet.getCell('E3').font = { bold: true };\n  sheet.getCell('E4').value = '   ';\n  sheet.getCell('E4').font = { bold: true };\n  sheet.getCell('E5').value = 'TEL.';\n  sheet.getCell('E5').font = { bold: true };\n  sheet.getCell('E6').value = 'FAX.';\n  sheet.getCell('E6').font = { bold: true };\n  sheet.getCell('E7').value = ' ';\n  sheet.getCell('E7').font = { bold: true };\n\n  sheet.getCell('F7').value = data.vendor_payment_schedule || '';\n\n  //  ()\n  sheet.getCell('C2').value = data.vendor_name;\n  sheet.getCell('C3').value = data.vendor_contact_name || '';\n  sheet.getCell('C4').value = formatDate(data.request_date);\n  sheet.getCell('C5').value = data.vendor_phone || '';\n  sheet.getCell('C6').value = data.vendor_fax || '';\n  sheet.getCell('C7').value = formatDate(data.delivery_request_date);\n\n  sheet.getCell('F2').value = data.requester_name;\n  sheet.getCell('F3').value = '  305';\n  sheet.getCell('F4').value = data.purchase_order_number;\n  sheet.getCell('F5').value = '(053) 626-7805';\n  sheet.getCell('F6').value = '(053) 657-7905';\n  sheet.getCell('F5').alignment = { horizontal: 'center', vertical: 'middle' };\n  sheet.getCell('F6').alignment = { horizontal: 'center', vertical: 'middle' };\n\n  // 8:  \n  const tableHeaders = ['No', '', '', '', '', '', ''];\n  for (let i = 0; i < tableHeaders.length; i++) {\n    sheet.getCell(String.fromCharCode(65 + i) + '8').value = tableHeaders[i];\n    sheet.getCell(String.fromCharCode(65 + i) + '8').font = { bold: true };\n    if(i===6){\n       sheet.getCell('G8').alignment = { horizontal:'center', vertical:'middle' };\n    }\n  }\n\n  //  45    /  \n  const baseRow = 9;\n  const minRows = 45;\n  // ---   line_number   ---\n  const sortedItems = [...data.items].sort((a, b) => a.line_number - b.line_number);\n  const itemRows = sortedItems.length;\n  const sumRow = baseRow + Math.max(itemRows, minRows); //  \n\n  //  \n  for (let i = 0; i < sortedItems.length; i++) {\n    const item = sortedItems[i];\n    const rowIdx = baseRow + i;\n    sheet.getCell('A' + rowIdx).value = item.line_number;\n    const bCell = sheet.getCell('B' + rowIdx);\n    bCell.value = item.item_name;\n    bCell.alignment = { horizontal: 'left', vertical: 'middle' };\n    sheet.getCell('C' + rowIdx).value = item.specification;\n    sheet.getCell('C' + rowIdx).alignment = { horizontal: 'left', vertical: 'middle' };\n    sheet.getCell('D' + rowIdx).value = item.quantity;\n    // (E) -   \n    const unitSymbol = getCurrencySymbol(item.currency);\n    const unitWithCurrency = (item.unit_price_value !== undefined && item.unit_price_value !== null)\n      ? `${item.unit_price_value.toLocaleString()} ${unitSymbol}`.trim()\n      : '';\n    sheet.getCell('E' + rowIdx).value = unitWithCurrency;\n    sheet.getCell('E' + rowIdx).alignment = { horizontal: 'right', vertical: 'middle' };\n\n    // (F) -   \n    const amountSymbol = getCurrencySymbol(item.currency);\n    const amountWithCurrency = (item.amount_value !== undefined && item.amount_value !== null)\n      ? `${item.amount_value.toLocaleString()} ${amountSymbol}`.trim()\n      : '';\n    sheet.getCell('F' + rowIdx).value = amountWithCurrency;\n    sheet.getCell('F' + rowIdx).alignment = { horizontal: 'right', vertical: 'middle' };\n    // G \n    const gCell = sheet.getCell('G' + rowIdx);\n    gCell.value = (item.remark !== undefined && item.remark !== null) ? String(item.remark) : '';\n    gCell.alignment = { horizontal: 'left', vertical: 'middle', wrapText: false, shrinkToFit: true };\n  }\n\n  //  45    \n  for (let i = itemRows; i < minRows; i++) {\n    const rowIdx = baseRow + i;\n    for (let c = 0; c < 7; c++) {\n      sheet.getCell(String.fromCharCode(65 + c) + rowIdx).value = '';\n    }\n  }\n\n  // \n  sheet.mergeCells(`A${sumRow}:E${sumRow}`);\n  sheet.getCell('A' + sumRow).value = '';\n  sheet.getCell('A' + sumRow).font = { bold: true };\n  const totalSymbol = getCurrencySymbol(data.items[0]?.currency);\n  const totalAmount = data.items.reduce((sum, item) => sum + (item.amount_value || 0), 0);\n  sheet.getCell('F' + sumRow).value = `${totalAmount.toLocaleString()} ${totalSymbol}`.trim();\n  sheet.getCell('F' + sumRow).alignment = { horizontal: 'right', vertical: 'middle' };\n\n  //         ()\n  const lastRow = sumRow;\n  for (let r = 1; r <= lastRow; r++) {\n    for (let c = 1; c <= 7; c++) {\n      const col = String.fromCharCode(64 + c); // A~G\n      const cellAddr = col + r;\n      const cell = sheet.getCell(cellAddr);\n      // E(5), F(6)   (/) , C(3)   () alignment  \n      const isPriceCol = (c === 5 || c === 6);\n      const isSpecCol = (c === 3);\n      const isItemRow = (r >= baseRow && r < sumRow);\n      const isSumRow = (r === sumRow);\n      if (!((isPriceCol && (isItemRow || isSumRow)) || (isSpecCol && isItemRow))) {\n        //    \n        cell.alignment = { horizontal: 'center', vertical: 'middle' };\n      }\n      //  : 2/8/(sumRow) , 8 ,  \n      cell.border = {\n        top:    { style: (r === 1) ? 'medium' : (r === 2 || r === 8 || r === sumRow) ? 'medium' : 'thin' },\n        left:   { style: c === 1 ? 'medium' : 'thin' },\n        right:  { style: c === 7 ? 'medium' : 'thin' },\n        bottom: { style: (r === 8 || r === sumRow || r === lastRow) ? 'medium' : 'thin' }\n      };\n    }\n  }\n  // (C) (  )    \n  for (let i = 0; i < itemRows; i++) {\n    const rowIdx = baseRow + i;\n    sheet.getCell('C' + rowIdx).alignment = { horizontal: 'left', vertical: 'middle' };\n  }\n\n  // B2:B7, D2:D7, E2:E6   \n  for (let r = 2; r <= 7; r++) {\n    sheet.getCell('B' + r).border = {\n      ...sheet.getCell('B' + r).border,\n      right: { style: 'medium' }\n    };\n    sheet.getCell('D' + r).border = {\n      ...sheet.getCell('D' + r).border,\n      right: { style: 'medium' }\n    };\n    if (r <= 6) {\n      sheet.getCell('E' + r).border = {\n        ...sheet.getCell('E' + r).border,\n        right: { style: 'medium' }\n      };\n    }\n  }\n  // E7, G7   ()\n  sheet.getCell('E7').border = {\n    ...sheet.getCell('E7').border,\n    top: { style: 'thin' },\n    right: { style: 'medium' }\n  };\n  sheet.getCell('G7').border = {\n    ...sheet.getCell('G7').border,\n    top: { style: 'thin' }\n  };\n\n  // A1~A7      ( )\n  for (let r = 1; r <= 7; r++) {\n    const currentBorder = sheet.getCell('A' + r).border || {};\n    sheet.getCell('A' + r).border = {\n      ...currentBorder,\n      left: { style: 'medium' }\n    };\n  }\n\n  //  (A)     \n  const sumCellBorder = sheet.getCell('A' + sumRow).border || {};\n  sheet.getCell('A' + sumRow).border = {\n    ...sumCellBorder,\n    left: { style: 'medium' }\n  };\n\n  //   ( )\n  const colWidths = { A:4.7, B:23, C:30, D:11, E:15, F:16, G:37 };\n  Object.entries(colWidths).forEach(([col, width]) => {\n    sheet.getColumn(col).width = width;\n  });\n\n  /* -----------------------------------\n        /  \n      1 : 39.75pt\n      2~lastRow : 18pt\n  ----------------------------------- */\n  sheet.getRow(1).height = 29.8; // 39.75px29.8pt\n  sheet.getRow(1).eachCell(c => { c.font = { ...(c.font || {}), name: ' ', size: 20 }; });\n\n  for (let r = 2; r <= lastRow; r++) {\n    const row = sheet.getRow(r);\n    row.height = 15.75; // 21px15.75pt\n    row.eachCell(c => {\n      c.font = { ...(c.font || {}), name: ' ', size: 11 };\n    });\n  }\n\n  // G       \n  for (let r = 9; r <= lastRow; r++) {\n    sheet.getCell('G' + r).alignment = { horizontal: 'left', vertical: 'middle', wrapText: false, shrinkToFit: true };\n    sheet.getCell('B' + r).alignment = { horizontal: 'left', vertical: 'middle' };\n  }\n\n  // 9.  \n  const buffer = await workbook.xlsx.writeBuffer();\n  return new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });\n}","//  Excel   -   \nimport { createClient } from '@/lib/supabase/client'\n\nconst supabase = createClient()\nimport { generatePurchaseOrderExcelJS } from '@/utils/exceljs/generatePurchaseOrderExcel'\nimport type { PurchaseOrderData } from '@/utils/exceljs/generatePurchaseOrderExcel'\nimport { toast } from 'sonner'\n\nexport interface Purchase {\n  id?: number\n  purchase_order_number: string\n  vendor_name: string\n  vendor_id?: string\n  contact_id?: string\n}\n\n/**\n *  Excel   -    \n *  handleExcelDownload    \n */\nexport const downloadPurchaseOrderExcel = async (\n  purchase: Purchase, \n  currentUserRoles?: string[],\n  onSuccessCallback?: () => void\n) => {\n  try {\n    // DB    \n    const { data: purchaseRequest, error: requestError } = await supabase\n      .from('purchase_requests')\n      .select('*')\n      .eq('purchase_order_number', purchase.purchase_order_number)\n      .single();\n\n    if (requestError || !purchaseRequest) {\n      toast.error('     .');\n      return;\n    }\n\n    //   \n    const { data: orderItems, error: itemsError } = await supabase\n      .from('purchase_request_items')\n      .select('*')\n      .eq('purchase_order_number', purchase.purchase_order_number)\n      .order('line_number');\n\n    if (itemsError || !orderItems || orderItems.length === 0) {\n      toast.error('      .');\n      return;\n    }\n\n    //       \n    const vendorInfo = {\n      vendor_name: purchase.vendor_name,\n      vendor_phone: '',\n      vendor_fax: '',\n      vendor_contact_name: ''\n    };\n\n    try {\n      const vendorId = purchaseRequest.vendor_id || purchase.vendor_id;\n      const contactId = purchaseRequest.contact_id || purchase.contact_id;\n      \n      // vendor  \n      if (vendorId) {\n        const { data: vendorData, error: vendorError } = await supabase\n          .from('vendors')\n          .select('vendor_phone, vendor_fax')\n          .eq('id', vendorId)\n          .single();\n\n        if (vendorData && !vendorError) {\n          vendorInfo.vendor_phone = vendorData.vendor_phone || '';\n          vendorInfo.vendor_fax = vendorData.vendor_fax || '';\n        }\n      }\n\n      // vendor_contacts contact_id   \n      if (contactId) {\n        const { data: contactData, error: contactError } = await supabase\n          .from('vendor_contacts')\n          .select('contact_name, contact_phone, contact_email')\n          .eq('id', contactId)\n          .single();\n        if (contactData && !contactError) {\n          vendorInfo.vendor_contact_name = contactData.contact_name || '';\n        }\n      }\n    } catch (error) {\n      //       \n    }\n\n    const excelData: PurchaseOrderData = {\n      purchase_order_number: purchaseRequest.purchase_order_number || '',\n      request_date: purchaseRequest.request_date,\n      delivery_request_date: purchaseRequest.delivery_request_date,\n      requester_name: purchaseRequest.requester_name,\n      vendor_name: vendorInfo.vendor_name || '',\n      vendor_contact_name: vendorInfo.vendor_contact_name,\n      vendor_phone: vendorInfo.vendor_phone,\n      vendor_fax: vendorInfo.vendor_fax,\n      project_vendor: purchaseRequest.project_vendor,\n      sales_order_number: purchaseRequest.sales_order_number,\n      project_item: purchaseRequest.project_item,\n      items: orderItems.map((item: any) => ({\n        line_number: item.line_number,\n        item_name: item.item_name,\n        specification: item.specification,\n        quantity: item.quantity,\n        unit_price_value: item.unit_price_value,\n        amount_value: item.amount_value,\n        remark: item.remark,\n        currency: purchaseRequest.currency || 'KRW'\n      }))\n    };\n\n    //   ExcelJS  (    )\n    const blob = await generatePurchaseOrderExcelJS(excelData);\n    \n    //  : _{}_\n    const downloadFilename = `_${excelData.vendor_name}_${excelData.purchase_order_number}.xlsx`;\n\n    //    \n    const url = window.URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = downloadFilename;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    window.URL.revokeObjectURL(url);\n    \n    toast.success('  .');\n    \n    // DB   (is_po_download)  - lead buyer \n    try {\n      const isLeadBuyer = currentUserRoles && currentUserRoles.includes('lead buyer');\n\n      if (isLeadBuyer) {\n        const { error: downloadFlagErr } = await supabase\n          .from('purchase_requests')\n          .update({ is_po_download: true })\n          .eq('purchase_order_number', purchase.purchase_order_number);\n        \n        if (!downloadFlagErr) {\n          //    (UI )\n          onSuccessCallback?.();\n        }\n      }\n    } catch (flagErr) {\n      //      \n    }\n  } catch (error) {\n    console.error(' Excel  :', error);\n    toast.error('  .');\n    throw error;\n  }\n};","import { useState } from 'react'\nimport { Calendar } from '@/components/ui/calendar'\nimport { Button } from '@/components/ui/button'\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from '@/components/ui/popover'\nimport { Calendar as CalendarIcon } from 'lucide-react'\nimport { format } from 'date-fns'\nimport { ko } from 'date-fns/locale'\nimport { cn } from '@/lib/utils'\nimport { logger } from '@/lib/logger'\n\ninterface DatePickerPopoverProps {\n  children: React.ReactNode\n  onDateSelect: (date: Date) => void\n  disabled?: boolean\n  placeholder?: string\n  align?: \"center\" | \"start\" | \"end\"\n  side?: \"top\" | \"right\" | \"bottom\" | \"left\"\n}\n\nexport function DatePickerPopover({\n  children,\n  onDateSelect,\n  disabled = false,\n  placeholder = \" \",\n  align = \"center\",\n  side = \"bottom\"\n}: DatePickerPopoverProps) {\n  const [open, setOpen] = useState(false)\n\n  const handleDateSelect = (date: Date | undefined) => {\n    logger.debug(' DatePickerPopover handleDateSelect :', { \n      date, \n      isToday: date && new Date().toDateString() === date.toDateString(),\n      dateString: date?.toDateString(),\n      todayString: new Date().toDateString()\n    });\n    if (date) {\n      logger.debug('  , onDateSelect  ');\n      onDateSelect(date)\n      setOpen(false) //     \n      logger.debug(' DatePickerPopover  ');\n    } else {\n      logger.debug('  undefined');\n    }\n  }\n\n  return (\n    <Popover open={open} onOpenChange={setOpen}>\n      <PopoverTrigger asChild disabled={disabled}>\n        {children}\n      </PopoverTrigger>\n      <PopoverContent \n        className=\"w-auto p-0 border-gray-200 shadow-lg\" \n        align={align}\n        side={side}\n        sideOffset={8}\n      >\n        <div className=\"bg-white business-radius-card p-2\">\n          <div className=\"mb-2 px-1\">\n            <div className=\"modal-label text-gray-600 text-center\">\n              {placeholder}\n            </div>\n          </div>\n          <Calendar\n            mode=\"single\"\n            selected={undefined}\n            onSelect={(date) => {\n              logger.debug(' Calendar onSelect  :', { \n                date, \n                isToday: date && new Date().toDateString() === date.toDateString(),\n                dateValue: date?.getTime(),\n                todayValue: new Date().getTime()\n              });\n              handleDateSelect(date);\n            }}\n            locale={ko}\n            initialFocus\n            className=\"compact-calendar\"\n            disabled={false}\n            fromDate={new Date('2020-01-01')}\n            toDate={new Date('2030-12-31')}\n            defaultMonth={new Date()}\n            modifiers={{\n              today: new Date()\n            }}\n            modifiersClassNames={{\n              today: \"bg-blue-500 text-white font-semibold cursor-pointer hover:bg-blue-600 rounded-md\"\n            }}\n          />\n        </div>\n      </PopoverContent>\n    </Popover>\n  )\n}","import { useState } from 'react'\nimport { Calendar } from '@/components/ui/calendar'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from '@/components/ui/popover'\nimport { Calendar as CalendarIcon } from 'lucide-react'\nimport { format } from 'date-fns'\nimport { ko } from 'date-fns/locale'\nimport { cn } from '@/lib/utils'\nimport { logger } from '@/lib/logger'\n\ninterface DateAmountPickerPopoverProps {\n  children: React.ReactNode\n  onConfirm: (date: Date, amount: number) => void\n  disabled?: boolean\n  placeholder?: string\n  align?: \"center\" | \"start\" | \"end\"\n  side?: \"top\" | \"right\" | \"bottom\" | \"left\"\n  defaultDate?: Date\n  defaultAmount?: number\n}\n\nexport function DateAmountPickerPopover({\n  children,\n  onConfirm,\n  disabled = false,\n  placeholder = \"  \",\n  align = \"center\",\n  side = \"bottom\",\n  defaultDate,\n  defaultAmount\n}: DateAmountPickerPopoverProps) {\n  const [open, setOpen] = useState(false)\n  const [selectedDate, setSelectedDate] = useState<Date | undefined>(defaultDate)\n  const [amount, setAmount] = useState<string>(defaultAmount?.toString() || '')\n\n  const handleConfirm = () => {\n    if (!selectedDate) {\n      return\n    }\n    \n    const amountNum = parseFloat(amount.replace(/,/g, ''))\n    if (isNaN(amountNum) || amountNum <= 0) {\n      return\n    }\n\n    onConfirm(selectedDate, amountNum)\n    setOpen(false)\n    // Reset after close\n    setSelectedDate(defaultDate)\n    setAmount(defaultAmount?.toString() || '')\n  }\n\n  const handleAmountChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const value = e.target.value.replace(/[^0-9]/g, '')\n    if (value) {\n      const numValue = parseInt(value, 10)\n      setAmount(numValue.toLocaleString())\n    } else {\n      setAmount('')\n    }\n  }\n\n  return (\n    <Popover open={open} onOpenChange={setOpen}>\n      <PopoverTrigger asChild disabled={disabled}>\n        {children}\n      </PopoverTrigger>\n      <PopoverContent \n        className=\"w-auto p-0 border-gray-200 shadow-lg\" \n        align={align}\n        side={side}\n        sideOffset={8}\n      >\n        <div className=\"bg-white business-radius-card p-3\">\n          <div className=\"mb-2 px-1\">\n            <div className=\"modal-label text-gray-600 text-center\">\n              {placeholder}\n            </div>\n          </div>\n          <Calendar\n            mode=\"single\"\n            selected={selectedDate}\n            onSelect={setSelectedDate}\n            locale={ko}\n            initialFocus\n            className=\"compact-calendar\"\n            disabled={false}\n            fromDate={new Date('2020-01-01')}\n            toDate={new Date('2030-12-31')}\n            defaultMonth={selectedDate || new Date()}\n            modifiers={{\n              today: new Date()\n            }}\n            modifiersClassNames={{\n              today: \"bg-blue-500 text-white font-semibold cursor-pointer hover:bg-blue-600 rounded-md\"\n            }}\n          />\n          <div className=\"mt-3 px-1\">\n            <label className=\"block text-xs font-medium text-gray-700 mb-1\">\n              \n            </label>\n            <Input\n              type=\"text\"\n              value={amount}\n              onChange={handleAmountChange}\n              placeholder=\" \"\n              className=\"w-full\"\n            />\n          </div>\n          <div className=\"mt-3 flex justify-end gap-2\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => setOpen(false)}\n            >\n              \n            </Button>\n            <Button\n              size=\"sm\"\n              onClick={handleConfirm}\n              disabled={!selectedDate || !amount || parseFloat(amount.replace(/,/g, '')) <= 0}\n              className=\"button-base button-action-primary\"\n            >\n              \n            </Button>\n          </div>\n        </div>\n      </PopoverContent>\n    </Popover>\n  )\n}\n\n","import { useState } from 'react'\nimport { Calendar } from '@/components/ui/calendar'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from '@/components/ui/popover'\nimport { Calendar as CalendarIcon } from 'lucide-react'\nimport { format } from 'date-fns'\nimport { ko } from 'date-fns/locale'\nimport { cn } from '@/lib/utils'\nimport { logger } from '@/lib/logger'\n\ninterface DateQuantityPickerPopoverProps {\n  children: React.ReactNode\n  onConfirm: (date: Date, quantity?: number) => void\n  disabled?: boolean\n  placeholder?: string\n  align?: \"center\" | \"start\" | \"end\"\n  side?: \"top\" | \"right\" | \"bottom\" | \"left\"\n  defaultDate?: Date\n  defaultQuantity?: number\n  maxQuantity?: number\n  hideQuantityInput?: boolean\n  quantityInfoText?: string\n}\n\nexport function DateQuantityPickerPopover({\n  children,\n  onConfirm,\n  disabled = false,\n  placeholder = \"  \",\n  align = \"center\",\n  side = \"bottom\",\n  defaultDate,\n  defaultQuantity,\n  maxQuantity,\n  hideQuantityInput = false,\n  quantityInfoText = \"   \"\n}: DateQuantityPickerPopoverProps) {\n  const [open, setOpen] = useState(false)\n  const [selectedDate, setSelectedDate] = useState<Date | undefined>(defaultDate)\n  const [quantity, setQuantity] = useState<string>(defaultQuantity?.toString() || '')\n\n  const handleConfirm = () => {\n    if (!selectedDate) {\n      return\n    }\n    \n    if (hideQuantityInput) {\n      //     ( ), quantity undefined \n      onConfirm(selectedDate, undefined)\n      setOpen(false)\n      // Reset after close\n      setSelectedDate(defaultDate)\n      setQuantity(defaultQuantity?.toString() || '')\n      return\n    }\n    \n    const quantityNum = parseFloat(quantity.replace(/,/g, ''))\n    if (isNaN(quantityNum) || quantityNum < 0) {\n      return\n    }\n\n    if (maxQuantity && quantityNum > maxQuantity) {\n      return\n    }\n\n    onConfirm(selectedDate, quantityNum)\n    setOpen(false)\n    // Reset after close\n    setSelectedDate(defaultDate)\n    setQuantity(defaultQuantity?.toString() || '')\n  }\n\n  const handleQuantityChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const value = e.target.value.replace(/[^0-9]/g, '')\n    setQuantity(value)\n  }\n\n  return (\n    <Popover open={open} onOpenChange={setOpen}>\n      <PopoverTrigger asChild disabled={disabled}>\n        {children}\n      </PopoverTrigger>\n      <PopoverContent \n        className=\"w-auto p-0 border-gray-200 shadow-lg\" \n        align={align}\n        side={side}\n        sideOffset={8}\n      >\n        <div className=\"bg-white business-radius-card p-3\">\n          <div className=\"mb-2 px-1\">\n            <div className=\"modal-label text-gray-600 text-center\">\n              {placeholder}\n            </div>\n          </div>\n          {hideQuantityInput && (\n            <div className=\"mb-2 px-1\">\n              <div className=\"text-[10px] text-gray-500 text-center leading-tight\">\n                <div> </div>\n                <div> </div>\n              </div>\n            </div>\n          )}\n          <Calendar\n            mode=\"single\"\n            selected={selectedDate}\n            onSelect={setSelectedDate}\n            locale={ko}\n            initialFocus\n            className=\"compact-calendar\"\n            disabled={false}\n            fromDate={new Date('2020-01-01')}\n            toDate={new Date('2030-12-31')}\n            defaultMonth={selectedDate || new Date()}\n            modifiers={{\n              today: new Date()\n            }}\n            modifiersClassNames={{\n              today: \"bg-blue-500 text-white font-semibold cursor-pointer hover:bg-blue-600 rounded-md\"\n            }}\n          />\n          {!hideQuantityInput && (\n            <div className=\"mt-3 px-1\">\n              <label className=\"block text-xs font-medium text-gray-700 mb-1\">\n                \n              </label>\n              <Input\n                type=\"number\"\n                value={quantity}\n                onChange={handleQuantityChange}\n                placeholder=\" \"\n                className=\"border-gray-200 rounded-lg text-center w-full !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400\"\n                min=\"0\"\n                max={maxQuantity}\n              />\n              {maxQuantity && (\n                <p className=\"text-xs text-gray-500 mt-1\">: {maxQuantity.toLocaleString()}</p>\n              )}\n            </div>\n          )}\n          <div className=\"mt-3 flex justify-end gap-2\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => setOpen(false)}\n              className=\"button-base\"\n            >\n              \n            </Button>\n            <Button\n              size=\"sm\"\n              onClick={handleConfirm}\n              disabled={!selectedDate || (!hideQuantityInput && (!quantity || parseFloat(quantity.replace(/,/g, '')) < 0 || (maxQuantity !== undefined && parseFloat(quantity.replace(/,/g, '')) > maxQuantity)))}\n              className=\"button-base button-action-primary\"\n            >\n              \n            </Button>\n          </div>\n        </div>\n      </PopoverContent>\n    </Popover>\n  )\n}\n\n","import { useCallback } from 'react'\nimport { createClient } from '@/lib/supabase/client'\nimport { toast } from 'sonner'\nimport { logger } from '@/lib/logger'\nimport { markItemAsReceived, markItemAsReceiptCanceled, markItemAsStatementReceived, markItemAsStatementCanceled } from '@/stores/purchaseMemoryStore'\n\nexport interface ConfirmDateActionConfig {\n  field: 'statement_received' | 'actual_received'\n  confirmMessage: {\n    confirm: string\n    cancel: string\n  }\n  successMessage: {\n    confirm: string\n    cancel: string\n  }\n  completedText: string\n  waitingText: string\n}\n\nexport interface UseConfirmDateActionProps {\n  config: ConfirmDateActionConfig\n  currentUserName: string | null\n  canPerformAction: boolean\n  purchaseId?: number | string  //     purchase ID\n  onUpdate?: () => void\n  onOptimisticUpdate?: (params: {\n    itemId: number\n    selectedDate?: Date\n    action: 'confirm' | 'cancel'\n    receivedQuantity?: number\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n      received_quantity?: number\n    }\n  }) => void\n}\n\nexport function useConfirmDateAction({\n  config,\n  currentUserName,\n  canPerformAction,\n  purchaseId,\n  onUpdate,\n  onOptimisticUpdate\n}: UseConfirmDateActionProps) {\n  const supabase = createClient()\n\n  const handleConfirm = useCallback(async (\n    itemId: number | string,\n    selectedDate: Date,\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n      received_quantity?: number\n    },\n    receivedQuantity?: number\n  ) => {\n    \n    if (!canPerformAction) {\n      logger.warn(`  `, { canPerformAction, currentUserName })\n      toast.error(`${config.field === 'statement_received' ? '' : ''}   .`)\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      logger.error('  ID', { itemId, numericId })\n      toast.error('   ID .')\n      return\n    }\n\n    //   \n    if (itemInfo) {\n      const confirmMessage = `: ${itemInfo.item_name || '-'}\n: ${itemInfo.specification || '-'}\n: ${itemInfo.quantity?.toLocaleString() || 0}\n: ${itemInfo.unit_price_value?.toLocaleString() || 0}\n: ${itemInfo.amount_value?.toLocaleString() || 0}\n: ${itemInfo.remark || '-'}\n\n${config.confirmMessage.confirm}`\n      \n      if (!window.confirm(confirmMessage)) {\n        return\n      }\n    }\n\n    try {\n      let updateData: any\n\n      if (config.field === 'statement_received') {\n        updateData = {\n          is_statement_received: true,\n          statement_received_date: selectedDate.toISOString(),\n          statement_received_by_name: currentUserName\n        }\n      } else if (config.field === 'actual_received') {\n        updateData = {\n          actual_received_date: selectedDate.toISOString(),\n          is_received: true,\n          received_quantity: receivedQuantity !== undefined ? receivedQuantity : (itemInfo?.received_quantity !== undefined ? itemInfo.received_quantity : null)\n        }\n      }\n\n      logger.debug('  :', updateData)\n\n      const { data, error } = await supabase\n        .from('purchase_request_items')\n        .update(updateData)\n        .eq('id', numericId)\n        .select()\n\n      logger.debug(' DB  :', { data, error })\n\n      if (error) {\n        logger.error(' DB  ', error)\n        throw error\n      }\n\n      logger.info(' DB  ', data)\n\n      //     \n      if (purchaseId) {\n        if (config.field === 'actual_received') {\n          const memoryUpdated = markItemAsReceived(purchaseId, numericId, selectedDate.toISOString(), receivedQuantity)\n          if (!memoryUpdated) {\n            logger.warn('[useConfirmDateAction]     ', { \n              purchaseId, \n              itemId: numericId \n            })\n          }\n        } else if (config.field === 'statement_received') {\n          const memoryUpdated = markItemAsStatementReceived(purchaseId, numericId, selectedDate.toISOString(), currentUserName || undefined)\n          if (!memoryUpdated) {\n            logger.warn('[useConfirmDateAction]      ', { \n              purchaseId, \n              itemId: numericId \n            })\n          }\n        }\n      }\n\n      if (onOptimisticUpdate) {\n        onOptimisticUpdate({\n          itemId: numericId,\n          selectedDate,\n          action: 'confirm',\n          receivedQuantity: receivedQuantity !== undefined ? receivedQuantity : itemInfo?.received_quantity,\n          itemInfo\n        })\n      }\n\n      //    onUpdate \n      if (onUpdate) {\n        onUpdate()\n      }\n      \n      toast.success(config.successMessage.confirm)\n    } catch (error) {\n      logger.error('   ', error)\n      toast.error(`${config.field === 'statement_received' ? '' : ''}     .`)\n    }\n  }, [config, currentUserName, canPerformAction, purchaseId, onUpdate, onOptimisticUpdate, supabase])\n\n  const handleCancel = useCallback(async (\n    itemId: number | string,\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n    }\n  ) => {\n    if (!canPerformAction) {\n      logger.warn(`   `, { canPerformAction, currentUserName })\n      toast.error(`${config.field === 'statement_received' ? '' : ''}   .`)\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      toast.error('   ID .')\n      return\n    }\n\n    //   \n    if (itemInfo) {\n      const confirmMessage = `: ${itemInfo.item_name || '-'}\n: ${itemInfo.specification || '-'}\n: ${itemInfo.quantity?.toLocaleString() || 0}\n: ${itemInfo.unit_price_value?.toLocaleString() || 0}\n: ${itemInfo.amount_value?.toLocaleString() || 0}\n: ${itemInfo.remark || '-'}\n\n${config.confirmMessage.cancel}`\n      \n      if (!window.confirm(confirmMessage)) {\n        return\n      }\n    }\n\n    try {\n      logger.debug(` ${config.field}   `, { \n        itemId, \n        itemName: itemInfo?.item_name \n      })\n\n      let updateData: any\n\n      if (config.field === 'statement_received') {\n        updateData = {\n          is_statement_received: false,\n          statement_received_date: null,\n          statement_received_by_name: null\n        }\n      } else if (config.field === 'actual_received') {\n        updateData = {\n          actual_received_date: null,\n          is_received: false\n        }\n      }\n\n      logger.debug('   :', updateData)\n\n      const { data, error } = await supabase\n        .from('purchase_request_items')\n        .update(updateData)\n        .eq('id', numericId)\n        .select()\n\n      logger.debug('  DB  :', { data, error })\n\n      if (error) {\n        logger.error(' DB  ', error)\n        throw error\n      }\n\n      logger.info(` ${config.field}   `, data)\n\n      //     \n      if (purchaseId) {\n        if (config.field === 'actual_received') {\n          const memoryUpdated = markItemAsReceiptCanceled(purchaseId, numericId)\n          if (!memoryUpdated) {\n            logger.warn('[useConfirmDateAction]     ', { \n              purchaseId, \n              itemId: numericId \n            })\n          }\n        } else if (config.field === 'statement_received') {\n          const memoryUpdated = markItemAsStatementCanceled(purchaseId, numericId)\n          if (!memoryUpdated) {\n            logger.warn('[useConfirmDateAction]      ', { \n              purchaseId, \n              itemId: numericId \n            })\n          }\n        }\n      }\n\n      if (onOptimisticUpdate) {\n        onOptimisticUpdate({\n          itemId: numericId,\n          action: 'cancel',\n          itemInfo\n        })\n      }\n\n      //    onUpdate \n      if (onUpdate) {\n        onUpdate()\n      }\n      \n      toast.success(config.successMessage.cancel)\n    } catch (error) {\n      logger.error(` ${config.field}   `, error)\n      toast.error(`${config.field === 'statement_received' ? '' : ''}     .`)\n    }\n  }, [config, canPerformAction, purchaseId, onUpdate, onOptimisticUpdate, supabase])\n\n  const isCompleted = useCallback((item: any) => {\n    if (config.field === 'statement_received') {\n      return item.is_statement_received\n    } else if (config.field === 'actual_received') {\n      return item.is_received // actual_received_date  is_received  \n    }\n    return false\n  }, [config.field])\n\n  const getCompletedDate = useCallback((item: any) => {\n    if (config.field === 'statement_received') {\n      return item.statement_received_date\n    } else if (config.field === 'actual_received') {\n      return item.actual_received_date\n    }\n    return null\n  }, [config.field])\n\n  const getCompletedByName = useCallback((item: any) => {\n    if (config.field === 'statement_received') {\n      return item.statement_received_by_name\n    } else if (config.field === 'actual_received') {\n      //     \n      return null\n    }\n    return null\n  }, [config.field])\n\n  return {\n    config,\n    handleConfirm,\n    handleCancel,\n    isCompleted,\n    getCompletedDate,\n    getCompletedByName\n  }\n}","import { ColumnInfo, DoneTabColumnId, ColumnVisibility } from '@/types/columnSettings';\n\n/**\n *     \n * 22     \n */\n\n//     ( )\nexport const DONE_TAB_COLUMNS: ColumnInfo[] = [\n  {\n    id: 'statement_progress',\n    label: '',\n    description: '  ',\n    defaultVisible: true,\n  },\n  {\n    id: 'purchase_order_number',\n    label: '',\n    description: ' ',\n    defaultVisible: true,\n  },\n  {\n    id: 'payment_category',\n    label: '',\n    description: '  (, ,  )',\n    defaultVisible: true,\n  },\n  {\n    id: 'requester_name',\n    label: '',\n    description: '  ',\n    defaultVisible: true,\n  },\n  {\n    id: 'request_date',\n    label: '',\n    description: '  ',\n    defaultVisible: true,\n  },\n  {\n    id: 'utk_status',\n    label: 'UTK',\n    description: 'UTK  ',\n    defaultVisible: true,\n  },\n  {\n    id: 'vendor_name',\n    label: '',\n    description: '',\n    defaultVisible: true,\n  },\n  {\n    id: 'contact_name',\n    label: '',\n    description: ' ',\n    defaultVisible: true,\n  },\n  {\n    id: 'delivery_request_date',\n    label: '',\n    description: '  ',\n    defaultVisible: true,\n  },\n  {\n    id: 'revised_delivery_date',\n    label: '',\n    description: '  ',\n    defaultVisible: true,\n  },\n  {\n    id: 'item_name',\n    label: '',\n    description: ' ',\n    defaultVisible: true,\n  },\n  {\n    id: 'specification',\n    label: '',\n    description: '  ',\n    defaultVisible: true,\n  },\n  {\n    id: 'quantity',\n    label: '',\n    description: ' ',\n    defaultVisible: true,\n  },\n  {\n    id: 'unit_price',\n    label: '',\n    description: ' ',\n    defaultVisible: true,\n  },\n  {\n    id: 'amount',\n    label: '',\n    description: ' ',\n    defaultVisible: true,\n  },\n  {\n    id: 'remark',\n    label: '',\n    description: '  ',\n    defaultVisible: true,\n  },\n  {\n    id: 'link',\n    label: '',\n    description: ' ',\n    defaultVisible: true,\n  },\n  {\n    id: 'project_vendor',\n    label: 'PJ',\n    description: ' ',\n    defaultVisible: true,\n  },\n  {\n    id: 'project_item',\n    label: 'PJ ITEM',\n    description: ' ',\n    defaultVisible: true,\n  },\n  {\n    id: 'sales_order_number',\n    label: '',\n    description: ' ',\n    defaultVisible: true,\n  },\n  {\n    id: 'purchase_progress',\n    label: '',\n    description: ' ',\n    defaultVisible: true,\n  },\n  {\n    id: 'receipt_progress',\n    label: '',\n    description: ' ',\n    defaultVisible: true,\n  },\n];\n\n//     (  )\nexport const DEFAULT_COLUMN_VISIBILITY: ColumnVisibility = DONE_TAB_COLUMNS.reduce(\n  (acc, column) => {\n    acc[column.id] = column.defaultVisible;\n    return acc;\n  },\n  {} as ColumnVisibility\n);\n\n//  ID    \nexport const COLUMN_INFO_MAP: Record<DoneTabColumnId, ColumnInfo> = DONE_TAB_COLUMNS.reduce(\n  (acc, column) => {\n    acc[column.id] = column;\n    return acc;\n  },\n  {} as Record<DoneTabColumnId, ColumnInfo>\n);\n\n//   (   )\nexport const REQUIRED_COLUMNS: DoneTabColumnId[] = [\n  'purchase_order_number',\n  'vendor_name',\n  'item_name',\n  'specification',\n];\n\n//    (     )\nexport const RESTRICTED_COLUMNS: DoneTabColumnId[] = [\n  'statement_progress',  // \n  'utk_status',         // UTK\n  'unit_price',         // \n  'amount',            // ( )\n];\n\n//   \nexport const AUTHORIZED_ROLES = [\n  'app_admin',\n  'ceo',\n  'final_approver',\n  'purchase_manager',\n];\n\n//   ( UI )\nexport const COLUMN_GROUPS = [\n  {\n    title: ' ',\n    columns: [\n      'statement_progress',\n      'purchase_order_number',\n      'payment_category',\n      'requester_name',\n      'request_date',\n      'utk_status',\n    ] as DoneTabColumnId[],\n  },\n  {\n    title: ' ',\n    columns: [\n      'vendor_name',\n      'contact_name',\n      'delivery_request_date',\n      'revised_delivery_date',\n    ] as DoneTabColumnId[],\n  },\n  {\n    title: ' ',\n    columns: [\n      'item_name',\n      'specification',\n      'quantity',\n      'unit_price',\n      'amount',\n      'remark',\n      'link',\n    ] as DoneTabColumnId[],\n  },\n  {\n    title: ' ',\n    columns: [\n      'project_vendor',\n      'project_item',\n      'sales_order_number',\n    ] as DoneTabColumnId[],\n  },\n  {\n    title: ' ',\n    columns: [\n      'purchase_progress',\n      'receipt_progress',\n    ] as DoneTabColumnId[],\n  },\n] as const;","import { useEffect, useState, useRef, useCallback, useMemo, memo } from 'react'\nimport { createClient } from '@/lib/supabase/client'\nimport { PurchaseRequestWithDetails, Purchase, Vendor } from '@/types/purchase'\nimport { findPurchaseInMemory, markItemAsPaymentCompleted, markPurchaseAsPaymentCompleted, markItemAsReceived, markPurchaseAsReceived, markItemAsPaymentCanceled, markItemAsStatementReceived, markItemAsStatementCanceled, usePurchaseMemory, updatePurchaseInMemory, removeItemFromMemory, markItemAsExpenditureSet } from '@/stores/purchaseMemoryStore'\nimport { formatDate } from '@/utils/helpers'\nimport { DatePickerPopover } from '@/components/ui/date-picker-popover'\nimport { DateAmountPickerPopover } from '@/components/ui/date-amount-picker-popover'\nimport { DateQuantityPickerPopover } from '@/components/ui/date-quantity-picker-popover'\nimport { \n  Calendar, \n  User, \n  Building2, \n  Package, \n  CreditCard,\n  X,\n  FileText,\n  DollarSign,\n  Edit2,\n  Trash2,\n  Save,\n  Plus,\n  CheckCircle,\n  XCircle,\n  Check,\n  Truck,\n  MessageSquarePlus\n} from 'lucide-react'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Textarea } from '@/components/ui/textarea'\nimport { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover'\nimport { Label } from '@/components/ui/label'\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog'\nimport { toast } from 'sonner'\nimport { logger } from '@/lib/logger'\nimport { useConfirmDateAction } from '@/hooks/useConfirmDateAction'\nimport { format as formatDateInput } from 'date-fns'\nimport { AUTHORIZED_ROLES } from '@/constants/columnSettings'\nimport ReactSelect from 'react-select'\n\ninterface PurchaseDetailModalProps {\n  purchaseId: number | null\n  isOpen: boolean\n  onClose: () => void\n  embedded?: boolean  // Dialog   \n  currentUserRoles?: string[]\n  activeTab?: string\n  onRefresh?: (forceRefresh?: boolean, options?: { silent?: boolean }) => void | Promise<void>\n  onOptimisticUpdate?: (purchaseId: number, updater: (prev: Purchase) => Purchase) => void\n  onDelete?: (purchase: PurchaseRequestWithDetails) => void\n}\n\nfunction PurchaseDetailModal({ \n  purchaseId, \n  isOpen, \n  onClose, \n  embedded = false,\n  currentUserRoles = [],\n  activeTab,\n  onRefresh,\n  onOptimisticUpdate,\n  onDelete\n}: PurchaseDetailModalProps) {\n  const { allPurchases, lastFetch } = usePurchaseMemory(); //     \n  \n  const [loading, setLoading] = useState(false)\n  const [purchase, setPurchase] = useState<PurchaseRequestWithDetails | null>(null)\n  const [isEditing, setIsEditing] = useState(false)\n  const [editedPurchase, setEditedPurchase] = useState<PurchaseRequestWithDetails | null>(null)\n  const [editedItems, setEditedItems] = useState<any[]>([])\n  const [deletedItemIds, setDeletedItemIds] = useState<number[]>([])\n  const [userRoles, setUserRoles] = useState<string[]>([])\n  const [currentUserName, setCurrentUserName] = useState<string>('')\n  const [columnWidths, setColumnWidths] = useState<number[]>([])\n  const [focusedInput, setFocusedInput] = useState<string | null>(null)\n  const [vendors, setVendors] = useState<Vendor[]>([])\n  const [vendorSearchTerm, setVendorSearchTerm] = useState('')\n  \n  //   \n  const [isModifyRequestOpen, setIsModifyRequestOpen] = useState(false)\n  const [modifySubject, setModifySubject] = useState('')\n  const [modifyMessage, setModifyMessage] = useState('')\n  const [isSendingModify, setIsSendingModify] = useState(false)\n\n  //   \n  useEffect(() => {\n    if (isModifyRequestOpen && purchase) {\n      setModifySubject(`[]  ${purchase.purchase_order_number}  .`)\n      setModifyMessage('') //    \n    }\n  }, [isModifyRequestOpen, purchase])\n\n  //  \n  const handleSendModifyRequest = async () => {\n    if (!modifySubject.trim() || !modifyMessage.trim()) {\n      toast.error('   .')\n      return\n    }\n\n    setIsSendingModify(true)\n    try {\n      const { data: { user } } = await supabase.auth.getUser()\n      \n      if (!user) {\n        toast.error(' .')\n        return\n      }\n\n      const { error } = await supabase\n        .from('support_inquires')\n        .insert({\n          user_id: user.id,\n          user_email: user.email,\n          user_name: currentUserName,\n          inquiry_type: 'modify',\n          subject: modifySubject,\n          message: modifyMessage,\n          status: 'open',\n          purchase_request_id: purchase?.id,\n          purchase_order_number: purchase?.purchase_order_number,\n          requester_id: purchase?.requester_id,\n          purchase_info: JSON.stringify({\n            vendor_name: purchase?.vendor_name,\n            total_amount: purchase?.total_amount,\n            item_count: purchase?.purchase_request_items?.length || 0\n          })\n        })\n\n      if (error) throw error\n\n      toast.success('  .')\n      setIsModifyRequestOpen(false)\n      setModifySubject('')\n      setModifyMessage('')\n    } catch (error) {\n      logger.error('   ', error)\n      toast.error('     .')\n    } finally {\n      setIsSendingModify(false)\n    }\n  }\n\n  //    useEffect \n\n  //   items  ( purchase state  )\n  const currentItems = useMemo(() => {\n    // purchase state   (   )\n    if (purchase?.items && purchase.items.length > 0) {\n      return purchase.items;\n    }\n    if (purchase?.purchase_request_items && purchase.purchase_request_items.length > 0) {\n      return purchase.purchase_request_items;\n    }\n    \n    // purchase state    \n    if (purchaseId && allPurchases) {\n      const memoryPurchase = allPurchases.find(p => p.id === purchaseId);\n      if (memoryPurchase) {\n        return (memoryPurchase.items && memoryPurchase.items.length > 0) ? memoryPurchase.items : (memoryPurchase.purchase_request_items || []);\n      }\n    }\n    \n    return [];\n  }, [purchase, purchaseId, allPurchases, lastFetch]); // purchase       \n\n  const tableMinWidth = useMemo(() => {\n    if (columnWidths.length > 0) {\n      const columnGap = columnWidths.length > 1 ? (columnWidths.length - 1) * 12 : 0\n      const padding = 24\n      const total = columnWidths.reduce((sum, width) => sum + width, 0) + columnGap + padding\n      return Math.max(total, 720)\n    }\n\n    const baseColumns: number[] = [120, 200, 70, 90, 100, 150, 80] // , , , , , , \n\n    if (activeTab === 'purchase') {\n      baseColumns.push(120)\n    }\n\n    if (activeTab === 'receipt' || activeTab === 'done') {\n      baseColumns.push(120)\n    }\n\n    if (activeTab === 'receipt') {\n      baseColumns.push(140)\n    }\n\n    if (activeTab === 'done') {\n      baseColumns.push(100, 80, 110) // (100), (80), (110)\n    }\n\n    if (isEditing) {\n      baseColumns.push(110)\n    }\n\n    const columnGap = baseColumns.length > 1 ? (baseColumns.length - 1) * 12 : 0\n    const total = baseColumns.reduce((sum, width) => sum + width, 0) + columnGap + 48\n    return Math.max(total, 720)\n  }, [columnWidths, activeTab, isEditing])\n  const headerRowRef = useRef<HTMLDivElement>(null)\n  const supabase = createClient()\n  \n  //      \n  useEffect(() => {\n    const loadUserRoles = async () => {\n      try {\n        // Supabase   \n        const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\n        const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;\n        \n        if (!supabaseUrl || !supabaseAnonKey || supabaseUrl.includes('placeholder')) {\n          logger.warn('Supabase     - PurchaseDetailModal');\n          return;\n        }\n\n        const { data: { user } } = await supabase.auth.getUser()\n        if (user) {\n          //  ID \n          let { data: employeeData } = await supabase\n            .from('employees')\n            .select('*')\n            .eq('id', user.id)\n            .maybeSingle()\n          \n          // ID    \n          if (!employeeData && user.email) {\n            const { data: employeeByEmail } = await supabase\n              .from('employees')\n              .select('*')\n              .eq('email', user.email)\n              .maybeSingle()\n            \n            employeeData = employeeByEmail\n          }\n          \n          //   \n          if (employeeData?.name) {\n            setCurrentUserName(employeeData.name)\n          }\n          \n          if (employeeData?.purchase_role) {\n            let roles: string[] = []\n            if (Array.isArray(employeeData.purchase_role)) {\n              roles = employeeData.purchase_role.map((r: any) => String(r).trim())\n            } else {\n              const roleString = String(employeeData.purchase_role)\n              roles = roleString\n                .split(',')\n                .map((r: string) => r.trim())\n                .filter((r: string) => r.length > 0)\n            }\n            setUserRoles(roles)\n          }\n        }\n      } catch (error) {\n      }\n    }\n    \n    if (isOpen) {\n      loadUserRoles()\n    }\n  }, [isOpen])\n\n  //   \n  useEffect(() => {\n    const loadVendors = async () => {\n      try {\n        const { data: vendorsData, error } = await supabase\n          .from('vendors')\n          .select('*')\n          .order('vendor_name', { ascending: true })\n        \n        if (error) throw error\n        if (vendorsData) {\n          setVendors(vendorsData)\n        }\n      } catch (error) {\n        logger.error('   :', error)\n      }\n    }\n    \n    if (isOpen) {\n      loadVendors()\n    }\n  }, [isOpen])\n  \n  // currentUserRoles   userRoles \n  const effectiveRoles = Array.isArray(currentUserRoles) && currentUserRoles.length > 0 \n    ? currentUserRoles \n    : userRoles\n  \n  //  \n  //    (   )\n  const canEditAll = effectiveRoles.includes('final_approver') || \n                     effectiveRoles.includes('app_admin') || \n                     effectiveRoles.includes('ceo')\n  \n  // lead buyer    (/  )\n  const canEditLimited = effectiveRoles.includes('lead buyer')\n  \n  //    (      )\n  const canEdit = canEditAll || canEditLimited\n  \n  //     \n  const canViewFinancialInfo = effectiveRoles.some(role => AUTHORIZED_ROLES.includes(role))\n  \n  //  :     (,   , lead buyer  )\n  const isApproved = purchase?.final_manager_status === 'approved';\n  const canDelete = isApproved \n    ? canEditAll  //      (lead buyer )\n    : (canEditAll || (purchase?.requester_name === currentUserName))  //  lead buyer \n  \n  //   : app_admin + lead buyer (  )\n  const canPurchase = effectiveRoles.includes('app_admin') || \n                     effectiveRoles.includes('lead buyer') || \n                     effectiveRoles.includes('lead buyer')\n  \n  //    \n  // 1.      \n  // 2.      \n  const canReceiveItems = effectiveRoles.includes('app_admin') || \n                         (purchase?.requester_name === currentUserName)\n  // 2.        \n  const isAdmin = effectiveRoles.includes('final_approver') || \n                  effectiveRoles.includes('app_admin') || \n                  effectiveRoles.includes('ceo')\n  const isRequester = purchase?.requester_name === currentUserName\n  \n  //   & UTK  : app_admin lead buyer \n  const canReceiptCheck = effectiveRoles.includes('app_admin') || \n                         effectiveRoles.includes('lead buyer')\n  \n  //   : app_admin    \n  const canProcessReceipt = effectiveRoles.includes('app_admin') || isRequester\n  \n\n  //      (  )\n  const refreshModalData = useCallback(async () => {\n    if (!purchaseId) return\n    \n    try {\n      //  DB    vendor_contacts   \n      //   vendor_contacts    \n      const supabase = createClient()\n      //     \n      //  purchase_requests  \n      const { data, error } = await supabase\n        .from('purchase_requests')\n        .select(`\n          *,\n          vendors:vendor_id(id, vendor_name, is_active),\n          purchase_request_items(*),\n          contact:contact_id(id, contact_name, contact_email, contact_phone, position)\n        `)\n        .eq('id', purchaseId)\n        .single()\n      \n      if (error) throw error\n      \n      // vendor_id      ,      \n      let vendorContacts = []\n      if (data && data.vendor_id) {\n        const { data: allContacts } = await supabase\n          .from('vendor_contacts')\n          .select('id, contact_name, contact_email, contact_phone, position')\n          .eq('vendor_id', data.vendor_id)\n          .order('contact_name')\n        \n        if (allContacts && allContacts.length > 0) {\n          // contact_id     \n          if (data.contact_id) {\n            const currentContact = allContacts.find((c: any) => c.id === data.contact_id)\n            const otherContacts = allContacts.filter((c: any) => c.id !== data.contact_id)\n            vendorContacts = currentContact ? [currentContact, ...otherContacts] : allContacts\n          } else {\n            vendorContacts = allContacts\n          }\n          logger.info('    :', {\n            vendor_id: data.vendor_id,\n            contact_id: data.contact_id,\n            allContacts_count: allContacts.length,\n            vendorContacts\n          })\n        }\n      } else if (data && data.contact) {\n        // vendor_id   contact  \n        vendorContacts = [data.contact]\n      }\n\n      if (data) {\n        //   \n        const sortedItems = (data.purchase_request_items || []).sort((a: any, b: any) => {\n          const lineA = a.line_number || 999999;\n          const lineB = b.line_number || 999999;\n          return lineA - lineB;\n        });\n\n        const purchaseData = {\n          ...data,\n          items: sortedItems,\n          vendor: data.vendors || null,\n          vendor_contacts: vendorContacts,\n          contact_id: data.contact_id,  // contact_id \n          contact_name: vendorContacts[0]?.contact_name || data.contact?.contact_name || null  // contact_name \n        } as PurchaseRequestWithDetails\n\n        setPurchase(purchaseData)\n        setEditedPurchase(purchaseData)\n        setEditedItems(sortedItems)\n        logger.info(' refreshModalData DB  :', { \n          vendor_contacts: purchaseData.vendor_contacts,\n          vendorContacts_from_query: vendorContacts,\n          purchase_updated: true,\n          vendor_id: data.vendor_id,\n          has_vendor_contacts: vendorContacts && vendorContacts.length > 0\n        })\n        console.log(' refreshModalData - DB  :', {\n          vendor_id: data.vendor_id,\n          vendor_contacts: vendorContacts,\n          purchaseData_full: purchaseData,\n          : vendorContacts?.[0]?.contact_name || ''\n        })\n      }\n    } catch (error) {\n      logger.error('   ', error)\n    }\n  }, [purchaseId])\n\n  //          \n  useEffect(() => {\n    if (!purchaseId || !allPurchases || !purchase) return;\n\n    const memoryPurchase = allPurchases.find(p => p.id === purchaseId);\n    if (memoryPurchase) {\n      //   purchase state  (   )\n      const normalizedItems = (memoryPurchase.items && memoryPurchase.items.length > 0) \n        ? memoryPurchase.items \n        : (memoryPurchase.purchase_request_items || []);\n      \n      const updatedPurchase = {\n        ...purchase,\n        ...memoryPurchase,\n        id: String(memoryPurchase.id),\n        items: normalizedItems,\n        purchase_request_items: normalizedItems\n      } as PurchaseRequestWithDetails;\n\n      setPurchase(updatedPurchase);\n      setEditedPurchase(updatedPurchase);\n      setEditedItems(normalizedItems.length > 0 ? normalizedItems : []);\n    }\n  }, [allPurchases, lastFetch]); // lastFetch     \n\n  //         \n  useEffect(() => {\n    if (!isOpen || !purchaseId || !allPurchases) return;\n\n    const memoryPurchase = allPurchases.find(p => p.id === purchaseId);\n    if (memoryPurchase) {\n      const normalizedItems = (memoryPurchase.items && memoryPurchase.items.length > 0) \n        ? memoryPurchase.items \n        : (memoryPurchase.purchase_request_items || []);\n      \n      const updatedPurchase = {\n        ...memoryPurchase,\n        id: String(memoryPurchase.id),\n        is_po_generated: false,\n        items: normalizedItems,\n        purchase_request_items: normalizedItems,\n        vendor: {\n          id: memoryPurchase.vendor_id,\n          vendor_name: memoryPurchase.vendor_name || '  ',\n          is_active: true\n        } as Vendor,\n        vendor_contacts: []\n      } as PurchaseRequestWithDetails;\n\n      setPurchase(updatedPurchase);\n      setEditedPurchase(updatedPurchase);\n      setEditedItems(normalizedItems.length > 0 ? normalizedItems : []);\n    }\n  }, [isOpen, purchaseId, allPurchases]); //    \n  \n  //       \n  const [isInitialLoad, setIsInitialLoad] = useState(true)\n  \n  //   \n  const purchaseIdNumber = purchaseId ? Number(purchaseId) : (purchase ? Number(purchase.id) : NaN)\n\n  const handleActualReceiptOptimisticUpdate = useCallback(({ itemId, selectedDate, action, receivedQuantity }: {\n    itemId: number\n    selectedDate?: Date\n    action: 'confirm' | 'cancel'\n    receivedQuantity?: number\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n      received_quantity?: number\n    }\n  }) => {\n    const itemIdStr = String(itemId)\n    const nowIso = new Date().toISOString()\n    const selectedDateIso = selectedDate ? selectedDate.toISOString() : undefined\n\n    const updateItems = (items?: any[]) => {\n      if (!items) return items\n      return items.map(item => {\n        if (String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_received: true,\n            actual_received_date: selectedDateIso,\n            received_at: nowIso,\n            received_quantity: receivedQuantity !== undefined ? receivedQuantity : item.received_quantity\n          }\n        }\n\n        return {\n          ...item,\n          is_received: false,\n          actual_received_date: undefined,\n          received_at: undefined,\n          received_quantity: undefined\n        }\n      })\n    }\n\n    setPurchase(prev => {\n      if (!prev) return prev\n      const updatedItems = updateItems(prev.items) || []\n      const updatedRequestItems = updateItems(prev.purchase_request_items) || []\n      const total = updatedItems.length\n      const completed = updatedItems.filter(item => item.is_received).length\n      const allReceived = total > 0 && completed === total\n\n      return {\n        ...prev,\n        items: updatedItems,\n        purchase_request_items: updatedRequestItems,\n        is_received: allReceived,\n        received_at: allReceived ? (prev.received_at || nowIso) : undefined,\n        updated_at: new Date().toISOString()\n      }\n    })\n\n    setEditedPurchase(prev => {\n      if (!prev) return prev\n      const updatedItems = updateItems(prev.items) || []\n      const updatedRequestItems = updateItems(prev.purchase_request_items) || []\n      return {\n        ...prev,\n        items: updatedItems,\n        purchase_request_items: updatedRequestItems\n      }\n    })\n\n    setEditedItems(prevItems => {\n      if (!prevItems || prevItems.length === 0) return prevItems\n      return prevItems.map(item => {\n        if (!item.id || String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_received: true,\n            actual_received_date: selectedDateIso,\n            received_at: nowIso,\n            received_quantity: receivedQuantity !== undefined ? receivedQuantity : item.received_quantity\n          }\n        }\n\n        return {\n          ...item,\n          is_received: false,\n          actual_received_date: undefined,\n          received_at: undefined,\n          received_quantity: undefined\n        }\n      })\n    })\n\n    if (!Number.isNaN(purchaseIdNumber)) {\n      onOptimisticUpdate?.(purchaseIdNumber, prevPurchase => {\n        const updatedItems = updateItems(prevPurchase.items) || prevPurchase.items || []\n        const updatedRequestItems = updateItems(prevPurchase.purchase_request_items) || prevPurchase.purchase_request_items || []\n        const total = updatedItems.length || prevPurchase.items?.length || 0\n        const completed = updatedItems.filter(item => item.is_received).length\n        const allReceived = total > 0 && completed === total\n\n        return {\n          ...prevPurchase,\n          items: updatedItems,\n          purchase_request_items: updatedRequestItems,\n          is_received: allReceived,\n          received_at: allReceived ? (prevPurchase.received_at || nowIso) : undefined,\n          updated_at: new Date().toISOString()\n        }\n      })\n    }\n  }, [onOptimisticUpdate, purchaseIdNumber])\n\n  const handleStatementReceivedOptimisticUpdate = useCallback(({ itemId, selectedDate, action }: {\n    itemId: number\n    selectedDate?: Date\n    action: 'confirm' | 'cancel'\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n    }\n  }) => {\n    const itemIdStr = String(itemId)\n    const selectedDateIso = selectedDate ? selectedDate.toISOString() : undefined\n\n    let nextAllCompleted = false\n    let nextStatementAt: string | null = null\n\n    setPurchase(prev => {\n      if (!prev) return prev\n\n      const updatedItems = (prev.items || []).map(item => {\n        if (String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_statement_received: true,\n            statement_received_date: selectedDateIso,\n            statement_received_by_name: currentUserName\n          }\n        }\n\n        return {\n          ...item,\n          is_statement_received: false,\n          statement_received_date: null,\n          statement_received_by_name: null\n        }\n      })\n\n      nextAllCompleted = updatedItems.length > 0 && updatedItems.every(item => item.is_statement_received)\n      nextStatementAt = nextAllCompleted\n        ? (selectedDateIso || prev.statement_received_at || new Date().toISOString())\n        : null\n\n      return {\n        ...prev,\n        items: updatedItems,\n        is_statement_received: nextAllCompleted,\n        statement_received_at: nextStatementAt\n      }\n    })\n\n    setEditedPurchase(prev => {\n      if (!prev) return prev\n\n      const updatedItems = (prev.items || []).map(item => {\n        if (String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_statement_received: true,\n            statement_received_date: selectedDateIso,\n            statement_received_by_name: currentUserName\n          }\n        }\n\n        return {\n          ...item,\n          is_statement_received: false,\n          statement_received_date: null,\n          statement_received_by_name: null\n        }\n      })\n\n      return {\n        ...prev,\n        items: updatedItems,\n        is_statement_received: nextAllCompleted,\n        statement_received_at: nextStatementAt\n      }\n    })\n\n    setEditedItems(prevItems => {\n      if (!prevItems) return prevItems\n      return prevItems.map(item => {\n        if (String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_statement_received: true,\n            statement_received_date: selectedDateIso,\n            statement_received_by_name: currentUserName\n          }\n        }\n\n        return {\n          ...item,\n          is_statement_received: false,\n          statement_received_date: null,\n          statement_received_by_name: null\n        }\n      })\n    })\n\n    if (!Number.isNaN(purchaseIdNumber)) {\n      onOptimisticUpdate?.(purchaseIdNumber, prevPurchase => {\n        const updatedItems = (prevPurchase.items || []).map(item => {\n          if (String(item.id) !== itemIdStr) return item\n\n          if (action === 'confirm') {\n            return {\n              ...item,\n              is_statement_received: true,\n              statement_received_date: selectedDateIso,\n              statement_received_by_name: currentUserName\n            }\n          }\n\n          return {\n            ...item,\n            is_statement_received: false,\n            statement_received_date: null,\n            statement_received_by_name: null\n          }\n        })\n\n        const allCompleted = updatedItems.length > 0 && updatedItems.every(item => item.is_statement_received)\n\n        return {\n          ...prevPurchase,\n          items: updatedItems,\n          is_statement_received: allCompleted\n        }\n      })\n    }\n\n    // purchase_requests   \n    if (purchase && nextAllCompleted !== undefined) {\n      const supabase = createClient()\n      supabase\n        .from('purchase_requests')\n        .update({\n          is_statement_received: nextAllCompleted,\n          statement_received_at: nextStatementAt\n        })\n        .eq('id', purchase.id)\n        .then(({ error }: { error: any }) => {\n          if (error) {\n            logger.error('  purchase_requests  ', error)\n          }\n        })\n    }\n  }, [currentUserName, onOptimisticUpdate, purchaseIdNumber, purchase])\n\n  const statementReceivedAction = useConfirmDateAction({\n    config: {\n      field: 'statement_received',\n      confirmMessage: {\n        confirm: '  ?',\n        cancel: '  ?'\n      },\n      successMessage: {\n        confirm: '  .',\n        cancel: '  .'\n      },\n      completedText: ' ',\n      waitingText: ''\n    },\n    currentUserName,\n    canPerformAction: canReceiptCheck,\n    purchaseId: purchase?.id,\n    onUpdate: refreshModalData,\n    onOptimisticUpdate: handleStatementReceivedOptimisticUpdate\n  })\n\n  const actualReceivedAction = useConfirmDateAction({\n    config: {\n      field: 'actual_received',\n      confirmMessage: {\n        confirm: '   ?',\n        cancel: '   ?'\n      },\n      successMessage: {\n        confirm: '   .',\n        cancel: '   .'\n      },\n      completedText: '',\n      waitingText: ''\n    },\n    currentUserName,\n    canPerformAction: canProcessReceipt,\n    purchaseId: purchase?.id,\n    onUpdate: refreshModalData,\n    onOptimisticUpdate: handleActualReceiptOptimisticUpdate\n  })\n  \n  //   \n  \n  \n  //   \n const canApproveMiddle = effectiveRoles.includes('middle_manager') || \n                          effectiveRoles.includes('app_admin') || \n                          effectiveRoles.includes('ceo')\n \n const canApproveFinal = effectiveRoles.includes('final_approver') || \n                         effectiveRoles.includes('app_admin') || \n                         effectiveRoles.includes('ceo')\n \n const approvalPillClass = 'inline-flex items-center gap-1 business-radius-badge px-2 py-0.5 badge-text leading-tight'\n const approvalButtonClass = 'inline-flex items-center gap-1 business-radius-badge !h-auto !min-h-0 !px-2.5 !py-0.5 badge-text leading-tight'\n const approvalWaitingPillClass = 'inline-flex items-center gap-1 business-radius-badge px-2.5 py-0.5 badge-text leading-tight'\n \n \n  useEffect(() => {\n    if (purchaseId && isOpen) {\n      //       \n      const memoryPurchase = findPurchaseInMemory(purchaseId)\n      if (memoryPurchase) {\n        //     (loading  )\n        const purchaseData = {\n          ...memoryPurchase,\n          id: String(memoryPurchase.id), // PurchaseRequest id string\n          is_po_generated: false, // Purchase   PurchaseRequest \n          vendor: (memoryPurchase as any).vendor || (memoryPurchase.vendor_id ? {\n            id: memoryPurchase.vendor_id,\n            vendor_name: memoryPurchase.vendor_name || '  ',\n            is_active: true\n          } as Vendor : null),\n          vendor_contacts: (memoryPurchase as any).vendor_contacts || []\n        } as PurchaseRequestWithDetails\n        \n        setPurchase(purchaseData)\n        setEditedPurchase(purchaseData)\n        setEditedItems(memoryPurchase.items || [])\n      } else {\n        //     \n        loadPurchaseDetail(purchaseId.toString())\n      }\n      setIsEditing(false) //      \n    }\n  }, [purchaseId, isOpen])\n\n  //    (  )\n  const calculateOptimalColumnWidths = useCallback(() => {\n    // items purchase_request_items   \n    const items = (purchase?.items && purchase.items.length > 0) \n      ? purchase.items \n      : (purchase?.purchase_request_items && purchase.purchase_request_items.length > 0)\n      ? purchase.purchase_request_items\n      : []\n    \n    if (items.length === 0) return []\n\n    const columnConfigs = [\n      { key: 'item_name', minWidth: 80, maxWidth: 500, baseWidth: 80 },\n      { key: 'specification', minWidth: 80, maxWidth: 200, baseWidth: 150, isFixed: false }, //   (80px~200px)\n      { key: 'quantity', minWidth: 70, maxWidth: 120, baseWidth: 70 }, // 100/0   maxWidth \n      { key: 'unit_price', minWidth: 90, maxWidth: 150, baseWidth: 90 },\n      { key: 'total_price', minWidth: 100, maxWidth: 180, baseWidth: 100 },\n    ]\n    \n    //     \n    if (purchase?.payment_category === '') {\n      columnConfigs.push({ key: 'tax_amount', minWidth: 80, maxWidth: 150, baseWidth: 80 })\n    }\n    \n    columnConfigs.push(\n      { key: 'remarks', minWidth: 150, maxWidth: 150, baseWidth: 150, isFixed: true }, //   150px\n      { key: 'status', minWidth: 70, maxWidth: 100, baseWidth: 70 } //    \n    )\n\n      //   ()\n      if (activeTab === 'receipt') {\n        columnConfigs.push(\n          { key: 'actual_receipt_date', minWidth: 100, maxWidth: 160, baseWidth: 100, isFixed: false }\n        )\n      }\n      if (activeTab === 'done') {\n        //    ,  ,   \n        if (purchase?.payment_category === '') {\n          columnConfigs.push(\n            { key: 'transaction_confirm', minWidth: 85, maxWidth: 120, baseWidth: 85, isFixed: false }, //     \n            { key: 'accounting_date', minWidth: 70, maxWidth: 70, baseWidth: 70, isFixed: true }, //     \n            { key: 'expenditure_info', minWidth: 90, maxWidth: 150, baseWidth: 90, isFixed: false } //    \n          )\n        }\n      }\n\n    const calculatedWidths = columnConfigs.map((config, index) => {\n      let maxLength = 4 //  4\n\n      //     ()\n      const getHeaders = () => {\n        const statusHeader = activeTab === 'purchase'\n          ? ''\n          : (activeTab === 'receipt' || activeTab === 'done')\n          ? ''\n          : ''\n\n        //    \n        // receipt, done  '/ '    \n        const quantityHeader = (activeTab === 'receipt' || activeTab === 'done') \n          ? '/ ' \n          : ''\n        const baseHeaders = activeTab === 'pending' \n          ? ['', '', quantityHeader, '', '', purchase?.payment_category === '' ? '' : null, ''].filter(h => h !== null)\n          : ['', '', quantityHeader, '', '', purchase?.payment_category === '' ? '' : null, '', statusHeader].filter(h => h !== null)\n        if (activeTab === 'receipt') {\n          return [...baseHeaders, '']\n        } else if (activeTab === 'done') {\n          const doneHeaders = [...baseHeaders]\n          //    ,  ,   \n          if (purchase?.payment_category === '') {\n            doneHeaders.push(' ', ' ', '')\n          }\n          return doneHeaders\n        }\n        return baseHeaders\n      }\n      \n      const headers = getHeaders()\n      if (headers[index]) {\n        maxLength = Math.max(maxLength, headers[index].length)\n      }\n\n      //     \n      items.forEach(item => {\n        let cellValue = ''\n        switch (config.key) {\n          case 'item_name':\n            cellValue = item.item_name || ''\n            break\n          case 'specification':\n            cellValue = item.specification || ''\n            break\n          case 'quantity':\n            // receipt, done  /  \n            if (activeTab === 'receipt' || activeTab === 'done') {\n              const quantity = item.quantity || 0\n              const receivedQuantity = item.received_quantity ?? 0\n              // 100  2      \n              //       (   /  )\n              cellValue = quantity >= 100 || receivedQuantity >= 100 \n                ? `${quantity}` // 2     \n                : `${quantity}/${receivedQuantity}` // 1   \n            } else {\n              cellValue = item.quantity?.toString() || ''\n            }\n            break\n          case 'unit_price':\n            cellValue = item.unit_price_value != null ? item.unit_price_value.toLocaleString() : ''\n            break\n          case 'total_price':\n            if (item.amount_value != null) {\n              cellValue = item.amount_value.toLocaleString()\n            } else if (item.quantity != null && item.unit_price_value != null) {\n              cellValue = (Number(item.quantity) * Number(item.unit_price_value)).toLocaleString()\n            } else {\n              cellValue = ''\n            }\n            break\n          case 'tax_amount':\n            cellValue = item.tax_amount_value != null ? item.tax_amount_value.toLocaleString() : ''\n            break\n          case 'remarks':\n            cellValue = item.remark || ''\n            break\n          case 'status':\n            cellValue = getStatusDisplay(item) || ''\n            break\n          case 'actual_receipt_date':\n            cellValue = item.actual_received_date ? formatDate(item.actual_received_date) : ''\n            break\n          case 'transaction_confirm':\n            cellValue = item.is_statement_received ? '' : ''\n            break\n          case 'accounting_date':\n            cellValue = item.statement_received_date ? formatDate(item.statement_received_date) : ''\n            break\n          case 'expenditure_info':\n            //    2   \n            if (item.expenditure_date && item.expenditure_amount !== null && item.expenditure_amount !== undefined) {\n              //   : \"2025. 11. 25.\" ( 14)\n              cellValue = '2025. 11. 25.' //    \n            } else {\n              cellValue = '' //  \n            }\n            break\n        }\n        \n        // /     ( 1.5 )\n        const adjustedLength = cellValue.split('').reduce((acc, char) => {\n          return acc + (/[-]/.test(char) ? 1.5 : 1)\n        }, 0)\n        \n        maxLength = Math.max(maxLength, Math.ceil(adjustedLength))\n      })\n\n      //     \n      if (config.isFixed) {\n        return config.baseWidth\n      }\n      \n      //    (  7px +  20px)\n      let calculatedWidth = Math.max(\n        config.minWidth,\n        Math.min(config.maxWidth, maxLength * 7 + 20)\n      )\n      \n      //      2   \n      if (config.key === 'expenditure_info') {\n        //   \"2025. 11. 25.\"  \n        // 2     \n        calculatedWidth = 110 //   \n      }\n\n      return calculatedWidth\n    })\n\n    setColumnWidths(calculatedWidths)\n    return calculatedWidths\n  }, [purchase, activeTab])\n\n  //     \n  const getStatusDisplay = (item: any) => {\n    if (activeTab === 'purchase') {\n      return item.is_payment_completed ? '' : ''\n    } else if (activeTab === 'receipt') {\n      return item.is_received ? '' : ''\n    }\n    return item.is_payment_completed ? '' : ''\n  }\n\n  //  gridTemplateColumns \n  const getGridTemplateColumns = () => {\n    //      (,    )\n    if (columnWidths.length > 0) {\n      const widths = columnWidths.map(width => `${width}px`)\n      \n      //      ( )\n      //      \n      \n      return widths.join(' ')\n    }\n    \n    //  (  )\n    // [, , , , ]\n    let baseColumns = ['minmax(80px, 1fr)', '200px', '70px', '90px', '100px']\n    \n    //     \n    if (purchase?.payment_category === '') {\n      baseColumns.push('100px') // \n    }\n    \n    //   \n    baseColumns.push('150px')\n    \n    // isEditing      \n    if (isEditing) {\n      baseColumns.push('80px') // \n    } else {\n      baseColumns.push('80px') // \n    }\n    \n    //   \n    if (activeTab === 'receipt') {\n      return [...baseColumns, '100px'].join(' ')\n    } else if (activeTab === 'done') {\n      const doneColumns = [...baseColumns]\n      //    ,  ,   \n      if (purchase?.payment_category === '') {\n        doneColumns.push('100px', '80px', '110px') //  ,  , \n      }\n      return doneColumns.join(' ')\n    }\n    \n    return baseColumns.join(' ')\n  }\n\n  //  measureColumnWidths  ( )\n  const measureColumnWidths = () => {\n    calculateOptimalColumnWidths()\n  }\n\n  // View     (  )\n  //      \n  useEffect(() => {\n    // items purchase_request_items   \n    const hasItems = (purchase?.items && purchase.items.length > 0) || \n                     (purchase?.purchase_request_items && purchase.purchase_request_items.length > 0)\n    \n    if (purchase && hasItems && !isEditing) {\n      // requestAnimationFrame       \n      requestAnimationFrame(() => {\n        calculateOptimalColumnWidths()\n      })\n    }\n  }, [purchase, isEditing, activeTab, calculateOptimalColumnWidths])\n\n  // Edit     \n  const handleEditToggle = (editing: boolean) => {\n    if (editing && !isEditing) {\n      // Edit      \n      setEditedPurchase(purchase)\n      setEditedItems(currentItems || [])\n      setDeletedItemIds([])\n      // Edit      \n      calculateOptimalColumnWidths()\n    }\n    setIsEditing(editing)\n  }\n\n  const loadPurchaseDetail = async (id: string) => {\n    try {\n      //     (    )\n      const memoryPurchase = findPurchaseInMemory(id)\n      if (memoryPurchase) {\n        //   PurchaseRequestWithDetails  \n        const purchaseData = {\n          ...memoryPurchase,\n          id: String(memoryPurchase.id), // PurchaseRequest id string\n          is_po_generated: false, // Purchase   PurchaseRequest \n          vendor: (memoryPurchase as any).vendor || (memoryPurchase.vendor_id ? {\n            id: memoryPurchase.vendor_id,\n            vendor_name: memoryPurchase.vendor_name || '  ',\n            is_active: true\n          } as Vendor : null),\n          vendor_contacts: (memoryPurchase as any).vendor_contacts || []\n        } as PurchaseRequestWithDetails\n        \n        setPurchase(purchaseData)\n        setEditedPurchase(purchaseData)\n        setEditedItems(memoryPurchase.items || [])\n        return\n      }\n      \n      //        DB  (fallback)\n      setLoading(true)\n      const supabase = createClient()\n      \n      //  purchase_requests  \n      const { data, error } = await supabase\n        .from('purchase_requests')\n        .select(`\n          *,\n          vendors:vendor_id(id, vendor_name, is_active),\n          purchase_request_items(*),\n          contact:contact_id(id, contact_name, contact_email, contact_phone, position)\n        `)\n        .eq('id', id)\n        .single()\n\n      if (error) throw error\n      \n      // vendor_id      ,      \n      let vendorContacts = []\n      if (data && data.vendor_id) {\n        const { data: allContacts } = await supabase\n          .from('vendor_contacts')\n          .select('id, contact_name, contact_email, contact_phone, position')\n          .eq('vendor_id', data.vendor_id)\n          .order('contact_name')\n        \n        if (allContacts && allContacts.length > 0) {\n          // contact_id     \n          if (data.contact_id) {\n            const currentContact = allContacts.find((c: any) => c.id === data.contact_id)\n            const otherContacts = allContacts.filter((c: any) => c.id !== data.contact_id)\n            vendorContacts = currentContact ? [currentContact, ...otherContacts] : allContacts\n          } else {\n            vendorContacts = allContacts\n          }\n          logger.info(' loadPurchaseDetail -    :', {\n            vendor_id: data.vendor_id,\n            contact_id: data.contact_id,\n            allContacts_count: allContacts.length,\n            vendorContacts\n          })\n        }\n      } else if (data && data.contact) {\n        // vendor_id   contact  \n        vendorContacts = [data.contact]\n      }\n\n      if (data) {\n        //   \n        const sortedItems = (data.purchase_request_items || []).sort((a: any, b: any) => {\n          const lineA = a.line_number || 999999;\n          const lineB = b.line_number || 999999;\n          return lineA - lineB;\n        });\n\n        const purchaseData = {\n          ...data,\n          items: sortedItems,\n          vendor: data.vendors || null,\n          vendor_contacts: vendorContacts,\n          contact_id: data.contact_id,  // contact_id \n          contact_name: vendorContacts[0]?.contact_name || data.contact?.contact_name || null  // contact_name \n        } as PurchaseRequestWithDetails\n        setPurchase(purchaseData)\n        setEditedPurchase(purchaseData)\n        setEditedItems(sortedItems)\n      }\n    } catch (error) {\n      logger.error('[PurchaseDetailModal]    :', error)\n      toast.error('    .')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const getStatusBadge = () => {\n    if (!purchase) return null\n    \n    // payment_category  \n    if (purchase.payment_category) {\n      const category = purchase.payment_category.trim()\n      \n      if (category === '') {\n        return <span className=\"badge-stats bg-green-500 text-white\"></span>\n      } else if (category === '') {\n        return <span className=\"badge-stats bg-blue-500 text-white\"></span>\n      } else if (category === '') {\n        return <span className=\"badge-stats bg-gray-500 text-white\"></span>\n      } else {\n        // payment_category      \n        return <span className=\"badge-stats bg-blue-500 text-white\">{category}</span>\n      }\n    }\n    \n    // payment_category  \n    return <span className=\"badge-stats bg-blue-500 text-white\"></span>\n  }\n\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat('ko-KR').format(amount)\n  }\n\n  const handleSave = async () => {\n    if (!purchase || !editedPurchase) {\n      toast.error('  .')\n      return\n    }\n    \n    logger.info('handleSave :', { \n      purchaseId: purchase.id,\n      vendor_id: editedPurchase.vendor_id,\n      vendor_name: editedPurchase.vendor_name,\n      vendor: editedPurchase.vendor,\n      editedPurchase: editedPurchase\n    })\n    \n    try {\n      const supabase = createClient()\n      \n      //    \n      const totalAmount = editedItems.reduce((sum, item) => sum + (item.amount_value || 0), 0)\n      \n      logger.info('Update payload:', {\n        purchase_order_number: editedPurchase.purchase_order_number || null,\n        requester_name: editedPurchase.requester_name || null,\n        vendor_id: editedPurchase.vendor_id || null,\n        vendor_name: editedPurchase.vendor_name || null,\n        delivery_request_date: editedPurchase.delivery_request_date || null,\n        revised_delivery_request_date: editedPurchase.revised_delivery_request_date || null,\n        payment_category: editedPurchase.payment_category || null,\n        project_vendor: editedPurchase.project_vendor || null,\n        project_item: editedPurchase.project_item || null,\n        sales_order_number: editedPurchase.sales_order_number || null,\n        total_amount: Number(totalAmount),\n        updated_at: new Date().toISOString()\n      })\n      \n      // contact_id :  1. editedPurchase.contact_id 2. vendor_contacts[0].id 3. null\n      let contactId = null\n      if ((editedPurchase as any).contact_id) {\n        contactId = (editedPurchase as any).contact_id\n      } else if (Array.isArray(editedPurchase.vendor_contacts) && editedPurchase.vendor_contacts.length > 0) {\n        contactId = editedPurchase.vendor_contacts[0].id || null\n      }\n      \n      const { error: updateError } = await supabase\n        .from('purchase_requests')\n        .update({\n          purchase_order_number: editedPurchase.purchase_order_number || null,\n          requester_name: editedPurchase.requester_name || null,\n          vendor_id: editedPurchase.vendor_id || null,\n          vendor_name: editedPurchase.vendor_name || null,\n          contact_id: contactId, // contact_id \n          delivery_request_date: editedPurchase.delivery_request_date || null,\n          revised_delivery_request_date: editedPurchase.revised_delivery_request_date || null,\n          payment_category: editedPurchase.payment_category || null,\n          project_vendor: editedPurchase.project_vendor || null,\n          project_item: editedPurchase.project_item || null,\n          sales_order_number: editedPurchase.sales_order_number || null,\n          total_amount: Number(totalAmount),\n          updated_at: new Date().toISOString()\n        })\n        .eq('id', purchase.id)\n\n      if (updateError) {\n        logger.error('Purchase update error:', updateError)\n        throw updateError\n      }\n\n      //      contact_id \n      let finalContactId = null\n      logger.info('  :', { \n        vendor_id: editedPurchase.vendor_id,\n        vendor_contacts: editedPurchase.vendor_contacts,\n        isArray: Array.isArray(editedPurchase.vendor_contacts)\n      })\n      \n      if (editedPurchase.vendor_id && Array.isArray(editedPurchase.vendor_contacts) && editedPurchase.vendor_contacts.length > 0) {\n        const contact = editedPurchase.vendor_contacts[0]\n        logger.info(' :', { contact })\n        \n        //    ,  \n        if (contact.id) {\n          finalContactId = contact.id\n          const { error: contactUpdateError } = await supabase\n            .from('vendor_contacts')\n            .update({\n              contact_name: contact.contact_name || '',\n              contact_email: contact.contact_email || '',\n              contact_phone: contact.contact_phone || '',\n              position: contact.position || ''\n            })\n            .eq('id', contact.id)\n          \n          if (contactUpdateError) {\n            logger.error('  :', contactUpdateError)\n          } else {\n            //  UI  \n            setPurchase(prev => {\n              const updated = prev ? {\n                ...prev,\n                vendor_contacts: [contact],\n                contact_id: contact.id,\n                contact_name: contact.contact_name  // contact_name \n              } : null\n              logger.info('    setPurchase:', { \n                prev_vendor_contacts: prev?.vendor_contacts,\n                new_vendor_contacts: [contact],\n                updated_purchase: updated\n              })\n              console.log('    setPurchase ')\n              return updated\n            })\n          }\n        } else if (contact.contact_name) {\n          //   \n          const { data: newContact, error: contactInsertError } = await supabase\n            .from('vendor_contacts')\n            .insert({\n              vendor_id: editedPurchase.vendor_id,\n              contact_name: contact.contact_name,\n              contact_email: contact.contact_email || '',\n              contact_phone: contact.contact_phone || '',\n              position: contact.position || ''\n            })\n            .select()\n            .single()\n          \n          if (contactInsertError) {\n            logger.error('  :', contactInsertError)\n          } else if (newContact) {\n            finalContactId = newContact.id\n            //    editedPurchase \n            editedPurchase.vendor_contacts = [newContact]\n            logger.info('  :', newContact)\n            \n            //  UI  \n            setPurchase(prev => {\n              const updated = prev ? {\n                ...prev,\n                vendor_contacts: [newContact],\n                contact_id: newContact.id,\n                contact_name: newContact.contact_name  // contact_name \n              } : null\n              logger.info('     setPurchase:', { \n                prev_vendor_contacts: prev?.vendor_contacts,\n                new_vendor_contacts: [newContact],\n                newContact_full: newContact,\n                updated_purchase: updated\n              })\n              console.log('     setPurchase :', newContact)\n              return updated\n            })\n            \n            // purchase_requests  contact_id \n            const { error: purchaseUpdateError } = await supabase\n              .from('purchase_requests')\n              .update({\n                contact_id: newContact.id\n              })\n              .eq('id', purchase.id)\n            \n            if (purchaseUpdateError) {\n              logger.error('purchase_requests contact_id  :', purchaseUpdateError)\n            }\n          }\n        }\n      }\n\n      //   \n      if (deletedItemIds.length > 0) {\n        const { error: deleteError } = await supabase\n          .from('purchase_request_items')\n          .delete()\n          .in('id', deletedItemIds)\n\n        if (deleteError) throw deleteError\n      }\n\n      //     \n      \n      for (const item of editedItems) {\n        \n        //   \n        if (!item.item_name || !item.item_name.trim()) {\n          throw new Error(' .');\n        }\n        if (!item.quantity || item.quantity <= 0) {\n          throw new Error(' 0  .');\n        }\n        if (item.unit_price_value !== null && item.unit_price_value !== undefined && item.unit_price_value < 0) {\n          throw new Error(' 0  .');\n        }\n        if (item.amount_value !== null && item.amount_value !== undefined && item.amount_value < 0) {\n          throw new Error(' 0  .');\n        }\n        \n        if (item.id) {\n          //   \n          const { error } = await supabase\n            .from('purchase_request_items')\n            .update({\n              item_name: item.item_name.trim(),\n              specification: item.specification || null,\n              quantity: Number(item.quantity),\n              received_quantity: item.received_quantity !== null && item.received_quantity !== undefined ? Number(item.received_quantity) : null,\n              unit_price_value: Number(item.unit_price_value),\n              unit_price_currency: purchase.currency || 'KRW',\n              amount_value: Number(item.amount_value),\n              amount_currency: purchase.currency || 'KRW',\n              remark: item.remark || null,\n              updated_at: new Date().toISOString()\n            })\n            .eq('id', item.id)\n\n          if (error) {\n            logger.error('   ', error);\n            throw error;\n          }\n        } else {\n          //   \n          const insertData = {\n            purchase_request_id: purchase.id,\n            item_name: item.item_name.trim(),\n            specification: item.specification || null,\n            quantity: Number(item.quantity),\n            received_quantity: item.received_quantity !== null && item.received_quantity !== undefined ? Number(item.received_quantity) : null,\n            unit_price_value: Number(item.unit_price_value),\n            unit_price_currency: purchase.currency || 'KRW',\n            amount_value: Number(item.amount_value),\n            amount_currency: purchase.currency || 'KRW',\n            remark: item.remark || null,\n            line_number: item.line_number || editedItems.indexOf(item) + 1,\n            created_at: new Date().toISOString()\n          };\n          \n          const { error } = await supabase\n            .from('purchase_request_items')\n            .insert(insertData)\n\n          if (error) {\n            logger.error('   ', error);\n            throw error;\n          }\n        }\n      }\n\n      //        (  )\n      const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n      const sourceData = editedPurchase || purchase\n      \n      // 1.         (  )\n      if (!Number.isNaN(purchaseIdNumber) && deletedItemIds.length > 0) {\n        logger.info(' [ ]     ', {\n          purchaseId: purchaseIdNumber,\n          deletedItemIds: deletedItemIds,\n          deletedCount: deletedItemIds.length\n        })\n        \n        //         (   )\n        deletedItemIds.forEach(itemId => {\n          const memoryUpdated = removeItemFromMemory(purchaseIdNumber, itemId)\n          if (!memoryUpdated) {\n            logger.warn('[handleSave]       ', { \n              purchaseId: purchaseIdNumber, \n              itemId: itemId \n            })\n          } else {\n            logger.info(' [handleSave]       ', { \n              purchaseId: purchaseIdNumber, \n              itemId: itemId \n            })\n          }\n        })\n      }\n      \n      // 2.       ( )\n      if (!Number.isNaN(purchaseIdNumber)) {\n        const memoryUpdated = updatePurchaseInMemory(purchaseIdNumber, (prev) => {\n          const totalAmount = editedItems.reduce((sum, item) => sum + (item.amount_value || 0), 0)\n          \n          logger.info(' [ ]    ', {\n            purchaseId: purchaseIdNumber,\n            newTotalAmount: totalAmount,\n            itemsCount: editedItems.length\n          })\n          \n          return {\n            ...prev,\n            //    \n            purchase_order_number: sourceData?.purchase_order_number || prev.purchase_order_number,\n            requester_name: sourceData?.requester_name || prev.requester_name,\n            vendor_id: sourceData?.vendor_id || prev.vendor_id,\n            vendor_name: sourceData?.vendor_name || prev.vendor_name,\n            vendor: sourceData?.vendor || (prev as any).vendor,\n            vendor_contacts: sourceData?.vendor_contacts || (prev as any).vendor_contacts,\n            delivery_request_date: sourceData?.delivery_request_date || prev.delivery_request_date,\n            revised_delivery_request_date: sourceData?.revised_delivery_request_date || prev.revised_delivery_request_date,\n            payment_category: sourceData?.payment_category || prev.payment_category,\n            project_vendor: sourceData?.project_vendor || prev.project_vendor,\n            project_item: sourceData?.project_item || prev.project_item,\n            total_amount: totalAmount,\n            updated_at: new Date().toISOString()\n          } as Purchase\n        })\n        \n        logger.info(' [ ]    :', { memoryUpdated })\n      }\n      \n      // 3. applyOptimisticUpdate   (  )\n      const applyOptimisticUpdate = () => {\n        if (!Number.isNaN(purchaseIdNumber) && onOptimisticUpdate) {\n          onOptimisticUpdate(purchaseIdNumber, prev => {\n            const finalItems = editedItems //    \n            const totalAmount = finalItems.reduce((sum, item) => sum + (item.amount_value || 0), 0)\n            \n            logger.info(' [onOptimisticUpdate]  UI ', {\n              originalItemsCount: prev.items?.length || prev.purchase_request_items?.length || 0,\n              finalItemsCount: finalItems.length,\n              deletedItemsCount: deletedItemIds.length\n            })\n            \n            return {\n              ...prev,\n              //    \n              purchase_order_number: sourceData?.purchase_order_number || prev.purchase_order_number,\n              requester_name: sourceData?.requester_name || prev.requester_name,\n              vendor_id: sourceData?.vendor_id || prev.vendor_id,\n              vendor_name: sourceData?.vendor_name || prev.vendor_name,\n              vendor: sourceData?.vendor || (prev as any).vendor,\n              vendor_contacts: sourceData?.vendor_contacts || (prev as any).vendor_contacts,\n              delivery_request_date: sourceData?.delivery_request_date || prev.delivery_request_date,\n              revised_delivery_request_date: sourceData?.revised_delivery_request_date || prev.revised_delivery_request_date,\n              payment_category: sourceData?.payment_category || prev.payment_category,\n              project_vendor: sourceData?.project_vendor || prev.project_vendor,\n              project_item: sourceData?.project_item || prev.project_item,\n              total_amount: totalAmount,\n              //    -   \n              items: finalItems,\n              purchase_request_items: finalItems,\n              updated_at: new Date().toISOString()\n            } as Purchase\n          })\n        }\n      }\n      \n      // 4.  UI   (  )\n      applyOptimisticUpdate()\n\n      toast.success('   .')\n      handleEditToggle(false)\n      setDeletedItemIds([])\n      \n      // 5.   : refreshModalData ,   onRefresh\n      await refreshModalData()\n      logger.info(' refreshModalData   purchase:', { purchaseId: purchase?.id })\n      console.log(' refreshModalData   -  purchase :', purchase)\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      logger.error('   ', error);\n      const errorMessage = error instanceof Error ? error.message : '    '\n      toast.error(` : ${errorMessage}`)\n    }\n  }\n\n  const handleItemChange = (index: number, field: string, value: any) => {\n    const newItems = [...editedItems]\n    \n    if (field === 'quantity' || field === 'unit_price_value') {\n      //       \n      const quantity = field === 'quantity' ? value : newItems[index].quantity\n      const unitPrice = field === 'unit_price_value' ? value : newItems[index].unit_price_value\n      newItems[index] = {\n        ...newItems[index],\n        [field]: value,\n        amount_value: (quantity || 0) * (unitPrice || 0)  // null  \n      }\n    } else {\n      //    (amount_value   )\n      newItems[index] = {\n        ...newItems[index],\n        [field]: value\n      }\n    }\n    \n    setEditedItems(newItems)\n  }\n\n  const handleAddItem = () => {\n    //    \n    const maxLineNumber = editedItems.reduce((max, item) => {\n      const lineNum = item.line_number || 0;\n      return lineNum > max ? lineNum : max;\n    }, 0);\n\n    const newItem = {\n      item_name: '',\n      specification: '',\n      quantity: 1,\n      unit_price_value: 0,\n      amount_value: 0,\n      remark: '',\n      line_number: maxLineNumber + 1\n    }\n    \n    //       \n    const newItems = [...editedItems, newItem].sort((a, b) => {\n      const lineA = a.line_number || 999999;\n      const lineB = b.line_number || 999999;\n      return lineA - lineB;\n    });\n    \n    setEditedItems(newItems)\n  }\n\n  const handleRemoveItem = (index: number) => {\n    const item = editedItems[index]\n    if (item.id) {\n      setDeletedItemIds([...deletedItemIds, item.id])\n    }\n    const newItems = editedItems.filter((_, i) => i !== index).sort((a, b) => {\n      const lineA = a.line_number || 999999;\n      const lineB = b.line_number || 999999;\n      return lineA - lineB;\n    });\n    setEditedItems(newItems)\n  }\n\n  //   \n  const handlePaymentToggle = async (itemId: number | string, isCompleted: boolean) => {\n    \n    if (!canPurchase) {\n      logger.warn('[handlePaymentToggle]  ', { canPurchase, currentUserRoles })\n      toast.error('   .')\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n\n    if (Number.isNaN(numericId)) {\n      logger.error('[handlePaymentToggle]  ID', { itemId, numericId })\n      toast.error('   ID .')\n      return\n    }\n\n    //     -   \n    \n    // items purchase_request_items    - length    \n    if (!purchase) return\n    \n    const purchaseItems = (purchase.items && purchase.items.length > 0) ? purchase.items : []\n    const requestItems = (purchase.purchase_request_items && purchase.purchase_request_items.length > 0) ? purchase.purchase_request_items : []\n    const items = purchaseItems.length > 0 ? purchaseItems : requestItems\n    \n    \n    const targetItem = items.find(item => String(item.id) === itemIdStr)\n    \n    \n    if (!targetItem) {\n      return\n    }\n\n    const itemInfo = `: ${targetItem.item_name}\n: ${targetItem.specification || ''}\n: ${targetItem.quantity?.toLocaleString() || 0}${targetItem.unit || ''}\n: ${targetItem.unit_price_value?.toLocaleString() || 0}\n: ${targetItem.amount_value?.toLocaleString() || 0}`\n\n    const confirmMessage = isCompleted \n      ? `   ?\\n\\n${itemInfo}` \n      : `   ?\\n\\n${itemInfo}`\n    \n    const confirm = window.confirm(confirmMessage)\n    \n    if (!confirm) {\n      return\n    }\n\n    try {\n      \n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_payment_completed: isCompleted,\n          payment_completed_at: isCompleted ? new Date().toISOString() : null\n        })\n        .eq('id', numericId)\n\n      if (error) {\n        throw error\n      }\n      \n\n      //      (/  )\n      if (purchase) {\n        \n        const memoryUpdated = isCompleted \n          ? markItemAsPaymentCompleted(purchase.id, numericId)\n          : markItemAsPaymentCanceled(purchase.id, numericId);\n          \n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal]     ', { \n            purchaseId: purchase.id, \n            itemId: numericId,\n            isCompleted\n          });\n        }\n      }\n\n      //     (UI  )\n      setPurchase(prev => {\n        if (!prev) {\n          return null\n        }\n        \n        // items purchase_request_items     - length    \n        const prevItems = (prev.items && prev.items.length > 0) ? prev.items : []\n        const prevRequestItems = (prev.purchase_request_items && prev.purchase_request_items.length > 0) ? prev.purchase_request_items : []\n        const currentItems = prevItems.length > 0 ? prevItems : prevRequestItems\n        const updatedItems = currentItems.map(item => \n          String(item.id) === itemIdStr \n            ? { ...item, is_payment_completed: isCompleted, payment_completed_at: isCompleted ? new Date().toISOString() : null }\n            : item\n        )\n        \n        \n        //    \n        const result = {\n          ...prev,\n          items: prev.items ? updatedItems : prev.items,\n          purchase_request_items: prev.purchase_request_items ? updatedItems : prev.purchase_request_items\n        }\n        \n        return result\n      })\n\n      if (purchase) {\n        const purchaseIdNumber = Number(purchase.id)\n        if (!Number.isNaN(purchaseIdNumber)) {\n          onOptimisticUpdate?.(purchaseIdNumber, prev => {\n            const updatedItems = (prev.items || []).map(item =>\n              String(item.id) === itemIdStr\n                ? { ...item, is_payment_completed: isCompleted }\n                : item\n            )\n            const total = updatedItems.length || prev.items?.length || 0\n            const completed = updatedItems.filter(item => item.is_payment_completed).length\n            const allCompleted = total > 0 && completed === total\n            return {\n              ...prev,\n              items: updatedItems,\n              is_payment_completed: allCompleted,\n              payment_completed_at: allCompleted ? new Date().toISOString() : null,\n              payment_completed_by_name: allCompleted ? (currentUserName || prev.payment_completed_by_name) : prev.payment_completed_by_name\n            }\n          })\n        }\n      }\n      \n      toast.success(isCompleted ? ' .' : ' .')\n\n      //         \n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      toast.error('    .')\n    }\n  }\n\n  //     (  + )\n  const handleItemReceiptToggle = async (itemId: number | string, selectedDate: Date, receivedQuantity?: number) => {\n    if (!canReceiveItems) {\n      toast.error('   .')\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      toast.error('   ID .')\n      return\n    }\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item =>\n            String(item.id) === itemIdStr\n              ? {\n                  ...item,\n                  is_received: true,\n                  actual_received_date: selectedDate.toISOString(),\n                  received_quantity: receivedQuantity !== undefined ? receivedQuantity : item.received_quantity\n                }\n              : item\n          )\n          const total = updatedItems.length || prev.items?.length || 0\n          const completed = updatedItems.filter(item => item.is_received).length\n          const allReceived = total > 0 && completed === total\n\n          return {\n            ...prev,\n            items: updatedItems,\n            is_received: allReceived,\n            received_at: allReceived ? new Date().toISOString() : prev.received_at\n          }\n        })\n      }\n    }\n\n    try {\n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_received: true,\n          received_at: new Date().toISOString(),\n          actual_received_date: selectedDate.toISOString(),\n          received_quantity: receivedQuantity !== undefined ? receivedQuantity : null\n        })\n        .eq('id', numericId)\n\n      if (error) throw error\n\n      //      (  )\n      if (purchase) {\n        const memoryUpdated = markItemAsReceived(purchase.id, numericId, selectedDate.toISOString(), receivedQuantity);\n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal]       ', { \n            purchaseId: purchase.id, \n            itemId: numericId \n          });\n        }\n      }\n\n      //    \n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          String(item.id) === itemIdStr \n            ? { \n                ...item, \n                is_received: true, \n                received_at: new Date().toISOString(),\n                actual_received_date: selectedDate.toISOString(),\n                received_quantity: receivedQuantity !== undefined ? receivedQuantity : item.received_quantity\n              }\n            : item\n        )\n        const updatedRequestItems = prev.purchase_request_items?.map(item => \n          String(item.id) === itemIdStr \n            ? { \n                ...item, \n                is_received: true, \n                received_at: new Date().toISOString(),\n                actual_received_date: selectedDate.toISOString(),\n                received_quantity: receivedQuantity !== undefined ? receivedQuantity : item.received_quantity\n              }\n            : item\n        )\n        return { \n          ...prev, \n          items: updatedItems,\n          purchase_request_items: updatedRequestItems,\n          updated_at: new Date().toISOString()\n        }\n      })\n\n      applyOptimisticUpdate()\n      \n      const targetItem = purchase?.items?.find(item => String(item.id) === itemIdStr)\n      toast.success(`\"${targetItem?.item_name}\"   .`)\n\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      toast.error('    .')\n    }\n  }\n\n  //   \n  const handleReceiptCancel = async (itemId: number | string) => {\n    if (!canProcessReceipt) {\n      toast.error('   .')\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      toast.error('   ID .')\n      return\n    }\n\n    const targetItem = purchase?.items?.find(item => String(item.id) === itemIdStr)\n    if (!targetItem) return\n\n    const confirm = window.confirm(`\"${targetItem.item_name}\"   ?`)\n    if (!confirm) return\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item =>\n            String(item.id) === itemIdStr\n              ? {\n                  ...item,\n                  is_received: false,\n                  actual_received_date: undefined\n                }\n              : item\n          )\n          const total = updatedItems.length || prev.items?.length || 0\n          const completed = updatedItems.filter(item => item.is_received).length\n          const allReceived = total > 0 && completed === total\n\n          return {\n            ...prev,\n            items: updatedItems,\n            is_received: allReceived,\n            received_at: allReceived ? prev.received_at : null\n          }\n        })\n      }\n    }\n\n    try {\n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_received: false,\n          received_at: null,\n          actual_received_date: null,\n          actual_received_by_name: null\n        })\n        .eq('id', numericId)\n\n      if (error) throw error\n\n      //    \n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          String(item.id) === itemIdStr \n            ? { ...item, is_received: false, received_at: null, actual_received_date: undefined, actual_received_by_name: undefined }\n            : item\n        )\n        return { ...prev, items: updatedItems }\n      })\n      \n      applyOptimisticUpdate()\n\n      toast.success(' .')\n\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      toast.error('    .')\n    }\n  }\n\n\n  //  \n  const handleApprove = async (type: 'middle' | 'final') => {\n    if (!purchase) return\n    \n    const approvalType = type === 'middle' ? '1 ' : ' '\n    const confirmMessage = `: ${purchase.purchase_order_number}\\n\\n${approvalType} ?`\n    const confirm = window.confirm(confirmMessage)\n    if (!confirm) return\n    \n    try {\n      const updateData = type === 'middle' \n        ? { \n            middle_manager_status: 'approved'\n          }\n        : { \n            final_manager_status: 'approved'\n          }\n\n      const { error } = await supabase\n        .from('purchase_requests')\n        .update(updateData)\n        .eq('id', purchase.id)\n      \n      if (error) {\n        throw error\n      }\n\n      //     (UI  )\n      if (type === 'middle') {\n        setPurchase(prev => prev ? { ...prev, middle_manager_status: 'approved' } : null)\n      } else {\n        setPurchase(prev => prev ? { ...prev, final_manager_status: 'approved' } : null)\n      }\n\n      // Optimistic Update    (/  )\n      if (purchase && onOptimisticUpdate) {\n        const purchaseIdNumber = Number(purchase.id)\n        if (!Number.isNaN(purchaseIdNumber)) {\n          onOptimisticUpdate(purchaseIdNumber, prev => {\n            if (type === 'middle') {\n              return {\n                ...prev,\n                middle_manager_status: 'approved' as any\n              }\n            } else {\n              return {\n                ...prev,\n                final_manager_status: 'approved' as any\n              }\n            }\n          })\n        }\n      }\n      \n      toast.success(`${type === 'middle' ? '' : ''}  .`)\n\n      //      \n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      toast.error('    .')\n    }\n  }\n  \n  //    (   )\n  const handleCompleteAllPayment = async () => {\n    \n    if (!purchase || !canPurchase) {\n      return\n    }\n    \n    const confirmMessage = `: ${purchase.purchase_order_number}\\n\\n  ?`\n    const confirm = window.confirm(confirmMessage)\n    if (!confirm) {\n      return\n    }\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const allItems = prev.purchase_request_items || [];\n          const pendingItems = allItems.filter(item => !item.is_payment_completed);\n          \n          const updatedItems = allItems.map(item => \n            !item.is_payment_completed \n              ? { ...item, is_payment_completed: true, payment_completed_at: new Date().toISOString() }\n              : item\n          );\n          \n          return {\n            ...prev,\n            purchase_request_items: updatedItems,\n            items: prev.items ? updatedItems : prev.items,\n            is_payment_completed: updatedItems.every(item => item.is_payment_completed)\n          }\n        })\n      }\n    }\n    \n    try {\n      //     (   )\n      const allItems = purchase.purchase_request_items || [];\n      const pendingItems = allItems.filter(item => !item.is_payment_completed);\n      \n      if (pendingItems.length === 0) {\n        toast.info('   .');\n        return;\n      }\n\n      logger.info(`  : ${pendingItems.length}  ( ${allItems.length} )`);\n      \n      for (const item of pendingItems) {\n        //   DB  (   )\n        const updateData = {\n          is_payment_completed: true,\n          payment_completed_at: new Date().toISOString()\n        };\n\n        const { error } = await supabase\n          .from('purchase_request_items')\n          .update(updateData)\n          .eq('id', item.id);\n\n        if (error) throw error;\n\n        //       (  )\n        const memoryUpdated = markItemAsPaymentCompleted(purchase.id, item.id);\n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal]       ', { \n            purchaseId: purchase.id, \n            itemId: item.id \n          });\n        }\n      }\n\n      toast.success(`${pendingItems.length}   .`);\n\n      //   (  )\n      await refreshModalData();\n      const refreshResult = onRefresh?.(true, { silent: true });\n      if (refreshResult instanceof Promise) {\n        await refreshResult;\n      }\n    } catch (error) {\n      logger.error('   ', error);\n      toast.error('    .')\n    }\n  }\n\n  //     \n  const handleItemExpenditure = async (itemId: number | string, date: Date, amount: number) => {\n    if (!purchase || !canReceiptCheck) {\n      toast.error('    .')\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      logger.error('  itemId', { itemId })\n      return\n    }\n\n    const targetItem = purchase.items?.find(item => String(item.id) === itemIdStr)\n    if (!targetItem) return\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item =>\n            String(item.id) === itemIdStr\n              ? {\n                  ...item,\n                  expenditure_date: date.toISOString(),\n                  expenditure_amount: amount\n                }\n              : item\n          )\n          return { ...prev, items: updatedItems }\n        })\n      }\n    }\n\n    try {\n      applyOptimisticUpdate()\n\n      //     (items purchase_request_items  ) -    \n      setPurchase(prev => {\n        if (!prev) return null\n        const currentItems = prev.items || prev.purchase_request_items || []\n        const updatedItems = currentItems.map(item => \n          String(item.id) === itemIdStr\n            ? {\n                ...item,\n                expenditure_date: date.toISOString(),\n                expenditure_amount: amount\n              }\n            : item\n        )\n        const totalExpenditure = updatedItems.reduce((sum, item) => sum + (item.expenditure_amount || 0), 0)\n        //    React   \n        return { \n          ...prev, \n          items: updatedItems,\n          purchase_request_items: updatedItems,\n          total_expenditure_amount: totalExpenditure,\n          updated_at: new Date().toISOString() //    \n        }\n      })\n\n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          expenditure_date: date.toISOString(),\n          expenditure_amount: amount\n        })\n        .eq('id', numericId)\n\n      if (error) {\n        logger.error('  DB  ', { error, itemId: numericId })\n        throw error\n      }\n\n      // purchase_requests total_expenditure_amount \n      const allItemsForTotal = purchase.items || purchase.purchase_request_items || []\n      const totalExpenditure = allItemsForTotal.reduce((sum, item) => {\n        if (String(item.id) === itemIdStr) {\n          return sum + amount\n        }\n        return sum + (item.expenditure_amount || 0)\n      }, 0)\n\n      await supabase\n        .from('purchase_requests')\n        .update({ total_expenditure_amount: totalExpenditure })\n        .eq('id', purchaseIdNumber)\n\n      //      ( UI ) - DB   \n      if (purchase?.id) {\n        const memoryUpdated = markItemAsExpenditureSet(purchase.id, numericId, date.toISOString(), amount)\n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal]      ', { \n            purchaseId: purchase.id, \n            itemId: numericId \n          })\n        }\n      }\n\n      toast.success(`\"${targetItem.item_name}\"    .`)\n\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      logger.error('    ', error)\n      toast.error('     .')\n    }\n  }\n\n  //     \n  const handleBulkExpenditure = async (date: Date, amount: number) => {\n    if (!purchase || !canReceiptCheck) {\n      toast.error('    .')\n      return\n    }\n\n    const confirmMessage = `: ${purchase.purchase_order_number}\\n\\n   ?\\n: ${date.toLocaleDateString('ko-KR')}\\n: ${amount.toLocaleString()}`\n    \n    if (!window.confirm(confirmMessage)) {\n      return\n    }\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item =>\n            //     \n            item.expenditure_date && item.expenditure_amount\n              ? item\n              : {\n                  ...item,\n                  expenditure_date: date.toISOString(),\n                  expenditure_amount: amount\n                }\n          )\n          return { ...prev, items: updatedItems }\n        })\n      }\n    }\n\n    try {\n      applyOptimisticUpdate()\n\n      //       \n      const allItems = purchase.items || purchase.purchase_request_items || []\n      const pendingItems = allItems.filter(item => !item.expenditure_date || !item.expenditure_amount)\n      \n      if (pendingItems.length === 0) {\n        toast.info('      .')\n        return\n      }\n\n      //     (items purchase_request_items  )\n      setPurchase(prev => {\n        if (!prev) return null\n        const allItems = prev.items || prev.purchase_request_items || []\n        const updatedItems = allItems.map(item =>\n          //     \n          item.expenditure_date && item.expenditure_amount\n            ? item\n            : {\n                ...item,\n                expenditure_date: date.toISOString(),\n                expenditure_amount: amount\n              }\n        )\n        const totalExpenditure = updatedItems.reduce((sum, item) => sum + (item.expenditure_amount || 0), 0)\n        //    React   \n        return { \n          ...prev, \n          items: updatedItems,\n          purchase_request_items: updatedItems,\n          total_expenditure_amount: totalExpenditure,\n          updated_at: new Date().toISOString() //    \n        }\n      })\n\n      for (const item of pendingItems) {\n        const { error } = await supabase\n          .from('purchase_request_items')\n          .update({\n            expenditure_date: date.toISOString(),\n            expenditure_amount: amount\n          })\n          .eq('id', item.id)\n\n        if (error) {\n          logger.error('   DB  ', { error, itemId: item.id })\n          throw error\n        }\n      }\n\n      // purchase_requests total_expenditure_amount \n      const totalExpenditure = allItems.reduce((sum, item) => {\n        if (pendingItems.find(pi => pi.id === item.id)) {\n          return sum + amount\n        }\n        return sum + (item.expenditure_amount || 0)\n      }, 0)\n\n      await supabase\n        .from('purchase_requests')\n        .update({ total_expenditure_amount: totalExpenditure })\n        .eq('id', purchaseIdNumber)\n\n      //      ( UI ) - DB   \n      for (const item of pendingItems) {\n        const memoryUpdated = markItemAsExpenditureSet(purchase.id, item.id, date.toISOString(), amount)\n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal]       ', { \n            purchaseId: purchase.id, \n            itemId: item.id \n          })\n        }\n      }\n\n      //         ( )\n      const memoryPurchase = findPurchaseInMemory(purchase.id)\n      if (memoryPurchase) {\n        const normalizedItems = (memoryPurchase.items && memoryPurchase.items.length > 0) \n          ? memoryPurchase.items \n          : (memoryPurchase.purchase_request_items || [])\n        const totalExpenditure = normalizedItems.reduce((sum, item) => sum + (item.expenditure_amount || 0), 0)\n        setPurchase(prev => ({\n          ...prev!,\n          items: normalizedItems,\n          purchase_request_items: normalizedItems,\n          total_expenditure_amount: totalExpenditure\n        }))\n      }\n\n      toast.success(`${pendingItems.length}     .`)\n\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      logger.error('     ', error)\n      toast.error('      .')\n    }\n  }\n\n  //     (   )\n  const handleCompleteAllStatement = async (selectedDate: Date) => {\n    if (!purchase || !canReceiptCheck) {\n      return\n    }\n\n    const formattedDate = selectedDate.toLocaleDateString('ko-KR', {\n      year: 'numeric',\n      month: '2-digit',\n      day: '2-digit'\n    })\n\n    const confirmMessage = `: ${purchase.purchase_order_number}\n\n   ?`\n    \n    if (!window.confirm(confirmMessage)) {\n      return\n    }\n\n    const selectedDateIso = selectedDate.toISOString()\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const allItems = prev.purchase_request_items || [];\n          const pendingItems = allItems.filter(item => !item.is_statement_received);\n          \n          const updatedItems = allItems.map(item => \n            !item.is_statement_received \n              ? { \n                  ...item, \n                  is_statement_received: true, \n                  statement_received_date: selectedDateIso,\n                  statement_received_by_name: currentUserName || null\n                }\n              : item\n          );\n          \n          return {\n            ...prev,\n            purchase_request_items: updatedItems,\n            items: prev.items ? updatedItems : prev.items,\n            is_statement_received: updatedItems.every(item => item.is_statement_received),\n            statement_received_at: selectedDateIso\n          }\n        })\n      }\n    }\n\n    try {\n      //     (    )\n      const allItems = purchase.purchase_request_items || [];\n      const pendingItems = allItems.filter(item => !item.is_statement_received);\n      \n      if (pendingItems.length === 0) {\n        toast.info('    .');\n        return;\n      }\n\n      logger.info(`   : ${pendingItems.length}  ( ${allItems.length} )`);\n      \n      for (const item of pendingItems) {\n        //   DB  (   )\n        const updateData = {\n          is_statement_received: true,\n          statement_received_date: selectedDateIso,\n          statement_received_by_name: currentUserName || null\n        };\n\n        const { error } = await supabase\n          .from('purchase_request_items')\n          .update(updateData)\n          .eq('id', item.id);\n\n        if (error) throw error;\n\n        //       (  )\n        const memoryUpdated = markItemAsStatementReceived(purchase.id, item.id, selectedDateIso, currentUserName || undefined);\n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal]        ', { \n            purchaseId: purchase.id, \n            itemId: item.id \n          });\n        }\n      }\n\n      toast.success(`${pendingItems.length}    .`);\n\n      //   (  )\n      await refreshModalData();\n      const refreshResult = onRefresh?.(true, { silent: true });\n      if (refreshResult instanceof Promise) {\n        await refreshResult;\n      }\n    } catch (error) {\n      logger.error('    ', error)\n      toast.error('     .')\n    }\n  }\n\n  //    (  + )\n  const handleCompleteAllReceipt = async (selectedDate: Date, receivedQuantity?: number) => {\n    if (!purchase || !canReceiveItems) {\n      return\n    }\n\n    //   \n    const confirmMessage = `: ${purchase.purchase_order_number}\n\n  ?`\n    \n    if (!window.confirm(confirmMessage)) {\n      return\n    }\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    try {\n      //     (   )\n      const allItems = purchase.purchase_request_items || [];\n      const pendingItems = allItems.filter(item => !item.is_received);\n      \n      const applyOptimisticUpdate = () => {\n        if (!Number.isNaN(purchaseIdNumber)) {\n          onOptimisticUpdate?.(purchaseIdNumber, prev => {\n            const updatedItems = (prev.items || []).map(item => {\n              const pendingItem = pendingItems.find((p: any) => String(p.id) === String(item.id))\n              if (pendingItem) {\n                //   , receivedQuantity  (quantity)  \n                return {\n                  ...item,\n                  is_received: true,\n                  actual_received_date: item.actual_received_date || selectedDate.toISOString(),\n                  received_quantity: receivedQuantity !== undefined ? receivedQuantity : item.quantity\n                }\n              }\n              return item\n            })\n            const updatedRequestItems = (prev.purchase_request_items || []).map(item => {\n              const pendingItem = pendingItems.find((p: any) => String(p.id) === String(item.id))\n              if (pendingItem) {\n                //   , receivedQuantity  (quantity)  \n                return {\n                  ...item,\n                  is_received: true,\n                  actual_received_date: item.actual_received_date || selectedDate.toISOString(),\n                  received_quantity: receivedQuantity !== undefined ? receivedQuantity : item.quantity\n                }\n              }\n              return item\n            })\n\n            return {\n              ...prev,\n              items: updatedItems,\n              purchase_request_items: updatedRequestItems,\n              is_received: true,\n              received_at: new Date().toISOString(),\n              updated_at: new Date().toISOString()\n            }\n          })\n        }\n      }\n      \n      if (pendingItems.length === 0) {\n        toast.info('   .');\n        return;\n      }\n\n      logger.info(`  : ${pendingItems.length}  ( ${allItems.length} )`);\n      \n      // Optimistic Update  \n      applyOptimisticUpdate()\n      \n      //    \n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => {\n          const pendingItem = pendingItems.find(p => String(p.id) === String(item.id))\n          if (pendingItem) {\n            // receivedQuantity  (quantity)  \n            return {\n              ...item,\n              is_received: true,\n              received_at: new Date().toISOString(),\n              actual_received_date: selectedDate.toISOString(),\n              received_quantity: receivedQuantity !== undefined ? receivedQuantity : item.quantity\n            }\n          }\n          return item\n        }) || []\n        const updatedRequestItems = prev.purchase_request_items?.map(item => {\n          const pendingItem = pendingItems.find(p => String(p.id) === String(item.id))\n          if (pendingItem) {\n            // receivedQuantity  (quantity)  \n            return {\n              ...item,\n              is_received: true,\n              received_at: new Date().toISOString(),\n              actual_received_date: selectedDate.toISOString(),\n              received_quantity: receivedQuantity !== undefined ? receivedQuantity : item.quantity\n            }\n          }\n          return item\n        }) || []\n        const total = updatedItems.length\n        const completed = updatedItems.filter(item => item.is_received).length\n        const allReceived = total > 0 && completed === total\n        \n        return {\n          ...prev,\n          items: updatedItems,\n          purchase_request_items: updatedRequestItems,\n          is_received: allReceived,\n          received_at: allReceived ? new Date().toISOString() : prev.received_at,\n          updated_at: new Date().toISOString()\n        }\n      })\n      \n      for (const item of pendingItems) {\n        //   DB  (   )\n        // receivedQuantity  (quantity)  \n        const updateData = {\n          actual_received_date: selectedDate.toISOString(),\n          is_received: true,\n          received_quantity: receivedQuantity !== undefined ? receivedQuantity : item.quantity //     \n        };\n\n        const { error } = await supabase\n          .from('purchase_request_items')\n          .update(updateData)\n          .eq('id', item.id);\n\n        if (error) throw error;\n\n        //       (  )\n        // receivedQuantity  (quantity)  \n        const itemReceivedQuantity = receivedQuantity !== undefined ? receivedQuantity : item.quantity\n        const memoryUpdated = markItemAsReceived(purchase.id, item.id, selectedDate.toISOString(), itemReceivedQuantity);\n        if (!memoryUpdated) {\n          logger.warn('[PurchaseDetailModal]       ', { \n            purchaseId: purchase.id, \n            itemId: item.id \n          });\n        }\n      }\n\n      toast.success(`${pendingItems.length}   .`);\n\n      //   (  )\n      await refreshModalData();\n      const refreshResult = onRefresh?.(true, { silent: true });\n      if (refreshResult instanceof Promise) {\n        await refreshResult;\n      }\n    } catch (error) {\n      logger.error('   ', error)\n      toast.error('    .')\n    }\n  }\n  \n\n  //  \n  const handleReject = async (type: 'middle' | 'final') => {\n    if (!purchase) return\n    \n    const reason = window.prompt('  :')\n    if (!reason) return\n    \n    try {\n      const updateData = type === 'middle'\n        ? {\n            middle_manager_status: 'rejected'\n          }\n        : {\n            final_manager_status: 'rejected'\n          }\n      \n      const { error } = await supabase\n        .from('purchase_requests')\n        .update(updateData)\n        .eq('id', purchase.id)\n      \n      if (error) {\n        throw error\n      }\n      \n      //     (UI  )\n      if (type === 'middle') {\n        setPurchase(prev => prev ? { ...prev, middle_manager_status: 'rejected' } : null)\n      } else {\n        setPurchase(prev => prev ? { ...prev, final_manager_status: 'rejected' } : null)\n      }\n      \n      toast.success(`${type === 'middle' ? '' : ''}  .`)\n    } catch (error) {\n      toast.error('    .')\n    }\n  }\n\n  const content = (\n    <div className=\"space-y-1 sm:space-y-4\">\n      {loading ? (\n        <div className=\"flex items-center justify-center py-12\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-hansl-600\"></div>\n        </div>\n      ) : purchase ? (\n        <div>\n          {/* Compact Info Header */}\n          <div className=\"bg-gray-50 rounded-lg p-2 sm:p-3 mb-1 sm:mb-2 border border-gray-100\">\n            <div className=\"grid grid-cols-1 sm:grid-cols-3 items-center gap-3 sm:gap-0\">\n              <div className=\"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-4\">\n                <div className=\"flex items-center gap-3\">\n                  {getStatusBadge()}\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"modal-label\">:</span>\n                    <span className=\"modal-value\">{purchase.requester_name}</span>\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Calendar className=\"w-3 h-3 text-gray-500\" />\n                  <span className=\"modal-subtitle\">: {formatDate(purchase.request_date)}</span>\n                </div>\n              </div>\n              \n              {/*     */}\n              <div className=\"flex items-center justify-center gap-2 sm:gap-3 flex-wrap\">\n                {/* 1   */}\n                {(() => {\n                  const shouldShow = canApproveMiddle && purchase.middle_manager_status === 'pending';\n                  return shouldShow;\n                })() && (\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => handleApprove('middle')}\n                    className={`${approvalButtonClass} border border-gray-400 bg-white hover:bg-gray-50 hover:border-gray-500`}\n                  >\n                    1  \n                  </Button>\n                )}\n                {purchase.middle_manager_status === 'approved' && (\n                  <div className=\"button-approved badge-text shadow-sm\">\n                    <Check className=\"w-3 h-3\" />\n                    1 \n                  </div>\n                )}\n                {purchase.middle_manager_status === 'rejected' && (\n                  <div className=\"button-rejected badge-text\">\n                    <X className=\"w-3 h-3\" />\n                    1 \n                  </div>\n                )}\n                {purchase.middle_manager_status === 'pending' && !canApproveMiddle && (\n                  <div className={`${approvalWaitingPillClass} border border-gray-300 text-gray-600 bg-white`}>\n                    1 \n                  </div>\n                )}\n\n                {/*    */}\n                {(() => {\n                  const shouldShow = canApproveFinal && purchase.middle_manager_status === 'approved' && purchase.final_manager_status === 'pending';\n                  return shouldShow;\n                })() && (\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => handleApprove('final')}\n                    className={`${approvalButtonClass} border border-gray-400 bg-white hover:bg-gray-50 hover:border-gray-500`}\n                  >\n                    <Check className=\"w-3 h-3\" />\n                     \n                  </Button>\n                )}\n                {purchase.final_manager_status === 'approved' && (\n                  <div className=\"button-approved badge-text\">\n                    <Check className=\"w-3 h-3\" />\n                     \n                  </div>\n                )}\n                {purchase.final_manager_status === 'rejected' && (\n                  <div className=\"button-rejected badge-text\">\n                    <X className=\"w-3 h-3\" />\n                     \n                  </div>\n                )}\n                {purchase.middle_manager_status !== 'approved' && purchase.final_manager_status === 'pending' && (\n                  <div className={`${approvalWaitingPillClass} border border-gray-300 text-gray-600 bg-white`}>\n                     \n                  </div>\n                )}\n              </div>\n              \n              {/*    */}\n              <div></div>\n            </div>\n          </div>\n\n          {/* Main 2-Column Layout */}\n          <div className=\"flex flex-col lg:flex-row gap-3 sm:gap-6\">\n            {/* Left Column - Basic Info (Fixed Width) */}\n            <div className=\"lg:w-80 lg:flex-shrink-0 space-y-1 sm:space-y-4 relative\">\n              \n              {/*   */}\n              <div className=\"bg-white rounded-lg p-2 sm:p-3 border border-gray-100 shadow-sm\">\n                <div className=\"mb-3\">\n                  <div className=\"flex items-center justify-between\">\n                    <h3 className=\"modal-section-title flex items-center\">\n                      <FileText className=\"w-4 h-4 mr-2 text-gray-600\" />\n                      {purchase?.purchase_order_number || 'PO '}\n                    </h3>\n                    {canReceiptCheck && canViewFinancialInfo && activeTab === 'done' && (\n                      <button\n                        onClick={async () => {\n                          if (!purchase) return\n                          const isCurrentlyChecked = purchase.is_utk_checked || false\n                          const newStatus = !isCurrentlyChecked\n                          \n                          const confirmMessage = newStatus\n                            ? `: ${purchase.purchase_order_number}\\n\\nUTK  ?`\n                            : `: ${purchase.purchase_order_number}\\n\\nUTK  ?`\n                          \n                          if (!window.confirm(confirmMessage)) return\n                          \n                          try {\n                            const supabase = createClient()\n                            const { error } = await supabase\n                              .from('purchase_requests')\n                              .update({ is_utk_checked: newStatus })\n                              .eq('id', purchase.id)\n                            \n                            if (error) {\n                              logger.error('UTK  DB  ', { error, purchaseId: purchase.id })\n                              toast.error('UTK     .')\n                              return\n                            }\n                            \n                            //     (   React  )\n                            setPurchase(prev => prev ? { \n                              ...prev, \n                              is_utk_checked: newStatus,\n                              updated_at: new Date().toISOString() //    \n                            } : null)\n                            \n                            //   \n                            if (purchase.id) {\n                              updatePurchaseInMemory(purchase.id, (prev) => ({\n                                ...prev,\n                                is_utk_checked: newStatus\n                              }))\n                            }\n                            \n                            toast.success(newStatus ? 'UTK  .' : 'UTK  .')\n                            \n                            await refreshModalData()\n                            const refreshResult = onRefresh?.(true, { silent: true })\n                            if (refreshResult instanceof Promise) {\n                              await refreshResult\n                            }\n                          } catch (error) {\n                            logger.error('UTK    ', error)\n                            toast.error('UTK     .')\n                          }\n                        }}\n                        className={`button-base text-xs px-2 py-1 flex items-center ${\n                          purchase?.is_utk_checked\n                            ? 'button-toggle-active bg-orange-500 hover:bg-orange-600 text-white'\n                            : 'button-toggle-inactive'\n                        }`}\n                        title={purchase?.is_utk_checked ? 'UTK  ' : 'UTK '}\n                      >\n                        <CheckCircle className=\"w-3 h-3 mr-1\" />\n                        UTK {purchase?.is_utk_checked ? '' : ''}\n                      </button>\n                    )}\n                  </div>\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\"> </span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.request_type || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, request_type: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.request_type || ''}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\"> </span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.payment_category || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, payment_category: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"//\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.payment_category || '-'}</p>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\"> </span>\n                      {isEditing ? (\n                        <DatePickerPopover\n                          onDateSelect={(date) => {\n                            setEditedPurchase(prev => prev ? {\n                              ...prev,\n                              delivery_request_date: formatDateInput(date, 'yyyy-MM-dd')\n                            } : null)\n                          }}\n                          placeholder=\"  \"\n                          align=\"start\"\n                          side=\"bottom\"\n                        >\n                          <Button\n                            variant=\"outline\"\n                            className=\"mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] justify-start text-left font-normal business-radius-input\"\n                          >\n                            <Calendar className=\"mr-1 h-3 w-3\" />\n                            {editedPurchase?.delivery_request_date ? \n                              formatDate(editedPurchase.delivery_request_date) : \n                              ' '\n                            }\n                          </Button>\n                        </DatePickerPopover>\n                      ) : (\n                        <p className=\"modal-subtitle\">{formatDate(purchase.delivery_request_date)}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label text-orange-500\"> </span>\n                      {isEditing ? (\n                        <DatePickerPopover\n                          onDateSelect={(date) => {\n                            setEditedPurchase(prev => prev ? {\n                              ...prev,\n                              revised_delivery_request_date: formatDateInput(date, 'yyyy-MM-dd')\n                            } : null)\n                          }}\n                          placeholder=\"  \"\n                          align=\"start\"\n                          side=\"bottom\"\n                        >\n                          <Button\n                            variant=\"outline\"\n                            className=\"mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] justify-start text-left font-normal business-radius-input\"\n                          >\n                            <Calendar className=\"mr-1 h-3 w-3\" />\n                            {editedPurchase?.revised_delivery_request_date ? \n                              formatDate(editedPurchase.revised_delivery_request_date) : \n                              ' '\n                            }\n                          </Button>\n                        </DatePickerPopover>\n                      ) : (\n                        <p className=\"modal-subtitle text-orange-700\">\n                          {purchase.revised_delivery_request_date ? formatDate(purchase.revised_delivery_request_date) : ''}\n                        </p>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/*   */}\n              <div className=\"bg-white rounded-lg p-2 sm:p-3 border border-gray-100 shadow-sm\">\n                <h3 className=\"modal-section-title mb-3 flex items-center\">\n                  <Building2 className=\"w-4 h-4 mr-2 text-gray-600\" />\n                   \n                </h3>\n                \n                <div className=\"space-y-2\">\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\"></span>\n                      {isEditing ? (\n                        <ReactSelect\n                          options={vendors.map(v => ({ \n                            value: v.id.toString(), \n                            label: v.vendor_name \n                          }))}\n                          value={editedPurchase?.vendor_id ? {\n                            value: editedPurchase.vendor_id.toString(),\n                            label: editedPurchase.vendor_name || vendors.find(v => v.id === editedPurchase.vendor_id)?.vendor_name || ''\n                          } : null}\n                          onChange={(option) => {\n                            logger.info('ReactSelect onChange:', { option })\n                            if (option) {\n                              const selectedVendor = vendors.find(v => v.id.toString() === option.value)\n                              logger.info('Selected vendor:', { selectedVendor })\n                              if (selectedVendor) {\n                                //    \n                                const supabase = createClient()\n                                supabase\n                                  .from('vendor_contacts')\n                                  .select('id, contact_name, contact_email, contact_phone, position')\n                                  .eq('vendor_id', selectedVendor.id)\n                                  .then(({ data: contactsData, error }: { data: any, error: any }) => {\n                                    if (error) {\n                                      logger.error('    :', error)\n                                      console.error('   :', error)\n                                    }\n                                    \n                                    logger.info('   -   :', { \n                                      vendor_id: selectedVendor.id,\n                                      vendor_name: selectedVendor.vendor_name,\n                                      contactsData,\n                                      contactsCount: contactsData?.length || 0\n                                    })\n                                    console.log('   -  :', contactsData)\n                                    \n                                    setEditedPurchase(prev => {\n                                      const updated = prev ? { \n                                        ...prev, \n                                        vendor_id: selectedVendor.id,\n                                        vendor_name: selectedVendor.vendor_name,\n                                        vendor: selectedVendor,\n                                        vendor_contacts: Array.isArray(contactsData) ? contactsData : [],\n                                        contact_id: undefined,  //     \n                                        contact_name: undefined  //      \n                                      } : null\n                                      logger.info('   - editedPurchase  :', { \n                                        vendor_id: selectedVendor.id,\n                                        vendor_name: selectedVendor.vendor_name,\n                                        contactsData,\n                                        updated_vendor_contacts: updated?.vendor_contacts,\n                                        updated_full: updated\n                                      })\n                                      console.log('   - editedPurchase :', updated)\n                                      return updated\n                                    })\n                                  })\n                              }\n                            } else {\n                              setEditedPurchase(prev => prev ? { \n                                ...prev, \n                                vendor_id: undefined,\n                                vendor_name: '',\n                                vendor: undefined,\n                                vendor_contacts: [],\n                                contact_id: undefined,  //     \n                                contact_name: undefined  //      \n                              } : null)\n                            }\n                          }}\n                          placeholder=\" \"\n                          isClearable\n                          isSearchable\n                          menuPortalTarget={document.body}\n                          styles={{\n                            control: (base) => ({\n                              ...base,\n                              minHeight: '20px',\n                              height: '20px',\n                              fontSize: '10px',\n                              borderRadius: '8px', // rounded-lg  \n                              borderColor: '#e5e7eb', // border-gray-200  \n                              borderWidth: '1px',\n                              backgroundColor: '#ffffff',\n                              boxShadow: 'none',\n                              paddingLeft: '6px', // px-1.5\n                              paddingRight: '6px', // px-1.5\n                              '&:hover': {\n                                borderColor: '#e5e7eb', // hover    \n                              },\n                              '&:focus-within': {\n                                borderColor: '#60a5fa', // focus:border-blue-400\n                                boxShadow: 'none',\n                                outline: 'none',\n                              },\n                            }),\n                            valueContainer: (base) => ({\n                              ...base,\n                              height: '18px', // Input   \n                              padding: '0 2px', //   \n                              margin: '0',\n                            }),\n                            input: (base) => ({\n                              ...base,\n                              margin: '0',\n                              padding: '0',\n                              fontSize: '10px',\n                            }),\n                            indicatorsContainer: (base) => ({\n                              ...base,\n                              height: '18px',\n                              padding: '0',\n                            }),\n                            indicatorSeparator: () => ({\n                              display: 'none',\n                            }),\n                            dropdownIndicator: (base) => ({\n                              ...base,\n                              padding: '0 2px',\n                              svg: {\n                                width: '12px',\n                                height: '12px',\n                              },\n                            }),\n                            clearIndicator: (base) => ({\n                              ...base,\n                              padding: '0 2px',\n                              svg: {\n                                width: '12px',\n                                height: '12px',\n                              },\n                            }),\n                            option: (base) => ({\n                              ...base,\n                              fontSize: '10px',\n                              padding: '4px 8px',\n                            }),\n                            menuPortal: (base) => ({\n                              ...base,\n                              zIndex: 9999,\n                            }),\n                          }}\n                          classNamePrefix=\"vendor-select\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.vendor?.vendor_name || '-'}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\"> </span>\n                      {isEditing ? (\n                        editedPurchase?.vendor_id ? (\n                          <ReactSelect\n                            options={(() => {\n                              const contacts = Array.isArray(editedPurchase.vendor_contacts) ? editedPurchase.vendor_contacts : []\n                              //  : id    ( ID  )\n                              const uniqueContacts = contacts.filter((contact, index, arr) => \n                                arr.findIndex(c => c.id === contact.id) === index\n                              )\n                              //  contact_name    (   ID  )\n                              const finalUniqueContacts = uniqueContacts.filter((contact, index, arr) => \n                                arr.findIndex(c => c.contact_name === contact.contact_name) === index\n                              )\n                              const options = finalUniqueContacts.map(c => ({\n                                value: c.id.toString(),\n                                label: c.contact_name || ''\n                              })) || []\n                              logger.info('   :', {\n                                vendor_id: editedPurchase.vendor_id,\n                                vendor_contacts_raw: editedPurchase.vendor_contacts,\n                                vendor_contacts_count: contacts.length,\n                                unique_by_id_count: uniqueContacts.length,\n                                final_unique_count: finalUniqueContacts.length,\n                                options\n                              })\n                              console.log('   :', options)\n                              return options\n                            })()}\n                            value={(() => {\n                              const contacts = Array.isArray(editedPurchase.vendor_contacts) ? editedPurchase.vendor_contacts : []\n                              const firstContact = contacts[0]\n                              return firstContact?.id ? {\n                                value: firstContact.id.toString(),\n                                label: firstContact.contact_name || ''\n                              } : null\n                            })()}\n                            onChange={(option) => {\n                              logger.info('   :', { option })\n                              if (option) {\n                                const contacts = Array.isArray(editedPurchase.vendor_contacts) ? editedPurchase.vendor_contacts : []\n                                const selectedContact = contacts.find(c => c.id.toString() === option.value)\n                                if (selectedContact) {\n                                  setEditedPurchase(prev => prev ? {\n                                    ...prev,\n                                    contact_id: selectedContact.id,\n                                    contact_name: selectedContact.contact_name,\n                                    vendor_contacts: [selectedContact, ...contacts.filter(c => c.id !== selectedContact.id)]\n                                  } : null)\n                                }\n                              } else {\n                                setEditedPurchase(prev => prev ? {\n                                  ...prev,\n                                  contact_id: undefined,\n                                  contact_name: undefined,\n                                  vendor_contacts: Array.isArray(editedPurchase.vendor_contacts) ? editedPurchase.vendor_contacts : []\n                                } : null)\n                              }\n                            }}\n                            placeholder=\" \"\n                            isClearable\n                            isSearchable\n                            noOptionsMessage={() => \" \"}\n                            menuPortalTarget={document.body}\n                            styles={{\n                              control: (base) => ({\n                                ...base,\n                                minHeight: '20px',\n                                height: '20px',\n                                fontSize: '10px',\n                                borderRadius: '8px', // rounded-lg  \n                                borderColor: '#e5e7eb', // border-gray-200  \n                                borderWidth: '1px',\n                                backgroundColor: '#ffffff',\n                                boxShadow: 'none',\n                                paddingLeft: '6px', // px-1.5\n                                paddingRight: '6px', // px-1.5\n                                '&:hover': {\n                                  borderColor: '#e5e7eb', // hover    \n                                },\n                                '&:focus-within': {\n                                  borderColor: '#60a5fa', // focus:border-blue-400\n                                  boxShadow: 'none',\n                                  outline: 'none',\n                                },\n                              }),\n                              valueContainer: (base) => ({\n                                ...base,\n                                height: '18px', // Input   \n                                padding: '0 2px', //   \n                                margin: '0',\n                              }),\n                              input: (base) => ({\n                                ...base,\n                                margin: '0',\n                                padding: '0',\n                                fontSize: '10px',\n                              }),\n                              indicatorsContainer: (base) => ({\n                                ...base,\n                                height: '18px',\n                                padding: '0',\n                              }),\n                              indicatorSeparator: () => ({\n                                display: 'none',\n                              }),\n                              dropdownIndicator: (base) => ({\n                                ...base,\n                                padding: '0 2px',\n                                svg: {\n                                  width: '12px',\n                                  height: '12px',\n                                },\n                              }),\n                              clearIndicator: (base) => ({\n                                ...base,\n                                padding: '0 2px',\n                                svg: {\n                                  width: '12px',\n                                  height: '12px',\n                                },\n                              }),\n                              option: (base) => ({\n                                ...base,\n                                fontSize: '10px',\n                                padding: '4px 8px',\n                              }),\n                              menuPortal: (base) => ({\n                                ...base,\n                                zIndex: 9999,\n                              }),\n                            }}\n                            classNamePrefix=\"contact-select\"\n                          />\n                        ) : (\n                          <Input\n                            value=\"\"\n                            disabled\n                            className=\"mt-1 rounded-lg border-gray-200 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                            placeholder=\"  \"\n                          />\n                        )\n                      ) : (\n                        <p className=\"modal-value\">{(() => {\n                          // : 1. contact_name , 2. vendor_contacts    , 3. '-'\n                          const contacts = Array.isArray(purchase.vendor_contacts) ? purchase.vendor_contacts : []\n                          const contactName = (purchase as any).contact_name ||\n                                            contacts[0]?.contact_name || \n                                            '-'\n                          logger.info(' vendor_contacts display :', { \n                            purchase_id: purchase?.id,\n                            vendor_id: purchase?.vendor_id,\n                            contact_id: purchase?.contact_id,\n                            vendor_contacts: purchase.vendor_contacts,\n                            purchase_contact_name: purchase.contact_name,\n                            contactName,\n                            purchase_full: purchase\n                          })\n                          console.log(' vendor_contacts display :', { \n                            purchase_id: purchase?.id,\n                            vendor_id: purchase?.vendor_id,\n                            contact_id: purchase?.contact_id,\n                            vendor_contacts: purchase.vendor_contacts,\n                            purchase_contact_name: purchase.contact_name,\n                            contactName\n                          })\n                          return contactName\n                        })()}</p>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">PJ</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.project_vendor || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, project_vendor: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.project_vendor || '-'}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">Item</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.project_item || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, project_item: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"\"\n                        />\n                      ) : (\n                        <p className=\"modal-subtitle\">{purchase.project_item || '-'}</p>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\"></span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.sales_order_number || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, sales_order_number: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"\"\n                        />\n                      ) : (\n                        <p className=\"modal-subtitle\">{purchase.sales_order_number || '-'}</p>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n            </div>\n\n            {/* Right Column - Items List (Fit Width) */}\n            <div className=\"lg:w-fit lg:min-w-0 relative overflow-visible\">\n              \n              <div className=\"bg-white rounded-lg border border-gray-100 shadow-sm\">\n                <div className=\"p-2 sm:p-3 bg-gray-50 border-b border-gray-100 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-0\">\n                  <h3 className=\"modal-section-title flex items-center\">\n                    <Package className=\"w-4 h-4 mr-2 text-gray-600\" />\n                     \n                    <span className=\"ml-2 badge-stats bg-gray-500 text-white\">\n                      {currentItems?.length || 0}\n                    </span>\n                  </h3>\n                  {!isEditing && (\n                    <>\n                      {activeTab === 'purchase' && canPurchase && (\n                        <Button\n                          size=\"sm\"\n                          onClick={handleCompleteAllPayment}\n                          className=\"button-base bg-orange-500 hover:bg-orange-600 text-white\"\n                        >\n                          <CreditCard className=\"w-3 h-3 mr-1\" />\n                           \n                        </Button>\n                      )}\n                      {activeTab === 'receipt' && canReceiveItems && (\n                        <DateQuantityPickerPopover\n                          onConfirm={handleCompleteAllReceipt}\n                          placeholder=\" \"\n                          align=\"end\"\n                          side=\"bottom\"\n                          hideQuantityInput={true}\n                          quantityInfoText=\"   \"\n                        >\n                          <Button\n                            size=\"sm\"\n                            className=\"button-base button-action-primary\"\n                          >\n                            <Truck className=\"w-3 h-3 mr-1\" />\n                             \n                          </Button>\n                        </DateQuantityPickerPopover>\n                      )}\n                      {activeTab === 'done' && canReceiptCheck && canViewFinancialInfo && purchase.payment_category === '' && (\n                        <div className=\"flex items-center gap-2\">\n                          <DatePickerPopover\n                            onDateSelect={handleCompleteAllStatement}\n                            placeholder=\"   \"\n                            align=\"end\"\n                            side=\"bottom\"\n                          >\n                            <Button\n                              size=\"sm\"\n                              className=\"button-base button-action-primary\"\n                            >\n                              <FileText className=\"w-3 h-3 mr-1\" />\n                               \n                            </Button>\n                          </DatePickerPopover>\n                          {purchase.payment_category === '' && (\n                            <DateAmountPickerPopover\n                              onConfirm={handleBulkExpenditure}\n                              placeholder=\"    \"\n                              align=\"end\"\n                              side=\"bottom\"\n                            >\n                              <Button\n                                size=\"sm\"\n                                className=\"button-base button-action-primary\"\n                              >\n                                <DollarSign className=\"w-3 h-3 mr-1\" />\n                                \n                              </Button>\n                            </DateAmountPickerPopover>\n                          )}\n                        </div>\n                      )}\n                    </>\n                  )}\n                </div>\n                \n                {/* Mobile Table Header */}\n                <div className=\"block sm:hidden bg-gray-50 px-2 py-1 border-b border-gray-100\">\n                  <div className=\"text-xs font-medium text-gray-600\">  ( )</div>\n                </div>\n                \n                {/* Items List with Header Inside Scrollable Container */}\n                <div className=\"max-h-[50vh] sm:max-h-[40vh] overflow-auto\">\n                  <div className=\"w-fit\">\n                    {/* Items Table Header - Sticky inside scroll container */}\n                    <div className=\"bg-gray-50 px-2 sm:px-3 py-1 border-b border-gray-100 sticky top-0 z-10 w-fit\">\n                      <div \n                        ref={headerRowRef}\n                         className=\"hidden sm:grid gap-1 modal-label w-fit\"\n                        style={{\n                          gridTemplateColumns: getGridTemplateColumns()\n                        }}\n                      >\n                        <div></div>\n                        <div></div>\n                        <div className=\"text-center\">\n                          {(activeTab === 'receipt' || activeTab === 'done') && !isEditing ? (\n                            <div className=\"flex flex-col items-center leading-tight\">\n                              <div className=\"text-[9px]\">/</div>\n                              <div className=\"text-[10px]\"></div>\n                            </div>\n                          ) : (\n                            ''\n                          )}\n                        </div>\n                        <div className=\"text-right\"></div>\n                        <div className=\"text-right\"></div>\n                        {purchase.payment_category === '' && (\n                          <div className=\"text-right\"></div>\n                        )}\n                        <div className=\"text-center\"></div>\n                        {isEditing ? (\n                          <>\n                            <div className=\"text-center\"></div>\n                            {activeTab === 'receipt' && (\n                              <>\n                                <div className=\"text-center\"></div>\n                              </>\n                            )}\n                            {activeTab === 'done' && (\n                              <>\n                                {purchase.payment_category === '' && (\n                                  <>\n                                    <div className=\"text-center\"> </div>\n                                    <div className=\"text-center\"> </div>\n                                    <div className=\"text-center\"></div>\n                                  </>\n                                )}\n                              </>\n                            )}\n                          </>\n                        ) : (\n                          <>\n                            <div className=\"text-center\">\n                              {activeTab === 'purchase'\n                                ? ''\n                                : (activeTab === 'receipt' || activeTab === 'done')\n                                ? ''\n                                : ''}\n                            </div>\n                            {activeTab === 'done' && (\n                              <>\n                                {purchase.payment_category === '' && (\n                                  <>\n                                    <div className=\"text-center\"> </div>\n                                    <div className=\"text-center\"> </div>\n                                    <div className=\"text-center\"></div>\n                                  </>\n                                )}\n                              </>\n                            )}\n                            {activeTab === 'receipt' && (\n                              <>\n                                <div className=\"text-center\"></div>\n                              </>\n                            )}\n                          </>\n                        )}\n                      </div>\n                    </div>\n                    <div className=\"divide-y divide-gray-100 overflow-visible w-fit\">\n                      {(isEditing ? editedItems : currentItems)?.map((item, index) => (\n                        <div key={index} className=\"px-2 sm:px-3 py-1 border-b border-gray-50 hover:bg-gray-50/50 relative overflow-visible\">\n                          {/* Desktop Layout */}\n                          <div className={`hidden sm:grid items-center gap-1 overflow-visible w-fit`} style={{\n                            gridTemplateColumns: getGridTemplateColumns()\n                          }}>\n                            {/*  */}\n                            <div className=\"min-w-0 relative overflow-visible flex items-center\">\n                              {isEditing ? (\n                                <Input\n                                  value={item.item_name}\n                                  onChange={(e) => handleItemChange(index, 'item_name', e.target.value)}\n                                  onFocus={() => setFocusedInput(`item_name_${index}`)}\n                                  onBlur={() => setFocusedInput(null)}\n                                  className={`modal-label border-gray-200 rounded-lg w-full !px-1.5 !py-0.5 !text-[10px] focus:border-blue-400 transition-all duration-200 ${\n                                    focusedInput === `item_name_${index}` \n                                      ? '!h-auto !min-h-[20px] !absolute !z-[9999] !bg-white !shadow-lg !left-0 !right-0 !-translate-y-1/2 !top-1/2 !whitespace-normal' \n                                      : '!h-5 !truncate'\n                                  }`}\n                                  placeholder=\"\"\n                                  disabled={canEditLimited && !canEditAll}  // lead buyer   \n                                />\n                              ) : (\n                                <div \n                                  className=\"modal-value\" \n                                  style={{\n                                    whiteSpace: 'normal',\n                                    wordBreak: 'break-all', //    ( )\n                                    overflowWrap: 'break-word',\n                                    hyphens: 'none', //    \n                                    WebkitHyphens: 'none',\n                                    MozHyphens: 'none',\n                                    msHyphens: 'none',\n                                    lineHeight: '1.4',\n                                    maxHeight: '2.8em', //  2 \n                                    overflow: 'hidden',\n                                    display: '-webkit-box',\n                                    WebkitLineClamp: 2,\n                                    WebkitBoxOrient: 'vertical'\n                                  }}\n                                  title={item.item_name || ' '}\n                                >\n                                  {item.item_name || ' '}\n                                </div>\n                              )}\n                            </div>\n                            \n                            {/*  */}\n                            <div className=\"min-w-0 relative overflow-visible flex items-center\" style={{ width: '200px', maxWidth: '200px', minWidth: '200px' }}>\n                              {isEditing ? (\n                                <Input\n                                  value={item.specification}\n                                  onChange={(e) => handleItemChange(index, 'specification', e.target.value)}\n                                  onFocus={() => setFocusedInput(`specification_${index}`)}\n                                  onBlur={() => setFocusedInput(null)}\n                                  className={`modal-label border-gray-200 rounded-lg w-full !px-1.5 !py-0.5 !text-[10px] focus:border-blue-400 transition-all duration-200 ${\n                                    focusedInput === `specification_${index}` \n                                      ? '!h-auto !min-h-[20px] !absolute !z-[9999] !bg-white !shadow-lg !left-1/2 !-translate-x-1/2 !-translate-y-1/2 !top-1/2 !whitespace-normal !w-[300px]' \n                                      : '!h-5 !truncate'\n                                  }`}\n                                  placeholder=\"\"\n                                  disabled={canEditLimited && !canEditAll}  // lead buyer   \n                                />\n                              ) : (\n                                <div \n                                  className=\"text-[11px] text-gray-600 font-medium\" \n                                  style={{\n                                    whiteSpace: 'normal',\n                                    wordBreak: 'break-all', //    ( )\n                                    overflowWrap: 'break-word',\n                                    hyphens: 'none', //    \n                                    WebkitHyphens: 'none', // Safari \n                                    MozHyphens: 'none', // Firefox \n                                    msHyphens: 'none', // IE \n                                    lineHeight: '1.4',\n                                    maxHeight: '2.8em', //  2 \n                                    overflow: 'hidden',\n                                    display: '-webkit-box',\n                                    WebkitLineClamp: 2, //  2 \n                                    WebkitBoxOrient: 'vertical'\n                                  }}\n                                  title={item.specification || '-'}\n                                >\n                                  {item.specification || '-'}\n                                </div>\n                              )}\n                            </div>\n                            \n                            {/*  */}\n                            <div className=\"text-center min-w-0 flex items-center justify-center\">\n                              {isEditing ? (\n                                (activeTab === 'receipt' || activeTab === 'done') ? (\n                                  <div className=\"flex flex-col items-center gap-0.5 w-full\">\n                                    <Input\n                                      type=\"number\"\n                                      value={item.quantity}\n                                      onChange={(e) => handleItemChange(index, 'quantity', Number(e.target.value))}\n                                      className=\"border-gray-200 rounded-lg text-center w-full !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400\"\n                                      placeholder=\"\"\n                                      max=\"99999\"\n                                    />\n                                    <div className=\"flex items-center gap-0.5 w-full\">\n                                      <span className=\"text-[9px] text-gray-500\">/</span>\n                                      <Input\n                                        type=\"number\"\n                                        value={item.received_quantity ?? ''}\n                                        onChange={(e) => handleItemChange(index, 'received_quantity', e.target.value ? Number(e.target.value) : null)}\n                                        className=\"border-gray-200 rounded-lg text-center flex-1 !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400\"\n                                        placeholder=\"\"\n                                        max=\"99999\"\n                                      />\n                                    </div>\n                                  </div>\n                                ) : (\n                                  <Input\n                                    type=\"number\"\n                                    value={item.quantity}\n                                    onChange={(e) => handleItemChange(index, 'quantity', Number(e.target.value))}\n                                    className=\"border-gray-200 rounded-lg text-center w-full !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400\"\n                                    placeholder=\"\"\n                                    max=\"99999\"\n                                  />\n                                )\n                              ) : (\n                                (activeTab === 'receipt' || activeTab === 'done') ? (\n                                  (() => {\n                                    const quantity = item.quantity || 0\n                                    const receivedQuantity = item.received_quantity ?? 0\n                                    const shouldWrap = quantity >= 100 || receivedQuantity >= 100\n                                    const hasReceived = receivedQuantity > 0\n                                    \n                                    if (shouldWrap) {\n                                      return (\n                                        <div className=\"flex flex-col items-center leading-tight\">\n                                          <div className={`modal-subtitle ${hasReceived ? 'text-gray-400' : ''}`}>{quantity}</div>\n                                          <div className={`modal-subtitle ${hasReceived ? '' : 'text-gray-400'}`}>/{receivedQuantity}</div>\n                                        </div>\n                                      )\n                                    } else {\n                                      return (\n                                        <span className=\"modal-subtitle\">\n                                          <span className={hasReceived ? 'text-gray-400' : ''}>{quantity}</span>\n                                          <span className={hasReceived ? '' : 'text-gray-400'}>/{receivedQuantity}</span>\n                                        </span>\n                                      )\n                                    }\n                                  })()\n                                ) : (\n                                  <span className=\"modal-subtitle\">{item.quantity || 0}</span>\n                                )\n                              )}\n                            </div>\n                            \n                            {/*  */}\n                            <div className=\"text-right min-w-0 flex items-center justify-end\">\n                              {isEditing ? (\n                                <Input\n                                  type=\"number\"\n                                  value={item.unit_price_value}\n                                  onChange={(e) => handleItemChange(index, 'unit_price_value', Number(e.target.value))}\n                                  className=\"border-gray-200 rounded-lg text-right w-full !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400\"\n                                  placeholder=\"\"\n                                  max=\"100000000000\"\n                                />\n                              ) : (\n                                <span className=\"modal-subtitle\">\n                                  {activeTab === 'done' && !canViewFinancialInfo \n                                    ? '-' \n                                    : `${formatCurrency(item.unit_price_value)}`}\n                                </span>\n                              )}\n                            </div>\n                            \n                            {/*  (,  ) */}\n                            <div className=\"text-right min-w-0 flex items-center justify-end\">\n                              <span className={isEditing ? \"modal-subtitle\" : \"modal-value\"}>\n                                {activeTab === 'done' && !canViewFinancialInfo \n                                  ? '-' \n                                  : `${formatCurrency(item.amount_value || 0)}`}\n                              </span>\n                            </div>\n                            \n                            {/*  -       */}\n                            {purchase?.payment_category === '' && (\n                              <div className=\"text-right min-w-0 flex items-center justify-end\">\n                                <span className={isEditing ? \"modal-subtitle\" : \"modal-value\"}>\n                                  {activeTab === 'done' && !canViewFinancialInfo \n                                    ? '-' \n                                    : `${formatCurrency(item.tax_amount_value || 0)}`}\n                                </span>\n                              </div>\n                            )}\n                            \n                            {/*  */}\n                            <div className=\"min-w-0 flex justify-center items-center text-center relative overflow-visible\" style={{ width: '150px', maxWidth: '150px', minWidth: '150px' }}>\n                              {isEditing ? (\n                                <Input\n                                  value={item.remark || ''}\n                                  disabled={canEditLimited && !canEditAll}  // lead buyer   \n                                  onChange={(e) => handleItemChange(index, 'remark', e.target.value)}\n                                  onFocus={() => setFocusedInput(`remark_${index}`)}\n                                  onBlur={() => setFocusedInput(null)}\n                                  className={`modal-label border-gray-200 rounded-lg text-center w-full !px-1.5 !py-0.5 !text-[10px] focus:border-blue-400 transition-all duration-200 ${\n                                    focusedInput === `remark_${index}` \n                                      ? '!h-auto !min-h-[20px] !absolute !z-[9999] !bg-white !shadow-lg !left-0 !right-0 !-translate-y-1/2 !top-1/2 !whitespace-normal !text-left' \n                                      : '!h-5 !truncate'\n                                  }`}\n                                  placeholder=\"\"\n                                />\n                              ) : (\n                                <div \n                                  className=\"text-[11px] text-gray-600 font-medium\"\n                                  style={{\n                                    width: '150px',\n                                    maxWidth: '150px',\n                                    minWidth: '150px',\n                                    boxSizing: 'border-box',\n                                    whiteSpace: 'normal',\n                                    wordBreak: 'break-all',\n                                    overflowWrap: 'break-word',\n                                    hyphens: 'none',\n                                    WebkitHyphens: 'none',\n                                    MozHyphens: 'none',\n                                    msHyphens: 'none',\n                                    lineHeight: '1.4',\n                                    maxHeight: '2.8em',\n                                    overflow: 'hidden',\n                                    display: '-webkit-box',\n                                    WebkitLineClamp: 2,\n                                    WebkitBoxOrient: 'vertical'\n                                  }}\n                                  title={item.remark || '-'}\n                                >\n                                  {item.remark || '-'}\n                                </div>\n                              )}\n                            </div>\n                            \n                            {/* / -   */}\n                            {activeTab !== 'pending' && (\n                              <div className=\"text-center flex justify-center items-center\">\n                                {isEditing ? (\n                                  <Button\n                                    size=\"sm\"\n                                    variant=\"ghost\"\n                                    onClick={() => handleRemoveItem(index)}\n                                    className=\"text-red-600 hover:bg-red-50 rounded-lg p-1 h-6 w-6\"\n                                  >\n                                    <Trash2 className=\"w-3 h-3\" />\n                                  </Button>\n                                ) : (\n                                  <>\n                                    {/*     */}\n                                    {activeTab === 'purchase' && (\n                                    <div className=\"flex justify-center\">\n                                      {canPurchase ? (\n                                        <button\n                                          onClick={() => handlePaymentToggle(item.id, !item.is_payment_completed)}\n                                          className={`${\n                                            item.is_payment_completed\n                                              ? 'button-toggle-active bg-orange-500 hover:bg-orange-600 text-white'\n                                              : 'button-toggle-inactive'\n                                          }`}\n                                        >\n                                          {item.is_payment_completed ? '' : ''}\n                                        </button>\n                                      ) : (\n                                        <span className={`${\n                                          item.is_payment_completed \n                                            ? 'button-toggle-active bg-orange-500 text-white' \n                                            : 'button-waiting-inactive'\n                                        }`}>\n                                          {item.is_payment_completed ? '' : ''}\n                                        </span>\n                                      )}\n                                    </div>\n                                  )}\n                                  \n                                  {/*     */}\n                                  {activeTab === 'receipt' && (\n                                    <div className=\"flex justify-center\">\n                                      {canReceiveItems ? (\n                                        actualReceivedAction.isCompleted(item) ? (\n                                          <button\n                                            onClick={() => {\n                                              actualReceivedAction.handleCancel(item.id, {\n                                                item_name: item.item_name,\n                                                specification: item.specification,\n                                                quantity: item.quantity,\n                                                unit_price_value: item.unit_price_value,\n                                                amount_value: item.amount_value,\n                                                remark: item.remark\n                                              })\n                                            }}\n                                            className=\"button-action-primary\"\n                                          >\n                                            {actualReceivedAction.config.completedText}\n                                          </button>\n                                        ) : (\n                                          <DateQuantityPickerPopover\n                                            onConfirm={(date, quantity) => {\n                                              handleItemReceiptToggle(item.id, date, quantity)\n                                            }}\n                                            placeholder=\"  \"\n                                            align=\"center\"\n                                            side=\"bottom\"\n                                            defaultQuantity={item.received_quantity ?? undefined}\n                                            maxQuantity={item.quantity}\n                                          >\n                                            <button className=\"button-toggle-inactive\">\n                                              {actualReceivedAction.config.waitingText}\n                                            </button>\n                                          </DateQuantityPickerPopover>\n                                        )\n                                      ) : (\n                                        <span className={`${\n                                          actualReceivedAction.isCompleted(item)\n                                            ? 'button-action-primary' \n                                            : 'button-waiting-inactive'\n                                        }`}>\n                                          {actualReceivedAction.isCompleted(item) ? actualReceivedAction.config.completedText : actualReceivedAction.config.waitingText}\n                                        </span>\n                                      )}\n                                    </div>\n                                  )}\n                                  \n                                  {/*       ( ) */}\n                                  {activeTab === 'done' && (\n                                    <div className=\"flex justify-center\">\n                                      <span className={`button-base ${\n                                        actualReceivedAction.isCompleted(item)\n                                          ? 'bg-blue-500 hover:bg-blue-600 text-white' \n                                          : 'border border-gray-300 text-gray-600 bg-white hover:bg-gray-50'\n                                      }`}>\n                                        {actualReceivedAction.isCompleted(item) ? '' : ''}\n                                      </span>\n                                    </div>\n                                  )}\n                                  \n                                  {/*      */}\n                                  {activeTab !== 'purchase' && activeTab !== 'receipt' && activeTab !== 'done' && (\n                                    <div className=\"flex justify-center\">\n                                      <span className=\"badge-text\">-</span>\n                                    </div>\n                                  )}\n                                </>\n                              )}\n                              </div>\n                            )}\n                            \n                            {/*    -    (  ) */}\n                            {activeTab === 'receipt' && (\n                              <div className=\"text-center flex justify-center items-center pl-2\">\n                                {actualReceivedAction.getCompletedDate(item) ? (\n                                  <div className=\"modal-subtitle text-green-700\">\n                                    {new Date(actualReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                                      year: 'numeric',\n                                      month: '2-digit',\n                                      day: '2-digit'\n                                    })}\n                                  </div>\n                                ) : (\n                                  <span className=\"modal-subtitle text-gray-400\">-</span>\n                                )}\n                              </div>\n                            )}\n\n                            {/*   -      */}\n                            {activeTab === 'done' && purchase.payment_category === '' && (\n                              <div className=\"text-center flex justify-center items-center\">\n                                {canReceiptCheck ? (\n                                  statementReceivedAction.isCompleted(item) ? (\n                                    <button\n                                      onClick={() => {\n                                        statementReceivedAction.handleCancel(item.id, {\n                                          item_name: item.item_name,\n                                          specification: item.specification,\n                                          quantity: item.quantity,\n                                          unit_price_value: item.unit_price_value,\n                                          amount_value: item.amount_value,\n                                          remark: item.remark\n                                        })\n                                      }}\n                                      className=\"button-action-primary hover:bg-green-600\"\n                                      title=\"   \"\n                                    >\n                                      {statementReceivedAction.config.completedText}\n                                    </button>\n                                  ) : (\n                                    <DatePickerPopover\n                                      onDateSelect={(date) => {\n                                        statementReceivedAction.handleConfirm(item.id, date, {\n                                          item_name: item.item_name,\n                                          specification: item.specification,\n                                          quantity: item.quantity,\n                                          unit_price_value: item.unit_price_value,\n                                          amount_value: item.amount_value,\n                                          remark: item.remark\n                                        })\n                                      }}\n                                      placeholder=\"  \"\n                                      align=\"center\"\n                                      side=\"bottom\"\n                                    >\n                                      <button \n                                        className=\"button-toggle-inactive\"\n                                        onClick={() => {}}\n                                      >\n                                        {statementReceivedAction.config.waitingText}\n                                      </button>\n                                    </DatePickerPopover>\n                                  )\n                                ) : (\n                                  <span className={`${\n                                    statementReceivedAction.isCompleted(item)\n                                      ? 'button-action-primary' \n                                      : 'button-waiting-inactive'\n                                  }`}>\n                                    {statementReceivedAction.isCompleted(item) ? statementReceivedAction.config.completedText : statementReceivedAction.config.waitingText}\n                                  </span>\n                                )}\n                              </div>\n                            )}\n\n                            {/*   -      */}\n                            {activeTab === 'done' && purchase.payment_category === '' && (\n                              <div className=\"text-center flex justify-center items-center\">\n                                {statementReceivedAction.getCompletedDate(item) ? (\n                                  <div className=\"modal-subtitle text-blue-700\">\n                                    {new Date(statementReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                                      year: 'numeric',\n                                      month: '2-digit',\n                                      day: '2-digit'\n                                    })}\n                                  </div>\n                                ) : (\n                                  <span className=\"modal-subtitle text-gray-400\">-</span>\n                                )}\n                              </div>\n                            )}\n\n                            {/*  -      */}\n                            {activeTab === 'done' && purchase.payment_category === '' && (\n                              <div className=\"text-center flex justify-center items-center\">\n                                {(() => {\n                                  const hasExpenditure = item.expenditure_date && \n                                                        item.expenditure_amount !== null && \n                                                        item.expenditure_amount !== undefined\n                                  \n                                  if (canReceiptCheck) {\n                                    return hasExpenditure ? (\n                                      <div className=\"w-full px-1 leading-none\">\n                                        <div className=\"text-blue-700 text-[9px] leading-[1.1] font-normal\">\n                                          {(() => {\n                                            const date = new Date(item.expenditure_date)\n                                            const year = date.getFullYear().toString().slice(-2)\n                                            const month = (date.getMonth() + 1).toString().padStart(2, '0')\n                                            const day = date.getDate().toString().padStart(2, '0')\n                                            return `${year}.${month}.${day}`\n                                          })()}\n                                        </div>\n                                        <div className=\"text-gray-700 text-[9px] leading-[1.1] font-normal\">\n                                          {!canViewFinancialInfo \n                                            ? '-' \n                                            : `${Number(item.expenditure_amount).toLocaleString()}`}\n                                        </div>\n                                      </div>\n                                    ) : (\n                                      <DateAmountPickerPopover\n                                        onConfirm={(date, amount) => handleItemExpenditure(item.id, date, amount)}\n                                        placeholder=\"   \"\n                                        align=\"center\"\n                                        side=\"bottom\"\n                                      >\n                                        <button className=\"button-toggle-inactive\">\n                                          \n                                        </button>\n                                      </DateAmountPickerPopover>\n                                    )\n                                  } else {\n                                    return hasExpenditure ? (\n                                      <div className=\"w-full px-1 leading-none\">\n                                        <div className=\"text-blue-700 text-[9px] leading-[1.1] font-normal\">\n                                          {(() => {\n                                            const date = new Date(item.expenditure_date)\n                                            const year = date.getFullYear().toString().slice(-2)\n                                            const month = (date.getMonth() + 1).toString().padStart(2, '0')\n                                            const day = date.getDate().toString().padStart(2, '0')\n                                            return `${year}.${month}.${day}`\n                                          })()}\n                                        </div>\n                                        <div className=\"text-gray-700 text-[9px] leading-[1.1] font-normal\">\n                                          {!canViewFinancialInfo \n                                            ? '-' \n                                            : `${Number(item.expenditure_amount).toLocaleString()}`}\n                                        </div>\n                                      </div>\n                                    ) : (\n                                      <span className=\"modal-subtitle text-gray-400\">-</span>\n                                    )\n                                  }\n                                })()}\n                              </div>\n                            )}\n\n                          </div>\n                          \n                          {/* Mobile Layout */}\n                          <div className=\"block sm:hidden space-y-2\">\n                            <div className=\"flex justify-between items-start\">\n                              <div className=\"flex-1 min-w-0 relative\">\n                                {isEditing ? (\n                                  <Input\n                                    value={item.item_name}\n                                    onChange={(e) => handleItemChange(index, 'item_name', e.target.value)}\n                                    onFocus={() => setFocusedInput(`m_item_name_${index}`)}\n                                    onBlur={() => setFocusedInput(null)}\n                                    className={`modal-label border-gray-200 rounded-lg w-full !px-1.5 !py-0.5 !text-[10px] focus:border-blue-400 transition-all duration-200 ${\n                                      focusedInput === `m_item_name_${index}` \n                                        ? '!h-auto !min-h-[20px] !absolute !z-[9999] !bg-white !shadow-lg !left-0 !right-0 !-translate-y-1/2 !top-1/2 !whitespace-normal' \n                                        : '!h-5 !truncate'\n                                    }`}\n                                    placeholder=\"\"\n                                    disabled={canEditLimited && !canEditAll}  // lead buyer   \n                                  />\n                                ) : (\n                                  <div className=\"modal-value font-medium\">{item.item_name || ' '}</div>\n                                )}\n                                {isEditing ? (\n                                  <Input\n                                    value={item.specification}\n                                    onChange={(e) => handleItemChange(index, 'specification', e.target.value)}\n                                    onFocus={() => setFocusedInput(`m_specification_${index}`)}\n                                    onBlur={() => setFocusedInput(null)}\n                                    className={`modal-label border-gray-200 rounded-lg mt-1 w-full !px-1.5 !py-0.5 !text-[10px] focus:border-blue-400 transition-all duration-200 ${\n                                      focusedInput === `m_specification_${index}` \n                                        ? '!h-auto !min-h-[20px] !absolute !z-[9999] !bg-white !shadow-lg !left-0 !right-0 !-translate-y-1/2 !top-1/2 !whitespace-normal !w-full' \n                                        : '!h-5 !truncate'\n                                    }`}\n                                    placeholder=\"\"\n                                    disabled={canEditLimited && !canEditAll}  // lead buyer   \n                                  />\n                                ) : (\n                                  <div className=\"modal-subtitle text-gray-500\">{item.specification || '-'}</div>\n                                )}\n                              </div>\n                              <div className=\"ml-3 text-right flex-shrink-0\">\n                                <div className={`${isEditing ? \"modal-subtitle\" : \"modal-value\"} font-semibold`}>{formatCurrency(item.amount_value || 0)}</div>\n                              </div>\n                            </div>\n                            \n                            <div className=\"grid grid-cols-3 gap-2 text-sm\">\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">:</span>\n                                {isEditing ? (\n                                  <Input\n                                    type=\"number\"\n                                    value={item.quantity}\n                                    onChange={(e) => handleItemChange(index, 'quantity', Number(e.target.value))}\n                                    className=\"border-gray-200 rounded-lg mt-1 w-full !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400\"\n                                    placeholder=\"\"\n                                  />\n                                ) : (\n                                  <div className=\"modal-subtitle\">{item.quantity || 0}</div>\n                                )}\n                              </div>\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">:</span>\n                                {isEditing ? (\n                                  <Input\n                                    type=\"number\"\n                                    value={item.unit_price_value}\n                                    onChange={(e) => handleItemChange(index, 'unit_price_value', Number(e.target.value))}\n                                    className=\"border-gray-200 rounded-lg mt-1 w-full !h-5 !px-1.5 !py-0.5 !text-[9px] font-normal text-gray-600 focus:border-blue-400\"\n                                    placeholder=\"\"\n                                  />\n                                ) : (\n                                  <div className=\"modal-subtitle\">\n                                    {activeTab === 'done' && !canViewFinancialInfo \n                                      ? '-' \n                                      : `${formatCurrency(item.unit_price_value)}`}\n                                  </div>\n                                )}\n                              </div>\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">:</span>\n                                <div className=\"mt-1\">\n                                  {isEditing ? (\n                                    <Button\n                                      size=\"sm\"\n                                      variant=\"ghost\"\n                                      onClick={() => handleRemoveItem(index)}\n                                      className=\"text-red-600 hover:bg-red-50 rounded-lg p-1 h-6 w-6\"\n                                    >\n                                      <Trash2 className=\"w-3 h-3\" />\n                                    </Button>\n                                  ) : (\n                                    <>\n                                      {activeTab === 'purchase' && (\n                                        <>\n                                          {canPurchase ? (\n                                            <button\n                                              onClick={() => handlePaymentToggle(item.id, !item.is_payment_completed)}\n                                              className={`text-xs px-2 py-1 rounded ${\n                                                item.is_payment_completed\n                                                  ? 'bg-orange-500 text-white hover:bg-orange-600'\n                                                  : 'bg-gray-100 text-gray-600'\n                                              }`}\n                                            >\n                                              {item.is_payment_completed ? '' : ''}\n                                            </button>\n                                          ) : (\n                                            <span className={`text-xs px-2 py-1 rounded ${\n                                              item.is_payment_completed \n                                                ? 'bg-orange-500 text-white' \n                                                : 'bg-gray-100 text-gray-400'\n                                            }`}>\n                                              {item.is_payment_completed ? '' : ''}\n                                            </span>\n                                          )}\n                                        </>\n                                      )}\n                                      \n                                      {activeTab === 'receipt' && (\n                                        <>\n                                          {canProcessReceipt ? (\n                                            actualReceivedAction.isCompleted(item) ? (\n                                              <button\n                                                onClick={() => {\n                                                  actualReceivedAction.handleCancel(item.id, {\n                                                    item_name: item.item_name,\n                                                    specification: item.specification,\n                                                    quantity: item.quantity,\n                                                    unit_price_value: item.unit_price_value,\n                                                    amount_value: item.amount_value,\n                                                    remark: item.remark\n                                                  })\n                                                }}\n                                                className=\"text-xs px-2 py-1 rounded button-action-primary\"\n                                              >\n                                                {actualReceivedAction.config.completedText}\n                                              </button>\n                                            ) : (\n                                              <DatePickerPopover\n                                                onDateSelect={(date) => {\n                                                  actualReceivedAction.handleConfirm(item.id, date, {\n                                                    item_name: item.item_name,\n                                                    specification: item.specification,\n                                                    quantity: item.quantity,\n                                                    unit_price_value: item.unit_price_value,\n                                                    amount_value: item.amount_value,\n                                                    remark: item.remark\n                                                  })\n                                                }}\n                                                placeholder=\"   \"\n                                                align=\"center\"\n                                                side=\"bottom\"\n                                              >\n                                                <button className=\"text-xs px-2 py-1 rounded bg-gray-100 text-gray-600\">\n                                                  {actualReceivedAction.config.waitingText}\n                                                </button>\n                                              </DatePickerPopover>\n                                            )\n                                          ) : (\n                                            <span className={`text-xs px-2 py-1 rounded ${\n                                              actualReceivedAction.isCompleted(item)\n                                                ? 'button-action-primary' \n                                                : 'bg-gray-100 text-gray-400'\n                                            }`}>\n                                              {actualReceivedAction.isCompleted(item) ? actualReceivedAction.config.completedText : actualReceivedAction.config.waitingText}\n                                            </span>\n                                          )}\n                                        </>\n                                      )}\n                                      \n                                      {activeTab === 'done' && (\n                                        <>\n                                          {/*       ( ) */}\n                                          <span className={`button-base ${\n                                            actualReceivedAction.isCompleted(item)\n                                              ? 'bg-green-500 text-white' \n                                              : 'border border-gray-300 text-gray-600 bg-white'\n                                          }`}>\n                                            {actualReceivedAction.isCompleted(item) ? '' : ''}\n                                          </span>\n                                        </>\n                                      )}\n                                      \n                                      {activeTab !== 'purchase' && activeTab !== 'receipt' && activeTab !== 'done' && (\n                                        <span className=\"text-xs text-gray-400\">-</span>\n                                      )}\n                                    </>\n                                  )}\n                                </div>\n                              </div>\n                            </div>\n                            \n                            {(item.remark || isEditing) && (\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">:</span>\n                                {isEditing ? (\n                                  <Input\n                                    value={item.remark || ''}\n                                    onChange={(e) => handleItemChange(index, 'remark', e.target.value)}\n                                    className=\"modal-label border-gray-200 rounded-lg mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                    placeholder=\"\"\n                                  />\n                                ) : (\n                                  <div className=\"modal-subtitle text-gray-500 mt-1\">{item.remark || '-'}</div>\n                                )}\n                              </div>\n                            )}\n                            \n                            {/*      */}\n                            {!isEditing && activeTab === 'receipt' && actualReceivedAction.getCompletedDate(item) && (\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">:</span>\n                                <div className=\"mt-1\">\n                                  <div className=\"modal-subtitle text-green-700\">\n                                    {new Date(actualReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                                      year: 'numeric',\n                                      month: '2-digit',\n                                      day: '2-digit'\n                                    })}\n                                  </div>\n                                  <div className=\"text-[9px] text-gray-500\">\n                                    {new Date(actualReceivedAction.getCompletedDate(item)).toLocaleTimeString('ko-KR', {\n                                      hour: '2-digit',\n                                      minute: '2-digit'\n                                    })}\n                                  </div>\n                                </div>\n                              </div>\n                            )}\n\n                            {/*     -      */}\n                            {!isEditing && activeTab === 'done' && purchase.payment_category === '' && (\n                              <div className=\"flex items-center justify-between\">\n                                <span className=\"text-gray-500 text-xs\"> :</span>\n                                <div className=\"flex items-center gap-2\">\n                                  {canReceiptCheck ? (\n                                    statementReceivedAction.isCompleted(item) ? (\n                                      <button\n                                        onClick={() => {\n                                          statementReceivedAction.handleCancel(item.id, {\n                                            item_name: item.item_name,\n                                            specification: item.specification,\n                                            quantity: item.quantity,\n                                            unit_price_value: item.unit_price_value,\n                                            amount_value: item.amount_value,\n                                            remark: item.remark\n                                          })\n                                        }}\n                                        className=\"text-xs px-2 py-1 rounded button-action-primary hover:bg-green-600\"\n                                        title=\"   \"\n                                      >\n                                        {statementReceivedAction.config.completedText}\n                                      </button>\n                                    ) : (\n                                      <DatePickerPopover\n                                        onDateSelect={(date) => {\n                                          statementReceivedAction.handleConfirm(item.id, date, {\n                                            item_name: item.item_name,\n                                            specification: item.specification,\n                                            quantity: item.quantity,\n                                            unit_price_value: item.unit_price_value,\n                                            amount_value: item.amount_value,\n                                            remark: item.remark\n                                          })\n                                        }}\n                                        placeholder=\"  \"\n                                        align=\"end\"\n                                        side=\"bottom\"\n                                      >\n                                        <button \n                                          className=\"text-xs px-2 py-1 rounded bg-gray-100 text-gray-600\"\n                                          onClick={() => {}}\n                                        >\n                                          {statementReceivedAction.config.waitingText}\n                                        </button>\n                                      </DatePickerPopover>\n                                    )\n                                  ) : (\n                                    <span className={`text-xs px-2 py-1 rounded ${\n                                      statementReceivedAction.isCompleted(item)\n                                        ? 'button-action-primary' \n                                        : 'bg-gray-100 text-gray-400'\n                                    }`}>\n                                      {statementReceivedAction.isCompleted(item) ? statementReceivedAction.config.completedText : statementReceivedAction.config.waitingText}\n                                    </span>\n                                  )}\n                                </div>\n                              </div>\n                            )}\n\n                            {/*     -      */}\n                            {!isEditing && activeTab === 'done' && purchase.payment_category === '' && statementReceivedAction.getCompletedDate(item) && (\n                              <div>\n                                <span className=\"text-gray-500 text-xs\"> :</span>\n                                <div className=\"mt-1\">\n                                  <div className=\"modal-subtitle text-blue-700\">\n                                    {new Date(statementReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                                      year: 'numeric',\n                                      month: '2-digit',\n                                      day: '2-digit'\n                                    })}\n                                  </div>\n                                </div>\n                              </div>\n                            )}\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                </div>\n                \n                {/*  */}\n                <div className=\"bg-gray-50 px-2 sm:px-3 border-t border-gray-100\">\n                  <div className=\"hidden sm:grid items-center gap-1 py-2 w-fit\" style={{\n                    gridTemplateColumns: getGridTemplateColumns()\n                  }}>\n                    {/*  */}\n                    <div></div>\n                    {/*  */}\n                    <div></div>\n                    {/*  */}\n                    <div></div>\n                    {/*   -   */}\n                    <div className=\"text-right flex items-center justify-end\">\n                      <span className=\"text-[11px] text-gray-600 font-medium\"></span>\n                    </div>\n                    {/*   -    */}\n                    <div className=\"text-right flex items-center justify-end\">\n                      <span className=\"text-[12px] font-bold text-gray-900\">\n                        {activeTab === 'done' && !canViewFinancialInfo \n                          ? '-' \n                          : `${formatCurrency(\n                              (isEditing ? editedItems : currentItems)?.reduce((sum, item) => sum + (item.amount_value || 0), 0) || 0\n                            )}`}\n                      </span>\n                    </div>\n                    {/*   ( ) */}\n                    {purchase.payment_category === '' && (\n                      <div className=\"text-right flex items-center justify-end\">\n                        {/*   -    */}\n                        <span className=\"text-[12px] font-bold text-gray-900\">\n                          {activeTab === 'done' && !canViewFinancialInfo \n                            ? '-' \n                            : `${formatCurrency(\n                                (isEditing ? editedItems : currentItems)?.reduce((sum, item) => sum + (item.tax_amount_value || 0), 0) || 0\n                              )}`}\n                        </span>\n                      </div>\n                    )}\n                    {/*  */}\n                    <div></div>\n                    {/*    -      */}\n                    {isEditing ? (\n                      <div></div>\n                    ) : (\n                      <div className={activeTab === 'done' && purchase.payment_category === '' ? \"text-right flex items-center justify-end\" : \"\"}>\n                        {activeTab === 'done' && purchase.payment_category === '' && (\n                          <span className=\"text-[11px] text-gray-600 font-medium\"></span>\n                        )}\n                      </div>\n                    )}\n                    {activeTab === 'receipt' && <div></div>}\n                    {activeTab === 'done' && (\n                      <>\n                        {/*   -      */}\n                        {purchase.payment_category === '' && (\n                          <>\n                            <div className=\"text-right flex items-center justify-end\">\n                              <div className=\"text-[12px] font-bold text-blue-700\">\n                                {!canViewFinancialInfo \n                                  ? '-' \n                                  : `${formatCurrency(\n                                      (isEditing ? editedItems : currentItems)?.reduce((sum: number, item: any) => {\n                                        return sum + (Number(item.expenditure_amount) || 0)\n                                      }, 0) || 0\n                                    )}`}\n                              </div>\n                            </div>\n                            {/*    */}\n                            <div></div>\n                            {/*   */}\n                            <div></div>\n                          </>\n                        )}\n                      </>\n                    )}\n                  </div>\n\n                  {/* +  ( ) */}\n                  {purchase.payment_category === '' && (\n                    <div className=\"hidden sm:grid items-center gap-1 py-2 w-fit border-t border-gray-300\" style={{\n                      gridTemplateColumns: getGridTemplateColumns()\n                    }}>\n                      {/*   */}\n                      <div></div>\n                      <div></div>\n                      <div></div>\n                      {/*   -  */}\n                      <div></div>\n                      {/*   -   */}\n                      <div className=\"text-right flex items-center justify-end\">\n                        <span className=\"text-[11px] text-gray-600 font-medium\"></span>\n                      </div>\n                      {/*   - +  */}\n                      <div className=\"text-right flex items-center justify-end\">\n                        <span className=\"text-[12px] font-bold text-blue-600\">\n                          {activeTab === 'done' && !canViewFinancialInfo \n                            ? '-' \n                            : `${formatCurrency(\n                                (isEditing ? editedItems : currentItems)?.reduce((sum, item) => {\n                                  const amount = item.amount_value || 0\n                                  const tax = item.tax_amount_value || 0\n                                  return sum + amount + tax\n                                }, 0) || 0\n                              )}`}\n                        </span>\n                      </div>\n                      {/*    */}\n                      <div></div>\n                      {isEditing ? <div></div> : <div></div>}\n                      {activeTab === 'receipt' && <div></div>}\n                      {activeTab === 'done' && purchase.payment_category === '' && (\n                        <>\n                          {/*   */}\n                          <div></div>\n                          {/*    */}\n                          <div></div>\n                          {/*   */}\n                          <div></div>\n                        </>\n                      )}\n                    </div>\n                  )}\n                  \n                  {/* Mobile  */}\n                  <div className=\"block sm:hidden py-2 space-y-1\">\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-[12px] text-gray-500\"> </span>\n                      <span className=\"text-[13px] font-bold text-gray-900\">\n                        {activeTab === 'done' && !canViewFinancialInfo \n                          ? '-' \n                          : `${formatCurrency(\n                              (isEditing ? editedItems : currentItems)?.reduce((sum, item) => sum + (item.amount_value || 0), 0) || 0\n                            )}`}\n                      </span>\n                    </div>\n                    {/*  ( ) */}\n                    {purchase.payment_category === '' && (\n                      <>\n                        <div className=\"flex justify-between items-center\">\n                          <span className=\"text-[12px] text-gray-500\"> </span>\n                          <span className=\"text-[13px] font-bold text-gray-900\">\n                            {activeTab === 'done' && !canViewFinancialInfo \n                              ? '-' \n                              : `${formatCurrency(\n                                  (isEditing ? editedItems : currentItems)?.reduce((sum, item) => sum + (item.tax_amount_value || 0), 0) || 0\n                                )}`}\n                          </span>\n                        </div>\n                        <div className=\"flex justify-between items-center border-t pt-1\">\n                          <span className=\"text-[12px] text-gray-500\">+</span>\n                          <span className=\"text-[13px] font-bold text-blue-600\">\n                            {activeTab === 'done' && !canViewFinancialInfo \n                              ? '-' \n                              : `${formatCurrency(\n                                  (isEditing ? editedItems : currentItems)?.reduce((sum, item) => {\n                                    const amount = item.amount_value || 0\n                                    const tax = item.tax_amount_value || 0\n                                    return sum + amount + tax\n                                  }, 0) || 0\n                                )}`}\n                          </span>\n                        </div>\n                      </>\n                    )}\n                    {/* Mobile   -    */}\n                    {activeTab === 'done' && purchase.payment_category === '' && (\n                      <div className=\"flex justify-between items-center border-t pt-1\">\n                        <span className=\"text-[12px] text-gray-500\"> </span>\n                        <span className=\"text-[13px] font-bold text-blue-700\">\n                          {!canViewFinancialInfo \n                            ? '-' \n                            : `${formatCurrency(\n                                (isEditing ? editedItems : currentItems)?.reduce((sum: number, item: any) => {\n                                  return sum + (Number(item.expenditure_amount) || 0)\n                                }, 0) || 0\n                              )}`}\n                        </span>\n                      </div>\n                    )}\n                  </div>\n                </div>\n                \n                {/*    */}\n                {isEditing && (\n                  <div className=\"p-2 sm:p-3 border-t border-gray-100\">\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={handleAddItem}\n                      className=\"w-full rounded-lg border-dashed border-2 border-gray-300 hover:border-gray-400 py-2 badge-text\"\n                    >\n                      <Plus className=\"w-4 h-4 mr-1\" />\n                       \n                    </Button>\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n      ) : (\n        <div className=\"text-center py-12\">\n          <span className=\"modal-subtitle\">\n                .\n          </span>\n        </div>\n      )}\n    </div>\n  )\n\n  // embedded true Dialog   \n  if (embedded) {\n    return content\n  }\n\n  // embedded false Dialog  \n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent \n        className=\"overflow-hidden bg-white rounded-lg shadow-sm border-0 w-full sm:w-auto max-w-[calc(100vw-48px)] sm:max-w-[calc(100vw-80px)] lg:max-w-[90vw] xl:max-w-[85vw] h-[95vh] sm:h-auto sm:max-h-[90vh] lg:max-h-[85vh] sm:rounded-lg flex flex-col\" \n        showCloseButton={false}\n      >\n        <DialogHeader className=\"sr-only\">\n          <DialogTitle>  </DialogTitle>\n        </DialogHeader>\n        {/* Apple-style Header */}\n        <div className=\"relative px-3 sm:px-6 pt-0 sm:pt-3 lg:pt-4 pb-0 sm:pb-2 lg:pb-3 flex-shrink-0\">\n          <div className=\"absolute right-3 sm:right-6 top-3 sm:top-3 lg:top-4 flex items-center gap-2 z-10\">\n            {/*   ( ,  ) */}\n            {!isAdmin && !isEditing && (\n              <Popover open={isModifyRequestOpen} onOpenChange={setIsModifyRequestOpen}>\n                <PopoverTrigger asChild>\n                  <Button \n                    variant=\"outline\" \n                    size=\"sm\" \n                    className=\"button-base button-action-secondary h-8 text-xs px-3 gap-1.5\"\n                    title=\" \"\n                  >\n                    <MessageSquarePlus className=\"w-3.5 h-3.5 text-gray-500\" />\n                    <span> </span>\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent \n                  className=\"w-80 sm:w-96 p-4\" \n                  align=\"end\"\n                  onOpenAutoFocus={(e) => e.preventDefault()}\n                >\n                  <div className=\"space-y-4\">\n                    <div className=\"space-y-2\">\n                      <h4 className=\"font-medium leading-none\"> </h4>\n                      <p className=\"text-xs text-muted-foreground\">\n                             .\n                      </p>\n                    </div>\n                    <div className=\"space-y-3\">\n                      <div className=\"space-y-1\">\n                        <Label htmlFor=\"subject\" className=\"text-xs\"></Label>\n                        <Input\n                          id=\"subject\"\n                          value={modifySubject}\n                          onChange={(e) => setModifySubject(e.target.value)}\n                          className=\"h-8 text-xs\"\n                          placeholder=\" \"\n                        />\n                      </div>\n                      <div className=\"space-y-1\">\n                        <Label htmlFor=\"message\" className=\"text-xs\"></Label>\n                        <div className=\"relative\" onWheel={(e) => e.stopPropagation()}>\n                          <Textarea\n                            id=\"message\"\n                            value={modifyMessage}\n                            onChange={(e) => setModifyMessage(e.target.value)}\n                            className=\"min-h-[150px] text-xs font-mono overflow-auto\"\n                            placeholder=\"  \"\n                            style={{ resize: 'none' }}\n                          />\n                        </div>\n                      </div>\n                    </div>\n                    <div className=\"flex justify-end gap-2\">\n                      <Button \n                        variant=\"outline\" \n                        size=\"sm\" \n                        onClick={() => setIsModifyRequestOpen(false)}\n                        className=\"h-8 text-xs\"\n                      >\n                        \n                      </Button>\n                      <Button \n                        size=\"sm\" \n                        onClick={handleSendModifyRequest}\n                        disabled={isSendingModify}\n                        className=\"h-8 text-xs bg-blue-600 hover:bg-blue-700\"\n                      >\n                        {isSendingModify ? ' ...' : ' '}\n                      </Button>\n                    </div>\n                  </div>\n                </PopoverContent>\n              </Popover>\n            )}\n            \n            <button\n              onClick={onClose}\n              className=\"button-base button-action-secondary w-8 h-8 rounded-full flex items-center justify-center\"\n            >\n              <X className=\"w-4 h-4 text-gray-500\" />\n            </button>\n          </div>\n          \n          <div className=\"pr-8 sm:pr-16\">\n            <div className=\"flex items-start gap-4 mb-0 sm:mb-3\">\n              <div className=\"min-w-0 flex-1\">\n                <h1 className=\"page-title mb-0 sm:mb-1\">\n                   \n                </h1>\n              </div>\n              <div className=\"flex items-center gap-3\">\n                {!isEditing && canEdit && (\n                  <>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => handleEditToggle(true)}\n                      className=\"button-base button-action-secondary\"\n                    >\n                      <Edit2 className=\"w-4 h-4 mr-2\" />\n                      \n                    </Button>\n                    {canDelete && onDelete && (\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={async () => {\n                          if (purchase) {\n                            try {\n                              await onDelete(purchase);\n                              \n                              //      \n                              onClose();\n                              if (onRefresh) {\n                                await onRefresh(true); //  \n                              }\n                            } catch (error) {\n                              logger.error('    ', error);\n                              toast.error('   .');\n                            }\n                          }\n                        }}\n                        className=\"button-base button-action-danger\"\n                      >\n                        <Trash2 className=\"w-4 h-4 mr-2\" />\n                        \n                      </Button>\n                    )}\n                  </>\n                )}\n                {isEditing && (\n                  <>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => {\n                        handleEditToggle(false)\n                        setEditedPurchase(purchase)\n                        setEditedItems(purchase?.items || [])\n                        setDeletedItemIds([])\n                      }}\n                      className=\"button-base button-action-secondary\"\n                    >\n                      <X className=\"w-4 h-4 mr-2\" />\n                      \n                    </Button>\n                    <Button\n                      size=\"sm\"\n                      onClick={handleSave}\n                      className=\"button-base button-action-primary\"\n                    >\n                      <Save className=\"w-4 h-4 mr-2\" />\n                      \n                    </Button>\n                  </>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Apple-style Content */}\n        <div className=\"overflow-y-auto flex-1 px-3 sm:px-6 pb-1 sm:pb-6 mt-0\">\n          {content}\n        </div>\n      </DialogContent>\n      \n    </Dialog>\n  )\n}\n\nexport default memo(PurchaseDetailModal)"],"file":"assets/PurchaseDetailModal-BcRyTDxP.js"}