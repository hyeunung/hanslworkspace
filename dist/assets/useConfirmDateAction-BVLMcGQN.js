import{r as e,j as t,a,l as i}from"./index-C_LZWDMs.js";import{C as r,k as n}from"./calendar-6U50J3z3.js";import{P as c,a as s,b as d}from"./popover-BOglz3Wg.js";import{t as o}from"./index-Cg1kW5Oo.js";function l({children:a,onDateSelect:i,disabled:o=!1,placeholder:l="ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”",align:m="center",side:u="bottom"}){const[f,_]=e.useState(!1);return t.jsxs(c,{open:f,onOpenChange:_,children:[t.jsx(s,{asChild:!0,disabled:o,children:a}),t.jsx(d,{className:"w-auto p-0 border-gray-200 shadow-lg",align:m,side:u,sideOffset:8,children:t.jsxs("div",{className:"bg-white business-radius-card p-2",children:[t.jsx("div",{className:"mb-2 px-1",children:t.jsx("div",{className:"modal-label text-gray-600 text-center",children:l})}),t.jsx(r,{mode:"single",selected:void 0,onSelect:e=>{(e=>{e&&(i(e),_(!1))})(e)},locale:n,initialFocus:!0,className:"compact-calendar",disabled:!1,fromDate:new Date("2020-01-01"),toDate:new Date("2030-12-31"),defaultMonth:new Date,modifiers:{today:new Date},modifiersClassNames:{today:"bg-blue-500 text-white font-semibold cursor-pointer hover:bg-blue-600 rounded-md"}})]})})]})}function m({config:t,currentUserName:r,canPerformAction:n,onUpdate:c,onOptimisticUpdate:s}){const d=a(),l=e.useCallback(async(e,a,l)=>{if(i.debug(`ðŸ” ${t.field} í™•ì¸ ì‹œìž‘`,{itemId:e,selectedDate:a,canPerformAction:n,currentUserName:r}),!n)return i.warn("âŒ ê¶Œí•œ ì—†ìŒ",{canPerformAction:n}),void o.error(("statement_received"===t.field?"ê±°ëž˜ëª…ì„¸ì„œ":"ìž…ê³ ")+" í™•ì¸ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");const m=String(e),u="number"==typeof e?e:Number(e);if(i.debug("ðŸ”¢ ID ë³€í™˜ í™•ì¸",{originalItemId:e,itemIdStr:m,numericId:u,itemIdType:typeof e}),Number.isNaN(u))return i.error("âŒ ìž˜ëª»ëœ ID",{itemId:e,numericId:u}),void o.error("ìœ íš¨í•˜ì§€ ì•Šì€ í•­ëª© ID ìž…ë‹ˆë‹¤.");if(l){const e=`í’ˆëª©ëª…: ${l.item_name||"-"}\nê·œê²©: ${l.specification||"-"}\nìˆ˜ëŸ‰: ${l.quantity?.toLocaleString()||0}\në‹¨ê°€: â‚©${l.unit_price_value?.toLocaleString()||0}\ní•©ê³„: â‚©${l.amount_value?.toLocaleString()||0}\në¹„ê³ : ${l.remark||"-"}\n\n${t.confirmMessage.confirm}`;if(!window.confirm(e))return}i.debug("ðŸ“ ë°ì´í„°ë² ì´ìŠ¤ ì—…ë°ì´íŠ¸ ì‹œìž‘",{numericId:u,selectedDate:a.toISOString()});try{let e;"statement_received"===t.field?e={is_statement_received:!0,statement_received_date:a.toISOString(),statement_received_by_name:r}:"actual_received"===t.field&&(e={actual_received_date:a.toISOString()});const{data:n,error:m}=await d.from("purchase_request_items").update(e).eq("id",u).select();if(m)throw i.error("âŒ DB ì—…ë°ì´íŠ¸ ì‹¤íŒ¨",m),m;i.info("âœ… DB ì—…ë°ì´íŠ¸ ì„±ê³µ"),s&&s({itemId:u,selectedDate:a,action:"confirm",itemInfo:l}),c&&(i.debug("ðŸ”„ ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ ìƒˆë¡œê³ ì¹¨ í˜¸ì¶œ"),c()),o.success(t.successMessage.confirm)}catch(f){i.error("âŒ ì „ì²´ ì²˜ë¦¬ ì‹¤íŒ¨",f),o.error(("statement_received"===t.field?"ê±°ëž˜ëª…ì„¸ì„œ":"ìž…ê³ ")+" í™•ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},[t,r,n,c,s,d]),m=e.useCallback(async(e,a)=>{if(!n)return void o.error(("statement_received"===t.field?"ê±°ëž˜ëª…ì„¸ì„œ":"ìž…ê³ ")+" í™•ì¸ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");const r="number"==typeof e?e:Number(e);if(Number.isNaN(r))o.error("ìœ íš¨í•˜ì§€ ì•Šì€ í•­ëª© ID ìž…ë‹ˆë‹¤.");else{if(a){const e=`í’ˆëª©ëª…: ${a.item_name||"-"}\nê·œê²©: ${a.specification||"-"}\nìˆ˜ëŸ‰: ${a.quantity?.toLocaleString()||0}\në‹¨ê°€: â‚©${a.unit_price_value?.toLocaleString()||0}\ní•©ê³„: â‚©${a.amount_value?.toLocaleString()||0}\në¹„ê³ : ${a.remark||"-"}\n\n${t.confirmMessage.cancel}`;if(!window.confirm(e))return}try{let n;i.debug(`ðŸ”„ ${t.field} í™•ì¸ ì·¨ì†Œ ì‹œìž‘`,{itemId:e,itemName:a?.item_name}),"statement_received"===t.field?n={is_statement_received:!1,statement_received_date:null,statement_received_by_name:null}:"actual_received"===t.field&&(n={actual_received_date:null});const{data:l,error:m}=await d.from("purchase_request_items").update(n).eq("id",r).select();if(m)throw i.error("âŒ DB ì—…ë°ì´íŠ¸ ì‹¤íŒ¨",m),m;i.info(`âœ… ${t.field} í™•ì¸ ì·¨ì†Œ ì„±ê³µ`),s&&s({itemId:r,action:"cancel",itemInfo:a}),c&&(i.debug("ðŸ”„ ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ ìƒˆë¡œê³ ì¹¨ í˜¸ì¶œ (ì·¨ì†Œ)"),c()),o.success(t.successMessage.cancel)}catch(l){i.error(`âŒ ${t.field} í™•ì¸ ì·¨ì†Œ ì‹¤íŒ¨`,l),o.error(("statement_received"===t.field?"ê±°ëž˜ëª…ì„¸ì„œ":"ìž…ê³ ")+" í™•ì¸ ì·¨ì†Œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}}},[t,n,c,s,d]),u=e.useCallback(e=>"statement_received"===t.field?e.is_statement_received:"actual_received"===t.field&&!!e.actual_received_date,[t.field]),f=e.useCallback(e=>"statement_received"===t.field?e.statement_received_date:"actual_received"===t.field?e.actual_received_date:null,[t.field]),_=e.useCallback(e=>"statement_received"===t.field?e.statement_received_by_name:(t.field,null),[t.field]);return{config:t,handleConfirm:l,handleCancel:m,isCompleted:u,getCompletedDate:f,getCompletedByName:_}}export{l as D,m as u};
//# sourceMappingURL=useConfirmDateAction-BVLMcGQN.js.map
