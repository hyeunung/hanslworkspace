{"version":3,"file":"PurchaseItemsModal-DcUOFzcA.js","sources":["../../src/components/purchase/PurchaseItemsModal.tsx"],"sourcesContent":["\nimport { useState, useCallback, useEffect, useMemo } from \"react\";\nimport { X, Edit2, Save, Trash2, Plus } from \"lucide-react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { format } from \"date-fns\";\nimport { createClient } from \"@/lib/supabase/client\";\nimport { toast } from \"sonner\";\nimport { ReceiptDownloadButton } from \"./ReceiptDownloadButton\";\nimport { DatePickerPopover } from \"@/components/ui/date-picker-popover\";\nimport { useEffect } from \"react\";\nimport { useConfirmDateAction } from '@/hooks/useConfirmDateAction';\nimport { logger } from '@/lib/logger';\n\ninterface PurchaseItem {\n  id?: number | string;\n  line_number?: number;\n  item_name: string;\n  specification?: string;\n  quantity: number;\n  unit_price_value?: number;\n  amount_value?: number;\n  remark?: string;\n  link?: string;\n  is_received?: boolean;\n  delivery_status?: string;\n  receipt_image_url?: string | null;\n  receipt_uploaded_at?: string | null;\n  receipt_uploaded_by?: string | null;\n  // Í±∞ÎûòÎ™ÖÏÑ∏ÏÑú ÌôïÏù∏ Í¥ÄÎ†® ÌïÑÎìú\n  is_statement_received?: boolean;\n  statement_received_date?: string | null;\n  statement_received_by_name?: string | null;\n}\n\ninterface PurchaseItemsModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  purchase: {\n    id: number;\n    purchase_order_number?: string;\n    vendor_name: string;\n    requester_name: string;\n    project_vendor: string;\n    sales_order_number: string;\n    project_item: string;\n    request_date: string;\n    delivery_request_date?: string | null;\n    revised_delivery_request_date?: string | null;\n    currency: string;\n    payment_category?: string;\n    items?: PurchaseItem[];\n    total_amount: number;\n  };\n  isAdmin: boolean;\n  onUpdate: () => void;\n  activeTab?: string; // ÌôúÏÑ± ÌÉ≠ Ï†ïÎ≥¥ Ï∂îÍ∞Ä\n}\n\nexport default function PurchaseItemsModal({ isOpen, onClose, purchase, isAdmin, onUpdate, activeTab = 'done' }: PurchaseItemsModalProps) {\n  const [editingItems, setEditingItems] = useState<PurchaseItem[]>(purchase.items || []);\n  const [isEditing, setIsEditing] = useState(false);\n  const [currentUserName, setCurrentUserName] = useState<string>('');\n  const [viewportSize, setViewportSize] = useState({ width: 0, height: 0 });\n  const supabase = createClient();\n\n  // ÌôîÎ©¥ ÌÅ¨Í∏∞ Í∞êÏßÄ\n  useEffect(() => {\n    const updateViewportSize = () => {\n      setViewportSize({\n        width: window.innerWidth,\n        height: window.innerHeight\n      });\n    };\n\n    // Ï¥àÍ∏∞Í∞í ÏÑ§Ï†ï\n    updateViewportSize();\n\n    // Î¶¨ÏÇ¨Ïù¥Ï¶à Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Îì±Î°ù\n    window.addEventListener('resize', updateViewportSize);\n    \n    return () => {\n      window.removeEventListener('resize', updateViewportSize);\n    };\n  }, []);\n\n  // ÌÖåÏù¥Î∏î Ïª®ÌÖåÏù¥ÎÑàÏùò ÎèôÏ†Å ÏµúÎåÄ ÎÑàÎπÑ Í≥ÑÏÇ∞\n  const tableMaxWidth = useMemo(() => {\n    const { width } = viewportSize;\n    \n    if (width === 0) return '800px'; // Ï¥àÍ∏∞Í∞í\n    \n    // Î™®Îã¨ Ìå®Îî©Í≥º Ïó¨Î∞±ÏùÑ Í≥†Î†§Ìïú Í∞ÄÏö© ÎÑàÎπÑ Í≥ÑÏÇ∞\n    // Î™®Îã¨ Ï¢åÏö∞ Ìå®Îî©: 24px (sm:p-6), Î∏åÎùºÏö∞Ï†Ä Ïó¨Î∞±: 20px, ÏïàÏ†Ñ Ïó¨Î∞±: 40px\n    const modalPadding = 48; // Ï¢åÏö∞ Ìå®Îî©\n    const browserMargin = 20; // Î∏åÎùºÏö∞Ï†Ä Ïó¨Î∞±\n    const safetyMargin = 40; // ÏïàÏ†Ñ Ïó¨Î∞±\n    const availableWidth = width - modalPadding - browserMargin - safetyMargin;\n    \n    // ÏµúÏÜå ÎÑàÎπÑ Î≥¥Ïû• (800px) Î∞è ÏµúÎåÄ ÎÑàÎπÑ Ï†úÌïú\n    const minWidth = 800;\n    const maxWidth = Math.max(minWidth, Math.min(availableWidth, width * 0.95));\n    \n    return `${maxWidth}px`;\n  }, [viewportSize]);\n  \n  // ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Î∞è ÏµúÏã† Îç∞Ïù¥ÌÑ∞ Î°úÎìú\n  useEffect(() => {\n    const loadData = async () => {\n      try {\n        const { data: { user } } = await supabase.auth.getUser();\n        if (user?.email) {\n          const { data: employeeData } = await supabase\n            .from('employees')\n            .select('name')\n            .eq('email', user.email)\n            .single();\n          \n          if (employeeData?.name) {\n            setCurrentUserName(employeeData.name);\n          } else {\n            setCurrentUserName(user.email);\n          }\n        }\n\n        // ÏµúÏã† Íµ¨Îß§ ÏöîÏ≤≠ ÏïÑÏù¥ÌÖú Îç∞Ïù¥ÌÑ∞ Î°úÎìú (Í±∞ÎûòÎ™ÖÏÑ∏ÏÑú ÌôïÏù∏ ÌïÑÎìú Ìè¨Ìï®)\n        if (purchase.id) {\n          const { data: freshItems } = await supabase\n            .from('purchase_request_items')\n            .select('*')\n            .eq('purchase_request_id', purchase.id)\n            .order('line_number');\n          \n          if (freshItems) {\n            setEditingItems(freshItems);\n          }\n        }\n      } catch (error) {\n        logger.error('Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®', error);\n        setCurrentUserName('ÏÇ¨Ïö©Ïûê');\n      }\n    };\n\n    if (isOpen) {\n      loadData();\n    }\n  }, [isOpen, supabase, purchase.id]);\n\n  // Í∂åÌïú Ï≤¥ÌÅ¨\n  const isRequester = purchase?.requester_name === currentUserName\n  const canReceiptCheck = isAdmin || isRequester\n  \n  logger.debug('üîê PurchaseItemsModal Í∂åÌïú Ï≤¥ÌÅ¨ Ï†ïÎ≥¥', {\n    currentUserName,\n    isAdmin,\n    isRequester,\n    canReceiptCheck,\n    purchaseRequesterName: purchase?.requester_name,\n    activeTab\n  })\n\n  // Î∞òÏùëÌòï ÎîîÎ≤ÑÍπÖ Ï†ïÎ≥¥\n  logger.debug('üì± PurchaseItemsModal Î∞òÏùëÌòï Ï†ïÎ≥¥', {\n    viewportWidth: viewportSize.width,\n    viewportHeight: viewportSize.height,\n    tableMaxWidth,\n    modalWidth: `min(98vw, ${tableMaxWidth})`\n  })\n\n  // Î™®Îã¨ ÎÇ¥Î∂Ä Îç∞Ïù¥ÌÑ∞Îßå ÏÉàÎ°úÍ≥†Ïπ®ÌïòÎäî Ìï®Ïàò (Î™®Îã¨ Îã´ÏßÄ ÏïäÏùå)\n  const refreshModalData = useCallback(async () => {\n    if (!purchase.id) return\n    \n    try {\n      // ÏµúÏã† Íµ¨Îß§ ÏöîÏ≤≠ ÏïÑÏù¥ÌÖú Îç∞Ïù¥ÌÑ∞ Î°úÎìú\n      const { data: freshItems } = await supabase\n        .from('purchase_request_items')\n        .select('*')\n        .eq('purchase_request_id', purchase.id)\n        .order('line_number')\n      \n      if (freshItems) {\n        setEditingItems(freshItems)\n        \n        // Î™®Îã¨ ÏÉÅÌÉú Ïú†ÏßÄÎ•º ÏúÑÌï¥ Ïô∏Î∂Ä onUpdate Ìò∏Ï∂ú Ï†úÍ±∞\n        // Ïô∏Î∂Ä ÏßÑÌñâÎ•† ÏóÖÎç∞Ïù¥Ìä∏Îäî Î∂ÄÎ™® Ïª¥Ìè¨ÎÑåÌä∏ÏóêÏÑú Î≥ÑÎèÑ Ï≤òÎ¶¨\n        logger.debug('Î™®Îã¨ ÏïÑÏù¥ÌÖú Îç∞Ïù¥ÌÑ∞ ÏÉàÎ°úÍ≥†Ïπ® ÏôÑÎ£å - Î™®Îã¨ ÏÉÅÌÉú Ïú†ÏßÄ')\n      }\n    } catch (error) {\n      logger.error('Î™®Îã¨ Îç∞Ïù¥ÌÑ∞ ÏÉàÎ°úÍ≥†Ïπ® Ïã§Ìå®', error)\n    }\n  }, [purchase.id, supabase])\n\n  // Ïª§Ïä§ÌÖÄ ÌõÖ ÏÑ§Ï†ï\n  const statementReceivedAction = useConfirmDateAction({\n    config: {\n      field: 'statement_received',\n      confirmMessage: {\n        confirm: 'Í±∞ÎûòÎ™ÖÏÑ∏ÏÑú ÌôïÏù∏ÏùÑ Ï≤òÎ¶¨ÌïòÏãúÍ≤†ÏäµÎãàÍπå?',\n        cancel: 'Í±∞ÎûòÎ™ÖÏÑ∏ÏÑú ÌôïÏù∏ÏùÑ Ï∑®ÏÜåÌïòÏãúÍ≤†ÏäµÎãàÍπå?'\n      },\n      successMessage: {\n        confirm: 'Í±∞ÎûòÎ™ÖÏÑ∏ÏÑú ÌôïÏù∏Ïù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§.',\n        cancel: 'Í±∞ÎûòÎ™ÖÏÑ∏ÏÑú ÌôïÏù∏Ïù¥ Ï∑®ÏÜåÎêòÏóàÏäµÎãàÎã§.'\n      },\n      completedText: '‚úì ÏôÑÎ£å',\n      waitingText: 'ÎåÄÍ∏∞'\n    },\n    currentUserName,\n    canPerformAction: canReceiptCheck,\n    onUpdate: refreshModalData\n  })\n\n  // Ïã§Ï†ú ÏûÖÍ≥† ÎÇ†Ïßú Ïª§Ïä§ÌÖÄ ÌõÖ ÏÑ§Ï†ï\n  const actualReceivedAction = useConfirmDateAction({\n    config: {\n      field: 'actual_received',\n      confirmMessage: {\n        confirm: 'Ïã§Ï†ú ÏûÖÍ≥† Ï≤òÎ¶¨Î•º ÏßÑÌñâÌïòÏãúÍ≤†ÏäµÎãàÍπå?',\n        cancel: 'Ïã§Ï†ú ÏûÖÍ≥† Ï≤òÎ¶¨Î•º Ï∑®ÏÜåÌïòÏãúÍ≤†ÏäµÎãàÍπå?'\n      },\n      successMessage: {\n        confirm: 'Ïã§Ï†ú ÏûÖÍ≥† Ï≤òÎ¶¨Í∞Ä ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§.',\n        cancel: 'Ïã§Ï†ú ÏûÖÍ≥† Ï≤òÎ¶¨Í∞Ä Ï∑®ÏÜåÎêòÏóàÏäµÎãàÎã§.'\n      },\n      completedText: 'ÏûÖÍ≥†ÏôÑÎ£å',\n      waitingText: 'ÏûÖÍ≥†ÎåÄÍ∏∞'\n    },\n    currentUserName,\n    canPerformAction: canReceiptCheck,\n    onUpdate: refreshModalData\n  })\n  \n  // ÌíàÎ™© ÏàòÏ†ï ÏãúÏûë\n  const handleEditStart = () => {\n    setIsEditing(true);\n    setEditingItems([...purchase.items || []]);\n  };\n\n  // ÌíàÎ™© ÏàòÏ†ï Ï∑®ÏÜå\n  const handleEditCancel = () => {\n    setIsEditing(false);\n    setEditingItems(purchase.items || []);\n  };\n\n  // ÌíàÎ™© Í∞í Î≥ÄÍ≤Ω\n  const handleItemChange = (index: number, field: keyof PurchaseItem, value: any) => {\n    const newItems = [...editingItems];\n    newItems[index] = {\n      ...newItems[index],\n      [field]: field === 'quantity' || field === 'unit_price_value' || field === 'amount_value' ? Number(value) : value\n    };\n    \n    // Í∏àÏï° ÏûêÎèô Í≥ÑÏÇ∞ (amount_valueÎ•º ÏßÅÏ†ë ÏàòÏ†ïÌïòÎäî Í≤ΩÏö∞Í∞Ä ÏïÑÎãê ÎïåÎßå)\n    if (field === 'quantity' || field === 'unit_price_value') {\n      const quantity = newItems[index].quantity || 0;\n      const unitPrice = newItems[index].unit_price_value || 0;\n      // Îã®Í∞ÄÍ∞Ä ÏûÖÎ†•Îêú Í≤ΩÏö∞ÏóêÎßå ÏûêÎèô Í≥ÑÏÇ∞, ÏïÑÎãàÎ©¥ 0 Ïú†ÏßÄ\n      newItems[index].amount_value = unitPrice > 0 ? quantity * unitPrice : 0;\n    }\n    \n    setEditingItems(newItems);\n  };\n\n  // ÏÉà ÌíàÎ™© Ï∂îÍ∞Ä\n  const handleAddItem = () => {\n    // ÌòÑÏû¨ ÏµúÎåÄ ÎùºÏù∏ÎÑòÎ≤Ñ Ï∞æÍ∏∞\n    const maxLineNumber = editingItems.reduce((max, item) => {\n      const lineNum = item.line_number || 0;\n      return lineNum > max ? lineNum : max;\n    }, 0);\n\n    const newItem: PurchaseItem = {\n      line_number: maxLineNumber + 1,\n      item_name: '',\n      specification: '',\n      quantity: 1,\n      unit_price_value: undefined, // Îã®Í∞Ä ÎπÑÏõåÎëêÍ∏∞\n      amount_value: 0,\n      remark: '',\n      is_received: false\n    };\n    \n    // ÏÉà ÏïÑÏù¥ÌÖú Ï∂îÍ∞Ä ÌõÑ ÎùºÏù∏ÎÑòÎ≤Ñ ÏàúÏÑúÎåÄÎ°ú Ï†ïÎ†¨\n    const newItems = [...editingItems, newItem].sort((a, b) => {\n      const lineA = a.line_number || 999999;\n      const lineB = b.line_number || 999999;\n      return lineA - lineB;\n    });\n    \n    setEditingItems(newItems);\n  };\n\n  // ÌíàÎ™© ÏÇ≠Ï†ú\n  const handleDeleteItem = (index: number) => {\n    const newItems = editingItems.filter((_, i) => i !== index).sort((a, b) => {\n      const lineA = a.line_number || 999999;\n      const lineB = b.line_number || 999999;\n      return lineA - lineB;\n    });\n    setEditingItems(newItems);\n  };\n\n  // ÌíàÎ™© Ï†ÄÏû•\n  const handleSave = async () => {\n    try {\n      logger.debug('ÌíàÎ™© Ï†ÄÏû• ÏãúÏûë', { \n        editingItems: editingItems.length,\n        purchaseId: purchase.id \n      });\n\n      // Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨ - ÌíàÎ™©Î™ÖÎßå ÌïÑÏàò\n      const invalidItems = editingItems.filter(item => \n        !item.item_name || !item.item_name.trim()\n      );\n      \n      if (invalidItems.length > 0) {\n        toast.error('ÌíàÎ™©Î™ÖÏùÄ ÌïÑÏàò ÏûÖÎ†• Ìï≠Î™©ÏûÖÎãàÎã§.');\n        return;\n      }\n\n      // Í∏∞Ï°¥ ÌíàÎ™© ÏÇ≠Ï†ú\n      const { error: deleteError } = await supabase\n        .from('purchase_request_items')\n        .delete()\n        .eq('purchase_request_id', purchase.id);\n\n      if (deleteError) {\n        logger.error('Í∏∞Ï°¥ ÌíàÎ™© ÏÇ≠Ï†ú Ïã§Ìå®', deleteError);\n        throw deleteError;\n      }\n\n      // ÏÉà ÌíàÎ™© Ï∂îÍ∞Ä\n      const itemsToInsert = editingItems.map(item => ({\n        purchase_request_id: purchase.id,\n        purchase_order_number: purchase.purchase_order_number,\n        line_number: item.line_number,\n        item_name: item.item_name.trim(),\n        specification: item.specification || '',\n        quantity: Number(item.quantity) || 0,\n        unit_price_value: (item.unit_price_value !== null && item.unit_price_value !== undefined && item.unit_price_value !== '') ? Number(item.unit_price_value) : null,\n        amount_value: Number(item.amount_value) || 0,\n        remark: item.remark || '',\n        link: item.link || null,\n        is_received: item.is_received || false,\n        delivery_status: item.delivery_status || 'pending'\n      }));\n\n      logger.debug('ÌíàÎ™© ÏÇΩÏûÖ Îç∞Ïù¥ÌÑ∞', { itemsToInsert });\n\n      const { error: insertError } = await supabase\n        .from('purchase_request_items')\n        .insert(itemsToInsert);\n\n      if (insertError) {\n        logger.error('ÌíàÎ™© ÏÇΩÏûÖ Ïã§Ìå®', insertError);\n        throw insertError;\n      }\n\n      // Ï¥ùÍ∏àÏï° ÏóÖÎç∞Ïù¥Ìä∏\n      const totalAmount = editingItems.reduce((sum, item) => sum + (Number(item.amount_value) || 0), 0);\n      const { error: updateError } = await supabase\n        .from('purchase_requests')\n        .update({ total_amount: totalAmount })\n        .eq('id', purchase.id);\n\n      if (updateError) {\n        logger.error('Ï¥ùÍ∏àÏï° ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®', updateError);\n        throw updateError;\n      }\n\n      logger.debug('ÌíàÎ™© Ï†ÄÏû• ÏôÑÎ£å');\n      toast.success('ÌíàÎ™©Ïù¥ ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§.');\n      setIsEditing(false);\n      onUpdate();\n      onClose();\n    } catch (error) {\n      logger.error('ÌíàÎ™© Ï†ÄÏû• Ï§ë Ïò§Î•ò', error);\n      toast.error(`Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ${error instanceof Error ? error.message : error}`);\n    }\n  };\n  \n  const items = isEditing ? editingItems : editingItems;\n  const totalAmount = items.reduce((sum, item) => sum + (item.amount_value || 0), 0);\n  \n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"w-full max-w-[95vw] max-h-[90vh] overflow-hidden flex flex-col bg-white p-3 sm:p-6\">\n        <DialogHeader className=\"flex-shrink-0\">\n          <div className=\"flex items-center justify-between\">\n            <DialogTitle className=\"modal-title\">\n              Î∞úÏ£º ÏÉÅÏÑ∏ Ìï≠Î™© - {purchase.purchase_order_number}\n            </DialogTitle>\n            <div className=\"flex items-center gap-2\">\n              {isAdmin && !isEditing && (\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={handleEditStart}\n                >\n                  <Edit2 className=\"h-4 w-4 mr-1\" />\n                  Ìé∏Ïßë\n                </Button>\n              )}\n              {isEditing && (\n                <>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={handleAddItem}\n                  >\n                    <Plus className=\"h-4 w-4 mr-1\" />\n                    ÌíàÎ™© Ï∂îÍ∞Ä\n                  </Button>\n                  <Button\n                    variant=\"default\"\n                    size=\"sm\"\n                    onClick={handleSave}\n                  >\n                    <Save className=\"h-4 w-4 mr-1\" />\n                    Ï†ÄÏû•\n                  </Button>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={handleEditCancel}\n                  >\n                    Ï∑®ÏÜå\n                  </Button>\n                </>\n              )}\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                onClick={onClose}\n                className=\"h-6 w-6\"\n              >\n                <X className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </div>\n        </DialogHeader>\n        \n        <div className=\"flex-shrink-0 grid grid-cols-2 md:grid-cols-4 gap-3 py-3 border-b\">\n          <div>\n            <p className=\"modal-label\">ÏóÖÏ≤¥Î™Ö</p>\n            <p className=\"modal-value\">{purchase.vendor_name}</p>\n          </div>\n          <div>\n            <p className=\"modal-label\">ÏöîÏ≤≠Ïûê</p>\n            <p className=\"modal-value\">{purchase.requester_name}</p>\n          </div>\n          <div>\n            <p className=\"modal-label\">ÌîÑÎ°úÏ†ùÌä∏</p>\n            <p className=\"modal-value truncate\" title={purchase.project_vendor}>\n              {purchase.project_vendor}\n            </p>\n          </div>\n          <div>\n            <p className=\"modal-label\">ÎÇ©Í∏∞Ïùº</p>\n            <p className=\"modal-value\">\n              {purchase.delivery_request_date && \n                format(new Date(purchase.delivery_request_date), 'yyyy-MM-dd')}\n            </p>\n          </div>\n        </div>\n        \n        <div className=\"flex-1 overflow-hidden\">\n          <div className=\"w-full h-full overflow-x-auto overflow-y-auto\" style={{ maxHeight: '60vh' }}>\n            <Table className=\"min-w-[800px] w-full\">\n            <TableHeader className=\"sticky top-0 bg-white z-10\">\n              <TableRow>\n                <TableHead className=\"w-12\">No.</TableHead>\n                <TableHead>ÌíàÎ™©</TableHead>\n                <TableHead>Í∑úÍ≤©</TableHead>\n                <TableHead className=\"text-right\">ÏàòÎüâ</TableHead>\n                <TableHead className=\"text-right\">Îã®Í∞Ä</TableHead>\n                <TableHead className=\"text-right\">Í∏àÏï°</TableHead>\n                {activeTab === 'purchase' && (\n                  <TableHead>Íµ¨Îß§ÏÉÅÌÉú</TableHead>\n                )}\n                {(activeTab === 'receipt' || activeTab === 'done') && (\n                  <TableHead>ÏûÖÍ≥†ÏÉÅÌÉú</TableHead>\n                )}\n                {activeTab === 'done' && (\n                  <>\n                    <TableHead className=\"text-center\">Í±∞ÎûòÎ™ÖÏÑ∏ÏÑú ÌôïÏù∏</TableHead>\n                    <TableHead className=\"text-center\">ÌöåÍ≥ÑÏÉÅ ÏûÖÍ≥†Ïùº</TableHead>\n                    <TableHead className=\"text-center\">Ï≤òÎ¶¨Ïûê</TableHead>\n                  </>\n                )}\n                {activeTab === 'receipt' && (\n                  <TableHead className=\"text-center\">Ïã§Ï†ú ÏûÖÍ≥†Ïùº</TableHead>\n                )}\n                <TableHead>ÎπÑÍ≥†</TableHead>\n                {isEditing && <TableHead className=\"w-20\">ÏÇ≠Ï†ú</TableHead>}\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {(isEditing ? editingItems : items).map((item, index) => (\n                <TableRow key={item.id || index}>\n                  <TableCell className=\"modal-value\">{item.line_number || index + 1}</TableCell>\n                  <TableCell>\n                    {isEditing ? (\n                      <Input\n                        value={item.item_name}\n                        onChange={(e) => handleItemChange(index, 'item_name', e.target.value)}\n                        className=\"h-7 modal-label\"\n                      />\n                    ) : (\n                      <div className=\"sm:max-w-[200px]\">\n                        <p className=\"modal-value truncate\" title={item.item_name}>\n                          {item.item_name}\n                        </p>\n                      </div>\n                    )}\n                  </TableCell>\n                  <TableCell>\n                    {isEditing ? (\n                      <Input\n                        value={item.specification}\n                        onChange={(e) => handleItemChange(index, 'specification', e.target.value)}\n                        className=\"h-7 modal-label\"\n                      />\n                    ) : (\n                      <div className=\"sm:max-w-[150px] truncate\" title={item.specification}>\n                        {item.specification}\n                      </div>\n                    )}\n                  </TableCell>\n                  <TableCell className=\"text-right\">\n                    {isEditing ? (\n                      <Input\n                        type=\"number\"\n                        value={item.quantity}\n                        onChange={(e) => handleItemChange(index, 'quantity', e.target.value)}\n                        className=\"h-7 text-xs text-right\"\n                      />\n                    ) : (\n                      <div className=\"text-right\">\n                        <span className=\"modal-value text-right\" style={{display: 'block', textAlign: 'right'}}>{item.quantity.toLocaleString()}</span>\n                      </div>\n                    )}\n                  </TableCell>\n                  <TableCell className=\"text-right\">\n                    {isEditing ? (\n                      <Input\n                        type=\"number\"\n                        value={item.unit_price_value}\n                        onChange={(e) => handleItemChange(index, 'unit_price_value', e.target.value)}\n                        className=\"h-7 text-xs text-right\"\n                      />\n                    ) : (\n                      <div className=\"text-right\">\n                        <span className=\"modal-subtitle text-right\" style={{display: 'block', textAlign: 'right'}}>{(item.unit_price_value || 0).toLocaleString()} {purchase.currency}</span>\n                      </div>\n                    )}\n                  </TableCell>\n                  <TableCell className=\"text-right\">\n                    {isEditing ? (\n                      <Input\n                        type=\"number\"\n                        value={item.amount_value}\n                        onChange={(e) => handleItemChange(index, 'amount_value', e.target.value)}\n                        className=\"h-7 modal-label text-right\"\n                      />\n                    ) : (\n                      <div className=\"text-right\">\n                        <span className=\"modal-value text-right\" style={{display: 'block', textAlign: 'right'}}>{(item.amount_value || 0).toLocaleString()} {purchase.currency}</span>\n                      </div>\n                    )}\n                  </TableCell>\n                  {activeTab === 'purchase' && (\n                    <TableCell>\n                      {/* Íµ¨Îß§ÏÉÅÌÉú - Íµ¨Îß§ÏôÑÎ£å/Ï∑®ÏÜå Î≤ÑÌäº */}\n                      {canReceiptCheck ? (\n                        item.is_payment_completed ? (\n                          <button\n                            onClick={async () => {\n                              try {\n                                logger.debug('Íµ¨Îß§Ï∑®ÏÜå Î≤ÑÌäº ÌÅ¥Î¶≠', { \n                                  itemId: item.id,\n                                  itemName: item.item_name,\n                                  currentStatus: item.is_payment_completed \n                                });\n\n                                if (!item.id) {\n                                  throw new Error('ÌíàÎ™© IDÍ∞Ä ÏóÜÏäµÎãàÎã§.');\n                                }\n\n                                const { error, data } = await supabase\n                                  .from('purchase_request_items')\n                                  .update({ is_payment_completed: false })\n                                  .eq('id', item.id)\n                                  .select();\n                                \n                                if (error) {\n                                  logger.error('Íµ¨Îß§Ï∑®ÏÜå ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®', error);\n                                  throw error;\n                                }\n\n                                logger.debug('Íµ¨Îß§Ï∑®ÏÜå ÏóÖÎç∞Ïù¥Ìä∏ ÏÑ±Í≥µ', { data });\n                                toast.success('Íµ¨Îß§ Ï∑®ÏÜå Ï≤òÎ¶¨ÎêòÏóàÏäµÎãàÎã§.');\n                                await refreshModalData();\n                              } catch (error) {\n                                logger.error('Íµ¨Îß§Ï∑®ÏÜå Ï≤òÎ¶¨ Ï§ë Ïò§Î•ò', error);\n                                toast.error(`Ï≤òÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ${error instanceof Error ? error.message : error}`);\n                              }\n                            }}\n                            className=\"button-base bg-green-500 hover:bg-green-600 text-white transition-colors\"\n                            title=\"ÌÅ¥Î¶≠ÌïòÏó¨ Íµ¨Îß§ Ï∑®ÏÜå\"\n                          >\n                            Íµ¨Îß§ÏôÑÎ£å\n                          </button>\n                        ) : (\n                          <button\n                            onClick={async () => {\n                              try {\n                                logger.debug('Íµ¨Îß§ÏôÑÎ£å Î≤ÑÌäº ÌÅ¥Î¶≠', { \n                                  itemId: item.id,\n                                  itemName: item.item_name,\n                                  currentStatus: item.is_payment_completed \n                                });\n\n                                if (!item.id) {\n                                  throw new Error('ÌíàÎ™© IDÍ∞Ä ÏóÜÏäµÎãàÎã§.');\n                                }\n\n                                const { error, data } = await supabase\n                                  .from('purchase_request_items')\n                                  .update({ is_payment_completed: true })\n                                  .eq('id', item.id)\n                                  .select();\n                                \n                                if (error) {\n                                  logger.error('Íµ¨Îß§ÏôÑÎ£å ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®', error);\n                                  throw error;\n                                }\n\n                                logger.debug('Íµ¨Îß§ÏôÑÎ£å ÏóÖÎç∞Ïù¥Ìä∏ ÏÑ±Í≥µ', { data });\n                                toast.success('Íµ¨Îß§ÏôÑÎ£å Ï≤òÎ¶¨ÎêòÏóàÏäµÎãàÎã§.');\n                                await refreshModalData();\n                              } catch (error) {\n                                logger.error('Íµ¨Îß§ÏôÑÎ£å Ï≤òÎ¶¨ Ï§ë Ïò§Î•ò', error);\n                                toast.error(`Ï≤òÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ${error instanceof Error ? error.message : error}`);\n                              }\n                            }}\n                            className=\"button-base border border-gray-300 text-gray-600 bg-white hover:bg-gray-50\"\n                          >\n                            Íµ¨Îß§ÎåÄÍ∏∞\n                          </button>\n                        )\n                      ) : (\n                        <span className={`button-base ${\n                          item.is_payment_completed\n                            ? 'bg-green-500 text-white' \n                            : 'border border-gray-300 text-gray-400 bg-white'\n                        }`}>\n                          {item.is_payment_completed ? 'Íµ¨Îß§ÏôÑÎ£å' : 'Íµ¨Îß§ÎåÄÍ∏∞'}\n                        </span>\n                      )}\n                    </TableCell>\n                  )}\n                  {(activeTab === 'receipt' || activeTab === 'done') && (\n                    <TableCell>\n                      {/* ÏûÖÍ≥†ÌòÑÌô© ÌÉ≠ÏóêÏÑúÎäî Ïã§Ï†ú ÏûÖÍ≥† ÎÇ†Ïßú Í∏∞Îä• ÏÇ¨Ïö© */}\n                      {activeTab === 'receipt' ? (\n                        canReceiptCheck ? (\n                          actualReceivedAction.isCompleted(item) ? (\n                            <button\n                              onClick={() => {\n                                actualReceivedAction.handleCancel(item.id!, {\n                                  item_name: item.item_name,\n                                  specification: item.specification,\n                                  quantity: item.quantity,\n                                  unit_price_value: item.unit_price_value,\n                                  amount_value: item.amount_value,\n                                  remark: item.remark\n                                })\n                              }}\n                              className=\"button-base bg-green-500 hover:bg-green-600 text-white transition-colors\"\n                              title=\"ÌÅ¥Î¶≠ÌïòÏó¨ Ïã§Ï†ú ÏûÖÍ≥† Ï≤òÎ¶¨ Ï∑®ÏÜå\"\n                            >\n                              {actualReceivedAction.config.completedText}\n                            </button>\n                          ) : (\n                            <DatePickerPopover\n                              onDateSelect={(date) => {\n                                actualReceivedAction.handleConfirm(item.id!, date, {\n                                  item_name: item.item_name,\n                                  specification: item.specification,\n                                  quantity: item.quantity,\n                                  unit_price_value: item.unit_price_value,\n                                  amount_value: item.amount_value,\n                                  remark: item.remark\n                                })\n                              }}\n                              placeholder=\"Ïã§Ï†ú ÏûÖÍ≥† ÎÇ†Ïßú ÏÑ†ÌÉù\"\n                            >\n                              <Button \n                                variant=\"outline\" \n                                size=\"sm\"\n                                className=\"button-base border border-gray-300 text-gray-600 bg-white hover:bg-gray-50\"\n                              >\n                                {actualReceivedAction.config.waitingText}\n                              </Button>\n                            </DatePickerPopover>\n                          )\n                        ) : (\n                          <span className={`button-base ${\n                            actualReceivedAction.isCompleted(item)\n                              ? 'bg-green-500 text-white' \n                              : 'border border-gray-300 text-gray-400 bg-white'\n                          }`}>\n                            {actualReceivedAction.isCompleted(item) ? actualReceivedAction.config.completedText : actualReceivedAction.config.waitingText}\n                          </span>\n                        )\n                      ) : (\n                        /* Ï†ÑÏ≤¥Ìï≠Î™© ÌÉ≠ÏóêÏÑúÎäî ÏÉÅÌÉú ÌëúÏãúÎßå */\n                        <span className={`button-base ${\n                          actualReceivedAction.isCompleted(item)\n                            ? 'bg-green-500 text-white' \n                            : 'border border-gray-300 text-gray-600 bg-white'\n                        }`}>\n                          {actualReceivedAction.isCompleted(item) ? actualReceivedAction.config.completedText : actualReceivedAction.config.waitingText}\n                        </span>\n                      )}\n                    </TableCell>\n                  )}\n                  {activeTab === 'receipt' && (\n                    <TableCell className=\"text-center\">\n                      {actualReceivedAction.getCompletedDate(item) ? (\n                        <span className=\"modal-subtitle text-green-600\">\n                          {format(new Date(actualReceivedAction.getCompletedDate(item)), 'yyyy-MM-dd HH:mm')}\n                        </span>\n                      ) : (\n                        <span className=\"modal-subtitle\">-</span>\n                      )}\n                    </TableCell>\n                  )}\n                  {activeTab === 'done' && (\n                    <>\n                      <TableCell className=\"text-center\">\n                        {canReceiptCheck ? (\n                          statementReceivedAction.isCompleted(item) ? (\n                            <button\n                              onClick={() => {\n                                statementReceivedAction.handleCancel(item.id!, {\n                                  item_name: item.item_name,\n                                  specification: item.specification,\n                                  quantity: item.quantity,\n                                  unit_price_value: item.unit_price_value,\n                                  amount_value: item.amount_value,\n                                  remark: item.remark\n                                })\n                              }}\n                              className=\"button-base bg-green-500 hover:bg-green-600 text-white transition-colors\"\n                              title=\"ÌÅ¥Î¶≠ÌïòÏó¨ Í±∞ÎûòÎ™ÖÏÑ∏ÏÑú ÌôïÏù∏ Ï∑®ÏÜå\"\n                            >\n                              {statementReceivedAction.config.completedText}\n                            </button>\n                          ) : (\n                            <DatePickerPopover\n                              onDateSelect={(date) => {\n                                statementReceivedAction.handleConfirm(item.id!, date, {\n                                  item_name: item.item_name,\n                                  specification: item.specification,\n                                  quantity: item.quantity,\n                                  unit_price_value: item.unit_price_value,\n                                  amount_value: item.amount_value,\n                                  remark: item.remark\n                                })\n                              }}\n                              placeholder=\"ÎÇ†Ïßú ÏÑ†ÌÉù\"\n                            >\n                              <Button \n                                variant=\"outline\" \n                                size=\"sm\"\n                                className=\"button-base border border-gray-300 text-gray-600 bg-white hover:bg-gray-50\"\n                              >\n                                {statementReceivedAction.config.waitingText}\n                              </Button>\n                            </DatePickerPopover>\n                          )\n                        ) : (\n                          <span className={`button-base ${\n                            statementReceivedAction.isCompleted(item)\n                              ? 'bg-green-500 text-white' \n                              : 'border border-gray-300 text-gray-400 bg-white'\n                          }`}>\n                            {statementReceivedAction.isCompleted(item) ? statementReceivedAction.config.completedText : statementReceivedAction.config.waitingText}\n                          </span>\n                        )}\n                      </TableCell>\n                      <TableCell className=\"text-center\">\n                        {statementReceivedAction.getCompletedDate(item) ? (\n                          <span className=\"modal-subtitle\">\n                            {format(new Date(statementReceivedAction.getCompletedDate(item)), 'yyyy-MM-dd')}\n                          </span>\n                        ) : (\n                          <span className=\"modal-subtitle\">-</span>\n                        )}\n                      </TableCell>\n                      <TableCell className=\"text-center\">\n                        {statementReceivedAction.getCompletedByName(item) ? (\n                          <span className=\"modal-subtitle\">\n                            {statementReceivedAction.getCompletedByName(item)}\n                          </span>\n                        ) : (\n                          <span className=\"modal-subtitle\">-</span>\n                        )}\n                      </TableCell>\n                    </>\n                  )}\n                  <TableCell>\n                    {isEditing ? (\n                      <Input\n                        value={item.remark || ''}\n                        onChange={(e) => handleItemChange(index, 'remark', e.target.value)}\n                        className=\"h-7 modal-label\"\n                        placeholder=\"ÎπÑÍ≥†\"\n                      />\n                    ) : (\n                      <div className=\"sm:max-w-[150px]\">\n                        <span className=\"modal-subtitle truncate block\" title={item.remark}>\n                          {item.remark || '-'}\n                        </span>\n                      </div>\n                    )}\n                  </TableCell>\n                  {isEditing && (\n                    <TableCell>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        onClick={() => handleDeleteItem(index)}\n                        className=\"h-7 w-7 text-red-500 hover:text-red-700\"\n                      >\n                        <Trash2 className=\"h-4 w-4\" />\n                      </Button>\n                    </TableCell>\n                  )}\n                </TableRow>\n              ))}\n            </TableBody>\n            </Table>\n          </div>\n        </div>\n        \n        <div className=\"flex-shrink-0 border-t pt-4 flex justify-between items-center\">\n          <div className=\"modal-subtitle\">\n            Ï¥ù {items.length}Í∞ú ÌíàÎ™©\n          </div>\n          <div className=\"modal-value-large\">\n            Ï¥ù Í∏àÏï°: {totalAmount.toLocaleString()} {purchase.currency}\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}"],"names":["PurchaseItemsModal","isOpen","onClose","purchase","isAdmin","onUpdate","activeTab","editingItems","setEditingItems","useState","items","isEditing","setIsEditing","currentUserName","setCurrentUserName","viewportSize","setViewportSize","width","height","supabase","createClient","useEffect","updateViewportSize","window","innerWidth","innerHeight","addEventListener","removeEventListener","tableMaxWidth","useMemo","availableWidth","Math","max","min","async","data","user","auth","getUser","email","employeeData","from","select","eq","single","name","id","freshItems","order","error","logger","loadData","isRequester","requester_name","canReceiptCheck","debug","purchaseRequesterName","viewportWidth","viewportHeight","modalWidth","refreshModalData","useCallback","statementReceivedAction","useConfirmDateAction","config","field","confirmMessage","confirm","cancel","successMessage","completedText","waitingText","canPerformAction","actualReceivedAction","handleItemChange","index","value","newItems","Number","quantity","unitPrice","unit_price_value","amount_value","totalAmount","reduce","sum","item","jsx","Dialog","open","onOpenChange","children","jsxs","DialogContent","className","DialogHeader","DialogTitle","purchase_order_number","Button","variant","size","onClick","Edit2","Fragment","newItem","line_number","lineNum","item_name","specification","remark","is_received","sort","a","b","Plus","length","purchaseId","filter","trim","toast","deleteError","delete","itemsToInsert","map","purchase_request_id","link","delivery_status","insertError","insert","updateError","update","total_amount","success","Error","message","Save","X","vendor_name","title","project_vendor","delivery_request_date","format","Date","style","maxHeight","Table","TableHeader","TableRow","TableHead","TableBody","TableCell","Input","onChange","e","target","type","display","textAlign","toLocaleString","currency","is_payment_completed","itemId","itemName","currentStatus","isCompleted","handleCancel","DatePickerPopover","onDateSelect","date","handleConfirm","placeholder","getCompletedDate","getCompletedByName","_","i","handleDeleteItem","Trash2"],"mappings":"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"}