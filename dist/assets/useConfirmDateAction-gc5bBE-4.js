import{r as e,j as t,l as a,a as r}from"./index-B-4QaAWl.js";import{a as i,k as n}from"./calendar-DOt1QLPg.js";import{P as d,a as c,b as o}from"./popover-D7IjkJ0T.js";import{t as s}from"./index-WxoWdzcK.js";function l({children:r,onDateSelect:s,disabled:l=!1,placeholder:m="ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”",align:u="center",side:f="bottom"}){const[_,g]=e.useState(!1);return t.jsxs(d,{open:_,onOpenChange:g,children:[t.jsx(c,{asChild:!0,disabled:l,children:r}),t.jsx(o,{className:"w-auto p-0 border-gray-200 shadow-lg",align:u,side:f,sideOffset:8,children:t.jsxs("div",{className:"bg-white business-radius-card p-2",children:[t.jsx("div",{className:"mb-2 px-1",children:t.jsx("div",{className:"modal-label text-gray-600 text-center",children:m})}),t.jsx(i,{mode:"single",selected:void 0,onSelect:e=>{a.debug("ðŸ—“ï¸ Calendar onSelect ì§ì ‘ í˜¸ì¶œ:",{date:e,isToday:e&&(new Date).toDateString()===e.toDateString(),dateValue:e?.getTime(),todayValue:(new Date).getTime()}),(e=>{a.debug("ðŸ“… DatePickerPopover handleDateSelect í˜¸ì¶œ:",{date:e,isToday:e&&(new Date).toDateString()===e.toDateString(),dateString:e?.toDateString(),todayString:(new Date).toDateString()}),e?(a.debug("âœ… ë‚ ì§œ ì„ íƒë¨, onDateSelect í˜¸ì¶œ ì˜ˆì •"),s(e),g(!1),a.debug("ðŸ”š DatePickerPopover ì²˜ë¦¬ ì™„ë£Œ")):a.debug("âŒ ë‚ ì§œê°€ undefinedìž„")})(e)},locale:n,initialFocus:!0,className:"compact-calendar",disabled:!1,fromDate:new Date("2020-01-01"),toDate:new Date("2030-12-31"),defaultMonth:new Date,modifiers:{today:new Date},modifiersClassNames:{today:"bg-blue-500 text-white font-semibold cursor-pointer hover:bg-blue-600 rounded-md"}})]})})]})}function m({config:t,currentUserName:i,canPerformAction:n,onUpdate:d,onOptimisticUpdate:c}){const o=r(),l=e.useCallback(async(e,r,l)=>{if(!n)return a.warn("âŒ ê¶Œí•œ ì—†ìŒ",{canPerformAction:n,currentUserName:i}),void s.error(("statement_received"===t.field?"ê±°ëž˜ëª…ì„¸ì„œ":"ìž…ê³ ")+" í™•ì¸ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");const m="number"==typeof e?e:Number(e);if(Number.isNaN(m))return a.error("âŒ ìž˜ëª»ëœ ID",{itemId:e,numericId:m}),void s.error("ìœ íš¨í•˜ì§€ ì•Šì€ í•­ëª© ID ìž…ë‹ˆë‹¤.");if(l){const e=`í’ˆëª©ëª…: ${l.item_name||"-"}\nê·œê²©: ${l.specification||"-"}\nìˆ˜ëŸ‰: ${l.quantity?.toLocaleString()||0}\në‹¨ê°€: â‚©${l.unit_price_value?.toLocaleString()||0}\ní•©ê³„: â‚©${l.amount_value?.toLocaleString()||0}\në¹„ê³ : ${l.remark||"-"}\n\n${t.confirmMessage.confirm}`;if(!window.confirm(e))return}try{let e;"statement_received"===t.field?e={is_statement_received:!0,statement_received_date:r.toISOString(),statement_received_by_name:i}:"actual_received"===t.field&&(e={actual_received_date:r.toISOString()}),a.debug("ðŸ“ ì—…ë°ì´íŠ¸í•  ë°ì´í„°:",e);const{data:n,error:u}=await o.from("purchase_request_items").update(e).eq("id",m).select();if(a.debug("ðŸ“ DB ì—…ë°ì´íŠ¸ ê²°ê³¼:",{data:n,error:u}),u)throw a.error("âŒ DB ì—…ë°ì´íŠ¸ ì‹¤íŒ¨",u),u;a.info("âœ… DB ì—…ë°ì´íŠ¸ ì„±ê³µ",n),c&&c({itemId:m,selectedDate:r,action:"confirm",itemInfo:l}),d&&d(),s.success(t.successMessage.confirm)}catch(u){a.error("âŒ ì „ì²´ ì²˜ë¦¬ ì‹¤íŒ¨",u),s.error(("statement_received"===t.field?"ê±°ëž˜ëª…ì„¸ì„œ":"ìž…ê³ ")+" í™•ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},[t,i,n,d,c,o]),m=e.useCallback(async(e,r)=>{if(!n)return a.warn("âŒ ì·¨ì†Œ ê¶Œí•œ ì—†ìŒ",{canPerformAction:n,currentUserName:i}),void s.error(("statement_received"===t.field?"ê±°ëž˜ëª…ì„¸ì„œ":"ìž…ê³ ")+" í™•ì¸ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");const l="number"==typeof e?e:Number(e);if(Number.isNaN(l))s.error("ìœ íš¨í•˜ì§€ ì•Šì€ í•­ëª© ID ìž…ë‹ˆë‹¤.");else{if(r){const e=`í’ˆëª©ëª…: ${r.item_name||"-"}\nê·œê²©: ${r.specification||"-"}\nìˆ˜ëŸ‰: ${r.quantity?.toLocaleString()||0}\në‹¨ê°€: â‚©${r.unit_price_value?.toLocaleString()||0}\ní•©ê³„: â‚©${r.amount_value?.toLocaleString()||0}\në¹„ê³ : ${r.remark||"-"}\n\n${t.confirmMessage.cancel}`;if(!window.confirm(e))return}try{let i;a.debug(`ðŸ”„ ${t.field} í™•ì¸ ì·¨ì†Œ ì‹œìž‘`,{itemId:e,itemName:r?.item_name}),"statement_received"===t.field?i={is_statement_received:!1,statement_received_date:null,statement_received_by_name:null}:"actual_received"===t.field&&(i={actual_received_date:null}),a.debug("ðŸ”„ ì·¨ì†Œ ì—…ë°ì´íŠ¸í•  ë°ì´í„°:",i);const{data:n,error:m}=await o.from("purchase_request_items").update(i).eq("id",l).select();if(a.debug("ðŸ”„ ì·¨ì†Œ DB ì—…ë°ì´íŠ¸ ê²°ê³¼:",{data:n,error:m}),m)throw a.error("âŒ DB ì—…ë°ì´íŠ¸ ì‹¤íŒ¨",m),m;a.info(`âœ… ${t.field} í™•ì¸ ì·¨ì†Œ ì„±ê³µ`,n),c&&c({itemId:l,action:"cancel",itemInfo:r}),d&&d(),s.success(t.successMessage.cancel)}catch(m){a.error(`âŒ ${t.field} í™•ì¸ ì·¨ì†Œ ì‹¤íŒ¨`,m),s.error(("statement_received"===t.field?"ê±°ëž˜ëª…ì„¸ì„œ":"ìž…ê³ ")+" í™•ì¸ ì·¨ì†Œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}}},[t,n,d,c,o]),u=e.useCallback(e=>"statement_received"===t.field?e.is_statement_received:"actual_received"===t.field&&!!e.actual_received_date,[t.field]),f=e.useCallback(e=>"statement_received"===t.field?e.statement_received_date:"actual_received"===t.field?e.actual_received_date:null,[t.field]),_=e.useCallback(e=>"statement_received"===t.field?e.statement_received_by_name:(t.field,null),[t.field]);return{config:t,handleConfirm:l,handleCancel:m,isCompleted:u,getCompletedDate:f,getCompletedByName:_}}export{l as D,m as u};
//# sourceMappingURL=useConfirmDateAction-gc5bBE-4.js.map
