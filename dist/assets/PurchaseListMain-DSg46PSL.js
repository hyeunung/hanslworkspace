const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PurchaseDetailModal-DFSq3uwl.js","assets/index-BBqlRFcp.js","assets/index-Dlw3QP5I.css","assets/helpers-CsHcdtkA.js","assets/chevron-right-C4qk5A-c.js","assets/chevron-down-CJqBJprP.js","assets/popover-Dtg6OeLr.js","assets/dialog-CUL_r7q0.js","assets/textarea-DxEeqYlW.js","assets/index-BwPoDD6m.js","assets/react-select.esm-Dql5RJUW.js","assets/calendar-5LoKqPi-.js","assets/check-DrHAfXhs.js","assets/credit-card-D1QBxTV5.js","assets/card-BnaOJBOj.js","assets/loader-circle-yVa5C846.js","assets/save-uKwyxrbO.js","assets/PurchaseItemsModal-BtjDgQ39.js"])))=>i.map(i=>d[i]);
import{c as e,l as t,p as a,r as s,d as r,a as n,j as l,B as i,R as c,X as d,f as o,U as u,P as m,e as p,n as h,g as x,_ as g,u as _,h as y,k as b,o as f,m as j,q as v,s as w}from"./index-BBqlRFcp.js";import{t as N}from"./index-BwPoDD6m.js";import{D as k,a as C,R as q,b as $,A as S,P as M,c as D,C as P,f as I,d as F,M as T}from"./PurchaseDetailModal-DFSq3uwl.js";import{D as E,a as R,b as O,c as L,d as U,A as z}from"./dropdown-menu-CMpT0xSh.js";import{R as V}from"./rotate-ccw-B2HzKviO.js";import{E as B}from"./eye-MxCi1oSo.js";import{C as A}from"./check-DrHAfXhs.js";import{f as W}from"./helpers-CsHcdtkA.js";import{g as Y}from"./excelDownload-CTQVGsiz.js";import{A as J,a as H,b as K,c as Z,d as Q,e as G,f as X,g as ee}from"./alert-dialog-DNMoSUJ2.js";import{I as te,D as ae,a as se,b as re,c as ne,L as le}from"./dialog-CUL_r7q0.js";import{P as ie,a as ce,b as de}from"./popover-Dtg6OeLr.js";import{S as oe,a as ue,b as me,c as pe,d as he}from"./select-ClJeBd6X.js";import{C as xe}from"./calendar-5LoKqPi-.js";import{S as ge,C as _e,a as ye,b as be,c as fe}from"./card-BnaOJBOj.js";import{P as je,B as ve}from"./badge-BgwWRtJE.js";import{T as we}from"./textarea-DxEeqYlW.js";import{L as Ne}from"./loader-circle-yVa5C846.js";import"./chevron-right-C4qk5A-c.js";import"./chevron-down-CJqBJprP.js";import"./react-select.esm-Dql5RJUW.js";import"./credit-card-D1QBxTV5.js";import"./save-uKwyxrbO.js";
/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=e("building",[["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3",key:"cabbwy"}],["rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",key:"1uxh74"}]]),Ce=e("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),qe=e("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),$e=e("sliders-vertical",[["line",{x1:"4",x2:"4",y1:"21",y2:"14",key:"1p332r"}],["line",{x1:"4",x2:"4",y1:"10",y2:"3",key:"gb41h5"}],["line",{x1:"12",x2:"12",y1:"21",y2:"12",key:"hf2csr"}],["line",{x1:"12",x2:"12",y1:"8",y2:"3",key:"1kfi7u"}],["line",{x1:"20",x2:"20",y1:"21",y2:"16",key:"1lhrwl"}],["line",{x1:"20",x2:"20",y1:"12",y2:"3",key:"16vvfq"}],["line",{x1:"2",x2:"6",y1:"14",y2:"14",key:"1uebub"}],["line",{x1:"10",x2:"14",y1:"8",y2:"8",key:"1yglbp"}],["line",{x1:"18",x2:"22",y1:"16",y2:"16",key:"1jxqpz"}]]),Se=e("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Me=["ì •í¬ì›…"],De=["item_name","item_detail","specification","spec","quantity","unit_price","unit_price_value","unit_price_currency","amount","amount_value","amount_currency","manufacturer","model","remark","link"],Pe=(e,a,s)=>{if(!e||!s)return[];const r=Array.isArray(s.purchase_role)?s.purchase_role.map(e=>e.trim()):"string"==typeof s.purchase_role?s.purchase_role.split(",").map(e=>e.trim()):[];switch(a){case"pending":return e.filter(e=>{if("approved"===e.middle_manager_status&&"approved"===e.final_manager_status)return!1;if("rejected"===e.middle_manager_status||"rejected"===e.final_manager_status)return!1;if(r.includes("consumable_manager")&&"êµ¬ë§¤ ìš”ì²­"!==e.payment_category)return!1;if(r.includes("raw_material_manager")&&"ë°œì£¼"!==e.payment_category)return!1;if(r.includes("app_admin")||r.includes("ceo"))return t.debug("ğŸ”¥ App Admin detected! Showing all items for:",{purchase_order_number:e.purchase_order_number}),!0;if(r.includes("middle_manager")){return["pending","ëŒ€ê¸°","",null,void 0].includes(e.middle_manager_status)}return e.requester_name===s?.name});case"purchase":{const t=r.some(e=>["app_admin","ceo","lead buyer","finance_team","raw_material_manager","consumable_manager","purchase_manager","hr"].includes(e));return e.filter(e=>{const a="êµ¬ë§¤ ìš”ì²­"===e.payment_category,r=!e.is_payment_completed;if(!a||!r)return!1;const n=(e.progress_type||"").includes("ì„ ì§„í–‰"),l=(e.progress_type||"").includes("ì¼ë°˜")||!e.progress_type||""===e.progress_type,i="approved"===e.final_manager_status;return!!(n||l&&i)&&(!!t||e.requester_name===s?.name)})}case"receipt":{const t=r.includes("hr"),a=r.some(e=>["app_admin","ceo","finance_team","raw_material_manager","consumable_manager","purchase_manager"].includes(e));return e.filter(e=>{if(e.is_received)return!1;if(t||a){const t=(e.progress_type||"").includes("ì„ ì§„í–‰"),a="approved"===e.final_manager_status;return t||a}const r=(e.progress_type||"").includes("ì„ ì§„í–‰"),n="approved"===e.final_manager_status,l=e.requester_name===s?.name;return(r||n)&&l})}default:return e.filter(e=>"approved"===e.middle_manager_status&&"approved"===e.final_manager_status)}},Ie=(e,t,a)=>{if(null==e)return"is_empty"===t;switch(t){case"contains":return String(e).toLowerCase().includes(String(a).toLowerCase());case"equals":if("string"==typeof a&&a.includes("~")){if(!e)return!1;try{const[t,s]=a.split("~"),r=new Date(e).toISOString().split("T")[0];return r>=t&&r<=s}catch(s){return!1}}if("string"==typeof a&&(a.match(/^\d{4}-\d{2}$/)||a.match(/^\d{4}-\d{2}~\d{4}-\d{2}$/))){if(!e)return!1;try{if(a.includes("~")){const[t,s]=a.split("~"),r=new Date(e).toISOString().slice(0,7);return r>=t&&r<=s}return new Date(e).toISOString().slice(0,7)===a}catch(s){return!1}}return String(e).toLowerCase()===String(a).toLowerCase();case"not_equals":return e!==a;case"starts_with":return String(e).toLowerCase().startsWith(String(a).toLowerCase());case"ends_with":return String(e).toLowerCase().endsWith(String(a).toLowerCase());case"greater_than":return Number(e)>Number(a);case"less_than":return Number(e)<Number(a);case"after":return new Date(e)>new Date(a);case"before":return new Date(e)<new Date(a);case"is_empty":return!e||""===e||null===e;case"is_not_empty":return e&&""!==e&&null!==e;case"between":{const[t,s]=a.split(",").map(Number),r=Number(e);return r>=t&&r<=s}case"in":return a.split(",").map(e=>e.trim()).includes(String(e));default:return!0}},Fe=(e,t)=>{if("date_range"===t||"date_month"===t)return e.request_date;if("approval_status"===t)return"rejected"===e.middle_manager_status||"rejected"===e.final_manager_status?"ë°˜ë ¤":"approved"===e.middle_manager_status&&"approved"===e.final_manager_status?"ìµœì¢…ìŠ¹ì¸":"approved"===e.middle_manager_status&&"pending"===e.final_manager_status?"1ì°¨ìŠ¹ì¸":"ìŠ¹ì¸ëŒ€ê¸°";if("is_payment_completed"===t){return!0===e.is_payment_completed?"ì™„ë£Œ":"ëŒ€ê¸°"}if("is_received"===t){return!0===e.is_received?"ì™„ë£Œ":"ëŒ€ê¸°"}if("is_statement_received"===t){return!0===e.is_statement_received?"ì™„ë£Œ":"ëŒ€ê¸°"}if("is_utk_checked"===t){return!0===e.is_utk_checked?"ì™„ë£Œ":"ëŒ€ê¸°"}if("contact_name"===t)return e.contact_name||null;const a=t.split(".");let s=e;for(const r of a){if(null==s)return null;s=s[r]}return s},Te=(e,t)=>({pending:Pe(e,"pending",t).length,purchase:Pe(e,"purchase",t).length,receipt:Pe(e,"receipt",t).length,done:Pe(e,"done",t).length}),Ee=(e,t,a)=>{let s=e;return t.tab&&(s=Pe(s,t.tab,a)),t.employeeName&&(s=((e,t,a)=>{if(!e||!t||"ì „ì²´"===t)return e;const s=(Array.isArray(a?.purchase_role)?a.purchase_role.map(e=>e.trim()):"string"==typeof a?.purchase_role?a.purchase_role.split(",").map(e=>e.trim()):[]).some(e=>["lead buyer","ceo","finance_team","raw_material_manager","consumable_manager"].includes(e));return e.filter(e=>{const a=e.requester_name||"";return!(Me.includes(a)&&!s)&&a===t})})(s,t.employeeName,a)),t.searchTerm&&(s=((e,t)=>{if(!t||""===t.trim())return e;const a=t.toLowerCase().trim();return e.flatMap(e=>{const t=[e.purchase_order_number,e.requester_name,e.vendor_name,e.contact_name].some(e=>e&&String(e).toLowerCase().includes(a)),s=(e.purchase_request_items||[]).filter(e=>[e.item_name,e.item_detail,e.manufacturer,e.model,e.specification,e.spec].some(e=>e&&String(e).toLowerCase().includes(a)));return t&&0===s.length?[e]:s.length>0?s.map(t=>({...e,purchase_request_items:[t]})):[]})})(s,t.searchTerm)),t.advancedFilters&&(s=((e,t)=>t&&0!==t.length?t.some(e=>De.includes(e.field))?e.flatMap(e=>(e.purchase_request_items||[]).filter(a=>t.every(t=>{const{field:s,condition:r,value:n,dateField:l}=t,i=l||s;if(De.includes(i)){const e=a[i];return Ie(e,r,n)}const c=Fe(e,i);return Ie(c,r,n)})).map(t=>({...e,purchase_request_items:[t]}))):e.filter(e=>t.every(t=>{const{field:a,condition:s,value:r,dateField:n}=t,l=Fe(e,n||a);return Ie(l,s,r)})):e)(s,t.advancedFilters)),(t.startDate||t.endDate)&&(s=((e,t,a)=>t||a?e.filter(e=>{const s=new Date(e.request_date);return!(t&&s<new Date(t)||a&&s>new Date(a))}):e)(s,t.startDate,t.endDate)),t.sortConfig&&(s=((e,t)=>t?[...e].sort((e,a)=>{const s=Fe(e,t.key),r=Fe(a,t.key);if(null==s)return 1;if(null==r)return-1;let n=0;return s>r&&(n=1),s<r&&(n=-1),"desc"===t.direction?-n:n}):e)(s,t.sortConfig)),s};function Re(){const e=a.allPurchases?[...a.allPurchases]:[],t=!a.allPurchases&&a.isLoading,[n,l]=s.useState(e),[i,c]=s.useState(t),[d,o]=s.useState(a.error),u=s.useRef(a.lastFetch),m=a.currentUser;s.useEffect(()=>{const e=r(()=>{a.allPurchases?(l([...a.allPurchases]),c(!1)):c(a.isLoading),o(a.error),u.current=a.lastFetch});return a.allPurchases&&0===n.length&&(l([...a.allPurchases]),c(!1),u.current=a.lastFetch),()=>{e()}},[]);const p=s.useCallback(e=>a.allPurchases?Ee(a.allPurchases,e,m):[],[m]),h=s.useMemo(()=>n&&0!==n.length?Te(n,m):{pending:0,purchase:0,receipt:0,done:0},[n,m]),x=s.useMemo(()=>({total:n.length,loaded:a.stats?.loadedCount||0,memoryUsage:a.stats?.memoryUsage||0,lastFetch:a.lastFetch}),[n]);return{allPurchases:n,getFilteredPurchases:p,loading:i,error:d,tabCounts:h,stats:x,currentUser:m}}const Oe=s.memo(({isVisible:e=!0,className:t="",columnVisibility:a,applyColumnSettings:r,resetToDefault:n,isLoading:o=!1,currentUserRoles:u=[]})=>{const[m,p]=s.useState(a),[h,x]=s.useState(!1),g=e=>!$.includes(e)||u.some(e=>S.includes(e));if(s.useEffect(()=>{h&&p(a)},[h,a]),!e)return null;const _=Object.values(a).filter(Boolean).length,y=Object.keys(a).length,b=Object.values(m).filter(Boolean).length;return l.jsxs(E,{open:h,onOpenChange:x,children:[l.jsx(R,{asChild:!0,children:l.jsxs(i,{variant:"outline",size:"sm",className:`button-base ${t}`,disabled:o,children:[l.jsx(qe,{className:"w-4 h-4 mr-2"}),l.jsx("span",{className:"button-text",children:o?"ë¡œë”© ì¤‘...":`ì¹¼ëŸ¼ ì„¤ì • (${_}/${y})`})]})}),l.jsxs(O,{className:"w-[320px] overflow-x-hidden",align:"end",onInteractOutside:()=>{p(a),x(!1)},children:[l.jsxs("div",{className:"max-h-[min(600px,80vh)] overflow-y-auto overflow-x-hidden",children:[l.jsxs(L,{className:"flex items-center justify-between py-1.5",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"modal-section-title",children:"ì¹¼ëŸ¼ í‘œì‹œ ì„¤ì •"}),l.jsxs("span",{className:"card-description",children:["(",b,"/",y,")"]})]}),l.jsx(i,{variant:"ghost",size:"sm",onClick:()=>{n(),x(!1)},className:"h-5 px-1.5",title:"ê¸°ë³¸ê°’ìœ¼ë¡œ ì¬ì„¤ì •",children:l.jsx(V,{className:"w-3 h-3"})})]}),l.jsx(U,{}),C.map((e,t)=>l.jsxs(c.Fragment,{children:[l.jsx("div",{className:"px-3 py-1",children:l.jsx("div",{className:"modal-label",children:e.title})}),l.jsx("div",{className:"grid grid-cols-2 gap-x-1 px-2",children:e.columns.map(e=>{const t=m[e],a=q.includes(e),s=g(e);return l.jsxs("div",{className:"flex items-center gap-1 py-1 rounded overflow-hidden "+(s?a&&t?"opacity-75":"cursor-pointer hover:bg-gray-50":"opacity-50 cursor-not-allowed"),onClick:()=>{s&&(a&&t||(e=>{q.includes(e)&&m[e]||g(e)&&p(t=>({...t,[e]:!t[e]}))})(e))},title:s?"":"ì´ ì¹¼ëŸ¼ì„ ë³´ë ¤ë©´ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤",children:[l.jsx("div",{className:"p-0.5 "+(s?a&&t?"":"hover:bg-gray-100 rounded transition-colors":""),children:t?l.jsx(B,{className:"w-3.5 h-3.5 "+(s?"text-green-600":"text-gray-400")}):l.jsx(Ce,{className:"w-3.5 h-3.5 text-gray-400"})}),l.jsx("div",{className:"flex-1 min-w-0",children:l.jsxs("div",{className:"modal-value truncate "+(s?t?"":"text-gray-500":"text-gray-400"),children:[{statement_progress:"ê±°ë˜ëª…ì„¸ì„œ",purchase_order_number:"ë°œì£¼ë²ˆí˜¸",payment_category:"ê²°ì œì¢…ë¥˜",requester_name:"ìš”ì²­ì",request_date:"ì²­êµ¬ì¼",utk_status:"UTK",vendor_name:"ì—…ì²´",contact_name:"ë‹´ë‹¹ì",delivery_request_date:"ì…ê³ ìš”ì²­ì¼",revised_delivery_date:"ë³€ê²½ì…ê³ ì¼",item_name:"í’ˆëª…",specification:"ê·œê²©",quantity:"ìˆ˜ëŸ‰",unit_price:"ë‹¨ê°€",amount:"í•©ê³„",remark:"ë¹„ê³ ",link:"ë§í¬",project_vendor:"PJì—…ì²´",project_item:"PJ ITEM",sales_order_number:"ìˆ˜ì£¼ë²ˆí˜¸",purchase_progress:"êµ¬ë§¤ì§„í–‰",receipt_progress:"ì…ê³ ì§„í–‰",received_quantity:"ì‹¤ì œ ì…ê³ ìˆ˜ëŸ‰"}[e],a&&l.jsx("span",{className:"ml-1 text-red-500",title:"í•„ìˆ˜ ì¹¼ëŸ¼",children:"*"}),!s&&l.jsx("span",{className:"ml-1 text-gray-400",title:"ê¶Œí•œ í•„ìš”",children:"ğŸ”’"})]})})]},e)})}),t<C.length-1&&l.jsx(U,{})]},e.title)),l.jsx(U,{}),l.jsx("div",{className:"px-3 py-2",children:l.jsxs("div",{className:"card-description space-y-1",children:[l.jsx("div",{children:"â€¢ í•„ìˆ˜ ì¹¼ëŸ¼(*)ì€ ìˆ¨ê¸¸ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"}),l.jsx("div",{children:"â€¢ ë³€ê²½ì‚¬í•­ì€ ì ìš© ë²„íŠ¼ì„ ëˆŒëŸ¬ì•¼ ë°˜ì˜ë©ë‹ˆë‹¤"}),l.jsx("div",{children:"â€¢ ìƒˆë¡œê³ ì¹¨ ì‹œì—ë„ ì„¤ì •ì´ ìœ ì§€ë©ë‹ˆë‹¤"})]})})]}),l.jsx(U,{}),l.jsxs("div",{className:"px-3 py-3 flex gap-2 border-t bg-white",children:[l.jsxs(i,{onClick:()=>{r(m),x(!1)},className:"button-base bg-blue-500 text-white hover:bg-blue-600 flex-1",children:[l.jsx(A,{className:"w-4 h-4 mr-1"}),"ì ìš©"]}),l.jsxs(i,{onClick:()=>{p(a),x(!1)},variant:"outline",className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 flex-1",children:[l.jsx(d,{className:"w-4 h-4 mr-1"}),"ì·¨ì†Œ"]})]})]})]})});Oe.displayName="ColumnSettingsDropdown";const Le=s.memo(({purchase:e})=>{const t=e.is_received?"completed":"approved"===e.middle_manager_status&&"approved"===e.final_manager_status?"inProgress":"rejected"===e.middle_manager_status||"rejected"===e.final_manager_status?"rejected":"pending",{text:a,className:s}={completed:{text:"ì…ê³ ì™„ë£Œ",className:"badge-success"},inProgress:{text:"êµ¬ë§¤ì§„í–‰",className:"badge-primary"},rejected:{text:"ë°˜ë ¤",className:"badge-danger"},pending:{text:"ìŠ¹ì¸ëŒ€ê¸°",className:"badge-warning"}}[t];return l.jsx("span",{className:`badge-stats ${s}`,children:a})});Le.displayName="StatusBadge";const Ue=s.memo(({purchase:e,onClick:t})=>{const a=(e=>{if(!e.purchase_request_items||0===e.purchase_request_items.length)return{received:0,total:0,percentage:0};const t=e.purchase_request_items.length,a=e.purchase_request_items.filter(e=>null!==e.actual_received_date&&void 0!==e.actual_received_date).length;return{received:a,total:t,percentage:t>0?Math.round(a/t*100):0}})(e),s="ì„ ì§„í–‰"===e.progress_type||e.progress_type?.includes("ì„ ì§„í–‰");return l.jsxs("div",{className:"bg-white rounded-lg border p-4 space-y-3 cursor-pointer transition-all hover:shadow-md "+(s?"border-red-400 bg-red-50 hover:bg-red-100":"hover:bg-gray-50"),onClick:()=>t(e),children:[l.jsxs("div",{className:"flex items-start justify-between",children:[l.jsxs("div",{children:[l.jsxs("div",{className:"flex items-center gap-2",children:[s?l.jsx("span",{className:"badge-stats bg-red-500 text-white",children:"ì„ ì§„í–‰"}):l.jsx("span",{className:"badge-stats bg-gray-500 text-white",children:"ì¼ë°˜"}),l.jsx("span",{className:"card-title text-gray-900",children:e.purchase_order_number||"-"})]}),l.jsxs("div",{className:"badge-text text-gray-500 mt-1",children:[W(e.request_date)," ìš”ì²­"]})]}),l.jsx(Le,{purchase:e})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[l.jsx("span",{className:"text-gray-600",children:"ìš”ì²­ì"}),l.jsx("span",{className:"card-title",children:e.requester_name})]}),l.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[l.jsx("span",{className:"text-gray-600",children:"ì—…ì²´"}),l.jsx("span",{className:"card-title",children:e.vendor_name})]}),e.project_vendor&&l.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[l.jsx("span",{className:"text-gray-600",children:"PJì—…ì²´"}),l.jsx("span",{className:"card-title truncate max-w-[150px]",children:e.project_vendor})]}),e.project_item&&l.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[l.jsx("span",{className:"text-gray-600",children:"PJ ITEM"}),l.jsx("span",{className:"card-title truncate max-w-[150px]",children:e.project_item})]}),e.sales_order_number&&l.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[l.jsx("span",{className:"text-gray-600",children:"ìˆ˜ì£¼ë²ˆí˜¸"}),l.jsx("span",{className:"card-title truncate max-w-[150px]",children:e.sales_order_number})]}),e.item_name&&l.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[l.jsx("span",{className:"text-gray-600",children:"í’ˆëª©"}),l.jsx("span",{className:"card-title truncate max-w-[150px]",children:e.item_name})]}),l.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[l.jsx("span",{className:"text-gray-600",children:"ê¸ˆì•¡"}),l.jsxs("span",{className:"font-semibold text-gray-900",children:[(e.amount_value||e.total_amount)?.toLocaleString()," ",e.currency]})]})]}),l.jsxs("div",{className:"space-y-1",children:[l.jsxs("div",{className:"flex items-center justify-between badge-text",children:[l.jsx("span",{className:"text-gray-600",children:"ì…ê³ í˜„í™©"}),l.jsxs("span",{className:"text-gray-700",children:[a.received,"/",a.total," (",a.percentage,"%)"]})]}),l.jsx("div",{className:"bg-gray-200 rounded-full h-2",children:l.jsx("div",{className:"h-2 rounded-full transition-all "+(100===a.percentage?"bg-green-500":a.percentage>0?"bg-hansl-500":"bg-gray-300"),style:{width:`${a.percentage}%`}})})]}),void 0!==e.is_payment_completed&&l.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[l.jsx("span",{className:"text-gray-600",children:"ê²°ì œ"}),e.is_payment_completed?l.jsx("span",{className:"badge-stats bg-green-500 text-white",children:"ì™„ë£Œ"}):l.jsx("span",{className:"badge-stats bg-gray-500 text-white",children:"ëŒ€ê¸°"})]}),l.jsx("div",{className:"pt-2 border-t",children:l.jsxs("div",{className:"flex items-center justify-center badge-text text-gray-500",children:[l.jsx(B,{className:"w-3 h-3 mr-1"}),"í´ë¦­í•˜ì—¬ ìƒì„¸ë³´ê¸°"]})})]})});Ue.displayName="MobilePurchaseCard";const ze=s.memo(({purchases:e,activeTab:t,onRowClick:a,isLeadBuyer:r,onPaymentComplete:n,onReceiptComplete:i,onExcelDownload:c,columnVisibility:d,vendorColumnWidth:o,tableHeader:u,TableRowComponent:m,height:p=600,shouldUseFitLayout:h=!1,currentUserRoles:x})=>{const g=s.useRef(null),[_,y]=s.useState(0),[b,f]=s.useState(p),[j,v]=s.useState(p),{startIndex:w,endIndex:N,visibleItems:k,totalHeight:C}=s.useMemo(()=>{const t=e.length,a=Math.ceil(b/30),s=Math.floor(_/30),r=Math.min(s+a+5,t),n=Math.max(0,s-5);return{startIndex:n,endIndex:r,visibleItems:e.slice(n,r),totalHeight:30*t}},[e,_,b]),q=s.useCallback(e=>{const t=Math.max(0,e.currentTarget.scrollTop-30);y(t)},[]);return s.useEffect(()=>{const e=()=>{const e=window.innerHeight;let t;t=e<=800?Math.min(450,.6*e):e<=1080?Math.min(725,.7*e):e<=1440?Math.min(1e3,.75*e):Math.min(1200,.8*e),v(t),f(t)},t=()=>{if(g.current){const e=g.current.getBoundingClientRect();f(Math.min(j,e.height))}},a=setTimeout(()=>{e(),t()},100),s=()=>{e(),t()};return window.addEventListener("resize",s),()=>{clearTimeout(a),window.removeEventListener("resize",s)}},[j]),l.jsx("div",{className:h?"table-container-fit-left":"border rounded-lg",children:l.jsxs("div",{ref:g,className:"virtual-scroll-body",style:{height:`${j}px`,overflow:"auto",position:"relative"},onScroll:q,children:[l.jsx("div",{className:"sticky-header-container",style:{position:"sticky",top:0,zIndex:30,backgroundColor:"#f9fafb",borderBottom:"1px solid #e5e7eb",willChange:"transform"},children:l.jsx("table",{className:h?`table-fit-left ${t}-tab`:"w-full min-w-[1790px] border-collapse",children:u})}),l.jsx("div",{style:{height:`${C}px`,position:"relative"},children:l.jsx("div",{style:{transform:`translateY(${30*w}px)`,position:"absolute",top:0,left:0,right:0},children:l.jsx("table",{className:(h?`table-fit-left ${t}-tab`:"w-full min-w-[1790px] border-collapse")+" virtual-scroll-table",children:l.jsx("tbody",{children:k.map((e,s)=>l.jsx(m,{purchase:e,onClick:a,activeTab:t,isLeadBuyer:r,onPaymentComplete:n,onReceiptComplete:i,onExcelDownload:c,vendorColumnWidth:o,columnVisibility:d,currentUserRoles:x},e.id))})})})}),0===e.length&&l.jsx("div",{className:"text-center py-12 bg-white",children:l.jsx("p",{className:"card-subtitle",children:"ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤."})})]})})});ze.displayName="VirtualScrollTable";const Ve=s.memo(({purchase:e})=>{const t=e.is_received?"completed":"approved"===e.middle_manager_status&&"approved"===e.final_manager_status?"inProgress":"rejected"===e.middle_manager_status||"rejected"===e.final_manager_status?"rejected":"pending",{text:a,className:s}={completed:{text:"ì…ê³ ì™„ë£Œ",className:"badge-success"},inProgress:{text:"êµ¬ë§¤ì§„í–‰",className:"badge-primary"},rejected:{text:"ë°˜ë ¤",className:"badge-danger"},pending:{text:"ìŠ¹ì¸ëŒ€ê¸°",className:"badge-warning"}}[t];return l.jsx("span",{className:`badge-stats ${s}`,children:a})});Ve.displayName="StatusBadge";const Be=e=>e?["KRW","ì›","â‚©"].includes(e)?"â‚©":["USD","$","ë‹¬ëŸ¬"].includes(e)?"$":["EUR","â‚¬"].includes(e)?"â‚¬":["JPY","ì—”","Â¥"].includes(e)||["CNY","ìœ„ì•ˆ","å…ƒ"].includes(e)?"Â¥":e:"â‚©",Ae="text-center w-20 min-w-[85px] max-w-[85px]",We="pl-2 w-[155px] min-w-[155px] max-w-[155px] purchase-order-number-column",Ye="text-center w-20 min-w-[85px] max-w-[85px]",Je="w-12 min-w-[48px] max-w-[48px]",He="text-center px-2 w-16 min-w-[64px] max-w-[68px]",Ke="pl-3 pr-2 w-32 min-w-[128px] max-w-[128px]",Ze="w-16 min-w-[68px] max-w-[68px]",Qe="w-20 min-w-[85px] max-w-[85px]",Ge="w-20 min-w-[85px] max-w-[85px]",Xe="w-44 min-w-[176px] max-w-[176px]",et="w-64 min-w-[260px] max-w-[260px]",tt="text-center w-14 min-w-[60px] max-w-[60px]",at="text-right w-24 min-w-[100px] max-w-[100px]",st="text-right w-24 min-w-[100px] max-w-[100px]",rt="w-[165px] min-w-[165px] max-w-[165px]",nt="w-24 min-w-[105px] max-w-[105px]",lt="w-28 min-w-[115px] max-w-[115px]",it="w-44 min-w-[180px] max-w-[180px]",ct="text-center w-20 min-w-[85px] max-w-[85px]",dt="text-center w-24 min-w-[100px] max-w-[100px]",ot="text-center w-24 min-w-[100px] max-w-[100px]",ut="w-20 min-w-[85px] max-w-[85px]",mt="text-center w-14 min-w-[56px] max-w-[60px]",pt=s.memo(({purchase:e})=>{const{allPurchases:t}=Re(),a=t?.find(t=>t.id===e.id)||e,s="approved"===a.middle_manager_status,r="rejected"===a.middle_manager_status,n="approved"===a.final_manager_status,i="rejected"===a.final_manager_status;return r||i?l.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[l.jsx("div",{className:"flex items-center gap-0.5",children:l.jsx("div",{className:"w-1.5 h-1.5 bg-red-500 rounded-full animate-pulse"})}),l.jsx("span",{className:"badge-stats bg-red-500 text-white",children:"ë°˜ë ¤"})]}):s&&n?l.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[l.jsx("div",{className:"flex items-center gap-0.5",children:l.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"})}),l.jsx("span",{className:"badge-stats bg-green-500 text-white",children:"ìŠ¹ì¸ì™„ë£Œ"})]}):!s||n||i?l.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full"}),l.jsx("div",{className:"w-3 h-0.5 bg-gray-300"}),l.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full"})]}),l.jsx("span",{className:"badge-stats bg-gray-500 text-white",children:"ìŠ¹ì¸ëŒ€ê¸°"})]}):l.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),l.jsx("div",{className:"w-3 h-0.5 bg-gray-300"}),l.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full"})]}),l.jsx("span",{className:"badge-stats bg-yellow-500 text-white",children:"1ì°¨ ìŠ¹ì¸"})]})});pt.displayName="ApprovalStatusBadge";const ht=s.memo(({purchase:e,activeTab:t})=>{const{allPurchases:a}=Re(),s=a?.find(t=>t.id===e.id)||e;if("done"===t&&"êµ¬ë§¤ ìš”ì²­"!==s.payment_category)return l.jsx("div",{className:"flex items-center justify-center",children:l.jsx("span",{className:"card-title text-gray-500",children:"-"})});if(s.is_payment_completed)return l.jsxs("div",{className:"flex items-center justify-center gap-1",children:[l.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:l.jsx("div",{className:"h-1.5 rounded-full bg-orange-500",style:{width:"100%"}})}),l.jsx("span",{className:"card-title text-gray-600",children:"100%"})]});if(!s.purchase_request_items||0===s.purchase_request_items.length)return l.jsxs("div",{className:"flex items-center justify-center gap-1",children:[l.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:l.jsx("div",{className:"h-1.5 rounded-full bg-gray-300",style:{width:"0%"}})}),l.jsx("span",{className:"card-title text-gray-600",children:"0%"})]});const r=s.purchase_request_items.length,n=s.purchase_request_items.filter(e=>!0===e.is_payment_completed).length,i=r>0?Math.round(n/r*100):0;return l.jsxs("div",{className:"flex items-center justify-center gap-1",children:[l.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:l.jsx("div",{className:"h-1.5 rounded-full "+(100===i?"bg-orange-500":i>0?"bg-orange-400":"bg-gray-300"),style:{width:`${i}%`}})}),l.jsxs("span",{className:"card-title text-gray-600",children:[i,"%"]})]})});ht.displayName="PaymentProgressBar";const xt=s.memo(({purchase:e})=>{const{allPurchases:t}=Re(),a=t?.find(t=>t.id===e.id)||e;if(!a.purchase_request_items||0===a.purchase_request_items.length)return l.jsxs("div",{className:"flex items-center justify-center gap-1",children:[l.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:l.jsx("div",{className:"h-1.5 rounded-full bg-gray-300",style:{width:"0%"}})}),l.jsx("span",{className:"card-title text-gray-600",children:"0%"})]});const s=a.purchase_request_items.length,r=a.purchase_request_items.filter(e=>!0===e.is_received).length,n=s>0?Math.round(r/s*100):0;return l.jsxs("div",{className:"flex items-center justify-center gap-1",children:[l.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:l.jsx("div",{className:"h-1.5 rounded-full "+(100===n?"bg-blue-500":n>0?"bg-blue-400":"bg-gray-300"),style:{width:`${n}%`}})}),l.jsxs("span",{className:"card-title text-gray-600",children:[n,"%"]})]})});xt.displayName="ReceiptProgressBar";const gt=s.memo(({purchase:e})=>{const{allPurchases:t}=Re(),a=s.useMemo(()=>{if(!t)return e;return t.find(t=>t.id===e.id)||e},[t,e.id,e]),r=s.useMemo(()=>{const e=a.purchase_request_items||a.items||[];if(0===e.length)return{completed:0,total:1,percentage:0};const t=e.length,s=e.filter(e=>!0===e.is_statement_received).length;return{completed:s,total:t,percentage:t>0?Math.round(s/t*100):0}},[a]);return l.jsxs("div",{className:"flex items-center justify-center gap-1",children:[l.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:l.jsx("div",{className:"h-1.5 rounded-full "+(100===r.percentage?"bg-green-500":r.percentage>0?"bg-green-400":"bg-gray-300"),style:{width:`${r.percentage}%`}})}),l.jsxs("span",{className:"card-title text-gray-600",children:[r.percentage,"%"]})]})});gt.displayName="StatementProgressBar";s.memo(({type:e})=>"ì„ ì§„í–‰"===e||e?.includes("ì„ ì§„í–‰")?l.jsx("span",{className:"badge-stats bg-red-500 text-white",children:"ì„ ì§„í–‰"}):l.jsx("span",{className:"badge-stats bg-gray-500 text-white",children:"ì¼ë°˜"})).displayName="ProgressTypeBadge";const _t=s.memo(({purchase:e,onClick:t,activeTab:a,isLeadBuyer:s,onPaymentComplete:r,onReceiptComplete:n,onExcelDownload:i,columnVisibility:c,vendorColumnWidth:d,currentUserRoles:o})=>{const u="ì„ ì§„í–‰"===e.progress_type||e.progress_type?.includes("ì„ ì§„í–‰"),m=e=>{if(!c)return!0;if("done"===a&&$.includes(e)){const e=o?.some(e=>S.includes(e));if(!e)return!1}return!1!==c[e]};return l.jsxs("tr",{className:"border-b hover:bg-gray-100 cursor-pointer transition-colors "+(u?"bg-red-50 hover:bg-red-100":""),onClick:()=>t(e),children:["pending"===a&&l.jsx("td",{className:`px-2 py-1.5 whitespace-nowrap ${Ae}`,children:l.jsx(pt,{purchase:e})}),"purchase"===a&&l.jsx("td",{className:`px-2 py-1.5 ${ct}`,children:l.jsx(ht,{purchase:e,activeTab:a})}),"receipt"===a&&m("receipt_progress")&&l.jsx("td",{className:`px-2 py-1.5 ${ct}`,children:l.jsx(xt,{purchase:e})}),"done"===a&&m("statement_progress")&&l.jsx("td",{className:`px-2 py-1.5 ${ct}`,children:l.jsx(gt,{purchase:e})}),m("purchase_order_number")&&l.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${We}`,children:l.jsxs("div",{className:"flex items-center gap-1",children:[i&&l.jsx("img",{src:"/excels-icon.svg",alt:"ì—‘ì…€ ë‹¤ìš´ë¡œë“œ",width:"16",height:"16",className:`inline-block align-middle transition-transform p-0.5 rounded\n                ${e.is_po_download?"border border-gray-400":""}\n                ${"ì„ ì§„í–‰"===e.progress_type||e.progress_type?.includes("ì„ ì§„í–‰")||"approved"===e.middle_manager_status&&"approved"===e.final_manager_status?e.is_po_download?"cursor-pointer":"cursor-pointer hover:scale-110":"opacity-40 grayscale cursor-not-allowed"}`,onClick:async t=>{("ì„ ì§„í–‰"===e.progress_type||e.progress_type?.includes("ì„ ì§„í–‰")||"approved"===e.middle_manager_status&&"approved"===e.final_manager_status)&&(t.stopPropagation(),await i(e))},style:{pointerEvents:"ì„ ì§„í–‰"===e.progress_type||e.progress_type?.includes("ì„ ì§„í–‰")||"approved"===e.middle_manager_status&&"approved"===e.final_manager_status?"auto":"none"},title:e.is_po_download?"ë‹¤ìš´ë¡œë“œ ì™„ë£Œ":"ì—‘ì…€ ë°œì£¼ì„œ ë‹¤ìš´ë¡œë“œ"}),l.jsxs("span",{className:"block truncate",title:e.purchase_order_number||"",children:[e.purchase_order_number||"-",e.purchase_request_items&&e.purchase_request_items.length>1&&l.jsxs("span",{className:"text-gray-500 ml-0.5",children:["(",e.purchase_request_items.length,")"]})]})]})}),m("payment_category")&&l.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${Ye}`,children:l.jsx("span",{className:"badge-stats "+("êµ¬ë§¤ìš”ì²­"===e.payment_category||"êµ¬ë§¤ ìš”ì²­"===e.payment_category?"bg-blue-500 text-white":"ë°œì£¼"===e.payment_category?"bg-green-500 text-white":("í˜„ì¥ê²°ì œ"===e.payment_category||"í˜„ì¥ ê²°ì œ"===e.payment_category||e.payment_category,"bg-gray-500 text-white")),children:"ë°œì£¼"===e.payment_category?"ë°œì£¼ìš”ì²­":"êµ¬ë§¤ ìš”ì²­"===e.payment_category?"êµ¬ë§¤ìš”ì²­":"í˜„ì¥ ê²°ì œ"===e.payment_category?"í˜„ì¥ê²°ì œ":e.payment_category||"-"})}),m("requester_name")&&l.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${Je}`,children:l.jsx("span",{className:"block truncate",title:e.requester_name||"",children:e.requester_name||"-"})}),m("request_date")&&l.jsx("td",{className:`py-1.5 card-title whitespace-nowrap ${He}`,children:W(e.request_date)}),"done"===a&&m("utk_status")&&l.jsx("td",{className:`pl-2 pr-3 py-1.5 card-title whitespace-nowrap text-center overflow-visible text-clip ${mt}`,children:l.jsx("span",{className:e.is_utk_checked?"badge-utk-complete":"badge-utk-pending",children:e.is_utk_checked?"ì™„ë£Œ":"ëŒ€ê¸°"})}),m("vendor_name")&&l.jsx("td",{className:`pl-3 pr-2 py-1.5 card-title ${"done"===a?Ke:"vendor-dynamic-column"}`,style:"done"===a?void 0:{width:`${d||80}px`,minWidth:`${d||80}px`,maxWidth:`${d||80}px`},children:l.jsx("span",{className:"block truncate",title:e.vendor_name||"",children:e.vendor_name||"-"})}),m("contact_name")&&l.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${Ze}`,children:l.jsx("span",{className:"block truncate",title:e.contact_name||"",children:e.contact_name||"-"})}),m("delivery_request_date")&&l.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${Qe} ${e.revised_delivery_request_date?"text-gray-400":""}`,children:W(e.delivery_request_date)}),("receipt"===a||"done"===a)&&m("revised_delivery_date")&&l.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${Ge}`,children:W(e.revised_delivery_request_date)}),m("item_name")&&l.jsx("td",{className:`px-2 py-1.5 card-title ${Xe}`,children:l.jsx("span",{className:"block truncate",title:e.purchase_request_items?.[0]?.item_name||"",children:e.purchase_request_items?.[0]?.item_name||"-"})}),m("specification")&&l.jsx("td",{className:`px-2 py-1.5 card-title ${et}`,children:l.jsx("span",{className:"block truncate",title:e.purchase_request_items?.[0]?.specification||"",children:e.purchase_request_items?.[0]?.specification||"-"})}),m("quantity")&&(()=>{const t=e.purchase_request_items?.reduce((e,t)=>e+(t.quantity||0),0)||0,s=e.purchase_request_items?.reduce((e,t)=>e+(t.received_quantity||0),0)||0,r=t===s&&s>0,n=("receipt"===a||"done"===a)&&(t>=100||s>=100)&&!r;return l.jsx("td",{className:`px-2 card-title ${tt} ${n?"py-0.5":"py-1.5"}`,children:"receipt"===a||"done"===a?(()=>{if(r)return l.jsx("span",{className:"text-gray-900",children:s});const e=s>0;return n?l.jsxs("div",{className:"flex flex-col items-center justify-center gap-px leading-tight text-[10px]",children:[l.jsx("div",{className:e?"text-gray-400":"",children:t}),l.jsxs("div",{className:e?"":"text-gray-400",children:["/",s]})]}):l.jsxs("span",{className:"whitespace-nowrap",children:[l.jsx("span",{className:e?"text-gray-400":"",children:t}),l.jsxs("span",{className:e?"":"text-gray-400",children:["/",s]})]})})():t||0})})(),m("unit_price")&&l.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${at}`,children:(()=>{if((e.purchase_request_items?.length||0)>1)return"-";const t=e.purchase_request_items?.[0]?.unit_price_value||0,a=e.purchase_request_items?.[0]?.unit_price_currency||"KRW";return`${t.toLocaleString()} ${Be(a)}`})()}),m("amount")&&l.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${st}`,children:(()=>{const t=e.purchase_request_items?.reduce((t,a)=>t+(a.amount_value||0)+("ë°œì£¼"===e.payment_category&&a.tax_amount_value?a.tax_amount_value:0),0)||0,a=e.purchase_request_items?.[0]?.amount_currency||e.currency||"KRW";return`${t.toLocaleString()} ${Be(a)}`})()}),("pending"===a||"purchase"===a)&&l.jsxs(l.Fragment,{children:[m("remark")&&l.jsx("td",{className:`px-2 py-1.5 card-title ${rt}`,children:l.jsx("span",{className:"block truncate",title:e.purchase_request_items?.[0]?.remark||"",children:e.purchase_request_items?.[0]?.remark||"-"})}),"purchase"===a&&m("link")&&l.jsx("td",{className:`px-2 py-1.5 card-title ${ut}`,children:e.purchase_request_items?.[0]?.link?l.jsx("a",{href:e.purchase_request_items?.[0]?.link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline truncate block",title:e.purchase_request_items?.[0]?.link,children:"ë§í¬ ë³´ê¸°"}):l.jsx("span",{className:"text-gray-400",children:"-"})}),m("project_vendor")&&l.jsx("td",{className:`px-2 py-1.5 card-title ${nt}`,children:l.jsx("span",{className:"block truncate",title:e.project_vendor||"",children:e.project_vendor||"-"})}),m("project_item")&&l.jsx("td",{className:`px-2 py-1.5 card-title ${it}`,children:l.jsx("span",{className:"block truncate",title:e.project_item||"",children:e.project_item||"-"})}),m("sales_order_number")&&l.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${lt}`,children:l.jsx("span",{className:"block truncate",title:e.sales_order_number||"",children:e.sales_order_number||"-"})})]}),"receipt"===a&&l.jsxs(l.Fragment,{children:[m("remark")&&l.jsx("td",{className:`px-2 py-1.5 card-title ${rt}`,children:l.jsx("span",{className:"block truncate",title:e.purchase_request_items?.[0]?.remark||"",children:e.purchase_request_items?.[0]?.remark||"-"})}),m("project_vendor")&&l.jsx("td",{className:`px-2 py-1.5 card-title ${nt}`,children:l.jsx("span",{className:"block truncate",title:e.project_vendor||"",children:e.project_vendor||"-"})}),m("project_item")&&l.jsx("td",{className:`px-2 py-1.5 card-title ${it}`,children:l.jsx("span",{className:"block truncate",title:e.project_item||"",children:e.project_item||"-"})}),m("sales_order_number")&&l.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${lt}`,children:l.jsx("span",{className:"block truncate",title:e.sales_order_number||"",children:e.sales_order_number||"-"})})]}),("done"===a||!a)&&l.jsxs(l.Fragment,{children:[m("remark")&&l.jsx("td",{className:`px-2 py-1.5 card-title ${rt}`,children:l.jsx("span",{className:"block truncate",title:e.purchase_request_items?.[0]?.remark||"",children:e.purchase_request_items?.[0]?.remark||"-"})}),m("link")&&l.jsx("td",{className:`px-2 py-1.5 card-title ${ut}`,children:e.purchase_request_items?.[0]?.link?l.jsx("a",{href:e.purchase_request_items?.[0]?.link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline truncate block",title:e.purchase_request_items?.[0]?.link,children:"ë§í¬ ë³´ê¸°"}):l.jsx("span",{className:"text-gray-400",children:"-"})}),m("project_vendor")&&l.jsx("td",{className:`px-2 py-1.5 card-title ${nt}`,children:l.jsx("span",{className:"block truncate",title:e.project_vendor||"",children:e.project_vendor||"-"})}),m("project_item")&&l.jsx("td",{className:`px-2 py-1.5 card-title ${it}`,children:l.jsx("span",{className:"block truncate",title:e.project_item||"",children:e.project_item||"-"})}),m("sales_order_number")&&l.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${lt}`,children:l.jsx("span",{className:"block truncate",title:e.sales_order_number||"",children:e.sales_order_number||"-"})}),m("purchase_progress")&&"purchase"!==a&&l.jsx("td",{className:`px-2 py-1.5 ${dt}`,children:l.jsx(ht,{purchase:e,activeTab:a})}),m("receipt_progress")&&l.jsx("td",{className:`px-2 py-1.5 ${ot} ${"done"===a?"column-progress":""}`,children:l.jsx(xt,{purchase:e})})]})]})});_t.displayName="TableRow";const yt=({purchases:e,activeTab:a="done",currentUserRoles:r=[],onRefresh:i,onOptimisticUpdate:c,onPaymentComplete:d,onReceiptComplete:u,columnVisibility:m})=>{s.useEffect(()=>{t.info("[FastPurchaseTable] columnVisibility ë³€ê²½ë¨",{columnVisibility:m})},[m]);const[p,h]=s.useState(null),[x,g]=s.useState(!1),[_,y]=s.useState(!1),[b,f]=s.useState(null),j=n(),v=r&&(r.includes("lead buyer")||r.includes("app_admin"));r.includes("final_approver")||r.includes("app_admin")||r.includes("ceo");const w=s.useMemo(()=>{if(!e||0===e.length)return 80;e.length;let t=2;const a=Math.min(e.length,100);e.slice(0,a).forEach(e=>{const a=(e.vendor_name||"").split("").reduce((e,t)=>e+(/[ê°€-í£]/.test(t)?1.5:1),0);t=Math.max(t,Math.ceil(a))});return Math.max(80,Math.min(200,7*t+20))},[e,a]),k=s.useCallback(e=>{h(e.id),g(!0)},[]),C=s.useCallback(()=>{g(!1),h(null)},[]),q=s.useCallback(async e=>{try{const{data:s,error:n}=await j.from("purchase_requests").select("*").eq("purchase_order_number",e.purchase_order_number).single();if(n||!s)return void N.error("í•´ë‹¹ ë°œì£¼ìš”ì²­ë²ˆí˜¸ì˜ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");const{data:l,error:c}=await j.from("purchase_request_items").select("*").eq("purchase_order_number",e.purchase_order_number).order("line_number");if(c||!l||0===l.length)return void N.error("í•´ë‹¹ ë°œì£¼ìš”ì²­ë²ˆí˜¸ì˜ í’ˆëª© ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");const d={vendor_name:e.vendor_name,vendor_phone:"",vendor_fax:"",vendor_contact_name:"",vendor_payment_schedule:""};try{const t=s.vendor_id||e.vendor_id,a=s.contact_id||e.contact_id;if(t){const{data:e}=await j.from("vendors").select("vendor_phone, vendor_fax, vendor_payment_schedule").eq("id",t).single();e&&(d.vendor_phone=e.vendor_phone||"",d.vendor_fax=e.vendor_fax||"",d.vendor_payment_schedule=e.vendor_payment_schedule||"")}if(a){const{data:e}=await j.from("vendor_contacts").select("contact_name, contact_phone, contact_email").eq("id",a).single();e&&(d.vendor_contact_name=e.contact_name||"")}}catch(t){}const o={purchase_order_number:s.purchase_order_number||"",request_date:s.request_date,delivery_request_date:s.delivery_request_date,requester_name:s.requester_name,vendor_name:d.vendor_name||"",vendor_contact_name:d.vendor_contact_name,vendor_phone:d.vendor_phone,vendor_fax:d.vendor_fax,project_vendor:s.project_vendor,sales_order_number:s.sales_order_number,project_item:s.project_item,vendor_payment_schedule:d.vendor_payment_schedule,items:l.map(e=>({line_number:e.line_number,item_name:e.item_name,specification:e.specification,quantity:e.quantity,unit_price_value:e.unit_price_value,amount_value:e.amount_value,remark:e.remark,currency:s.currency||"KRW"}))},u=await Y(o),m=`ë°œì£¼ì„œ_${o.vendor_name}_${o.purchase_order_number}.xlsx`,p=window.URL.createObjectURL(u),h=document.createElement("a");h.href=p,h.download=m,document.body.appendChild(h),h.click(),document.body.removeChild(h),window.URL.revokeObjectURL(p),N.success("ì—‘ì…€ íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.");try{if(r&&r.includes("lead buyer")){const{error:t}=await j.from("purchase_requests").update({is_po_download:!0}).eq("purchase_order_number",e.purchase_order_number);t||i?.()}}catch(a){}}catch(t){N.error("ì—‘ì…€ ë‹¤ìš´ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}},[j]),D=s.useCallback(async()=>{if(!b)return t.error("[handleConfirmDelete] purchaseToDeleteê°€ nullì…ë‹ˆë‹¤"),void N.error("ì‚­ì œí•  ë°œì£¼ìš”ì²­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");t.info("ğŸš€ [handleConfirmDelete] ì‚­ì œ ì‹œì‘",{purchaseId:b.id,purchaseOrderNumber:b.purchase_order_number,type:typeof b.id});try{const s="https://qvhbigvdfyvhoegkhvef.supabase.co";if(!s||!"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF2aGJpZ3ZkZnl2aG9lZ2todmVmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc4MTQzNjAsImV4cCI6MjA2MzM5MDM2MH0.7VZlSwnNuE0MaQpDjuzeZFgjJrDBQOWA_COyqaM8Rbg"||s.includes("placeholder"))return t.warn("Supabase í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•ŠìŒ - FastPurchaseTable"),void N.error("í™˜ê²½ ì„¤ì • ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");const{data:{user:r},error:n}=await j.auth.getUser();if(n||!r)return void N.error("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");const{data:l,error:c}=await j.from("employees").select("name, email, purchase_role").eq("email",r.email).single();if(c||!l)return void N.error("ì‚¬ìš©ì ê¶Œí•œì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");let d=[];if(l.purchase_role)if(Array.isArray(l.purchase_role))d=l.purchase_role.map(e=>String(e).trim());else{d=String(l.purchase_role).split(",").map(e=>e.trim()).filter(e=>e.length>0)}const u=d.includes("final_approver")||d.includes("app_admin")||d.includes("ceo"),m="approved"===b.final_manager_status,p=b.requester_name===l.name;if(!(m?u:u||p))return t.warn("[handleConfirmDelete] ì‚­ì œ ê¶Œí•œ ì—†ìŒ",{canEdit:u,isApproved:m,isRequester:p,roles:d,employeeName:l.name}),void N.error("ì‚­ì œ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");t.info("âœ… [handleConfirmDelete] ê¶Œí•œ í™•ì¸ ì™„ë£Œ, ì‚­ì œ ì§„í–‰",{purchaseId:b.id}),t.info("ğŸ—‘ï¸ [handleConfirmDelete] í’ˆëª© ì‚­ì œ ì‹œì‘",{purchaseId:b.id});const{data:x,error:_}=await j.from("purchase_request_items").delete().eq("purchase_request_id",b.id).select();if(_)throw t.error("âŒ [handleConfirmDelete] ì•„ì´í…œ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ",_,{code:_.code,message:_.message,details:_.details,hint:_.hint,purchaseId:b.id}),_;t.info("âœ… [handleConfirmDelete] í’ˆëª© ì‚­ì œ ì™„ë£Œ",{purchaseId:b.id,deletedItemsCount:x?.length||0});const v="string"==typeof b.id?parseInt(b.id,10):b.id;if(isNaN(v))throw t.error("âŒ [handleConfirmDelete] purchaseId ë³€í™˜ ì‹¤íŒ¨",{originalId:b.id,type:typeof b.id}),new Error("ë°œì£¼ìš”ì²­ IDê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");t.info("ğŸ—‘ï¸ [handleConfirmDelete] support_inquires ê´€ë ¨ ë ˆì½”ë“œ ì²˜ë¦¬ ì‹œì‘ (ë¬¸ì˜ ê¸°ë¡ ë³´ì¡´)",{purchaseId:v});let w=!1,k=0;try{const{data:e,error:a}=await j.from("support_inquires").select("id, purchase_order_number").eq("purchase_request_id",v);if(a)t.warn("[handleConfirmDelete] support_inquires ì¡°íšŒ ì‹¤íŒ¨ (ë¬´ì‹œí•˜ê³  ê³„ì† ì§„í–‰)",{error:a,purchaseId:v});else if(e&&e.length>0){k=e.length,t.info("ğŸ—‘ï¸ [handleConfirmDelete] support_inquires ë ˆì½”ë“œ ì—…ë°ì´íŠ¸ í•„ìš” (ë¬¸ì˜ ê¸°ë¡ ë³´ì¡´)",{purchaseId:v,inquiriesCount:e.length,inquiryIds:e.map(e=>e.id),note:"ë¬¸ì˜ ê¸°ë¡ì€ ì‚­ì œí•˜ì§€ ì•Šê³  purchase_request_idë§Œ nullë¡œ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤."});const{data:a,error:s}=await j.from("support_inquires").update({purchase_request_id:null}).eq("purchase_request_id",v).select();if(s)throw t.error("âŒ [handleConfirmDelete] support_inquires ì—…ë°ì´íŠ¸ ì‹¤íŒ¨",{error:s,purchaseId:v,code:s.code,message:s.message,details:s.details}),new Error(`ë¬¸ì˜ ê¸°ë¡(${e.length}ê°œ)ì˜ ì°¸ì¡°ë¥¼ ì œê±°í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì‚­ì œë¥¼ ì¤‘ë‹¨í•©ë‹ˆë‹¤.`);w=!0,t.info("âœ… [handleConfirmDelete] support_inquires ì—…ë°ì´íŠ¸ ì™„ë£Œ (ë¬¸ì˜ ê¸°ë¡ ë³´ì¡´)",{purchaseId:v,updatedCount:a?.length||e.length,updatedInquiryIds:a?.map(e=>e.id)||e.map(e=>e.id),note:"ë¬¸ì˜ ê¸°ë¡ì€ ê·¸ëŒ€ë¡œ ë³´ì¡´ë˜ì—ˆê³ , purchase_request_idë§Œ nullë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤."}),await new Promise(e=>setTimeout(e,100))}else t.info("âœ… [handleConfirmDelete] support_inquires ê´€ë ¨ ë ˆì½”ë“œ ì—†ìŒ",{purchaseId:v})}catch(e){throw t.error("âŒ [handleConfirmDelete] support_inquires ì²˜ë¦¬ ì¤‘ ì˜ˆì™¸ ë°œìƒ",{error:e,purchaseId:v}),N.error(`ë¬¸ì˜ ê¸°ë¡ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${e instanceof Error?e.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}`),e}t.info("ğŸ—‘ï¸ [handleConfirmDelete] ë°œì£¼ê¸°ë³¸ì •ë³´ ì‚­ì œ ì‹œì‘",{purchaseId:v,idType:typeof b.id,idValue:b.id});const{error:C}=await j.from("purchase_requests").delete().eq("id",v);if(C){if(t.error("âŒ [handleConfirmDelete] ë°œì£¼ìš”ì²­ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ",C,{code:C.code,message:C.message,details:C.details,hint:C.hint,purchaseId:v,originalId:b.id,note:"í’ˆëª©ì€ ì´ë¯¸ ì‚­ì œë˜ì—ˆì§€ë§Œ ë°œì£¼ìš”ì²­ì€ ì‚­ì œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ í…Œì´ë¸”ì—ì„œ ì°¸ì¡°í•˜ê³  ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤."}),"409"!==C.code&&"23503"!==C.code&&!C.message?.includes("409")&&!C.message?.includes("foreign key"))throw C;{const e=C.details||C.message||"ë‹¤ë¥¸ ë°ì´í„°ì—ì„œ ì°¸ì¡°í•˜ê³  ìˆìŠµë‹ˆë‹¤.";t.error("âŒ [handleConfirmDelete] Foreign key constraint ìœ„ë°˜",{code:C.code,message:C.message,details:C.details,hint:C.hint,purchaseId:v}),N.error(`ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${e} ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.`)}return}t.info("âœ… [handleConfirmDelete] ë°œì£¼ê¸°ë³¸ì •ë³´ ì‚­ì œ ì™„ë£Œ",{purchaseId:v,originalId:b.id,inquiriesPreserved:w?`${k}ê°œ ë¬¸ì˜ ê¸°ë¡ ë³´ì¡´ë¨`:"ë¬¸ì˜ ê¸°ë¡ ì—†ìŒ"});const q=v;if(o(q)?t.info("âœ… [handleConfirmDelete] ë©”ëª¨ë¦¬ ìºì‹œì—ì„œ ë°œì£¼ì„œ ì‚­ì œ ì„±ê³µ",{purchaseId:q,originalId:b.id}):t.warn("[handleConfirmDelete] ë©”ëª¨ë¦¬ ìºì‹œì—ì„œ ë°œì£¼ì„œ ì‚­ì œ ì‹¤íŒ¨",{purchaseId:q,originalId:b.id}),w&&k>0?N.success(`ë°œì£¼ìš”ì²­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤. (${k}ê°œì˜ ë¬¸ì˜ ê¸°ë¡ì€ ë³´ì¡´ë˜ì—ˆìŠµë‹ˆë‹¤)`):N.success("ë°œì£¼ìš”ì²­ ë‚´ì—­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤."),g(!1),h(null),y(!1),f(null),i)try{await i(!0,{silent:!1}),t.info("âœ… [handleConfirmDelete] ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ")}catch(a){t.error("âŒ [handleConfirmDelete] ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨",a)}}catch(s){const e=s;t.error("âŒ [handleConfirmDelete] ë°œì£¼ìš”ì²­ ì‚­ì œ ì¤‘ ì˜ˆì™¸ ë°œìƒ",e,{name:e?.name,message:e?.message,code:e?.code,details:e?.details,hint:e?.hint,stack:e?.stack,purchaseId:b?.id,purchaseOrderNumber:b?.purchase_order_number}),N.error(`ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${e?.message||"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}`)}finally{y(!1),f(null)}},[j,b,i]),P=s.useCallback(e=>{if(!m)return!0;if("done"===a&&$.includes(e)){const e=r?.some(e=>S.includes(e));if(!e)return!1}return!1!==m[e]},[m,a,r]),I=s.useMemo(()=>{if("pending"===a)return l.jsx("thead",{className:"sticky top-0 z-30 bg-gray-50",style:{boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},children:l.jsxs("tr",{children:[l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Ae}`,children:"ìŠ¹ì¸ìƒíƒœ"}),P("purchase_order_number")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${We}`,children:"ë°œì£¼ë²ˆí˜¸"}),P("payment_category")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Ye}`,children:"ê²°ì œì¢…ë¥˜"}),P("requester_name")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Je}`,children:"ìš”ì²­ì"}),P("request_date")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${He}`,children:"ì²­êµ¬ì¼"}),P("vendor_name")&&l.jsx("th",{className:"px-2 py-1.5 modal-label text-gray-900 text-left vendor-dynamic-column",style:{width:`${w||80}px`,minWidth:`${w||80}px`,maxWidth:`${w||80}px`},children:"ì—…ì²´"}),P("contact_name")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ze}`,children:"ë‹´ë‹¹ì"}),P("delivery_request_date")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Qe}`,children:"ì…ê³ ìš”ì²­ì¼"}),P("item_name")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${Xe}`,children:"í’ˆëª…"}),P("specification")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${et}`,children:"ê·œê²©"}),P("quantity")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${tt}`,children:"ìš”ì²­ìˆ˜ëŸ‰"}),P("unit_price")&&l.jsx("th",{className:`px-2 py-1.5 table-header-text text-gray-900 whitespace-nowrap ${at}`,children:"ë‹¨ê°€"}),P("amount")&&l.jsx("th",{className:`px-2 py-1.5 table-header-text text-gray-900 whitespace-nowrap ${st}`,children:"í•©ê³„"}),P("remark")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${rt}`,children:"ë¹„ê³ "}),P("project_vendor")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${nt}`,children:"PJì—…ì²´"}),P("project_item")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${it}`,children:"PJ ITEM"}),P("sales_order_number")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${lt}`,children:"ìˆ˜ì£¼ë²ˆí˜¸"})]})});if("purchase"===a)return l.jsx("thead",{className:"sticky top-0 z-30 bg-gray-50",style:{boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},children:l.jsxs("tr",{children:[l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${ct}`,children:"êµ¬ë§¤ì§„í–‰"}),P("purchase_order_number")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${We}`,children:"ë°œì£¼ë²ˆí˜¸"}),P("payment_category")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Ye}`,children:"ê²°ì œì¢…ë¥˜"}),P("requester_name")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Je}`,children:"ìš”ì²­ì"}),P("request_date")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${He}`,children:"ì²­êµ¬ì¼"}),P("vendor_name")&&l.jsx("th",{className:"px-2 py-1.5 modal-label text-gray-900 text-left vendor-dynamic-column",style:{width:`${w||80}px`,minWidth:`${w||80}px`,maxWidth:`${w||80}px`},children:"ì—…ì²´"}),P("contact_name")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ze}`,children:"ë‹´ë‹¹ì"}),P("delivery_request_date")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Qe}`,children:"ì…ê³ ìš”ì²­ì¼"}),P("item_name")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${Xe}`,children:"í’ˆëª…"}),P("specification")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${et}`,children:"ê·œê²©"}),P("quantity")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${tt}`,children:"ìš”ì²­ìˆ˜ëŸ‰"}),P("unit_price")&&l.jsx("th",{className:`px-2 py-1.5 table-header-text text-gray-900 whitespace-nowrap ${at}`,children:"ë‹¨ê°€"}),P("amount")&&l.jsx("th",{className:`px-2 py-1.5 table-header-text text-gray-900 whitespace-nowrap ${st}`,children:"í•©ê³„"}),P("remark")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${rt}`,children:"ë¹„ê³ "}),"purchase"===a&&P("link")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${ut}`,children:"ë§í¬"}),P("project_vendor")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${nt}`,children:"PJì—…ì²´"}),P("project_item")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${it}`,children:"PJ ITEM"}),P("sales_order_number")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${lt}`,children:"ìˆ˜ì£¼ë²ˆí˜¸"})]})});const e=l.jsxs(l.Fragment,{children:[P("purchase_order_number")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${We}`,children:"ë°œì£¼ë²ˆí˜¸"}),P("payment_category")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Ye}`,children:"ê²°ì œì¢…ë¥˜"}),P("requester_name")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Je}`,children:"ìš”ì²­ì"}),P("request_date")&&l.jsx("th",{className:`py-1.5 modal-label text-gray-900 whitespace-nowrap ${He}`,children:"ì²­êµ¬ì¼"}),"done"===a&&P("utk_status")&&l.jsx("th",{className:`pl-2 pr-3 py-1.5 modal-label text-gray-900 whitespace-nowrap text-center ${mt}`,children:"UTK"}),P("vendor_name")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${"done"===a?Ke:"vendor-dynamic-column"}`,style:"done"===a?void 0:{width:`${w||80}px`,minWidth:`${w||80}px`,maxWidth:`${w||80}px`},children:"ì—…ì²´"}),P("contact_name")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ze}`,children:"ë‹´ë‹¹ì"}),P("delivery_request_date")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Qe}`,children:"ì…ê³ ìš”ì²­ì¼"}),("receipt"===a||"done"===a)&&P("revised_delivery_date")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Ge}`,children:"ë³€ê²½ ì…ê³ ì¼"}),P("item_name")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${Xe}`,children:"í’ˆëª…"}),P("specification")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${et}`,children:"ê·œê²©"}),P("quantity")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 ${tt}`,children:"receipt"===a||"done"===a?l.jsxs("div",{className:"flex flex-col items-center leading-tight",children:[l.jsx("div",{className:"text-[9px]",children:"ìš”ì²­/ì‹¤ì œ"}),l.jsx("div",{className:"text-[10px]",children:"ì…ê³ ìˆ˜ëŸ‰"})]}):"ìš”ì²­ìˆ˜ëŸ‰"}),P("unit_price")&&l.jsx("th",{className:`px-2 py-1.5 table-header-text text-gray-900 whitespace-nowrap ${at}`,children:"ë‹¨ê°€"}),P("amount")&&l.jsx("th",{className:`px-2 py-1.5 table-header-text text-gray-900 whitespace-nowrap ${st}`,children:"(ì´ í’ˆëª©)í•©ê³„"})]});let t=null;return"receipt"===a?t=l.jsxs(l.Fragment,{children:[P("remark")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${rt}`,children:"ë¹„ê³ "}),P("project_vendor")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${nt}`,children:"PJì—…ì²´"}),P("project_item")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${it}`,children:"PJ ITEM"}),P("sales_order_number")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${lt}`,children:"ìˆ˜ì£¼ë²ˆí˜¸"})]}):"done"===a&&(t=l.jsxs(l.Fragment,{children:[P("remark")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${rt}`,children:"ë¹„ê³ "}),P("link")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${ut}`,children:"ë§í¬"}),P("project_vendor")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${nt}`,children:"PJì—…ì²´"}),P("project_item")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${it}`,children:"PJ ITEM"}),P("sales_order_number")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${lt}`,children:"ìˆ˜ì£¼ë²ˆí˜¸"}),P("purchase_progress")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${dt}`,children:"êµ¬ë§¤ì§„í–‰"}),P("receipt_progress")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${ot}`,children:"ì…ê³ ì§„í–‰"})]})),l.jsx("thead",{className:"sticky top-0 z-30 bg-gray-50",style:{boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},children:l.jsxs("tr",{children:["receipt"===a&&P("receipt_progress")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${ct}`,children:"ì…ê³ ì§„í–‰"}),"done"===a&&P("statement_progress")&&l.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${ct}`,children:"ê±°ë˜ëª…ì„¸ì„œ"}),e,t]})})},[a,P,w]),F=s.useMemo(()=>{if(!m)return!1;return!!Object.values(m).some(e=>!e)},[m]),T=s.useMemo(()=>e.length>=100,[e.length]);return l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"hidden md:block w-full max-w-full",children:T?l.jsx(ze,{purchases:e,activeTab:a,onRowClick:k,isLeadBuyer:v,onPaymentComplete:d,onReceiptComplete:u,onExcelDownload:q,columnVisibility:m,vendorColumnWidth:w,tableHeader:I,TableRowComponent:_t,shouldUseFitLayout:F,currentUserRoles:r}):l.jsx("div",{className:F?"table-container-fit-left max-h-[70vh] overflow-auto":"overflow-x-auto overflow-y-auto max-h-[70vh] border rounded-lg",children:l.jsxs("table",{className:F?`table-fit-left ${a}-tab`:"w-full min-w-[1790px] border-collapse",children:[I,l.jsx("tbody",{children:e.map(e=>l.jsx(_t,{purchase:e,onClick:k,activeTab:a,isLeadBuyer:v,onPaymentComplete:d,onReceiptComplete:u,onExcelDownload:q,vendorColumnWidth:w,columnVisibility:m,currentUserRoles:r},e.id))})]})})}),l.jsx("div",{className:"hidden sm:block md:hidden w-full",children:l.jsx("div",{className:"overflow-x-auto border rounded-lg",children:l.jsxs("table",{className:"w-full min-w-[600px] card-title",children:[l.jsx("thead",{className:"sticky top-0 z-30 bg-gray-50",style:{boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},children:l.jsxs("tr",{children:[l.jsx("th",{className:"text-left p-2 modal-label text-gray-900 w-24",children:"ë°œì£¼ë²ˆí˜¸"}),l.jsx("th",{className:"text-left p-2 modal-label text-gray-900 w-16",children:"ìš”ì²­ì"}),l.jsx("th",{className:"text-left p-2 modal-label text-gray-900 vendor-dynamic-column",style:{width:`${w||80}px`},children:"ì—…ì²´"}),l.jsx("th",{className:"text-left p-2 modal-label text-gray-900 w-32",children:"í’ˆëª…"}),l.jsx("th",{className:"text-right p-2 modal-label text-gray-900 w-20",children:"ê¸ˆì•¡"}),l.jsx("th",{className:"text-center p-2 modal-label text-gray-900 w-16",children:"ìƒíƒœ"})]})}),l.jsx("tbody",{children:e.map(e=>l.jsxs("tr",{className:"border-b hover:bg-gray-50 cursor-pointer",onClick:()=>k(e),children:[l.jsx("td",{className:"p-2 modal-value",children:e.purchase_order_number||"-"}),l.jsx("td",{className:"p-2",children:e.requester_name}),l.jsx("td",{className:"p-2 truncate",title:e.vendor_name,children:e.vendor_name}),l.jsx("td",{className:"p-2 truncate",title:e.purchase_request_items?.[0]?.item_name,children:e.purchase_request_items?.[0]?.item_name||"-"}),l.jsx("td",{className:"p-2 text-right card-amount",children:e.purchase_request_items?.[0]?.amount_value?`${e.purchase_request_items[0].amount_value.toLocaleString()} ${Be(e.purchase_request_items[0]?.amount_currency||"KRW")}`:e.total_amount?`${e.total_amount.toLocaleString()} ${Be(e.currency||"KRW")}`:`0 ${Be(e.currency||"KRW")}`}),l.jsx("td",{className:"p-2 text-center",children:l.jsx(Ve,{purchase:e})})]},e.id))})]})})}),l.jsx("div",{className:"sm:hidden space-y-3",children:e.map(e=>l.jsx(Ue,{purchase:e,onClick:()=>k(e)},e.id))}),l.jsx(M,{purchaseId:p,isOpen:x,onClose:C,currentUserRoles:r,activeTab:a,onRefresh:i,onOptimisticUpdate:c,onDelete:e=>{t.info("ğŸ—‘ï¸ [FastPurchaseTable] ì‚­ì œ ë²„íŠ¼ í´ë¦­",{purchaseId:e.id,purchaseOrderNumber:e.purchase_order_number,type:typeof e.id}),f(e),y(!0)}}),l.jsx(J,{open:_,onOpenChange:e=>{y(e),e||f(null)},children:l.jsxs(H,{children:[l.jsxs(K,{children:[l.jsx(Z,{children:"ë°œì£¼ìš”ì²­ ë‚´ì—­ ì‚­ì œ"}),l.jsxs(Q,{children:["ë°œì£¼ìš”ì²­ë²ˆí˜¸ ",l.jsx("strong",{children:b?.purchase_order_number||"ì•Œ ìˆ˜ ì—†ìŒ"}),"ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?",l.jsx("br",{}),"ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."]})]}),l.jsxs(G,{children:[l.jsx(X,{children:"ì·¨ì†Œ"}),l.jsx(ee,{onClick:async()=>{t.info("âœ… [FastPurchaseTable] ì‚­ì œ í™•ì¸ ë²„íŠ¼ í´ë¦­",{purchaseId:b?.id,purchaseOrderNumber:b?.purchase_order_number}),await D()},className:"bg-red-600 hover:bg-red-700",children:"ì‚­ì œ"})]})]})})]})};yt.displayName="FastPurchaseTable";const bt=[{key:"date_range",label:"ê¸°ê°„ë³„",type:"date_range",icon:xe,category:"ë‚ ì§œ"},{key:"date_month",label:"ì›”ë³„",type:"date_month",icon:xe,category:"ë‚ ì§œ"},{key:"requester_name",label:"ìš”ì²­ì",type:"searchable_select",icon:u,category:"ì‚¬ìš©ì"},{key:"vendor_name",label:"ì—…ì²´",type:"searchable_select",icon:ke,category:"ì‚¬ìš©ì"},{key:"contact_name",label:"ë‹´ë‹¹ì",type:"searchable_select",icon:u,category:"ì‚¬ìš©ì"},{key:"purchase_order_number",label:"ë°œì£¼ë²ˆí˜¸",type:"text",icon:m,category:"í…ìŠ¤íŠ¸"},{key:"item_name",label:"í’ˆëª…",type:"text",icon:m,category:"í…ìŠ¤íŠ¸"},{key:"specification",label:"ê·œê²©",type:"text",icon:m,category:"í…ìŠ¤íŠ¸"},{key:"remark",label:"ë¹„ê³ ",type:"text",icon:m,category:"í…ìŠ¤íŠ¸"},{key:"project_vendor",label:"PJì—…ì²´",type:"text",icon:ke,category:"í…ìŠ¤íŠ¸"},{key:"project_item",label:"PJ ITEM",type:"text",icon:m,category:"í…ìŠ¤íŠ¸"},{key:"sales_order_number",label:"ìˆ˜ì£¼ë²ˆí˜¸",type:"text",icon:m,category:"í…ìŠ¤íŠ¸"},{key:"quantity",label:"ìˆ˜ëŸ‰",type:"number",icon:D,category:"ìˆ«ì"},{key:"unit_price_value",label:"ë‹¨ê°€",type:"number",icon:D,category:"ìˆ«ì"},{key:"total_amount",label:"í•©ê³„",type:"number",icon:D,category:"ìˆ«ì"},{key:"payment_category",label:"ê²°ì œì¢…ë¥˜",type:"select",icon:P,category:"ìƒíƒœ",options:["í˜„ì¥ê²°ì œ","êµ¬ë§¤ ìš”ì²­","ë°œì£¼","í˜„ê¸ˆ","ì¹´ë“œ"]},{key:"payment_schedule",label:"ì§€ì¶œì˜ˆì •ì¼",type:"select_with_empty",icon:xe,category:"ìƒíƒœ"},{key:"is_payment_completed",label:"êµ¬ë§¤í˜„í™©",type:"select",icon:A,category:"ìƒíƒœ",options:["ëŒ€ê¸°","ì™„ë£Œ"]},{key:"is_received",label:"ì…ê³ í˜„í™©",type:"select",icon:A,category:"ìƒíƒœ",options:["ëŒ€ê¸°","ì™„ë£Œ"]},{key:"is_statement_received",label:"ê±°ë˜ëª…ì„¸ì„œ í™•ì¸",type:"select",icon:A,category:"ìƒíƒœ",options:["ëŒ€ê¸°","ì™„ë£Œ"]},{key:"is_utk_checked",label:"UTK í™•ì¸",type:"select",icon:P,category:"ìƒíƒœ",options:["ëŒ€ê¸°","ì™„ë£Œ"]},{key:"approval_status",label:"ìŠ¹ì¸ìƒíƒœ",type:"select",icon:P,category:"ìƒíƒœ",options:["ìŠ¹ì¸ëŒ€ê¸°","1ì°¨ìŠ¹ì¸","ìµœì¢…ìŠ¹ì¸","ë°˜ë ¤"]}],ft=[{value:"request_date",label:"ì²­êµ¬ì¼"},{value:"delivery_request_date",label:"ì…ê³ ìš”ì²­ì¼"},{value:"payment_completed_at",label:"êµ¬ë§¤ì™„ë£Œì¼"},{value:"received_at",label:"ì…ê³ ì™„ë£Œì¼"},{value:"created_at",label:"ìƒì„±ì¼"},{value:"statement_received_at",label:"ê±°ë˜ëª…ì„¸ì„œì…ê³ ì¼"}],jt=[{value:"request_date",label:"ìš”ì²­ì¼"},{value:"purchase_order_number",label:"ë°œì£¼ë²ˆí˜¸"},{value:"vendor_name",label:"ì—…ì²´ëª…"},{value:"requester_name",label:"ìš”ì²­ì"},{value:"total_amount",label:"í•©ê³„"},{value:"delivery_request_date",label:"ì…ê³ ìš”ì²­ì¼"},{value:"created_at",label:"ìƒì„±ì¼"}];function vt({activeFilters:e,sortConfig:t,searchTerm:a,onFiltersChange:r,onSortChange:n,onSearchChange:c,availableEmployees:o=[],availableVendors:u=[],availableContacts:m=[],availablePaymentSchedules:p=[],children:h}){const[x,g]=s.useState(!1),[_,y]=s.useState(!1),[b,f]=s.useState(!1),[j,v]=s.useState({}),[w,N]=s.useState(!1),[k,C]=s.useState(!1),[q,$]=s.useState({}),[S,M]=s.useState(),[D,P]=s.useState({}),[T,E]=s.useState({}),[R,O]=s.useState(""),L=s.useRef(null);s.useEffect(()=>{b&&L.current&&L.current.focus()},[b]),s.useEffect(()=>{_&&E({field:t?.field||"",direction:t?.direction||"asc"})},[_,t]);const U=t=>{r(e.filter(e=>e.id!==t))},V=()=>{const e=bt.find(e=>e.key===j.field);if(!e)return null;switch(e.type){case"text":return l.jsx(te,{placeholder:"ê°’ ì…ë ¥",value:String(j.value||""),onChange:e=>v(t=>({...t,value:e.target.value})),className:"w-full business-radius-input border border-gray-300 bg-white text-gray-700 card-description h-auto",style:{padding:"2px 10px",fontSize:"10px",fontWeight:"500"}});case"number":return l.jsx(te,{type:"number",placeholder:"ìˆ«ì ì…ë ¥",value:String(j.value||""),onChange:e=>v(t=>({...t,value:e.target.value})),className:"w-full business-radius-input border border-gray-300 bg-white text-gray-700 card-description h-auto",style:{padding:"2px 10px",fontSize:"10px",fontWeight:"500"}});case"searchable_select":let t=[],a="ì„ íƒ";"requester_name"===e.key?(t=o,a="ìš”ì²­ì"):"vendor_name"===e.key?(t=u,a="ì—…ì²´"):"contact_name"===e.key&&(t=m,a="ë‹´ë‹¹ì");const s=t.filter(e=>e.toLowerCase().includes(R.toLowerCase()));return l.jsxs(ie,{onOpenChange:e=>{e||O("")},children:[l.jsx(ce,{asChild:!0,children:l.jsxs(i,{variant:"outline",role:"combobox",className:"w-full button-base business-radius-button border border-gray-300 bg-white text-gray-700 justify-between [&>svg]:hidden",children:[l.jsx("span",{className:"truncate text-left",style:{fontSize:"12px",fontWeight:"500"},children:String(j.value||a)}),l.jsx(ge,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),l.jsx(de,{className:"w-[200px] p-1 border-0 shadow-lg",align:"start",children:l.jsxs("div",{className:"space-y-1",children:[l.jsx(te,{placeholder:`${a} ê²€ìƒ‰...`,className:"h-auto border-0 focus:ring-0 focus:outline-none card-description placeholder:card-description",style:{padding:"2px 10px"},value:R,onChange:e=>O(e.target.value),autoFocus:!0}),l.jsx("div",{className:"max-h-[200px] overflow-y-auto",children:0===s.length?l.jsx("div",{className:"p-2 text-sm text-gray-500",children:R?"ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤":`${a}ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤`}):s.map(e=>l.jsxs(i,{variant:"ghost",onClick:()=>{v(t=>({...t,value:e})),O("")},className:"w-full justify-start p-2 h-auto hover:bg-gray-100 text-left",children:[l.jsx(A,{className:"mr-2 h-3 w-3 "+(j.value===e?"opacity-100":"opacity-0")}),l.jsx("span",{className:"card-description",children:e})]},e))})]})})]});case"select":return l.jsxs(oe,{value:String(j.value||""),onValueChange:e=>v(t=>({...t,value:e})),children:[l.jsx(ue,{className:"button-base business-radius-button border border-gray-300 bg-white text-gray-700 [&>svg]:hidden text-center",children:l.jsx(me,{placeholder:"ì„ íƒ"})}),l.jsx(pe,{children:e.options?.map(e=>l.jsx(he,{value:e,children:l.jsx("span",{className:"card-description",children:e})},e))})]});case"select_with_empty":const r=["ê³µë€",...p];return l.jsxs(oe,{value:String(j.value||""),onValueChange:e=>v(t=>({...t,value:e})),children:[l.jsx(ue,{className:"button-base business-radius-button border border-gray-300 bg-white text-gray-700 [&>svg]:hidden text-center",children:l.jsx(me,{placeholder:"ì§€ì¶œì˜ˆì •ì¼"})}),l.jsx(pe,{children:r.map(e=>l.jsx(he,{value:e,children:l.jsx("span",{className:"card-description",children:e})},e))})]});case"date_range":return l.jsxs(ie,{open:w,onOpenChange:e=>{if(e)if(j.value&&"string"==typeof j.value)if(j.value.includes("~")){const[e,t]=j.value.split("~");$({from:new Date(e),to:new Date(t)})}else $({from:new Date(j.value),to:void 0});else $({});N(e)},children:[l.jsx(ce,{asChild:!0,children:l.jsx(i,{variant:"outline",className:"w-full button-base business-radius-button border border-gray-300 bg-white text-gray-700 justify-between h-auto",children:l.jsxs("div",{className:"flex items-center gap-1.5 min-h-[32px]",children:[l.jsx(xe,{className:"w-3 h-3 flex-shrink-0"}),l.jsx("span",{className:"card-description leading-tight whitespace-pre-line",children:j.value&&"string"==typeof j.value?(()=>{if(j.value.includes("~")){const[e,t]=j.value.split("~");return`${I(new Date(e),"yy/MM/dd")}\n~ ${I(new Date(t),"yy/MM/dd")}`}return I(new Date(String(j.value)),"yy/MM/dd")})():"ë‚ ì§œ ì„ íƒ"})]})})}),l.jsx(de,{className:"w-auto p-0",align:"start",children:l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{className:"p-3 pb-0",children:[l.jsx("div",{className:"text-xs font-medium text-gray-600 mb-2",children:"ë‚ ì§œ ë²”ìœ„ ì„ íƒ"}),l.jsx(F,{mode:"range",selected:q,onSelect:e=>{e&&$(e)},numberOfMonths:1,initialFocus:!0,className:"compact-calendar"})]}),l.jsxs("div",{className:"flex gap-2 p-3 pt-0",children:[l.jsx(i,{onClick:()=>{$({}),N(!1)},variant:"outline",className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 flex-1",children:"ì·¨ì†Œ"}),l.jsx(i,{onClick:()=>{if(q.from){if(q.to){const e=`${I(q.from,"yyyy-MM-dd")}~${I(q.to,"yyyy-MM-dd")}`;v(t=>({...t,value:e}))}else v(e=>({...e,value:I(q.from,"yyyy-MM-dd")}));N(!1)}},disabled:!q.from,className:"button-base bg-blue-500 text-white hover:bg-blue-600 flex-1",children:"í™•ì¸"})]})]})})]});case"date_month":return l.jsxs(ie,{open:k,onOpenChange:e=>{if(e)if(j.value&&"string"==typeof j.value)if(j.value.includes("~")){const[e,t]=j.value.split("~");P({from:new Date(`${e}-01`),to:new Date(`${t}-01`)})}else P({from:new Date(`${j.value}-01`),to:void 0});else P({});C(e)},children:[l.jsx(ce,{asChild:!0,children:l.jsx(i,{variant:"outline",className:"w-full button-base business-radius-button border border-gray-300 bg-white text-gray-700 justify-between h-auto",children:l.jsxs("div",{className:"flex items-center gap-1.5",children:[l.jsx(xe,{className:"w-3 h-3 flex-shrink-0"}),l.jsx("span",{className:"card-description leading-tight whitespace-pre-line",children:j.value&&"string"==typeof j.value?(()=>{if(j.value.includes("~")){const[e,t]=j.value.split("~"),[a,s]=e.split("-"),[r,n]=t.split("-");return`${a.slice(-2)}/${s}\n~ ${r.slice(-2)}/${n}`}{const[e,t]=String(j.value).split("-");return`${e.slice(-2)}/${t}`}})():"ì›” ì„ íƒ"})]})})}),l.jsx(de,{className:"w-auto p-0",align:"start",children:l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{className:"p-3 pb-0",children:[l.jsx("div",{className:"text-xs font-medium text-gray-600 mb-3",children:"ì›” ì„ íƒ"}),l.jsxs("div",{className:"flex gap-4",children:[l.jsxs("div",{className:"flex-1",children:[l.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"ì‹œì‘ ì›” ì„ íƒ"}),l.jsx("div",{className:"mb-3",children:l.jsxs("div",{className:"flex items-center justify-between mb-2",children:[l.jsx(i,{onClick:()=>{const e=D.from?D.from.getFullYear():(new Date).getFullYear(),t=new Date(e-1,D.from?.getMonth()||0,1);P(e=>({...e,from:t}))},variant:"outline",size:"sm",className:"button-base border border-gray-300 bg-white text-gray-600 hover:bg-gray-50",children:"â€¹"}),l.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[D.from?D.from.getFullYear():(new Date).getFullYear(),"ë…„"]}),l.jsx(i,{onClick:()=>{const e=D.from?D.from.getFullYear():(new Date).getFullYear(),t=new Date(e+1,D.from?D.from.getMonth():0,1);P(e=>({...e,from:t}))},variant:"outline",size:"sm",className:"button-base border border-gray-300 bg-white text-gray-600 hover:bg-gray-50",children:"â€º"})]})}),l.jsx("div",{className:"grid grid-cols-3 gap-2",children:Array.from({length:12},(e,t)=>{const a=D.from?D.from.getFullYear():(new Date).getFullYear(),s=new Date(a,t,1),r=D.from&&D.from.getFullYear()===a&&D.from.getMonth()===t;return l.jsxs(i,{onClick:()=>{P(e=>({...e,from:s}))},variant:"outline",className:"button-base text-xs h-8 "+(r?"bg-blue-500 text-white border-blue-500 hover:bg-blue-600":"border-gray-300 bg-white text-gray-700 hover:bg-gray-50"),children:[t+1,"ì›”"]},t)})})]}),D.from&&l.jsxs("div",{className:"flex-1",children:[l.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"ì¢…ë£Œ ì›” ì„ íƒ (ì„ íƒì‚¬í•­)"}),l.jsx("div",{className:"mb-3",children:l.jsxs("div",{className:"flex items-center justify-between mb-2",children:[l.jsx(i,{onClick:()=>{const e=D.to?D.to.getFullYear():D.from.getFullYear(),t=new Date(e-1,D.to?.getMonth()||11,1);P(e=>({...e,to:t}))},variant:"outline",size:"sm",className:"button-base border border-gray-300 bg-white text-gray-600 hover:bg-gray-50",children:"â€¹"}),l.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[D.to?D.to.getFullYear():D.from.getFullYear(),"ë…„"]}),l.jsx(i,{onClick:()=>{const e=D.to?D.to.getFullYear():D.from.getFullYear(),t=new Date(e+1,D.to?.getMonth()||11,1);P(e=>({...e,to:t}))},variant:"outline",size:"sm",className:"button-base border border-gray-300 bg-white text-gray-600 hover:bg-gray-50",children:"â€º"})]})}),l.jsx("div",{className:"grid grid-cols-3 gap-2",children:Array.from({length:12},(e,t)=>{const a=D.to?D.to.getFullYear():D.from.getFullYear(),s=new Date(a,t,1),r=D.to&&D.to.getFullYear()===a&&D.to.getMonth()===t,n=!!D.from&&s<D.from;return l.jsxs(i,{onClick:()=>{n||P(e=>({...e,to:s}))},variant:"outline",disabled:n,className:"button-base text-xs h-8 "+(r?"bg-blue-500 text-white border-blue-500 hover:bg-blue-600":n?"border-gray-200 bg-gray-100 text-gray-400 cursor-not-allowed":"border-gray-300 bg-white text-gray-700 hover:bg-gray-50"),children:[t+1,"ì›”"]},t)})}),l.jsx("div",{className:"mt-3",children:l.jsx(i,{onClick:()=>{P(e=>({...e,to:void 0}))},variant:"outline",size:"sm",className:"button-base border border-gray-300 bg-white text-gray-600 hover:bg-gray-50 text-xs",children:"ì¢…ë£Œ ì›” ì œê±°"})})]})]})]}),l.jsxs("div",{className:"flex gap-2 p-3 pt-0",children:[l.jsx(i,{onClick:()=>{P({}),C(!1)},variant:"outline",className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 flex-1",children:"ì·¨ì†Œ"}),l.jsx(i,{onClick:()=>{if(D.from){if(D.to){const e=`${I(D.from,"yyyy-MM")}~${I(D.to,"yyyy-MM")}`;v(t=>({...t,value:e}))}else v(e=>({...e,value:I(D.from,"yyyy-MM")}));C(!1)}},disabled:!D.from,className:"button-base bg-blue-500 text-white hover:bg-blue-600 flex-1",children:"í™•ì¸"})]})]})})]});default:return null}};return l.jsx("div",{className:"w-full",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[l.jsxs(ie,{open:x,onOpenChange:g,children:[l.jsx(ce,{asChild:!0,children:l.jsxs(i,{variant:"outline",className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50",children:[l.jsx($e,{className:"w-4 h-4 mr-1"}),l.jsx("span",{className:"button-text",children:"í•„í„°"}),e.length>0&&l.jsx("span",{className:"ml-1 badge-stats bg-blue-50 text-blue-700",children:e.length})]})}),l.jsx(de,{className:"w-64 p-3",align:"start",children:l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("h4",{className:"card-title",children:"í•„í„°"}),e.length>0&&l.jsx(i,{variant:"ghost",onClick:()=>{r([]),g(!1)},className:"button-base text-red-600 hover:text-red-700 hover:bg-red-50",children:l.jsx("span",{className:"button-text",children:"ëª¨ë‘ ì§€ìš°ê¸°"})})]}),e.length>0&&l.jsxs("div",{className:"space-y-2",children:[e.map(e=>l.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 business-radius",children:[l.jsxs("span",{className:"card-description",children:[e.label,e.dateField&&l.jsxs("span",{className:"text-blue-600",children:["(",ft.find(t=>t.value===e.dateField)?.label,")"]}),": ",String(e.value)]}),l.jsx(i,{variant:"ghost",onClick:()=>U(e.id),className:"button-base h-6 w-6 p-0 hover:bg-red-50",children:l.jsx(d,{className:"w-3 h-3"})})]},e.id)),l.jsx("div",{className:"border-t border-gray-200 my-2"})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs(oe,{onValueChange:e=>{const t=bt.find(t=>t.key===e);if(!t)return;let a="contains";"date_range"!==t.type&&"date_month"!==t.type||(a="equals"),v({id:`${e}_${Date.now()}`,field:e,condition:a,value:"",label:t.label})},children:[l.jsx(ue,{className:"button-base business-radius-button border border-gray-300 bg-white text-gray-700 [&>svg]:hidden text-center",children:l.jsx(me,{placeholder:"+ í•„í„° ì¶”ê°€"})}),l.jsx(pe,{className:"w-64 max-h-80 overflow-y-auto",style:{scrollbarWidth:"auto",scrollbarColor:"#9ca3af #f3f4f6"},children:Object.entries(bt.reduce((e,t)=>(e[t.category]||(e[t.category]=[]),e[t.category].push(t),e),{})).map(([e,t])=>l.jsxs("div",{children:[l.jsx("div",{className:"px-2 py-1 card-description uppercase",children:e}),t.map(e=>l.jsx(he,{value:e.key,children:l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(e.icon,{className:"w-4 h-4"}),l.jsx("span",{className:"card-description",children:e.label})]})},e.key))]},e))})]}),j.field&&l.jsxs("div",{className:"space-y-2 p-3 border business-radius bg-white",children:[l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("span",{className:"card-title",children:[j.label," í•„í„°"]})}),"date_range"===j.field||"date_month"===j.field?l.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[l.jsx("div",{className:"flex items-start",children:l.jsxs(oe,{value:j.dateField||"",onValueChange:e=>v(t=>({...t,dateField:e})),children:[l.jsx(ue,{className:"w-full button-base business-radius-button border border-gray-300 bg-white text-gray-700 [&>svg]:hidden text-center justify-center",children:l.jsx(me,{placeholder:"ë‚ ì§œ í•­ëª©",className:"text-center"})}),l.jsx(pe,{children:ft.map(e=>l.jsx(he,{value:e.value,children:l.jsx("span",{className:"card-description",children:e.label})},e.value))})]})}),l.jsx("div",{className:"flex items-start",children:V()})]}):l.jsx("div",{children:V()}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx(i,{onClick:()=>{const t="date_range"===j.field||"date_month"===j.field,a=t&&!j.dateField;let s=j.condition;if(!s)if(t)s="equals";else{const e=bt.find(e=>e.key===j.field);s="select"===e?.type||"select_with_empty"===e?.type||"searchable_select"===e?.type?"equals":"contains"}if(j.field&&void 0!==s&&void 0!==j.value&&""!==j.value&&!a){const t={id:j.id,field:j.field,condition:s,value:j.value,label:j.label,dateField:j.dateField};r([...e,t]),v({}),g(!1)}},disabled:!j.field||""===j.value||("date_range"===j.field||"date_month"===j.field)&&!j.dateField,className:"button-base bg-blue-500 text-white hover:bg-blue-600 flex-1",children:"ì ìš©"}),l.jsx(i,{variant:"outline",onClick:()=>v({}),className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 flex-1",children:"ì·¨ì†Œ"})]})]})]})]})})]}),l.jsxs(ie,{open:_,onOpenChange:y,children:[l.jsx(ce,{asChild:!0,children:l.jsxs(i,{variant:"outline",className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50",children:[l.jsx(z,{className:"w-4 h-4 mr-1"}),l.jsx("span",{className:"button-text",children:"ì •ë ¬"}),t&&l.jsxs("span",{className:"ml-1 card-description",children:["(","asc"===t.direction?"â†‘":"â†“",")"]})]})}),l.jsx(de,{className:"w-56 p-3",align:"start",children:l.jsxs("div",{className:"space-y-3",children:[l.jsx("h4",{className:"card-title",children:"ì •ë ¬ ì„¤ì •"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{children:[l.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"ì •ë ¬ ê¸°ì¤€"}),l.jsxs(oe,{value:T.field||"",onValueChange:e=>{E(t=>({...t,field:e}))},children:[l.jsx(ue,{className:"button-base business-radius-button border border-gray-300 bg-white text-gray-700 [&>svg]:hidden",children:l.jsx(me,{placeholder:"ì„ íƒí•˜ì„¸ìš”"})}),l.jsx(pe,{children:jt.map(e=>l.jsx(he,{value:e.value,children:l.jsx("span",{className:"card-description",children:e.label})},e.value))})]})]}),T.field&&l.jsxs("div",{children:[l.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"ì •ë ¬ ë°©í–¥"}),l.jsxs(oe,{value:T.direction||"",onValueChange:e=>{E(t=>({...t,direction:e}))},children:[l.jsx(ue,{className:"button-base business-radius-button border border-gray-300 bg-white text-gray-700 [&>svg]:hidden",children:l.jsx(me,{placeholder:"ì„ íƒí•˜ì„¸ìš”"})}),l.jsxs(pe,{children:[l.jsx(he,{value:"asc",children:l.jsx("span",{className:"card-description",children:"ì˜¤ë¦„ì°¨ìˆœ â†‘"})}),l.jsx(he,{value:"desc",children:l.jsx("span",{className:"card-description",children:"ë‚´ë¦¼ì°¨ìˆœ â†“"})})]})]})]}),l.jsxs("div",{className:"flex gap-2 pt-2",children:[l.jsx(i,{onClick:()=>{if(T.field&&T.direction){const e=jt.find(e=>e.value===T.field);e&&n({field:T.field,direction:T.direction,label:e.label})}y(!1),E({})},disabled:!T.field||!T.direction,className:"button-base bg-blue-500 hover:bg-blue-600 text-white flex-1",children:"ì ìš©"}),l.jsx(i,{onClick:()=>{n(null),E({}),y(!1)},className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50",children:"ì´ˆê¸°í™”"})]})]}),t&&l.jsx("div",{className:"border-t pt-2",children:l.jsx(i,{variant:"outline",onClick:()=>n(null),className:"button-base w-full border border-gray-300 text-gray-700",children:l.jsx("span",{className:"button-text",children:"ì •ë ¬ í•´ì œ"})})})]})})]}),l.jsx("div",{className:"flex items-center gap-2",children:b?l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(te,{ref:L,placeholder:"ì „ì²´ ê²€ìƒ‰...",value:a,onChange:e=>c(e.target.value),className:"w-64 business-radius-input button-base border border-gray-300 bg-white text-gray-700"}),l.jsx(i,{variant:"ghost",onClick:()=>{f(!1),c("")},className:"button-base h-8 w-8 p-0",children:l.jsx(d,{className:"w-4 h-4"})})]}):l.jsxs(i,{variant:"outline",onClick:()=>f(!0),className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50",children:[l.jsx(ge,{className:"w-4 h-4 mr-1"}),l.jsx("span",{className:"button-text",children:"ê²€ìƒ‰"})]})}),l.jsxs(i,{variant:"outline",onClick:()=>{c(""),r([]),n({field:"created_at",direction:"desc",label:"ìƒì„±ì¼"}),f(!1)},className:"button-base border border-gray-300 bg-white text-blue-600 hover:bg-blue-50 hover:border-blue-300",children:["â†» ",l.jsx("span",{className:"button-text text-blue-600",children:"ì´ˆê¸°í™”"})]}),e.length>0&&l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"h-6 w-px bg-gray-300 mx-3"}),l.jsx("div",{className:"flex items-center gap-2 flex-nowrap overflow-x-auto",children:e.map(e=>l.jsxs("span",{className:"badge-stats flex items-center gap-1 bg-blue-50 text-blue-700 border border-blue-200 whitespace-nowrap",children:[e.label,e.dateField&&l.jsxs("span",{className:"text-blue-600",children:["(",ft.find(t=>t.value===e.dateField)?.label,")"]}),": ",String(e.value),l.jsx(i,{variant:"ghost",size:"sm",onClick:()=>U(e.id),className:"h-4 w-4 p-0 hover:bg-blue-100 ml-1",children:l.jsx(d,{className:"w-3 h-3"})})]},e.id))})]})]}),l.jsx("div",{className:"flex items-center gap-2",children:h})]})})}const wt=s.lazy(()=>g(()=>import("./PurchaseDetailModal-DFSq3uwl.js").then(e=>e.i),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16])));function Nt({isOpen:e,onClose:t,purchases:a,onRefresh:c,currentUserName:d}){const[o,u]=s.useState(new Set),[m,g]=s.useState([]),_=s.useRef(!1),y=s.useRef(!1),[b,f]=s.useState(null),[j,v]=s.useState(""),[w,k]=s.useState(""),[C,q]=s.useState(!1),[$,S]=s.useState(null),[M,D]=s.useState(!1),P=s.useRef(t);P.current=t;const I=n(),F=s.useCallback(()=>{const e=new Date;e.setHours(0,0,0,0);const t=[];return a.forEach(a=>{if(a.is_received||"completed"===a.delivery_status)return;if("approved"!==a.middle_manager_status||"approved"!==a.final_manager_status)return;if(d&&a.requester_name!==d)return;if(!0===a.delivery_revision_requested)return;const s=a.delivery_request_date?new Date(a.delivery_request_date):null,r=a.revised_delivery_request_date?new Date(a.revised_delivery_request_date):null;s&&s.setHours(0,0,0,0),r&&r.setHours(0,0,0,0),r&&r<e?t.push({purchase:a,warningType:"revision_overdue",daysOverdue:Math.floor((e.getTime()-r.getTime())/864e5)}):s&&s<e&&!r&&t.push({purchase:a,warningType:"delivery_overdue",daysOverdue:Math.floor((e.getTime()-s.getTime())/864e5)})}),t.sort((e,t)=>t.daysOverdue-e.daysOverdue)},[a,d]),E=m;s.useEffect(()=>{if(e&&!_.current){u(new Set),f(null),y.current=!1;const e=F();g(e),_.current=!0}e||(_.current=!1)},[e,F]);const R=s.useMemo(()=>0===E.length||E.every(e=>o.has(e.purchase.id)),[E,o]),O=s.useMemo(()=>0===E.length?100:Math.round(o.size/E.length*100),[E.length,o.size]);s.useEffect(()=>{100===O&&E.length>0&&!y.current&&(y.current=!0,setTimeout(()=>{P.current()},300))},[O,E.length]);const L=s.useRef(!0);s.useEffect(()=>{if(!e)return;const t=r(()=>{L.current?L.current=!1:c?.()});return()=>t()},[e,c]);const U=s.useCallback((e,t)=>{f(e),v(`[ì…ê³ ì¼ ìˆ˜ì •ìš”ì²­] ${t}`),k("")},[]),z=s.useCallback(async e=>{if(j.trim()&&w.trim()){q(!0);try{const{data:{user:t}}=await I.auth.getUser();if(!t)return void N.error("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");const{error:a}=await I.from("support_inquires").insert({user_id:t.id,user_email:t.email,user_name:d,inquiry_type:"modify",subject:j,message:w,status:"open",purchase_request_id:e.id,purchase_order_number:e.purchase_order_number,requester_id:e.requester_id,purchase_info:JSON.stringify({vendor_name:e.vendor_name,delivery_request_date:e.delivery_request_date,revised_delivery_request_date:e.revised_delivery_request_date})});if(a)throw a;const{error:s}=await I.from("purchase_requests").update({delivery_revision_requested:!0,delivery_revision_requested_at:(new Date).toISOString(),delivery_revision_requested_by:d||"unknown"}).eq("id",e.id);if(s)throw s;p(e.id,e=>({...e,delivery_revision_requested:!0,delivery_revision_requested_at:(new Date).toISOString(),delivery_revision_requested_by:d||"unknown"}))&&h(),u(t=>new Set(t).add(e.id)),f(null),v(""),k(""),N.success("ìˆ˜ì • ìš”ì²­ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.")}catch(t){N.error("ìˆ˜ì • ìš”ì²­ ì „ì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{q(!1)}}else N.error("ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.")},[I,d,j,w]),V=s.useCallback(()=>{R?t():N.error(`ëª¨ë“  í•­ëª©(${E.length}ê±´)ì— ëŒ€í•´ ìˆ˜ì •ìš”ì²­ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.`)},[R,t,E.length]),B=e=>{if(!e)return"-";const t=new Date(e);return`${t.getFullYear()}.${String(t.getMonth()+1).padStart(2,"0")}.${String(t.getDate()).padStart(2,"0")}`},W=s.useCallback(e=>{S(e),D(!0)},[]),Y=s.useCallback(()=>{D(!1),S(null)},[]);return 0===E.length?null:l.jsxs(l.Fragment,{children:[l.jsx(ae,{open:e,onOpenChange:e=>!e&&V(),children:l.jsxs(se,{className:"max-w-2xl max-h-[80vh] flex flex-col p-0 gap-0",showCloseButton:!1,children:[l.jsxs(re,{className:"px-5 py-4 border-b",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(x,{className:"w-5 h-5 text-red-500"}),l.jsx(ne,{className:"page-title text-base",children:"ì…ê³  ì¼ì • ì§€ì—° ì•Œë¦¼"})]}),l.jsxs("span",{className:"text-xs text-gray-500",children:[o.size,"/",E.length," ì™„ë£Œ"]})]}),l.jsx(je,{value:O,className:"h-1 mt-3"})]}),l.jsx("div",{className:"flex-1 overflow-auto p-4 space-y-2",children:E.map(e=>{const t=o.has(e.purchase.id);return l.jsx("div",{className:"border rounded-lg p-3 transition-all duration-200 cursor-pointer hover:border-hansl-400 "+(t?"bg-gray-50 opacity-60":"bg-white"),onClick:()=>W(e.purchase.id),children:l.jsxs("div",{className:"flex items-center justify-between gap-3",children:[l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[l.jsx("span",{className:"text-sm font-medium text-gray-900",children:e.purchase.purchase_order_number}),l.jsx("span",{className:"text-xs text-gray-500",children:e.purchase.vendor_name})]}),l.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:[l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx(xe,{className:"w-3 h-3"}),"ì…ê³ ìš”ì²­: ",B(e.purchase.delivery_request_date)]}),e.purchase.revised_delivery_request_date&&l.jsxs("span",{children:["ë³€ê²½: ",B(e.purchase.revised_delivery_request_date)]}),l.jsxs("span",{className:"text-red-500",children:[e.daysOverdue,"ì¼ ê²½ê³¼"]})]})]}),l.jsx("div",{className:"flex-shrink-0",onClick:e=>e.stopPropagation(),children:t?l.jsxs(i,{size:"sm",disabled:!0,className:"button-base bg-gray-100 text-gray-500 h-7 px-3 text-xs",children:[l.jsx(A,{className:"w-3 h-3 mr-1"}),"ìš”ì²­ ì™„ë£Œ"]}):l.jsxs(ie,{open:b===e.purchase.id,onOpenChange:t=>{t?U(e.purchase.id,e.purchase.purchase_order_number):f(null)},children:[l.jsx(ce,{asChild:!0,children:l.jsxs(i,{size:"sm",className:"button-base bg-hansl-600 hover:bg-hansl-700 text-white h-7 px-3 text-xs",children:[l.jsx(T,{className:"w-3 h-3 mr-1"}),"ìˆ˜ì • ìš”ì²­"]})}),l.jsx(de,{className:"w-80 p-4",align:"end",onOpenAutoFocus:e=>e.preventDefault(),children:l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{children:[l.jsx("h4",{className:"font-medium text-sm",children:"ì…ê³ ì¼ ìˆ˜ì • ìš”ì²­"}),l.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:e.purchase.vendor_name})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{children:[l.jsx(le,{className:"text-xs",children:"ì œëª©"}),l.jsx(te,{value:j,onChange:e=>v(e.target.value),className:"h-8 text-xs mt-1"})]}),l.jsxs("div",{children:[l.jsx(le,{className:"text-xs",children:"ë‚´ìš©"}),l.jsx(we,{value:w,onChange:e=>k(e.target.value),className:"min-h-[80px] text-xs mt-1",placeholder:"ë³€ê²½ ìš”ì²­ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"})]})]}),l.jsxs("div",{className:"flex justify-end gap-2",children:[l.jsx(i,{variant:"outline",size:"sm",onClick:()=>f(null),className:"button-base h-7 text-xs",children:"ì·¨ì†Œ"}),l.jsxs(i,{size:"sm",onClick:()=>z(e.purchase),disabled:C,className:"button-base bg-hansl-600 hover:bg-hansl-700 text-white h-7 text-xs",children:[C&&l.jsx(Ne,{className:"w-3 h-3 animate-spin mr-1"}),"ìš”ì²­ ì „ì†¡"]})]})]})})]})})]})},e.purchase.id)})}),l.jsx("div",{className:"border-t px-5 py-3",children:l.jsx("p",{className:"text-xs text-gray-500 text-center",children:"â„¹ï¸ ëª¨ë“  ìˆ˜ì • ìš”ì²­ì´ ì™„ë£Œë˜ë©´ ì´ ì°½ì´ ìë™ìœ¼ë¡œ ë‹«í™ë‹ˆë‹¤"})})]})}),$&&l.jsx(s.Suspense,{fallback:l.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[100]",children:l.jsx(Ne,{className:"w-8 h-8 animate-spin text-white"})}),children:l.jsx(wt,{purchaseId:$,isOpen:M,onClose:Y,activeTab:"receipt",onRefresh:c})})]})}const kt=["purchase_manager","app_admin","raw_material_manager","consumable_manager"],Ct=["ì •í¬ì›…"];function qt(e,t){return a=t,kt.some(e=>a.includes(e))?e:e.filter(e=>!Ct.includes(e.requester_name));var a}const $t=s.lazy(()=>g(()=>import("./PurchaseItemsModal-BtjDgQ39.js"),__vite__mapDeps([17,1,2,7,9,0,3,4,5,6,8,10,11,12,13,14,15,16]))),St=[{key:"pending",label:"ìŠ¹ì¸ëŒ€ê¸°"},{key:"purchase",label:"êµ¬ë§¤ í˜„í™©"},{key:"receipt",label:"ì…ê³  í˜„í™©"},{key:"done",label:"ì „ì²´ í•­ëª©"}];function Mt({showEmailButton:e=!0}){const r=_(),c=y(),d=n(),[o,u]=s.useState(null),[p,h]=s.useState(!1),[x,g]=s.useState(!1),C=s.useRef(!1),[q,$]=s.useState([]),[S,M]=s.useState({field:"created_at",direction:"desc",label:"ìƒì„±ì¼"}),[D,P]=s.useState(""),[I,F]=s.useState([]),[T,E]=s.useState([]),[R,O]=s.useState([]),[L,U]=s.useState([]),{allPurchases:z,loading:V,currentUser:B,getFilteredPurchases:A}=Re(),{columnVisibility:W,isLoading:Y,applyColumnSettings:J,resetToDefault:H}=(()=>{const[e,a]=s.useState(k),[r,l]=s.useState(!0),[i,c]=s.useState(null),[,d]=s.useState(0),o=n(),u=s.useCallback(async()=>{try{l(!0),c(null);const{data:{user:e},error:s}=await o.auth.getUser();if(s||!e?.email)return t.warn("[useColumnSettings] ì‚¬ìš©ì ì¸ì¦ ì •ë³´ ì—†ìŒ",{authError:s}),void a(k);const{data:r,error:n}=await o.from("user_ui_settings").select("setting_value").eq("user_email",e.email).eq("setting_type","column_visibility").eq("setting_key","purchase_list_done").maybeSingle();if(n)return t.error("[useColumnSettings] ì„¤ì • ì¡°íšŒ ì‹¤íŒ¨",n,{userEmail:e.email}),c("ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."),void a(k);if(r?.setting_value){const s=r.setting_value,n={...k,...s};a(n),t.debug("[useColumnSettings] ì‚¬ìš©ì ì„¤ì • ë¡œë“œ ì™„ë£Œ",{userEmail:e.email,settingsCount:Object.keys(n).length})}else a(k),t.debug("[useColumnSettings] ê¸°ë³¸ ì„¤ì • ì‚¬ìš©",{userEmail:e.email})}catch(e){t.error("[useColumnSettings] ì„¤ì • ë¡œë“œ ì¤‘ ì˜ˆì™¸ ë°œìƒ",e),c("ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."),a(k)}finally{l(!1)}},[o]),m=s.useCallback(async e=>{try{const{data:{user:a},error:s}=await o.auth.getUser();if(s||!a?.email)return void t.warn("[useColumnSettings] ì‚¬ìš©ì ì¸ì¦ ì •ë³´ ì—†ìŒ - ì €ì¥ ì‹¤íŒ¨",{authError:s});const{error:r}=await o.from("user_ui_settings").upsert({user_email:a.email,setting_type:"column_visibility",setting_key:"purchase_list_done",setting_value:e},{onConflict:"user_email,setting_type,setting_key"});if(r)throw t.error("[useColumnSettings] ì„¤ì • ì €ì¥ ì‹¤íŒ¨",r,{userEmail:a.email,settings:e}),r;t.info("[useColumnSettings] ì„¤ì • ì €ì¥ ì„±ê³µ",{userEmail:a.email,settingsCount:Object.keys(e).length,visibleColumns:Object.entries(e).filter(([,e])=>e).length})}catch(a){throw t.error("[useColumnSettings] ì„¤ì • ì €ì¥ ì¤‘ ì˜ˆì™¸ ë°œìƒ",a),a}},[o]),p=s.useCallback(e=>{a(s=>{const r={...s,[e]:!s[e]};return m(r).catch(e=>{a(s),N.error("ì„¤ì • ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."),t.error("[useColumnSettings] í† ê¸€ ì €ì¥ ì‹¤íŒ¨, ë¡¤ë°± ì²˜ë¦¬",e)}),r})},[m]),h=s.useCallback(e=>{t.info("[useColumnSettings] applyColumnSettings í˜¸ì¶œ",{newSettings:e,keys:Object.keys(e),values:Object.values(e)}),a(e),d(e=>e+1),t.info("[useColumnSettings] setColumnVisibility í˜¸ì¶œë¨",{newSettings:e}),m(e).then(()=>{N.success("ì¹¼ëŸ¼ ì„¤ì •ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤."),t.info("[useColumnSettings] DB ì €ì¥ ì„±ê³µ")}).catch(e=>{t.error("[useColumnSettings] ì„¤ì • ì €ì¥ ì‹¤íŒ¨",e),N.error("ì„¤ì • ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")})},[m]),x=s.useCallback(()=>{a(k),m(k).catch(e=>{N.error("ê¸°ë³¸ ì„¤ì • ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."),t.error("[useColumnSettings] ê¸°ë³¸ê°’ ì €ì¥ ì‹¤íŒ¨",e)}),N.success("ì¹¼ëŸ¼ ì„¤ì •ì´ ê¸°ë³¸ê°’ìœ¼ë¡œ ì¬ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.")},[m]);return s.useEffect(()=>{u()},[u]),{columnVisibility:e,toggleColumn:p,applyColumnSettings:h,resetToDefault:x,isLoading:r,error:i}})();s.useMemo(()=>!!W&&Object.values(W).some(e=>!e),[W]),s.useEffect(()=>{t.info("[PurchaseListMain] columnVisibility ìƒíƒœ",{columnVisibility:W})},[W]);const K=Array.isArray(B?.purchase_role)?B.purchase_role.map(e=>e.trim()):"string"==typeof B?.purchase_role?B.purchase_role.split(",").map(e=>e.trim()):[],Z=B?.name||null,[Q,G]=s.useState(0),[X,ee]=s.useState({pending:0,purchase:0,receipt:0,done:0}),te=s.useCallback(async()=>{t.debug("ğŸ”„ [loadPurchases] ê°•ì œ ìƒˆë¡œê³ ì¹¨ íŠ¸ë¦¬ê±°"),G(e=>e+1)},[]),ae=s.useCallback((e,t)=>{b(e,t)},[]),se=K?.includes("app_admin"),re=s.useMemo(()=>{return(e=K)&&0!==e.length?e.includes("app_admin")||e.includes("ceo")?3:e.includes("consumable_manager")||e.includes("raw_material_manager")||e.includes("purchase_manager")||e.includes("lead buyer")||e.includes("middle_manager")?2:1:1;var e},[K]),ne=s.useMemo(()=>{if(!Z)return t.warn("[defaultEmployeeByTab] currentUserNameì´ ì—†ìŒ",{currentUser:B,currentUserRoles:K}),{pending:"all",purchase:"all",receipt:"all",done:"all"};const e=K.includes("hr"),a=K.includes("purchase_manager"),s=K.some(e=>["app_admin","ceo","lead buyer","finance_team","raw_material_manager","consumable_manager","purchase_manager","hr"].includes(e)),r={pending:3===re?"all":Z,purchase:s||3===re?"all":Z,receipt:e||a||3===re?"all":Z,done:"all"};return t.info("[defaultEmployeeByTab ê³„ì‚° ê²°ê³¼]",{currentUserName:Z,roleCase:re,currentUserRoles:K,hasManagerRole:s,result:r}),r},[Z,re,K]),le=(()=>{const e=new URLSearchParams(c.search).get("tab");return e&&["pending","purchase","receipt","done"].includes(e)?e:"pending"})(),[ie,ce]=s.useState(le),[de,oe]=s.useState("all"),[ue,me]=s.useTransition(),pe=s.useMemo(()=>qt(z,K),[z,K]),he=function(e,t){return s.useMemo(()=>{const a=new Date;a.setHours(0,0,0,0);let s=0;return e.forEach(e=>{if(e.is_received||"completed"===e.delivery_status)return;if("approved"!==e.middle_manager_status||"approved"!==e.final_manager_status)return;if(t&&e.requester_name!==t)return;if(!0===e.delivery_revision_requested)return;const r=e.delivery_request_date?new Date(e.delivery_request_date):null,n=e.revised_delivery_request_date?new Date(e.revised_delivery_request_date):null;r&&r.setHours(0,0,0,0),n&&n.setHours(0,0,0,0),(n&&n<a||r&&r<a&&!n)&&s++}),s},[e,t])}(pe,Z);s.useEffect(()=>{if(!C.current&&!V&&he>0&&pe.length>0){const e=setTimeout(()=>{C.current||(C.current=!0,g(!0))},500);return()=>clearTimeout(e)}},[V,he,pe.length]),s.useEffect(()=>{if(ne&&null!==Z){const e=ne[ie];void 0!==e&&(oe(e),t.info("[ì´ˆê¸° selectedEmployee ì„¤ì •]",{activeTab:ie,initialEmployeeValue:e,defaultEmployeeByTab:ne}))}},[]),s.useEffect(()=>{const e=new URLSearchParams(c.search).get("tab");e&&["pending","purchase","receipt","done"].includes(e)&&ce(e)},[c.search]),s.useEffect(()=>{const e=ne[ie];void 0!==e&&oe(e)},[ie,ne]),s.useEffect(()=>{(async()=>{if(!v()||!a.allPurchases){t.info("ğŸ”„ [PurchaseListMain] ìºì‹œ ë¬´íš¨í™” ê°ì§€, ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì¤‘...",{isCacheValid:v(),hasData:!!a.allPurchases,lastFetch:a.lastFetch});try{await w(B?.id),t.info("âœ… [PurchaseListMain] ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ")}catch(e){t.error("âŒ [PurchaseListMain] ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨:",e)}}})()},[B?.id]),s.useEffect(()=>{(async()=>{try{const{data:e}=await d.from("employees").select("name");if(e){const t=[...new Set(e.map(e=>e.name).filter(Boolean))];F(t)}const{data:t}=await d.from("vendors").select("vendor_name");if(t){const e=[...new Set(t.map(e=>e.vendor_name).filter(Boolean))];E(e)}const{data:a}=await d.from("vendor_contacts").select("contact_name");if(a){const e=[...new Set(a.map(e=>e.contact_name).filter(Boolean))];O(e)}const{data:s}=await d.from("vendors").select("vendor_payment_schedule");if(s){const e=[...new Set(s.map(e=>e.vendor_payment_schedule).filter(Boolean))];U(e)}}catch(e){t.error("í•„í„° ì˜µì…˜ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨",e)}})()},[d]),s.useCallback(e=>e.is_received?l.jsx("span",{className:"badge-stats bg-green-500 text-white",children:"ì…ê³ ì™„ë£Œ"}):"approved"===e.middle_manager_status&&"approved"===e.final_manager_status?l.jsx("span",{className:"badge-stats bg-blue-500 text-white",children:"êµ¬ë§¤ì§„í–‰"}):"rejected"===e.middle_manager_status||"rejected"===e.final_manager_status?l.jsx("span",{className:"badge-stats bg-red-500 text-white",children:"ë°˜ë ¤"}):l.jsx("span",{className:"badge-stats bg-yellow-500 text-white",children:"ìŠ¹ì¸ëŒ€ê¸°"}),[]),s.useCallback((e,t)=>{switch(t){case"purchase_order_number":return e.purchase_order_number;case"payment_category":return e.payment_category;case"requester_name":return e.requester_name;case"vendor_name":return e.vendor_name;case"contact_name":case"payment_schedule":return"-";case"item_name":return e.purchase_request_items?.[0]?.item_name||"";case"specification":return e.purchase_request_items?.[0]?.specification||"";case"quantity":return e.purchase_request_items?.[0]?.quantity||0;case"unit_price_value":return e.purchase_request_items?.[0]?.unit_price_value||0;case"total_amount":return e.total_amount;case"remark":return e.purchase_request_items?.[0]?.remark||"";case"project_vendor":return e.project_vendor;case"project_item":return e.project_item;case"sales_order_number":return e.sales_order_number;case"is_payment_completed":return e.is_payment_completed?"ì™„ë£Œ":"ëŒ€ê¸°";case"is_received":return e.is_received?"ì™„ë£Œ":"ëŒ€ê¸°";case"is_statement_received":return e.is_statement_received?"ì™„ë£Œ":"ëŒ€ê¸°";case"is_utk_checked":return e.is_utk_checked?"ì™„ë£Œ":"ëŒ€ê¸°";case"request_date":return e.request_date;case"delivery_request_date":return e.delivery_request_date;case"payment_completed_at":return e.payment_completed_at;case"received_at":return e.received_at;case"created_at":return e.created_at;case"statement_received_at":return e.purchase_request_items?.[0]?.statement_received_date||null;default:return null}},[]),s.useCallback((e,a,s,r)=>{if(null==e)return"is_empty"===a;if("date_range"===r&&s&&"string"==typeof s&&s.includes("~")){if(!e)return!1;const[t,a]=s.split("~"),r=new Date(e),n=new Date(t),l=new Date(a);return r>=n&&r<=l}if("date_month"===r&&s&&"string"==typeof s&&s.includes("~")){if(!e)return!1;const[t,a]=s.split("~"),r=new Date(e),n=new Date(`${t}-01`),l=new Date(`${a}-01`),i=new Date(l.getFullYear(),l.getMonth()+1,0,23,59,59);return r>=n&&r<=i}if(r&&("date_month"===r||r.endsWith("_month"))){if(!s)return!0;const t=new Date(e),[a,r]=s.split("-");return t.getFullYear()===parseInt(a)&&t.getMonth()+1===parseInt(r)}const n=String(e).toLowerCase(),l=String(s).toLowerCase();switch(a){case"contains":return n.includes(l);case"equals":if("date_range"===r||s.match(/^[0-9]{4}-[0-9]{2}-[0-9]{2}/)){if(!e)return!1;try{const t=new Date(e).toISOString().split("T")[0];return t===s.split("T")[0]}catch(i){return t.error("ë‚ ì§œ ë¹„êµ ì˜¤ë¥˜:",i),!1}}return n===l;case"starts_with":return n.startsWith(l);case"ends_with":return n.endsWith(l);case"is_empty":return!e||""===n.trim();case"is_not_empty":return!!e&&""!==n.trim();case"greater_than":return Number(e)>Number(s);case"less_than":return Number(e)<Number(s);case"between":default:return!0;case"after":return new Date(e)>new Date(s);case"before":return new Date(e)<new Date(s);case"not_equals":return n!==l}},[]);const xe=s.useMemo(()=>A({tab:ie,employeeName:"all"===de||"ì „ì²´"===de?null:de,searchTerm:D,advancedFilters:q,sortConfig:S?{key:S.field,direction:S.direction}:void 0}),[A,ie,de,D,q,S,z]);s.useEffect(()=>{if(z&&z.length>0){const e=Te(z,B);ee(e)}else if(a.allPurchases&&a.allPurchases.length>0){const e=Te(a.allPurchases,B);ee(e)}},[z,B]);const ge=X,je=s.useMemo(()=>{if(!D&&0===q.length)return ge;const e={pending:0,purchase:0,receipt:0,done:0};return["pending","purchase","receipt","done"].forEach(t=>{const a=A({tab:t,employeeName:"all"===ne[t]?null:ne[t],searchTerm:D,advancedFilters:q,sortConfig:S?{key:S.field,direction:S.direction}:void 0});e[t]=a.length}),e},[D,q,ge,A,ne,S]),we=s.useCallback(e=>D||q.length>0?je[e].toString():"done"===e?"ì „ì²´":ge[e].toString(),[D,q.length,je,ge]),Ne=s.useMemo(()=>{const e=q.filter(e=>"date_month"===e.field||"date_range"===e.field&&e.dateField&&e.dateField.includes("_month"));if(0===e.length)return null;const t=xe.reduce((e,t)=>{if(t.purchase_request_items?.length){return e+t.purchase_request_items.reduce((e,a)=>e+(a.amount_value||0)+("ë°œì£¼"===t.payment_category&&a.tax_amount_value?a.tax_amount_value:0),0)}const a=t.total_amount||0;return e+a+("ë°œì£¼"===t.payment_category?.1*a:0)},0),a=e[0].value;if(a&&"string"==typeof a&&a.includes("~")){const[e,s]=a.split("~"),r=new Date(`${e}-01`),n=new Date(`${s}-01`),l=[];let i=0;const c=new Date(r);for(;c<=n;){const e=c.getFullYear(),t=c.getMonth()+1,a=`${e}-${t.toString().padStart(2,"0")}`,s=xe.filter(a=>{const s=new Date(a.request_date);return s.getFullYear()===e&&s.getMonth()+1===t}),r=s.reduce((e,t)=>{if(t.purchase_request_items?.length){return e+t.purchase_request_items.reduce((e,a)=>e+(a.amount_value||0)+("ë°œì£¼"===t.payment_category&&a.tax_amount_value?a.tax_amount_value:0),0)}const a=t.total_amount||0;return e+a+("ë°œì£¼"===t.payment_category?.1*a:0)},0);l.push({year:e,month:t,monthStr:a,total:r,count:s.length}),i+=r,c.setMonth(c.getMonth()+1)}return{type:"range",months:l,grandTotal:i,totalFilteredAmount:t}}{const[e,s]=("string"==typeof a?a:"").split("-"),r=xe.filter(t=>{const a=new Date(t.request_date);return a.getFullYear()===parseInt(e)&&a.getMonth()+1===parseInt(s)}),n=r.reduce((e,t)=>{if(t.purchase_request_items?.length){return e+t.purchase_request_items.reduce((e,a)=>e+(a.amount_value||0)+("ë°œì£¼"===t.payment_category&&a.tax_amount_value?a.tax_amount_value:0),0)}const a=t.total_amount||0;return e+a+("ë°œì£¼"===t.payment_category?.1*a:0)},0);return{type:"single",year:parseInt(e),month:parseInt(s),total:n,count:r.length,totalFilteredAmount:t}}},[q,xe]),ke=s.useCallback(async e=>{try{const a=(new Date).toISOString(),[s,r]=await Promise.all([d.from("purchase_requests").update({is_received:!0,received_at:a}).eq("id",e),d.from("purchase_request_items").update({is_received:!0,delivery_status:"received"}).eq("purchase_request_id",e)]);if(s.error)throw s.error;if(r.error)throw r.error;f(e)||t.warn("[PurchaseListMain] ë©”ëª¨ë¦¬ ìºì‹œ ì…ê³ ì™„ë£Œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨",{purchaseId:e}),N.success("ì…ê³ ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤."),await te()}catch(a){N.error("ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},[d,te]),Ce=s.useCallback(async e=>{try{const a=(new Date).toISOString(),[s,r]=await Promise.all([d.from("purchase_requests").update({is_payment_completed:!0,payment_completed_at:a}).eq("id",e),d.from("purchase_request_items").update({is_payment_completed:!0,payment_completed_at:a}).eq("purchase_request_id",e)]);if(s.error)throw s.error;if(r.error)throw r.error;j(e)||(t.warn("[PurchaseListMain] ë©”ëª¨ë¦¬ ìºì‹œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨, ë°ì´í„° ì¬ë¡œë“œ",{purchaseId:e}),await te()),N.success("êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.")}catch(a){t.error("[PurchaseListMain] êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ ì‹¤íŒ¨:",a),N.error("ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},[d,te]);s.useCallback(e=>{u(e),h(!0)},[]);const qe=s.useMemo(()=>o?{...o,vendor_name:o.vendor_name||"",project_vendor:o.project_vendor||"",sales_order_number:o.sales_order_number||"",project_item:o.project_item||""}:null,[o]);return s.useCallback(e=>{g(!1),u(e),h(!0)},[]),l.jsxs("div",{className:"w-full",children:[l.jsx("div",{className:"mb-4",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"page-title",children:"ë°œì£¼ìš”ì²­ ê´€ë¦¬"}),l.jsx("p",{className:"page-subtitle",style:{marginTop:"-2px",marginBottom:"-4px"},children:"Purchase Management"})]}),he>0&&l.jsxs(i,{onClick:()=>g(!0),variant:"outline",className:"flex items-center gap-2 border-orange-300 bg-orange-50 text-orange-700 hover:bg-orange-100 hover:border-orange-400",children:[l.jsx(Se,{className:"w-4 h-4"}),l.jsx("span",{className:"text-xs font-medium",children:"ì…ê³  ì§€ì—°"}),l.jsxs(ve,{variant:"outline",className:"bg-orange-100 text-orange-700 border-orange-300 text-[10px] px-1.5 py-0",children:[he,"ê±´"]})]})]})}),l.jsx("div",{className:"mb-3",children:l.jsx(vt,{activeFilters:q,sortConfig:S,searchTerm:D,onFiltersChange:$,onSortChange:M,onSearchChange:P,availableEmployees:I,availableVendors:T,availableContacts:R,availablePaymentSchedules:L,children:l.jsx(Oe,{isVisible:!0,columnVisibility:W,applyColumnSettings:J,resetToDefault:H,isLoading:Y,currentUserRoles:K})})}),l.jsxs("div",{className:"space-y-3",children:[l.jsx("div",{className:"flex flex-col sm:flex-row sm:space-x-1 space-y-1 sm:space-y-0 bg-gray-50 p-1 business-radius-card border border-gray-200",children:St.map(e=>l.jsxs("button",{onClick:()=>{t.info("[íƒ­ í´ë¦­ ì´ë²¤íŠ¸]",{tab:e.key,currentActiveTab:ie,currentUser:B?.name,currentUserRoles:K,defaultEmployeeByTab:ne,isPending:ue});const a=new URLSearchParams(c.search);a.set("tab",e.key),r({search:a.toString()},{replace:!0});try{const a=ne[e.key];void 0===a?(t.error("[íƒ­ ì „í™˜ ì˜¤ë¥˜] defaultEmployeeByTabì—ì„œ ê°’ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ",{tabKey:e.key,defaultEmployeeByTab:ne,availableKeys:Object.keys(ne)}),ce(e.key),oe("all")):(ce(e.key),oe(a)),t.info("[íƒ­ ì „í™˜ ì„±ê³µ]",{newTab:e.key,newEmployee:a||"all",actualNewEmployee:a})}catch(s){t.error("[íƒ­ ì „í™˜ ì‹¤íŒ¨]",s)}},className:"flex-1 flex items-center justify-center space-x-2 py-1.5 px-3 sm:px-4 business-radius-button button-text font-medium transition-colors "+(ie===e.key?"text-hansl-600 bg-white shadow-sm border border-gray-200":"text-gray-600 bg-transparent hover:text-gray-900 hover:bg-white/50"),children:[l.jsx("span",{className:"whitespace-nowrap",children:e.label}),l.jsx("span",{className:"badge-stats "+(ie===e.key?"bg-hansl-50 text-hansl-700":"bg-gray-100 text-gray-600"),children:we(e.key)})]},e.key))}),Ne&&l.jsx("div",{className:"mb-3",children:"single"===Ne.type?l.jsxs("div",{className:"inline-flex items-center gap-2 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 business-radius-badge px-3 py-2 shadow-sm",children:[l.jsxs("div",{className:"flex items-center gap-1.5",children:[l.jsx("div",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full"}),l.jsxs("span",{className:"card-subtitle text-gray-700",children:[Ne.year,"ë…„ ",Ne.month,"ì›”"]}),l.jsxs("span",{className:"badge-text text-gray-500",children:[Ne.count,"ê±´"]})]}),l.jsx("div",{className:"h-4 w-px bg-blue-300"}),l.jsxs("span",{className:"modal-value text-blue-700 font-semibold",children:["â‚©",Ne.totalFilteredAmount?.toLocaleString()||"0"]})]}):l.jsxs(_e,{className:"business-radius-card border border-gray-200 shadow-sm",children:[l.jsx(ye,{className:"pb-3 pt-4 px-4",children:l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full"}),l.jsx(be,{className:"section-title text-gray-800",children:"ì›”ë³„ ë°œì£¼ìš”ì²­ ì´ì•¡"})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsxs("span",{className:"badge-text text-gray-600",children:["(",Ne.months?.reduce((e,t)=>e+t.count,0)||0,"ê±´)"]}),l.jsx("div",{className:"h-4 w-px bg-gray-300"}),l.jsxs("span",{className:"modal-value text-gray-500 font-bold",children:["â‚©",Ne.totalFilteredAmount?.toLocaleString()||"0"]})]})]})}),l.jsx(fe,{className:"px-4 pb-4",children:l.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:Ne.months?.map(e=>l.jsx("div",{className:"bg-gray-50 business-radius-card px-3 py-1.5 border border-gray-200 hover:border-blue-300 hover:bg-blue-50 transition-all flex-shrink-0",children:l.jsxs("div",{className:"flex items-baseline gap-1.5",children:[l.jsxs("span",{className:"modal-value font-bold text-gray-800 whitespace-nowrap",children:[e.month,"ì›”"]}),l.jsxs("span",{className:"text-[9px] text-gray-500 whitespace-nowrap",children:["(",e.count,")"]}),l.jsxs("span",{className:"modal-value text-gray-500 font-bold whitespace-nowrap ml-1",children:["â‚©",e.total.toLocaleString()]})]})},e.monthStr))})})]})}),l.jsx(_e,{className:"overflow-hidden border border-gray-200 w-full max-w-full",children:l.jsx(fe,{className:"p-0",children:V?l.jsxs("div",{className:"flex items-center justify-center py-12",children:[l.jsx("div",{className:"w-8 h-8 border-2 border-hansl-500 border-t-transparent rounded-full animate-spin"}),l.jsx("span",{className:"ml-3 card-subtitle",children:"ë¡œë”© ì¤‘..."})]}):0===xe.length?l.jsxs("div",{className:"text-center py-12",children:[l.jsx(m,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),l.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"ë°œì£¼ìš”ì²­ì„œê°€ ì—†ìŠµë‹ˆë‹¤"}),l.jsx("p",{className:"card-subtitle",children:"ìƒˆë¡œìš´ ë°œì£¼ìš”ì²­ì„œë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”."})]}):l.jsx(yt,{purchases:xe,activeTab:ie,currentUserRoles:K,onRefresh:te,onOptimisticUpdate:ae,onPaymentComplete:Ce,onReceiptComplete:ke,columnVisibility:W})})})]}),qe&&l.jsx(s.Suspense,{fallback:l.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:l.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"})}),children:l.jsx($t,{isOpen:p,onClose:()=>{h(!1),u(null)},purchase:qe,isAdmin:se||!1,onUpdate:te,activeTab:ie})}),l.jsx(Nt,{isOpen:x,onClose:()=>{g(!1),window.location.reload()},purchases:pe,currentUserName:Z})]})}export{Mt as default};
//# sourceMappingURL=PurchaseListMain-DSg46PSL.js.map
