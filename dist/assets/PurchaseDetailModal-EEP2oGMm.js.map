{"version":3,"file":"PurchaseDetailModal-EEP2oGMm.js","sources":["../../node_modules/lucide-react/dist/esm/icons/truck.js","../../src/components/purchase/PurchaseDetailModal.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2\", key: \"wrbu53\" }],\n  [\"path\", { d: \"M15 18H9\", key: \"1lyqi6\" }],\n  [\n    \"path\",\n    {\n      d: \"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14\",\n      key: \"lysw3i\"\n    }\n  ],\n  [\"circle\", { cx: \"17\", cy: \"18\", r: \"2\", key: \"332jqn\" }],\n  [\"circle\", { cx: \"7\", cy: \"18\", r: \"2\", key: \"19iecd\" }]\n];\nconst Truck = createLucideIcon(\"truck\", __iconNode);\n\nexport { __iconNode, Truck as default };\n//# sourceMappingURL=truck.js.map\n","import { useEffect, useState, useRef, useCallback, useMemo, memo } from 'react'\nimport { createClient } from '@/lib/supabase/client'\nimport { PurchaseRequestWithDetails, Purchase } from '@/types/purchase'\nimport { formatDate } from '@/utils/helpers'\nimport { DatePickerPopover } from '@/components/ui/date-picker-popover'\nimport { \n  Calendar, \n  User, \n  Building2, \n  Package, \n  CreditCard,\n  X,\n  FileText,\n  DollarSign,\n  Edit2,\n  Trash2,\n  Save,\n  Plus,\n  CheckCircle,\n  XCircle,\n  Check,\n  Truck\n} from 'lucide-react'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport { Input } from '@/components/ui/input'\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog'\nimport { toast } from 'sonner'\nimport { logger } from '@/lib/logger'\nimport { useConfirmDateAction } from '@/hooks/useConfirmDateAction'\nimport { format as formatDateInput } from 'date-fns'\n\ninterface PurchaseDetailModalProps {\n  purchaseId: number | null\n  isOpen: boolean\n  onClose: () => void\n  embedded?: boolean  // Dialog 없이 내용만 렌더링\n  currentUserRoles?: string[]\n  activeTab?: string\n  onRefresh?: (forceRefresh?: boolean, options?: { silent?: boolean }) => void | Promise<void>\n  onOptimisticUpdate?: (purchaseId: number, updater: (prev: Purchase) => Purchase) => void\n  onDelete?: (purchase: PurchaseRequestWithDetails) => void\n}\n\nfunction PurchaseDetailModal({ \n  purchaseId, \n  isOpen, \n  onClose, \n  embedded = false,\n  currentUserRoles = [],\n  activeTab,\n  onRefresh,\n  onOptimisticUpdate,\n  onDelete\n}: PurchaseDetailModalProps) {\n  const [loading, setLoading] = useState(false)\n  const [purchase, setPurchase] = useState<PurchaseRequestWithDetails | null>(null)\n  const [isEditing, setIsEditing] = useState(false)\n  const [editedPurchase, setEditedPurchase] = useState<PurchaseRequestWithDetails | null>(null)\n  const [editedItems, setEditedItems] = useState<any[]>([])\n  const [deletedItemIds, setDeletedItemIds] = useState<number[]>([])\n  const [userRoles, setUserRoles] = useState<string[]>([])\n  const [currentUserName, setCurrentUserName] = useState<string>('')\n  const [columnWidths, setColumnWidths] = useState<number[]>([])\n  const tableMinWidth = useMemo(() => {\n    if (columnWidths.length > 0) {\n      const columnGap = columnWidths.length > 1 ? (columnWidths.length - 1) * 12 : 0\n      const padding = 48\n      const total = columnWidths.reduce((sum, width) => sum + width, 0) + columnGap + padding\n      return Math.max(total, 720)\n    }\n\n    const baseColumns: number[] = [120, 140, 80, 110, 130, 110, 120]\n\n    if (activeTab === 'purchase') {\n      baseColumns.push(120)\n    }\n\n    if (activeTab === 'receipt' || activeTab === 'done') {\n      baseColumns.push(120)\n    }\n\n    if (activeTab === 'receipt') {\n      baseColumns.push(140)\n    }\n\n    if (activeTab === 'done') {\n      baseColumns.push(140, 140, 110)\n    }\n\n    if (isEditing) {\n      baseColumns.push(110)\n    }\n\n    const columnGap = baseColumns.length > 1 ? (baseColumns.length - 1) * 12 : 0\n    const total = baseColumns.reduce((sum, width) => sum + width, 0) + columnGap + 48\n    return Math.max(total, 720)\n  }, [columnWidths, activeTab, isEditing])\n  const headerRowRef = useRef<HTMLDivElement>(null)\n  const supabase = createClient()\n  \n  // 사용자 권한 및 이름 직접 로드\n  useEffect(() => {\n    const loadUserRoles = async () => {\n      try {\n        // Supabase 환경 변수 확인\n        const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\n        const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;\n        \n        if (!supabaseUrl || !supabaseAnonKey || supabaseUrl.includes('placeholder')) {\n          logger.warn('Supabase 환경 변수가 설정되지 않음 - PurchaseDetailModal');\n          return;\n        }\n\n        const { data: { user } } = await supabase.auth.getUser()\n        if (user) {\n          // 먼저 ID로 시도\n          let { data: employeeData } = await supabase\n            .from('employees')\n            .select('*')\n            .eq('id', user.id)\n            .maybeSingle()\n          \n          // ID로 못 찾았으면 이메일로 시도\n          if (!employeeData && user.email) {\n            const { data: employeeByEmail } = await supabase\n              .from('employees')\n              .select('*')\n              .eq('email', user.email)\n              .maybeSingle()\n            \n            employeeData = employeeByEmail\n          }\n          \n          // 사용자 이름 저장\n          if (employeeData?.name) {\n            setCurrentUserName(employeeData.name)\n          }\n          \n          if (employeeData?.purchase_role) {\n            let roles: string[] = []\n            if (Array.isArray(employeeData.purchase_role)) {\n              roles = employeeData.purchase_role.map((r: any) => String(r).trim())\n            } else {\n              const roleString = String(employeeData.purchase_role)\n              roles = roleString\n                .split(',')\n                .map((r: string) => r.trim())\n                .filter((r: string) => r.length > 0)\n            }\n            setUserRoles(roles)\n          }\n        }\n      } catch (error) {\n      }\n    }\n    \n    if (isOpen) {\n      loadUserRoles()\n    }\n  }, [isOpen])\n  \n  // currentUserRoles가 배열이 아니면 userRoles 사용\n  const effectiveRoles = Array.isArray(currentUserRoles) && currentUserRoles.length > 0 \n    ? currentUserRoles \n    : userRoles\n  \n  // 권한 체크\n  const canEdit = effectiveRoles.includes('final_approver') || \n                  effectiveRoles.includes('app_admin') || \n                  effectiveRoles.includes('ceo')\n  \n  // 삭제 권한: 관리자 또는 요청자 본인 (단, 승인된 요청은 관리자만)\n  const isApproved = purchase?.final_manager_status === 'approved';\n  const canDelete = isApproved \n    ? canEdit  // 승인된 요청은 관리자만 삭제 가능\n    : (canEdit || (purchase?.requester_name === currentUserName))  // 미승인 요청은 요청자도 삭제 가능\n  \n  // 구매 권한 체크: app_admin + lead buyer만 (요청자 본인 제외)\n  const canPurchase = effectiveRoles.includes('app_admin') || \n                     effectiveRoles.includes('lead buyer') || \n                     effectiveRoles.includes('lead buyer')\n  \n  // 입고 권한 체크 \n  // 1. 관리자는 모든 건 입고 처리 가능\n  // 2. 요청자는 자신의 요청건만 입고 처리 가능\n  const canReceiveItems = effectiveRoles.includes('app_admin') || \n                         (purchase?.requester_name === currentUserName)\n  // 2. 일반 직원은 본인이 요청한 건만 입고 처리 가능\n  const isAdmin = effectiveRoles.includes('final_approver') || \n                  effectiveRoles.includes('app_admin') || \n                  effectiveRoles.includes('ceo')\n  const isRequester = purchase?.requester_name === currentUserName\n  \n  // 거래명세서 확인 & UTK 확인 권한: app_admin과 lead buyer만 가능\n  const canReceiptCheck = effectiveRoles.includes('app_admin') || \n                         effectiveRoles.includes('lead buyer')\n  \n\n  // 모달 내부 데이터만 새로고침하는 함수 (모달 닫지 않음)\n  const refreshModalData = useCallback(async () => {\n    if (!purchaseId) return\n    \n    try {\n      const supabase = createClient()\n      // 최신 구매 요청 데이터 로드\n      const { data, error } = await supabase\n        .from('purchase_requests')\n        .select(`\n          *,\n          vendors(id, vendor_name),\n          purchase_request_items(*)\n        `)\n        .eq('id', purchaseId)\n        .single()\n      \n      if (error) throw error\n\n      if (data) {\n        // 라인넘버 순서대로 정렬\n        const sortedItems = (data.purchase_request_items || []).sort((a: any, b: any) => {\n          const lineA = a.line_number || 999999;\n          const lineB = b.line_number || 999999;\n          return lineA - lineB;\n        });\n\n        const purchaseData = {\n          ...data,\n          items: sortedItems,\n          vendor: data.vendors || { id: 0, vendor_name: '알 수 없음' },\n          vendor_contacts: []\n        } as PurchaseRequestWithDetails\n\n        setPurchase(purchaseData)\n        setEditedPurchase(purchaseData)\n        setEditedItems(sortedItems)\n        \n        logger.debug('모달 데이터 새로고침 완료 - 모달 상태 유지')\n      }\n    } catch (error) {\n      logger.error('모달 데이터 새로고침 실패', error)\n    }\n  }, [purchaseId])\n  \n  // 컴포넌트가 마운트될 때 외부 새로고침을 방지하는 플래그\n  const [isInitialLoad, setIsInitialLoad] = useState(true)\n  \n  // 커스텀 훅 설정\n  const purchaseIdNumber = purchaseId ? Number(purchaseId) : (purchase ? Number(purchase.id) : NaN)\n\n  const handleActualReceiptOptimisticUpdate = useCallback(({ itemId, selectedDate, action }: {\n    itemId: number\n    selectedDate?: Date\n    action: 'confirm' | 'cancel'\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n    }\n  }) => {\n    const itemIdStr = String(itemId)\n    const nowIso = new Date().toISOString()\n    const selectedDateIso = selectedDate ? selectedDate.toISOString() : undefined\n\n    const updateItems = (items?: any[]) => {\n      if (!items) return items\n      return items.map(item => {\n        if (String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_received: true,\n            actual_received_date: selectedDateIso,\n            received_at: nowIso\n          }\n        }\n\n        return {\n          ...item,\n          is_received: false,\n          actual_received_date: undefined,\n          received_at: undefined\n        }\n      })\n    }\n\n    setPurchase(prev => {\n      if (!prev) return prev\n      const updatedItems = updateItems(prev.items) || []\n      const total = updatedItems.length\n      const completed = updatedItems.filter(item => item.is_received).length\n      const allReceived = total > 0 && completed === total\n\n      return {\n        ...prev,\n        items: updatedItems,\n        is_received: allReceived,\n        received_at: allReceived ? (prev.received_at || nowIso) : undefined\n      }\n    })\n\n    setEditedPurchase(prev => {\n      if (!prev) return prev\n      const updatedItems = updateItems(prev.items) || []\n      return {\n        ...prev,\n        items: updatedItems\n      }\n    })\n\n    setEditedItems(prevItems => {\n      if (!prevItems || prevItems.length === 0) return prevItems\n      return prevItems.map(item => {\n        if (!item.id || String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_received: true,\n            actual_received_date: selectedDateIso,\n            received_at: nowIso\n          }\n        }\n\n        return {\n          ...item,\n          is_received: false,\n          actual_received_date: undefined,\n          received_at: undefined\n        }\n      })\n    })\n\n    if (!Number.isNaN(purchaseIdNumber)) {\n      onOptimisticUpdate?.(purchaseIdNumber, prevPurchase => {\n        const updatedItems = updateItems(prevPurchase.items) || prevPurchase.items || []\n        const total = updatedItems.length || prevPurchase.items?.length || 0\n        const completed = updatedItems.filter(item => item.is_received).length\n        const allReceived = total > 0 && completed === total\n\n        return {\n          ...prevPurchase,\n          items: updatedItems,\n          is_received: allReceived,\n          received_at: allReceived ? (prevPurchase.received_at || nowIso) : undefined\n        }\n      })\n    }\n  }, [onOptimisticUpdate, purchaseIdNumber])\n\n  const handleStatementReceivedOptimisticUpdate = useCallback(({ itemId, selectedDate, action }: {\n    itemId: number\n    selectedDate?: Date\n    action: 'confirm' | 'cancel'\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n    }\n  }) => {\n    const itemIdStr = String(itemId)\n    const selectedDateIso = selectedDate ? selectedDate.toISOString() : undefined\n\n    let nextAllCompleted = false\n    let nextStatementAt: string | null = null\n\n    setPurchase(prev => {\n      if (!prev) return prev\n\n      const updatedItems = (prev.items || []).map(item => {\n        if (String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_statement_received: true,\n            statement_received_date: selectedDateIso,\n            statement_received_by_name: currentUserName\n          }\n        }\n\n        return {\n          ...item,\n          is_statement_received: false,\n          statement_received_date: null,\n          statement_received_by_name: null\n        }\n      })\n\n      nextAllCompleted = updatedItems.length > 0 && updatedItems.every(item => item.is_statement_received)\n      nextStatementAt = nextAllCompleted\n        ? (selectedDateIso || prev.statement_received_at || new Date().toISOString())\n        : null\n\n      return {\n        ...prev,\n        items: updatedItems,\n        is_statement_received: nextAllCompleted,\n        statement_received_at: nextStatementAt\n      }\n    })\n\n    setEditedPurchase(prev => {\n      if (!prev) return prev\n\n      const updatedItems = (prev.items || []).map(item => {\n        if (String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_statement_received: true,\n            statement_received_date: selectedDateIso,\n            statement_received_by_name: currentUserName\n          }\n        }\n\n        return {\n          ...item,\n          is_statement_received: false,\n          statement_received_date: null,\n          statement_received_by_name: null\n        }\n      })\n\n      return {\n        ...prev,\n        items: updatedItems,\n        is_statement_received: nextAllCompleted,\n        statement_received_at: nextStatementAt\n      }\n    })\n\n    setEditedItems(prevItems => {\n      if (!prevItems) return prevItems\n      return prevItems.map(item => {\n        if (String(item.id) !== itemIdStr) return item\n\n        if (action === 'confirm') {\n          return {\n            ...item,\n            is_statement_received: true,\n            statement_received_date: selectedDateIso,\n            statement_received_by_name: currentUserName\n          }\n        }\n\n        return {\n          ...item,\n          is_statement_received: false,\n          statement_received_date: null,\n          statement_received_by_name: null\n        }\n      })\n    })\n\n    if (!Number.isNaN(purchaseIdNumber)) {\n      onOptimisticUpdate?.(purchaseIdNumber, prevPurchase => {\n        const updatedItems = (prevPurchase.items || []).map(item => {\n          if (String(item.id) !== itemIdStr) return item\n\n          if (action === 'confirm') {\n            return {\n              ...item,\n              is_statement_received: true,\n              statement_received_date: selectedDateIso,\n              statement_received_by_name: currentUserName\n            }\n          }\n\n          return {\n            ...item,\n            is_statement_received: false,\n            statement_received_date: null,\n            statement_received_by_name: null\n          }\n        })\n\n        const allCompleted = updatedItems.length > 0 && updatedItems.every(item => item.is_statement_received)\n\n        return {\n          ...prevPurchase,\n          items: updatedItems,\n          is_statement_received: allCompleted\n        }\n      })\n    }\n\n    // purchase_requests 레벨 플래그도 업데이트\n    if (purchase && nextAllCompleted !== undefined) {\n      const supabase = createClient()\n      supabase\n        .from('purchase_requests')\n        .update({\n          is_statement_received: nextAllCompleted,\n          statement_received_at: nextStatementAt\n        })\n        .eq('id', purchase.id)\n        .then(({ error }: { error: any }) => {\n          if (error) {\n            logger.error('거래명세서 확인 purchase_requests 업데이트 실패', error)\n          }\n        })\n    }\n  }, [currentUserName, onOptimisticUpdate, purchaseIdNumber, purchase])\n\n  const statementReceivedAction = useConfirmDateAction({\n    config: {\n      field: 'statement_received',\n      confirmMessage: {\n        confirm: '거래명세서 확인을 처리하시겠습니까?',\n        cancel: '거래명세서 확인을 취소하시겠습니까?'\n      },\n      successMessage: {\n        confirm: '거래명세서 확인이 완료되었습니다.',\n        cancel: '거래명세서 확인이 취소되었습니다.'\n      },\n      completedText: '✓ 완료',\n      waitingText: '대기'\n    },\n    currentUserName,\n    canPerformAction: canReceiptCheck,\n    onUpdate: refreshModalData,\n    onOptimisticUpdate: handleStatementReceivedOptimisticUpdate\n  })\n\n  const actualReceivedAction = useConfirmDateAction({\n    config: {\n      field: 'actual_received',\n      confirmMessage: {\n        confirm: '실제 입고 처리를 진행하시겠습니까?',\n        cancel: '실제 입고 처리를 취소하시겠습니까?'\n      },\n      successMessage: {\n        confirm: '실제 입고 처리가 완료되었습니다.',\n        cancel: '실제 입고 처리가 취소되었습니다.'\n      },\n      completedText: '입고완료',\n      waitingText: '입고대기'\n    },\n    currentUserName,\n    canPerformAction: canReceiptCheck,\n    onUpdate: refreshModalData,\n    onOptimisticUpdate: handleActualReceiptOptimisticUpdate\n  })\n  \n  // 날짜 선택 핸들러들\n  \n  // 디버깅용 로그\n  logger.debug('Receipt Check', {\n    activeTab,\n    canReceiptCheck,\n    isAdmin,\n    isRequester,\n    currentUserName,\n    requesterName: purchase?.requester_name,\n    effectiveRoles\n  });\n  \n  // 승인 권한 체크\n const canApproveMiddle = effectiveRoles.includes('middle_manager') || \n                          effectiveRoles.includes('app_admin') || \n                          effectiveRoles.includes('ceo')\n \n const canApproveFinal = effectiveRoles.includes('final_approver') || \n                         effectiveRoles.includes('app_admin') || \n                         effectiveRoles.includes('ceo')\n \n const approvalPillClass = 'inline-flex items-center gap-1 business-radius-badge px-2 py-0.5 badge-text leading-tight'\n const approvalButtonClass = 'inline-flex items-center gap-1 business-radius-badge !h-auto !min-h-0 !px-2.5 !py-0.5 badge-text leading-tight'\n const approvalWaitingPillClass = 'inline-flex items-center gap-1 business-radius-badge px-2.5 py-0.5 badge-text leading-tight'\n \n   // 디버깅 로그\n   logger.debug('PurchaseDetailModal 권한 체크', {\n     currentUserRoles,\n     userRoles,\n     effectiveRoles,\n     canApproveMiddle,\n     canApproveFinal,\n     isEditing,\n     middleManagerStatus: purchase?.middle_manager_status,\n     finalManagerStatus: purchase?.final_manager_status\n   });\n \n  useEffect(() => {\n    if (purchaseId && isOpen) {\n      loadPurchaseDetail(purchaseId.toString())\n      setIsEditing(false) // 모달 열 때마다 편집 모드 초기화\n    }\n  }, [purchaseId, isOpen])\n\n  // 칼럼 너비 계산 (텍스트 길이 기반)\n  const calculateOptimalColumnWidths = useCallback(() => {\n    if (!purchase?.items || purchase.items.length === 0) return []\n\n    const items = purchase.items ?? []\n\n    const columnConfigs = [\n      { key: 'item_name', minWidth: 80, maxWidth: 500, baseWidth: 80 },\n      { key: 'specification', minWidth: 120, maxWidth: 700, baseWidth: 120 },\n      { key: 'quantity', minWidth: 70, maxWidth: 100, baseWidth: 70 },\n      { key: 'unit_price', minWidth: 90, maxWidth: 150, baseWidth: 90 },\n      { key: 'total_price', minWidth: 100, maxWidth: 180, baseWidth: 100 },\n      { key: 'remarks', minWidth: 80, maxWidth: 240, baseWidth: 80 },\n      { key: 'status', minWidth: 80, maxWidth: 120, baseWidth: 80 }\n    ]\n\n    // 추가 칼럼들 (탭별)\n    if (activeTab === 'receipt') {\n      columnConfigs.push({ key: 'actual_receipt_date', minWidth: 100, maxWidth: 160, baseWidth: 100 })\n    }\n    if (activeTab === 'done') {\n      columnConfigs.push(\n        { key: 'transaction_confirm', minWidth: 100, maxWidth: 160, baseWidth: 100 },\n        { key: 'accounting_date', minWidth: 100, maxWidth: 160, baseWidth: 100 },\n        { key: 'processor', minWidth: 80, maxWidth: 120, baseWidth: 80 },\n        { key: 'utk_confirm', minWidth: 80, maxWidth: 120, baseWidth: 80 }\n      )\n    }\n\n    const calculatedWidths = columnConfigs.map((config, index) => {\n      let maxLength = 4 // 최소 4자\n\n      // 헤더 텍스트 길이 고려 (탭별)\n      const getHeaders = () => {\n        const statusHeader = activeTab === 'purchase'\n          ? '구매상태'\n          : (activeTab === 'receipt' || activeTab === 'done')\n          ? '입고상태'\n          : '상태'\n\n        const baseHeaders = ['품목명', '규격', '수량', '단가', '합계', '비고', statusHeader]\n        if (activeTab === 'receipt') {\n          return [...baseHeaders, '실제입고일']\n        } else if (activeTab === 'done') {\n          return [...baseHeaders, '거래명세서 확인', '회계상 입고일', '처리자', 'UTK']\n        }\n        return baseHeaders\n      }\n      \n      const headers = getHeaders()\n      if (headers[index]) {\n        maxLength = Math.max(maxLength, headers[index].length)\n      }\n\n      // 실제 데이터에서 최대 길이 찾기\n      items.forEach(item => {\n        let cellValue = ''\n        switch (config.key) {\n          case 'item_name':\n            cellValue = item.item_name || ''\n            break\n          case 'specification':\n            cellValue = item.specification || ''\n            break\n          case 'quantity':\n            cellValue = item.quantity?.toString() || ''\n            break\n          case 'unit_price':\n            cellValue = item.unit_price_value != null ? item.unit_price_value.toLocaleString() : ''\n            break\n          case 'total_price':\n            if (item.amount_value != null) {\n              cellValue = item.amount_value.toLocaleString()\n            } else if (item.quantity != null && item.unit_price_value != null) {\n              cellValue = (Number(item.quantity) * Number(item.unit_price_value)).toLocaleString()\n            } else {\n              cellValue = ''\n            }\n            break\n          case 'remarks':\n            cellValue = item.remark || ''\n            break\n          case 'status':\n            cellValue = getStatusDisplay(item) || ''\n            break\n          case 'actual_receipt_date':\n            cellValue = item.actual_received_date ? formatDate(item.actual_received_date) : ''\n            break\n          case 'transaction_confirm':\n            cellValue = item.is_statement_received ? '확인완료' : '미확인'\n            break\n          case 'accounting_date':\n            cellValue = item.statement_received_date ? formatDate(item.statement_received_date) : ''\n            break\n          case 'processor':\n            cellValue = item.statement_received_by_name || ''\n            break\n          case 'utk_confirm':\n            cellValue = item.is_utk_checked ? '완료' : '대기'\n            break\n        }\n        \n        // 한글/영문 혼합 텍스트 길이 계산 (한글은 1.5배 가중치)\n        const adjustedLength = cellValue.split('').reduce((acc, char) => {\n          return acc + (/[가-힣]/.test(char) ? 1.5 : 1)\n        }, 0)\n        \n        maxLength = Math.max(maxLength, Math.ceil(adjustedLength))\n      })\n\n      // 길이를 픽셀로 변환 (글자당 약 7px + 여백 20px)\n      const calculatedWidth = Math.max(\n        config.minWidth,\n        Math.min(config.maxWidth, maxLength * 7 + 20)\n      )\n\n      logger.debug(`Column ${config.key} calculated:`, { \n        maxLength, \n        calculatedWidth, \n        range: `${config.minWidth}-${config.maxWidth}px` \n      })\n\n      return calculatedWidth\n    })\n\n    setColumnWidths(calculatedWidths)\n    logger.debug('Optimal column widths calculated', { calculatedWidths })\n    return calculatedWidths\n  }, [purchase, activeTab])\n\n  // 상태 표시 텍스트 반환 함수\n  const getStatusDisplay = (item: any) => {\n    if (activeTab === 'purchase') {\n      return item.is_payment_completed ? '구매완료' : '구매요청'\n    } else if (activeTab === 'receipt') {\n      return item.is_received ? '입고' : '입고대기'\n    }\n    return item.is_payment_completed ? '구매완료' : '구매요청'\n  }\n\n  // 동적 gridTemplateColumns 생성\n  const getGridTemplateColumns = () => {\n    if (columnWidths.length > 0) {\n      return columnWidths.map(width => `${width}px`).join(' ')\n    }\n    \n    // 기본값 (데이터 로드 전)\n    const baseColumns = ['80px', '120px', '70px', '90px', '100px', '80px', '80px']\n    \n    // 탭별 추가 칼럼\n    if (activeTab === 'receipt') {\n      return [...baseColumns, '100px'].join(' ')\n    } else if (activeTab === 'done') {\n      return [...baseColumns, '100px', '100px', '80px', '80px'].join(' ')\n    }\n    \n    return baseColumns.join(' ')\n  }\n\n  // 레거시 measureColumnWidths 함수 (호환성 유지)\n  const measureColumnWidths = () => {\n    calculateOptimalColumnWidths()\n  }\n\n  // View 모드에서 칼럼 너비 계산 (데이터 로드 후)\n  useEffect(() => {\n    if (purchase && purchase.items && purchase.items.length > 0 && !isEditing) {\n      // 즉시 계산 (DOM 측정 불필요)\n      calculateOptimalColumnWidths()\n    }\n  }, [purchase, isEditing, activeTab, calculateOptimalColumnWidths])\n\n  // Edit 모드 전환 시 너비 계산\n  const handleEditToggle = (editing: boolean) => {\n    if (editing && !isEditing) {\n      // Edit 모드로 전환하기 전에 현재 너비 계산\n      calculateOptimalColumnWidths()\n    }\n    setIsEditing(editing)\n  }\n\n  const loadPurchaseDetail = async (id: string) => {\n    try {\n      setLoading(true)\n      const supabase = createClient()\n      \n      const { data, error } = await supabase\n        .from('purchase_requests')\n        .select(`\n          *,\n          vendors(id, vendor_name),\n          purchase_request_items(*)\n        `)\n        .eq('id', id)\n        .single()\n\n      if (error) throw error\n\n      if (data) {\n        // 라인넘버 순서대로 정렬\n        const sortedItems = (data.purchase_request_items || []).sort((a: any, b: any) => {\n          const lineA = a.line_number || 999999;\n          const lineB = b.line_number || 999999;\n          return lineA - lineB;\n        });\n\n        const purchaseData = {\n          ...data,\n          items: sortedItems,\n          vendor: data.vendors || { id: 0, vendor_name: '알 수 없음' },\n          vendor_contacts: []\n        } as PurchaseRequestWithDetails\n        setPurchase(purchaseData)\n        setEditedPurchase(purchaseData)\n        setEditedItems(sortedItems)\n      }\n    } catch (error) {\n      toast.error('발주 상세 정보를 불러오는데 실패했습니다.')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const getStatusBadge = () => {\n    if (!purchase) return null\n    \n    // payment_category 우선 확인\n    if (purchase.payment_category) {\n      const category = purchase.payment_category.trim()\n      \n      if (category === '발주') {\n        return <Badge variant={null} className=\"badge-success\">발주</Badge>\n      } else if (category === '구매요청') {\n        return <Badge variant={null} className=\"badge-primary\">구매요청</Badge>\n      } else if (category === '현장결제') {\n        return <Badge variant={null} className=\"badge-secondary\">현장결제</Badge>\n      } else {\n        // payment_category 값이 있지만 알려진 값이 아닌 경우\n        return <Badge variant={null} className=\"badge-primary\">{category}</Badge>\n      }\n    }\n    \n    // payment_category가 없으면 기본값\n    return <Badge variant={null} className=\"badge-primary\">구매요청</Badge>\n  }\n\n  // formatDate는 utils/helpers.ts에서 import\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat('ko-KR').format(amount)\n  }\n\n  const handleSave = async () => {\n    if (!purchase || !editedPurchase) {\n      toast.error('저장할 데이터가 없습니다.')\n      return\n    }\n    \n    try {\n      logger.debug('저장 시작', { \n        purchaseId: purchase.id, \n        editedItemsCount: editedItems.length,\n        deletedItemsCount: deletedItemIds.length \n      });\n      \n      // 발주 기본 정보 업데이트\n      const totalAmount = editedItems.reduce((sum, item) => sum + (item.amount_value || 0), 0)\n      logger.debug('계산된 총액', { totalAmount });\n      \n      const { error: updateError } = await supabase\n        .from('purchase_requests')\n        .update({\n          purchase_order_number: editedPurchase.purchase_order_number || null,\n          requester_name: editedPurchase.requester_name || null,\n          delivery_request_date: editedPurchase.delivery_request_date || null,\n          revised_delivery_request_date: editedPurchase.revised_delivery_request_date || null,\n          payment_category: editedPurchase.payment_category || null,\n          project_vendor: editedPurchase.project_vendor || null,\n          total_amount: Number(totalAmount),\n          updated_at: new Date().toISOString()\n        })\n        .eq('id', purchase.id)\n\n      if (updateError) throw updateError\n\n      // 삭제된 항목들 처리\n      if (deletedItemIds.length > 0) {\n        const { error: deleteError } = await supabase\n          .from('purchase_request_items')\n          .delete()\n          .in('id', deletedItemIds)\n\n        if (deleteError) throw deleteError\n      }\n\n      // 각 아이템 업데이트 또는 생성\n      logger.debug('저장할 editedItems', { count: editedItems.length });\n      \n      for (const item of editedItems) {\n        logger.debug('처리 중인 item', { \n          itemId: item.id, \n          itemName: item.item_name,\n          quantity: item.quantity,\n          unitPrice: item.unit_price_value,\n          amount: item.amount_value\n        });\n        \n        // 필수 필드 검증\n        if (!item.item_name || !item.item_name.trim()) {\n          throw new Error('품목명은 필수입니다.');\n        }\n        if (!item.quantity || item.quantity <= 0) {\n          throw new Error('수량은 0보다 커야 합니다.');\n        }\n        if (item.unit_price_value !== null && item.unit_price_value !== undefined && item.unit_price_value < 0) {\n          throw new Error('단가는 0 이상이어야 합니다.');\n        }\n        if (item.amount_value !== null && item.amount_value !== undefined && item.amount_value < 0) {\n          throw new Error('합계는 0 이상이어야 합니다.');\n        }\n        \n        if (item.id) {\n          // 기존 항목 업데이트\n          logger.debug('기존 항목 업데이트', { itemId: item.id });\n          const { error } = await supabase\n            .from('purchase_request_items')\n            .update({\n              item_name: item.item_name.trim(),\n              specification: item.specification || null,\n              quantity: Number(item.quantity),\n              unit_price_value: Number(item.unit_price_value),\n              unit_price_currency: purchase.currency || 'KRW',\n              amount_value: Number(item.amount_value),\n              amount_currency: purchase.currency || 'KRW',\n              remark: item.remark || null,\n              updated_at: new Date().toISOString()\n            })\n            .eq('id', item.id)\n\n          if (error) {\n            logger.error('기존 항목 업데이트 오류', error);\n            throw error;\n          }\n        } else {\n          // 새 항목 생성\n          logger.debug('새 항목 생성', { itemName: item.item_name });\n          const insertData = {\n            purchase_request_id: purchase.id,\n            item_name: item.item_name.trim(),\n            specification: item.specification || null,\n            quantity: Number(item.quantity),\n            unit_price_value: Number(item.unit_price_value),\n            unit_price_currency: purchase.currency || 'KRW',\n            amount_value: Number(item.amount_value),\n            amount_currency: purchase.currency || 'KRW',\n            remark: item.remark || null,\n            line_number: item.line_number || editedItems.indexOf(item) + 1,\n            created_at: new Date().toISOString()\n          };\n          logger.debug('삽입할 데이터', { itemName: insertData.item_name });\n          \n          const { error } = await supabase\n            .from('purchase_request_items')\n            .insert(insertData)\n\n          if (error) {\n            logger.error('새 항목 생성 오류', error);\n            throw error;\n          } else {\n            logger.debug('새 항목 생성 성공');\n          }\n        }\n      }\n\n      logger.debug('저장 완료');\n      toast.success('발주 내역이 성공적으로 저장되었습니다.')\n      handleEditToggle(false)\n      setDeletedItemIds([])\n      \n      // 수정된 데이터 다시 로드 (모달은 열린 상태 유지)\n      await loadPurchaseDetail(purchaseId?.toString() || '')\n\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      logger.error('저장 중 전체 오류', error);\n      const errorMessage = error instanceof Error ? error.message : '알 수 없는 오류가 발생했습니다'\n      toast.error(`저장 실패: ${errorMessage}`)\n    }\n  }\n\n  const handleItemChange = (index: number, field: string, value: any) => {\n    const newItems = [...editedItems]\n    \n    if (field === 'amount_value') {\n      // 금액을 직접 수정한 경우\n      newItems[index] = {\n        ...newItems[index],\n        amount_value: value\n      }\n    } else if (field === 'quantity' || field === 'unit_price_value') {\n      // 수량이나 단가를 수정한 경우 금액 자동 계산\n      const quantity = field === 'quantity' ? value : newItems[index].quantity\n      const unitPrice = field === 'unit_price_value' ? value : newItems[index].unit_price_value\n      newItems[index] = {\n        ...newItems[index],\n        [field]: value,\n        amount_value: quantity * unitPrice\n      }\n    } else {\n      // 기타 필드 수정\n      newItems[index] = {\n        ...newItems[index],\n        [field]: value\n      }\n    }\n    \n    setEditedItems(newItems)\n  }\n\n  const handleAddItem = () => {\n    // 현재 최대 라인넘버 찾기\n    const maxLineNumber = editedItems.reduce((max, item) => {\n      const lineNum = item.line_number || 0;\n      return lineNum > max ? lineNum : max;\n    }, 0);\n\n    const newItem = {\n      item_name: '',\n      specification: '',\n      quantity: 1,\n      unit_price_value: 0,\n      amount_value: 0,\n      remark: '',\n      line_number: maxLineNumber + 1\n    }\n    \n    // 새 아이템 추가 후 라인넘버 순서대로 정렬\n    const newItems = [...editedItems, newItem].sort((a, b) => {\n      const lineA = a.line_number || 999999;\n      const lineB = b.line_number || 999999;\n      return lineA - lineB;\n    });\n    \n    setEditedItems(newItems)\n  }\n\n  const handleRemoveItem = (index: number) => {\n    const item = editedItems[index]\n    if (item.id) {\n      setDeletedItemIds([...deletedItemIds, item.id])\n    }\n    const newItems = editedItems.filter((_, i) => i !== index).sort((a, b) => {\n      const lineA = a.line_number || 999999;\n      const lineB = b.line_number || 999999;\n      return lineA - lineB;\n    });\n    setEditedItems(newItems)\n  }\n\n  // 구매완료 처리 함수\n  const handlePaymentToggle = async (itemId: number | string, isCompleted: boolean) => {\n    if (!canPurchase) {\n      toast.error('구매완료 처리 권한이 없습니다.')\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      toast.error('유효하지 않은 항목 ID 입니다.')\n      return\n    }\n\n    // 해당 품목 정보 찾기\n    const targetItem = purchase?.items?.find(item => String(item.id) === itemIdStr)\n    if (!targetItem) return\n\n    const itemInfo = `품명: ${targetItem.item_name}\n규격: ${targetItem.specification || '미입력'}\n수량: ${targetItem.quantity?.toLocaleString() || 0}${targetItem.unit || ''}\n단가: ₩${targetItem.unit_price_value?.toLocaleString() || 0}\n합계: ₩${targetItem.amount_value?.toLocaleString() || 0}`\n\n    const confirmMessage = isCompleted \n      ? `다음 품목을 구매완료 처리하시겠습니까?\\n\\n${itemInfo}` \n      : `다음 품목의 구매완료를 취소하시겠습니까?\\n\\n${itemInfo}`\n    \n    const confirm = window.confirm(confirmMessage)\n    if (!confirm) return\n\n    try {\n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_payment_completed: isCompleted,\n          payment_completed_at: isCompleted ? new Date().toISOString() : null\n        })\n        .eq('id', numericId)\n\n      if (error) throw error\n\n      // 로컬 상태 즉시 업데이트 (UI 즉시 반영)\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          String(item.id) === itemIdStr \n            ? { ...item, is_payment_completed: isCompleted, payment_completed_at: isCompleted ? new Date().toISOString() : null }\n            : item\n        )\n        return { ...prev, items: updatedItems }\n      })\n\n      if (purchase) {\n        const purchaseIdNumber = Number(purchase.id)\n        if (!Number.isNaN(purchaseIdNumber)) {\n          onOptimisticUpdate?.(purchaseIdNumber, prev => {\n            const updatedItems = (prev.items || []).map(item =>\n              String(item.id) === itemIdStr\n                ? { ...item, is_payment_completed: isCompleted }\n                : item\n            )\n            const total = updatedItems.length || prev.items?.length || 0\n            const completed = updatedItems.filter(item => item.is_payment_completed).length\n            const allCompleted = total > 0 && completed === total\n            return {\n              ...prev,\n              items: updatedItems,\n              is_payment_completed: allCompleted,\n              payment_completed_at: allCompleted ? new Date().toISOString() : null,\n              payment_completed_by_name: allCompleted ? (currentUserName || prev.payment_completed_by_name) : prev.payment_completed_by_name\n            }\n          })\n        }\n      }\n      \n      toast.success(isCompleted ? '구매완료 처리되었습니다.' : '구매완료가 취소되었습니다.')\n\n      // 상세 모달 및 상위 리스트 모두 최신 상태로 동기화\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      toast.error('구매완료 처리 중 오류가 발생했습니다.')\n    }\n  }\n\n  // 개별 품목 입고완료 처리 (날짜 선택)\n  const handleItemReceiptToggle = async (itemId: number | string, selectedDate: Date) => {\n    if (!canReceiptCheck) {\n      toast.error('입고 처리 권한이 없습니다.')\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      toast.error('유효하지 않은 항목 ID 입니다.')\n      return\n    }\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item =>\n            String(item.id) === itemIdStr\n              ? {\n                  ...item,\n                  is_received: true,\n                  actual_received_date: selectedDate.toISOString()\n                }\n              : item\n          )\n          const total = updatedItems.length || prev.items?.length || 0\n          const completed = updatedItems.filter(item => item.is_received).length\n          const allReceived = total > 0 && completed === total\n\n          return {\n            ...prev,\n            items: updatedItems,\n            is_received: allReceived,\n            received_at: allReceived ? new Date().toISOString() : prev.received_at\n          }\n        })\n      }\n    }\n\n    try {\n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_received: true,\n          received_at: new Date().toISOString(),\n          actual_received_date: selectedDate.toISOString()\n        })\n        .eq('id', numericId)\n\n      if (error) throw error\n\n      // 로컬 상태 즉시 업데이트\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          String(item.id) === itemIdStr \n            ? { \n                ...item, \n                is_received: true, \n                received_at: new Date().toISOString(),\n                actual_received_date: selectedDate.toISOString()\n              }\n            : item\n        )\n        return { ...prev, items: updatedItems }\n      })\n\n      applyOptimisticUpdate()\n      \n      const targetItem = purchase?.items?.find(item => String(item.id) === itemIdStr)\n      toast.success(`\"${targetItem?.item_name}\" 품목이 입고완료 처리되었습니다.`)\n\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n\n      applyOptimisticUpdate()\n    } catch (error) {\n      toast.error('입고완료 처리 중 오류가 발생했습니다.')\n    }\n  }\n\n  // 입고완료 취소 처리\n  const handleReceiptCancel = async (itemId: number | string) => {\n    if (!canReceiptCheck) {\n      toast.error('입고 처리 권한이 없습니다.')\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      toast.error('유효하지 않은 항목 ID 입니다.')\n      return\n    }\n\n    const targetItem = purchase?.items?.find(item => String(item.id) === itemIdStr)\n    if (!targetItem) return\n\n    const confirm = window.confirm(`\"${targetItem.item_name}\" 품목의 입고완료를 취소하시겠습니까?`)\n    if (!confirm) return\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item =>\n            String(item.id) === itemIdStr\n              ? {\n                  ...item,\n                  is_received: false,\n                  actual_received_date: undefined\n                }\n              : item\n          )\n          const total = updatedItems.length || prev.items?.length || 0\n          const completed = updatedItems.filter(item => item.is_received).length\n          const allReceived = total > 0 && completed === total\n\n          return {\n            ...prev,\n            items: updatedItems,\n            is_received: allReceived,\n            received_at: allReceived ? prev.received_at : null\n          }\n        })\n      }\n    }\n\n    try {\n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_received: false,\n          received_at: null,\n          actual_received_date: null,\n          actual_received_by_name: null\n        })\n        .eq('id', numericId)\n\n      if (error) throw error\n\n      // 로컬 상태 즉시 업데이트\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          String(item.id) === itemIdStr \n            ? { ...item, is_received: false, received_at: null, actual_received_date: undefined, actual_received_by_name: undefined }\n            : item\n        )\n        return { ...prev, items: updatedItems }\n      })\n      \n      applyOptimisticUpdate()\n\n      toast.success('입고완료가 취소되었습니다.')\n\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n\n      applyOptimisticUpdate()\n    } catch (error) {\n      toast.error('입고완료 취소 중 오류가 발생했습니다.')\n    }\n  }\n\n\n  // 승인 처리\n  const handleApprove = async (type: 'middle' | 'final') => {\n    if (!purchase) return\n    \n    const approvalType = type === 'middle' ? '1차 승인' : '최종 승인'\n    const confirmMessage = `발주번호: ${purchase.purchase_order_number}\\n\\n${approvalType}을 진행하시겠습니까?`\n    const confirm = window.confirm(confirmMessage)\n    if (!confirm) return\n    \n    try {\n      const updateData = type === 'middle' \n        ? { \n            middle_manager_status: 'approved'\n          }\n        : { \n            final_manager_status: 'approved'\n          }\n      \n      const { error } = await supabase\n        .from('purchase_requests')\n        .update(updateData)\n        .eq('id', purchase.id)\n      \n      if (error) {\n        throw error\n      }\n      \n      // 로컬 상태 즉시 업데이트 (UI 즉시 반영)\n      if (type === 'middle') {\n        setPurchase(prev => prev ? { ...prev, middle_manager_status: 'approved' } : null)\n      } else {\n        setPurchase(prev => prev ? { ...prev, final_manager_status: 'approved' } : null)\n      }\n      \n      toast.success(`${type === 'middle' ? '중간' : '최종'} 승인이 완료되었습니다.`)\n    } catch (error) {\n      toast.error('승인 처리 중 오류가 발생했습니다.')\n    }\n  }\n  \n  // 전체 구매완료 처리\n  const handleCompleteAllPayment = async () => {\n    if (!purchase || !canPurchase) return\n    \n    const confirmMessage = `발주번호: ${purchase.purchase_order_number}\\n\\n모든 품목을 구매완료 처리하시겠습니까?`\n    const confirm = window.confirm(confirmMessage)\n    if (!confirm) return\n    \n    try {\n      const updateData = {\n        is_payment_completed: true,\n        payment_completed_at: new Date().toISOString()\n      }\n      \n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update(updateData)\n        .eq('purchase_request_id', purchase.id)\n        .eq('is_payment_completed', false) // 아직 구매완료되지 않은 항목만\n      \n      if (error) throw error\n      \n      // 로컬 상태 즉시 업데이트 (UI 즉시 반영)\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          !item.is_payment_completed \n            ? { ...item, is_payment_completed: true, payment_completed_at: new Date().toISOString() }\n            : item\n        )\n        return { ...prev, items: updatedItems }\n      })\n\n      if (purchase) {\n        const purchaseIdNumber = Number(purchase.id)\n        if (!Number.isNaN(purchaseIdNumber)) {\n          onOptimisticUpdate?.(purchaseIdNumber, prev => {\n            const updatedItems = (prev.items || []).map(item => ({\n              ...item,\n              is_payment_completed: true\n            }))\n            return {\n              ...prev,\n              items: updatedItems,\n              is_payment_completed: true,\n              payment_completed_at: new Date().toISOString(),\n              payment_completed_by_name: currentUserName || prev.payment_completed_by_name\n            }\n          })\n        }\n      }\n      \n      toast.success('모든 품목이 구매완료 처리되었습니다.')\n\n      // 상세 모달 및 리스트 모두 새로고침\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      logger.error('전체 구매완료 처리 오류', error);\n      toast.error('구매완료 처리 중 오류가 발생했습니다.')\n    }\n  }\n\n  // UTK 확인 처리 함수\n  const handleUtkToggle = async (itemId: number | string, isChecked: boolean) => {\n    if (!canReceiptCheck) {\n      toast.error('UTK 확인 처리 권한이 없습니다.')\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      toast.error('유효하지 않은 항목 ID 입니다.')\n      return\n    }\n\n    // 해당 품목 정보 찾기\n    const targetItem = purchase?.items?.find(item => String(item.id) === itemIdStr)\n    if (!targetItem) return\n\n    const itemInfo = `품명: ${targetItem.item_name}\n규격: ${targetItem.specification || '미입력'}\n수량: ${targetItem.quantity?.toLocaleString() || 0}${targetItem.unit || ''}\n단가: ₩${targetItem.unit_price_value?.toLocaleString() || 0}\n합계: ₩${targetItem.amount_value?.toLocaleString() || 0}`\n\n    const confirmMessage = isChecked \n      ? `다음 품목을 UTK 확인 처리하시겠습니까?\\n\\n${itemInfo}` \n      : `다음 품목의 UTK 확인을 취소하시겠습니까?\\n\\n${itemInfo}`\n    \n    const confirm = window.confirm(confirmMessage)\n    if (!confirm) return\n\n    try {\n      const supabase = createClient()\n      logger.debug('UTK 확인 처리 시작', { itemId: numericId, isChecked, itemIdStr })\n      \n      const { data, error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_utk_checked: isChecked\n        })\n        .eq('id', numericId)\n        .select()\n\n      if (error) {\n        logger.error('UTK 확인 DB 업데이트 실패', { error, itemId: numericId, isChecked })\n        throw error\n      }\n      \n      logger.debug('UTK 확인 DB 업데이트 성공', { data })\n\n      // 로컬 상태 즉시 업데이트 (UI 즉시 반영)\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          String(item.id) === itemIdStr \n            ? { ...item, is_utk_checked: isChecked }\n            : item\n        )\n        return { ...prev, items: updatedItems }\n      })\n\n      if (purchase) {\n        const purchaseIdNumber = Number(purchase.id)\n        if (!Number.isNaN(purchaseIdNumber)) {\n          onOptimisticUpdate?.(purchaseIdNumber, prev => {\n            const updatedItems = (prev.items || []).map(item =>\n              String(item.id) === itemIdStr\n                ? { ...item, is_utk_checked: isChecked }\n                : item\n            )\n            const total = updatedItems.length || prev.items?.length || 0\n            const checked = updatedItems.filter(item => item.is_utk_checked).length\n            const allChecked = total > 0 && checked === total\n            return {\n              ...prev,\n              items: updatedItems,\n              is_utk_checked: allChecked\n            }\n          })\n        }\n      }\n\n      // 모든 품목이 확인되면 purchase_requests에도 업데이트\n      const allChecked = purchase?.items?.every(item => {\n        if (String(item.id) === itemIdStr) {\n          return isChecked\n        }\n        return item.is_utk_checked === true\n      })\n\n      if (allChecked !== undefined && purchase) {\n        logger.debug('purchase_requests 업데이트 시작', { purchaseId: purchase.id, allChecked })\n        const { error: updateError } = await supabase\n          .from('purchase_requests')\n          .update({ is_utk_checked: allChecked })\n          .eq('id', purchase.id)\n          .select()\n        \n        if (updateError) {\n          logger.error('purchase_requests 업데이트 실패', { error: updateError, purchaseId: purchase.id, allChecked })\n        } else {\n          logger.debug('purchase_requests 업데이트 성공', { purchaseId: purchase.id, allChecked })\n        }\n      }\n      \n      toast.success(isChecked ? 'UTK 확인이 완료되었습니다.' : 'UTK 확인이 취소되었습니다.')\n\n      // 상세 모달 및 상위 리스트 모두 최신 상태로 동기화\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      logger.error('UTK 확인 처리 중 오류', error)\n      toast.error('UTK 확인 처리 중 오류가 발생했습니다.')\n    }\n  }\n\n  // 전체 UTK 확인 처리\n  const handleCompleteAllUtk = async () => {\n    if (!purchase || !canReceiptCheck) return\n    \n    const confirmMessage = `발주번호: ${purchase.purchase_order_number}\\n\\n모든 품목을 UTK 확인 처리하시겠습니까?`\n    const confirm = window.confirm(confirmMessage)\n    if (!confirm) return\n    \n    try {\n      const supabase = createClient()\n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_utk_checked: true\n        })\n        .eq('purchase_request_id', purchase.id)\n        .eq('is_utk_checked', false) // 아직 확인되지 않은 항목만\n      \n      if (error) throw error\n\n      // purchase_requests도 업데이트\n      await supabase\n        .from('purchase_requests')\n        .update({ is_utk_checked: true })\n        .eq('id', purchase.id)\n      \n      // 로컬 상태 즉시 업데이트 (UI 즉시 반영)\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          !item.is_utk_checked \n            ? { ...item, is_utk_checked: true }\n            : item\n        )\n        return { \n          ...prev, \n          items: updatedItems,\n          is_utk_checked: true\n        }\n      })\n\n      if (purchase) {\n        const purchaseIdNumber = Number(purchase.id)\n        if (!Number.isNaN(purchaseIdNumber)) {\n          onOptimisticUpdate?.(purchaseIdNumber, prev => {\n            const updatedItems = (prev.items || []).map(item => ({\n              ...item,\n              is_utk_checked: true\n            }))\n            return {\n              ...prev,\n              items: updatedItems,\n              is_utk_checked: true\n            }\n          })\n        }\n      }\n      \n      toast.success('모든 품목의 UTK 확인이 완료되었습니다.')\n\n      // 상세 모달 및 리스트 모두 새로고침\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      logger.error('전체 UTK 확인 처리 오류', error);\n      toast.error('UTK 확인 처리 중 오류가 발생했습니다.')\n    }\n  }\n\n  // 전체 거래명세서 확인 처리 (날짜 선택)\n  const handleCompleteAllStatement = async (selectedDate: Date) => {\n    if (!purchase || !canReceiptCheck) {\n      return\n    }\n\n    const formattedDate = selectedDate.toLocaleDateString('ko-KR', {\n      year: 'numeric',\n      month: '2-digit',\n      day: '2-digit'\n    })\n\n    const confirmMessage = `발주번호: ${purchase.purchase_order_number}\n\n모든 품목의 회계상 입고일을 ${formattedDate}로 등록하시겠습니까?`\n    \n    if (!window.confirm(confirmMessage)) {\n      return\n    }\n\n    const selectedDateIso = selectedDate.toISOString()\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    try {\n      const { error } = await supabase\n        .from('purchase_request_items')\n        .update({\n          is_statement_received: true,\n          statement_received_date: selectedDateIso,\n          statement_received_by_name: currentUserName || null\n        })\n        .eq('purchase_request_id', purchase.id)\n        .eq('is_statement_received', false) // 아직 확인되지 않은 항목만\n      \n      if (error) throw error\n\n      // purchase_requests도 업데이트\n      await supabase\n        .from('purchase_requests')\n        .update({ \n          is_statement_received: true,\n          statement_received_at: selectedDateIso\n        })\n        .eq('id', purchase.id)\n\n      // 로컬 상태 즉시 업데이트\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          !item.is_statement_received \n            ? { \n                ...item, \n                is_statement_received: true,\n                statement_received_date: selectedDateIso,\n                statement_received_by_name: currentUserName || null\n              }\n            : item\n        )\n        const allCompleted = updatedItems && updatedItems.length > 0 && updatedItems.every(item => item.is_statement_received)\n        return { \n          ...prev, \n          items: updatedItems,\n          is_statement_received: allCompleted,\n          statement_received_at: allCompleted ? selectedDateIso : prev.statement_received_at\n        }\n      })\n\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item => ({\n            ...item,\n            is_statement_received: true,\n            statement_received_date: item.statement_received_date || selectedDateIso,\n            statement_received_by_name: item.statement_received_by_name || currentUserName || null\n          }))\n          return {\n            ...prev,\n            items: updatedItems,\n            is_statement_received: true,\n            statement_received_at: selectedDateIso\n          }\n        })\n      }\n\n      toast.success('모든 품목의 회계상 입고일이 등록되었습니다.')\n\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n    } catch (error) {\n      logger.error('전체 거래명세서 확인 처리 오류', error)\n      toast.error('거래명세서 확인 처리 중 오류가 발생했습니다.')\n    }\n  }\n\n  // 전체 입고완료 처리 (날짜 선택)\n  const handleCompleteAllReceipt = async (selectedDate: Date) => {\n    if (!purchase || !canReceiveItems) {\n      return\n    }\n\n    // 확인 다이얼로그 표시\n    const confirmMessage = `발주번호: ${purchase.purchase_order_number}\n\n전체 입고완료 처리하시겠습니까?`\n    \n    if (!window.confirm(confirmMessage)) {\n      return\n    }\n\n    const purchaseIdNumber = purchase ? Number(purchase.id) : NaN\n\n    const applyOptimisticUpdate = () => {\n      if (!Number.isNaN(purchaseIdNumber)) {\n        onOptimisticUpdate?.(purchaseIdNumber, prev => {\n          const updatedItems = (prev.items || []).map(item => ({\n            ...item,\n            is_received: true,\n            actual_received_date: item.actual_received_date || selectedDate.toISOString()\n          }))\n\n          return {\n            ...prev,\n            items: updatedItems,\n            is_received: true,\n            received_at: new Date().toISOString()\n          }\n        })\n      }\n    }\n\n    try {\n      const updateData = {\n        is_received: true,\n        received_at: new Date().toISOString(),\n        actual_received_date: selectedDate.toISOString()\n      }\n      \n\n      const { data, error } = await supabase\n        .from('purchase_request_items')\n        .update(updateData)\n        .eq('purchase_request_id', purchase.id)\n        .is('actual_received_date', null) // 아직 실제 입고되지 않은 항목만\n        .select()\n\n\n      if (error) throw error\n\n      // 로컬 상태 즉시 업데이트\n      setPurchase(prev => {\n        if (!prev) return null\n        const updatedItems = prev.items?.map(item => \n          !item.actual_received_date \n            ? { \n                ...item, \n                is_received: true, \n                received_at: new Date().toISOString(),\n                actual_received_date: selectedDate.toISOString()\n              }\n            : item\n        )\n        return { ...prev, items: updatedItems }\n      })\n\n      applyOptimisticUpdate()\n\n      toast.success('모든 품목이 입고완료 처리되었습니다.')\n\n      await refreshModalData()\n      const refreshResult = onRefresh?.(true, { silent: true })\n      if (refreshResult instanceof Promise) {\n        await refreshResult\n      }\n\n      applyOptimisticUpdate()\n    } catch (error) {\n      logger.error('전체 입고완료 처리 오류', error)\n      toast.error('입고완료 처리 중 오류가 발생했습니다.')\n    }\n  }\n  \n\n  // 반려 처리\n  const handleReject = async (type: 'middle' | 'final') => {\n    if (!purchase) return\n    \n    const reason = window.prompt('반려 사유를 입력해주세요:')\n    if (!reason) return\n    \n    try {\n      const updateData = type === 'middle'\n        ? {\n            middle_manager_status: 'rejected'\n          }\n        : {\n            final_manager_status: 'rejected'\n          }\n      \n      const { error } = await supabase\n        .from('purchase_requests')\n        .update(updateData)\n        .eq('id', purchase.id)\n      \n      if (error) {\n        throw error\n      }\n      \n      // 로컬 상태 즉시 업데이트 (UI 즉시 반영)\n      if (type === 'middle') {\n        setPurchase(prev => prev ? { ...prev, middle_manager_status: 'rejected' } : null)\n      } else {\n        setPurchase(prev => prev ? { ...prev, final_manager_status: 'rejected' } : null)\n      }\n      \n      toast.success(`${type === 'middle' ? '중간' : '최종'} 반려가 완료되었습니다.`)\n    } catch (error) {\n      toast.error('반려 처리 중 오류가 발생했습니다.')\n    }\n  }\n\n  const content = (\n    <div className=\"space-y-1 sm:space-y-4\">\n      {loading ? (\n        <div className=\"flex items-center justify-center py-12\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-hansl-600\"></div>\n        </div>\n      ) : purchase ? (\n        <div>\n          {/* Compact Info Header */}\n          <div className=\"bg-gray-50 rounded-lg p-2 sm:p-3 mb-1 sm:mb-2 border border-gray-100\">\n            <div className=\"grid grid-cols-1 sm:grid-cols-3 items-center gap-3 sm:gap-0\">\n              <div className=\"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-4\">\n                <div className=\"flex items-center gap-3\">\n                  {getStatusBadge()}\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"modal-label\">요청자:</span>\n                    <span className=\"modal-value\">{purchase.requester_name}</span>\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Calendar className=\"w-3 h-3 text-gray-500\" />\n                  <span className=\"modal-subtitle\">청구일: {formatDate(purchase.request_date)}</span>\n                </div>\n              </div>\n              \n              {/* 승인 버튼들을 중앙에 배치 */}\n              <div className=\"flex items-center justify-center gap-2 sm:gap-3 flex-wrap\">\n                {/* 1차 승인 버튼 */}\n                {canApproveMiddle && purchase.middle_manager_status === 'pending' && (\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => handleApprove('middle')}\n                    className={`${approvalButtonClass} border border-gray-400 bg-white hover:bg-gray-50 hover:border-gray-500`}\n                  >\n                    1차 승인 대기\n                  </Button>\n                )}\n                {purchase.middle_manager_status === 'approved' && (\n                  <div className=\"button-approved badge-text shadow-sm\">\n                    <Check className=\"w-3 h-3\" />\n                    1차 승인완료\n                  </div>\n                )}\n                {purchase.middle_manager_status === 'rejected' && (\n                  <div className=\"button-rejected badge-text\">\n                    <X className=\"w-3 h-3\" />\n                    1차 반려\n                  </div>\n                )}\n                {purchase.middle_manager_status === 'pending' && !canApproveMiddle && (\n                  <div className={`${approvalWaitingPillClass} border border-gray-300 text-gray-600 bg-white`}>\n                    1차 승인대기\n                  </div>\n                )}\n\n                {/* 최종 승인 버튼 */}\n                {canApproveFinal && purchase.middle_manager_status === 'approved' && purchase.final_manager_status === 'pending' && (\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => handleApprove('final')}\n                    className={`${approvalButtonClass} border border-gray-400 bg-white hover:bg-gray-50 hover:border-gray-500`}\n                  >\n                    <Check className=\"w-3 h-3\" />\n                    최종 승인\n                  </Button>\n                )}\n                {purchase.final_manager_status === 'approved' && (\n                  <div className=\"button-approved badge-text\">\n                    <Check className=\"w-3 h-3\" />\n                    최종 승인완료\n                  </div>\n                )}\n                {purchase.final_manager_status === 'rejected' && (\n                  <div className=\"button-rejected badge-text\">\n                    <X className=\"w-3 h-3\" />\n                    최종 반려\n                  </div>\n                )}\n                {purchase.middle_manager_status !== 'approved' && purchase.final_manager_status === 'pending' && (\n                  <div className={`${approvalWaitingPillClass} border border-gray-300 text-gray-600 bg-white`}>\n                    최종 승인대기\n                  </div>\n                )}\n              </div>\n              \n              {/* 우측 빈 영역 */}\n              <div></div>\n            </div>\n          </div>\n\n          {/* Main 2-Column Layout */}\n          <div className=\"flex flex-col lg:flex-row gap-3 sm:gap-6\">\n            {/* Left Column - Basic Info (Fixed Width) */}\n            <div className=\"lg:w-80 lg:flex-shrink-0 space-y-1 sm:space-y-4 relative\">\n              \n              {/* 발주 기본정보 */}\n              <div className=\"bg-white rounded-lg p-2 sm:p-3 border border-gray-100 shadow-sm\">\n                <div className=\"mb-3\">\n                  <h3 className=\"modal-section-title flex items-center\">\n                    <FileText className=\"w-4 h-4 mr-2 text-gray-600\" />\n                    {purchase?.purchase_order_number || 'PO번호 없음'}\n                  </h3>\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">발주서 종류</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.request_type || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, request_type: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"일반\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.request_type || '일반'}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">결제 종류</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.payment_category || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, payment_category: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"발주/구매요청/현장결제\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.payment_category || '-'}</p>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">입고 요청일</span>\n                      {isEditing ? (\n                        <DatePickerPopover\n                          onDateSelect={(date) => {\n                            setEditedPurchase(prev => prev ? {\n                              ...prev,\n                              delivery_request_date: formatDateInput(date, 'yyyy-MM-dd')\n                            } : null)\n                          }}\n                          placeholder=\"입고 요청일을 선택하세요\"\n                          align=\"start\"\n                          side=\"bottom\"\n                        >\n                          <Button\n                            variant=\"outline\"\n                            className=\"mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] justify-start text-left font-normal business-radius-input\"\n                          >\n                            <Calendar className=\"mr-1 h-3 w-3\" />\n                            {editedPurchase?.delivery_request_date ? \n                              formatDate(editedPurchase.delivery_request_date) : \n                              '날짜 선택'\n                            }\n                          </Button>\n                        </DatePickerPopover>\n                      ) : (\n                        <p className=\"modal-subtitle\">{formatDate(purchase.delivery_request_date)}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label text-orange-500\">변경 입고일</span>\n                      {isEditing ? (\n                        <DatePickerPopover\n                          onDateSelect={(date) => {\n                            setEditedPurchase(prev => prev ? {\n                              ...prev,\n                              revised_delivery_request_date: formatDateInput(date, 'yyyy-MM-dd')\n                            } : null)\n                          }}\n                          placeholder=\"변경 입고일을 선택하세요\"\n                          align=\"start\"\n                          side=\"bottom\"\n                        >\n                          <Button\n                            variant=\"outline\"\n                            className=\"mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] justify-start text-left font-normal business-radius-input\"\n                          >\n                            <Calendar className=\"mr-1 h-3 w-3\" />\n                            {editedPurchase?.revised_delivery_request_date ? \n                              formatDate(editedPurchase.revised_delivery_request_date) : \n                              '날짜 선택'\n                            }\n                          </Button>\n                        </DatePickerPopover>\n                      ) : (\n                        <p className=\"modal-subtitle text-orange-700\">\n                          {purchase.revised_delivery_request_date ? formatDate(purchase.revised_delivery_request_date) : '미설정'}\n                        </p>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/* 업체 정보 */}\n              <div className=\"bg-white rounded-lg p-2 sm:p-3 border border-gray-100 shadow-sm\">\n                <h3 className=\"modal-section-title mb-3 flex items-center\">\n                  <Building2 className=\"w-4 h-4 mr-2 text-gray-600\" />\n                  업체 정보\n                </h3>\n                \n                <div className=\"space-y-2\">\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">업체명</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.vendor?.vendor_name || editedPurchase?.vendor_name || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, vendor_name: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"업체 선택\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.vendor?.vendor_name || '-'}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">업체 담당자</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.vendor_contacts?.[0]?.contact_name || ''}\n                          onChange={(e) => {\n                            setEditedPurchase(prev => {\n                              if (!prev) return null;\n                              const contacts = prev.vendor_contacts || [];\n                              const updatedContacts = [...contacts];\n                              if (updatedContacts[0]) {\n                                updatedContacts[0] = { ...updatedContacts[0], contact_name: e.target.value };\n                              } else {\n                                updatedContacts[0] = { contact_name: e.target.value } as any;\n                              }\n                              return { ...prev, vendor_contacts: updatedContacts };\n                            })\n                          }}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"담당자 선택\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.vendor_contacts?.[0]?.contact_name || '-'}</p>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">PJ업체</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.project_vendor || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, project_vendor: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"입력\"\n                        />\n                      ) : (\n                        <p className=\"modal-value\">{purchase.project_vendor || '-'}</p>\n                      )}\n                    </div>\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">Item</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.project_item || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, project_item: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"입력\"\n                        />\n                      ) : (\n                        <p className=\"modal-subtitle\">{purchase.project_item || '-'}</p>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 sm:flex sm:gap-8\">\n                    <div className=\"w-32\">\n                      <span className=\"modal-label\">수주번호</span>\n                      {isEditing ? (\n                        <Input\n                          value={editedPurchase?.order_number || ''}\n                          onChange={(e) => setEditedPurchase(prev => prev ? { ...prev, order_number: e.target.value } : null)}\n                          className=\"mt-1 rounded-lg border-gray-200 focus:border-blue-400 w-full h-5 px-1.5 py-0.5 text-[10px]\"\n                          placeholder=\"입력\"\n                        />\n                      ) : (\n                        <p className=\"modal-subtitle\">{purchase.order_number || '-'}</p>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n            </div>\n\n            {/* Right Column - Items List (Flexible Width) */}\n            <div className=\"lg:flex-1 lg:min-w-0 relative overflow-visible\">\n              \n              <div className=\"bg-white rounded-lg border border-gray-100 overflow-hidden shadow-sm\">\n                <div className=\"p-2 sm:p-3 bg-gray-50 border-b border-gray-100 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-0\">\n                  <h3 className=\"modal-section-title flex items-center\">\n                    <Package className=\"w-4 h-4 mr-2 text-gray-600\" />\n                    품목 리스트\n                    <span className=\"ml-2 badge-secondary\">\n                      {purchase.items?.length || 0}개\n                    </span>\n                  </h3>\n                  {!isEditing && (\n                    <>\n                      {activeTab === 'purchase' && canPurchase && (\n                        <Button\n                          size=\"sm\"\n                          onClick={handleCompleteAllPayment}\n                          className=\"button-base bg-orange-500 hover:bg-orange-600 text-white\"\n                        >\n                          <CreditCard className=\"w-3 h-3 mr-1\" />\n                          전체 구매완료\n                        </Button>\n                      )}\n                      {activeTab === 'receipt' && canReceiveItems && (\n                        <DatePickerPopover\n                          onDateSelect={handleCompleteAllReceipt}\n                          placeholder=\"전체 입고완료 날짜를 선택하세요\"\n                          align=\"end\"\n                          side=\"bottom\"\n                        >\n                          <Button\n                            size=\"sm\"\n                            className=\"button-base button-action-primary\"\n                          >\n                            <Truck className=\"w-3 h-3 mr-1\" />\n                            전체 입고완료\n                          </Button>\n                        </DatePickerPopover>\n                      )}\n                      {activeTab === 'done' && canReceiptCheck && (\n                        <div className=\"flex items-center gap-2\">\n                          <DatePickerPopover\n                            onDateSelect={handleCompleteAllStatement}\n                            placeholder=\"전체 회계상 입고일을 선택하세요\"\n                            align=\"end\"\n                            side=\"bottom\"\n                          >\n                            <Button\n                              size=\"sm\"\n                              className=\"button-base button-action-primary\"\n                            >\n                              <FileText className=\"w-3 h-3 mr-1\" />\n                              거래명세서 확인\n                            </Button>\n                          </DatePickerPopover>\n                          <Button\n                            size=\"sm\"\n                            onClick={handleCompleteAllUtk}\n                            className=\"button-base bg-orange-500 hover:bg-orange-600 text-white\"\n                          >\n                            <CheckCircle className=\"w-3 h-3 mr-1\" />\n                            UTK 확인\n                          </Button>\n                        </div>\n                      )}\n                    </>\n                  )}\n                </div>\n                \n                {/* Mobile Table Header */}\n                <div className=\"block sm:hidden bg-gray-50 px-2 py-1 border-b border-gray-100\">\n                  <div className=\"text-xs font-medium text-gray-600\">품목 목록 (터치하여 스크롤)</div>\n                </div>\n                \n                {/* Items List with Header Inside Scrollable Container */}\n                <div className=\"max-h-[50vh] sm:max-h-[40vh] w-full min-w-0 overflow-auto\">\n                  <div style={{ minWidth: `${tableMinWidth}px` }}>\n                    {/* Items Table Header - Sticky inside scroll container */}\n                    <div className=\"bg-gray-50 px-2 sm:px-3 py-1 border-b border-gray-100 sticky top-0 z-10\">\n                      <div \n                        ref={headerRowRef}\n                        className=\"hidden sm:grid gap-3 modal-label\" \n                        style={{\n                          gridTemplateColumns: getGridTemplateColumns()\n                        }}\n                      >\n                        <div>품목명</div>\n                        <div>규격</div>\n                        <div className=\"text-center\">수량</div>\n                        <div className=\"text-right\">단가</div>\n                        <div className=\"text-right\">합계</div>\n                        <div className=\"text-center\">비고</div>\n                        {isEditing ? (\n                          <>\n                            <div className=\"text-center\">삭제</div>\n                            {activeTab === 'receipt' && (\n                              <>\n                                <div className=\"text-center\">실제입고일</div>\n                              </>\n                            )}\n                            {activeTab === 'done' && (\n                              <>\n                                <div className=\"text-center\">거래명세서 확인</div>\n                                <div className=\"text-center\">회계상 입고일</div>\n                                <div className=\"text-center\">처리자</div>\n                                <div className=\"text-center\">UTK</div>\n                              </>\n                            )}\n                          </>\n                        ) : (\n                          <>\n                            <div className=\"text-center\">\n                              {activeTab === 'purchase'\n                                ? '구매상태'\n                                : (activeTab === 'receipt' || activeTab === 'done')\n                                ? '입고상태'\n                                : '상태'}\n                            </div>\n                            {activeTab === 'done' && (\n                              <>\n                                <div className=\"text-center\">거래명세서 확인</div>\n                                <div className=\"text-center\">회계상 입고일</div>\n                                <div className=\"text-center\">처리자</div>\n                                <div className=\"text-center\">UTK</div>\n                              </>\n                            )}\n                            {activeTab === 'receipt' && (\n                              <>\n                                <div className=\"text-center\">실제입고일</div>\n                              </>\n                            )}\n                          </>\n                        )}\n                      </div>\n                    </div>\n                    <div className=\"divide-y divide-gray-100\">\n                      {(isEditing ? editedItems : purchase.items)?.map((item, index) => (\n                        <div key={index} className=\"px-2 sm:px-3 py-1.5 border-b border-gray-50 hover:bg-gray-50/50 transition-colors\">\n                          {/* Desktop Layout */}\n                          <div className={`hidden sm:grid items-center gap-3`} style={{\n                            gridTemplateColumns: getGridTemplateColumns()\n                          }}>\n                            {/* 품목명 */}\n                            <div className=\"min-w-0\">\n                              {isEditing ? (\n                                <Input\n                                  value={item.item_name}\n                                  onChange={(e) => handleItemChange(index, 'item_name', e.target.value)}\n                                  className=\"modal-label border-gray-200 rounded-lg w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                  placeholder=\"품목명\"\n                                />\n                              ) : (\n                                <span className=\"modal-value\">{item.item_name || '품목명 없음'}</span>\n                              )}\n                            </div>\n                            \n                            {/* 규격 */}\n                            <div className=\"min-w-0\">\n                              {isEditing ? (\n                                <Input\n                                  value={item.specification}\n                                  onChange={(e) => handleItemChange(index, 'specification', e.target.value)}\n                                  className=\"modal-label border-gray-200 rounded-lg w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                  placeholder=\"규격\"\n                                />\n                              ) : (\n                                <span className=\"modal-subtitle\">{item.specification || '-'}</span>\n                              )}\n                            </div>\n                            \n                            {/* 수량 */}\n                            <div className=\"text-center min-w-0\">\n                              {isEditing ? (\n                                <Input\n                                  type=\"number\"\n                                  value={item.quantity}\n                                  onChange={(e) => handleItemChange(index, 'quantity', Number(e.target.value))}\n                                  className=\"modal-label border-gray-200 rounded-lg text-center w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                  placeholder=\"수량\"\n                                  max=\"99999\"\n                                />\n                              ) : (\n                                <span className=\"modal-subtitle\">{item.quantity || 0}</span>\n                              )}\n                            </div>\n                            \n                            {/* 단가 */}\n                            <div className=\"text-right min-w-0\">\n                              {isEditing ? (\n                                <Input\n                                  type=\"number\"\n                                  value={item.unit_price_value}\n                                  onChange={(e) => handleItemChange(index, 'unit_price_value', Number(e.target.value))}\n                                  className=\"modal-label border-gray-200 rounded-lg text-right w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                  placeholder=\"단가\"\n                                  max=\"100000000000\"\n                                />\n                              ) : (\n                                <span className=\"modal-subtitle\">₩{formatCurrency(item.unit_price_value)}</span>\n                              )}\n                            </div>\n                            \n                            {/* 합계 */}\n                            <div className=\"text-right min-w-0\">\n                              {isEditing ? (\n                                <Input\n                                  type=\"number\"\n                                  value={item.amount_value}\n                                  onChange={(e) => handleItemChange(index, 'amount_value', Number(e.target.value))}\n                                  className=\"modal-label border-gray-200 rounded-lg text-right w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                  placeholder=\"합계\"\n                                  max=\"10000000000\"\n                                />\n                              ) : (\n                                <span className=\"modal-value\">₩{formatCurrency(item.amount_value || 0)}</span>\n                              )}\n                            </div>\n                            \n                            {/* 비고 */}\n                            <div className=\"min-w-0 flex justify-center items-start pt-1 text-center\">\n                              {isEditing ? (\n                                <Input\n                                  value={item.remark || ''}\n                                  onChange={(e) => handleItemChange(index, 'remark', e.target.value)}\n                                  className=\"modal-label border-gray-200 rounded-lg text-center w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                  placeholder=\"비고\"\n                                />\n                              ) : (\n                                <span className=\"modal-subtitle text-center\">{item.remark || '-'}</span>\n                              )}\n                            </div>\n                            \n                            {/* 상태/액션 */}\n                            <div className=\"text-center flex justify-center items-start pt-1\">\n                              {isEditing ? (\n                                <Button\n                                  size=\"sm\"\n                                  variant=\"ghost\"\n                                  onClick={() => handleRemoveItem(index)}\n                                  className=\"text-red-600 hover:bg-red-50 rounded-lg p-1 h-6 w-6\"\n                                >\n                                  <Trash2 className=\"w-3 h-3\" />\n                                </Button>\n                              ) : (\n                                <>\n                                  {/* 구매 탭에서의 구매완료 상태 */}\n                                  {activeTab === 'purchase' && (\n                                    <div className=\"flex justify-center\">\n                                      {canPurchase ? (\n                                        <button\n                                          onClick={() => handlePaymentToggle(item.id, !item.is_payment_completed)}\n                                          className={`transition-colors ${\n                                            item.is_payment_completed\n                                              ? 'button-toggle-active bg-orange-500 hover:bg-orange-600 text-white'\n                                              : 'button-toggle-inactive'\n                                          }`}\n                                        >\n                                          {item.is_payment_completed ? '구매완료' : '구매대기'}\n                                        </button>\n                                      ) : (\n                                        <span className={`${\n                                          item.is_payment_completed \n                                            ? 'button-toggle-active bg-orange-500 text-white' \n                                            : 'button-waiting-inactive'\n                                        }`}>\n                                          {item.is_payment_completed ? '구매완료' : '구매대기'}\n                                        </span>\n                                      )}\n                                    </div>\n                                  )}\n                                  \n                                  {/* 입고 탭에서의 입고완료 상태 */}\n                                  {activeTab === 'receipt' && (\n                                    <div className=\"flex justify-center\">\n                                      {canReceiptCheck ? (\n                                        actualReceivedAction.isCompleted(item) ? (\n                                          <button\n                                            onClick={() => {\n                                              actualReceivedAction.handleCancel(item.id, {\n                                                item_name: item.item_name,\n                                                specification: item.specification,\n                                                quantity: item.quantity,\n                                                unit_price_value: item.unit_price_value,\n                                                amount_value: item.amount_value,\n                                                remark: item.remark\n                                              })\n                                            }}\n                                            className=\"button-action-primary\"\n                                          >\n                                            {actualReceivedAction.config.completedText}\n                                          </button>\n                                        ) : (\n                                          <DatePickerPopover\n                                            onDateSelect={(date) => {\n                                              actualReceivedAction.handleConfirm(item.id, date, {\n                                                item_name: item.item_name,\n                                                specification: item.specification,\n                                                quantity: item.quantity,\n                                                unit_price_value: item.unit_price_value,\n                                                amount_value: item.amount_value,\n                                                remark: item.remark\n                                              })\n                                            }}\n                                            placeholder=\"실제 입고된 날짜를 선택하세요\"\n                                            align=\"center\"\n                                            side=\"bottom\"\n                                          >\n                                            <button className=\"button-toggle-inactive\">\n                                              {actualReceivedAction.config.waitingText}\n                                            </button>\n                                          </DatePickerPopover>\n                                        )\n                                      ) : (\n                                        <span className={`${\n                                          actualReceivedAction.isCompleted(item)\n                                            ? 'button-action-primary' \n                                            : 'button-waiting-inactive'\n                                        }`}>\n                                          {actualReceivedAction.isCompleted(item) ? actualReceivedAction.config.completedText : actualReceivedAction.config.waitingText}\n                                        </span>\n                                      )}\n                                    </div>\n                                  )}\n                                  \n                                  {/* 전체 항목 탭에서는 입고 상태만 표시 (클릭 불가) */}\n                                  {activeTab === 'done' && (\n                                    <div className=\"flex justify-center\">\n                                      <span className={`button-base ${\n                                        actualReceivedAction.isCompleted(item)\n                                          ? 'bg-green-500 hover:bg-green-600 text-white' \n                                          : 'border border-gray-300 text-gray-600 bg-white hover:bg-gray-50'\n                                      }`}>\n                                        {actualReceivedAction.isCompleted(item) ? '입고완료' : '입고대기'}\n                                      </span>\n                                    </div>\n                                  )}\n                                  \n                                  {/* 기타 탭에서는 기본 상태 표시 */}\n                                  {activeTab !== 'purchase' && activeTab !== 'receipt' && activeTab !== 'done' && (\n                                    <div className=\"flex justify-center\">\n                                      <span className=\"badge-text\">-</span>\n                                    </div>\n                                  )}\n                                </>\n                              )}\n                            </div>\n                            \n                            {/* 실제 입고 날짜 - 입고 탭에서만 표시 (상태 컬럼 오른쪽) */}\n                            {activeTab === 'receipt' && (\n                              <div className=\"text-center flex justify-center items-start pt-1 pl-2\">\n                                {actualReceivedAction.getCompletedDate(item) ? (\n                                  <div className=\"modal-subtitle text-green-700\">\n                                    {new Date(actualReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                                      year: 'numeric',\n                                      month: '2-digit',\n                                      day: '2-digit'\n                                    })}\n                                  </div>\n                                ) : (\n                                  <span className=\"modal-subtitle text-gray-400\">-</span>\n                                )}\n                              </div>\n                            )}\n\n                            {/* 거래명세서 확인 - 전체항목 탭에서만 표시 */}\n                            {activeTab === 'done' && (\n                              <div className=\"text-center flex justify-center items-start pt-1\">\n                                {canReceiptCheck ? (\n                                  statementReceivedAction.isCompleted(item) ? (\n                                    <button\n                                      onClick={() => {\n                                        statementReceivedAction.handleCancel(item.id, {\n                                          item_name: item.item_name,\n                                          specification: item.specification,\n                                          quantity: item.quantity,\n                                          unit_price_value: item.unit_price_value,\n                                          amount_value: item.amount_value,\n                                          remark: item.remark\n                                        })\n                                      }}\n                                      className=\"button-action-primary hover:bg-green-600 transition-colors\"\n                                      title=\"클릭하여 거래명세서 확인 취소\"\n                                    >\n                                      {statementReceivedAction.config.completedText}\n                                    </button>\n                                  ) : (\n                                    <DatePickerPopover\n                                      onDateSelect={(date) => {\n                                        statementReceivedAction.handleConfirm(item.id, date, {\n                                          item_name: item.item_name,\n                                          specification: item.specification,\n                                          quantity: item.quantity,\n                                          unit_price_value: item.unit_price_value,\n                                          amount_value: item.amount_value,\n                                          remark: item.remark\n                                        })\n                                      }}\n                                      placeholder=\"회계상 입고일을 선택하세요\"\n                                      align=\"center\"\n                                      side=\"bottom\"\n                                    >\n                                      <button \n                                        className=\"button-toggle-inactive\"\n                                        onClick={() => {}}\n                                      >\n                                        {statementReceivedAction.config.waitingText}\n                                      </button>\n                                    </DatePickerPopover>\n                                  )\n                                ) : (\n                                  <span className={`${\n                                    statementReceivedAction.isCompleted(item)\n                                      ? 'button-action-primary' \n                                      : 'button-waiting-inactive'\n                                  }`}>\n                                    {statementReceivedAction.isCompleted(item) ? statementReceivedAction.config.completedText : statementReceivedAction.config.waitingText}\n                                  </span>\n                                )}\n                              </div>\n                            )}\n\n                            {/* 회계상 입고일 - 전체항목 탭에서만 표시 */}\n                            {activeTab === 'done' && (\n                              <div className=\"text-center flex justify-center items-start pt-1\">\n                                {statementReceivedAction.getCompletedDate(item) ? (\n                                  <div className=\"modal-subtitle text-blue-700\">\n                                    {new Date(statementReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                                      year: 'numeric',\n                                      month: '2-digit',\n                                      day: '2-digit'\n                                    })}\n                                  </div>\n                                ) : (\n                                  <span className=\"modal-subtitle text-gray-400\">-</span>\n                                )}\n                              </div>\n                            )}\n                            {/* 처리자 - 전체항목 탭에서만 표시 */}\n                            {activeTab === 'done' && (\n                              <div className=\"text-center flex justify-center items-start pt-1\">\n                                {statementReceivedAction.getCompletedByName(item) ? (\n                                  <span className=\"modal-subtitle text-gray-600\">\n                                    {statementReceivedAction.getCompletedByName(item)}\n                                  </span>\n                                ) : (\n                                  <span className=\"modal-subtitle text-gray-400\">-</span>\n                                )}\n                              </div>\n                            )}\n\n                            {/* UTK 확인 - 전체항목 탭에서만 표시 (맨 오른쪽 끝) */}\n                            {activeTab === 'done' && (\n                              <div className=\"text-center flex justify-center items-start pt-1\">\n                                {canReceiptCheck ? (\n                                  <button\n                                    onClick={() => handleUtkToggle(item.id, !item.is_utk_checked)}\n                                    className={`button-base transition-colors ${\n                                      item.is_utk_checked\n                                        ? 'button-toggle-active bg-orange-500 hover:bg-orange-600 text-white'\n                                        : 'button-toggle-inactive'\n                                    }`}\n                                    title={item.is_utk_checked ? 'UTK 확인 취소' : 'UTK 확인 처리'}\n                                  >\n                                    {item.is_utk_checked ? '완료' : '대기'}\n                                  </button>\n                                ) : (\n                                  <span className={`${\n                                    item.is_utk_checked \n                                      ? 'button-toggle-active bg-orange-500 text-white' \n                                      : 'button-waiting-inactive'\n                                  }`}>\n                                    {item.is_utk_checked ? '완료' : '대기'}\n                                  </span>\n                                )}\n                              </div>\n                            )}\n                          </div>\n                          \n                          {/* Mobile Layout */}\n                          <div className=\"block sm:hidden space-y-2\">\n                            <div className=\"flex justify-between items-start\">\n                              <div className=\"flex-1 min-w-0\">\n                                {isEditing ? (\n                                  <Input\n                                    value={item.item_name}\n                                    onChange={(e) => handleItemChange(index, 'item_name', e.target.value)}\n                                    className=\"modal-label border-gray-200 rounded-lg w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                    placeholder=\"품목명\"\n                                  />\n                                ) : (\n                                  <div className=\"modal-value font-medium\">{item.item_name || '품목명 없음'}</div>\n                                )}\n                                {isEditing ? (\n                                  <Input\n                                    value={item.specification}\n                                    onChange={(e) => handleItemChange(index, 'specification', e.target.value)}\n                                    className=\"modal-label border-gray-200 rounded-lg mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                    placeholder=\"규격\"\n                                  />\n                                ) : (\n                                  <div className=\"modal-subtitle text-gray-500\">{item.specification || '-'}</div>\n                                )}\n                              </div>\n                              <div className=\"ml-3 text-right flex-shrink-0\">\n                                {isEditing ? (\n                                  <Input\n                                    type=\"number\"\n                                    value={item.amount_value}\n                                    onChange={(e) => handleItemChange(index, 'amount_value', Number(e.target.value))}\n                                    className=\"modal-label border-gray-200 rounded-lg text-right w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                    placeholder=\"합계\"\n                                  />\n                                ) : (\n                                  <div className=\"modal-value font-semibold\">₩{formatCurrency(item.amount_value || 0)}</div>\n                                )}\n                              </div>\n                            </div>\n                            \n                            <div className=\"grid grid-cols-3 gap-2 text-sm\">\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">수량:</span>\n                                {isEditing ? (\n                                  <Input\n                                    type=\"number\"\n                                    value={item.quantity}\n                                    onChange={(e) => handleItemChange(index, 'quantity', Number(e.target.value))}\n                                    className=\"modal-label border-gray-200 rounded-lg mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                    placeholder=\"수량\"\n                                  />\n                                ) : (\n                                  <div className=\"modal-subtitle\">{item.quantity || 0}</div>\n                                )}\n                              </div>\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">단가:</span>\n                                {isEditing ? (\n                                  <Input\n                                    type=\"number\"\n                                    value={item.unit_price_value}\n                                    onChange={(e) => handleItemChange(index, 'unit_price_value', Number(e.target.value))}\n                                    className=\"modal-label border-gray-200 rounded-lg mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                    placeholder=\"단가\"\n                                  />\n                                ) : (\n                                  <div className=\"modal-subtitle\">₩{formatCurrency(item.unit_price_value)}</div>\n                                )}\n                              </div>\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">상태:</span>\n                                <div className=\"mt-1\">\n                                  {isEditing ? (\n                                    <Button\n                                      size=\"sm\"\n                                      variant=\"ghost\"\n                                      onClick={() => handleRemoveItem(index)}\n                                      className=\"text-red-600 hover:bg-red-50 rounded-lg p-1 h-6 w-6\"\n                                    >\n                                      <Trash2 className=\"w-3 h-3\" />\n                                    </Button>\n                                  ) : (\n                                    <>\n                                      {activeTab === 'purchase' && (\n                                        <>\n                                          {canPurchase ? (\n                                            <button\n                                              onClick={() => handlePaymentToggle(item.id, !item.is_payment_completed)}\n                                              className={`text-xs px-2 py-1 rounded transition-colors ${\n                                                item.is_payment_completed\n                                                  ? 'bg-orange-500 text-white hover:bg-orange-600'\n                                                  : 'bg-gray-100 text-gray-600'\n                                              }`}\n                                            >\n                                              {item.is_payment_completed ? '구매완료' : '구매대기'}\n                                            </button>\n                                          ) : (\n                                            <span className={`text-xs px-2 py-1 rounded ${\n                                              item.is_payment_completed \n                                                ? 'bg-orange-500 text-white' \n                                                : 'bg-gray-100 text-gray-400'\n                                            }`}>\n                                              {item.is_payment_completed ? '구매완료' : '구매대기'}\n                                            </span>\n                                          )}\n                                        </>\n                                      )}\n                                      \n                                      {activeTab === 'receipt' && (\n                                        <>\n                                          {canReceiptCheck ? (\n                                            actualReceivedAction.isCompleted(item) ? (\n                                              <button\n                                                onClick={() => {\n                                                  actualReceivedAction.handleCancel(item.id, {\n                                                    item_name: item.item_name,\n                                                    specification: item.specification,\n                                                    quantity: item.quantity,\n                                                    unit_price_value: item.unit_price_value,\n                                                    amount_value: item.amount_value,\n                                                    remark: item.remark\n                                                  })\n                                                }}\n                                                className=\"text-xs px-2 py-1 rounded button-action-primary\"\n                                              >\n                                                {actualReceivedAction.config.completedText}\n                                              </button>\n                                            ) : (\n                                              <DatePickerPopover\n                                                onDateSelect={(date) => {\n                                                  actualReceivedAction.handleConfirm(item.id, date, {\n                                                    item_name: item.item_name,\n                                                    specification: item.specification,\n                                                    quantity: item.quantity,\n                                                    unit_price_value: item.unit_price_value,\n                                                    amount_value: item.amount_value,\n                                                    remark: item.remark\n                                                  })\n                                                }}\n                                                placeholder=\"실제 입고된 날짜를 선택하세요\"\n                                                align=\"center\"\n                                                side=\"bottom\"\n                                              >\n                                                <button className=\"text-xs px-2 py-1 rounded bg-gray-100 text-gray-600\">\n                                                  {actualReceivedAction.config.waitingText}\n                                                </button>\n                                              </DatePickerPopover>\n                                            )\n                                          ) : (\n                                            <span className={`text-xs px-2 py-1 rounded ${\n                                              actualReceivedAction.isCompleted(item)\n                                                ? 'button-action-primary' \n                                                : 'bg-gray-100 text-gray-400'\n                                            }`}>\n                                              {actualReceivedAction.isCompleted(item) ? actualReceivedAction.config.completedText : actualReceivedAction.config.waitingText}\n                                            </span>\n                                          )}\n                                        </>\n                                      )}\n                                      \n                                      {activeTab === 'done' && (\n                                        <>\n                                          {/* 전체 항목 탭에서는 입고 상태만 표시 (클릭 불가) */}\n                                          <span className={`button-base ${\n                                            actualReceivedAction.isCompleted(item)\n                                              ? 'bg-green-500 text-white' \n                                              : 'border border-gray-300 text-gray-600 bg-white'\n                                          }`}>\n                                            {actualReceivedAction.isCompleted(item) ? '입고완료' : '입고대기'}\n                                          </span>\n                                        </>\n                                      )}\n                                      \n                                      {activeTab !== 'purchase' && activeTab !== 'receipt' && activeTab !== 'done' && (\n                                        <span className=\"text-xs text-gray-400\">-</span>\n                                      )}\n                                    </>\n                                  )}\n                                </div>\n                              </div>\n                            </div>\n                            \n                            {(item.remark || isEditing) && (\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">비고:</span>\n                                {isEditing ? (\n                                  <Input\n                                    value={item.remark || ''}\n                                    onChange={(e) => handleItemChange(index, 'remark', e.target.value)}\n                                    className=\"modal-label border-gray-200 rounded-lg mt-1 w-full h-5 px-1.5 py-0.5 text-[10px] focus:border-blue-400\"\n                                    placeholder=\"비고\"\n                                  />\n                                ) : (\n                                  <div className=\"modal-subtitle text-gray-500 mt-1\">{item.remark || '-'}</div>\n                                )}\n                              </div>\n                            )}\n                            \n                            {/* 모바일에서 실제 입고 날짜 표시 */}\n                            {!isEditing && activeTab === 'receipt' && actualReceivedAction.getCompletedDate(item) && (\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">실제입고일:</span>\n                                <div className=\"mt-1\">\n                                  <div className=\"modal-subtitle text-green-700\">\n                                    {new Date(actualReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                                      year: 'numeric',\n                                      month: '2-digit',\n                                      day: '2-digit'\n                                    })}\n                                  </div>\n                                  <div className=\"text-[9px] text-gray-500\">\n                                    {new Date(actualReceivedAction.getCompletedDate(item)).toLocaleTimeString('ko-KR', {\n                                      hour: '2-digit',\n                                      minute: '2-digit'\n                                    })}\n                                  </div>\n                                </div>\n                              </div>\n                            )}\n\n                            {/* 모바일에서 거래명세서 확인 표시 - 전체항목 탭에서만 */}\n                            {!isEditing && activeTab === 'done' && (\n                              <div className=\"flex items-center justify-between\">\n                                <span className=\"text-gray-500 text-xs\">거래명세서 확인:</span>\n                                <div className=\"flex items-center gap-2\">\n                                  {canReceiptCheck ? (\n                                    statementReceivedAction.isCompleted(item) ? (\n                                      <button\n                                        onClick={() => {\n                                          statementReceivedAction.handleCancel(item.id, {\n                                            item_name: item.item_name,\n                                            specification: item.specification,\n                                            quantity: item.quantity,\n                                            unit_price_value: item.unit_price_value,\n                                            amount_value: item.amount_value,\n                                            remark: item.remark\n                                          })\n                                        }}\n                                        className=\"text-xs px-2 py-1 rounded button-action-primary hover:bg-green-600 transition-colors\"\n                                        title=\"클릭하여 거래명세서 확인 취소\"\n                                      >\n                                        {statementReceivedAction.config.completedText}\n                                      </button>\n                                    ) : (\n                                      <DatePickerPopover\n                                        onDateSelect={(date) => {\n                                          statementReceivedAction.handleConfirm(item.id, date, {\n                                            item_name: item.item_name,\n                                            specification: item.specification,\n                                            quantity: item.quantity,\n                                            unit_price_value: item.unit_price_value,\n                                            amount_value: item.amount_value,\n                                            remark: item.remark\n                                          })\n                                        }}\n                                        placeholder=\"회계상 입고일을 선택하세요\"\n                                        align=\"end\"\n                                        side=\"bottom\"\n                                      >\n                                        <button \n                                          className=\"text-xs px-2 py-1 rounded bg-gray-100 text-gray-600\"\n                                          onClick={() => {}}\n                                        >\n                                          {statementReceivedAction.config.waitingText}\n                                        </button>\n                                      </DatePickerPopover>\n                                    )\n                                  ) : (\n                                    <span className={`text-xs px-2 py-1 rounded ${\n                                      statementReceivedAction.isCompleted(item)\n                                        ? 'button-action-primary' \n                                        : 'bg-gray-100 text-gray-400'\n                                    }`}>\n                                      {statementReceivedAction.isCompleted(item) ? statementReceivedAction.config.completedText : statementReceivedAction.config.waitingText}\n                                    </span>\n                                  )}\n                                </div>\n                              </div>\n                            )}\n\n                            {/* 모바일에서 회계상 입고일 표시 - 전체항목 탭에서만 */}\n                            {!isEditing && activeTab === 'done' && statementReceivedAction.getCompletedDate(item) && (\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">회계상 입고일:</span>\n                                <div className=\"mt-1\">\n                                  <div className=\"modal-subtitle text-blue-700\">\n                                    {new Date(statementReceivedAction.getCompletedDate(item)).toLocaleDateString('ko-KR', {\n                                      year: 'numeric',\n                                      month: '2-digit',\n                                      day: '2-digit'\n                                    })}\n                                  </div>\n                                </div>\n                              </div>\n                            )}\n                            {/* 모바일에서 처리자 표시 - 전체항목 탭에서만 */}\n                            {!isEditing && activeTab === 'done' && statementReceivedAction.getCompletedByName(item) && (\n                              <div>\n                                <span className=\"text-gray-500 text-xs\">처리자:</span>\n                                <div className=\"mt-1\">\n                                  <div className=\"modal-subtitle text-gray-600\">\n                                    {statementReceivedAction.getCompletedByName(item)}\n                                  </div>\n                                </div>\n                              </div>\n                            )}\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                </div>\n                \n                {/* 합계 */}\n                <div className=\"bg-gray-50 px-2 sm:px-3 border-t border-gray-100\">\n                  <div className=\"hidden sm:grid items-center gap-3 py-0.5\" style={{\n                    gridTemplateColumns: getGridTemplateColumns()\n                  }}>\n                    {/* 품목명 */}\n                    <div></div>\n                    {/* 규격 */}\n                    <div></div>\n                    {/* 수량 */}\n                    <div></div>\n                    {/* 단가 */}\n                    <div className=\"text-right\">\n                      <span className=\"text-[12px] font-bold text-gray-900\">총액</span>\n                    </div>\n                    {/* 합계 */}\n                    <div className=\"text-right\">\n                      <span className=\"text-[12px] font-bold text-gray-900\">\n                        ₩{formatCurrency(\n                          (isEditing ? editedItems : purchase.items)?.reduce((sum, item) => sum + (item.amount_value || 0), 0) || 0\n                        )}\n                      </span>\n                    </div>\n                    {/* 나머지 칼럼들 */}\n                    <div></div>\n                    <div></div>\n                    {activeTab === 'receipt' && <div></div>}\n                  </div>\n                  \n                  {/* Mobile 총액 */}\n                  <div className=\"block sm:hidden py-0.5\">\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-[13px] font-bold text-gray-900\">총액</span>\n                      <span className=\"text-[13px] font-bold text-gray-900\">\n                        ₩{formatCurrency(\n                          (isEditing ? editedItems : purchase.items)?.reduce((sum, item) => sum + (item.amount_value || 0), 0) || 0\n                        )}\n                      </span>\n                    </div>\n                  </div>\n                </div>\n                \n                {/* 항목 추가 버튼 */}\n                {isEditing && (\n                  <div className=\"p-2 sm:p-3 border-t border-gray-100\">\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={handleAddItem}\n                      className=\"w-full rounded-lg border-dashed border-2 border-gray-300 hover:border-gray-400 py-2 badge-text\"\n                    >\n                      <Plus className=\"w-4 h-4 mr-1\" />\n                      항목 추가\n                    </Button>\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n      ) : (\n        <div className=\"text-center py-12\">\n          <span className=\"modal-subtitle\">\n            발주 정보를 불러올 수 없습니다.\n          </span>\n        </div>\n      )}\n    </div>\n  )\n\n  // embedded가 true면 Dialog 없이 내용만 반환\n  if (embedded) {\n    return content\n  }\n\n  // embedded가 false면 Dialog로 감싸서 반환\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent \n        className=\"overflow-hidden bg-white rounded-lg shadow-sm border-0 w-full sm:w-auto max-w-[calc(100vw-48px)] sm:max-w-[calc(100vw-80px)] lg:max-w-[90vw] xl:max-w-[85vw] h-[95vh] sm:h-auto sm:max-h-[90vh] lg:max-h-[85vh] sm:rounded-lg flex flex-col\" \n        showCloseButton={false}\n      >\n        <DialogHeader className=\"sr-only\">\n          <DialogTitle>발주 상세 정보</DialogTitle>\n        </DialogHeader>\n        {/* Apple-style Header */}\n        <div className=\"relative px-3 sm:px-6 pt-0 sm:pt-3 lg:pt-4 pb-0 sm:pb-2 lg:pb-3 flex-shrink-0\">\n          <button\n            onClick={onClose}\n            className=\"button-base button-action-secondary absolute right-3 sm:right-6 top-0 sm:top-3 lg:top-4 w-6 h-6 sm:w-8 sm:h-8 rounded-full\"\n          >\n            <X className=\"w-4 h-4 text-gray-500\" />\n          </button>\n          \n          <div className=\"pr-8 sm:pr-16\">\n            <div className=\"flex items-start gap-4 mb-0 sm:mb-3\">\n              <div className=\"min-w-0 flex-1\">\n                <h1 className=\"page-title mb-0 sm:mb-1\">\n                  발주 기본정보\n                </h1>\n              </div>\n              <div className=\"flex items-center gap-3\">\n                {!isEditing && canEdit && (\n                  <>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => handleEditToggle(true)}\n                      className=\"button-base button-action-secondary\"\n                    >\n                      <Edit2 className=\"w-4 h-4 mr-2\" />\n                      수정\n                    </Button>\n                    {canDelete && onDelete && (\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={() => purchase && onDelete(purchase)}\n                        className=\"button-base button-action-danger\"\n                      >\n                        <Trash2 className=\"w-4 h-4 mr-2\" />\n                        삭제\n                      </Button>\n                    )}\n                  </>\n                )}\n                {isEditing && (\n                  <>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => {\n                        handleEditToggle(false)\n                        setEditedPurchase(purchase)\n                        setEditedItems(purchase?.items || [])\n                        setDeletedItemIds([])\n                      }}\n                      className=\"button-base button-action-secondary\"\n                    >\n                      <X className=\"w-4 h-4 mr-2\" />\n                      취소\n                    </Button>\n                    <Button\n                      size=\"sm\"\n                      onClick={handleSave}\n                      className=\"button-base button-action-primary\"\n                    >\n                      <Save className=\"w-4 h-4 mr-2\" />\n                      저장\n                    </Button>\n                  </>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Apple-style Content */}\n        <div className=\"overflow-y-auto flex-1 px-3 sm:px-6 pb-1 sm:pb-6 mt-0\">\n          {content}\n        </div>\n      </DialogContent>\n      \n    </Dialog>\n  )\n}\n\nexport default memo(PurchaseDetailModal)"],"names":["Truck","createLucideIcon","d","key","cx","cy","r","PurchaseDetailModal$1","memo","purchaseId","isOpen","onClose","embedded","currentUserRoles","activeTab","onRefresh","onOptimisticUpdate","onDelete","loading","setLoading","useState","purchase","setPurchase","isEditing","setIsEditing","editedPurchase","setEditedPurchase","editedItems","setEditedItems","deletedItemIds","setDeletedItemIds","userRoles","setUserRoles","currentUserName","setCurrentUserName","columnWidths","setColumnWidths","tableMinWidth","useMemo","length","columnGap","padding","total","reduce","sum","width","Math","max","baseColumns","push","headerRowRef","useRef","supabase","createClient","useEffect","async","supabaseUrl","includes","logger","warn","data","user","auth","getUser","employeeData","from","select","eq","id","maybeSingle","email","employeeByEmail","name","purchase_role","roles","Array","isArray","map","String","trim","split","filter","error","loadUserRoles","effectiveRoles","canEdit","canDelete","final_manager_status","requester_name","canPurchase","canReceiveItems","isAdmin","isRequester","canReceiptCheck","refreshModalData","useCallback","single","sortedItems","purchase_request_items","sort","a","b","line_number","purchaseData","items","vendor","vendors","vendor_name","vendor_contacts","debug","isInitialLoad","setIsInitialLoad","purchaseIdNumber","Number","NaN","handleActualReceiptOptimisticUpdate","itemId","selectedDate","action","itemIdStr","nowIso","Date","toISOString","selectedDateIso","updateItems","item","is_received","actual_received_date","received_at","prev","updatedItems","completed","allReceived","prevItems","isNaN","prevPurchase","handleStatementReceivedOptimisticUpdate","nextAllCompleted","nextStatementAt","is_statement_received","statement_received_date","statement_received_by_name","every","statement_received_at","allCompleted","update","then","statementReceivedAction","useConfirmDateAction","config","field","confirmMessage","confirm","cancel","successMessage","completedText","waitingText","canPerformAction","onUpdate","actualReceivedAction","requesterName","canApproveMiddle","canApproveFinal","approvalButtonClass","approvalWaitingPillClass","middleManagerStatus","middle_manager_status","finalManagerStatus","loadPurchaseDetail","toString","calculateOptimalColumnWidths","columnConfigs","minWidth","maxWidth","baseWidth","calculatedWidths","index","maxLength","headers","baseHeaders","getHeaders","forEach","cellValue","item_name","specification","quantity","unit_price_value","toLocaleString","amount_value","remark","getStatusDisplay","formatDate","is_utk_checked","adjustedLength","acc","char","test","ceil","calculatedWidth","min","range","is_payment_completed","getGridTemplateColumns","join","handleEditToggle","editing","toast","formatCurrency","amount","Intl","NumberFormat","format","handleItemChange","value","newItems","unitPrice","handleRemoveItem","_","i","handlePaymentToggle","isCompleted","numericId","targetItem","find","itemInfo","unit","window","payment_completed_at","payment_completed_by_name","success","refreshResult","silent","Promise","handleApprove","type","approvalType","purchase_order_number","updateData","content","jsx","className","children","jsxs","payment_category","category","Badge","variant","getStatusBadge","Calendar","request_date","Button","size","onClick","Check","X","FileText","Input","request_type","onChange","e","target","placeholder","DatePickerPopover","onDateSelect","date","delivery_request_date","formatDateInput","align","side","revised_delivery_request_date","Building2","contact_name","updatedContacts","project_vendor","project_item","order_number","Package","Fragment","CreditCard","applyOptimisticUpdate","is","formattedDate","toLocaleDateString","year","month","day","CheckCircle","style","ref","gridTemplateColumns","Trash2","handleCancel","handleConfirm","getCompletedDate","title","getCompletedByName","isChecked","checked","allChecked","updateError","handleUtkToggle","toLocaleTimeString","hour","minute","newItem","lineNum","Plus","Dialog","open","onOpenChange","DialogContent","showCloseButton","DialogHeader","DialogTitle","Edit2","editedItemsCount","deletedItemsCount","totalAmount","total_amount","updated_at","deleteError","delete","in","count","itemName","Error","unit_price_currency","currency","amount_currency","insertData","purchase_request_id","indexOf","created_at","insert","errorMessage","message","Save"],"mappings":"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","x_google_ignoreList":[0]}