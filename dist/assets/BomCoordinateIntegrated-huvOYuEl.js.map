{"version":3,"file":"BomCoordinateIntegrated-huvOYuEl.js","sources":["../../node_modules/lucide-react/dist/esm/icons/link-2.js","../../src/components/ui/tabs.tsx","../../src/utils/excel-generator.ts","../../src/components/bom-coordinate/GeneratedPreviewPanel.tsx","../../src/components/bom-coordinate/CoordinatePreviewPanel.tsx","../../src/components/bom-coordinate/BomDetailModal.tsx","../../src/utils/v7-generator.ts","../../src/components/bom-coordinate/BomCoordinateIntegrated.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M9 17H7A5 5 0 0 1 7 7h2\", key: \"8i5ue5\" }],\n  [\"path\", { d: \"M15 7h2a5 5 0 1 1 0 10h-2\", key: \"1b9ql8\" }],\n  [\"line\", { x1: \"8\", x2: \"16\", y1: \"12\", y2: \"12\", key: \"1jonct\" }]\n];\nconst Link2 = createLucideIcon(\"link-2\", __iconNode);\n\nexport { __iconNode, Link2 as default };\n//# sourceMappingURL=link-2.js.map\n","import * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\n\nconst TabsContext = React.createContext<{\n  value: string\n  onValueChange: (value: string) => void\n} | null>(null)\n\nconst Tabs = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & {\n    defaultValue?: string\n    value?: string\n    onValueChange?: (value: string) => void\n  }\n>(({ className, defaultValue, value: controlledValue, onValueChange, ...props }, ref) => {\n  const [uncontrolledValue, setUncontrolledValue] = React.useState(defaultValue || \"\")\n  const value = controlledValue !== undefined ? controlledValue : uncontrolledValue\n  \n  const handleValueChange = React.useCallback(\n    (newValue: string) => {\n      if (onValueChange) {\n        onValueChange(newValue)\n      } else {\n        setUncontrolledValue(newValue)\n      }\n    },\n    [onValueChange]\n  )\n\n  return (\n    <TabsContext.Provider value={{ value, onValueChange: handleValueChange }}>\n      <div ref={ref} className={cn(\"\", className)} {...props} />\n    </TabsContext.Provider>\n  )\n})\nTabs.displayName = \"Tabs\"\n\nconst TabsList = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n      {...props}\n    />\n))\nTabsList.displayName = \"TabsList\"\n\nconst TabsTrigger = React.forwardRef<\n  HTMLButtonElement,\n  React.ButtonHTMLAttributes<HTMLButtonElement> & { value: string }\n>(({ className, value, onClick, ...props }, ref) => {\n  const context = React.useContext(TabsContext)\n  if (!context) throw new Error(\"TabsTrigger must be used within a Tabs component\")\n\n  const isActive = context.value === value\n\n  return (\n    <button\n      ref={ref}\n      type=\"button\"\n      role=\"tab\"\n      aria-selected={isActive}\n      data-state={isActive ? \"active\" : \"inactive\"}\n      className={cn(\n        \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n        className\n      )}\n      onClick={(e) => {\n        context.onValueChange(value)\n        onClick?.(e)\n      }}\n      {...props}\n    />\n  )\n})\nTabsTrigger.displayName = \"TabsTrigger\"\n\nconst TabsContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & { value: string }\n>(({ className, value, ...props }, ref) => {\n  const context = React.useContext(TabsContext)\n  if (!context) throw new Error(\"TabsContent must be used within a Tabs component\")\n\n  if (context.value !== value) return null\n\n  return (\n    <div\n      ref={ref}\n      role=\"tabpanel\"\n      className={cn(\n        \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nTabsContent.displayName = \"TabsContent\"\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","/**\n * BOM 템플릿 기반 엑셀 생성기\n * \n * BOM_Template.xlsx를 기반으로 정리된 BOM 데이터를 채워서 생성\n * \n * === BOM 시트 구조 ===\n * A2: Artwork 담당자\n * C2: 생산 담당자\n * H3: 품번 (보드명)\n * A7: \"보드명  |  SET : 수량\"\n * Row 8~: BOM 데이터\n *   - A: 번호 (1, 2, 3...)\n *   - B: 종류\n *   - C: 품명\n *   - D: SET\n *   - E: 수량 (생산수량 × SET)\n *   - H: Ref\n *   - J: 비고\n */\n\nimport ExcelJS from 'exceljs';\nimport type { BOMItem, CoordinateItem } from './v7-generator';\n\n// ============================================================\n// 타입 정의\n// ============================================================\n\nexport interface ExcelMetadata {\n  boardName: string;\n  artworkManager: string;\n  productionManager: string;\n  productionQuantity: number;\n}\n\n// ============================================================\n// 메인 함수: 템플릿 기반 엑셀 생성\n// ============================================================\n\nexport async function generateBOMExcelFromTemplate(\n  bomItems: BOMItem[],\n  topCoordinates: CoordinateItem[],\n  bottomCoordinates: CoordinateItem[],\n  metadata: ExcelMetadata\n): Promise<Blob> {\n  const workbook = new ExcelJS.Workbook();\n  \n  try {\n    // 템플릿 로드\n    const response = await fetch('/templates/BOM_Template.xlsx');\n    if (!response.ok) {\n      throw new Error('템플릿 파일을 찾을 수 없습니다.');\n    }\n    \n      const buffer = await response.arrayBuffer();\n      await workbook.xlsx.load(buffer);\n    console.log('✅ 템플릿 로드 완료');\n    \n  } catch (error) {\n    console.error('템플릿 로드 실패:', error);\n    throw new Error('템플릿 파일 로드에 실패했습니다.');\n  }\n\n  // 워크북 메타데이터\n  workbook.creator = 'HANSL BOM System';\n  workbook.modified = new Date();\n\n  // BOM 시트 채우기\n  fillBOMSheet(workbook, bomItems, metadata);\n\n  // 좌표 시트 채우기\n  fillCoordinateSheet(workbook, 'TOP', topCoordinates);\n  fillCoordinateSheet(workbook, 'BOTTOM', bottomCoordinates);\n\n  // Blob으로 반환\n  const outBuffer = await workbook.xlsx.writeBuffer();\n  return new Blob([outBuffer], { \n    type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' \n  });\n}\n\n// ============================================================\n// BOM 시트 채우기\n// ============================================================\n\nfunction fillBOMSheet(\n  workbook: ExcelJS.Workbook, \n  bomItems: BOMItem[], \n  metadata: ExcelMetadata\n) {\n  // 첫 번째 시트 (BOM 시트)\n  const bomSheet = workbook.worksheets[0];\n  if (!bomSheet) {\n    throw new Error('BOM 시트를 찾을 수 없습니다.');\n  }\n\n  // 보드명에서 _정리본 및 날짜 패턴(_YYMMDD) 제거 (엑셀 내부에는 제외)\n  // 순서 중요: 복합 패턴 먼저 제거\n  const cleanBoardName = (metadata.boardName || '')\n    .trim()\n    .replace(/_\\d{6}_정리본$/, '')      // _YYMMDD_정리본 형식 먼저 제거\n    .replace(/_정리본$/, '')            // _정리본 제거\n    .replace(/_\\d{6}$/, '');            // _YYMMDD 형식 제거 (예: _250722)\n  \n  // 시트 이름 변경 (보드명, 31자 제한)\n  if (cleanBoardName) {\n    bomSheet.name = cleanBoardName.substring(0, 31);\n  }\n\n  // === 상단 정보 ===\n  // A2: Artwork 담당자\n  bomSheet.getCell('A2').value = metadata.artworkManager || '';\n  \n  // C2: 생산 담당자\n  bomSheet.getCell('C2').value = metadata.productionManager || '';\n  \n  // H3: 품번 (보드명, _정리본 제외)\n  bomSheet.getCell('H3').value = cleanBoardName;\n  \n  // H5: 보드명 + 부품리스트\n  bomSheet.getCell('H5').value = `${cleanBoardName} 부품리스트`;\n\n  // === A7: 보드명 | SET : 수량 (A7~J7 병합, _정리본 제외) ===\n  bomSheet.mergeCells('A7:J7');\n  const infoCell = bomSheet.getCell('A7');\n  infoCell.value = `${cleanBoardName}  |  SET : ${metadata.productionQuantity}`;\n  infoCell.alignment = { horizontal: 'center', vertical: 'middle' };\n  infoCell.font = { bold: true };\n\n  // === Row 8~: BOM 데이터 ===\n  const dataStartRow = 8;\n  \n  // 테두리 스타일\n  const border: Partial<ExcelJS.Borders> = {\n    top: { style: 'thin' },\n    left: { style: 'thin' },\n    bottom: { style: 'thin' },\n    right: { style: 'thin' },\n  };\n  \n  // 이전 종류 추적 (같은 종류가 연속이면 빈칸 처리)\n  let prevItemType = '';\n\n  bomItems.forEach((item, index) => {\n    const rowNum = dataStartRow + index;\n    const row = bomSheet.getRow(rowNum);\n    \n    // A: 번호 (1, 2, 3...)\n    row.getCell('A').value = index + 1;\n    \n    // B: 종류 (같은 종류가 연속이면 첫 번째만 표시, 나머지는 빈칸)\n    const currentType = item.itemType || '';\n    if (currentType !== prevItemType) {\n      row.getCell('B').value = currentType;\n      prevItemType = currentType;\n    } else {\n      row.getCell('B').value = ''; // 빈칸\n    }\n    \n    // C: 품명\n    row.getCell('C').value = item.itemName || '';\n    \n    // D: SET\n    row.getCell('D').value = item.setCount || 0;\n    \n    // 미삽 여부 확인 \n    // 1. remark에 '미삽'이 있거나\n    // 2. 품명에 _OPEN, OPEN_, _POGO, POGO_, _PAD, PAD_, _NC, NC_ 등 키워드가 _로 구분되어 포함된 경우\n    const itemNameUpper = (item.itemName || '').toUpperCase();\n    const remarkUpper = (item.remark || '').toUpperCase();\n    const isMisap = remarkUpper.includes('미삽') || \n      itemNameUpper.includes('_OPEN') || itemNameUpper.includes('OPEN_') ||\n      itemNameUpper.includes('_POGO') || itemNameUpper.includes('POGO_') ||\n      itemNameUpper.includes('_PAD') || itemNameUpper.includes('PAD_') ||\n      itemNameUpper.includes('_NC') || itemNameUpper.includes('NC_');\n    \n    // E: 수량 (미삽이면 0, 아니면 생산수량 × SET)\n    const setCount = item.setCount || 0;\n    row.getCell('E').value = isMisap ? 0 : metadata.productionQuantity * setCount;\n    \n    // F: 비움 (재고)\n    \n    // G: CHECK\n    row.getCell('G').value = '□양호 □불량';\n    \n    // H: Ref\n    row.getCell('H').value = item.refList || '';\n    \n    // I: 비움 (대체품)\n    \n    // J: 비고 (미삽이면 '미삽' 표시)\n    row.getCell('J').value = isMisap ? '미삽' : (item.remark || '');\n\n    // 데이터가 있는 모든 셀에 테두리 및 스타일 적용 (A~J열)\n    // 중앙 정렬 열: A(1), D(4), E(5), G(7), J(10)\n    const centerAlignCols = [1, 4, 5, 7, 10];\n    \n    // 기본 폰트 (theme 색상 제거하고 argb 직접 지정)\n    const baseFont: Partial<ExcelJS.Font> = {\n      size: 11,\n      name: '굴림체',\n      family: 3,\n      charset: 129,\n      color: isMisap ? { argb: 'FFFF0000' } : { argb: 'FF000000' },\n    };\n    \n    // 다음 행의 종류 확인 (B열 테두리 조정용)\n    const nextItemType = index < bomItems.length - 1 ? (bomItems[index + 1].itemType || '') : '';\n    const isLastOfGroup = currentType !== nextItemType; // 같은 종류 그룹의 마지막 행인지\n    const isFirstOfGroup = currentType !== (index > 0 ? (bomItems[index - 1].itemType || '') : ''); // 같은 종류 그룹의 첫 행인지\n    \n    for (let col = 1; col <= 10; col++) {\n      const cell = row.getCell(col);\n      \n      // B열(col 2)은 같은 종류 그룹 내에서 중간 테두리 제거\n      let cellBorder = border;\n      if (col === 2) {\n        cellBorder = {\n                left: { style: 'thin' },\n          right: { style: 'thin' },\n          top: isFirstOfGroup ? { style: 'thin' } : undefined,\n          bottom: isLastOfGroup ? { style: 'thin' } : undefined,\n        };\n      }\n      \n      // style 객체 전체를 새로 할당 (템플릿 스타일 완전 덮어쓰기)\n      cell.style = {\n        font: baseFont,\n        border: cellBorder,\n        alignment: {\n          vertical: 'middle',\n          horizontal: centerAlignCols.includes(col) ? 'center' : 'left',\n          wrapText: true,\n        },\n      };\n    }\n    \n    // H열(Ref)은 특히 줄바꿈이 필요하므로 행 높이 자동 조정\n    const refText = item.refList || '';\n    const refLength = refText.length;\n    if (refLength > 50) {\n      // Ref 텍스트가 길면 행 높이 자동 증가 (대략적 계산)\n      const estimatedLines = Math.ceil(refLength / 50);\n      row.height = Math.max(15, estimatedLines * 15);\n            }\n    \n    row.commit();\n  });\n}\n\n// ============================================================\n// 좌표 시트 채우기\n// ============================================================\n\nfunction fillCoordinateSheet(\n  workbook: ExcelJS.Workbook,\n  sheetName: 'TOP' | 'BOTTOM',\n  coordinates: CoordinateItem[]\n) {\n  if (coordinates.length === 0) return;\n\n  // 시트 가져오기\n  const sheet = workbook.getWorksheet(sheetName);\n  if (!sheet) {\n    console.warn(`${sheetName} 시트를 찾을 수 없습니다.`);\n    return;\n  }\n\n  // Row 2부터 데이터 입력 (Row 1은 헤더)\n  // 연속된 동일 종류는 첫 번째만 표시\n  let prevType = '';\n  \n  coordinates.forEach((coord, index) => {\n    const row = sheet.getRow(2 + index);\n    \n    const currentType = coord.type || '';\n    const nextType = index < coordinates.length - 1 ? (coordinates[index + 1].type || '') : '';\n    const isFirstOfGroup = currentType !== prevType; // 종류 그룹 첫 행\n    const isLastRow = index === coordinates.length - 1; // 마지막 데이터 행\n    \n    // 같은 종류가 연속이면 빈칸, 아니면 표시\n    if (isFirstOfGroup) {\n      row.getCell('A').value = currentType;\n      prevType = currentType;\n    } else {\n      row.getCell('A').value = '';\n    }\n    \n    row.getCell('B').value = coord.partName || '';    // Type (품명)\n    row.getCell('C').value = coord.refDes || '';      // RefDes\n    row.getCell('D').value = coord.layer || sheetName; // Layer\n    row.getCell('E').value = coord.locationX || 0;    // LocationX\n    row.getCell('F').value = coord.locationY || 0;    // LocationY\n    row.getCell('G').value = coord.rotation || 0;     // Rotation\n    row.getCell('H').value = coord.remark || '';      // 비고\n\n    // 미삽 여부 확인 (BOM과 동일한 조건)\n    const partNameUpper = (coord.partName || '').toUpperCase();\n    const coordRemarkUpper = (coord.remark || '').toUpperCase();\n    const isCoordMisap = coordRemarkUpper.includes('미삽') || \n      partNameUpper.includes('_OPEN') || partNameUpper.includes('OPEN_') ||\n      partNameUpper.includes('_POGO') || partNameUpper.includes('POGO_') ||\n      partNameUpper.includes('_PAD') || partNameUpper.includes('PAD_') ||\n      partNameUpper.includes('_NC') || partNameUpper.includes('NC_');\n\n    // 테두리 및 스타일 설정\n    for (let col = 1; col <= 8; col++) {\n      const cell = row.getCell(col);\n      cell.style = {\n        font: { \n          size: 10, \n          name: '굴림체',\n          color: isCoordMisap ? { argb: 'FFFF0000' } : { argb: 'FF000000' },\n        },\n        alignment: { vertical: 'middle', horizontal: col <= 2 ? 'left' : 'center' },\n        border: {\n          top: isFirstOfGroup ? { style: 'thick' } : undefined,\n          bottom: isLastRow ? { style: 'thick' } : undefined,\n          left: undefined,\n          right: undefined,\n        },\n      };\n    }\n\n    row.commit();\n  });\n}\n\n// ============================================================\n// 파일 다운로드 헬퍼\n// ============================================================\n\nexport async function downloadExcelBlob(blob: Blob, filename: string) {\n  // showSaveFilePicker API 지원 여부 확인 (Chrome/Edge에서만 지원)\n  if ('showSaveFilePicker' in window) {\n    try {\n      const handle = await (window as any).showSaveFilePicker({\n        suggestedName: filename,\n        types: [{\n          description: 'Excel 파일',\n          accept: { 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet': ['.xlsx'] },\n        }],\n      });\n      const writable = await handle.createWritable();\n      await writable.write(blob);\n      await writable.close();\n      return;\n    } catch (err: any) {\n      // 사용자가 취소한 경우\n      if (err.name === 'AbortError') {\n        return;\n      }\n      // 다른 오류면 fallback으로 진행\n      console.warn('showSaveFilePicker 실패, fallback 사용:', err);\n    }\n  }\n  \n  // Fallback: 기존 방식 (바로 다운로드)\n  const url = URL.createObjectURL(blob);\n  const link = document.createElement('a');\n  link.href = url;\n  link.download = filename;\n  document.body.appendChild(link);\n  link.click();\n  document.body.removeChild(link);\n  URL.revokeObjectURL(url);\n}\n","import { useState, useEffect, forwardRef, useImperativeHandle, useRef, useLayoutEffect } from 'react';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { Badge } from '@/components/ui/badge';\nimport { AlertTriangle, Plus } from 'lucide-react';\nimport { \n  generateBOMExcelFromTemplate, \n  downloadExcelBlob,\n  type ExcelMetadata \n} from '@/utils/excel-generator';\nimport { type BOMItem, type CoordinateItem } from '@/utils/v7-generator';\nimport { toast } from 'sonner';\n\ninterface GeneratedPreviewPanelProps {\n  bomItems: BOMItem[];\n  coordinates: CoordinateItem[];\n  boardName: string;\n  productionQuantity: number;\n  artworkManager?: string;       // Artwork 담당자\n  productionManager?: string;    // 생산 담당자\n  onSave: (items: BOMItem[]) => void;\n  onMergeStateChange?: (isMerged: boolean) => void;\n  onBomChange?: (items: BOMItem[]) => void;  // BOM 수정 시 콜백 (좌표 동기화용)\n}\n\nexport interface GeneratedPreviewPanelRef {\n  handleDownload: () => Promise<void>;\n  handleSave: () => void;\n  handleReset: () => void;\n  handleMerge: () => void;\n  isMerged: () => boolean;\n}\n\nconst GeneratedPreviewPanel = forwardRef<GeneratedPreviewPanelRef, GeneratedPreviewPanelProps>(({ \n  bomItems: initialItems, \n  coordinates, \n  boardName,\n  productionQuantity,\n  artworkManager = '',\n  productionManager = '',\n  onSave,\n  onMergeStateChange,\n  onBomChange\n}, ref) => {\n  const [items, setItems] = useState<BOMItem[]>(initialItems);\n  const [beforeMergeItems, setBeforeMergeItems] = useState<BOMItem[] | null>(null); // 합치기 전 상태 저장\n  const textareaRefs = useRef<{ [key: string]: HTMLTextAreaElement | null }>({});\n  \n  // initialItems가 변경되면 items 업데이트\n  useEffect(() => {\n    setItems(initialItems);\n  }, [initialItems]);\n\n  // textarea 높이 자동 조정\n  useLayoutEffect(() => {\n    Object.values(textareaRefs.current).forEach(textarea => {\n      if (textarea) {\n        textarea.style.height = 'auto';\n        const newHeight = Math.max(24, textarea.scrollHeight);\n        textarea.style.height = newHeight + 'px';\n      }\n    });\n  }, [items]);\n  \n  // 통계 계산\n  const manualRequiredCount = items.filter(i => i.isManualRequired).length;\n  const newPartCount = items.filter(i => i.isNewPart).length;\n  const misapCount = items.filter(i => i.remark === '미삽').length;\n  const totalSetCount = items.reduce((sum, item) => sum + (item.setCount || 0), 0);\n  \n  // 캔버스로 텍스트 실제 너비 측정\n  const measureTextWidth = (text: string, fontSize: number = 10): number => {\n    const canvas = document.createElement('canvas');\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return text.length * 10;\n    ctx.font = `${fontSize}px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif`;\n    return Math.ceil(ctx.measureText(text).width);\n  };\n  \n  // 종류, 품명 컬럼 너비 계산 (실제 텍스트 기준 + 충분한 여유분)\n  const maxTypeWidth = Math.max(\n    ...items.map(i => measureTextWidth(i.itemType || '', 10)),\n    measureTextWidth('종류', 10),\n    50\n  ) + 30; // 여유분 추가\n  \n  const maxNameWidth = Math.max(\n    ...items.map(i => measureTextWidth(i.itemName || '', 10)),\n    measureTextWidth('품명', 10),\n    100\n  ) + 40; // 여유분 추가\n  \n  // 엑셀 다운로드 핸들러\n  const handleDownload = async () => {\n    try {\n      console.log('Starting download with:', { \n        itemsCount: items.length, \n        coordsCount: coordinates.length, \n        boardName \n      });\n      \n      // 데이터 검증\n      if (!items || items.length === 0) {\n        throw new Error('BOM 데이터가 없습니다. 데이터를 확인해주세요.');\n      }\n      \n      if (!boardName || boardName.trim() === '') {\n        throw new Error('보드 이름이 설정되지 않았습니다.');\n      }\n      \n      // 수동 확인 필요 항목 체크\n      const unfilledItems = items.filter(item => \n        item.isManualRequired && \n        (item.itemName === '데이터 없음 (수동 확인 필요)' || item.itemType === '데이터 없음')\n      );\n      \n      if (unfilledItems.length > 0) {\n        const confirm = window.confirm(\n          `수동 확인이 필요한 항목이 ${unfilledItems.length}개 있습니다.\\n` +\n          '그대로 다운로드하시겠습니까?\\n\\n' +\n          '(해당 항목들은 \"데이터 없음\"으로 표시됩니다)'\n        );\n        if (!confirm) return;\n      }\n\n      // Excel 생성\n      const excelMetadata: ExcelMetadata = {\n        boardName,\n        artworkManager,\n        productionManager,\n        productionQuantity\n      };\n\n      // TOP/BOTTOM 분리\n      const topCoords = coordinates.filter(c => c.layer === 'TOP');\n      const bottomCoords = coordinates.filter(c => c.layer === 'BOTTOM');\n\n      const blob = await generateBOMExcelFromTemplate(\n        items,\n        topCoords,\n        bottomCoords,\n        excelMetadata\n      );\n      \n      console.log('Blob generated:', { size: blob.size, type: blob.type });\n      \n      if (!blob || blob.size === 0) {\n        throw new Error('엑셀 파일 생성에 실패했습니다. (빈 파일)');\n      }\n      \n      // 파일명: 보드명_YYMMDD_정리본.xlsx\n      const today = new Date();\n      const dateStr = today.getFullYear().toString().slice(2) + \n        String(today.getMonth() + 1).padStart(2, '0') + \n        String(today.getDate()).padStart(2, '0');\n      // 순서 중요: 복합 패턴 먼저 제거\n      const cleanName = boardName.trim()\n        .replace(/_\\d{6}_정리본$/, '')\n        .replace(/_정리본$/, '')\n        .replace(/_\\d{6}$/, '');\n      downloadExcelBlob(blob, `${cleanName}_${dateStr}_정리본.xlsx`);\n      toast.success('엑셀 파일이 다운로드되었습니다.');\n    } catch (error) {\n      console.error('Download error details:', error);\n      let errorMessage = '알 수 없는 오류';\n      \n      if (error instanceof Error) {\n        errorMessage = error.message;\n      }\n      \n      toast.error(`다운로드 중 오류가 발생했습니다: ${errorMessage}`);\n    }\n  };\n\n  // 초기화 핸들러\n  const handleReset = () => {\n    if (confirm('모든 수정사항을 초기화하시겠습니까?')) {\n      setItems(initialItems);\n    }\n  };\n\n  // 동일 항목 합치기 핸들러\n  const handleMerge = () => {\n    // 이미 합친 상태면 해제\n    if (beforeMergeItems) {\n      setItems(beforeMergeItems);\n      setBeforeMergeItems(null);\n      onMergeStateChange?.(false);\n      toast.success('합치기가 해제되었습니다.');\n      return;\n    }\n    \n    // 종류+품명 기준으로 그룹핑\n    const grouped = new Map<string, BOMItem[]>();\n    \n    items.forEach(item => {\n      // \"데이터 없음\" 항목은 합치지 않음\n      if (item.itemName.includes('데이터 없음') || item.itemType === '데이터 없음') {\n        const uniqueKey = `__unique__${item.lineNumber}`;\n        grouped.set(uniqueKey, [item]);\n        return;\n      }\n      \n      const key = `${item.itemType}|${item.itemName}`;\n      if (!grouped.has(key)) {\n        grouped.set(key, []);\n      }\n      grouped.get(key)!.push(item);\n    });\n    \n    // 합칠 항목이 있는지 확인\n    let mergeCount = 0;\n    grouped.forEach(groupItems => {\n      if (groupItems.length > 1) mergeCount++;\n    });\n    \n    if (mergeCount === 0) {\n      toast.info('합칠 수 있는 동일 항목이 없습니다.');\n      return;\n    }\n    \n    if (!confirm(`동일한 종류+품명 항목 ${mergeCount}건을 합치시겠습니까?`)) {\n      return;\n    }\n    \n    // 합치기 전 상태 저장\n    setBeforeMergeItems([...items]);\n    \n    // 합치기 실행\n    const mergedItems: BOMItem[] = [];\n    let lineNumber = 1;\n    \n    grouped.forEach(groupItems => {\n      if (groupItems.length === 1) {\n        // 단일 항목\n        mergedItems.push({ ...groupItems[0], lineNumber: lineNumber++ });\n      } else {\n        // 합치기\n        const first = groupItems[0];\n        const mergedRefs = groupItems.map(i => i.refList).join(', ');\n        const mergedSetCount = groupItems.reduce((sum, i) => sum + (i.setCount || 0), 0);\n        const mergedTotalQty = groupItems.reduce((sum, i) => sum + (i.totalQuantity || 0), 0);\n        \n        mergedItems.push({\n          ...first,\n          lineNumber: lineNumber++,\n          refList: mergedRefs,\n          setCount: mergedSetCount,\n          totalQuantity: mergedTotalQty,\n        });\n      }\n    });\n    \n    setItems(mergedItems);\n    onMergeStateChange?.(true);\n    toast.success(`${mergeCount}건의 동일 항목이 합쳐졌습니다.`);\n  };\n\n  // 저장 핸들러 (DB 업데이트용)\n  const handleSave = () => {\n    onSave(items);\n  };\n\n  // 부모에서 호출 가능하도록 메서드 노출\n  useImperativeHandle(ref, () => ({\n    handleDownload,\n    handleSave,\n    handleReset,\n    handleMerge,\n    isMerged: () => beforeMergeItems !== null\n  }));\n\n  // 데이터 수정 핸들러\n  const handleCellChange = (index: number, field: keyof BOMItem, value: string) => {\n    const newItems = [...items];\n    const item = { ...newItems[index] };\n    \n    // 숫자 필드 처리\n    if (field === 'setCount' || field === 'totalQuantity' || field === 'stockQuantity') {\n      (item as any)[field] = Number(value) || 0;\n    } else if (field === 'refList') {\n      (item as any)[field] = value;\n    } else {\n      (item as any)[field] = value;\n    }\n    \n    // 수동 입력 완료 시 플래그 해제\n    if (field === 'itemName' && value && value !== '데이터 없음 (수동 확인 필요)') {\n      item.isManualRequired = false;\n    }\n    if (field === 'itemType' && value && value !== '데이터 없음') {\n      item.isNewPart = false;\n    }\n    \n    newItems[index] = item;\n    setItems(newItems);\n    \n    // 종류/품명 변경 시 좌표 데이터도 동기화\n    if (field === 'itemType' || field === 'itemName') {\n      onBomChange?.(newItems);\n    }\n  };\n\n  // 행 배경색 결정\n  const getRowClassName = (item: BOMItem) => {\n    if (item.isManualRequired) return 'bg-yellow-50 hover:bg-yellow-100';\n    if (item.isNewPart) return 'bg-red-50 hover:bg-red-100';\n    if (item.remark === '미삽') return 'bg-gray-50 hover:bg-gray-100';\n    return 'hover:bg-gray-50';\n  };\n\n  return (\n    <div className=\"space-y-3\">\n\n      {/* 테이블 */}\n      <div className=\"border rounded-lg overflow-hidden bg-white shadow-sm\">\n        <div className=\"overflow-x-auto\">\n          <Table className=\"table-auto !w-auto\">\n            <TableHeader className=\"bg-gray-50 sticky top-0 z-10\">\n              <TableRow className=\"h-6\">\n                <TableHead className=\"w-[40px] sm:w-[50px] text-center !h-auto !py-0.5 !px-2\">\n                  <span className=\"card-description\">No</span>\n                </TableHead>\n                <TableHead className=\"text-center whitespace-nowrap !h-auto !py-0.5 !px-2\">\n                  <span className=\"card-description\">종류</span>\n                </TableHead>\n                <TableHead className=\"whitespace-nowrap !h-auto !py-0.5 !px-2\">\n                  <span className=\"card-description\">품명</span>\n                </TableHead>\n                <TableHead className=\"w-[50px] sm:w-[60px] text-center !h-auto !py-0.5 !px-2\">\n                  <span className=\"card-description\">SET</span>\n                </TableHead>\n                <TableHead className=\"w-[60px] sm:w-[80px] text-center !h-auto !py-0.5 !px-2\">\n                  <span className=\"card-description\">수량</span>\n                </TableHead>\n                <TableHead className=\"w-[50px] sm:w-[60px] text-center hidden sm:table-cell !h-auto !py-0.5 !px-2\">\n                  <span className=\"card-description\">재고</span>\n                </TableHead>\n                <TableHead className=\"min-w-[200px] sm:min-w-[300px] !h-auto !py-0.5 !px-2\">\n                  <span className=\"card-description\">REF</span>\n                </TableHead>\n                <TableHead className=\"w-[100px] sm:w-[150px] hidden md:table-cell !h-auto !py-0.5 !px-2\">\n                  <span className=\"card-description\">대체품</span>\n                </TableHead>\n                <TableHead className=\"w-[100px] sm:w-[150px] !h-auto !py-0.5 !px-2\">\n                  <span className=\"card-description\">비고</span>\n                </TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {items.map((item, index) => (\n                <TableRow key={index} className={getRowClassName(item)}>\n                  <TableCell className=\"text-center py-1 px-2\">\n                    <div className=\"card-subtitle\">{index + 1}</div>\n                  </TableCell>\n                  \n                  {/* 종류 */}\n                  <TableCell className=\"text-center py-1 px-1 whitespace-nowrap\">\n                    <input \n                      type=\"text\"\n                      className={`text-[10px] text-gray-600 text-center border border-transparent hover:border-gray-200 focus:border-primary focus:outline-none rounded px-1 ${\n                        item.itemType === '데이터 없음' ? '!text-red-500 font-bold bg-red-50' : 'bg-transparent'\n                      }`}\n                      style={{ fontSize: '10px', height: '24px', width: `${Math.max((item.itemType?.length || 4) * 7 + 16, 50)}px` }}\n                      value={item.itemType || ''}\n                      onChange={(e) => handleCellChange(index, 'itemType', e.target.value)}\n                      placeholder=\"종류\"\n                    />\n                  </TableCell>\n\n                  {/* 품명 */}\n                  <TableCell className=\"py-1 px-1 whitespace-nowrap\">\n                    <input \n                      type=\"text\"\n                      className={`text-[10px] text-gray-500 border border-transparent hover:border-gray-200 focus:border-primary focus:outline-none rounded px-1 ${\n                        item.isManualRequired || item.isNewPart ? 'text-red-600 bg-yellow-50' : 'bg-transparent'\n                      }`}\n                      style={{ fontSize: '10px', height: '24px', width: `${Math.max((item.itemName?.length || 6) * 7 + 16, 80)}px` }}\n                      value={item.itemName}\n                      onChange={(e) => handleCellChange(index, 'itemName', e.target.value)}\n                      placeholder=\"품명 입력\"\n                      title={item.originalFootprint ? `원본: ${item.originalFootprint}` : ''}\n                    />\n                  </TableCell>\n\n                  {/* SET */}\n                  <TableCell className=\"text-center py-1 px-2\">\n                    <input \n                      type=\"number\"\n                      className=\"w-full text-[10px] font-medium text-gray-900 text-center border border-transparent hover:border-gray-200 focus:border-primary focus:outline-none rounded bg-transparent px-1\"\n                      style={{ fontSize: '10px', height: '24px' }}\n                      value={item.setCount}\n                      onChange={(e) => handleCellChange(index, 'setCount', e.target.value)}\n                    />\n                  </TableCell>\n\n                  {/* 수량 */}\n                  <TableCell className=\"text-center py-1 px-2\">\n                    <input \n                      type=\"number\"\n                      className=\"w-full text-[10px] font-bold text-gray-900 text-center border border-transparent hover:border-gray-200 focus:border-primary focus:outline-none rounded bg-gray-50 px-1\"\n                      style={{ fontSize: '10px', height: '24px' }}\n                      value={item.totalQuantity}\n                      readOnly\n                      onChange={(e) => handleCellChange(index, 'totalQuantity', e.target.value)}\n                    />\n                  </TableCell>\n\n                  {/* 재고 */}\n                  <TableCell className=\"hidden sm:table-cell text-center py-1 px-2\">\n                    <input \n                      type=\"number\"\n                      className=\"w-full text-[10px] font-medium text-gray-900 text-center border border-transparent hover:border-gray-200 focus:border-primary focus:outline-none rounded bg-transparent px-1\"\n                      style={{ fontSize: '10px', height: '24px' }}\n                      value={item.stockQuantity || ''}\n                      placeholder=\"0\"\n                      onChange={(e) => handleCellChange(index, 'stockQuantity', e.target.value)}\n                    />\n                  </TableCell>\n\n                  {/* REF */}\n                  <TableCell className=\"px-1 py-1 align-middle\" style={{ width: '300px', maxWidth: '300px' }}>\n                    <div\n                      contentEditable\n                      suppressContentEditableWarning\n                      className=\"text-[10px] text-gray-600 outline-none\"\n                      style={{ \n                        width: '300px',\n                        maxWidth: '300px',\n                        lineHeight: '14px',\n                        wordWrap: 'break-word',\n                        overflowWrap: 'break-word',\n                        whiteSpace: 'pre-wrap'\n                      }}\n                      onBlur={(e) => handleCellChange(index, 'refList', e.currentTarget.textContent || '')}\n                    >\n                      {(item.refList || '').split(',').map(r => r.trim()).filter(r => r).join(', ')}\n                    </div>\n                  </TableCell>\n\n                  {/* 대체품 */}\n                  <TableCell className=\"hidden md:table-cell py-1 px-2\">\n                    <input \n                      type=\"text\"\n                      className=\"w-full text-[10px] text-gray-500 px-1 border border-transparent hover:border-gray-200 focus:border-primary focus:outline-none rounded bg-transparent\"\n                      style={{ fontSize: '10px', height: '24px' }}\n                      value={item.alternativeItem || ''}\n                      onChange={(e) => handleCellChange(index, 'alternativeItem', e.target.value)}\n                    />\n                  </TableCell>\n\n                  {/* 비고 */}\n                  <TableCell className=\"py-1 px-2\">\n                    <input \n                      type=\"text\"\n                      className={`w-full text-[10px] text-gray-500 px-1 border border-transparent hover:border-gray-200 focus:border-primary focus:outline-none rounded ${\n                        item.remark === '미삽' ? '!text-gray-500 font-bold bg-gray-50' : 'bg-transparent'\n                      }`}\n                      style={{ fontSize: '10px', height: '24px' }}\n                      value={item.remark || ''}\n                      onChange={(e) => handleCellChange(index, 'remark', e.target.value)}\n                    />\n                  </TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n            {/* 푸터 - 본문 테이블과 동일한 구조 */}\n            <tfoot className=\"bg-gray-50 border-t\">\n              <tr>\n                {/* No 칼럼 */}\n                <td className=\"py-2 px-2\">\n                  <span className=\"card-description whitespace-nowrap\">총 {items.length}개 항목</span>\n                </td>\n                {/* 종류 */}\n                <td></td>\n                {/* 품명 - 합계 라벨 */}\n                <td className=\"text-right pr-2\">\n                  <span className=\"card-description\">합계:</span>\n                </td>\n                {/* SET - 합계 숫자 */}\n                <td className=\"text-center py-2\">\n                  <span className=\"text-[11px] text-gray-700\">{totalSetCount}</span>\n                </td>\n                {/* 수량 */}\n                <td></td>\n                {/* 재고 */}\n                <td className=\"hidden sm:table-cell\"></td>\n                {/* REF */}\n                <td></td>\n                {/* 대체품 */}\n                <td className=\"hidden md:table-cell\"></td>\n                {/* 비고 + 범례 */}\n                <td className=\"py-2 px-2 text-right\">\n                  <div className=\"flex gap-4 card-description justify-end whitespace-nowrap\">\n                    <span className=\"flex items-center gap-1\">\n                      <span className=\"w-3 h-3 bg-yellow-100 border border-yellow-300 rounded\"></span>\n                      수동 확인\n                    </span>\n                    <span className=\"flex items-center gap-1\">\n                      <span className=\"w-3 h-3 bg-red-50 border border-red-200 rounded\"></span>\n                      미삽\n                    </span>\n                  </div>\n                </td>\n              </tr>\n            </tfoot>\n          </Table>\n        </div>\n      </div>\n    </div>\n  );\n});\n\nGeneratedPreviewPanel.displayName = 'GeneratedPreviewPanel';\n\nexport default GeneratedPreviewPanel;\n","import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { type CoordinateItem } from '@/utils/v7-generator';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\n\ninterface CoordinatePreviewPanelProps {\n  coordinates: CoordinateItem[];\n}\n\nexport default function CoordinatePreviewPanel({ coordinates }: CoordinatePreviewPanelProps) {\n  const topCoords = coordinates.filter(c => c.layer === 'TOP');\n  const bottomCoords = coordinates.filter(c => c.layer === 'BOTTOM');\n\n  return (\n    <div className=\"space-y-3\">\n      <Tabs defaultValue=\"top\" className=\"w-full\">\n        <TabsList className=\"mb-3 grid grid-cols-2 h-8\">\n          <TabsTrigger value=\"top\" className=\"text-[10px] h-7\">\n            TOP\n            <span className=\"ml-1 text-gray-400\">{topCoords.length}</span>\n          </TabsTrigger>\n          <TabsTrigger value=\"bottom\" className=\"text-[10px] h-7\">\n            BOTTOM\n            <span className=\"ml-1 text-gray-400\">{bottomCoords.length}</span>\n          </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"top\" className=\"mt-0\">\n            <CoordinateTable data={topCoords} />\n          </TabsContent>\n          <TabsContent value=\"bottom\" className=\"mt-0\">\n            <CoordinateTable data={bottomCoords} />\n          </TabsContent>\n        </Tabs>\n    </div>\n  );\n}\n\nfunction CoordinateTable({ data }: { data: CoordinateItem[] }) {\n  const totalCount = data.length;\n  \n  return (\n    <div className=\"border rounded-lg overflow-hidden bg-white shadow-sm\">\n      <div className=\"overflow-x-auto\">\n        <Table className=\"table-auto !w-auto\">\n        <TableHeader className=\"bg-gray-50 sticky top-0 z-10\">\n            <TableRow className=\"h-6\">\n              <TableHead className=\"w-[40px] text-center !h-auto !py-0.5 !px-2\">\n                <span className=\"card-description\">No</span>\n              </TableHead>\n              <TableHead className=\"text-center whitespace-nowrap !h-auto !py-0.5 !px-2\">\n                <span className=\"card-description\">종류</span>\n              </TableHead>\n              <TableHead className=\"whitespace-nowrap !h-auto !py-0.5 !px-2\">\n                <span className=\"card-description\">품명</span>\n              </TableHead>\n              <TableHead className=\"w-[80px] text-center !h-auto !py-0.5 !px-2\">\n                <span className=\"card-description\">RefDes</span>\n              </TableHead>\n              <TableHead className=\"w-[60px] text-center !h-auto !py-0.5 !px-2\">\n                <span className=\"card-description\">Layer</span>\n              </TableHead>\n              <TableHead className=\"w-[80px] text-center !h-auto !py-0.5 !px-2\">\n                <span className=\"card-description\">X</span>\n              </TableHead>\n              <TableHead className=\"w-[80px] text-center !h-auto !py-0.5 !px-2\">\n                <span className=\"card-description\">Y</span>\n              </TableHead>\n              <TableHead className=\"w-[60px] text-center !h-auto !py-0.5 !px-2\">\n                <span className=\"card-description\">Angle</span>\n              </TableHead>\n              <TableHead className=\"w-[80px] !h-auto !py-0.5 !px-2\">\n                <span className=\"card-description\">비고</span>\n              </TableHead>\n          </TableRow>\n        </TableHeader>\n        <TableBody>\n          {data.length === 0 ? (\n            <TableRow>\n                <TableCell colSpan={9} className=\"text-center py-6 card-description\">\n                데이터가 없습니다.\n              </TableCell>\n            </TableRow>\n          ) : (\n              data.map((item, index) => {\n                // 연속된 동일 종류는 첫 번째만 표시\n                const prevType = index > 0 ? data[index - 1].type : null;\n                const showType = item.type !== prevType;\n                \n                return (\n                <TableRow \n                  key={index} \n                  className={`hover:bg-gray-50 ${item.remark === '미삽' ? 'bg-gray-50' : ''}`}\n                >\n                  <TableCell className=\"text-center py-1 px-2\">\n                    <span className=\"text-[10px] text-gray-500\">{index + 1}</span>\n                  </TableCell>\n                  <TableCell className=\"text-center py-1 px-1 whitespace-nowrap\">\n                    <span className=\"text-[10px] text-gray-600\">{showType ? (item.type || '-') : ''}</span>\n                  </TableCell>\n                  <TableCell className=\"py-1 px-1 whitespace-nowrap\">\n                    <span className={`text-[10px] ${item.remark === '미삽' ? 'text-gray-400' : 'text-gray-600'}`}>\n                      {item.partName || '-'}\n                    </span>\n                  </TableCell>\n                  <TableCell className=\"text-center py-1 px-2\">\n                    <span className=\"text-[10px] font-medium text-gray-900\">{item.refDes}</span>\n                </TableCell>\n                  <TableCell className=\"text-center py-1 px-2\">\n                    <Badge \n                      variant={item.layer === 'TOP' ? 'default' : 'secondary'} \n                      className=\"text-[9px] px-1.5 py-0 h-4\"\n                    >\n                      {item.layer}\n                  </Badge>\n                </TableCell>\n                  <TableCell className=\"text-center py-1 px-2\">\n                    <span className=\"text-[10px] font-mono text-gray-600\">{item.locationX?.toFixed(2)}</span>\n                  </TableCell>\n                  <TableCell className=\"text-center py-1 px-2\">\n                    <span className=\"text-[10px] font-mono text-gray-600\">{item.locationY?.toFixed(2)}</span>\n                  </TableCell>\n                  <TableCell className=\"text-center py-1 px-2\">\n                    <span className=\"text-[10px] font-mono text-gray-600\">{item.rotation || 0}</span>\n                  </TableCell>\n                  <TableCell className=\"py-1 px-2\">\n                    <span className={`text-[10px] ${item.remark === '미삽' ? 'text-red-500 font-medium' : 'text-gray-500'}`}>\n                      {item.remark || ''}\n                    </span>\n                  </TableCell>\n              </TableRow>\n              )})\n          )}\n        </TableBody>\n          {/* 푸터 */}\n          <tfoot className=\"bg-gray-50 border-t\">\n            <tr>\n              <td colSpan={9} className=\"py-2 px-2\">\n                <div className=\"flex justify-between items-center\">\n                  <span className=\"card-description\">총 {totalCount}개 항목</span>\n                  <div className=\"flex gap-4 card-description\">\n                    <span className=\"flex items-center gap-1\">\n                      <span className=\"w-3 h-3 bg-gray-100 border border-gray-300 rounded\"></span>\n                      미삽\n                    </span>\n                  </div>\n                </div>\n              </td>\n            </tr>\n          </tfoot>\n      </Table>\n      </div>\n    </div>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport { createClient } from '@/lib/supabase/client';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\n// native table 태그 사용 (sticky header 지원을 위해)\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { Loader2, Download } from 'lucide-react';\nimport { toast } from 'sonner';\nimport { \n  generateBOMExcelFromTemplate, \n  downloadExcelBlob,\n  type ExcelMetadata \n} from '@/utils/excel-generator';\nimport { type BOMItem, type CoordinateItem } from '@/utils/v7-generator';\n\ninterface BomDetailModalProps {\n  boardId: string | null;\n  isOpen: boolean;\n  onClose: () => void;\n}\n\ninterface BoardData {\n  id: string;\n  board_name: string;\n  artwork_manager: string;\n  production_manager: string;\n  production_quantity: number;\n  created_at: string;\n  bomItems: BOMItem[];\n  topCoordinates: CoordinateItem[];\n  bottomCoordinates: CoordinateItem[];\n}\n\nexport default function BomDetailModal({ boardId, isOpen, onClose }: BomDetailModalProps) {\n  const [loading, setLoading] = useState(false);\n  const [boardData, setBoardData] = useState<BoardData | null>(null);\n  const [downloading, setDownloading] = useState(false);\n  \n  const supabase = createClient();\n\n  useEffect(() => {\n    if (isOpen && boardId) {\n      loadBoardData();\n    }\n  }, [isOpen, boardId]);\n\n  const loadBoardData = async () => {\n    if (!boardId) return;\n    \n    setLoading(true);\n    try {\n      // 보드 정보 가져오기\n      const { data: board, error: boardError } = await supabase\n        .from('cad_drawings')\n        .select('*')\n        .eq('id', boardId)\n        .single();\n      \n      if (boardError) throw boardError;\n\n      // BOM 항목 가져오기\n      const { data: bomItems, error: bomError } = await supabase\n        .from('bom_items')\n        .select('*')\n        .eq('cad_drawing_id', boardId)\n        .order('line_number');\n      \n      if (bomError) throw bomError;\n\n      // 좌표 데이터 가져오기\n      const { data: coordinates, error: coordError } = await supabase\n        .from('part_placements')\n        .select('*')\n        .eq('cad_drawing_id', boardId);\n      \n      if (coordError) throw coordError;\n\n      // BOM 항목 변환\n      const convertedBOMItems: BOMItem[] = (bomItems || []).map((item: any) => ({\n        lineNumber: item.line_number,\n        itemType: item.item_type || '',\n        itemName: item.item_name || '',\n        setCount: item.set_count || 0,\n        totalQuantity: item.total_quantity || 0,\n        stockQuantity: item.stock_quantity || 0,\n        checkStatus: item.check_status || '',\n        // refList가 배열이면 문자열로 변환\n        refList: Array.isArray(item.ref_list) \n          ? item.ref_list.join(', ') \n          : (item.ref_list || ''),\n        alternativeItem: item.alternative_item || '',\n        remark: item.remark || '',\n        isManualRequired: item.is_manual_required || false,\n        isNewPart: item.is_new_part || false,\n        originalPart: item.original_part || '',\n        originalFootprint: item.original_footprint || '',\n      }));\n\n      // 좌표 변환 (DB 컬럼명과 일치시킴)\n      const topCoords: CoordinateItem[] = [];\n      const bottomCoords: CoordinateItem[] = [];\n      \n      (coordinates || []).forEach((coord: any) => {\n        const coordItem: CoordinateItem = {\n          refDes: coord.ref || '',           // DB: ref\n          type: coord.part_type || '',       // DB: part_type\n          partName: coord.part_name || '',   // DB: part_name\n          layer: coord.side || 'TOP',        // DB: side\n          locationX: coord.x_coordinate || 0, // DB: x_coordinate\n          locationY: coord.y_coordinate || 0, // DB: y_coordinate\n          rotation: coord.angle || 0,        // DB: angle\n          remark: coord.remark || '',\n        };\n        \n        if (coord.side === 'TOP') {\n          topCoords.push(coordItem);\n        } else {\n          bottomCoords.push(coordItem);\n        }\n      });\n\n      setBoardData({\n        id: board.id,\n        board_name: board.board_name,\n        artwork_manager: board.artwork_manager || '',\n        production_manager: board.production_manager || '',\n        production_quantity: board.production_quantity || 0,\n        created_at: board.created_at,\n        bomItems: convertedBOMItems,\n        topCoordinates: topCoords,\n        bottomCoordinates: bottomCoords,\n      });\n    } catch (error) {\n      console.error('Error loading board data:', error);\n      toast.error('데이터를 불러오는데 실패했습니다.');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleDownloadExcel = async () => {\n    if (!boardData) return;\n    \n    setDownloading(true);\n    try {\n      const excelMetadata: ExcelMetadata = {\n        boardName: boardData.board_name,\n        artworkManager: boardData.artwork_manager,\n        productionManager: boardData.production_manager,\n        productionQuantity: boardData.production_quantity,\n      };\n\n      const blob = await generateBOMExcelFromTemplate(\n        boardData.bomItems,\n        boardData.topCoordinates,\n        boardData.bottomCoordinates,\n        excelMetadata\n      );\n\n      // 파일명 생성\n      const today = new Date();\n      const dateStr = today.getFullYear().toString().slice(2) + \n        String(today.getMonth() + 1).padStart(2, '0') + \n        String(today.getDate()).padStart(2, '0');\n      const cleanName = boardData.board_name.trim()\n        .replace(/_\\d{6}_정리본$/, '')\n        .replace(/_정리본$/, '')\n        .replace(/_\\d{6}$/, '');\n      const fileName = `${cleanName}_${dateStr}_정리본.xlsx`;\n\n      await downloadExcelBlob(blob, fileName);\n      toast.success('엑셀 파일이 다운로드되었습니다.');\n    } catch (error) {\n      console.error('Excel download error:', error);\n      toast.error('엑셀 다운로드에 실패했습니다.');\n    } finally {\n      setDownloading(false);\n    }\n  };\n\n  // 미삽 체크 함수 (미리보기와 동일)\n  const checkIsMisap = (itemName: string, remark: string) => {\n    const nameUpper = (itemName || '').toUpperCase();\n    const remarkUpper = (remark || '').toUpperCase();\n    return remarkUpper.includes('미삽') || \n      nameUpper.includes('_OPEN') || nameUpper.includes('OPEN_') ||\n      nameUpper.includes('_POGO') || nameUpper.includes('POGO_') ||\n      nameUpper.includes('_PAD') || nameUpper.includes('PAD_') ||\n      nameUpper.includes('_NC') || nameUpper.includes('NC_');\n  };\n\n  // 보드명 정리\n  const cleanBoardName = (name: string) => {\n    return (name || '').trim()\n      .replace(/_\\d{6}_정리본$/, '')\n      .replace(/_정리본$/, '')\n      .replace(/_\\d{6}$/, '');\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <Dialog open={isOpen} onOpenChange={(open) => !open && onClose()}>\n      <DialogContent maxWidth=\"max-w-fit\" showCloseButton={false} className=\"w-fit min-w-[600px] max-w-[90vw] max-h-[90vh] overflow-hidden flex flex-col p-4\">\n        <DialogHeader className=\"flex-shrink-0 !p-0 !border-0\">\n          <div className=\"flex justify-between items-start\">\n            <div>\n              <DialogTitle className=\"text-lg font-semibold text-gray-900\">\n                {boardData ? cleanBoardName(boardData.board_name) : '로딩 중...'}\n              </DialogTitle>\n              {boardData && (\n                <div className=\"flex gap-4 mt-1 text-xs text-gray-500\">\n                  <span>Artwork: {boardData.artwork_manager || '-'}</span>\n                  <span>생산: {boardData.production_manager || '-'}</span>\n                  <span>수량: {boardData.production_quantity}</span>\n                </div>\n              )}\n            </div>\n            <div className=\"flex gap-2\">\n              <Button\n                onClick={handleDownloadExcel}\n                disabled={downloading || !boardData}\n                className=\"h-8 px-3 text-xs bg-green-600 hover:bg-green-700 text-white\"\n              >\n                {downloading ? (\n                  <Loader2 className=\"w-3 h-3 animate-spin mr-1\" />\n                ) : (\n                  <Download className=\"w-3 h-3 mr-1\" />\n                )}\n                Excel 다운로드\n              </Button>\n            </div>\n          </div>\n        </DialogHeader>\n\n        <div className=\"flex-1 overflow-hidden mt-3\">\n          {loading ? (\n            <div className=\"flex items-center justify-center h-64\">\n              <Loader2 className=\"w-6 h-6 text-hansl-600 animate-spin mr-2\" />\n              <span className=\"text-sm text-gray-600\">데이터를 불러오는 중...</span>\n            </div>\n          ) : boardData ? (\n            <Tabs defaultValue=\"bom\" className=\"h-full flex flex-col\">\n              <TabsList className=\"flex-shrink-0 mb-3 grid grid-cols-3 h-8 bg-gray-100 p-1 business-radius-button\">\n                <TabsTrigger \n                  value=\"bom\" \n                  className=\"text-[10px] h-7 data-[state=active]:bg-white data-[state=active]:text-hansl-600 data-[state=active]:shadow-sm\"\n                >\n                  정리된 BOM\n                  <span className=\"ml-1 badge-stats bg-gray-100 text-gray-600 data-[state=active]:bg-hansl-50 data-[state=active]:text-hansl-700\">\n                    {boardData.bomItems.length}\n                  </span>\n                </TabsTrigger>\n                <TabsTrigger \n                  value=\"top\" \n                  className=\"text-[10px] h-7 data-[state=active]:bg-white data-[state=active]:text-hansl-600 data-[state=active]:shadow-sm\"\n                >\n                  TOP\n                  <span className=\"ml-1 badge-stats bg-gray-100 text-gray-600 data-[state=active]:bg-hansl-50 data-[state=active]:text-hansl-700\">\n                    {boardData.topCoordinates.length}\n                  </span>\n                </TabsTrigger>\n                <TabsTrigger \n                  value=\"bottom\" \n                  className=\"text-[10px] h-7 data-[state=active]:bg-white data-[state=active]:text-hansl-600 data-[state=active]:shadow-sm\"\n                >\n                  BOTTOM\n                  <span className=\"ml-1 badge-stats bg-gray-100 text-gray-600 data-[state=active]:bg-orange-50 data-[state=active]:text-orange-700\">\n                    {boardData.bottomCoordinates.length}\n                  </span>\n                </TabsTrigger>\n              </TabsList>\n\n              {/* BOM 탭 */}\n              <TabsContent value=\"bom\" className=\"flex-1 overflow-auto mt-0\">\n                <BOMTable items={boardData.bomItems} checkIsMisap={checkIsMisap} productionQuantity={boardData.production_quantity} />\n              </TabsContent>\n\n              {/* TOP 탭 */}\n              <TabsContent value=\"top\" className=\"flex-1 overflow-auto mt-0\">\n                <CoordinateTable coordinates={boardData.topCoordinates} checkIsMisap={checkIsMisap} />\n              </TabsContent>\n\n              {/* BOTTOM 탭 */}\n              <TabsContent value=\"bottom\" className=\"flex-1 overflow-auto mt-0\">\n                <CoordinateTable coordinates={boardData.bottomCoordinates} checkIsMisap={checkIsMisap} />\n              </TabsContent>\n            </Tabs>\n          ) : (\n            <div className=\"flex items-center justify-center h-64 text-gray-500\">\n              데이터를 불러올 수 없습니다.\n            </div>\n          )}\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\n// ============================================================================\n// BOM 테이블 컴포넌트 (GeneratedPreviewPanel과 100% 동일한 디자인)\n// ============================================================================\nfunction BOMTable({ \n  items, \n  checkIsMisap,\n  productionQuantity \n}: { \n  items: BOMItem[]; \n  checkIsMisap: (name: string, remark: string) => boolean;\n  productionQuantity: number;\n}) {\n  let prevType = '';\n  const totalSetCount = items.reduce((sum, item) => sum + (item.setCount || 0), 0);\n  \n  // 행 배경색 결정 (미리보기와 동일)\n  const getRowClassName = (item: BOMItem) => {\n    const isMisap = checkIsMisap(item.itemName, item.remark);\n    if (item.isManualRequired) return 'bg-yellow-50 hover:bg-yellow-100';\n    if (item.isNewPart) return 'bg-red-50 hover:bg-red-100';\n    if (isMisap) return 'bg-gray-50 hover:bg-gray-100';\n    return 'hover:bg-gray-50';\n  };\n  \n  return (\n    <div className=\"border rounded-lg bg-white shadow-sm max-h-[55vh] overflow-auto\">\n      <table className=\"table-auto w-auto border-collapse text-[13px]\">\n        <thead className=\"bg-gray-50 sticky top-0 z-20\">\n            <tr className=\"h-6 border-b border-gray-200\">\n              <th className=\"w-[40px] sm:w-[50px] text-center py-0.5 px-2 bg-gray-50 text-[12px] font-semibold text-gray-700\">\n                <span className=\"card-description\">No</span>\n              </th>\n              <th className=\"text-center whitespace-nowrap py-0.5 px-2 bg-gray-50 text-[12px] font-semibold text-gray-700\">\n                <span className=\"card-description\">종류</span>\n              </th>\n              <th className=\"whitespace-nowrap py-0.5 px-2 bg-gray-50 text-[12px] font-semibold text-gray-700\">\n                <span className=\"card-description\">품명</span>\n              </th>\n              <th className=\"w-[50px] sm:w-[60px] text-center py-0.5 px-2 bg-gray-50 text-[12px] font-semibold text-gray-700\">\n                <span className=\"card-description\">SET</span>\n              </th>\n              <th className=\"w-[60px] sm:w-[80px] text-center py-0.5 px-2 bg-gray-50 text-[12px] font-semibold text-gray-700\">\n                <span className=\"card-description\">수량</span>\n              </th>\n              <th className=\"w-[50px] sm:w-[60px] text-center hidden sm:table-cell py-0.5 px-2 bg-gray-50 text-[12px] font-semibold text-gray-700\">\n                <span className=\"card-description\">재고</span>\n              </th>\n              <th className=\"min-w-[200px] sm:min-w-[300px] py-0.5 px-2 bg-gray-50 text-[12px] font-semibold text-gray-700\">\n                <span className=\"card-description\">REF</span>\n              </th>\n              <th className=\"w-[100px] sm:w-[150px] hidden md:table-cell py-0.5 px-2 bg-gray-50 text-[12px] font-semibold text-gray-700\">\n                <span className=\"card-description\">대체품</span>\n              </th>\n              <th className=\"w-[100px] sm:w-[150px] py-0.5 px-2 bg-gray-50 text-[12px] font-semibold text-gray-700\">\n                <span className=\"card-description\">비고</span>\n              </th>\n            </tr>\n          </thead>\n          <tbody>\n            {items.length === 0 ? (\n              <tr>\n                <td colSpan={9} className=\"text-center py-6 card-description\">\n                  데이터가 없습니다.\n                </td>\n              </tr>\n            ) : (\n              items.map((item, index) => {\n                const isMisap = checkIsMisap(item.itemName, item.remark);\n                const showType = item.itemType !== prevType;\n                prevType = item.itemType;\n                \n                return (\n                  <tr key={index} className={`${getRowClassName(item)} border-b border-gray-100`}>\n                    {/* No */}\n                    <td className=\"text-center py-1 px-2\">\n                      <span className={`text-[10px] ${isMisap ? 'text-red-600' : 'text-gray-500'}`}>{index + 1}</span>\n                    </td>\n                    \n                    {/* 종류 - 연속 동일 종류는 첫 번째만 표시 */}\n                    <td className=\"text-center py-1 px-1 whitespace-nowrap\">\n                      <span className={`text-[10px] ${isMisap ? 'text-red-600' : 'text-gray-600'} ${\n                        item.itemType === '데이터 없음' ? '!text-red-500 font-bold' : ''\n                      }`}>\n                        {showType ? (item.itemType || '-') : ''}\n                      </span>\n                    </td>\n\n                    {/* 품명 */}\n                    <td className=\"py-1 px-1 whitespace-nowrap\">\n                      <span className={`text-[10px] ${\n                        isMisap ? 'text-red-600 font-medium' : \n                        (item.isManualRequired || item.isNewPart) ? 'text-red-600' : 'text-gray-500'\n                      }`}>\n                        {item.itemName || '-'}\n                      </span>\n                    </td>\n\n                    {/* SET */}\n                    <td className=\"text-center py-1 px-2\">\n                      <span className={`text-[10px] font-medium ${isMisap ? 'text-red-600' : 'text-gray-900'}`}>\n                        {item.setCount}\n                      </span>\n                    </td>\n\n                    {/* 수량 */}\n                    <td className=\"text-center py-1 px-2\">\n                      <span className={`text-[10px] font-bold ${isMisap ? 'text-red-600' : 'text-gray-900'}`}>\n                        {item.totalQuantity}\n                      </span>\n                    </td>\n\n                    {/* 재고 */}\n                    <td className=\"hidden sm:table-cell text-center py-1 px-2\">\n                      <span className={`text-[10px] font-medium ${isMisap ? 'text-red-600' : 'text-gray-900'}`}>\n                        {item.stockQuantity || ''}\n                      </span>\n                    </td>\n\n                    {/* REF */}\n                    <td className=\"px-1 py-1 align-middle\" style={{ width: '300px', maxWidth: '300px' }}>\n                      <span \n                        className={`text-[10px] ${isMisap ? 'text-red-600' : 'text-gray-600'}`}\n                        style={{ \n                          display: 'block',\n                          width: '300px',\n                          maxWidth: '300px',\n                          lineHeight: '14px',\n                          wordWrap: 'break-word',\n                          overflowWrap: 'break-word',\n                          whiteSpace: 'pre-wrap'\n                        }}\n                      >\n                        {item.refList || '-'}\n                      </span>\n                    </td>\n\n                    {/* 대체품 */}\n                    <td className=\"hidden md:table-cell py-1 px-2\">\n                      <span className={`text-[10px] ${isMisap ? 'text-red-600' : 'text-gray-500'}`}>\n                        {item.alternativeItem || ''}\n                      </span>\n                    </td>\n\n                    {/* 비고 */}\n                    <td className=\"py-1 px-2\">\n                      <span className={`text-[10px] ${isMisap ? 'text-red-600 font-medium' : 'text-gray-500'}`}>\n                        {item.remark || ''}\n                      </span>\n                    </td>\n                  </tr>\n                );\n              })\n            )}\n          </tbody>\n          {/* 푸터 - 미리보기와 동일한 구조 (하단 고정) */}\n          <tfoot className=\"bg-gray-50 border-t sticky bottom-0 z-20\">\n            <tr>\n              {/* No 칼럼 */}\n              <td className=\"py-2 px-2 bg-gray-50\">\n                <span className=\"card-description whitespace-nowrap\">총 {items.length}개 항목</span>\n              </td>\n              {/* 종류 */}\n              <td className=\"bg-gray-50\"></td>\n              {/* 품명 - 합계 라벨 */}\n              <td className=\"text-right pr-2 bg-gray-50\">\n                <span className=\"card-description\">합계:</span>\n              </td>\n              {/* SET - 합계 숫자 */}\n              <td className=\"text-center py-2 bg-gray-50\">\n                <span className=\"text-[11px] text-gray-700\">{totalSetCount}</span>\n              </td>\n              {/* 수량 */}\n              <td className=\"bg-gray-50\"></td>\n              {/* 재고 */}\n              <td className=\"hidden sm:table-cell bg-gray-50\"></td>\n              {/* REF */}\n              <td className=\"bg-gray-50\"></td>\n              {/* 대체품 */}\n              <td className=\"hidden md:table-cell bg-gray-50\"></td>\n              {/* 비고 + 범례 */}\n              <td className=\"py-2 px-2 text-right bg-gray-50\">\n                <div className=\"flex gap-4 card-description justify-end whitespace-nowrap\">\n                  <span className=\"flex items-center gap-1\">\n                    <span className=\"w-3 h-3 bg-yellow-100 border border-yellow-300 rounded\"></span>\n                    수동 확인\n                  </span>\n                  <span className=\"flex items-center gap-1\">\n                    <span className=\"w-3 h-3 bg-red-50 border border-red-200 rounded\"></span>\n                    미삽\n                  </span>\n                </div>\n              </td>\n            </tr>\n          </tfoot>\n        </table>\n    </div>\n  );\n}\n\n// ============================================================================\n// 좌표 테이블 컴포넌트 (CoordinatePreviewPanel과 100% 동일한 디자인)\n// ============================================================================\nfunction CoordinateTable({ \n  coordinates, \n  checkIsMisap \n}: { \n  coordinates: CoordinateItem[]; \n  checkIsMisap: (name: string, remark: string) => boolean;\n}) {\n  let prevType = '';\n  const totalCount = coordinates.length;\n  \n  return (\n    <div className=\"border rounded-lg bg-white shadow-sm max-h-[55vh] overflow-auto\">\n      <table className=\"table-auto w-auto border-collapse text-[13px]\">\n        <thead className=\"bg-gray-50 sticky top-0 z-20\">\n            <tr className=\"h-6 border-b border-gray-200\">\n              <th className=\"w-[40px] text-center py-0.5 px-2 bg-gray-50 text-[12px] font-semibold text-gray-700\">\n                <span className=\"card-description\">No</span>\n              </th>\n              <th className=\"text-center whitespace-nowrap py-0.5 px-2 bg-gray-50 text-[12px] font-semibold text-gray-700\">\n                <span className=\"card-description\">종류</span>\n              </th>\n              <th className=\"whitespace-nowrap py-0.5 px-2 bg-gray-50 text-[12px] font-semibold text-gray-700\">\n                <span className=\"card-description\">품명</span>\n              </th>\n              <th className=\"w-[80px] text-center py-0.5 px-2 bg-gray-50 text-[12px] font-semibold text-gray-700\">\n                <span className=\"card-description\">RefDes</span>\n              </th>\n              <th className=\"w-[60px] text-center py-0.5 px-2 bg-gray-50 text-[12px] font-semibold text-gray-700\">\n                <span className=\"card-description\">Layer</span>\n              </th>\n              <th className=\"w-[80px] text-center py-0.5 px-2 bg-gray-50 text-[12px] font-semibold text-gray-700\">\n                <span className=\"card-description\">X</span>\n              </th>\n              <th className=\"w-[80px] text-center py-0.5 px-2 bg-gray-50 text-[12px] font-semibold text-gray-700\">\n                <span className=\"card-description\">Y</span>\n              </th>\n              <th className=\"w-[60px] text-center py-0.5 px-2 bg-gray-50 text-[12px] font-semibold text-gray-700\">\n                <span className=\"card-description\">Angle</span>\n              </th>\n              <th className=\"w-[80px] py-0.5 px-2 bg-gray-50 text-[12px] font-semibold text-gray-700\">\n                <span className=\"card-description\">비고</span>\n              </th>\n            </tr>\n          </thead>\n          <tbody>\n            {coordinates.length === 0 ? (\n              <tr>\n                <td colSpan={9} className=\"text-center py-6 card-description\">\n                  데이터가 없습니다.\n                </td>\n              </tr>\n            ) : (\n              coordinates.map((coord, index) => {\n                const isMisap = checkIsMisap(coord.partName || '', coord.remark || '');\n                const showType = coord.type !== prevType;\n                prevType = coord.type || '';\n                \n                return (\n                  <tr \n                    key={index} \n                    className={`hover:bg-gray-50 border-b border-gray-100 ${isMisap ? 'bg-gray-50' : ''}`}\n                  >\n                    {/* No */}\n                    <td className=\"text-center py-1 px-2\">\n                      <span className={`text-[10px] ${isMisap ? 'text-red-600' : 'text-gray-500'}`}>{index + 1}</span>\n                    </td>\n                    \n                    {/* 종류 - 연속 동일 종류는 첫 번째만 표시 */}\n                    <td className=\"text-center py-1 px-1 whitespace-nowrap\">\n                      <span className={`text-[10px] ${isMisap ? 'text-red-600' : 'text-gray-600'}`}>\n                        {showType ? (coord.type || '-') : ''}\n                      </span>\n                    </td>\n                    \n                    {/* 품명 */}\n                    <td className=\"py-1 px-1 whitespace-nowrap\">\n                      <span className={`text-[10px] ${isMisap ? 'text-red-600' : 'text-gray-600'}`}>\n                        {coord.partName || '-'}\n                      </span>\n                    </td>\n                    \n                    {/* RefDes */}\n                    <td className=\"text-center py-1 px-2\">\n                      <span className={`text-[10px] font-medium ${isMisap ? 'text-red-600' : 'text-gray-900'}`}>\n                        {coord.refDes}\n                      </span>\n                    </td>\n                    \n                    {/* Layer */}\n                    <td className=\"text-center py-1 px-2\">\n                      <Badge \n                        variant={coord.layer === 'TOP' ? 'default' : 'secondary'} \n                        className=\"text-[9px] px-1.5 py-0 h-4\"\n                      >\n                        {coord.layer}\n                      </Badge>\n                    </td>\n                    \n                    {/* X */}\n                    <td className=\"text-center py-1 px-2\">\n                      <span className={`text-[10px] font-mono ${isMisap ? 'text-red-600' : 'text-gray-600'}`}>\n                        {coord.locationX?.toFixed(2)}\n                      </span>\n                    </td>\n                    \n                    {/* Y */}\n                    <td className=\"text-center py-1 px-2\">\n                      <span className={`text-[10px] font-mono ${isMisap ? 'text-red-600' : 'text-gray-600'}`}>\n                        {coord.locationY?.toFixed(2)}\n                      </span>\n                    </td>\n                    \n                    {/* Angle */}\n                    <td className=\"text-center py-1 px-2\">\n                      <span className={`text-[10px] font-mono ${isMisap ? 'text-red-600' : 'text-gray-600'}`}>\n                        {coord.rotation || 0}\n                      </span>\n                    </td>\n                    \n                    {/* 비고 */}\n                    <td className=\"py-1 px-2\">\n                      <span className={`text-[10px] ${isMisap ? 'text-red-600 font-medium' : 'text-gray-500'}`}>\n                        {coord.remark || ''}\n                      </span>\n                    </td>\n                  </tr>\n                );\n              })\n            )}\n          </tbody>\n          {/* 푸터 (하단 고정) */}\n          <tfoot className=\"bg-gray-50 border-t sticky bottom-0 z-20\">\n            <tr>\n              <td colSpan={9} className=\"py-2 px-2 bg-gray-50\">\n                <div className=\"flex justify-between items-center\">\n                  <span className=\"card-description\">총 {totalCount}개 항목</span>\n                  <div className=\"flex gap-4 card-description\">\n                    <span className=\"flex items-center gap-1\">\n                      <span className=\"w-3 h-3 bg-gray-100 border border-gray-300 rounded\"></span>\n                      미삽\n                    </span>\n                  </div>\n                </div>\n              </td>\n            </tr>\n          </tfoot>\n        </table>\n    </div>\n  );\n}\n","/**\n * BOM 좌표 자동 정리 엔진 v7 (웹 버전)\n * \n * v7-engine.js의 학습 데이터를 활용하여\n * BOM, 좌표 원본 파일 → 정리본 데이터 생성\n */\n\nimport * as XLSX from 'xlsx';\n\n// ============================================================\n// 타입 정의\n// ============================================================\n\nexport interface BOMItem {\n  lineNumber: number;\n  itemType: string;           // 종류\n  itemName: string;           // 품명\n  setCount: number;           // SET\n  totalQuantity: number;      // 수량\n  stockQuantity?: number;     // 재고\n  checkStatus: string;        // CHECK\n  refList: string;            // Ref\n  alternativeItem?: string;   // 대체가능품목\n  remark: string;             // 비고\n  // 상태 플래그\n  isManualRequired: boolean;  // 수동 확인 필요\n  isNewPart: boolean;         // 새로운 부품 (미등록)\n  originalPart?: string;      // 원본 Part\n  originalFootprint?: string; // 원본 Footprint\n}\n\nexport interface CoordinateItem {\n  type: string;       // Type (종류)\n  partName: string;   // 품명\n  refDes: string;     // RefDes\n  layer: string;      // Layer (TOP/BOTTOM)\n  locationX: number;  // LocationX\n  locationY: number;  // LocationY\n  rotation: number;   // Rotation\n  remark?: string;    // 비고 (미삽 등)\n}\n\nexport interface ProcessedResult {\n  bomItems: BOMItem[];\n  topCoordinates: CoordinateItem[];\n  bottomCoordinates: CoordinateItem[];\n  summary: {\n    totalItems: number;\n    manualRequiredCount: number;\n    newPartCount: number;\n    misapCount: number;\n  };\n}\n\nexport interface LearningDataType {\n  typeMapping: Record<string, string>;      // 품명 → 종류\n  partNameMapping: Record<string, string>;  // footprint → 품명\n  partNameConflicts: Record<string, string[]>;\n  typeSortOrder: string[];\n  misapKeywords: string[];\n  manualInputRequired: string[];\n}\n\n// ============================================================\n// 학습 데이터 캐시\n// ============================================================\n\nlet learningDataCache: LearningDataType | null = null;\n\n// 수동 작성 필요 조합 (10V/16V/50V 충돌)\nconst MANUAL_INPUT_REQUIRED = [\n  '1u/1005|C1UF_1005',\n  '10u/1005|C10UF_1005',\n  '1u/1608|C1UF_1608',\n  '0.01u/1005|C0.01UF_1005',\n  '0.1u/1005|C0.1UF_1005',\n  '10uf/1608|C10UF_1608',\n  '10pf/1005|C10PF_1005',\n  '10nf/1005|C10NF_1005',\n  '220pf/1005|C220PF_1005',\n  '47u/2012|C47UF_16V_2012',\n  '2.2u/1005|C2.2UF_16V_1005',\n  '0.001u/1005|C0.001UF_1005',\n  '4.7u/1005|C4.7UF_1005',\n  '|R1K_1005_0.1%',\n];\n\n// 고정 매핑 (다수결로 결정된 항목들)\nconst FIXED_MAPPINGS: Record<string, string> = {\n  'FI-RE41S-HF': 'FI-RE41S-HF-R1500',\n  'FI-RE51S-HF': 'FI-RE51S-HF-R1500',\n  '24LC256ISN': '24LC256-I/SN',\n  'TLP3107': 'TLP3107',\n  'AD5175BRMZ-10-RL7': 'AD5175BRMZ-10-RL7',\n  'AD5175BCPZ-10-RL7': 'AD5175BCPZ-10-RL7',\n  'ADS7828E_250': 'ADS7828E/250',\n  'TPD2EUSB30DRTR_OPEN': 'TPD2EUSB30DRTR_OPEN',\n  'TPD2EUSB30DRTR': 'TPD2EUSB30DRTR',\n  'C10PF_50V_1005_OPEN': 'C10pF/50V_1005_OPEN',\n  'C10PF_1005_OPEN': 'C10PF/10V_1005_OPEN',\n  'R0_1005_OPEN': 'R0_1005_OPEN',\n  'C0.1UF_16V_1005_OPEN': 'C0.1uF/16V_1005_OPEN',\n  'W25Q16JVSSIQ_OPEN': 'W25Q16JVSSIQ_OPEN',\n  'R1K_1005_OPEN_1903': 'R1K_1005_OPEN',\n  'R10K_1005_OPEN_1903': 'R10K_1005_OPEN',\n  'R10K_1005_OPEN': 'R10K_1005_OPEN',\n  'R4.7K_1005': 'R4.7K_1005_1%',\n  'R10_1005': 'R10_1005_1%',\n  'R15_1005': 'R15_1005_1%',\n  'MAX3373EEKA+T_NEW': 'MAX3373EEKA+T',\n  'C0.1UF_16V_1005': 'C0.1uF/16V_1005',\n  'T47UF_16V-B': 'T47uF/16V \"B\"',\n  'SN65DP141RLJR_R-PWQFN-N38_RLJ': 'SN65DP141RLJR',\n  'TSM6963SD_TSSOP-8': 'TSM6963SD',\n  'SW-DJMM-12V': 'SW-DJMM-12V',\n  'BOI_C70_CUBE_Z-CAL_POGO': 'BOI_C70_CUBE_Z-CAL_POGO',\n  'MGL_G1_AA_MASTER_SENSOR_POGO': 'B2B',\n  'TPD2EUSB30DRTR/OPEN|TPD2EUSB30DRTR': 'TPD2EUSB30DRTR_OPEN',\n};\n\n// ============================================================\n// 학습 데이터 로드\n// ============================================================\n\nexport async function loadLearningData(): Promise<LearningDataType> {\n  if (learningDataCache) {\n    return learningDataCache;\n  }\n\n  try {\n    console.log('📂 학습 데이터 로드 시작...');\n    \n    const [\n      typeMappingRes,\n      partNameMappingRes,\n      partNameConflictsRes,\n      typeSortOrderRes,\n      misapKeywordsRes,\n    ] = await Promise.all([\n      fetch('/data/종류_매핑.json'),\n      fetch('/data/품명_매핑.json'),\n      fetch('/data/품명_충돌목록.json'),\n      fetch('/data/종류_정렬순서.json'),\n      fetch('/data/미삽항목.json'),\n    ]);\n\n    // 응답 체크\n    if (!typeMappingRes.ok) throw new Error(`종류_매핑.json 로드 실패: ${typeMappingRes.status}`);\n    if (!partNameMappingRes.ok) throw new Error(`품명_매핑.json 로드 실패: ${partNameMappingRes.status}`);\n    if (!partNameConflictsRes.ok) throw new Error(`품명_충돌목록.json 로드 실패: ${partNameConflictsRes.status}`);\n    if (!typeSortOrderRes.ok) throw new Error(`종류_정렬순서.json 로드 실패: ${typeSortOrderRes.status}`);\n    if (!misapKeywordsRes.ok) throw new Error(`미삽항목.json 로드 실패: ${misapKeywordsRes.status}`);\n\n    const typeMapping = await typeMappingRes.json();\n    const partNameMapping = await partNameMappingRes.json();\n    const partNameConflicts = await partNameConflictsRes.json();\n    const typeSortOrder = await typeSortOrderRes.json();\n    const misapKeywords = await misapKeywordsRes.json();\n\n    // 고정 매핑 적용\n    const mergedPartNameMapping = { ...partNameMapping, ...FIXED_MAPPINGS };\n\n    learningDataCache = {\n      typeMapping,\n      partNameMapping: mergedPartNameMapping,\n      partNameConflicts,\n      typeSortOrder,\n      misapKeywords,\n      manualInputRequired: MANUAL_INPUT_REQUIRED,\n    };\n\n    console.log('✅ 학습 데이터 로드 완료');\n    return learningDataCache;\n  } catch (error) {\n    console.error('❌ 학습 데이터 로드 실패:', error);\n    throw error;\n  }\n}\n\n// ============================================================\n// 유틸리티 함수\n// ============================================================\n\nconst Utils = {\n  // 품명 정규화 (대소문자, 구분자 통일)\n  normalizePartName(partName: string): string {\n    if (!partName) return '';\n    return partName\n      .toLowerCase()\n      .replace(/[\\/\\-_\\s]/g, '')\n      .replace(/\"/g, '')\n      .trim();\n  },\n\n  // Part|Footprint 조합 정규화\n  normalizePartFootprintCombo(part: string, footprint: string): string {\n    let normPart = (part || '')\n      .toLowerCase()\n      .replace(/uf/g, 'u')\n      .replace(/pf/g, 'p')\n      .replace(/nf/g, 'n')\n      .replace(/\\s/g, '');\n    // Part 앞의 c 접두사 제거\n    if (/^c\\d/.test(normPart)) {\n      normPart = normPart.substring(1);\n    }\n    const normFp = (footprint || '').toUpperCase();\n    return `${normPart}|${normFp}`;\n  },\n\n  // 수동 작성 필요 조합인지 체크\n  isManualInputRequired(part: string, footprint: string, learningData: LearningDataType): boolean {\n    const fpUpper = (footprint || '').toUpperCase();\n    \n    return learningData.manualInputRequired.some(m => {\n      const [mPart, mFp] = m.split('|');\n      // Footprint만으로도 체크\n      if (mFp && fpUpper === mFp.toUpperCase()) {\n        return true;\n      }\n      const combo = this.normalizePartFootprintCombo(part, footprint);\n      const normM = this.normalizePartFootprintCombo(mPart, mFp);\n      return combo === normM;\n    });\n  },\n\n  // 미삽 여부 체크 (footprint와 part 모두 체크)\n  isMisap(footprint: string, part: string, learningData: LearningDataType): boolean {\n    const footprintUpper = (footprint || '').toUpperCase();\n    const partUpper = (part || '').toUpperCase();\n    \n    // footprint 또는 part에 미삽 키워드가 포함되어 있으면 미삽\n    return learningData.misapKeywords.some(kw => \n      footprintUpper.includes(kw) || partUpper.includes(kw)\n    );\n  },\n\n  // Ref 파싱\n  parseRefs(refStr: string): string[] {\n    if (!refStr) return [];\n    const refs: string[] = [];\n    const parts = refStr.split(/[,.\\s]+/).map(r => r.trim()).filter(r => r.length > 0);\n    \n    for (const part of parts) {\n      if (/^[-_=]+$/.test(part)) continue;\n      \n      const rangeMatch = part.match(/^([A-Z]+)(\\d+)[-~]([A-Z]*)(\\d+)$/i);\n      if (rangeMatch) {\n        const prefix = rangeMatch[1];\n        const start = parseInt(rangeMatch[2]);\n        const end = parseInt(rangeMatch[4]);\n        for (let i = start; i <= end; i++) {\n          refs.push(prefix + i);\n        }\n      } else {\n        refs.push(part);\n      }\n    }\n    \n    return refs;\n  },\n\n  // TP 여부\n  isTP(ref: string): boolean {\n    return /^TP/i.test(ref);\n  },\n\n  // 종류 정규화\n  normalizeType(typeVal: string): string {\n    if (!typeVal) return '';\n    const normalized = typeVal.trim();\n    \n    const typeMapping: Record<string, string> = {\n      'TP/DIP': 'TEST POINT/DIP',\n      'TP/SMD': 'TEST POINT/SMD',\n      'SENSOR': 'SENSOR(SMD)',\n      'PEM NUT': 'PEMNUT',\n      'BEAD(012)': 'BEAD(2012)',\n      'TEST POINT': 'TEST POINT/SMD',\n      'CONNECTGOR': 'CONNECTOR',\n      'CONNECTO4R': 'CONNECTOR',\n      'CONNECTROR': 'CONNECTOR',\n      'DIOODE(SMD)': 'DIODE(SMD)',\n      'X-TAL': 'X-TAL(SMD)',\n    };\n    \n    return typeMapping[normalized] || normalized;\n  },\n};\n\n// ============================================================\n// BOM 파싱\n// ============================================================\n\ninterface ParsedBOMItem {\n  quantity: number;\n  refs: string[];\n  part: string;\n  footprint: string;\n}\n\nasync function parseBOMFile(file: File): Promise<ParsedBOMItem[]> {\n  const arrayBuffer = await file.arrayBuffer();\n  const data = new Uint8Array(arrayBuffer);\n  \n  const workbook = XLSX.read(data, { type: 'array' });\n  const sheet = workbook.Sheets[workbook.SheetNames[0]];\n  const rows = XLSX.utils.sheet_to_json<string[]>(sheet, { header: 1 });\n  \n  const items: ParsedBOMItem[] = [];\n  \n  // 헤더 찾기\n  let headerRow = -1;\n  let colMap = { item: 0, ref: 1, qty: 2, part: 3, footprint: -1 };\n  const refKeywords = ['reference', 'references', 'ref', 'designator'];\n  const partKeywords = ['part', 'part number'];\n  const footprintKeywords = ['pcb footprint', 'footprint', 'partnumber'];\n  \n  for (let r = 0; r < Math.min(30, rows.length); r++) {\n    const row = rows[r];\n    if (!row) continue;\n    \n    const rowStr = row.map(c => String(c || '').toLowerCase()).join(' ');\n    if (refKeywords.some(kw => rowStr.includes(kw))) {\n      headerRow = r;\n      row.forEach((cell, idx) => {\n        const val = String(cell || '').toLowerCase().trim();\n        if (val === 'item' || val === 'no') colMap.item = idx;\n        if (refKeywords.some(kw => val === kw)) colMap.ref = idx;\n        if (val === 'quantity' || val === 'qty') colMap.qty = idx;\n        if (partKeywords.some(kw => val === kw)) colMap.part = idx;\n        if (footprintKeywords.some(kw => val === kw)) colMap.footprint = idx;\n      });\n      break;\n    }\n  }\n  \n  if (headerRow === -1) {\n    console.warn('헤더를 찾을 수 없습니다. 기본값 사용.');\n    headerRow = 0;\n  }\n  \n  let currentItem: ParsedBOMItem | null = null;\n  \n  for (let r = headerRow + 1; r < rows.length; r++) {\n    const row = rows[r];\n    if (!row || row.length === 0) continue;\n    \n    const itemNum = String(row[colMap.item] || '').trim();\n    const reference = String(row[colMap.ref] || '').trim();\n    const quantity = String(row[colMap.qty] || '').trim();\n    const part = String(row[colMap.part] || '').trim();\n    const footprint = colMap.footprint >= 0 ? String(row[colMap.footprint] || '').trim() : '';\n    \n    if (reference.startsWith('_')) continue;\n    \n    if (itemNum && /^\\d+$/.test(itemNum)) {\n      if (currentItem && currentItem.refs.length > 0) {\n        items.push(currentItem);\n      }\n      const refs = Utils.parseRefs(reference).filter(ref => !Utils.isTP(ref));\n      currentItem = {\n        quantity: parseInt(quantity) || refs.length,\n        refs,\n        part,\n        footprint: footprint || part,\n      };\n    } else if (currentItem && reference) {\n      const additionalRefs = Utils.parseRefs(reference).filter(ref => !Utils.isTP(ref));\n      currentItem.refs.push(...additionalRefs);\n    }\n  }\n  \n  if (currentItem && currentItem.refs.length > 0) {\n    items.push(currentItem);\n  }\n  \n  return items;\n}\n\n// ============================================================\n// 좌표 파싱\n// ============================================================\n\ninterface ParsedCoordItem {\n  ref: string;\n  x: number;\n  y: number;\n  rotation: number;\n  layer: string;\n}\n\nasync function parseCoordinateFile(file: File): Promise<ParsedCoordItem[]> {\n  const arrayBuffer = await file.arrayBuffer();\n  const items: ParsedCoordItem[] = [];\n  \n  if (file.name.endsWith('.txt')) {\n    // 텍스트 파일 파싱\n    const text = new TextDecoder('utf-8').decode(arrayBuffer);\n    const lines = text.split('\\n');\n    \n    let headerFound = false;\n    let colMap = { ref: 0, x: 3, y: 4, rotation: 5, layer: 2 };\n    \n    for (const line of lines) {\n      const trimmed = line.trim();\n      if (!trimmed) continue;\n      \n      // 헤더 찾기\n      if (!headerFound) {\n        const lower = trimmed.toLowerCase();\n        if (lower.includes('refdes') || lower.includes('ref') || lower.includes('designator')) {\n          headerFound = true;\n          const cols = trimmed.split(/\\s{2,}|\\t/).map(c => c.toLowerCase().trim());\n          cols.forEach((col, idx) => {\n            if (col.includes('ref') || col.includes('designator')) colMap.ref = idx;\n            if (col.includes('locationx') || col === 'x') colMap.x = idx;\n            if (col.includes('locationy') || col === 'y') colMap.y = idx;\n            if (col.includes('rotation') || col.includes('angle')) colMap.rotation = idx;\n            if (col.includes('layer') || col.includes('side')) colMap.layer = idx;\n          });\n          continue;\n        }\n        continue;\n      }\n      \n      // 데이터 행 파싱\n      const cols = trimmed.split(/\\s{2,}|\\t/);\n      if (cols.length < 4) continue;\n      \n      const ref = (cols[colMap.ref]?.trim() || '').toUpperCase();\n      if (!ref || Utils.isTP(ref)) continue;\n      \n      items.push({\n        ref,\n        x: parseFloat(cols[colMap.x]) || 0,\n        y: parseFloat(cols[colMap.y]) || 0,\n        rotation: parseFloat(cols[colMap.rotation]) || 0,\n        layer: cols[colMap.layer]?.toUpperCase().includes('BOT') ? 'BOTTOM' : 'TOP',\n      });\n    }\n  } else {\n    // 엑셀 파일 파싱\n    const data = new Uint8Array(arrayBuffer);\n    const workbook = XLSX.read(data, { type: 'array' });\n    const sheet = workbook.Sheets[workbook.SheetNames[0]];\n    const rows = XLSX.utils.sheet_to_json<string[]>(sheet, { header: 1 });\n    \n    let headerRow = -1;\n    let colMap = { ref: 0, x: 3, y: 4, rotation: 5, layer: 2 };\n    \n    for (let r = 0; r < Math.min(10, rows.length); r++) {\n      const row = rows[r];\n      if (!row) continue;\n      \n      const rowStr = row.map(c => String(c || '').toLowerCase()).join(' ');\n      if (rowStr.includes('ref') || rowStr.includes('designator')) {\n        headerRow = r;\n        row.forEach((cell, idx) => {\n          const val = String(cell || '').toLowerCase().trim();\n          if (val.includes('ref') || val.includes('designator')) colMap.ref = idx;\n          if (val.includes('locationx') || val === 'x') colMap.x = idx;\n          if (val.includes('locationy') || val === 'y') colMap.y = idx;\n          if (val.includes('rotation') || val.includes('angle')) colMap.rotation = idx;\n          if (val.includes('layer') || val.includes('side')) colMap.layer = idx;\n        });\n        break;\n      }\n    }\n    \n    for (let r = headerRow + 1; r < rows.length; r++) {\n      const row = rows[r];\n      if (!row) continue;\n      \n      const ref = String(row[colMap.ref] || '').trim().toUpperCase();\n      if (!ref || Utils.isTP(ref)) continue;\n      \n      items.push({\n        ref,\n        x: parseFloat(String(row[colMap.x])) || 0,\n        y: parseFloat(String(row[colMap.y])) || 0,\n        rotation: parseFloat(String(row[colMap.rotation])) || 0,\n        layer: String(row[colMap.layer] || '').toUpperCase().includes('BOT') ? 'BOTTOM' : 'TOP',\n      });\n    }\n  }\n  \n  return items;\n}\n\n// ============================================================\n// 매핑 적용\n// ============================================================\n\nfunction mapPartName(\n  part: string, \n  footprint: string, \n  learningData: LearningDataType\n): { partName: string; isNew: boolean } {\n  const fpUpper = footprint.toUpperCase();\n  \n  // 1. Part|Footprint 조합으로 먼저 체크\n  const combo = `${part}|${footprint}`;\n  if (learningData.partNameMapping[combo]) {\n    return { partName: learningData.partNameMapping[combo], isNew: false };\n  }\n  \n  // 2. Footprint만으로 체크\n  if (learningData.partNameMapping[fpUpper]) {\n    return { partName: learningData.partNameMapping[fpUpper], isNew: false };\n  }\n  if (learningData.partNameMapping[footprint]) {\n    return { partName: learningData.partNameMapping[footprint], isNew: false };\n  }\n  \n  // 3. Part 이름으로 체크\n  if (learningData.partNameMapping[part]) {\n    return { partName: learningData.partNameMapping[part], isNew: false };\n  }\n  \n  // 4. 미등록 부품\n  return { partName: footprint || part, isNew: true };\n}\n\nfunction mapType(partName: string, learningData: LearningDataType): string {\n  // 정규화된 품명으로 종류 찾기\n  if (learningData.typeMapping[partName]) {\n    return learningData.typeMapping[partName];\n  }\n  \n  // 정규화해서 다시 시도\n  const normalized = Utils.normalizePartName(partName);\n  for (const [key, value] of Object.entries(learningData.typeMapping)) {\n    if (Utils.normalizePartName(key) === normalized) {\n      return value;\n    }\n  }\n  \n  return '';  // 데이터 없음\n}\n\n// Footprint에서 종류 찾기 (품명 충돌이어도 종류는 같으니까!)\nfunction mapTypeFromFootprint(part: string, footprint: string, learningData: LearningDataType): string {\n  const fpUpper = footprint.toUpperCase();\n  \n  // 1. Part|Footprint 조합으로 품명 찾기\n  const combo = `${part}|${footprint}`;\n  if (learningData.partNameMapping[combo]) {\n    const mappedPartName = learningData.partNameMapping[combo];\n    const type = mapType(mappedPartName, learningData);\n    if (type) return type;\n  }\n  \n  // 2. Footprint만으로 품명 찾기\n  const footprintKeys = [fpUpper, footprint];\n  for (const key of footprintKeys) {\n    if (learningData.partNameMapping[key]) {\n      const mappedPartName = learningData.partNameMapping[key];\n      const type = mapType(mappedPartName, learningData);\n      if (type) return type;\n    }\n  }\n  \n  // 3. Part로 품명 찾기\n  if (learningData.partNameMapping[part]) {\n    const mappedPartName = learningData.partNameMapping[part];\n    const type = mapType(mappedPartName, learningData);\n    if (type) return type;\n  }\n  \n  // 4. 품명 매핑의 모든 키 중에 footprint 패턴이 포함된 것 찾기\n  for (const [key, mappedPartName] of Object.entries(learningData.partNameMapping)) {\n    if (key.toUpperCase().includes(fpUpper) || fpUpper.includes(key.toUpperCase())) {\n      const type = mapType(mappedPartName, learningData);\n      if (type) return type;\n    }\n  }\n  \n  return '';  // 못 찾음\n}\n\n// ============================================================\n// 메인 처리 함수\n// ============================================================\n\nexport async function processBOMAndCoordinates(\n  bomFile: File,\n  coordFile: File,\n  productionQuantity: number\n): Promise<ProcessedResult> {\n  console.log('🚀 BOM/좌표 처리 시작...');\n  \n  // 1. 학습 데이터 로드\n  const learningData = await loadLearningData();\n  \n  // 2. 파일 파싱\n  const parsedBOM = await parseBOMFile(bomFile);\n  const parsedCoord = await parseCoordinateFile(coordFile);\n\n  // Ref를 대문자로 정규화해 매핑 실패 방지\n  parsedBOM.forEach(item => {\n    item.refs = item.refs.map(ref => ref.toUpperCase());\n  });\n  const normalizedCoord = parsedCoord.map(coord => ({\n    ...coord,\n    ref: coord.ref.toUpperCase(),\n  }));\n  \n  console.log(`📄 BOM 항목: ${parsedBOM.length}개`);\n  console.log(`📍 좌표 항목: ${normalizedCoord.length}개`);\n  \n  // 3. Ref → 좌표 맵 생성\n  const coordMap = new Map<string, ParsedCoordItem>();\n  for (const coord of normalizedCoord) {\n    coordMap.set(coord.ref, coord);\n  }\n  \n  // 4. BOM 처리 및 매핑\n  const bomItems: BOMItem[] = [];\n  const topCoordinates: CoordinateItem[] = [];\n  const bottomCoordinates: CoordinateItem[] = [];\n  \n  let manualRequiredCount = 0;\n  let newPartCount = 0;\n  let misapCount = 0;\n  \n  let lineNumber = 1;\n  \n  for (const item of parsedBOM) {\n    // 수동 확인 필요 여부\n    const isManualRequired = Utils.isManualInputRequired(item.part, item.footprint, learningData);\n    \n    // 품명 매핑\n    let mappedPartName: string;\n    let isNewPart = false;\n    \n    if (isManualRequired) {\n      mappedPartName = '데이터 없음 (수동 확인 필요)';\n      manualRequiredCount++;\n    } else {\n      const mapping = mapPartName(item.part, item.footprint, learningData);\n      mappedPartName = mapping.partName;\n      isNewPart = mapping.isNew;\n      if (isNewPart) {\n        newPartCount++;\n      }\n    }\n    \n    // 종류 매핑\n    let itemType = mapType(mappedPartName, learningData);\n    if (!itemType && !isManualRequired && !isNewPart) {\n      // 종류도 못 찾으면 새 부품으로 처리\n      isNewPart = true;\n      newPartCount++;\n    }\n    \n    // 미삽 여부 (footprint와 part 모두 체크)\n    const isMisap = Utils.isMisap(item.footprint, item.part, learningData);\n    if (isMisap) {\n      misapCount++;\n    }\n    \n    // Footprint/Part에서 종류 추출 (학습 데이터와 무관하게)\n    const extractTypeFromFootprint = (part: string, footprint: string, refs: string[]): string => {\n      const fp = footprint.toUpperCase();\n      const pt = part.toUpperCase();\n      const firstRef = (refs[0] || '').toUpperCase();\n      const refPrefix = firstRef.replace(/\\d+/g, '');\n      \n      // 사이즈 추출\n      let size = '1005'; // 기본값\n      if (fp.includes('0603') || pt.includes('0603')) size = '0603';\n      else if (fp.includes('1005') || pt.includes('1005')) size = '1005';\n      else if (fp.includes('1608') || pt.includes('1608')) size = '1608';\n      else if (fp.includes('2012') || pt.includes('2012')) size = '2012';\n      else if (fp.includes('3225') || pt.includes('3225')) size = '3225';\n      \n      // 1. Footprint/Part 패턴으로 먼저 판단\n      // 커패시터: C로 시작하거나 UF, PF, NF 포함\n      if (/^C\\d/.test(pt) || /^C[_-]/.test(pt) || pt.includes('UF') || pt.includes('PF') || pt.includes('NF')) {\n        return `C/C(${size})`;\n      }\n      // 저항: R로 시작하거나 OHM, K_숫자 패턴\n      if (/^R\\d/.test(pt) || /^R[_-]/.test(pt) || pt.includes('OHM') || /R\\d+K/.test(pt)) {\n        return `저항(${size})`;\n      }\n      // IC\n      if (pt.includes('IC') || pt.includes('MAX') || pt.includes('LM') || pt.includes('TPS') || \n          pt.includes('STM') || pt.includes('AD5') || pt.includes('ADS') || pt.includes('PCA') ||\n          pt.includes('TCA') || pt.includes('SN6') || pt.includes('SN7')) {\n        return 'IC(SMD)';\n      }\n      // 트랜지스터\n      if (pt.includes('DMN') || pt.includes('MOSFET') || pt.includes('2N') || /^Q\\d/.test(refPrefix)) {\n        return 'TR(SMD)';\n      }\n      // 다이오드\n      if (pt.includes('DIODE') || pt.includes('1N') || pt.includes('BAT') || pt.includes('D5V') || pt.includes('D10V') || pt.includes('TPD')) {\n        return 'DIODE(SMD)';\n      }\n      // 비드\n      if (pt.includes('BEAD') || pt.includes('BLM') || pt.includes('FB')) {\n        return 'BEAD(2012)';\n      }\n      // 커넥터\n      if (pt.includes('CONN') || pt.includes('B2B') || pt.includes('HEADER') || pt.includes('POGO') || \n          pt.includes('PIN') || fp.includes('CONN') || /^\\d{5}/.test(pt)) {\n        return 'CONNECTOR';\n      }\n      // LED\n      if (pt.includes('LED')) {\n        return 'LED(1608)';\n      }\n      // OSC\n      if (pt.includes('OSC') || pt.includes('XTAL') || pt.includes('CRYSTAL')) {\n        return 'OSC(SMD)';\n      }\n      // 스위치\n      if (pt.includes('SW') || pt.includes('SWITCH')) {\n        return 'S/W(DIP)';\n      }\n      // T/T (탄탈)\n      if (pt.includes('TANT') || pt.includes('T/T')) {\n        return 'T/T';\n      }\n      \n      // 2. REF 접두어로 판단 (fallback)\n      if (refPrefix === 'C') return `C/C(${size})`;\n      if (refPrefix === 'R') return `저항(${size})`;\n      if (refPrefix === 'U') return 'IC(SMD)';\n      if (refPrefix === 'Q') return 'TR(SMD)';\n      if (refPrefix === 'D') return 'DIODE(SMD)';\n      if (refPrefix === 'L' || refPrefix === 'FB' || refPrefix === 'BD') return 'BEAD(2012)';\n      if (refPrefix === 'LED') return 'LED(1608)';\n      if (refPrefix === 'J' || refPrefix === 'CN' || refPrefix === 'CON') return 'CONNECTOR';\n      if (refPrefix === 'SW') return 'S/W(DIP)';\n      if (refPrefix === 'Y' || refPrefix === 'X') return 'OSC(SMD)';\n      \n      return '데이터 없음';\n    };\n    \n    // 종류 결정: 1순위 학습데이터, 2순위 footprint 패턴 추출\n    let finalItemType: string;\n    if (!isManualRequired && !isNewPart && itemType) {\n      // 정상 매핑된 경우\n      finalItemType = Utils.normalizeType(itemType);\n    } else {\n      // 수동확인/새부품이어도 종류는 학습 데이터에서 찾기!\n      const typeFromLearning = mapTypeFromFootprint(item.part, item.footprint, learningData);\n      if (typeFromLearning) {\n        finalItemType = Utils.normalizeType(typeFromLearning);\n      } else {\n        // 학습 데이터에도 없으면 패턴으로 추출\n        finalItemType = extractTypeFromFootprint(item.part, item.footprint, item.refs);\n      }\n    }\n    \n    // BOM 아이템 생성\n    const bomItem: BOMItem = {\n      lineNumber,\n      itemType: finalItemType,\n      itemName: mappedPartName,\n      setCount: item.refs.length,\n      totalQuantity: item.refs.length * productionQuantity,\n      checkStatus: '□양호',\n      refList: item.refs.join(', '),\n      remark: isMisap ? '미삽' : '',\n      isManualRequired,\n      isNewPart,\n      originalPart: item.part,\n      originalFootprint: item.footprint,\n    };\n    \n    bomItems.push(bomItem);\n    lineNumber++;\n    \n    // 좌표 처리\n    for (const ref of item.refs) {\n      const coord = coordMap.get(ref.toUpperCase());\n      if (!coord) continue;\n      \n      const coordItem: CoordinateItem = {\n        type: bomItem.itemType,\n        partName: bomItem.itemName,\n        refDes: ref,\n        layer: coord.layer,\n        locationX: coord.x,\n        locationY: coord.y,\n        rotation: coord.rotation,\n        remark: isMisap ? '미삽' : undefined,\n      };\n      \n      if (coord.layer === 'TOP') {\n        topCoordinates.push(coordItem);\n      } else {\n        bottomCoordinates.push(coordItem);\n      }\n    }\n  }\n  \n  // 5. 종류별 정렬 (대분류 기준으로 그룹핑)\n  // 대분류 순서 (세부 사이즈 무시하고 같은 그룹으로 묶음)\n  const TYPE_GROUP_ORDER = [\n    'IC',       // IC(SMD)\n    'SENSOR',   // SENSOR(SMD)\n    'TR',       // TR(SMD)\n    'DIODE',    // DIODE(SMD)\n    'T/T',      // T/T (탄탈)\n    'C/C',      // C/C(0603), C/C(1005), C/C(1608), C/C(2012), C/C(3225)\n    '저항',     // 저항(1005), 저항(1608), 저항(2012)\n    'BEAD',     // BEAD(2012)\n    'OSC',      // OSC(SMD)\n    'LED',      // LED(1608)\n    'S/W',      // S/W(DIP)\n    'CONNECTOR',// CONNECTOR\n    'PEMNUT',   // PEMNUT\n  ];\n  \n  // 종류에서 대분류 추출\n  const getTypeGroup = (itemType: string): string => {\n    if (!itemType || itemType === '데이터 없음') return '';\n    if (itemType.startsWith('IC')) return 'IC';\n    if (itemType.startsWith('SENSOR')) return 'SENSOR';\n    if (itemType.startsWith('TR')) return 'TR';\n    if (itemType.startsWith('DIODE')) return 'DIODE';\n    if (itemType.startsWith('T/T')) return 'T/T';\n    if (itemType.startsWith('C/C')) return 'C/C';\n    if (itemType.startsWith('저항')) return '저항';\n    if (itemType.startsWith('BEAD')) return 'BEAD';\n    if (itemType.startsWith('OSC')) return 'OSC';\n    if (itemType.startsWith('LED')) return 'LED';\n    if (itemType.startsWith('S/W')) return 'S/W';\n    if (itemType === 'CONNECTOR') return 'CONNECTOR';\n    if (itemType === 'PEMNUT') return 'PEMNUT';\n    return itemType;\n  };\n  \n  // 원본 데이터로 대분류 추측\n  const guessTypeGroupForSort = (item: BOMItem): string => {\n    // 이미 종류가 있으면 대분류 추출\n    if (item.itemType && item.itemType !== '데이터 없음') {\n      return getTypeGroup(item.itemType);\n    }\n    \n    // REF에서 첫 글자로 대분류 추측 (C1 → C, R10 → R)\n    const firstRef = (item.refList || '').split(',')[0].trim().toUpperCase();\n    const refPrefix = firstRef.replace(/\\d+/g, ''); // 숫자 제거하여 접두어만\n    \n    // REF 접두어로 분류\n    if (refPrefix === 'C') return 'C/C';\n    if (refPrefix === 'R') return '저항';\n    if (refPrefix === 'U') return 'IC';\n    if (refPrefix === 'Q') return 'TR';\n    if (refPrefix === 'D') return 'DIODE';\n    if (refPrefix === 'L' || refPrefix === 'FB' || refPrefix === 'BD') return 'BEAD';\n    if (refPrefix === 'LED') return 'LED';\n    if (refPrefix === 'J' || refPrefix === 'CN' || refPrefix === 'CON') return 'CONNECTOR';\n    if (refPrefix === 'SW') return 'S/W';\n    if (refPrefix === 'Y' || refPrefix === 'X') return 'OSC';\n    \n    // 원본 데이터로 대분류 추측\n    const part = (item.originalPart || item.itemName || '').toUpperCase();\n    const footprint = (item.originalFootprint || '').toUpperCase();\n    \n    // 커패시터 (C로 시작)\n    if (/^C\\d/.test(part) || /^C[_-]/.test(part) || part.startsWith('CC') || \n        part.includes('PF') || part.includes('UF') || part.includes('NF')) {\n      return 'C/C';\n    }\n    \n    // 저항 (R로 시작)\n    if (/^R\\d/.test(part) || /^R[_-]/.test(part) || part.includes('OHM') || /^\\d+[KMR]$/.test(part)) {\n      return '저항';\n    }\n    \n    // IC\n    if (/^U\\d/.test(part) || part.includes('IC') || part.includes('MAX') || part.includes('LM') || \n        part.includes('TPS') || part.includes('STM') || part.includes('MC')) {\n      return 'IC';\n    }\n    \n    // 트랜지스터\n    if (/^Q\\d/.test(part) || part.includes('TR') || part.includes('MOSFET') || part.includes('2N')) {\n      return 'TR';\n    }\n    \n    // 다이오드\n    if (/^D\\d/.test(part) || part.includes('DIODE') || part.includes('1N') || part.includes('BAT')) {\n      return 'DIODE';\n    }\n    \n    // LED\n    if (part.includes('LED')) {\n      return 'LED';\n    }\n    \n    // 센서\n    if (part.includes('SENSOR')) {\n      return 'SENSOR';\n    }\n    \n    // 비드\n    if (part.includes('BEAD') || part.includes('FB')) {\n      return 'BEAD';\n    }\n    \n    // 커넥터\n    if (part.includes('CONN') || part.includes('B2B') || part.includes('HEADER') || \n        part.includes('USB') || part.includes('PIN') || /^J\\d/.test(part)) {\n      return 'CONNECTOR';\n    }\n    \n    // 스위치\n    if (part.includes('SW') || part.includes('SWITCH') || part.includes('BTN')) {\n      return 'S/W';\n    }\n    \n    // 오실레이터/크리스탈\n    if (part.includes('OSC') || part.includes('XTAL') || part.includes('CRYSTAL')) {\n      return 'OSC';\n    }\n    \n    // 탄탈 커패시터\n    if (part.includes('T/T') || part.includes('TANT')) {\n      return 'T/T';\n    }\n    \n    // 추측 불가 - 커넥터 앞에 배치\n    return 'CONNECTOR';\n  };\n  \n  // 미삽 여부 체크 함수\n  const checkIsMisap = (itemName: string, remark: string) => {\n    const nameUpper = (itemName || '').toUpperCase();\n    const remarkUpper = (remark || '').toUpperCase();\n    const result = remarkUpper.includes('미삽') || \n      nameUpper.includes('_OPEN') || nameUpper.includes('OPEN_') ||\n      nameUpper.includes('_POGO') || nameUpper.includes('POGO_') ||\n      nameUpper.includes('_PAD') || nameUpper.includes('PAD_') ||\n      nameUpper.includes('_NC') || nameUpper.includes('NC_');\n    return result;\n  };\n  \n  bomItems.sort((a, b) => {\n    const groupA = guessTypeGroupForSort(a);\n    const groupB = guessTypeGroupForSort(b);\n    \n    const orderA = TYPE_GROUP_ORDER.indexOf(groupA);\n    const orderB = TYPE_GROUP_ORDER.indexOf(groupB);\n    \n    // 대분류 순서에 없으면 맨 뒤로\n    const idxA = orderA === -1 ? 999 : orderA;\n    const idxB = orderB === -1 ? 999 : orderB;\n    \n    if (idxA !== idxB) return idxA - idxB;\n    \n    // 같은 대분류면 세부 종류순 (C/C(0603) < C/C(1005) < ...)\n    if (a.itemType !== b.itemType) {\n      return (a.itemType || '').localeCompare(b.itemType || '');\n    }\n    \n    // 같은 종류 내에서 미삽 항목은 맨 아래로\n    const aMisap = checkIsMisap(a.itemName, a.remark);\n    const bMisap = checkIsMisap(b.itemName, b.remark);\n    if (aMisap !== bMisap) {\n      return aMisap ? 1 : -1; // 미삽이면 뒤로\n    }\n    \n    // 같은 종류, 같은 미삽 상태면 품명순\n    return (a.itemName || '').localeCompare(b.itemName || '');\n  });\n  \n  // 정렬 후 lineNumber 재할당\n  bomItems.forEach((item, idx) => {\n    item.lineNumber = idx + 1;\n  });\n  \n  // 좌표 데이터도 동일한 정렬 로직 적용\n  const sortCoordinates = (coords: CoordinateItem[]) => {\n    return coords.sort((a, b) => {\n      // type 기준으로 대분류 그룹 결정\n      const getGroup = (type: string) => {\n        const t = (type || '').toUpperCase();\n        if (t.includes('IC')) return 'IC';\n        if (t.includes('DIODE')) return 'DIODE';\n        if (t.includes('C/C') || t.includes('C_C')) return 'C/C';\n        if (t.includes('저항')) return '저항';\n        if (t.includes('BEAD')) return 'BEAD';\n        if (t.includes('S/W') || t.includes('SW')) return 'S/W';\n        if (t.includes('CONNECTOR') || t.includes('CONN')) return 'CONNECTOR';\n        return 'ETC';\n      };\n      \n      const groupA = getGroup(a.type || '');\n      const groupB = getGroup(b.type || '');\n      \n      const orderA = TYPE_GROUP_ORDER.indexOf(groupA);\n      const orderB = TYPE_GROUP_ORDER.indexOf(groupB);\n      \n      const idxA = orderA === -1 ? 999 : orderA;\n      const idxB = orderB === -1 ? 999 : orderB;\n      \n      if (idxA !== idxB) return idxA - idxB;\n      \n      // 같은 대분류면 type 순\n      if (a.type !== b.type) {\n        return (a.type || '').localeCompare(b.type || '');\n      }\n      \n      // 같은 종류 내에서 미삽 항목은 맨 아래로\n      const aMisap = checkIsMisap(a.partName || '', a.remark || '');\n      const bMisap = checkIsMisap(b.partName || '', b.remark || '');\n      if (aMisap !== bMisap) {\n        return aMisap ? 1 : -1; // 미삽이면 뒤로\n      }\n      \n      // 같은 type, 같은 미삽 상태면 refDes 순\n      return (a.refDes || '').localeCompare(b.refDes || '');\n    });\n  };\n  \n  sortCoordinates(topCoordinates);\n  sortCoordinates(bottomCoordinates);\n  \n  // 미삽 정렬 확인용 디버그 로그\n  const misapItems = bomItems.filter(item => checkIsMisap(item.itemName, item.remark));\n  console.log('🔴 미삽 항목들:', misapItems.map(item => `${item.itemType} - ${item.itemName}`));\n  \n  console.log('✅ BOM/좌표 처리 완료');\n  console.log(`  - 총 항목: ${bomItems.length}`);\n  console.log(`  - 수동 확인 필요: ${manualRequiredCount}`);\n  console.log(`  - 새 부품: ${newPartCount}`);\n  console.log(`  - 미삽: ${misapCount}`);\n  \n  return {\n    bomItems,\n    topCoordinates,\n    bottomCoordinates,\n    summary: {\n      totalItems: bomItems.length,\n      manualRequiredCount,\n      newPartCount,\n      misapCount,\n    },\n  };\n}\n\n// ============================================================\n// 새 부품 저장 (로컬 스토리지)\n// ============================================================\n\nexport function saveNewPartMapping(footprint: string, partName: string, itemType: string) {\n  try {\n    const storageKey = 'v7_new_parts';\n    const existing = JSON.parse(localStorage.getItem(storageKey) || '{}');\n    \n    existing[footprint.toUpperCase()] = {\n      partName,\n      itemType,\n      savedAt: new Date().toISOString(),\n    };\n    \n    localStorage.setItem(storageKey, JSON.stringify(existing));\n    console.log(`✅ 새 부품 저장: ${footprint} → ${partName} (${itemType})`);\n    \n    // 캐시 무효화\n    learningDataCache = null;\n  } catch (error) {\n    console.error('새 부품 저장 실패:', error);\n  }\n}\n\n// ============================================================\n// 학습 데이터 캐시 리셋\n// ============================================================\n\nexport function resetLearningDataCache() {\n  learningDataCache = null;\n}\n\n","import { useState, useCallback, useEffect, useRef, useMemo } from 'react';\nimport { createClient } from '@/lib/supabase/client';\nimport { toast } from 'sonner';\nimport { Package, Upload, FileText, X, AlertCircle, Loader2, Download, Eye, Plus, Check, ChevronsUpDown, RotateCcw, Save, Link2, Trash2 } from 'lucide-react';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Command, CommandEmpty, CommandGroup, CommandInput, CommandItem, CommandList } from '@/components/ui/command';\nimport { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Progress } from '@/components/ui/progress';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { cn } from '@/lib/utils';\nimport GeneratedPreviewPanel, { type GeneratedPreviewPanelRef } from './GeneratedPreviewPanel';\nimport CoordinatePreviewPanel from './CoordinatePreviewPanel';\nimport BomDetailModal from './BomDetailModal';\nimport { \n  processBOMAndCoordinates, \n  type BOMItem, \n  type CoordinateItem,\n  type ProcessedResult \n} from '@/utils/v7-generator';\nimport { \n  generateBOMExcelFromTemplate, \n  downloadExcelBlob,\n  type ExcelMetadata \n} from '@/utils/excel-generator';\n\ninterface FileInfo {\n  bomFile: File | null;\n  coordFile: File | null;\n  bomUrl?: string;\n  coordUrl?: string;\n}\n\ninterface Metadata {\n  boardName: string;\n  artworkManager: string;\n  productionManager: string;\n  productionQuantity: number;\n}\n\nexport default function BomCoordinateIntegrated() {\n  const [viewMode, setViewMode] = useState<'list' | 'create'>('create');\n  const [step, setStep] = useState<'input' | 'processing' | 'preview'>('input');\n  const [fileInfo, setFileInfo] = useState<FileInfo>({\n    bomFile: null,\n    coordFile: null\n  });\n  const [metadata, setMetadata] = useState<Metadata>({\n    boardName: '',\n    artworkManager: '',\n    productionManager: '',\n    productionQuantity: 0\n  });\n  const [employees, setEmployees] = useState<{ id: string; name: string }[]>([]);\n  const [currentUser, setCurrentUser] = useState<{ email: string; name: string } | null>(null);\n  const [loading, setLoading] = useState(false);\n  const [uploading, setUploading] = useState(false);\n  const [openArtworkManager, setOpenArtworkManager] = useState(false);\n  const [openProductionManager, setOpenProductionManager] = useState(false);\n  const [processedResult, setProcessedResult] = useState<any>(null);\n  const [dragActive, setDragActive] = useState<string | null>(null);\n  const [savedBoards, setSavedBoards] = useState<Array<{\n    id: string;\n    board_name: string;\n    created_at: string;\n    artwork_manager?: string;\n    production_manager?: string;\n  }>>([]);\n  const [loadingBoards, setLoadingBoards] = useState(false);\n  const [uploadedFilePaths, setUploadedFilePaths] = useState<{ bomPath: string; coordPath: string } | null>(null);\n  const [errorMessage, setErrorMessage] = useState<string | null>(null);\n  const [progress, setProgress] = useState(0);\n  const [loadingText, setLoadingText] = useState('');\n  const [isMerged, setIsMerged] = useState(false);\n  const [deletingBoardId, setDeletingBoardId] = useState<string | null>(null);\n  const [detailModalBoardId, setDetailModalBoardId] = useState<string | null>(null);\n  const [isDetailModalOpen, setIsDetailModalOpen] = useState(false);\n  const [isSaving, setIsSaving] = useState(false);\n\n  // REF 불일치 수 계산 (BOM vs 좌표)\n  const mismatchCount = useMemo(() => {\n    const bomItems = processedResult?.processedData?.bomItems ?? [];\n    const coords = processedResult?.processedData?.coordinates ?? [];\n\n    const bomRefs = new Set<string>();\n    bomItems.forEach((item: BOMItem) => {\n      const refs = (item.refList || '').split(',').map(r => r.trim().toUpperCase()).filter(Boolean);\n      refs.forEach(ref => bomRefs.add(ref));\n    });\n\n    const coordRefs = new Set<string>();\n    coords.forEach((coord: CoordinateItem) => {\n      const ref = coord?.refDes;\n      if (ref) coordRefs.add(ref.trim().toUpperCase());\n    });\n\n    let missingInCoord = 0;\n    bomRefs.forEach(ref => {\n      if (!coordRefs.has(ref)) missingInCoord += 1;\n    });\n\n    let missingInBom = 0;\n    coordRefs.forEach(ref => {\n      if (!bomRefs.has(ref)) missingInBom += 1;\n    });\n\n    return missingInCoord + missingInBom;\n  }, [processedResult?.processedData?.bomItems, processedResult?.processedData?.coordinates]);\n\n  // 합칠 수 있는 동일 항목이 있는지 체크\n  const hasMergeableItems = (() => {\n    const bomItems = processedResult?.processedData?.bomItems || [];\n    if (bomItems.length === 0) return false;\n    \n    const grouped = new Map<string, number>();\n    bomItems.forEach((item: BOMItem) => {\n      if (item.itemName?.includes('데이터 없음') || item.itemType === '데이터 없음') return;\n      const key = `${item.itemType}|${item.itemName}`;\n      grouped.set(key, (grouped.get(key) || 0) + 1);\n    });\n    \n    return Array.from(grouped.values()).some(count => count > 1);\n  })();\n\n  const supabase = createClient();\n  const previewPanelRef = useRef<GeneratedPreviewPanelRef>(null);\n  const { currentUserRoles } = useAuth();\n  \n  // 관리자 권한 확인\n  const isAdmin = currentUserRoles.includes('app_admin');\n  \n  // localStorage 키 생성 (사용자별 분리)\n  const getTempStorageKey = (userId: string) => `bom_temp_data_${userId}`;\n  \n  // 임시 데이터 저장\n  const saveTempData = (userId: string) => {\n    if (!processedResult || !userId) return;\n    \n    try {\n      const tempData = {\n        step,\n        metadata,\n        processedResult,\n        savedAt: new Date().toISOString()\n      };\n      localStorage.setItem(getTempStorageKey(userId), JSON.stringify(tempData));\n      console.log('✅ 임시 데이터 저장됨');\n    } catch (error) {\n      console.error('임시 데이터 저장 실패:', error);\n    }\n  };\n  \n  // 임시 데이터 불러오기\n  const loadTempData = async (userId: string) => {\n    try {\n      const saved = localStorage.getItem(getTempStorageKey(userId));\n      if (saved) {\n        const tempData = JSON.parse(saved);\n        \n        // 24시간 이상 된 데이터는 삭제\n        const savedAt = new Date(tempData.savedAt);\n        const now = new Date();\n        const hoursDiff = (now.getTime() - savedAt.getTime()) / (1000 * 60 * 60);\n        \n        if (hoursDiff > 24) {\n          localStorage.removeItem(getTempStorageKey(userId));\n          console.log('⏰ 24시간 지난 임시 데이터 삭제됨');\n          return;\n        }\n        \n        // 데이터 복원\n        setStep(tempData.step);\n        setMetadata(tempData.metadata);\n        setProcessedResult(tempData.processedResult);\n        setViewMode('create');\n        console.log('✅ 임시 데이터 복원됨');\n      }\n    } catch (error) {\n      console.error('임시 데이터 불러오기 실패:', error);\n    }\n  };\n  \n  // 임시 데이터 삭제\n  const clearTempData = async () => {\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (user) {\n        localStorage.removeItem(getTempStorageKey(user.id));\n        console.log('🗑️ 임시 데이터 삭제됨');\n      }\n    } catch (error) {\n      console.error('임시 데이터 삭제 실패:', error);\n    }\n  };\n\n  // 직원 목록 및 현재 사용자 정보 로드\n  useEffect(() => {\n    const loadData = async () => {\n      try {\n        // 직원 목록 로드\n        const { data: empData } = await supabase\n          .from('employees')\n          .select('id, name')\n          .order('name');\n        \n        if (empData) {\n          setEmployees(empData);\n        }\n\n        // 현재 사용자 정보 로드\n        const { data: { user } } = await supabase.auth.getUser();\n        if (user && user.email) {\n          const { data: userData } = await supabase\n            .from('employees')\n            .select('id, name')\n            .eq('email', user.email)\n            .single();\n          \n          setCurrentUser({\n            email: user.email,\n            name: userData?.name || user.email.split('@')[0]\n          });\n          \n          // Artwork 담당자 초기값을 현재 사용자 ID로 설정\n          setMetadata(prev => ({\n            ...prev,\n            artworkManager: userData?.id || ''\n          }));\n          \n          // 임시 저장 데이터 복원\n          loadTempData(user.id);\n        }\n      } catch (error) {\n        console.error('Error loading data:', error);\n      }\n    };\n\n    loadData();\n  }, [supabase]);\n\n  // processedResult 변경 시 임시 저장\n  useEffect(() => {\n    const saveTemp = async () => {\n      if (!processedResult || step !== 'preview') return;\n      \n      const { data: { user } } = await supabase.auth.getUser();\n      if (user) {\n        saveTempData(user.id);\n      }\n    };\n    \n    saveTemp();\n  }, [processedResult, metadata, step]);\n\n  // 저장된 보드 목록 로드\n  useEffect(() => {\n    const loadSavedBoards = async () => {\n      if (viewMode !== 'list') return;\n      \n      try {\n        setLoadingBoards(true);\n        const { data: boards, error } = await supabase\n          .from('cad_drawings')\n          .select('id, board_name, created_at, artwork_manager, production_manager')\n          .order('created_at', { ascending: false });\n        \n        if (error) throw error;\n        \n        setSavedBoards(boards || []);\n      } catch (error) {\n        console.error('Error loading saved boards:', error);\n        toast.error('저장된 BOM 목록을 불러오는데 실패했습니다.');\n      } finally {\n        setLoadingBoards(false);\n      }\n    };\n\n    loadSavedBoards();\n  }, [viewMode, supabase]);\n\n  // 파일명에서 보드 이름 추측\n  useEffect(() => {\n    if (fileInfo.bomFile) {\n      let name = fileInfo.bomFile.name;\n      // 확장자 제거\n      name = name.replace(/\\.(xlsx|xls|csv)$/i, '');\n      // .part.BOM, .BOM, _BOM, part.BOM 등 불필요한 접미사 제거 (대소문자 무관)\n      name = name.replace(/(\\.|_|\\s)?(part)?(\\.|_|\\s)?bom$/i, '');\n      // 앞부분의 타임스탬프나 불필요한 접두사 제거\n      name = name.replace(/^\\d+_bom_/, '');\n      \n      // 날짜 포맷 (YYMMDD) 및 _정리본 추가\n      const today = new Date();\n      const dateStr = today.getFullYear().toString().slice(2) + \n        (today.getMonth() + 1).toString().padStart(2, '0') + \n        today.getDate().toString().padStart(2, '0');\n      \n      name = `${name}_${dateStr}_정리본`;\n\n      setMetadata(prev => ({ ...prev, boardName: name }));\n    }\n  }, [fileInfo.bomFile]);\n\n  const handleDrag = useCallback((e: React.DragEvent, type: string) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (e.type === 'dragenter' || e.type === 'dragover') {\n      setDragActive(type);\n    } else if (e.type === 'dragleave') {\n      setDragActive(null);\n    }\n  }, []);\n\n  const handleDrop = useCallback((e: React.DragEvent, type: 'bom' | 'coord') => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragActive(null);\n\n    if (e.dataTransfer.files && e.dataTransfer.files[0]) {\n      const file = e.dataTransfer.files[0];\n      if (type === 'bom') {\n        setFileInfo(prev => ({ ...prev, bomFile: file }));\n      } else {\n        setFileInfo(prev => ({ ...prev, coordFile: file }));\n      }\n    }\n  }, []);\n\n  const handleFileSelect = useCallback((e: React.ChangeEvent<HTMLInputElement>, type: 'bom' | 'coord') => {\n    if (e.target.files && e.target.files[0]) {\n      const file = e.target.files[0];\n      if (type === 'bom') {\n        setFileInfo(prev => ({ ...prev, bomFile: file }));\n      } else {\n        setFileInfo(prev => ({ ...prev, coordFile: file }));\n      }\n    }\n  }, []);\n\n  const handleRemoveFile = useCallback((type: 'bom' | 'coord') => {\n    if (type === 'bom') {\n      setFileInfo(prev => ({ ...prev, bomFile: null, bomUrl: undefined }));\n    } else {\n      setFileInfo(prev => ({ ...prev, coordFile: null, coordUrl: undefined }));\n    }\n  }, []);\n\n  const handleProcess = async () => {\n    if (!fileInfo.bomFile || !fileInfo.coordFile) {\n      toast.error('BOM 파일과 좌표 파일을 모두 선택해주세요.');\n      return;\n    }\n\n    if (!metadata.boardName.trim()) {\n      toast.error('보드 이름을 입력해주세요.');\n      return;\n    }\n\n    if (!metadata.productionManager || metadata.productionManager === 'none') {\n      toast.error('생산 담당자를 선택해주세요.');\n      return;\n    }\n\n    if (metadata.productionQuantity <= 0) {\n      toast.error('생산 수량을 입력해주세요 (1 이상).');\n      return;\n    }\n\n    let timer: NodeJS.Timeout | null = null;\n    let textTimer: NodeJS.Timeout | null = null;\n\n    try {\n      setUploading(true);\n      setStep('processing');\n      setErrorMessage(null);\n      setProgress(0);\n      setLoadingText('파일 업로드 준비 중...');\n\n      // 예상 소요 시간 계산\n      const totalSize = (fileInfo.bomFile?.size || 0) + (fileInfo.coordFile?.size || 0);\n      const estimatedDuration = 15000 + (totalSize / 1024) * 50; \n      \n      const updateInterval = 500;\n      const totalSteps = estimatedDuration / updateInterval;\n      const incrementPerStep = 90 / totalSteps;\n\n      // 진행률 애니메이션 시작\n      timer = setInterval(() => {\n        setProgress((oldProgress) => {\n          if (oldProgress >= 95) {\n            return oldProgress;\n          }\n          const randomFactor = Math.random() * 0.5 + 0.8;\n          return Math.min(oldProgress + (incrementPerStep * randomFactor), 95);\n        });\n      }, updateInterval);\n\n      // 텍스트 변경 타이머\n      textTimer = setInterval(() => {\n        setLoadingText((current) => {\n          if (current === '파일 업로드 준비 중...') return 'BOM 파일 읽는 중...';\n          if (current === 'BOM 파일 읽는 중...') return '데이터 구조 분석 중...';\n          if (current === '데이터 구조 분석 중...') return '좌표 데이터 매칭 중...';\n          if (current === '좌표 데이터 매칭 중...') return 'AI가 최종 정리 중입니다...';\n          if (current === 'AI가 최종 정리 중입니다...') return '거의 다 되었습니다. 잠시만요!';\n          return current;\n        });\n      }, estimatedDuration / 5);\n\n      // 1. 파일 업로드 (Storage) - 로직 유지\n      // ... (파일 업로드 코드는 그대로 둠) ...\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('로그인이 필요합니다.');\n\n      const timestamp = Date.now();\n      const sanitizeFileName = (fileName: string) => {\n        const lastDotIndex = fileName.lastIndexOf('.');\n        const extension = lastDotIndex > -1 ? fileName.slice(lastDotIndex) : '';\n        const nameWithoutExt = lastDotIndex > -1 ? fileName.slice(0, lastDotIndex) : fileName;\n        const safeName = nameWithoutExt\n          .replace(/[^a-zA-Z0-9\\-_]/g, '_')\n          .replace(/_+/g, '_')\n          .replace(/^_|_$/g, '');\n        return (safeName || 'file') + extension;\n      };\n\n      const safeBomFileName = sanitizeFileName(fileInfo.bomFile.name);\n      const safeCoordFileName = sanitizeFileName(fileInfo.coordFile.name);\n      const bomPath = `raw/${timestamp}_bom_${safeBomFileName}`;\n      const coordPath = `raw/${timestamp}_coord_${safeCoordFileName}`;\n\n      // 파일 업로드\n      const bomResult = await supabase.storage\n        .from('bom-files')\n        .upload(bomPath, fileInfo.bomFile, { cacheControl: '3600', upsert: true });\n\n      if (bomResult.error) throw bomResult.error;\n\n      const coordResult = await supabase.storage\n        .from('bom-files')\n        .upload(coordPath, fileInfo.coordFile, { cacheControl: '3600', upsert: true });\n\n      if (coordResult.error) {\n        await supabase.storage.from('bom-files').remove([bomPath]);\n        throw coordResult.error;\n      }\n\n      // Signed URL 생성\n      const { data: bomUrlData } = await supabase.storage\n        .from('bom-files')\n        .createSignedUrl(bomPath, 60 * 60);\n\n      const { data: coordUrlData } = await supabase.storage\n        .from('bom-files')\n        .createSignedUrl(coordPath, 60 * 60);\n\n      if (!bomUrlData?.signedUrl || !coordUrlData?.signedUrl) {\n        throw new Error('파일 URL 생성 실패');\n      }\n\n      // 업로드된 파일 경로 저장 (나중에 DB에 저장할 때 사용)\n      setUploadedFilePaths({ bomPath, coordPath });\n\n      // 2. v7 엔진으로 BOM/좌표 처리 (학습 데이터 기반)\n      console.log('Processing BOM with v7 engine...');\n      setLoadingText('학습 데이터 기반 분석 중...');\n      \n      // v7-generator로 처리\n      const processedData = await processBOMAndCoordinates(\n        fileInfo.bomFile,\n        fileInfo.coordFile,\n        metadata.productionQuantity\n      );\n\n      if (timer) clearInterval(timer);\n      if (textTimer) clearInterval(textTimer);\n      setProgress(100);\n      setLoadingText('완료!');\n\n      if (!processedData || !processedData.bomItems) {\n        throw new Error('BOM 처리 결과가 올바르지 않습니다.');\n      }\n\n      // 3. 결과 데이터 구조화 (임시 ID 부여)\n      const resultWithId = {\n        cadDrawingId: `cad_${Date.now()}`,\n        processedData: {\n          bomItems: processedData.bomItems,\n          topCoordinates: processedData.topCoordinates,\n          bottomCoordinates: processedData.bottomCoordinates,\n          coordinates: [...processedData.topCoordinates, ...processedData.bottomCoordinates],\n          summary: processedData.summary\n        }\n      };\n\n      setProcessedResult(resultWithId);\n      toast.success('BOM 분석 및 정리가 완료되었습니다.');\n      setStep('preview');\n\n    } catch (error: any) {\n      console.error('Processing error:', error);\n      const msg = `처리 중 오류가 발생했습니다: ${error.message || error}`;\n      setErrorMessage(msg);\n      \n      if (timer) clearInterval(timer);\n      if (textTimer) clearInterval(textTimer);\n      \n      setUploading(false);\n      setStep('input'); \n      window.scrollTo({ top: 0, behavior: 'smooth' });\n    } finally {\n      // 성공 시에는 위에서 clearInterval 등을 처리했음\n      // 실패 시에만 여기가 실행될 수 있는데, 중복 실행 방지\n      if (step === 'processing' && errorMessage) {\n         setUploading(false);\n      }\n    }\n  };\n\n  const handleSaveBOM = async (items: BOMItem[]) => {\n    if (!processedResult?.cadDrawingId) return;\n\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('로그인이 필요합니다.');\n\n      // 1. cad_drawings 테이블에 보드 정보 저장/업데이트\n      let cadDrawingId = processedResult.cadDrawingId;\n      \n      // 담당자 이름 가져오기 (ID로 저장되어 있으므로 employees에서 이름 찾기)\n      const artworkManagerName = employees.find(emp => emp.id === metadata.artworkManager)?.name || currentUser?.name || '';\n      const productionManagerName = employees.find(emp => emp.id === metadata.productionManager)?.name || metadata.productionManager;\n      \n      // cadDrawingId가 임시 ID인 경우 (새로 생성)\n      if (cadDrawingId.startsWith('cad_')) {\n        // 보드명에서 기존 날짜/정리본 패턴 제거 후 새 날짜 추가\n        const today = new Date();\n        const dateStr = today.getFullYear().toString().slice(2) + \n          String(today.getMonth() + 1).padStart(2, '0') + \n          String(today.getDate()).padStart(2, '0');\n        \n        // 기존 패턴 제거 후 새 날짜 추가\n        const cleanBoardName = metadata.boardName.trim()\n          .replace(/_\\d{6}_정리본$/, '')\n          .replace(/_정리본$/, '')\n          .replace(/_\\d{6}$/, '');\n        const saveBoardName = `${cleanBoardName}_${dateStr}_정리본`;\n\n        // 항상 새로 생성 (날짜로 구분되므로)\n        const { data: newBoard, error: boardError } = await supabase\n          .from('cad_drawings')\n          .insert({ \n            board_name: saveBoardName,\n            artwork_manager: artworkManagerName,\n            production_manager: productionManagerName,\n            production_quantity: metadata.productionQuantity\n          })\n          .select('id')\n          .single();\n\n        if (boardError) throw boardError;\n        cadDrawingId = newBoard.id;\n      }\n      \n      // 담당자 정보 업데이트 (기존 보드인 경우에만)\n      if (!processedResult.cadDrawingId.startsWith('cad_')) {\n        await supabase\n          .from('cad_drawings')\n          .update({ \n            artwork_manager: artworkManagerName,\n            production_manager: productionManagerName,\n            production_quantity: metadata.productionQuantity\n          })\n          .eq('id', cadDrawingId);\n      }\n\n      // 2. 원본 파일 정보 저장 (bom_raw_files)\n      if (fileInfo.bomFile && fileInfo.coordFile && uploadedFilePaths) {\n        let bomFileUrl = '';\n        let coordFileUrl = '';\n\n        // Storage에서 Signed URL 생성 (1년 유효)\n        const { data: bomUrlData } = await supabase.storage\n          .from('bom-files')\n          .createSignedUrl(uploadedFilePaths.bomPath, 60 * 60 * 24 * 365);\n\n        const { data: coordUrlData } = await supabase.storage\n          .from('bom-files')\n          .createSignedUrl(uploadedFilePaths.coordPath, 60 * 60 * 24 * 365);\n\n        if (bomUrlData?.signedUrl) bomFileUrl = bomUrlData.signedUrl;\n        if (coordUrlData?.signedUrl) coordFileUrl = coordUrlData.signedUrl;\n\n        // bom_raw_files에 저장 (기존 데이터가 있으면 업데이트, 없으면 삽입)\n        const { data: existingRawFile } = await supabase\n          .from('bom_raw_files')\n          .select('id')\n          .eq('cad_drawing_id', cadDrawingId)\n          .single();\n\n        if (existingRawFile) {\n          const { error: updateRawError } = await supabase\n            .from('bom_raw_files')\n            .update({\n              bom_file_url: bomFileUrl,\n              coordinate_file_url: coordFileUrl,\n              bom_file_name: fileInfo.bomFile.name,\n              coordinate_file_name: fileInfo.coordFile.name,\n              uploaded_by: user.email || user.id\n            })\n            .eq('id', existingRawFile.id);\n\n          if (updateRawError) throw updateRawError;\n        } else {\n          const { error: insertRawError } = await supabase\n            .from('bom_raw_files')\n            .insert({\n              cad_drawing_id: cadDrawingId,\n              bom_file_url: bomFileUrl,\n              coordinate_file_url: coordFileUrl,\n              bom_file_name: fileInfo.bomFile.name,\n              coordinate_file_name: fileInfo.coordFile.name,\n              uploaded_by: user.email || user.id\n            });\n\n          if (insertRawError) throw insertRawError;\n        }\n      }\n\n      // 3. 기존 bom_items 삭제 후 새로 저장\n      const { error: deleteError } = await supabase\n        .from('bom_items')\n        .delete()\n        .eq('cad_drawing_id', cadDrawingId);\n\n      if (deleteError) throw deleteError;\n\n      const { error: insertError } = await supabase\n        .from('bom_items')\n        .insert(\n          items.map((item: BOMItem) => ({\n            cad_drawing_id: cadDrawingId,\n            line_number: item.lineNumber,\n            item_type: item.itemType,\n            item_name: item.itemName,\n            specification: item.originalFootprint || '',\n            set_count: item.setCount,\n            total_quantity: item.totalQuantity,\n            stock_quantity: item.stockQuantity || 0,\n            check_status: item.checkStatus,\n            ref_list: Array.isArray(item.refList) ? item.refList : (item.refList ? item.refList.split(',').map((r: string) => r.trim()) : []),\n            alternative_item: item.alternativeItem || '',\n            remark: item.remark || ''\n          }))\n        );\n\n      if (insertError) throw insertError;\n\n      // 4. 좌표 데이터도 저장 (part_placements)\n      if (processedResult.processedData?.coordinates) {\n        const { error: deleteCoordError } = await supabase\n          .from('part_placements')\n          .delete()\n          .eq('cad_drawing_id', cadDrawingId);\n\n        if (deleteCoordError) throw deleteCoordError;\n\n        const { error: insertCoordError } = await supabase\n          .from('part_placements')\n          .insert(\n            processedResult.processedData.coordinates.map((coord: CoordinateItem) => ({\n              cad_drawing_id: cadDrawingId,\n              ref: coord.refDes,\n              part_name: coord.partName,\n              part_type: coord.type,\n              side: coord.layer,\n              x_coordinate: coord.locationX || 0,\n              y_coordinate: coord.locationY || 0,\n              angle: coord.rotation || null\n            }))\n          );\n\n        if (insertCoordError) throw insertCoordError;\n      }\n\n      // 5. AI 학습 데이터 저장 (중요: 지속적인 학습을 위해 원본과 결과 저장)\n      // 사용자가 최종 수정한 데이터(items, processedResult.processedData.coordinates)가 정답 데이터가 됨\n      if (uploadedFilePaths) { // 원본 파일 경로가 있을 때만\n        // 텍스트 내용은 클라이언트에서 다시 읽어오기 번거로우므로, 일단 파일 경로와 결과 데이터만 저장하거나\n        // 추후 Edge Function이 복구되면 거기서 처리. \n        // 현재는 DB에 파일 경로와 결과 JSON을 저장하여 나중에 파인튜닝에 활용\n        \n        /* 학습 데이터 저장 로직 (ai_learning_records 테이블) */\n        const { error: learningError } = await supabase\n          .from('ai_learning_records')\n          .insert({\n            cad_drawing_id: cadDrawingId,\n            // 원본 데이터는 URL로 참조하거나, 필요시 텍스트로 저장해야 함. \n            // 여기서는 메타데이터 위주로 저장\n            processed_bom_data: items, // 사용자가 검수/수정한 최종 BOM\n            processed_coordinate_data: processedResult.processedData?.coordinates,\n            cad_program_type: 'unknown', // 추후 분석 가능\n            created_at: new Date().toISOString()\n          });\n          \n        if (learningError) {\n            console.warn('학습 데이터 저장 실패 (기능에는 영향 없음):', learningError);\n        }\n      }\n      \n      // cadDrawingId 업데이트\n      setProcessedResult((prev: any) => ({\n        ...prev,\n        cadDrawingId: cadDrawingId,\n        processedData: {\n          ...prev.processedData,\n          bomItems: items\n        }\n      }));\n\n      toast.success('수정사항이 저장되었습니다.');\n      \n      // 저장 완료 시 임시 데이터 삭제 및 로컬 상태 초기화\n      clearTempData();\n      handleReset();\n      \n      // 목록 뷰로 전환하여 새로 저장된 항목 확인 가능\n      setTimeout(() => {\n        setViewMode('list');\n      }, 1000);\n\n    } catch (error: any) {\n      console.error('Save error:', error);\n      toast.error(`저장에 실패했습니다: ${error.message}`);\n    }\n  };\n\n  const handleReset = () => {\n    setStep('input');\n    setFileInfo({ bomFile: null, coordFile: null });\n    setMetadata(prev => ({\n      ...prev,\n      boardName: '',\n      productionManager: '',\n      productionQuantity: 0\n    }));\n    setProcessedResult(null);\n    setUploadedFilePaths(null);\n    // 초기화 시에는 임시 데이터 유지 (저장/24시간 경과만 삭제)\n  };\n\n  // BOM 수정 시 좌표 데이터 실시간 동기화\n  const handleBomChange = (updatedBomItems: BOMItem[]) => {\n    if (!processedResult?.processedData?.coordinates) return;\n    \n    // BOM의 refList에서 각 Ref별 종류/품명 매핑 생성\n    const refToItemMap = new Map<string, { type: string; partName: string }>();\n    \n    updatedBomItems.forEach(item => {\n      const refs = (item.refList || '').split(',').map(r => r.trim()).filter(r => r);\n      refs.forEach(ref => {\n        refToItemMap.set(ref.toUpperCase(), {\n          type: item.itemType || '',\n          partName: item.itemName || ''\n        });\n      });\n    });\n    \n    // 좌표 데이터 업데이트\n    const updatedCoordinates = processedResult.processedData.coordinates.map((coord: CoordinateItem) => {\n      const refKey = (coord.refDes || '').toUpperCase();\n      const bomInfo = refToItemMap.get(refKey);\n      \n      if (bomInfo) {\n        return {\n          ...coord,\n          type: bomInfo.type,\n          partName: bomInfo.partName\n        };\n      }\n      return coord;\n    });\n    \n    // processedResult 업데이트\n    setProcessedResult((prev: any) => ({\n      ...prev,\n      processedData: {\n        ...prev.processedData,\n        bomItems: updatedBomItems,\n        coordinates: updatedCoordinates\n      }\n    }));\n  };\n\n  // 저장된 BOM 다운로드\n  const handleDownloadSavedBOM = async (boardId: string, boardName: string) => {\n    try {\n      // 보드 정보 가져오기 (담당자 정보 포함)\n      const { data: boardInfo, error: boardError } = await supabase\n        .from('cad_drawings')\n        .select('artwork_manager, production_manager, production_quantity')\n        .eq('id', boardId)\n        .single();\n      \n      if (boardError) throw boardError;\n\n      // BOM 아이템 가져오기\n      const { data: bomItems, error: bomError } = await supabase\n        .from('bom_items')\n        .select('*')\n        .eq('cad_drawing_id', boardId)\n        .order('line_number');\n      \n      if (bomError) throw bomError;\n\n      // 좌표 데이터 가져오기\n      const { data: coordinates, error: coordError } = await supabase\n        .from('part_placements')\n        .select('*')\n        .eq('cad_drawing_id', boardId);\n      \n      if (coordError) throw coordError;\n\n      // BOMItem 형식으로 변환\n      const convertedBOMItems: BOMItem[] = (bomItems || []).map((item: any) => ({\n        lineNumber: item.line_number,\n        itemType: item.item_type || '',\n        itemName: item.item_name,\n        specification: item.specification || '',\n        setCount: item.set_count,\n        totalQuantity: item.total_quantity || 0,\n        stockQuantity: item.stock_quantity || 0,\n        checkStatus: item.check_status || '□양호',\n        refList: Array.isArray(item.ref_list) ? item.ref_list.join(',') : (item.ref_list || ''),\n        alternativeItem: item.alternative_item || '',\n        remark: item.remark || ''\n      }));\n\n      // CoordinateItem 형식으로 변환\n      const convertedCoords: CoordinateItem[] = (coordinates || []).map((coord: any) => ({\n        ref: coord.ref,\n        partName: coord.part_name,\n        partType: coord.part_type || 'SMD',\n        side: coord.side,\n        x: coord.x_coordinate.toString(),\n        y: coord.y_coordinate.toString(),\n        angle: coord.angle?.toString() || '0'\n      }));\n\n      // Excel 생성 및 다운로드 - DB에서 가져온 담당자 정보 사용\n      const excelMetadata: ExcelMetadata = {\n        boardName,\n        artworkManager: boardInfo?.artwork_manager || currentUser?.name || '',\n        productionManager: boardInfo?.production_manager || '',\n        productionQuantity: boardInfo?.production_quantity || (convertedBOMItems[0]?.totalQuantity && convertedBOMItems[0]?.setCount \n          ? Math.round(convertedBOMItems[0].totalQuantity / convertedBOMItems[0].setCount)\n          : 0)\n      };\n\n      // TOP/BOTTOM 분리\n      const topCoords = convertedCoords.filter((c: any) => \n        c.side?.toUpperCase().includes('TOP') || c.layer?.toUpperCase().includes('TOP')\n      );\n      const bottomCoords = convertedCoords.filter((c: any) => \n        c.side?.toUpperCase().includes('BOT') || c.layer?.toUpperCase().includes('BOT')\n      );\n\n      const blob = await generateBOMExcelFromTemplate(\n        convertedBOMItems,\n        topCoords,\n        bottomCoords,\n        excelMetadata\n      );\n      \n      // 파일명: 보드명_YYMMDD_정리본.xlsx (날짜는 저장 시점)\n      const today = new Date();\n      const dateStr = today.getFullYear().toString().slice(2) + \n        String(today.getMonth() + 1).padStart(2, '0') + \n        String(today.getDate()).padStart(2, '0');\n      // 순서 중요: 복합 패턴 먼저 제거\n      const cleanName = boardName.trim()\n        .replace(/_\\d{6}_정리본$/, '')\n        .replace(/_정리본$/, '')\n        .replace(/_\\d{6}$/, '');\n      const fileName = `${cleanName}_${dateStr}_정리본.xlsx`;\n      \n      downloadExcelBlob(blob, fileName);\n      \n      toast.success('엑셀 파일이 다운로드되었습니다.');\n    } catch (error: any) {\n      console.error('Download error:', error);\n      toast.error(`다운로드 중 오류가 발생했습니다: ${error.message}`);\n    }\n  };\n\n\n  // 저장된 BOM 삭제 (app_admin만 가능)\n  const handleDeleteSavedBOM = async (boardId: string, boardName: string) => {\n    if (!isAdmin) {\n      toast.error('삭제 권한이 없습니다.');\n      return;\n    }\n\n    // 삭제 확인\n    const confirmed = window.confirm(`\"${boardName}\" BOM을 삭제하시겠습니까?\\n\\n관련된 모든 데이터(BOM 항목, 좌표 데이터, 원본 파일 정보)가 함께 삭제됩니다.`);\n    if (!confirmed) return;\n\n    try {\n      setDeletingBoardId(boardId);\n\n      // 1. 관련 데이터 삭제 (외래키 관계가 있는 테이블들)\n      // bom_items 삭제\n      const { error: bomItemsError } = await supabase\n        .from('bom_items')\n        .delete()\n        .eq('cad_drawing_id', boardId);\n      \n      if (bomItemsError) {\n        console.warn('bom_items 삭제 실패:', bomItemsError);\n      }\n\n      // part_placements 삭제\n      const { error: placementsError } = await supabase\n        .from('part_placements')\n        .delete()\n        .eq('cad_drawing_id', boardId);\n      \n      if (placementsError) {\n        console.warn('part_placements 삭제 실패:', placementsError);\n      }\n\n      // bom_raw_files에서 파일 경로 가져온 후 삭제\n      const { data: rawFilesData } = await supabase\n        .from('bom_raw_files')\n        .select('bom_file_url, coordinate_file_url')\n        .eq('cad_drawing_id', boardId);\n\n      // Storage에서 파일 삭제 (URL에서 경로 추출)\n      if (rawFilesData && rawFilesData.length > 0) {\n        for (const file of rawFilesData) {\n          // URL에서 Storage 경로 추출 (예: bom-files/uploads/xxx.xlsx)\n          try {\n            if (file.bom_file_url) {\n              const bomPath = file.bom_file_url.split('/bom-files/')[1]?.split('?')[0];\n              if (bomPath) {\n                await supabase.storage.from('bom-files').remove([decodeURIComponent(bomPath)]);\n              }\n            }\n            if (file.coordinate_file_url) {\n              const coordPath = file.coordinate_file_url.split('/bom-files/')[1]?.split('?')[0];\n              if (coordPath) {\n                await supabase.storage.from('bom-files').remove([decodeURIComponent(coordPath)]);\n              }\n            }\n          } catch (storageError) {\n            console.warn('Storage 파일 삭제 실패:', storageError);\n          }\n        }\n      }\n\n      // bom_raw_files 레코드 삭제\n      const { error: rawFilesError } = await supabase\n        .from('bom_raw_files')\n        .delete()\n        .eq('cad_drawing_id', boardId);\n      \n      if (rawFilesError) {\n        console.warn('bom_raw_files 삭제 실패:', rawFilesError);\n      }\n\n      // ai_learning_records는 학습 데이터이므로 삭제하지 않음 (유지)\n\n      // 2. 메인 cad_drawings 삭제\n      const { error: cadError } = await supabase\n        .from('cad_drawings')\n        .delete()\n        .eq('id', boardId);\n\n      if (cadError) throw cadError;\n\n      // 3. 로컬 상태 업데이트\n      setSavedBoards(prev => prev.filter(board => board.id !== boardId));\n      \n      toast.success(`\"${boardName}\" BOM이 삭제되었습니다.`);\n    } catch (error: any) {\n      console.error('Delete error:', error);\n      toast.error(`삭제 중 오류가 발생했습니다: ${error.message}`);\n    } finally {\n      setDeletingBoardId(null);\n    }\n  };\n\n  return (\n    <div className=\"w-full\">\n      {/* Header */}\n      <div className=\"mb-4\">\n        <div>\n          <h1 className=\"page-title\">BOM/좌표 정리</h1>\n          <div className=\"flex justify-between items-center\" style={{marginTop:'-2px',marginBottom:'-4px'}}>\n            <p className=\"page-subtitle mb-0\">BOM & Coordinate Management</p>\n            <div className=\"flex gap-2\">\n              <Button\n                onClick={() => {\n                  setViewMode('create');\n                  setStep('input');\n                  handleReset();\n                  clearTempData(); // 새로 만들기 시 임시 데이터 삭제\n                }}\n                className={`button-base ${\n                  viewMode === 'create' \n                    ? 'bg-hansl-600 hover:bg-hansl-700 text-white' \n                    : 'border border-gray-300 bg-white text-gray-700 hover:bg-gray-50'\n                }`}\n              >\n                <Plus className=\"w-4 h-4 mr-2\" />\n                새로 만들기\n              </Button>\n              <Button\n                onClick={() => {\n                  setViewMode('list');\n                  setStep('input');\n                }}\n                className={`button-base ${\n                  viewMode === 'list' \n                    ? 'bg-hansl-600 hover:bg-hansl-700 text-white' \n                    : 'border border-gray-300 bg-white text-gray-700 hover:bg-gray-50'\n                }`}\n              >\n                <Eye className=\"w-4 h-4 mr-2\" />\n                저장된 목록\n              </Button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* 저장된 BOM 목록 */}\n      {viewMode === 'list' && (\n        <div className=\"space-y-4\">\n          <Card>\n            <CardContent className=\"p-4 sm:p-6\">\n              {loadingBoards ? (\n                <div className=\"flex items-center justify-center py-12\">\n                  <Loader2 className=\"w-6 h-6 text-hansl-600 animate-spin mr-2\" />\n                  <span className=\"text-sm text-gray-600\">목록을 불러오는 중...</span>\n                </div>\n              ) : savedBoards.length === 0 ? (\n                <div className=\"text-center py-12\">\n                  <Package className=\"w-12 h-12 mx-auto mb-3 text-gray-300\" />\n                  <p className=\"text-sm text-gray-500 mb-4\">저장된 BOM이 없습니다.</p>\n                  <Button\n                    onClick={() => setViewMode('create')}\n                    className=\"button-base bg-hansl-600 hover:bg-hansl-700 text-white\"\n                  >\n                    <Plus className=\"w-4 h-4 mr-2\" />\n                    새 BOM 만들기\n                  </Button>\n                </div>\n              ) : (\n                <div className=\"space-y-3\">\n                  <div className=\"flex justify-between items-center mb-4\">\n                    <div>\n                      <h3 className=\"page-title\">저장된 BOM 목록</h3>\n                      <p className=\"page-subtitle\">저장된 BOM을 확인하고 다운로드할 수 있습니다.</p>\n                    </div>\n                  </div>\n                  <div className=\"border rounded-lg overflow-hidden bg-white shadow-sm\">\n                    <div className=\"overflow-x-auto\">\n                      <Table className=\"table-auto\">\n                        <TableHeader className=\"bg-gray-50 sticky top-0 z-10\">\n                          <TableRow className=\"h-6\">\n                            <TableHead className=\"w-[50px] text-center !py-1 !h-auto\">\n                              <span className=\"card-description\">No</span>\n                            </TableHead>\n                            <TableHead className=\"min-w-[200px] !py-1 !h-auto\">\n                              <span className=\"card-description\">보드명</span>\n                            </TableHead>\n                            <TableHead className=\"w-[100px] text-center !py-1 !h-auto\">\n                              <span className=\"card-description\">아트웍 담당</span>\n                            </TableHead>\n                            <TableHead className=\"w-[100px] text-center !py-1 !h-auto\">\n                              <span className=\"card-description\">생산 담당</span>\n                            </TableHead>\n                            <TableHead className=\"w-[100px] text-center !py-1 !h-auto\">\n                              <span className=\"card-description\">생성일</span>\n                            </TableHead>\n                            <TableHead className=\"w-[120px] text-center !py-1 !h-auto\">\n                              <span className=\"card-description\">액션</span>\n                            </TableHead>\n                          </TableRow>\n                        </TableHeader>\n                        <TableBody>\n                          {savedBoards.map((board, index) => (\n                            <TableRow \n                              key={board.id} \n                              className=\"hover:bg-gray-50 cursor-pointer\"\n                              onClick={() => {\n                                setDetailModalBoardId(board.id);\n                                setIsDetailModalOpen(true);\n                              }}\n                            >\n                              <TableCell className=\"text-center py-1\">\n                                <span className=\"card-subtitle\">{index + 1}</span>\n                              </TableCell>\n                              <TableCell className=\"py-1\">\n                                <span className=\"text-[11px] font-medium text-gray-900\">{board.board_name}</span>\n                              </TableCell>\n                              <TableCell className=\"text-center py-1\">\n                                <span className=\"text-[10px] text-gray-600\">{board.artwork_manager || '-'}</span>\n                              </TableCell>\n                              <TableCell className=\"text-center py-1\">\n                                <span className=\"text-[10px] text-gray-600\">{board.production_manager || '-'}</span>\n                              </TableCell>\n                              <TableCell className=\"text-center py-1\">\n                                <span className=\"text-[10px] text-gray-500\">\n                                  {new Date(board.created_at).toLocaleDateString('ko-KR', {\n                                    year: 'numeric',\n                                    month: '2-digit',\n                                    day: '2-digit'\n                                  })}\n                                </span>\n                              </TableCell>\n                              <TableCell className=\"text-center py-1\" onClick={(e) => e.stopPropagation()}>\n                                <div className=\"flex gap-1 justify-center\">\n                                  <Button\n                                    onClick={() => handleDownloadSavedBOM(board.id, board.board_name)}\n                                    variant=\"outline\"\n                                    size=\"sm\"\n                                    className=\"h-6 px-2 text-[10px] text-green-600 hover:text-green-700 hover:bg-green-50 border-green-200\"\n                                  >\n                                    <Download className=\"w-3 h-3 mr-1\" />\n                                    Excel\n                                  </Button>\n                                  {isAdmin && (\n                                    <Button\n                                      onClick={() => handleDeleteSavedBOM(board.id, board.board_name)}\n                                      variant=\"outline\"\n                                      size=\"sm\"\n                                      disabled={deletingBoardId === board.id}\n                                      className=\"h-6 px-2 text-[10px] text-red-600 hover:text-red-700 hover:bg-red-50 border-red-200\"\n                                    >\n                                      {deletingBoardId === board.id ? (\n                                        <Loader2 className=\"w-3 h-3 animate-spin\" />\n                                      ) : (\n                                        <Trash2 className=\"w-3 h-3\" />\n                                      )}\n                                    </Button>\n                                  )}\n                                </div>\n                              </TableCell>\n                            </TableRow>\n                          ))}\n                        </TableBody>\n                        <tfoot className=\"bg-gray-50 border-t\">\n                          <tr>\n                            <td colSpan={isAdmin ? 7 : 6} className=\"py-2 px-4\">\n                              <span className=\"card-description\">총 {savedBoards.length}개 항목</span>\n                            </td>\n                          </tr>\n                        </tfoot>\n                      </Table>\n                    </div>\n                  </div>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n      )}\n\n      {/* 새로 만들기 / 미리보기 */}\n      {viewMode === 'create' && (\n        <>\n      {/* 메인 컨텐츠 */}\n      {step === 'input' && (\n        <div className=\"space-y-4\">\n          {errorMessage && (\n            <div className=\"bg-red-50 border border-red-200 text-red-700 px-6 py-4 rounded-lg text-sm flex flex-col gap-2 shadow-sm animate-in fade-in slide-in-from-top-2\">\n              <div className=\"flex items-center gap-2 font-semibold\">\n                <AlertCircle className=\"w-5 h-5 flex-shrink-0 text-red-600\" />\n                <span>오류가 발생했습니다</span>\n              </div>\n              <p className=\"pl-7\">{errorMessage}</p>\n              {errorMessage.includes('quota') && (\n                <p className=\"pl-7 text-xs text-red-600 mt-1\">\n                  * OpenAI 결제 정보가 반영되기까지 최대 10~20분이 소요될 수 있습니다. 잠시 후 다시 시도해주세요.\n                </p>\n              )}\n            </div>\n          )}\n          \n          {/* 파일 업로드 영역 */}\n          <Card>\n            <CardContent className=\"py-4\">\n              <div className=\"flex flex-col lg:flex-row gap-4 lg:gap-6 items-stretch\">\n                {/* 왼쪽: 파일 업로드 (50%) */}\n                <div className=\"w-full lg:w-[50%] grid grid-cols-1 sm:grid-cols-2 gap-3\">\n                  {/* BOM 파일 업로드 */}\n                  <div \n                    className={cn(\n                      \"border-2 border-dashed rounded-lg p-2 text-center transition-colors cursor-pointer relative flex flex-col items-center justify-center h-full\",\n                      dragActive === 'bom' ? \"border-primary bg-primary/5\" : \"border-gray-200 hover:border-gray-300\",\n                      fileInfo.bomFile ? \"bg-green-50 border-green-200\" : \"\"\n                    )}\n                    onDragEnter={(e) => handleDrag(e, 'bom')}\n                    onDragLeave={(e) => handleDrag(e, 'bom')}\n                    onDragOver={(e) => handleDrag(e, 'bom')}\n                    onDrop={(e) => handleDrop(e, 'bom')}\n                    onClick={() => document.getElementById('bom-upload')?.click()}\n                  >\n                    <input \n                      id=\"bom-upload\" \n                      type=\"file\" \n                      className=\"hidden\" \n                      accept=\".xlsx,.xls\" \n                      onChange={(e) => handleFileSelect(e, 'bom')}\n                    />\n                    \n                    {fileInfo.bomFile ? (\n                      <div className=\"flex flex-col items-center gap-1 w-full px-1\">\n                        <span className=\"text-xs font-bold text-green-600\">BOM</span>\n                        <p className=\"text-[10px] font-medium text-green-700 w-full text-center break-all line-clamp-2\" title={fileInfo.bomFile.name}>\n                          {fileInfo.bomFile.name}\n                        </p>\n                        <Button \n                          variant=\"ghost\" \n                          size=\"sm\" \n                          className=\"absolute top-1 right-1 p-0 w-4 h-4 min-w-0\"\n                          onClick={(e) => { e.stopPropagation(); handleRemoveFile('bom'); }}\n                        >\n                          <X size={12} />\n                        </Button>\n                      </div>\n                    ) : (\n                      <div className=\"flex flex-col items-center gap-1\">\n                        <span className=\"text-xs font-bold text-gray-400\">BOM</span>\n                        <p className=\"text-[10px] font-medium text-gray-700\">파일 업로드</p>\n                      </div>\n                    )}\n                  </div>\n\n                  {/* 좌표 파일 업로드 */}\n                  <div \n                    className={cn(\n                      \"border-2 border-dashed rounded-lg p-2 text-center transition-colors cursor-pointer relative flex flex-col items-center justify-center h-full\",\n                      dragActive === 'coord' ? \"border-primary bg-primary/5\" : \"border-gray-200 hover:border-gray-300\",\n                      fileInfo.coordFile ? \"bg-blue-50 border-blue-200\" : \"\"\n                    )}\n                    onDragEnter={(e) => handleDrag(e, 'coord')}\n                    onDragLeave={(e) => handleDrag(e, 'coord')}\n                    onDragOver={(e) => handleDrag(e, 'coord')}\n                    onDrop={(e) => handleDrop(e, 'coord')}\n                    onClick={() => document.getElementById('coord-upload')?.click()}\n                  >\n                    <input \n                      id=\"coord-upload\" \n                      type=\"file\" \n                      className=\"hidden\" \n                      accept=\".xlsx,.xls,.txt,.csv\" \n                      onChange={(e) => handleFileSelect(e, 'coord')}\n                    />\n                    \n                    {fileInfo.coordFile ? (\n                      <div className=\"flex flex-col items-center gap-1 w-full px-1\">\n                        <span className=\"text-xs font-bold text-blue-600\">좌표</span>\n                        <p className=\"text-[10px] font-medium text-blue-700 w-full text-center break-all line-clamp-2\" title={fileInfo.coordFile.name}>\n                          {fileInfo.coordFile.name}\n                        </p>\n                        <Button \n                          variant=\"ghost\" \n                          size=\"sm\" \n                          className=\"absolute top-1 right-1 p-0 w-4 h-4 min-w-0\"\n                          onClick={(e) => { e.stopPropagation(); handleRemoveFile('coord'); }}\n                        >\n                          <X size={12} />\n                        </Button>\n                      </div>\n                    ) : (\n                      <div className=\"flex flex-col items-center gap-1\">\n                        <span className=\"text-xs font-bold text-gray-400\">좌표</span>\n                        <p className=\"text-[10px] font-medium text-gray-700\">파일 업로드</p>\n                      </div>\n                    )}\n                  </div>\n                </div>\n\n                {/* 오른쪽: 정보 입력 (50%) */}\n                <div className=\"w-full lg:w-[50%] space-y-1\">\n                  {/* 1. 보드 이름 (전체 폭) */}\n                  <div className=\"space-y-1 mb-3.5\">\n                    <Label className=\"text-[10px] text-gray-500\">보드 이름 (자동)</Label>\n                    <Input\n                      value={metadata.boardName || 'BOM 파일 업로드 시 자동'}\n                      disabled\n                      className=\"w-full bg-gray-50 border border-[#d2d2d7] rounded-md text-xs shadow-sm\"\n                      style={{ height: '32px' }}\n                    />\n                  </div>\n\n                  {/* 2. Artwork 담당자, 생산 담당자, 생산 수량, 생성 버튼 (같은 행) */}\n                  <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-2\">\n                    {/* Artwork 담당자 */}\n                    <div className=\"space-y-1\">\n                      <Label className=\"text-[10px] text-gray-500\">Artwork 담당자</Label>\n                      <Popover open={openArtworkManager} onOpenChange={setOpenArtworkManager}>\n                        <PopoverTrigger asChild>\n                          <Button\n                            variant=\"outline\"\n                            role=\"combobox\"\n                            aria-expanded={openArtworkManager}\n                            className=\"w-full justify-between text-xs h-8 min-h-[32px] px-2 bg-white border-[#d2d2d7] shadow-sm hover:bg-gray-50\"\n                          >\n                            {metadata.artworkManager\n                              ? employees.find((emp) => emp.id === metadata.artworkManager)?.name || metadata.artworkManager\n                              : currentUser?.name || \"담당자 선택\"}\n                            <ChevronsUpDown className=\"ml-2 h-3 w-3 shrink-0 opacity-50\" />\n                          </Button>\n                        </PopoverTrigger>\n                        <PopoverContent className=\"w-[200px] p-0\">\n                          <Command>\n                            <CommandInput placeholder=\"이름 검색...\" className=\"h-8 text-xs\" />\n                            <CommandList>\n                              <CommandEmpty>검색 결과 없음</CommandEmpty>\n                              <CommandGroup>\n                                {employees.map((emp) => (\n                                  <CommandItem\n                                    key={emp.id}\n                                    value={emp.name}\n                                    onSelect={() => {\n                                      setMetadata(prev => ({ ...prev, artworkManager: emp.id }));\n                                      setOpenArtworkManager(false);\n                                    }}\n                                    className=\"text-xs\"\n                                  >\n                                    <Check\n                                      className={cn(\n                                        \"mr-2 h-3 w-3\",\n                                        metadata.artworkManager === emp.id ? \"opacity-100\" : \"opacity-0\"\n                                      )}\n                                    />\n                                    {emp.name}\n                                  </CommandItem>\n                                ))}\n                              </CommandGroup>\n                            </CommandList>\n                          </Command>\n                        </PopoverContent>\n                      </Popover>\n                    </div>\n\n                    {/* 생산 담당자 */}\n                    <div className=\"space-y-1\">\n                      <Label className=\"text-[10px] text-gray-500\">생산 담당자 <span className=\"text-red-500\">*</span></Label>\n                      <Popover open={openProductionManager} onOpenChange={setOpenProductionManager}>\n                        <PopoverTrigger asChild>\n                          <Button\n                            variant=\"outline\"\n                            role=\"combobox\"\n                            aria-expanded={openProductionManager}\n                            className=\"w-full justify-between text-xs h-8 min-h-[32px] px-2 bg-white border-[#d2d2d7] shadow-sm hover:bg-gray-50\"\n                          >\n                            {metadata.productionManager\n                              ? employees.find((emp) => emp.id === metadata.productionManager)?.name\n                              : \"담당자 선택\"}\n                            <ChevronsUpDown className=\"ml-2 h-3 w-3 shrink-0 opacity-50\" />\n                          </Button>\n                        </PopoverTrigger>\n                        <PopoverContent className=\"w-[200px] p-0\">\n                          <Command>\n                            <CommandInput placeholder=\"이름 검색...\" className=\"h-8 text-xs\" />\n                            <CommandList>\n                              <CommandEmpty>검색 결과 없음</CommandEmpty>\n                              <CommandGroup>\n                                {employees.map((emp) => (\n                                  <CommandItem\n                                    key={emp.id}\n                                    value={emp.name}\n                                    onSelect={() => {\n                                      setMetadata(prev => ({ ...prev, productionManager: emp.id }));\n                                      setOpenProductionManager(false);\n                                    }}\n                                    className=\"text-xs\"\n                                  >\n                                    <Check\n                                      className={cn(\n                                        \"mr-2 h-3 w-3\",\n                                        metadata.productionManager === emp.id ? \"opacity-100\" : \"opacity-0\"\n                                      )}\n                                    />\n                                    {emp.name}\n                                  </CommandItem>\n                                ))}\n                              </CommandGroup>\n                            </CommandList>\n                          </Command>\n                        </PopoverContent>\n                      </Popover>\n                    </div>\n\n                    {/* 생산 수량 */}\n                    <div className=\"space-y-1\">\n                      <Label className=\"text-[10px] text-gray-500\">생산 수량 <span className=\"text-red-500\">*</span></Label>\n                      <div className=\"relative\">\n                        <Input\n                          type=\"number\"\n                          min=\"0\"\n                          value={metadata.productionQuantity === 0 ? '' : metadata.productionQuantity}\n                          onChange={(e) => setMetadata(prev => ({ ...prev, productionQuantity: parseInt(e.target.value) || 0 }))}\n                          className=\"w-full bg-white border border-[#d2d2d7] rounded-md text-xs shadow-sm hover:shadow-md transition-shadow duration-200 pr-8\"\n                          style={{ height: '32px' }}\n                          placeholder=\"0\"\n                        />\n                        <span className=\"absolute right-2.5 top-1/2 -translate-y-1/2 text-[10px] text-gray-500 font-medium pointer-events-none\">SET</span>\n                      </div>\n                    </div>\n\n                    {/* 생성 버튼 */}\n                    <div className=\"flex items-end\">\n                      <Button \n                        onClick={handleProcess}\n                        disabled={\n                          !fileInfo.bomFile || \n                          !fileInfo.coordFile || \n                          !metadata.boardName || \n                          !metadata.productionManager ||\n                          metadata.productionQuantity <= 0 ||\n                          uploading\n                        }\n                        className=\"w-full bg-hansl-500 hover:bg-hansl-600 text-white shadow-sm text-xs disabled:bg-gray-300 disabled:cursor-not-allowed\"\n                        style={{ height: '32px' }}\n                      >\n                        정리 및 생성\n                      </Button>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* 안내 메시지 */}\n          {!fileInfo.bomFile && !fileInfo.coordFile && (\n            <div className=\"text-center py-6 sm:py-8 text-gray-500\">\n              <Package className=\"w-10 h-10 sm:w-12 sm:h-12 mx-auto mb-3 text-gray-300\" />\n              <p className=\"text-xs sm:text-sm px-4\">BOM 파일과 좌표 파일을 업로드하여 시작하세요</p>\n            </div>\n          )}\n        </div>\n      )}\n\n      {/* 처리 중 */}\n      {step === 'processing' && (\n        <Card>\n          <CardContent className=\"py-12 sm:py-16 lg:py-20\">\n            <div className=\"flex flex-col items-center justify-center max-w-md mx-auto\">\n              <Loader2 className=\"w-8 h-8 sm:w-10 sm:h-10 text-hansl-600 animate-spin mb-6\" />\n              <h3 className=\"text-base sm:text-lg lg:text-xl font-semibold text-center mb-2\">{loadingText || 'AI가 BOM을 분석하고 있습니다'}</h3>\n              <p className=\"text-xs sm:text-sm text-gray-600 mb-6 text-center px-4\">잠시만 기다려주세요... (약 30초 ~ 1분 소요)</p>\n              \n              <div className=\"w-full px-4\">\n                <Progress value={progress} className=\"h-2\" />\n                <p className=\"text-right text-xs text-gray-500 mt-1\">{Math.round(progress)}%</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* 결과 미리보기 */}\n      {step === 'preview' && processedResult && (\n        <div className=\"space-y-4\">\n          <Card>\n            <CardContent className=\"p-4 sm:p-6\">\n              {/* 제목 / 부제 + 버튼 */}\n              <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-end gap-3 mb-4\">\n                <div>\n                  <h3 className=\"page-title\">데이터 미리보기 <span className=\"text-xs font-medium text-gray-500 ml-3\">{(metadata.boardName || '').trim().replace(/_\\d{6}_정리본$/, '').replace(/_정리본$/, '').replace(/_\\d{6}$/, '')}</span></h3>\n                  <p className=\"page-subtitle\">데이터 클릭 수정 후 저장 바랍니다.</p>\n                </div>\n                <div className=\"flex gap-2\">\n                  <Button \n                    onClick={() => previewPanelRef.current?.handleMerge()}\n                    disabled={!hasMergeableItems && !isMerged}\n                    className={`button-base border ${\n                      !hasMergeableItems && !isMerged\n                        ? 'border-gray-200 bg-gray-100 text-gray-400 cursor-not-allowed'\n                        : isMerged \n                          ? 'border-orange-300 bg-orange-50 text-orange-700 hover:bg-orange-100' \n                          : 'border-gray-300 bg-white text-gray-700 hover:bg-gray-50'\n                    }`}\n                  >\n                    <Link2 className=\"w-4 h-4 mr-2\" />\n                    {isMerged ? '합치기 해제' : '동일 항목 합치기'}\n                  </Button>\n                  <Button \n                    onClick={() => previewPanelRef.current?.handleReset()}\n                    className=\"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50\"\n                  >\n                    <RotateCcw className=\"w-4 h-4 mr-2\" />\n                    초기화\n                  </Button>\n                  <Button \n                    onClick={() => previewPanelRef.current?.handleSave()}\n                    disabled={isSaving}\n                    className=\"button-base bg-hansl-500 hover:bg-hansl-600 text-white\"\n                  >\n                    {isSaving ? (\n                      <>\n                        <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                        저장 중...\n                      </>\n                    ) : (\n                      <>\n                        <Save className=\"w-4 h-4 mr-2\" />\n                        저장\n                      </>\n                    )}\n                  </Button>\n                  <Button \n                    onClick={() => previewPanelRef.current?.handleDownload()}\n                    className=\"button-base bg-green-500 hover:bg-green-600 text-white\"\n                  >\n                    <Download className=\"w-4 h-4 mr-2\" />\n                    Excel\n                  </Button>\n                </div>\n              </div>\n\n              {/* 탭 */}\n              <Tabs defaultValue=\"bom\" className=\"w-full\">\n                <TabsList className=\"flex space-x-1 bg-gray-50 p-1 business-radius-card border border-gray-200 mb-4\">\n                  <TabsTrigger \n                    value=\"bom\" \n                    className=\"flex-1 flex items-center justify-center space-x-2 py-1.5 px-3 sm:px-4 business-radius-button !text-xs font-medium transition-colors data-[state=active]:text-hansl-600 data-[state=active]:bg-white data-[state=active]:shadow-sm data-[state=active]:border data-[state=active]:border-gray-200 data-[state=inactive]:text-gray-600 data-[state=inactive]:bg-transparent data-[state=inactive]:hover:text-gray-900 data-[state=inactive]:hover:bg-white/50\"\n                  >\n                    <span className=\"whitespace-nowrap\">정리된 BOM</span>\n                    <span className=\"badge-stats data-[state=active]:bg-hansl-50 data-[state=active]:text-hansl-700 bg-gray-100 text-gray-600\">\n                      {(processedResult.processedData?.bomItems ?? []).reduce(\n                        (sum: number, item: BOMItem) => sum + (item.setCount || 0),\n                        0\n                      )}\n                    </span>\n                    {(processedResult.processedData?.bomItems?.filter((item: { isManualRequired?: boolean }) => item.isManualRequired).length ?? 0) > 0 && (\n                      <span className=\"badge-stats bg-yellow-100 text-yellow-700 border border-yellow-300\">\n                        ⚠️ 수동 작성: {processedResult.processedData?.bomItems?.filter((item: { isManualRequired?: boolean }) => item.isManualRequired).length}\n                      </span>\n                    )}\n                    {mismatchCount > 0 && (\n                      <span className=\"badge-stats bg-red-100 text-red-700 border border-red-200\">\n                        REF 불일치: {mismatchCount}\n                      </span>\n                    )}\n                  </TabsTrigger>\n                  <TabsTrigger \n                    value=\"coord\" \n                    className=\"flex-1 flex items-center justify-center space-x-2 py-1.5 px-3 sm:px-4 business-radius-button !text-xs font-medium transition-colors data-[state=active]:text-hansl-600 data-[state=active]:bg-white data-[state=active]:shadow-sm data-[state=active]:border data-[state=active]:border-gray-200 data-[state=inactive]:text-gray-600 data-[state=inactive]:bg-transparent data-[state=inactive]:hover:text-gray-900 data-[state=inactive]:hover:bg-white/50\"\n                  >\n                    <span className=\"whitespace-nowrap\">좌표 데이터</span>\n                    <span className=\"badge-stats data-[state=active]:bg-hansl-50 data-[state=active]:text-hansl-700 bg-gray-100 text-gray-600\">\n                      {processedResult.processedData?.coordinates?.filter((c: CoordinateItem) => c.layer === 'TOP').length || 0}\n                    </span>\n                    <span className=\"badge-stats data-[state=active]:bg-orange-50 data-[state=active]:text-orange-700 bg-gray-100 text-gray-600\">\n                      {processedResult.processedData?.coordinates?.filter((c: CoordinateItem) => c.layer === 'BOTTOM').length || 0}\n                    </span>\n                  </TabsTrigger>\n                </TabsList>\n\n                <TabsContent value=\"bom\" className=\"mt-0\">\n                  <GeneratedPreviewPanel \n                    ref={previewPanelRef}\n                    bomItems={processedResult.processedData?.bomItems || []}\n                    coordinates={processedResult.processedData?.coordinates || []}\n                    boardName={metadata.boardName || 'Board'}\n                    productionQuantity={metadata.productionQuantity}\n                    artworkManager={employees.find(emp => emp.id === metadata.artworkManager)?.name || currentUser?.name || ''}\n                    productionManager={employees.find(emp => emp.id === metadata.productionManager)?.name || ''}\n                    onSave={handleSaveBOM}\n                    onMergeStateChange={setIsMerged}\n                    onBomChange={handleBomChange}\n                  />\n                </TabsContent>\n\n                <TabsContent value=\"coord\" className=\"mt-0\">\n                  <CoordinatePreviewPanel \n                    coordinates={processedResult.processedData?.coordinates || []}\n                  />\n                </TabsContent>\n              </Tabs>\n            </CardContent>\n          </Card>\n        </div>\n      )}\n        </>\n      )}\n\n      {/* BOM 상세 모달 */}\n      <BomDetailModal\n        boardId={detailModalBoardId}\n        isOpen={isDetailModalOpen}\n        onClose={() => {\n          setIsDetailModalOpen(false);\n          setDetailModalBoardId(null);\n        }}\n      />\n    </div>\n  );\n}"],"names":["Link2","createLucideIcon","d","key","x1","x2","y1","y2","TabsContext","React.createContext","Tabs","React.forwardRef","className","defaultValue","value","controlledValue","onValueChange","props","ref","uncontrolledValue","setUncontrolledValue","React.useState","handleValueChange","React.useCallback","newValue","jsx","Provider","children","cn","displayName","TabsList","TabsTrigger","onClick","context","React.useContext","Error","isActive","type","role","e","TabsContent","async","generateBOMExcelFromTemplate","bomItems","topCoordinates","bottomCoordinates","metadata","workbook","ExcelJS","Workbook","response","fetch","ok","buffer","arrayBuffer","xlsx","load","error","creator","modified","Date","bomSheet","worksheets","cleanBoardName","boardName","trim","replace","name","substring","getCell","artworkManager","productionManager","mergeCells","infoCell","productionQuantity","alignment","horizontal","vertical","font","bold","dataStartRow","border","top","style","left","bottom","right","prevItemType","forEach","item","index","rowNum","row","getRow","currentType","itemType","itemName","setCount","itemNameUpper","toUpperCase","isMisap","remark","includes","refList","centerAlignCols","baseFont","size","family","charset","color","argb","isLastOfGroup","length","isFirstOfGroup","col","cell","cellBorder","wrapText","refLength","estimatedLines","Math","ceil","height","max","commit","fillBOMSheet","fillCoordinateSheet","outBuffer","writeBuffer","Blob","sheetName","coordinates","sheet","getWorksheet","prevType","coord","isLastRow","partName","refDes","layer","locationX","locationY","rotation","partNameUpper","isCoordMisap","downloadExcelBlob","blob","filename","window","handle","showSaveFilePicker","suggestedName","types","description","accept","writable","createWritable","write","close","err","url","URL","createObjectURL","link","document","createElement","href","download","body","appendChild","click","removeChild","revokeObjectURL","GeneratedPreviewPanel","forwardRef","initialItems","onSave","onMergeStateChange","onBomChange","items","setItems","useState","beforeMergeItems","setBeforeMergeItems","textareaRefs","useRef","useEffect","useLayoutEffect","Object","values","current","textarea","newHeight","scrollHeight","filter","i","isManualRequired","isNewPart","totalSetCount","reduce","sum","measureTextWidth","text","fontSize","ctx","getContext","measureText","width","map","handleDownload","unfilledItems","confirm","excelMetadata","topCoords","c","bottomCoords","today","dateStr","getFullYear","toString","slice","String","getMonth","padStart","getDate","toast","success","errorMessage","message","handleReset","handleMerge","grouped","Map","uniqueKey","lineNumber","set","has","get","push","mergeCount","groupItems","info","mergedItems","first","mergedRefs","join","mergedSetCount","mergedTotalQty","totalQuantity","handleSave","useImperativeHandle","isMerged","handleCellChange","field","newItems","Number","getRowClassName","jsxs","Table","TableHeader","TableRow","TableHead","TableBody","TableCell","onChange","target","placeholder","title","originalFootprint","readOnly","stockQuantity","maxWidth","contentEditable","suppressContentEditableWarning","lineHeight","wordWrap","overflowWrap","whiteSpace","onBlur","currentTarget","textContent","split","r","alternativeItem","CoordinatePreviewPanel","CoordinateTable","data","totalCount","colSpan","showType","Badge","variant","toFixed","BomDetailModal","boardId","isOpen","onClose","loading","setLoading","boardData","setBoardData","downloading","setDownloading","supabase","createClient","loadBoardData","board","boardError","from","select","eq","single","bomError","order","coordError","convertedBOMItems","line_number","item_type","item_name","set_count","total_quantity","stock_quantity","checkStatus","check_status","Array","isArray","ref_list","alternative_item","is_manual_required","is_new_part","originalPart","original_part","original_footprint","coordItem","part_type","part_name","side","x_coordinate","y_coordinate","angle","id","board_name","artwork_manager","production_manager","production_quantity","created_at","checkIsMisap","nameUpper","Dialog","open","onOpenChange","DialogContent","showCloseButton","DialogHeader","DialogTitle","Button","fileName","disabled","Loader2","Download","BOMTable","display","learningDataCache","MANUAL_INPUT_REQUIRED","FIXED_MAPPINGS","TLP3107","ADS7828E_250","TPD2EUSB30DRTR_OPEN","TPD2EUSB30DRTR","C10PF_50V_1005_OPEN","C10PF_1005_OPEN","R0_1005_OPEN","W25Q16JVSSIQ_OPEN","R1K_1005_OPEN_1903","R10K_1005_OPEN_1903","R10K_1005_OPEN","R10_1005","R15_1005","MGL_G1_AA_MASTER_SENSOR_POGO","Utils","normalizePartName","toLowerCase","normalizePartFootprintCombo","part","footprint","normPart","test","isManualInputRequired","learningData","fpUpper","manualInputRequired","some","m","mPart","mFp","this","footprintUpper","partUpper","misapKeywords","kw","parseRefs","refStr","refs","parts","rangeMatch","match","prefix","start","parseInt","end","isTP","normalizeType","typeVal","normalized","SENSOR","CONNECTGOR","CONNECTO4R","CONNECTROR","mapPartName","combo","partNameMapping","isNew","mapType","typeMapping","entries","mapTypeFromFootprint","footprintKeys","mappedPartName","processBOMAndCoordinates","bomFile","coordFile","typeMappingRes","partNameMappingRes","partNameConflictsRes","typeSortOrderRes","misapKeywordsRes","Promise","all","status","json","partNameConflicts","typeSortOrder","mergedPartNameMapping","loadLearningData","parsedBOM","file","Uint8Array","XLSX.read","Sheets","SheetNames","rows","XLSX.utils","sheet_to_json","header","headerRow","colMap","qty","refKeywords","partKeywords","footprintKeywords","min","rowStr","idx","val","currentItem","itemNum","reference","quantity","startsWith","additionalRefs","parseBOMFile","parsedCoord","endsWith","lines","TextDecoder","decode","headerFound","x","y","line","trimmed","lower","cols","parseFloat","parseCoordinateFile","normalizedCoord","coordMap","manualRequiredCount","newPartCount","misapCount","mapping","extractTypeFromFootprint","fp","pt","refPrefix","finalItemType","typeFromLearning","bomItem","TYPE_GROUP_ORDER","guessTypeGroupForSort","sort","a","b","groupA","groupB","orderA","indexOf","orderB","idxA","idxB","localeCompare","aMisap","sortCoordinates","coords","getGroup","t","summary","totalItems","BomCoordinateIntegrated","viewMode","setViewMode","step","setStep","fileInfo","setFileInfo","setMetadata","employees","setEmployees","currentUser","setCurrentUser","uploading","setUploading","openArtworkManager","setOpenArtworkManager","openProductionManager","setOpenProductionManager","processedResult","setProcessedResult","dragActive","setDragActive","savedBoards","setSavedBoards","loadingBoards","setLoadingBoards","uploadedFilePaths","setUploadedFilePaths","setErrorMessage","progress","setProgress","loadingText","setLoadingText","setIsMerged","deletingBoardId","setDeletingBoardId","detailModalBoardId","setDetailModalBoardId","isDetailModalOpen","setIsDetailModalOpen","isSaving","setIsSaving","mismatchCount","useMemo","processedData","bomRefs","Set","Boolean","add","coordRefs","missingInCoord","missingInBom","hasMergeableItems","count","previewPanelRef","currentUserRoles","useAuth","isAdmin","getTempStorageKey","userId","clearTempData","user","auth","getUser","localStorage","removeItem","empData","email","userData","prev","saved","getItem","tempData","JSON","parse","savedAt","getTime","loadTempData","loadData","toISOString","setItem","stringify","saveTempData","saveTemp","boards","ascending","loadSavedBoards","handleDrag","useCallback","preventDefault","stopPropagation","handleDrop","dataTransfer","files","handleFileSelect","handleRemoveFile","bomUrl","coordUrl","marginTop","marginBottom","Plus","Eye","Card","CardContent","Package","toLocaleDateString","year","month","day","boardInfo","specification","convertedCoords","partType","round","handleDownloadSavedBOM","bomItemsError","delete","placementsError","rawFilesData","bom_file_url","bomPath","storage","remove","decodeURIComponent","coordinate_file_url","coordPath","storageError","rawFilesError","cadError","handleDeleteSavedBOM","Trash2","Fragment","AlertCircle","onDragEnter","onDragLeave","onDragOver","onDrop","getElementById","X","Label","Input","Popover","PopoverTrigger","asChild","find","emp","ChevronsUpDown","PopoverContent","Command","CommandInput","CommandList","CommandEmpty","CommandGroup","CommandItem","onSelect","Check","timer","textTimer","estimatedDuration","updateInterval","incrementPerStep","setInterval","oldProgress","randomFactor","random","timestamp","now","sanitizeFileName","lastDotIndex","lastIndexOf","extension","safeBomFileName","safeCoordFileName","bomResult","upload","cacheControl","upsert","coordResult","bomUrlData","createSignedUrl","coordUrlData","signedUrl","resultWithId","cadDrawingId","msg","scrollTo","behavior","Progress","RotateCcw","Save","artworkManagerName","productionManagerName","saveBoardName","newBoard","insert","update","bomFileUrl","coordFileUrl","existingRawFile","updateRawError","bom_file_name","coordinate_file_name","uploaded_by","insertRawError","cad_drawing_id","deleteError","insertError","deleteCoordError","insertCoordError","learningError","processed_bom_data","processed_coordinate_data","cad_program_type","setTimeout","updatedBomItems","refToItemMap","updatedCoordinates","refKey","bomInfo"],"mappings":"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","x_google_ignoreList":[0]}