{"version":3,"file":"DashboardMain-DswfkWOZ.js","sources":["../../node_modules/lucide-react/dist/esm/icons/clock.js","../../src/services/dashboardService.ts","../../src/components/dashboard/DashboardMain.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M12 6v6l4 2\", key: \"mmk7yg\" }],\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }]\n];\nconst Clock = createLucideIcon(\"clock\", __iconNode);\n\nexport { __iconNode, Clock as default };\n//# sourceMappingURL=clock.js.map\n","import { createClient } from '@/lib/supabase/client'\nimport { logger } from '@/lib/logger'\nimport type { \n  DashboardData, \n  DashboardStats, \n  UrgentRequest, \n  MyRequestStatus, \n  QuickAction,\n  Employee,\n  PurchaseRequestWithDetails \n} from '@/types/purchase'\n\n// ëŒ€ì‹œë³´ë“œ ë°ì´í„° ìºì‹œ\nconst dashboardCache = {\n  data: null as DashboardData | null,\n  lastFetch: 0,\n  CACHE_DURATION: 30 * 1000, // 30ì´ˆ ìºì‹œ\n  employeeId: null as string | null\n}\n\nexport class DashboardService {\n  private supabase = createClient()\n\n  // ì—­í•  íŒŒì‹± ìœ í‹¸: ë°°ì—´/CSV ë¬¸ìì—´/ë‹¨ì¼ ë¬¸ìì—´ì„ ëª¨ë‘ ë°°ì—´ë¡œ ì •ê·œí™”\n  private parseRoles(purchaseRole: string | string[] | null | undefined): string[] {\n    let roles: string[] = []\n    \n    if (purchaseRole) {\n      if (Array.isArray(purchaseRole)) {\n        // ë°°ì—´ì¸ ê²½ìš°\n        roles = purchaseRole.map((r: any) => String(r).trim())\n      } else {\n        // ë¬¸ìì—´ì¸ ê²½ìš° (ì¼ë°˜ì )\n        const roleString = String(purchaseRole)\n        // ì‰¼í‘œë¡œ ë¶„í• í•˜ê³  ê³µë°± ì œê±°\n        roles = roleString\n          .split(',')\n          .map((r: string) => r.trim())\n          .filter((r: string) => r.length > 0)\n      }\n    }\n    \n    return roles\n  }\n\n  // ë©”ì¸ ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ\n  async getDashboardData(employee: Employee, forceRefresh = false): Promise<DashboardData> {\n    const now = Date.now()\n    const cacheValid = !forceRefresh && \n                       dashboardCache.data && \n                       dashboardCache.employeeId === employee.id &&\n                       (now - dashboardCache.lastFetch) < dashboardCache.CACHE_DURATION\n\n    // ìºì‹œê°€ ìœ íš¨í•˜ë©´ ì¦‰ì‹œ ë°˜í™˜\n    if (cacheValid && dashboardCache.data) {\n      return dashboardCache.data\n    }\n\n    const results = await Promise.allSettled([\n      this.getDashboardStats(employee),\n      this.getMyRecentRequests(employee),\n      this.getPendingApprovals(employee),\n      this.getQuickActions(employee),\n      this.getTodaySummary(employee),\n      this.getMyPurchaseStatus(employee)\n    ])\n    \n    const statsResult = results[0]\n    const myRecentRequestsResult = results[1]\n    const pendingApprovalsResult = results[2]\n    const quickActionsResult = results[3]\n    const todaySummaryResult = results[4]\n    const myPurchaseStatusResult = results[5]\n    \n    const stats: DashboardStats = statsResult.status === 'fulfilled' \n      ? statsResult.value \n      : { total: 0, myRequests: 0, pending: 0, completed: 0, urgent: 0, todayActions: 0 }\n    \n    const myRecentRequests: MyRequestStatus[] = myRecentRequestsResult.status === 'fulfilled'\n      ? myRecentRequestsResult.value\n      : []\n    \n    const pendingApprovals: PurchaseRequestWithDetails[] = pendingApprovalsResult.status === 'fulfilled'\n      ? pendingApprovalsResult.value\n      : []\n    \n    const quickActions: QuickAction[] = quickActionsResult.status === 'fulfilled'\n      ? quickActionsResult.value\n      : []\n    \n    const todaySummary = todaySummaryResult.status === 'fulfilled'\n      ? todaySummaryResult.value\n      : { approved: 0, requested: 0, received: 0 }\n    \n    const myPurchaseStatus = myPurchaseStatusResult.status === 'fulfilled'\n      ? myPurchaseStatusResult.value\n      : { waitingPurchase: [], waitingDelivery: [], recentCompleted: [] }\n    \n    // ì‹¤íŒ¨í•œ í•­ëª© ë¡œê¹…\n    if (statsResult.status === 'rejected') {\n      logger.error('[DashboardService] getDashboardStats ì‹¤íŒ¨:', statsResult.reason)\n    }\n    if (myRecentRequestsResult.status === 'rejected') {\n      logger.error('[DashboardService] getMyRecentRequests ì‹¤íŒ¨:', myRecentRequestsResult.reason)\n    }\n    if (pendingApprovalsResult.status === 'rejected') {\n      logger.error('[DashboardService] getPendingApprovals ì‹¤íŒ¨:', pendingApprovalsResult.reason)\n    }\n    if (quickActionsResult.status === 'rejected') {\n      logger.error('[DashboardService] getQuickActions ì‹¤íŒ¨:', quickActionsResult.reason)\n    }\n    if (todaySummaryResult.status === 'rejected') {\n      logger.error('[DashboardService] getTodaySummary ì‹¤íŒ¨:', todaySummaryResult.reason)\n    }\n    if (myPurchaseStatusResult.status === 'rejected') {\n      logger.error('[DashboardService] getMyPurchaseStatus ì‹¤íŒ¨:', myPurchaseStatusResult.reason)\n    }\n\n    const dashboardData: DashboardData = {\n      employee,\n      stats,\n      urgentRequests: [],\n      myRecentRequests,\n      pendingApprovals,\n      quickActions,\n      todaySummary,\n      myPurchaseStatus\n    }\n\n    // ìºì‹œ ì—…ë°ì´íŠ¸\n    dashboardCache.data = dashboardData\n    dashboardCache.lastFetch = now\n    dashboardCache.employeeId = employee.id\n\n    return dashboardData\n  }\n\n  // í†µê³„ ì •ë³´ (ìš°ì„ ìˆœìœ„ ì¬ì •ë ¬)\n  async getDashboardStats(employee: Employee): Promise<DashboardStats> {\n    const today = new Date().toISOString().split('T')[0]\n    const roles = this.parseRoles(employee.purchase_role)\n\n\n    // ë³‘ë ¬ ì¿¼ë¦¬ë¡œ ì„±ëŠ¥ ìµœì í™”\n    const [\n      totalResult,\n      myRequestsResult,\n      pendingResult,\n      completedResult,\n      urgentResult,\n      todayActionsResult\n    ] = await Promise.all([\n      // ì „ì²´ ìš”ì²­ ìˆ˜\n      this.supabase\n        .from('purchase_requests')\n        .select('id', { count: 'exact', head: true }),\n\n      // ë‚´ ìš”ì²­ ìˆ˜\n      this.supabase\n        .from('purchase_requests')\n        .select('id', { count: 'exact', head: true })\n        .eq('requester_name', employee.name),\n\n      // ë‚´ê°€ ì²˜ë¦¬í•´ì•¼ í•  ìŠ¹ì¸ ëŒ€ê¸°\n      this.getPendingCount(employee, roles),\n\n      // ì´ë²ˆ ë‹¬ ì™„ë£Œëœ ìš”ì²­ ìˆ˜  \n      this.supabase\n        .from('purchase_requests')\n        .select('id', { count: 'exact', head: true })\n        .eq('is_received', true)\n        .gte('received_at', new Date(new Date().getFullYear(), new Date().getMonth(), 1).toISOString()),\n\n      // ê¸´ê¸‰ ìš”ì²­ ìˆ˜ (3ì¼ ì´ìƒ ëŒ€ê¸°)\n      this.getUrgentCount(employee, roles),\n\n      // ì˜¤ëŠ˜ ì²˜ë¦¬í•œ ì•¡ì…˜ ìˆ˜\n      this.getTodayActionsCount(employee, today)\n    ])\n\n    const stats = {\n      total: totalResult.count || 0,\n      myRequests: myRequestsResult.count || 0,\n      pending: pendingResult,\n      completed: completedResult.count || 0,\n      urgent: urgentResult,\n      todayActions: todayActionsResult\n    }\n\n    return stats\n  }\n\n  // ë‚´ ìµœê·¼ ìš”ì²­ ìƒíƒœ (ìŠ¹ì¸ ì§„í–‰ì¤‘ì¸ í•­ëª©ë§Œ - ìŠ¹ì¸ ëŒ€ê¸°ëŠ” ì œì™¸) - ì´ë¯¸ JOIN ìµœì í™”ë¨\n  async getMyRecentRequests(employee: Employee): Promise<MyRequestStatus[]> {\n    const { data } = await this.supabase\n      .from('purchase_requests')\n      .select('*,vendors(vendor_name),purchase_request_items(id)')\n      .eq('requester_name', employee.name)\n      // ìŠ¹ì¸ì´ ì§„í–‰ì¤‘ì¸ í•­ëª©ë§Œ (1ì°¨ ìŠ¹ì¸ë¨ + ìµœì¢… ëŒ€ê¸°ì¤‘ OR ëª¨ë“  ìŠ¹ì¸ ì™„ë£Œ + êµ¬ë§¤ ëŒ€ê¸°ì¤‘)\n      .or('and(middle_manager_status.eq.approved,final_manager_status.eq.pending),and(final_manager_status.eq.approved,is_payment_completed.eq.false)')\n      .order('created_at', { ascending: false })\n      .limit(5)\n\n    return (data || []).map((item: any) => ({\n      ...item,\n      vendor_name: item.vendors?.vendor_name,\n      total_items: item.purchase_request_items?.length || 0,\n      progress_percentage: this.calculateProgress(item),\n      current_step: this.getCurrentStep(item),\n      next_action: this.getNextAction(item),\n      estimated_completion: this.estimateCompletion(item)\n    })) as MyRequestStatus[]\n  }\n\n  // ìŠ¹ì¸ ëŒ€ê¸° í•­ëª© (ì „ì²´ ì¡°íšŒ) - JOIN ì¿¼ë¦¬ë¡œ N+1 ë¬¸ì œ í•´ê²°\n  async getPendingApprovals(employee: Employee): Promise<PurchaseRequestWithDetails[]> {\n    const roles = this.parseRoles(employee.purchase_role)\n\n    // ì—­í• ì´ ìˆëŠ” ì‚¬ìš©ìë§Œ ìŠ¹ì¸ ëŒ€ê¸° í•­ëª©ì„ ë³¼ ìˆ˜ ìˆìŒ\n    if (roles.length === 0) {\n      return []\n    }\n\n    logger.debug('ğŸš€ ìŠ¹ì¸ ëŒ€ê¸° í•­ëª© ì¡°íšŒ ì‹œì‘', {\n      employeeName: employee.name,\n      employeeRoles: roles\n    })\n\n    // âœ… N+1 ë¬¸ì œ í•´ê²°: JOINì„ ì‚¬ìš©í•˜ì—¬ í•œ ë²ˆì˜ ì¿¼ë¦¬ë¡œ ëª¨ë“  ê´€ë ¨ ë°ì´í„° ì¡°íšŒ\n    const { data: allRequests, error: requestsError } = await this.supabase\n      .from('purchase_requests')\n      .select(`\n        *,\n        vendors(vendor_name),\n        purchase_request_items(\n          id,\n          item_name,\n          specification,\n          quantity,\n          unit_price_value,\n          amount_value\n        )\n      `)\n      .order('request_date', { ascending: false })\n      .limit(100) // ì„±ëŠ¥ ìµœì í™”: 100ê°œë¡œ ì œí•œ\n\n    if (requestsError) {\n      logger.error('âŒ ìŠ¹ì¸ ëŒ€ê¸° í•­ëª© ì¡°íšŒ ì‹¤íŒ¨', requestsError)\n      return []\n    }\n\n    // í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œ ìŠ¹ì¸ ëŒ€ê¸° ìƒíƒœ í•„í„°ë§\n    let filteredData = allRequests || []\n\n    // pending, ëŒ€ê¸°, ë¹ˆë¬¸ìì—´, null ëª¨ë‘ ëŒ€ê¸°ë¡œ ì²˜ë¦¬\n    const isPending = (status: any) => (\n      status === 'pending' || status === 'ëŒ€ê¸°' || status === '' || status === null || status === undefined\n    )\n\n    logger.debug('ğŸ” ìŠ¹ì¸ ëŒ€ê¸° í•„í„°ë§ ì „ ë°ì´í„°', {\n      totalRequests: allRequests?.length || 0\n    })\n    \n    // ìŠ¹ì¸ ëŒ€ê¸°ì¸ í•­ëª©ë§Œ í•„í„°ë§\n    filteredData = filteredData.filter((item: any) => {\n      const middlePending = isPending(item.middle_manager_status)\n      const finalPending = isPending(item.final_manager_status)\n      \n      // ë°˜ë ¤ëœ ê²½ìš°ëŠ” ì œì™¸\n      const middleRejected = item.middle_manager_status === 'rejected'\n      const finalRejected = item.final_manager_status === 'rejected'\n      \n      if (middleRejected || finalRejected) return false\n      \n      // ì¤‘ê°„ìŠ¹ì¸ ëŒ€ê¸° ë˜ëŠ” ìµœì¢…ìŠ¹ì¸ ëŒ€ê¸°\n      return middlePending || finalPending\n    })\n\n    // ì—­í• ë³„ ê¶Œí•œì— ë”°ë¥¸ ì¶”ê°€ í•„í„°ë§\n    let roleFilteredData = filteredData\n    \n    if (roles.includes('app_admin')) {\n      // app_adminì€ ëª¨ë“  ìŠ¹ì¸ ëŒ€ê¸° í•­ëª© ë³¼ ìˆ˜ ìˆìŒ (í•„í„°ë§ ì—†ìŒ)\n      logger.debug('ğŸ”‘ app_admin ê¶Œí•œìœ¼ë¡œ ëª¨ë“  ìŠ¹ì¸ëŒ€ê¸° í•­ëª© í‘œì‹œ', {\n        totalItems: roleFilteredData.length\n      })\n    } else if (roles.includes('middle_manager')) {\n      // ì¤‘ê°„ìŠ¹ì¸ì: ì¤‘ê°„ìŠ¹ì¸ ëŒ€ê¸° í•­ëª©ë§Œ\n      roleFilteredData = filteredData.filter((item: any) => isPending(item.middle_manager_status))\n      logger.debug('ğŸ”‘ middle_manager ê¶Œí•œìœ¼ë¡œ ì¤‘ê°„ìŠ¹ì¸ ëŒ€ê¸° í•­ëª©ë§Œ í‘œì‹œ', {\n        beforeFilter: filteredData.length,\n        afterFilter: roleFilteredData.length\n      })\n    } else if (roles.includes('final_approver') || roles.includes('ceo')) {\n      // ìµœì¢…ìŠ¹ì¸ì: ì¤‘ê°„ìŠ¹ì¸ ì™„ë£Œ + ìµœì¢…ìŠ¹ì¸ ëŒ€ê¸° í•­ëª©ë§Œ\n      roleFilteredData = filteredData.filter((item: any) => {\n        const middleApproved = item.middle_manager_status === 'approved'\n        const finalPending = isPending(item.final_manager_status)\n        return middleApproved && finalPending\n      })\n      logger.debug('ğŸ”‘ final_approver/ceo ê¶Œí•œìœ¼ë¡œ ìµœì¢…ìŠ¹ì¸ ëŒ€ê¸° í•­ëª©ë§Œ í‘œì‹œ', {\n        beforeFilter: filteredData.length,\n        afterFilter: roleFilteredData.length\n      })\n    } else if (roles.includes('raw_material_manager') || roles.includes('consumable_manager')) {\n      // ì›ìì¬/ì†Œëª¨í’ˆ ë§¤ë‹ˆì €: ìµœì¢…ìŠ¹ì¸ìì™€ ë™ì¼í•œ ê¶Œí•œ\n      roleFilteredData = filteredData.filter((item: any) => {\n        const middleApproved = item.middle_manager_status === 'approved'\n        const finalPending = isPending(item.final_manager_status)\n        return middleApproved && finalPending\n      })\n      logger.debug('ğŸ”‘ material_manager ê¶Œí•œìœ¼ë¡œ ìµœì¢…ìŠ¹ì¸ ëŒ€ê¸° í•­ëª©ë§Œ í‘œì‹œ', {\n        beforeFilter: filteredData.length,\n        afterFilter: roleFilteredData.length\n      })\n    } else if (roles.includes('lead buyer')) {\n      // êµ¬ë§¤ë‹´ë‹¹ì: ìµœì¢…ìŠ¹ì¸ ì™„ë£Œ + êµ¬ë§¤ ëŒ€ê¸° í•­ëª©ë§Œ\n      roleFilteredData = filteredData.filter((item: any) => {\n        const finalApproved = item.final_manager_status === 'approved'\n        const purchasePending = !item.is_payment_completed\n        return finalApproved && purchasePending\n      })\n      logger.debug('ğŸ”‘ lead buyer ê¶Œí•œìœ¼ë¡œ êµ¬ë§¤ ëŒ€ê¸° í•­ëª©ë§Œ í‘œì‹œ', {\n        beforeFilter: filteredData.length,\n        afterFilter: roleFilteredData.length\n      })\n    } else {\n      // ê¸°íƒ€ ì—­í• ì€ ìŠ¹ì¸ ê¶Œí•œ ì—†ìŒ\n      roleFilteredData = []\n      logger.debug('ğŸ”‘ ìŠ¹ì¸ ê¶Œí•œ ì—†ëŠ” ì—­í• ', { roles, result: 'empty' })\n    }\n\n    // âœ… ë°ì´í„° ê°€ê³µ: JOINìœ¼ë¡œ ê°€ì ¸ì˜¨ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì²˜ë¦¬\n    const enhancedData = roleFilteredData.map((item: any) => {\n      // vendor_name ì²˜ë¦¬ (JOIN ê²°ê³¼ ì‚¬ìš©)\n      const vendor_name = item.vendors?.vendor_name || item.vendor_name || 'ì—…ì²´ ì •ë³´ ì—†ìŒ'\n      \n      // purchase_request_items ì²˜ë¦¬ (ì´ë¯¸ JOINìœ¼ë¡œ ê°€ì ¸ì˜´)\n      const purchase_request_items = item.purchase_request_items || []\n      \n      // total_amount ê³„ì‚°\n      const total_amount = purchase_request_items.reduce((sum: number, i: any) => {\n        const amount = Number(i?.amount_value) || (Number(i?.quantity) || 0) * (Number(i?.unit_price_value) || 0)\n        return sum + amount\n      }, 0)\n\n      return {\n        ...item,\n        vendor_name,\n        purchase_request_items,\n        total_amount\n      }\n    })\n    \n    logger.debug('âœ… ìŠ¹ì¸ ëŒ€ê¸° í•­ëª© ì¡°íšŒ ì™„ë£Œ (ìµœì í™”ë¨)', {\n      finalCount: enhancedData.length,\n      performanceNote: 'N+1 ë¬¸ì œ í•´ê²° - ë‹¨ì¼ JOIN ì¿¼ë¦¬ ì‚¬ìš©'\n    })\n\n    return enhancedData\n  }\n\n  // ë¹ ë¥¸ ì•¡ì…˜ ë²„íŠ¼ ë°ì´í„°\n  async getQuickActions(employee: Employee): Promise<QuickAction[]> {\n    const roles = this.parseRoles(employee.purchase_role)\n\n    const actions: QuickAction[] = []\n\n    // ìŠ¹ì¸ ê¶Œí•œì´ ìˆëŠ” ê²½ìš°\n    if (roles.includes('app_admin') || roles.includes('middle_manager') || roles.includes('final_approver') || roles.includes('ceo')) {\n      const pendingCount = await this.getPendingCount(employee, roles)\n      if (pendingCount > 0) {\n        actions.push({\n          id: 'approve',\n          type: 'approve',\n          label: 'ìŠ¹ì¸ ëŒ€ê¸°',\n          description: `${pendingCount}ê±´ì˜ ìŠ¹ì¸ ëŒ€ê¸° ì¤‘`,\n          count: pendingCount,\n          color: 'red'\n        })\n      }\n    }\n\n    // êµ¬ë§¤ ê¶Œí•œì´ ìˆëŠ” ê²½ìš°\n    if (roles.includes('lead buyer') || roles.includes('lead buyer')) {\n      const { count: purchaseCount } = await this.supabase\n        .from('purchase_requests')\n        .select('id', { count: 'exact', head: true })\n        .eq('final_manager_status', 'approved')\n        .eq('is_payment_completed', false)\n\n      if (purchaseCount && purchaseCount > 0) {\n        actions.push({\n          id: 'purchase',\n          type: 'purchase',\n          label: 'êµ¬ë§¤ ì²˜ë¦¬',\n          description: `${purchaseCount}ê±´ì˜ êµ¬ë§¤ ëŒ€ê¸° ì¤‘`,\n          count: purchaseCount,\n          color: 'yellow'\n        })\n      }\n    }\n\n    return actions\n  }\n\n  // ì˜¤ëŠ˜ ìš”ì•½ ì •ë³´\n  async getTodaySummary(employee: Employee) {\n    const today = new Date().toISOString().split('T')[0]\n    const tomorrow = new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString().split('T')[0]\n\n    const [approvedResult, requestedResult, receivedResult] = await Promise.all([\n      // ì˜¤ëŠ˜ ë‚´ê°€ ìŠ¹ì¸í•œ ê±´ìˆ˜\n      this.supabase\n        .from('purchase_requests')\n        .select('id', { count: 'exact', head: true })\n        .gte('updated_at', today)\n        .lt('updated_at', tomorrow)\n        .or('middle_manager_status.eq.approved,final_manager_status.eq.approved'),\n\n      // ì˜¤ëŠ˜ ë‚´ê°€ ìš”ì²­í•œ ê±´ìˆ˜\n      this.supabase\n        .from('purchase_requests')\n        .select('id', { count: 'exact', head: true })\n        .eq('requester_name', employee.name)\n        .gte('created_at', today)\n        .lt('created_at', tomorrow),\n\n      // ì˜¤ëŠ˜ ì…ê³  ì²˜ë¦¬í•œ ê±´ìˆ˜\n      this.supabase\n        .from('purchase_requests')\n        .select('id', { count: 'exact', head: true })\n        .eq('is_received', true)\n        .gte('received_at', today)\n        .lt('received_at', tomorrow)\n    ])\n\n    return {\n      approved: approvedResult.count || 0,\n      requested: requestedResult.count || 0,\n      received: receivedResult.count || 0\n    }\n  }\n\n  // ë‚´ êµ¬ë§¤/ì…ê³  ìƒíƒœ í™•ì¸ - JOIN ì¿¼ë¦¬ë¡œ ìµœì í™”ë¨\n  async getMyPurchaseStatus(employee: Employee): Promise<{ waitingPurchase: PurchaseRequestWithDetails[], waitingDelivery: PurchaseRequestWithDetails[], recentCompleted: PurchaseRequestWithDetails[] }> {\n    \n    const roles = this.parseRoles(employee.purchase_role)\n    const isLeadBuyer = roles.includes('lead buyer') || roles.includes('app_admin')\n    \n    // nameì´ ì—†ìœ¼ë©´ email ì‚¬ìš©\n    const requesterName = employee.name || employee.email\n    \n    const sevenDaysAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString()\n\n    // âœ… JOINì„ ì‚¬ìš©í•˜ì—¬ í•œ ë²ˆì˜ ì¿¼ë¦¬ë¡œ ëª¨ë“  ê´€ë ¨ ë°ì´í„° ì¡°íšŒ\n    // lead buyer ë˜ëŠ” app_adminì€ ëª¨ë“  í•­ëª© ì¡°íšŒ, ê·¸ ì™¸ëŠ” ë³¸ì¸ ê²ƒë§Œ\n    // PurchaseItemsModalê³¼ ë™ì¼í•œ ë°ì´í„° êµ¬ì¡°ë¥¼ ìœ„í•´ purchase_request_items ì „ì²´ í•„ë“œ ì¡°íšŒ\n    let query = this.supabase\n      .from('purchase_requests')\n      .select('*,vendors(vendor_name),purchase_request_items(*)')\n      .order('created_at', { ascending: false })\n      .limit(500)  // ì¶©ë¶„í•œ ê°œìˆ˜ë¡œ ì¦ê°€\n    \n    if (!isLeadBuyer) {\n      query = query.eq('requester_name', requesterName)\n    }\n    \n    const myRequests = await query\n\n    if (myRequests.error) {\n      logger.error('getMyPurchaseStatus ì—ëŸ¬', myRequests.error)\n      return {\n        waitingPurchase: [],\n        waitingDelivery: [],\n        recentCompleted: []\n      }\n    }\n\n    const allMyRequests = myRequests.data || []\n    \n\n    // í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ í•„í„°ë§ (PurchaseListMain êµ¬ë§¤/ì…ê³  íƒ­ê³¼ ë™ì¼í•œ ë¡œì§)\n    \n    const waitingPurchase = allMyRequests.filter((item: any) => {\n      // êµ¬ë§¤ ëŒ€ê¸°: êµ¬ë§¤ ìš”ì²­ + ê²°ì œ ë¯¸ì™„ë£Œ + (ì„ ì§„í–‰ì´ê±°ë‚˜ ìµœì¢…ìŠ¹ì¸ì™„ë£Œ)\n      const category = (item.payment_category || '').trim()\n      const isPurchaseRequest = category === 'êµ¬ë§¤ ìš”ì²­'\n      const notPaid = !item.is_payment_completed\n      \n      // êµ¬ë§¤ ìš”ì²­ì´ ì•„ë‹ˆê±°ë‚˜ ì´ë¯¸ ê²°ì œ ì™„ë£Œëœ ê²ƒì€ ì œì™¸\n      if (!isPurchaseRequest || !notPaid) return false\n      \n      const isSeonJin = (item.progress_type || '').includes('ì„ ì§„í–‰')\n      \n      // ì„ ì§„í–‰ì€ ìŠ¹ì¸ ìƒíƒœì™€ ë¬´ê´€í•˜ê²Œ êµ¬ë§¤ ëŒ€ê¸°\n      if (isSeonJin) {\n        return true\n      }\n      \n      // ì¼ë°˜ì€ ìµœì¢… ìŠ¹ì¸ ì™„ë£Œë˜ì–´ì•¼ êµ¬ë§¤ ëŒ€ê¸°\n      const isIlban = (item.progress_type || '').includes('ì¼ë°˜') || !item.progress_type || item.progress_type === ''\n      const finalApproved = item.final_manager_status === 'approved'\n      \n      return isIlban && finalApproved\n    })\n\n\n    const waitingDelivery = allMyRequests.filter((item: any) => {\n      // ì…ê³  íƒ­ ë¡œì§: ì…ê³  ë¯¸ì™„ë£Œ + ì„ ì§„í–‰(ìŠ¹ì¸ë¬´ê´€) OR ìµœì¢…ìŠ¹ì¸\n      const notReceived = !item.is_received\n      const isSeonJin = (item.progress_type || '').includes('ì„ ì§„í–‰')\n      \n      // ì…ê³  ëŒ€ê¸°ëŠ” í•­ìƒ ë³¸ì¸ ê²ƒë§Œ (lead buyerë„ ë³¸ì¸ ê²ƒë§Œ)\n      if (item.requester_name !== requesterName) {\n        return false\n      }\n      \n      // ì„ ì§„í–‰ì€ ìŠ¹ì¸ ìƒíƒœì™€ ë¬´ê´€í•˜ê²Œ ì…ê³  ëŒ€ê¸°\n      if (notReceived && isSeonJin) {\n        return true\n      }\n      \n      // ì¼ë°˜ì€ ìµœì¢… ìŠ¹ì¸ ì™„ë£Œë˜ì–´ì•¼ ì…ê³  ëŒ€ê¸°\n      const finalApproved = item.final_manager_status === 'approved'\n      \n      return notReceived && finalApproved\n    })\n\n\n    const recentCompleted = allMyRequests.filter((item: any) => {\n      // ì…ê³  ì™„ë£Œ && 7ì¼ ì´ë‚´ && ë³¸ì¸ ê²ƒë§Œ\n      if (item.is_received !== true) return false\n      if (!item.received_at) return false\n      if (item.requester_name !== requesterName) return false\n      \n      const receivedDate = new Date(item.received_at)\n      const sevenDaysAgoDate = new Date(sevenDaysAgo)\n      return receivedDate >= sevenDaysAgoDate\n    })\n\n\n    return {\n      waitingPurchase: waitingPurchase,\n      waitingDelivery: waitingDelivery,\n      recentCompleted: recentCompleted\n    }\n  }\n\n  // ì›í´ë¦­ ìŠ¹ì¸ API\n  async quickApprove(requestId: string, employee: Employee): Promise<{success: boolean, error?: string}> {\n    \n    try {\n      const roles = this.parseRoles(employee.purchase_role)\n\n      // ë¨¼ì € í˜„ì¬ ìš”ì²­ì˜ ìƒíƒœë¥¼ í™•ì¸\n      const { data: request } = await this.supabase\n        .from('purchase_requests')\n        .select('middle_manager_status, final_manager_status')\n        .eq('id', requestId)\n        .single()\n\n      if (!request) {\n        return { success: false, error: 'ìš”ì²­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.' }\n      }\n      \n\n      let updateData: any = {}\n\n      // pending, ëŒ€ê¸°, null, ë¹ˆ ë¬¸ìì—´ ëª¨ë‘ ëŒ€ê¸° ìƒíƒœë¡œ ê°„ì£¼\n      const isPending = (status: any) => (\n        status === 'pending' || status === 'ëŒ€ê¸°' || status === '' || status === null || status === undefined\n      )\n\n      // app_adminì€ í˜„ì¬ í•„ìš”í•œ ìŠ¹ì¸ ë‹¨ê³„ë¥¼ ì²˜ë¦¬\n      if (roles.includes('app_admin')) {\n        if (isPending(request.middle_manager_status)) {\n          updateData = {\n            middle_manager_status: 'approved'\n          }\n        } else if (request.middle_manager_status === 'approved' && isPending(request.final_manager_status)) {\n          updateData = {\n            final_manager_status: 'approved'\n          }\n        }\n      } else if (roles.includes('middle_manager')) {\n        if (isPending(request.middle_manager_status)) {\n          updateData = {\n            middle_manager_status: 'approved'\n          }\n        }\n      } else if (roles.includes('final_approver') || roles.includes('ceo')) {\n        if (request.middle_manager_status === 'approved' && isPending(request.final_manager_status)) {\n          updateData = {\n            final_manager_status: 'approved'\n          }\n        }\n      } else if (roles.includes('raw_material_manager') || roles.includes('consumable_manager')) {\n        // raw_material_managerì™€ consumable_managerë„ ìµœì¢… ìŠ¹ì¸ ê¶Œí•œì´ ìˆìŒ\n        if (request.middle_manager_status === 'approved' && isPending(request.final_manager_status)) {\n          updateData = {\n            final_manager_status: 'approved'\n          }\n        }\n      }\n\n      // updateDataê°€ ë¹„ì–´ìˆìœ¼ë©´ ìŠ¹ì¸í•  ë‹¨ê³„ê°€ ì—†ìŒ\n      if (Object.keys(updateData).length === 0) {\n        return { success: false, error: 'ìŠ¹ì¸í•  ìˆ˜ ìˆëŠ” ìƒíƒœê°€ ì•„ë‹™ë‹ˆë‹¤.' }\n      }\n      \n\n      const { data: updatedData, error } = await this.supabase\n        .from('purchase_requests')\n        .update(updateData)\n        .eq('id', requestId)\n        .select()\n        .single()\n\n      if (error) {\n        // Error details are handled by the caller\n        throw error\n      }\n\n      return { success: true }\n    } catch (error) {\n      return { success: false, error: (error as Error).message }\n    }\n  }\n\n  // Helper methods\n  private async getPendingCount(employee: Employee, roles: string[]): Promise<number> {\n    // ê³µí†µ: 'ëŒ€ê¸°', null, ë¹ˆ ë¬¸ìì—´ë„ ëŒ€ê¸° ìƒíƒœë¡œ ê°„ì£¼\n    const pendingClause = (col: string) => (\n      `${col}.in.(pending,ëŒ€ê¸°),${col}.is.null`\n    )\n\n    // ì—­í• ë³„ ì¹´ìš´íŠ¸ ì¿¼ë¦¬ êµ¬ì„±\n    if (roles.includes('app_admin')) {\n      // 1) ì¤‘ê°„ ìŠ¹ì¸ ëŒ€ê¸° + 2) ìµœì¢… ìŠ¹ì¸ ëŒ€ê¸°(ì¤‘ê°„ ìŠ¹ì¸ ì™„ë£Œ) + 3) êµ¬ë§¤ ëŒ€ê¸°(ìµœì¢… ìŠ¹ì¸ ì™„ë£Œ)\n      const [mid, fin, pur] = await Promise.all([\n        this.supabase\n          .from('purchase_requests')\n          .select('id', { count: 'exact', head: true })\n          .or(`middle_manager_status.in.(pending,ëŒ€ê¸°),middle_manager_status.is.null`),\n        this.supabase\n          .from('purchase_requests')\n          .select('id', { count: 'exact', head: true })\n          .eq('middle_manager_status', 'approved')\n          .or(`final_manager_status.in.(pending,ëŒ€ê¸°),final_manager_status.is.null`),\n        this.supabase\n          .from('purchase_requests')\n          .select('id', { count: 'exact', head: true })\n          .eq('final_manager_status', 'approved')\n          .eq('is_payment_completed', false)\n      ])\n\n      const total = (mid.count || 0) + (fin.count || 0) + (pur.count || 0)\n      return total\n    }\n\n    if (roles.includes('middle_manager')) {\n      const { count, error } = await this.supabase\n        .from('purchase_requests')\n        .select('id', { count: 'exact', head: true })\n        .or(`middle_manager_status.in.(pending,ëŒ€ê¸°),middle_manager_status.is.null`)\n\n      if (error) {\n        // Count error for middle_manager - will use 0\n        return 0\n      }\n      return count || 0\n    }\n\n    if (roles.includes('final_approver') || roles.includes('ceo')) {\n      const { count, error } = await this.supabase\n        .from('purchase_requests')\n        .select('id', { count: 'exact', head: true })\n        .eq('middle_manager_status', 'approved')\n        .or(`final_manager_status.in.(pending,ëŒ€ê¸°),final_manager_status.is.null`)\n\n      if (error) {\n        // Count error for final_approver/ceo - will use 0\n        return 0\n      }\n      return count || 0\n    }\n\n    if (roles.includes('lead buyer')) {\n      const { count, error } = await this.supabase\n        .from('purchase_requests')\n        .select('id', { count: 'exact', head: true })\n        .eq('final_manager_status', 'approved')\n        .eq('is_payment_completed', false)\n\n      if (error) {\n        // Count error for lead buyer - will use 0\n        return 0\n      }\n      return count || 0\n    }\n\n    return 0\n  }\n\n  private async getUrgentCount(employee: Employee, roles: string[]): Promise<number> {\n    // ì—­í• ì´ ì—†ìœ¼ë©´ ê¸´ê¸‰ ìš”ì²­ ì¹´ìš´íŠ¸ë„ 0\n    if (roles.length === 0) {\n      return 0\n    }\n\n    const threeDaysAgo = new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString()\n    \n    let query = this.supabase\n      .from('purchase_requests')\n      .select('id', { count: 'exact', head: true })\n      .lt('created_at', threeDaysAgo)\n\n    if (roles.includes('app_admin')) {\n      query = query.or('middle_manager_status.eq.pending,final_manager_status.eq.pending,is_payment_completed.eq.false')\n    } else if (roles.includes('middle_manager')) {\n      query = query.eq('middle_manager_status', 'pending')\n    } else if (roles.includes('final_approver') || roles.includes('ceo')) {\n      query = query\n        .eq('middle_manager_status', 'approved')\n        .eq('final_manager_status', 'pending')\n    } else if (roles.includes('lead buyer')) {\n      query = query\n        .eq('final_manager_status', 'approved')\n        .eq('is_payment_completed', false)\n    } else {\n      return 0\n    }\n\n    const { count } = await query\n    return count || 0\n  }\n\n  private async getTodayActionsCount(employee: Employee, today: string): Promise<number> {\n    // middle_manager_idì™€ final_manager_id ì»¬ëŸ¼ì´ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ\n    // ì˜¤ëŠ˜ ì—…ë°ì´íŠ¸ëœ ìš”ì²­ ì¤‘ í•´ë‹¹ ì§ì›ì´ ìš”ì²­í•œ ìš”ì²­ë§Œ ì¹´ìš´íŠ¸\n    const tomorrow = new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString().split('T')[0]\n    \n    const { count } = await this.supabase\n      .from('purchase_requests')\n      .select('id', { count: 'exact', head: true })\n      .gte('updated_at', today)\n      .lt('updated_at', tomorrow)\n      .eq('requester_name', employee.name)\n\n    return count || 0\n  }\n\n  // ì „ì²´ ì…ê³ ëŒ€ê¸° ê±´ìˆ˜ ì¡°íšŒ (ê¶Œí•œì— ê´€ê³„ì—†ì´ ì „ì²´ ì¡°íšŒ)\n  async getTotalDeliveryWaitingCount(): Promise<number> {\n    const { count } = await this.supabase\n      .from('purchase_requests')\n      .select('id', { count: 'exact', head: true })\n      .eq('is_received', false)\n      .or('is_payment_completed.eq.true,progress_type.ilike.%ì„ ì§„í–‰%')\n\n    return count || 0\n  }\n\n  private calculateProgress(request: any): number {\n    let progress = 0\n    \n    if (request.middle_manager_status === 'approved') progress += 25\n    if (request.final_manager_status === 'approved') progress += 25\n    if (request.is_payment_completed) progress += 25\n    if (request.is_received) progress += 25\n    \n    return progress\n  }\n\n  private getCurrentStep(request: any): 'approval' | 'purchase' | 'delivery' | 'payment' | 'completed' {\n    if (request.is_received) return 'completed'\n    if (request.is_payment_completed) return 'delivery'\n    if (request.final_manager_status === 'approved') return 'purchase'\n    return 'approval'\n  }\n\n  private getNextAction(request: any): string {\n    if (request.middle_manager_status === 'pending') return 'ì¤‘ê°„ ìŠ¹ì¸ ëŒ€ê¸° ì¤‘'\n    if (request.final_manager_status === 'pending') return 'ìµœì¢… ìŠ¹ì¸ ëŒ€ê¸° ì¤‘'\n    if (!request.is_payment_completed) return 'êµ¬ë§¤ ì²˜ë¦¬ ëŒ€ê¸° ì¤‘'\n    if (!request.is_received) return 'ì…ê³  ëŒ€ê¸° ì¤‘'\n    return 'ì™„ë£Œ'\n  }\n\n  private estimateCompletion(request: any): string {\n    const created = new Date(request.created_at)\n    const today = new Date()\n    const daysPassed = Math.floor((today.getTime() - created.getTime()) / (1000 * 60 * 60 * 24))\n    \n    // í‰ê·  ì²˜ë¦¬ ì‹œê°„ì„ ê¸°ë°˜ìœ¼ë¡œ ì˜ˆìƒ ì™„ë£Œì¼ ê³„ì‚°\n    let estimatedDays = 7 // ê¸°ë³¸ 7ì¼\n    if (request.progress_type === 'ê¸´ê¸‰') estimatedDays = 3\n    \n    const estimatedCompletion = new Date(created.getTime() + estimatedDays * 24 * 60 * 60 * 1000)\n    return estimatedCompletion.toLocaleDateString('ko-KR')\n  }\n\n  // lead buyer ë˜ëŠ” app_adminì„ ìœ„í•œ ë¯¸ë‹¤ìš´ë¡œë“œ ë°œì£¼ì„œ ëª©ë¡ ì¡°íšŒ - ì´ë¯¸ JOIN ìµœì í™”ë¨\n  async getUndownloadedOrders(employee: Employee): Promise<PurchaseRequestWithDetails[]> {\n    const roles = this.parseRoles(employee.purchase_role)\n    \n    // lead buyer ë˜ëŠ” app_admin ê¶Œí•œ ì²´í¬\n    if (!roles.includes('lead buyer') && !roles.includes('app_admin')) {\n      logger.info('[DashboardService] ë¯¸ë‹¤ìš´ë¡œë“œ ë°œì£¼ì„œ ì¡°íšŒ ê¶Œí•œ ì—†ìŒ:', { roles })\n      return []\n    }\n\n    try {\n      // ë¯¸ë‹¤ìš´ë¡œë“œ ë°œì£¼ì„œë§Œ ë¨¼ì € ê°€ì ¸ì˜¤ê¸° (NULLì´ê±°ë‚˜ falseì¸ ê²ƒë“¤)\n      const { data, error } = await this.supabase\n        .from('purchase_requests')\n        .select('*,purchase_request_items(id,item_name,specification,quantity,unit_price_value,amount_value)')\n        .or('is_po_download.is.null,is_po_download.eq.false')\n        .order('created_at', { ascending: false })  // ìµœì‹  ìˆœìœ¼ë¡œ ì •ë ¬\n        .limit(500)  // ë” ë§ì€ ë°ì´í„° ì¡°íšŒ\n\n      if (error) {\n        logger.error('[DashboardService] ë¯¸ë‹¤ìš´ë¡œë“œ ë°œì£¼ì„œ ì¡°íšŒ ì¿¼ë¦¬ ì—ëŸ¬:', error)\n        throw error\n      }\n\n      // í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œ ì¡°ê±´ì— ë§ëŠ” ê²ƒë§Œ í•„í„°ë§\n      // ì¼ì‹œì ìœ¼ë¡œ í•„í„°ë§ ì™„í™” - ì „ì²´ ë¯¸ë‹¤ìš´ë¡œë“œ í•­ëª© ì¡°íšŒ\n      const filteredData = (data || []).filter((item: any) => {\n        // is_po_downloadê°€ trueì¸ ê²ƒë§Œ ì œì™¸ (ì‹¤ì œ ë‹¤ìš´ë¡œë“œ ì™„ë£Œëœ ê²ƒ)\n        if (item.is_po_download === true) return false\n        \n        // ë‚˜ë¨¸ì§€ëŠ” ëª¨ë‘ í¬í•¨ (lead buyerê°€ ì „ì²´ë¥¼ ë³¼ ìˆ˜ ìˆë„ë¡)\n        return true\n      })\n\n      logger.info('[DashboardService] ë¯¸ë‹¤ìš´ë¡œë“œ ë°œì£¼ì„œ í•„í„°ë§ ê²°ê³¼:', {\n        totalFetched: data?.length || 0,\n        afterFilter: filteredData.length,\n        roles,\n        employeeName: employee.name,\n        sampleItems: filteredData.slice(0, 3).map((item: any) => ({\n          id: item.id,\n          purchase_order_number: item.purchase_order_number,\n          requester_name: item.requester_name,\n          payment_category: item.payment_category,\n          progress_type: item.progress_type,\n          is_po_download: item.is_po_download,\n          is_payment_completed: item.is_payment_completed\n        }))\n      })\n\n      return filteredData\n    } catch (error) {\n      logger.error('[DashboardService] getUndownloadedOrders ì—ëŸ¬:', error)\n      throw error // ì—ëŸ¬ë¥¼ ìƒìœ„ë¡œ ì „íŒŒ\n    }\n  }\n}\n\nexport const dashboardService = new DashboardService()","\nimport { useState, useEffect, useCallback } from 'react'\nimport { useAuth } from '@/contexts/AuthContext'\nimport { dashboardService } from '@/services/dashboardService'\nimport { createClient } from '@/lib/supabase/client'\nimport { updatePurchaseInMemory } from '@/services/purchaseDataLoader'\nimport { Button } from '@/components/ui/button'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Input } from '@/components/ui/input'\nimport { Clock, CheckCircle, ArrowRight, X, Package, Truck, ShoppingCart, Download, Search } from 'lucide-react'\nimport { downloadPurchaseOrderExcel } from '@/utils/excelDownload'\n\n// ëª¨ë“  ì¹´ë“œì—ì„œ ì‚¬ìš©í•˜ëŠ” ëª¨ë‹¬ (activeTabì— ë”°ë¼ ë‹¤ë¥¸ ë‚´ìš© í‘œì‹œ)\nimport PurchaseDetailModal from '@/components/purchase/PurchaseDetailModal'\n\nimport { toast } from 'sonner'\nimport type { DashboardData, Purchase } from '@/types/purchase'\nimport { useNavigate } from 'react-router-dom'\nimport { logger } from '@/lib/logger'\n\nexport default function DashboardMain() {\n  const [data, setData] = useState<DashboardData | null>(null)\n  const [loading, setLoading] = useState(true)\n  const [actionLoading, setActionLoading] = useState<string | null>(null)\n  const [currentUserRoles, setCurrentUserRoles] = useState<string[]>([])\n  const [undownloadedOrders, setUndownloadedOrders] = useState<any[]>([])\n  const [downloadingIds, setDownloadingIds] = useState<Set<string>>(new Set())\n  \n  const supabase = createClient()\n  \n  // PurchaseDetailModal ìƒíƒœ (ëª¨ë“  ì¹´ë“œì—ì„œ ì‚¬ìš©)\n  const [selectedPurchaseId, setSelectedPurchaseId] = useState<number | null>(null)\n  const [isModalOpen, setIsModalOpen] = useState(false)\n  const [modalActiveTab, setModalActiveTab] = useState<string>('pending') // ëª¨ë‹¬ì˜ activeTab ê°’\n  \n  // ê²€ìƒ‰ ìƒíƒœ\n  const [searchTerms, setSearchTerms] = useState({\n    undownloaded: '',\n    pending: '',\n    purchase: '',\n    delivery: ''\n  })\n  \n  const navigate = useNavigate()\n  const { employee, currentUserRoles: userRoles } = useAuth()\n\n  const loadDashboardData = useCallback(async (showLoading = true, forceRefresh = false) => {\n    if (!employee) {\n      logger.error('[DashboardMain] No employee data available')\n      if (showLoading) {\n        setLoading(false)\n      }\n      return\n    }\n\n    try {\n      if (showLoading && !forceRefresh && !data) {\n        setLoading(true)\n      }\n      \n      const dashboardData = await dashboardService.getDashboardData(employee, forceRefresh)\n      setData(dashboardData)\n      setCurrentUserRoles(userRoles)\n      \n      // lead buyer ë˜ëŠ” app_adminì¸ ê²½ìš° ë¯¸ë‹¤ìš´ë¡œë“œ í•­ëª© ì¡°íšŒ\n      if (userRoles.includes('lead buyer') || userRoles.includes('app_admin')) {\n        try {\n          const undownloaded = await dashboardService.getUndownloadedOrders(employee)\n          logger.info('[DashboardMain] ë¯¸ë‹¤ìš´ë¡œë“œ ë°œì£¼ì„œ ì¡°íšŒ ê²°ê³¼:', { \n            count: undownloaded.length,\n            userRoles,\n            employeeName: employee.name,\n            sampleItems: undownloaded.slice(0, 3).map(item => ({\n              purchase_order_number: item.purchase_order_number,\n              requester_name: item.requester_name,\n              vendor_name: item.vendor_name\n            }))\n          })\n          setUndownloadedOrders(undownloaded)\n        } catch (undownloadedError) {\n          logger.error('[DashboardMain] ë¯¸ë‹¤ìš´ë¡œë“œ ë°œì£¼ì„œ ì¡°íšŒ ì‹¤íŒ¨:', undownloadedError)\n          toast.error('ë¯¸ë‹¤ìš´ë¡œë“œ ë°œì£¼ì„œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.')\n        }\n      }\n    } catch (error) {\n      logger.error('[DashboardMain] Failed to load dashboard data:', error)\n      toast.error('ëŒ€ì‹œë³´ë“œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.')\n      // ì—ëŸ¬ ë°œìƒ ì‹œì—ë„ ë¡œë”© ìƒíƒœ í•´ì œ\n      setLoading(false)\n      // ë¹ˆ ë°ì´í„°ë¼ë„ ì„¤ì •í•´ì„œ UIê°€ ë Œë”ë§ë˜ë„ë¡\n      setData(null)\n    } finally {\n      if (showLoading) {\n        setLoading(false)\n      }\n    }\n  }, [employee, userRoles, data])\n\n  useEffect(() => {\n    loadDashboardData()\n  }, [loadDashboardData])\n\n  const handleQuickApprove = async (requestId: string) => {\n    if (!data?.employee) {\n      toast.error('ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')\n      return\n    }\n\n    // ìŠ¹ì¸ í™•ì¸ ë©”ì‹œì§€\n    if (!confirm('ì •ë§ë¡œ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {\n      return\n    }\n\n    setActionLoading(requestId)\n    \n    // UI ë¸”ë¡œí‚¹ ë°©ì§€ë¥¼ ìœ„í•´ ë‹¤ìŒ í‹±ìœ¼ë¡œ ì§€ì—°\n    await new Promise(resolve => setTimeout(resolve, 0))\n    \n    // Optimistic Update: ì¦‰ì‹œ UIì—ì„œ ì œê±°\n    const originalData = data\n    setData(prev => {\n      if (!prev) return prev\n      return {\n        ...prev,\n        pendingApprovals: prev.pendingApprovals.filter(item => item.id !== requestId),\n        stats: {\n          ...prev.stats,\n          pending: Math.max(0, prev.stats.pending - 1)\n        }\n      }\n    })\n\n    try {\n      const result = await dashboardService.quickApprove(requestId, data.employee)\n      \n      if (result.success) {\n        toast.success('ìŠ¹ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.')\n        // ì„±ê³µ ì‹œ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë°ì´í„° ë™ê¸°í™” (UI ê¹œë¹¡ì„ ì—†ì´)\n        setTimeout(() => {\n          loadDashboardData(false)  // falseë¥¼ ì „ë‹¬í•˜ì—¬ ë¡œë”© í™”ë©´ í‘œì‹œ ì•ˆ í•¨\n        }, 1000)\n      } else {\n        // ì‹¤íŒ¨ ì‹œ ì›ë˜ ë°ì´í„°ë¡œ ë¡¤ë°±\n        setData(originalData)\n        toast.error(result.error || 'ìŠ¹ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n      }\n    } catch (error) {\n      // ì—ëŸ¬ ì‹œ ì›ë˜ ë°ì´í„°ë¡œ ë¡¤ë°±\n      setData(originalData)\n      toast.error('ìŠ¹ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n    } finally {\n      setActionLoading(null)\n    }\n  }\n\n  // ëª¨ë‹¬ ì—´ê¸° í—¬í¼ í•¨ìˆ˜ (PurchaseDetailModal ì‚¬ìš©, activeTab ì „ë‹¬)\n  const openPurchaseModal = (item: any, activeTab: string = 'pending') => {\n    setSelectedPurchaseId(Number(item.id))\n    setModalActiveTab(activeTab)\n    setIsModalOpen(true)\n  }\n\n  // ê²€ìƒ‰ í•„í„°ë§ í•¨ìˆ˜\n  const filterItems = (items: any[], searchTerm: string) => {\n    if (!searchTerm.trim()) return items\n    \n    return items.filter(item => {\n      const orderNumber = item.purchase_order_number || ''\n      const vendorName = item.vendor_name || ''\n      const itemsText = (item.purchase_request_items || [])\n        .map((pItem: any) => pItem.item_name || '')\n        .join(' ')\n      \n      return [orderNumber, vendorName, itemsText]\n        .join(' ')\n        .toLowerCase()\n        .includes(searchTerm.toLowerCase())\n    })\n  }\n\n  const handleDownloadExcel = async (purchase: any) => {\n    try {\n      setDownloadingIds(prev => new Set(prev).add(purchase.id))\n      \n      // UI ë¸”ë¡œí‚¹ ë°©ì§€ë¥¼ ìœ„í•´ ë‹¤ìŒ í‹±ìœ¼ë¡œ ì§€ì—°\n      await new Promise(resolve => setTimeout(resolve, 0))\n      \n      // ê´€ë¦¬íƒ­ê³¼ ë™ì¼í•œ Excel ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜ í˜¸ì¶œ\n      await downloadPurchaseOrderExcel(\n        {\n          id: purchase.id,\n          purchase_order_number: purchase.purchase_order_number,\n          vendor_name: purchase.vendor_name,\n          vendor_id: purchase.vendor_id,\n          contact_id: purchase.contact_id\n        },\n        currentUserRoles,\n        () => {\n          // ì„±ê³µ ì½œë°±: UIì—ì„œ ë‹¤ìš´ë¡œë“œ ì™„ë£Œëœ í•­ëª© ì œê±°\n          setUndownloadedOrders(prev => prev.filter(item => item.id !== purchase.id))\n        }\n      )\n    } catch (error) {\n      logger.error('Excel ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ', error)\n    } finally {\n      setDownloadingIds(prev => {\n        const newSet = new Set(prev)\n        newSet.delete(purchase.id)\n        return newSet\n      })\n    }\n  }\n\n  const getStepColor = (step: string) => {\n    switch (step) {\n      case 'approval': return 'bg-yellow-100 text-yellow-800'\n      case 'purchase': return 'bg-blue-100 text-blue-800'\n      case 'delivery': return 'bg-purple-100 text-purple-800'\n      case 'completed': return 'bg-green-100 text-green-800'\n      default: return 'bg-gray-100 text-gray-800'\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center\" style={{ minHeight: '400px', backgroundColor: '#f9fafb' }}>\n        <div className=\"text-center\">\n          <div className=\"w-12 h-12 border-3 border-hansl-500 border-t-transparent rounded-full animate-spin mx-auto\" />\n          <p className=\"mt-4 card-subtitle\">ëŒ€ì‹œë³´ë“œë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆìŠµë‹ˆë‹¤...</p>\n          <p className=\"text-xs text-gray-400 mt-2\">Employee: {employee?.name || 'ì—†ìŒ'}</p>\n        </div>\n      </div>\n    )\n  }\n\n  if (!data?.employee) {\n    logger.warn('[DashboardMain] ë°ì´í„° ì—†ìŒ', { \n      hasData: !!data, \n      hasEmployee: !!employee,\n      employeeName: employee?.name,\n      loading \n    })\n    return (\n      <div className=\"flex items-center justify-center\" style={{ minHeight: '400px', backgroundColor: '#f9fafb' }}>\n        <div className=\"text-center bg-white p-8 rounded-lg border border-gray-200 shadow-sm\">\n          <h3 className=\"modal-subtitle mb-2\">ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h3>\n          <p className=\"card-subtitle mb-4\">ë¡œê·¸ì¸ì„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p>\n          <div className=\"text-xs text-gray-400 space-y-1\">\n            <p>Employee: {employee?.name || 'ì—†ìŒ'}</p>\n            <p>Loading: {loading ? 'true' : 'false'}</p>\n            <p>Has Data: {data ? 'true' : 'false'}</p>\n          </div>\n        </div>\n      </div>\n    )\n  }\n\n  // ê¶Œí•œ íŒŒì‹± ë° í‘œì‹œ ì—¬ë¶€ ê²°ì •\n  const roles = Array.isArray(data.employee.purchase_role)\n    ? (data.employee.purchase_role as any[]).map((r: any) => String(r).trim())\n    : (data.employee.purchase_role\n        ? String(data.employee.purchase_role)\n            .split(',')\n            .map((r: string) => r.trim())\n            .filter((r: string) => r.length > 0)\n        : [])\n\n  const canSeeApprovalBox = roles.some((r: string) => ['middle_manager', 'final_approver', 'app_admin', 'raw_material_manager', 'consumable_manager'].includes(r))\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <div className=\"w-full px-4 lg:px-6\">\n        {/* í—¤ë” */}\n        <div className=\"mb-3\">\n          <div>\n            <h1 className=\"page-title\">ëŒ€ì‹œë³´ë“œ</h1>\n            <p className=\"page-subtitle\" style={{marginTop:'-2px',marginBottom:'-4px'}}>Dashboard</p>\n          </div>\n        </div>\n\n        {/* í†µí•© ëŒ€ì‹œë³´ë“œ ê·¸ë¦¬ë“œ */}\n        <div className=\"mb-2\">\n          <h2 className=\"section-title mb-2 flex items-center gap-1.5\">\n            <Package className=\"w-3.5 h-3.5 text-gray-600\" />\n            ì „ì²´ í˜„í™©\n            <span className=\"badge-stats border border-gray-300 bg-white text-gray-600 ml-2\">\n              {new Date().toLocaleDateString('ko-KR', { \n                month: 'long', \n                day: 'numeric',\n                weekday: 'short'\n              })}\n            </span>\n          </h2>\n        </div>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3\">\n          {/* Lead Buyer / App Admin - ë¯¸ë‹¤ìš´ë¡œë“œ ë°œì£¼ì„œ */}\n          {(currentUserRoles.includes('lead buyer') || currentUserRoles.includes('app_admin')) && (\n            <Card className=\"w-full col-span-1 row-span-2 border-gray-200 shadow-sm hover:shadow-md transition-shadow\">\n              <CardHeader className=\"h-12 px-4 bg-gray-50 border-b flex items-center\">\n                <CardTitle className=\"section-title flex items-center justify-between w-full\">\n                  <div className=\"flex items-center gap-2\">\n                    <Download className=\"w-4 h-4 text-orange-600\" />\n                    <span>ë¯¸ë‹¤ìš´ë¡œë“œ ë°œì£¼ì„œ</span>\n                  </div>\n                  <span className=\"badge-stats bg-gray-200 text-gray-700\">\n                    {undownloadedOrders.length}\n                  </span>\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"p-4\">\n                <div className=\"space-y-3\">\n                  {/* ê²€ìƒ‰ ì…ë ¥ */}\n                  <div className=\"relative\">\n                    <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                    <Input\n                      placeholder=\"ë°œì£¼ë²ˆí˜¸, ì—…ì²´ëª…, í’ˆëª©ìœ¼ë¡œ ê²€ìƒ‰...\"\n                      value={searchTerms.undownloaded}\n                      onChange={(e) => setSearchTerms(prev => ({ ...prev, undownloaded: e.target.value }))}\n                      className=\"pl-10 h-8 text-xs\"\n                    />\n                  </div>\n                  \n                  \n                  {/* í•­ëª© ë¦¬ìŠ¤íŠ¸ */}\n                  <div className=\"space-y-2 h-[36rem] overflow-y-auto\">\n                    {filterItems(undownloadedOrders, searchTerms.undownloaded).length === 0 ? (\n                      <div className=\"text-center py-12 text-gray-400\">\n                        <Download className=\"w-10 h-10 mx-auto mb-3 text-gray-300\" />\n                        <p className=\"card-subtitle\">ë¯¸ë‹¤ìš´ë¡œë“œ ë°œì£¼ì„œê°€ ì—†ìŠµë‹ˆë‹¤</p>\n                      </div>\n                    ) : (\n                      filterItems(undownloadedOrders, searchTerms.undownloaded).map((item, index) => {\n                        const items = item.purchase_request_items || []\n                        const firstItem = items[0] || {}\n                        const isAdvance = item.progress_type === 'ì„ ì§„í–‰'\n                      \n                      return (\n                        <div \n                          key={`undownloaded-${item.id}`} \n                          className={`border rounded-lg p-2 hover:shadow-sm transition-all cursor-pointer mb-2 ${\n                            isAdvance ? 'bg-red-50 border-red-200' : 'hover:bg-orange-50/30'\n                          }`}\n                          onClick={(e) => {\n                            // ë²„íŠ¼ í´ë¦­ì€ ë¬´ì‹œ\n                            if ((e.target as HTMLElement).closest('button')) return\n                            openPurchaseModal(item, 'pending') // ë¯¸ë‹¤ìš´ë¡œë“œ ë°œì£¼ì„œëŠ” ìŠ¹ì¸ëŒ€ê¸° íƒ­ê³¼ ë™ì¼\n                          }}\n                        >\n                          <div className=\"flex items-center justify-between gap-2\">\n                            <div className=\"flex items-center gap-2 flex-1 min-w-0\">\n                              <span className=\"card-title\">\n                                {item.purchase_order_number || `PO-${item.id.slice(0, 8)}`}\n                              </span>\n                              <span className=\"card-subtitle truncate\">\n                                {item.vendor_name || 'ì—…ì²´ëª… ì—†ìŒ'}\n                              </span>\n                              <span className=\"card-description truncate\">\n                                {firstItem.item_name || 'í’ˆëª©'} \n                                {items.length > 1 && (\n                                  <span className=\"text-gray-400\"> ì™¸ {items.length - 1}ê±´</span>\n                                )}\n                              </span>\n                            </div>\n                            <Button\n                              className=\"button-base bg-gray-500 hover:bg-gray-600 text-white\"\n                              onClick={async (e) => {\n                                e.stopPropagation()\n                                await handleDownloadExcel(item)\n                              }}\n                              disabled={downloadingIds.has(item.id)}\n                            >\n                              {downloadingIds.has(item.id) ? (\n                                <div className=\"w-3 h-3 border border-white border-t-transparent rounded-full animate-spin\" />\n                              ) : (\n                                \"ë‹¤ìš´ë¡œë“œ\"\n                              )}\n                            </Button>\n                          </div>\n                        </div>\n                      )\n                      })\n                    )}\n                    {filterItems(undownloadedOrders, searchTerms.undownloaded).length >= 100 && (\n                      <div className=\"text-center text-xs text-gray-500 mt-3 pb-2\">\n                        í‘œì‹œëœ í•­ëª©: {filterItems(undownloadedOrders, searchTerms.undownloaded).length}ê°œ\n                        <br />\n                        ë” ë§ì€ í•­ëª©ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê²€ìƒ‰ìœ¼ë¡œ í•„í„°ë§í•˜ì„¸ìš”.\n                      </div>\n                    )}\n                    {filterItems(undownloadedOrders, searchTerms.undownloaded).length > 0 && (\n                      <div className=\"text-center text-xs text-gray-400 mt-2 pb-2\">\n                        ì´ {filterItems(undownloadedOrders, searchTerms.undownloaded).length}ê°œ ë¯¸ë‹¤ìš´ë¡œë“œ ë°œì£¼ì„œ\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          )}\n\n\n          {/* ìŠ¹ì¸ ëŒ€ê¸° (ìŠ¹ì¸ ê¶Œí•œìë§Œ í‘œì‹œ) */}\n          {canSeeApprovalBox && (\n            <Card className=\"w-full col-span-1 row-span-2\">\n              <CardHeader className=\"h-12 px-4 bg-gray-50 border-b flex items-center\">\n                <CardTitle className=\"section-title flex items-center justify-between w-full\">\n                  <div className=\"flex items-center gap-2\">\n                    <Clock className=\"w-3.5 h-3.5 text-orange-500\" />\n                    <span>ìŠ¹ì¸ ëŒ€ê¸°</span>\n                  </div>\n                  {data.pendingApprovals.length > 0 && (\n                    <span className=\"badge-stats bg-gray-200 text-gray-700\">\n                      {data.pendingApprovals.length}\n                    </span>\n                  )}\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"p-4\">\n                {data.pendingApprovals.length === 0 ? (\n                  <div className=\"text-center py-4 text-gray-400\">\n                    <CheckCircle className=\"w-6 h-6 mx-auto mb-1\" />\n                    <p className=\"card-description\">ëŒ€ê¸° í•­ëª© ì—†ìŒ</p>\n                  </div>\n                  ) : (\n                  <div className=\"space-y-3\">\n                    {/* ê²€ìƒ‰ ì…ë ¥ */}\n                    <div className=\"relative\">\n                      <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                      <Input\n                        placeholder=\"ë°œì£¼ë²ˆí˜¸, ì—…ì²´ëª…, í’ˆëª©ìœ¼ë¡œ ê²€ìƒ‰...\"\n                        value={searchTerms.pending}\n                        onChange={(e) => setSearchTerms(prev => ({ ...prev, pending: e.target.value }))}\n                        className=\"pl-10 h-8 text-xs\"\n                      />\n                    </div>\n                    \n                    {/* í•­ëª© ë¦¬ìŠ¤íŠ¸ */}\n                    <div className=\"space-y-2 h-[36rem] overflow-y-auto\">\n                      {filterItems(data.pendingApprovals, searchTerms.pending).slice(0, 10).map((approval, index) => {\n                        const items = approval.purchase_request_items || []\n                        const firstItem = items[0] || {}\n                        const totalAmount = approval.total_amount || items.reduce((sum: number, i: any) => sum + (Number(i.amount_value) || 0), 0)\n                        const isAdvance = approval.progress_type === 'ì„ ì§„í–‰'\n                        \n                        return (\n                          <div \n                            key={`approval-${approval.id}`} \n                            className={`border rounded-lg p-2 hover:shadow-sm transition-all cursor-pointer mb-2 ${\n                              isAdvance ? 'bg-red-50 border-red-200' : 'hover:bg-orange-50/30'\n                            }`}\n                            onClick={(e) => {\n                              // ë²„íŠ¼ í´ë¦­ì€ ë¬´ì‹œ\n                              if ((e.target as HTMLElement).closest('button')) return\n                              openPurchaseModal(approval, 'pending') // ìŠ¹ì¸ëŒ€ê¸° íƒ­\n                            }}\n                          >\n                            <div className=\"flex items-center justify-between gap-2\">\n                              <div className=\"flex items-center gap-2 flex-1 min-w-0\">\n                                <span className=\"card-title\">\n                                  {approval.purchase_order_number}\n                                </span>\n                                <span className=\"card-subtitle truncate\">{approval.vendor_name || 'ì—…ì²´'}</span>\n                                <span className=\"card-description truncate\">\n                                  {firstItem.item_name || 'í’ˆëª©'} {items.length > 1 && `ì™¸ ${items.length - 1}ê±´`}\n                                </span>\n                              </div>\n                              <Button\n                                onClick={async (e) => {\n                                  e.stopPropagation()\n                                  await handleQuickApprove(approval.id)\n                                }}\n                                disabled={actionLoading === approval.id}\n                                className={`button-base text-white ${\n                                  approval.middle_manager_status === 'approved' \n                                    ? 'bg-blue-600 hover:bg-blue-700' \n                                    : 'bg-green-600 hover:bg-green-700'\n                                }`}\n                              >\n                                {actionLoading === approval.id ? (\n                                  <div className=\"w-3 h-3 border border-white border-t-transparent rounded-full animate-spin\" />\n                                ) : (\n                                  <>\n                                    {approval.middle_manager_status === 'approved' ? 'ìµœì¢…' : '1ì°¨'} ìŠ¹ì¸\n                                  </>\n                                )}\n                              </Button>\n                            </div>\n                          </div>\n                        )\n                      })}\n                    </div>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          )}\n          \n\n          {/* êµ¬ë§¤ ëŒ€ê¸°ì¤‘ - Lead Buyerì™€ App Adminë§Œ í‘œì‹œ */}\n          {(currentUserRoles.includes('lead buyer') || currentUserRoles.includes('app_admin')) && (\n            <Card className=\"w-full col-span-1 border-gray-200 shadow-sm hover:shadow-md transition-shadow\">\n              <CardHeader className=\"h-12 px-4 bg-gray-50 border-b flex items-center\">\n                <CardTitle className=\"section-title flex items-center justify-between w-full\">\n                  <div className=\"flex items-center gap-2\">\n                    <ShoppingCart className=\"w-4 h-4 text-yellow-600\" />\n                    <span>êµ¬ë§¤ ëŒ€ê¸°</span>\n                  </div>\n                  {data.myPurchaseStatus && data.myPurchaseStatus.waitingPurchase && data.myPurchaseStatus.waitingPurchase.length > 0 && (\n                    <span className=\"badge-stats bg-gray-200 text-gray-700\">\n                      {data.myPurchaseStatus.waitingPurchase.length}\n                    </span>\n                  )}\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"p-4\">\n                {!data.myPurchaseStatus || !data.myPurchaseStatus.waitingPurchase || data.myPurchaseStatus.waitingPurchase.length === 0 ? (\n                  <div className=\"text-center py-12 text-gray-400\">\n                    <ShoppingCart className=\"w-10 h-10 mx-auto mb-3 text-gray-300\" />\n                    <p className=\"card-subtitle\">êµ¬ë§¤ ëŒ€ê¸° í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤</p>\n                  </div>\n                ) : (\n                  <div className=\"space-y-3\">\n                    {/* ê²€ìƒ‰ ì…ë ¥ */}\n                    <div className=\"relative\">\n                      <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                      <Input\n                        placeholder=\"ë°œì£¼ë²ˆí˜¸, ì—…ì²´ëª…, í’ˆëª©ìœ¼ë¡œ ê²€ìƒ‰...\"\n                        value={searchTerms.purchase}\n                        onChange={(e) => setSearchTerms(prev => ({ ...prev, purchase: e.target.value }))}\n                        className=\"pl-10 h-8 text-xs\"\n                      />\n                    </div>\n                    \n                    {/* í•­ëª© ë¦¬ìŠ¤íŠ¸ */}\n                    <div className=\"space-y-2 h-[36rem] overflow-y-auto\">\n                      {filterItems(data.myPurchaseStatus.waitingPurchase, searchTerms.purchase).map((item) => {\n                        const items = item.purchase_request_items || []\n                        const firstItem = items[0]\n                        const totalAmount = items.reduce((sum: number, i: any) => sum + (Number(i.amount_value) || 0), 0)\n                        const isSeonJin = (item.progress_type || '').includes('ì„ ì§„í–‰')\n                        \n                        return (\n                          <div \n                            key={item.id} \n                            className={`border rounded-lg p-2 transition-all hover:shadow-sm mb-2 ${\n                              isSeonJin ? 'bg-red-50 hover:bg-red-100 border-red-200' : 'bg-white hover:bg-gray-50 border-gray-200'\n                            }`}\n                          >\n                            <div className=\"flex items-center justify-between gap-2\">\n                              <div \n                                className=\"flex items-center gap-2 flex-1 cursor-pointer\"\n                                onClick={(e) => {\n                                  // ë²„íŠ¼ í´ë¦­ì€ ë¬´ì‹œ\n                                  if ((e.target as HTMLElement).closest('button')) return\n                                  openPurchaseModal(item, 'purchase') // êµ¬ë§¤í˜„í™© íƒ­\n                                }}\n                              >\n                                <span className=\"card-title\">\n                                  {item.purchase_order_number || `PO-${item.id.slice(0, 8)}`}\n                                </span>\n                                <span className=\"card-subtitle truncate\">\n                                  {item.vendor_name || 'ì—…ì²´ëª… ì—†ìŒ'}\n                                </span>\n                                <span className=\"card-description truncate\">\n                                  {firstItem?.item_name || 'í’ˆëª©'} \n                                  {items.length > 1 && (\n                                    <span className=\"text-gray-400\"> ì™¸ {items.length - 1}ê±´</span>\n                                  )}\n                                </span>\n                              </div>\n                              \n                              {/* êµ¬ë§¤ì™„ë£Œ ë²„íŠ¼ - Lead Buyer, App Adminë§Œ í‘œì‹œ */}\n                              {(currentUserRoles.includes('lead buyer') || \n                                currentUserRoles.includes('app_admin')) && !item.is_payment_completed && (\n                                <Button\n                                  onClick={async (e) => {\n                                    e.stopPropagation()\n                                    if (!confirm('ì´ ë°œì£¼ë¥¼ êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return\n                                    \n                                    // UI ë¸”ë¡œí‚¹ ë°©ì§€ë¥¼ ìœ„í•´ ë‹¤ìŒ í‹±ìœ¼ë¡œ ì§€ì—°\n                                    await new Promise(resolve => setTimeout(resolve, 0))\n                                    \n                                    try {\n                                      const { error } = await supabase\n                                        .from('purchase_requests')\n                                        .update({ \n                                          is_payment_completed: true,\n                                          payment_completed_at: new Date().toISOString()\n                                        })\n                                        .eq('id', item.id)\n\n                                      if (error) throw error\n                                      \n                                      toast.success('êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.')\n                                      loadDashboardData(false) // ë°ì´í„° ìƒˆë¡œê³ ì¹¨\n                                    } catch (error) {\n                                      toast.error('ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')\n                                    }\n                                  }}\n                                  className=\"button-base bg-orange-500 hover:bg-orange-600 text-white\"\n                                >\n                                  êµ¬ë§¤ì™„ë£Œ\n                                </Button>\n                              )}\n                              \n                              {/* ì´ë¯¸ êµ¬ë§¤ì™„ë£Œëœ ê²½ìš° ì™„ë£Œ í‘œì‹œ */}\n                              {item.is_payment_completed && (\n                                <div className=\"bg-green-100 text-green-700 px-2 py-1 business-radius-badge badge-text shrink-0\">\n                                  ì™„ë£Œë¨\n                                </div>\n                              )}\n                            </div>\n                          </div>\n                        )\n                      })}\n                    </div>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          )}\n\n          {/* ì…ê³  ëŒ€ê¸°ì¤‘ */}\n          <Card className=\"w-full col-span-1 border-gray-200 shadow-sm hover:shadow-md transition-shadow\">\n              <CardHeader className=\"h-12 px-4 bg-gray-50 border-b flex items-center\">\n                <CardTitle className=\"section-title flex items-center justify-between w-full\">\n                  <div className=\"flex items-center gap-2\">\n                    <Truck className=\"w-4 h-4 text-blue-600\" />\n                    <span>ì…ê³  ëŒ€ê¸°</span>\n                  </div>\n                  {data.myPurchaseStatus.waitingDelivery.length > 0 && (\n                    <span className=\"badge-stats bg-gray-200 text-gray-700\">\n                      {data.myPurchaseStatus.waitingDelivery.length}\n                    </span>\n                  )}\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"p-4\">\n                {data.myPurchaseStatus.waitingDelivery.length === 0 ? (\n                  <div className=\"text-center py-12 text-gray-400\">\n                    <Truck className=\"w-10 h-10 mx-auto mb-3 text-gray-300\" />\n                    <p className=\"card-subtitle\">ì…ê³  ëŒ€ê¸° í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤</p>\n                  </div>\n                ) : (\n                  <div className=\"space-y-3\">\n                    {/* ê²€ìƒ‰ ì…ë ¥ */}\n                    <div className=\"relative\">\n                      <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                      <Input\n                        placeholder=\"ë°œì£¼ë²ˆí˜¸, ì—…ì²´ëª…, í’ˆëª©ìœ¼ë¡œ ê²€ìƒ‰...\"\n                        value={searchTerms.delivery}\n                        onChange={(e) => setSearchTerms(prev => ({ ...prev, delivery: e.target.value }))}\n                        className=\"pl-10 h-8 text-xs\"\n                      />\n                    </div>\n                    \n                    {/* í•­ëª© ë¦¬ìŠ¤íŠ¸ */}\n                    <div className=\"space-y-2 h-[36rem] overflow-y-auto\">\n                      {filterItems(data.myPurchaseStatus.waitingDelivery, searchTerms.delivery).slice(0, 10).map((item) => {\n                        const items = item.purchase_request_items || []\n                        const firstItem = items[0]\n                        const totalItems = items.length\n                        const receivedItems = items.filter((i: any) => i.is_received).length\n                        const progress = totalItems > 0 ? Math.round((receivedItems / totalItems) * 100) : 0\n                        const totalAmount = items.reduce((sum: number, i: any) => sum + (Number(i.amount_value) || 0), 0)\n                        const isSeonJin = (item.progress_type || '').includes('ì„ ì§„í–‰')\n                        \n                        return (\n                          <div \n                            key={item.id} \n                            className={`border rounded-lg p-2 transition-all cursor-pointer hover:shadow-sm mb-2 ${\n                              isSeonJin ? 'bg-red-50 hover:bg-red-100 border-red-200' : 'bg-white hover:bg-gray-50 border-gray-200'\n                            }`}\n                            onClick={(e) => {\n                              // ë²„íŠ¼ í´ë¦­ì€ ë¬´ì‹œ\n                              if ((e.target as HTMLElement).closest('button')) return\n                              openPurchaseModal(item, 'receipt') // ì…ê³ í˜„í™© íƒ­\n                            }}\n                          >\n                            <div className=\"flex items-center gap-2\">\n                              <span className=\"card-title\">\n                                {item.purchase_order_number || `PO-${item.id.slice(0, 8)}`}\n                              </span>\n                              <span className=\"card-subtitle truncate\">\n                                {item.vendor_name || 'ì—…ì²´ëª… ì—†ìŒ'}\n                              </span>\n                              <span className=\"card-description truncate\">\n                                {firstItem?.item_name || 'í’ˆëª©'} \n                                {totalItems > 1 && (\n                                  <span className=\"text-gray-400\"> ì™¸ {totalItems - 1}ê±´</span>\n                                )}\n                              </span>\n                            </div>\n                          </div>\n                        )\n                      })}\n                    </div>\n                  </div>\n                )}\n              </CardContent>\n          </Card>\n\n        </div>\n\n        {/* ì˜¤ëŠ˜ì˜ ìš”ì•½ - ìƒë‹¨ í†µê³„ì— í†µí•© */}\n      </div>\n      \n      {/* PurchaseDetailModal - ëª¨ë“  ì¹´ë“œì—ì„œ ì‚¬ìš© (activeTabì— ë”°ë¼ ë‹¤ë¥¸ ë‚´ìš© í‘œì‹œ) */}\n      <PurchaseDetailModal\n        purchaseId={selectedPurchaseId}\n        isOpen={isModalOpen}\n        onClose={() => {\n          setIsModalOpen(false)\n          setSelectedPurchaseId(null)\n          setModalActiveTab('pending')\n        }}\n        currentUserRoles={currentUserRoles}\n        activeTab={modalActiveTab}\n        onRefresh={() => {\n          loadDashboardData(false)\n          setIsModalOpen(false)\n          setSelectedPurchaseId(null)\n          setModalActiveTab('pending')\n        }}\n        onOptimisticUpdate={(purchaseId: number, updater: (prev: Purchase) => Purchase) => {\n          updatePurchaseInMemory(purchaseId, updater)\n          loadDashboardData(false)\n        }}\n      />\n    </div>\n  )\n}"],"names":["Clock","createLucideIcon","d","key","cx","cy","r","dashboardCache","data","lastFetch","CACHE_DURATION","employeeId","dashboardService","constructor","this","supabase","createClient","parseRoles","purchaseRole","roles","Array","isArray","map","String","trim","split","filter","length","getDashboardData","employee","forceRefresh","now","Date","id","results","Promise","allSettled","getDashboardStats","getMyRecentRequests","getPendingApprovals","getQuickActions","getTodaySummary","getMyPurchaseStatus","statsResult","myRecentRequestsResult","pendingApprovalsResult","quickActionsResult","todaySummaryResult","myPurchaseStatusResult","stats","status","value","total","myRequests","pending","completed","urgent","todayActions","myRecentRequests","pendingApprovals","quickActions","todaySummary","approved","requested","received","myPurchaseStatus","waitingPurchase","waitingDelivery","recentCompleted","logger","error","reason","dashboardData","urgentRequests","today","toISOString","purchase_role","totalResult","myRequestsResult","pendingResult","completedResult","urgentResult","todayActionsResult","all","from","select","count","head","eq","name","getPendingCount","gte","getFullYear","getMonth","getUrgentCount","getTodayActionsCount","or","order","ascending","limit","item","vendor_name","vendors","total_items","purchase_request_items","progress_percentage","calculateProgress","current_step","getCurrentStep","next_action","getNextAction","estimated_completion","estimateCompletion","debug","employeeName","employeeRoles","allRequests","requestsError","filteredData","isPending","totalRequests","middlePending","middle_manager_status","finalPending","final_manager_status","middleRejected","finalRejected","roleFilteredData","includes","totalItems","beforeFilter","afterFilter","middleApproved","finalApproved","purchasePending","is_payment_completed","result","enhancedData","total_amount","reduce","sum","i","Number","amount_value","quantity","unit_price_value","finalCount","performanceNote","actions","pendingCount","push","type","label","description","color","purchaseCount","tomorrow","approvedResult","requestedResult","receivedResult","lt","isLeadBuyer","requesterName","email","sevenDaysAgo","query","allMyRequests","isPurchaseRequest","payment_category","notPaid","progress_type","isIlban","notReceived","is_received","isSeonJin","requester_name","received_at","quickApprove","requestId","request","single","success","updateData","Object","keys","updatedData","update","message","mid","fin","pur","threeDaysAgo","getTotalDeliveryWaitingCount","progress","created","created_at","Math","floor","getTime","estimatedDays","toLocaleDateString","getUndownloadedOrders","info","is_po_download","totalFetched","sampleItems","slice","purchase_order_number","DashboardMain","setData","useState","loading","setLoading","actionLoading","setActionLoading","currentUserRoles","setCurrentUserRoles","undownloadedOrders","setUndownloadedOrders","downloadingIds","setDownloadingIds","Set","selectedPurchaseId","setSelectedPurchaseId","isModalOpen","setIsModalOpen","modalActiveTab","setModalActiveTab","searchTerms","setSearchTerms","undownloaded","purchase","delivery","useNavigate","userRoles","useAuth","loadDashboardData","useCallback","async","showLoading","undownloadedError","toast","useEffect","openPurchaseModal","activeTab","filterItems","items","searchTerm","pItem","item_name","join","toLowerCase","jsx","className","style","minHeight","backgroundColor","children","jsxs","warn","hasData","hasEmployee","canSeeApprovalBox","some","marginTop","marginBottom","Package","month","day","weekday","Card","CardHeader","CardTitle","Download","CardContent","Search","Input","placeholder","onChange","e","prev","target","index","firstItem","isAdvance","onClick","closest","Button","stopPropagation","add","resolve","setTimeout","downloadPurchaseOrderExcel","vendor_id","contact_id","newSet","delete","handleDownloadExcel","disabled","has","CheckCircle","approval","confirm","originalData","max","handleQuickApprove","Fragment","ShoppingCart","payment_completed_at","Truck","PurchaseDetailModal","purchaseId","isOpen","onClose","onRefresh","onOptimisticUpdate","updater","updatePurchaseInMemory"],"mappings":"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","x_google_ignoreList":[0]}