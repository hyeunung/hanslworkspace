import{c as e,l as s,j as a,B as r,r as t,y as n,S as c,_ as d}from"./index-B2fe1AdS.js";import{D as o}from"./download-CCtE4wN_.js";import{P as i,D as l,a as h,b as m,c as x,I as p,d as u}from"./dialog-DUVaXYsz.js";import{b as j}from"./helpers-CmqE03mo.js";import{T as g,a as b,b as v,c as f,d as y,e as N}from"./table-CPcIGVij.js";import{D as _,a as w,b as I,e as S}from"./dropdown-menu-k4y0XUQh.js";import{t as C}from"./index-BTwCLR-H.js";import{u as k,S as E,E as T,a as D,M as V,b as O,c as P,d as M}from"./mobile-card-C-RbxCYf.js";import{E as $}from"./eye-CEt3XZI9.js";import{T as q}from"./card-B_1zkS1U.js";import{F,C as J,b as R,c as K,u as L}from"./index.esm-u4fjCnJ8.js";import{L as z}from"./label-17cE5upn.js";import{T as B}from"./textarea-DDPFFRhy.js";import{S as A}from"./search-BKX69ZPt.js";import"./index-BfVTsRpp.js";import"./check-CvQ_W1_B.js";const G=new class{constructor(){this.supabase=e()}async getVendors(e){try{let s=this.supabase.from("vendors").select("*,vendor_contacts(*)").order("vendor_name");e?.search&&(s=s.or(`\n          vendor_name.ilike.%${e.search}%,\n          vendor_phone.ilike.%${e.search}%,\n          vendor_fax.ilike.%${e.search}%,\n          vendor_address.ilike.%${e.search}%\n        `));const{data:a,error:r}=await s;if(r)throw r;return{success:!0,data:a||[]}}catch(a){return s.error("업체 목록 조회 실패",a),{success:!1,error:a instanceof Error?a.message:"알 수 없는 오류가 발생했습니다."}}}async getVendor(e){try{const{data:s,error:a}=await this.supabase.from("vendors").select("*").eq("id",e).single();if(a)throw a;return{success:!0,data:s}}catch(a){return s.error("업체 조회 실패",a),{success:!1,error:a instanceof Error?a.message:"알 수 없는 오류가 발생했습니다."}}}async createVendor(e){try{const{data:s}=await this.supabase.from("vendors").select("id").eq("vendor_name",e.vendor_name).single();if(s)return{success:!1,error:"이미 등록된 업체명입니다."};const{data:a,error:r}=await this.supabase.from("vendors").insert(e).select().single();if(r)throw r;return{success:!0,data:a}}catch(a){return s.error("업체 생성 실패",a),{success:!1,error:a instanceof Error?a.message:"알 수 없는 오류가 발생했습니다."}}}async updateVendor(e,a){try{if(a.vendor_name){const{data:s}=await this.supabase.from("vendors").select("id").eq("vendor_name",a.vendor_name).neq("id",e).single();if(s)return{success:!1,error:"이미 등록된 업체명입니다."}}const{data:s,error:r}=await this.supabase.from("vendors").update(a).eq("id",e).select().single();if(r)throw r;return{success:!0,data:s}}catch(r){return s.error("업체 수정 실패",r),{success:!1,error:r instanceof Error?r.message:"알 수 없는 오류가 발생했습니다."}}}async deleteVendor(e){try{fetch("http://127.0.0.1:7242/ingest/b22edbac-a44c-4882-a88d-47f6cafc7628",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"vendorService.ts:141",message:"deleteVendor start",data:{vendorId:e},timestamp:Date.now(),sessionId:"debug-session",runId:"pre",hypothesisId:"A"})}).catch(()=>{});const{data:s}=await this.supabase.from("purchase_requests").select("id").eq("vendor_id",e).limit(1);if(fetch("http://127.0.0.1:7242/ingest/b22edbac-a44c-4882-a88d-47f6cafc7628",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"vendorService.ts:151",message:"purchaseRequests checked",data:{vendorId:e,hasPurchaseRequests:(s?.length||0)>0,count:s?.length||0},timestamp:Date.now(),sessionId:"debug-session",runId:"pre",hypothesisId:"B"})}).catch(()=>{}),s&&s.length>0)return{success:!1,error:"발주 요청과 연결된 업체는 삭제할 수 없습니다."};{fetch("http://127.0.0.1:7242/ingest/b22edbac-a44c-4882-a88d-47f6cafc7628",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"vendorService.ts:160",message:"deleting vendor",data:{vendorId:e},timestamp:Date.now(),sessionId:"debug-session",runId:"pre",hypothesisId:"C"})}).catch(()=>{});const{error:s}=await this.supabase.from("vendors").delete().eq("id",e);if(fetch("http://127.0.0.1:7242/ingest/b22edbac-a44c-4882-a88d-47f6cafc7628",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"vendorService.ts:169",message:"delete result",data:{vendorId:e,hasError:!!s,errorMessage:s?.message},timestamp:Date.now(),sessionId:"debug-session",runId:"pre",hypothesisId:"C"})}).catch(()=>{}),s)throw s;return{success:!0}}}catch(a){return fetch("http://127.0.0.1:7242/ingest/b22edbac-a44c-4882-a88d-47f6cafc7628",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"vendorService.ts:178",message:"deleteVendor error",data:{vendorId:e,errorMessage:a instanceof Error?a.message:"unknown"},timestamp:Date.now(),sessionId:"debug-session",runId:"pre",hypothesisId:"C"})}).catch(()=>{}),s.error("업체 삭제 실패",a),{success:!1,error:a instanceof Error?a.message:"알 수 없는 오류가 발생했습니다."}}}async getVendorContacts(e){try{const{data:s,error:a}=await this.supabase.from("vendor_contacts").select("*").eq("vendor_id",e).order("contact_name");if(a)throw a;return{success:!0,data:s||[]}}catch(a){return s.error("업체 연락처 조회 실패",a),{success:!1,error:a instanceof Error?a.message:"알 수 없는 오류가 발생했습니다."}}}async getVendorsForExport(){try{const{data:e,error:s}=await this.supabase.from("vendors").select("*").order("vendor_name");if(s)throw s;return{success:!0,data:(e||[]).map(e=>({"업체명":e.vendor_name,"전화번호":e.vendor_phone||"","팩스번호":e.vendor_fax||"","결제조건":e.vendor_payment_schedule||"","주소":e.vendor_address||"","비고":e.note||"","등록일":e.created_at?new Date(e.created_at).toLocaleDateString("ko-KR"):""}))}}catch(e){return s.error("업체 Excel 내보내기 실패",e),{success:!1,error:e instanceof Error?e.message:"알 수 없는 오류가 발생했습니다."}}}};function H({onExport:e,onCreateNew:s}){return a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"page-title",children:"업체 관리"}),a.jsx("p",{className:"page-subtitle",style:{marginTop:"-2px",marginBottom:"-4px"},children:"Vendors Management"})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(r,{variant:"outline",onClick:e,className:"flex items-center gap-1 sm:gap-2 button-base business-radius-button border border-gray-300 bg-white text-gray-700 hover:bg-gray-50",children:[a.jsx(o,{className:"w-3 h-3 sm:w-4 sm:h-4"}),a.jsx("span",{className:"hidden sm:inline badge-text",children:"Excel 내보내기"}),a.jsx("span",{className:"sm:hidden badge-text",children:"Excel"})]}),a.jsxs(r,{onClick:s,className:"flex items-center gap-1 sm:gap-2 button-base business-radius-button bg-blue-500 text-white hover:bg-blue-600",children:[a.jsx(i,{className:"w-3 h-3 sm:w-4 sm:h-4"}),a.jsx("span",{className:"badge-text",children:"업체 등록"})]})]})]})})}function Q({vendors:e,onEdit:s,onView:n,onRefresh:c}){const[d,o]=t.useState(null),{sortedData:i,sortConfig:l,handleSort:h}=k(e,"vendor_name","asc"),m=async e=>{if(fetch("http://127.0.0.1:7242/ingest/b22edbac-a44c-4882-a88d-47f6cafc7628",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"VendorTable.tsx:49",message:"handleDelete clicked",data:{vendorId:e.id},timestamp:Date.now(),sessionId:"debug-session",runId:"pre",hypothesisId:"A"})}).catch(()=>{}),confirm(`정말로 '${e.vendor_name}' 업체를 삭제하시겠습니까?`)){o(e.id);try{const s=await G.deleteVendor(e.id);fetch("http://127.0.0.1:7242/ingest/b22edbac-a44c-4882-a88d-47f6cafc7628",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"VendorTable.tsx:61",message:"deleteVendor result",data:{vendorId:e.id,success:s.success,error:s.error},timestamp:Date.now(),sessionId:"debug-session",runId:"pre",hypothesisId:"B"})}).catch(()=>{}),s.success?(C.success("업체가 삭제되었습니다."),c()):C.error(s.error||"삭제에 실패했습니다.")}catch(s){fetch("http://127.0.0.1:7242/ingest/b22edbac-a44c-4882-a88d-47f6cafc7628",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"VendorTable.tsx:72",message:"handleDelete error",data:{vendorId:e.id,errorMessage:s instanceof Error?s.message:"unknown"},timestamp:Date.now(),sessionId:"debug-session",runId:"pre",hypothesisId:"C"})}).catch(()=>{}),C.error("삭제 중 오류가 발생했습니다.")}finally{o(null)}}else fetch("http://127.0.0.1:7242/ingest/b22edbac-a44c-4882-a88d-47f6cafc7628",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"VendorTable.tsx:52",message:"delete confirm canceled",data:{vendorId:e.id},timestamp:Date.now(),sessionId:"debug-session",runId:"pre",hypothesisId:"A"})}).catch(()=>{})};return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"hidden lg:block border rounded-lg overflow-hidden",children:a.jsx("div",{className:"overflow-x-auto",children:a.jsxs(g,{children:[a.jsx(b,{children:a.jsxs(v,{children:[a.jsx(f,{className:"w-24 min-w-[80px] lg:w-32",children:a.jsx(E,{sortKey:"vendor_name",currentSortKey:l.key,sortDirection:l.direction,onSort:()=>h("vendor_name"),children:"업체명"})}),a.jsx(f,{className:"w-16 min-w-[50px] text-center",children:"담당자"}),a.jsx(f,{className:"min-w-[200px]",children:"담당자 정보"}),a.jsx(f,{className:"w-28 min-w-[110px]",children:"전화번호"}),a.jsx(f,{className:"w-28 min-w-[110px]",children:"팩스번호"}),a.jsx(f,{className:"w-24 min-w-[100px]",children:"지출예정일"}),a.jsx(f,{className:"w-20 min-w-[60px]",children:a.jsx(E,{sortKey:"created_at",currentSortKey:l.key,sortDirection:l.direction,onSort:()=>h("created_at"),children:"등록일"})}),a.jsx(f,{className:"w-14 min-w-[45px] text-center",children:"작업"})]})}),a.jsx(y,{children:0===e.length?a.jsx(v,{children:a.jsx(N,{colSpan:8,className:"text-center py-8 text-gray-500",children:"등록된 업체가 없습니다."})}):i.map(e=>a.jsxs(v,{children:[a.jsx(N,{className:"modal-value px-2 py-1.5",children:e.vendor_name}),a.jsx(N,{className:"text-center text-[11px] px-1 py-1.5",children:a.jsxs("span",{className:"badge-stats border border-gray-300 bg-white text-gray-600 text-[10px] px-1 py-0",children:[e.vendor_contacts?.length||0,"명"]})}),a.jsx(N,{className:"px-2 py-1.5",children:a.jsxs("div",{className:"space-y-0.5",children:[e.vendor_contacts&&e.vendor_contacts.length>0?e.vendor_contacts.slice(0,2).map((e,s)=>a.jsxs("div",{className:"text-[10px]",children:[a.jsx("span",{className:"modal-value",children:e.contact_name}),a.jsx("span",{className:"text-gray-500 ml-1",children:e.contact_phone}),e.contact_email&&a.jsx("span",{className:"text-gray-500 ml-1 truncate inline-block max-w-[180px]",children:e.contact_email})]},s)):a.jsx("span",{className:"text-gray-400 text-[10px]",children:"담당자 없음"}),e.vendor_contacts&&e.vendor_contacts.length>2&&a.jsxs("span",{className:"text-[10px] text-gray-500",children:["외 ",e.vendor_contacts.length-2,"명"]})]})}),a.jsx(N,{className:"text-[11px] px-2 py-1.5",children:a.jsx("span",{className:"block truncate",title:e.vendor_phone||"",children:e.vendor_phone||"-"})}),a.jsx(N,{className:"text-[11px] px-2 py-1.5",children:a.jsx("span",{className:"block truncate",title:e.vendor_fax||"",children:e.vendor_fax||"-"})}),a.jsx(N,{className:"text-[11px] px-2 py-1.5",children:a.jsx("span",{className:"block truncate",title:e.vendor_payment_schedule||"",children:e.vendor_payment_schedule||"-"})}),a.jsx(N,{className:"text-[11px] px-2 py-1.5",children:j(e.created_at)}),a.jsx(N,{className:"px-1 py-1.5 text-center",children:a.jsxs(_,{children:[a.jsx(w,{asChild:!0,children:a.jsx(r,{variant:"ghost",className:"h-7 w-7 p-0",disabled:d===e.id,children:a.jsx(T,{className:"h-3 w-3"})})}),a.jsxs(I,{align:"end",children:[a.jsxs(S,{onClick:()=>n(e),children:[a.jsx($,{className:"mr-2 h-4 w-4"}),"상세 보기"]}),a.jsxs(S,{onClick:()=>s(e),children:[a.jsx(D,{className:"mr-2 h-4 w-4"}),"수정"]}),a.jsxs(S,{onClick:()=>m(e),className:"text-red-600",children:[a.jsx(q,{className:"mr-2 h-4 w-4"}),"삭제"]})]})]})})]},e.id))})]})})}),a.jsx("div",{className:"hidden md:block lg:hidden",children:a.jsx("div",{className:"overflow-x-auto border rounded-lg",children:a.jsxs("table",{className:"w-full min-w-[900px]",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"text-left p-3 header-title text-gray-900",children:"업체명"}),a.jsx("th",{className:"text-center p-3 header-title text-gray-900 w-20",children:"담당자"}),a.jsx("th",{className:"text-left p-3 header-title text-gray-900",children:"연락처"}),a.jsx("th",{className:"text-left p-3 header-title text-gray-900 w-28",children:"전화번호"}),a.jsx("th",{className:"text-left p-3 header-title text-gray-900 w-28",children:"팩스번호"}),a.jsx("th",{className:"text-left p-3 header-title text-gray-900 w-24",children:"지출예정일"}),a.jsx("th",{className:"text-left p-3 header-title text-gray-900 w-24",children:"등록일"}),a.jsx("th",{className:"text-center p-3 header-title text-gray-900 w-16",children:"작업"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:0===i.length?a.jsx("tr",{children:a.jsx("td",{colSpan:8,className:"text-center py-8 text-gray-500",children:"등록된 업체가 없습니다."})}):i.map(e=>a.jsxs("tr",{className:"hover:bg-gray-50",children:[a.jsx("td",{className:"p-3 modal-value",children:e.vendor_name}),a.jsx("td",{className:"p-3 text-center",children:a.jsxs("span",{className:"badge-stats border border-gray-300 bg-white text-gray-600 badge-text",children:[e.vendor_contacts?.length||0,"명"]})}),a.jsx("td",{className:"p-3 modal-subtitle",children:e.vendor_contacts&&e.vendor_contacts.length>0?a.jsxs("div",{children:[a.jsx("div",{className:"modal-value",children:e.vendor_contacts[0].contact_name}),a.jsx("div",{className:"text-gray-500 badge-text",children:e.vendor_contacts[0].contact_phone})]}):a.jsx("span",{className:"text-gray-400",children:"담당자 없음"})}),a.jsx("td",{className:"p-3 modal-subtitle",children:a.jsx("span",{className:"block truncate",title:e.vendor_phone||"",children:e.vendor_phone||"-"})}),a.jsx("td",{className:"p-3 modal-subtitle",children:a.jsx("span",{className:"block truncate",title:e.vendor_fax||"",children:e.vendor_fax||"-"})}),a.jsx("td",{className:"p-3 modal-subtitle",children:a.jsx("span",{className:"block truncate",title:e.vendor_payment_schedule||"",children:e.vendor_payment_schedule||"-"})}),a.jsx("td",{className:"p-3 modal-subtitle",children:j(e.created_at)}),a.jsx("td",{className:"p-3 text-center",children:a.jsxs(_,{children:[a.jsx(w,{asChild:!0,children:a.jsx(r,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:a.jsx(T,{className:"h-4 w-4"})})}),a.jsxs(I,{align:"end",children:[a.jsxs(S,{onClick:()=>n(e),children:[a.jsx($,{className:"mr-2 h-4 w-4"}),"상세 보기"]}),a.jsxs(S,{onClick:()=>s(e),children:[a.jsx(D,{className:"mr-2 h-4 w-4"}),"수정"]}),a.jsxs(S,{onClick:()=>m(e),className:"text-red-600",children:[a.jsx(q,{className:"mr-2 h-4 w-4"}),"삭제"]})]})]})})]},e.id))})]})})}),a.jsx("div",{className:"block md:hidden space-y-3",children:0===i.length?a.jsx("div",{className:"text-center py-8 text-gray-500",children:"등록된 업체가 없습니다."}):i.map(e=>a.jsxs(V,{children:[a.jsx(O,{children:a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{children:e.vendor_name}),a.jsxs("span",{className:"badge-stats border border-gray-300 bg-white text-gray-600",children:[e.vendor_contacts?.length||0,"명"]})]})}),a.jsx(P,{label:"담당자",value:a.jsxs("div",{className:"space-y-1",children:[e.vendor_contacts&&e.vendor_contacts.length>0?e.vendor_contacts.slice(0,2).map((e,s)=>a.jsxs("div",{className:"modal-subtitle",children:[a.jsx("div",{className:"modal-value",children:e.contact_name}),a.jsx("div",{className:"text-gray-500 badge-text",children:e.contact_phone}),e.contact_email&&a.jsx("div",{className:"text-gray-500 badge-text",children:e.contact_email})]},s)):a.jsx("span",{className:"text-gray-400",children:"담당자 없음"}),e.vendor_contacts&&e.vendor_contacts.length>2&&a.jsxs("span",{className:"modal-subtitle text-gray-500",children:["외 ",e.vendor_contacts.length-2,"명"]})]})}),a.jsx(P,{label:"전화번호",value:e.vendor_phone||"-"}),a.jsx(P,{label:"팩스번호",value:e.vendor_fax||"-"}),a.jsx(P,{label:"지출예정일",value:e.vendor_payment_schedule||"-"}),a.jsx(P,{label:"등록일",value:j(e.created_at)}),a.jsxs(M,{children:[a.jsx(r,{size:"sm",variant:"outline",onClick:()=>n(e),children:a.jsx($,{className:"w-4 h-4"})}),a.jsx(r,{size:"sm",variant:"outline",onClick:()=>s(e),children:a.jsx(D,{className:"w-4 h-4"})}),a.jsx(r,{size:"sm",variant:"outline",className:"text-red-600",onClick:()=>m(e),disabled:d===e.id,children:a.jsx(q,{className:"w-4 h-4"})})]})]},e.id))})]})}const U=F,W=t.createContext({}),X=({...e})=>a.jsx(W.Provider,{value:{name:e.name},children:a.jsx(J,{...e})}),Y=()=>{const e=t.useContext(W),s=t.useContext(Z),{getFieldState:a}=R(),r=K({name:e.name}),n=a(e.name,r);if(!e)throw new Error("useFormField should be used within <FormField>");const{id:c}=s;return{id:c,name:e.name,formItemId:`${c}-form-item`,formDescriptionId:`${c}-form-item-description`,formMessageId:`${c}-form-item-message`,...n}},Z=t.createContext({});function ee({className:e,...s}){const r=t.useId();return a.jsx(Z.Provider,{value:{id:r},children:a.jsx("div",{"data-slot":"form-item",className:n("grid gap-2",e),...s})})}function se({className:e,...s}){const{error:r,formItemId:t}=Y();return a.jsx(z,{"data-slot":"form-label","data-error":!!r,className:n("data-[error=true]:text-destructive",e),htmlFor:t,...s})}function ae({...e}){const{error:s,formItemId:r,formDescriptionId:t,formMessageId:n}=Y();return a.jsx(c,{"data-slot":"form-control",id:r,"aria-describedby":s?`${t} ${n}`:`${t}`,"aria-invalid":!!s,...e})}function re({className:e,...s}){const{error:r,formMessageId:t}=Y(),c=r?String(r?.message??""):s.children;return c?a.jsx("p",{"data-slot":"form-message",id:t,className:n("text-destructive text-sm",e),...s,children:c}):null}function te({isOpen:e,onClose:s,vendor:n,onSave:c,mode:d}){const[o,i]=t.useState(!1),j=L({defaultValues:{vendor_name:"",vendor_phone:"",vendor_fax:"",vendor_payment_schedule:"",vendor_address:"",note:""}});t.useEffect(()=>{n&&e?j.reset({vendor_name:n.vendor_name||"",vendor_phone:n.vendor_phone||"",vendor_fax:n.vendor_fax||"",vendor_payment_schedule:n.vendor_payment_schedule||"",vendor_address:n.vendor_address||"",note:n.note||""}):!n&&e&&j.reset({vendor_name:"",vendor_phone:"",vendor_fax:"",vendor_payment_schedule:"",vendor_address:"",note:""})},[n,e,j]);const g="view"===d;return a.jsx(l,{open:e,onOpenChange:s,children:a.jsxs(h,{className:"w-full max-w-[95vw] sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[a.jsx(m,{children:a.jsx(x,{children:(()=>{switch(d){case"create":return"업체 등록";case"edit":return"업체 수정";case"view":return"업체 상세";default:return"업체"}})()})}),a.jsx(U,{...j,children:a.jsxs("form",{onSubmit:j.handleSubmit(async e=>{i(!0);try{let a;"create"===d?a=await G.createVendor(e):"edit"===d&&n&&(a=await G.updateVendor(n.id,e)),a?.success?(C.success("create"===d?"업체가 등록되었습니다.":"업체 정보가 수정되었습니다."),c(),s()):C.error(a?.error||"처리 중 오류가 발생했습니다.")}catch(a){C.error("처리 중 오류가 발생했습니다.")}finally{i(!1)}}),className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(X,{control:j.control,name:"vendor_name",rules:{required:"업체명을 입력해주세요."},render:({field:e})=>a.jsxs(ee,{children:[a.jsx(se,{children:"업체명 *"}),a.jsx(ae,{children:a.jsx(p,{...e,placeholder:"업체명을 입력하세요",className:"business-radius-input button-base border border-gray-300 bg-white text-gray-700",disabled:g})}),a.jsx(re,{})]})}),a.jsx(X,{control:j.control,name:"vendor_phone",render:({field:e})=>a.jsxs(ee,{children:[a.jsx(se,{children:"전화번호"}),a.jsx(ae,{children:a.jsx(p,{...e,placeholder:"02-1234-5678",className:"business-radius-input button-base border border-gray-300 bg-white text-gray-700",disabled:g})}),a.jsx(re,{})]})}),a.jsx(X,{control:j.control,name:"vendor_fax",render:({field:e})=>a.jsxs(ee,{children:[a.jsx(se,{children:"팩스번호"}),a.jsx(ae,{children:a.jsx(p,{...e,placeholder:"02-1234-5679",className:"business-radius-input button-base border border-gray-300 bg-white text-gray-700",disabled:g})}),a.jsx(re,{})]})}),a.jsx(X,{control:j.control,name:"vendor_payment_schedule",render:({field:e})=>a.jsxs(ee,{children:[a.jsx(se,{children:"결제조건"}),a.jsx(ae,{children:a.jsx(p,{...e,placeholder:"월말결제, 현금결제 등",className:"business-radius-input button-base border border-gray-300 bg-white text-gray-700",disabled:g})}),a.jsx(re,{})]})})]}),a.jsx(X,{control:j.control,name:"vendor_address",render:({field:e})=>a.jsxs(ee,{children:[a.jsx(se,{children:"주소"}),a.jsx(ae,{children:a.jsx(B,{...e,placeholder:"주소를 입력하세요",className:"business-radius-input border border-gray-300 bg-white text-gray-700 card-description min-h-[64px]",disabled:g})}),a.jsx(re,{})]})}),a.jsx(X,{control:j.control,name:"note",render:({field:e})=>a.jsxs(ee,{children:[a.jsx(se,{children:"비고"}),a.jsx(ae,{children:a.jsx(B,{...e,placeholder:"메모 사항을 입력하세요",className:"business-radius-input border border-gray-300 bg-white text-gray-700 card-description min-h-[48px]",disabled:g})}),a.jsx(re,{})]})}),"view"===d&&n&&a.jsx("div",{className:"pt-4 border-t",children:a.jsxs("div",{className:"grid grid-cols-2 gap-4 modal-subtitle",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-gray-500",children:"상태:"}),a.jsx("span",{className:"ml-2 px-2 py-1 business-radius-badge badge-text bg-green-100 text-green-800",children:"활성"})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-gray-500",children:"등록일:"}),a.jsx("span",{className:"ml-2",children:n.created_at?new Date(n.created_at).toLocaleDateString("ko-KR"):"-"})]})]})}),a.jsxs(u,{className:"gap-2",children:[a.jsx(r,{type:"button",variant:"outline",onClick:s,className:"button-base business-radius-button border border-gray-300 bg-white text-gray-700 hover:bg-gray-50",children:"view"===d?"닫기":"취소"}),!g&&a.jsx(r,{type:"submit",disabled:o,className:"button-base business-radius-button bg-blue-500 text-white hover:bg-blue-600",children:o?"create"===d?"등록 중...":"수정 중...":"create"===d?"등록":"수정"})]})]})})]})})}function ne(){const[e,s]=t.useState([]),[r,n]=t.useState([]),[c,o]=t.useState(!0),[i,l]=t.useState({}),[h,m]=t.useState(!1),[x,p]=t.useState(null),[u,j]=t.useState("create"),g=t.useMemo(()=>e.reduce((e,s)=>{const a=(s.vendor_name||"").length;return Math.max(e,a)},0),[e]),b=t.useMemo(()=>{const e=8*(g||10)+40;return Math.min(Math.max(e,180),320)},[g]),v=e=>{const{search:s,...a}=e;return a},f=async(e=v(i))=>{o(!0);try{const a=await G.getVendors(e);a.success&&a.data?(s(a.data),n(a.data)):C.error(a.error||"업체 목록을 불러오는데 실패했습니다.")}catch(a){C.error("업체 목록을 불러오는 중 오류가 발생했습니다.")}finally{o(!1)}};t.useEffect(()=>{f(v(i))},[i.is_active,i.business_number]),t.useEffect(()=>{const s=(i.search||"").trim().toLowerCase();if(!s)return void n(e);const a=e=>(e||"").toLowerCase().includes(s);n(e.filter(e=>!![e.vendor_name,e.vendor_phone,e.vendor_fax,e.vendor_address,e.vendor_payment_schedule,e.note].some(a)||(e.vendor_contacts||[]).some(e=>[e.contact_name,e.contact_phone,e.contact_email,e.position].some(a))))},[i.search,e]);return c&&0===e.length?a.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),a.jsx("p",{className:"mt-2 card-subtitle",children:"업체 목록을 불러오는 중..."})]})}):a.jsx(a.Fragment,{children:a.jsxs("div",{className:"space-y-5",children:[a.jsx(H,{onExport:async()=>{try{const e=await G.getVendorsForExport();if(e.success&&e.data){const s=await d(()=>import("./xlsx-ByDo_lG2.js"),[]),a=s.utils.json_to_sheet(e.data),r=s.utils.book_new();s.utils.book_append_sheet(r,a,"업체 목록");const t=`업체_목록_${(new Date).toISOString().slice(0,10)}.xlsx`;s.writeFile(r,t),C.success("Excel 파일이 다운로드되었습니다.")}else C.error(e.error||"Excel 내보내기에 실패했습니다.")}catch(e){C.error("Excel 내보내기 중 오류가 발생했습니다.")}},onCreateNew:()=>{p(null),j("create"),m(!0)}}),a.jsxs("div",{className:"bg-white",children:[a.jsx("div",{className:"p-3 border-b border-gray-200",children:a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("h3",{className:"modal-title",children:"업체 목록"}),a.jsxs("div",{className:"relative flex items-center",children:[a.jsx(A,{className:"absolute left-0 top-1/2 -translate-y-1/2 text-gray-400 w-3.5 h-3.5"}),a.jsx("input",{type:"text",value:i.search||"",onChange:e=>{l({...i,search:e.target.value.trim()||void 0})},placeholder:"검색어를 입력하세요.",style:{width:`${b}px`},className:"pl-5 pr-1 h-6 bg-transparent text-[13px] text-gray-700 placeholder:text-gray-400 placeholder:text-[10px] border-0 border-b border-gray-300 focus:border-hansl-500 focus:outline-none focus:ring-0 rounded-none shadow-none appearance-none"})]}),a.jsxs("span",{className:"badge-stats bg-blue-50 text-blue-600",children:["총 ",r.length,"개"]})]}),a.jsx("div",{className:"card-description",children:c&&"업데이트 중..."})]})}),a.jsx(Q,{vendors:r,onEdit:e=>{p(e),j("edit"),m(!0)},onView:e=>{p(e),j("view"),m(!0)},onRefresh:f})]}),a.jsx(te,{isOpen:h,onClose:()=>{m(!1),p(null)},vendor:x,onSave:()=>{f(v(i))},mode:u})]})})}export{ne as default};
//# sourceMappingURL=VendorMain-DljS4sSf.js.map
