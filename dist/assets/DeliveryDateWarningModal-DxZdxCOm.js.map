{"version":3,"mappings":"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","names":["formatDate","formatDateISO","getCurrencySymbol","currency","includes","async","generatePurchaseOrderExcelJS","data","workbook","__vitePreload","import","then","n","e","__VITE_PRELOAD__","Workbook","sheet","addWorksheet","pageSetup","paperSize","orientation","fitToPage","fitToWidth","fitToHeight","horizontalCentered","verticalCentered","margins","left","right","top","bottom","header","footer","getRow","height","r","eachCell","cell","font","name","size","mergeCells","response","fetch","arrayBuffer","imageId","addImage","buffer","extension","dWidth","getColumn","width","logoWidth","Math","max","logoHeight","logoCol","logoRow","tl","col","row","ext","_e","getCell","value","alignment","horizontal","vertical","indent","bold","vendor_payment_schedule","vendor_name","vendor_contact_name","request_date","vendor_phone","vendor_fax","delivery_request_date","requester_name","purchase_order_number","tableHeaders","i","length","String","fromCharCode","sortedItems","items","sort","a","b","line_number","itemRows","sumRow","item","rowIdx","bCell","item_name","specification","quantity","unitSymbol","unitWithCurrency","unit_price_value","toLocaleString","trim","amountSymbol","amountWithCurrency","amount_value","gCell","remark","wrapText","shrinkToFit","c","totalSymbol","totalAmount","reduce","sum","lastRow","cellAddr","isItemRow","border","style","currentBorder","sumCellBorder","Object","entries","A","B","C","D","E","F","G","forEach","xlsx","writeBuffer","Blob","type","supabase","createClient","downloadPurchaseOrderExcel","purchase","currentUserRoles","onSuccessCallback","purchaseRequest","error","requestError","from","select","eq","single","toast","orderItems","itemsError","order","vendorInfo","vendorId","vendor_id","contactId","contact_id","vendorData","vendorError","contactData","contactError","contact_name","excelData","project_vendor","sales_order_number","project_item","map","blob","downloadFilename","url","window","URL","createObjectURL","document","createElement","href","download","body","appendChild","click","removeChild","revokeObjectURL","success","downloadFlagErr","update","is_po_download","flagErr","PurchaseDetailModal","lazy","DeliveryDateWarningModal","isOpen","onClose","purchases","onRefresh","currentUserName","navigate","useNavigate","completedIds","setCompletedIds","useState","Set","fixedWarningItems","setFixedWarningItems","hasFixedItemsRef","useRef","hasClosedRef","detailModalPurchaseId","setDetailModalPurchaseId","isDetailModalOpen","setIsDetailModalOpen","detailModalPurchaseIdRef","useEffect","current","onCloseRef","calculateWarningItems","useCallback","today","Date","setHours","is_received","delivery_status","middle_manager_status","final_manager_status","delivery_revision_requested","deliveryDate","revisedDate","revised_delivery_request_date","push","warningType","daysOverdue","floor","getTime","warningItems","setWarningItems","remainingItems","filter","fixedItem","memoryPurchase","findPurchaseInMemory","id","currentPurchase","find","p","setTimeout","every","has","logger","info","allCompleted","useMemo","progress","round","realtimeFirstMount","unsubscribe","addCacheListener","handleOpenDeliveryDateChangeSupport","purchaseId","returnTo","encodeURIComponent","handleClose","dateStr","d","getFullYear","getMonth","padStart","getDate","handleCardClick","handleDetailModalClose","purchaseIdToCheck","prev","add","silent","jsxs","Fragment","children","jsx","Dialog","open","onOpenChange","DialogContent","className","showCloseButton","DialogHeader","AlertCircle","DialogTitle","Progress","isCompleted","onClick","Calendar","stopPropagation","Button","disabled","Check","title","MessageSquarePlus","Suspense","fallback","Loader2","activeTab","options","result","Promise","currentPurchaseId","useDeliveryWarningCount","count","debugItems","isTarget","step","middle","final","dateToISOString","toISOString"],"ignoreList":[],"sources":["../../src/utils/exceljs/generatePurchaseOrderExcel.ts","../../src/utils/excelDownload.ts","../../src/components/purchase/DeliveryDateWarningModal.tsx"],"sourcesContent":["// hanslwebappÍ≥º ÎèôÏùºÌïú ÏΩîÎìú Í∏∞Î∞ò Excel ÏÉùÏÑ±\nimport { formatDateISO } from '@/utils/helpers';\n\nexport interface PurchaseOrderData {\n  purchase_order_number: string;\n  request_date: string;\n  delivery_request_date: string;\n  requester_name: string;\n  vendor_name: string;\n  vendor_contact_name?: string;\n  vendor_phone?: string;\n  vendor_fax?: string;\n  project_vendor: string;\n  sales_order_number: string;\n  project_item: string;\n  items: PurchaseOrderItem[];\n  vendor_payment_schedule?: string;\n}\n\nexport interface PurchaseOrderItem {\n  line_number: number;\n  item_name: string;\n  specification: string;\n  quantity: number;\n  unit_price_value: number;\n  amount_value: number;\n  remark: string;\n  currency: string;\n}\n\nconst formatDate = formatDateISO;\n\n// Helper: currency code to symbol\nfunction getCurrencySymbol(currency: string) {\n  if (!currency) return '';\n  if (['KRW', 'Ïõê', '‚Ç©'].includes(currency)) return '‚Ç©';\n  if (['USD', '$', 'Îã¨Îü¨'].includes(currency)) return '$';\n  if (['EUR', '‚Ç¨'].includes(currency)) return '‚Ç¨';\n  if (['JPY', 'Ïóî', '¬•'].includes(currency)) return '¬•';\n  if (['CNY', 'ÏúÑÏïà', 'ÂÖÉ'].includes(currency)) return '¬•';\n  return currency;\n}\n\n/**\n * ÏóëÏÖÄ Î∞úÏ£ºÏÑú ÏÉùÏÑ± (ExcelJS) - hanslwebappÍ≥º ÎèôÏùºÌïú Î∞©Ïãù\n * @param data PurchaseOrderData\n * @returns Blob (xlsx)\n */\nexport async function generatePurchaseOrderExcelJS(data: PurchaseOrderData): Promise<Blob> {\n  // ExcelJSÎ•º ÎèôÏ†ÅÏúºÎ°ú importÌïòÏó¨ Ï¥àÍ∏∞ Î≤àÎì§ ÌÅ¨Í∏∞ Í∞êÏÜå\n  const ExcelJS = await import('exceljs');\n  const workbook = new ExcelJS.Workbook();\n  \n  const sheet = workbook.addWorksheet('Î∞úÏ£ºÏÑú', {\n    pageSetup: {\n      paperSize: 9, // A4\n      orientation: 'portrait',\n      fitToPage: true,\n      fitToWidth: 1,\n      fitToHeight: 1,\n      horizontalCentered: true,\n      verticalCentered: true,\n      margins: {\n        left: 0.3,\n        right: 0.3,\n        top: 0.5,\n        bottom: 0.5,\n        header: 0.2,\n        footer: 0.2\n      }\n    }\n  });\n\n  // Ìñâ ÎÜíÏù¥ Í≥†Ï†ï: 1Ìñâ 39.75px(‚âà29.8pt), 2ÌñâÎ∂ÄÌÑ∞ 18px(‚âà13.5pt)\n  sheet.getRow(1).height = 29.8; // 39.75px\n  for (let r = 2; r <= 60; r++) {\n    sheet.getRow(r).height = 15.75; // 21px‚âà15.75pt\n  }\n  // Ìè∞Ìä∏ Í∏∞Î≥∏Í∞í: ÎßëÏùÄÍ≥†Îîï, ÌÅ¨Í∏∞ 11 (2ÌñâÎ∂ÄÌÑ∞), 1ÌñâÏùÄ 20\n  // 1Ìñâ\n  sheet.getRow(1).eachCell(cell => {\n    cell.font = { ...(cell.font || {}), name: 'ÎßëÏùÄ Í≥†Îîï', size: 20 };\n  });\n\n  // ÎÇòÎ®∏ÏßÄ Ìñâ Í∏∞Î≥∏ Ìè∞Ìä∏ ÏÑ§Ï†ï (ÌïÑÏöîÏãú Îí§ÏóêÏÑú Í∞úÎ≥Ñ ÏÖÄÏóêÏÑú Îã§Ïãú bold ÏßÄÏ†ï)\n  for (let r = 2; r <= 60; r++) {\n    sheet.getRow(r).eachCell(cell => {\n      cell.font = { ...(cell.font || {}), name: 'ÎßëÏùÄ Í≥†Îîï', size: 11 };\n    });\n  }\n\n  // 1. Î≥ëÌï© Î≤îÏúÑ ÌÖúÌîåÎ¶øÍ≥º 1:1 Ï†ÅÏö©\n  sheet.mergeCells('A1:G1');\n  sheet.mergeCells('A2:B2'); sheet.mergeCells('C2:D2'); sheet.mergeCells('F2:G2');\n  sheet.mergeCells('A3:B3'); sheet.mergeCells('C3:D3'); sheet.mergeCells('F3:G3');\n  sheet.mergeCells('A4:B4'); sheet.mergeCells('C4:D4'); sheet.mergeCells('F4:G4');\n  sheet.mergeCells('A5:B5'); sheet.mergeCells('C5:D5'); sheet.mergeCells('F5:G5');\n  sheet.mergeCells('A6:B6'); sheet.mergeCells('C6:D6'); sheet.mergeCells('F6:G6');\n  sheet.mergeCells('A7:B7'); sheet.mergeCells('C7:D7'); sheet.mergeCells('F7:G7');\n  // 8~46Ìñâ(Ìó§Îçî/ÌíàÎ™©/Ìï©Í≥Ñ) Î≥ëÌï© ÏóÜÏùå\n  // Ìï©Í≥ÑÍ∞Ä Îì§Ïñ¥Í∞ÄÎäî ÌñâÏóê ÎßûÏ∂∞ Î≥ëÌï© Î≤îÏúÑÎèÑ ÎèôÏ†ÅÏúºÎ°ú Ïù¥Îèô\n  // (ÏïÑÎûòÏóêÏÑú sumRow Í≥ÑÏÇ∞ ÌõÑ Î≥ëÌï©)\n\n  try {\n    const response = await fetch('/logo_KOR.png');\n    const arrayBuffer = await response.arrayBuffer();\n    const imageId = workbook.addImage({\n      buffer: arrayBuffer,\n      extension: 'png',\n    });\n    // Î°úÍ≥†(Ïù¥Î™®Ìã∞ÏΩò)Îäî ÎÑàÎπÑ 0.58col, 'Î∞úÏ£ºÏÑú' Í∏ÄÏûê Î∞îÎ°ú ÏôºÏ™ΩÏóê Îî± Î∂ôÍ≤å Î∞∞Ïπò\n    // DÏó¥ widthÍ∞Ä undefined/null/0Ïù¥Î©¥ Í∏∞Î≥∏Í∞í 22Î°ú ÎåÄÏ≤¥\n    const dWidth = sheet.getColumn('D').width || 22;\n    const logoWidth = Math.max(1, dWidth * 7.2 * 0.58) + 4; // Í∏∞Ï°¥Î≥¥Îã§ 4px Îçî ÌÅ¨Í≤å\n    const logoHeight = 30 + 4; // Í∏∞Ï°¥ 30ÏóêÏÑú 4px Îçî ÌÅ¨Í≤å\n    // D1 ÏÖÄ Ï§ëÏïô(3.5, 0.5)ÏóêÏÑú ÏôºÏ™Ω 2px(0.28col), ÏúÑÎ°ú 2px(0.13row) Ïù¥Îèô\n    const logoCol = 3.5 - 0.50;\n    const logoRow = 0.5 - 0.20;\n    sheet.addImage(imageId, {\n      tl: { col: logoCol, row: logoRow }, // D1 ÏÖÄ Ï§ëÏïôÏóêÏÑú ÏôºÏ™Ω 2px, ÏúÑÎ°ú 2px Ïù¥Îèô\n      ext: { width: logoWidth, height: logoHeight },\n    });\n  } catch (_e) {\n    // Logo loading failed, continue without logo\n  }\n\n  // 2. Ï†úÎ™© (B1:H1 Î≥ëÌï©, Ï§ëÏïôÏ†ïÎ†¨)\n  sheet.getCell('D1').value = '                Î∞ú Ï£º ÏÑú';\n  sheet.getCell('D1').alignment = { horizontal: 'left', vertical: 'middle', indent: 1 };\n  sheet.getCell('D1').font = { bold: true, size: 20 };\n\n  // 3. ÏÉÅÎã® Ï†ïÎ≥¥ Í≥†Ï†ï ÎùºÎ≤® Ï†ÅÏö© (Í≥µÎ∞± Ìè¨Ìï®)\n  sheet.getCell('A2').value = 'ÏóÖ   Ï≤¥   Î™Ö';\n  sheet.getCell('A2').font = { bold: true };\n  sheet.getCell('A3').value = 'Îã¥   Îãπ   Ïûê';\n  sheet.getCell('A3').font = { bold: true };\n  sheet.getCell('A4').value = 'Ï≤≠   Íµ¨   Ïùº';\n  sheet.getCell('A4').font = { bold: true };\n  sheet.getCell('A5').value = 'TEL.';\n  sheet.getCell('A5').font = { bold: true };\n  sheet.getCell('A6').value = 'FAX.';\n  sheet.getCell('A6').font = { bold: true };\n  sheet.getCell('A7').value = 'ÏûÖÍ≥†ÏöîÏ≤≠Ïùº';\n  sheet.getCell('A7').font = { bold: true };\n\n  sheet.getCell('E2').value = 'Íµ¨Îß§ÏöîÏ≤≠Ïûê';\n  sheet.getCell('E2').font = { bold: true };\n  sheet.getCell('E3').value = 'Ï£º         ÏÜå';\n  sheet.getCell('E3').font = { bold: true };\n  sheet.getCell('E4').value = 'Î∞ú Ï£º Î≤à Ìò∏';\n  sheet.getCell('E4').font = { bold: true };\n  sheet.getCell('E5').value = 'TEL.';\n  sheet.getCell('E5').font = { bold: true };\n  sheet.getCell('E6').value = 'FAX.';\n  sheet.getCell('E6').font = { bold: true };\n  sheet.getCell('E7').value = 'ÏßÄÏ∂ú ÏòàÏ†ïÏùº';\n  sheet.getCell('E7').font = { bold: true };\n\n  sheet.getCell('F7').value = data.vendor_payment_schedule || '';\n\n  // Îç∞Ïù¥ÌÑ∞ Îß§Ìïë(ÏòàÏãú)\n  sheet.getCell('C2').value = data.vendor_name;\n  sheet.getCell('C3').value = data.vendor_contact_name || '';\n  sheet.getCell('C4').value = formatDate(data.request_date);\n  sheet.getCell('C5').value = data.vendor_phone || '';\n  sheet.getCell('C6').value = data.vendor_fax || '';\n  sheet.getCell('C7').value = formatDate(data.delivery_request_date);\n\n  sheet.getCell('F2').value = data.requester_name;\n  sheet.getCell('F3').value = 'ÎåÄÍµ¨Í¥ëÏó≠Ïãú Îã¨ÏÑúÍµ¨ ÏÑ±ÏÑúÍ≥µÎã®Î∂ÅÎ°ú305';\n  sheet.getCell('F4').value = data.purchase_order_number;\n  sheet.getCell('F5').value = '(053) 626-7805';\n  sheet.getCell('F6').value = '(053) 657-7905';\n  sheet.getCell('F5').alignment = { horizontal: 'center', vertical: 'middle' };\n  sheet.getCell('F6').alignment = { horizontal: 'center', vertical: 'middle' };\n\n  // 8Ìñâ: ÌÖåÏù¥Î∏î Ìó§Îçî\n  const tableHeaders = ['No', 'ÌíàÎ™Ö', 'Í∑úÍ≤©', 'ÏàòÎüâ', 'Îã®Í∞Ä', 'Í∏àÏï°', 'ÎπÑÍ≥†'];\n  for (let i = 0; i < tableHeaders.length; i++) {\n    sheet.getCell(String.fromCharCode(65 + i) + '8').value = tableHeaders[i];\n    sheet.getCell(String.fromCharCode(65 + i) + '8').font = { bold: true };\n    if(i===6){\n       sheet.getCell('G8').alignment = { horizontal:'center', vertical:'middle' };\n    }\n  }\n\n  // ÌíàÎ™©Ïù¥ 45Í∞úÎ•º ÎÑòÏúºÎ©¥ ÏïÑÎûòÎ°ú Î∞ÄÏñ¥ÏÑú Ìï©Í≥Ñ/ÌïòÎã® Ï†ïÎ≥¥ Ï∂úÎ†•\n  const baseRow = 9;\n  const minRows = 45;\n  // --- ÌíàÎ™© Îç∞Ïù¥ÌÑ∞ line_number Í∏∞Ï§Ä Ï†ïÎ†¨ ---\n  const sortedItems = [...data.items].sort((a, b) => a.line_number - b.line_number);\n  const itemRows = sortedItems.length;\n  const sumRow = baseRow + Math.max(itemRows, minRows); // Ìï©Í≥Ñ ÏúÑÏπò\n\n  // ÌíàÎ™© Îç∞Ïù¥ÌÑ∞\n  for (let i = 0; i < sortedItems.length; i++) {\n    const item = sortedItems[i];\n    const rowIdx = baseRow + i;\n    sheet.getCell('A' + rowIdx).value = item.line_number;\n    const bCell = sheet.getCell('B' + rowIdx);\n    bCell.value = item.item_name;\n    bCell.alignment = { horizontal: 'left', vertical: 'middle' };\n    sheet.getCell('C' + rowIdx).value = item.specification;\n    sheet.getCell('C' + rowIdx).alignment = { horizontal: 'left', vertical: 'middle' };\n    sheet.getCell('D' + rowIdx).value = item.quantity;\n    // Îã®Í∞Ä(EÏó¥) - ÌÜµÌôî Í∏∞Ìò∏ Ìè¨Ìï®\n    const unitSymbol = getCurrencySymbol(item.currency);\n    const unitWithCurrency = (item.unit_price_value !== undefined && item.unit_price_value !== null)\n      ? `${item.unit_price_value.toLocaleString()} ${unitSymbol}`.trim()\n      : '';\n    sheet.getCell('E' + rowIdx).value = unitWithCurrency;\n    sheet.getCell('E' + rowIdx).alignment = { horizontal: 'right', vertical: 'middle' };\n\n    // Í∏àÏï°(FÏó¥) - ÌÜµÌôî Í∏∞Ìò∏ Ìè¨Ìï®\n    const amountSymbol = getCurrencySymbol(item.currency);\n    const amountWithCurrency = (item.amount_value !== undefined && item.amount_value !== null)\n      ? `${item.amount_value.toLocaleString()} ${amountSymbol}`.trim()\n      : '';\n    sheet.getCell('F' + rowIdx).value = amountWithCurrency;\n    sheet.getCell('F' + rowIdx).alignment = { horizontal: 'right', vertical: 'middle' };\n    // GÏó¥ÏùÄ ÎπÑÏõåÎë†\n    const gCell = sheet.getCell('G' + rowIdx);\n    gCell.value = (item.remark !== undefined && item.remark !== null) ? String(item.remark) : '';\n    gCell.alignment = { horizontal: 'left', vertical: 'middle', wrapText: false, shrinkToFit: true };\n  }\n\n  // ÌíàÎ™©Ïù¥ 45Í∞úÎ≥¥Îã§ Ï†ÅÏúºÎ©¥ Îπà Ìñâ Ï∂îÍ∞Ä\n  for (let i = itemRows; i < minRows; i++) {\n    const rowIdx = baseRow + i;\n    for (let c = 0; c < 7; c++) {\n      sheet.getCell(String.fromCharCode(65 + c) + rowIdx).value = '';\n    }\n  }\n\n  // Ìï©Í≥Ñ\n  sheet.mergeCells(`A${sumRow}:E${sumRow}`);\n  sheet.getCell('A' + sumRow).value = 'Ìï©Í≥Ñ';\n  sheet.getCell('A' + sumRow).font = { bold: true };\n  const totalSymbol = getCurrencySymbol(data.items[0]?.currency);\n  const totalAmount = data.items.reduce((sum, item) => sum + (item.amount_value || 0), 0);\n  sheet.getCell('F' + sumRow).value = `${totalAmount.toLocaleString()} ${totalSymbol}`.trim();\n  sheet.getCell('F' + sumRow).alignment = { horizontal: 'right', vertical: 'middle' };\n\n  // Ïã§Ï†ú ÎßàÏßÄÎßâ Îç∞Ïù¥ÌÑ∞Í∞Ä Îì§Ïñ¥Í∞Ñ ÌñâÍπåÏßÄ ÎèôÏ†ÅÏúºÎ°ú ÌÖåÎëêÎ¶¨ Ï†ÅÏö© (Ìï©Í≥ÑÍπåÏßÄÎßå)\n  const lastRow = sumRow;\n  for (let r = 1; r <= lastRow; r++) {\n    for (let c = 1; c <= 7; c++) {\n      const col = String.fromCharCode(64 + c); // A~G\n      const cellAddr = col + r;\n      const cell = sheet.getCell(cellAddr);\n      // E(5), F(6)Ïó¥Ïùò ÌíàÎ™© Îç∞Ïù¥ÌÑ∞ Ìñâ(Îã®Í∞Ä/Í∏àÏï°)Í≥º Ìï©Í≥ÑÌñâ, C(3)Ïó¥Ïùò ÌíàÎ™© Îç∞Ïù¥ÌÑ∞ Ìñâ(Í∑úÍ≤©)ÏùÄ alignmentÎ•º ÎçÆÏñ¥Ïì∞ÏßÄ ÏïäÏùå\n      const isPriceCol = (c === 5 || c === 6);\n      const isSpecCol = (c === 3);\n      const isItemRow = (r >= baseRow && r < sumRow);\n      const isSumRow = (r === sumRow);\n      if (!((isPriceCol && (isItemRow || isSumRow)) || (isSpecCol && isItemRow))) {\n        // ÎÇòÎ®∏ÏßÄ ÏÖÄÎßå Ï§ëÏïô Ï†ïÎ†¨\n        cell.alignment = { horizontal: 'center', vertical: 'middle' };\n      }\n      // Í∏∞Ï°¥ Ïä§ÌÉÄÏùº: 2Ìñâ/8Ìñâ/Ìï©Í≥ÑÌñâ(sumRow) ÏúÑ, 8Ìñâ ÏïÑÎûò, ÎßàÏßÄÎßâÌñâÎßå ÍµµÏùÄÏÑ†\n      cell.border = {\n        top:    { style: (r === 1) ? 'medium' : (r === 2 || r === 8 || r === sumRow) ? 'medium' : 'thin' },\n        left:   { style: c === 1 ? 'medium' : 'thin' },\n        right:  { style: c === 7 ? 'medium' : 'thin' },\n        bottom: { style: (r === 8 || r === sumRow || r === lastRow) ? 'medium' : 'thin' }\n      };\n    }\n  }\n  // Í∑úÍ≤©(CÏó¥) ÏûÖÎ†•ÎûÄ(ÌíàÎ™© Îç∞Ïù¥ÌÑ∞ Ìñâ)ÏùÄ ÎßàÏßÄÎßâÏóê Ï¢åÏ∏° Ï†ïÎ†¨Î°ú ÎçÆÏñ¥Ïì¥Îã§\n  for (let i = 0; i < itemRows; i++) {\n    const rowIdx = baseRow + i;\n    sheet.getCell('C' + rowIdx).alignment = { horizontal: 'left', vertical: 'middle' };\n  }\n\n  // B2:B7, D2:D7, E2:E6 Ïò§Î•∏Ï™Ω ÌÖåÎëêÎ¶¨ ÍµµÍ≤å\n  for (let r = 2; r <= 7; r++) {\n    sheet.getCell('B' + r).border = {\n      ...sheet.getCell('B' + r).border,\n      right: { style: 'medium' }\n    };\n    sheet.getCell('D' + r).border = {\n      ...sheet.getCell('D' + r).border,\n      right: { style: 'medium' }\n    };\n    if (r <= 6) {\n      sheet.getCell('E' + r).border = {\n        ...sheet.getCell('E' + r).border,\n        right: { style: 'medium' }\n      };\n    }\n  }\n  // E7, G7 ÏúÑÏ™Ω ÌÖåÎëêÎ¶¨ ÏùºÎ∞ò(ÏñáÍ≤å)\n  sheet.getCell('E7').border = {\n    ...sheet.getCell('E7').border,\n    top: { style: 'thin' },\n    right: { style: 'medium' }\n  };\n  sheet.getCell('G7').border = {\n    ...sheet.getCell('G7').border,\n    top: { style: 'thin' }\n  };\n\n  // A1~A7 ÏôºÏ™Ω ÌÖåÎëêÎ¶¨ ÍµµÍ≤å Î™ÖÏãúÏ†Å ÏÑ§Ï†ï (ÎçÆÏñ¥Ïì∞Í∏∞ Î∞©ÏßÄ)\n  for (let r = 1; r <= 7; r++) {\n    const currentBorder = sheet.getCell('A' + r).border || {};\n    sheet.getCell('A' + r).border = {\n      ...currentBorder,\n      left: { style: 'medium' }\n    };\n  }\n\n  // Ìï©Í≥Ñ Ìñâ(AÏó¥) ÏôºÏ™Ω ÌÖåÎëêÎ¶¨ ÍµµÍ≤å Î™ÖÏãúÏ†Å ÏÑ§Ï†ï\n  const sumCellBorder = sheet.getCell('A' + sumRow).border || {};\n  sheet.getCell('A' + sumRow).border = {\n    ...sumCellBorder,\n    left: { style: 'medium' }\n  };\n\n  // Ïó¥ ÎÑàÎπÑ (ÌÖúÌîåÎ¶ø Í∏∞Ï§Ä)\n  const colWidths = { A:4.7, B:23, C:30, D:11, E:15, F:16, G:37 };\n  Object.entries(colWidths).forEach(([col, width]) => {\n    sheet.getColumn(col).width = width;\n  });\n\n  /* -----------------------------------\n      ÏµúÏ¢Ö Ìñâ ÎÜíÏù¥/Ìè∞Ìä∏ ÏùºÍ¥Ñ Ï†ÅÏö©\n      1Ìñâ : 39.75pt\n      2Ìñâ~lastRow : 18pt\n  ----------------------------------- */\n  sheet.getRow(1).height = 29.8; // 39.75px‚âà29.8pt\n  sheet.getRow(1).eachCell(c => { c.font = { ...(c.font || {}), name: 'ÎßëÏùÄ Í≥†Îîï', size: 20 }; });\n\n  for (let r = 2; r <= lastRow; r++) {\n    const row = sheet.getRow(r);\n    row.height = 15.75; // 21px‚âà15.75pt\n    row.eachCell(c => {\n      c.font = { ...(c.font || {}), name: 'ÎßëÏùÄ Í≥†Îîï', size: 11 };\n    });\n  }\n\n  // GÏó¥ Ï†ÑÏ≤¥ Ï¢åÏ∏° Ï†ïÎ†¨ Î∞è ÏûêÎèô Ï§ÑÎ∞îÍøà Î≥¥Ïû•\n  for (let r = 9; r <= lastRow; r++) {\n    sheet.getCell('G' + r).alignment = { horizontal: 'left', vertical: 'middle', wrapText: false, shrinkToFit: true };\n    sheet.getCell('B' + r).alignment = { horizontal: 'left', vertical: 'middle' };\n  }\n\n  // 9. ÌååÏùº ÏÉùÏÑ±\n  const buffer = await workbook.xlsx.writeBuffer();\n  return new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });\n}","// Í≥µÌÜµ Excel Îã§Ïö¥Î°úÎìú Ïú†Ìã∏Î¶¨Ìã∞ - Í¥ÄÎ¶¨ÌÉ≠Í≥º ÎåÄÏãúÎ≥¥ÎìúÏóêÏÑú Í≥µÏú†\nimport { createClient } from '@/lib/supabase/client'\n\nconst supabase = createClient()\nimport { generatePurchaseOrderExcelJS } from '@/utils/exceljs/generatePurchaseOrderExcel'\nimport type { PurchaseOrderData } from '@/utils/exceljs/generatePurchaseOrderExcel'\nimport { toast } from 'sonner'\n\nexport interface Purchase {\n  id?: number\n  purchase_order_number: string\n  vendor_name: string\n  vendor_id?: string\n  contact_id?: string\n}\n\n/**\n * Í≥µÌÜµ Excel Îã§Ïö¥Î°úÎìú Ìï®Ïàò - Í¥ÄÎ¶¨ÌÉ≠Í≥º ÎåÄÏãúÎ≥¥Îìú Î™®ÎëêÏóêÏÑú ÏÇ¨Ïö©\n * Í¥ÄÎ¶¨ÌÉ≠Ïùò handleExcelDownload Î°úÏßÅÏùÑ Í∑∏ÎåÄÎ°ú Ïú†Ìã∏Î¶¨Ìã∞Î°ú Î∂ÑÎ¶¨\n */\nexport const downloadPurchaseOrderExcel = async (\n  purchase: Purchase, \n  currentUserRoles?: string[],\n  onSuccessCallback?: () => void\n) => {\n  try {\n    // DBÏóêÏÑú ÏßÅÏ†ë Î™®Îì† ÌíàÎ™© Ï°∞Ìöå\n    const { data: purchaseRequest, error: requestError } = await supabase\n      .from('purchase_requests')\n      .select('*')\n      .eq('purchase_order_number', purchase.purchase_order_number)\n      .single();\n\n    if (requestError || !purchaseRequest) {\n      toast.error('Ìï¥Îãπ Î∞úÏ£ºÏöîÏ≤≠Î≤àÌò∏Ïùò Îç∞Ïù¥ÌÑ∞Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');\n      return;\n    }\n\n    // ÌíàÎ™© Îç∞Ïù¥ÌÑ∞ Ï°∞Ìöå\n    const { data: orderItems, error: itemsError } = await supabase\n      .from('purchase_request_items')\n      .select('*')\n      .eq('purchase_order_number', purchase.purchase_order_number)\n      .order('line_number');\n\n    if (itemsError || !orderItems || orderItems.length === 0) {\n      toast.error('Ìï¥Îãπ Î∞úÏ£ºÏöîÏ≤≠Î≤àÌò∏Ïùò ÌíàÎ™© Îç∞Ïù¥ÌÑ∞Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');\n      return;\n    }\n\n    // ÏóÖÏ≤¥ ÏÉÅÏÑ∏ Ï†ïÎ≥¥ Î∞è Îã¥ÎãπÏûê Ï†ïÎ≥¥ Ï°∞Ìöå\n    const vendorInfo = {\n      vendor_name: purchase.vendor_name,\n      vendor_phone: '',\n      vendor_fax: '',\n      vendor_contact_name: ''\n    };\n\n    try {\n      const vendorId = purchaseRequest.vendor_id || purchase.vendor_id;\n      const contactId = purchaseRequest.contact_id || purchase.contact_id;\n      \n      // vendor Ï†ïÎ≥¥ Ï°∞Ìöå\n      if (vendorId) {\n        const { data: vendorData, error: vendorError } = await supabase\n          .from('vendors')\n          .select('vendor_phone, vendor_fax')\n          .eq('id', vendorId)\n          .single();\n\n        if (vendorData && !vendorError) {\n          vendorInfo.vendor_phone = vendorData.vendor_phone || '';\n          vendorInfo.vendor_fax = vendorData.vendor_fax || '';\n        }\n      }\n\n      // vendor_contactsÏóêÏÑú contact_idÎ°ú Îã¥ÎãπÏûê Ï†ïÎ≥¥ Ï°∞Ìöå\n      if (contactId) {\n        const { data: contactData, error: contactError } = await supabase\n          .from('vendor_contacts')\n          .select('contact_name, contact_phone, contact_email')\n          .eq('id', contactId)\n          .single();\n        if (contactData && !contactError) {\n          vendorInfo.vendor_contact_name = contactData.contact_name || '';\n        }\n      }\n    } catch (error) {\n      // ÏóÖÏ≤¥ Ï†ïÎ≥¥ Ï°∞Ìöå Ïã§Ìå® ÏãúÏóêÎèÑ Í≥ÑÏÜç ÏßÑÌñâ\n    }\n\n    const excelData: PurchaseOrderData = {\n      purchase_order_number: purchaseRequest.purchase_order_number || '',\n      request_date: purchaseRequest.request_date,\n      delivery_request_date: purchaseRequest.delivery_request_date,\n      requester_name: purchaseRequest.requester_name,\n      vendor_name: vendorInfo.vendor_name || '',\n      vendor_contact_name: vendorInfo.vendor_contact_name,\n      vendor_phone: vendorInfo.vendor_phone,\n      vendor_fax: vendorInfo.vendor_fax,\n      project_vendor: purchaseRequest.project_vendor,\n      sales_order_number: purchaseRequest.sales_order_number,\n      project_item: purchaseRequest.project_item,\n      items: orderItems.map((item: any) => ({\n        line_number: item.line_number,\n        item_name: item.item_name,\n        specification: item.specification,\n        quantity: item.quantity,\n        unit_price_value: item.unit_price_value,\n        amount_value: item.amount_value,\n        remark: item.remark,\n        currency: purchaseRequest.currency || 'KRW'\n      }))\n    };\n\n    // ÏΩîÎìú Í∏∞Î∞ò ExcelJS ÏÉùÏÑ± (ÌÖúÌîåÎ¶ø ÏóÜÏù¥ ÏÑúÏãù ÏßÅÏ†ë Ï†ïÏùò)\n    const blob = await generatePurchaseOrderExcelJS(excelData);\n    \n    // Îã§Ïö¥Î°úÎìúÏö© ÌååÏùºÎ™Ö: Î∞úÏ£ºÏÑú_{ÏóÖÏ≤¥Î™Ö}_Î∞úÏ£ºÏöîÏ≤≠Î≤àÌò∏\n    const downloadFilename = `Î∞úÏ£ºÏÑú_${excelData.vendor_name}_${excelData.purchase_order_number}.xlsx`;\n\n    // ÏÇ¨Ïö©ÏûêÏóêÍ≤å Ï¶âÏãú Îã§Ïö¥Î°úÎìú Ï†úÍ≥µ\n    const url = window.URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = downloadFilename;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    window.URL.revokeObjectURL(url);\n    \n    toast.success('ÏóëÏÖÄ ÌååÏùºÏù¥ Îã§Ïö¥Î°úÎìúÎêòÏóàÏäµÎãàÎã§.');\n    \n    // DBÏóê Îã§Ïö¥Î°úÎìú ÏôÑÎ£å ÌîåÎûòÍ∑∏(is_po_download) ÏóÖÎç∞Ïù¥Ìä∏ - lead buyerÎßå Ìï¥Îãπ\n    try {\n      const isLeadBuyer = currentUserRoles && currentUserRoles.includes('lead buyer');\n\n      if (isLeadBuyer) {\n        const { error: downloadFlagErr } = await supabase\n          .from('purchase_requests')\n          .update({ is_po_download: true })\n          .eq('purchase_order_number', purchase.purchase_order_number);\n        \n        if (!downloadFlagErr) {\n          // ÏÑ±Í≥µ ÏΩúÎ∞± Ïã§Ìñâ (UI ÏóÖÎç∞Ïù¥Ìä∏Ïö©)\n          onSuccessCallback?.();\n        }\n      }\n    } catch (flagErr) {\n      // ÌîåÎûòÍ∑∏ ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®Îäî Î¨¥ÏãúÌïòÍ≥† Í≥ÑÏÜç ÏßÑÌñâ\n    }\n  } catch (error) {\n    console.error('‚ùå Excel Îã§Ïö¥Î°úÎìú Ïã§Ìå®:', error);\n    toast.error('ÏóëÏÖÄ Îã§Ïö¥Î°úÎìúÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');\n    throw error;\n  }\n};","import { useMemo, useState, useCallback, useEffect, useRef, lazy, Suspense } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { AlertCircle, Calendar, Loader2, MessageSquarePlus, Check } from 'lucide-react';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Progress } from '@/components/ui/progress';\nimport { Purchase } from '@/types/purchase';\nimport { toast } from 'sonner';\nimport { addCacheListener, findPurchaseInMemory } from '@/stores/purchaseMemoryStore';\nimport { dateToISOString } from '@/utils/helpers';\nimport { logger } from '@/lib/logger';\n\n// ÏÉÅÏÑ∏ Î™®Îã¨ lazy load\nconst PurchaseDetailModal = lazy(() => import('./PurchaseDetailModal'));\n\ninterface DeliveryDateWarningModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  purchases: Purchase[];\n  onRefresh?: (forceRefresh?: boolean, options?: { silent?: boolean }) => void | Promise<void>;\n  currentUserName?: string | null;\n}\n\ninterface WarningItem {\n  purchase: Purchase;\n  warningType: 'delivery_overdue' | 'revision_overdue';\n  daysOverdue: number;\n}\n\nexport default function DeliveryDateWarningModal({\n  isOpen,\n  onClose,\n  purchases,\n  onRefresh,\n  currentUserName\n}: DeliveryDateWarningModalProps) {\n  const navigate = useNavigate();\n  // ÏôÑÎ£åÎêú Ìï≠Î™© ID Î™©Î°ù (Î°úÏª¨ ÏÉÅÌÉúÎ°ú Ï¶âÏãú UI Î∞òÏòÅ)\n  const [completedIds, setCompletedIds] = useState<Set<number>>(new Set());\n  // Î™®Îã¨Ïù¥ Ïó¥Î¶¥ Îïå Í≥†Ï†ïÎêú Í≤ΩÍ≥† Ìï≠Î™© (Ïù¥ÌõÑ Ïû¨Í≥ÑÏÇ∞ Î∞©ÏßÄ)\n  const [fixedWarningItems, setFixedWarningItems] = useState<WarningItem[]>([]);\n  // Ïù¥ÎØ∏ Ìï≠Î™©ÏùÑ Í≥†Ï†ïÌñàÎäîÏßÄ Ï∂îÏ†Å (Ìïú Î≤àÎßå Í≥†Ï†ï)\n  const hasFixedItemsRef = useRef(false);\n  // ÏûêÎèô Îã´Í∏∞Í∞Ä Ïù¥ÎØ∏ Ïã§ÌñâÎêòÏóàÎäîÏßÄ Ï∂îÏ†Å (Ï§ëÎ≥µ Î∞©ÏßÄ)\n  const hasClosedRef = useRef(false);\n  \n  // ÏÉÅÏÑ∏ Î™®Îã¨ ÏÉÅÌÉú\n  const [detailModalPurchaseId, setDetailModalPurchaseId] = useState<number | null>(null);\n  const [isDetailModalOpen, setIsDetailModalOpen] = useState(false);\n  \n  // detailModalPurchaseIdÎ•º refÎ°úÎèÑ Ï†ÄÏû• (onRefresh ÏΩúÎ∞±ÏóêÏÑú ÏÇ¨Ïö©)\n  const detailModalPurchaseIdRef = useRef<number | null>(null);\n  useEffect(() => {\n    detailModalPurchaseIdRef.current = detailModalPurchaseId;\n  }, [detailModalPurchaseId]);\n  \n  // onCloseÎ•º refÎ°ú Í∞êÏã∏ÏÑú useEffect ÏùòÏ°¥ÏÑ± Î¨∏Ï†ú Ìï¥Í≤∞\n  const onCloseRef = useRef(onClose);\n  onCloseRef.current = onClose;\n\n  // Í≤ΩÍ≥† Ìï≠Î™© Í≥ÑÏÇ∞ Ìï®Ïàò\n  const calculateWarningItems = useCallback(() => {\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    \n    const items: WarningItem[] = [];\n    \n    purchases.forEach(purchase => {\n      // Ïù¥ÎØ∏ ÏûÖÍ≥† ÏôÑÎ£åÎêú Ìï≠Î™© Ï†úÏô∏\n      if (purchase.is_received || purchase.delivery_status === 'completed') return;\n      // ÏäπÏù∏ ÏïàÎêú Ìï≠Î™© Ï†úÏô∏\n      if (purchase.middle_manager_status !== 'approved' || purchase.final_manager_status !== 'approved') return;\n      // Î≥∏Ïù∏ Î∞úÏ£ºÎßå ÌëúÏãú\n      if (currentUserName && purchase.requester_name !== currentUserName) return;\n      // Ïù¥ÎØ∏ ÏàòÏ†ïÏöîÏ≤≠ ÏôÑÎ£åÎêú Ìï≠Î™© Ï†úÏô∏\n      if (purchase.delivery_revision_requested === true) return;\n      \n      const deliveryDate = purchase.delivery_request_date ? new Date(purchase.delivery_request_date) : null;\n      const revisedDate = purchase.revised_delivery_request_date ? new Date(purchase.revised_delivery_request_date) : null;\n      \n      if (deliveryDate) deliveryDate.setHours(0, 0, 0, 0);\n      if (revisedDate) revisedDate.setHours(0, 0, 0, 0);\n      \n      // Î≥ÄÍ≤ΩÏöîÏ≤≠ÏùºÏù¥ ÏûàÍ≥† ÏßÄÎÇú Í≤ΩÏö∞\n      if (revisedDate && revisedDate < today) {\n        items.push({\n          purchase,\n          warningType: 'revision_overdue',\n          daysOverdue: Math.floor((today.getTime() - revisedDate.getTime()) / (1000 * 60 * 60 * 24))\n        });\n        return;\n      }\n      \n      // ÏûÖÍ≥†ÏöîÏ≤≠ÏùºÏù¥ ÏßÄÎÇ¨Í≥† Î≥ÄÍ≤ΩÏöîÏ≤≠ÏùºÏù¥ ÏóÜÎäî Í≤ΩÏö∞\n      if (deliveryDate && deliveryDate < today && !revisedDate) {\n        items.push({\n          purchase,\n          warningType: 'delivery_overdue',\n          daysOverdue: Math.floor((today.getTime() - deliveryDate.getTime()) / (1000 * 60 * 60 * 24))\n        });\n      }\n    });\n    \n    return items.sort((a, b) => b.daysOverdue - a.daysOverdue);\n  }, [purchases, currentUserName]);\n\n  // Î™®Îã¨Ïù¥ Ïó¥Î¶¥ Îïå Í≤ΩÍ≥† Ìï≠Î™© Í≥†Ï†ï (Ïù¥ÌõÑ Î©îÎ™®Î¶¨ Ï∫êÏãú ÏóÖÎç∞Ïù¥Ìä∏Î°ú Ïû¨Í≥ÑÏÇ∞ÎêòÏßÄ ÏïäÏùå)\n  // Îã®, ÏûÖÍ≥†ÏôÑÎ£å Ï≤òÎ¶¨Î°ú Ìï≠Î™©Ïù¥ Ï†úÍ±∞ÎêòÎ©¥ Ïã§ÏãúÍ∞ÑÏúºÎ°ú ÏóÖÎç∞Ïù¥Ìä∏\n  const [warningItems, setWarningItems] = useState<WarningItem[]>([]);\n\n  // Î™®Îã¨ Ïó¥Î¶¥ Îïå ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî Î∞è Í≤ΩÍ≥† Ìï≠Î™© Í≥†Ï†ï (Ìïú Î≤àÎßå)\n  useEffect(() => {\n    if (isOpen && !hasFixedItemsRef.current) {\n      setCompletedIds(new Set());\n      hasClosedRef.current = false; // ÏûêÎèô Îã´Í∏∞ ÌîåÎûòÍ∑∏ Ï¥àÍ∏∞Ìôî\n      // Î™®Îã¨ Ïó¥Î¶¥ Îïå Í≤ΩÍ≥† Ìï≠Î™© Í≥†Ï†ï (Ïù¥ÌõÑ Ïû¨Í≥ÑÏÇ∞ Î∞©ÏßÄ)\n      const items = calculateWarningItems();\n      setFixedWarningItems(items);\n      setWarningItems(items);\n      hasFixedItemsRef.current = true;\n    }\n    \n    // Î™®Îã¨Ïù¥ Îã´ÌûàÎ©¥ ÌîåÎûòÍ∑∏ Ï¥àÍ∏∞Ìôî\n    if (!isOpen) {\n      hasFixedItemsRef.current = false;\n    }\n  }, [isOpen, calculateWarningItems]);\n  \n  // ÏûÖÍ≥†ÏôÑÎ£å Ï≤òÎ¶¨ ÌõÑ Í≤ΩÍ≥† Ìï≠Î™© Ïã§ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏\n  useEffect(() => {\n    if (!isOpen || fixedWarningItems.length === 0) return;\n    \n    // ÏûÖÍ≥†ÏôÑÎ£åÎêú Ìï≠Î™© Ï†úÍ±∞ (Î©îÎ™®Î¶¨ Ï∫êÏãú Ïö∞ÏÑ† ÌôïÏù∏, ÏóÜÏúºÎ©¥ purchases prop ÌôïÏù∏)\n    const remainingItems = fixedWarningItems.filter(fixedItem => {\n      // 1. Î©îÎ™®Î¶¨ Ï∫êÏãúÏóêÏÑú Î®ºÏ†Ä ÌôïÏù∏ (Í∞ÄÏû• ÏµúÏã† Îç∞Ïù¥ÌÑ∞)\n      const memoryPurchase = findPurchaseInMemory(fixedItem.purchase.id);\n      if (memoryPurchase) {\n        if (memoryPurchase.is_received || memoryPurchase.delivery_status === 'completed') {\n          return false;\n        }\n        return true;\n      }\n      \n      // 2. Î©îÎ™®Î¶¨ Ï∫êÏãúÏóê ÏóÜÏúºÎ©¥ purchases propÏóêÏÑú ÌôïÏù∏\n      const currentPurchase = purchases.find(p => p.id === fixedItem.purchase.id);\n      if (!currentPurchase) {\n        // Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏúºÎ©¥ ÏõêÎ≥∏ Îç∞Ïù¥ÌÑ∞Î°ú Ï≤¥ÌÅ¨\n        return !(fixedItem.purchase.is_received || fixedItem.purchase.delivery_status === 'completed');\n      }\n      \n      // ÏûÖÍ≥†ÏôÑÎ£åÎêòÏóàÏúºÎ©¥ Ï†úÏô∏\n      if (currentPurchase.is_received || currentPurchase.delivery_status === 'completed') {\n        return false;\n      }\n      \n      return true;\n    });\n    \n    // Í≤ΩÍ≥† Ìï≠Î™© ÏóÖÎç∞Ïù¥Ìä∏\n    if (remainingItems.length !== warningItems.length) {\n      setWarningItems(remainingItems);\n    }\n    \n    // Î™®Îì† Ìï≠Î™©Ïù¥ ÏûÖÍ≥†ÏôÑÎ£åÎêòÏóàÏúºÎ©¥ Î™®Îã¨ ÏûêÎèô Îã´Í∏∞\n    if (remainingItems.length === 0 && fixedWarningItems.length > 0 && !hasClosedRef.current) {\n      hasClosedRef.current = true;\n      setTimeout(() => {\n        onCloseRef.current();\n      }, 300);\n    }\n  }, [purchases, isOpen, fixedWarningItems, warningItems.length]);\n  \n  // warningItemsÍ∞Ä Î≥ÄÍ≤ΩÎê† Îïå Î™®Îì† Ìï≠Î™© ÏôÑÎ£å ÌôïÏù∏\n  useEffect(() => {\n    if (!isOpen) return;\n    \n    // Î™®Îì† Ìï≠Î™©Ïù¥ ÏôÑÎ£åÎêòÏóàÎäîÏßÄ ÌôïÏù∏ (ÏûÖÍ≥†ÏôÑÎ£å ÎòêÎäî ÏàòÏ†ïÏöîÏ≤≠ ÏôÑÎ£å)\n    const allCompleted = warningItems.length === 0 || \n      warningItems.every(item => \n        completedIds.has(item.purchase.id) ||\n        item.purchase.is_received ||\n        item.purchase.delivery_status === 'completed'\n      );\n    \n    if (allCompleted && warningItems.length > 0 && !hasClosedRef.current) {\n      logger.info('üîç [ÏûÖÍ≥†ÏßÄÏó∞ÏïåÎ¶º] Î™®Îì† Ìï≠Î™© ÏôÑÎ£å, Î™®Îã¨ ÏûêÎèô Îã´Í∏∞');\n      hasClosedRef.current = true;\n      setTimeout(() => {\n        onCloseRef.current();\n      }, 300);\n    }\n  }, [warningItems, completedIds, isOpen]);\n\n  // Î™®Îì† Ìï≠Î™© ÏôÑÎ£å Ïó¨Î∂Ä\n  const allCompleted = useMemo(() => {\n    if (warningItems.length === 0) return true;\n    return warningItems.every(item => completedIds.has(item.purchase.id));\n  }, [warningItems, completedIds]);\n\n  // ÏßÑÌñâÎ•†\n  const progress = useMemo(() => {\n    if (warningItems.length === 0) return 100;\n    return Math.round((completedIds.size / warningItems.length) * 100);\n  }, [warningItems.length, completedIds.size]);\n\n  // 100% ÏôÑÎ£å Ïãú ÏûêÎèô Îã´Í∏∞\n  useEffect(() => {\n    if (progress === 100 && warningItems.length > 0 && !hasClosedRef.current) {\n      hasClosedRef.current = true;\n      // 300ms ÌõÑ Î™®Îã¨ ÏûêÎèô Îã´Í∏∞\n      setTimeout(() => {\n        onCloseRef.current();\n      }, 300);\n    }\n  }, [progress, warningItems.length]);\n\n  // üöÄ Realtime Ïù¥Î≤§Ìä∏ Íµ¨ÎèÖ - Î™®Îã¨Ïù¥ Ïó¥Î†§ÏûàÎäî ÎèôÏïà Ïã§ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏\n  const realtimeFirstMount = useRef(true);\n  useEffect(() => {\n    if (!isOpen) return;\n\n    const handleCacheUpdate = () => {\n      if (realtimeFirstMount.current) {\n        realtimeFirstMount.current = false;\n        return;\n      }\n      // Realtime Ïù¥Î≤§Ìä∏ Î∞úÏÉù Ïãú Î∂ÄÎ™®ÏóêÍ≤å ÏÉàÎ°úÍ≥†Ïπ® ÏöîÏ≤≠\n      onRefresh?.();\n    };\n\n    const unsubscribe = addCacheListener(handleCacheUpdate);\n    return () => unsubscribe();\n  }, [isOpen, onRefresh]);\n\n  const handleOpenDeliveryDateChangeSupport = useCallback((purchase: Purchase) => {\n    const purchaseId = purchase?.id;\n    if (!purchaseId) {\n      toast.error('Î∞úÏ£ºÏöîÏ≤≠ Ï†ïÎ≥¥Î•º ÌôïÏù∏Ìï† Ïàò ÏóÜÏäµÎãàÎã§.');\n      return;\n    }\n\n    const returnTo = encodeURIComponent('/purchase/list?tab=receipt');\n    navigate(`/support?type=delivery_date_change&purchaseId=${purchaseId}&source=delivery-warning&returnTo=${returnTo}`);\n  }, [navigate]);\n\n  // Îã´Í∏∞ Ìï∏Îì§Îü¨\n  const handleClose = useCallback(() => {\n    if (allCompleted) {\n      onClose();\n    } else {\n      toast.error(`Î™®Îì† Ìï≠Î™©(${warningItems.length}Í±¥)Ïóê ÎåÄÌï¥ ÏàòÏ†ïÏöîÏ≤≠ÏùÑ ÏôÑÎ£åÌï¥Ï£ºÏÑ∏Ïöî.`);\n    }\n  }, [allCompleted, onClose, warningItems.length]);\n\n  // ÎÇ†Ïßú Ìè¨Îß∑\n  const formatDate = (dateStr: string | undefined | null) => {\n    if (!dateStr) return '-';\n    const d = new Date(dateStr);\n    return `${d.getFullYear()}.${String(d.getMonth() + 1).padStart(2, '0')}.${String(d.getDate()).padStart(2, '0')}`;\n  };\n\n  // Ïπ¥Îìú ÌÅ¥Î¶≠ Ïãú ÏÉÅÏÑ∏ Î™®Îã¨ Ïó¥Í∏∞\n  const handleCardClick = useCallback((purchaseId: number) => {\n    setDetailModalPurchaseId(purchaseId);\n    setIsDetailModalOpen(true);\n  }, []);\n\n  // ÏÉÅÏÑ∏ Î™®Îã¨ Îã´Í∏∞ - ÏûÖÍ≥†ÏôÑÎ£å Ï≤òÎ¶¨ ÌôïÏù∏ Î∞è Í≤ΩÍ≥† Ìï≠Î™© ÏóÖÎç∞Ïù¥Ìä∏\n  const handleDetailModalClose = useCallback(() => {\n    const purchaseIdToCheck = detailModalPurchaseId;\n    \n    setIsDetailModalOpen(false);\n    setDetailModalPurchaseId(null);\n    \n    if (purchaseIdToCheck) {\n      // 1. Î©îÎ™®Î¶¨ Ï∫êÏãúÏóêÏÑú Ï¶âÏãú ÌôïÏù∏ (ÏßÄÏó∞ ÏóÜÏùå)\n      const memoryPurchase = findPurchaseInMemory(purchaseIdToCheck);\n      \n      if (memoryPurchase) {\n        const isReceived = memoryPurchase.is_received || memoryPurchase.delivery_status === 'completed';\n        \n        if (isReceived) {\n          // Ï¶âÏãú Í≤ΩÍ≥† Ìï≠Î™©ÏóêÏÑú Ï†úÍ±∞\n          setWarningItems(prev => {\n            const filtered = prev.filter(item => item.purchase.id !== purchaseIdToCheck);\n            return filtered;\n          });\n          \n          setFixedWarningItems(prev => prev.filter(item => item.purchase.id !== purchaseIdToCheck));\n          setCompletedIds(prev => new Set(prev).add(purchaseIdToCheck));\n        }\n      } else {\n        // Î©îÎ™®Î¶¨ Ï∫êÏãúÏóê ÏóÜÏúºÎ©¥ purchases propÏóêÏÑú ÌôïÏù∏ (fallback)\n        const currentPurchase = purchases.find(p => p.id === purchaseIdToCheck);\n        \n        if (currentPurchase) {\n          const isReceived = currentPurchase.is_received || currentPurchase.delivery_status === 'completed';\n          \n          if (isReceived) {\n            setWarningItems(prev => prev.filter(item => item.purchase.id !== purchaseIdToCheck));\n            setFixedWarningItems(prev => prev.filter(item => item.purchase.id !== purchaseIdToCheck));\n            setCompletedIds(prev => new Set(prev).add(purchaseIdToCheck));\n          }\n        }\n      }\n      \n      // 2. Î∞±Í∑∏ÎùºÏö¥ÎìúÏóêÏÑú onRefresh Ìò∏Ï∂ú (prop ÏóÖÎç∞Ïù¥Ìä∏Ïö©)\n      onRefresh?.(false, { silent: true });\n    }\n  }, [detailModalPurchaseId, purchases, onRefresh]);\n\n  if (warningItems.length === 0) return null;\n\n  return (\n    <>\n      <Dialog open={isOpen} onOpenChange={(open) => !open && handleClose()}>\n        <DialogContent className=\"max-w-2xl max-h-[80vh] flex flex-col p-0 gap-0\" showCloseButton={false}>\n          {/* Ìó§Îçî */}\n          <DialogHeader className=\"px-5 py-4 border-b\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-3\">\n                <AlertCircle className=\"w-5 h-5 text-red-500\" />\n                <DialogTitle className=\"page-title text-base\">\n                  ÏûÖÍ≥† ÏùºÏ†ï ÏßÄÏó∞ ÏïåÎ¶º\n                </DialogTitle>\n              </div>\n              <span className=\"text-xs text-gray-500\">\n                {completedIds.size}/{warningItems.length} ÏôÑÎ£å\n              </span>\n            </div>\n            <Progress value={progress} className=\"h-1 mt-3\" />\n          </DialogHeader>\n\n          {/* Î≥∏Î¨∏ */}\n          <div className=\"flex-1 overflow-auto p-4 space-y-2\">\n            {warningItems.map((item) => {\n              const isCompleted = completedIds.has(item.purchase.id);\n\n              return (\n                <div\n                  key={item.purchase.id}\n                  className={`border rounded-lg p-3 transition-all duration-200 cursor-pointer hover:border-hansl-400 ${\n                    isCompleted ? 'bg-gray-50 opacity-60' : 'bg-white'\n                  }`}\n                  onClick={() => handleCardClick(item.purchase.id)}\n                >\n                  <div className=\"flex items-center justify-between gap-3\">\n                    {/* Ï†ïÎ≥¥ */}\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"flex items-center gap-2 mb-1\">\n                        <span className=\"text-sm font-medium text-gray-900\">\n                          {item.purchase.purchase_order_number}\n                        </span>\n                        <span className=\"text-xs text-gray-500\">\n                          {item.purchase.vendor_name}\n                        </span>\n                      </div>\n                      <div className=\"flex items-center gap-3 text-xs text-gray-500\">\n                        <span className=\"flex items-center gap-1\">\n                          <Calendar className=\"w-3 h-3\" />\n                          ÏûÖÍ≥†ÏöîÏ≤≠: {formatDate(item.purchase.delivery_request_date)}\n                        </span>\n                        {item.purchase.revised_delivery_request_date && (\n                          <span>Î≥ÄÍ≤Ω: {formatDate(item.purchase.revised_delivery_request_date)}</span>\n                        )}\n                        <span className=\"text-red-500\">{item.daysOverdue}Ïùº Í≤ΩÍ≥º</span>\n                      </div>\n                    </div>\n\n                    {/* Î≤ÑÌäº */}\n                    <div className=\"flex-shrink-0\" onClick={(e) => e.stopPropagation()}>\n                      {isCompleted ? (\n                        <Button\n                          size=\"sm\"\n                          disabled\n                          className=\"button-base bg-gray-100 text-gray-500 h-7 px-3 text-xs\"\n                        >\n                          <Check className=\"w-3 h-3 mr-1\" />\n                          ÏöîÏ≤≠ ÏôÑÎ£å\n                        </Button>\n                      ) : (\n                        <Button\n                          size=\"sm\"\n                          className=\"button-base bg-hansl-600 hover:bg-hansl-700 text-white h-7 px-3 text-xs\"\n                          onClick={() => handleOpenDeliveryDateChangeSupport(item.purchase)}\n                          title=\"ÏûÖÍ≥†Ïùº Î≥ÄÍ≤Ω ÏöîÏ≤≠\"\n                        >\n                          <MessageSquarePlus className=\"w-3 h-3 mr-1\" />\n                          ÏûÖÍ≥†Ïùº Î≥ÄÍ≤Ω ÏöîÏ≤≠\n                        </Button>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n\n          {/* Ìë∏ÌÑ∞ */}\n          <div className=\"border-t px-5 py-3\">\n            <p className=\"text-xs text-gray-500 text-center\">\n              ‚ÑπÔ∏è Î™®Îì† ÏàòÏ†ï ÏöîÏ≤≠Ïù¥ ÏôÑÎ£åÎêòÎ©¥ Ïù¥ Ï∞ΩÏù¥ ÏûêÎèôÏúºÎ°ú Îã´ÌûôÎãàÎã§\n            </p>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* ÏÉÅÏÑ∏ Î™®Îã¨ - Î∞úÏ£ºÏöîÏ≤≠Í¥ÄÎ¶¨ > ÏûÖÍ≥†ÌòÑÌô© ÌÉ≠Ïùò ÏÉÅÏÑ∏ Î™®Îã¨Í≥º ÎèôÏùº */}\n      {detailModalPurchaseId && (\n        <Suspense fallback={\n          <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-[100]\">\n            <Loader2 className=\"w-8 h-8 animate-spin text-white\" />\n          </div>\n        }>\n          <PurchaseDetailModal\n            purchaseId={detailModalPurchaseId}\n            isOpen={isDetailModalOpen}\n            onClose={handleDetailModalClose}\n            activeTab=\"receipt\"\n            onRefresh={async (silent, options) => {\n              // ÏÉÅÏÑ∏ Î™®Îã¨ÏóêÏÑú ÏûÖÍ≥†ÏôÑÎ£å Ï≤òÎ¶¨ Ïãú Î∂ÄÎ™®ÏóêÍ≤å ÏÉàÎ°úÍ≥†Ïπ® ÏöîÏ≤≠\n              if (onRefresh) {\n                const result = onRefresh(silent, options);\n                if (result instanceof Promise) {\n                  await result;\n                }\n              }\n              \n              // ÏûÖÍ≥†ÏôÑÎ£å Ï≤òÎ¶¨ ÌõÑ Î©îÎ™®Î¶¨ Ï∫êÏãúÏóêÏÑú Ï¶âÏãú ÌôïÏù∏ÌïòÏó¨ Í≤ΩÍ≥† Ìï≠Î™© Ï†úÍ±∞\n              const currentPurchaseId = detailModalPurchaseIdRef.current;\n              if (currentPurchaseId) {\n                // ÏïΩÍ∞ÑÏùò ÏßÄÏó∞ ÌõÑ Î©îÎ™®Î¶¨ Ï∫êÏãú ÌôïÏù∏ (ÏûÖÍ≥†ÏôÑÎ£å Ï≤òÎ¶¨ ÏôÑÎ£å ÎåÄÍ∏∞)\n                setTimeout(() => {\n                  const memoryPurchase = findPurchaseInMemory(currentPurchaseId);\n                  \n                  if (memoryPurchase) {\n                    const isReceived = memoryPurchase.is_received || memoryPurchase.delivery_status === 'completed';\n                    \n                    if (isReceived) {\n                      // Ï¶âÏãú Í≤ΩÍ≥† Ìï≠Î™©ÏóêÏÑú Ï†úÍ±∞\n                      setWarningItems(prev => prev.filter(item => item.purchase.id !== currentPurchaseId));\n                      setFixedWarningItems(prev => prev.filter(item => item.purchase.id !== currentPurchaseId));\n                      setCompletedIds(prev => new Set(prev).add(currentPurchaseId));\n                    }\n                  }\n                }, 100); // 100ms ÏßÄÏó∞ÏúºÎ°ú ÏûÖÍ≥†ÏôÑÎ£å Ï≤òÎ¶¨ ÏôÑÎ£å ÎåÄÍ∏∞\n              }\n            }}\n          />\n        </Suspense>\n      )}\n    </>\n  );\n}\n\n// Í≤ΩÍ≥† Ìï≠Î™© Ïàò Í≥ÑÏÇ∞ ÌõÖ\nexport function useDeliveryWarningCount(purchases: Purchase[], currentUserName?: string | null): number {\n  return useMemo(() => {\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n\n    let count = 0;\n    const debugItems: any[] = [];\n\n    purchases.forEach(purchase => {\n      // F20251226_003 Ìï≠Î™© ÎîîÎ≤ÑÍπÖ\n      const isTarget = purchase.purchase_order_number === 'F20251226_003';\n      \n      if (purchase.is_received || purchase.delivery_status === 'completed') {\n        if (isTarget) debugItems.push({ step: 'ÏûÖÍ≥†ÏôÑÎ£åÎ°ú Ï†úÏô∏', purchase: purchase.purchase_order_number });\n        return;\n      }\n      if (purchase.middle_manager_status !== 'approved' || purchase.final_manager_status !== 'approved') {\n        if (isTarget) debugItems.push({ \n          step: 'ÏäπÏù∏ ÎØ∏ÏôÑÎ£åÎ°ú Ï†úÏô∏', \n          purchase: purchase.purchase_order_number,\n          middle: purchase.middle_manager_status,\n          final: purchase.final_manager_status\n        });\n        return;\n      }\n      if (currentUserName && purchase.requester_name !== currentUserName) {\n        if (isTarget) debugItems.push({ \n          step: 'Î≥∏Ïù∏ Î∞úÏ£º ÏïÑÎãòÏúºÎ°ú Ï†úÏô∏', \n          purchase: purchase.purchase_order_number,\n          requester_name: purchase.requester_name,\n          currentUserName\n        });\n        return;\n      }\n      if (purchase.delivery_revision_requested === true) {\n        if (isTarget) debugItems.push({ \n          step: 'ÏàòÏ†ïÏöîÏ≤≠ ÏôÑÎ£åÎ°ú Ï†úÏô∏', \n          purchase: purchase.purchase_order_number \n        });\n        return;\n      }\n\n      const deliveryDate = purchase.delivery_request_date ? new Date(purchase.delivery_request_date) : null;\n      const revisedDate = purchase.revised_delivery_request_date ? new Date(purchase.revised_delivery_request_date) : null;\n\n      if (deliveryDate) deliveryDate.setHours(0, 0, 0, 0);\n      if (revisedDate) revisedDate.setHours(0, 0, 0, 0);\n\n      if (revisedDate && revisedDate < today) {\n        count++;\n        if (isTarget) debugItems.push({ \n          step: 'Î≥ÄÍ≤ΩÏöîÏ≤≠Ïùº ÏßÄÏó∞ÏúºÎ°ú Ìè¨Ìï®', \n          purchase: purchase.purchase_order_number,\n          revisedDate: dateToISOString(revisedDate),\n          today: today.toISOString()\n        });\n        return;\n      }\n\n      if (deliveryDate && deliveryDate < today && !revisedDate) {\n        count++;\n        if (isTarget) debugItems.push({ \n          step: 'ÏûÖÍ≥†ÏöîÏ≤≠Ïùº ÏßÄÏó∞ÏúºÎ°ú Ìè¨Ìï®', \n          purchase: purchase.purchase_order_number,\n          deliveryDate: dateToISOString(deliveryDate),\n          today: today.toISOString()\n        });\n        return;\n      }\n      \n      if (isTarget) {\n        debugItems.push({ \n          step: 'ÎÇ†Ïßú Ï°∞Í±¥ Î∂àÎßåÏ°±', \n          purchase: purchase.purchase_order_number,\n          deliveryDate: deliveryDate ? dateToISOString(deliveryDate) : null,\n          revisedDate: revisedDate ? dateToISOString(revisedDate) : null,\n          today: today.toISOString()\n        });\n      }\n    });\n\n    // ÎîîÎ≤ÑÍπÖ Î°úÍ∑∏ Ï∂úÎ†•\n    if (debugItems.length > 0) {\n      console.log('üîç [useDeliveryWarningCount] F20251226_003 ÎîîÎ≤ÑÍπÖ:', debugItems);\n    }\n    \n    // F20251226_003 Ìï≠Î™©Ïù¥ purchasesÏóê ÏûàÎäîÏßÄ ÌôïÏù∏\n    const targetPurchase = purchases.find(p => p.purchase_order_number === 'F20251226_003');\n    if (targetPurchase) {\n      console.log('üîç [useDeliveryWarningCount] F20251226_003 Ìï≠Î™© ÏÉÅÏÑ∏ Ï†ïÎ≥¥:', {\n        purchase_order_number: targetPurchase.purchase_order_number,\n        requester_name: targetPurchase.requester_name,\n        currentUserName,\n        nameMatch: targetPurchase.requester_name === currentUserName,\n        is_received: targetPurchase.is_received,\n        delivery_status: targetPurchase.delivery_status,\n        middle_manager_status: targetPurchase.middle_manager_status,\n        final_manager_status: targetPurchase.final_manager_status,\n        delivery_revision_requested: targetPurchase.delivery_revision_requested,\n        delivery_request_date: targetPurchase.delivery_request_date,\n        revised_delivery_request_date: targetPurchase.revised_delivery_request_date,\n        today: today.toISOString(),\n        finalCount: count\n      });\n    }\n\n    return count;\n  }, [purchases, currentUserName]);\n}\n"],"file":"assets/DeliveryDateWarningModal-DxZdxCOm.js"}