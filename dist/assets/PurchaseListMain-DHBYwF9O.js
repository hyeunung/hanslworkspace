const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/exceljs.min-C0ibNCbi.js","assets/index-Dv9d16If.js","assets/index-B_OS4WmA.css","assets/PurchaseItemsModal-Bdj3iIAJ.js","assets/input-DUa4cizf.js","assets/table-CmddlnI6.js","assets/index-V7ajxhIs.js","assets/eye-Bmp-s4Ec.js","assets/download-BhudwEBV.js","assets/format-TRPNovzq.js","assets/plus-D4n6UfPv.js","assets/save-DvZrlKDk.js","assets/card-BFToctv8.js"])))=>i.map(i=>d[i]);
import{c as Zt,r as n,a as be,l as ke,j as e,_ as Je,f as He,g as er,h as tr,i as rr,k as Y,m as Ye,n as xe,P as ce,o as we,b as Ue,u as ar,p as sr}from"./index-Dv9d16If.js";import{t as te,B as H}from"./index-V7ajxhIs.js";import{a as nr,b as lr,c as or,d as ir,P as cr}from"./PurchaseDetailModal-mvPs8I3n.js";import{f as Pe}from"./helpers-BMiTuHMe.js";import{E as dr}from"./eye-Bmp-s4Ec.js";import{g as Xe,R as Qe,P as Ze,W as mr,C as et,T as ur,h as pr,i as tt,O as rt,j as xr,I as _e}from"./input-DUa4cizf.js";import{C as gr,S as Me,a as Oe,b as Le,c as Te,d as me}from"./select-DIyFZOqr.js";import{S as at}from"./search-BA1eViO3.js";import{C as Be,a as fr,b as hr,c as ze}from"./card-BFToctv8.js";import{P as yr}from"./plus-D4n6UfPv.js";import{F as _r}from"./funnel-C0DxPFIe.js";import"./format-TRPNovzq.js";import"./chevron-down-BMz__SWj.js";import"./calendar-DgpiSDVo.js";import"./save-DvZrlKDk.js";/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vr=[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]],wr=Zt("chevrons-up-down",vr),jr=()=>{const[t,s]=n.useState([]),[r,a]=n.useState([]),[o,x]=n.useState([]),[f,h]=n.useState(!0),[b,c]=n.useState([]),[C,$]=n.useState(""),[A,R]=n.useState(""),[F,X]=n.useState(""),l=be();n.useEffect(()=>{(async()=>{try{const[I,P,p]=await Promise.all([l.from("vendors").select("*"),l.from("employees").select("*"),l.auth.getUser()]);if(I.error)throw I.error;if(a(I.data||[]),P.error)throw P.error;if(x(P.data||[]),p.data.user&&!p.error){let u=null;if(p.data.user.email&&(u=(await l.from("employees").select("*").eq("email",p.data.user.email).maybeSingle()).data),u){let D=[];u.purchase_role&&(Array.isArray(u.purchase_role)?D=u.purchase_role.map(_=>String(_).trim()):D=String(u.purchase_role).split(",").map(T=>T.trim()).filter(T=>T.length>0)),c(D),$(u.name||u.full_name||""),R(u.email||""),X(u.id||"")}}}catch(I){ke.error("초기 데이터 로드 실패",I)}})()},[]);const g=n.useCallback(async()=>{h(!0);try{let N=o;if(N.length===0){const{data:_}=await l.from("employees").select("*");N=_||[]}const{data:{user:I},error:P}=await l.auth.getUser();if(P||!I){ke.error("사용자 인증 실패",P),te.error("로그인이 필요합니다."),h(!1);return}const{data:p,error:u}=await l.from("purchase_requests").select("*,vendors(vendor_name,vendor_payment_schedule),vendor_contacts(contact_name),purchase_request_items(*).order(line_number)").order("request_date",{ascending:!1}).limit(2e3);if(u)throw u;const D=(p||[]).map(_=>{const T=_.purchase_request_items?.[0]||{},L=N.find(M=>M.id===_.requester_id);return{id:Number(_.id),purchase_order_number:_.purchase_order_number,request_date:_.request_date,delivery_request_date:_.delivery_request_date,progress_type:_.progress_type,payment_completed_at:_.payment_completed_at,payment_category:_.payment_category,currency:_.currency,request_type:_.request_type,vendor:_.vendors||null,vendor_name:_.vendors?.vendor_name||"",vendor_payment_schedule:_.vendors?.vendor_payment_schedule||"",vendor_contacts:_.vendor_contacts||[],requester_id:_.requester_id,requester_name:_.requester_name,requester_full_name:L?.full_name||L?.name||_.requester_name||"",item_name:T.item_name||"",specification:T.specification||"",quantity:Number(T.quantity)||0,unit_price_value:Number(T.unit_price_value)||0,amount_value:Number(T.amount_value)||0,remark:T.remark||"",project_vendor:_.project_vendor,sales_order_number:_.sales_order_number,project_item:_.project_item,line_number:Number(T.line_number)||1,contact_name:_.vendor_contacts?.contact_name||"",middle_manager_status:_.middle_manager_status,final_manager_status:_.final_manager_status,is_received:!!_.is_received,received_at:_.received_at,is_payment_completed:!!_.is_payment_completed,is_po_download:!!_.is_po_download,link:T.link,items:_.purchase_request_items||[],total_amount:_.purchase_request_items?.reduce((M,ee)=>M+(Number(ee.amount_value)||0),0)||0,purchase_status:_.purchase_status||"pending"}});s(D)}catch(N){ke.error("발주 목록 로드 실패",N),te.error("발주 목록을 불러올 수 없습니다.")}finally{h(!1)}},[o]);return n.useEffect(()=>{g()},[g]),{purchases:t,vendors:r,employees:o,loading:f,currentUserRoles:b,currentUserName:C,currentUserEmail:A,currentUserId:F,refreshPurchases:g}};function br(t,s=500){const[r,a]=n.useState(t);return n.useEffect(()=>{const o=setTimeout(()=>{a(t)},s);return()=>{clearTimeout(o)}},[t,s]),r}const Nr=["정희웅"],Cr=(t,s,r,a,o)=>{const x=be(),[f,h]=n.useState("pending"),[b,c]=n.useState(""),[C,$]=n.useState(""),[A,R]=n.useState(""),[F,X]=n.useState(""),[l,g]=n.useState(""),[N,I]=n.useState(""),[P,p]=n.useState(""),[u,D]=n.useState(""),_=new Date().getFullYear(),T=new Date(_,0,1).toISOString().split("T")[0],L=new Date().toISOString().split("T")[0],[M,ee]=n.useState(T),[V,J]=n.useState(L),W=br(b,300),O=s?.includes("app_admin");s?.includes("final_approver"),s?.includes("middle_manager");const Q=s?.includes("purchase_manager"),G=s?.includes("raw_material_manager")||s?.includes("consumable_manager")||s?.includes("purchase_manager"),re=n.useMemo(()=>!s||s.length===0?1:Q?2:s.some(w=>["middle_manager","final_approver","app_admin","ceo"].includes(w))?3:1,[s,Q]),ae=n.useCallback(w=>{if(!r)return"all";if(w==="purchase")return G||O?"all":r;switch(re){case 1:return w==="done"?"all":r;case 2:return w==="done"?"all":r;case 3:return"all";default:return r}},[r,re,G,O]);n.useEffect(()=>{if(!r)return;const w=ae(f);R(w)},[f,r,re,ae]);const se=n.useMemo(()=>s.includes("purchase_manager")||s.includes("app_admin")?t:t.filter(w=>!Nr.includes(w.requester_name)),[t,s]),i=n.useMemo(()=>se.filter(w=>{const v=w.request_date?w.request_date.split("T")[0]:"",S=!M||v>=M,B=!V||v<=V;return S&&B}),[se,M,V]),j=n.useMemo(()=>i.filter(v=>{let S=!1;switch(f){case"pending":return S=["pending","대기","",null].includes(v.final_manager_status),S;case"purchase":{const B=v.payment_category==="구매 요청",fe=!v.is_payment_completed,he=(v.progress_type||"").includes("선진행"),Ce=(v.progress_type||"").includes("일반"),Se=v.final_manager_status==="approved";return!B||!fe?S=!1:S=he||Ce&&Se,S}case"receipt":{const B=!v.is_received,fe=(v.progress_type||"").includes("선진행"),he=v.final_manager_status==="approved";return S=B&&(fe||he),S}case"done":return S=!0,S;default:return!0}}),[i,f]),k=n.useMemo(()=>A&&A!=="all"&&A!=="전체"?j.filter(v=>v.requester_name===A):j,[j,A]),y=n.useMemo(()=>C?k.filter(w=>w.vendor_name===C):k,[k,C]),E=n.useMemo(()=>{let w=y;if(F){const v=F.trim().toLowerCase();w=w.filter(S=>S.purchase_order_number?.toLowerCase().includes(v))}if(l){const v=l.trim().toLowerCase();w=w.filter(S=>S.items&&S.items.length>0?S.items.some(B=>B.item_name?.toLowerCase().includes(v)):!1)}if(N){const v=N.trim().toLowerCase();w=w.filter(S=>S.items&&S.items.length>0?S.items.some(B=>B.specification?.toLowerCase().includes(v)):!1)}if(P&&P!=="all"&&(w=w.filter(v=>{switch(P){case"pending":return!v.final_manager_status||v.final_manager_status==="pending"||v.final_manager_status==="대기";case"approved":return v.final_manager_status==="approved";case"rejected":return v.final_manager_status==="rejected"||v.middle_manager_status==="rejected";default:return!0}})),u){const v=u.trim().toLowerCase();w=w.filter(S=>S.items&&S.items.length>0?S.items.some(B=>B.remark?.toLowerCase().includes(v)):!1)}return w},[y,F,l,N,P,u]),m=n.useMemo(()=>{if(!W)return E;const w=W.trim().toLowerCase();return E.filter(v=>v.purchase_order_number?.toLowerCase().includes(w)||v.vendor_name?.toLowerCase().includes(w)||v.requester_name?.toLowerCase().includes(w)||v.project_vendor?.toLowerCase().includes(w)?!0:v.items&&v.items.length>0?v.items.some(S=>S.item_name&&S.item_name.toLowerCase().includes(w)||S.specification&&S.specification.toLowerCase().includes(w)):!1)},[E,W]),q=n.useMemo(()=>[...m].sort((w,v)=>{const S=w.request_date?new Date(w.request_date).getTime():0;return(v.request_date?new Date(v.request_date).getTime():0)-S}),[m]),K=n.useMemo(()=>{const v=se.filter(z=>{const Z=z.request_date?z.request_date.split("T")[0]:"",ne=!M||Z>=M,ye=!V||Z<=V;return ne&&ye}),S=z=>new Set(z.map(Z=>Z.purchase_order_number)).size,B=z=>{if(z==="purchase")return G||O?v:v.filter(ne=>ne.requester_name===r);const Z=ae(z);return Z==="all"||Z==="전체"?v:v.filter(ne=>ne.requester_name===Z)},fe=B("pending"),he=B("purchase"),Ce=B("receipt"),Se=B("done"),Ht=fe.filter(z=>["pending","대기","",null].includes(z.final_manager_status)),Yt=he.filter(z=>{const Z=z.payment_category==="구매 요청",ne=!z.is_payment_completed;if(!Z||!ne)return!1;const ye=(z.progress_type||"").includes("선진행"),Xt=(z.progress_type||"").includes("일반"),Qt=z.final_manager_status==="approved";return ye||Xt&&Qt}),Ut=Ce.filter(z=>{const Z=!z.is_received,ne=(z.progress_type||"").includes("선진행"),ye=z.final_manager_status==="approved";return Z&&(ne||ye)});return{pending:S(Ht),purchase:S(Yt),receipt:S(Ut),done:S(Se)}},[se,M,V,re,r,ae,G,O]);return n.useEffect(()=>{(async()=>{const{data:{user:w}}=await x.auth.getUser();if(!w)return;const{data:v}=await x.from("user_preferences").select("period_start, period_end").eq("user_id",w.id).single();if(v){const S=v.period_start?new Date(v.period_start).toISOString().split("T")[0]:T,B=v.period_end?new Date(v.period_end).toISOString().split("T")[0]:L;ee(S),J(B)}})()},[]),n.useEffect(()=>{(async()=>{const{data:{user:w}}=await x.auth.getUser();w&&(!M||!V||await x.from("user_preferences").upsert({user_id:w.id,period_start:M,period_end:V,updated_at:new Date().toISOString()}))})()},[M,V]),{activeTab:f,searchTerm:b,vendorFilter:C,dateFromFilter:M,dateToFilter:V,selectedEmployee:A,purchaseNumberFilter:F,itemNameFilter:l,specificationFilter:N,approvalStatusFilter:P,remarkFilter:u,setActiveTab:h,setSearchTerm:c,setVendorFilter:$,setDateFromFilter:ee,setDateToFilter:J,setSelectedEmployee:R,setPurchaseNumberFilter:X,setItemNameFilter:g,setSpecificationFilter:I,setApprovalStatusFilter:p,setRemarkFilter:D,filteredPurchases:q,tabCounts:K}},Sr=t=>{if(!t.items||t.items.length===0)return{received:0,total:0,percentage:0};const s=t.items.length,r=t.items.filter(o=>o.is_received||o.delivery_status==="received").length,a=s>0?Math.round(r/s*100):0;return{received:r,total:s,percentage:a}},st=n.memo(({purchase:t})=>{const s=t.is_received?"completed":t.middle_manager_status==="approved"&&t.final_manager_status==="approved"?"inProgress":t.middle_manager_status==="rejected"||t.final_manager_status==="rejected"?"rejected":"pending",r={completed:{text:"입고완료",className:"bg-green-100 text-green-800"},inProgress:{text:"구매진행",className:"bg-hansl-100 text-hansl-800"},rejected:{text:"반려",className:"bg-red-100 text-red-800"},pending:{text:"승인대기",className:"bg-yellow-100 text-yellow-800"}},{text:a,className:o}=r[s];return e.jsx(H,{className:`${o} text-xs`,children:a})});st.displayName="StatusBadge";const nt=n.memo(({purchase:t,onClick:s})=>{const r=Sr(t),a=t.progress_type==="선진행"||t.progress_type?.includes("선진행");return e.jsxs("div",{className:`bg-white rounded-lg border p-4 space-y-3 cursor-pointer transition-all hover:shadow-md ${a?"border-red-400 bg-red-50 hover:bg-red-100":"hover:bg-gray-50"}`,onClick:()=>s(t),children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[a?e.jsx(H,{className:"bg-red-500 text-white font-bold text-xs px-2 py-0.5",children:"선진행"}):e.jsx(H,{className:"bg-gray-200 text-gray-700 text-xs px-2 py-0.5",children:"일반"}),e.jsx("span",{className:"font-semibold text-sm text-gray-900",children:t.purchase_order_number||"-"})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[Pe(t.request_date)," 요청"]})]}),e.jsx(st,{purchase:t})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"요청자"}),e.jsx("span",{className:"font-medium",children:t.requester_name})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"업체"}),e.jsx("span",{className:"font-medium",children:t.vendor_name})]}),t.project_vendor&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"PJ업체"}),e.jsx("span",{className:"font-medium truncate max-w-[150px]",children:t.project_vendor})]}),t.project_item&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"PJ ITEM"}),e.jsx("span",{className:"font-medium truncate max-w-[150px]",children:t.project_item})]}),t.sales_order_number&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"수주번호"}),e.jsx("span",{className:"font-medium truncate max-w-[150px]",children:t.sales_order_number})]}),t.item_name&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"품목"}),e.jsx("span",{className:"font-medium truncate max-w-[150px]",children:t.item_name})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"금액"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[(t.amount_value||t.total_amount)?.toLocaleString()," ",t.currency]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"입고현황"}),e.jsxs("span",{className:"text-gray-700",children:[r.received,"/",r.total," (",r.percentage,"%)"]})]}),e.jsx("div",{className:"bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${r.percentage===100?"bg-green-500":r.percentage>0?"bg-hansl-500":"bg-gray-300"}`,style:{width:`${r.percentage}%`}})})]}),t.is_payment_completed!==void 0&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"결제"}),t.is_payment_completed?e.jsx(H,{className:"bg-green-100 text-green-800 text-xs",children:"완료"}):e.jsx(H,{className:"bg-gray-100 text-gray-800 text-xs",children:"대기"})]}),e.jsx("div",{className:"pt-2 border-t",children:e.jsxs("div",{className:"flex items-center justify-center text-xs text-gray-500",children:[e.jsx(dr,{className:"w-3 h-3 mr-1"}),"클릭하여 상세보기"]})})]})});nt.displayName="MobilePurchaseCard";function Ve(t){if(!t)return"";const s=new Date(t);return isNaN(s.getTime())?t:`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")}`}function $e(t){return t?["KRW","원","₩"].includes(t)?"₩":["USD","$","달러"].includes(t)?"$":["EUR","€"].includes(t)?"€":["JPY","엔","¥"].includes(t)||["CNY","위안","元"].includes(t)?"¥":t:""}async function kr(t){const s=await Je(()=>import("./exceljs.min-C0ibNCbi.js").then(l=>l.e),__vite__mapDeps([0,1,2])),r=new s.Workbook,a=r.addWorksheet("발주서",{pageSetup:{paperSize:9,orientation:"portrait",fitToPage:!0,fitToWidth:1,fitToHeight:1,horizontalCentered:!0,verticalCentered:!0,margins:{left:.3,right:.3,top:.5,bottom:.5,header:.2,footer:.2}}});a.getRow(1).height=29.8;for(let l=2;l<=60;l++)a.getRow(l).height=15.75;a.getRow(1).eachCell(l=>{l.font={...l.font||{},name:"맑은 고딕",size:20}});for(let l=2;l<=60;l++)a.getRow(l).eachCell(g=>{g.font={...g.font||{},name:"맑은 고딕",size:11}});a.mergeCells("A1:G1"),a.mergeCells("A2:B2"),a.mergeCells("C2:D2"),a.mergeCells("F2:G2"),a.mergeCells("A3:B3"),a.mergeCells("C3:D3"),a.mergeCells("F3:G3"),a.mergeCells("A4:B4"),a.mergeCells("C4:D4"),a.mergeCells("F4:G4"),a.mergeCells("A5:B5"),a.mergeCells("C5:D5"),a.mergeCells("F5:G5"),a.mergeCells("A6:B6"),a.mergeCells("C6:D6"),a.mergeCells("F6:G6"),a.mergeCells("A7:B7"),a.mergeCells("C7:D7"),a.mergeCells("F7:G7");try{const g=await(await fetch("/logo_KOR.png")).arrayBuffer(),N=r.addImage({buffer:g,extension:"png"}),I=a.getColumn("D").width||22,P=Math.max(1,I*7.2*.58)+4,p=34,u=3.5-.5,D=.5-.2;a.addImage(N,{tl:{col:u,row:D},ext:{width:P,height:p}})}catch{}a.getCell("D1").value="                발 주 서",a.getCell("D1").alignment={horizontal:"left",vertical:"middle",indent:1},a.getCell("D1").font={bold:!0,size:20},a.getCell("A2").value="업   체   명",a.getCell("A2").font={bold:!0},a.getCell("A3").value="담   당   자",a.getCell("A3").font={bold:!0},a.getCell("A4").value="청   구   일",a.getCell("A4").font={bold:!0},a.getCell("A5").value="TEL.",a.getCell("A5").font={bold:!0},a.getCell("A6").value="FAX.",a.getCell("A6").font={bold:!0},a.getCell("A7").value="입고요청일",a.getCell("A7").font={bold:!0},a.getCell("E2").value="구매요청자",a.getCell("E2").font={bold:!0},a.getCell("E3").value="주         소",a.getCell("E3").font={bold:!0},a.getCell("E4").value="발 주 번 호",a.getCell("E4").font={bold:!0},a.getCell("E5").value="TEL.",a.getCell("E5").font={bold:!0},a.getCell("E6").value="FAX.",a.getCell("E6").font={bold:!0},a.getCell("E7").value="지출 예정일",a.getCell("E7").font={bold:!0},a.getCell("F7").value=t.vendor_payment_schedule||"",a.getCell("C2").value=t.vendor_name,a.getCell("C3").value=t.vendor_contact_name||"",a.getCell("C4").value=Ve(t.request_date),a.getCell("C5").value=t.vendor_phone||"",a.getCell("C6").value=t.vendor_fax||"",a.getCell("C7").value=Ve(t.delivery_request_date),a.getCell("F2").value=t.requester_name,a.getCell("F3").value="대구광역시 달서구 성서공단북로305",a.getCell("F4").value=t.purchase_order_number,a.getCell("F5").value="(053) 626-7805",a.getCell("F6").value="(053) 657-7905",a.getCell("F5").alignment={horizontal:"center",vertical:"middle"},a.getCell("F6").alignment={horizontal:"center",vertical:"middle"};const o=["No","품명","규격","수량","단가","금액","비고"];for(let l=0;l<o.length;l++)a.getCell(String.fromCharCode(65+l)+"8").value=o[l],a.getCell(String.fromCharCode(65+l)+"8").font={bold:!0},l===6&&(a.getCell("G8").alignment={horizontal:"center",vertical:"middle"});const x=9,f=45,h=[...t.items].sort((l,g)=>l.line_number-g.line_number),b=h.length,c=x+Math.max(b,f);for(let l=0;l<h.length;l++){const g=h[l],N=x+l;a.getCell("A"+N).value=g.line_number;const I=a.getCell("B"+N);I.value=g.item_name,I.alignment={horizontal:"left",vertical:"middle"},a.getCell("C"+N).value=g.specification,a.getCell("C"+N).alignment={horizontal:"left",vertical:"middle"},a.getCell("D"+N).value=g.quantity;const P=$e(g.currency),p=g.unit_price_value!==void 0&&g.unit_price_value!==null?`${g.unit_price_value.toLocaleString()} ${P}`.trim():"";a.getCell("E"+N).value=p,a.getCell("E"+N).alignment={horizontal:"right",vertical:"middle"};const u=$e(g.currency),D=g.amount_value!==void 0&&g.amount_value!==null?`${g.amount_value.toLocaleString()} ${u}`.trim():"";a.getCell("F"+N).value=D,a.getCell("F"+N).alignment={horizontal:"right",vertical:"middle"};const _=a.getCell("G"+N);_.value=g.remark!==void 0&&g.remark!==null?String(g.remark):"",_.alignment={horizontal:"left",vertical:"middle",wrapText:!1,shrinkToFit:!0}}for(let l=b;l<f;l++){const g=x+l;for(let N=0;N<7;N++)a.getCell(String.fromCharCode(65+N)+g).value=""}a.mergeCells(`A${c}:E${c}`),a.getCell("A"+c).value="합계",a.getCell("A"+c).font={bold:!0};const C=$e(t.items[0]?.currency),$=t.items.reduce((l,g)=>l+(g.amount_value||0),0);a.getCell("F"+c).value=`${$.toLocaleString()} ${C}`.trim(),a.getCell("F"+c).alignment={horizontal:"right",vertical:"middle"};const A=c;for(let l=1;l<=A;l++)for(let g=1;g<=7;g++){const I=String.fromCharCode(64+g)+l,P=a.getCell(I),p=g===5||g===6,u=g===3,D=l>=x&&l<c;p&&(D||l===c)||u&&D||(P.alignment={horizontal:"center",vertical:"middle"}),P.border={top:{style:l===1||l===2||l===8||l===c?"medium":"thin"},left:{style:g===1?"medium":"thin"},right:{style:g===7?"medium":"thin"},bottom:{style:l===8||l===c||l===A?"medium":"thin"}}}for(let l=0;l<b;l++){const g=x+l;a.getCell("C"+g).alignment={horizontal:"left",vertical:"middle"}}for(let l=2;l<=7;l++)a.getCell("B"+l).border={...a.getCell("B"+l).border,right:{style:"medium"}},a.getCell("D"+l).border={...a.getCell("D"+l).border,right:{style:"medium"}},l<=6&&(a.getCell("E"+l).border={...a.getCell("E"+l).border,right:{style:"medium"}});a.getCell("E7").border={...a.getCell("E7").border,top:{style:"thin"},right:{style:"medium"}},a.getCell("G7").border={...a.getCell("G7").border,top:{style:"thin"}};for(let l=1;l<=7;l++){const g=a.getCell("A"+l).border||{};a.getCell("A"+l).border={...g,left:{style:"medium"}}}const R=a.getCell("A"+c).border||{};a.getCell("A"+c).border={...R,left:{style:"medium"}},Object.entries({A:4.7,B:23,C:30,D:11,E:15,F:16,G:37}).forEach(([l,g])=>{a.getColumn(l).width=g}),a.getRow(1).height=29.8,a.getRow(1).eachCell(l=>{l.font={...l.font||{},name:"맑은 고딕",size:20}});for(let l=2;l<=A;l++){const g=a.getRow(l);g.height=15.75,g.eachCell(N=>{N.font={...N.font||{},name:"맑은 고딕",size:11}})}for(let l=9;l<=A;l++)a.getCell("G"+l).alignment={horizontal:"left",vertical:"middle",wrapText:!1,shrinkToFit:!0},a.getCell("B"+l).alignment={horizontal:"left",vertical:"middle"};const X=await r.xlsx.writeBuffer();return new Blob([X],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})}var lt="AlertDialog",[$r,qa]=er(lt,[Xe]),le=Xe(),ot=t=>{const{__scopeAlertDialog:s,...r}=t,a=le(s);return e.jsx(Qe,{...a,...r,modal:!0})};ot.displayName=lt;var Dr="AlertDialogTrigger",Ar=n.forwardRef((t,s)=>{const{__scopeAlertDialog:r,...a}=t,o=le(r);return e.jsx(xr,{...o,...a,ref:s})});Ar.displayName=Dr;var Er="AlertDialogPortal",it=t=>{const{__scopeAlertDialog:s,...r}=t,a=le(s);return e.jsx(Ze,{...a,...r})};it.displayName=Er;var Pr="AlertDialogOverlay",ct=n.forwardRef((t,s)=>{const{__scopeAlertDialog:r,...a}=t,o=le(r);return e.jsx(rt,{...o,...a,ref:s})});ct.displayName=Pr;var ge="AlertDialogContent",[Rr,Fr]=$r(ge),Ir=rr("AlertDialogContent"),dt=n.forwardRef((t,s)=>{const{__scopeAlertDialog:r,children:a,...o}=t,x=le(r),f=n.useRef(null),h=He(s,f),b=n.useRef(null);return e.jsx(mr,{contentName:ge,titleName:mt,docsSlug:"alert-dialog",children:e.jsx(Rr,{scope:r,cancelRef:b,children:e.jsxs(et,{role:"alertdialog",...x,...o,ref:h,onOpenAutoFocus:tr(o.onOpenAutoFocus,c=>{c.preventDefault(),b.current?.focus({preventScroll:!0})}),onPointerDownOutside:c=>c.preventDefault(),onInteractOutside:c=>c.preventDefault(),children:[e.jsx(Ir,{children:a}),e.jsx(Mr,{contentRef:f})]})})})});dt.displayName=ge;var mt="AlertDialogTitle",ut=n.forwardRef((t,s)=>{const{__scopeAlertDialog:r,...a}=t,o=le(r);return e.jsx(ur,{...o,...a,ref:s})});ut.displayName=mt;var pt="AlertDialogDescription",xt=n.forwardRef((t,s)=>{const{__scopeAlertDialog:r,...a}=t,o=le(r);return e.jsx(pr,{...o,...a,ref:s})});xt.displayName=pt;var qr="AlertDialogAction",gt=n.forwardRef((t,s)=>{const{__scopeAlertDialog:r,...a}=t,o=le(r);return e.jsx(tt,{...o,...a,ref:s})});gt.displayName=qr;var ft="AlertDialogCancel",ht=n.forwardRef((t,s)=>{const{__scopeAlertDialog:r,...a}=t,{cancelRef:o}=Fr(ft,r),x=le(r),f=He(s,o);return e.jsx(tt,{...x,...a,ref:f})});ht.displayName=ft;var Mr=({contentRef:t})=>{const s=`\`${ge}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${ge}\` by passing a \`${pt}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${ge}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return n.useEffect(()=>{document.getElementById(t.current?.getAttribute("aria-describedby"))||console.warn(s)},[s,t]),null},Or=ot,Lr=it,yt=ct,_t=dt,vt=gt,wt=ht,jt=ut,bt=xt;const Tr=Or,Br=Lr,Nt=n.forwardRef(({className:t,...s},r)=>e.jsx(yt,{className:Y("fixed inset-0 z-50 bg-black/40 backdrop-blur-sm","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s,ref:r}));Nt.displayName=yt.displayName;const Ct=n.forwardRef(({className:t,...s},r)=>e.jsxs(Br,{children:[e.jsx(Nt,{}),e.jsx(_t,{ref:r,className:Y("fixed left-[50%] top-[50%] z-50","w-full max-w-md translate-x-[-50%] translate-y-[-50%]","grid gap-4 bg-white border border-gray-200","rounded-lg p-6 shadow-professional-xl","duration-200","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0","data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95","data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%]","data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%]",t),...s})]}));Ct.displayName=_t.displayName;const St=({className:t,...s})=>e.jsx("div",{className:Y("flex flex-col space-y-2 text-left",t),...s});St.displayName="AlertDialogHeader";const kt=({className:t,...s})=>e.jsx("div",{className:Y("flex flex-col-reverse sm:flex-row sm:justify-end gap-3",t),...s});kt.displayName="AlertDialogFooter";const $t=n.forwardRef(({className:t,...s},r)=>e.jsx(jt,{ref:r,className:Y("text-lg font-semibold text-gray-800 tracking-tight",t),...s}));$t.displayName=jt.displayName;const Dt=n.forwardRef(({className:t,...s},r)=>e.jsx(bt,{ref:r,className:Y("text-sm text-gray-600",t),...s}));Dt.displayName=bt.displayName;const At=n.forwardRef(({className:t,...s},r)=>e.jsx(vt,{ref:r,className:Y(Ye(),t),...s}));At.displayName=vt.displayName;const Et=n.forwardRef(({className:t,...s},r)=>e.jsx(wt,{ref:r,className:Y(Ye({variant:"outline"}),"mt-2 sm:mt-0",t),...s}));Et.displayName=wt.displayName;const Ie=n.memo(({purchase:t})=>{const s=t.is_received?"completed":t.middle_manager_status==="approved"&&t.final_manager_status==="approved"?"inProgress":t.middle_manager_status==="rejected"||t.final_manager_status==="rejected"?"rejected":"pending",r={completed:{text:"입고완료",className:"bg-green-100 text-green-800"},inProgress:{text:"구매진행",className:"bg-hansl-100 text-hansl-800"},rejected:{text:"반려",className:"bg-red-100 text-red-800"},pending:{text:"승인대기",className:"bg-yellow-100 text-yellow-800"}},{text:a,className:o}=r[s];return e.jsx(H,{className:o,children:a})});Ie.displayName="StatusBadge";const oe=t=>!t||["KRW","원","₩"].includes(t)?"₩":["USD","$","달러"].includes(t)?"$":["EUR","€"].includes(t)?"€":["JPY","엔","¥"].includes(t)||["CNY","위안","元"].includes(t)?"¥":t,d={approvalStatus:"text-center w-20 min-w-[85px] max-w-[85px]",purchaseOrderNumber:"pl-2 w-36 min-w-[145px] max-w-[145px]",paymentCategory:"text-center w-20 min-w-[85px] max-w-[85px]",requesterName:"w-16 min-w-[68px] max-w-[68px]",requestDate:"w-20 min-w-[85px] max-w-[85px]",vendorName:"w-28 min-w-[115px] max-w-[115px]",contactName:"w-16 min-w-[68px] max-w-[68px]",deliveryRequestDate:"w-20 min-w-[85px] max-w-[85px]",itemName:"w-28 min-w-[120px] max-w-[120px]",specification:"w-64 min-w-[260px] max-w-[260px]",quantity:"text-center w-14 min-w-[60px] max-w-[60px]",unitPrice:"text-right w-24 min-w-[100px] max-w-[100px]",amount:"text-right w-24 min-w-[100px] max-w-[100px]",remark:"w-28 min-w-[115px] max-w-[115px]",paymentSchedule:"w-24 min-w-[100px] max-w-[100px]",projectVendor:"w-24 min-w-[105px] max-w-[105px]",salesOrderNumber:"w-28 min-w-[115px] max-w-[115px]",projectItem:"w-44 min-w-[180px] max-w-[180px]",receiptProgress:"text-center w-20 min-w-[85px] max-w-[85px]",status:"text-center w-20 min-w-[85px] max-w-[85px]",receipt:"text-center w-16 min-w-[70px] max-w-[70px]",paymentStatus:"text-center w-16 min-w-[70px] max-w-[70px]",link:"w-20 min-w-[85px] max-w-[85px]"},Pt=n.memo(({purchase:t})=>{const s=t.middle_manager_status==="approved",r=t.middle_manager_status==="rejected",a=t.final_manager_status==="approved",o=t.final_manager_status==="rejected";return r||o?e.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[e.jsx("div",{className:"flex items-center gap-0.5",children:e.jsx("div",{className:"w-1.5 h-1.5 bg-red-500 rounded-full animate-pulse"})}),e.jsx(H,{className:"bg-red-100 text-red-800 text-[11px] font-medium px-1.5 py-0",children:"반려"})]}):s&&a?e.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[e.jsx("div",{className:"flex items-center gap-0.5",children:e.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"})}),e.jsx(H,{className:"bg-green-100 text-green-800 text-[11px] font-medium px-1.5 py-0",children:"승인완료"})]}):s&&!a&&!o?e.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),e.jsx("div",{className:"w-3 h-0.5 bg-gray-300"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full"})]}),e.jsx(H,{className:"bg-yellow-100 text-yellow-800 text-[11px] font-medium px-1.5 py-0",children:"1차 승인"})]}):e.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full"}),e.jsx("div",{className:"w-3 h-0.5 bg-gray-300"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full"})]}),e.jsx(H,{className:"bg-gray-100 text-gray-600 text-[11px] font-medium px-1.5 py-0",children:"승인대기"})]})});Pt.displayName="ApprovalStatusBadge";const zr=t=>{if(t.is_received)return{received:1,total:1,percentage:100};if(!t.items||t.items.length===0)return{received:0,total:1,percentage:0};const s=t.items.length,r=t.items.filter(o=>o.is_received===!0).length,a=s>0?Math.round(r/s*100):0;return{received:r,total:s,percentage:a}},Vr=t=>{if(t.is_payment_completed)return{completed:1,total:1,percentage:100};if(!t.items||t.items.length===0)return{completed:0,total:1,percentage:0};const s=t.items.length,r=t.items.filter(o=>o.is_payment_completed===!0).length,a=s>0?Math.round(r/s*100):0;return{completed:r,total:s,percentage:a}},Wr=n.memo(({type:t})=>t==="선진행"||t?.includes("선진행")?e.jsx(H,{className:"bg-red-500 text-white font-bold text-[11px] px-2 py-0.5",children:"선진행"}):e.jsx(H,{className:"bg-gray-200 text-gray-700 text-[11px] px-2 py-0.5",children:"일반"}));Wr.displayName="ProgressTypeBadge";const Rt=n.memo(({purchase:t,onClick:s,activeTab:r,isLeadBuyer:a,onPaymentComplete:o,onReceiptComplete:x,onExcelDownload:f})=>{const h=zr(t),b=Vr(t),c=t.progress_type==="선진행"||t.progress_type?.includes("선진행");return e.jsxs("tr",{className:`border-b hover:bg-gray-100 cursor-pointer transition-colors ${c?"bg-red-50 hover:bg-red-100":""}`,onClick:()=>s(t),children:[r==="pending"&&e.jsx("td",{className:`px-2 py-1.5 whitespace-nowrap ${d.approvalStatus}`,children:e.jsx(Pt,{purchase:t})}),r==="purchase"&&e.jsx("td",{className:`px-2 py-1.5 ${d.receiptProgress}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:e.jsx("div",{className:`h-1.5 rounded-full ${b.percentage===100?"bg-blue-500":b.percentage>0?"bg-blue-400":"bg-gray-300"}`,style:{width:`${b.percentage}%`}})}),e.jsxs("span",{className:"text-[11px] text-gray-600",children:[b.percentage,"%"]})]})}),r==="receipt"&&e.jsx("td",{className:`px-2 py-1.5 ${d.receiptProgress}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:e.jsx("div",{className:`h-1.5 rounded-full ${h.percentage===100?"bg-green-500":h.percentage>0?"bg-hansl-500":"bg-gray-300"}`,style:{width:`${h.percentage}%`}})}),e.jsxs("span",{className:"text-[11px] text-gray-600",children:[h.percentage,"%"]})]})}),e.jsx("td",{className:`px-2 py-1.5 font-medium text-[11px] whitespace-nowrap ${d.purchaseOrderNumber}`,children:e.jsxs("div",{className:"flex items-center gap-1",children:[f&&e.jsx("img",{src:"/excels-icon.svg",alt:"엑셀 다운로드",width:"16",height:"16",className:`inline-block align-middle transition-transform p-0.5 rounded
                ${t.is_po_download?"border border-gray-400":""}
                ${t.progress_type==="선진행"||t.progress_type?.includes("선진행")||t.middle_manager_status==="approved"&&t.final_manager_status==="approved"?t.is_po_download?"cursor-pointer":"cursor-pointer hover:scale-110":"opacity-40 grayscale cursor-not-allowed"}`,onClick:async C=>{(t.progress_type==="선진행"||t.progress_type?.includes("선진행")||t.middle_manager_status==="approved"&&t.final_manager_status==="approved")&&(C.stopPropagation(),await f(t))},style:{pointerEvents:t.progress_type==="선진행"||t.progress_type?.includes("선진행")||t.middle_manager_status==="approved"&&t.final_manager_status==="approved"?"auto":"none"},title:t.is_po_download?"다운로드 완료":"엑셀 발주서 다운로드"}),e.jsx("span",{className:"block truncate",title:t.purchase_order_number||"",children:t.purchase_order_number||"-"})]})}),(r==="pending"||r==="receipt"||r==="done"||!r)&&e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${d.paymentCategory}`,children:e.jsx(H,{className:`text-[11px] ${t.payment_category==="구매 요청"?"bg-blue-100 text-blue-800":t.payment_category==="발주"?"bg-green-100 text-green-800":t.payment_category==="경비 청구"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:t.payment_category==="구매 요청"?"구매요청":t.payment_category==="발주"?"발주요청":t.payment_category||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${d.requesterName}`,children:e.jsx("span",{className:"block truncate",title:t.requester_name||"",children:t.requester_name||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${d.requestDate}`,children:Pe(t.request_date)}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${d.vendorName}`,children:e.jsx("span",{className:"block truncate",title:t.vendor_name||"",children:t.vendor_name||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${d.contactName}`,children:e.jsx("span",{className:"block truncate",title:t.contact_name||"",children:t.contact_name||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${d.deliveryRequestDate}`,children:Pe(t.delivery_request_date)}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${d.itemName}`,children:e.jsx("span",{className:"block truncate",title:t.item_name||"",children:t.item_name||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${d.specification}`,children:e.jsx("span",{className:"block truncate",title:t.specification||"",children:t.specification||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${d.quantity}`,children:t.quantity||0}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${d.unitPrice}`,children:t.unit_price_value?`${t.unit_price_value.toLocaleString()} ${oe(t.currency||"KRW")}`:`0 ${oe(t.currency||"KRW")}`}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] font-medium whitespace-nowrap ${d.amount}`,children:t.amount_value?`${t.amount_value.toLocaleString()} ${oe(t.currency||"KRW")}`:t.total_amount?`${t.total_amount.toLocaleString()} ${oe(t.currency||"KRW")}`:`0 ${oe(t.currency||"KRW")}`}),r==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${d.remark}`,children:e.jsx("span",{className:"block truncate",title:t.remark||"",children:t.remark||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${d.projectVendor}`,children:e.jsx("span",{className:"block truncate",title:t.project_vendor||"",children:t.project_vendor||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${d.projectItem}`,children:e.jsx("span",{className:"block truncate",title:t.project_item||"",children:t.project_item||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${d.salesOrderNumber}`,children:e.jsx("span",{className:"block truncate",title:t.sales_order_number||"",children:t.sales_order_number||"-"})})]}),r==="purchase"&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${d.remark}`,children:e.jsx("span",{className:"block truncate",title:t.remark||"",children:t.remark||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${d.link}`,children:t.link?e.jsx("a",{href:t.link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline truncate block",title:t.link,children:"링크 보기"}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${d.paymentSchedule}`,children:e.jsx("span",{className:"block truncate",title:t.vendor_payment_schedule||"",children:t.vendor_payment_schedule||"-"})})]}),r==="receipt"&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${d.remark}`,children:e.jsx("span",{className:"block truncate",title:t.remark||"",children:t.remark||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${d.projectVendor}`,children:e.jsx("span",{className:"block truncate",title:t.project_vendor||"",children:t.project_vendor||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${d.projectItem}`,children:e.jsx("span",{className:"block truncate",title:t.project_item||"",children:t.project_item||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${d.salesOrderNumber}`,children:e.jsx("span",{className:"block truncate",title:t.sales_order_number||"",children:t.sales_order_number||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${d.paymentSchedule}`,children:e.jsx("span",{className:"block truncate",title:t.vendor_payment_schedule||"",children:t.vendor_payment_schedule||"-"})})]}),(r==="done"||!r)&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${d.remark}`,children:e.jsx("span",{className:"block truncate",title:t.remark||"",children:t.remark||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${d.link}`,children:t.link?e.jsx("a",{href:t.link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline truncate block",title:t.link,children:"링크 보기"}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${d.projectVendor}`,children:e.jsx("span",{className:"block truncate",title:t.project_vendor||"",children:t.project_vendor||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] ${d.projectItem}`,children:e.jsx("span",{className:"block truncate",title:t.project_item||"",children:t.project_item||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${d.salesOrderNumber}`,children:e.jsx("span",{className:"block truncate",title:t.sales_order_number||"",children:t.sales_order_number||"-"})}),e.jsx("td",{className:`px-2 py-1.5 text-[11px] whitespace-nowrap ${d.paymentSchedule}`,children:e.jsx("span",{className:"block truncate",title:t.vendor_payment_schedule||"",children:t.vendor_payment_schedule||"-"})}),e.jsx("td",{className:`px-2 py-1.5 ${d.status}`,children:e.jsx(Ie,{purchase:t})}),e.jsx("td",{className:`px-2 py-1.5 ${d.receipt}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:e.jsx("div",{className:`h-1.5 rounded-full ${h.percentage===100?"bg-green-500":h.percentage>0?"bg-hansl-500":"bg-gray-300"}`,style:{width:`${h.percentage}%`}})}),e.jsxs("span",{className:"text-[11px] text-gray-600",children:[h.percentage,"%"]})]})}),e.jsx("td",{className:`px-2 py-1.5 ${d.paymentStatus}`,children:t.is_payment_completed?e.jsx(H,{className:"bg-green-100 text-green-800 text-[11px]",children:"완료"}):e.jsx(H,{className:"bg-gray-100 text-gray-800 text-[11px]",children:"대기"})})]})]})});Rt.displayName="TableRow";const Ft=n.memo(({purchases:t,activeTab:s="done",currentUserRoles:r=[],onRefresh:a,onPaymentComplete:o,onReceiptComplete:x})=>{const[f,h]=n.useState(null),[b,c]=n.useState(!1),[C,$]=n.useState(!1),[A,R]=n.useState(null),F=be(),X=r&&(r.includes("lead buyer")||r.includes("app_admin"));r.includes("final_approver")||r.includes("app_admin")||r.includes("ceo");const l=p=>{h(p.id),c(!0)},g=()=>{c(!1),h(null)},N=async p=>{try{const{data:u,error:D}=await F.from("purchase_requests").select("*").eq("purchase_order_number",p.purchase_order_number).single();if(D||!u){te.error("해당 발주요청번호의 데이터를 찾을 수 없습니다.");return}const{data:_,error:T}=await F.from("purchase_request_items").select("*").eq("purchase_order_number",p.purchase_order_number).order("line_number");if(T||!_||_.length===0){te.error("해당 발주요청번호의 품목 데이터를 찾을 수 없습니다.");return}const L={vendor_name:p.vendor_name,vendor_phone:"",vendor_fax:"",vendor_contact_name:"",vendor_payment_schedule:""};try{const O=u.vendor_id||p.vendor_id,Q=u.contact_id||p.contact_id;if(O){const{data:G}=await F.from("vendors").select("vendor_phone, vendor_fax, vendor_payment_schedule").eq("id",O).single();G&&(L.vendor_phone=G.vendor_phone||"",L.vendor_fax=G.vendor_fax||"",L.vendor_payment_schedule=G.vendor_payment_schedule||"")}if(Q){const{data:G}=await F.from("vendor_contacts").select("contact_name, contact_phone, contact_email").eq("id",Q).single();G&&(L.vendor_contact_name=G.contact_name||"")}}catch{}const M={purchase_order_number:u.purchase_order_number||"",request_date:u.request_date,delivery_request_date:u.delivery_request_date,requester_name:u.requester_name,vendor_name:L.vendor_name||"",vendor_contact_name:L.vendor_contact_name,vendor_phone:L.vendor_phone,vendor_fax:L.vendor_fax,project_vendor:u.project_vendor,sales_order_number:u.sales_order_number,project_item:u.project_item,vendor_payment_schedule:L.vendor_payment_schedule,items:_.map(O=>({line_number:O.line_number,item_name:O.item_name,specification:O.specification,quantity:O.quantity,unit_price_value:O.unit_price_value,amount_value:O.amount_value,remark:O.remark,currency:u.currency||"KRW"}))},ee=await kr(M),V=`발주서_${M.vendor_name}_${M.purchase_order_number}.xlsx`,J=window.URL.createObjectURL(ee),W=document.createElement("a");W.href=J,W.download=V,document.body.appendChild(W),W.click(),document.body.removeChild(W),window.URL.revokeObjectURL(J),te.success("엑셀 파일이 다운로드되었습니다.");try{if(r&&r.includes("lead buyer")){const{error:Q}=await F.from("purchase_requests").update({is_po_download:!0}).eq("purchase_order_number",p.purchase_order_number);Q||a?.()}}catch{}}catch{te.error("엑셀 다운로드에 실패했습니다.")}},I=async()=>{if(A){try{const{error:p}=await F.from("purchase_request_items").delete().eq("purchase_request_id",A.id);if(p)throw p;const{error:u}=await F.from("purchase_requests").delete().eq("id",A.id);if(u)throw u;te.success("발주요청 내역이 삭제되었습니다."),a?.()}catch{te.error("삭제 중 오류가 발생했습니다.")}$(!1),R(null)}},P=n.useMemo(()=>{if(s==="pending")return e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${d.approvalStatus}`,children:"승인상태"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${d.purchaseOrderNumber}`,children:"발주번호"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${d.paymentCategory}`,children:"결제종류"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${d.requesterName}`,children:"요청자"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${d.requestDate}`,children:"청구일"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] text-left ${d.vendorName}`,children:"업체"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${d.contactName}`,children:"담당자"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${d.deliveryRequestDate}`,children:"입고요청일"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] text-left ${d.itemName}`,children:"품명"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] text-left ${d.specification}`,children:"규격"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${d.quantity}`,children:"수량"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${d.unitPrice}`,children:"단가"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${d.amount}`,children:"합계"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${d.remark}`,children:"비고"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${d.projectVendor}`,children:"PJ업체"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${d.projectItem}`,children:"PJ ITEM"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${d.salesOrderNumber}`,children:"수주번호"})]})});const p=e.jsxs(e.Fragment,{children:[e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${d.purchaseOrderNumber}`,children:"발주번호"}),(s==="receipt"||s==="done"||!s)&&e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${d.paymentCategory}`,children:"결제종류"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${d.requesterName}`,children:"요청자"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${d.requestDate}`,children:"청구일"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${d.vendorName}`,children:"업체"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${d.contactName}`,children:"담당자"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${d.deliveryRequestDate}`,children:"입고요청일"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] text-left ${d.itemName}`,children:"품명"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] text-left ${d.specification}`,children:"규격"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${d.quantity}`,children:"수량"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${d.unitPrice}`,children:"단가"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${d.amount}`,children:"합계"})]});let u=null;return s==="purchase"?u=e.jsxs(e.Fragment,{children:[e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${d.remark}`,children:"비고"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${d.link}`,children:"링크"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${d.paymentSchedule}`,children:"지출예정일"})]}):s==="receipt"?u=e.jsxs(e.Fragment,{children:[e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${d.remark}`,children:"비고"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${d.projectVendor}`,children:"PJ업체"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${d.projectItem}`,children:"PJ ITEM"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${d.salesOrderNumber}`,children:"수주번호"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${d.paymentSchedule}`,children:"지출예정일"})]}):u=e.jsxs(e.Fragment,{children:[e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${d.remark}`,children:"비고"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${d.link}`,children:"링크"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${d.projectVendor}`,children:"PJ업체"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${d.projectItem}`,children:"PJ ITEM"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${d.salesOrderNumber}`,children:"수주번호"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap text-left ${d.paymentSchedule}`,children:"지출예정일"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${d.status}`,children:"상태"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${d.receipt}`,children:"입고"}),e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${d.paymentStatus}`,children:"결제"})]}),e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[s==="purchase"&&e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${d.receiptProgress}`,children:"구매진행"}),s==="receipt"&&e.jsx("th",{className:`px-2 py-1.5 font-medium text-gray-900 text-[11px] whitespace-nowrap ${d.receiptProgress}`,children:"입고진행"}),p,u]})})},[s]);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:block w-full",children:e.jsx("div",{className:"overflow-x-auto border rounded-lg",children:e.jsxs("table",{className:"w-full min-w-[1760px]",children:[P,e.jsx("tbody",{children:t.map(p=>e.jsx(Rt,{purchase:p,onClick:l,activeTab:s,isLeadBuyer:X,onPaymentComplete:o,onReceiptComplete:x,onExcelDownload:N},p.id))})]})})}),e.jsx("div",{className:"hidden sm:block md:hidden w-full",children:e.jsx("div",{className:"overflow-x-auto border rounded-lg",children:e.jsxs("table",{className:"w-full min-w-[600px] text-[11px]",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-2 font-medium text-gray-900 w-24",children:"발주번호"}),e.jsx("th",{className:"text-left p-2 font-medium text-gray-900 w-16",children:"요청자"}),e.jsx("th",{className:"text-left p-2 font-medium text-gray-900 w-20",children:"업체"}),e.jsx("th",{className:"text-left p-2 font-medium text-gray-900 w-32",children:"품명"}),e.jsx("th",{className:"text-right p-2 font-medium text-gray-900 w-20",children:"금액"}),e.jsx("th",{className:"text-center p-2 font-medium text-gray-900 w-16",children:"상태"})]})}),e.jsx("tbody",{children:t.map(p=>e.jsxs("tr",{className:"border-b hover:bg-gray-50 cursor-pointer",onClick:()=>l(p),children:[e.jsx("td",{className:"p-2 font-medium",children:p.purchase_order_number||"-"}),e.jsx("td",{className:"p-2",children:p.requester_name}),e.jsx("td",{className:"p-2 truncate",title:p.vendor_name,children:p.vendor_name}),e.jsx("td",{className:"p-2 truncate",title:p.item_name,children:p.item_name||"-"}),e.jsx("td",{className:"p-2 text-right font-medium",children:p.amount_value?`${p.amount_value.toLocaleString()} ${oe(p.currency||"KRW")}`:p.total_amount?`${p.total_amount.toLocaleString()} ${oe(p.currency||"KRW")}`:`0 ${oe(p.currency||"KRW")}`}),e.jsx("td",{className:"p-2 text-center",children:e.jsx(Ie,{purchase:p})})]},p.id))})]})})}),e.jsx("div",{className:"sm:hidden space-y-3",children:t.map(p=>e.jsx(nt,{purchase:p,onClick:()=>l(p)},p.id))}),e.jsx(nr,{purchaseId:f,isOpen:b,onClose:g,currentUserRoles:r,activeTab:s,onRefresh:a,onDelete:p=>{R(p),$(!0)}}),e.jsx(Tr,{open:C,onOpenChange:$,children:e.jsxs(Ct,{children:[e.jsxs(St,{children:[e.jsx($t,{children:"발주요청 내역 삭제"}),e.jsxs(Dt,{children:["발주요청번호 ",A?.purchase_order_number,"를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."]})]}),e.jsxs(kt,{children:[e.jsx(Et,{children:"취소"}),e.jsx(At,{onClick:I,className:"bg-red-600 hover:bg-red-700",children:"삭제"})]})]})})]})});Ft.displayName="FastPurchaseTable";var We=1,Gr=.9,Kr=.8,Jr=.17,De=.1,Ae=.999,Hr=.9999,Yr=.99,Ur=/[\\\/_+.#"@\[\(\{&]/,Xr=/[\\\/_+.#"@\[\(\{&]/g,Qr=/[\s-]/,It=/[\s-]/g;function Re(t,s,r,a,o,x,f){if(x===s.length)return o===t.length?We:Yr;var h=`${o},${x}`;if(f[h]!==void 0)return f[h];for(var b=a.charAt(x),c=r.indexOf(b,o),C=0,$,A,R,F;c>=0;)$=Re(t,s,r,a,c+1,x+1,f),$>C&&(c===o?$*=We:Ur.test(t.charAt(c-1))?($*=Kr,R=t.slice(o,c-1).match(Xr),R&&o>0&&($*=Math.pow(Ae,R.length))):Qr.test(t.charAt(c-1))?($*=Gr,F=t.slice(o,c-1).match(It),F&&o>0&&($*=Math.pow(Ae,F.length))):($*=Jr,o>0&&($*=Math.pow(Ae,c-o))),t.charAt(c)!==s.charAt(x)&&($*=Hr)),($<De&&r.charAt(c-1)===a.charAt(x+1)||a.charAt(x+1)===a.charAt(x)&&r.charAt(c-1)!==a.charAt(x))&&(A=Re(t,s,r,a,c+1,x+2,f),A*De>$&&($=A*De)),$>C&&(C=$),c=r.indexOf(b,c+1);return f[h]=C,C}function Ge(t){return t.toLowerCase().replace(It," ")}function Zr(t,s,r){return t=r&&r.length>0?`${t+" "+r.join(" ")}`:t,Re(t,s,Ge(t),Ge(s),0,0,{})}var ve='[cmdk-group=""]',Ee='[cmdk-group-items=""]',ea='[cmdk-group-heading=""]',qt='[cmdk-item=""]',Ke=`${qt}:not([aria-disabled="true"])`,Fe="cmdk-item-select",ue="data-value",ta=(t,s,r)=>Zr(t,s,r),Mt=n.createContext(void 0),je=()=>n.useContext(Mt),Ot=n.createContext(void 0),qe=()=>n.useContext(Ot),Lt=n.createContext(void 0),Tt=n.forwardRef((t,s)=>{let r=pe(()=>{var i,j;return{search:"",value:(j=(i=t.value)!=null?i:t.defaultValue)!=null?j:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),a=pe(()=>new Set),o=pe(()=>new Map),x=pe(()=>new Map),f=pe(()=>new Set),h=Bt(t),{label:b,children:c,value:C,onValueChange:$,filter:A,shouldFilter:R,loop:F,disablePointerSelection:X=!1,vimBindings:l=!0,...g}=t,N=xe(),I=xe(),P=xe(),p=n.useRef(null),u=ua();de(()=>{if(C!==void 0){let i=C.trim();r.current.value=i,D.emit()}},[C]),de(()=>{u(6,V)},[]);let D=n.useMemo(()=>({subscribe:i=>(f.current.add(i),()=>f.current.delete(i)),snapshot:()=>r.current,setState:(i,j,k)=>{var y,E,m,q;if(!Object.is(r.current[i],j)){if(r.current[i]=j,i==="search")ee(),L(),u(1,M);else if(i==="value"){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let K=document.getElementById(P);K?K.focus():(y=document.getElementById(N))==null||y.focus()}if(u(7,()=>{var K;r.current.selectedItemId=(K=J())==null?void 0:K.id,D.emit()}),k||u(5,V),((E=h.current)==null?void 0:E.value)!==void 0){let K=j??"";(q=(m=h.current).onValueChange)==null||q.call(m,K);return}}D.emit()}},emit:()=>{f.current.forEach(i=>i())}}),[]),_=n.useMemo(()=>({value:(i,j,k)=>{var y;j!==((y=x.current.get(i))==null?void 0:y.value)&&(x.current.set(i,{value:j,keywords:k}),r.current.filtered.items.set(i,T(j,k)),u(2,()=>{L(),D.emit()}))},item:(i,j)=>(a.current.add(i),j&&(o.current.has(j)?o.current.get(j).add(i):o.current.set(j,new Set([i]))),u(3,()=>{ee(),L(),r.current.value||M(),D.emit()}),()=>{x.current.delete(i),a.current.delete(i),r.current.filtered.items.delete(i);let k=J();u(4,()=>{ee(),k?.getAttribute("id")===i&&M(),D.emit()})}),group:i=>(o.current.has(i)||o.current.set(i,new Set),()=>{x.current.delete(i),o.current.delete(i)}),filter:()=>h.current.shouldFilter,label:b||t["aria-label"],getDisablePointerSelection:()=>h.current.disablePointerSelection,listId:N,inputId:P,labelId:I,listInnerRef:p}),[]);function T(i,j){var k,y;let E=(y=(k=h.current)==null?void 0:k.filter)!=null?y:ta;return i?E(i,r.current.search,j):0}function L(){if(!r.current.search||h.current.shouldFilter===!1)return;let i=r.current.filtered.items,j=[];r.current.filtered.groups.forEach(y=>{let E=o.current.get(y),m=0;E.forEach(q=>{let K=i.get(q);m=Math.max(K,m)}),j.push([y,m])});let k=p.current;W().sort((y,E)=>{var m,q;let K=y.getAttribute("id"),w=E.getAttribute("id");return((m=i.get(w))!=null?m:0)-((q=i.get(K))!=null?q:0)}).forEach(y=>{let E=y.closest(Ee);E?E.appendChild(y.parentElement===E?y:y.closest(`${Ee} > *`)):k.appendChild(y.parentElement===k?y:y.closest(`${Ee} > *`))}),j.sort((y,E)=>E[1]-y[1]).forEach(y=>{var E;let m=(E=p.current)==null?void 0:E.querySelector(`${ve}[${ue}="${encodeURIComponent(y[0])}"]`);m?.parentElement.appendChild(m)})}function M(){let i=W().find(k=>k.getAttribute("aria-disabled")!=="true"),j=i?.getAttribute(ue);D.setState("value",j||void 0)}function ee(){var i,j,k,y;if(!r.current.search||h.current.shouldFilter===!1){r.current.filtered.count=a.current.size;return}r.current.filtered.groups=new Set;let E=0;for(let m of a.current){let q=(j=(i=x.current.get(m))==null?void 0:i.value)!=null?j:"",K=(y=(k=x.current.get(m))==null?void 0:k.keywords)!=null?y:[],w=T(q,K);r.current.filtered.items.set(m,w),w>0&&E++}for(let[m,q]of o.current)for(let K of q)if(r.current.filtered.items.get(K)>0){r.current.filtered.groups.add(m);break}r.current.filtered.count=E}function V(){var i,j,k;let y=J();y&&(((i=y.parentElement)==null?void 0:i.firstChild)===y&&((k=(j=y.closest(ve))==null?void 0:j.querySelector(ea))==null||k.scrollIntoView({block:"nearest"})),y.scrollIntoView({block:"nearest"}))}function J(){var i;return(i=p.current)==null?void 0:i.querySelector(`${qt}[aria-selected="true"]`)}function W(){var i;return Array.from(((i=p.current)==null?void 0:i.querySelectorAll(Ke))||[])}function O(i){let j=W()[i];j&&D.setState("value",j.getAttribute(ue))}function Q(i){var j;let k=J(),y=W(),E=y.findIndex(q=>q===k),m=y[E+i];(j=h.current)!=null&&j.loop&&(m=E+i<0?y[y.length-1]:E+i===y.length?y[0]:y[E+i]),m&&D.setState("value",m.getAttribute(ue))}function G(i){let j=J(),k=j?.closest(ve),y;for(;k&&!y;)k=i>0?da(k,ve):ma(k,ve),y=k?.querySelector(Ke);y?D.setState("value",y.getAttribute(ue)):Q(i)}let re=()=>O(W().length-1),ae=i=>{i.preventDefault(),i.metaKey?re():i.altKey?G(1):Q(1)},se=i=>{i.preventDefault(),i.metaKey?O(0):i.altKey?G(-1):Q(-1)};return n.createElement(ce.div,{ref:s,tabIndex:-1,...g,"cmdk-root":"",onKeyDown:i=>{var j;(j=g.onKeyDown)==null||j.call(g,i);let k=i.nativeEvent.isComposing||i.keyCode===229;if(!(i.defaultPrevented||k))switch(i.key){case"n":case"j":{l&&i.ctrlKey&&ae(i);break}case"ArrowDown":{ae(i);break}case"p":case"k":{l&&i.ctrlKey&&se(i);break}case"ArrowUp":{se(i);break}case"Home":{i.preventDefault(),O(0);break}case"End":{i.preventDefault(),re();break}case"Enter":{i.preventDefault();let y=J();if(y){let E=new Event(Fe);y.dispatchEvent(E)}}}}},n.createElement("label",{"cmdk-label":"",htmlFor:_.inputId,id:_.labelId,style:xa},b),Ne(t,i=>n.createElement(Ot.Provider,{value:D},n.createElement(Mt.Provider,{value:_},i))))}),ra=n.forwardRef((t,s)=>{var r,a;let o=xe(),x=n.useRef(null),f=n.useContext(Lt),h=je(),b=Bt(t),c=(a=(r=b.current)==null?void 0:r.forceMount)!=null?a:f?.forceMount;de(()=>{if(!c)return h.item(o,f?.id)},[c]);let C=zt(o,x,[t.value,t.children,x],t.keywords),$=qe(),A=ie(u=>u.value&&u.value===C.current),R=ie(u=>c||h.filter()===!1?!0:u.search?u.filtered.items.get(o)>0:!0);n.useEffect(()=>{let u=x.current;if(!(!u||t.disabled))return u.addEventListener(Fe,F),()=>u.removeEventListener(Fe,F)},[R,t.onSelect,t.disabled]);function F(){var u,D;X(),(D=(u=b.current).onSelect)==null||D.call(u,C.current)}function X(){$.setState("value",C.current,!0)}if(!R)return null;let{disabled:l,value:g,onSelect:N,forceMount:I,keywords:P,...p}=t;return n.createElement(ce.div,{ref:we(x,s),...p,id:o,"cmdk-item":"",role:"option","aria-disabled":!!l,"aria-selected":!!A,"data-disabled":!!l,"data-selected":!!A,onPointerMove:l||h.getDisablePointerSelection()?void 0:X,onClick:l?void 0:F},t.children)}),aa=n.forwardRef((t,s)=>{let{heading:r,children:a,forceMount:o,...x}=t,f=xe(),h=n.useRef(null),b=n.useRef(null),c=xe(),C=je(),$=ie(R=>o||C.filter()===!1?!0:R.search?R.filtered.groups.has(f):!0);de(()=>C.group(f),[]),zt(f,h,[t.value,t.heading,b]);let A=n.useMemo(()=>({id:f,forceMount:o}),[o]);return n.createElement(ce.div,{ref:we(h,s),...x,"cmdk-group":"",role:"presentation",hidden:$?void 0:!0},r&&n.createElement("div",{ref:b,"cmdk-group-heading":"","aria-hidden":!0,id:c},r),Ne(t,R=>n.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":r?c:void 0},n.createElement(Lt.Provider,{value:A},R))))}),sa=n.forwardRef((t,s)=>{let{alwaysRender:r,...a}=t,o=n.useRef(null),x=ie(f=>!f.search);return!r&&!x?null:n.createElement(ce.div,{ref:we(o,s),...a,"cmdk-separator":"",role:"separator"})}),na=n.forwardRef((t,s)=>{let{onValueChange:r,...a}=t,o=t.value!=null,x=qe(),f=ie(c=>c.search),h=ie(c=>c.selectedItemId),b=je();return n.useEffect(()=>{t.value!=null&&x.setState("search",t.value)},[t.value]),n.createElement(ce.input,{ref:s,...a,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":b.listId,"aria-labelledby":b.labelId,"aria-activedescendant":h,id:b.inputId,type:"text",value:o?t.value:f,onChange:c=>{o||x.setState("search",c.target.value),r?.(c.target.value)}})}),la=n.forwardRef((t,s)=>{let{children:r,label:a="Suggestions",...o}=t,x=n.useRef(null),f=n.useRef(null),h=ie(c=>c.selectedItemId),b=je();return n.useEffect(()=>{if(f.current&&x.current){let c=f.current,C=x.current,$,A=new ResizeObserver(()=>{$=requestAnimationFrame(()=>{let R=c.offsetHeight;C.style.setProperty("--cmdk-list-height",R.toFixed(1)+"px")})});return A.observe(c),()=>{cancelAnimationFrame($),A.unobserve(c)}}},[]),n.createElement(ce.div,{ref:we(x,s),...o,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":h,"aria-label":a,id:b.listId},Ne(t,c=>n.createElement("div",{ref:we(f,b.listInnerRef),"cmdk-list-sizer":""},c)))}),oa=n.forwardRef((t,s)=>{let{open:r,onOpenChange:a,overlayClassName:o,contentClassName:x,container:f,...h}=t;return n.createElement(Qe,{open:r,onOpenChange:a},n.createElement(Ze,{container:f},n.createElement(rt,{"cmdk-overlay":"",className:o}),n.createElement(et,{"aria-label":t.label,"cmdk-dialog":"",className:x},n.createElement(Tt,{ref:s,...h}))))}),ia=n.forwardRef((t,s)=>ie(r=>r.filtered.count===0)?n.createElement(ce.div,{ref:s,...t,"cmdk-empty":"",role:"presentation"}):null),ca=n.forwardRef((t,s)=>{let{progress:r,children:a,label:o="Loading...",...x}=t;return n.createElement(ce.div,{ref:s,...x,"cmdk-loading":"",role:"progressbar","aria-valuenow":r,"aria-valuemin":0,"aria-valuemax":100,"aria-label":o},Ne(t,f=>n.createElement("div",{"aria-hidden":!0},f)))}),U=Object.assign(Tt,{List:la,Item:ra,Input:na,Group:aa,Separator:sa,Dialog:oa,Empty:ia,Loading:ca});function da(t,s){let r=t.nextElementSibling;for(;r;){if(r.matches(s))return r;r=r.nextElementSibling}}function ma(t,s){let r=t.previousElementSibling;for(;r;){if(r.matches(s))return r;r=r.previousElementSibling}}function Bt(t){let s=n.useRef(t);return de(()=>{s.current=t}),s}var de=typeof window>"u"?n.useEffect:n.useLayoutEffect;function pe(t){let s=n.useRef();return s.current===void 0&&(s.current=t()),s}function ie(t){let s=qe(),r=()=>t(s.snapshot());return n.useSyncExternalStore(s.subscribe,r,r)}function zt(t,s,r,a=[]){let o=n.useRef(),x=je();return de(()=>{var f;let h=(()=>{var c;for(let C of r){if(typeof C=="string")return C.trim();if(typeof C=="object"&&"current"in C)return C.current?(c=C.current.textContent)==null?void 0:c.trim():o.current}})(),b=a.map(c=>c.trim());x.value(t,h,b),(f=s.current)==null||f.setAttribute(ue,h),o.current=h}),o}var ua=()=>{let[t,s]=n.useState(),r=pe(()=>new Map);return de(()=>{r.current.forEach(a=>a()),r.current=new Map},[t]),(a,o)=>{r.current.set(a,o),s({})}};function pa(t){let s=t.type;return typeof s=="function"?s(t.props):"render"in s?s.render(t.props):t}function Ne({asChild:t,children:s},r){return t&&n.isValidElement(s)?n.cloneElement(pa(s),{ref:s.ref},r(s.props.children)):r(s)}var xa={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const Vt=n.forwardRef(({className:t,...s},r)=>e.jsx(U,{ref:r,className:Y("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",t),...s}));Vt.displayName=U.displayName;const Wt=n.forwardRef(({className:t,...s},r)=>e.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[e.jsx(at,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),e.jsx(U.Input,{ref:r,className:Y("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",t),...s})]}));Wt.displayName=U.Input.displayName;const ga=n.forwardRef(({className:t,...s},r)=>e.jsx(U.List,{ref:r,className:Y("max-h-[300px] overflow-y-auto overflow-x-hidden",t),...s}));ga.displayName=U.List.displayName;const Gt=n.forwardRef((t,s)=>e.jsx(U.Empty,{ref:s,className:"py-6 text-center text-sm",...t}));Gt.displayName=U.Empty.displayName;const Kt=n.forwardRef(({className:t,...s},r)=>e.jsx(U.Group,{ref:r,className:Y("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",t),...s}));Kt.displayName=U.Group.displayName;const fa=n.forwardRef(({className:t,...s},r)=>e.jsx(U.Separator,{ref:r,className:Y("-mx-1 h-px bg-border",t),...s}));fa.displayName=U.Separator.displayName;const Jt=n.forwardRef(({className:t,...s},r)=>e.jsx(U.Item,{ref:r,className:Y("relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t),...s}));Jt.displayName=U.Item.displayName;function ha({options:t,value:s,onValueChange:r,placeholder:a="선택...",searchPlaceholder:o="검색...",emptyText:x="결과가 없습니다.",className:f}){const[h,b]=n.useState(!1);return e.jsxs(lr,{open:h,onOpenChange:b,children:[e.jsx(or,{asChild:!0,children:e.jsxs(Ue,{variant:"outline",role:"combobox","aria-expanded":h,className:Y("w-full justify-between h-9 text-sm font-normal",f),children:[s?t.find(c=>c.value===s)?.label:a,e.jsx(wr,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(ir,{className:"w-full p-0",align:"start",children:e.jsxs(Vt,{children:[e.jsx(Wt,{placeholder:o,className:"h-9"}),e.jsx(Gt,{children:x}),e.jsx(Kt,{className:"max-h-[300px] overflow-auto",children:t.map(c=>e.jsxs(Jt,{value:c.label,onSelect:()=>{r(c.value===s?"":c.value),b(!1)},children:[e.jsx(gr,{className:Y("mr-2 h-4 w-4",s===c.value?"opacity-100":"opacity-0")}),c.label]},c.value))})]})})]})}const ya=n.lazy(()=>Je(()=>import("./PurchaseItemsModal-Bdj3iIAJ.js"),__vite__mapDeps([3,1,2,4,5,6,7,8,9,10,11,12]))),_a=[{key:"pending",label:"승인대기"},{key:"purchase",label:"구매 현황"},{key:"receipt",label:"입고 현황"},{key:"done",label:"전체 항목"}];function Ma({onEmailToggle:t,showEmailButton:s=!0}){const r=ar(),a=sr(),o=be(),[x,f]=n.useState(null),[h,b]=n.useState({}),[c,C]=n.useState(null),[$,A]=n.useState(!1),{purchases:R,vendors:F,employees:X,loading:l,currentUserRoles:g,currentUserName:N,refreshPurchases:I}=jr(),P=g?.includes("app_admin"),{activeTab:p,searchTerm:u,vendorFilter:D,dateFromFilter:_,dateToFilter:T,selectedEmployee:L,purchaseNumberFilter:M,itemNameFilter:ee,approvalStatusFilter:V,setActiveTab:J,setSearchTerm:W,setVendorFilter:O,setDateFromFilter:Q,setDateToFilter:G,setSelectedEmployee:re,setPurchaseNumberFilter:ae,setItemNameFilter:se,setApprovalStatusFilter:i,filteredPurchases:j,tabCounts:k}=Cr(R,g,N);n.useEffect(()=>{new URLSearchParams(a.search).get("tab")==="purchase"&&J("purchase")},[a.search,J]);const y=async m=>{try{const{error:q}=await o.from("purchase_requests").update({is_received:!0,received_at:new Date().toISOString()}).eq("id",m);if(q)throw q;await o.from("purchase_request_items").update({is_received:!0,delivery_status:"received"}).eq("purchase_request_id",m),te.success("입고완료 처리되었습니다."),await I()}catch{te.error("처리 중 오류가 발생했습니다.")}},E=async m=>{try{const{error:q}=await o.from("purchase_requests").update({is_payment_completed:!0,payment_completed_at:new Date().toISOString()}).eq("id",m);if(q)throw q;te.success("구매완료 처리되었습니다."),await I()}catch{te.error("처리 중 오류가 발생했습니다.")}};return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"발주요청 관리"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"발주요청서를 관리하고 승인 처리를 할 수 있습니다"})]}),e.jsxs(Ue,{onClick:()=>r("/purchase/new"),className:"mt-4 sm:mt-0 bg-hansl-500 hover:bg-hansl-600",children:[e.jsx(yr,{className:"w-4 h-4 mr-2"}),"새 발주요청 작성"]})]}),e.jsxs(Be,{className:"mb-4 border border-gray-200",children:[e.jsx(fr,{className:"bg-white border-b border-gray-200 py-3",children:e.jsxs(hr,{className:"flex items-center text-gray-900 text-sm font-medium",children:[e.jsx(_r,{className:"w-4 h-4 mr-2"}),"검색 필터"]})}),e.jsx(ze,{className:"py-3",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"시작일"}),e.jsx(_e,{type:"date",value:_,onChange:m=>Q(m.target.value),className:"text-sm h-9"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"종료일"}),e.jsx(_e,{type:"date",value:T,onChange:m=>G(m.target.value),className:"text-sm h-9"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"요청자"}),e.jsx(ha,{value:L||"all",onValueChange:m=>{re(m)},options:[{value:"all",label:"전체"},...X.filter(m=>m.name&&m.name.trim()!=="").sort((m,q)=>(m.name||"").localeCompare(q.name||"")).map(m=>({value:m.name||"",label:`${m.name}${m.name===N?" (나)":""}`}))],placeholder:L==="all"?"전체":L||"선택",searchPlaceholder:"직원 이름 검색...",emptyText:"일치하는 직원이 없습니다",className:"text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"업체"}),e.jsxs(Me,{value:D||"all",onValueChange:m=>O(m==="all"?"":m),children:[e.jsx(Oe,{className:"h-9 text-sm",children:e.jsx(Le,{placeholder:"전체"})}),e.jsxs(Te,{children:[e.jsx(me,{value:"all",children:"전체"}),F.map(m=>e.jsx(me,{value:m.vendor_name,children:m.vendor_name},m.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"발주번호"}),e.jsx(_e,{placeholder:"번호",value:M,onChange:m=>ae(m.target.value),className:"text-sm h-9"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"품명"}),e.jsx(_e,{placeholder:"품명",value:ee,onChange:m=>se(m.target.value),className:"text-sm h-9"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"승인상태"}),e.jsxs(Me,{value:V||"all",onValueChange:m=>i(m==="all"?"":m),children:[e.jsx(Oe,{className:"h-9 text-sm",children:e.jsx(Le,{placeholder:"전체"})}),e.jsxs(Te,{children:[e.jsx(me,{value:"all",children:"전체"}),e.jsx(me,{value:"pending",children:"대기"}),e.jsx(me,{value:"approved",children:"승인"}),e.jsx(me,{value:"rejected",children:"반려"})]})]})]}),e.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"통합검색"}),e.jsxs("div",{className:"relative",children:[e.jsx(at,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 w-3 h-3 text-gray-400"}),e.jsx(_e,{placeholder:"검색...",value:u,onChange:m=>W(m.target.value),className:"pl-7 text-sm h-9"})]})]})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:space-x-1 space-y-1 sm:space-y-0 bg-gray-50 p-1 rounded-lg border border-gray-200",children:_a.map(m=>e.jsxs("button",{onClick:()=>J(m.key),className:`flex-1 flex items-center justify-center space-x-2 py-2.5 px-3 sm:px-4 rounded-md text-xs sm:text-sm font-medium transition-colors ${p===m.key?"text-hansl-600 bg-white shadow-sm border border-gray-200":"text-gray-600 bg-transparent hover:text-gray-900 hover:bg-white/50"}`,children:[e.jsx("span",{className:"whitespace-nowrap",children:m.label}),e.jsx(H,{variant:"secondary",className:`text-[10px] sm:text-xs ${p===m.key?"bg-hansl-50 text-hansl-700":"bg-gray-100 text-gray-600"}`,children:k[m.key]})]},m.key))}),e.jsx(Be,{className:"overflow-hidden border border-gray-200",children:e.jsx(ze,{className:"p-0",children:l?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-hansl-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"로딩 중..."})]}):j.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(cr,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"발주요청서가 없습니다"}),e.jsx("p",{className:"text-gray-600",children:"새로운 발주요청서를 작성해보세요."})]}):e.jsx(Ft,{purchases:j,activeTab:p,currentUserRoles:g,onRefresh:I,onPaymentComplete:E,onReceiptComplete:y})})})]}),c&&e.jsx(n.Suspense,{fallback:e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"})}),children:e.jsx(ya,{isOpen:$,onClose:()=>{A(!1),C(null)},purchase:{...c,vendor_name:c.vendor_name||"",project_vendor:c.project_vendor||"",sales_order_number:c.sales_order_number||"",project_item:c.project_item||""},isAdmin:P||!1,onUpdate:I})})]})}export{Ma as default};
//# sourceMappingURL=PurchaseListMain-DHBYwF9O.js.map
