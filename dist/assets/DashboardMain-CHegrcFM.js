import{c as p,F as v,j as e,L as x,C as w,r as h,a as j}from"./index-BA_gFQ-Z.js";import{P as N,C as P,b as g,a as l,c as d,d as q,f}from"./format-DvJHaB9Z.js";/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],y=p("arrow-right",M);/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],W=p("clock",D);function k({stats:a}){const r=[{title:"전체 발주",value:a.total,icon:N,color:"bg-hansl-500",bgColor:"bg-hansl-50"},{title:"내 발주",value:a.myRequests,icon:v,color:"bg-green-500",bgColor:"bg-green-50"},{title:"승인 대기",value:a.pending,icon:W,color:"bg-yellow-500",bgColor:"bg-yellow-50"},{title:"이번 달 완료",value:a.completed,icon:P,color:"bg-purple-500",bgColor:"bg-purple-50"}];return e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:r.map(t=>{const s=t.icon;return e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:t.title}),e.jsx("p",{className:"text-3xl font-semibold text-gray-900",children:t.value.toLocaleString()})]}),e.jsx("div",{className:`${t.bgColor} p-3 rounded-lg`,children:e.jsx(s,{className:`w-6 h-6 ${t.color.replace("bg-","text-")}`})})]})},t.title)})})}const C={lessThanXSeconds:{one:"1초 미만",other:"{{count}}초 미만"},xSeconds:{one:"1초",other:"{{count}}초"},halfAMinute:"30초",lessThanXMinutes:{one:"1분 미만",other:"{{count}}분 미만"},xMinutes:{one:"1분",other:"{{count}}분"},aboutXHours:{one:"약 1시간",other:"약 {{count}}시간"},xHours:{one:"1시간",other:"{{count}}시간"},xDays:{one:"1일",other:"{{count}}일"},aboutXWeeks:{one:"약 1주",other:"약 {{count}}주"},xWeeks:{one:"1주",other:"{{count}}주"},aboutXMonths:{one:"약 1개월",other:"약 {{count}}개월"},xMonths:{one:"1개월",other:"{{count}}개월"},aboutXYears:{one:"약 1년",other:"약 {{count}}년"},xYears:{one:"1년",other:"{{count}}년"},overXYears:{one:"1년 이상",other:"{{count}}년 이상"},almostXYears:{one:"거의 1년",other:"거의 {{count}}년"}},S=(a,r,t)=>{let s;const i=C[a];return typeof i=="string"?s=i:r===1?s=i.one:s=i.other.replace("{{count}}",r.toString()),t?.addSuffix?t.comparison&&t.comparison>0?s+" 후":s+" 전":s},R={full:"y년 M월 d일 EEEE",long:"y년 M월 d일",medium:"y.MM.dd",short:"y.MM.dd"},L={full:"a H시 mm분 ss초 zzzz",long:"a H:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},A={full:"{{date}} {{time}}",long:"{{date}} {{time}}",medium:"{{date}} {{time}}",short:"{{date}} {{time}}"},F={date:g({formats:R,defaultWidth:"full"}),time:g({formats:L,defaultWidth:"full"}),dateTime:g({formats:A,defaultWidth:"full"})},z={lastWeek:"'지난' eeee p",yesterday:"'어제' p",today:"'오늘' p",tomorrow:"'내일' p",nextWeek:"'다음' eeee p",other:"P"},E=(a,r,t,s)=>z[a],Q={narrow:["BC","AD"],abbreviated:["BC","AD"],wide:["기원전","서기"]},H={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1분기","2분기","3분기","4분기"]},V={narrow:["1","2","3","4","5","6","7","8","9","10","11","12"],abbreviated:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],wide:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"]},X={narrow:["일","월","화","수","목","금","토"],short:["일","월","화","수","목","금","토"],abbreviated:["일","월","화","수","목","금","토"],wide:["일요일","월요일","화요일","수요일","목요일","금요일","토요일"]},$={narrow:{am:"오전",pm:"오후",midnight:"자정",noon:"정오",morning:"아침",afternoon:"오후",evening:"저녁",night:"밤"},abbreviated:{am:"오전",pm:"오후",midnight:"자정",noon:"정오",morning:"아침",afternoon:"오후",evening:"저녁",night:"밤"},wide:{am:"오전",pm:"오후",midnight:"자정",noon:"정오",morning:"아침",afternoon:"오후",evening:"저녁",night:"밤"}},T={narrow:{am:"오전",pm:"오후",midnight:"자정",noon:"정오",morning:"아침",afternoon:"오후",evening:"저녁",night:"밤"},abbreviated:{am:"오전",pm:"오후",midnight:"자정",noon:"정오",morning:"아침",afternoon:"오후",evening:"저녁",night:"밤"},wide:{am:"오전",pm:"오후",midnight:"자정",noon:"정오",morning:"아침",afternoon:"오후",evening:"저녁",night:"밤"}},O=(a,r)=>{const t=Number(a);switch(String(r?.unit)){case"minute":case"second":return String(t);case"date":return t+"일";default:return t+"번째"}},I={ordinalNumber:O,era:l({values:Q,defaultWidth:"wide"}),quarter:l({values:H,defaultWidth:"wide",argumentCallback:a=>a-1}),month:l({values:V,defaultWidth:"wide"}),day:l({values:X,defaultWidth:"wide"}),dayPeriod:l({values:$,defaultWidth:"wide",formattingValues:T,defaultFormattingWidth:"wide"})},Y=/^(\d+)(일|번째)?/i,B=/\d+/i,U={narrow:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(기원전|서기)/i},G={any:[/^(bc|기원전)/i,/^(ad|서기)/i]},J={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234]사?분기/i},K={any:[/1/i,/2/i,/3/i,/4/i]},Z={narrow:/^(1[012]|[123456789])/,abbreviated:/^(1[012]|[123456789])월/i,wide:/^(1[012]|[123456789])월/i},ee={any:[/^1월?$/,/^2/,/^3/,/^4/,/^5/,/^6/,/^7/,/^8/,/^9/,/^10/,/^11/,/^12/]},te={narrow:/^[일월화수목금토]/,short:/^[일월화수목금토]/,abbreviated:/^[일월화수목금토]/,wide:/^[일월화수목금토]요일/},ae={any:[/^일/,/^월/,/^화/,/^수/,/^목/,/^금/,/^토/]},se={any:/^(am|pm|오전|오후|자정|정오|아침|저녁|밤)/i},re={any:{am:/^(am|오전)/i,pm:/^(pm|오후)/i,midnight:/^자정/i,noon:/^정오/i,morning:/^아침/i,afternoon:/^오후/i,evening:/^저녁/i,night:/^밤/i}},ne={ordinalNumber:q({matchPattern:Y,parsePattern:B,valueCallback:a=>parseInt(a,10)}),era:d({matchPatterns:U,defaultMatchWidth:"wide",parsePatterns:G,defaultParseWidth:"any"}),quarter:d({matchPatterns:J,defaultMatchWidth:"wide",parsePatterns:K,defaultParseWidth:"any",valueCallback:a=>a+1}),month:d({matchPatterns:Z,defaultMatchWidth:"wide",parsePatterns:ee,defaultParseWidth:"any"}),day:d({matchPatterns:te,defaultMatchWidth:"wide",parsePatterns:ae,defaultParseWidth:"any"}),dayPeriod:d({matchPatterns:se,defaultMatchWidth:"any",parsePatterns:re,defaultParseWidth:"any"})},b={code:"ko",formatDistance:S,formatLong:F,formatRelative:E,localize:I,match:ne,options:{weekStartsOn:0,firstWeekContainsDate:1}};function ie({requests:a}){const r=t=>t.delivery_status==="completed"?e.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-green-100 text-green-700 rounded-full",children:"완료"}):t.final_manager_status==="approved"?e.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-hansl-100 text-hansl-700 rounded-full",children:"구매중"}):t.middle_manager_status==="approved"?e.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-yellow-100 text-yellow-700 rounded-full",children:"최종승인 대기"}):t.middle_manager_status==="pending"?e.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-gray-100 text-gray-700 rounded-full",children:"1차승인 대기"}):e.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-red-100 text-red-700 rounded-full",children:"반려"});return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"최근 발주 내역"}),e.jsxs(x,{to:"/purchase/list",className:"flex items-center gap-1 text-sm text-primary hover:underline",children:["전체보기",e.jsx(y,{className:"w-4 h-4"})]})]})}),e.jsx("div",{className:"divide-y divide-gray-200",children:a.length===0?e.jsx("div",{className:"p-6 text-center text-gray-500",children:"최근 발주 내역이 없습니다."}):a.map(t=>e.jsxs("div",{className:"p-4 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.purchase_order_number||`발주 #${t.id.slice(0,8)}`}),e.jsxs("p",{className:"text-sm text-gray-600",children:[t.purchase_request_items?.[0]?.item_name,t.purchase_request_items?.length>1&&` 외 ${t.purchase_request_items.length-1}건`]})]}),r(t)]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[e.jsx("span",{children:f(new Date(t.created_at),"yyyy년 MM월 dd일",{locale:b})}),e.jsxs("span",{className:"font-medium",children:["₩",t.total_amount?.toLocaleString()||"0"]})]})]},t.id))})]})}function oe({approvals:a,role:r}){const t=()=>r==="middle_manager"?"1차 승인 필요":r==="final_approver"||r==="ceo"?"최종 승인 필요":r==="lead_buyer"?"구매 처리 필요":"처리 필요";return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5 text-yellow-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"승인 대기 항목"})]}),e.jsxs(x,{to:"/approval",className:"flex items-center gap-1 text-sm text-primary hover:underline",children:["전체보기",e.jsx(y,{className:"w-4 h-4"})]})]})}),e.jsx("div",{className:"divide-y divide-gray-200",children:a.map(s=>e.jsxs("div",{className:"p-4 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.purchase_order_number||`발주 #${s.id.slice(0,8)}`}),e.jsxs("p",{className:"text-sm text-gray-600",children:["요청자: ",s.requester_name||s.requester_email]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.purchase_request_items?.[0]?.item_name,s.purchase_request_items?.length>1&&` 외 ${s.purchase_request_items.length-1}건`]})]}),e.jsx("span",{className:"px-3 py-1 text-xs font-medium bg-yellow-100 text-yellow-700 rounded-full",children:t()})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[e.jsx("span",{children:f(new Date(s.created_at),"yyyy년 MM월 dd일",{locale:b})}),e.jsxs("span",{className:"font-medium",children:["₩",s.total_amount?.toLocaleString()||"0"]})]})]},s.id))})]})}function he(){const[a,r]=h.useState({employee:null,stats:{total:0,myRequests:0,pending:0,completed:0},recentRequests:[],pendingApprovals:[]}),[t,s]=h.useState(!0);h.useEffect(()=>{i()},[]);const i=async()=>{try{s(!0);const n=j(),{data:{user:c}}=await n.auth.getUser();if(!c){s(!1);return}const{data:o}=await n.from("employees").select("*").eq("email",c.email).single();if(!o){s(!1);return}const[m,u,_]=await Promise.all([le(n,o),de(n,o),ce(n,o)]);r({employee:o,stats:m,recentRequests:u,pendingApprovals:_})}catch{}finally{s(!1)}};return t?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-hansl-600 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"로딩 중..."})]}):a.employee?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"대시보드"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[a.employee.name,"님, 환영합니다. 오늘의 발주 현황을 확인하세요."]})]}),e.jsx(k,{stats:a.stats}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(ie,{requests:a.recentRequests}),a.pendingApprovals.length>0&&e.jsx(oe,{approvals:a.pendingApprovals,role:a.employee.purchase_role})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"사용자 정보를 찾을 수 없습니다"}),e.jsx("p",{className:"text-gray-600",children:"로그인을 다시 시도해주세요."})]})}async function le(a,r){new Date().toISOString().split("T")[0];const t=new Date(new Date().getFullYear(),new Date().getMonth(),1).toISOString();let s=a.from("purchase_requests").select("id",{count:"exact",head:!0}),i=a.from("purchase_requests").select("id",{count:"exact",head:!0}).eq("requester_email",r?.email),n=a.from("purchase_requests").select("id",{count:"exact",head:!0});r?.purchase_role==="middle_manager"?n=n.eq("middle_manager_status","pending"):r?.purchase_role==="final_approver"||r?.purchase_role==="ceo"?n=n.eq("middle_manager_status","approved").eq("final_manager_status","pending"):r?.purchase_role==="lead_buyer"&&(n=n.eq("final_manager_status","approved").eq("purchase_status","pending"));const[c,o,m]=await Promise.all([s,i,n]),{count:u}=await a.from("purchase_requests").select("id",{count:"exact",head:!0}).eq("delivery_status","completed").gte("created_at",t);return{total:c.count||0,myRequests:o.count||0,pending:m.count||0,completed:u||0}}async function de(a,r){const{data:t}=await a.from("purchase_requests").select(`
      *,
      purchase_request_items (
        item_name,
        quantity,
        unit_price
      )
    `).eq("requester_email",r?.email).order("created_at",{ascending:!1}).limit(5);return t||[]}async function ce(a,r){let t=a.from("purchase_requests").select(`
      *,
      purchase_request_items (
        item_name,
        quantity,
        unit_price
      )
    `);if(r?.purchase_role==="middle_manager")t=t.eq("middle_manager_status","pending");else if(r?.purchase_role==="final_approver"||r?.purchase_role==="ceo")t=t.eq("middle_manager_status","approved").eq("final_manager_status","pending");else if(r?.purchase_role==="lead_buyer")t=t.eq("final_manager_status","approved").eq("purchase_status","pending");else return[];const{data:s}=await t.order("created_at",{ascending:!1}).limit(5);return s||[]}export{he as default};
//# sourceMappingURL=DashboardMain-CHegrcFM.js.map
