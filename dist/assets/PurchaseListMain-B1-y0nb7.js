const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/exceljs.min-DowPrxBb.js","assets/index-D8M7vxbM.js","assets/index-C0EC6Oop.css","assets/PurchaseItemsModal-Y-xrtiYl.js","assets/input-z_v8gvEl.js","assets/index-DEpWIVDZ.js","assets/PurchaseDetailModal-BXQ5x2G0.js","assets/helpers-CsHcdtkA.js","assets/calendar-D4AzkUn4.js","assets/chevron-right-EPuiEj_O.js","assets/chevron-down-BFcFynQ9.js","assets/popover-DYLNkvmj.js","assets/calendar-AemyNNBp.js","assets/package-D1-VROro.js","assets/credit-card-A4to8Srp.js","assets/card-CEIU5XSb.js","assets/plus-Dk4c22r9.js","assets/save-DzwwSIA_.js"])))=>i.map(i=>d[i]);
import{c as e,r as a,p as t,j as s,_ as r,f as l,g as n,h as c,i,k as d,m as o,a as m,l as u,B as p,X as h,U as x,u as g,n as b}from"./index-D8M7vxbM.js";import{P as y}from"./PurchaseDetailModal-BXQ5x2G0.js";import{f as _,a as f}from"./helpers-CsHcdtkA.js";import{E as j}from"./eye-D4Xa3FWI.js";import{t as v}from"./index-DEpWIVDZ.js";import{f as w,R as N,P as C,W as k,C as $,T as q,g as D,h as S,O as F,i as M,I as A}from"./input-z_v8gvEl.js";import{P as R,a as E,b as P}from"./popover-DYLNkvmj.js";import{S as T,a as z,b as I,c as L,d as O}from"./select-D3SFYUQk.js";import{C as B,f as Y,a as W}from"./calendar-D4AzkUn4.js";import{C as U}from"./calendar-AemyNNBp.js";import{P as J}from"./package-D1-VROro.js";import{C as G}from"./chevron-down-BFcFynQ9.js";import{A as K}from"./arrow-up-down-CR4s2SKH.js";import{S as V,C as Z,a as H,b as X,c as Q}from"./card-CEIU5XSb.js";import{P as ee}from"./plus-Dk4c22r9.js";import"./credit-card-A4to8Srp.js";import"./save-DzwwSIA_.js";import"./chevron-right-EPuiEj_O.js";
/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=e("building",[["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3",key:"cabbwy"}],["rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",key:"1uxh74"}]]),te=e("dollar-sign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),se=e("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),re=e("sliders-vertical",[["line",{x1:"4",x2:"4",y1:"21",y2:"14",key:"1p332r"}],["line",{x1:"4",x2:"4",y1:"10",y2:"3",key:"gb41h5"}],["line",{x1:"12",x2:"12",y1:"21",y2:"12",key:"hf2csr"}],["line",{x1:"12",x2:"12",y1:"8",y2:"3",key:"1kfi7u"}],["line",{x1:"20",x2:"20",y1:"21",y2:"16",key:"1lhrwl"}],["line",{x1:"20",x2:"20",y1:"12",y2:"3",key:"16vvfq"}],["line",{x1:"2",x2:"6",y1:"14",y2:"14",key:"1uebub"}],["line",{x1:"10",x2:"14",y1:"8",y2:"8",key:"1yglbp"}],["line",{x1:"18",x2:"22",y1:"16",y2:"16",key:"1jxqpz"}]]),le=["정희웅"],ne=(e,a,t)=>{if(!e||!t)return[];const s=Array.isArray(t.purchase_role)?t.purchase_role.map(e=>e.trim()):"string"==typeof t.purchase_role?t.purchase_role.split(",").map(e=>e.trim()):[];switch(a){case"pending":return e.filter(e=>{if("approved"===e.middle_manager_status&&"approved"===e.final_manager_status)return!1;if("rejected"===e.middle_manager_status||"rejected"===e.final_manager_status)return!1;if(s.includes("consumable_manager")&&"구매 요청"!==e.payment_category)return!1;if(s.includes("raw_material_manager")&&"발주"!==e.payment_category)return!1;if(s.includes("app_admin")||s.includes("ceo"))return!0;if(s.includes("middle_manager")){return["pending","대기","",null,void 0].includes(e.middle_manager_status)}return e.requester_name===t?.name});case"purchase":return e.filter(e=>{const a="구매 요청"===e.payment_category,t=!e.is_payment_completed;if(!a||!t)return!1;const s=(e.progress_type||"").includes("선진행"),r=(e.progress_type||"").includes("일반")||!e.progress_type||""===e.progress_type,l="approved"===e.final_manager_status;return s||r&&l});case"receipt":return e.filter(e=>{if(e.is_received)return!1;const a=(e.progress_type||"").includes("선진행"),t="approved"===e.final_manager_status;return a||t});default:return e}},ce=(e,a)=>{const t=a.split(".");let s=e;for(const r of t){if(null==s)return null;s=s[r]}return s},ie=(e,a,t)=>{let s=e;return a.tab&&(s=ne(s,a.tab,t)),a.employeeName&&(s=((e,a,t)=>{if(!e||!a||"전체"===a)return e;const s=(Array.isArray(t?.purchase_role)?t.purchase_role.map(e=>e.trim()):"string"==typeof t?.purchase_role?t.purchase_role.split(",").map(e=>e.trim()):[]).some(e=>["lead_buyer","ceo","finance_team","raw_material_manager","consumable_manager"].includes(e));return e.filter(e=>{const t=e.requester_name||"";return!(le.includes(t)&&!s)&&t===a})})(s,a.employeeName,t)),a.searchTerm&&(s=((e,a)=>{if(!a||""===a.trim())return e;const t=a.toLowerCase().trim();return e.filter(e=>[e.purchase_order_number,e.requester_name,e.purchase_order_number,e.vendor_name,...(e.purchase_request_items||[]).map(e=>[e.item_name,e.item_detail,e.manufacturer,e.model,e.spec]).flat()].some(e=>e&&String(e).toLowerCase().includes(t)))})(s,a.searchTerm)),a.advancedFilters&&(s=((e,a)=>a&&0!==a.length?e.filter(e=>a.every(a=>{const{field:t,operator:s,value:r}=a,l=ce(e,t);switch(s){case"contains":return String(l).toLowerCase().includes(String(r).toLowerCase());case"equals":return l===r;case"notEquals":return l!==r;case"greaterThan":return Number(l)>Number(r);case"lessThan":return Number(l)<Number(r);case"between":const[e,a]=r.split(",").map(Number),t=Number(l);return t>=e&&t<=a;case"in":return r.split(",").map(e=>e.trim()).includes(String(l));case"startsWith":return String(l).toLowerCase().startsWith(String(r).toLowerCase());case"endsWith":return String(l).toLowerCase().endsWith(String(r).toLowerCase());default:return!0}})):e)(s,a.advancedFilters)),(a.startDate||a.endDate)&&(s=((e,a,t)=>a||t?e.filter(e=>{const s=new Date(e.request_date);return!(a&&s<new Date(a)||t&&s>new Date(t))}):e)(s,a.startDate,a.endDate)),a.sortConfig&&(s=((e,a)=>a?[...e].sort((e,t)=>{const s=ce(e,a.key),r=ce(t,a.key);if(null==s)return 1;if(null==r)return-1;let l=0;return s>r&&(l=1),s<r&&(l=-1),"desc"===a.direction?-l:l}):e)(s,a.sortConfig)),s};function de(){const[e,s]=a.useState([]),[r,l]=a.useState(!1),[n,c]=a.useState(null),i=t.currentUser;a.useEffect(()=>{const e=()=>{t.allPurchases?(s(t.allPurchases),l(!1)):l(t.isLoading),c(t.error)};e();const a=setInterval(e,100);return()=>clearInterval(a)},[]);const d=a.useCallback(e=>t.allPurchases?ie(t.allPurchases,e,i):[],[i]),o=a.useMemo(()=>t.allPurchases?((e,a)=>({pending:ne(e,"pending",a).length,purchase:ne(e,"purchase",a).length,receipt:ne(e,"receipt",a).length,done:e.length}))(t.allPurchases,i):{pending:0,purchase:0,receipt:0,done:0},[e,i]),m=a.useMemo(()=>({total:e.length,loaded:t.stats?.loadedCount||0,memoryUsage:t.stats?.memoryUsage||0,lastFetch:t.lastFetch}),[e]);return{allPurchases:e,getFilteredPurchases:d,loading:r,error:n,tabCounts:o,stats:m,currentUser:i}}const oe=a.memo(({purchase:e})=>{const a=e.is_received?"completed":"approved"===e.middle_manager_status&&"approved"===e.final_manager_status?"inProgress":"rejected"===e.middle_manager_status||"rejected"===e.final_manager_status?"rejected":"pending",{text:t,className:r}={completed:{text:"입고완료",className:"badge-success"},inProgress:{text:"구매진행",className:"badge-primary"},rejected:{text:"반려",className:"badge-danger"},pending:{text:"승인대기",className:"badge-warning"}}[a];return s.jsx("span",{className:`badge-stats ${r}`,children:t})});oe.displayName="StatusBadge";const me=a.memo(({purchase:e,onClick:a})=>{const t=(e=>{if(!e.purchase_request_items||0===e.purchase_request_items.length)return{received:0,total:0,percentage:0};const a=e.purchase_request_items.length,t=e.purchase_request_items.filter(e=>null!==e.actual_received_date&&void 0!==e.actual_received_date).length;return{received:t,total:a,percentage:a>0?Math.round(t/a*100):0}})(e),r="선진행"===e.progress_type||e.progress_type?.includes("선진행");return s.jsxs("div",{className:"bg-white rounded-lg border p-4 space-y-3 cursor-pointer transition-all hover:shadow-md "+(r?"border-red-400 bg-red-50 hover:bg-red-100":"hover:bg-gray-50"),onClick:()=>a(e),children:[s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-2",children:[r?s.jsx("span",{className:"badge-stats bg-red-500 text-white",children:"선진행"}):s.jsx("span",{className:"badge-stats bg-gray-500 text-white",children:"일반"}),s.jsx("span",{className:"card-title text-gray-900",children:e.purchase_order_number||"-"})]}),s.jsxs("div",{className:"badge-text text-gray-500 mt-1",children:[_(e.request_date)," 요청"]})]}),s.jsx(oe,{purchase:e})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[s.jsx("span",{className:"text-gray-600",children:"요청자"}),s.jsx("span",{className:"card-title",children:e.requester_name})]}),s.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[s.jsx("span",{className:"text-gray-600",children:"업체"}),s.jsx("span",{className:"card-title",children:e.vendor_name})]}),e.project_vendor&&s.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[s.jsx("span",{className:"text-gray-600",children:"PJ업체"}),s.jsx("span",{className:"card-title truncate max-w-[150px]",children:e.project_vendor})]}),e.project_item&&s.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[s.jsx("span",{className:"text-gray-600",children:"PJ ITEM"}),s.jsx("span",{className:"card-title truncate max-w-[150px]",children:e.project_item})]}),e.sales_order_number&&s.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[s.jsx("span",{className:"text-gray-600",children:"수주번호"}),s.jsx("span",{className:"card-title truncate max-w-[150px]",children:e.sales_order_number})]}),e.item_name&&s.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[s.jsx("span",{className:"text-gray-600",children:"품목"}),s.jsx("span",{className:"card-title truncate max-w-[150px]",children:e.item_name})]}),s.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[s.jsx("span",{className:"text-gray-600",children:"금액"}),s.jsxs("span",{className:"font-semibold text-gray-900",children:[(e.amount_value||e.total_amount)?.toLocaleString()," ",e.currency]})]})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsxs("div",{className:"flex items-center justify-between badge-text",children:[s.jsx("span",{className:"text-gray-600",children:"입고현황"}),s.jsxs("span",{className:"text-gray-700",children:[t.received,"/",t.total," (",t.percentage,"%)"]})]}),s.jsx("div",{className:"bg-gray-200 rounded-full h-2",children:s.jsx("div",{className:"h-2 rounded-full transition-all "+(100===t.percentage?"bg-green-500":t.percentage>0?"bg-hansl-500":"bg-gray-300"),style:{width:`${t.percentage}%`}})})]}),void 0!==e.is_payment_completed&&s.jsxs("div",{className:"flex items-center justify-between card-subtitle",children:[s.jsx("span",{className:"text-gray-600",children:"결제"}),e.is_payment_completed?s.jsx("span",{className:"badge-stats bg-green-500 text-white",children:"완료"}):s.jsx("span",{className:"badge-stats bg-gray-500 text-white",children:"대기"})]}),s.jsx("div",{className:"pt-2 border-t",children:s.jsxs("div",{className:"flex items-center justify-center badge-text text-gray-500",children:[s.jsx(j,{className:"w-3 h-3 mr-1"}),"클릭하여 상세보기"]})})]})});me.displayName="MobilePurchaseCard";const ue=f;function pe(e){return e?["KRW","원","₩"].includes(e)?"₩":["USD","$","달러"].includes(e)?"$":["EUR","€"].includes(e)?"€":["JPY","엔","¥"].includes(e)||["CNY","위안","元"].includes(e)?"¥":e:""}var he="AlertDialog",[xe,ge]=n(he,[w]),be=w(),ye=e=>{const{__scopeAlertDialog:a,...t}=e,r=be(a);return s.jsx(N,{...r,...t,modal:!0})};ye.displayName=he;a.forwardRef((e,a)=>{const{__scopeAlertDialog:t,...r}=e,l=be(t);return s.jsx(M,{...l,...r,ref:a})}).displayName="AlertDialogTrigger";var _e=e=>{const{__scopeAlertDialog:a,...t}=e,r=be(a);return s.jsx(C,{...r,...t})};_e.displayName="AlertDialogPortal";var fe=a.forwardRef((e,a)=>{const{__scopeAlertDialog:t,...r}=e,l=be(t);return s.jsx(F,{...l,...r,ref:a})});fe.displayName="AlertDialogOverlay";var je="AlertDialogContent",[ve,we]=xe(je),Ne=i("AlertDialogContent"),Ce=a.forwardRef((e,t)=>{const{__scopeAlertDialog:r,children:n,...i}=e,d=be(r),o=a.useRef(null),m=l(t,o),u=a.useRef(null);return s.jsx(k,{contentName:je,titleName:ke,docsSlug:"alert-dialog",children:s.jsx(ve,{scope:r,cancelRef:u,children:s.jsxs($,{role:"alertdialog",...d,...i,ref:m,onOpenAutoFocus:c(i.onOpenAutoFocus,e=>{e.preventDefault(),u.current?.focus({preventScroll:!0})}),onPointerDownOutside:e=>e.preventDefault(),onInteractOutside:e=>e.preventDefault(),children:[s.jsx(Ne,{children:n}),s.jsx(Ae,{contentRef:o})]})})})});Ce.displayName=je;var ke="AlertDialogTitle",$e=a.forwardRef((e,a)=>{const{__scopeAlertDialog:t,...r}=e,l=be(t);return s.jsx(q,{...l,...r,ref:a})});$e.displayName=ke;var qe="AlertDialogDescription",De=a.forwardRef((e,a)=>{const{__scopeAlertDialog:t,...r}=e,l=be(t);return s.jsx(D,{...l,...r,ref:a})});De.displayName=qe;var Se=a.forwardRef((e,a)=>{const{__scopeAlertDialog:t,...r}=e,l=be(t);return s.jsx(S,{...l,...r,ref:a})});Se.displayName="AlertDialogAction";var Fe="AlertDialogCancel",Me=a.forwardRef((e,a)=>{const{__scopeAlertDialog:t,...r}=e,{cancelRef:n}=we(Fe,t),c=be(t),i=l(a,n);return s.jsx(S,{...c,...r,ref:i})});Me.displayName=Fe;var Ae=({contentRef:e})=>{const t=`\`${je}\` requires a description for the component to be accessible for screen reader users.\n\nYou can add a description to the \`${je}\` by passing a \`${qe}\` component as a child, which also benefits sighted users by adding visible context to the dialog.\n\nAlternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${je}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.\n\nFor more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return a.useEffect(()=>{document.getElementById(e.current?.getAttribute("aria-describedby"))},[t,e]),null},Re=fe,Ee=Ce,Pe=Se,Te=Me,ze=$e,Ie=De;const Le=ye,Oe=_e,Be=a.forwardRef(({className:e,...a},t)=>s.jsx(Re,{className:d("fixed inset-0 z-50 bg-black/40 backdrop-blur-sm","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...a,ref:t}));Be.displayName=Re.displayName;const Ye=a.forwardRef(({className:e,...a},t)=>s.jsxs(Oe,{children:[s.jsx(Be,{}),s.jsx(Ee,{ref:t,className:d("fixed left-[50%] top-[50%] z-50","w-full max-w-md translate-x-[-50%] translate-y-[-50%]","grid gap-4 bg-white border border-gray-200","rounded-lg p-6 shadow-professional-xl","duration-200","data-[state=open]:animate-in data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0","data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95","data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%]","data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%]",e),...a})]}));Ye.displayName=Ee.displayName;const We=({className:e,...a})=>s.jsx("div",{className:d("flex flex-col space-y-2 text-left",e),...a});We.displayName="AlertDialogHeader";const Ue=({className:e,...a})=>s.jsx("div",{className:d("flex flex-col-reverse sm:flex-row sm:justify-end gap-3",e),...a});Ue.displayName="AlertDialogFooter";const Je=a.forwardRef(({className:e,...a},t)=>s.jsx(ze,{ref:t,className:d("text-lg font-semibold text-gray-800 tracking-tight",e),...a}));Je.displayName=ze.displayName;const Ge=a.forwardRef(({className:e,...a},t)=>s.jsx(Ie,{ref:t,className:d("text-sm text-gray-600",e),...a}));Ge.displayName=Ie.displayName;const Ke=a.forwardRef(({className:e,...a},t)=>s.jsx(Pe,{ref:t,className:d(o(),e),...a}));Ke.displayName=Pe.displayName;const Ve=a.forwardRef(({className:e,...a},t)=>s.jsx(Te,{ref:t,className:d(o({variant:"outline"}),"mt-2 sm:mt-0",e),...a}));Ve.displayName=Te.displayName;const Ze=a.memo(({purchase:e})=>{const a=e.is_received?"completed":"approved"===e.middle_manager_status&&"approved"===e.final_manager_status?"inProgress":"rejected"===e.middle_manager_status||"rejected"===e.final_manager_status?"rejected":"pending",{text:t,className:r}={completed:{text:"입고완료",className:"badge-success"},inProgress:{text:"구매진행",className:"badge-primary"},rejected:{text:"반려",className:"badge-danger"},pending:{text:"승인대기",className:"badge-warning"}}[a];return s.jsx("span",{className:`badge-stats ${r}`,children:t})});Ze.displayName="StatusBadge";const He=e=>e?["KRW","원","₩"].includes(e)?"₩":["USD","$","달러"].includes(e)?"$":["EUR","€"].includes(e)?"€":["JPY","엔","¥"].includes(e)||["CNY","위안","元"].includes(e)?"¥":e:"₩",Xe="text-center w-20 min-w-[85px] max-w-[85px]",Qe="pl-2 w-38 min-w-[155px] max-w-[155px]",ea="pl-2 w-36 min-w-[140px] max-w-[140px]",aa="text-center w-20 min-w-[85px] max-w-[85px]",ta="w-16 min-w-[68px] max-w-[68px]",sa="text-center px-2 w-16 min-w-[64px] max-w-[68px]",ra="pl-3 pr-2 w-32 min-w-[130px] max-w-[130px]",la="w-16 min-w-[68px] max-w-[68px]",na="w-20 min-w-[85px] max-w-[85px]",ca="w-20 min-w-[85px] max-w-[85px]",ia="w-28 min-w-[120px] max-w-[120px]",da="w-64 min-w-[260px] max-w-[260px]",oa="text-center w-14 min-w-[60px] max-w-[60px]",ma="text-right w-24 min-w-[100px] max-w-[100px]",ua="text-right w-24 min-w-[100px] max-w-[100px]",pa="w-28 min-w-[115px] max-w-[115px]",ha="w-24 min-w-[100px] max-w-[100px]",xa="w-24 min-w-[105px] max-w-[105px]",ga="w-28 min-w-[115px] max-w-[115px]",ba="w-44 min-w-[180px] max-w-[180px]",ya="text-center w-20 min-w-[85px] max-w-[85px]",_a="text-center w-20 min-w-[85px] max-w-[85px]",fa="text-center w-24 min-w-[100px] max-w-[100px]",ja="w-20 min-w-[85px] max-w-[85px]",va="text-center w-14 min-w-[56px] max-w-[60px]",wa=a.memo(({purchase:e})=>{const a="approved"===e.middle_manager_status,t="rejected"===e.middle_manager_status,r="approved"===e.final_manager_status,l="rejected"===e.final_manager_status;return t||l?s.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[s.jsx("div",{className:"flex items-center gap-0.5",children:s.jsx("div",{className:"w-1.5 h-1.5 bg-red-500 rounded-full animate-pulse"})}),s.jsx("span",{className:"badge-stats bg-red-500 text-white",children:"반려"})]}):a&&r?s.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[s.jsx("div",{className:"flex items-center gap-0.5",children:s.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"})}),s.jsx("span",{className:"badge-stats bg-green-500 text-white",children:"승인완료"})]}):!a||r||l?s.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full"}),s.jsx("div",{className:"w-3 h-0.5 bg-gray-300"}),s.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full"})]}),s.jsx("span",{className:"badge-stats bg-gray-500 text-white",children:"승인대기"})]}):s.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),s.jsx("div",{className:"w-3 h-0.5 bg-gray-300"}),s.jsx("div",{className:"w-1.5 h-1.5 bg-gray-300 rounded-full"})]}),s.jsx("span",{className:"badge-stats bg-yellow-500 text-white",children:"1차 승인"})]})});wa.displayName="ApprovalStatusBadge";a.memo(({type:e})=>"선진행"===e||e?.includes("선진행")?s.jsx("span",{className:"badge-stats bg-red-500 text-white",children:"선진행"}):s.jsx("span",{className:"badge-stats bg-gray-500 text-white",children:"일반"})).displayName="ProgressTypeBadge";const Na=a.memo(({purchase:e,onClick:a,activeTab:t,isLeadBuyer:r,onPaymentComplete:l,onReceiptComplete:n,onExcelDownload:c})=>{const i=(e=>{if(!e.purchase_request_items||0===e.purchase_request_items.length)return{received:0,total:1,percentage:0};const a=e.purchase_request_items.length,t=e.purchase_request_items.filter(e=>!0===e.is_received).length;return{received:t,total:a,percentage:a>0?Math.round(t/a*100):0}})(e),d=(e=>{if(e.is_payment_completed)return{completed:1,total:1,percentage:100};if(!e.purchase_request_items||0===e.purchase_request_items.length)return{completed:0,total:1,percentage:0};const a=e.purchase_request_items.length,t=e.purchase_request_items.filter(e=>!0===e.is_payment_completed).length;return{completed:t,total:a,percentage:a>0?Math.round(t/a*100):0}})(e),o=(e=>{if(!e.purchase_request_items||0===e.purchase_request_items.length)return{completed:0,total:1,percentage:0};const a=e.purchase_request_items.length,t=e.purchase_request_items.filter(e=>!0===e.is_statement_received).length;return{completed:t,total:a,percentage:a>0?Math.round(t/a*100):0}})(e),m="선진행"===e.progress_type||e.progress_type?.includes("선진행");return s.jsxs("tr",{className:"border-b hover:bg-gray-100 cursor-pointer transition-colors "+(m?"bg-red-50 hover:bg-red-100":""),onClick:()=>a(e),children:["pending"===t&&s.jsx("td",{className:`px-2 py-1.5 whitespace-nowrap ${Xe}`,children:s.jsx(wa,{purchase:e})}),"purchase"===t&&s.jsx("td",{className:`px-2 py-1.5 ${ya}`,children:s.jsxs("div",{className:"flex items-center justify-center gap-1",children:[s.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:s.jsx("div",{className:"h-1.5 rounded-full "+(100===d.percentage?"bg-blue-500":d.percentage>0?"bg-blue-400":"bg-gray-300"),style:{width:`${d.percentage}%`}})}),s.jsxs("span",{className:"card-title text-gray-600",children:[d.percentage,"%"]})]})}),"receipt"===t&&s.jsx("td",{className:`px-2 py-1.5 ${ya}`,children:s.jsxs("div",{className:"flex items-center justify-center gap-1",children:[s.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:s.jsx("div",{className:"h-1.5 rounded-full "+(100===i.percentage?"bg-green-500":i.percentage>0?"bg-hansl-500":"bg-gray-300"),style:{width:`${i.percentage}%`}})}),s.jsxs("span",{className:"card-title text-gray-600",children:[i.percentage,"%"]})]})}),"done"===t&&s.jsx("td",{className:`px-2 py-1.5 ${ya}`,children:s.jsxs("div",{className:"flex items-center justify-center gap-1",children:[s.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:s.jsx("div",{className:"h-1.5 rounded-full "+(100===o.percentage?"bg-green-500":o.percentage>0?"bg-hansl-500":"bg-gray-300"),style:{width:`${o.percentage}%`}})}),s.jsxs("span",{className:"card-title text-gray-600",children:[o.percentage,"%"]})]})}),s.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${"purchase"===t?ea:Qe}`,children:s.jsxs("div",{className:"flex items-center gap-1",children:[c&&s.jsx("img",{src:"/excels-icon.svg",alt:"엑셀 다운로드",width:"16",height:"16",className:`inline-block align-middle transition-transform p-0.5 rounded\n                ${e.is_po_download?"border border-gray-400":""}\n                ${"선진행"===e.progress_type||e.progress_type?.includes("선진행")||"approved"===e.middle_manager_status&&"approved"===e.final_manager_status?e.is_po_download?"cursor-pointer":"cursor-pointer hover:scale-110":"opacity-40 grayscale cursor-not-allowed"}`,onClick:async a=>{("선진행"===e.progress_type||e.progress_type?.includes("선진행")||"approved"===e.middle_manager_status&&"approved"===e.final_manager_status)&&(a.stopPropagation(),await c(e))},style:{pointerEvents:"선진행"===e.progress_type||e.progress_type?.includes("선진행")||"approved"===e.middle_manager_status&&"approved"===e.final_manager_status?"auto":"none"},title:e.is_po_download?"다운로드 완료":"엑셀 발주서 다운로드"}),s.jsxs("span",{className:"block truncate",title:e.purchase_order_number||"",children:[e.purchase_order_number||"-",e.purchase_request_items&&e.purchase_request_items.length>1&&s.jsxs("span",{className:"text-gray-500 ml-0.5",children:["(",e.purchase_request_items.length,")"]})]})]})}),("pending"===t||"purchase"===t||"receipt"===t||"done"===t||!t)&&s.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${aa}`,children:s.jsx("span",{className:"badge-stats "+("구매요청"===e.payment_category||"구매 요청"===e.payment_category?"bg-blue-500 text-white":"발주"===e.payment_category?"bg-green-500 text-white":("현장결제"===e.payment_category||"현장 결제"===e.payment_category||e.payment_category,"bg-gray-500 text-white")),children:"발주"===e.payment_category?"발주요청":"구매 요청"===e.payment_category?"구매요청":"현장 결제"===e.payment_category?"현장결제":e.payment_category||"-"})}),s.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${ta}`,children:s.jsx("span",{className:"block truncate",title:e.requester_name||"",children:e.requester_name||"-"})}),s.jsx("td",{className:`py-1.5 card-title whitespace-nowrap ${sa}`,children:_(e.request_date)}),"done"===t&&s.jsx("td",{className:`pl-2 pr-3 py-1.5 card-title whitespace-nowrap text-center overflow-visible text-clip ${va}`,children:s.jsx("span",{className:e.is_utk_checked?"badge-utk-complete":"badge-utk-pending",children:e.is_utk_checked?"완료":"대기"})}),s.jsx("td",{className:`pl-3 pr-2 py-1.5 card-title ${ra}`,children:s.jsx("span",{className:"block truncate",title:e.vendor_name||"",children:e.vendor_name||"-"})}),s.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${la}`,children:s.jsx("span",{className:"block truncate",title:e.contact_name||"",children:e.contact_name||"-"})}),s.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${na} ${e.revised_delivery_request_date?"text-gray-400":""}`,children:_(e.delivery_request_date)}),("receipt"===t||"done"===t||!t)&&s.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${ca}`,children:_(e.revised_delivery_request_date)}),s.jsx("td",{className:`px-2 py-1.5 card-title ${ia}`,children:s.jsx("span",{className:"block truncate",title:e.purchase_request_items?.[0]?.item_name||"",children:e.purchase_request_items?.[0]?.item_name||"-"})}),s.jsx("td",{className:`px-2 py-1.5 card-title ${da}`,children:s.jsx("span",{className:"block truncate",title:e.purchase_request_items?.[0]?.specification||"",children:e.purchase_request_items?.[0]?.specification||"-"})}),s.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${oa}`,children:e.purchase_request_items?.[0]?.quantity||0}),s.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${ma}`,children:e.purchase_request_items?.[0]?.unit_price_value?`${e.purchase_request_items[0].unit_price_value.toLocaleString()} ${He(e.purchase_request_items[0]?.unit_price_currency||"KRW")}`:`0 ${He(e.purchase_request_items?.[0]?.unit_price_currency||"KRW")}`}),s.jsx("td",{className:`px-2 py-1.5 card-amount whitespace-nowrap ${ua}`,children:e.purchase_request_items?.[0]?.amount_value?`${e.purchase_request_items[0].amount_value.toLocaleString()} ${He(e.purchase_request_items[0]?.amount_currency||"KRW")}`:e.total_amount?`${e.total_amount.toLocaleString()} ${He(e.currency||"KRW")}`:`0 ${He(e.currency||"KRW")}`}),"pending"===t&&s.jsxs(s.Fragment,{children:[s.jsx("td",{className:`px-2 py-1.5 card-title ${pa}`,children:s.jsx("span",{className:"block truncate",title:e.purchase_request_items?.[0]?.remark||"",children:e.purchase_request_items?.[0]?.remark||"-"})}),s.jsx("td",{className:`px-2 py-1.5 card-title ${xa}`,children:s.jsx("span",{className:"block truncate",title:e.project_vendor||"",children:e.project_vendor||"-"})}),s.jsx("td",{className:`px-2 py-1.5 card-title ${ba}`,children:s.jsx("span",{className:"block truncate",title:e.project_item||"",children:e.project_item||"-"})}),s.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${ga}`,children:s.jsx("span",{className:"block truncate",title:e.sales_order_number||"",children:e.sales_order_number||"-"})})]}),"purchase"===t&&s.jsxs(s.Fragment,{children:[s.jsx("td",{className:`px-2 py-1.5 card-title ${pa}`,children:s.jsx("span",{className:"block truncate",title:e.purchase_request_items?.[0]?.remark||"",children:e.purchase_request_items?.[0]?.remark||"-"})}),s.jsx("td",{className:`px-2 py-1.5 card-title ${ja}`,children:e.purchase_request_items?.[0]?.link?s.jsx("a",{href:e.purchase_request_items?.[0]?.link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline truncate block",title:e.purchase_request_items?.[0]?.link,children:"링크 보기"}):s.jsx("span",{className:"text-gray-400",children:"-"})}),"purchase"!==t&&"receipt"!==t&&s.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${ha}`,children:s.jsx("span",{className:"block truncate",title:e.vendor_payment_schedule||"",children:e.vendor_payment_schedule||"-"})})]}),"receipt"===t&&s.jsxs(s.Fragment,{children:[s.jsx("td",{className:`px-2 py-1.5 card-title ${pa}`,children:s.jsx("span",{className:"block truncate",title:e.purchase_request_items?.[0]?.remark||"",children:e.purchase_request_items?.[0]?.remark||"-"})}),s.jsx("td",{className:`px-2 py-1.5 card-title ${xa}`,children:s.jsx("span",{className:"block truncate",title:e.project_vendor||"",children:e.project_vendor||"-"})}),s.jsx("td",{className:`px-2 py-1.5 card-title ${ba}`,children:s.jsx("span",{className:"block truncate",title:e.project_item||"",children:e.project_item||"-"})}),s.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${ga}`,children:s.jsx("span",{className:"block truncate",title:e.sales_order_number||"",children:e.sales_order_number||"-"})})]}),("done"===t||!t)&&s.jsxs(s.Fragment,{children:[s.jsx("td",{className:`px-2 py-1.5 card-title ${pa}`,children:s.jsx("span",{className:"block truncate",title:e.purchase_request_items?.[0]?.remark||"",children:e.purchase_request_items?.[0]?.remark||"-"})}),s.jsx("td",{className:`px-2 py-1.5 card-title ${ja}`,children:e.purchase_request_items?.[0]?.link?s.jsx("a",{href:e.purchase_request_items?.[0]?.link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline truncate block",title:e.purchase_request_items?.[0]?.link,children:"링크 보기"}):s.jsx("span",{className:"text-gray-400",children:"-"})}),s.jsx("td",{className:`px-2 py-1.5 card-title ${xa}`,children:s.jsx("span",{className:"block truncate",title:e.project_vendor||"",children:e.project_vendor||"-"})}),s.jsx("td",{className:`px-2 py-1.5 card-title ${ba}`,children:s.jsx("span",{className:"block truncate",title:e.project_item||"",children:e.project_item||"-"})}),s.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${ga}`,children:s.jsx("span",{className:"block truncate",title:e.sales_order_number||"",children:e.sales_order_number||"-"})}),s.jsx("td",{className:`px-2 py-1.5 card-title whitespace-nowrap ${ha}`,children:s.jsx("span",{className:"block truncate",title:e.vendor_payment_schedule||"",children:e.vendor_payment_schedule||"-"})}),s.jsx("td",{className:`px-2 py-1.5 ${_a}`,children:s.jsx("span",{className:"text-gray-400 card-title",children:"-"})}),s.jsx("td",{className:`px-2 py-1.5 ${fa}`,children:s.jsxs("div",{className:"flex items-center justify-center gap-1",children:[s.jsx("div",{className:"bg-gray-200 rounded-full h-1.5 w-8",children:s.jsx("div",{className:"h-1.5 rounded-full "+(100===i.percentage?"bg-green-500":i.percentage>0?"bg-hansl-500":"bg-gray-300"),style:{width:`${i.percentage}%`}})}),s.jsxs("span",{className:"card-title text-gray-600",children:[i.percentage,"%"]})]})})]})]})});Na.displayName="TableRow";const Ca=a.memo(({purchases:e,activeTab:t="done",currentUserRoles:l=[],onRefresh:n,onOptimisticUpdate:c,onPaymentComplete:i,onReceiptComplete:d})=>{const[o,p]=a.useState(null),[h,x]=a.useState(!1),[g,b]=a.useState(!1),[_,f]=a.useState(null),j=m(),w=l&&(l.includes("lead buyer")||l.includes("app_admin"));l.includes("final_approver")||l.includes("app_admin")||l.includes("ceo");const N=a.useCallback(e=>{p(e.id),x(!0)},[]),C=a.useCallback(()=>{x(!1),p(null)},[]),k=a.useCallback(async e=>{try{const{data:s,error:c}=await j.from("purchase_requests").select("*").eq("purchase_order_number",e.purchase_order_number).single();if(c||!s)return void v.error("해당 발주요청번호의 데이터를 찾을 수 없습니다.");const{data:i,error:d}=await j.from("purchase_request_items").select("*").eq("purchase_order_number",e.purchase_order_number).order("line_number");if(d||!i||0===i.length)return void v.error("해당 발주요청번호의 품목 데이터를 찾을 수 없습니다.");const o={vendor_name:e.vendor_name,vendor_phone:"",vendor_fax:"",vendor_contact_name:"",vendor_payment_schedule:""};try{const a=s.vendor_id||e.vendor_id,t=s.contact_id||e.contact_id;if(a){const{data:e}=await j.from("vendors").select("vendor_phone, vendor_fax, vendor_payment_schedule").eq("id",a).single();e&&(o.vendor_phone=e.vendor_phone||"",o.vendor_fax=e.vendor_fax||"",o.vendor_payment_schedule=e.vendor_payment_schedule||"")}if(t){const{data:e}=await j.from("vendor_contacts").select("contact_name, contact_phone, contact_email").eq("id",t).single();e&&(o.vendor_contact_name=e.contact_name||"")}}catch(a){}const m={purchase_order_number:s.purchase_order_number||"",request_date:s.request_date,delivery_request_date:s.delivery_request_date,requester_name:s.requester_name,vendor_name:o.vendor_name||"",vendor_contact_name:o.vendor_contact_name,vendor_phone:o.vendor_phone,vendor_fax:o.vendor_fax,project_vendor:s.project_vendor,sales_order_number:s.sales_order_number,project_item:s.project_item,vendor_payment_schedule:o.vendor_payment_schedule,items:i.map(e=>({line_number:e.line_number,item_name:e.item_name,specification:e.specification,quantity:e.quantity,unit_price_value:e.unit_price_value,amount_value:e.amount_value,remark:e.remark,currency:s.currency||"KRW"}))},u=await async function(e){const a=new((await r(()=>import("./exceljs.min-DowPrxBb.js").then(e=>e.e),__vite__mapDeps([0,1,2]))).Workbook),t=a.addWorksheet("발주서",{pageSetup:{paperSize:9,orientation:"portrait",fitToPage:!0,fitToWidth:1,fitToHeight:1,horizontalCentered:!0,verticalCentered:!0,margins:{left:.3,right:.3,top:.5,bottom:.5,header:.2,footer:.2}}});t.getRow(1).height=29.8;for(let r=2;r<=60;r++)t.getRow(r).height=15.75;t.getRow(1).eachCell(e=>{e.font={...e.font||{},name:"맑은 고딕",size:20}});for(let r=2;r<=60;r++)t.getRow(r).eachCell(e=>{e.font={...e.font||{},name:"맑은 고딕",size:11}});t.mergeCells("A1:G1"),t.mergeCells("A2:B2"),t.mergeCells("C2:D2"),t.mergeCells("F2:G2"),t.mergeCells("A3:B3"),t.mergeCells("C3:D3"),t.mergeCells("F3:G3"),t.mergeCells("A4:B4"),t.mergeCells("C4:D4"),t.mergeCells("F4:G4"),t.mergeCells("A5:B5"),t.mergeCells("C5:D5"),t.mergeCells("F5:G5"),t.mergeCells("A6:B6"),t.mergeCells("C6:D6"),t.mergeCells("F6:G6"),t.mergeCells("A7:B7"),t.mergeCells("C7:D7"),t.mergeCells("F7:G7");try{const e=await fetch("/logo_KOR.png"),s=await e.arrayBuffer(),r=a.addImage({buffer:s,extension:"png"}),l=t.getColumn("D").width||22,n=Math.max(1,7.2*l*.58)+4,c=34,i=3,d=.3;t.addImage(r,{tl:{col:i,row:d},ext:{width:n,height:c}})}catch(p){}t.getCell("D1").value="                발 주 서",t.getCell("D1").alignment={horizontal:"left",vertical:"middle",indent:1},t.getCell("D1").font={bold:!0,size:20},t.getCell("A2").value="업   체   명",t.getCell("A2").font={bold:!0},t.getCell("A3").value="담   당   자",t.getCell("A3").font={bold:!0},t.getCell("A4").value="청   구   일",t.getCell("A4").font={bold:!0},t.getCell("A5").value="TEL.",t.getCell("A5").font={bold:!0},t.getCell("A6").value="FAX.",t.getCell("A6").font={bold:!0},t.getCell("A7").value="입고요청일",t.getCell("A7").font={bold:!0},t.getCell("E2").value="구매요청자",t.getCell("E2").font={bold:!0},t.getCell("E3").value="주         소",t.getCell("E3").font={bold:!0},t.getCell("E4").value="발 주 번 호",t.getCell("E4").font={bold:!0},t.getCell("E5").value="TEL.",t.getCell("E5").font={bold:!0},t.getCell("E6").value="FAX.",t.getCell("E6").font={bold:!0},t.getCell("E7").value="지출 예정일",t.getCell("E7").font={bold:!0},t.getCell("F7").value=e.vendor_payment_schedule||"",t.getCell("C2").value=e.vendor_name,t.getCell("C3").value=e.vendor_contact_name||"",t.getCell("C4").value=ue(e.request_date),t.getCell("C5").value=e.vendor_phone||"",t.getCell("C6").value=e.vendor_fax||"",t.getCell("C7").value=ue(e.delivery_request_date),t.getCell("F2").value=e.requester_name,t.getCell("F3").value="대구광역시 달서구 성서공단북로305",t.getCell("F4").value=e.purchase_order_number,t.getCell("F5").value="(053) 626-7805",t.getCell("F6").value="(053) 657-7905",t.getCell("F5").alignment={horizontal:"center",vertical:"middle"},t.getCell("F6").alignment={horizontal:"center",vertical:"middle"};const s=["No","품명","규격","수량","단가","금액","비고"];for(let r=0;r<s.length;r++)t.getCell(String.fromCharCode(65+r)+"8").value=s[r],t.getCell(String.fromCharCode(65+r)+"8").font={bold:!0},6===r&&(t.getCell("G8").alignment={horizontal:"center",vertical:"middle"});const l=[...e.items].sort((e,a)=>e.line_number-a.line_number),n=l.length,c=9+Math.max(n,45);for(let r=0;r<l.length;r++){const e=l[r],a=9+r;t.getCell("A"+a).value=e.line_number;const s=t.getCell("B"+a);s.value=e.item_name,s.alignment={horizontal:"left",vertical:"middle"},t.getCell("C"+a).value=e.specification,t.getCell("C"+a).alignment={horizontal:"left",vertical:"middle"},t.getCell("D"+a).value=e.quantity;const n=pe(e.currency),c=void 0!==e.unit_price_value&&null!==e.unit_price_value?`${e.unit_price_value.toLocaleString()} ${n}`.trim():"";t.getCell("E"+a).value=c,t.getCell("E"+a).alignment={horizontal:"right",vertical:"middle"};const i=pe(e.currency),d=void 0!==e.amount_value&&null!==e.amount_value?`${e.amount_value.toLocaleString()} ${i}`.trim():"";t.getCell("F"+a).value=d,t.getCell("F"+a).alignment={horizontal:"right",vertical:"middle"};const o=t.getCell("G"+a);o.value=void 0!==e.remark&&null!==e.remark?String(e.remark):"",o.alignment={horizontal:"left",vertical:"middle",wrapText:!1,shrinkToFit:!0}}for(let r=n;r<45;r++){const e=9+r;for(let a=0;a<7;a++)t.getCell(String.fromCharCode(65+a)+e).value=""}t.mergeCells(`A${c}:E${c}`),t.getCell("A"+c).value="합계",t.getCell("A"+c).font={bold:!0};const i=pe(e.items[0]?.currency),d=e.items.reduce((e,a)=>e+(a.amount_value||0),0);t.getCell("F"+c).value=`${d.toLocaleString()} ${i}`.trim(),t.getCell("F"+c).alignment={horizontal:"right",vertical:"middle"};const o=c;for(let r=1;r<=o;r++)for(let e=1;e<=7;e++){const a=String.fromCharCode(64+e)+r,s=t.getCell(a),l=r>=9&&r<c;(5===e||6===e)&&(l||r===c)||3===e&&l||(s.alignment={horizontal:"center",vertical:"middle"}),s.border={top:{style:1===r||2===r||8===r||r===c?"medium":"thin"},left:{style:1===e?"medium":"thin"},right:{style:7===e?"medium":"thin"},bottom:{style:8===r||r===c||r===o?"medium":"thin"}}}for(let r=0;r<n;r++){const e=9+r;t.getCell("C"+e).alignment={horizontal:"left",vertical:"middle"}}for(let r=2;r<=7;r++)t.getCell("B"+r).border={...t.getCell("B"+r).border,right:{style:"medium"}},t.getCell("D"+r).border={...t.getCell("D"+r).border,right:{style:"medium"}},r<=6&&(t.getCell("E"+r).border={...t.getCell("E"+r).border,right:{style:"medium"}});t.getCell("E7").border={...t.getCell("E7").border,top:{style:"thin"},right:{style:"medium"}},t.getCell("G7").border={...t.getCell("G7").border,top:{style:"thin"}};for(let r=1;r<=7;r++){const e=t.getCell("A"+r).border||{};t.getCell("A"+r).border={...e,left:{style:"medium"}}}const m=t.getCell("A"+c).border||{};t.getCell("A"+c).border={...m,left:{style:"medium"}},Object.entries({A:4.7,B:23,C:30,D:11,E:15,F:16,G:37}).forEach(([e,a])=>{t.getColumn(e).width=a}),t.getRow(1).height=29.8,t.getRow(1).eachCell(e=>{e.font={...e.font||{},name:"맑은 고딕",size:20}});for(let r=2;r<=o;r++){const e=t.getRow(r);e.height=15.75,e.eachCell(e=>{e.font={...e.font||{},name:"맑은 고딕",size:11}})}for(let r=9;r<=o;r++)t.getCell("G"+r).alignment={horizontal:"left",vertical:"middle",wrapText:!1,shrinkToFit:!0},t.getCell("B"+r).alignment={horizontal:"left",vertical:"middle"};const u=await a.xlsx.writeBuffer();return new Blob([u],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})}(m),p=`발주서_${m.vendor_name}_${m.purchase_order_number}.xlsx`,h=window.URL.createObjectURL(u),x=document.createElement("a");x.href=h,x.download=p,document.body.appendChild(x),x.click(),document.body.removeChild(x),window.URL.revokeObjectURL(h),v.success("엑셀 파일이 다운로드되었습니다.");try{if(l&&l.includes("lead buyer")){const{error:a}=await j.from("purchase_requests").update({is_po_download:!0}).eq("purchase_order_number",e.purchase_order_number);a||n?.()}}catch(t){}}catch(a){v.error("엑셀 다운로드에 실패했습니다.")}},[j]),$=a.useCallback(async()=>{if(_){u.debug("발주 삭제 확인",{id:_.id,purchase_order_number:_.purchase_order_number,requester_name:_.requester_name,final_manager_status:_.final_manager_status});try{const e="https://qvhbigvdfyvhoegkhvef.supabase.co";if(!e||!"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF2aGJpZ3ZkZnl2aG9lZ2todmVmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc4MTQzNjAsImV4cCI6MjA2MzM5MDM2MH0.7VZlSwnNuE0MaQpDjuzeZFgjJrDBQOWA_COyqaM8Rbg"||e.includes("placeholder"))return u.warn("Supabase 환경 변수가 설정되지 않음 - FastPurchaseTable"),void v.error("환경 설정 오류가 발생했습니다.");const{data:{user:a},error:t}=await j.auth.getUser();if(t||!a)return void v.error("로그인이 필요합니다.");const{data:s,error:r}=await j.from("employees").select("name, email, purchase_role").eq("email",a.email).single();if(u.debug("사용자 권한 확인",{employee:s?.name,roles:s?.purchase_role,email:s?.email}),r||!s)return void v.error("사용자 권한을 확인할 수 없습니다.");let l=[];if(s.purchase_role)if(Array.isArray(s.purchase_role))l=s.purchase_role.map(e=>String(e).trim());else{l=String(s.purchase_role).split(",").map(e=>e.trim()).filter(e=>e.length>0)}const c=l.includes("final_approver")||l.includes("app_admin")||l.includes("ceo"),i="approved"===_.final_manager_status,d=_.requester_name===s.name,o=i?c:c||d;if(u.debug("삭제 권한 확인",{canEdit:c,isApproved:i,isRequester:d,canDeleteThis:o,userRoles:l}),!o)return void v.error("삭제 권한이 없습니다.");const{data:m,error:p}=await j.from("purchase_request_items").delete().eq("purchase_request_id",_.id).select();if(p)throw u.error("아이템 삭제 중 오류 발생",p,{code:p.code,message:p.message,details:p.details,hint:p.hint}),p;u.debug("아이템 삭제 완료",{deletedItemsCount:m?.length||0,purchaseRequestId:_.id});const{data:h,error:x}=await j.from("purchase_requests").delete().eq("id",_.id).select();if(x)throw u.error("발주요청 삭제 중 오류 발생",x,{code:x.code,message:x.message,details:x.details,hint:x.hint}),x;u.debug("발주요청 삭제 완료",{deletedRequestId:_.id,purchase_order_number:_.purchase_order_number}),v.success("발주요청 내역이 삭제되었습니다."),n?.()}catch(e){const a=e;u.error("발주요청 삭제 중 예외 발생",a,{name:a?.name,message:a?.message,code:a?.code,details:a?.details,hint:a?.hint,stack:a?.stack}),v.error(`삭제 중 오류가 발생했습니다: ${a?.message||"알 수 없는 오류"}`)}b(!1),f(null)}},[j,_,n]),q=a.useMemo(()=>{if("pending"===t)return s.jsx("thead",{className:"bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${Xe}`,children:"승인상태"}),s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${Qe}`,children:"발주번호"}),s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${aa}`,children:"결제종류"}),s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${ta}`,children:"요청자"}),s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${sa}`,children:"청구일"}),s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${ra}`,children:"업체"}),s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${la}`,children:"담당자"}),s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${na}`,children:"입고요청일"}),s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${ia}`,children:"품명"}),s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${da}`,children:"규격"}),s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${oa}`,children:"수량"}),s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${ma}`,children:"단가"}),s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${ua}`,children:"합계"}),s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${pa}`,children:"비고"}),s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${xa}`,children:"PJ업체"}),s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${ba}`,children:"PJ ITEM"}),s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${ga}`,children:"수주번호"})]})});const e=s.jsxs(s.Fragment,{children:[s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${"purchase"===t?ea:Qe}`,children:"발주번호"}),("purchase"===t||"receipt"===t||"done"===t||!t)&&s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${aa}`,children:"결제종류"}),s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${ta}`,children:"요청자"}),s.jsx("th",{className:`py-1.5 modal-label text-gray-900 whitespace-nowrap ${sa}`,children:"청구일"}),"done"===t&&s.jsx("th",{className:`pl-2 pr-3 py-1.5 modal-label text-gray-900 whitespace-nowrap text-center ${va}`,children:"UTK"}),s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${ra}`,children:"업체"}),s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${la}`,children:"담당자"}),s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${na}`,children:"입고요청일"}),("receipt"===t||"done"===t||!t)&&s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${ca}`,children:"변경 입고일"}),s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${ia}`,children:"품명"}),s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 text-left ${da}`,children:"규격"}),s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${oa}`,children:"수량"}),s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${ma}`,children:"단가"}),s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${ua}`,children:"합계"})]});let a=null;return a="purchase"===t?s.jsxs(s.Fragment,{children:[s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${pa}`,children:"비고"}),s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${ja}`,children:"링크"}),s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${ha}`,children:"지출예정일"})]}):"receipt"===t?s.jsxs(s.Fragment,{children:[s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${pa}`,children:"비고"}),s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${xa}`,children:"PJ업체"}),s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${ba}`,children:"PJ ITEM"}),s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${ga}`,children:"수주번호"})]}):s.jsxs(s.Fragment,{children:[s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${pa}`,children:"비고"}),s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${ja}`,children:"링크"}),s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${xa}`,children:"PJ업체"}),s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${ba}`,children:"PJ ITEM"}),s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${ga}`,children:"수주번호"}),s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap text-left ${ha}`,children:"지출예정일"}),s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${_a}`,children:"구매진행"}),s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${fa}`,children:"입고진행"})]}),s.jsx("thead",{className:"bg-gray-50",children:s.jsxs("tr",{children:["purchase"===t&&s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${ya}`,children:"구매진행"}),"receipt"===t&&s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${ya}`,children:"입고진행"}),"done"===t&&s.jsx("th",{className:`px-2 py-1.5 modal-label text-gray-900 whitespace-nowrap ${ya}`,children:"거래명세서"}),e,a]})})},[t]);return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"hidden md:block w-full",children:s.jsx("div",{className:"overflow-x-auto border rounded-lg",children:s.jsxs("table",{className:"w-full min-w-[1790px] border-collapse",children:[q,s.jsx("tbody",{children:e.map(e=>s.jsx(Na,{purchase:e,onClick:N,activeTab:t,isLeadBuyer:w,onPaymentComplete:i,onReceiptComplete:d,onExcelDownload:k},e.id))})]})})}),s.jsx("div",{className:"hidden sm:block md:hidden w-full",children:s.jsx("div",{className:"overflow-x-auto border rounded-lg",children:s.jsxs("table",{className:"w-full min-w-[600px] card-title",children:[s.jsx("thead",{className:"bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"text-left p-2 modal-label text-gray-900 w-24",children:"발주번호"}),s.jsx("th",{className:"text-left p-2 modal-label text-gray-900 w-16",children:"요청자"}),s.jsx("th",{className:"text-left p-2 modal-label text-gray-900 w-20",children:"업체"}),s.jsx("th",{className:"text-left p-2 modal-label text-gray-900 w-32",children:"품명"}),s.jsx("th",{className:"text-right p-2 modal-label text-gray-900 w-20",children:"금액"}),s.jsx("th",{className:"text-center p-2 modal-label text-gray-900 w-16",children:"상태"})]})}),s.jsx("tbody",{children:e.map(e=>s.jsxs("tr",{className:"border-b hover:bg-gray-50 cursor-pointer",onClick:()=>N(e),children:[s.jsx("td",{className:"p-2 modal-value",children:e.purchase_order_number||"-"}),s.jsx("td",{className:"p-2",children:e.requester_name}),s.jsx("td",{className:"p-2 truncate",title:e.vendor_name,children:e.vendor_name}),s.jsx("td",{className:"p-2 truncate",title:e.purchase_request_items?.[0]?.item_name,children:e.purchase_request_items?.[0]?.item_name||"-"}),s.jsx("td",{className:"p-2 text-right card-amount",children:e.purchase_request_items?.[0]?.amount_value?`${e.purchase_request_items[0].amount_value.toLocaleString()} ${He(e.purchase_request_items[0]?.amount_currency||"KRW")}`:e.total_amount?`${e.total_amount.toLocaleString()} ${He(e.currency||"KRW")}`:`0 ${He(e.currency||"KRW")}`}),s.jsx("td",{className:"p-2 text-center",children:s.jsx(Ze,{purchase:e})})]},e.id))})]})})}),s.jsx("div",{className:"sm:hidden space-y-3",children:e.map(e=>s.jsx(me,{purchase:e,onClick:()=>N(e)},e.id))}),s.jsx(y,{purchaseId:o,isOpen:h,onClose:C,currentUserRoles:l,activeTab:t,onRefresh:n,onOptimisticUpdate:c,onDelete:e=>{f(e),b(!0)}}),s.jsx(Le,{open:g,onOpenChange:b,children:s.jsxs(Ye,{children:[s.jsxs(We,{children:[s.jsx(Je,{children:"발주요청 내역 삭제"}),s.jsxs(Ge,{children:["발주요청번호 ",_?.purchase_order_number,"를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."]})]}),s.jsxs(Ue,{children:[s.jsx(Ve,{children:"취소"}),s.jsx(Ke,{onClick:$,className:"bg-red-600 hover:bg-red-700",children:"삭제"})]})]})})]})});Ca.displayName="FastPurchaseTable";const ka=[{key:"date_range",label:"기간별",type:"date_range",icon:U,category:"날짜"},{key:"date_month",label:"월별",type:"date_month",icon:U,category:"날짜"},{key:"requester_name",label:"요청자",type:"searchable_select",icon:x,category:"사용자"},{key:"vendor_name",label:"업체",type:"searchable_select",icon:ae,category:"사용자"},{key:"contact_name",label:"담당자",type:"searchable_select",icon:x,category:"사용자"},{key:"purchase_order_number",label:"발주번호",type:"text",icon:J,category:"텍스트"},{key:"item_name",label:"품명",type:"text",icon:J,category:"텍스트"},{key:"specification",label:"규격",type:"text",icon:J,category:"텍스트"},{key:"remark",label:"비고",type:"text",icon:J,category:"텍스트"},{key:"project_vendor",label:"PJ업체",type:"text",icon:ae,category:"텍스트"},{key:"project_item",label:"PJ ITEM",type:"text",icon:J,category:"텍스트"},{key:"sales_order_number",label:"수주번호",type:"text",icon:J,category:"텍스트"},{key:"quantity",label:"수량",type:"number",icon:te,category:"숫자"},{key:"unit_price_value",label:"단가",type:"number",icon:te,category:"숫자"},{key:"total_amount",label:"합계",type:"number",icon:te,category:"숫자"},{key:"payment_category",label:"결제종류",type:"select",icon:B,category:"상태",options:["현장결제","구매요청","발주요청"]},{key:"payment_schedule",label:"지출예정일",type:"select_with_empty",icon:U,category:"상태"},{key:"is_payment_completed",label:"구매현황",type:"select",icon:G,category:"상태",options:["대기","완료"]},{key:"is_received",label:"입고현황",type:"select",icon:G,category:"상태",options:["대기","완료"]},{key:"is_statement_received",label:"거래명세서 확인",type:"select",icon:G,category:"상태",options:["대기","완료"]},{key:"is_utk_checked",label:"UTK 확인",type:"select",icon:B,category:"상태",options:["대기","완료"]}],$a=[{value:"request_date",label:"청구일"},{value:"delivery_request_date",label:"입고요청일"},{value:"payment_completed_at",label:"구매완료일"},{value:"received_at",label:"입고완료일"},{value:"created_at",label:"생성일"},{value:"statement_received_at",label:"거래명세서입고일"}],qa=[{value:"request_date",label:"요청일"},{value:"purchase_order_number",label:"발주번호"},{value:"vendor_name",label:"업체명"},{value:"requester_name",label:"요청자"},{value:"total_amount",label:"합계"},{value:"delivery_request_date",label:"입고요청일"},{value:"created_at",label:"생성일"}];function Da({activeFilters:e,sortConfig:t,searchTerm:r,onFiltersChange:l,onSortChange:n,onSearchChange:c,availableEmployees:i=[],availableVendors:d=[],availableContacts:o=[],availablePaymentSchedules:m=[]}){const[u,x]=a.useState(!1),[g,b]=a.useState(!1),[y,_]=a.useState(!1),[f,j]=a.useState({}),[v,w]=a.useState(!1),[N,C]=a.useState(!1),[k,$]=a.useState({}),[q,D]=a.useState(),[S,F]=a.useState({}),[M,B]=a.useState({}),[J,Z]=a.useState(""),H=a.useRef(null);a.useEffect(()=>{y&&H.current&&H.current.focus()},[y]),a.useEffect(()=>{g&&B({field:t?.field||"",direction:t?.direction||"asc"})},[g,t]);const X=a=>{l(e.filter(e=>e.id!==a))},Q=()=>{const e=ka.find(e=>e.key===f.field);if(!e)return null;switch(e.type){case"text":return s.jsx(A,{placeholder:"값 입력",value:f.value||"",onChange:e=>j(a=>({...a,value:e.target.value})),className:"w-full business-radius-input border border-gray-300 bg-white text-gray-700 card-description h-auto",style:{padding:"2px 10px",fontSize:"10px",fontWeight:"500"}});case"number":return s.jsx(A,{type:"number",placeholder:"숫자 입력",value:f.value||"",onChange:e=>j(a=>({...a,value:e.target.value})),className:"w-full business-radius-input border border-gray-300 bg-white text-gray-700 card-description h-auto",style:{padding:"2px 10px",fontSize:"10px",fontWeight:"500"}});case"searchable_select":let a=[],t="선택";"requester_name"===e.key?(a=i,t="요청자"):"vendor_name"===e.key?(a=d,t="업체"):"contact_name"===e.key&&(a=o,t="담당자");const r=a.filter(e=>e.toLowerCase().includes(J.toLowerCase()));return s.jsxs(R,{onOpenChange:e=>{e||Z("")},children:[s.jsx(E,{asChild:!0,children:s.jsxs(p,{variant:"outline",role:"combobox",className:"w-full button-base business-radius-button border border-gray-300 bg-white text-gray-700 justify-between [&>svg]:hidden",children:[s.jsx("span",{className:"truncate text-left",style:{fontSize:"12px",fontWeight:"500"},children:f.value||t}),s.jsx(V,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),s.jsx(P,{className:"w-[200px] p-1 border-0 shadow-lg",align:"start",children:s.jsxs("div",{className:"space-y-1",children:[s.jsx(A,{placeholder:`${t} 검색...`,className:"h-auto border-0 focus:ring-0 focus:outline-none card-description placeholder:card-description",style:{padding:"2px 10px"},value:J,onChange:e=>Z(e.target.value),autoFocus:!0}),s.jsx("div",{className:"max-h-[200px] overflow-y-auto",children:0===r.length?s.jsx("div",{className:"p-2 text-sm text-gray-500",children:J?"검색 결과가 없습니다":`${t}를 찾을 수 없습니다`}):r.map(e=>s.jsxs(p,{variant:"ghost",onClick:()=>{j(a=>({...a,value:e})),Z("")},className:"w-full justify-start p-2 h-auto hover:bg-gray-100 text-left",children:[s.jsx(G,{className:"mr-2 h-3 w-3 "+(f.value===e?"opacity-100":"opacity-0")}),s.jsx("span",{className:"card-description",children:e})]},e))})]})})]});case"select":return s.jsxs(T,{value:f.value||"",onValueChange:e=>j(a=>({...a,value:e})),children:[s.jsx(z,{className:"button-base business-radius-button border border-gray-300 bg-white text-gray-700 [&>svg]:hidden text-center",children:s.jsx(I,{placeholder:"선택"})}),s.jsx(L,{children:e.options?.map(e=>s.jsx(O,{value:e,children:s.jsx("span",{className:"card-description",children:e})},e))})]});case"select_with_empty":const l=["공란",...m];return s.jsxs(T,{value:f.value||"",onValueChange:e=>j(a=>({...a,value:e})),children:[s.jsx(z,{className:"button-base business-radius-button border border-gray-300 bg-white text-gray-700 [&>svg]:hidden text-center",children:s.jsx(I,{placeholder:"지출예정일"})}),s.jsx(L,{children:l.map(e=>s.jsx(O,{value:e,children:s.jsx("span",{className:"card-description",children:e})},e))})]});case"date_range":return s.jsxs(R,{open:v,onOpenChange:e=>{if(e)if(f.value)if(f.value.includes("~")){const[e,a]=f.value.split("~");$({from:new Date(e),to:new Date(a)})}else $({from:new Date(f.value),to:void 0});else $({});w(e)},children:[s.jsx(E,{asChild:!0,children:s.jsx(p,{variant:"outline",className:"w-full button-base business-radius-button border border-gray-300 bg-white text-gray-700 justify-between h-auto",children:s.jsxs("div",{className:"flex items-center gap-1.5 min-h-[32px]",children:[s.jsx(U,{className:"w-3 h-3 flex-shrink-0"}),s.jsx("span",{className:"card-description leading-tight whitespace-pre-line",children:f.value?(()=>{if(f.value.includes("~")){const[e,a]=f.value.split("~");return`${Y(new Date(e),"yy/MM/dd")}\n~ ${Y(new Date(a),"yy/MM/dd")}`}return Y(new Date(f.value),"yy/MM/dd")})():"날짜 선택"})]})})}),s.jsx(P,{className:"w-auto p-0",align:"start",children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"p-3 pb-0",children:[s.jsx("div",{className:"text-xs font-medium text-gray-600 mb-2",children:"날짜 범위 선택"}),s.jsx(W,{mode:"range",selected:k,onSelect:e=>{e&&$(e)},numberOfMonths:1,initialFocus:!0,className:"compact-calendar"})]}),s.jsxs("div",{className:"flex gap-2 p-3 pt-0",children:[s.jsx(p,{onClick:()=>{$({}),w(!1)},variant:"outline",className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 flex-1",children:"취소"}),s.jsx(p,{onClick:()=>{if(k.from){if(k.to){const e=`${Y(k.from,"yyyy-MM-dd")}~${Y(k.to,"yyyy-MM-dd")}`;j(a=>({...a,value:e}))}else j(e=>({...e,value:Y(k.from,"yyyy-MM-dd")}));w(!1)}},disabled:!k.from,className:"button-base bg-blue-500 text-white hover:bg-blue-600 flex-1",children:"확인"})]})]})})]});case"date_month":return s.jsxs(R,{open:N,onOpenChange:e=>{if(e)if(f.value)if(f.value.includes("~")){const[e,a]=f.value.split("~");F({from:new Date(`${e}-01`),to:new Date(`${a}-01`)})}else F({from:new Date(`${f.value}-01`),to:void 0});else F({});C(e)},children:[s.jsx(E,{asChild:!0,children:s.jsx(p,{variant:"outline",className:"w-full button-base business-radius-button border border-gray-300 bg-white text-gray-700 justify-between h-auto",children:s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx(U,{className:"w-3 h-3 flex-shrink-0"}),s.jsx("span",{className:"card-description leading-tight whitespace-pre-line",children:f.value?(()=>{if(f.value.includes("~")){const[e,a]=f.value.split("~"),[t,s]=e.split("-"),[r,l]=a.split("-");return`${t.slice(-2)}/${s}\n~ ${r.slice(-2)}/${l}`}{const[e,a]=f.value.split("-");return`${e.slice(-2)}/${a}`}})():"월 선택"})]})})}),s.jsx(P,{className:"w-auto p-0",align:"start",children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"p-3 pb-0",children:[s.jsx("div",{className:"text-xs font-medium text-gray-600 mb-3",children:"월 선택"}),s.jsxs("div",{className:"flex gap-4",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"시작 월 선택"}),s.jsx("div",{className:"mb-3",children:s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(p,{onClick:()=>{const e=S.from?S.from.getFullYear():(new Date).getFullYear(),a=new Date(e-1,S.from?S.from.getMonth():0,1);F(e=>({...e,from:a}))},variant:"outline",size:"sm",className:"button-base border border-gray-300 bg-white text-gray-600 hover:bg-gray-50",children:"‹"}),s.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[S.from?S.from.getFullYear():(new Date).getFullYear(),"년"]}),s.jsx(p,{onClick:()=>{const e=S.from?S.from.getFullYear():(new Date).getFullYear(),a=new Date(e+1,S.from?S.from.getMonth():0,1);F(e=>({...e,from:a}))},variant:"outline",size:"sm",className:"button-base border border-gray-300 bg-white text-gray-600 hover:bg-gray-50",children:"›"})]})}),s.jsx("div",{className:"grid grid-cols-3 gap-2",children:Array.from({length:12},(e,a)=>{const t=S.from?S.from.getFullYear():(new Date).getFullYear(),r=new Date(t,a,1),l=S.from&&S.from.getFullYear()===t&&S.from.getMonth()===a;return s.jsxs(p,{onClick:()=>{F(e=>({...e,from:r}))},variant:"outline",className:"button-base text-xs h-8 "+(l?"bg-blue-500 text-white border-blue-500 hover:bg-blue-600":"border-gray-300 bg-white text-gray-700 hover:bg-gray-50"),children:[a+1,"월"]},a)})})]}),S.from&&s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"종료 월 선택 (선택사항)"}),s.jsx("div",{className:"mb-3",children:s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(p,{onClick:()=>{const e=S.to?S.to.getFullYear():S.from.getFullYear(),a=new Date(e-1,S.to?S.to.getMonth():11,1);F(e=>({...e,to:a}))},variant:"outline",size:"sm",className:"button-base border border-gray-300 bg-white text-gray-600 hover:bg-gray-50",children:"‹"}),s.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[S.to?S.to.getFullYear():S.from.getFullYear(),"년"]}),s.jsx(p,{onClick:()=>{const e=S.to?S.to.getFullYear():S.from.getFullYear(),a=new Date(e+1,S.to?S.to.getMonth():11,1);F(e=>({...e,to:a}))},variant:"outline",size:"sm",className:"button-base border border-gray-300 bg-white text-gray-600 hover:bg-gray-50",children:"›"})]})}),s.jsx("div",{className:"grid grid-cols-3 gap-2",children:Array.from({length:12},(e,a)=>{const t=S.to?S.to.getFullYear():S.from.getFullYear(),r=new Date(t,a,1),l=S.to&&S.to.getFullYear()===t&&S.to.getMonth()===a,n=r<S.from;return s.jsxs(p,{onClick:()=>{n||F(e=>({...e,to:r}))},variant:"outline",disabled:n,className:"button-base text-xs h-8 "+(l?"bg-blue-500 text-white border-blue-500 hover:bg-blue-600":n?"border-gray-200 bg-gray-100 text-gray-400 cursor-not-allowed":"border-gray-300 bg-white text-gray-700 hover:bg-gray-50"),children:[a+1,"월"]},a)})}),s.jsx("div",{className:"mt-3",children:s.jsx(p,{onClick:()=>{F(e=>({...e,to:void 0}))},variant:"outline",size:"sm",className:"button-base border border-gray-300 bg-white text-gray-600 hover:bg-gray-50 text-xs",children:"종료 월 제거"})})]})]})]}),s.jsxs("div",{className:"flex gap-2 p-3 pt-0",children:[s.jsx(p,{onClick:()=>{F({}),C(!1)},variant:"outline",className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 flex-1",children:"취소"}),s.jsx(p,{onClick:()=>{if(S.from){if(S.to){const e=`${Y(S.from,"yyyy-MM")}~${Y(S.to,"yyyy-MM")}`;j(a=>({...a,value:e}))}else j(e=>({...e,value:Y(S.from,"yyyy-MM")}));C(!1)}},disabled:!S.from,className:"button-base bg-blue-500 text-white hover:bg-blue-600 flex-1",children:"확인"})]})]})})]});default:return null}};return s.jsxs("div",{className:"w-full space-y-3",children:[s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(R,{open:u,onOpenChange:x,children:[s.jsx(E,{asChild:!0,children:s.jsxs(p,{variant:"outline",className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50",children:[s.jsx(re,{className:"w-4 h-4 mr-1"}),s.jsx("span",{className:"button-text",children:"필터"}),e.length>0&&s.jsx("span",{className:"ml-1 badge-stats bg-blue-50 text-blue-700",children:e.length})]})}),s.jsx(P,{className:"w-64 p-3",align:"start",children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h4",{className:"card-title",children:"필터"}),e.length>0&&s.jsx(p,{variant:"ghost",onClick:()=>{l([]),x(!1)},className:"button-base text-red-600 hover:text-red-700 hover:bg-red-50",children:s.jsx("span",{className:"button-text",children:"모두 지우기"})})]}),e.length>0&&s.jsxs("div",{className:"space-y-2",children:[e.map(e=>s.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 business-radius",children:[s.jsxs("span",{className:"card-description",children:[e.label,e.dateField&&s.jsxs("span",{className:"text-blue-600",children:["(",$a.find(a=>a.value===e.dateField)?.label,")"]}),": ",e.value]}),s.jsx(p,{variant:"ghost",onClick:()=>X(e.id),className:"button-base h-6 w-6 p-0 hover:bg-red-50",children:s.jsx(h,{className:"w-3 h-3"})})]},e.id)),s.jsx("div",{className:"border-t border-gray-200 my-2"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs(T,{onValueChange:e=>{const a=ka.find(a=>a.key===e);if(!a)return;let t="contains";"date_range"!==a.type&&"date_month"!==a.type||(t="equals"),j({id:`${e}_${Date.now()}`,field:e,condition:t,value:"",label:a.label})},children:[s.jsx(z,{className:"button-base business-radius-button border border-gray-300 bg-white text-gray-700 [&>svg]:hidden text-center",children:s.jsx(I,{placeholder:"+ 필터 추가"})}),s.jsx(L,{className:"w-64 max-h-80 overflow-y-auto",style:{scrollbarWidth:"auto",scrollbarColor:"#9ca3af #f3f4f6",WebkitScrollbarWidth:"8px"},children:Object.entries(ka.reduce((e,a)=>(e[a.category]||(e[a.category]=[]),e[a.category].push(a),e),{})).map(([e,a])=>s.jsxs("div",{children:[s.jsx("div",{className:"px-2 py-1 card-description uppercase",children:e}),a.map(e=>s.jsx(O,{value:e.key,children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(e.icon,{className:"w-4 h-4"}),s.jsx("span",{className:"card-description",children:e.label})]})},e.key))]},e))})]}),f.field&&s.jsxs("div",{className:"space-y-2 p-3 border business-radius bg-white",children:[s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("span",{className:"card-title",children:[f.label," 필터"]})}),"date_range"===f.field||"date_month"===f.field?s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsx("div",{className:"flex items-start",children:s.jsxs(T,{value:f.dateField||"",onValueChange:e=>j(a=>({...a,dateField:e})),children:[s.jsx(z,{className:"w-full button-base business-radius-button border border-gray-300 bg-white text-gray-700 [&>svg]:hidden text-center justify-center",children:s.jsx(I,{placeholder:"날짜 항목",className:"text-center"})}),s.jsx(L,{children:$a.map(e=>s.jsx(O,{value:e.value,children:s.jsx("span",{className:"card-description",children:e.label})},e.value))})]})}),s.jsx("div",{className:"flex items-start",children:Q()})]}):s.jsx("div",{children:Q()}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(p,{onClick:()=>{const a="date_range"===f.field||"date_month"===f.field,t=a&&!f.dateField;let s=f.condition;if(!s)if(a)s="equals";else{const e=ka.find(e=>e.key===f.field);s="select"===e?.type||"select_with_empty"===e?.type||"searchable_select"===e?.type?"equals":"contains"}if(f.field&&void 0!==s&&""!==f.value&&!t){const a={id:f.id,field:f.field,condition:s,value:f.value,label:f.label,dateField:f.dateField};l([...e,a]),j({}),x(!1)}},disabled:!f.field||""===f.value||("date_range"===f.field||"date_month"===f.field)&&!f.dateField,className:"button-base bg-blue-500 text-white hover:bg-blue-600 flex-1",children:"적용"}),s.jsx(p,{variant:"outline",onClick:()=>j({}),className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 flex-1",children:"취소"})]})]})]})]})})]}),s.jsxs(R,{open:g,onOpenChange:b,children:[s.jsx(E,{asChild:!0,children:s.jsxs(p,{variant:"outline",className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50",children:[s.jsx(K,{className:"w-4 h-4 mr-1"}),s.jsx("span",{className:"button-text",children:"정렬"}),t&&s.jsxs("span",{className:"ml-1 card-description",children:["(","asc"===t.direction?"↑":"↓",")"]})]})}),s.jsx(P,{className:"w-56 p-3",align:"start",children:s.jsxs("div",{className:"space-y-3",children:[s.jsx("h4",{className:"card-title",children:"정렬 설정"}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"정렬 기준"}),s.jsxs(T,{value:M.field||"",onValueChange:e=>{B(a=>({...a,field:e}))},children:[s.jsx(z,{className:"button-base business-radius-button border border-gray-300 bg-white text-gray-700 [&>svg]:hidden",children:s.jsx(I,{placeholder:"선택하세요"})}),s.jsx(L,{children:qa.map(e=>s.jsx(O,{value:e.value,children:s.jsx("span",{className:"card-description",children:e.label})},e.value))})]})]}),M.field&&s.jsxs("div",{children:[s.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"정렬 방향"}),s.jsxs(T,{value:M.direction||"",onValueChange:e=>{B(a=>({...a,direction:e}))},children:[s.jsx(z,{className:"button-base business-radius-button border border-gray-300 bg-white text-gray-700 [&>svg]:hidden",children:s.jsx(I,{placeholder:"선택하세요"})}),s.jsxs(L,{children:[s.jsx(O,{value:"asc",children:s.jsx("span",{className:"card-description",children:"오름차순 ↑"})}),s.jsx(O,{value:"desc",children:s.jsx("span",{className:"card-description",children:"내림차순 ↓"})})]})]})]}),s.jsxs("div",{className:"flex gap-2 pt-2",children:[s.jsx(p,{onClick:()=>{if(M.field&&M.direction){const e=qa.find(e=>e.value===M.field);e&&n({field:M.field,direction:M.direction,label:e.label})}b(!1),B({})},disabled:!M.field||!M.direction,className:"button-base bg-blue-500 hover:bg-blue-600 text-white flex-1",children:"적용"}),s.jsx(p,{onClick:()=>{n(null),B({}),b(!1)},className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50",children:"초기화"})]})]}),t&&s.jsx("div",{className:"border-t pt-2",children:s.jsx(p,{variant:"outline",onClick:()=>n(null),className:"button-base w-full border border-gray-300 text-gray-700",children:s.jsx("span",{className:"button-text",children:"정렬 해제"})})})]})})]}),s.jsx("div",{className:"flex items-center gap-2",children:y?s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(A,{ref:H,placeholder:"전체 검색...",value:r,onChange:e=>c(e.target.value),className:"w-64 business-radius-input button-base border border-gray-300 bg-white text-gray-700"}),s.jsx(p,{variant:"ghost",onClick:()=>{_(!1),c("")},className:"button-base h-8 w-8 p-0",children:s.jsx(h,{className:"w-4 h-4"})})]}):s.jsxs(p,{variant:"outline",onClick:()=>_(!0),className:"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50",children:[s.jsx(V,{className:"w-4 h-4 mr-1"}),s.jsx("span",{className:"button-text",children:"검색"})]})}),s.jsxs(p,{variant:"outline",onClick:()=>{c(""),l([]),n({field:"created_at",direction:"desc",label:"생성일"}),_(!1)},className:"button-base border border-gray-300 bg-white text-blue-600 hover:bg-blue-50 hover:border-blue-300",children:["↻ ",s.jsx("span",{className:"button-text text-blue-600",children:"초기화"})]})]})}),e.length>0&&s.jsx("div",{className:"flex flex-wrap gap-2",children:e.map(e=>s.jsxs("span",{className:"badge-stats flex items-center gap-1 bg-blue-50 text-blue-700 border border-blue-200",children:[e.label,e.dateField&&s.jsxs("span",{className:"text-blue-600",children:["(",$a.find(a=>a.value===e.dateField)?.label,")"]}),": ",e.value,s.jsx(p,{variant:"ghost",size:"sm",onClick:()=>X(e.id),className:"h-4 w-4 p-0 hover:bg-blue-100 ml-1",children:s.jsx(h,{className:"w-3 h-3"})})]},e.id))})]})}const Sa=["purchase_manager","app_admin","raw_material_manager","consumable_manager"],Fa=["정희웅"];function Ma(e,a){return t=a,Sa.some(e=>t.includes(e))?e:e.filter(e=>!Fa.includes(e.requester_name));var t}const Aa=a.lazy(()=>r(()=>import("./PurchaseItemsModal-Y-xrtiYl.js"),__vite__mapDeps([3,1,2,4,5,6,7,8,9,10,11,12,13,14,15,16,17]))),Ra=[{key:"pending",label:"승인대기"},{key:"purchase",label:"구매 현황"},{key:"receipt",label:"입고 현황"},{key:"done",label:"전체 항목"}];function Ea({showEmailButton:e=!0}){const t=g(),r=b(),l=m(),[n,c]=a.useState(null),[i,d]=a.useState(!1),[o,h]=a.useState([]),[x,y]=a.useState({field:"created_at",direction:"desc",label:"생성일"}),[_,f]=a.useState(""),[j,w]=a.useState([]),[N,C]=a.useState([]),[k,$]=a.useState([]),[q,D]=a.useState([]),{allPurchases:S,loading:F,currentUser:M,getFilteredPurchases:A}=de(),R=Array.isArray(M?.purchase_role)?M.purchase_role.map(e=>e.trim()):"string"==typeof M?.purchase_role?M.purchase_role.split(",").map(e=>e.trim()):[],E=M?.name||null,P=a.useCallback(async()=>{},[]),T=a.useCallback(()=>{},[]),z=R?.includes("app_admin"),[I,L]=a.useState("pending"),[O,B]=a.useState("");a.useMemo(()=>Ma(S,R),[S,R]);const Y=a.useMemo(()=>{return(e=R)&&0!==e.length?e.includes("app_admin")||e.includes("ceo")?3:e.includes("consumable_manager")||e.includes("raw_material_manager")||e.includes("purchase_manager")||e.includes("middle_manager")?2:1:1;var e},[R]),W=a.useCallback(e=>{if(!E)return"all";switch(Y){case 1:case 2:return"done"===e?"all":E;case 3:return"all";default:return E}},[E,Y]);a.useEffect(()=>{if(!E)return;const e=W(I);B(e)},[I,E,W]),a.useEffect(()=>{const e=new URLSearchParams(r.search).get("tab");e&&["pending","purchase","receipt","done"].includes(e)&&L(e)},[r.search]),a.useEffect(()=>{(async()=>{try{const{data:e}=await l.from("employees").select("name");if(e){const a=[...new Set(e.map(e=>e.name).filter(Boolean))];w(a)}const{data:a}=await l.from("vendors").select("vendor_name");if(a){const e=[...new Set(a.map(e=>e.vendor_name).filter(Boolean))];C(e)}const{data:t}=await l.from("vendor_contacts").select("contact_name");if(t){const e=[...new Set(t.map(e=>e.contact_name).filter(Boolean))];$(e)}const{data:s}=await l.from("vendors").select("vendor_payment_schedule");if(s){const e=[...new Set(s.map(e=>e.vendor_payment_schedule).filter(Boolean))];D(e)}}catch(e){u.error("필터 옵션 데이터 로드 실패",e)}})()},[l]),a.useCallback(e=>e.is_received?s.jsx("span",{className:"badge-stats bg-green-500 text-white",children:"입고완료"}):"approved"===e.middle_manager_status&&"approved"===e.final_manager_status?s.jsx("span",{className:"badge-stats bg-blue-500 text-white",children:"구매진행"}):"rejected"===e.middle_manager_status||"rejected"===e.final_manager_status?s.jsx("span",{className:"badge-stats bg-red-500 text-white",children:"반려"}):s.jsx("span",{className:"badge-stats bg-yellow-500 text-white",children:"승인대기"}),[]),a.useCallback((e,a)=>{switch(a){case"purchase_order_number":return e.purchase_order_number;case"payment_category":return e.payment_category;case"requester_name":return e.requester_name;case"vendor_name":return e.vendor_name;case"contact_name":case"payment_schedule":return"-";case"item_name":return e.purchase_request_items?.[0]?.item_name||"";case"specification":return e.purchase_request_items?.[0]?.specification||"";case"quantity":return e.purchase_request_items?.[0]?.quantity||0;case"unit_price_value":return e.purchase_request_items?.[0]?.unit_price_value||0;case"total_amount":return e.total_amount;case"remark":return e.purchase_request_items?.[0]?.remark||"";case"project_vendor":return e.project_vendor;case"project_item":return e.project_item;case"sales_order_number":return e.sales_order_number;case"is_payment_completed":return e.is_payment_completed?"완료":"대기";case"is_received":return e.is_received?"완료":"대기";case"is_statement_received":return e.is_statement_received?"완료":"대기";case"is_utk_checked":return e.is_utk_checked?"완료":"대기";case"request_date":return e.request_date;case"delivery_request_date":return e.delivery_request_date;case"payment_completed_at":return e.payment_completed_at;case"received_at":return e.received_at;case"created_at":return e.created_at;case"statement_received_at":return e.purchase_request_items?.[0]?.statement_received_date||null;default:return null}},[]),a.useCallback((e,a,t,s)=>{if(null==e)return"is_empty"===a;if("date_range"===s&&t&&"string"==typeof t&&t.includes("~")){if(!e)return!1;const[a,s]=t.split("~"),r=new Date(e),l=new Date(a),n=new Date(s);return r>=l&&r<=n}if("date_month"===s&&t&&"string"==typeof t&&t.includes("~")){if(!e)return!1;const[a,s]=t.split("~"),r=new Date(e),l=new Date(`${a}-01`),n=new Date(`${s}-01`),c=new Date(n.getFullYear(),n.getMonth()+1,0,23,59,59);return r>=l&&r<=c}if(s&&("date_month"===s||s.endsWith("_month"))){if(!t)return!0;const a=new Date(e),[s,r]=t.split("-");return a.getFullYear()===parseInt(s)&&a.getMonth()+1===parseInt(r)}const r=String(e).toLowerCase(),l=String(t).toLowerCase();switch(a){case"contains":return r.includes(l);case"equals":if("date_range"===s||t.match(/^[0-9]{4}-[0-9]{2}-[0-9]{2}/)){if(!e)return!1;try{const a=new Date(e).toISOString().split("T")[0];return a===t.split("T")[0]}catch(n){return u.error("날짜 비교 오류:",n),!1}}return r===l;case"starts_with":return r.startsWith(l);case"ends_with":return r.endsWith(l);case"is_empty":return!e||""===r.trim();case"is_not_empty":return!!e&&""!==r.trim();case"greater_than":return Number(e)>Number(t);case"less_than":return Number(e)<Number(t);case"between":default:return!0;case"after":return new Date(e)>new Date(t);case"before":return new Date(e)<new Date(t);case"not_equals":return r!==l}},[]);const U=a.useMemo(()=>{let e;if(!(o.length>0||""!==_.trim()||O&&"all"!==O&&"전체"!==O)){const a=new Date;a.setDate(a.getDate()-60),e=a.toISOString().split("T")[0]}return A({tab:I,employeeName:"all"===O||"전체"===O?null:O,searchTerm:_,advancedFilters:o,startDate:e,sortConfig:x?{key:x.field,direction:x.direction}:void 0})},[A,I,O,_,o,x]),{tabCounts:G}=de(),K=a.useMemo(()=>{const e=o.filter(e=>"date_month"===e.field||"date_range"===e.field&&e.dateField&&e.dateField.includes("_month"));if(0===e.length)return null;const a=e[0].value;if(a&&"string"==typeof a&&a.includes("~")){const[e,t]=a.split("~"),s=new Date(`${e}-01`),r=new Date(`${t}-01`),l=[];let n=0;const c=new Date(s);for(;c<=r;){const e=c.getFullYear(),a=c.getMonth()+1,t=`${e}-${a.toString().padStart(2,"0")}`,s=U.filter(t=>{const s=new Date(t.request_date);return s.getFullYear()===e&&s.getMonth()+1===a}),r=s.reduce((e,a)=>{if(a.purchase_request_items?.length){return e+a.purchase_request_items.reduce((e,a)=>e+(a.amount_value||0),0)}return e+(a.total_amount||0)},0);l.push({year:e,month:a,monthStr:t,total:r,count:s.length}),n+=r,c.setMonth(c.getMonth()+1)}return{type:"range",months:l,grandTotal:n}}{const[e,t]=("string"==typeof a?a:"").split("-"),s=U.filter(a=>{const s=new Date(a.request_date);return s.getFullYear()===parseInt(e)&&s.getMonth()+1===parseInt(t)}),r=s.reduce((e,a)=>{if(a.purchase_request_items?.length){return e+a.purchase_request_items.reduce((e,a)=>e+(a.amount_value||0),0)}return e+(a.total_amount||0)},0);return{type:"single",year:parseInt(e),month:parseInt(t),total:r,count:s.length}}},[o,U]),V=a.useCallback(async e=>{try{const a=(new Date).toISOString(),[t,s]=await Promise.all([l.from("purchase_requests").update({is_received:!0,received_at:a}).eq("id",e),l.from("purchase_request_items").update({is_received:!0,delivery_status:"received"}).eq("purchase_request_id",e)]);if(t.error)throw t.error;if(s.error)throw s.error;v.success("입고완료 처리되었습니다."),await P()}catch(a){v.error("처리 중 오류가 발생했습니다.")}},[l,P]),ae=a.useCallback(async e=>{try{const a=(new Date).toISOString(),[t,s]=await Promise.all([l.from("purchase_requests").update({is_payment_completed:!0,payment_completed_at:a}).eq("id",e),l.from("purchase_request_items").update({is_payment_completed:!0}).eq("purchase_request_id",e)]);if(t.error)throw t.error;if(s.error)throw s.error;v.success("구매완료 처리되었습니다."),await P()}catch(a){v.error("처리 중 오류가 발생했습니다.")}},[l,P]);a.useCallback(e=>{c(e),d(!0)},[]);const te=a.useMemo(()=>n?{...n,vendor_name:n.vendor_name||"",project_vendor:n.project_vendor||"",sales_order_number:n.sales_order_number||"",project_item:n.project_item||""}:null,[n]);return s.jsxs("div",{className:"w-full",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"page-title",children:"발주요청 관리"}),s.jsx("p",{className:"page-subtitle",style:{marginTop:"-2px",marginBottom:"-4px"},children:"Purchase Management"})]}),s.jsxs(p,{onClick:()=>t("/purchase/new"),className:"mt-4 sm:mt-0 bg-hansl-500 hover:bg-hansl-600",children:[s.jsx(ee,{className:"w-4 h-4 mr-2"}),"새 발주요청 작성"]})]}),s.jsxs("div",{className:"mb-3",children:[s.jsx(Da,{activeFilters:o,sortConfig:x,searchTerm:_,onFiltersChange:h,onSortChange:y,onSearchChange:f,availableEmployees:j,availableVendors:N,availableContacts:k,availablePaymentSchedules:q}),0===o.length&&!_.trim()&&s.jsxs("div",{className:"mt-2 flex items-center gap-1.5 text-xs text-gray-500",children:[s.jsx(se,{className:"w-3.5 h-3.5"}),s.jsx("span",{children:"최근 60일 데이터만 표시됩니다. 더 오래된 데이터를 보려면 필터를 적용해주세요."})]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("div",{className:"flex flex-col sm:flex-row sm:space-x-1 space-y-1 sm:space-y-0 bg-gray-50 p-1 business-radius-card border border-gray-200",children:Ra.map(e=>s.jsxs("button",{onClick:()=>{L(e.key)},className:"flex-1 flex items-center justify-center space-x-2 py-1.5 px-3 sm:px-4 business-radius-button button-text font-medium transition-colors "+(I===e.key?"text-hansl-600 bg-white shadow-sm border border-gray-200":"text-gray-600 bg-transparent hover:text-gray-900 hover:bg-white/50"),children:[s.jsx("span",{className:"whitespace-nowrap",children:e.label}),s.jsx("span",{className:"badge-stats "+(I===e.key?"bg-hansl-50 text-hansl-700":"bg-gray-100 text-gray-600"),children:G[e.key]})]},e.key))}),K&&s.jsx("div",{className:"mb-3",children:"single"===K.type?s.jsxs("div",{className:"inline-flex items-center gap-2 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 business-radius-badge px-3 py-2 shadow-sm",children:[s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx("div",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full"}),s.jsxs("span",{className:"card-subtitle text-gray-700",children:[K.year,"년 ",K.month,"월"]}),s.jsxs("span",{className:"badge-text text-gray-500",children:[K.count,"건"]})]}),s.jsx("div",{className:"h-4 w-px bg-blue-300"}),s.jsxs("span",{className:"modal-value text-blue-700 font-semibold",children:["₩",K.total?.toLocaleString()||"0"]})]}):s.jsxs(Z,{className:"business-radius-card border border-gray-200 shadow-sm",children:[s.jsx(H,{className:"pb-3 pt-4 px-4",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full"}),s.jsx(X,{className:"section-title text-gray-800",children:"월별 발주요청 총액"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{className:"badge-text text-gray-600",children:["(",K.months?.reduce((e,a)=>e+a.count,0)||0,"건)"]}),s.jsx("div",{className:"h-4 w-px bg-gray-300"}),s.jsxs("span",{className:"modal-value text-gray-500 font-bold",children:["₩",K.grandTotal?.toLocaleString()||"0"]})]})]})}),s.jsx(Q,{className:"px-4 pb-4",children:s.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:K.months?.map(e=>s.jsx("div",{className:"bg-gray-50 business-radius-card px-3 py-1.5 border border-gray-200 hover:border-blue-300 hover:bg-blue-50 transition-all flex-shrink-0",children:s.jsxs("div",{className:"flex items-baseline gap-1.5",children:[s.jsxs("span",{className:"modal-value font-bold text-gray-800 whitespace-nowrap",children:[e.month,"월"]}),s.jsxs("span",{className:"text-[9px] text-gray-500 whitespace-nowrap",children:["(",e.count,")"]}),s.jsxs("span",{className:"modal-value text-gray-500 font-bold whitespace-nowrap ml-1",children:["₩",e.total.toLocaleString()]})]})},e.monthStr))})})]})}),s.jsx(Z,{className:"overflow-hidden border border-gray-200",children:s.jsx(Q,{className:"p-0",children:F?s.jsxs("div",{className:"flex items-center justify-center py-12",children:[s.jsx("div",{className:"w-8 h-8 border-2 border-hansl-500 border-t-transparent rounded-full animate-spin"}),s.jsx("span",{className:"ml-3 card-subtitle",children:"로딩 중..."})]}):0===U.length?s.jsxs("div",{className:"text-center py-12",children:[s.jsx(J,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"발주요청서가 없습니다"}),s.jsx("p",{className:"card-subtitle",children:"새로운 발주요청서를 작성해보세요."})]}):s.jsx(Ca,{purchases:U,activeTab:I,currentUserRoles:R,onRefresh:P,onOptimisticUpdate:T,onPaymentComplete:ae,onReceiptComplete:V})})})]}),te&&s.jsx(a.Suspense,{fallback:s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"})}),children:s.jsx(Aa,{isOpen:i,onClose:()=>{d(!1),c(null)},purchase:te,isAdmin:z||!1,onUpdate:P,activeTab:I})})]})}export{Ea as default};
//# sourceMappingURL=PurchaseListMain-B1-y0nb7.js.map
