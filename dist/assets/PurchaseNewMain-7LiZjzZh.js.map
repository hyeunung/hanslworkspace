{"version":3,"file":"PurchaseNewMain-7LiZjzZh.js","sources":["../../src/components/purchase/PurchaseNewMain.tsx"],"sourcesContent":["import { useState, useEffect, useRef, useLayoutEffect, useCallback, useMemo } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Plus, X, Save, Calculator, Pencil, Trash2, Package } from \"lucide-react\";\nimport { createClient } from \"@/lib/supabase/client\";\nimport { useNavigate } from \"react-router-dom\";\nimport { invalidatePurchaseMemoryCache } from '@/stores/purchaseMemoryStore';\nimport { useForm as useFormRH, Controller, useFieldArray } from \"react-hook-form\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter, DialogClose } from \"@/components/ui/dialog\";\nimport { FormValues, FormItem } from \"@/types/purchase\";\nimport { toast } from \"sonner\";\nimport { DatePicker } from \"@/components/ui/datepicker\";\nimport { Separator } from \"@/components/ui/separator\";\nimport ReactSelect from 'react-select';\n\ninterface EmployeeOption {\n  value: string;\n  label: string;\n}\n\nexport default function PurchaseNewMain() {\n  const navigate = useNavigate();\n  const supabase = createClient();\n  \n  const [user, setUser] = useState<any>(null);\n  const [employeeName, setEmployeeName] = useState<string>(\"\");\n  const [employees, setEmployees] = useState<{id: string; name: string; email?: string; phone?: string; address?: string; position?: string; department?: string;}[]>([]);\n  const [defaultRequesterLoaded, setDefaultRequesterLoaded] = useState(false);\n  const [addCount, setAddCount] = useState(1);\n  const [vendorSearchTerm, setVendorSearchTerm] = useState(\"\");\n  \n  // ì´ˆê¸° ì‚¬ìš©ì ì •ë³´ ë¡œë“œ\n  useEffect(() => {\n    const getUser = async () => {\n      const { data: { user } } = await supabase.auth.getUser();\n      setUser(user);\n    };\n    getUser();\n  }, []);\n\n  useEffect(() => {\n    // DBì—ì„œ ì§ì› ëª©ë¡ ê°€ì ¸ì˜¤ê¸°\n    const loadEmployees = async () => {\n      try {\n        const { data, error } = await supabase\n          .from('employees')\n          .select('id, name, email, phone, adress, position, department')\n          .order('name');\n        \n        \n        if (data && !error && data.length > 0) {\n          setEmployees(data.map((dbEmp: any) => ({\n            id: dbEmp.id,\n            name: dbEmp.name,\n            email: dbEmp.email || '',\n            phone: dbEmp.phone || '',\n            address: dbEmp.address || '',\n            position: dbEmp.position || '',\n            department: dbEmp.department || ''\n          })));\n          \n          // ì´ë¯¸ ì„¤ì •ëœ employeeNameì´ ìˆê³  employees ë°°ì—´ì— í•´ë‹¹ ì§ì›ì´ ìˆëŠ”ì§€ í™•ì¸\n          if (employeeName && !data.find((emp: any) => emp.name === employeeName)) {\n            // í˜„ì¬ ì‚¬ìš©ìë¥¼ employees ë°°ì—´ì— ì¶”ê°€\n            const currentUser = {\n              id: user?.id || 'current-user',\n              name: employeeName,\n              email: user?.email || '',\n              phone: '',\n              address: '',\n              position: '',\n              department: ''\n            };\n            setEmployees([...data.map((dbEmp: any) => ({\n              id: dbEmp.id,\n              name: dbEmp.name,\n              email: dbEmp.email || '',\n              phone: dbEmp.phone || '',\n              address: dbEmp.address || '',\n              position: dbEmp.position || '',\n              department: dbEmp.department || ''\n            })), currentUser]);\n          }\n        } else {\n          // DBì—ì„œ ëª» ë¶ˆëŸ¬ì™€ë„ í˜„ì¬ ì‚¬ìš©ìë§Œì´ë¼ë„ ì¶”ê°€\n          if (employeeName) {\n            setEmployees([{\n              id: user?.id || 'current-user',\n              name: employeeName,\n              email: user?.email || '',\n              phone: '',\n              address: '',\n              position: '',\n              department: ''\n            }]);\n          } else {\n            setEmployees([]);\n          }\n        }\n      } catch (err) {\n        // ì˜¤ë¥˜ ë°œìƒ ì‹œì—ë„ í˜„ì¬ ì‚¬ìš©ì ì¶”ê°€\n        if (employeeName) {\n          setEmployees([{\n            id: user?.id || 'current-user',\n            name: employeeName,\n            email: user?.email || '',\n            phone: '',\n            address: '',\n            position: '',\n            department: ''\n          }]);\n        } else {\n          setEmployees([]);\n        }\n      }\n    };\n    \n    // user ìƒíƒœì™€ ê´€ê³„ì—†ì´ ì§ì› ëª©ë¡ ë¡œë“œ\n    loadEmployees();\n  }, [employeeName, user]);\n\n  const [vendors, setVendors] = useState<{ id: number; vendor_name: string }[]>([]);\n  const [contacts, setContacts] = useState<{ id: number; contact_name: string; contact_email: string; contact_phone: string; position: string }[]>([]);\n  const [vendor, setVendor] = useState(\"\");\n  const [selectedContacts, setSelectedContacts] = useState<string[]>([]);\n  const [currency, setCurrency] = useState(\"KRW\");\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(\"\");\n  const [inputValues, setInputValues] = useState<{[key: string]: string}>({});\n  const [isContactDialogOpen, setIsContactDialogOpen] = useState(false);\n  const [contactsForEdit, setContactsForEdit] = useState<{ id?: number; contact_name: string; contact_email: string; contact_phone: string; position: string; isNew?: boolean }[]>([]);\n  const [hasChanges, setHasChanges] = useState(false);\n  // ì¤‘ë³µ ì œì¶œ ë°©ì§€ìš© ref\n  const isSubmittingRef = useRef(false);\n\n  const { control, handleSubmit: rhHandleSubmit, watch, setValue, reset, getValues } = useFormRH<FormValues>({\n    defaultValues: {\n      progress_type: \"\",\n      payment_category: \"\",\n      currency: \"KRW\",\n      po_template_type: \"ì¼ë°˜\",\n      request_type: \"\",\n      contacts: [],\n      sales_order_number: '',\n      project_vendor: '',\n      project_item: '',\n      delivery_request_date: '',\n      vendor_id: 0,\n      requester_name: \"\",\n      items: [\n        {\n          line_number: 1,\n          item_name: \"\",\n          specification: \"\",\n          quantity: 1,\n          unit_price_value: 0,\n          unit_price_currency: \"KRW\",\n          amount_value: 0,\n          amount_currency: \"KRW\",\n          remark: \"\",\n          link: \"\",\n        },\n      ],\n      request_date: new Date().toISOString().slice(0, 10),\n    }\n  });\n\n  const { fields, append, remove, update } = useFieldArray({\n    control,\n    name: \"items\"\n  });\n\n  // ì‚¬ìš©ì ì •ë³´ë¡œ êµ¬ë§¤ìš”ì²­ì ê¸°ë³¸ê°’ ì„¤ì •\n  useEffect(() => {\n    if (!user?.email || defaultRequesterLoaded) return;\n    \n    const loadUserName = async () => {\n      const { data: empData } = await supabase\n        .from('employees')\n        .select('name')\n        .eq('email', user.email)\n        .single();\n      \n      if (empData?.name) {\n        setEmployeeName(empData.name);\n        setValue('requester_name', empData.name);\n        setDefaultRequesterLoaded(true);\n      }\n    };\n    loadUserName();\n  }, [user, supabase, setValue, defaultRequesterLoaded]);\n\n  // ì—…ì²´ ëª©ë¡ ë¡œë“œ\n  useEffect(() => {\n    const setDefaultRequester = async () => {\n      if (user?.email && setValue && !defaultRequesterLoaded) {\n        try {\n          const { data: employeeData, error } = await supabase\n            .from('employees')\n            .select('name')\n            .eq('email', user.email)\n            .single();\n          \n          if (employeeData && !error) {\n            setEmployeeName(employeeData.name);\n            // React Hook Formì˜ setValueë¥¼ ì•½ê°„ì˜ ì§€ì—° í›„ í˜¸ì¶œ\n            setTimeout(() => {\n              setValue('requester_name', employeeData.name, { \n                shouldValidate: true,\n                shouldDirty: true \n              });\n            }, 100);\n            setDefaultRequesterLoaded(true);\n          } else {\n            const fallbackName = user.email.split('@')[0] || \"ì‚¬ìš©ì\";\n            setEmployeeName(fallbackName);\n            setTimeout(() => {\n              setValue('requester_name', fallbackName, { \n                shouldValidate: true,\n                shouldDirty: true \n              });\n            }, 100);\n            setDefaultRequesterLoaded(true);\n          }\n        } catch (err) {\n          const fallbackName = user.email?.split('@')[0] || \"ì‚¬ìš©ì\";\n          setEmployeeName(fallbackName);\n          setTimeout(() => {\n            setValue('requester_name', fallbackName, { \n              shouldValidate: true,\n              shouldDirty: true \n            });\n          }, 100);\n          setDefaultRequesterLoaded(true);\n        }\n      }\n    };\n    \n    setDefaultRequester();\n  }, [user, setValue, defaultRequesterLoaded]);\n\n  // Vendors ë¡œë“œ\n  useEffect(() => {\n    const loadVendors = async () => {\n      try {\n        const { data, error } = await supabase\n          .from(\"vendors\")\n          .select(\"*\")\n          .order(\"vendor_name\");\n        \n        if (error) throw error;\n        setVendors(data || []);\n      } catch (error) {\n        toast.error(\"ì—…ì²´ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\");\n      }\n    };\n\n    loadVendors();\n  }, []);\n\n  const selectedVendor = watch('vendor_id');\n\n  // ì—…ì²´ ë³€ê²½ ì‹œ ë‹´ë‹¹ì ëª©ë¡ ë¡œë“œ\n  useEffect(() => {\n    const loadContacts = async () => {\n      if (selectedVendor) {\n        try {\n          const { data, error } = await supabase\n            .from('vendor_contacts')\n            .select('id, contact_name, contact_email, contact_phone, position')\n            .eq('vendor_id', selectedVendor);\n          \n          if (error) throw error;\n          setContacts(data || []);\n        } catch (error) {\n          setContacts([]);\n        }\n      } else {\n        setContacts([]);\n      }\n    };\n    \n    loadContacts();\n  }, [selectedVendor]);\n\n  // í†µí™” ë³€ê²½ì‹œ í’ˆëª©ë“¤ì˜ í†µí™”ë„ ì—…ë°ì´íŠ¸\n  useEffect(() => {\n    const items = getValues(\"items\");\n    const updatedItems = items.map(item => ({\n      ...item,\n      unit_price_currency: currency,\n      amount_currency: currency\n    }));\n    setValue(\"items\", updatedItems);\n    setCurrency(currency);\n  }, [currency, setValue, getValues]);\n\n  // ìˆ˜ëŸ‰ì´ë‚˜ ë‹¨ê°€ ë³€ê²½ ì‹œ ê¸ˆì•¡ ìë™ ê³„ì‚°\n  useEffect(() => {\n    fields.forEach((item, idx) => {\n      const calcAmount = Number(item.quantity) * Number(item.unit_price_value);\n      if (item.amount_value !== calcAmount) {\n        update(idx, { ...item, amount_value: calcAmount });\n      }\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [fields.map(f => `${f.quantity}-${f.unit_price_value}`).join(\",\")]);\n\n  // í’ˆëª© ì¶”ê°€\n  const addItem = () => {\n    const currentItems = getValues(\"items\");\n    const nextLineNumber = Math.max(...currentItems.map(item => item.line_number), 0) + 1;\n    \n    append({\n      line_number: nextLineNumber,\n      item_name: \"\",\n      specification: \"\",\n      quantity: 1,\n      unit_price_value: 0,\n      unit_price_currency: currency,\n      amount_value: 0,\n      amount_currency: currency,\n      remark: \"\",\n      link: \"\"\n    });\n  };\n\n  // ê¸ˆì•¡ ê³„ì‚°\n  const calculateAmount = (index: number) => {\n    const items = getValues(\"items\");\n    const item = items[index];\n    const amount = item.quantity * item.unit_price_value;\n    \n    // update í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ fields ë°°ì—´ ì§ì ‘ ì—…ë°ì´íŠ¸\n    update(index, { ...item, amount_value: amount });\n  };\n\n  // ì „ì²´ ê¸ˆì•¡ ê³„ì‚°\n  const getTotalAmount = () => {\n    const items = getValues(\"items\");\n    return items.reduce((sum, item) => sum + item.amount_value, 0);\n  };\n\n  // í•„ìˆ˜ í•­ëª© ì²´í¬ í•¨ìˆ˜\n  const checkRequiredFields = () => {\n    const requestType = watch('request_type');\n    const progressType = watch('progress_type');\n    const paymentCategory = watch('payment_category');\n    const vendorId = watch('vendor_id');\n    \n    return !!(requestType && progressType && paymentCategory && vendorId && vendorId !== 0 && fields.length > 0);\n  };\n\n  // ì‹¤ì‹œê°„ í•„ìˆ˜í•­ëª© ì²´í¬ë¥¼ ìœ„í•œ state\n  const [isFormValid, setIsFormValid] = useState(false);\n\n  // í•„ìˆ˜í•­ëª© ë³€ê²½ ê°ì§€\n  useEffect(() => {\n    setIsFormValid(checkRequiredFields());\n  }, [watch('request_type'), watch('progress_type'), watch('payment_category'), watch('vendor_id'), fields]);\n\n  // ë°œì£¼ìš”ì²­ë²ˆí˜¸ ìƒì„± í•¨ìˆ˜ (ì¬ì‹œë„ ë¡œì§ í¬í•¨)\n  const generatePurchaseOrderNumber = async () => {\n    const today = new Date();\n    // í•œêµ­ ì‹œê°„ëŒ€(UTC+9) ê¸°ì¤€ìœ¼ë¡œ ë‚ ì§œ ìƒì„±\n    const koreaTime = new Date(today.getTime() + (9 * 60 * 60 * 1000));\n    const dateStr = koreaTime.toISOString().slice(0, 10).replace(/-/g, ''); // YYYYMMDD\n    const prefix = `F${dateStr}_`;\n    \n    // ì˜¤ëŠ˜ ë‚ ì§œë¡œ ì‹œì‘í•˜ëŠ” ë°œì£¼ìš”ì²­ë²ˆí˜¸ë“¤ ì¡°íšŒ (ìœ íš¨í•œ ìˆ«ì í˜•ì‹ë§Œ)\n    const { data: existingOrders, error: queryError } = await supabase\n      .from('purchase_requests')\n      .select('purchase_order_number')\n      .like('purchase_order_number', `${prefix}%`)\n      .order('purchase_order_number', { ascending: false });\n    \n    if (queryError) {\n    }\n    \n    // ë‹¤ìŒ ìˆœë²ˆ ê³„ì‚° (ìˆ«ìì¸ ì‹œí€€ìŠ¤ë§Œ ì°¾ê¸°)\n    let nextNumber = 1;\n    let maxSequence = 0;\n    \n    if (existingOrders && existingOrders.length > 0) {\n      // ëª¨ë“  ë°œì£¼ìš”ì²­ë²ˆí˜¸ë¥¼ í™•ì¸í•˜ì—¬ ê°€ì¥ í° ìœ íš¨í•œ ìˆ«ì ì‹œí€€ìŠ¤ ì°¾ê¸°\n      for (const order of existingOrders) {\n        const orderNumber = order.purchase_order_number;\n        \n        // ë°œì£¼ìš”ì²­ë²ˆí˜¸ í˜•ì‹: F20250612_001\n        const parts = orderNumber.split('_');\n        if (parts.length >= 2) {\n          const sequenceStr = parts[1];\n          const sequence = parseInt(sequenceStr, 10);\n          \n          // ìœ íš¨í•œ ìˆ«ìì´ê³  í˜„ì¬ ìµœëŒ€ê°’ë³´ë‹¤ í¬ë©´ ì—…ë°ì´íŠ¸\n          if (!isNaN(sequence) && sequence > maxSequence) {\n            maxSequence = sequence;\n          }\n        }\n      }\n      \n      nextNumber = maxSequence + 1;\n    }\n    \n    // 3ìë¦¬ íŒ¨ë”©ìœ¼ë¡œ ë°œì£¼ìš”ì²­ë²ˆí˜¸ ìƒì„±\n    const safeNextNumber = isNaN(nextNumber) ? 1 : nextNumber;\n    const purchaseOrderNumber = `${prefix}${String(safeNextNumber).padStart(3, '0')}`;\n    \n    return purchaseOrderNumber;\n  };\n\n  // í¼ ì œì¶œ\n  const handleSubmit = async (data: FormValues) => {\n    const currentEmployee = employees.find(emp => emp.name === data.requester_name);\n    \n    if (isSubmittingRef.current) {\n      return;\n    }\n\n    if (!currentEmployee) {\n      setError(\"êµ¬ë§¤ìš”ì²­ì ì´ë¦„ì— í•´ë‹¹í•˜ëŠ” ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤. ì´ë¦„ì„ ì •í™•íˆ ì…ë ¥í•´ ì£¼ì„¸ìš”.\");\n      return;\n    }\n    \n    // í•„ìˆ˜ í•­ëª©ì´ ëª¨ë‘ ì±„ì›Œì ¸ ìˆëŠ”ì§€ ì¬í™•ì¸\n    if (!checkRequiredFields()) {\n      return; // ë²„íŠ¼ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆì–´ì•¼ í•˜ë¯€ë¡œ ë³„ë„ ì˜¤ë¥˜ ë©”ì‹œì§€ ì—†ì´ ê·¸ëƒ¥ ë¦¬í„´\n    }\n\n    isSubmittingRef.current = true;\n    setLoading(true);\n    setError(\"\");\n    \n    try {\n\n      let prId: number = 0;\n      let purchaseOrderNumber: string = '';\n      const maxRetries = 5;\n      let retryCount = 0;\n\n      // ë°œì£¼ìš”ì²­ë²ˆí˜¸ ì¤‘ë³µ ë°©ì§€ë¥¼ ìœ„í•œ ì¬ì‹œë„ ë¡œì§\n      while (retryCount < maxRetries) {\n        try {\n          // ë°œì£¼ìš”ì²­ë²ˆí˜¸ ìë™ ìƒì„±\n          purchaseOrderNumber = await generatePurchaseOrderNumber();\n\n          // êµ¬ë§¤ìš”ì²­ ë“±ë¡ ì‹œë„\n          const { data: pr, error: prError } = await supabase.from(\"purchase_requests\").insert({\n            requester_id: currentEmployee.id,\n            purchase_order_number: purchaseOrderNumber,\n            requester_name: data.requester_name,\n            requester_phone: currentEmployee?.phone,\n            requester_fax: null,\n            requester_address: currentEmployee?.address,\n            vendor_id: data.vendor_id,\n            sales_order_number: data.sales_order_number,\n            project_vendor: data.project_vendor,\n            project_item: data.project_item,\n            request_date: data.request_date,\n            delivery_request_date: data.delivery_request_date || null,\n            request_type: data.request_type,\n            progress_type: data.progress_type,\n            is_payment_completed: false,\n            payment_category: data.payment_category,\n            currency: currency,\n            total_amount: fields.reduce((sum, i) => sum + i.amount_value, 0),\n            unit_price_currency: fields[0]?.unit_price_currency || currency,\n            po_template_type: data.po_template_type,\n            contact_id: data.contact_id ? Number(data.contact_id) : null,\n          }).select(\"id\").single();\n          \n          // ë°œì£¼ìš”ì²­ë²ˆí˜¸ ì¤‘ë³µ ì—ëŸ¬ê°€ ì•„ë‹Œ ë‹¤ë¥¸ ì—ëŸ¬ëŠ” ë°”ë¡œ throw\n          if (prError && !prError.message.includes('duplicate key value violates unique constraint')) {\n            throw prError;\n          }\n          \n          // ë°œì£¼ìš”ì²­ë²ˆí˜¸ ì¤‘ë³µ ì—ëŸ¬ì¸ ê²½ìš°\n          if (prError && prError.message.includes('duplicate key value violates unique constraint')) {\n            retryCount++;\n            if (retryCount >= maxRetries) {\n              throw new Error(`ë°œì£¼ìš”ì²­ë²ˆí˜¸ ìƒì„±ì— ${maxRetries}ë²ˆ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.`);\n            }\n            // ì¬ì‹œë„ë¥¼ ìœ„í•´ ì§§ì€ ëŒ€ê¸°\n            await new Promise(resolve => setTimeout(resolve, 100 + Math.random() * 200));\n            continue;\n          }\n          \n          // ì„±ê³µí•œ ê²½ìš°\n          if (!pr) throw new Error(\"ë“±ë¡ ì‹¤íŒ¨\");\n          prId = pr.id;\n          break; // ì„±ê³µ ì‹œ ë£¨í”„ ì¢…ë£Œ\n          \n        } catch (retryError: any) {\n          // ë°œì£¼ìš”ì²­ë²ˆí˜¸ ì¤‘ë³µì´ ì•„ë‹Œ ì—ëŸ¬ëŠ” ë°”ë¡œ throw\n          if (!retryError.message.includes('duplicate key value violates unique constraint')) {\n            throw retryError;\n          }\n          \n          retryCount++;\n          if (retryCount >= maxRetries) {\n            throw new Error(`ë°œì£¼ìš”ì²­ë²ˆí˜¸ ìƒì„±ì— ${maxRetries}ë²ˆ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.`);\n          }\n          \n          // ì¬ì‹œë„ë¥¼ ìœ„í•´ ì§§ì€ ëŒ€ê¸° (100-300ms ëœë¤)\n          await new Promise(resolve => setTimeout(resolve, 100 + Math.random() * 200));\n        }\n      }\n\n      // í’ˆëª©ë“¤ ì €ì¥\n      for (const [idx, item] of fields.entries()) {\n        const { error: itemErr } = await supabase.from(\"purchase_request_items\").insert({\n          purchase_request_id: prId,\n          line_number: idx + 1,\n          item_name: item.item_name,\n          specification: item.specification,\n          quantity: item.quantity,\n          unit_price_value: item.unit_price_value,\n          unit_price_currency: currency,\n          amount_value: item.amount_value,\n          amount_currency: currency,\n          remark: item.remark,\n          link: item.link || null,\n        });\n        if (itemErr) throw itemErr;\n      }\n      \n      // ë°œì£¼ìš”ì²­ ì„±ê³µ ì²˜ë¦¬\n      \n      // ğŸ“¨ ì¤‘ê°„ê´€ë¦¬ì DM ì•Œë¦¼ ë°œì†¡ (í’ˆëª© ì¶”ê°€ ì™„ë£Œ í›„ ì •í™•í•œ ê°œìˆ˜ë¡œ)\n      try {\n        const notifyResponse = await fetch(`/api/purchase/${prId}/notify-middle-manager`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n        });\n        \n        if (notifyResponse.ok) {\n          const notifyResult = await notifyResponse.json();\n        } else {\n          const errorText = await notifyResponse.text();\n        }\n      } catch (notifyError) {\n      }\n      \n      // 1. í¼ ì´ˆê¸°í™”\n      reset({\n        progress_type: \"\",\n        payment_category: \"\",\n        currency: \"KRW\",\n        po_template_type: \"ì¼ë°˜\",\n        request_type: \"\",\n        contacts: [],\n        sales_order_number: '',\n        project_vendor: '',\n        project_item: '',\n        delivery_request_date: '',\n        vendor_id: 0,\n        requester_name: employeeName, // ìš”ì²­ì ì´ë¦„ì€ ìœ ì§€\n        items: [\n          {\n            line_number: 1,\n            item_name: \"\",\n            specification: \"\",\n            quantity: 1,\n            unit_price_value: 0,\n            unit_price_currency: \"KRW\",\n            amount_value: 0,\n            amount_currency: \"KRW\",\n            remark: \"\",\n            link: \"\",\n          },\n        ],\n        request_date: new Date().toISOString().slice(0, 10),\n      });\n      \n      // 2. ìƒíƒœ ì´ˆê¸°í™”\n      setVendor(\"\");\n      setSelectedContacts([]);\n      setCurrency(\"KRW\");\n      setError(\"\");\n      setLoading(false);\n      \n      // 3. ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ\n      toast.success(\"ë°œì£¼ìš”ì²­ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.\");\n      \n      // 4. ë©”ëª¨ë¦¬ ìºì‹œ ë¬´íš¨í™”í•˜ì—¬ ìƒˆë¡œìš´ ë°œì£¼ìš”ì²­ì´ ëª©ë¡ì— ë‚˜íƒ€ë‚˜ë„ë¡ í•¨\n      invalidatePurchaseMemoryCache() // ìºì‹œ ë¬´íš¨í™”ë¡œ ë‹¤ìŒ ë¡œë“œ ì‹œ ìƒˆë¡œê³ ì¹¨\n      \n      // 5. ë°œì£¼ìš”ì²­ ê´€ë¦¬ í˜ì´ì§€ì˜ ìŠ¹ì¸ëŒ€ê¸° íƒ­ìœ¼ë¡œ ì´ë™\n      try {\n        await navigate('/purchase/list?tab=pending');\n      } catch (routerError) {\n        // ëŒ€ì²´ ë¼ìš°íŒ… ë°©ë²•\n        window.location.href = '/purchase/list?tab=pending';\n      }\n      return;\n    } catch (err: any) {\n      setError(err.message || \"ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\");\n      toast.error(err.message || \"ë°œì£¼ìš”ì²­ì„œ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\");\n    } finally {\n      // ì˜¤ë¥˜ê°€ ìˆì—ˆì„ ë•Œë§Œ ì‹¤í–‰ë¨ (ì„±ê³µ ì‹œì—ëŠ” returnìœ¼ë¡œ ë¹ ì§)\n      setLoading(false);\n      isSubmittingRef.current = false;\n    }\n  };\n\n  const totalAmount = fields.reduce((sum, item) => sum + item.amount_value, 0);\n\n  const openContactsManager = () => {\n    // ê¸°ì¡´ ë‹´ë‹¹ìë“¤ì„ ë³µì‚¬í•˜ê³  ìƒˆë¡œìš´ ë‹´ë‹¹ì ì¶”ê°€ë¥¼ ìœ„í•œ ë¹ˆ ìŠ¬ë¡¯ë„ ì¶”ê°€\n    const existingContacts = contacts.map(c => ({ ...c, isNew: false }));\n    const newEmptyContact = { contact_name: '', contact_email: '', contact_phone: '', position: '', isNew: true };\n    setContactsForEdit([...existingContacts, newEmptyContact]);\n    setHasChanges(false);\n    setIsContactDialogOpen(true);\n  };\n\n  const handleContactChange = (index: number, field: string, value: string) => {\n    setContactsForEdit(prev => prev.map((contact, i) => \n      i === index ? { ...contact, [field]: value } : contact\n    ));\n    setHasChanges(true);\n  };\n\n  const addNewContactSlot = () => {\n    setContactsForEdit(prev => [...prev, { contact_name: '', contact_email: '', contact_phone: '', position: '', isNew: true }]);\n    setHasChanges(true);\n  };\n\n  const removeContactSlot = (index: number) => {\n    setContactsForEdit(prev => prev.filter((_, i) => i !== index));\n    setHasChanges(true);\n  };\n\n  const handleSaveAllContacts = async () => {\n    if (!selectedVendor) return;\n    \n    try {\n      // @hanslë¡œ ëë‚˜ëŠ” ì´ë©”ì¼ ì²´í¬\n      const hanslEmails = contactsForEdit.filter(c => c.contact_email && c.contact_email.endsWith('@hansl.io'));\n      if (hanslEmails.length > 0) {\n        alert('í•œìŠ¬ ì§ì› ì´ë©”ì¼ì€ ì—…ì²´ ë‹´ë‹¹ìë¡œ ë“±ë¡í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');\n        return;\n      }\n\n      for (const contact of contactsForEdit) {\n        if (contact.contact_name && contact.contact_email) {\n          if (!contact.isNew && contact.id) {\n            // ê¸°ì¡´ ë‹´ë‹¹ì ì—…ë°ì´íŠ¸\n            await supabase\n              .from('vendor_contacts')\n              .update({\n                contact_name: contact.contact_name,\n                contact_email: contact.contact_email,\n                contact_phone: contact.contact_phone || '',\n                position: contact.position || ''\n              })\n              .eq('id', contact.id);\n          } else if (contact.isNew) {\n            // ìƒˆë¡œìš´ ë‹´ë‹¹ì ì¶”ê°€\n            await supabase\n              .from('vendor_contacts')\n              .insert({\n                vendor_id: selectedVendor,\n                contact_name: contact.contact_name,\n                contact_email: contact.contact_email,\n                contact_phone: contact.contact_phone || '',\n                position: contact.position || ''\n              });\n          }\n        }\n      }\n      \n      // ë‹´ë‹¹ì ëª©ë¡ ìƒˆë¡œê³ ì¹¨\n      const { data } = await supabase\n        .from('vendor_contacts')\n        .select('id, contact_name, contact_email, contact_phone, position')\n        .eq('vendor_id', selectedVendor);\n      \n      if (data) setContacts(data);\n      setIsContactDialogOpen(false);\n      toast.success('ë‹´ë‹¹ì ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');\n    } catch (error) {\n      toast.error('ë‹´ë‹¹ì ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n    }\n  };\n\n  const handleDeleteContact = async (contactId: number) => {\n    if (!confirm('ì •ë§ ì´ ë‹´ë‹¹ìë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;\n    \n    try {\n      await supabase\n        .from('vendor_contacts')\n        .delete()\n        .eq('id', contactId);\n      \n      // ë‹´ë‹¹ì ëª©ë¡ ìƒˆë¡œê³ ì¹¨\n      const { data } = await supabase\n        .from('vendor_contacts')\n        .select('id, contact_name, contact_email, contact_phone, position')\n        .eq('vendor_id', selectedVendor);\n      \n      if (data) setContacts(data);\n      toast.success('ë‹´ë‹¹ìê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');\n    } catch (error) {\n      toast.error('ë‹´ë‹¹ì ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n    }\n  };\n\n  const paymentCategory = watch('payment_category');\n\n  return (\n    <form \n      onSubmit={(e) => {\n        e.preventDefault();\n        rhHandleSubmit(handleSubmit)(e);\n      }}\n      onKeyDown={e => {\n        if (e.key === 'Enter' || e.keyCode === 13) {\n          e.preventDefault();\n        }\n      }}\n    >\n      <div className=\"flex flex-col lg:flex-row gap-4 lg:gap-6\">\n        {/* ë°œì£¼ ê¸°ë³¸ ì •ë³´ - ëª¨ë°”ì¼: ì „ì²´í­, ë°ìŠ¤í¬í†±: 1/4 í­ */}\n        <div className=\"w-full lg:w-1/4 relative bg-muted/20 border border-border rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300 p-4 lg:p-5 space-y-4\">\n          <div className=\"flex flex-row items-start justify-between w-full mb-4\">\n            <div className=\"flex flex-col\">\n              <h4 className=\"font-semibold text-foreground\">ë°œì£¼ ê¸°ë³¸ ì •ë³´</h4>\n              <p className=\"text-xs text-muted-foreground mt-0.5\">Basic Information</p>\n            </div>\n            <div className=\"flex flex-col items-start\">\n              <Label className=\"mb-1 block text-xs\">ë°œì£¼ì„œ ì¢…ë¥˜<span className=\"text-red-500 ml-1\">*</span></Label>\n              <Select value={watch('po_template_type')} onValueChange={value => setValue('po_template_type', value)}>\n                <SelectTrigger className=\"!h-9 !py-0 w-28 bg-white border border-[#d2d2d7] rounded-md text-xs shadow-sm hover:shadow-md transition-shadow duration-200\">\n                  <SelectValue placeholder=\"ì¢…ë¥˜ ì„ íƒ\" />\n                </SelectTrigger>\n                <SelectContent position=\"popper\" className=\"z-[9999]\">\n                  <SelectItem value=\"ì¼ë°˜\">ì¼ë°˜</SelectItem>\n                  <SelectItem value=\"PCB\">PCB</SelectItem>\n                  <SelectItem value=\"ì†Œëª¨í’ˆ\">ì†Œëª¨í’ˆ</SelectItem>\n                  <SelectItem value=\"ê¸°íƒ€\">ê¸°íƒ€</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n          {watch('po_template_type') === 'ì¼ë°˜' && (\n            <div className=\"space-y-4\">\n              {/* ìš”ì²­ ì„¤ì • */}\n              <div className=\"grid grid-cols-3 gap-1.5 sm:gap-2\">\n                <div>\n                  <Label className=\"mb-0.5 block text-[10px] sm:text-xs\">ìš”ì²­ ìœ í˜•<span className=\"text-red-500 ml-0.5\">*</span></Label>\n                  <Select value={watch('request_type')} onValueChange={(value) => setValue('request_type', value)}>\n                    <SelectTrigger className=\"!h-9 !py-0 !leading-none bg-white border border-[#d2d2d7] rounded-md text-xs shadow-sm hover:shadow-md transition-shadow duration-200\">\n                      <SelectValue placeholder=\"ì„ íƒ\" />\n                    </SelectTrigger>\n                    <SelectContent position=\"popper\" className=\"z-[9999]\">\n                      <SelectItem value=\"ì›ìì¬\">ì›ìì¬</SelectItem>\n                      <SelectItem value=\"ì†Œëª¨í’ˆ\">ì†Œëª¨í’ˆ</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div>\n                  <Label className=\"mb-0.5 block text-[10px] sm:text-xs\">ì§„í–‰ ì¢…ë¥˜<span className=\"text-red-500 ml-0.5\">*</span></Label>\n                  <Select value={watch('progress_type')} onValueChange={(value) => setValue('progress_type', value)}>\n                    <SelectTrigger className=\"!h-9 !py-0 !leading-none bg-white border border-[#d2d2d7] rounded-md text-xs shadow-sm hover:shadow-md transition-shadow duration-200\">\n                      <SelectValue placeholder=\"ì„ íƒ\" />\n                    </SelectTrigger>\n                    <SelectContent position=\"popper\" className=\"z-[9999]\">\n                      <SelectItem value=\"ì¼ë°˜\">ì¼ë°˜</SelectItem>\n                      <SelectItem value=\"ì„ ì§„í–‰\">ì„ ì§„í–‰</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div>\n                  <Label className=\"mb-0.5 block text-[10px] sm:text-xs\">ê²°ì œ ì¢…ë¥˜<span className=\"text-red-500 ml-0.5\">*</span></Label>\n                  <Select value={watch('payment_category')} onValueChange={(value) => setValue('payment_category', value)}>\n                    <SelectTrigger className=\"!h-9 !py-0 !leading-none bg-white border border-[#d2d2d7] rounded-md text-xs shadow-sm hover:shadow-md transition-shadow duration-200\">\n                      <SelectValue placeholder=\"ì„ íƒ\" />\n                    </SelectTrigger>\n                    <SelectContent position=\"popper\" className=\"z-[9999]\">\n                      <SelectItem value=\"êµ¬ë§¤ ìš”ì²­\">êµ¬ë§¤ ìš”ì²­</SelectItem>\n                      <SelectItem value=\"ë°œì£¼\">ë°œì£¼</SelectItem>\n                      <SelectItem value=\"í˜„ì¥ ê²°ì œ\">í˜„ì¥ ê²°ì œ</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n\n              {/* ì—…ì²´ ì •ë³´ */}\n              <div className=\"grid grid-cols-2 gap-1.5 sm:gap-2 lg:grid-cols-2\">\n                <div>\n                  <Label className=\"mb-0.5 block text-[10px] sm:text-xs\">ì—…ì²´ëª…<span className=\"text-red-500 ml-0.5\">*</span></Label>\n                  <ReactSelect\n                      options={vendors.map(v => ({ value: v.id.toString(), label: v.vendor_name }))}\n                      value={vendors.find(v => v.id.toString() === vendor) ? { value: vendor, label: vendors.find(v => v.id.toString() === vendor)?.vendor_name } : null}\n                      onChange={(option) => {\n                        const opt = option as { value: string; label: string } | null;\n                        if (opt) {\n                          setVendor(opt.value);\n                          setValue('vendor_id', Number(opt.value));\n                        } else {\n                          setVendor('');\n                          setValue('vendor_id', 0);\n                        }\n                      }}\n                      placeholder=\"ì—…ì²´ ì„ íƒ\"\n                      isClearable\n                      isSearchable\n                      closeMenuOnSelect={false}\n                      classNamePrefix=\"vendor-select\"\n                      blurInputOnSelect={false}\n                      openMenuOnFocus={false}\n                      openMenuOnClick={true}\n                      tabSelectsValue={false}\n                      captureMenuScroll={false}\n                      pageSize={20}\n                      styles={{\n                        container: base => ({ ...base, width: '100%' }),\n                        control: base => ({ \n                          ...base, \n                          height: '36px !important',\n                          minHeight: '36px !important',\n                          maxHeight: '36px !important',\n                          background: '#fff',\n                          border: '1px solid #d2d2d7',\n                          borderRadius: '6px',\n                          fontSize: '0.75rem',\n                          boxShadow: '0 1px 2px 0 rgb(0 0 0 / 0.05)',\n                          padding: '0 !important',\n                          margin: '0 !important',\n                          alignItems: 'center',\n                          display: 'flex',\n                          position: 'relative',\n                          verticalAlign: 'top',\n                          lineHeight: '1',\n                          '&:hover': { \n                            boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1)' \n                          }\n                        }),\n                        valueContainer: base => ({ \n                          ...base, \n                          height: '36px !important',\n                          minHeight: '36px !important',\n                          maxHeight: '36px !important',\n                          padding: '0 14px !important',\n                          margin: '0 !important',\n                          fontSize: '0.75rem',\n                          alignItems: 'center',\n                          display: 'flex',\n                          lineHeight: '1',\n                          justifyContent: 'flex-start'\n                        }),\n                        input: base => ({ \n                          ...base, \n                          margin: '0 !important', \n                          padding: '0 !important', \n                          fontSize: '0.75rem',\n                          lineHeight: '1',\n                          position: 'relative',\n                          top: '0'\n                        }),\n                        singleValue: base => ({\n                          ...base,\n                          margin: '0 !important',\n                          padding: '0 !important',\n                          fontSize: '0.75rem',\n                          lineHeight: '1',\n                          position: 'relative',\n                          top: '0',\n                          transform: 'none'\n                        }),\n                        placeholder: base => ({\n                          ...base,\n                          margin: '0 !important',\n                          padding: '0 !important',\n                          fontSize: '0.75rem',\n                          lineHeight: '1',\n                          position: 'relative',\n                          top: '0',\n                          transform: 'none'\n                        }),\n                        indicatorsContainer: base => ({ \n                          ...base, \n                          height: '36px !important',\n                          padding: '0 8px !important',\n                          alignItems: 'center',\n                          display: 'flex'\n                        }),\n                        indicatorSeparator: () => ({ display: 'none' }),\n                        dropdownIndicator: base => ({ ...base, padding: '4px !important' }),\n                        clearIndicator: base => ({ ...base, padding: '4px !important' }),\n                        menuPortal: base => ({ ...base, zIndex: 1400 })\n                      }}\n                    />\n                </div>\n                <div>\n                  <div className=\"flex items-center justify-between mb-0.5\">\n                    <Label className=\"text-[10px] sm:text-xs\">ì—…ì²´ ë‹´ë‹¹ì</Label>\n                    <span\n                      className=\"text-primary text-[9px] sm:text-[10px] cursor-pointer hover:underline select-none flex items-center\"\n                      onClick={openContactsManager}\n                    >\n                      <span className=\"-translate-y-px\">+</span><span className=\"ml-0.5\">ì¶”ê°€/ìˆ˜ì •</span>\n                    </span>\n                  </div>\n                  <Select\n                    value={watch('contacts')[0] || ''}\n                    onValueChange={val => {\n                      setValue('contacts', [val]);\n                      setValue('contact_id', val ? Number(val) : undefined);\n                    }}\n                  >\n                    <SelectTrigger className=\"!h-9 !py-0 !leading-none bg-white border border-[#d2d2d7] rounded-md text-xs shadow-sm hover:shadow-md transition-shadow duration-200\">\n                      <SelectValue placeholder=\"ë‹´ë‹¹ì ì„ íƒ\" />\n                    </SelectTrigger>\n                    <SelectContent position=\"popper\" className=\"z-[9999]\">\n                      {contacts.map(c => (\n                        <SelectItem key={c.id} value={c.id.toString()}>\n                          {c.contact_name || c.contact_email || c.contact_phone || c.position || ''}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n\n              {/* êµ¬ë§¤ìš”êµ¬ì ë° ì¼ì • ì •ë³´ */}\n              <div className=\"grid grid-cols-3 gap-1.5 sm:gap-2\">\n                <div>\n                  <Label className=\"mb-0.5 block text-[10px] sm:text-xs\">êµ¬ë§¤ìš”êµ¬ì</Label>\n                  <ReactSelect\n                      key={`employee-select-${employeeName}`}\n                      value={employeeName ? { value: employeeName, label: employeeName } : null}\n                      defaultValue={employeeName ? { value: employeeName, label: employeeName } : null}\n                      onChange={(selectedOption) => {\n                        const value = (selectedOption as EmployeeOption)?.value || \"\";\n                        setValue('requester_name', value);\n                        setEmployeeName(value);\n                      }}\n                      options={employees.map(employee => ({\n                        value: employee.name,\n                        label: employee.name\n                      }))}\n                      placeholder=\"ì„ íƒ\"\n                      isSearchable\n                      isClearable={false}\n                      noOptionsMessage={() => \"ì¼ì¹˜í•˜ëŠ” ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤\"}\n                      filterOption={(option, inputValue) => {\n                        const employee = employees.find(emp => emp.name === option.value);\n                        const searchText = `${employee?.name || ''} ${employee?.position || ''} ${employee?.email || ''}`.toLowerCase();\n                        return searchText.includes(inputValue.toLowerCase());\n                      }}\n                      styles={{\n                        control: (base) => ({\n                          ...base,\n                          height: '36px !important',\n                          minHeight: '36px !important',\n                          maxHeight: '36px !important',\n                          background: '#fff',\n                          border: '1px solid #d2d2d7',\n                          borderRadius: '6px',\n                          fontSize: '0.75rem',\n                          boxShadow: '0 1px 2px 0 rgb(0 0 0 / 0.05)',\n                          padding: '0 !important',\n                          margin: '0 !important',\n                          alignItems: 'center',\n                          display: 'flex',\n                          position: 'relative',\n                          verticalAlign: 'top',\n                          lineHeight: '1',\n                          '&:hover': {\n                            borderColor: '#d2d2d7',\n                            boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1)'\n                          }\n                        }),\n                        valueContainer: (base) => ({\n                          ...base,\n                          height: '36px !important',\n                          minHeight: '36px !important',\n                          maxHeight: '36px !important',\n                          padding: '0 14px !important',\n                          margin: '0 !important',\n                          fontSize: '0.75rem',\n                          alignItems: 'center',\n                          display: 'flex',\n                          lineHeight: '1',\n                          justifyContent: 'flex-start'\n                        }),\n                        input: (base) => ({ \n                          ...base, \n                          margin: '0 !important', \n                          padding: '0 !important', \n                          fontSize: '0.75rem',\n                          lineHeight: '1',\n                          position: 'relative',\n                          top: '0'\n                        }),\n                        singleValue: base => ({\n                          ...base,\n                          margin: '0 !important',\n                          padding: '0 !important',\n                          fontSize: '0.75rem',\n                          lineHeight: '1',\n                          position: 'relative',\n                          top: '0',\n                          transform: 'none'\n                        }),\n                        placeholder: base => ({\n                          ...base,\n                          margin: '0 !important',\n                          padding: '0 !important',\n                          fontSize: '0.75rem',\n                          lineHeight: '1',\n                          position: 'relative',\n                          top: '0',\n                          transform: 'none'\n                        }),\n                        indicatorsContainer: (base) => ({ \n                          ...base, \n                          height: '36px !important',\n                          padding: '0 8px !important',\n                          alignItems: 'center',\n                          display: 'flex'\n                        }),\n                        indicatorSeparator: () => ({ display: 'none' }),\n                        dropdownIndicator: base => ({ ...base, padding: '4px !important' }),\n                        clearIndicator: base => ({ ...base, padding: '4px !important' }),\n                        menu: (base) => ({ ...base, fontSize: '0.75rem', zIndex: 9999 }),\n                        option: (base) => ({ ...base, fontSize: '0.75rem', padding: '6px 10px' })\n                      }}\n                    />\n                </div>\n                <div>\n                  <Label className=\"mb-0.5 block text-[10px] sm:text-xs\">ì²­êµ¬ì¼</Label>\n                  <Input\n                    type=\"date\"\n                    value={watch('request_date')}\n                    onChange={e => setValue('request_date', e.target.value)}\n                    className=\"h-9 bg-white border border-[#d2d2d7] rounded-md text-xs shadow-sm hover:shadow-md transition-shadow duration-200\"\n                  />\n                </div>\n                <div>\n                  <Label className=\"mb-0.5 block text-[10px] sm:text-xs\">ì…ê³  ìš”ì²­ì¼</Label>\n                  <Input\n                    type=\"date\"\n                    value={watch('delivery_request_date')}\n                    onChange={e => setValue('delivery_request_date', e.target.value)}\n                    className=\"h-9 bg-white border border-[#d2d2d7] rounded-md text-xs shadow-sm hover:shadow-md transition-shadow duration-200\"\n                  />\n                </div>\n              </div>\n\n              {/* í”„ë¡œì íŠ¸ ì •ë³´ */}\n              <div className=\"grid grid-cols-3 gap-1.5 sm:gap-2\">\n                <div>\n                  <Label className=\"mb-0.5 block text-[10px] sm:text-xs\">PJì—…ì²´</Label>\n                  <Input \n                    type=\"text\" \n                    value={watch('project_vendor')} \n                    onChange={(e) => setValue('project_vendor', e.target.value)} \n                    placeholder=\"ì…ë ¥\"\n                    className=\"h-9 bg-white border border-[#d2d2d7] rounded-md text-xs shadow-sm hover:shadow-md focus:shadow-md transition-shadow duration-200\"\n                  />\n                </div>\n                <div>\n                  <Label className=\"mb-0.5 block text-[10px] sm:text-xs\">ìˆ˜ì£¼ë²ˆí˜¸</Label>\n                  <Input \n                    type=\"text\" \n                    value={watch('sales_order_number')} \n                    onChange={(e) => setValue('sales_order_number', e.target.value)} \n                    placeholder=\"ì…ë ¥\"\n                    className=\"h-9 bg-white border border-[#d2d2d7] rounded-md text-xs shadow-sm hover:shadow-md focus:shadow-md transition-shadow duration-200\"\n                  />\n                </div>\n                <div>\n                  <Label className=\"mb-0.5 block text-[10px] sm:text-xs\">Item</Label>\n                  <Input \n                    type=\"text\" \n                    value={watch('project_item')} \n                    onChange={(e) => setValue('project_item', e.target.value)} \n                    placeholder=\"ì…ë ¥\"\n                    className=\"h-9 bg-white border border-[#d2d2d7] rounded-md text-xs shadow-sm hover:shadow-md focus:shadow-md transition-shadow duration-200\"\n                  />\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* Professional Items Section - ëª¨ë°”ì¼: ì „ì²´í­, ë°ìŠ¤í¬í†±: 3/4 í­ */}\n        <div className=\"w-full lg:w-3/4 space-y-4\">\n\n          {/* í…Œì´ë¸” í˜•íƒœì˜ í’ˆëª© ë¦¬ìŠ¤íŠ¸ */}\n          <div className=\"relative border border-gray-200 rounded-lg overflow-hidden\">\n            <div className=\"bg-gray-50 border-b border-gray-100 px-2 sm:px-3 py-2 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-3\">\n              <div className=\"flex flex-wrap items-center gap-3\">\n                <div className=\"flex items-center gap-2\">\n                  <Package className=\"w-4 h-4 text-gray-600\" />\n                  <div className=\"flex flex-col\">\n                    <span className=\"font-semibold text-foreground leading-tight\">í’ˆëª© ëª©ë¡</span>\n                    <span className=\"text-xs text-muted-foreground leading-tight\">Purchase Items</span>\n                  </div>\n                  <span className=\"badge-secondary whitespace-nowrap\">\n                    {fields.length}ê°œ\n                  </span>\n                </div>\n                <Select value={currency} onValueChange={setCurrency}>\n                  <SelectTrigger className=\"w-20 text-xs border-border business-radius-badge shadow-sm hover:shadow-md transition-shadow duration-200 bg-white\" style={{ height: 'auto', padding: '2.5px 10px', minHeight: 'auto' }}>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent className=\"rounded-md\">\n                    <SelectItem value=\"KRW\">KRW</SelectItem>\n                    <SelectItem value=\"USD\">USD</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"flex items-center justify-end gap-2 flex-wrap sm:flex-nowrap\">\n                <span className=\"badge-stats text-hansl-500 text-[10px] px-1.5 py-0.5 whitespace-nowrap flex-shrink-0 bg-hansl-50 business-radius-badge\">\n                  ì´ì•¡: {totalAmount.toLocaleString('ko-KR')} {currency}\n                </span>\n                <Button \n                  type=\"button\" \n                  className=\"button-base border border-gray-300 text-gray-600 bg-white hover:bg-red-50 hover:text-red-600\" \n                  onClick={() => { \n                    if (confirm('ëª¨ë“  í’ˆëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {\n                      fields.forEach((_idx, index) => remove(fields.length - 1 - index)); \n                      append({ \n                        line_number: 1, \n                        item_name: '', \n                        specification: '', \n                        quantity: 1, \n                        unit_price_value: 0, \n                        unit_price_currency: currency, \n                        amount_value: 0, \n                        amount_currency: currency, \n                        remark: '', \n                        link: '' \n                      });\n                    }\n                  }}\n                >\n                  ì „ì²´ì‚­ì œ\n                </Button>\n                <Input\n                  type=\"number\"\n                  min={1}\n                  max={1000}\n                  value={addCount}\n                  onChange={e => setAddCount(Math.max(1, Number(e.target.value.replace(/[^0-9]/g, ''))))}\n                  className=\"w-12 text-center flex-shrink-0 business-radius-badge border border-gray-300 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none [&]:!text-[12px] [&]:!font-medium [&]:!leading-tight\"\n                  style={{ \n                    height: 'auto',\n                    padding: '2px 6px', \n                    minHeight: 'auto',\n                    maxHeight: 'none',\n                    lineHeight: '1.25'\n                  }}\n                />\n                <Button\n                  type=\"button\"\n                  onClick={() => {\n                    for (let i = 0; i < addCount; i++) {\n                      append({\n                        line_number: fields.length + 1 + i,\n                        item_name: '',\n                        specification: '',\n                        quantity: 1,\n                        unit_price_value: 0,\n                        unit_price_currency: currency,\n                        amount_value: 0,\n                        amount_currency: currency,\n                        remark: '',\n                        link: ''\n                      });\n                    }\n                  }}\n                  className=\"button-base bg-blue-500 hover:bg-blue-600 text-white\"\n                >\n                  <Plus className=\"w-3 h-3 mr-0.5\" />\n                  ì¶”ê°€\n                </Button>\n              </div>\n            </div>\n            <div className=\"overflow-x-auto\">\n              <div className=\"max-h-[500px] overflow-y-auto\">\n                <table className=\"w-full text-xs\">\n                  <thead className=\"bg-gray-50 sticky top-0 z-10\">\n                    <tr className=\"border-b border-gray-200\">\n                      <th className=\"px-2 py-2 text-left font-medium text-gray-700 w-10\">#</th>\n                      <th className=\"px-2 py-2 text-left font-medium text-gray-700 min-w-[100px] sm:min-w-[120px]\">\n                        í’ˆëª©<span className=\"text-red-500\">*</span>\n                      </th>\n                      <th className=\"px-2 py-2 text-left font-medium text-gray-700 min-w-[250px] sm:min-w-[320px]\">ê·œê²©</th>\n                      <th className=\"px-2 py-2 text-center font-medium text-gray-700 w-20\">\n                        ìˆ˜ëŸ‰<span className=\"text-red-500\">*</span>\n                      </th>\n                      <th className=\"px-2 py-2 text-right font-medium text-gray-700 w-[140px] sm:w-[160px]\">\n                        ë‹¨ê°€ ({currency})\n                      </th>\n                      <th className=\"px-2 py-2 text-right font-medium text-gray-700 min-w-[110px] sm:min-w-[140px]\">\n                        í•©ê³„ ({currency})\n                      </th>\n                      {paymentCategory === \"êµ¬ë§¤ ìš”ì²­\" && (\n                        <th className=\"px-2 py-2 text-left font-medium text-gray-700 min-w-[120px] sm:min-w-[150px]\">ë§í¬</th>\n                      )}\n                      <th className=\"px-2 py-2 text-left font-medium text-gray-700 min-w-[100px] sm:min-w-[150px]\">ë¹„ê³ </th>\n                      <th className=\"px-2 py-2 text-center font-medium text-gray-700 w-10\"></th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"bg-white\">\n                    {fields.map((item, idx) => (\n                      <tr key={idx} className=\"border-b border-gray-100 hover:bg-gray-50\">\n                        <td className=\"px-2 py-1 text-center text-gray-500\">{idx + 1}</td>\n                        {/* í’ˆëª© */}\n                        <td className=\"px-2 py-1\">\n                          <Input\n                            value={item.item_name}\n                            onChange={(e) => update(idx, { ...item, item_name: e.target.value })}\n                            className=\"h-7 w-full bg-white border border-gray-200 text-xs\"\n                            placeholder=\"í’ˆëª©ëª… ì…ë ¥\"\n                          />\n                        </td>\n\n                        {/* ê·œê²© */}\n                        <td className=\"px-2 py-1\">\n                          <Input\n                            value={item.specification}\n                            onChange={(e) => update(idx, { ...item, specification: e.target.value })}\n                            className=\"h-7 w-full bg-white border border-gray-200 text-xs\"\n                            placeholder=\"ê·œê²© ì…ë ¥\"\n                          />\n                        </td>\n\n                        {/* ìˆ˜ëŸ‰ */}\n                        <td className=\"px-2 py-1\">\n                          <Input\n                            type=\"number\"\n                            min=\"1\"\n                            value={item.quantity || ''}\n                            className=\"h-7 w-20 bg-white border border-gray-200 text-xs text-center [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none\"\n                            placeholder=\"0\"\n                            onChange={(e) => {\n                              const newQuantity = parseInt(e.target.value) || 0;\n                              update(idx, { ...item, quantity: newQuantity });\n                            }}\n                          />\n                        </td>\n\n                        {/* ë‹¨ê°€ */}\n                        <td className=\"px-2 py-1\">\n                          <div className=\"flex items-center\">\n                            <Input\n                              type=\"text\"\n                              inputMode=\"decimal\"\n                              value={inputValues[`${idx}_unit_price_value`] ?? (item.unit_price_value === 0 ? \"\" : item.unit_price_value?.toLocaleString('ko-KR') || \"\")}\n                              onChange={(e) => {\n                                const raw = e.target.value.replace(/,/g, \"\");\n                                // ìˆ«ìì™€ ì†Œìˆ˜ì ë§Œ í—ˆìš©\n                                const cleanValue = raw.replace(/[^0-9.]/g, '');\n                                // ì†Œìˆ˜ì  ì¤‘ë³µ ë°©ì§€\n                                const parts = cleanValue.split('.');\n                                const finalValue = parts.length > 2 ? parts[0] + '.' + parts.slice(1).join('') : cleanValue;\n                                \n                                // ì…ë ¥ ì¤‘ì¸ ê°’ ì €ì¥ (ì†Œìˆ˜ì  ìœ ì§€)\n                                setInputValues(prev => ({...prev, [`${idx}_unit_price_value`]: finalValue}));\n                                \n                                // ê³„ì‚°ìš© ìˆ«ì ê°’ ì €ì¥\n                                const numVal = finalValue === '' ? 0 : parseFloat(finalValue) || 0;\n                                update(idx, { ...item, unit_price_value: numVal });\n                              }}\n                              onBlur={() => {\n                                // í¬ì»¤ìŠ¤ ë²—ì–´ë‚  ë•Œ ì…ë ¥ê°’ ì •ë¦¬\n                                setInputValues(prev => {\n                                  const newState = {...prev};\n                                  delete newState[`${idx}_unit_price_value`];\n                                  return newState;\n                                });\n                              }}\n                              className=\"h-7 w-32 bg-white border border-gray-200 text-xs text-right\"\n                              placeholder=\"0\"\n                            />\n                            <span className=\"ml-1 text-xs text-gray-500\">{currency === \"KRW\" ? \"â‚©\" : \"$\"}</span>\n                          </div>\n                        </td>\n\n                        {/* í•©ê³„ */}\n                        <td className=\"px-2 py-1\">\n                          <div className=\"flex items-center justify-end\">\n                            <span className=\"text-xs text-right font-medium\">\n                              {(item.amount_value || 0).toLocaleString('ko-KR')}\n                            </span>\n                            <span className=\"ml-1 text-xs text-gray-500\">{currency === \"KRW\" ? \"â‚©\" : \"$\"}</span>\n                          </div>\n                        </td>\n\n                        {/* ë§í¬ (êµ¬ë§¤ìš”ì²­ì¼ ë•Œë§Œ) */}\n                        {paymentCategory === \"êµ¬ë§¤ ìš”ì²­\" && (\n                          <td className=\"px-2 py-1\">\n                            <Input\n                              value={item.link || ''}\n                              onChange={(e) => update(idx, { ...item, link: e.target.value })}\n                              type=\"url\"\n                              className=\"h-7 w-full bg-white border border-gray-200 text-xs\"\n                              placeholder=\"https://...\"\n                            />\n                          </td>\n                        )}\n\n                        {/* ë¹„ê³  */}\n                        <td className=\"px-2 py-1\">\n                          <Input\n                            value={item.remark || ''}\n                            onChange={(e) => update(idx, { ...item, remark: e.target.value })}\n                            className=\"h-7 w-full bg-white border border-gray-200 text-xs\"\n                            placeholder=\"ë¹„ê³ \"\n                          />\n                        </td>\n                        {/* ì‚­ì œ ë²„íŠ¼ */}\n                        <td className=\"px-2 py-1 text-center\">\n                          {fields.length > 1 && (\n                            <Button\n                              type=\"button\"\n                              onClick={() => remove(idx)}\n                              size=\"sm\"\n                              variant=\"ghost\"\n                              className=\"h-6 w-6 p-0 hover:bg-red-50\"\n                            >\n                              <X className=\"w-3 h-3 text-red-600\" />\n                            </Button>\n                          )}\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n            </div>\n          </div>\n          \n          {/* ì œì¶œ ë²„íŠ¼ */}\n          <div className=\"flex justify-end gap-3 mt-2\">\n            <Button \n              type=\"button\" \n              variant=\"outline\"\n              onClick={() => navigate(-1)}\n              className=\"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 hover:border-gray-400\"\n            >\n              ì·¨ì†Œ\n            </Button>\n            <Button \n              type=\"submit\"\n              disabled={loading || !isFormValid}\n              className=\"button-base bg-hansl-600 hover:bg-hansl-700 text-white\"\n            >\n              {loading ? (\n                <>\n                  <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2\" />\n                  ì²˜ë¦¬ ì¤‘...\n                </>\n              ) : (\n                <>\n                  <Save className=\"w-4 h-4 mr-2\" />\n                  ë°œì£¼ìš”ì²­\n                </>\n              )}\n            </Button>\n          </div>\n        </div>\n      </div>\n\n      {/* ì—ëŸ¬ ë©”ì‹œì§€ */}\n      {error && (\n        <div className=\"mt-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-700 text-sm\">\n          {error}\n        </div>\n      )}\n\n      {/* ë‹´ë‹¹ì ê´€ë¦¬ ëª¨ë‹¬ */}\n      <Dialog open={isContactDialogOpen} onOpenChange={setIsContactDialogOpen}>\n        <DialogContent className=\"w-full max-w-[95vw] sm:max-w-3xl max-h-[80vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>ë‹´ë‹¹ì ê´€ë¦¬</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            {contactsForEdit.map((contact, index) => (\n              <div key={index} className=\"flex gap-2 items-end\">\n                <div className=\"flex-1\">\n                  <Label className=\"text-xs\">ì´ë¦„</Label>\n                  <Input\n                    value={contact.contact_name}\n                    onChange={(e) => handleContactChange(index, 'contact_name', e.target.value)}\n                    placeholder=\"ë‹´ë‹¹ì ì´ë¦„\"\n                    className=\"h-9\"\n                  />\n                </div>\n                <div className=\"flex-1\">\n                  <Label className=\"text-xs\">ì´ë©”ì¼</Label>\n                  <Input\n                    value={contact.contact_email}\n                    onChange={(e) => handleContactChange(index, 'contact_email', e.target.value)}\n                    placeholder=\"ì´ë©”ì¼\"\n                    className=\"h-9\"\n                  />\n                </div>\n                <div className=\"flex-1\">\n                  <Label className=\"text-xs\">ì „í™”ë²ˆí˜¸</Label>\n                  <Input\n                    value={contact.contact_phone}\n                    onChange={(e) => handleContactChange(index, 'contact_phone', e.target.value)}\n                    placeholder=\"ì „í™”ë²ˆí˜¸\"\n                    className=\"h-9\"\n                  />\n                </div>\n                <div className=\"flex-1\">\n                  <Label className=\"text-xs\">ì§ì±…</Label>\n                  <Input\n                    value={contact.position}\n                    onChange={(e) => handleContactChange(index, 'position', e.target.value)}\n                    placeholder=\"ì§ì±…\"\n                    className=\"h-9\"\n                  />\n                </div>\n                <Button\n                  type=\"button\"\n                  size=\"sm\"\n                  variant=\"ghost\"\n                  onClick={() => removeContactSlot(index)}\n                  className=\"h-9 px-2\"\n                >\n                  <X className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            ))}\n          </div>\n          <DialogFooter className=\"gap-2\">\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              onClick={addNewContactSlot}\n              size=\"sm\"\n            >\n              <Plus className=\"h-4 w-4 mr-1\" />\n              ë‹´ë‹¹ì ì¶”ê°€\n            </Button>\n            <DialogClose asChild>\n              <Button type=\"button\" variant=\"outline\" size=\"sm\">\n                ì·¨ì†Œ\n              </Button>\n            </DialogClose>\n            <Button\n              type=\"button\"\n              onClick={handleSaveAllContacts}\n              disabled={!hasChanges}\n              size=\"sm\"\n            >\n              ì €ì¥\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </form>\n  );\n}"],"names":["PurchaseNewMain","navigate","useNavigate","supabase","createClient","user","setUser","useState","employeeName","setEmployeeName","employees","setEmployees","defaultRequesterLoaded","setDefaultRequesterLoaded","addCount","setAddCount","vendorSearchTerm","setVendorSearchTerm","useEffect","async","data","auth","getUser","error","from","select","order","length","map","dbEmp","id","name","email","phone","address","position","department","find","emp","currentUser","err","loadEmployees","vendors","setVendors","contacts","setContacts","vendor","setVendor","selectedContacts","setSelectedContacts","currency","setCurrency","loading","setLoading","setError","inputValues","setInputValues","isContactDialogOpen","setIsContactDialogOpen","contactsForEdit","setContactsForEdit","hasChanges","setHasChanges","isSubmittingRef","useRef","control","handleSubmit","rhHandleSubmit","watch","setValue","reset","getValues","useFormRH","defaultValues","progress_type","payment_category","po_template_type","request_type","sales_order_number","project_vendor","project_item","delivery_request_date","vendor_id","requester_name","items","line_number","item_name","specification","quantity","unit_price_value","unit_price_currency","amount_value","amount_currency","remark","link","request_date","Date","toISOString","slice","fields","append","remove","update","useFieldArray","empData","eq","single","loadUserName","employeeData","setTimeout","shouldValidate","shouldDirty","fallbackName","split","setDefaultRequester","toast","loadVendors","selectedVendor","loadContacts","updatedItems","item","forEach","idx","calcAmount","Number","f","join","checkRequiredFields","requestType","progressType","paymentCategory","vendorId","isFormValid","setIsFormValid","generatePurchaseOrderNumber","prefix","getTime","replace","existingOrders","queryError","like","ascending","nextNumber","maxSequence","parts","purchase_order_number","sequenceStr","sequence","parseInt","isNaN","safeNextNumber","String","padStart","currentEmployee","current","prId","purchaseOrderNumber","maxRetries","retryCount","pr","prError","insert","requester_id","requester_phone","requester_fax","requester_address","is_payment_completed","total_amount","reduce","sum","i","contact_id","message","includes","Error","Promise","resolve","Math","random","retryError","entries","itemErr","purchase_request_id","notifyResponse","fetch","method","headers","ok","json","text","notifyError","success","invalidatePurchaseMemoryCache","routerError","window","location","href","totalAmount","handleContactChange","index","field","value","prev","contact","jsxs","onSubmit","e","preventDefault","onKeyDown","key","keyCode","children","className","jsx","Label","Select","onValueChange","SelectTrigger","SelectValue","placeholder","SelectContent","SelectItem","ReactSelect","options","v","toString","label","vendor_name","onChange","option","opt","isClearable","isSearchable","closeMenuOnSelect","classNamePrefix","blurInputOnSelect","openMenuOnFocus","openMenuOnClick","tabSelectsValue","captureMenuScroll","pageSize","styles","container","base","width","height","minHeight","maxHeight","background","border","borderRadius","fontSize","boxShadow","padding","margin","alignItems","display","verticalAlign","lineHeight","valueContainer","justifyContent","input","top","singleValue","transform","indicatorsContainer","indicatorSeparator","dropdownIndicator","clearIndicator","menuPortal","zIndex","onClick","existingContacts","c","isNew","contact_name","contact_email","contact_phone","val","defaultValue","selectedOption","employee","noOptionsMessage","filterOption","inputValue","toLowerCase","borderColor","menu","Input","type","target","Package","style","toLocaleString","Button","confirm","_idx","min","max","Plus","newQuantity","inputMode","cleanValue","finalValue","numVal","parseFloat","onBlur","newState","size","variant","X","disabled","Fragment","Save","Dialog","open","onOpenChange","DialogContent","DialogHeader","DialogTitle","filter","_","removeContactSlot","DialogFooter","DialogClose","asChild","endsWith","alert"],"mappings":"mhBAsBA,SAAwBA,IACtB,MAAMC,EAAWC,IACXC,EAAWC,KAEVC,EAAMC,GAAWC,EAAAA,SAAc,OAC/BC,EAAcC,GAAmBF,EAAAA,SAAiB,KAClDG,EAAWC,GAAgBJ,EAAAA,SAAkI,KAC7JK,EAAwBC,GAA6BN,EAAAA,UAAS,IAC9DO,EAAUC,GAAeR,EAAAA,SAAS,IAClCS,EAAkBC,GAAuBV,EAAAA,SAAS,IAGzDW,EAAAA,UAAU,KACQC,WACd,MAAQC,MAAQf,KAAAA,UAAiBF,EAASkB,KAAKC,UAC/ChB,EAAQD,IAEViB,IACC,IAEHJ,EAAAA,UAAU,KAEcC,WACpB,IACE,MAAMC,KAAEA,EAAMG,MAAAA,SAAgBpB,EAC3BqB,KAAK,aACLC,OAAO,wDACPC,MAAM,QAGT,GAAIN,IAASG,GAASH,EAAKO,OAAS,GAYlC,GAXAhB,EAAaS,EAAKQ,IAAKC,IAAA,CACrBC,GAAID,EAAMC,GACVC,KAAMF,EAAME,KACZC,MAAOH,EAAMG,OAAS,GACtBC,MAAOJ,EAAMI,OAAS,GACtBC,QAASL,EAAMK,SAAW,GAC1BC,SAAUN,EAAMM,UAAY,GAC5BC,WAAYP,EAAMO,YAAc,OAI9B5B,IAAiBY,EAAKiB,KAAMC,GAAaA,EAAIP,OAASvB,GAAe,CAEvE,MAAM+B,EAAc,CAClBT,GAAIzB,GAAMyB,IAAM,eAChBC,KAAMvB,EACNwB,MAAO3B,GAAM2B,OAAS,GACtBC,MAAO,GACPC,QAAS,GACTC,SAAU,GACVC,WAAY,IAEdzB,EAAa,IAAIS,EAAKQ,IAAKC,IAAA,CACzBC,GAAID,EAAMC,GACVC,KAAMF,EAAME,KACZC,MAAOH,EAAMG,OAAS,GACtBC,MAAOJ,EAAMI,OAAS,GACtBC,QAASL,EAAMK,SAAW,GAC1BC,SAAUN,EAAMM,UAAY,GAC5BC,WAAYP,EAAMO,YAAc,MAC7BG,GACP,OAIE5B,EADEH,EACW,CAAC,CACZsB,GAAIzB,GAAMyB,IAAM,eAChBC,KAAMvB,EACNwB,MAAO3B,GAAM2B,OAAS,GACtBC,MAAO,GACPC,QAAS,GACTC,SAAU,GACVC,WAAY,KAGD,GAGnB,OAASI,GAGL7B,EADEH,EACW,CAAC,CACZsB,GAAIzB,GAAMyB,IAAM,eAChBC,KAAMvB,EACNwB,MAAO3B,GAAM2B,OAAS,GACtBC,MAAO,GACPC,QAAS,GACTC,SAAU,GACVC,WAAY,KAGD,GAEjB,GAIFK,IACC,CAACjC,EAAcH,IAElB,MAAOqC,EAASC,GAAcpC,EAAAA,SAAgD,KACvEqC,EAAUC,GAAetC,EAAAA,SAAiH,KAC1IuC,EAAQC,GAAaxC,EAAAA,SAAS,KAC9ByC,EAAkBC,GAAuB1C,EAAAA,SAAmB,KAC5D2C,EAAUC,GAAe5C,EAAAA,SAAS,QAClC6C,EAASC,GAAc9C,EAAAA,UAAS,IAChCgB,EAAO+B,IAAY/C,EAAAA,SAAS,KAC5BgD,GAAaC,IAAkBjD,EAAAA,SAAkC,CAAA,IACjEkD,GAAqBC,IAA0BnD,EAAAA,UAAS,IACxDoD,GAAiBC,IAAsBrD,EAAAA,SAAmI,KAC1KsD,GAAYC,IAAiBvD,EAAAA,UAAS,GAEvCwD,GAAkBC,EAAAA,QAAO,IAEzBC,QAAEA,GAASC,aAAcC,GAAAC,MAAgBA,YAAOC,GAAAC,MAAUA,GAAAC,UAAOA,IAAcC,EAAsB,CACzGC,cAAe,CACbC,cAAe,GACfC,iBAAkB,GAClBzB,SAAU,MACV0B,iBAAkB,KAClBC,aAAc,GACdjC,SAAU,GACVkC,mBAAoB,GACpBC,eAAgB,GAChBC,aAAc,GACdC,sBAAuB,GACvBC,UAAW,EACXC,eAAgB,GAChBC,MAAO,CACL,CACEC,YAAa,EACbC,UAAW,GACXC,cAAe,GACfC,SAAU,EACVC,iBAAkB,EAClBC,oBAAqB,MACrBC,aAAc,EACdC,gBAAiB,MACjBC,OAAQ,GACRC,KAAM,KAGVC,cAAA,IAAkBC,MAAOC,cAAcC,MAAM,EAAG,QAI9CC,OAAEA,GAAAC,OAAQA,GAAAC,OAAQA,GAAAC,OAAQA,IAAWC,EAAc,CACvDtC,WACAlC,KAAM,UAIRb,EAAAA,UAAU,KACR,IAAKb,GAAM2B,OAASpB,EAAwB,OAEvBO,WACnB,MAAQC,KAAMoF,SAAkBrG,EAC7BqB,KAAK,aACLC,OAAO,QACPgF,GAAG,QAASpG,EAAK2B,OACjB0E,SAECF,GAASzE,OACXtB,EAAgB+F,EAAQzE,MACxBsC,GAAS,iBAAkBmC,EAAQzE,MACnClB,GAA0B,KAG9B8F,IACC,CAACtG,EAAMF,EAAUkE,GAAUzD,IAG9BM,EAAAA,UAAU,KACoBC,WAC1B,GAAId,GAAM2B,OAASqC,KAAazD,EAC9B,IACE,MAAQQ,KAAMwF,EAAcrF,MAAAA,SAAgBpB,EACzCqB,KAAK,aACLC,OAAO,QACPgF,GAAG,QAASpG,EAAK2B,OACjB0E,SAEH,GAAIE,IAAiBrF,EACnBd,EAAgBmG,EAAa7E,MAE7B8E,WAAW,KACTxC,GAAS,iBAAkBuC,EAAa7E,KAAM,CAC5C+E,gBAAgB,EAChBC,aAAa,KAEd,KACHlG,GAA0B,OACrB,CACL,MAAMmG,EAAe3G,EAAK2B,MAAMiF,MAAM,KAAK,IAAM,MACjDxG,EAAgBuG,GAChBH,WAAW,KACTxC,GAAS,iBAAkB2C,EAAc,CACvCF,gBAAgB,EAChBC,aAAa,KAEd,KACHlG,GAA0B,EAC5B,CACF,OAAS2B,GACP,MAAMwE,EAAe3G,EAAK2B,OAAOiF,MAAM,KAAK,IAAM,MAClDxG,EAAgBuG,GAChBH,WAAW,KACTxC,GAAS,iBAAkB2C,EAAc,CACvCF,gBAAgB,EAChBC,aAAa,KAEd,KACHlG,GAA0B,EAC5B,GAIJqG,IACC,CAAC7G,EAAMgE,GAAUzD,IAGpBM,EAAAA,UAAU,KACYC,WAClB,IACE,MAAMC,KAAEA,EAAMG,MAAAA,SAAgBpB,EAC3BqB,KAAK,WACLC,OAAO,KACPC,MAAM,eAET,GAAIH,EAAO,MAAMA,EACjBoB,EAAWvB,GAAQ,GACrB,OAASG,GACP4F,EAAM5F,MAAM,qBACd,GAGF6F,IACC,IAEH,MAAMC,GAAiBjD,GAAM,aAG7BlD,EAAAA,UAAU,KACaC,WACnB,GAAIkG,GACF,IACE,MAAMjG,KAAEA,EAAMG,MAAAA,SAAgBpB,EAC3BqB,KAAK,mBACLC,OAAO,4DACPgF,GAAG,YAAaY,IAEnB,GAAI9F,EAAO,MAAMA,EACjBsB,EAAYzB,GAAQ,GACtB,OAASG,GACPsB,EAAY,GACd,MAEAA,EAAY,KAIhByE,IACC,CAACD,KAGJnG,EAAAA,UAAU,KACR,MACMqG,EADQhD,GAAU,SACG3C,IAAI4F,IAAA,IAC1BA,EACH9B,oBAAqBxC,EACrB0C,gBAAiB1C,KAEnBmB,GAAS,QAASkD,GAClBpE,EAAYD,IACX,CAACA,EAAUmB,GAAUE,KAGxBrD,EAAAA,UAAU,KACRiF,GAAOsB,QAAQ,CAACD,EAAME,KACpB,MAAMC,EAAaC,OAAOJ,EAAKhC,UAAYoC,OAAOJ,EAAK/B,kBACnD+B,EAAK7B,eAAiBgC,GACxBrB,GAAOoB,EAAK,IAAKF,EAAM7B,aAAcgC,OAIxC,CAACxB,GAAOvE,IAAIiG,GAAK,GAAGA,EAAErC,YAAYqC,EAAEpC,oBAAoBqC,KAAK,OAsChE,MAAMC,GAAsB,KAC1B,MAAMC,EAAc5D,GAAM,gBACpB6D,EAAe7D,GAAM,iBACrB8D,EAAkB9D,GAAM,oBACxB+D,EAAW/D,GAAM,aAEvB,SAAU4D,GAAeC,GAAgBC,GAAmBC,GAAyB,IAAbA,GAAkBhC,GAAOxE,OAAS,KAIrGyG,GAAaC,IAAkB9H,EAAAA,UAAS,GAG/CW,EAAAA,UAAU,KACRmH,GAAeN,OACd,CAAC3D,GAAM,gBAAiBA,GAAM,iBAAkBA,GAAM,oBAAqBA,GAAM,aAAc+B,KAGlG,MAAMmC,GAA8BnH,UAClC,MAIMoH,EAAS,IAFG,IAAIvC,UAFJA,MAEewC,UAAa,OACpBvC,cAAcC,MAAM,EAAG,IAAIuC,QAAQ,KAAM,QAI3DrH,KAAMsH,EAAgBnH,MAAOoH,SAAqBxI,EACvDqB,KAAK,qBACLC,OAAO,yBACPmH,KAAK,wBAAyB,GAAGL,MACjC7G,MAAM,wBAAyB,CAAEmH,WAAW,IAM/C,IAAIC,EAAa,EACbC,EAAc,EAElB,GAAIL,GAAkBA,EAAe/G,OAAS,EAAG,CAE/C,IAAA,MAAWD,KAASgH,EAAgB,CAClC,MAGMM,EAHctH,EAAMuH,sBAGAhC,MAAM,KAChC,GAAI+B,EAAMrH,QAAU,EAAG,CACrB,MAAMuH,EAAcF,EAAM,GACpBG,EAAWC,SAASF,EAAa,KAGlCG,MAAMF,IAAaA,EAAWJ,IACjCA,EAAcI,EAElB,CACF,CAEAL,EAAaC,EAAc,CAC7B,CAGA,MAAMO,EAAiBD,MAAMP,GAAc,EAAIA,EAG/C,MAF4B,GAAGP,IAASgB,OAAOD,GAAgBE,SAAS,EAAG,QAMvEtF,GAAe/C,MAAOC,IAC1B,MAAMqI,EAAkB/I,EAAU2B,QAAYC,EAAIP,OAASX,EAAK+D,gBAEhE,IAAIpB,GAAgB2F,QAIpB,GAAKD,GAML,GAAK1B,KAAL,CAIAhE,GAAgB2F,SAAU,EAC1BrG,GAAW,GACXC,GAAS,IAET,IAEE,IAAIqG,EAAe,EACfC,EAA8B,GAClC,MAAMC,EAAa,EACnB,IAAIC,EAAa,EAGjB,KAAOA,EAAaD,GAClB,IAEED,QAA4BtB,KAG5B,MAAQlH,KAAM2I,EAAIxI,MAAOyI,SAAkB7J,EAASqB,KAAK,qBAAqByI,OAAO,CACnFC,aAAcT,EAAgB3H,GAC9BmH,sBAAuBW,EACvBzE,eAAgB/D,EAAK+D,eACrBgF,gBAAiBV,GAAiBxH,MAClCmI,cAAe,KACfC,kBAAmBZ,GAAiBvH,QACpCgD,UAAW9D,EAAK8D,UAChBJ,mBAAoB1D,EAAK0D,mBACzBC,eAAgB3D,EAAK2D,eACrBC,aAAc5D,EAAK4D,aACnBe,aAAc3E,EAAK2E,aACnBd,sBAAuB7D,EAAK6D,uBAAyB,KACrDJ,aAAczD,EAAKyD,aACnBH,cAAetD,EAAKsD,cACpB4F,sBAAsB,EACtB3F,iBAAkBvD,EAAKuD,iBACvBzB,WACAqH,aAAcpE,GAAOqE,OAAO,CAACC,EAAKC,IAAMD,EAAMC,EAAE/E,aAAc,GAC9DD,oBAAqBS,GAAO,IAAIT,qBAAuBxC,EACvD0B,iBAAkBxD,EAAKwD,iBACvB+F,WAAYvJ,EAAKuJ,WAAa/C,OAAOxG,EAAKuJ,YAAc,OACvDlJ,OAAO,MAAMiF,SAGhB,GAAIsD,IAAYA,EAAQY,QAAQC,SAAS,kDACvC,MAAMb,EAIR,GAAIA,GAAWA,EAAQY,QAAQC,SAAS,kDAAmD,CAEzF,GADAf,IACIA,GAAcD,EAChB,MAAM,IAAIiB,MAAM,cAAcjB,oCAG1B,IAAIkB,QAAQC,GAAWnE,WAAWmE,EAAS,IAAsB,IAAhBC,KAAKC,WAC5D,QACF,CAGA,IAAKnB,EAAI,MAAM,IAAIe,MAAM,SACzBnB,EAAOI,EAAGjI,GACV,KAEF,OAASqJ,GAEP,IAAKA,EAAWP,QAAQC,SAAS,kDAC/B,MAAMM,EAIR,GADArB,IACIA,GAAcD,EAChB,MAAM,IAAIiB,MAAM,cAAcjB,oCAI1B,IAAIkB,QAAQC,GAAWnE,WAAWmE,EAAS,IAAsB,IAAhBC,KAAKC,UAC9D,CAIF,IAAA,MAAYxD,EAAKF,KAASrB,GAAOiF,UAAW,CAC1C,MAAQ7J,MAAO8J,SAAkBlL,EAASqB,KAAK,0BAA0ByI,OAAO,CAC9EqB,oBAAqB3B,EACrBtE,YAAaqC,EAAM,EACnBpC,UAAWkC,EAAKlC,UAChBC,cAAeiC,EAAKjC,cACpBC,SAAUgC,EAAKhC,SACfC,iBAAkB+B,EAAK/B,iBACvBC,oBAAqBxC,EACrByC,aAAc6B,EAAK7B,aACnBC,gBAAiB1C,EACjB2C,OAAQ2B,EAAK3B,OACbC,KAAM0B,EAAK1B,MAAQ,OAErB,GAAIuF,EAAS,MAAMA,CACrB,CAKA,IACE,MAAME,QAAuBC,MAAM,iBAAiB7B,0BAA8B,CAChF8B,OAAQ,OACRC,QAAS,CACP,eAAgB,sBAIpB,GAAIH,EAAeI,GAAI,OACMJ,EAAeK,MAC5C,KAAO,OACmBL,EAAeM,MACzC,CACF,OAASC,GACT,CAGAxH,GAAM,CACJI,cAAe,GACfC,iBAAkB,GAClBzB,SAAU,MACV0B,iBAAkB,KAClBC,aAAc,GACdjC,SAAU,GACVkC,mBAAoB,GACpBC,eAAgB,GAChBC,aAAc,GACdC,sBAAuB,GACvBC,UAAW,EACXC,eAAgB3E,EAChB4E,MAAO,CACL,CACEC,YAAa,EACbC,UAAW,GACXC,cAAe,GACfC,SAAU,EACVC,iBAAkB,EAClBC,oBAAqB,MACrBC,aAAc,EACdC,gBAAiB,MACjBC,OAAQ,GACRC,KAAM,KAGVC,cAAA,IAAkBC,MAAOC,cAAcC,MAAM,EAAG,MAIlDnD,EAAU,IACVE,EAAoB,IACpBE,EAAY,OACZG,GAAS,IACTD,GAAW,GAGX8D,EAAM4E,QAAQ,yBAGdC,IAGA,UACQ/L,EAAS,6BACjB,OAASgM,GAEPC,OAAOC,SAASC,KAAO,4BACzB,CACA,MACF,OAAS5J,GACPc,GAASd,EAAIoI,SAAW,eACxBzD,EAAM5F,MAAMiB,EAAIoI,SAAW,oBAC7B,CAAA,QAEEvH,GAAW,GACXU,GAAgB2F,SAAU,CAC5B,CAjLA,OAPEpG,GAAS,8CA2LP+I,GAAclG,GAAOqE,OAAO,CAACC,EAAKjD,IAASiD,EAAMjD,EAAK7B,aAAc,GAWpE2G,GAAsB,CAACC,EAAeC,EAAeC,KACzD7I,MAA2B8I,EAAK9K,IAAI,CAAC+K,EAASjC,IAC5CA,IAAM6B,EAAQ,IAAKI,EAASH,CAACA,GAAQC,GAAUE,IAEjD7I,IAAc,IAwFVoE,GAAkB9D,GAAM,oBAE9B,OACEwI,EAAAA,KAAC,OAAA,CACCC,SAAWC,IACTA,EAAEC,iBACF5I,GAAeD,GAAfC,CAA6B2I,IAE/BE,UAAWF,IACK,UAAVA,EAAEG,KAAiC,KAAdH,EAAEI,SACzBJ,EAAEC,kBAINI,SAAA,GAAAP,KAAC,MAAA,CAAIQ,UAAU,2CAEbD,SAAA,GAAAP,KAAC,MAAA,CAAIQ,UAAU,qJACbD,SAAA,GAAAP,KAAC,MAAA,CAAIQ,UAAU,wDACbD,SAAA,GAAAP,KAAC,MAAA,CAAIQ,UAAU,gBACbD,SAAA,CAAAE,EAAAA,IAAC,KAAA,CAAGD,UAAU,gCAAgCD,SAAA,aAC9CE,EAAAA,IAAC,IAAA,CAAED,UAAU,uCAAuCD,SAAA,2BAEtDP,KAAC,MAAA,CAAIQ,UAAU,4BACbD,SAAA,GAAAP,KAACU,EAAA,CAAMF,UAAU,qBAAqBD,SAAA,CAAA,SAAME,EAAAA,IAAC,OAAA,CAAKD,UAAU,oBAAoBD,SAAA,SAChFP,EAAAA,KAACW,EAAA,CAAOd,MAAOrI,GAAM,oBAAqBoJ,cAAef,GAASpI,GAAS,mBAAoBoI,GAC7FU,SAAA,CAAAE,EAAAA,IAACI,GAAcL,UAAU,+HACvBD,eAACO,EAAA,CAAYC,YAAY,YAE3Bf,EAAAA,KAACgB,EAAA,CAAczL,SAAS,SAASiL,UAAU,WACzCD,SAAA,CAAAE,EAAAA,IAACQ,EAAA,CAAWpB,MAAM,KAAKU,SAAA,OACvBE,EAAAA,IAACQ,EAAA,CAAWpB,MAAM,MAAMU,SAAA,QACxBE,EAAAA,IAACQ,EAAA,CAAWpB,MAAM,MAAMU,SAAA,QACxBE,EAAAA,IAACQ,EAAA,CAAWpB,MAAM,KAAKU,SAAA,mBAKA,OAA9B/I,GAAM,qBACLwI,EAAAA,KAAC,MAAA,CAAIQ,UAAU,YAEbD,SAAA,GAAAP,KAAC,MAAA,CAAIQ,UAAU,oCACbD,SAAA,CAAAP,OAAC,MAAA,CACCO,SAAA,GAAAP,KAACU,EAAA,CAAMF,UAAU,sCAAsCD,SAAA,CAAA,QAAKE,EAAAA,IAAC,OAAA,CAAKD,UAAU,sBAAsBD,SAAA,SAClGP,EAAAA,KAACW,EAAA,CAAOd,MAAOrI,GAAM,gBAAiBoJ,cAAgBf,GAAUpI,GAAS,eAAgBoI,GACvFU,SAAA,CAAAE,EAAAA,IAACI,GAAcL,UAAU,wIACvBD,eAACO,EAAA,CAAYC,YAAY,SAE3Bf,EAAAA,KAACgB,EAAA,CAAczL,SAAS,SAASiL,UAAU,WACzCD,SAAA,CAAAE,EAAAA,IAACQ,EAAA,CAAWpB,MAAM,MAAMU,SAAA,QACxBE,EAAAA,IAACQ,EAAA,CAAWpB,MAAM,MAAMU,SAAA,wBAI7B,MAAA,CACCA,SAAA,GAAAP,KAACU,EAAA,CAAMF,UAAU,sCAAsCD,SAAA,CAAA,QAAKE,EAAAA,IAAC,OAAA,CAAKD,UAAU,sBAAsBD,SAAA,SAClGP,EAAAA,KAACW,EAAA,CAAOd,MAAOrI,GAAM,iBAAkBoJ,cAAgBf,GAAUpI,GAAS,gBAAiBoI,GACzFU,SAAA,CAAAE,EAAAA,IAACI,GAAcL,UAAU,wIACvBD,eAACO,EAAA,CAAYC,YAAY,SAE3Bf,EAAAA,KAACgB,EAAA,CAAczL,SAAS,SAASiL,UAAU,WACzCD,SAAA,CAAAE,EAAAA,IAACQ,EAAA,CAAWpB,MAAM,KAAKU,SAAA,OACvBE,EAAAA,IAACQ,EAAA,CAAWpB,MAAM,MAAMU,SAAA,wBAI7B,MAAA,CACCA,SAAA,GAAAP,KAACU,EAAA,CAAMF,UAAU,sCAAsCD,SAAA,CAAA,QAAKE,EAAAA,IAAC,OAAA,CAAKD,UAAU,sBAAsBD,SAAA,SAClGP,EAAAA,KAACW,EAAA,CAAOd,MAAOrI,GAAM,oBAAqBoJ,cAAgBf,GAAUpI,GAAS,mBAAoBoI,GAC/FU,SAAA,CAAAE,EAAAA,IAACI,GAAcL,UAAU,wIACvBD,eAACO,EAAA,CAAYC,YAAY,SAE3Bf,EAAAA,KAACgB,EAAA,CAAczL,SAAS,SAASiL,UAAU,WACzCD,SAAA,CAAAE,EAAAA,IAACQ,EAAA,CAAWpB,MAAM,QAAQU,SAAA,UAC1BE,EAAAA,IAACQ,EAAA,CAAWpB,MAAM,KAAKU,SAAA,OACvBE,EAAAA,IAACQ,EAAA,CAAWpB,MAAM,QAAQU,SAAA,wBAOlCP,KAAC,MAAA,CAAIQ,UAAU,mDACbD,SAAA,CAAAP,OAAC,MAAA,CACCO,SAAA,GAAAP,KAACU,EAAA,CAAMF,UAAU,sCAAsCD,SAAA,CAAA,MAAGE,EAAAA,IAAC,OAAA,CAAKD,UAAU,sBAAsBD,SAAA,SAChGE,EAAAA,IAACS,EAAA,CACGC,QAASrL,EAAQd,IAAIoM,KAAQvB,MAAOuB,EAAElM,GAAGmM,WAAYC,MAAOF,EAAEG,eAC9D1B,MAAO/J,EAAQL,KAAK2L,GAAKA,EAAElM,GAAGmM,aAAenL,GAAU,CAAE2J,MAAO3J,EAAQoL,MAAOxL,EAAQL,KAAK2L,GAAKA,EAAElM,GAAGmM,aAAenL,IAASqL,aAAgB,KAC9IC,SAAWC,IACT,MAAMC,EAAMD,EACRC,GACFvL,EAAUuL,EAAI7B,OACdpI,GAAS,YAAauD,OAAO0G,EAAI7B,UAEjC1J,EAAU,IACVsB,GAAS,YAAa,KAG1BsJ,YAAY,QACZY,aAAW,EACXC,cAAY,EACZC,mBAAmB,EACnBC,gBAAgB,gBAChBC,mBAAmB,EACnBC,iBAAiB,EACjBC,iBAAiB,EACjBC,iBAAiB,EACjBC,mBAAmB,EACnBC,SAAU,GACVC,OAAQ,CACNC,UAAWC,IAAA,IAAcA,EAAMC,MAAO,SACtCnL,QAASkL,IAAA,IACJA,EACHE,OAAQ,kBACRC,UAAW,kBACXC,UAAW,kBACXC,WAAY,OACZC,OAAQ,oBACRC,aAAc,MACdC,SAAU,UACVC,UAAW,gCACXC,QAAS,eACTC,OAAQ,eACRC,WAAY,SACZC,QAAS,OACT7N,SAAU,WACV8N,cAAe,MACfC,WAAY,IACZ,UAAW,CACTN,UAAW,sEAGfO,eAAgBhB,IAAA,IACXA,EACHE,OAAQ,kBACRC,UAAW,kBACXC,UAAW,kBACXM,QAAS,oBACTC,OAAQ,eACRH,SAAU,UACVI,WAAY,SACZC,QAAS,OACTE,WAAY,IACZE,eAAgB,eAElBC,MAAOlB,IAAA,IACFA,EACHW,OAAQ,eACRD,QAAS,eACTF,SAAU,UACVO,WAAY,IACZ/N,SAAU,WACVmO,IAAK,MAEPC,YAAapB,IAAA,IACRA,EACHW,OAAQ,eACRD,QAAS,eACTF,SAAU,UACVO,WAAY,IACZ/N,SAAU,WACVmO,IAAK,IACLE,UAAW,SAEb7C,YAAawB,IAAA,IACRA,EACHW,OAAQ,eACRD,QAAS,eACTF,SAAU,UACVO,WAAY,IACZ/N,SAAU,WACVmO,IAAK,IACLE,UAAW,SAEbC,oBAAqBtB,IAAA,IAChBA,EACHE,OAAQ,kBACRQ,QAAS,mBACTE,WAAY,SACZC,QAAS,SAEXU,mBAAoB,KAAA,CAASV,QAAS,SACtCW,kBAAmBxB,IAAA,IAAcA,EAAMU,QAAS,mBAChDe,eAAgBzB,IAAA,IAAcA,EAAMU,QAAS,mBAC7CgB,WAAY1B,IAAA,IAAcA,EAAM2B,OAAQ,oBAI/C,MAAA,CACC3D,SAAA,GAAAP,KAAC,MAAA,CAAIQ,UAAU,2CACbD,SAAA,CAAAE,EAAAA,IAACC,EAAA,CAAMF,UAAU,yBAAyBD,SAAA,WAC1CP,EAAAA,KAAC,OAAA,CACCQ,UAAU,sGACV2D,QArSQ,KAE1B,MAAMC,EAAmBpO,EAAShB,IAAIqP,IAAA,IAAWA,EAAGC,OAAO,KAE3DtN,GAAmB,IAAIoN,EADC,CAAEG,aAAc,GAAIC,cAAe,GAAIC,cAAe,GAAIlP,SAAU,GAAI+O,OAAO,KAEvGpN,IAAc,GACdJ,IAAuB,IAiSLyJ,SAAA,CAAAE,EAAAA,IAAC,OAAA,CAAKD,UAAU,kBAAkBD,SAAA,MAAQE,EAAAA,IAAC,OAAA,CAAKD,UAAU,SAASD,SAAA,gBAGvEP,EAAAA,KAACW,EAAA,CACCd,MAAOrI,GAAM,YAAY,IAAM,GAC/BoJ,cAAe8D,IACbjN,GAAS,WAAY,CAACiN,IACtBjN,GAAS,aAAciN,EAAM1J,OAAO0J,QAAO,IAG7CnE,SAAA,CAAAE,EAAAA,IAACI,GAAcL,UAAU,wIACvBD,eAACO,EAAA,CAAYC,YAAY,eAE3BN,IAACO,EAAA,CAAczL,SAAS,SAASiL,UAAU,WACxCD,SAAAvK,EAAShB,IAAIqP,GACZ5D,EAAAA,IAACQ,EAAA,CAAsBpB,MAAOwE,EAAEnP,GAAGmM,WAChCd,SAAA8D,EAAEE,cAAgBF,EAAEG,eAAiBH,EAAEI,eAAiBJ,EAAE9O,UAAY,IADxD8O,EAAEnP,kBAU7B8K,KAAC,MAAA,CAAIQ,UAAU,oCACbD,SAAA,CAAAP,OAAC,MAAA,CACCO,SAAA,CAAAE,EAAAA,IAACC,EAAA,CAAMF,UAAU,sCAAsCD,SAAA,UACvDE,EAAAA,IAACS,EAAA,CAEGrB,MAAOjM,EAAe,CAAEiM,MAAOjM,EAAc0N,MAAO1N,GAAiB,KACrE+Q,aAAc/Q,EAAe,CAAEiM,MAAOjM,EAAc0N,MAAO1N,GAAiB,KAC5E4N,SAAWoD,IACT,MAAM/E,EAAS+E,GAAmC/E,OAAS,GAC3DpI,GAAS,iBAAkBoI,GAC3BhM,EAAgBgM,IAElBsB,QAASrN,EAAUkB,IAAI6P,IAAA,CACrBhF,MAAOgF,EAAS1P,KAChBmM,MAAOuD,EAAS1P,QAElB4L,YAAY,KACZa,cAAY,EACZD,aAAa,EACbmD,iBAAkB,IAAM,gBACxBC,aAAc,CAACtD,EAAQuD,KACrB,MAAMH,EAAW/Q,EAAU2B,QAAYC,EAAIP,OAASsM,EAAO5B,OAE3D,MADmB,GAAGgF,GAAU1P,MAAQ,MAAM0P,GAAUtP,UAAY,MAAMsP,GAAUzP,OAAS,KAAK6P,cAChFhH,SAAS+G,EAAWC,gBAExC5C,OAAQ,CACNhL,QAAUkL,IAAA,IACLA,EACHE,OAAQ,kBACRC,UAAW,kBACXC,UAAW,kBACXC,WAAY,OACZC,OAAQ,oBACRC,aAAc,MACdC,SAAU,UACVC,UAAW,gCACXC,QAAS,eACTC,OAAQ,eACRC,WAAY,SACZC,QAAS,OACT7N,SAAU,WACV8N,cAAe,MACfC,WAAY,IACZ,UAAW,CACT4B,YAAa,UACblC,UAAW,sEAGfO,eAAiBhB,IAAA,IACZA,EACHE,OAAQ,kBACRC,UAAW,kBACXC,UAAW,kBACXM,QAAS,oBACTC,OAAQ,eACRH,SAAU,UACVI,WAAY,SACZC,QAAS,OACTE,WAAY,IACZE,eAAgB,eAElBC,MAAQlB,IAAA,IACHA,EACHW,OAAQ,eACRD,QAAS,eACTF,SAAU,UACVO,WAAY,IACZ/N,SAAU,WACVmO,IAAK,MAEPC,YAAapB,IAAA,IACRA,EACHW,OAAQ,eACRD,QAAS,eACTF,SAAU,UACVO,WAAY,IACZ/N,SAAU,WACVmO,IAAK,IACLE,UAAW,SAEb7C,YAAawB,IAAA,IACRA,EACHW,OAAQ,eACRD,QAAS,eACTF,SAAU,UACVO,WAAY,IACZ/N,SAAU,WACVmO,IAAK,IACLE,UAAW,SAEbC,oBAAsBtB,IAAA,IACjBA,EACHE,OAAQ,kBACRQ,QAAS,mBACTE,WAAY,SACZC,QAAS,SAEXU,mBAAoB,KAAA,CAASV,QAAS,SACtCW,kBAAmBxB,IAAA,IAAcA,EAAMU,QAAS,mBAChDe,eAAgBzB,IAAA,IAAcA,EAAMU,QAAS,mBAC7CkC,KAAO5C,IAAA,IAAeA,EAAMQ,SAAU,UAAWmB,OAAQ,OACzDzC,OAASc,IAAA,IAAeA,EAAMQ,SAAU,UAAWE,QAAS,eAjGzD,mBAAmBrP,eAqG7B,MAAA,CACC2M,SAAA,CAAAE,EAAAA,IAACC,EAAA,CAAMF,UAAU,sCAAsCD,SAAA,QACvDE,EAAAA,IAAC2E,EAAA,CACCC,KAAK,OACLxF,MAAOrI,GAAM,gBACbgK,SAAUtB,GAAKzI,GAAS,eAAgByI,EAAEoF,OAAOzF,OACjDW,UAAU,+HAGb,MAAA,CACCD,SAAA,CAAAE,EAAAA,IAACC,EAAA,CAAMF,UAAU,sCAAsCD,SAAA,WACvDE,EAAAA,IAAC2E,EAAA,CACCC,KAAK,OACLxF,MAAOrI,GAAM,yBACbgK,SAAUtB,GAAKzI,GAAS,wBAAyByI,EAAEoF,OAAOzF,OAC1DW,UAAU,6HAMhBR,KAAC,MAAA,CAAIQ,UAAU,oCACbD,SAAA,CAAAP,OAAC,MAAA,CACCO,SAAA,CAAAE,EAAAA,IAACC,EAAA,CAAMF,UAAU,sCAAsCD,SAAA,SACvDE,EAAAA,IAAC2E,EAAA,CACCC,KAAK,OACLxF,MAAOrI,GAAM,kBACbgK,SAAWtB,GAAMzI,GAAS,iBAAkByI,EAAEoF,OAAOzF,OACrDkB,YAAY,KACZP,UAAU,+IAGb,MAAA,CACCD,SAAA,CAAAE,EAAAA,IAACC,EAAA,CAAMF,UAAU,sCAAsCD,SAAA,SACvDE,EAAAA,IAAC2E,EAAA,CACCC,KAAK,OACLxF,MAAOrI,GAAM,sBACbgK,SAAWtB,GAAMzI,GAAS,qBAAsByI,EAAEoF,OAAOzF,OACzDkB,YAAY,KACZP,UAAU,+IAGb,MAAA,CACCD,SAAA,CAAAE,EAAAA,IAACC,EAAA,CAAMF,UAAU,sCAAsCD,SAAA,SACvDE,EAAAA,IAAC2E,EAAA,CACCC,KAAK,OACLxF,MAAOrI,GAAM,gBACbgK,SAAWtB,GAAMzI,GAAS,eAAgByI,EAAEoF,OAAOzF,OACnDkB,YAAY,KACZP,UAAU,mJAStBR,KAAC,MAAA,CAAIQ,UAAU,4BAGbD,SAAA,GAAAP,KAAC,MAAA,CAAIQ,UAAU,6DACbD,SAAA,GAAAP,KAAC,MAAA,CAAIQ,UAAU,6IACbD,SAAA,GAAAP,KAAC,MAAA,CAAIQ,UAAU,oCACbD,SAAA,GAAAP,KAAC,MAAA,CAAIQ,UAAU,0BACbD,SAAA,GAAAE,IAAC8E,EAAA,CAAQ/E,UAAU,4BACnBR,KAAC,MAAA,CAAIQ,UAAU,gBACbD,SAAA,CAAAE,EAAAA,IAAC,OAAA,CAAKD,UAAU,8CAA8CD,SAAA,UAC9DE,EAAAA,IAAC,OAAA,CAAKD,UAAU,8CAA8CD,SAAA,wBAEhEP,KAAC,OAAA,CAAKQ,UAAU,oCACbD,SAAA,CAAAhH,GAAOxE,OAAO,UAGnBiL,EAAAA,KAACW,EAAA,CAAOd,MAAOvJ,EAAUsK,cAAerK,EACtCgK,SAAA,CAAAE,EAAAA,IAACI,EAAA,CAAcL,UAAU,qHAAqHgF,MAAO,CAAE/C,OAAQ,OAAQQ,QAAS,aAAcP,UAAW,QACvMnC,SAAAE,EAAAA,IAACK,UAEHd,KAACgB,EAAA,CAAcR,UAAU,aACvBD,SAAA,CAAAE,EAAAA,IAACQ,EAAA,CAAWpB,MAAM,MAAMU,SAAA,QACxBE,EAAAA,IAACQ,EAAA,CAAWpB,MAAM,MAAMU,SAAA,mBAI9BP,KAAC,MAAA,CAAIQ,UAAU,+DACbD,SAAA,GAAAP,KAAC,OAAA,CAAKQ,UAAU,yHAAyHD,SAAA,CAAA,OAClId,GAAYgG,eAAe,SAAS,IAAEnP,KAE7CmK,EAAAA,IAACiF,EAAA,CACCL,KAAK,SACL7E,UAAU,+FACV2D,QAAS,KACHwB,QAAQ,sBACVpM,GAAOsB,QAAQ,CAAC+K,EAAMjG,IAAUlG,GAAOF,GAAOxE,OAAS,EAAI4K,IAC3DnG,GAAO,CACLf,YAAa,EACbC,UAAW,GACXC,cAAe,GACfC,SAAU,EACVC,iBAAkB,EAClBC,oBAAqBxC,EACrByC,aAAc,EACdC,gBAAiB1C,EACjB2C,OAAQ,GACRC,KAAM,OAIbqH,SAAA,SAGDE,EAAAA,IAAC2E,EAAA,CACCC,KAAK,SACLQ,IAAK,EACLC,IAAK,IACLjG,MAAO3L,EACPsN,SAAUtB,GAAK/L,EAAYkK,KAAKyH,IAAI,EAAG9K,OAAOkF,EAAEoF,OAAOzF,MAAMhE,QAAQ,UAAW,OAChF2E,UAAU,wPACVgF,MAAO,CACL/C,OAAQ,OACRQ,QAAS,UACTP,UAAW,OACXC,UAAW,OACXW,WAAY,UAGhBtD,EAAAA,KAAC0F,EAAA,CACCL,KAAK,SACLlB,QAAS,KACP,IAAA,IAASrG,EAAI,EAAGA,EAAI5J,EAAU4J,IAC5BtE,GAAO,CACLf,YAAac,GAAOxE,OAAS,EAAI+I,EACjCpF,UAAW,GACXC,cAAe,GACfC,SAAU,EACVC,iBAAkB,EAClBC,oBAAqBxC,EACrByC,aAAc,EACdC,gBAAiB1C,EACjB2C,OAAQ,GACRC,KAAM,MAIZsH,UAAU,uDAEVD,SAAA,GAAAE,IAACsF,EAAA,CAAKvF,UAAU,mBAAmB,cAKzCC,EAAAA,IAAC,MAAA,CAAID,UAAU,kBACbD,WAAAE,IAAC,MAAA,CAAID,UAAU,gCACbD,SAAAP,OAAC,QAAA,CAAMQ,UAAU,iBACfD,SAAA,CAAAE,EAAAA,IAAC,SAAMD,UAAU,+BACfD,SAAAP,EAAAA,KAAC,KAAA,CAAGQ,UAAU,2BACZD,SAAA,CAAAE,EAAAA,IAAC,KAAA,CAAGD,UAAU,qDAAqDD,SAAA,QACnEP,KAAC,KAAA,CAAGQ,UAAU,+EAA+ED,SAAA,CAAA,KACzFE,EAAAA,IAAC,OAAA,CAAKD,UAAU,eAAeD,SAAA,SAEnCE,EAAAA,IAAC,KAAA,CAAGD,UAAU,+EAA+ED,SAAA,SAC7FP,KAAC,KAAA,CAAGQ,UAAU,uDAAuDD,SAAA,CAAA,KACjEE,EAAAA,IAAC,OAAA,CAAKD,UAAU,eAAeD,SAAA,WAEnCP,KAAC,KAAA,CAAGQ,UAAU,wEAAwED,SAAA,CAAA,OAC/EjK,EAAS,SAEhB0J,KAAC,KAAA,CAAGQ,UAAU,gFAAgFD,SAAA,CAAA,OACvFjK,EAAS,OAEK,UAApBgF,IACCmF,EAAAA,IAAC,KAAA,CAAGD,UAAU,+EAA+ED,SAAA,OAE/FE,EAAAA,IAAC,KAAA,CAAGD,UAAU,+EAA+ED,SAAA,SAC7FE,IAAC,KAAA,CAAGD,UAAU,gEAGlBC,IAAC,QAAA,CAAMD,UAAU,WACdD,SAAAhH,GAAOvE,IAAI,CAAC4F,EAAME,IACjBkF,EAAAA,KAAC,KAAA,CAAaQ,UAAU,4CACtBD,SAAA,CAAAE,EAAAA,IAAC,KAAA,CAAGD,UAAU,sCAAuCD,SAAAzF,EAAM,MAE3D2F,IAAC,KAAA,CAAGD,UAAU,YACZD,SAAAE,EAAAA,IAAC2E,EAAA,CACCvF,MAAOjF,EAAKlC,UACZ8I,SAAWtB,GAAMxG,GAAOoB,EAAK,IAAKF,EAAMlC,UAAWwH,EAAEoF,OAAOzF,QAC5DW,UAAU,qDACVO,YAAY,eAKhBN,IAAC,KAAA,CAAGD,UAAU,YACZD,SAAAE,EAAAA,IAAC2E,EAAA,CACCvF,MAAOjF,EAAKjC,cACZ6I,SAAWtB,GAAMxG,GAAOoB,EAAK,IAAKF,EAAMjC,cAAeuH,EAAEoF,OAAOzF,QAChEW,UAAU,qDACVO,YAAY,cAKhBN,IAAC,KAAA,CAAGD,UAAU,YACZD,SAAAE,EAAAA,IAAC2E,EAAA,CACCC,KAAK,SACLQ,IAAI,IACJhG,MAAOjF,EAAKhC,UAAY,GACxB4H,UAAU,oLACVO,YAAY,IACZS,SAAWtB,IACT,MAAM8F,EAAcxJ,SAAS0D,EAAEoF,OAAOzF,QAAU,EAChDnG,GAAOoB,EAAK,IAAKF,EAAMhC,SAAUoN,eAMtC,KAAA,CAAGxF,UAAU,YACZD,SAAAP,EAAAA,KAAC,MAAA,CAAIQ,UAAU,oBACbD,SAAA,CAAAE,EAAAA,IAAC2E,EAAA,CACCC,KAAK,OACLY,UAAU,UACVpG,MAAOlJ,GAAY,GAAGmE,wBAAsD,IAA1BF,EAAK/B,iBAAyB,GAAK+B,EAAK/B,kBAAkB4M,eAAe,UAAY,IACvIjE,SAAWtB,IACT,MAEMgG,EAFMhG,EAAEoF,OAAOzF,MAAMhE,QAAQ,KAAM,IAElBA,QAAQ,WAAY,IAErCO,EAAQ8J,EAAW7L,MAAM,KACzB8L,EAAa/J,EAAMrH,OAAS,EAAIqH,EAAM,GAAK,IAAMA,EAAM9C,MAAM,GAAG4B,KAAK,IAAMgL,EAGjFtP,GAAekJ,IAAA,IAAaA,EAAM,CAAC,GAAGhF,sBAAyBqL,KAG/D,MAAMC,EAAwB,KAAfD,EAAoB,EAAIE,WAAWF,IAAe,EACjEzM,GAAOoB,EAAK,IAAKF,EAAM/B,iBAAkBuN,KAE3CE,OAAQ,KAEN1P,GAAekJ,IACb,MAAMyG,EAAW,IAAIzG,GAErB,cADOyG,EAAS,GAAGzL,sBACZyL,KAGX/F,UAAU,8DACVO,YAAY,YAEb,OAAA,CAAKP,UAAU,6BAA8BD,SAAa,QAAbjK,EAAqB,IAAM,iBAK5E,KAAA,CAAGkK,UAAU,YACZD,SAAAP,EAAAA,KAAC,MAAA,CAAIQ,UAAU,gCACbD,SAAA,CAAAE,EAAAA,IAAC,OAAA,CAAKD,UAAU,iCACZD,UAAA3F,EAAK7B,cAAgB,GAAG0M,eAAe,iBAE1C,OAAA,CAAKjF,UAAU,6BAA8BD,SAAa,QAAbjK,EAAqB,IAAM,WAKxD,UAApBgF,IACCmF,MAAC,KAAA,CAAGD,UAAU,YACZD,SAAAE,EAAAA,IAAC2E,EAAA,CACCvF,MAAOjF,EAAK1B,MAAQ,GACpBsI,SAAWtB,GAAMxG,GAAOoB,EAAK,IAAKF,EAAM1B,KAAMgH,EAAEoF,OAAOzF,QACvDwF,KAAK,MACL7E,UAAU,qDACVO,YAAY,oBAMlBN,IAAC,KAAA,CAAGD,UAAU,YACZD,SAAAE,EAAAA,IAAC2E,EAAA,CACCvF,MAAOjF,EAAK3B,QAAU,GACtBuI,SAAWtB,GAAMxG,GAAOoB,EAAK,IAAKF,EAAM3B,OAAQiH,EAAEoF,OAAOzF,QACzDW,UAAU,qDACVO,YAAY,eAIf,KAAA,CAAGP,UAAU,wBACXD,SAAAhH,GAAOxE,OAAS,GACf0L,EAAAA,IAACiF,EAAA,CACCL,KAAK,SACLlB,QAAS,IAAM1K,GAAOqB,GACtB0L,KAAK,KACLC,QAAQ,QACRjG,UAAU,8BAEVD,SAAAE,EAAAA,IAACiG,EAAA,CAAElG,UAAU,+BApHZ1F,kBAiIrBkF,KAAC,MAAA,CAAIQ,UAAU,8BACbD,SAAA,CAAAE,EAAAA,IAACiF,EAAA,CACCL,KAAK,SACLoB,QAAQ,UACRtC,QAAS,IAAM9Q,GAAS,GACxBmN,UAAU,mGACXD,SAAA,OAGDE,EAAAA,IAACiF,EAAA,CACCL,KAAK,SACLsB,SAAUnQ,IAAYgF,GACtBgF,UAAU,yDAETD,WACCP,EAAAA,KAAA4G,EAAAA,SAAA,CACErG,SAAA,GAAAE,IAAC,MAAA,CAAID,UAAU,sFAAsF,aAIvGR,EAAAA,KAAA4G,EAAAA,SAAA,CACErG,SAAA,GAAAE,IAACoG,EAAA,CAAKrG,UAAU,iBAAiB,qBAU5C7L,KACC8L,IAAC,MAAA,CAAID,UAAU,2EACZD,SAAA5L,IAKL8L,EAAAA,IAACqG,GAAOC,KAAMlQ,GAAqBmQ,aAAclQ,GAC/CyJ,WAAAP,KAACiH,EAAA,CAAczG,UAAU,gEACvBD,SAAA,CAAAE,MAACyG,EAAA,CACC3G,SAAAE,EAAAA,IAAC0G,EAAA,CAAY5G,SAAA,eAEfE,IAAC,MAAA,CAAID,UAAU,YACZD,SAAAxJ,GAAgB/B,IAAI,CAAC+K,EAASJ,IAC7BK,EAAAA,KAAC,MAAA,CAAgBQ,UAAU,uBACzBD,SAAA,GAAAP,KAAC,MAAA,CAAIQ,UAAU,SACbD,SAAA,CAAAE,EAAAA,IAACC,EAAA,CAAMF,UAAU,UAAUD,SAAA,OAC3BE,EAAAA,IAAC2E,EAAA,CACCvF,MAAOE,EAAQwE,aACf/C,SAAWtB,GAAMR,GAAoBC,EAAO,eAAgBO,EAAEoF,OAAOzF,OACrEkB,YAAY,SACZP,UAAU,aAGdR,KAAC,MAAA,CAAIQ,UAAU,SACbD,SAAA,CAAAE,EAAAA,IAACC,EAAA,CAAMF,UAAU,UAAUD,SAAA,QAC3BE,EAAAA,IAAC2E,EAAA,CACCvF,MAAOE,EAAQyE,cACfhD,SAAWtB,GAAMR,GAAoBC,EAAO,gBAAiBO,EAAEoF,OAAOzF,OACtEkB,YAAY,MACZP,UAAU,aAGdR,KAAC,MAAA,CAAIQ,UAAU,SACbD,SAAA,CAAAE,EAAAA,IAACC,EAAA,CAAMF,UAAU,UAAUD,SAAA,SAC3BE,EAAAA,IAAC2E,EAAA,CACCvF,MAAOE,EAAQ0E,cACfjD,SAAWtB,GAAMR,GAAoBC,EAAO,gBAAiBO,EAAEoF,OAAOzF,OACtEkB,YAAY,OACZP,UAAU,aAGdR,KAAC,MAAA,CAAIQ,UAAU,SACbD,SAAA,CAAAE,EAAAA,IAACC,EAAA,CAAMF,UAAU,UAAUD,SAAA,OAC3BE,EAAAA,IAAC2E,EAAA,CACCvF,MAAOE,EAAQxK,SACfiM,SAAWtB,GAAMR,GAAoBC,EAAO,WAAYO,EAAEoF,OAAOzF,OACjEkB,YAAY,KACZP,UAAU,WAGdC,EAAAA,IAACiF,EAAA,CACCL,KAAK,SACLmB,KAAK,KACLC,QAAQ,QACRtC,QAAS,IA9xBC,CAACxE,IACzB3I,GAAmB8I,GAAQA,EAAKsH,OAAO,CAACC,EAAGvJ,IAAMA,IAAM6B,IACvDzI,IAAc,IA4xBeoQ,CAAkB3H,GACjCa,UAAU,WAEVD,SAAAE,EAAAA,IAACiG,EAAA,CAAElG,UAAU,gBA5CPb,QAiDdK,KAACuH,EAAA,CAAa/G,UAAU,QACtBD,SAAA,CAAAP,EAAAA,KAAC0F,EAAA,CACCL,KAAK,SACLoB,QAAQ,UACRtC,QA/yBc,KACxBnN,MAA2B,IAAI8I,EAAM,CAAEyE,aAAc,GAAIC,cAAe,GAAIC,cAAe,GAAIlP,SAAU,GAAI+O,OAAO,KACpHpN,IAAc,IA8yBJsP,KAAK,KAELjG,SAAA,GAAAE,IAACsF,EAAA,CAAKvF,UAAU,iBAAiB,YAGnCC,EAAAA,IAAC+G,EAAA,CAAYC,SAAO,EAClBlH,WAAAE,IAACiF,EAAA,CAAOL,KAAK,SAASoB,QAAQ,UAAUD,KAAK,KAAKjG,kBAIpDE,EAAAA,IAACiF,EAAA,CACCL,KAAK,SACLlB,QAlzBkB5P,UAC5B,GAAKkG,GAEL,IAGE,GADoB1D,GAAgBqQ,OAAO/C,GAAKA,EAAEG,eAAiBH,EAAEG,cAAckD,SAAS,cAC5E3S,OAAS,EAEvB,YADA4S,MAAM,kCAIR,IAAA,MAAW5H,KAAWhJ,GAChBgJ,EAAQwE,cAAgBxE,EAAQyE,iBAC7BzE,EAAQuE,OAASvE,EAAQ7K,SAEtB3B,EACHqB,KAAK,mBACL8E,OAAO,CACN6K,aAAcxE,EAAQwE,aACtBC,cAAezE,EAAQyE,cACvBC,cAAe1E,EAAQ0E,eAAiB,GACxClP,SAAUwK,EAAQxK,UAAY,KAE/BsE,GAAG,KAAMkG,EAAQ7K,IACX6K,EAAQuE,aAEX/Q,EACHqB,KAAK,mBACLyI,OAAO,CACN/E,UAAWmC,GACX8J,aAAcxE,EAAQwE,aACtBC,cAAezE,EAAQyE,cACvBC,cAAe1E,EAAQ0E,eAAiB,GACxClP,SAAUwK,EAAQxK,UAAY,MAOxC,MAAMf,KAAEA,SAAejB,EACpBqB,KAAK,mBACLC,OAAO,4DACPgF,GAAG,YAAaY,IAEfjG,KAAkBA,GACtBsC,IAAuB,GACvByD,EAAM4E,QAAQ,mBAChB,OAASxK,GACP4F,EAAM5F,MAAM,kBACd,GAiwBUgS,UAAW1P,GACXuP,KAAK,KACNjG,SAAA,iBAQb"}