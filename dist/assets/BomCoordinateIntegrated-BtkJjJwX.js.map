{"version":3,"file":"BomCoordinateIntegrated-BtkJjJwX.js","sources":["../../node_modules/lucide-react/dist/esm/icons/loader-circle.js","../../src/components/ui/badge.tsx","../../src/components/ui/progress.tsx","../../src/utils/excel-generator.ts","../../src/components/bom-coordinate/GeneratedPreviewPanel.tsx","../../src/components/ui/tabs.tsx","../../src/components/bom-coordinate/CoordinatePreviewPanel.tsx","../../src/utils/bom-processor.ts","../../src/components/bom-coordinate/BomCoordinateIntegrated.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [[\"path\", { d: \"M21 12a9 9 0 1 1-6.219-8.56\", key: \"13zald\" }]];\nconst LoaderCircle = createLucideIcon(\"loader-circle\", __iconNode);\n\nexport { __iconNode, LoaderCircle as default };\n//# sourceMappingURL=loader-circle.js.map\n","import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center justify-center rounded-full px-2.5 py-0.5 text-[11px] font-semibold w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none transition-all duration-150 overflow-hidden uppercase tracking-wider\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-hansl-100 text-hansl-700 border border-hansl-200/50\",\n        secondary:\n          \"bg-gray-100 text-gray-700 border border-gray-200/50\",\n        success:\n          \"bg-green-100 text-green-700 border border-green-200/50\",\n        warning:\n          \"bg-amber-100 text-amber-700 border border-amber-200/50\",\n        destructive:\n          \"bg-red-100 text-red-700 border border-red-200/50\",\n        info:\n          \"bg-blue-100 text-blue-700 border border-blue-200/50\",\n        outline:\n          \"border border-gray-300 text-gray-600 bg-white\",\n        pending:\n          \"bg-yellow-50 text-yellow-700 border border-yellow-200/50\",\n        approved:\n          \"bg-green-50 text-green-700 border border-green-200/50\",\n        rejected:\n          \"bg-red-50 text-red-700 border border-red-200/50\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nfunction Badge({\n  className,\n  variant,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"span\"> &\n  VariantProps<typeof badgeVariants> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"span\"\n\n  return (\n    <Comp\n      data-slot=\"badge\"\n      className={cn(badgeVariants({ variant }), className)}\n      {...props}\n    />\n  )\n}\n\nexport { Badge, badgeVariants }\n","import * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & { value?: number | null }\n>(({ className, value, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"relative h-2 w-full overflow-hidden rounded-full bg-primary/20\",\n      className\n    )}\n    {...props}\n  >\n    <div\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </div>\n))\nProgress.displayName = \"Progress\"\n\nexport { Progress }\n","import ExcelJS from 'exceljs';\n\n// BOM 아이템 타입 정의\nexport interface BOMItem {\n  lineNumber: number;\n  itemType?: string;\n  itemName: string;\n  specification?: string;\n  setCount: number;\n  totalQuantity: number;\n  stockQuantity?: number;\n  checkStatus?: string;\n  refList: string | string[];  // 문자열 또는 배열 둘 다 허용\n  alternativeItem?: string;\n  remark?: string;\n}\n\nexport interface CoordinateItem {\n  ref?: string;     // 실제 데이터에서 사용할 수 있는 필드\n  partName?: string;\n  partType?: string;\n  side?: string;\n  layer?: string;   // TOP/BOTTOM을 나타내는 다른 필드\n  x: number | string;\n  y: number | string;\n  angle?: number | string;\n  rotation?: number | string;  // angle 대신 rotation을 사용할 수도 있음\n}\n\n/**\n * 템플릿 기반 정리된 BOM 및 좌표 데이터를 Excel 파일로 생성\n */\nexport async function generateCleanedBOMExcel(\n  bomItems: BOMItem[],\n  coordinates: CoordinateItem[],\n  boardName: string,\n  productionQuantity?: number\n): Promise<Blob> {\n  const workbook = new ExcelJS.Workbook();\n  \n  try {\n    // 1. 템플릿 파일 로드 시도\n    const response = await fetch('/templates/BOM_Template.xlsx');\n    if (response.ok) {\n      const buffer = await response.arrayBuffer();\n      await workbook.xlsx.load(buffer);\n      console.log('Template loaded successfully');\n    } else {\n      console.error('Template loading failed:', response.status, response.statusText);\n      console.warn('Template not found, creating new workbook');\n      // 템플릿이 없으면 새 시트 생성\n      const bomSheet = workbook.addWorksheet('BOM');\n      // 헤더 추가\n      bomSheet.getRow(1).values = ['No', '종류', '품명', 'SET', '수량', '재고', 'CHECK', 'REF', '대체가능품목', '비고'];\n      bomSheet.getRow(1).font = { bold: true };\n    }\n  } catch (error) {\n    console.error('Template load error:', error);\n    // 오류 발생 시 새 시트 생성\n    const bomSheet = workbook.addWorksheet('BOM');\n    bomSheet.getRow(1).values = ['No', '종류', '품명', 'SET', '수량', '재고', 'CHECK', 'REF', '대체가능품목', '비고'];\n    bomSheet.getRow(1).font = { bold: true };\n  }\n\n  // 워크북 메타데이터 설정\n  workbook.creator = 'HANSL AI System';\n  workbook.modified = new Date();\n\n  // 2. BOM 시트 데이터 채우기\n  let bomSheet = workbook.getWorksheet('BOM');\n  if (!bomSheet) {\n    // 시트가 없으면 첫 번째 시트 사용\n    bomSheet = workbook.worksheets[0];\n  }\n\n  if (!bomSheet) {\n     bomSheet = workbook.addWorksheet('BOM');\n  }\n\n  // 데이터 시작 행 찾기 (헤더가 있는 행을 찾음)\n  let startRow = 6; // 기본값\n  let headerFound = false;\n  \n  bomSheet.eachRow((row, rowNumber) => {\n    if (headerFound) return;\n    const values = row.values;\n    if (Array.isArray(values)) {\n      // '번호' 또는 'No'가 포함된 행을 헤더로 간주\n      if (values.some(v => v && v.toString().includes('번호')) || values.some(v => v && v.toString().includes('No'))) {\n        startRow = rowNumber + 1;\n        headerFound = true;\n      }\n    }\n  });\n\n  // 템플릿의 제목 위치 업데이트 (예: \"[보드명] 부품리스트\")\n  if (boardName) {\n      let titleCellFound = false;\n      // 제목 찾기 (보통 위쪽에 있음)\n      for (let i = 1; i < startRow; i++) {\n          const row = bomSheet.getRow(i);\n          row.eachCell((cell) => {\n              if (cell.value && cell.value.toString().includes('부품리스트')) {\n                  // 기존 포맷 유지하면서 보드명만 교체 시도\n                  // 예: \"H25-133... 부품리스트\"\n                  cell.value = `${boardName} 부품리스트`;\n                  titleCellFound = true;\n              }\n          });\n          if (titleCellFound) break;\n      }\n  }\n\n  // 데이터 시작 위치 조정 (헤더 아래에 보드 정보 행 추가)\n  // 스크린샷을 보면 헤더(번호, 종류...) 바로 아래 행에 \"** [보드명]... [수량] SET\" 가 있음\n  // 따라서 데이터는 헤더 + 2 행부터 시작해야 함\n  const infoRowIndex = startRow; // 헤더 바로 다음 행\n  const dataStartIndex = startRow + 1; // 그 다음 행부터 데이터\n\n  // 보드 정보 행 내용 작성 (스타일 유지하며 값 입력)\n  const infoRow = bomSheet.getRow(infoRowIndex);\n  \n  // 생산 수량 계산\n  let productionQty = productionQuantity || 0;\n  if (productionQty === 0 && bomItems.length > 0 && bomItems[0].setCount > 0) {\n      productionQty = Math.round(bomItems[0].totalQuantity / bomItems[0].setCount);\n  }\n\n  // 3번 컬럼(품명)에 정보 입력\n  infoRow.getCell(3).value = `** ${boardName}   ${productionQty} SET`;\n  infoRow.getCell(3).font = { bold: true, name: '맑은 고딕', size: 10 };\n  infoRow.getCell(3).alignment = { horizontal: 'left', vertical: 'middle' };\n\n  bomItems.forEach((item, index) => {\n    const currentRowNum = dataStartIndex + index;\n    let row = bomSheet.getRow(currentRowNum);\n    \n    // 템플릿 행의 스타일 복사 (첫 번째 데이터인 경우 템플릿 행 사용, 그 이후는 복사)\n    // ExcelJS에서 스타일 복사는 까다로우므로, 기본 스타일을 코드에서 지정하는 게 안전할 수 있음.\n    // 하지만 사용자 요청은 \"템플릿 그대로\" 이므로 최대한 보존 노력.\n    \n    // 값 설정\n    row.getCell(1).value = index + 1;                    // 번호\n    row.getCell(2).value = item.itemType || '';          // 종류\n    row.getCell(3).value = item.itemName;                // 품명\n    row.getCell(4).value = item.setCount;                // SET\n    row.getCell(5).value = item.totalQuantity;           // 수량\n    row.getCell(6).value = item.stockQuantity || '';     // 재고\n    row.getCell(7).value = item.checkStatus || '□양호';  // CHECK\n    row.getCell(8).value = Array.isArray(item.refList) ? item.refList.join(', ') : item.refList;      // REF\n    row.getCell(9).value = item.alternativeItem || '';   // 대체가능품목\n    row.getCell(10).value = item.remark || '';           // 비고\n\n    // 스타일 적용 (템플릿 스타일이 없을 경우에만 기본 스타일 적용)\n    // 사용자가 \"개판\"이라고 했으므로 코드로 스타일을 강제하는 게 나을 수 있음 (템플릿 스타일이 깨졌을 수도 있으니)\n    // 하지만 \"템플릿 그대로\"를 원하므로, \n    // border, alignment, font 등을 명시적으로 지정하여 깔끔하게 만듦.\n    row.eachCell({ includeEmpty: true }, (cell, colNumber) => {\n        if (colNumber <= 10) {\n            cell.border = {\n                top: { style: 'thin' },\n                left: { style: 'thin' },\n                bottom: { style: 'thin' },\n                right: { style: 'thin' }\n            };\n            cell.alignment = { vertical: 'middle', wrapText: true };\n            // 폰트는 템플릿 폰트 유지 또는 지정\n            // cell.font = { name: '맑은 고딕', size: 10 }; \n            \n            if ([1, 2, 4, 5, 6, 7, 10].includes(colNumber)) {\n                cell.alignment = { ...cell.alignment, horizontal: 'center' };\n            } else {\n                cell.alignment = { ...cell.alignment, horizontal: 'left' };\n            }\n        }\n    });\n    \n    row.commit();\n  });\n\n  // 3. 좌표 시트 처리 (TOP/BOTTOM) - 컬럼 매핑 수정\n  const topCoords = coordinates.filter(c => \n    c.side?.toUpperCase().includes('TOP') || c.layer?.toUpperCase().includes('TOP')\n  );\n  const bottomCoords = coordinates.filter(c => \n    c.side?.toUpperCase().includes('BOT') || c.layer?.toUpperCase().includes('BOT')\n  );\n  \n  await writeCoordinateSheet(workbook, 'TOP', topCoords);\n  await writeCoordinateSheet(workbook, 'BOTTOM', bottomCoords);\n\n  // Blob으로 반환\n  const outBuffer = await workbook.xlsx.writeBuffer();\n  return new Blob([outBuffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });\n}\n\nasync function writeCoordinateSheet(workbook: ExcelJS.Workbook, sheetName: string, coords: CoordinateItem[]) {\n  if (coords.length === 0) return;\n\n  let sheet = workbook.getWorksheet(sheetName);\n  if (!sheet) {\n    sheet = workbook.addWorksheet(sheetName);\n    // 새 시트인 경우 헤더 생성 (수동 파일 양식에 맞춤)\n    // Type, RefDes, Layer, LocationX, LocationY, Rotation\n    sheet.getRow(1).values = ['Type', 'RefDes', 'Layer', 'LocationX', 'LocationY', 'Rotation'];\n    sheet.getRow(1).font = { bold: true };\n  } else {\n    // 기존 시트가 있으면 헤더는 유지하고 데이터만 추가\n    // 만약 헤더가 없다면 추가\n    if (sheet.rowCount === 0) {\n        sheet.getRow(1).values = ['Type', 'RefDes', 'Layer', 'LocationX', 'LocationY', 'Rotation'];\n    }\n  }\n\n  // 데이터 시작 행\n  const startRow = 2;\n  \n  // 기존 데이터 삭제 (필요 시)\n  // if (sheet.rowCount >= startRow) {\n  //     sheet.spliceRows(startRow, sheet.rowCount - startRow + 1);\n  // }\n\n  coords.forEach((coord, index) => {\n    const row = sheet.getRow(startRow + index);\n    // 수동 파일 양식: Type | RefDes | Layer | LocationX | LocationY | Rotation\n    row.values = [\n      coord.partType || 'SMD',           // Type\n      coord.ref || '',                   // RefDes\n      coord.side || coord.layer || '',   // Layer (TOP/BOTTOM)\n      coord.x,                           // LocationX\n      coord.y,                           // LocationY\n      coord.angle || coord.rotation || 0 // Rotation\n    ];\n    \n    // 스타일 적용\n    row.eachCell({ includeEmpty: true }, (cell) => {\n        cell.border = {\n            top: { style: 'thin' },\n            left: { style: 'thin' },\n            bottom: { style: 'thin' },\n            right: { style: 'thin' }\n        };\n        cell.alignment = { horizontal: 'center', vertical: 'middle' };\n    });\n  });\n  \n  // 컬럼 너비 자동 조정\n  sheet.columns.forEach(col => {\n      col.width = 15;\n  });\n}\n","import { useState } from 'react';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Download, Save, RotateCcw } from 'lucide-react';\nimport { generateCleanedBOMExcel, BOMItem, CoordinateItem } from '@/utils/excel-generator';\nimport { toast } from 'sonner';\n\ninterface GeneratedPreviewPanelProps {\n  bomItems: BOMItem[];\n  coordinates: CoordinateItem[];\n  boardName: string;\n  productionQuantity: number;\n  onSave: (items: BOMItem[]) => void;\n}\n\nexport default function GeneratedPreviewPanel({ \n  bomItems: initialItems, \n  coordinates, \n  boardName,\n  productionQuantity,\n  onSave \n}: GeneratedPreviewPanelProps) {\n  const [items, setItems] = useState<BOMItem[]>(initialItems);\n  const [editingCell, setEditingCell] = useState<{ row: number, field: keyof BOMItem } | null>(null);\n  \n  // 엑셀 다운로드 핸들러\n  const handleDownload = async () => {\n    try {\n      console.log('Starting download with:', { \n        itemsCount: items.length, \n        coordsCount: coordinates.length, \n        boardName \n      });\n      \n      // 데이터 검증\n      if (!items || items.length === 0) {\n        throw new Error('BOM 데이터가 없습니다. 데이터를 확인해주세요.');\n      }\n      \n      if (!boardName || boardName.trim() === '') {\n        throw new Error('보드 이름이 설정되지 않았습니다.');\n      }\n      \n      // 필수 필드 검증\n      const invalidItems = items.filter((item, idx) => {\n        return !item.itemName || item.setCount === undefined || item.totalQuantity === undefined;\n      });\n      \n      if (invalidItems.length > 0) {\n        console.warn('Invalid items found:', invalidItems);\n        throw new Error(`${invalidItems.length}개 항목에 필수 데이터가 누락되었습니다. (품명, SET, 수량 확인 필요)`);\n      }\n      \n      const blob = await generateCleanedBOMExcel(items, coordinates, boardName, productionQuantity);\n      \n      console.log('Blob generated:', { size: blob.size, type: blob.type });\n      \n      if (!blob || blob.size === 0) {\n        throw new Error('엑셀 파일 생성에 실패했습니다. (빈 파일)');\n      }\n      \n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      \n      // 보드 이름에 이미 날짜와 _정리본이 포함되어 있으므로 그대로 사용\n      a.download = `${boardName}.xlsx`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      window.URL.revokeObjectURL(url);\n      toast.success('엑셀 파일이 다운로드되었습니다.');\n    } catch (error) {\n      console.error('Download error details:', error);\n      let errorMessage = '알 수 없는 오류';\n      \n      if (error instanceof Error) {\n        errorMessage = error.message;\n        \n        // 구체적인 에러 메시지 제공\n        if (errorMessage.includes('Template') || errorMessage.includes('템플릿')) {\n          errorMessage = '템플릿 파일을 불러오는데 실패했습니다. 관리자에게 문의하세요.';\n        } else if (errorMessage.includes('parse') || errorMessage.includes('파싱')) {\n          errorMessage = '데이터 형식이 올바르지 않습니다. 데이터를 확인해주세요.';\n        } else if (errorMessage.includes('memory') || errorMessage.includes('메모리')) {\n          errorMessage = '파일이 너무 커서 처리할 수 없습니다. 데이터를 줄여주세요.';\n        }\n      }\n      \n      toast.error(`다운로드 중 오류가 발생했습니다: ${errorMessage}`);\n    }\n  };\n\n  // 데이터 수정 핸들러\n  const handleCellChange = (index: number, field: keyof BOMItem, value: string) => {\n    const newItems = [...items];\n    const item = { ...newItems[index] };\n    \n    // 숫자 필드 처리\n    if (field === 'setCount' || field === 'totalQuantity' || field === 'stockQuantity') {\n      (item as any)[field] = Number(value) || 0;\n    } else if (field === 'refList') {\n      // REF 리스트는 문자열로 저장 (엑셀 생성 시 처리)\n      (item as any)[field] = value;\n    } else {\n      (item as any)[field] = value;\n    }\n    \n    newItems[index] = item;\n    setItems(newItems);\n  };\n\n  // 초기화 핸들러\n  const handleReset = () => {\n    if (confirm('모든 수정사항을 초기화하시겠습니까?')) {\n      setItems(initialItems);\n    }\n  };\n\n  // 저장 핸들러 (DB 업데이트용)\n  const handleSave = () => {\n    onSave(items);\n    toast.success('수정사항이 저장되었습니다.');\n  };\n\n  return (\n    <div className=\"space-y-3 sm:space-y-4\">\n      <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 sm:gap-4\">\n        <div className=\"flex-1\">\n          <h3 className=\"text-base sm:text-lg font-semibold\">정리된 BOM 미리보기</h3>\n          <p className=\"text-xs sm:text-sm text-gray-500 mt-1\">\n            데이터를 클릭하여 직접 수정할 수 있습니다. 확인 후 엑셀로 다운로드하세요.\n          </p>\n        </div>\n        <div className=\"flex flex-wrap gap-2 w-full sm:w-auto\">\n          <Button \n            onClick={handleReset}\n            className=\"flex-1 sm:flex-initial button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 text-xs sm:text-sm\"\n          >\n            <RotateCcw className=\"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2\" />\n            초기화\n          </Button>\n          <Button \n            onClick={handleSave}\n            className=\"flex-1 sm:flex-initial button-base bg-blue-500 hover:bg-blue-600 text-white text-xs sm:text-sm\"\n          >\n            <Save className=\"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2\" />\n            저장\n          </Button>\n          <Button \n            onClick={handleDownload} \n            className=\"flex-1 sm:flex-initial button-base bg-green-500 hover:bg-green-600 text-white text-xs sm:text-sm\"\n          >\n            <Download className=\"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2\" />\n            Excel\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"border rounded-lg overflow-hidden bg-white shadow-sm\">\n        <div className=\"overflow-x-auto max-h-[400px] sm:max-h-[500px] lg:max-h-[600px]\">\n          <Table>\n            <TableHeader className=\"bg-gray-50 sticky top-0 z-10\">\n              <TableRow>\n                <TableHead className=\"w-[40px] sm:w-[50px] text-center text-xs\">No</TableHead>\n                <TableHead className=\"w-[60px] sm:w-[80px] text-center text-xs\">종류</TableHead>\n                <TableHead className=\"min-w-[120px] sm:min-w-[200px] text-xs\">품명</TableHead>\n                <TableHead className=\"w-[50px] sm:w-[60px] text-center text-xs\">SET</TableHead>\n                <TableHead className=\"w-[60px] sm:w-[80px] text-center text-xs\">수량</TableHead>\n                <TableHead className=\"w-[50px] sm:w-[60px] text-center text-xs hidden sm:table-cell\">재고</TableHead>\n                <TableHead className=\"w-[70px] sm:w-[80px] text-center text-xs\">CHECK</TableHead>\n                <TableHead className=\"min-w-[120px] sm:min-w-[200px] text-xs\">REF</TableHead>\n                <TableHead className=\"w-[100px] sm:w-[150px] text-xs hidden md:table-cell\">대체품</TableHead>\n                <TableHead className=\"w-[100px] sm:w-[150px] text-xs\">비고</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {items.map((item, index) => (\n                <TableRow key={index} className=\"hover:bg-gray-50\">\n                  <TableCell className=\"text-center text-gray-500\">{index + 1}</TableCell>\n                  \n                  {/* 종류 */}\n                  <TableCell className=\"p-1\">\n                    <Input \n                      className=\"h-7 sm:h-8 text-center border-transparent hover:border-gray-200 focus:border-primary text-xs\"\n                      value={item.itemType || ''}\n                      onChange={(e) => handleCellChange(index, 'itemType', e.target.value)}\n                    />\n                  </TableCell>\n\n                  {/* 품명 */}\n                  <TableCell className=\"p-1\">\n                    <Input \n                      className=\"h-7 sm:h-8 border-transparent hover:border-gray-200 focus:border-primary font-medium text-xs\"\n                      value={item.itemName}\n                      onChange={(e) => handleCellChange(index, 'itemName', e.target.value)}\n                    />\n                  </TableCell>\n\n                  {/* SET */}\n                  <TableCell className=\"p-1\">\n                    <Input \n                      type=\"number\"\n                      className=\"h-7 sm:h-8 text-center border-transparent hover:border-gray-200 focus:border-primary text-xs\"\n                      value={item.setCount}\n                      onChange={(e) => handleCellChange(index, 'setCount', e.target.value)}\n                    />\n                  </TableCell>\n\n                  {/* 수량 */}\n                  <TableCell className=\"p-1\">\n                    <Input \n                      type=\"number\"\n                      className=\"h-7 sm:h-8 text-center border-transparent hover:border-gray-200 focus:border-primary bg-gray-50 text-xs\"\n                      value={item.totalQuantity}\n                      readOnly // 수량은 보통 계산값이므로 읽기 전용 (필요 시 해제)\n                      onChange={(e) => handleCellChange(index, 'totalQuantity', e.target.value)}\n                    />\n                  </TableCell>\n\n                  {/* 재고 */}\n                  <TableCell className=\"p-1 hidden sm:table-cell\">\n                    <Input \n                      type=\"number\"\n                      className=\"h-8 text-center border-transparent hover:border-gray-200 focus:border-primary text-xs\"\n                      value={item.stockQuantity || ''}\n                      placeholder=\"0\"\n                      onChange={(e) => handleCellChange(index, 'stockQuantity', e.target.value)}\n                    />\n                  </TableCell>\n\n                  {/* CHECK */}\n                  <TableCell className=\"p-1\">\n                    <select \n                      className=\"w-full h-7 sm:h-8 text-center text-xs border-transparent hover:border-gray-200 focus:border-primary bg-transparent rounded outline-none cursor-pointer\"\n                      value={item.checkStatus || '□양호'}\n                      onChange={(e) => handleCellChange(index, 'checkStatus', e.target.value)}\n                    >\n                      <option value=\"□양호\">□양호</option>\n                      <option value=\"□불량\">□불량</option>\n                      <option value=\"□확인필요\">□확인필요</option>\n                    </select>\n                  </TableCell>\n\n                  {/* REF */}\n                  <TableCell className=\"p-1\">\n                    <textarea\n                      className=\"w-full min-h-[28px] sm:min-h-[32px] p-1 text-xs border border-transparent hover:border-gray-200 focus:border-primary rounded resize-y bg-transparent outline-none\"\n                      value={item.refList || ''}\n                      onChange={(e) => handleCellChange(index, 'refList', e.target.value)}\n                      rows={1}\n                    />\n                  </TableCell>\n\n                  {/* 대체품 */}\n                  <TableCell className=\"p-1 hidden md:table-cell\">\n                    <Input \n                      className=\"h-8 border-transparent hover:border-gray-200 focus:border-primary text-xs\"\n                      value={item.alternativeItem || ''}\n                      onChange={(e) => handleCellChange(index, 'alternativeItem', e.target.value)}\n                    />\n                  </TableCell>\n\n                  {/* 비고 */}\n                  <TableCell className=\"p-1\">\n                    <Input \n                      className={`h-7 sm:h-8 border-transparent hover:border-gray-200 focus:border-primary text-xs ${item.remark === '미삽' ? 'text-red-500 font-bold' : ''}`}\n                      value={item.remark || ''}\n                      onChange={(e) => handleCellChange(index, 'remark', e.target.value)}\n                    />\n                  </TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        </div>\n        <div className=\"bg-gray-50 p-2 sm:p-3 border-t text-xs text-gray-500 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2\">\n          <span>총 {items.length}개 항목</span>\n          <span className=\"text-[10px] sm:text-xs\">* 셀을 클릭하여 직접 수정할 수 있습니다. 수정 후 '변경사항 저장'을 눌러주세요.</span>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n\n","import * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\n\nconst TabsContext = React.createContext<{\n  value: string\n  onValueChange: (value: string) => void\n} | null>(null)\n\nconst Tabs = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & {\n    defaultValue?: string\n    value?: string\n    onValueChange?: (value: string) => void\n  }\n>(({ className, defaultValue, value: controlledValue, onValueChange, ...props }, ref) => {\n  const [uncontrolledValue, setUncontrolledValue] = React.useState(defaultValue || \"\")\n  const value = controlledValue !== undefined ? controlledValue : uncontrolledValue\n  \n  const handleValueChange = React.useCallback(\n    (newValue: string) => {\n      if (onValueChange) {\n        onValueChange(newValue)\n      } else {\n        setUncontrolledValue(newValue)\n      }\n    },\n    [onValueChange]\n  )\n\n  return (\n    <TabsContext.Provider value={{ value, onValueChange: handleValueChange }}>\n      <div ref={ref} className={cn(\"\", className)} {...props} />\n    </TabsContext.Provider>\n  )\n})\nTabs.displayName = \"Tabs\"\n\nconst TabsList = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n      {...props}\n    />\n))\nTabsList.displayName = \"TabsList\"\n\nconst TabsTrigger = React.forwardRef<\n  HTMLButtonElement,\n  React.ButtonHTMLAttributes<HTMLButtonElement> & { value: string }\n>(({ className, value, onClick, ...props }, ref) => {\n  const context = React.useContext(TabsContext)\n  if (!context) throw new Error(\"TabsTrigger must be used within a Tabs component\")\n\n  const isActive = context.value === value\n\n  return (\n    <button\n      ref={ref}\n      type=\"button\"\n      role=\"tab\"\n      aria-selected={isActive}\n      data-state={isActive ? \"active\" : \"inactive\"}\n      className={cn(\n        \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n        className\n      )}\n      onClick={(e) => {\n        context.onValueChange(value)\n        onClick?.(e)\n      }}\n      {...props}\n    />\n  )\n})\nTabsTrigger.displayName = \"TabsTrigger\"\n\nconst TabsContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & { value: string }\n>(({ className, value, ...props }, ref) => {\n  const context = React.useContext(TabsContext)\n  if (!context) throw new Error(\"TabsContent must be used within a Tabs component\")\n\n  if (context.value !== value) return null\n\n  return (\n    <div\n      ref={ref}\n      role=\"tabpanel\"\n      className={cn(\n        \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nTabsContent.displayName = \"TabsContent\"\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","import { useState } from 'react';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { CoordinateItem } from '@/utils/excel-generator';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\n\ninterface CoordinatePreviewPanelProps {\n  coordinates: CoordinateItem[];\n}\n\nexport default function CoordinatePreviewPanel({ coordinates }: CoordinatePreviewPanelProps) {\n  const topCoords = coordinates.filter(c => c.side?.toUpperCase().includes('TOP'));\n  const bottomCoords = coordinates.filter(c => c.side?.toUpperCase().includes('BOT'));\n\n  return (\n    <div className=\"space-y-3 sm:space-y-4\">\n      <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2 sm:gap-4\">\n        <h3 className=\"text-base sm:text-lg font-semibold\">좌표 데이터 미리보기</h3>\n        <div className=\"flex gap-2 text-xs sm:text-sm text-gray-500\">\n          <Badge variant=\"outline\" className=\"text-[10px] sm:text-xs\">TOP: {topCoords.length}개</Badge>\n          <Badge variant=\"outline\" className=\"text-[10px] sm:text-xs\">BOTTOM: {bottomCoords.length}개</Badge>\n        </div>\n      </div>\n\n      <div className=\"border rounded-lg bg-white shadow-sm p-3 sm:p-4\">\n        <Tabs defaultValue=\"all\" className=\"w-full\">\n          <TabsList className=\"mb-3 sm:mb-4 w-full grid grid-cols-3\">\n            <TabsTrigger value=\"all\" className=\"text-xs sm:text-sm\">전체 ({coordinates.length})</TabsTrigger>\n            <TabsTrigger value=\"top\" className=\"text-xs sm:text-sm\">TOP ({topCoords.length})</TabsTrigger>\n            <TabsTrigger value=\"bottom\" className=\"text-xs sm:text-sm\">BOTTOM ({bottomCoords.length})</TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"all\" className=\"mt-0\">\n            <CoordinateTable data={coordinates} />\n          </TabsContent>\n          <TabsContent value=\"top\" className=\"mt-0\">\n            <CoordinateTable data={topCoords} />\n          </TabsContent>\n          <TabsContent value=\"bottom\" className=\"mt-0\">\n            <CoordinateTable data={bottomCoords} />\n          </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n  );\n}\n\nfunction CoordinateTable({ data }: { data: CoordinateItem[] }) {\n  return (\n    <div className=\"overflow-x-auto max-h-[300px] sm:max-h-[400px] border rounded\">\n      <Table>\n        <TableHeader className=\"bg-gray-50 sticky top-0 z-10\">\n          <TableRow>\n            <TableHead className=\"w-[60px] sm:w-[80px] text-center text-xs\">Ref</TableHead>\n            <TableHead className=\"min-w-[100px] sm:min-w-[150px] text-xs\">Part Name</TableHead>\n            <TableHead className=\"w-[60px] sm:w-[80px] text-center text-xs hidden sm:table-cell\">Type</TableHead>\n            <TableHead className=\"w-[60px] sm:w-[80px] text-center text-xs\">Side</TableHead>\n            <TableHead className=\"w-[60px] sm:w-[80px] text-center text-xs\">X</TableHead>\n            <TableHead className=\"w-[60px] sm:w-[80px] text-center text-xs\">Y</TableHead>\n            <TableHead className=\"w-[60px] sm:w-[80px] text-center text-xs hidden md:table-cell\">Angle</TableHead>\n          </TableRow>\n        </TableHeader>\n        <TableBody>\n          {data.length === 0 ? (\n            <TableRow>\n              <TableCell colSpan={7} className=\"text-center py-6 sm:py-8 text-gray-500 text-xs sm:text-sm\">\n                데이터가 없습니다.\n              </TableCell>\n            </TableRow>\n          ) : (\n            data.map((item, index) => (\n              <TableRow key={index} className=\"hover:bg-gray-50 text-[10px] sm:text-xs\">\n                <TableCell className=\"text-center font-medium\">{item.ref}</TableCell>\n                <TableCell className=\"truncate max-w-[100px] sm:max-w-[150px]\" title={item.partName}>\n                  {item.partName}\n                </TableCell>\n                <TableCell className=\"text-center hidden sm:table-cell\">{item.partType || 'SMD'}</TableCell>\n                <TableCell className=\"text-center\">\n                  <Badge variant={item.side === 'TOP' ? 'default' : 'secondary'} className=\"text-[9px] sm:text-[10px] px-1 py-0 h-4 sm:h-5\">\n                    {item.side}\n                  </Badge>\n                </TableCell>\n                <TableCell className=\"text-center font-mono text-gray-600\">{item.x}</TableCell>\n                <TableCell className=\"text-center font-mono text-gray-600\">{item.y}</TableCell>\n                <TableCell className=\"text-center font-mono text-gray-600 hidden md:table-cell\">{item.angle}</TableCell>\n              </TableRow>\n            ))\n          )}\n        </TableBody>\n      </Table>\n    </div>\n  );\n}\n\n\n","import * as XLSX from 'xlsx';\n\ninterface ProcessedBOMResult {\n  bomItems: any[];\n  coordinates: any[];\n}\n\nexport async function processBOMWithAI(\n  bomFile: File,\n  coordFile: File,\n  productionQuantity: number\n): Promise<ProcessedBOMResult> {\n  const bomText = await readFileAsText(bomFile);\n  const coordText = await readFileAsText(coordFile);\n  \n  const apiKey = import.meta.env.VITE_OPENAI_API_KEY || import.meta.env.OPENAI_API_KEY || process.env.OPENAI_API_KEY;\n  \n  if (!apiKey) {\n    throw new Error('OpenAI API Key가 설정되지 않았습니다. .env 파일을 확인해주세요.');\n  }\n\n  // Fine-tuned Model에 최적화된 간결한 프롬프트\n  const prompt = `\nAnalyze the provided BOM and Coordinate data and generate a structured TSV (Tab-Separated Values) output based on the patterns you have learned.\n\n### INPUT DATA\n**BOM Content**:\n${bomText.substring(0, 25000)}\n\n**Coordinate Content**:\n${coordText.substring(0, 25000)}\n\n### OUTPUT FORMAT\nRespond ONLY with the data rows (no header, no markdown). Columns are separated by TAB.\nColumns: LineNumber | ItemType | ItemName | SetCount | TotalQuantity | Stock | Check | RefList | Alternative | Remark\n\nExample Output:\n1\\tIC(SMD)\\tU1\\t1\\t100\\t\\t□양호\\tU1\\t\\t\n2\\t저항(1005)\\tR100\\t2\\t200\\t\\t□양호\\tR1, R2\\t\\t\n3\\tC/C(1005)\\tC100\\t1\\t100\\t\\t\\tC3\\t\\t미삽\n`;\n\n  try {\n    const response = await fetch('https://api.openai.com/v1/chat/completions', {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${apiKey}`,\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        model: 'gpt-4o-mini-2024-07-18', // 2차 재학습 완료된 모델 (최신)\n        messages: [\n          { role: 'system', content: 'You are a helpful assistant that outputs TSV data only.' },\n          { role: 'user', content: prompt }\n        ],\n        temperature: 0.2\n      })\n    });\n\n    if (!response.ok) {\n      const errorData = await response.json();\n      throw new Error(`OpenAI API Error: ${errorData.error?.message || response.statusText}`);\n    }\n\n    const result = await response.json();\n    const content = result.choices[0].message.content;\n    \n    try {\n      // TSV 파싱\n      const lines = content.split('\\n');\n      const bomItems = [];\n      const coordinates = [];\n      \n      for (const line of lines) {\n        const cols = line.split('\\t');\n        if (cols.length < 3) continue;\n\n        // [좌표 파싱 로직 추가]\n        let itemCoordinates = [];\n        try {\n             // 마지막 컬럼(인덱스 10)에 있는 JSON 문자열 파싱\n             const coordStr = cols[10]?.trim();\n             if (coordStr && (coordStr.startsWith('[') || coordStr.startsWith('{'))) {\n                 itemCoordinates = JSON.parse(coordStr);\n                 if (Array.isArray(itemCoordinates)) {\n                     coordinates.push(...itemCoordinates);\n                 }\n             }\n        } catch (e) {\n             console.warn('Frontend Coordinate Parse Error:', e);\n        }\n\n        bomItems.push({\n          lineNumber: cols[0]?.trim(),\n          itemType: cols[1]?.trim(),\n          itemName: cols[2]?.trim(),\n          setCount: cols[3]?.trim(),\n          totalQuantity: cols[4]?.trim(),\n          // stock: cols[5], // 현재 UI에서 사용 안함\n          // check: cols[6], // 현재 UI에서 사용 안함\n          refList: cols[7]?.trim(),\n          // alt: cols[8], // 현재 UI에서 사용 안함\n          remark: cols[9]?.trim(),\n          coordinates: itemCoordinates // [중요] 각 아이템에도 좌표 배열 할당\n        });\n      }\n      \n      // 후처리 및 데이터 보정 (Rule-based Correction)\n      // 이 로직은 AI가 실수했을 때를 대비한 안전망으로 남겨둡니다.\n      const correctedBomItems = bomItems.map((item: any) => {\n          // 1. Ref 추출 (문자열)\n          let refPrefix = '';\n          if (item.refList && typeof item.refList === 'string') {\n             refPrefix = item.refList.replace(/[0-9]/g, '').split(',')[0].trim().toUpperCase();\n          }\n\n          // 2. Item Type 보정\n          let newItemType = item.itemType;\n          const invalidTypes = ['저항', 'CAP', 'RES', 'IC', 'DIODE', 'TR']; \n          const looksLikePartName = /^[A-Z0-9]+-[A-Z0-9]+/.test(newItemType) || (newItemType && newItemType.length > 10 && newItemType.includes(' '));\n\n          if (!newItemType || invalidTypes.includes(newItemType) || looksLikePartName) {\n            if (looksLikePartName && (!item.itemName || item.itemName === '')) {\n                item.itemName = newItemType;\n            }\n\n            if (refPrefix.startsWith('R')) newItemType = '저항(1005)';\n            else if (refPrefix.startsWith('C')) newItemType = 'C/C(1005)';\n            else if (refPrefix.startsWith('L') || refPrefix.startsWith('B') || refPrefix.startsWith('FB')) newItemType = 'BEAD(2012)';\n            else if (refPrefix.startsWith('D') || refPrefix.startsWith('ZD')) newItemType = 'DIODE(SMD)';\n            else if (refPrefix.startsWith('Q')) newItemType = 'TR(SMD)';\n            else if (refPrefix.startsWith('U') || refPrefix.startsWith('IC')) newItemType = 'IC(SMD)';\n            else if (refPrefix.startsWith('J') || refPrefix.startsWith('CN') || refPrefix.startsWith('P')) newItemType = 'CONNECTOR';\n            else if (refPrefix.startsWith('Y') || refPrefix.startsWith('X') || refPrefix.startsWith('OSC')) newItemType = 'OSC(SMD)';\n            else if (refPrefix.startsWith('TP')) newItemType = 'TEST POINT';\n            else if (refPrefix.startsWith('SW')) newItemType = 'SWITCH';\n            else if (refPrefix.startsWith('LED') || refPrefix.startsWith('DL')) newItemType = 'LED(1608)';\n            \n            if (item.itemType === '저항') newItemType = '저항(1005)';\n          }\n          \n          // 3. Item Name 보정\n          if (!item.itemName && item.specification) {\n            item.itemName = item.specification;\n          }\n\n          return {\n            ...item,\n            itemType: newItemType || item.itemType\n          };\n      });\n\n      return { bomItems: correctedBomItems, coordinates };\n\n    } catch (e) {\n      console.error('TSV Parse Error:', e);\n      console.log('Raw Content:', content);\n      throw new Error('AI 응답을 처리하는데 실패했습니다.');\n    }\n  } catch (error) {\n    console.error('AI Processing Error:', error);\n    throw error;\n  }\n}\n\nasync function readFileAsText(file: File): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    \n    reader.onload = (e) => {\n      const data = e.target?.result;\n      if (!data) {\n        reject(new Error('파일을 읽을 수 없습니다.'));\n        return;\n      }\n\n      // 엑셀 파일인 경우 XLSX 라이브러리로 텍스트 변환\n      if (file.name.match(/\\.(xlsx|xls)$/i)) {\n        try {\n          const workbook = XLSX.read(data, { type: 'array' });\n          const firstSheetName = workbook.SheetNames[0];\n          const worksheet = workbook.Sheets[firstSheetName];\n          \n          // sheet_to_csv 대신 학습 데이터 생성 로직과 유사하게 탭 구분 텍스트 생성\n          const rows: string[] = [];\n          const range = XLSX.utils.decode_range(worksheet['!ref'] || 'A1:A1');\n          \n          for (let R = range.s.r; R <= range.e.r; ++R) {\n            const cells: string[] = [];\n            // 10개 컬럼까지만 읽음 (학습 데이터와 동일하게)\n            for (let C = range.s.c; C <= Math.min(range.e.c, 10); ++C) {\n              const cell_address = { c: C, r: R };\n              const cell_ref = XLSX.utils.encode_cell(cell_address);\n              const cell = worksheet[cell_ref];\n              \n              if (cell && cell.v !== undefined) {\n                // 특수문자나 공백 제거 로직 (선택 사항)\n                cells.push(String(cell.v).trim());\n              } else {\n                cells.push('');\n              }\n            }\n            // 빈 행 제외 로직\n            if (cells.some(c => c !== '')) {\n              rows.push(cells.join('\\t'));\n            }\n          }\n          \n          resolve(rows.join('\\n'));\n        } catch (err) {\n          console.warn('Excel parsing failed, fallback to text', err);\n          // 바이너리를 텍스트로 읽으면 깨지므로 에러 처리\n          reject(new Error('엑셀 파일 파싱에 실패했습니다.'));\n        }\n      } else {\n        // 텍스트 파일 (CSV, TXT)\n        const textDecoder = new TextDecoder('utf-8'); // 한글 깨짐 방지\n        // FileReader가 readAsArrayBuffer로 읽었으므로 디코딩 필요\n        if (data instanceof ArrayBuffer) {\n            resolve(textDecoder.decode(data));\n        } else {\n            resolve(data as string);\n        }\n      }\n    };\n\n    reader.onerror = (e) => reject(e);\n\n    if (file.name.match(/\\.(xlsx|xls)$/i)) {\n      reader.readAsArrayBuffer(file);\n    } else {\n      // 텍스트 파일도 인코딩 문제를 피하기 위해 ArrayBuffer로 읽어서 디코딩\n      reader.readAsArrayBuffer(file);\n    }\n  });\n}\n","import { useState, useCallback, useEffect } from 'react';\nimport { createClient } from '@/lib/supabase/client';\nimport { toast } from 'sonner';\nimport { Package, Upload, FileText, X, AlertCircle, Loader2, Download, Eye, Plus, Check, ChevronsUpDown } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Command, CommandEmpty, CommandGroup, CommandInput, CommandItem, CommandList } from '@/components/ui/command';\nimport { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Progress } from '@/components/ui/progress';\nimport { cn } from '@/lib/utils';\nimport GeneratedPreviewPanel from './GeneratedPreviewPanel';\nimport CoordinatePreviewPanel from './CoordinatePreviewPanel';\nimport { BOMItem, CoordinateItem, generateCleanedBOMExcel } from '@/utils/excel-generator';\nimport { processBOMWithAI } from '@/utils/bom-processor';\n\ninterface FileInfo {\n  bomFile: File | null;\n  coordFile: File | null;\n  bomUrl?: string;\n  coordUrl?: string;\n}\n\ninterface Metadata {\n  boardName: string;\n  artworkManager: string;\n  productionManager: string;\n  productionQuantity: number;\n}\n\nexport default function BomCoordinateIntegrated() {\n  const [viewMode, setViewMode] = useState<'list' | 'create'>('create');\n  const [step, setStep] = useState<'input' | 'processing' | 'preview'>('input');\n  const [fileInfo, setFileInfo] = useState<FileInfo>({\n    bomFile: null,\n    coordFile: null\n  });\n  const [metadata, setMetadata] = useState<Metadata>({\n    boardName: '',\n    artworkManager: '',\n    productionManager: '',\n    productionQuantity: 0\n  });\n  const [employees, setEmployees] = useState<{ id: string; name: string }[]>([]);\n  const [currentUser, setCurrentUser] = useState<{ email: string; name: string } | null>(null);\n  const [loading, setLoading] = useState(false);\n  const [uploading, setUploading] = useState(false);\n  const [openProductionManager, setOpenProductionManager] = useState(false);\n  const [processedResult, setProcessedResult] = useState<any>(null);\n  const [dragActive, setDragActive] = useState<string | null>(null);\n  const [savedBoards, setSavedBoards] = useState<Array<{\n    id: string;\n    board_name: string;\n    created_at: string;\n    item_count?: number;\n  }>>([]);\n  const [loadingBoards, setLoadingBoards] = useState(false);\n  const [selectedBoardForView, setSelectedBoardForView] = useState<string | null>(null);\n  const [uploadedFilePaths, setUploadedFilePaths] = useState<{ bomPath: string; coordPath: string } | null>(null);\n  const [errorMessage, setErrorMessage] = useState<string | null>(null);\n  const [progress, setProgress] = useState(0);\n  const [loadingText, setLoadingText] = useState('');\n\n  const supabase = createClient();\n\n  // 직원 목록 및 현재 사용자 정보 로드\n  useEffect(() => {\n    const loadData = async () => {\n      try {\n        // 직원 목록 로드\n        const { data: empData } = await supabase\n          .from('employees')\n          .select('id, name')\n          .order('name');\n        \n        if (empData) {\n          setEmployees(empData);\n        }\n\n        // 현재 사용자 정보 로드\n        const { data: { user } } = await supabase.auth.getUser();\n        if (user && user.email) {\n          const { data: userData } = await supabase\n            .from('employees')\n            .select('name')\n            .eq('email', user.email)\n            .single();\n          \n          setCurrentUser({\n            email: user.email,\n            name: userData?.name || user.email.split('@')[0]\n          });\n          \n          setMetadata(prev => ({\n            ...prev,\n            artworkManager: userData?.name || user.email.split('@')[0]\n          }));\n        }\n      } catch (error) {\n        console.error('Error loading data:', error);\n      }\n    };\n\n    loadData();\n  }, [supabase]);\n\n  // 저장된 보드 목록 로드\n  useEffect(() => {\n    const loadSavedBoards = async () => {\n      if (viewMode !== 'list') return;\n      \n      try {\n        setLoadingBoards(true);\n        const { data: boards, error } = await supabase\n          .from('cad_drawings')\n          .select('id, board_name, created_at')\n          .order('created_at', { ascending: false });\n        \n        if (error) throw error;\n        \n        // 각 보드의 아이템 개수 가져오기\n        const boardsWithCount = await Promise.all(\n          (boards || []).map(async (board: any) => {\n            const { count } = await supabase\n              .from('bom_items')\n              .select('*', { count: 'exact', head: true })\n              .eq('cad_drawing_id', board.id);\n            \n            return {\n              ...board,\n              item_count: count || 0\n            };\n          })\n        );\n        \n        setSavedBoards(boardsWithCount);\n      } catch (error) {\n        console.error('Error loading saved boards:', error);\n        toast.error('저장된 BOM 목록을 불러오는데 실패했습니다.');\n      } finally {\n        setLoadingBoards(false);\n      }\n    };\n\n    loadSavedBoards();\n  }, [viewMode, supabase]);\n\n  // 파일명에서 보드 이름 추측\n  useEffect(() => {\n    if (fileInfo.bomFile) {\n      let name = fileInfo.bomFile.name;\n      // 확장자 제거\n      name = name.replace(/\\.(xlsx|xls|csv)$/i, '');\n      // .part.BOM, .BOM, _BOM, part.BOM 등 불필요한 접미사 제거 (대소문자 무관)\n      name = name.replace(/(\\.|_|\\s)?(part)?(\\.|_|\\s)?bom$/i, '');\n      // 앞부분의 타임스탬프나 불필요한 접두사 제거\n      name = name.replace(/^\\d+_bom_/, '');\n      \n      // 날짜 포맷 (YYMMDD) 및 _정리본 추가\n      const today = new Date();\n      const dateStr = today.getFullYear().toString().slice(2) + \n        (today.getMonth() + 1).toString().padStart(2, '0') + \n        today.getDate().toString().padStart(2, '0');\n      \n      name = `${name}_${dateStr}_정리본`;\n\n      setMetadata(prev => ({ ...prev, boardName: name }));\n    }\n  }, [fileInfo.bomFile]);\n\n  const handleDrag = useCallback((e: React.DragEvent, type: string) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (e.type === 'dragenter' || e.type === 'dragover') {\n      setDragActive(type);\n    } else if (e.type === 'dragleave') {\n      setDragActive(null);\n    }\n  }, []);\n\n  const handleDrop = useCallback((e: React.DragEvent, type: 'bom' | 'coord') => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragActive(null);\n\n    if (e.dataTransfer.files && e.dataTransfer.files[0]) {\n      const file = e.dataTransfer.files[0];\n      if (type === 'bom') {\n        setFileInfo(prev => ({ ...prev, bomFile: file }));\n      } else {\n        setFileInfo(prev => ({ ...prev, coordFile: file }));\n      }\n    }\n  }, []);\n\n  const handleFileSelect = useCallback((e: React.ChangeEvent<HTMLInputElement>, type: 'bom' | 'coord') => {\n    if (e.target.files && e.target.files[0]) {\n      const file = e.target.files[0];\n      if (type === 'bom') {\n        setFileInfo(prev => ({ ...prev, bomFile: file }));\n      } else {\n        setFileInfo(prev => ({ ...prev, coordFile: file }));\n      }\n    }\n  }, []);\n\n  const handleRemoveFile = useCallback((type: 'bom' | 'coord') => {\n    if (type === 'bom') {\n      setFileInfo(prev => ({ ...prev, bomFile: null, bomUrl: undefined }));\n    } else {\n      setFileInfo(prev => ({ ...prev, coordFile: null, coordUrl: undefined }));\n    }\n  }, []);\n\n  const handleProcess = async () => {\n    if (!fileInfo.bomFile || !fileInfo.coordFile) {\n      toast.error('BOM 파일과 좌표 파일을 모두 선택해주세요.');\n      return;\n    }\n\n    if (!metadata.boardName.trim()) {\n      toast.error('보드 이름을 입력해주세요.');\n      return;\n    }\n\n    if (!metadata.productionManager || metadata.productionManager === 'none') {\n      toast.error('생산 담당자를 선택해주세요.');\n      return;\n    }\n\n    if (metadata.productionQuantity <= 0) {\n      toast.error('생산 수량을 입력해주세요 (1 이상).');\n      return;\n    }\n\n    let timer: NodeJS.Timeout | null = null;\n    let textTimer: NodeJS.Timeout | null = null;\n\n    try {\n      setUploading(true);\n      setStep('processing');\n      setErrorMessage(null);\n      setProgress(0);\n      setLoadingText('파일 업로드 준비 중...');\n\n      // 예상 소요 시간 계산\n      const totalSize = (fileInfo.bomFile?.size || 0) + (fileInfo.coordFile?.size || 0);\n      const estimatedDuration = 15000 + (totalSize / 1024) * 50; \n      \n      const updateInterval = 500;\n      const totalSteps = estimatedDuration / updateInterval;\n      const incrementPerStep = 90 / totalSteps;\n\n      // 진행률 애니메이션 시작\n      timer = setInterval(() => {\n        setProgress((oldProgress) => {\n          if (oldProgress >= 95) {\n            return oldProgress;\n          }\n          const randomFactor = Math.random() * 0.5 + 0.8;\n          return Math.min(oldProgress + (incrementPerStep * randomFactor), 95);\n        });\n      }, updateInterval);\n\n      // 텍스트 변경 타이머\n      textTimer = setInterval(() => {\n        setLoadingText((current) => {\n          if (current === '파일 업로드 준비 중...') return 'BOM 파일 읽는 중...';\n          if (current === 'BOM 파일 읽는 중...') return '데이터 구조 분석 중...';\n          if (current === '데이터 구조 분석 중...') return '좌표 데이터 매칭 중...';\n          if (current === '좌표 데이터 매칭 중...') return 'AI가 최종 정리 중입니다...';\n          if (current === 'AI가 최종 정리 중입니다...') return '거의 다 되었습니다. 잠시만요!';\n          return current;\n        });\n      }, estimatedDuration / 5);\n\n      // 1. 파일 업로드 (Storage) - 로직 유지\n      // ... (파일 업로드 코드는 그대로 둠) ...\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('로그인이 필요합니다.');\n\n      const timestamp = Date.now();\n      const sanitizeFileName = (fileName: string) => {\n        const lastDotIndex = fileName.lastIndexOf('.');\n        const extension = lastDotIndex > -1 ? fileName.slice(lastDotIndex) : '';\n        const nameWithoutExt = lastDotIndex > -1 ? fileName.slice(0, lastDotIndex) : fileName;\n        const safeName = nameWithoutExt\n          .replace(/[^a-zA-Z0-9\\-_]/g, '_')\n          .replace(/_+/g, '_')\n          .replace(/^_|_$/g, '');\n        return (safeName || 'file') + extension;\n      };\n\n      const safeBomFileName = sanitizeFileName(fileInfo.bomFile.name);\n      const safeCoordFileName = sanitizeFileName(fileInfo.coordFile.name);\n      const bomPath = `raw/${timestamp}_bom_${safeBomFileName}`;\n      const coordPath = `raw/${timestamp}_coord_${safeCoordFileName}`;\n\n      // 파일 업로드\n      const bomResult = await supabase.storage\n        .from('bom-files')\n        .upload(bomPath, fileInfo.bomFile, { cacheControl: '3600', upsert: true });\n\n      if (bomResult.error) throw bomResult.error;\n\n      const coordResult = await supabase.storage\n        .from('bom-files')\n        .upload(coordPath, fileInfo.coordFile, { cacheControl: '3600', upsert: true });\n\n      if (coordResult.error) {\n        await supabase.storage.from('bom-files').remove([bomPath]);\n        throw coordResult.error;\n      }\n\n      // Signed URL 생성\n      const { data: bomUrlData } = await supabase.storage\n        .from('bom-files')\n        .createSignedUrl(bomPath, 60 * 60);\n\n      const { data: coordUrlData } = await supabase.storage\n        .from('bom-files')\n        .createSignedUrl(coordPath, 60 * 60);\n\n      if (!bomUrlData?.signedUrl || !coordUrlData?.signedUrl) {\n        throw new Error('파일 URL 생성 실패');\n      }\n\n      // 업로드된 파일 경로 저장 (나중에 DB에 저장할 때 사용)\n      setUploadedFilePaths({ bomPath, coordPath });\n\n      // 2. Client-side AI Processing (CORS 우회)\n      console.log('Processing BOM with AI (Client-side)...');\n      \n      // 파일 객체 직접 전달\n      const processedData = await processBOMWithAI(\n        fileInfo.bomFile,\n        fileInfo.coordFile,\n        metadata.productionQuantity\n      );\n\n      if (timer) clearInterval(timer);\n      if (textTimer) clearInterval(textTimer);\n      setProgress(100);\n      setLoadingText('완료!');\n\n      if (!processedData || !processedData.bomItems) {\n        throw new Error('AI 처리 결과가 올바르지 않습니다.');\n      }\n\n      // 3. 결과 데이터 구조화 (임시 ID 부여)\n      const resultWithId = {\n        cadDrawingId: `cad_${Date.now()}`,\n        processedData: {\n          bomItems: processedData.bomItems,\n          coordinates: processedData.coordinates\n        }\n      };\n\n      setProcessedResult(resultWithId);\n      toast.success('BOM 분석 및 정리가 완료되었습니다.');\n      setStep('preview');\n\n    } catch (error: any) {\n      console.error('Processing error:', error);\n      const msg = `처리 중 오류가 발생했습니다: ${error.message || error}`;\n      setErrorMessage(msg);\n      \n      if (timer) clearInterval(timer);\n      if (textTimer) clearInterval(textTimer);\n      \n      setUploading(false);\n      setStep('input'); \n      window.scrollTo({ top: 0, behavior: 'smooth' });\n    } finally {\n      // 성공 시에는 위에서 clearInterval 등을 처리했음\n      // 실패 시에만 여기가 실행될 수 있는데, 중복 실행 방지\n      if (step === 'processing' && errorMessage) {\n         setUploading(false);\n      }\n    }\n  };\n\n  const handleSaveBOM = async (items: BOMItem[]) => {\n    if (!processedResult?.cadDrawingId) return;\n\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error('로그인이 필요합니다.');\n\n      // 1. cad_drawings 테이블에 보드 정보 저장/업데이트\n      let cadDrawingId = processedResult.cadDrawingId;\n      \n      // cadDrawingId가 임시 ID인 경우 (새로 생성)\n      if (cadDrawingId.startsWith('cad_')) {\n        const { data: existingBoard, error: checkError } = await supabase\n          .from('cad_drawings')\n          .select('id')\n          .eq('board_name', metadata.boardName)\n          .single();\n\n        if (checkError && checkError.code !== 'PGRST116') {\n          throw checkError;\n        }\n\n        if (existingBoard) {\n          cadDrawingId = existingBoard.id;\n        } else {\n          const { data: newBoard, error: boardError } = await supabase\n            .from('cad_drawings')\n            .insert({ board_name: metadata.boardName })\n            .select('id')\n            .single();\n\n          if (boardError) throw boardError;\n          cadDrawingId = newBoard.id;\n        }\n      }\n\n      // 2. 원본 파일 정보 저장 (bom_raw_files)\n      if (fileInfo.bomFile && fileInfo.coordFile && uploadedFilePaths) {\n        let bomFileUrl = '';\n        let coordFileUrl = '';\n\n        // Storage에서 Signed URL 생성 (1년 유효)\n        const { data: bomUrlData } = await supabase.storage\n          .from('bom-files')\n          .createSignedUrl(uploadedFilePaths.bomPath, 60 * 60 * 24 * 365);\n\n        const { data: coordUrlData } = await supabase.storage\n          .from('bom-files')\n          .createSignedUrl(uploadedFilePaths.coordPath, 60 * 60 * 24 * 365);\n\n        if (bomUrlData?.signedUrl) bomFileUrl = bomUrlData.signedUrl;\n        if (coordUrlData?.signedUrl) coordFileUrl = coordUrlData.signedUrl;\n\n        // bom_raw_files에 저장 (기존 데이터가 있으면 업데이트, 없으면 삽입)\n        const { data: existingRawFile } = await supabase\n          .from('bom_raw_files')\n          .select('id')\n          .eq('cad_drawing_id', cadDrawingId)\n          .single();\n\n        if (existingRawFile) {\n          const { error: updateRawError } = await supabase\n            .from('bom_raw_files')\n            .update({\n              bom_file_url: bomFileUrl,\n              coordinate_file_url: coordFileUrl,\n              bom_file_name: fileInfo.bomFile.name,\n              coordinate_file_name: fileInfo.coordFile.name,\n              uploaded_by: user.email || user.id\n            })\n            .eq('id', existingRawFile.id);\n\n          if (updateRawError) throw updateRawError;\n        } else {\n          const { error: insertRawError } = await supabase\n            .from('bom_raw_files')\n            .insert({\n              cad_drawing_id: cadDrawingId,\n              bom_file_url: bomFileUrl,\n              coordinate_file_url: coordFileUrl,\n              bom_file_name: fileInfo.bomFile.name,\n              coordinate_file_name: fileInfo.coordFile.name,\n              uploaded_by: user.email || user.id\n            });\n\n          if (insertRawError) throw insertRawError;\n        }\n      }\n\n      // 3. 기존 bom_items 삭제 후 새로 저장\n      const { error: deleteError } = await supabase\n        .from('bom_items')\n        .delete()\n        .eq('cad_drawing_id', cadDrawingId);\n\n      if (deleteError) throw deleteError;\n\n        const { error: insertError } = await supabase\n          .from('bom_items')\n          .insert(\n            items.map((item: BOMItem) => ({\n              cad_drawing_id: cadDrawingId,\n              line_number: item.lineNumber,\n            item_type: item.itemType,\n            item_name: item.itemName,\n            specification: item.specification,\n            set_count: item.setCount,\n            total_quantity: item.totalQuantity,\n            stock_quantity: item.stockQuantity,\n            check_status: item.checkStatus,\n            ref_list: Array.isArray(item.refList) ? item.refList : (item.refList ? item.refList.split(',') : []),\n            alternative_item: item.alternativeItem,\n            remark: item.remark\n          }))\n        );\n\n      if (insertError) throw insertError;\n\n      // 4. 좌표 데이터도 저장 (part_placements)\n      if (processedResult.processedData?.coordinates) {\n        const { error: deleteCoordError } = await supabase\n          .from('part_placements')\n          .delete()\n          .eq('cad_drawing_id', cadDrawingId);\n\n        if (deleteCoordError) throw deleteCoordError;\n\n        const { error: insertCoordError } = await supabase\n          .from('part_placements')\n          .insert(\n            processedResult.processedData.coordinates.map((coord: CoordinateItem) => ({\n              cad_drawing_id: cadDrawingId,\n              ref: coord.ref,\n              part_name: coord.partName,\n              part_type: coord.partType,\n              side: coord.side,\n              x_coordinate: parseFloat(coord.x?.toString() || '0'),\n              y_coordinate: parseFloat(coord.y?.toString() || '0'),\n              angle: coord.angle ? parseFloat(coord.angle.toString()) : null\n            }))\n          );\n\n        if (insertCoordError) throw insertCoordError;\n      }\n\n      // 5. AI 학습 데이터 저장 (중요: 지속적인 학습을 위해 원본과 결과 저장)\n      // 사용자가 최종 수정한 데이터(items, processedResult.processedData.coordinates)가 정답 데이터가 됨\n      if (uploadedFilePaths) { // 원본 파일 경로가 있을 때만\n        // 텍스트 내용은 클라이언트에서 다시 읽어오기 번거로우므로, 일단 파일 경로와 결과 데이터만 저장하거나\n        // 추후 Edge Function이 복구되면 거기서 처리. \n        // 현재는 DB에 파일 경로와 결과 JSON을 저장하여 나중에 파인튜닝에 활용\n        \n        /* 학습 데이터 저장 로직 (ai_learning_records 테이블) */\n        const { error: learningError } = await supabase\n          .from('ai_learning_records')\n          .insert({\n            cad_drawing_id: cadDrawingId,\n            // 원본 데이터는 URL로 참조하거나, 필요시 텍스트로 저장해야 함. \n            // 여기서는 메타데이터 위주로 저장\n            processed_bom_data: items, // 사용자가 검수/수정한 최종 BOM\n            processed_coordinate_data: processedResult.processedData?.coordinates,\n            cad_program_type: 'unknown', // 추후 분석 가능\n            created_at: new Date().toISOString()\n          });\n          \n        if (learningError) {\n            console.warn('학습 데이터 저장 실패 (기능에는 영향 없음):', learningError);\n        }\n      }\n      \n      // cadDrawingId 업데이트\n      setProcessedResult((prev: any) => ({\n        ...prev,\n        cadDrawingId: cadDrawingId,\n        processedData: {\n          ...prev.processedData,\n          bomItems: items\n        }\n      }));\n\n      toast.success('수정사항이 저장되었습니다.');\n      \n      // 목록 뷰로 전환하여 새로 저장된 항목 확인 가능\n      setTimeout(() => {\n        setViewMode('list');\n      }, 1000);\n\n    } catch (error: any) {\n      console.error('Save error:', error);\n      toast.error(`저장에 실패했습니다: ${error.message}`);\n    }\n  };\n\n  const handleReset = () => {\n    setStep('input');\n    setFileInfo({ bomFile: null, coordFile: null });\n    setMetadata(prev => ({\n      ...prev,\n      boardName: '',\n      productionManager: '',\n      productionQuantity: 0\n    }));\n    setProcessedResult(null);\n    setUploadedFilePaths(null);\n  };\n\n  // 저장된 BOM 다운로드\n  const handleDownloadSavedBOM = async (boardId: string, boardName: string) => {\n    try {\n      // BOM 아이템 가져오기\n      const { data: bomItems, error: bomError } = await supabase\n        .from('bom_items')\n        .select('*')\n        .eq('cad_drawing_id', boardId)\n        .order('line_number');\n      \n      if (bomError) throw bomError;\n\n      // 좌표 데이터 가져오기\n      const { data: coordinates, error: coordError } = await supabase\n        .from('part_placements')\n        .select('*')\n        .eq('cad_drawing_id', boardId);\n      \n      if (coordError) throw coordError;\n\n      // BOMItem 형식으로 변환\n      const convertedBOMItems: BOMItem[] = (bomItems || []).map((item: any) => ({\n        lineNumber: item.line_number,\n        itemType: item.item_type || '',\n        itemName: item.item_name,\n        specification: item.specification || '',\n        setCount: item.set_count,\n        totalQuantity: item.total_quantity || 0,\n        stockQuantity: item.stock_quantity || 0,\n        checkStatus: item.check_status || '□양호',\n        refList: Array.isArray(item.ref_list) ? item.ref_list.join(',') : (item.ref_list || ''),\n        alternativeItem: item.alternative_item || '',\n        remark: item.remark || ''\n      }));\n\n      // CoordinateItem 형식으로 변환\n      const convertedCoords: CoordinateItem[] = (coordinates || []).map((coord: any) => ({\n        ref: coord.ref,\n        partName: coord.part_name,\n        partType: coord.part_type || 'SMD',\n        side: coord.side,\n        x: coord.x_coordinate.toString(),\n        y: coord.y_coordinate.toString(),\n        angle: coord.angle?.toString() || '0'\n      }));\n\n      // Excel 생성 및 다운로드\n      // 저장된 BOM은 productionQuantity 정보를 따로 저장하지 않았으므로(로그에만 있음), \n      // BOM 아이템 역산을 통해 추정하거나 0으로 처리해야 함.\n      // 일단 0으로 넘기고 excel-generator 내부에서 역산 로직 활용\n      const blob = await generateCleanedBOMExcel(convertedBOMItems, convertedCoords, boardName);\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      \n      // 보드 이름에 이미 날짜와 _정리본이 포함되어 있으므로 그대로 사용\n      a.download = `${boardName}.xlsx`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      window.URL.revokeObjectURL(url);\n      \n      toast.success('엑셀 파일이 다운로드되었습니다.');\n    } catch (error: any) {\n      console.error('Download error:', error);\n      toast.error(`다운로드 중 오류가 발생했습니다: ${error.message}`);\n    }\n  };\n\n  // 저장된 BOM 상세 보기\n  const handleViewSavedBOM = async (boardId: string) => {\n    try {\n      // BOM 아이템 가져오기\n      const { data: bomItems, error: bomError } = await supabase\n        .from('bom_items')\n        .select('*')\n        .eq('cad_drawing_id', boardId)\n        .order('line_number');\n      \n      if (bomError) throw bomError;\n\n      // 좌표 데이터 가져오기\n      const { data: coordinates, error: coordError } = await supabase\n        .from('part_placements')\n        .select('*')\n        .eq('cad_drawing_id', boardId);\n      \n      if (coordError) throw coordError;\n\n      // 보드 정보 가져오기\n      const { data: boardData } = await supabase\n        .from('cad_drawings')\n        .select('board_name')\n        .eq('id', boardId)\n        .single();\n\n      // BOMItem 형식으로 변환\n      const convertedBOMItems: BOMItem[] = (bomItems || []).map((item: any) => ({\n        lineNumber: item.line_number,\n        itemType: item.item_type || '',\n        itemName: item.item_name,\n        specification: item.specification || '',\n        setCount: item.set_count,\n        totalQuantity: item.total_quantity || 0,\n        stockQuantity: item.stock_quantity || 0,\n        checkStatus: item.check_status || '□양호',\n        refList: Array.isArray(item.ref_list) ? item.ref_list.join(',') : (item.ref_list || ''),\n        alternativeItem: item.alternative_item || '',\n        remark: item.remark || ''\n      }));\n\n      // CoordinateItem 형식으로 변환\n      const convertedCoords: CoordinateItem[] = (coordinates || []).map((coord: any) => ({\n        ref: coord.ref,\n        partName: coord.part_name,\n        partType: coord.part_type || 'SMD',\n        side: coord.side,\n        x: coord.x_coordinate.toString(),\n        y: coord.y_coordinate.toString(),\n        angle: coord.angle?.toString() || '0'\n      }));\n\n      setProcessedResult({\n        cadDrawingId: boardId,\n        processedData: {\n          bomItems: convertedBOMItems,\n          coordinates: convertedCoords\n        }\n      });\n\n      setMetadata(prev => ({\n        ...prev,\n        boardName: boardData?.board_name || ''\n      }));\n\n      setSelectedBoardForView(boardId);\n      setViewMode('create');\n      setStep('preview');\n      \n      toast.success('저장된 BOM을 불러왔습니다.');\n    } catch (error: any) {\n      console.error('View error:', error);\n      toast.error(`BOM을 불러오는데 실패했습니다: ${error.message}`);\n    }\n  };\n\n  return (\n    <div className=\"w-full\">\n      {/* Header */}\n      <div className=\"mb-4\">\n        <div>\n          <h1 className=\"page-title\">BOM/좌표 정리</h1>\n          <div className=\"flex justify-between items-center\" style={{marginTop:'-2px',marginBottom:'-4px'}}>\n            <p className=\"page-subtitle mb-0\">BOM & Coordinate Management</p>\n            <div className=\"flex gap-2\">\n              <Button\n                onClick={() => {\n                  setViewMode('create');\n                  setStep('input');\n                  setSelectedBoardForView(null);\n                  handleReset();\n                }}\n                className={`button-base ${\n                  viewMode === 'create' \n                    ? 'bg-hansl-600 hover:bg-hansl-700 text-white' \n                    : 'border border-gray-300 bg-white text-gray-700 hover:bg-gray-50'\n                }`}\n              >\n                <Plus className=\"w-4 h-4 mr-2\" />\n                새로 만들기\n              </Button>\n              <Button\n                onClick={() => {\n                  setViewMode('list');\n                  setStep('input');\n                  setSelectedBoardForView(null);\n                }}\n                className={`button-base ${\n                  viewMode === 'list' \n                    ? 'bg-hansl-600 hover:bg-hansl-700 text-white' \n                    : 'border border-gray-300 bg-white text-gray-700 hover:bg-gray-50'\n                }`}\n              >\n                <Eye className=\"w-4 h-4 mr-2\" />\n                저장된 목록\n              </Button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* 저장된 BOM 목록 */}\n      {viewMode === 'list' && (\n        <div className=\"space-y-4\">\n          <Card>\n            <CardContent className=\"p-4 sm:p-6\">\n              {loadingBoards ? (\n                <div className=\"flex items-center justify-center py-12\">\n                  <Loader2 className=\"w-6 h-6 text-hansl-600 animate-spin mr-2\" />\n                  <span className=\"text-sm text-gray-600\">목록을 불러오는 중...</span>\n                </div>\n              ) : savedBoards.length === 0 ? (\n                <div className=\"text-center py-12\">\n                  <Package className=\"w-12 h-12 mx-auto mb-3 text-gray-300\" />\n                  <p className=\"text-sm text-gray-500 mb-4\">저장된 BOM이 없습니다.</p>\n                  <Button\n                    onClick={() => setViewMode('create')}\n                    className=\"button-base bg-hansl-600 hover:bg-hansl-700 text-white\"\n                  >\n                    <Plus className=\"w-4 h-4 mr-2\" />\n                    새 BOM 만들기\n                  </Button>\n                </div>\n              ) : (\n                <div className=\"space-y-3\">\n                  <div className=\"flex justify-between items-center mb-4\">\n                    <h3 className=\"text-base sm:text-lg font-semibold\">저장된 BOM 목록</h3>\n                    <span className=\"text-xs sm:text-sm text-gray-500\">총 {savedBoards.length}개</span>\n                  </div>\n                  <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4\">\n                    {savedBoards.map((board) => (\n                      <Card key={board.id} className=\"hover:shadow-md transition-shadow\">\n                        <CardContent className=\"p-4\">\n                          <div className=\"flex justify-between items-start mb-3\">\n                            <div className=\"flex-1 min-w-0\">\n                              <h4 className=\"font-semibold text-sm sm:text-base truncate\" title={board.board_name}>\n                                {board.board_name}\n                              </h4>\n                              <p className=\"text-xs text-gray-500 mt-1\">\n                                {new Date(board.created_at).toLocaleDateString('ko-KR', {\n                                  year: 'numeric',\n                                  month: '2-digit',\n                                  day: '2-digit'\n                                })}\n                              </p>\n                            </div>\n                            <Badge variant=\"outline\" className=\"text-[10px] sm:text-xs ml-2 flex-shrink-0\">\n                              {board.item_count || 0}개\n                            </Badge>\n                          </div>\n                          <div className=\"flex gap-2\">\n                            <Button\n                              onClick={() => handleViewSavedBOM(board.id)}\n                              variant=\"outline\"\n                              size=\"sm\"\n                              className=\"flex-1 text-xs\"\n                            >\n                              <Eye className=\"w-3 h-3 mr-1\" />\n                              보기\n                            </Button>\n                            <Button\n                              onClick={() => handleDownloadSavedBOM(board.id, board.board_name)}\n                              variant=\"outline\"\n                              size=\"sm\"\n                              className=\"flex-1 text-xs\"\n                            >\n                              <Download className=\"w-3 h-3 mr-1\" />\n                              다운로드\n                            </Button>\n                          </div>\n                        </CardContent>\n                      </Card>\n                    ))}\n                  </div>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n      )}\n\n      {/* 새로 만들기 / 미리보기 */}\n      {viewMode === 'create' && (\n        <>\n      {/* 메인 컨텐츠 */}\n      {step === 'input' && (\n        <div className=\"space-y-4\">\n          {errorMessage && (\n            <div className=\"bg-red-50 border border-red-200 text-red-700 px-6 py-4 rounded-lg text-sm flex flex-col gap-2 shadow-sm animate-in fade-in slide-in-from-top-2\">\n              <div className=\"flex items-center gap-2 font-semibold\">\n                <AlertCircle className=\"w-5 h-5 flex-shrink-0 text-red-600\" />\n                <span>오류가 발생했습니다</span>\n              </div>\n              <p className=\"pl-7\">{errorMessage}</p>\n              {errorMessage.includes('quota') && (\n                <p className=\"pl-7 text-xs text-red-600 mt-1\">\n                  * OpenAI 결제 정보가 반영되기까지 최대 10~20분이 소요될 수 있습니다. 잠시 후 다시 시도해주세요.\n                </p>\n              )}\n            </div>\n          )}\n          \n          {/* 파일 업로드 영역 */}\n          <Card>\n            <CardContent className=\"py-4\">\n              <div className=\"flex flex-col lg:flex-row gap-4 lg:gap-6 items-stretch\">\n                {/* 왼쪽: 파일 업로드 (50%) */}\n                <div className=\"w-full lg:w-[50%] grid grid-cols-1 sm:grid-cols-2 gap-3\">\n                  {/* BOM 파일 업로드 */}\n                  <div \n                    className={cn(\n                      \"border-2 border-dashed rounded-lg p-2 text-center transition-colors cursor-pointer relative flex flex-col items-center justify-center h-full\",\n                      dragActive === 'bom' ? \"border-primary bg-primary/5\" : \"border-gray-200 hover:border-gray-300\",\n                      fileInfo.bomFile ? \"bg-green-50 border-green-200\" : \"\"\n                    )}\n                    onDragEnter={(e) => handleDrag(e, 'bom')}\n                    onDragLeave={(e) => handleDrag(e, 'bom')}\n                    onDragOver={(e) => handleDrag(e, 'bom')}\n                    onDrop={(e) => handleDrop(e, 'bom')}\n                    onClick={() => document.getElementById('bom-upload')?.click()}\n                  >\n                    <input \n                      id=\"bom-upload\" \n                      type=\"file\" \n                      className=\"hidden\" \n                      accept=\".xlsx,.xls\" \n                      onChange={(e) => handleFileSelect(e, 'bom')}\n                    />\n                    \n                    {fileInfo.bomFile ? (\n                      <div className=\"flex flex-col items-center gap-1 w-full px-1\">\n                        <span className=\"text-xs font-bold text-green-600\">BOM</span>\n                        <p className=\"text-[10px] font-medium text-green-700 w-full text-center break-all line-clamp-2\" title={fileInfo.bomFile.name}>\n                          {fileInfo.bomFile.name}\n                        </p>\n                        <Button \n                          variant=\"ghost\" \n                          size=\"sm\" \n                          className=\"absolute top-1 right-1 p-0 w-4 h-4 min-w-0\"\n                          onClick={(e) => { e.stopPropagation(); handleRemoveFile('bom'); }}\n                        >\n                          <X size={12} />\n                        </Button>\n                      </div>\n                    ) : (\n                      <div className=\"flex flex-col items-center gap-1\">\n                        <span className=\"text-xs font-bold text-gray-400\">BOM</span>\n                        <p className=\"text-[10px] font-medium text-gray-700\">파일 업로드</p>\n                      </div>\n                    )}\n                  </div>\n\n                  {/* 좌표 파일 업로드 */}\n                  <div \n                    className={cn(\n                      \"border-2 border-dashed rounded-lg p-2 text-center transition-colors cursor-pointer relative flex flex-col items-center justify-center h-full\",\n                      dragActive === 'coord' ? \"border-primary bg-primary/5\" : \"border-gray-200 hover:border-gray-300\",\n                      fileInfo.coordFile ? \"bg-blue-50 border-blue-200\" : \"\"\n                    )}\n                    onDragEnter={(e) => handleDrag(e, 'coord')}\n                    onDragLeave={(e) => handleDrag(e, 'coord')}\n                    onDragOver={(e) => handleDrag(e, 'coord')}\n                    onDrop={(e) => handleDrop(e, 'coord')}\n                    onClick={() => document.getElementById('coord-upload')?.click()}\n                  >\n                    <input \n                      id=\"coord-upload\" \n                      type=\"file\" \n                      className=\"hidden\" \n                      accept=\".xlsx,.xls,.txt,.csv\" \n                      onChange={(e) => handleFileSelect(e, 'coord')}\n                    />\n                    \n                    {fileInfo.coordFile ? (\n                      <div className=\"flex flex-col items-center gap-1 w-full px-1\">\n                        <span className=\"text-xs font-bold text-blue-600\">좌표</span>\n                        <p className=\"text-[10px] font-medium text-blue-700 w-full text-center break-all line-clamp-2\" title={fileInfo.coordFile.name}>\n                          {fileInfo.coordFile.name}\n                        </p>\n                        <Button \n                          variant=\"ghost\" \n                          size=\"sm\" \n                          className=\"absolute top-1 right-1 p-0 w-4 h-4 min-w-0\"\n                          onClick={(e) => { e.stopPropagation(); handleRemoveFile('coord'); }}\n                        >\n                          <X size={12} />\n                        </Button>\n                      </div>\n                    ) : (\n                      <div className=\"flex flex-col items-center gap-1\">\n                        <span className=\"text-xs font-bold text-gray-400\">좌표</span>\n                        <p className=\"text-[10px] font-medium text-gray-700\">파일 업로드</p>\n                      </div>\n                    )}\n                  </div>\n                </div>\n\n                {/* 오른쪽: 정보 입력 (50%) */}\n                <div className=\"w-full lg:w-[50%] space-y-1\">\n                  {/* 1. 보드 이름 (전체 폭) */}\n                  <div className=\"space-y-1 mb-3.5\">\n                    <Label className=\"text-[10px] text-gray-500\">보드 이름 (자동)</Label>\n                    <Input\n                      value={metadata.boardName || 'BOM 파일 업로드 시 자동'}\n                      disabled\n                      className=\"w-full bg-gray-50 border border-[#d2d2d7] rounded-md text-xs shadow-sm\"\n                      style={{ height: '32px' }}\n                    />\n                  </div>\n\n                  {/* 2. Artwork 담당자, 생산 담당자, 생산 수량, 생성 버튼 (같은 행) */}\n                  <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-2\">\n                    {/* Artwork 담당자 */}\n                    <div className=\"space-y-1\">\n                      <Label className=\"text-[10px] text-gray-500\">Artwork 담당자</Label>\n                      <Input\n                        value={currentUser?.name || '로딩'}\n                        disabled\n                        className=\"w-full bg-gray-50 border border-[#d2d2d7] rounded-md text-xs shadow-sm\"\n                        style={{ height: '32px' }}\n                      />\n                    </div>\n\n                    {/* 생산 담당자 */}\n                    <div className=\"space-y-1\">\n                      <Label className=\"text-[10px] text-gray-500\">생산 담당자 <span className=\"text-red-500\">*</span></Label>\n                      <Popover open={openProductionManager} onOpenChange={setOpenProductionManager}>\n                        <PopoverTrigger asChild>\n                          <Button\n                            variant=\"outline\"\n                            role=\"combobox\"\n                            aria-expanded={openProductionManager}\n                            className=\"w-full justify-between text-xs h-8 min-h-[32px] px-2 bg-white border-[#d2d2d7] shadow-sm hover:bg-gray-50\"\n                          >\n                            {metadata.productionManager\n                              ? employees.find((emp) => emp.id === metadata.productionManager)?.name\n                              : \"담당자 선택\"}\n                            <ChevronsUpDown className=\"ml-2 h-3 w-3 shrink-0 opacity-50\" />\n                          </Button>\n                        </PopoverTrigger>\n                        <PopoverContent className=\"w-[200px] p-0\">\n                          <Command>\n                            <CommandInput placeholder=\"이름 검색...\" className=\"h-8 text-xs\" />\n                            <CommandList>\n                              <CommandEmpty>검색 결과 없음</CommandEmpty>\n                              <CommandGroup>\n                                {employees.map((emp) => (\n                                  <CommandItem\n                                    key={emp.id}\n                                    value={emp.name}\n                                    onSelect={() => {\n                                      setMetadata(prev => ({ ...prev, productionManager: emp.id }));\n                                      setOpenProductionManager(false);\n                                    }}\n                                    className=\"text-xs\"\n                                  >\n                                    <Check\n                                      className={cn(\n                                        \"mr-2 h-3 w-3\",\n                                        metadata.productionManager === emp.id ? \"opacity-100\" : \"opacity-0\"\n                                      )}\n                                    />\n                                    {emp.name}\n                                  </CommandItem>\n                                ))}\n                              </CommandGroup>\n                            </CommandList>\n                          </Command>\n                        </PopoverContent>\n                      </Popover>\n                    </div>\n\n                    {/* 생산 수량 */}\n                    <div className=\"space-y-1\">\n                      <Label className=\"text-[10px] text-gray-500\">생산 수량 <span className=\"text-red-500\">*</span></Label>\n                      <div className=\"relative\">\n                        <Input\n                          type=\"number\"\n                          min=\"0\"\n                          value={metadata.productionQuantity === 0 ? '' : metadata.productionQuantity}\n                          onChange={(e) => setMetadata(prev => ({ ...prev, productionQuantity: parseInt(e.target.value) || 0 }))}\n                          className=\"w-full bg-white border border-[#d2d2d7] rounded-md text-xs shadow-sm hover:shadow-md transition-shadow duration-200 pr-8\"\n                          style={{ height: '32px' }}\n                          placeholder=\"0\"\n                        />\n                        <span className=\"absolute right-2.5 top-1/2 -translate-y-1/2 text-[10px] text-gray-500 font-medium pointer-events-none\">SET</span>\n                      </div>\n                    </div>\n\n                    {/* 생성 버튼 */}\n                    <div className=\"flex items-end\">\n                      <Button \n                        onClick={handleProcess}\n                        disabled={!fileInfo.bomFile || !fileInfo.coordFile || !metadata.boardName || uploading}\n                        className=\"w-full bg-hansl-600 hover:bg-hansl-700 text-white shadow-sm text-xs\"\n                        style={{ height: '32px' }}\n                      >\n                        정리 및 생성\n                      </Button>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* 안내 메시지 */}\n          {!fileInfo.bomFile && !fileInfo.coordFile && (\n            <div className=\"text-center py-6 sm:py-8 text-gray-500\">\n              <Package className=\"w-10 h-10 sm:w-12 sm:h-12 mx-auto mb-3 text-gray-300\" />\n              <p className=\"text-xs sm:text-sm px-4\">BOM 파일과 좌표 파일을 업로드하여 시작하세요</p>\n            </div>\n          )}\n        </div>\n      )}\n\n      {/* 처리 중 */}\n      {step === 'processing' && (\n        <Card>\n          <CardContent className=\"py-12 sm:py-16 lg:py-20\">\n            <div className=\"flex flex-col items-center justify-center max-w-md mx-auto\">\n              <Loader2 className=\"w-8 h-8 sm:w-10 sm:h-10 text-hansl-600 animate-spin mb-6\" />\n              <h3 className=\"text-base sm:text-lg lg:text-xl font-semibold text-center mb-2\">{loadingText || 'AI가 BOM을 분석하고 있습니다'}</h3>\n              <p className=\"text-xs sm:text-sm text-gray-600 mb-6 text-center px-4\">잠시만 기다려주세요... (약 30초 ~ 1분 소요)</p>\n              \n              <div className=\"w-full px-4\">\n                <Progress value={progress} className=\"h-2\" />\n                <p className=\"text-right text-xs text-gray-500 mt-1\">{Math.round(progress)}%</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* 결과 미리보기 */}\n      {step === 'preview' && processedResult && (\n        <div className=\"space-y-4\">\n          <Card className=\"border-green-200 bg-green-50\">\n            <CardContent className=\"p-3 sm:p-4\">\n              <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3\">\n                <div className=\"flex items-center gap-2 sm:gap-3\">\n                  <div className=\"w-8 h-8 sm:w-10 sm:h-10 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0\">\n                    <Package className=\"w-4 h-4 sm:w-5 sm:h-5 text-green-600\" />\n                  </div>\n                  <div>\n                    <h3 className=\"text-sm sm:text-base lg:text-lg font-semibold text-green-900\">분석 완료</h3>\n                    <p className=\"text-xs sm:text-sm text-green-700 mt-0.5\">\n                      보드명: {metadata.boardName} / 생산수량: {metadata.productionQuantity} SET\n                    </p>\n                  </div>\n                </div>\n                <Button \n                  onClick={handleReset} \n                  className=\"w-full sm:w-auto button-base border border-green-200 bg-white text-green-700 hover:bg-green-100 text-xs sm:text-sm\"\n                >\n                  처음부터 다시 하기\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4\">\n            <div className=\"lg:col-span-2\">\n              <GeneratedPreviewPanel \n                bomItems={processedResult.processedData?.bomItems || []}\n                coordinates={processedResult.processedData?.coordinates || []}\n                boardName={metadata.boardName || 'Board'}\n                productionQuantity={metadata.productionQuantity}\n                onSave={handleSaveBOM}\n              />\n            </div>\n\n            <div className=\"lg:col-span-1\">\n              <CoordinatePreviewPanel \n                coordinates={processedResult.processedData?.coordinates || []}\n              />\n            </div>\n          </div>\n        </div>\n      )}\n        </>\n      )}\n    </div>\n  );\n}"],"names":["LoaderCircle","createLucideIcon","d","key","badgeVariants","cva","variants","variant","default","secondary","success","warning","destructive","info","outline","pending","approved","rejected","defaultVariants","Badge","className","asChild","props","Comp","Slot","jsx","cn","Progress","React.forwardRef","value","ref","children","style","transform","async","generateCleanedBOMExcel","bomItems","coordinates","boardName","productionQuantity","workbook","ExcelJS","Workbook","response","fetch","ok","buffer","arrayBuffer","xlsx","load","bomSheet","addWorksheet","getRow","values","font","bold","error","creator","modified","Date","getWorksheet","worksheets","startRow","headerFound","eachRow","row","rowNumber","Array","isArray","some","v","toString","includes","titleCellFound","i","eachCell","cell","infoRowIndex","dataStartIndex","infoRow","productionQty","length","setCount","Math","round","totalQuantity","getCell","name","size","alignment","horizontal","vertical","forEach","item","index","currentRowNum","itemType","itemName","stockQuantity","checkStatus","refList","join","alternativeItem","remark","includeEmpty","colNumber","border","top","left","bottom","right","wrapText","commit","topCoords","filter","c","side","toUpperCase","layer","bottomCoords","writeCoordinateSheet","outBuffer","writeBuffer","Blob","type","sheetName","coords","sheet","rowCount","coord","partType","x","y","angle","rotation","columns","col","width","GeneratedPreviewPanel","initialItems","onSave","items","setItems","useState","editingCell","setEditingCell","handleCellChange","field","newItems","Number","jsxs","Button","onClick","confirm","RotateCcw","toast","Save","Error","trim","invalidItems","idx","blob","url","window","URL","createObjectURL","a","document","createElement","href","download","body","appendChild","click","removeChild","revokeObjectURL","errorMessage","message","Download","Table","TableHeader","TableRow","TableHead","TableBody","map","TableCell","Input","onChange","e","target","readOnly","placeholder","rows","displayName","TabsContext","React.createContext","Tabs","defaultValue","controlledValue","onValueChange","uncontrolledValue","setUncontrolledValue","React.useState","handleValueChange","React.useCallback","newValue","Provider","TabsList","TabsTrigger","context","React.useContext","isActive","role","TabsContent","CoordinatePreviewPanel","CoordinateTable","data","colSpan","title","partName","readFileAsText","file","Promise","resolve","reject","reader","FileReader","onload","result","match","XLSX.read","firstSheetName","SheetNames","worksheet","Sheets","range","XLSX.utils","decode_range","R","s","r","cells","C","min","cell_address","encode_cell","push","String","err","textDecoder","TextDecoder","ArrayBuffer","decode","onerror","readAsArrayBuffer","BomCoordinateIntegrated","viewMode","setViewMode","step","setStep","fileInfo","setFileInfo","bomFile","coordFile","metadata","setMetadata","artworkManager","productionManager","employees","setEmployees","currentUser","setCurrentUser","loading","setLoading","uploading","setUploading","openProductionManager","setOpenProductionManager","processedResult","setProcessedResult","dragActive","setDragActive","savedBoards","setSavedBoards","loadingBoards","setLoadingBoards","selectedBoardForView","setSelectedBoardForView","uploadedFilePaths","setUploadedFilePaths","setErrorMessage","progress","setProgress","loadingText","setLoadingText","supabase","createClient","useEffect","empData","from","select","order","user","auth","getUser","email","userData","eq","single","split","prev","loadData","boards","ascending","boardsWithCount","all","board","count","head","id","item_count","loadSavedBoards","replace","today","dateStr","getFullYear","slice","getMonth","padStart","getDate","handleDrag","useCallback","preventDefault","stopPropagation","handleDrop","dataTransfer","files","handleFileSelect","handleRemoveFile","bomUrl","coordUrl","handleReset","marginTop","marginBottom","Plus","Eye","Card","CardContent","Loader2","Package","board_name","created_at","toLocaleDateString","year","month","day","boardId","bomError","coordError","boardData","convertedBOMItems","lineNumber","line_number","item_type","item_name","specification","set_count","total_quantity","stock_quantity","check_status","ref_list","alternative_item","convertedCoords","part_name","part_type","x_coordinate","y_coordinate","cadDrawingId","processedData","handleViewSavedBOM","handleDownloadSavedBOM","Fragment","AlertCircle","onDragEnter","onDragLeave","onDragOver","onDrop","getElementById","accept","X","Label","disabled","height","Popover","open","onOpenChange","PopoverTrigger","find","emp","ChevronsUpDown","PopoverContent","Command","CommandInput","CommandList","CommandEmpty","CommandGroup","CommandItem","onSelect","Check","parseInt","timer","textTimer","estimatedDuration","updateInterval","incrementPerStep","setInterval","oldProgress","randomFactor","random","current","timestamp","now","sanitizeFileName","fileName","lastDotIndex","lastIndexOf","extension","safeBomFileName","safeCoordFileName","bomPath","coordPath","bomResult","storage","upload","cacheControl","upsert","coordResult","remove","bomUrlData","createSignedUrl","coordUrlData","signedUrl","processBOMWithAI","resultWithId","msg","scrollTo","behavior","startsWith","existingBoard","checkError","code","newBoard","boardError","insert","bomFileUrl","coordFileUrl","existingRawFile","updateRawError","update","bom_file_url","coordinate_file_url","bom_file_name","coordinate_file_name","uploaded_by","insertRawError","cad_drawing_id","deleteError","delete","insertError","deleteCoordError","insertCoordError","parseFloat","learningError","processed_bom_data","processed_coordinate_data","cad_program_type","toISOString","setTimeout"],"mappings":"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","x_google_ignoreList":[0]}