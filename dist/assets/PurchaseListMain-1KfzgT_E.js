const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FastPurchaseTable-CChe_ipP.js","assets/index-DURjiRtV.js","assets/index-CRgX5jue.css","assets/index-DgYLmkP3.js","assets/PurchaseDetailModal-BvNLZqrd.js","assets/helpers-CWDchwQL.js","assets/input-DR32zq7D.js","assets/dialog-BOugK96I.js","assets/format-NvEY_HGk.js","assets/circle-check-big-BuVt1Qd6.js","assets/eye-Dp6JYudF.js","assets/chevron-down-Diu47hfg.js","assets/popover-D9IINcEu.js","assets/calendar-DMR6LWZU.js","assets/package-BOBhWn-U.js","assets/credit-card-XsL0DUkR.js","assets/trash-2-CdcJ6l8T.js","assets/plus-W5OE0DJN.js","assets/save-CLakp-ew.js","assets/PurchaseItemsModal-BteMtjj6.js","assets/table-DQEiv4SB.js"])))=>i.map(i=>d[i]);
import{r as l,a as xe,l as de,j as e,_ as Ne,u as Ie,e as ke,B as qe}from"./index-DURjiRtV.js";import{t as se,B as Ae}from"./index-DgYLmkP3.js";import{I as ue}from"./input-DR32zq7D.js";import{S as ve,a as be,b as je,c as Se,d as te}from"./select-BOfJLo8C.js";import{C as Be}from"./combobox-BBNZEgcA.js";import{C as we,a as Ge,b as Le,c as De,S as Me}from"./card-D7c8b6xy.js";import{P as Ue}from"./plus-W5OE0DJN.js";import{F as Oe}from"./funnel-BIjdjqbv.js";import{P as Re}from"./package-BOBhWn-U.js";import"./chevron-down-Diu47hfg.js";import"./popover-D9IINcEu.js";const i={purchases:null,vendors:null,employees:null,lastFetch:0,userInfo:null,CACHE_DURATION:120*1e3},Ve=()=>{const[x,d]=l.useState([]),[f,q]=l.useState([]),[w,A]=l.useState([]),[F,z]=l.useState(!0),[ae,E]=l.useState([]),[O,Y]=l.useState(""),[P,B]=l.useState(""),[R,Z]=l.useState(""),v=xe(),G=l.useRef(!1);l.useEffect(()=>{(async()=>{if(G.current)return;G.current=!0,console.log("ðŸš€ [DEBUG] loadInitialData ì‹œìž‘");const y=Date.now(),I=i.lastFetch&&y-i.lastFetch<i.CACHE_DURATION;console.log("ðŸ“Š [DEBUG] ìºì‹œ ìƒíƒœ:",{cacheValid:I,lastFetch:i.lastFetch,timeSinceLastFetch:y-i.lastFetch,cacheHasData:!!(i.vendors&&i.employees&&i.userInfo)});try{if(I&&i.vendors&&i.employees&&i.userInfo)try{console.log("âœ… [DEBUG] ìºì‹œ ë°ì´í„° ì‚¬ìš©"),q(i.vendors),A(i.employees);const o=i.userInfo;if(o){let g=[];o.purchase_role&&(Array.isArray(o.purchase_role)?g=o.purchase_role.map(t=>String(t).trim()):g=String(o.purchase_role).split(",").map(_=>_.trim()).filter(_=>_.length>0)),E(g),Y(o.name||o.full_name||""),B(o.email||""),Z(o.id||"")}return}catch(o){de.error("ìºì‹œ ë°ì´í„° ì‚¬ìš© ì¤‘ ì˜¤ë¥˜",o),console.error("âŒ [DEBUG] ìºì‹œ ì˜¤ë¥˜:",o),i.purchases=null,i.vendors=null,i.employees=null,i.userInfo=null,i.lastFetch=0}console.log("ðŸ”„ [DEBUG] ë°ì´í„° ìƒˆë¡œ ë¡œë“œ");const[h,L,N]=await Promise.all([v.from("vendors").select("*"),v.from("employees").select("*"),v.auth.getUser()]);if(h.error)throw console.error("âŒ [DEBUG] ì—…ì²´ ë¡œë“œ ì‹¤íŒ¨:",h.error),h.error;const j=h.data||[];if(q(j),i.vendors=j,console.log("âœ… [DEBUG] ì—…ì²´ ë¡œë“œ ì™„ë£Œ:",j.length,"ê°œ"),L.error)throw console.error("âŒ [DEBUG] ì§ì› ë¡œë“œ ì‹¤íŒ¨:",L.error),L.error;const b=L.data||[];if(A(b),i.employees=b,console.log("âœ… [DEBUG] ì§ì› ë¡œë“œ ì™„ë£Œ:",b.length,"ê°œ"),N.data.user&&!N.error){console.log("ðŸ‘¤ [DEBUG] ì‚¬ìš©ìž ì •ë³´:",N.data.user.email);let o=null;if(N.data.user.email&&(o=(await v.from("employees").select("*").eq("email",N.data.user.email).maybeSingle()).data),o){i.userInfo=o;let g=[];o.purchase_role&&(Array.isArray(o.purchase_role)?g=o.purchase_role.map(t=>String(t).trim()):g=String(o.purchase_role).split(",").map(_=>_.trim()).filter(_=>_.length>0)),console.log("ðŸ‘¤ [DEBUG] ì‚¬ìš©ìž ê¶Œí•œ:",{name:o.name,email:o.email,roles:g}),E(g),Y(o.name||o.full_name||""),B(o.email||""),Z(o.id||"")}i.lastFetch=y}}catch(h){de.error("ì´ˆê¸° ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨",h),console.error("âŒ [DEBUG] ì´ˆê¸° ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:",h)}})()},[]);const D=l.useCallback(async T=>{console.log("ðŸ”„ [DEBUG] loadPurchases ì‹œìž‘ - forceRefresh:",T),z(!0);try{const y=Date.now(),I=i.lastFetch&&y-i.lastFetch<i.CACHE_DURATION;if(console.log("ðŸ“Š [DEBUG] ìºì‹œ í™•ì¸:",{forceRefresh:T,cacheValid:I,hasCachedData:!!i.purchases,cacheAge:y-i.lastFetch}),!T&&I&&i.purchases)try{console.log("âœ… [DEBUG] ìºì‹œëœ ë°œì£¼ ë°ì´í„° ì‚¬ìš©:",i.purchases.length,"ê±´"),d(i.purchases),z(!1);return}catch(t){de.error("ë°œì£¼ ë°ì´í„° ìºì‹œ ì‚¬ìš© ì¤‘ ì˜¤ë¥˜",t),console.error("âŒ [DEBUG] ìºì‹œ ì˜¤ë¥˜:",t),i.purchases=null,i.lastFetch=0}let h=w;if(h.length===0&&(h=i.employees||[],h.length===0)){const{data:t}=await v.from("employees").select("*");h=t||[]}const{data:{user:L},error:N}=await v.auth.getUser();if(N||!L){de.error("ì‚¬ìš©ìž ì¸ì¦ ì‹¤íŒ¨",N),se.error("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤."),z(!1);return}const j=new Date;j.setMonth(j.getMonth()-6),j.setHours(0,0,0,0),console.log("ðŸ“… [DEBUG] ìµœê·¼ 6ê°œì›” ë°ì´í„° ì¡°íšŒ:",{sixMonthsAgo:j.toISOString(),today:new Date().toISOString()});const{data:b,error:o}=await v.from("purchase_requests").select("*,vendors(vendor_name,vendor_payment_schedule),vendor_contacts(contact_name),purchase_request_items(*).order(line_number)").gte("request_date",j.toISOString()).order("request_date",{ascending:!1}).limit(500);if(o)throw console.error("âŒ [DEBUG] ë°œì£¼ ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨:",o),o;console.log("ðŸ“Š [DEBUG] ë°œì£¼ ë°ì´í„° ì¡°íšŒ ê²°ê³¼:",{dataCount:Array.isArray(b)?b.length:0,firstFewIds:Array.isArray(b)?b.slice(0,5).map(t=>({id:t.id,po_number:t.purchase_order_number,date:t.request_date})):[]});const g=(b||[]).map(t=>{const _=t.purchase_request_items?.[0]||{},V=h.find(M=>M.id===t.requester_id);return{id:Number(t.id),purchase_order_number:t.purchase_order_number,request_date:t.request_date,delivery_request_date:t.delivery_request_date,progress_type:t.progress_type,payment_completed_at:t.payment_completed_at,payment_category:t.payment_category,currency:t.currency,request_type:t.request_type,vendor:t.vendors||null,vendor_name:t.vendors?.vendor_name||"",vendor_payment_schedule:t.vendors?.vendor_payment_schedule||"",vendor_contacts:t.vendor_contacts||[],requester_id:t.requester_id,requester_name:t.requester_name,requester_full_name:V?.full_name||V?.name||t.requester_name||"",item_name:_.item_name||"",specification:_.specification||"",quantity:Number(_.quantity)||0,unit_price_value:Number(_.unit_price_value)||0,amount_value:Number(_.amount_value)||0,remark:_.remark||"",project_vendor:t.project_vendor,sales_order_number:t.sales_order_number,project_item:t.project_item,line_number:Number(_.line_number)||1,contact_name:t.vendor_contacts?.contact_name||"",middle_manager_status:t.middle_manager_status,final_manager_status:t.final_manager_status,is_received:!!t.is_received,received_at:t.received_at,is_payment_completed:!!t.is_payment_completed,is_po_download:!!t.is_po_download,link:_.link,items:t.purchase_request_items||[],total_amount:t.purchase_request_items?.reduce((M,Q)=>M+(Number(Q.amount_value)||0),0)||0,purchase_status:t.purchase_status||"pending"}});console.log("âœ… [DEBUG] ë°œì£¼ ë°ì´í„° ì²˜ë¦¬ ì™„ë£Œ:",{processedCount:g.length,sampleData:g.slice(0,3).map(t=>({id:t.id,po:t.purchase_order_number,requester:t.requester_name,date:t.request_date}))}),d(g),i.purchases=g,i.lastFetch=y,console.log("âœ… [DEBUG] ìºì‹œ ì—…ë°ì´íŠ¸ ì™„ë£Œ")}catch(y){de.error("ë°œì£¼ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨",y),console.error("âŒ [DEBUG] ë°œì£¼ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:",y),se.error("ë°œì£¼ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")}finally{z(!1)}},[w]);return l.useEffect(()=>{console.log("ðŸš€ [DEBUG] usePurchaseData ì²« ë¡œë“œ"),D()},[D]),{purchases:x,vendors:f,employees:w,loading:F,currentUserRoles:ae,currentUserName:O,currentUserEmail:P,currentUserId:R,refreshPurchases:D}};function $e(x,d=500){const[f,q]=l.useState(x);return l.useEffect(()=>{const w=setTimeout(()=>{q(x)},d);return()=>{clearTimeout(w)}},[x,d]),f}const Fe=["ì •í¬ì›…"],u=new Map,_e=100,ze=(x,d,f,q,w)=>{const A=xe(),[F,z]=l.useState("pending"),[ae,E]=l.useState(""),[O,Y]=l.useState(""),[P,B]=l.useState(""),[R,Z]=l.useState(""),[v,G]=l.useState(""),[D,T]=l.useState(""),[y,I]=l.useState(""),[h,L]=l.useState(""),N=new Date().getFullYear(),j=new Date(N,0,1).toISOString().split("T")[0],b=new Date().toISOString().split("T")[0],[o,g]=l.useState(j),[t,_]=l.useState(b),V=$e(ae,300),M=d?.includes("app_admin");d?.includes("final_approver"),d?.includes("middle_manager");const Q=d?.includes("purchase_manager"),W=d?.includes("raw_material_manager")||d?.includes("consumable_manager")||d?.includes("purchase_manager"),X=l.useMemo(()=>!d||d.length===0?1:Q?2:d.some(r=>["middle_manager","final_approver","app_admin","ceo"].includes(r))?3:1,[d,Q]),ee=l.useCallback(r=>{if(!f)return"all";if(r==="purchase")return W||M?"all":f;switch(X){case 1:return r==="done"?"all":f;case 2:return r==="done"?"all":f;case 3:return"all";default:return f}},[f,X,W,M]);l.useEffect(()=>{if(!f)return;const r=ee(F);B(r)},[F,f,X,ee]);const H=l.useMemo(()=>{console.log("ðŸ” [Filter] 1ë‹¨ê³„ ê¶Œí•œë³„ í•„í„°ë§ ì‹œìž‘:",{purchasesCount:x.length,currentUserRoles:d,currentUserName:f});try{const r=`visible_${x.length}_${d.join(",")}`;if(u.has(r))return console.log("ðŸ“¦ [Filter] ìºì‹œì—ì„œ ê°€ì ¸ì˜´"),u.get(r);let a;if(d.includes("purchase_manager")||d.includes("app_admin")?a=x:a=x.filter(s=>!Fe.includes(s.requester_name)),console.log("âœ… [Filter] ê¶Œí•œë³„ í•„í„°ë§ ì™„ë£Œ:",{originalCount:x.length,filteredCount:a.length}),u.size>=_e){const s=u.keys().next().value;u.delete(s)}return u.set(r,a),a}catch(r){return console.error("í•„í„°ë§ ì¤‘ ì˜¤ë¥˜:",r),u.clear(),d.includes("purchase_manager")||d.includes("app_admin")?x:x.filter(a=>!Fe.includes(a.requester_name))}},[x,d]),$=l.useMemo(()=>{const r=`date_${H.length}_${o}_${t}`;if(u.has(r))return u.get(r);const a=H.filter(s=>{const c=s.request_date?s.request_date.split("T")[0]:"",U=!o||c>=o,p=!t||c<=t;return U&&p});if(u.size>=_e){const s=u.keys().next().value;u.delete(s)}return u.set(r,a),a},[H,o,t]),K=l.useMemo(()=>{const r=`tab_${$.length}_${F}`;if(u.has(r))return u.get(r);if(F==="pending"){console.log("ðŸ” [PENDING TAB DEBUG] ì „ì²´ ë°ì´í„° ìƒíƒœ:",{totalCount:$.length,sampleData:$.slice(0,5).map(p=>({id:p.id,po_number:p.purchase_order_number,middle_status:p.middle_manager_status,final_status:p.final_manager_status,requester:p.requester_name,middle_type:typeof p.middle_manager_status,final_type:typeof p.final_manager_status}))});const s=$.map(p=>({middle:p.middle_manager_status,final:p.final_manager_status})),c=[...new Set(s.map(p=>p.middle))],U=[...new Set(s.map(p=>p.final))];console.log("ðŸ” [PENDING TAB DEBUG] ê³ ìœ  ìƒíƒœê°’ë“¤:",{uniqueMiddleStatuses:c,uniqueFinalStatuses:U})}const a=$.filter(s=>{let c=!1;switch(F){case"pending":const U=["pending","ëŒ€ê¸°","",null,void 0].includes(s.middle_manager_status),p=["pending","ëŒ€ê¸°","",null,void 0].includes(s.final_manager_status),he=s.middle_manager_status==="rejected",fe=s.final_manager_status==="rejected";return he||fe?!1:(c=U||p,c&&console.log("ðŸ” [PENDING DEBUG] ìŠ¹ì¸ëŒ€ê¸° í•­ëª© ë°œê²¬:",{id:s.id,po_number:s.purchase_order_number,middle_status:s.middle_manager_status,final_status:s.final_manager_status,middlePending:U,finalPending:p,matches:c}),c);case"purchase":{const oe=s.payment_category==="êµ¬ë§¤ ìš”ì²­",ie=!s.is_payment_completed,ce=(s.progress_type||"").includes("ì„ ì§„í–‰"),ye=(s.progress_type||"").includes("ì¼ë°˜"),m=s.final_manager_status==="approved";return!oe||!ie?c=!1:c=ce||ye&&m,c}case"receipt":{const oe=!s.is_received,ie=(s.progress_type||"").includes("ì„ ì§„í–‰"),ce=s.final_manager_status==="approved";return c=oe&&(ie||ce),c}case"done":return c=!0,c;default:return!0}});if(u.size>=_e){const s=u.keys().next().value;u.delete(s)}return u.set(r,a),a},[$,F]),re=l.useMemo(()=>{const r=`employee_${K.length}_${P}`;if(u.has(r))return u.get(r);let a;if(P&&P!=="all"&&P!=="ì „ì²´"?a=K.filter(s=>s.requester_name===P):a=K,u.size>=_e){const s=u.keys().next().value;u.delete(s)}return u.set(r,a),a},[K,P]),me=l.useMemo(()=>O?re.filter(r=>r.vendor_name===O):re,[re,O]),ne=l.useMemo(()=>{let r=me;if(R){const a=R.trim().toLowerCase();r=r.filter(s=>s.purchase_order_number?.toLowerCase().includes(a))}if(v){const a=v.trim().toLowerCase();r=r.filter(s=>s.items&&s.items.length>0?s.items.some(c=>c.item_name?.toLowerCase().includes(a)):!1)}if(D){const a=D.trim().toLowerCase();r=r.filter(s=>s.items&&s.items.length>0?s.items.some(c=>c.specification?.toLowerCase().includes(a)):!1)}if(y&&y!=="all"&&(r=r.filter(a=>{switch(y){case"pending":return!a.final_manager_status||a.final_manager_status==="pending"||a.final_manager_status==="ëŒ€ê¸°";case"approved":return a.final_manager_status==="approved";case"rejected":return a.final_manager_status==="rejected"||a.middle_manager_status==="rejected";default:return!0}})),h){const a=h.trim().toLowerCase();r=r.filter(s=>s.items&&s.items.length>0?s.items.some(c=>c.remark?.toLowerCase().includes(a)):!1)}return r},[me,R,v,D,y,h]),n=l.useMemo(()=>{if(!V)return ne;const r=V.trim().toLowerCase();return ne.filter(a=>a.purchase_order_number?.toLowerCase().includes(r)||a.vendor_name?.toLowerCase().includes(r)||a.requester_name?.toLowerCase().includes(r)||a.project_vendor?.toLowerCase().includes(r)?!0:a.items&&a.items.length>0?a.items.some(s=>s.item_name&&s.item_name.toLowerCase().includes(r)||s.specification&&s.specification.toLowerCase().includes(r)):!1)},[ne,V]),C=l.useMemo(()=>{const r=[...n].sort((a,s)=>{const c=a.request_date?new Date(a.request_date).getTime():0;return(s.request_date?new Date(s.request_date).getTime():0)-c});return console.log("âœ… [Filter] ìµœì¢… í•„í„°ë§ ì™„ë£Œ:",{activeTab:F,searchFilteredCount:n.length,finalCount:r.length,firstFewResults:r.slice(0,3).map(a=>({id:a.id,po:a.purchase_order_number,requester:a.requester_name,date:a.request_date}))}),r},[n,F]),Pe=l.useMemo(()=>{const a=H.filter(m=>{const S=m.request_date?m.request_date.split("T")[0]:"",k=!o||S>=o,J=!t||S<=t;return k&&J}),s=m=>new Set(m.map(S=>S.purchase_order_number)).size,c=m=>{if(m==="purchase")return W||M?a:a.filter(k=>k.requester_name===f);const S=ee(m);return S==="all"||S==="ì „ì²´"?a:a.filter(k=>k.requester_name===S)},U=c("pending"),p=c("purchase"),he=c("receipt"),fe=c("done"),oe=U.filter(m=>{const S=["pending","ëŒ€ê¸°","",null,void 0].includes(m.middle_manager_status),k=["pending","ëŒ€ê¸°","",null,void 0].includes(m.final_manager_status),J=m.middle_manager_status==="rejected",ge=m.final_manager_status==="rejected";return J||ge?!1:S||k}),ie=p.filter(m=>{const S=m.payment_category==="êµ¬ë§¤ ìš”ì²­",k=!m.is_payment_completed;if(!S||!k)return!1;const J=(m.progress_type||"").includes("ì„ ì§„í–‰"),ge=(m.progress_type||"").includes("ì¼ë°˜"),Te=m.final_manager_status==="approved";return J||ge&&Te}),ce=he.filter(m=>{const S=!m.is_received,k=(m.progress_type||"").includes("ì„ ì§„í–‰"),J=m.final_manager_status==="approved";return S&&(k||J)});return{pending:s(oe),purchase:s(ie),receipt:s(ce),done:s(fe)}},[H,o,t,X,f,ee,W,M]),pe=l.useRef(!1);l.useEffect(()=>{pe.current||(pe.current=!0,(async()=>{const{data:{user:r}}=await A.auth.getUser();if(!r)return;const{data:a}=await A.from("user_preferences").select("period_start, period_end").eq("user_id",r.id).single();if(a){const s=a.period_start?new Date(a.period_start).toISOString().split("T")[0]:j,c=a.period_end?new Date(a.period_end).toISOString().split("T")[0]:b;g(s),_(c)}})())},[]);const le=l.useRef(void 0);return l.useEffect(()=>{if(pe.current)return le.current&&clearTimeout(le.current),le.current=setTimeout(async()=>{const{data:{user:r}}=await A.auth.getUser();r&&(!o||!t||await A.from("user_preferences").upsert({user_id:r.id,period_start:o,period_end:t,updated_at:new Date().toISOString()}))},1e3),()=>{le.current&&clearTimeout(le.current)}},[o,t]),{activeTab:F,searchTerm:ae,vendorFilter:O,dateFromFilter:o,dateToFilter:t,selectedEmployee:P,purchaseNumberFilter:R,itemNameFilter:v,specificationFilter:D,approvalStatusFilter:y,remarkFilter:h,setActiveTab:z,setSearchTerm:E,setVendorFilter:Y,setDateFromFilter:g,setDateToFilter:_,setSelectedEmployee:B,setPurchaseNumberFilter:Z,setItemNameFilter:G,setSpecificationFilter:T,setApprovalStatusFilter:I,setRemarkFilter:L,filteredPurchases:C,tabCounts:Pe}},He=l.lazy(()=>Ne(()=>import("./FastPurchaseTable-CChe_ipP.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]))),Ce=l.memo(()=>e.jsx("div",{className:"p-4 space-y-4",children:[...Array(5)].map((x,d)=>e.jsxs("div",{className:"flex space-x-4 animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"})]},d))}));Ce.displayName="TableSkeleton";const Ee=l.memo(({purchases:x,activeTab:d,currentUserRoles:f,onRefresh:q,onPaymentComplete:w,onReceiptComplete:A})=>e.jsx(l.Suspense,{fallback:e.jsx(Ce,{}),children:e.jsx(He,{purchases:x,activeTab:d,currentUserRoles:f,onRefresh:q,onPaymentComplete:w,onReceiptComplete:A})}));Ee.displayName="LazyPurchaseTable";const Ke=l.lazy(()=>Ne(()=>import("./PurchaseItemsModal-BteMtjj6.js"),__vite__mapDeps([19,1,2,7,6,20,3,8,17,18,16]))),Je=[{key:"pending",label:"ìŠ¹ì¸ëŒ€ê¸°"},{key:"purchase",label:"êµ¬ë§¤ í˜„í™©"},{key:"receipt",label:"ìž…ê³  í˜„í™©"},{key:"done",label:"ì „ì²´ í•­ëª©"}];function lt({onEmailToggle:x,showEmailButton:d=!0}){const f=Ie(),q=ke(),w=xe(),[A,F]=l.useState(null),[z,ae]=l.useState({}),[E,O]=l.useState(null),[Y,P]=l.useState(!1),{purchases:B,vendors:R,employees:Z,loading:v,currentUserRoles:G,currentUserName:D,refreshPurchases:T}=Ve(),y=G?.includes("app_admin");l.useEffect(()=>{console.log("ðŸ“Š [PurchaseListMain] ë°œì£¼ ë°ì´í„° ìƒíƒœ:",{purchasesCount:B.length,loading:v,currentUserName:D,currentUserRoles:G,firstFewPurchases:B.slice(0,3).map(n=>({id:n.id,po:n.purchase_order_number,requester:n.requester_name,date:n.request_date}))})},[B,v,D,G]);const{activeTab:I,searchTerm:h,vendorFilter:L,dateFromFilter:N,dateToFilter:j,selectedEmployee:b,purchaseNumberFilter:o,itemNameFilter:g,approvalStatusFilter:t,setActiveTab:_,setSearchTerm:V,setVendorFilter:M,setDateFromFilter:Q,setDateToFilter:W,setSelectedEmployee:X,setPurchaseNumberFilter:ee,setItemNameFilter:H,setApprovalStatusFilter:$,filteredPurchases:K,tabCounts:re}=ze(B,G,D);l.useEffect(()=>{new URLSearchParams(q.search).get("tab")==="purchase"&&_("purchase")},[q.search,_]);const me=async n=>{try{const{error:C}=await w.from("purchase_requests").update({is_received:!0,received_at:new Date().toISOString()}).eq("id",n);if(C)throw C;await w.from("purchase_request_items").update({is_received:!0,delivery_status:"received"}).eq("purchase_request_id",n),se.success("ìž…ê³ ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤."),await T()}catch{se.error("ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},ne=async n=>{try{const{error:C}=await w.from("purchase_requests").update({is_payment_completed:!0,payment_completed_at:new Date().toISOString()}).eq("id",n);if(C)throw C;await w.from("purchase_request_items").update({is_payment_completed:!0}).eq("purchase_request_id",n),se.success("êµ¬ë§¤ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤."),await T()}catch{se.error("ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}};return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"ë°œì£¼ìš”ì²­ ê´€ë¦¬"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"ë°œì£¼ìš”ì²­ì„œë¥¼ ê´€ë¦¬í•˜ê³  ìŠ¹ì¸ ì²˜ë¦¬ë¥¼ í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤"})]}),e.jsxs(qe,{onClick:()=>f("/purchase/new"),className:"mt-4 sm:mt-0 bg-hansl-500 hover:bg-hansl-600",children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"}),"ìƒˆ ë°œì£¼ìš”ì²­ ìž‘ì„±"]})]}),e.jsxs(we,{className:"mb-4 border border-gray-200",children:[e.jsx(Ge,{className:"bg-white border-b border-gray-200 py-3",children:e.jsxs(Le,{className:"flex items-center text-gray-900 text-sm font-medium",children:[e.jsx(Oe,{className:"w-4 h-4 mr-2"}),"ê²€ìƒ‰ í•„í„°"]})}),e.jsx(De,{className:"py-3",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"ì‹œìž‘ì¼"}),e.jsx(ue,{type:"date",value:N,onChange:n=>Q(n.target.value),className:"text-sm h-9"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"ì¢…ë£Œì¼"}),e.jsx(ue,{type:"date",value:j,onChange:n=>W(n.target.value),className:"text-sm h-9"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"ìš”ì²­ìž"}),e.jsx(Be,{value:b||"all",onValueChange:n=>{X(n)},options:[{value:"all",label:"ì „ì²´"},...Z.filter(n=>n.name&&n.name.trim()!=="").sort((n,C)=>(n.name||"").localeCompare(C.name||"")).map(n=>({value:n.name||"",label:`${n.name}${n.name===D?" (ë‚˜)":""}`}))],placeholder:b==="all"?"ì „ì²´":b||"ì„ íƒ",searchPlaceholder:"ì§ì› ì´ë¦„ ê²€ìƒ‰...",emptyText:"ì¼ì¹˜í•˜ëŠ” ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤",className:"text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"ì—…ì²´"}),e.jsxs(ve,{value:L||"all",onValueChange:n=>M(n==="all"?"":n),children:[e.jsx(be,{className:"h-9 text-sm",children:e.jsx(je,{placeholder:"ì „ì²´"})}),e.jsxs(Se,{children:[e.jsx(te,{value:"all",children:"ì „ì²´"}),R.map(n=>e.jsx(te,{value:n.vendor_name,children:n.vendor_name},n.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"ë°œì£¼ë²ˆí˜¸"}),e.jsx(ue,{placeholder:"ë²ˆí˜¸",value:o,onChange:n=>ee(n.target.value),className:"text-sm h-9"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"í’ˆëª…"}),e.jsx(ue,{placeholder:"í’ˆëª…",value:g,onChange:n=>H(n.target.value),className:"text-sm h-9"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"ìŠ¹ì¸ìƒíƒœ"}),e.jsxs(ve,{value:t||"all",onValueChange:n=>$(n==="all"?"":n),children:[e.jsx(be,{className:"h-9 text-sm",children:e.jsx(je,{placeholder:"ì „ì²´"})}),e.jsxs(Se,{children:[e.jsx(te,{value:"all",children:"ì „ì²´"}),e.jsx(te,{value:"pending",children:"ëŒ€ê¸°"}),e.jsx(te,{value:"approved",children:"ìŠ¹ì¸"}),e.jsx(te,{value:"rejected",children:"ë°˜ë ¤"})]})]})]}),e.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"í†µí•©ê²€ìƒ‰"}),e.jsxs("div",{className:"relative",children:[e.jsx(Me,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 w-3 h-3 text-gray-400"}),e.jsx(ue,{placeholder:"ê²€ìƒ‰...",value:h,onChange:n=>V(n.target.value),className:"pl-7 text-sm h-9"})]})]})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:space-x-1 space-y-1 sm:space-y-0 bg-gray-50 p-1 rounded-lg border border-gray-200",children:Je.map(n=>e.jsxs("button",{onClick:()=>_(n.key),className:`flex-1 flex items-center justify-center space-x-2 py-2.5 px-3 sm:px-4 rounded-md text-xs sm:text-sm font-medium transition-colors ${I===n.key?"text-hansl-600 bg-white shadow-sm border border-gray-200":"text-gray-600 bg-transparent hover:text-gray-900 hover:bg-white/50"}`,children:[e.jsx("span",{className:"whitespace-nowrap",children:n.label}),e.jsx(Ae,{variant:"secondary",className:`text-[10px] sm:text-xs ${I===n.key?"bg-hansl-50 text-hansl-700":"bg-gray-100 text-gray-600"}`,children:re[n.key]})]},n.key))}),e.jsx(we,{className:"overflow-hidden border border-gray-200",children:e.jsx(De,{className:"p-0",children:v?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-hansl-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"ë¡œë”© ì¤‘..."})]}):K.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Re,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"ë°œì£¼ìš”ì²­ì„œê°€ ì—†ìŠµë‹ˆë‹¤"}),e.jsx("p",{className:"text-gray-600",children:"ìƒˆë¡œìš´ ë°œì£¼ìš”ì²­ì„œë¥¼ ìž‘ì„±í•´ë³´ì„¸ìš”."})]}):e.jsx(Ee,{purchases:K,activeTab:I,currentUserRoles:G,onRefresh:T,onPaymentComplete:ne,onReceiptComplete:me})})})]}),E&&e.jsx(l.Suspense,{fallback:e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"})}),children:e.jsx(Ke,{isOpen:Y,onClose:()=>{P(!1),O(null)},purchase:{...E,vendor_name:E.vendor_name||"",project_vendor:E.project_vendor||"",sales_order_number:E.sales_order_number||"",project_item:E.project_item||""},isAdmin:y||!1,onUpdate:T})})]})}export{lt as default};
//# sourceMappingURL=PurchaseListMain-1KfzgT_E.js.map
