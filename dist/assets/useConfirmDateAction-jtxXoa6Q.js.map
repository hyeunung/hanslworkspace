{"version":3,"file":"useConfirmDateAction-jtxXoa6Q.js","sources":["../../src/components/ui/date-picker-popover.tsx","../../src/hooks/useConfirmDateAction.ts"],"sourcesContent":["import { useState } from 'react'\nimport { Calendar } from '@/components/ui/calendar'\nimport { Button } from '@/components/ui/button'\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from '@/components/ui/popover'\nimport { Calendar as CalendarIcon } from 'lucide-react'\nimport { format } from 'date-fns'\nimport { ko } from 'date-fns/locale'\nimport { cn } from '@/lib/utils'\n\ninterface DatePickerPopoverProps {\n  children: React.ReactNode\n  onDateSelect: (date: Date) => void\n  disabled?: boolean\n  placeholder?: string\n  align?: \"center\" | \"start\" | \"end\"\n  side?: \"top\" | \"right\" | \"bottom\" | \"left\"\n}\n\nexport function DatePickerPopover({\n  children,\n  onDateSelect,\n  disabled = false,\n  placeholder = \"ÎÇ†ÏßúÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî\",\n  align = \"center\",\n  side = \"bottom\"\n}: DatePickerPopoverProps) {\n  const [open, setOpen] = useState(false)\n\n  const handleDateSelect = (date: Date | undefined) => {\n    console.log('üìÖ DatePickerPopover handleDateSelect Ìò∏Ï∂ú:', { \n      date, \n      isToday: date && new Date().toDateString() === date.toDateString(),\n      dateString: date?.toDateString(),\n      todayString: new Date().toDateString()\n    });\n    if (date) {\n      console.log('‚úÖ ÎÇ†Ïßú ÏÑ†ÌÉùÎê®, onDateSelect Ìò∏Ï∂ú ÏòàÏ†ï');\n      onDateSelect(date)\n      setOpen(false) // ÎÇ†Ïßú ÏÑ†ÌÉù ÌõÑ ÌåùÏò§Î≤Ñ Îã´Í∏∞\n      console.log('üîö DatePickerPopover Ï≤òÎ¶¨ ÏôÑÎ£å');\n    } else {\n      console.log('‚ùå ÎÇ†ÏßúÍ∞Ä undefinedÏûÑ');\n    }\n  }\n\n  return (\n    <Popover open={open} onOpenChange={setOpen}>\n      <PopoverTrigger asChild disabled={disabled}>\n        {children}\n      </PopoverTrigger>\n      <PopoverContent \n        className=\"w-auto p-0 border-gray-200 shadow-lg\" \n        align={align}\n        side={side}\n        sideOffset={8}\n      >\n        <div className=\"bg-white business-radius-card p-2\">\n          <div className=\"mb-2 px-1\">\n            <div className=\"modal-label text-gray-600 text-center\">\n              {placeholder}\n            </div>\n          </div>\n          <Calendar\n            mode=\"single\"\n            selected={undefined}\n            onSelect={(date) => {\n              console.log('üóìÔ∏è Calendar onSelect ÏßÅÏ†ë Ìò∏Ï∂ú:', { \n                date, \n                isToday: date && new Date().toDateString() === date.toDateString(),\n                dateValue: date?.getTime(),\n                todayValue: new Date().getTime()\n              });\n              handleDateSelect(date);\n            }}\n            locale={ko}\n            initialFocus\n            className=\"compact-calendar\"\n            disabled={false}\n            fromDate={new Date('2020-01-01')}\n            toDate={new Date('2030-12-31')}\n            defaultMonth={new Date()}\n            modifiers={{\n              today: new Date()\n            }}\n            modifiersClassNames={{\n              today: \"bg-blue-500 text-white font-semibold cursor-pointer hover:bg-blue-600 rounded-md\"\n            }}\n          />\n        </div>\n      </PopoverContent>\n    </Popover>\n  )\n}","import { useCallback } from 'react'\nimport { createClient } from '@/lib/supabase/client'\nimport { toast } from 'sonner'\nimport { logger } from '@/lib/logger'\n\nexport interface ConfirmDateActionConfig {\n  field: 'statement_received' | 'actual_received'\n  confirmMessage: {\n    confirm: string\n    cancel: string\n  }\n  successMessage: {\n    confirm: string\n    cancel: string\n  }\n  completedText: string\n  waitingText: string\n}\n\nexport interface UseConfirmDateActionProps {\n  config: ConfirmDateActionConfig\n  currentUserName: string | null\n  canPerformAction: boolean\n  onUpdate?: () => void\n  onOptimisticUpdate?: (params: {\n    itemId: number\n    selectedDate?: Date\n    action: 'confirm' | 'cancel'\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n    }\n  }) => void\n}\n\nexport function useConfirmDateAction({\n  config,\n  currentUserName,\n  canPerformAction,\n  onUpdate,\n  onOptimisticUpdate\n}: UseConfirmDateActionProps) {\n  const supabase = createClient()\n\n  const handleConfirm = useCallback(async (\n    itemId: number | string,\n    selectedDate: Date,\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n    }\n  ) => {\n    \n    if (!canPerformAction) {\n      console.log(`‚ùå Í∂åÌïú ÏóÜÏùå`, { canPerformAction, currentUserName })\n      logger.warn(`‚ùå Í∂åÌïú ÏóÜÏùå`, { canPerformAction })\n      toast.error(`${config.field === 'statement_received' ? 'Í±∞ÎûòÎ™ÖÏÑ∏ÏÑú' : 'ÏûÖÍ≥†'} ÌôïÏù∏ Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§.`)\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      logger.error('‚ùå ÏûòÎ™ªÎêú ID', { itemId, numericId })\n      toast.error('Ïú†Ìö®ÌïòÏßÄ ÏïäÏùÄ Ìï≠Î™© ID ÏûÖÎãàÎã§.')\n      return\n    }\n\n    // ÌôïÏù∏ Îã§Ïù¥ÏñºÎ°úÍ∑∏ ÌëúÏãú\n    if (itemInfo) {\n      const confirmMessage = `ÌíàÎ™©Î™Ö: ${itemInfo.item_name || '-'}\nÍ∑úÍ≤©: ${itemInfo.specification || '-'}\nÏàòÎüâ: ${itemInfo.quantity?.toLocaleString() || 0}\nÎã®Í∞Ä: ‚Ç©${itemInfo.unit_price_value?.toLocaleString() || 0}\nÌï©Í≥Ñ: ‚Ç©${itemInfo.amount_value?.toLocaleString() || 0}\nÎπÑÍ≥†: ${itemInfo.remark || '-'}\n\n${config.confirmMessage.confirm}`\n      \n      if (!window.confirm(confirmMessage)) {\n        return\n      }\n    }\n\n    try {\n      let updateData: any\n\n      if (config.field === 'statement_received') {\n        updateData = {\n          is_statement_received: true,\n          statement_received_date: selectedDate.toISOString(),\n          statement_received_by_name: currentUserName\n        }\n      } else if (config.field === 'actual_received') {\n        updateData = {\n          actual_received_date: selectedDate.toISOString()\n        }\n      }\n\n      console.log('üìù ÏóÖÎç∞Ïù¥Ìä∏Ìï† Îç∞Ïù¥ÌÑ∞:', updateData)\n\n      const { data, error } = await supabase\n        .from('purchase_request_items')\n        .update(updateData)\n        .eq('id', numericId)\n        .select()\n\n      console.log('üìù DB ÏóÖÎç∞Ïù¥Ìä∏ Í≤∞Í≥º:', { data, error })\n\n      if (error) {\n        console.error('‚ùå DB ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®:', error)\n        logger.error('‚ùå DB ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®', error)\n        throw error\n      }\n\n      console.log('‚úÖ DB ÏóÖÎç∞Ïù¥Ìä∏ ÏÑ±Í≥µ:', data)\n      logger.info('‚úÖ DB ÏóÖÎç∞Ïù¥Ìä∏ ÏÑ±Í≥µ')\n\n      if (onOptimisticUpdate) {\n        onOptimisticUpdate({\n          itemId: numericId,\n          selectedDate,\n          action: 'confirm',\n          itemInfo\n        })\n      }\n\n      // Í∞ïÏ†ú ÏÉàÎ°úÍ≥†Ïπ®ÏùÑ ÏúÑÌï¥ onUpdate Ìò∏Ï∂ú\n      if (onUpdate) {\n        onUpdate()\n      }\n      \n      toast.success(config.successMessage.confirm)\n    } catch (error) {\n      logger.error('‚ùå Ï†ÑÏ≤¥ Ï≤òÎ¶¨ Ïã§Ìå®', error)\n      toast.error(`${config.field === 'statement_received' ? 'Í±∞ÎûòÎ™ÖÏÑ∏ÏÑú' : 'ÏûÖÍ≥†'} ÌôïÏù∏ Ï≤òÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.`)\n    }\n  }, [config, currentUserName, canPerformAction, onUpdate, onOptimisticUpdate, supabase])\n\n  const handleCancel = useCallback(async (\n    itemId: number | string,\n    itemInfo?: {\n      item_name?: string\n      specification?: string\n      quantity?: number\n      unit_price_value?: number\n      amount_value?: number\n      remark?: string\n    }\n  ) => {\n    if (!canPerformAction) {\n      console.log(`‚ùå Ï∑®ÏÜå Í∂åÌïú ÏóÜÏùå`, { canPerformAction, currentUserName })\n      toast.error(`${config.field === 'statement_received' ? 'Í±∞ÎûòÎ™ÖÏÑ∏ÏÑú' : 'ÏûÖÍ≥†'} ÌôïÏù∏ Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§.`)\n      return\n    }\n\n    const itemIdStr = String(itemId)\n    const numericId = typeof itemId === 'number' ? itemId : Number(itemId)\n\n    if (Number.isNaN(numericId)) {\n      toast.error('Ïú†Ìö®ÌïòÏßÄ ÏïäÏùÄ Ìï≠Î™© ID ÏûÖÎãàÎã§.')\n      return\n    }\n\n    // ÌôïÏù∏ Îã§Ïù¥ÏñºÎ°úÍ∑∏ ÌëúÏãú\n    if (itemInfo) {\n      const confirmMessage = `ÌíàÎ™©Î™Ö: ${itemInfo.item_name || '-'}\nÍ∑úÍ≤©: ${itemInfo.specification || '-'}\nÏàòÎüâ: ${itemInfo.quantity?.toLocaleString() || 0}\nÎã®Í∞Ä: ‚Ç©${itemInfo.unit_price_value?.toLocaleString() || 0}\nÌï©Í≥Ñ: ‚Ç©${itemInfo.amount_value?.toLocaleString() || 0}\nÎπÑÍ≥†: ${itemInfo.remark || '-'}\n\n${config.confirmMessage.cancel}`\n      \n      if (!window.confirm(confirmMessage)) {\n        return\n      }\n    }\n\n    try {\n      console.log(`üîÑ ${config.field} ÌôïÏù∏ Ï∑®ÏÜå ÏãúÏûë`, { \n        itemId, \n        itemName: itemInfo?.item_name \n      })\n\n      let updateData: any\n\n      if (config.field === 'statement_received') {\n        updateData = {\n          is_statement_received: false,\n          statement_received_date: null,\n          statement_received_by_name: null\n        }\n      } else if (config.field === 'actual_received') {\n        updateData = {\n          actual_received_date: null\n        }\n      }\n\n      console.log('üîÑ Ï∑®ÏÜå ÏóÖÎç∞Ïù¥Ìä∏Ìï† Îç∞Ïù¥ÌÑ∞:', updateData)\n\n      const { data, error } = await supabase\n        .from('purchase_request_items')\n        .update(updateData)\n        .eq('id', numericId)\n        .select()\n\n      console.log('üîÑ Ï∑®ÏÜå DB ÏóÖÎç∞Ïù¥Ìä∏ Í≤∞Í≥º:', { data, error })\n\n      if (error) {\n        console.error('‚ùå Ï∑®ÏÜå DB ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®:', error)\n        logger.error('‚ùå DB ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®', error)\n        throw error\n      }\n\n      console.log(`‚úÖ ${config.field} ÌôïÏù∏ Ï∑®ÏÜå ÏÑ±Í≥µ:`, data)\n      logger.info(`‚úÖ ${config.field} ÌôïÏù∏ Ï∑®ÏÜå ÏÑ±Í≥µ`)\n\n      if (onOptimisticUpdate) {\n        onOptimisticUpdate({\n          itemId: numericId,\n          action: 'cancel',\n          itemInfo\n        })\n      }\n\n      // Í∞ïÏ†ú ÏÉàÎ°úÍ≥†Ïπ®ÏùÑ ÏúÑÌï¥ onUpdate Ìò∏Ï∂ú\n      if (onUpdate) {\n        onUpdate()\n      }\n      \n      toast.success(config.successMessage.cancel)\n    } catch (error) {\n      logger.error(`‚ùå ${config.field} ÌôïÏù∏ Ï∑®ÏÜå Ïã§Ìå®`, error)\n      toast.error(`${config.field === 'statement_received' ? 'Í±∞ÎûòÎ™ÖÏÑ∏ÏÑú' : 'ÏûÖÍ≥†'} ÌôïÏù∏ Ï∑®ÏÜå Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.`)\n    }\n  }, [config, canPerformAction, onUpdate, onOptimisticUpdate, supabase])\n\n  const isCompleted = useCallback((item: any) => {\n    if (config.field === 'statement_received') {\n      return item.is_statement_received\n    } else if (config.field === 'actual_received') {\n      return !!item.actual_received_date\n    }\n    return false\n  }, [config.field])\n\n  const getCompletedDate = useCallback((item: any) => {\n    if (config.field === 'statement_received') {\n      return item.statement_received_date\n    } else if (config.field === 'actual_received') {\n      return item.actual_received_date\n    }\n    return null\n  }, [config.field])\n\n  const getCompletedByName = useCallback((item: any) => {\n    if (config.field === 'statement_received') {\n      return item.statement_received_by_name\n    } else if (config.field === 'actual_received') {\n      // ÏûÖÍ≥†ÏôÑÎ£åÎäî Ï≤òÎ¶¨Ïûê Ï†ïÎ≥¥Î•º Í∏∞Î°ùÌïòÏßÄ ÏïäÏùå\n      return null\n    }\n    return null\n  }, [config.field])\n\n  return {\n    config,\n    handleConfirm,\n    handleCancel,\n    isCompleted,\n    getCompletedDate,\n    getCompletedByName\n  }\n}"],"names":["DatePickerPopover","children","onDateSelect","disabled","placeholder","align","side","open","setOpen","useState","jsxs","Popover","onOpenChange","jsx","PopoverTrigger","asChild","PopoverContent","className","sideOffset","Calendar","mode","selected","onSelect","date","handleDateSelect","locale","ko","initialFocus","fromDate","Date","toDate","defaultMonth","modifiers","today","modifiersClassNames","useConfirmDateAction","config","currentUserName","canPerformAction","onUpdate","onOptimisticUpdate","supabase","createClient","handleConfirm","useCallback","async","itemId","selectedDate","itemInfo","logger","warn","toast","error","field","numericId","Number","isNaN","confirmMessage","item_name","specification","quantity","toLocaleString","unit_price_value","amount_value","remark","confirm","window","updateData","is_statement_received","statement_received_date","toISOString","statement_received_by_name","actual_received_date","data","from","update","eq","select","info","action","success","successMessage","handleCancel","cancel","isCompleted","item","getCompletedDate","getCompletedByName"],"mappings":"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"}