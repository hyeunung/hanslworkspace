{"version":3,"mappings":"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","names":["Link2","createLucideIcon","d","key","x1","x2","y1","y2","TabsContext","React.createContext","Tabs","React.forwardRef","className","defaultValue","value","controlledValue","onValueChange","props","ref","uncontrolledValue","setUncontrolledValue","React.useState","handleValueChange","React.useCallback","newValue","jsx","Provider","children","cn","displayName","TabsList","TabsTrigger","onClick","context","React.useContext","Error","isActive","type","role","e","TabsContent","forceMount","hidden","async","generateBOMExcelFromTemplate","bomItems","topCoordinates","bottomCoordinates","metadata","workbook","ExcelJS","Workbook","response","fetch","ok","buffer","arrayBuffer","xlsx","load","error","creator","modified","Date","bomSheet","worksheets","cleanBoardName","boardName","trim","replace","sanitizeWorksheetName","name","substring","getCell","artworkManager","productionManager","mergeCells","infoCell","productionQuantity","alignment","horizontal","vertical","font","bold","dataStartRow","border","top","style","left","bottom","right","prevItemType","forEach","item","index","rowNum","row","getRow","currentType","itemType","itemName","setCount","itemNameUpper","toUpperCase","isMisap","remark","includes","refList","centerAlignCols","baseFont","size","family","charset","color","argb","isLastOfGroup","length","isFirstOfGroup","col","cell","cellBorder","wrapText","refLength","estimatedLines","Math","ceil","height","max","commit","fillBOMSheet","removeWorksheetIfExists","ws","getWorksheet","removeWorksheet","id","fillCoordinateSheet","outBuffer","writeBuffer","Blob","sheetName","coordinates","sheet","prevType","coord","isLastRow","partName","refDes","layer","locationX","locationY","rotation","partNameUpper","isCoordMisap","downloadExcelBlob","blob","filename","window","handle","showSaveFilePicker","suggestedName","types","description","accept","writable","createWritable","write","close","err","url","URL","createObjectURL","link","document","createElement","href","download","body","appendChild","click","removeChild","revokeObjectURL","learningDataCache","MANUAL_INPUT_REQUIRED","FIXED_MAPPINGS","TLP3107","ADS7828E_250","TPD2EUSB30DRTR_OPEN","TPD2EUSB30DRTR","C10PF_50V_1005_OPEN","C10PF_1005_OPEN","R0_1005_OPEN","W25Q16JVSSIQ_OPEN","R1K_1005_OPEN_1903","R10K_1005_OPEN_1903","R10K_1005_OPEN","R10_1005","R15_1005","MGL_G1_AA_MASTER_SENSOR_POGO","loadLearningData","typeMappingRes","partNameMappingRes","partNameConflictsRes","typeSortOrderRes","misapKeywordsRes","Promise","all","status","typeMapping","json","partNameMapping","partNameConflicts","typeSortOrder","misapKeywords","mergedPartNameMapping","mergedTypeMapping","supabase","createClient","data","learningRecords","dbError","from","select","not","order","ascending","dbPartNameCount","dbTypeCount","record","bomData","processed_bom_data","Array","isArray","originalPart","originalFootprint","part","footprint","isUserModified","combo","dbLoadError","manualInputRequired","Utils","normalizePartName","toLowerCase","normalizePartFootprintCombo","normPart","test","isManualInputRequired","learningData","fpUpper","some","m","mPart","mFp","split","this","footprintUpper","partUpper","kw","parseRefs","refStr","refs","parts","map","r","filter","rangeMatch","match","prefix","start","parseInt","end","i","push","isTP","normalizeType","typeVal","normalized","SENSOR","CONNECTGOR","CONNECTO4R","CONNECTROR","mapPartName","isNew","mapType","Object","entries","mapTypeFromFootprint","footprintKeys","mappedPartName","normalizeGroupedBomToken","token","buildGroupedBomNormalization","partRaw","footprintRaw","raw","fpRaw","refPrefix","isOpen","p","f","endsWith","detectOpenFromTokens","extractMetricSize","voltage","v","Boolean","find","extractVoltageToken","segments","s","valueSeg","partCandidates","footprintCandidates","fallbackStandardizedName","cap","valueRaw","num","unitLetter","displayValue","keyValue","normalizeCapValueForFootprintKey","unshift","normalizedPart","vSeg","sizeSeg","res","suffix","normalizeResValueForFootprintKey","tail","nc","uniq","arr","out","seen","Set","has","add","processBOMAndCoordinates","bomFile","coordFile","parsedBOM","file","Uint8Array","XLSX.read","Sheets","SheetNames","rows","XLSX.utils","sheet_to_json","header","items","headerRow","colMap","qty","comment","itemKeywords","refKeywords","qtyKeywords","partKeywords","commentKeywords","descriptionKeywords","footprintKeywords","min","rowStr","c","String","join","partExplicitFound","idx","val","refColumnFoundByKeyword","isRefPattern","trimmed","sampleRows","slice","colScores","maxCols","matchCount","totalCount","cellValue","score","maxScore","bestRefCol","indexOf","headerCellsLower","hasDesignatorHeader","hasGroupedFields","sampleRowsForDetect","itemNonEmptyCount","itemNumericCount","itemNumericRate","multiRefRate","currentItem","reference","startsWith","quantityStr","quantity","format","itemNum","additionalRefs","parseBOMFile","parsedCoord","lines","TextDecoder","decode","headerFound","x","y","line","lower","colLower","cols","parseFloat","parseCoordinateFile","normalizedCoord","coordMap","Map","set","manualRequiredCount","newPartCount","misapCount","lineNumber","norm","partForMatch","footprintForMatch","matched","fp","isManualRequired","isNewPart","found","mapping","extractTypeFromFootprint","pt","finalItemType","typeFromLearning","bomItem","totalQuantity","checkStatus","normRef","get","coordItem","delete","TYPE_GROUP_ORDER","guessTypeGroupForSort","checkIsMisap","nameUpper","sort","a","b","groupA","groupB","orderA","orderB","idxA","idxB","localeCompare","aMisap","sortCoordinates","coords","getGroup","t","summary","totalItems","TYPE_GROUP_ORDER_EXPORT","checkIsMisapExport","remarkUpper","sortBOMItems","guessTypeGroup","sortCoordinateItems","GeneratedPreviewPanel","forwardRef","initialItems","coordinatesProvided","onSave","onMergeStateChange","onBomChange","onDeleteRefs","setItems","useState","beforeMergeItems","setBeforeMergeItems","textareaRefs","useRef","useEffect","useLayoutEffect","values","current","textarea","newHeight","scrollHeight","totalSetCount","reduce","sum","coordRefSet","useMemo","refSet","hasMissingCoordinate","measureTextWidth","text","fontSize","ctx","getContext","measureText","width","maxTypeWidth","maxNameWidth","allRefs","flatMap","refWidthPerItem","maxRefWidth","maxNoWidth","handleDownload","unfilledItems","confirm","excelMetadata","topCoords","bottomCoords","sortedItems","sortedTopCoords","sortedBottomCoords","today","dateStr","getFullYear","toString","getMonth","padStart","getDate","toast","success","errorMessage","message","handleReset","handleMerge","grouped","uniqueKey","mergeCount","groupItems","info","mergedItems","first","mergedRefs","mergedSetCount","mergedTotalQty","handleSave","useImperativeHandle","isMerged","handleCellChange","field","newItems","Number","handleDeleteRow","getRowClassName","jsxs","Table","tableLayout","TableHeader","TableRow","TableHead","TableBody","TableCell","onChange","target","placeholder","title","readOnly","stockQuantity","contentEditable","suppressContentEditableWarning","lineHeight","wordWrap","overflowWrap","whiteSpace","onBlur","currentTarget","textContent","alternativeItem","Button","variant","Trash2","CoordinatePreviewPanel","onCoordinatesChange","onDeleteRef","localCoordinates","setLocalCoordinates","normalizeLayer","useCallback","handleUpdateCoord","coordIndex","patch","prev","next","handleDeleteCoord","_","bomRefSet","manualRefSet","topRows","bottomRows","CoordinateTable","onUpdate","onDelete","defaultLayerForTable","minWidth","colSpan","rowIndex","isMissingBom","isMissingInBom","inputMode","step","isFinite","disabled","BomDetailModal","boardId","onClose","loading","setLoading","boardData","setBoardData","downloading","setDownloading","loadBoardData","board","boardError","eq","single","bomError","coordError","convertedBOMItems","line_number","item_type","item_name","set_count","total_quantity","stock_quantity","check_status","ref_list","alternative_item","is_manual_required","is_new_part","original_part","original_footprint","part_type","part_name","side","x_coordinate","y_coordinate","angle","board_name","artwork_manager","production_manager","production_quantity","created_at","Dialog","open","onOpenChange","DialogContent","maxWidth","showCloseButton","DialogHeader","DialogTitle","sortedBomItems","fileName","Loader2","Download","BOMTable","showType","display","Badge","toFixed","BomCoordinateIntegrated","viewMode","setViewMode","setStep","fileInfo","setFileInfo","setMetadata","employees","setEmployees","currentUser","setCurrentUser","uploading","setUploading","openArtworkManager","setOpenArtworkManager","openProductionManager","setOpenProductionManager","processedResult","setProcessedResult","dragActive","setDragActive","savedBoards","setSavedBoards","editingBoardId","setEditingBoardId","loadingBoards","setLoadingBoards","uploadedFilePaths","setUploadedFilePaths","setErrorMessage","progress","setProgress","loadingText","setLoadingText","setIsMerged","deletingBoardId","setDeletingBoardId","detailModalBoardId","setDetailModalBoardId","isDetailModalOpen","setIsDetailModalOpen","isSaving","setIsSaving","skipTempDataLoad","setSkipTempDataLoad","mismatchCount","missingInCoord","missingInBom","processedData","bomRefs","coordRefs","hasMergeableItems","count","previewPanelRef","currentUserRoles","useAuth","isAdmin","normalizeName","canDeleteBoard","inspectorRaw","myName","myId","inspectorNameById","emp","getTempStorageKey","userId","clearTempData","user","auth","getUser","localStorage","removeItem","empData","email","userData","skipIfEmpty","saved","getItem","tempData","JSON","parse","savedAt","getTime","restoredResult","loadTempData","loadData","toISOString","setItem","stringify","saveTempData","saveTemp","boards","loadSavedBoards","handleDrag","preventDefault","stopPropagation","handleDrop","dataTransfer","files","handleFileSelect","handleRemoveFile","bomUrl","coordUrl","handleCoordinatesChange","nextCoordinates","handleDeleteRefs","normalizedToDelete","prevBom","prevCoords","prevTop","prevBottom","normalizeRef","nextCoords","nextTop","nextBottom","nextBom","refsInRow","remaining","nextSetCount","nextTotalQty","renumberedBom","it","handleDeleteRef","marginTop","marginBottom","setTimeout","Plus","Eye","Card","CardContent","Package","boardInfo","isDataMissing","specification","convertedCoords","cadDrawingId","isEditMode","handleLoadPendingBoard","toLocaleDateString","year","month","day","round","handleDownloadSavedBOM","targetBoard","bomItemsError","placementsError","rawFilesData","bom_file_url","bomPath","storage","remove","decodeURIComponent","coordinate_file_url","coordPath","storageError","rawFilesError","cadError","handleDeleteSavedBOM","Fragment","AlertCircle","onDragEnter","onDragLeave","onDragOver","onDrop","getElementById","X","Label","Input","Popover","PopoverTrigger","asChild","ChevronsUpDown","PopoverContent","Command","CommandInput","CommandList","CommandEmpty","CommandGroup","CommandItem","onSelect","Check","timer","textTimer","estimatedDuration","updateInterval","incrementPerStep","setInterval","oldProgress","randomFactor","random","timestamp","now","sanitizeFileName","lastDotIndex","lastIndexOf","extension","bomResult","upload","cacheControl","upsert","coordResult","bomUrlData","createSignedUrl","coordUrlData","signedUrl","resultWithId","resolve","msg","scrollTo","behavior","Progress","RotateCcw","Save","artworkManagerName","saveStatus","finalProductionManager","updatedRows","updateError","update","saveBoardName","newBoard","insert","afterInsertRow","afterInsertReadError","updateExistingError","bomFileUrl","coordFileUrl","existingRawFile","updateRawError","bom_file_name","coordinate_file_name","uploaded_by","insertRawError","cad_drawing_id","deleteError","insertError","deleteCoordError","insertCoordError","learningError","processed_coordinate_data","cad_program_type","resetLearningDataCache","__vitePreload","then","v7Generator","__VITE_PRELOAD__","updatedBomItems","refToItemMap","updatedCoordinates","refKey","bomInfo"],"ignoreList":[0],"sources":["../../node_modules/lucide-react/dist/esm/icons/link-2.js","../../src/components/ui/tabs.tsx","../../src/utils/excel-generator.ts","../../src/utils/v7-generator.ts","../../src/components/bom-coordinate/GeneratedPreviewPanel.tsx","../../src/components/bom-coordinate/CoordinatePreviewPanel.tsx","../../src/components/bom-coordinate/BomDetailModal.tsx","../../src/components/bom-coordinate/BomCoordinateIntegrated.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.541.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M9 17H7A5 5 0 0 1 7 7h2\", key: \"8i5ue5\" }],\n  [\"path\", { d: \"M15 7h2a5 5 0 1 1 0 10h-2\", key: \"1b9ql8\" }],\n  [\"line\", { x1: \"8\", x2: \"16\", y1: \"12\", y2: \"12\", key: \"1jonct\" }]\n];\nconst Link2 = createLucideIcon(\"link-2\", __iconNode);\n\nexport { __iconNode, Link2 as default };\n//# sourceMappingURL=link-2.js.map\n","import * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\n\nconst TabsContext = React.createContext<{\n  value: string\n  onValueChange: (value: string) => void\n} | null>(null)\n\nconst Tabs = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & {\n    defaultValue?: string\n    value?: string\n    onValueChange?: (value: string) => void\n  }\n>(({ className, defaultValue, value: controlledValue, onValueChange, ...props }, ref) => {\n  const [uncontrolledValue, setUncontrolledValue] = React.useState(defaultValue || \"\")\n  const value = controlledValue !== undefined ? controlledValue : uncontrolledValue\n  \n  const handleValueChange = React.useCallback(\n    (newValue: string) => {\n      if (onValueChange) {\n        onValueChange(newValue)\n      } else {\n        setUncontrolledValue(newValue)\n      }\n    },\n    [onValueChange]\n  )\n\n  return (\n    <TabsContext.Provider value={{ value, onValueChange: handleValueChange }}>\n      <div ref={ref} className={cn(\"\", className)} {...props} />\n    </TabsContext.Provider>\n  )\n})\nTabs.displayName = \"Tabs\"\n\nconst TabsList = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n      {...props}\n    />\n))\nTabsList.displayName = \"TabsList\"\n\nconst TabsTrigger = React.forwardRef<\n  HTMLButtonElement,\n  React.ButtonHTMLAttributes<HTMLButtonElement> & { value: string }\n>(({ className, value, onClick, ...props }, ref) => {\n  const context = React.useContext(TabsContext)\n  if (!context) throw new Error(\"TabsTrigger must be used within a Tabs component\")\n\n  const isActive = context.value === value\n\n  return (\n    <button\n      ref={ref}\n      type=\"button\"\n      role=\"tab\"\n      aria-selected={isActive}\n      data-state={isActive ? \"active\" : \"inactive\"}\n      className={cn(\n        \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n        className\n      )}\n      onClick={(e) => {\n        context.onValueChange(value)\n        onClick?.(e)\n      }}\n      {...props}\n    />\n  )\n})\nTabsTrigger.displayName = \"TabsTrigger\"\n\nconst TabsContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & { value: string; forceMount?: boolean }\n>(({ className, value, forceMount = false, ...props }, ref) => {\n  const context = React.useContext(TabsContext)\n  if (!context) throw new Error(\"TabsContent must be used within a Tabs component\")\n\n  const isActive = context.value === value\n  if (!isActive && !forceMount) return null\n\n  return (\n    <div\n      ref={ref}\n      role=\"tabpanel\"\n      aria-hidden={!isActive}\n      hidden={!isActive}\n      className={cn(\n        \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nTabsContent.displayName = \"TabsContent\"\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","/**\n * BOM    \n * \n * BOM_Template.xlsx   BOM   \n * \n * === BOM   ===\n * A2: Artwork \n * C2:  \n * H3:  ()\n * A7: \"  |  SET : \"\n * Row 8~: BOM \n *   - A:  (1, 2, 3...)\n *   - B: \n *   - C: \n *   - D: SET\n *   - E:  (  SET)\n *   - H: Ref\n *   - J: \n */\n\nimport ExcelJS from 'exceljs';\nimport type { BOMItem, CoordinateItem } from './v7-generator';\n\n// ============================================================\n//  \n// ============================================================\n\nexport interface ExcelMetadata {\n  boardName: string;\n  artworkManager: string;\n  productionManager: string;\n  productionQuantity: number;\n}\n\n// ============================================================\n//  :    \n// ============================================================\n\nexport async function generateBOMExcelFromTemplate(\n  bomItems: BOMItem[],\n  topCoordinates: CoordinateItem[],\n  bottomCoordinates: CoordinateItem[],\n  metadata: ExcelMetadata\n): Promise<Blob> {\n  const workbook = new ExcelJS.Workbook();\n  \n  try {\n    //  \n    const response = await fetch('/templates/BOM_Template.xlsx');\n    if (!response.ok) {\n      throw new Error('    .');\n    }\n    \n      const buffer = await response.arrayBuffer();\n      await workbook.xlsx.load(buffer);\n    console.log('   ');\n    \n  } catch (error) {\n    console.error('  :', error);\n    throw new Error('   .');\n  }\n\n  //  \n  workbook.creator = 'HANSL BOM System';\n  workbook.modified = new Date();\n\n  // BOM  \n  fillBOMSheet(workbook, bomItems, metadata);\n\n  //    (     )\n  const hasAnyCoordinates = (topCoordinates?.length || 0) > 0 || (bottomCoordinates?.length || 0) > 0;\n\n  const removeWorksheetIfExists = (name: string) => {\n    const ws = workbook.getWorksheet(name);\n    if (!ws) return;\n    // ExcelJS: removeWorksheet worksheet.id \n    workbook.removeWorksheet(ws.id);\n  };\n\n  if (!hasAnyCoordinates) {\n    // BOM-only :   TOP/BOTTOM  \n    removeWorksheetIfExists('TOP');\n    removeWorksheetIfExists('BOTTOM');\n  } else {\n    //      (          )\n    fillCoordinateSheet(workbook, 'TOP', topCoordinates || []);\n    fillCoordinateSheet(workbook, 'BOTTOM', bottomCoordinates || []);\n  }\n\n  // Blob \n  const outBuffer = await workbook.xlsx.writeBuffer();\n  return new Blob([outBuffer], { \n    type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' \n  });\n}\n\n// ============================================================\n// BOM  \n// ============================================================\n\nfunction fillBOMSheet(\n  workbook: ExcelJS.Workbook, \n  bomItems: BOMItem[], \n  metadata: ExcelMetadata\n) {\n  //    (BOM )\n  const bomSheet = workbook.worksheets[0];\n  if (!bomSheet) {\n    throw new Error('BOM    .');\n  }\n\n  //  _   (_YYMMDD)  (  )\n  //  :    \n  const cleanBoardName = (metadata.boardName || '')\n    .trim()\n    .replace(/_\\d{6}_$/, '')      // _YYMMDD_   \n    .replace(/_$/, '')            // _ \n    .replace(/_\\d{6}$/, '');            // _YYMMDD   (: _250722)\n  \n  // Excel     : * ? : \\ / [ ]\n  //  31 ,  apostrophe       \n  const sanitizeWorksheetName = (name: string) => {\n    const replaced = (name || '')\n      .replace(/[\\*\\?:\\\\\\/\\[\\]]/g, '_')\n      .replace(/^'+|'+$/g, '')\n      .trim();\n    return (replaced || 'BOM').substring(0, 31);\n  };\n\n  //    (, 31 )\n  if (cleanBoardName) {\n    bomSheet.name = sanitizeWorksheetName(cleanBoardName);\n  }\n\n  // ===   ===\n  // A2: Artwork \n  bomSheet.getCell('A2').value = metadata.artworkManager || '';\n  \n  // C2:  \n  bomSheet.getCell('C2').value = metadata.productionManager || '';\n  \n  // H3:  (, _ )\n  bomSheet.getCell('H3').value = cleanBoardName;\n  \n  // H5:  + \n  bomSheet.getCell('H5').value = `${cleanBoardName} `;\n\n  // === A7:  | SET :  (A7~J7 , _ ) ===\n  bomSheet.mergeCells('A7:J7');\n  const infoCell = bomSheet.getCell('A7');\n  infoCell.value = `${cleanBoardName}  |  SET : ${metadata.productionQuantity}`;\n  infoCell.alignment = { horizontal: 'center', vertical: 'middle' };\n  infoCell.font = { bold: true };\n\n  // === Row 8~: BOM  ===\n  const dataStartRow = 8;\n  \n  //  \n  const border: Partial<ExcelJS.Borders> = {\n    top: { style: 'thin' },\n    left: { style: 'thin' },\n    bottom: { style: 'thin' },\n    right: { style: 'thin' },\n  };\n  \n  //    (    )\n  let prevItemType = '';\n\n  bomItems.forEach((item, index) => {\n    const rowNum = dataStartRow + index;\n    const row = bomSheet.getRow(rowNum);\n    \n    // A:  (1, 2, 3...)\n    row.getCell('A').value = index + 1;\n    \n    // B:  (     ,  )\n    const currentType = item.itemType || '';\n    if (currentType !== prevItemType) {\n      row.getCell('B').value = currentType;\n      prevItemType = currentType;\n    } else {\n      row.getCell('B').value = ''; // \n    }\n    \n    // C: \n    row.getCell('C').value = item.itemName || '';\n    \n    // D: SET\n    row.getCell('D').value = item.setCount || 0;\n    \n    //    \n    // 1. remark '' \n    // 2.  _OPEN, OPEN_, _POGO, POGO_, _PAD, PAD_, _NC, NC_   _   \n    const itemNameUpper = (item.itemName || '').toUpperCase();\n    const remarkUpper = (item.remark || '').toUpperCase();\n    const isMisap = remarkUpper.includes('') || \n      itemNameUpper.includes('_OPEN') || itemNameUpper.includes('OPEN_') ||\n      itemNameUpper.includes('_POGO') || itemNameUpper.includes('POGO_') ||\n      itemNameUpper.includes('_PAD') || itemNameUpper.includes('PAD_') ||\n      itemNameUpper.includes('_NC') || itemNameUpper.includes('NC_');\n    \n    // E:  ( 0,    SET)\n    const setCount = item.setCount || 0;\n    row.getCell('E').value = isMisap ? 0 : metadata.productionQuantity * setCount;\n    \n    // F:  ()\n    \n    // G: CHECK\n    row.getCell('G').value = ' ';\n    \n    // H: Ref\n    row.getCell('H').value = item.refList || '';\n    \n    // I:  ()\n    \n    // J:  ( '' )\n    row.getCell('J').value = isMisap ? '' : (item.remark || '');\n\n    //         (A~J)\n    //   : A(1), D(4), E(5), G(7), J(10)\n    const centerAlignCols = [1, 4, 5, 7, 10];\n    \n    //   (theme   argb  )\n    const baseFont: Partial<ExcelJS.Font> = {\n      size: 11,\n      name: '',\n      family: 3,\n      charset: 129,\n      color: isMisap ? { argb: 'FFFF0000' } : { argb: 'FF000000' },\n    };\n    \n    //     (B  )\n    const nextItemType = index < bomItems.length - 1 ? (bomItems[index + 1].itemType || '') : '';\n    const isLastOfGroup = currentType !== nextItemType; //     \n    const isFirstOfGroup = currentType !== (index > 0 ? (bomItems[index - 1].itemType || '') : ''); //     \n    \n    for (let col = 1; col <= 10; col++) {\n      const cell = row.getCell(col);\n      \n      // B(col 2)       \n      let cellBorder = border;\n      if (col === 2) {\n        cellBorder = {\n                left: { style: 'thin' },\n          right: { style: 'thin' },\n          top: isFirstOfGroup ? { style: 'thin' } : undefined,\n          bottom: isLastOfGroup ? { style: 'thin' } : undefined,\n        };\n      }\n      \n      // style     (   )\n      cell.style = {\n        font: baseFont,\n        border: cellBorder,\n        alignment: {\n          vertical: 'middle',\n          horizontal: centerAlignCols.includes(col) ? 'center' : 'left',\n          wrapText: true,\n        },\n      };\n    }\n    \n    // H(Ref)       \n    const refText = item.refList || '';\n    const refLength = refText.length;\n    if (refLength > 50) {\n      // Ref       ( )\n      const estimatedLines = Math.ceil(refLength / 50);\n      row.height = Math.max(15, estimatedLines * 15);\n            }\n    \n    row.commit();\n  });\n}\n\n// ============================================================\n//   \n// ============================================================\n\nfunction fillCoordinateSheet(\n  workbook: ExcelJS.Workbook,\n  sheetName: 'TOP' | 'BOTTOM',\n  coordinates: CoordinateItem[]\n) {\n  if (coordinates.length === 0) return;\n\n  //  \n  const sheet = workbook.getWorksheet(sheetName);\n  if (!sheet) {\n    console.warn(`${sheetName}    .`);\n    return;\n  }\n\n  // Row 2   (Row 1 )\n  //      \n  let prevType = '';\n  \n  coordinates.forEach((coord, index) => {\n    const row = sheet.getRow(2 + index);\n    \n    const currentType = coord.type || '';\n    const nextType = index < coordinates.length - 1 ? (coordinates[index + 1].type || '') : '';\n    const isFirstOfGroup = currentType !== prevType; //    \n    const isLastRow = index === coordinates.length - 1; //   \n    \n    //    ,  \n    if (isFirstOfGroup) {\n      row.getCell('A').value = currentType;\n      prevType = currentType;\n    } else {\n      row.getCell('A').value = '';\n    }\n    \n    row.getCell('B').value = coord.partName || '';    // Type ()\n    row.getCell('C').value = coord.refDes || '';      // RefDes\n    row.getCell('D').value = coord.layer || sheetName; // Layer\n    row.getCell('E').value = coord.locationX || 0;    // LocationX\n    row.getCell('F').value = coord.locationY || 0;    // LocationY\n    row.getCell('G').value = coord.rotation || 0;     // Rotation\n    row.getCell('H').value = coord.remark || '';      // \n\n    //    (BOM  )\n    const partNameUpper = (coord.partName || '').toUpperCase();\n    const coordRemarkUpper = (coord.remark || '').toUpperCase();\n    const isCoordMisap = coordRemarkUpper.includes('') || \n      partNameUpper.includes('_OPEN') || partNameUpper.includes('OPEN_') ||\n      partNameUpper.includes('_POGO') || partNameUpper.includes('POGO_') ||\n      partNameUpper.includes('_PAD') || partNameUpper.includes('PAD_') ||\n      partNameUpper.includes('_NC') || partNameUpper.includes('NC_');\n\n    //    \n    for (let col = 1; col <= 8; col++) {\n      const cell = row.getCell(col);\n      cell.style = {\n        font: { \n          size: 10, \n          name: '',\n          color: isCoordMisap ? { argb: 'FFFF0000' } : { argb: 'FF000000' },\n        },\n        alignment: { vertical: 'middle', horizontal: col <= 2 ? 'left' : 'center' },\n        border: {\n          top: isFirstOfGroup ? { style: 'thick' } : undefined,\n          bottom: isLastRow ? { style: 'thick' } : undefined,\n          left: undefined,\n          right: undefined,\n        },\n      };\n    }\n\n    row.commit();\n  });\n}\n\n// ============================================================\n//   \n// ============================================================\n\nexport async function downloadExcelBlob(blob: Blob, filename: string) {\n  // showSaveFilePicker API    (Chrome/Edge )\n  if ('showSaveFilePicker' in window) {\n    try {\n      const handle = await (window as any).showSaveFilePicker({\n        suggestedName: filename,\n        types: [{\n          description: 'Excel ',\n          accept: { 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet': ['.xlsx'] },\n        }],\n      });\n      const writable = await handle.createWritable();\n      await writable.write(blob);\n      await writable.close();\n      return;\n    } catch (err: any) {\n      //   \n      if (err.name === 'AbortError') {\n        return;\n      }\n      //   fallback \n      console.warn('showSaveFilePicker , fallback :', err);\n    }\n  }\n  \n  // Fallback:   ( )\n  const url = URL.createObjectURL(blob);\n  const link = document.createElement('a');\n  link.href = url;\n  link.download = filename;\n  document.body.appendChild(link);\n  link.click();\n  document.body.removeChild(link);\n  URL.revokeObjectURL(url);\n}\n","/**\n * BOM     v7 ( )\n * \n * v7-engine.js   \n * BOM,       \n */\n\nimport * as XLSX from 'xlsx';\nimport { createClient } from '@/lib/supabase/client';\n\n// ============================================================\n//  \n// ============================================================\n\nexport interface BOMItem {\n  lineNumber: number;\n  itemType: string;           // \n  itemName: string;           // \n  setCount: number;           // SET\n  totalQuantity: number;      // \n  stockQuantity?: number;     // \n  checkStatus: string;        // CHECK\n  refList: string;            // Ref\n  alternativeItem?: string;   // \n  remark: string;             // \n  //  \n  isManualRequired: boolean;  //   \n  isNewPart: boolean;         //   ()\n  originalPart?: string;      //  Part\n  originalFootprint?: string; //  Footprint\n}\n\nexport interface CoordinateItem {\n  type: string;       // Type ()\n  partName: string;   // \n  refDes: string;     // RefDes\n  layer: string;      // Layer (TOP/BOTTOM)\n  locationX: number;  // LocationX\n  locationY: number;  // LocationY\n  rotation: number;   // Rotation\n  remark?: string;    //  ( )\n}\n\nexport interface ProcessedResult {\n  bomItems: BOMItem[];\n  topCoordinates: CoordinateItem[];\n  bottomCoordinates: CoordinateItem[];\n  summary: {\n    totalItems: number;\n    manualRequiredCount: number;\n    newPartCount: number;\n    misapCount: number;\n  };\n}\n\nexport interface LearningDataType {\n  typeMapping: Record<string, string>;      //   \n  partNameMapping: Record<string, string>;  // footprint  \n  partNameConflicts: Record<string, string[]>;\n  typeSortOrder: string[];\n  misapKeywords: string[];\n  manualInputRequired: string[];\n}\n\n// ============================================================\n//   \n// ============================================================\n\nlet learningDataCache: LearningDataType | null = null;\n\n//     (10V/16V/50V )\nconst MANUAL_INPUT_REQUIRED = [\n  '1u/1005|C1UF_1005',\n  '10u/1005|C10UF_1005',\n  '1u/1608|C1UF_1608',\n  '0.01u/1005|C0.01UF_1005',\n  '0.1u/1005|C0.1UF_1005',\n  '10uf/1608|C10UF_1608',\n  '10pf/1005|C10PF_1005',\n  '10nf/1005|C10NF_1005',\n  '220pf/1005|C220PF_1005',\n  '47u/2012|C47UF_16V_2012',\n  '2.2u/1005|C2.2UF_16V_1005',\n  '0.001u/1005|C0.001UF_1005',\n  '4.7u/1005|C4.7UF_1005',\n  '|R1K_1005_0.1%',\n];\n\n//   (  )\nconst FIXED_MAPPINGS: Record<string, string> = {\n  'FI-RE41S-HF': 'FI-RE41S-HF-R1500',\n  'FI-RE51S-HF': 'FI-RE51S-HF-R1500',\n  '24LC256ISN': '24LC256-I/SN',\n  'TLP3107': 'TLP3107',\n  'AD5175BRMZ-10-RL7': 'AD5175BRMZ-10-RL7',\n  'AD5175BCPZ-10-RL7': 'AD5175BCPZ-10-RL7',\n  'ADS7828E_250': 'ADS7828E/250',\n  'TPD2EUSB30DRTR_OPEN': 'TPD2EUSB30DRTR_OPEN',\n  'TPD2EUSB30DRTR': 'TPD2EUSB30DRTR',\n  'C10PF_50V_1005_OPEN': 'C10pF/50V_1005_OPEN',\n  'C10PF_1005_OPEN': 'C10PF/10V_1005_OPEN',\n  'R0_1005_OPEN': 'R0_1005_OPEN',\n  'C0.1UF_16V_1005_OPEN': 'C0.1uF/16V_1005_OPEN',\n  'W25Q16JVSSIQ_OPEN': 'W25Q16JVSSIQ_OPEN',\n  'R1K_1005_OPEN_1903': 'R1K_1005_OPEN',\n  'R10K_1005_OPEN_1903': 'R10K_1005_OPEN',\n  'R10K_1005_OPEN': 'R10K_1005_OPEN',\n  'R4.7K_1005': 'R4.7K_1005_1%',\n  'R10_1005': 'R10_1005_1%',\n  'R15_1005': 'R15_1005_1%',\n  'MAX3373EEKA+T_NEW': 'MAX3373EEKA+T',\n  'C0.1UF_16V_1005': 'C0.1uF/16V_1005',\n  'T47UF_16V-B': 'T47uF/16V \"B\"',\n  'SN65DP141RLJR_R-PWQFN-N38_RLJ': 'SN65DP141RLJR',\n  'TSM6963SD_TSSOP-8': 'TSM6963SD',\n  'SW-DJMM-12V': 'SW-DJMM-12V',\n  'BOI_C70_CUBE_Z-CAL_POGO': 'BOI_C70_CUBE_Z-CAL_POGO',\n  'MGL_G1_AA_MASTER_SENSOR_POGO': 'B2B',\n  'TPD2EUSB30DRTR/OPEN|TPD2EUSB30DRTR': 'TPD2EUSB30DRTR_OPEN',\n};\n\n// ============================================================\n//   \n// ============================================================\n\nexport async function loadLearningData(): Promise<LearningDataType> {\n  if (learningDataCache) {\n    return learningDataCache;\n  }\n\n  try {\n    console.log('    ...');\n    \n    // 1.  JSON  \n    const [\n      typeMappingRes,\n      partNameMappingRes,\n      partNameConflictsRes,\n      typeSortOrderRes,\n      misapKeywordsRes,\n    ] = await Promise.all([\n      fetch('/data/_.json'),\n      fetch('/data/_.json'),\n      fetch('/data/_.json'),\n      fetch('/data/_.json'),\n      fetch('/data/.json'),\n    ]);\n\n    //  \n    if (!typeMappingRes.ok) throw new Error(`_.json  : ${typeMappingRes.status}`);\n    if (!partNameMappingRes.ok) throw new Error(`_.json  : ${partNameMappingRes.status}`);\n    if (!partNameConflictsRes.ok) throw new Error(`_.json  : ${partNameConflictsRes.status}`);\n    if (!typeSortOrderRes.ok) throw new Error(`_.json  : ${typeSortOrderRes.status}`);\n    if (!misapKeywordsRes.ok) throw new Error(`.json  : ${misapKeywordsRes.status}`);\n\n    const typeMapping = await typeMappingRes.json();\n    const partNameMapping = await partNameMappingRes.json();\n    const partNameConflicts = await partNameConflictsRes.json();\n    const typeSortOrder = await typeSortOrderRes.json();\n    const misapKeywords = await misapKeywordsRes.json();\n\n    //    (  JSON  +  )\n    const mergedPartNameMapping = { ...partNameMapping, ...FIXED_MAPPINGS };\n    const mergedTypeMapping = { ...typeMapping };\n\n    // 2. DB        \n    try {\n      console.log(' DB    ...');\n      const supabase = createClient();\n      const { data: learningRecords, error: dbError } = await supabase\n        .from('ai_learning_records')\n        .select('processed_bom_data')\n        .not('processed_bom_data', 'is', null)\n        .order('created_at', { ascending: false }); //   \n\n      if (dbError) {\n        console.warn(' DB     (  ):', dbError);\n      } else if (learningRecords && learningRecords.length > 0) {\n        console.log(` ${learningRecords.length}   `);\n        \n        let dbPartNameCount = 0;\n        let dbTypeCount = 0;\n        \n        //     \n        for (const record of learningRecords) {\n          const bomData = record.processed_bom_data;\n          if (!Array.isArray(bomData)) continue;\n\n          for (const item of bomData) {\n            //     \n            if (!item.originalPart && !item.originalFootprint) continue;\n            \n            const part = (item.originalPart || '').trim();\n            const footprint = (item.originalFootprint || '').trim().toUpperCase();\n            const itemName = (item.itemName || '').trim();\n            const itemType = (item.itemType || '').trim();\n\n            //    (Footprint  )\n            //      \n            if (footprint && itemName && itemName !== '  (  )') {\n              //     (footprint itemName )\n              const isUserModified = itemName !== footprint && itemName.toUpperCase() !== footprint;\n              \n              // Part|Footprint  \n              if (part) {\n                const combo = `${part}|${footprint}`;\n                //     ,      \n                if (isUserModified || !mergedPartNameMapping[combo]) {\n                  mergedPartNameMapping[combo] = itemName;\n                  dbPartNameCount++;\n                }\n              }\n              \n              // Footprint \n              //     ,      \n              if (isUserModified || !mergedPartNameMapping[footprint]) {\n                mergedPartNameMapping[footprint] = itemName;\n                dbPartNameCount++;\n              }\n            }\n\n            //    (  )\n            //   JSON , DB    /\n            if (itemName && itemType && itemType !== ' ') {\n              if (!mergedTypeMapping[itemName] || mergedTypeMapping[itemName] !== itemType) {\n                mergedTypeMapping[itemName] = itemType;\n                dbTypeCount++;\n              }\n            }\n          }\n        }\n        \n        console.log(` DB     (: +${dbPartNameCount}, : +${dbTypeCount})`);\n      }\n    } catch (dbLoadError) {\n      console.warn(' DB      (  ):', dbLoadError);\n    }\n\n    learningDataCache = {\n      typeMapping: mergedTypeMapping,\n      partNameMapping: mergedPartNameMapping,\n      partNameConflicts,\n      typeSortOrder,\n      misapKeywords,\n      manualInputRequired: MANUAL_INPUT_REQUIRED,\n    };\n\n    console.log('    ');\n    return learningDataCache;\n  } catch (error) {\n    console.error('    :', error);\n    throw error;\n  }\n}\n\n// ============================================================\n//  \n// ============================================================\n\nconst Utils = {\n  //   (,  )\n  normalizePartName(partName: string): string {\n    if (!partName) return '';\n    return partName\n      .toLowerCase()\n      .replace(/[/\\s_-]/g, '')\n      .replace(/\"/g, '')\n      .trim();\n  },\n\n  // Part|Footprint  \n  normalizePartFootprintCombo(part: string, footprint: string): string {\n    let normPart = (part || '')\n      .toLowerCase()\n      .replace(/uf/g, 'u')\n      .replace(/pf/g, 'p')\n      .replace(/nf/g, 'n')\n      .replace(/\\s/g, '');\n    // Part  c  \n    if (/^c\\d/.test(normPart)) {\n      normPart = normPart.substring(1);\n    }\n    const normFp = (footprint || '').toUpperCase();\n    return `${normPart}|${normFp}`;\n  },\n\n  //     \n  isManualInputRequired(part: string, footprint: string, learningData: LearningDataType): boolean {\n    const fpUpper = (footprint || '').toUpperCase();\n    \n    return learningData.manualInputRequired.some(m => {\n      const [mPart, mFp] = m.split('|');\n      // Footprint \n      if (mFp && fpUpper === mFp.toUpperCase()) {\n        return true;\n      }\n      const combo = this.normalizePartFootprintCombo(part, footprint);\n      const normM = this.normalizePartFootprintCombo(mPart, mFp);\n      return combo === normM;\n    });\n  },\n\n  //    (footprint part  )\n  isMisap(footprint: string, part: string, learningData: LearningDataType): boolean {\n    const footprintUpper = (footprint || '').toUpperCase();\n    const partUpper = (part || '').toUpperCase();\n    \n    // footprint  part     \n    return learningData.misapKeywords.some(kw => \n      footprintUpper.includes(kw) || partUpper.includes(kw)\n    );\n  },\n\n  // Ref \n  parseRefs(refStr: string): string[] {\n    if (!refStr) return [];\n    const refs: string[] = [];\n    const parts = refStr.split(/[,.\\s]+/).map(r => r.trim()).filter(r => r.length > 0);\n    \n    for (const part of parts) {\n      if (/^[-_=]+$/.test(part)) continue;\n      \n      const rangeMatch = part.match(/^([A-Z]+)(\\d+)[-~]([A-Z]*)(\\d+)$/i);\n      if (rangeMatch) {\n        const prefix = rangeMatch[1];\n        const start = parseInt(rangeMatch[2]);\n        const end = parseInt(rangeMatch[4]);\n        for (let i = start; i <= end; i++) {\n          refs.push(prefix + i);\n        }\n      } else {\n        refs.push(part);\n      }\n    }\n    \n    return refs;\n  },\n\n  // TP \n  isTP(ref: string): boolean {\n    return /^TP/i.test(ref);\n  },\n\n  //  \n  normalizeType(typeVal: string): string {\n    if (!typeVal) return '';\n    const normalized = typeVal.trim();\n    \n    const typeMapping: Record<string, string> = {\n      'TP/DIP': 'TEST POINT/DIP',\n      'TP/SMD': 'TEST POINT/SMD',\n      'SENSOR': 'SENSOR(SMD)',\n      'PEM NUT': 'PEMNUT',\n      'BEAD(012)': 'BEAD(2012)',\n      'TEST POINT': 'TEST POINT/SMD',\n      'CONNECTGOR': 'CONNECTOR',\n      'CONNECTO4R': 'CONNECTOR',\n      'CONNECTROR': 'CONNECTOR',\n      'DIOODE(SMD)': 'DIODE(SMD)',\n      'X-TAL': 'X-TAL(SMD)',\n    };\n    \n    return typeMapping[normalized] || normalized;\n  },\n};\n\n// ============================================================\n// BOM \n// ============================================================\n\ninterface ParsedBOMItem {\n  quantity: number;\n  refs: string[];\n  part: string;\n  footprint: string;\n  format: 'item_no' | 'grouped_designator';\n}\n\nasync function parseBOMFile(file: File): Promise<ParsedBOMItem[]> {\n  const arrayBuffer = await file.arrayBuffer();\n  const data = new Uint8Array(arrayBuffer);\n  \n  const workbook = XLSX.read(data, { type: 'array' });\n  const sheet = workbook.Sheets[workbook.SheetNames[0]];\n  const rows = XLSX.utils.sheet_to_json<string[]>(sheet, { header: 1 });\n  \n  const items: ParsedBOMItem[] = [];\n  \n  //  \n  let headerRow = -1;\n  const colMap = { item: 0, ref: 1, qty: 2, part: 3, comment: -1, description: -1, footprint: -1 };\n  const itemKeywords = ['item', 'no', '#', 'line', 'ln'];\n  const refKeywords = ['reference', 'references', 'ref', 'refdes', 'designator', 'designators'];\n  const qtyKeywords = ['quantity', 'qty'];\n  const partKeywords = ['part', 'part number', 'value'];\n  const commentKeywords = ['comment'];\n  const descriptionKeywords = ['description', 'desc'];\n  const footprintKeywords = ['pcb footprint', 'footprint', 'package', 'partnumber'];\n  \n  for (let r = 0; r < Math.min(30, rows.length); r++) {\n    const row = rows[r];\n    if (!row) continue;\n    \n    const rowStr = row.map(c => String(c || '').toLowerCase()).join(' ');\n    if (refKeywords.some(kw => rowStr.includes(kw))) {\n      headerRow = r;\n      let partExplicitFound = false;\n      row.forEach((cell, idx) => {\n        const val = String(cell || '').toLowerCase().trim();\n        if (itemKeywords.some(kw => val === kw)) colMap.item = idx;\n        if (refKeywords.some(kw => val === kw)) colMap.ref = idx;\n        if (qtyKeywords.some(kw => val === kw)) colMap.qty = idx;\n        if (partKeywords.some(kw => val === kw)) {\n          colMap.part = idx;\n          partExplicitFound = true;\n        }\n        if (commentKeywords.some(kw => val === kw)) {\n          colMap.comment = idx;\n          // comment part/value     part \n          if (!partExplicitFound) colMap.part = idx;\n        }\n        if (descriptionKeywords.some(kw => val === kw)) {\n          colMap.description = idx;\n          // description part/value    , part comment   fallback\n          if (!partExplicitFound && colMap.comment < 0) colMap.part = idx;\n        }\n        if (footprintKeywords.some(kw => val === kw)) colMap.footprint = idx;\n      });\n      break;\n    }\n  }\n  \n  // 2:    REF     ,   \n  let refColumnFoundByKeyword = headerRow !== -1;\n  \n  if (headerRow === -1) {\n    console.warn('   .   REF  ...');\n    headerRow = 0; //    \n    refColumnFoundByKeyword = false;\n  }\n  \n  // REF :  1~3 +  (: R1, C2, U3, IC1, JP1 )\n  //  /   REF (: R1, R2, R3)\n  //    (: R1~R10, C1-C5)\n  const isRefPattern = (value: string): boolean => {\n    if (!value || typeof value !== 'string') return false;\n    const trimmed = value.trim();\n    if (!trimmed) return false;\n    \n    //  REF : A1, R12, IC3, JP1 \n    const singleRefPattern = /^[A-Z]{1,3}\\d+$/i;\n    //  REF : R1, R2, R3  R1 R2 R3\n    const multiRefPattern = /^[A-Z]{1,3}\\d+([,.\\s]+[A-Z]{1,3}\\d+)*$/i;\n    //  REF : R1~R10, C1-C5\n    const rangeRefPattern = /^[A-Z]{1,3}\\d+[-~][A-Z]*\\d+$/i;\n    \n    return singleRefPattern.test(trimmed) || multiRefPattern.test(trimmed) || rangeRefPattern.test(trimmed);\n  };\n  \n  // REF       \n  if (!refColumnFoundByKeyword || colMap.ref === 1) { //    \n    const sampleRows = rows.slice(headerRow + 1, Math.min(headerRow + 20, rows.length));\n    const colScores: number[] = [];\n    \n    //   REF    \n    const maxCols = Math.max(...sampleRows.map(r => (r ? r.length : 0)));\n    for (let col = 0; col < maxCols; col++) {\n      let matchCount = 0;\n      let totalCount = 0;\n      \n      for (const row of sampleRows) {\n        if (!row || col >= row.length) continue;\n        const cellValue = String(row[col] || '').trim();\n        if (!cellValue) continue;\n        \n        totalCount++;\n        if (isRefPattern(cellValue)) {\n          matchCount++;\n        }\n      }\n      \n      //    ( 3    )\n      const score = totalCount >= 3 ? matchCount / totalCount : 0;\n      colScores.push(score);\n    }\n    \n    //     REF  (60%   )\n    const maxScore = Math.max(...colScores);\n    if (maxScore >= 0.6) {\n      const bestRefCol = colScores.indexOf(maxScore);\n      console.log(`   :  ${bestRefCol}() REF  (: ${(maxScore * 100).toFixed(1)}%)`);\n      colMap.ref = bestRefCol;\n    } else {\n      console.warn('   REF   . (1) .');\n    }\n  }\n  \n  // BOM  : (A)  Item/No  vs (B) Designator  \n  const headerCellsLower = headerRow >= 0 ? (rows[headerRow] || []).map(c => String(c || '').toLowerCase().trim()) : [];\n  const hasDesignatorHeader = headerCellsLower.includes('designator') || headerCellsLower.includes('designators');\n  const hasGroupedFields = (colMap.comment >= 0 || colMap.description >= 0) && colMap.qty >= 0;\n  const sampleRowsForDetect = rows.slice(headerRow + 1, Math.min(headerRow + 21, rows.length));\n  const itemNonEmptyCount = colMap.item >= 0\n    ? sampleRowsForDetect.filter(r => r && String(r[colMap.item] || '').trim().length > 0).length\n    : 0;\n  const itemNumericCount = colMap.item >= 0\n    ? sampleRowsForDetect.filter(r => r && /^\\d+$/.test(String(r[colMap.item] || '').trim())).length\n    : 0;\n  const itemNumericRate = itemNonEmptyCount > 0 ? itemNumericCount / itemNonEmptyCount : 0;\n  const multiRefRate = colMap.ref >= 0\n    ? (sampleRowsForDetect.filter(r => {\n        const v = r && colMap.ref < r.length ? String(r[colMap.ref] || '') : '';\n        return v.includes(',') || v.includes(' ,');\n      }).length / Math.max(1, sampleRowsForDetect.length))\n    : 0;\n\n  const isGroupedDesignatorFormat =\n    hasGroupedFields &&\n    (hasDesignatorHeader || multiRefRate >= 0.2) &&\n    (itemNonEmptyCount === 0 || itemNumericRate < 0.3);\n\n  let currentItem: ParsedBOMItem | null = null;\n  \n  if (isGroupedDesignatorFormat) {\n    // ModeB:  row  1  (Designator REF list)\n    for (let r = headerRow + 1; r < rows.length; r++) {\n      const row = rows[r];\n      if (!row || row.length === 0) continue;\n\n      const reference = String(row[colMap.ref] || '').trim();\n      if (!reference) continue;\n      if (reference.startsWith('_')) continue;\n\n      const refs = Utils.parseRefs(reference).filter(ref => !Utils.isTP(ref));\n      if (refs.length === 0) continue;\n\n      const quantityStr = String(row[colMap.qty] || '').trim();\n      const qty = parseInt(quantityStr) || refs.length;\n\n      const comment = colMap.comment >= 0 ? String(row[colMap.comment] || '').trim() : '';\n      const description = colMap.description >= 0 ? String(row[colMap.description] || '').trim() : '';\n      const part = (comment || description || String(row[colMap.part] || '')).trim();\n      const footprint = colMap.footprint >= 0 ? String(row[colMap.footprint] || '').trim() : '';\n\n      items.push({\n        quantity: qty,\n        refs,\n        part,\n        footprint: footprint || part,\n        format: 'grouped_designator',\n      });\n    }\n  } else {\n    // ModeA:  Item/No  (  )\n    for (let r = headerRow + 1; r < rows.length; r++) {\n      const row = rows[r];\n      if (!row || row.length === 0) continue;\n\n      const itemNum = String(row[colMap.item] || '').trim();\n      const reference = String(row[colMap.ref] || '').trim();\n      const quantity = String(row[colMap.qty] || '').trim();\n      const part = String(row[colMap.part] || '').trim();\n      const footprint = colMap.footprint >= 0 ? String(row[colMap.footprint] || '').trim() : '';\n\n      if (reference.startsWith('_')) continue;\n\n      if (itemNum && /^\\d+$/.test(itemNum)) {\n        if (currentItem && currentItem.refs.length > 0) {\n          items.push(currentItem);\n        }\n        const refs = Utils.parseRefs(reference).filter(ref => !Utils.isTP(ref));\n        currentItem = {\n          quantity: parseInt(quantity) || refs.length,\n          refs,\n          part,\n          footprint: footprint || part,\n          format: 'item_no',\n        };\n      } else if (currentItem && reference) {\n        const additionalRefs = Utils.parseRefs(reference).filter(ref => !Utils.isTP(ref));\n        currentItem.refs.push(...additionalRefs);\n      }\n    }\n\n    if (currentItem && currentItem.refs.length > 0) {\n      items.push(currentItem);\n    }\n  }\n  \n  return items;\n}\n\n// ============================================================\n//  \n// ============================================================\n\ninterface ParsedCoordItem {\n  ref: string;\n  x: number;\n  y: number;\n  rotation: number;\n  layer: string;\n}\n\nasync function parseCoordinateFile(file: File): Promise<ParsedCoordItem[]> {\n  const arrayBuffer = await file.arrayBuffer();\n  const items: ParsedCoordItem[] = [];\n  \n  if (file.name.endsWith('.txt')) {\n    //   \n    const text = new TextDecoder('utf-8').decode(arrayBuffer);\n    const lines = text.split('\\n');\n    \n    let headerFound = false;\n    const colMap = { ref: 0, x: 1, y: 2, rotation: 3, layer: 4 };\n    \n    for (const line of lines) {\n      const trimmed = line.trim();\n      if (!trimmed) continue;\n      \n      //  \n      if (!headerFound) {\n        const lower = trimmed.toLowerCase();\n        if (lower.includes('refdes') || lower.includes('ref') || lower.includes('designator')) {\n          headerFound = true;\n          //    \n          const cols = trimmed.split(/\\t|\\s{2,}/).map(c => c.trim().replace(/\"/g, ''));\n          console.log('   :', cols);\n          \n          cols.forEach((col, idx) => {\n            const colLower = col.toLowerCase();\n            if (colLower.includes('ref') || colLower.includes('designator')) {\n              colMap.ref = idx;\n              console.log(`  - Ref : ${idx} (${col})`);\n            }\n            if (colLower.includes('locationx') || colLower === 'x' || (colLower === 'x' && idx === 1)) {\n              colMap.x = idx;\n              console.log(`  - X : ${idx} (${col})`);\n            }\n            if (colLower.includes('locationy') || colLower === 'y' || (colLower === 'y' && idx === 2)) {\n              colMap.y = idx;\n              console.log(`  - Y : ${idx} (${col})`);\n            }\n            if (colLower.includes('rotation') || colLower.includes('angle') || colLower.includes('rot')) {\n              colMap.rotation = idx;\n              console.log(`  - Rotation : ${idx} (${col})`);\n            }\n            if (colLower.includes('layer') || colLower.includes('side')) {\n              colMap.layer = idx;\n              console.log(`  - Layer : ${idx} (${col})`);\n            }\n          });\n          \n          console.log('   :', colMap);\n          continue;\n        }\n        continue;\n      }\n      \n      //   \n      //     (  )\n      const cols = trimmed.split(/\\t|\\s{2,}/).map(c => c.trim().replace(/\"/g, ''));\n      if (cols.length < 3) continue;\n      \n      const ref = (cols[colMap.ref] || '').trim().toUpperCase().replace(/\"/g, '');\n      if (!ref || Utils.isTP(ref) || /^\\d+$/.test(ref)) continue; //   REF \n      \n      const x = parseFloat(cols[colMap.x] || '0');\n      const y = parseFloat(cols[colMap.y] || '0');\n      const rotation = parseFloat(cols[colMap.rotation] || '0');\n      const layerStr = (cols[colMap.layer] || '').toUpperCase().replace(/\"/g, '');\n      const layer = layerStr.includes('BOT') ? 'BOTTOM' : 'TOP';\n      \n      items.push({\n        ref,\n        x,\n        y,\n        rotation,\n        layer,\n      });\n    }\n    \n    console.log(`  : ${items.length}`);\n    if (items.length > 0) {\n      console.log('    :', items[0]);\n    }\n  } else {\n    //   \n    const data = new Uint8Array(arrayBuffer);\n    const workbook = XLSX.read(data, { type: 'array' });\n    const sheet = workbook.Sheets[workbook.SheetNames[0]];\n    const rows = XLSX.utils.sheet_to_json<string[]>(sheet, { header: 1 });\n    \n    let headerRow = -1;\n    const colMap = { ref: 0, x: 3, y: 4, rotation: 5, layer: 2 };\n    \n    for (let r = 0; r < Math.min(10, rows.length); r++) {\n      const row = rows[r];\n      if (!row) continue;\n      \n      const rowStr = row.map(c => String(c || '').toLowerCase()).join(' ');\n      if (rowStr.includes('ref') || rowStr.includes('designator')) {\n        headerRow = r;\n        row.forEach((cell, idx) => {\n          const val = String(cell || '').toLowerCase().trim();\n          if (val.includes('ref') || val.includes('designator')) colMap.ref = idx;\n          if (val.includes('locationx') || val === 'x') colMap.x = idx;\n          if (val.includes('locationy') || val === 'y') colMap.y = idx;\n          if (val.includes('rotation') || val.includes('angle')) colMap.rotation = idx;\n          if (val.includes('layer') || val.includes('side')) colMap.layer = idx;\n        });\n        break;\n      }\n    }\n    \n    for (let r = headerRow + 1; r < rows.length; r++) {\n      const row = rows[r];\n      if (!row) continue;\n      \n      const ref = String(row[colMap.ref] || '').trim().toUpperCase();\n      if (!ref || Utils.isTP(ref) || /^\\d+$/.test(ref)) continue; //   REF \n      \n      items.push({\n        ref,\n        x: parseFloat(String(row[colMap.x])) || 0,\n        y: parseFloat(String(row[colMap.y])) || 0,\n        rotation: parseFloat(String(row[colMap.rotation])) || 0,\n        layer: String(row[colMap.layer] || '').toUpperCase().includes('BOT') ? 'BOTTOM' : 'TOP',\n      });\n    }\n  }\n  \n  return items;\n}\n\n// ============================================================\n//  \n// ============================================================\n\nfunction mapPartName(\n  part: string, \n  footprint: string, \n  learningData: LearningDataType\n): { partName: string; isNew: boolean } {\n  const fpUpper = footprint.toUpperCase();\n  \n  // 1. Part|Footprint   \n  const combo = `${part}|${footprint}`;\n  if (learningData.partNameMapping[combo]) {\n    return { partName: learningData.partNameMapping[combo], isNew: false };\n  }\n  \n  // 2. Footprint \n  if (learningData.partNameMapping[fpUpper]) {\n    return { partName: learningData.partNameMapping[fpUpper], isNew: false };\n  }\n  if (learningData.partNameMapping[footprint]) {\n    return { partName: learningData.partNameMapping[footprint], isNew: false };\n  }\n  \n  // 3. Part  \n  if (learningData.partNameMapping[part]) {\n    return { partName: learningData.partNameMapping[part], isNew: false };\n  }\n  \n  // 4.  \n  return { partName: footprint || part, isNew: true };\n}\n\nfunction mapType(partName: string, learningData: LearningDataType): string {\n  //    \n  if (learningData.typeMapping[partName]) {\n    return learningData.typeMapping[partName];\n  }\n  \n  //   \n  const normalized = Utils.normalizePartName(partName);\n  for (const [key, value] of Object.entries(learningData.typeMapping)) {\n    if (Utils.normalizePartName(key) === normalized) {\n      return value;\n    }\n  }\n  \n  return '';  //  \n}\n\n// Footprint   (   !)\nfunction mapTypeFromFootprint(part: string, footprint: string, learningData: LearningDataType): string {\n  const fpUpper = footprint.toUpperCase();\n  \n  // 1. Part|Footprint   \n  const combo = `${part}|${footprint}`;\n  if (learningData.partNameMapping[combo]) {\n    const mappedPartName = learningData.partNameMapping[combo];\n    const type = mapType(mappedPartName, learningData);\n    if (type) return type;\n  }\n  \n  // 2. Footprint  \n  const footprintKeys = [fpUpper, footprint];\n  for (const key of footprintKeys) {\n    if (learningData.partNameMapping[key]) {\n      const mappedPartName = learningData.partNameMapping[key];\n      const type = mapType(mappedPartName, learningData);\n      if (type) return type;\n    }\n  }\n  \n  // 3. Part  \n  if (learningData.partNameMapping[part]) {\n    const mappedPartName = learningData.partNameMapping[part];\n    const type = mapType(mappedPartName, learningData);\n    if (type) return type;\n  }\n  \n  // 4.      footprint    \n  for (const [key, mappedPartName] of Object.entries(learningData.partNameMapping)) {\n    if (key.toUpperCase().includes(fpUpper) || fpUpper.includes(key.toUpperCase())) {\n      const type = mapType(mappedPartName, learningData);\n      if (type) return type;\n    }\n  }\n  \n  return '';  //  \n}\n\n// ============================================================\n// Grouped-Designator BOM  (Comment/Designator  )\n// ============================================================\n\nfunction normalizeGroupedBomToken(token: string): string {\n  return (token || '').trim();\n}\n\nfunction detectOpenFromTokens(partRaw: string, footprintRaw: string): boolean {\n  const p = (partRaw || '').toUpperCase();\n  const f = (footprintRaw || '').toUpperCase();\n  // NC OPEN/  ( misapKeywords )\n  return p.includes('/NC') || p.endsWith('NC') || f.includes('/NC') || f.endsWith('NC');\n}\n\nfunction extractMetricSize(partRaw: string, footprintRaw: string): string {\n  const candidates = `${footprintRaw || ''} ${partRaw || ''}`.toUpperCase();\n  const m = candidates.match(/(0603|1005|1608|2012|3216|3225)/);\n  return m?.[1] || '';\n}\n\nfunction extractVoltageToken(partRaw: string): string {\n  const parts = (partRaw || '').split('/').map(p => p.trim()).filter(Boolean);\n  const v = parts.find(p => /\\d+\\s*(V|KV)$/i.test(p));\n  return v ? v.toUpperCase().replace(/\\s+/g, '') : '';\n}\n\nfunction normalizeCapValueForFootprintKey(valueRaw: string): { displayValue: string; keyValue: string } | null {\n  const v = normalizeGroupedBomToken(valueRaw);\n  if (!v) return null;\n  // value token : 0.1uF, 10pf, 1nF, 47u, 8pF\n  const m = v.match(/^([0-9]*\\.?[0-9]+)\\s*([uUnNpP])\\s*([fF])?$/);\n  if (!m) return null;\n  const num = m[1];\n  const unitLetter = m[2].toLowerCase(); // u/n/p\n  const displayUnit = `${unitLetter}F`; // uF/nF/pF\n  const displayValue = `${num}${displayUnit}`;\n  const keyValue = `${num}${unitLetter.toUpperCase()}F`; // UF/NF/PF\n  return { displayValue, keyValue };\n}\n\nfunction normalizeResValueForFootprintKey(valueRaw: string): { displayValue: string; keyValue: string } | null {\n  const v = normalizeGroupedBomToken(valueRaw);\n  if (!v) return null;\n  // : 1k, 4.7k, 1M, 0, 0.007\n  const m = v.match(/^([0-9]*\\.?[0-9]+)\\s*([kKmMrR])?$/);\n  if (!m) return null;\n  const num = m[1];\n  const suffix = (m[2] || '').toUpperCase(); // K/M/R/'' (R   ohm   )\n  const displayValue = `${num}${suffix}`;\n  const keyValue = `${num}${suffix}`;\n  return { displayValue, keyValue };\n}\n\nfunction buildGroupedBomNormalization(\n  partRaw: string,\n  footprintRaw: string,\n  refs: string[]\n): {\n  partCandidates: string[];\n  footprintCandidates: string[];\n  fallbackStandardizedName: string;\n} {\n  const raw = normalizeGroupedBomToken(partRaw);\n  const fpRaw = normalizeGroupedBomToken(footprintRaw);\n  const firstRef = (refs?.[0] || '').toUpperCase();\n  const refPrefix = firstRef.replace(/\\d+/g, '');\n\n  const isOpen = detectOpenFromTokens(raw, fpRaw);\n  const size = extractMetricSize(raw, fpRaw);\n  const voltage = extractVoltageToken(raw);\n\n  const segments = raw.split('/').map(s => s.trim()).filter(Boolean);\n  const valueSeg = segments[0] || raw;\n\n  const partCandidates: string[] = [];\n  const footprintCandidates: string[] = [];\n  let fallbackStandardizedName = raw || fpRaw || '';\n\n  //  : raw   \n  if (raw) partCandidates.push(raw);\n  if (fpRaw) footprintCandidates.push(fpRaw);\n\n  if (refPrefix === 'C') {\n    const cap = normalizeCapValueForFootprintKey(valueSeg);\n    if (cap && size) {\n      const key = voltage\n        ? `C${cap.keyValue}_${voltage}_${size}`\n        : `C${cap.keyValue}_${size}`;\n      footprintCandidates.unshift(isOpen ? `${key}_OPEN` : key);\n      // mapping key partRaw(: 0.1uF/16V/1005)   ,\n      // u/n/p  uF/nF/pF  variant  \n      const normalizedPart = (() => {\n        if (segments.length >= 3) {\n          const vSeg = segments.find(s => /\\d+\\s*(V|KV)$/i.test(s)) || '';\n          const sizeSeg = segments.find(s => /(0603|1005|1608|2012|3216|3225|1206)/i.test(s)) || '';\n          const part = `${cap.displayValue}${vSeg ? `/${vSeg.replace(/\\s+/g, '')}` : ''}${sizeSeg ? `/${sizeSeg}` : ''}`;\n          return part;\n        }\n        return cap.displayValue;\n      })();\n      if (normalizedPart && normalizedPart !== raw) partCandidates.unshift(normalizedPart);\n      fallbackStandardizedName = `C${cap.displayValue}${voltage ? `/${voltage}` : ''}_${size}${isOpen ? '_OPEN' : ''}`;\n    }\n  } else if (refPrefix === 'R') {\n    const res = normalizeResValueForFootprintKey(valueSeg);\n    if (res && size) {\n      const key = `R${res.keyValue}_${size}${isOpen ? '_OPEN' : ''}`;\n      footprintCandidates.unshift(key);\n      const normalizedPart = (() => {\n        // partRaw \"1k/1005\"    , K/M    \n        if (segments.length >= 2) {\n          const sizeSeg = segments.find(s => /(0603|1005|1608|2012|3216|3225|1206)/i.test(s)) || '';\n          const tail = sizeSeg ? `/${sizeSeg}` : '';\n          const nc = isOpen ? '/NC' : '';\n          return `${res.displayValue}${tail}${nc}`;\n        }\n        return res.displayValue;\n      })();\n      if (normalizedPart && normalizedPart !== raw) partCandidates.unshift(normalizedPart);\n      fallbackStandardizedName = `R${res.displayValue}_${size}${isOpen ? '_OPEN' : ''}`;\n    }\n  }\n\n  //    ( )\n  const uniq = (arr: string[]) => {\n    const out: string[] = [];\n    const seen = new Set<string>();\n    for (const v of arr) {\n      const key = (v || '').trim();\n      if (!key) continue;\n      if (seen.has(key)) continue;\n      seen.add(key);\n      out.push(key);\n    }\n    return out;\n  };\n\n  return {\n    partCandidates: uniq(partCandidates),\n    footprintCandidates: uniq(footprintCandidates),\n    fallbackStandardizedName,\n  };\n}\n\n// ============================================================\n//   \n// ============================================================\n\nexport async function processBOMAndCoordinates(\n  bomFile: File,\n  coordFile: File | null,\n  productionQuantity: number\n): Promise<ProcessedResult> {\n  console.log(' BOM/  ...');\n  \n  // 1.   \n  const learningData = await loadLearningData();\n  \n  // 2.  \n  const parsedBOM = await parseBOMFile(bomFile);\n  const parsedCoord = coordFile ? await parseCoordinateFile(coordFile) : [];\n\n  // Ref     \n  parsedBOM.forEach(item => {\n    item.refs = item.refs.map(ref => ref.toUpperCase());\n  });\n  const normalizedCoord = parsedCoord.map(coord => ({\n    ...coord,\n    ref: coord.ref.toUpperCase(),\n  }));\n  \n  console.log(` BOM : ${parsedBOM.length}`);\n  console.log(`  : ${normalizedCoord.length}`);\n  \n  // 3. Ref    \n  const coordMap = new Map<string, ParsedCoordItem>();\n  for (const coord of normalizedCoord) {\n    coordMap.set(coord.ref, coord);\n  }\n  \n  // 4. BOM   \n  const bomItems: BOMItem[] = [];\n  const topCoordinates: CoordinateItem[] = [];\n  const bottomCoordinates: CoordinateItem[] = [];\n  \n  let manualRequiredCount = 0;\n  let newPartCount = 0;\n  let misapCount = 0;\n  \n  let lineNumber = 1;\n  \n  for (const item of parsedBOM) {\n    // (part/footprint)  ( grouped_designator BOM raw footprint C1005/R1005    )\n    const norm =\n      item.format === 'grouped_designator'\n        ? buildGroupedBomNormalization(item.part, item.footprint, item.refs)\n        : null;\n\n    // /   part/footprint (  )\n    let partForMatch = item.part;\n    let footprintForMatch = item.footprint;\n\n    if (norm) {\n      // part/footprint        \n      let matched = false;\n      for (const fp of norm.footprintCandidates) {\n        for (const p of norm.partCandidates) {\n          if (learningData.partNameMapping[`${p}|${fp}`] || learningData.partNameMapping[fp.toUpperCase()] || learningData.partNameMapping[fp]) {\n            partForMatch = p;\n            footprintForMatch = fp;\n            matched = true;\n            break;\n          }\n        }\n        if (matched) break;\n      }\n      //   footprint      ( fallback)\n      if (!matched && norm.footprintCandidates.length > 0) {\n        footprintForMatch = norm.footprintCandidates[0];\n        partForMatch = norm.partCandidates[0] || item.part;\n      }\n    }\n\n    //    \n    const isManualRequired = Utils.isManualInputRequired(partForMatch, footprintForMatch, learningData);\n    \n    //  \n    let mappedPartName: string;\n    let isNewPart = false;\n    \n    if (isManualRequired) {\n      mappedPartName = '  (  )';\n      manualRequiredCount++;\n    } else {\n      // grouped_designator        \n      if (norm) {\n        let found: { partName: string; isNew: boolean } | null = null;\n        for (const fp of norm.footprintCandidates) {\n          for (const p of norm.partCandidates) {\n            const m = mapPartName(p, fp, learningData);\n            if (!m.isNew) {\n              found = m;\n              partForMatch = p;\n              footprintForMatch = fp;\n              break;\n            }\n          }\n          if (found) break;\n        }\n        if (found) {\n          mappedPartName = found.partName;\n          isNewPart = found.isNew;\n        } else {\n          //       (   )\n          mappedPartName = norm.fallbackStandardizedName || (footprintForMatch || partForMatch);\n          isNewPart = true;\n        }\n      } else {\n        const mapping = mapPartName(partForMatch, footprintForMatch, learningData);\n        mappedPartName = mapping.partName;\n        isNewPart = mapping.isNew;\n      }\n      if (isNewPart) {\n        newPartCount++;\n      }\n    }\n    \n    //  \n    const itemType = mapType(mappedPartName, learningData);\n    if (!itemType && !isManualRequired && !isNewPart) {\n      //      \n      isNewPart = true;\n      newPartCount++;\n    }\n    \n    //   (footprint part  )\n    const isMisap = Utils.isMisap(footprintForMatch, partForMatch, learningData);\n    if (isMisap) {\n      misapCount++;\n    }\n    \n    // Footprint/Part   (  )\n    const extractTypeFromFootprint = (part: string, footprint: string, refs: string[]): string => {\n      const fp = footprint.toUpperCase();\n      const pt = part.toUpperCase();\n      const firstRef = (refs[0] || '').toUpperCase();\n      const refPrefix = firstRef.replace(/\\d+/g, '');\n      \n      //  \n      let size = '1005'; // \n      if (fp.includes('0603') || pt.includes('0603')) size = '0603';\n      else if (fp.includes('1005') || pt.includes('1005')) size = '1005';\n      else if (fp.includes('1608') || pt.includes('1608')) size = '1608';\n      else if (fp.includes('2012') || pt.includes('2012')) size = '2012';\n      else if (fp.includes('3225') || pt.includes('3225')) size = '3225';\n      \n      // 1. Footprint/Part   \n      // : C  UF, PF, NF \n      if (/^C\\d/.test(pt) || /^C[_-]/.test(pt) || pt.includes('UF') || pt.includes('PF') || pt.includes('NF')) {\n        return `C/C(${size})`;\n      }\n      // : R  OHM, K_ \n      if (/^R\\d/.test(pt) || /^R[_-]/.test(pt) || pt.includes('OHM') || /R\\d+K/.test(pt)) {\n        return `(${size})`;\n      }\n      // IC\n      if (pt.includes('IC') || pt.includes('MAX') || pt.includes('LM') || pt.includes('TPS') || \n          pt.includes('STM') || pt.includes('AD5') || pt.includes('ADS') || pt.includes('PCA') ||\n          pt.includes('TCA') || pt.includes('SN6') || pt.includes('SN7')) {\n        return 'IC(SMD)';\n      }\n      // \n      if (pt.includes('DMN') || pt.includes('MOSFET') || pt.includes('2N') || /^Q\\d/.test(refPrefix)) {\n        return 'TR(SMD)';\n      }\n      // \n      if (pt.includes('DIODE') || pt.includes('1N') || pt.includes('BAT') || pt.includes('D5V') || pt.includes('D10V') || pt.includes('TPD')) {\n        return 'DIODE(SMD)';\n      }\n      // \n      if (pt.includes('BEAD') || pt.includes('BLM') || pt.includes('FB')) {\n        return 'BEAD(2012)';\n      }\n      // \n      if (pt.includes('CONN') || pt.includes('B2B') || pt.includes('HEADER') || pt.includes('POGO') || \n          pt.includes('PIN') || fp.includes('CONN') || /^\\d{5}/.test(pt)) {\n        return 'CONNECTOR';\n      }\n      // LED\n      if (pt.includes('LED')) {\n        return 'LED(1608)';\n      }\n      // OSC\n      if (pt.includes('OSC') || pt.includes('XTAL') || pt.includes('CRYSTAL')) {\n        return 'OSC(SMD)';\n      }\n      // \n      if (pt.includes('SW') || pt.includes('SWITCH')) {\n        return 'S/W(DIP)';\n      }\n      // T/T ()\n      if (pt.includes('TANT') || pt.includes('T/T')) {\n        return 'T/T';\n      }\n      \n      // 2. REF   (fallback)\n      if (refPrefix === 'C') return `C/C(${size})`;\n      if (refPrefix === 'R') return `(${size})`;\n      if (refPrefix === 'U') return 'IC(SMD)';\n      if (refPrefix === 'Q') return 'TR(SMD)';\n      if (refPrefix === 'D') return 'DIODE(SMD)';\n      if (refPrefix === 'L' || refPrefix === 'FB' || refPrefix === 'BD') return 'BEAD(2012)';\n      if (refPrefix === 'LED') return 'LED(1608)';\n      if (refPrefix === 'J' || refPrefix === 'CN' || refPrefix === 'CON') return 'CONNECTOR';\n      if (refPrefix === 'SW') return 'S/W(DIP)';\n      if (refPrefix === 'Y' || refPrefix === 'X') return 'OSC(SMD)';\n      \n      return ' ';\n    };\n    \n    //  : 1 , 2 footprint  \n    let finalItemType: string;\n    if (!isManualRequired && !isNewPart && itemType) {\n      //   \n      finalItemType = Utils.normalizeType(itemType);\n    } else {\n      // /    !\n      const typeFromLearning = mapTypeFromFootprint(item.part, item.footprint, learningData);\n      if (typeFromLearning) {\n        finalItemType = Utils.normalizeType(typeFromLearning);\n      } else {\n        //     \n        finalItemType = extractTypeFromFootprint(item.part, item.footprint, item.refs);\n      }\n    }\n    \n    // BOM  \n    const bomItem: BOMItem = {\n      lineNumber,\n      itemType: finalItemType,\n      itemName: mappedPartName,\n      setCount: item.refs.length,\n      totalQuantity: item.refs.length * productionQuantity,\n      checkStatus: '',\n      refList: item.refs.join(', '),\n      remark: isMisap ? '' : '',\n      isManualRequired,\n      isNewPart,\n      originalPart: item.part,\n      originalFootprint: item.footprint,\n    };\n    \n    bomItems.push(bomItem);\n    lineNumber++;\n    \n    //  \n    for (const ref of item.refs) {\n      const normRef = ref.toUpperCase();\n      const coord = coordMap.get(normRef);\n      if (!coord) continue;\n      \n      const coordItem: CoordinateItem = {\n        type: bomItem.itemType,\n        partName: bomItem.itemName,\n        refDes: ref,\n        layer: coord.layer,\n        locationX: coord.x,\n        locationY: coord.y,\n        rotation: coord.rotation,\n        remark: isMisap ? '' : undefined,\n      };\n      \n      if (coord.layer === 'TOP') {\n        topCoordinates.push(coordItem);\n      } else {\n        bottomCoordinates.push(coordItem);\n      }\n\n      //         \n      coordMap.delete(normRef);\n    }\n  }\n\n  // 4-1. BOM    REF   \n  coordMap.forEach((coord) => {\n    const coordItem: CoordinateItem = {\n      type: ' ',\n      partName: 'BOM ',\n      refDes: coord.ref,\n      layer: coord.layer,\n      locationX: coord.x,\n      locationY: coord.y,\n      rotation: coord.rotation,\n      remark: 'BOM ',\n    };\n\n    if (coord.layer === 'TOP') {\n      topCoordinates.push(coordItem);\n    } else {\n      bottomCoordinates.push(coordItem);\n    }\n  });\n  \n  // 5.   (  )\n  //   (     )\n  const TYPE_GROUP_ORDER = [\n    'IC',       // IC(SMD)\n    'SENSOR',   // SENSOR(SMD)\n    'TR',       // TR(SMD)\n    'DIODE',    // DIODE(SMD)\n    'T/T',      // T/T ()\n    'C/C',      // C/C(0603), C/C(1005), C/C(1608), C/C(2012), C/C(3225)\n    '',     // (1005), (1608), (2012)\n    'BEAD',     // BEAD(2012)\n    'OSC',      // OSC(SMD)\n    'LED',      // LED(1608)\n    'S/W',      // S/W(DIP)\n    'CONNECTOR',// CONNECTOR\n    'PEMNUT',   // PEMNUT\n  ];\n  \n  //   \n  const getTypeGroup = (itemType: string): string => {\n    if (!itemType || itemType === ' ') return '';\n    if (itemType.startsWith('IC')) return 'IC';\n    if (itemType.startsWith('SENSOR')) return 'SENSOR';\n    if (itemType.startsWith('TR')) return 'TR';\n    if (itemType.startsWith('DIODE')) return 'DIODE';\n    if (itemType.startsWith('T/T')) return 'T/T';\n    if (itemType.startsWith('C/C')) return 'C/C';\n    if (itemType.startsWith('')) return '';\n    if (itemType.startsWith('BEAD')) return 'BEAD';\n    if (itemType.startsWith('OSC')) return 'OSC';\n    if (itemType.startsWith('LED')) return 'LED';\n    if (itemType.startsWith('S/W')) return 'S/W';\n    if (itemType === 'CONNECTOR') return 'CONNECTOR';\n    if (itemType === 'PEMNUT') return 'PEMNUT';\n    return itemType;\n  };\n  \n  //    \n  const guessTypeGroupForSort = (item: BOMItem): string => {\n    //     \n    if (item.itemType && item.itemType !== ' ') {\n      return getTypeGroup(item.itemType);\n    }\n    \n    // REF     (C1  C, R10  R)\n    const firstRef = (item.refList || '').split(',')[0].trim().toUpperCase();\n    const refPrefix = firstRef.replace(/\\d+/g, ''); //   \n    \n    // REF  \n    if (refPrefix === 'C') return 'C/C';\n    if (refPrefix === 'R') return '';\n    if (refPrefix === 'U') return 'IC';\n    if (refPrefix === 'Q') return 'TR';\n    if (refPrefix === 'D') return 'DIODE';\n    if (refPrefix === 'L' || refPrefix === 'FB' || refPrefix === 'BD') return 'BEAD';\n    if (refPrefix === 'LED') return 'LED';\n    if (refPrefix === 'J' || refPrefix === 'CN' || refPrefix === 'CON') return 'CONNECTOR';\n    if (refPrefix === 'SW') return 'S/W';\n    if (refPrefix === 'Y' || refPrefix === 'X') return 'OSC';\n    \n    //    \n    const part = (item.originalPart || item.itemName || '').toUpperCase();\n    const footprint = (item.originalFootprint || '').toUpperCase();\n    \n    //  (C )\n    if (/^C\\d/.test(part) || /^C[_-]/.test(part) || part.startsWith('CC') || \n        part.includes('PF') || part.includes('UF') || part.includes('NF')) {\n      return 'C/C';\n    }\n    \n    //  (R )\n    if (/^R\\d/.test(part) || /^R[_-]/.test(part) || part.includes('OHM') || /^\\d+[KMR]$/.test(part)) {\n      return '';\n    }\n    \n    // IC\n    if (/^U\\d/.test(part) || part.includes('IC') || part.includes('MAX') || part.includes('LM') || \n        part.includes('TPS') || part.includes('STM') || part.includes('MC')) {\n      return 'IC';\n    }\n    \n    // \n    if (/^Q\\d/.test(part) || part.includes('TR') || part.includes('MOSFET') || part.includes('2N')) {\n      return 'TR';\n    }\n    \n    // \n    if (/^D\\d/.test(part) || part.includes('DIODE') || part.includes('1N') || part.includes('BAT')) {\n      return 'DIODE';\n    }\n    \n    // LED\n    if (part.includes('LED')) {\n      return 'LED';\n    }\n    \n    // \n    if (part.includes('SENSOR')) {\n      return 'SENSOR';\n    }\n    \n    // \n    if (part.includes('BEAD') || part.includes('FB')) {\n      return 'BEAD';\n    }\n    \n    // \n    if (part.includes('CONN') || part.includes('B2B') || part.includes('HEADER') || \n        part.includes('USB') || part.includes('PIN') || /^J\\d/.test(part)) {\n      return 'CONNECTOR';\n    }\n    \n    // \n    if (part.includes('SW') || part.includes('SWITCH') || part.includes('BTN')) {\n      return 'S/W';\n    }\n    \n    // /\n    if (part.includes('OSC') || part.includes('XTAL') || part.includes('CRYSTAL')) {\n      return 'OSC';\n    }\n    \n    //  \n    if (part.includes('T/T') || part.includes('TANT')) {\n      return 'T/T';\n    }\n    \n    //   -   \n    return 'CONNECTOR';\n  };\n  \n  //    \n  const checkIsMisap = (itemName: string, remark: string) => {\n    const nameUpper = (itemName || '').toUpperCase();\n    const remarkUpper = (remark || '').toUpperCase();\n    const result = remarkUpper.includes('') || \n      nameUpper.includes('_OPEN') || nameUpper.includes('OPEN_') ||\n      nameUpper.includes('_POGO') || nameUpper.includes('POGO_') ||\n      nameUpper.includes('_PAD') || nameUpper.includes('PAD_') ||\n      nameUpper.includes('_NC') || nameUpper.includes('NC_');\n    return result;\n  };\n  \n  bomItems.sort((a, b) => {\n    const groupA = guessTypeGroupForSort(a);\n    const groupB = guessTypeGroupForSort(b);\n    \n    const orderA = TYPE_GROUP_ORDER.indexOf(groupA);\n    const orderB = TYPE_GROUP_ORDER.indexOf(groupB);\n    \n    //     \n    const idxA = orderA === -1 ? 999 : orderA;\n    const idxB = orderB === -1 ? 999 : orderB;\n    \n    if (idxA !== idxB) return idxA - idxB;\n    \n    //     (C/C(0603) < C/C(1005) < ...)\n    if (a.itemType !== b.itemType) {\n      return (a.itemType || '').localeCompare(b.itemType || '');\n    }\n    \n    //       \n    const aMisap = checkIsMisap(a.itemName, a.remark);\n    const bMisap = checkIsMisap(b.itemName, b.remark);\n    if (aMisap !== bMisap) {\n      return aMisap ? 1 : -1; //  \n    }\n    \n    //  ,    \n    return (a.itemName || '').localeCompare(b.itemName || '');\n  });\n  \n  //   lineNumber \n  bomItems.forEach((item, idx) => {\n    item.lineNumber = idx + 1;\n  });\n  \n  //      \n  const sortCoordinates = (coords: CoordinateItem[]) => {\n    return coords.sort((a, b) => {\n      // type    \n      const getGroup = (type: string) => {\n        const t = (type || '').toUpperCase();\n        if (t.includes('IC')) return 'IC';\n        if (t.includes('DIODE')) return 'DIODE';\n        if (t.includes('C/C') || t.includes('C_C')) return 'C/C';\n        if (t.includes('')) return '';\n        if (t.includes('BEAD')) return 'BEAD';\n        if (t.includes('S/W') || t.includes('SW')) return 'S/W';\n        if (t.includes('CONNECTOR') || t.includes('CONN')) return 'CONNECTOR';\n        return 'ETC';\n      };\n      \n      const groupA = getGroup(a.type || '');\n      const groupB = getGroup(b.type || '');\n      \n      const orderA = TYPE_GROUP_ORDER.indexOf(groupA);\n      const orderB = TYPE_GROUP_ORDER.indexOf(groupB);\n      \n      const idxA = orderA === -1 ? 999 : orderA;\n      const idxB = orderB === -1 ? 999 : orderB;\n      \n      if (idxA !== idxB) return idxA - idxB;\n      \n      //    type \n      if (a.type !== b.type) {\n        return (a.type || '').localeCompare(b.type || '');\n      }\n      \n      //  type     \n      const aMisap = checkIsMisap(a.partName ?? '', a.remark ?? '');\n      const bMisap = checkIsMisap(b.partName ?? '', b.remark ?? '');\n      if (aMisap !== bMisap) {\n        return aMisap ? 1 : -1; //  \n      }\n      \n      //  type,    \n      return (a.partName || '').localeCompare(b.partName || '');\n    });\n  };\n  \n  sortCoordinates(topCoordinates);\n  sortCoordinates(bottomCoordinates);\n  \n  //     \n  const misapItems = bomItems.filter(item => checkIsMisap(item.itemName, item.remark));\n  console.log('  :', misapItems.map(item => `${item.itemType} - ${item.itemName}`));\n  \n  console.log(' BOM/  ');\n  console.log(`  -  : ${bomItems.length}`);\n  console.log(`  -   : ${manualRequiredCount}`);\n  console.log(`  -  : ${newPartCount}`);\n  console.log(`  - : ${misapCount}`);\n  \n  return {\n    bomItems,\n    topCoordinates,\n    bottomCoordinates,\n    summary: {\n      totalItems: bomItems.length,\n      manualRequiredCount,\n      newPartCount,\n      misapCount,\n    },\n  };\n}\n\n// ============================================================\n//    ( )\n// ============================================================\n\nexport function saveNewPartMapping(footprint: string, partName: string, itemType: string) {\n  try {\n    const storageKey = 'v7_new_parts';\n    const existing = JSON.parse(localStorage.getItem(storageKey) || '{}');\n    \n    existing[footprint.toUpperCase()] = {\n      partName,\n      itemType,\n      savedAt: new Date().toISOString(),\n    };\n    \n    localStorage.setItem(storageKey, JSON.stringify(existing));\n    console.log(`   : ${footprint}  ${partName} (${itemType})`);\n    \n    //  \n    learningDataCache = null;\n  } catch (error) {\n    console.error('   :', error);\n  }\n}\n\n// ============================================================\n//    \n// ============================================================\n\nexport function resetLearningDataCache() {\n  learningDataCache = null;\n}\n\n// ============================================================\n//    (  )\n// ============================================================\n\nconst TYPE_GROUP_ORDER_EXPORT = ['IC', 'DIODE', 'C/C', '', 'BEAD', 'S/W', 'CONNECTOR'];\n\n//   \nfunction checkIsMisapExport(partName: string | undefined, remark: string | undefined): boolean {\n  const remarkUpper = (remark || '').toUpperCase();\n  const nameUpper = (partName || '').toUpperCase();\n  return remarkUpper.includes('') ||\n    nameUpper.includes('_OPEN') || nameUpper.includes('OPEN_') ||\n    nameUpper.includes('_POGO') || nameUpper.includes('POGO_') ||\n    nameUpper.includes('_PAD') || nameUpper.includes('PAD_') ||\n    nameUpper.includes('_NC') || nameUpper.includes('NC_');\n}\n\n// BOM   \nexport function sortBOMItems(bomItems: BOMItem[]): BOMItem[] {\n  const guessTypeGroup = (item: BOMItem) => {\n    const type = (item.itemType || '').toUpperCase();\n    if (type.includes('IC')) return 'IC';\n    if (type.includes('DIODE')) return 'DIODE';\n    if (type.includes('C/C') || type.includes('C_C')) return 'C/C';\n    if (type.includes('')) return '';\n    if (type.includes('BEAD')) return 'BEAD';\n    if (type.includes('S/W') || type.includes('SW')) return 'S/W';\n    if (type.includes('CONNECTOR') || type.includes('CONN')) return 'CONNECTOR';\n    return 'ETC';\n  };\n\n  return [...bomItems].sort((a, b) => {\n    const groupA = guessTypeGroup(a);\n    const groupB = guessTypeGroup(b);\n    \n    const orderA = TYPE_GROUP_ORDER_EXPORT.indexOf(groupA);\n    const orderB = TYPE_GROUP_ORDER_EXPORT.indexOf(groupB);\n    \n    const idxA = orderA === -1 ? 999 : orderA;\n    const idxB = orderB === -1 ? 999 : orderB;\n    \n    if (idxA !== idxB) return idxA - idxB;\n    \n    //    \n    if (a.itemType !== b.itemType) {\n      return (a.itemType || '').localeCompare(b.itemType || '');\n    }\n    \n    //       \n    const aMisap = checkIsMisapExport(a.itemName, a.remark);\n    const bMisap = checkIsMisapExport(b.itemName, b.remark);\n    if (aMisap !== bMisap) {\n      return aMisap ? 1 : -1;\n    }\n    \n    //  ,    \n    return (a.itemName || '').localeCompare(b.itemName || '');\n  });\n}\n\n//    \nexport function sortCoordinateItems(coordinates: CoordinateItem[]): CoordinateItem[] {\n  const getGroup = (type: string) => {\n    const t = (type || '').toUpperCase();\n    if (t.includes('IC')) return 'IC';\n    if (t.includes('DIODE')) return 'DIODE';\n    if (t.includes('C/C') || t.includes('C_C')) return 'C/C';\n    if (t.includes('')) return '';\n    if (t.includes('BEAD')) return 'BEAD';\n    if (t.includes('S/W') || t.includes('SW')) return 'S/W';\n    if (t.includes('CONNECTOR') || t.includes('CONN')) return 'CONNECTOR';\n    return 'ETC';\n  };\n\n  return [...coordinates].sort((a, b) => {\n    const groupA = getGroup(a.type || '');\n    const groupB = getGroup(b.type || '');\n    \n    const orderA = TYPE_GROUP_ORDER_EXPORT.indexOf(groupA);\n    const orderB = TYPE_GROUP_ORDER_EXPORT.indexOf(groupB);\n    \n    const idxA = orderA === -1 ? 999 : orderA;\n    const idxB = orderB === -1 ? 999 : orderB;\n    \n    if (idxA !== idxB) return idxA - idxB;\n    \n    //    type \n    if (a.type !== b.type) {\n      return (a.type || '').localeCompare(b.type || '');\n    }\n    \n    //  type     \n    const aMisap = checkIsMisapExport(a.partName, a.remark);\n    const bMisap = checkIsMisapExport(b.partName, b.remark);\n    if (aMisap !== bMisap) {\n      return aMisap ? 1 : -1;\n    }\n    \n    //  type,    \n    return (a.partName || '').localeCompare(b.partName || '');\n  });\n}\n\n","import { useState, useEffect, forwardRef, useImperativeHandle, useRef, useLayoutEffect, useMemo } from 'react';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { Badge } from '@/components/ui/badge';\nimport { AlertTriangle, Plus, Trash2 } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { \n  generateBOMExcelFromTemplate, \n  downloadExcelBlob,\n  type ExcelMetadata \n} from '@/utils/excel-generator';\nimport { type BOMItem, type CoordinateItem, sortBOMItems, sortCoordinateItems } from '@/utils/v7-generator';\nimport { toast } from 'sonner';\n\ninterface GeneratedPreviewPanelProps {\n  bomItems: BOMItem[];\n  coordinates: CoordinateItem[];\n  coordinatesProvided?: boolean;\n  boardName: string;\n  productionQuantity: number;\n  artworkManager?: string;       // Artwork \n  productionManager?: string;    //  \n  onSave: (items: BOMItem[]) => void;\n  onMergeStateChange?: (isMerged: boolean) => void;\n  onBomChange?: (items: BOMItem[]) => void;  // BOM    ( )\n  onDeleteRefs?: (refs: string[]) => void;   // BOM    ( ref   )\n}\n\nexport interface GeneratedPreviewPanelRef {\n  handleDownload: () => Promise<void>;\n  handleSave: () => void;\n  handleReset: () => void;\n  handleMerge: () => void;\n  isMerged: () => boolean;\n}\n\nconst GeneratedPreviewPanel = forwardRef<GeneratedPreviewPanelRef, GeneratedPreviewPanelProps>(({ \n  bomItems: initialItems, \n  coordinates, \n  coordinatesProvided = true,\n  boardName,\n  productionQuantity,\n  artworkManager = '',\n  productionManager = '',\n  onSave,\n  onMergeStateChange,\n  onBomChange,\n  onDeleteRefs\n}, ref) => {\n  const [items, setItems] = useState<BOMItem[]>(initialItems);\n  const [beforeMergeItems, setBeforeMergeItems] = useState<BOMItem[] | null>(null); //    \n  const textareaRefs = useRef<{ [key: string]: HTMLTextAreaElement | null }>({});\n  \n  // initialItems  items \n  useEffect(() => {\n    setItems(initialItems);\n    //  BOM (:  )       \n    setBeforeMergeItems(null);\n    onMergeStateChange?.(false);\n  }, [initialItems]);\n\n  // textarea   \n  useLayoutEffect(() => {\n    Object.values(textareaRefs.current).forEach(textarea => {\n      if (textarea) {\n        textarea.style.height = 'auto';\n        const newHeight = Math.max(24, textarea.scrollHeight);\n        textarea.style.height = newHeight + 'px';\n      }\n    });\n  }, [items]);\n  \n  //  \n  const manualRequiredCount = items.filter(i => i.isManualRequired).length;\n  const newPartCount = items.filter(i => i.isNewPart).length;\n  const misapCount = items.filter(i => i.remark === '').length;\n  const totalSetCount = items.reduce((sum, item) => sum + (item.setCount || 0), 0);\n  \n  //  REF Set  (  )\n  const coordRefSet = useMemo(() => {\n    const refSet = new Set<string>();\n    coordinates.forEach((coord: CoordinateItem) => {\n      if (coord.refDes) {\n        refSet.add(coord.refDes.trim().toUpperCase());\n      }\n    });\n    return refSet;\n  }, [coordinates]);\n  \n  // BOM     \n  const hasMissingCoordinate = (item: BOMItem): boolean => {\n    if (!coordinatesProvided) return false;\n    if (!item.refList) return false;\n    const refs = item.refList.split(',').map(r => r.trim().toUpperCase()).filter(Boolean);\n    //    true\n    return refs.some(ref => !coordRefSet.has(ref));\n  };\n  \n  //     \n  const measureTextWidth = (text: string, fontSize: number = 10): number => {\n    const canvas = document.createElement('canvas');\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return text.length * 10;\n    ctx.font = `${fontSize}px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif`;\n    return Math.ceil(ctx.measureText(text).width);\n  };\n  \n  //    (   + )\n  const maxTypeWidth = Math.max(\n    ...items.map(i => measureTextWidth(i.itemType || '', 10)),\n    measureTextWidth('', 10),\n    50\n  ) + 20;\n  \n  const maxNameWidth = Math.max(\n    ...items.map(i => measureTextWidth(i.itemName || '', 10)),\n    measureTextWidth('', 10),\n    100\n  ) + 20;\n  \n  // REF    (15~16 REF )\n  //  REF   (: \"C10, C11\"   REF  )\n  const allRefs = items.flatMap(i => {\n    const refs = (i.refList || '').split(',').map(r => r.trim()).filter(r => r);\n    return refs;\n  });\n  \n  const avgRefWidth = allRefs.length > 0\n    ? allRefs.reduce((sum, ref) => sum + measureTextWidth(ref, 10), 0) / allRefs.length\n    : measureTextWidth('C10', 10); // \n  \n  // 15~16 REF +   \n  const refWidthPerItem = avgRefWidth + measureTextWidth(', ', 10); // REF + \", \"\n  const maxRefWidth = Math.ceil(refWidthPerItem * 15.5) + 20; // 15.5  + \n  \n  // NO    (   )\n  const maxNoWidth = Math.max(\n    measureTextWidth(String(items.length), 10),\n    measureTextWidth('No', 10),\n    30\n  ) + 20;\n  \n  //   \n  const handleDownload = async () => {\n    try {\n      console.log('Starting download with:', { \n        itemsCount: items.length, \n        coordsCount: coordinates.length, \n        boardName \n      });\n      \n      //  \n      if (!items || items.length === 0) {\n        throw new Error('BOM  .  .');\n      }\n      \n      if (!boardName || boardName.trim() === '') {\n        throw new Error('   .');\n      }\n      \n      //     \n      const unfilledItems = items.filter(item => \n        item.isManualRequired && \n        (item.itemName === '  (  )' || item.itemType === ' ')\n      );\n      \n      if (unfilledItems.length > 0) {\n        const confirm = window.confirm(\n          `    ${unfilledItems.length} .\\n` +\n          ' ?\\n\\n' +\n          '(  \" \" )'\n        );\n        if (!confirm) return;\n      }\n\n      // Excel \n      const excelMetadata: ExcelMetadata = {\n        boardName,\n        artworkManager,\n        productionManager,\n        productionQuantity\n      };\n\n      // TOP/BOTTOM \n      const topCoords = coordinates.filter(c => c.layer === 'TOP');\n      const bottomCoords = coordinates.filter(c => c.layer === 'BOTTOM');\n\n      //   ( >  >   )\n      const sortedItems = sortBOMItems(items);\n      const sortedTopCoords = sortCoordinateItems(topCoords);\n      const sortedBottomCoords = sortCoordinateItems(bottomCoords);\n\n      const blob = await generateBOMExcelFromTemplate(\n        sortedItems,\n        sortedTopCoords,\n        sortedBottomCoords,\n        excelMetadata\n      );\n      \n      console.log('Blob generated:', { size: blob.size, type: blob.type });\n      \n      if (!blob || blob.size === 0) {\n        throw new Error('   . ( )');\n      }\n      \n      // : _YYMMDD_.xlsx\n      const today = new Date();\n      const dateStr = today.getFullYear().toString().slice(2) + \n        String(today.getMonth() + 1).padStart(2, '0') + \n        String(today.getDate()).padStart(2, '0');\n      //  :    \n      const cleanName = boardName.trim()\n        .replace(/_\\d{6}_$/, '')\n        .replace(/_$/, '')\n        .replace(/_\\d{6}$/, '');\n      downloadExcelBlob(blob, `${cleanName}_${dateStr}_.xlsx`);\n      toast.success('  .');\n    } catch (error) {\n      console.error('Download error details:', error);\n      let errorMessage = '   ';\n      \n      if (error instanceof Error) {\n        errorMessage = error.message;\n      }\n      \n      toast.error(`   : ${errorMessage}`);\n    }\n  };\n\n  //  \n  const handleReset = () => {\n    if (confirm('  ?')) {\n      setItems(initialItems);\n    }\n  };\n\n  //    \n  const handleMerge = () => {\n    //    \n    if (beforeMergeItems) {\n      setItems(beforeMergeItems);\n      setBeforeMergeItems(null);\n      onMergeStateChange?.(false);\n      toast.success(' .');\n      return;\n    }\n    \n    // +  \n    const grouped = new Map<string, BOMItem[]>();\n    \n    items.forEach(item => {\n      // \" \"   \n      if (item.itemName.includes(' ') || item.itemType === ' ') {\n        const uniqueKey = `__unique__${item.lineNumber}`;\n        grouped.set(uniqueKey, [item]);\n        return;\n      }\n      \n      const key = `${item.itemType}|${item.itemName}`;\n      if (!grouped.has(key)) {\n        grouped.set(key, []);\n      }\n      grouped.get(key)!.push(item);\n    });\n    \n    //    \n    let mergeCount = 0;\n    grouped.forEach(groupItems => {\n      if (groupItems.length > 1) mergeCount++;\n    });\n    \n    if (mergeCount === 0) {\n      toast.info('     .');\n      return;\n    }\n    \n    if (!confirm(` +  ${mergeCount} ?`)) {\n      return;\n    }\n    \n    //    \n    setBeforeMergeItems([...items]);\n    \n    //  \n    const mergedItems: BOMItem[] = [];\n    let lineNumber = 1;\n    \n    grouped.forEach(groupItems => {\n      if (groupItems.length === 1) {\n        //  \n        mergedItems.push({ ...groupItems[0], lineNumber: lineNumber++ });\n      } else {\n        // \n        const first = groupItems[0];\n        const mergedRefs = groupItems.map(i => i.refList).join(', ');\n        const mergedSetCount = groupItems.reduce((sum, i) => sum + (i.setCount || 0), 0);\n        const mergedTotalQty = groupItems.reduce((sum, i) => sum + (i.totalQuantity || 0), 0);\n        \n        mergedItems.push({\n          ...first,\n          lineNumber: lineNumber++,\n          refList: mergedRefs,\n          setCount: mergedSetCount,\n          totalQuantity: mergedTotalQty,\n        });\n      }\n    });\n    \n    setItems(mergedItems);\n    onMergeStateChange?.(true);\n    toast.success(`${mergeCount}   .`);\n  };\n\n  //   (DB )\n  const handleSave = () => {\n    onSave(items);\n  };\n\n  //     \n  useImperativeHandle(ref, () => ({\n    handleDownload,\n    handleSave,\n    handleReset,\n    handleMerge,\n    isMerged: () => beforeMergeItems !== null\n  }));\n\n  //   \n  const handleCellChange = (index: number, field: keyof BOMItem, value: string) => {\n    const newItems = [...items];\n    const item = { ...newItems[index] };\n    \n    //   \n    if (field === 'setCount' || field === 'totalQuantity' || field === 'stockQuantity') {\n      (item as any)[field] = Number(value) || 0;\n    } else if (field === 'refList') {\n      (item as any)[field] = value;\n    } else {\n      (item as any)[field] = value;\n    }\n    \n    //      \n    if (field === 'itemName' && value && value !== '  (  )') {\n      item.isManualRequired = false;\n    }\n    if (field === 'itemType' && value && value !== ' ') {\n      item.isNewPart = false;\n    }\n    \n    newItems[index] = item;\n    setItems(newItems);\n\n    // /     \n    if (field === 'itemType' || field === 'itemName') {\n      onBomChange?.(newItems);\n    }\n  };\n\n  const parseRefs = (refList?: string) =>\n    (refList || '')\n      .split(',')\n      .map(r => r.trim())\n      .filter(Boolean);\n\n  const handleDeleteRow = (item: BOMItem) => {\n    const refs = parseRefs(item.refList);\n    if (!refs.length) return;\n    const ok = window.confirm(\n      `  ?\\n\\n: ${item.itemName || '-'}\\nREF: ${refs.join(', ')}`\n    );\n    if (!ok) return;\n    onDeleteRefs?.(refs);\n  };\n\n  //   \n  const getRowClassName = (item: BOMItem) => {\n    if (item.isManualRequired) return 'bg-yellow-50 hover:bg-yellow-100';\n    // BOM     ()\n    if (hasMissingCoordinate(item)) return 'bg-red-50 hover:bg-red-100';\n    //      ()\n    if (item.isNewPart) return 'bg-gray-100 hover:bg-gray-200';\n    if (item.remark === '') return 'bg-gray-50 hover:bg-gray-100';\n    return 'hover:bg-gray-50';\n  };\n\n  return (\n    <div className=\"space-y-3\">\n\n      {/*  */}\n      <div className=\"border rounded-lg overflow-hidden bg-white shadow-sm w-full\">\n        <div className=\"overflow-x-auto w-full max-w-full\">\n          <Table className=\"w-full\" style={{ tableLayout: 'fixed' }}>\n            <TableHeader className=\"bg-gray-50 sticky top-0 z-10\">\n              <TableRow className=\"h-6\">\n                <TableHead className=\"text-center !h-auto !py-0.5 !px-2\" style={{ width: `${maxNoWidth}px` }}>\n                  <span className=\"card-description\">No</span>\n                </TableHead>\n                <TableHead className=\"text-center whitespace-nowrap !h-auto !py-0.5 !px-2\" style={{ width: `${maxTypeWidth}px` }}>\n                  <span className=\"card-description\"></span>\n                </TableHead>\n                <TableHead className=\"whitespace-nowrap !h-auto !py-0.5 !px-2\" style={{ width: `${maxNameWidth}px` }}>\n                  <span className=\"card-description\"></span>\n                </TableHead>\n                <TableHead className=\"w-[60px] text-center !h-auto !py-0.5 !px-2\">\n                  <span className=\"card-description\">SET</span>\n                </TableHead>\n                <TableHead className=\"w-[70px] text-center !h-auto !py-0.5 !px-2\">\n                  <span className=\"card-description\"></span>\n                </TableHead>\n                <TableHead className=\"w-[60px] text-center hidden sm:table-cell !h-auto !py-0.5 !px-2\">\n                  <span className=\"card-description\"></span>\n                </TableHead>\n                <TableHead className=\"!h-auto !py-0.5 !px-2\" style={{ width: `${Math.min(maxRefWidth, 350)}px` }}>\n                  <span className=\"card-description\">REF</span>\n                </TableHead>\n                <TableHead className=\"hidden md:table-cell !h-auto !py-0.5 !px-2\" style={{ width: '240px' }}>\n                  <span className=\"card-description\"></span>\n                </TableHead>\n                <TableHead className=\"!h-auto !py-0.5 !px-2\">\n                  <span className=\"card-description\"></span>\n                </TableHead>\n                <TableHead className=\"w-[46px] text-center !h-auto !py-0.5 !px-1\">\n                  <span className=\"card-description\"></span>\n                </TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {items.map((item, index) => (\n                <TableRow key={index} className={getRowClassName(item)}>\n                  <TableCell className=\"text-center py-1 px-2\">\n                    <div className=\"card-subtitle\">{index + 1}</div>\n                  </TableCell>\n                  \n                  {/*  */}\n                  <TableCell className=\"text-center py-1 px-1 whitespace-nowrap\">\n                    <input \n                      type=\"text\"\n                      className={`w-full text-[10px] text-gray-600 text-center border border-transparent hover:border-gray-200 focus:border-primary focus:outline-none rounded px-1 ${\n                        item.itemType === ' ' ? '!text-red-500 font-bold bg-red-50' : 'bg-transparent'\n                      }`}\n                      style={{ fontSize: '10px', height: '24px' }}\n                      value={item.itemType || ''}\n                      onChange={(e) => handleCellChange(index, 'itemType', e.target.value)}\n                      placeholder=\"\"\n                    />\n                  </TableCell>\n\n                  {/*  */}\n                  <TableCell className=\"py-1 px-1 whitespace-nowrap\">\n                    <input \n                      type=\"text\"\n                      className={`w-full text-[10px] border border-transparent hover:border-gray-200 focus:border-primary focus:outline-none rounded px-1 ${\n                        hasMissingCoordinate(item)\n                          ? 'text-gray-500 bg-red-50'\n                          : item.isNewPart \n                            ? 'text-gray-500 bg-gray-100' \n                            : item.isManualRequired \n                              ? 'text-red-600 bg-yellow-50' \n                              : 'text-gray-500 bg-transparent'\n                      }`}\n                      style={{ fontSize: '10px', height: '24px' }}\n                      value={item.itemName}\n                      onChange={(e) => handleCellChange(index, 'itemName', e.target.value)}\n                      placeholder=\" \"\n                      title={item.originalFootprint ? `: ${item.originalFootprint}` : ''}\n                    />\n                  </TableCell>\n\n                  {/* SET */}\n                  <TableCell className=\"text-center py-1 px-2\">\n                    <input \n                      type=\"number\"\n                      className=\"w-full text-[10px] font-medium text-gray-900 text-center border border-transparent hover:border-gray-200 focus:border-primary focus:outline-none rounded bg-transparent px-1\"\n                      style={{ fontSize: '10px', height: '24px' }}\n                      value={item.setCount}\n                      onChange={(e) => handleCellChange(index, 'setCount', e.target.value)}\n                    />\n                  </TableCell>\n\n                  {/*  */}\n                  <TableCell className=\"text-center py-1 px-2\">\n                    <input \n                      type=\"number\"\n                      className=\"w-full text-[10px] font-bold text-gray-900 text-center border border-transparent hover:border-gray-200 focus:border-primary focus:outline-none rounded bg-gray-50 px-1\"\n                      style={{ fontSize: '10px', height: '24px' }}\n                      value={item.totalQuantity}\n                      readOnly\n                      onChange={(e) => handleCellChange(index, 'totalQuantity', e.target.value)}\n                    />\n                  </TableCell>\n\n                  {/*  */}\n                  <TableCell className=\"hidden sm:table-cell text-center py-1 px-2\">\n                    <input \n                      type=\"number\"\n                      className=\"w-full text-[10px] font-medium text-gray-900 text-center border border-transparent hover:border-gray-200 focus:border-primary focus:outline-none rounded bg-transparent px-1\"\n                      style={{ fontSize: '10px', height: '24px' }}\n                      value={item.stockQuantity || ''}\n                      placeholder=\"0\"\n                      onChange={(e) => handleCellChange(index, 'stockQuantity', e.target.value)}\n                    />\n                  </TableCell>\n\n                  {/* REF */}\n                  <TableCell className=\"px-1 py-1 align-middle\">\n                    <div\n                      contentEditable\n                      suppressContentEditableWarning\n                      className=\"text-[10px] text-gray-600 outline-none w-full\"\n                      style={{ \n                        lineHeight: '14px',\n                        wordWrap: 'break-word',\n                        overflowWrap: 'break-word',\n                        whiteSpace: 'pre-wrap'\n                      }}\n                      onBlur={(e) => handleCellChange(index, 'refList', e.currentTarget.textContent || '')}\n                    >\n                      {(item.refList || '').split(',').map(r => r.trim()).filter(r => r).join(', ')}\n                    </div>\n                  </TableCell>\n\n                  {/*  */}\n                  <TableCell className=\"hidden md:table-cell py-1 px-2\">\n                    <input \n                      type=\"text\"\n                      className=\"w-full text-[10px] text-gray-500 px-1 border border-transparent hover:border-gray-200 focus:border-primary focus:outline-none rounded bg-transparent\"\n                      style={{ fontSize: '10px', height: '24px' }}\n                      value={item.alternativeItem || ''}\n                      onChange={(e) => handleCellChange(index, 'alternativeItem', e.target.value)}\n                    />\n                  </TableCell>\n\n                  {/*  */}\n                  <TableCell className=\"py-1 px-2\">\n                    <input \n                      type=\"text\"\n                      className={`w-full text-[10px] text-gray-500 px-1 border border-transparent hover:border-gray-200 focus:border-primary focus:outline-none rounded ${\n                        item.remark === '' ? '!text-gray-500 font-bold bg-gray-50' : 'bg-transparent'\n                      }`}\n                      style={{ fontSize: '10px', height: '24px' }}\n                      value={item.remark || ''}\n                      onChange={(e) => handleCellChange(index, 'remark', e.target.value)}\n                    />\n                  </TableCell>\n\n                  {/*  */}\n                  <TableCell className=\"text-center py-1 px-1\">\n                    <Button\n                      type=\"button\"\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      className=\"h-6 w-6\"\n                      onClick={() => handleDeleteRow(item)}\n                      title=\" \"\n                    >\n                      <Trash2 className=\"w-3.5 h-3.5 text-red-600\" />\n                    </Button>\n                  </TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n            {/*  -     */}\n            <tfoot className=\"bg-gray-50 border-t\">\n              <tr>\n                {/* No  */}\n                <td className=\"py-2 px-2\">\n                  <span className=\"card-description whitespace-nowrap\"> {items.length} </span>\n                </td>\n                {/*  */}\n                <td></td>\n                {/*  -   */}\n                <td className=\"text-right pr-2\">\n                  <span className=\"card-description\">:</span>\n                </td>\n                {/* SET -   */}\n                <td className=\"text-center py-2\">\n                  <span className=\"text-[11px] text-gray-700\">{totalSetCount}</span>\n                </td>\n                {/*  */}\n                <td></td>\n                {/*  */}\n                <td className=\"hidden sm:table-cell\"></td>\n                {/* REF */}\n                <td></td>\n                {/*  */}\n                <td className=\"hidden md:table-cell\"></td>\n                {/*  +  */}\n                <td className=\"py-2 px-2 text-right\">\n                  <div className=\"flex gap-4 card-description justify-end whitespace-nowrap\">\n                    <span className=\"flex items-center gap-1\">\n                      <span className=\"w-3 h-3 bg-yellow-100 border border-yellow-300 rounded\"></span>\n                       \n                    </span>\n                    <span className=\"flex items-center gap-1\">\n                      <span className=\"w-3 h-3 bg-red-50 border border-red-200 rounded\"></span>\n                      \n                    </span>\n                  </div>\n                </td>\n                {/*  */}\n                <td></td>\n              </tr>\n            </tfoot>\n          </Table>\n        </div>\n      </div>\n    </div>\n  );\n});\n\nGeneratedPreviewPanel.displayName = 'GeneratedPreviewPanel';\n\nexport default GeneratedPreviewPanel;\n","import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { type CoordinateItem, type BOMItem } from '@/utils/v7-generator';\nimport { useCallback, useEffect, useMemo, useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Trash2 } from 'lucide-react';\n\ninterface CoordinatePreviewPanelProps {\n  coordinates: CoordinateItem[];\n  bomItems?: BOMItem[];\n  onCoordinatesChange?: (nextCoordinates: CoordinateItem[]) => void;\n  onDeleteRef?: (refDes: string) => void;\n}\n\nexport default function CoordinatePreviewPanel({\n  coordinates,\n  bomItems = [],\n  onCoordinatesChange,\n  onDeleteRef,\n}: CoordinatePreviewPanelProps) {\n  const [localCoordinates, setLocalCoordinates] = useState<CoordinateItem[]>(coordinates);\n\n  const normalizeLayer = useCallback((layer?: string | null) => {\n    const v = (layer || '').trim().toUpperCase();\n    if (!v) return '';\n    if (v === 'TOP' || v === 'T' || v === 'TOPSIDE' || v === 'FRONT' || v === 'F') return 'TOP';\n    if (v === 'BOTTOM' || v === 'BOT' || v === 'B' || v === 'BOTTOMSIDE' || v === 'BACK') return 'BOTTOM';\n    return v;\n  }, []);\n\n  // props   \n  useEffect(() => {\n    // layer  TOP/BOTTOM    select     \n    setLocalCoordinates(\n      coordinates.map(c => ({\n        ...c,\n        layer: normalizeLayer(c.layer) || c.layer,\n      }))\n    );\n  }, [coordinates, normalizeLayer]);\n\n  const handleUpdateCoord = useCallback(\n    (coordIndex: number, patch: Partial<CoordinateItem>) => {\n      setLocalCoordinates(prev => {\n        const next = [...prev];\n        next[coordIndex] = { ...next[coordIndex], ...patch };\n        onCoordinatesChange?.(next);\n        return next;\n      });\n    },\n    [onCoordinatesChange]\n  );\n\n  const handleDeleteCoord = useCallback(\n    (coordIndex: number, refDes: string) => {\n      //  UI  (  )\n      setLocalCoordinates(prev => prev.filter((_, i) => i !== coordIndex));\n      // BOM/    \n      onDeleteRef?.(refDes);\n    },\n    [onDeleteRef]\n  );\n\n  // BOM REF Set  (  )\n  const bomRefSet = useMemo(() => {\n    const refSet = new Set<string>();\n    bomItems.forEach((item: BOMItem) => {\n      if (item.refList) {\n        const refs = item.refList.split(',').map(r => r.trim().toUpperCase()).filter(Boolean);\n        refs.forEach(ref => refSet.add(ref));\n      }\n    });\n    return refSet;\n  }, [bomItems]);\n\n  // BOM \"  \"  REF Set (  )\n  const manualRefSet = useMemo(() => {\n    const refSet = new Set<string>();\n    bomItems.forEach((item: BOMItem) => {\n      if (!item.isManualRequired) return;\n      const refs = (item.refList || '').split(',').map(r => r.trim().toUpperCase()).filter(Boolean);\n      refs.forEach(ref => refSet.add(ref));\n    });\n    return refSet;\n  }, [bomItems]);\n\n  const topRows = useMemo(\n    () =>\n      localCoordinates\n        .map((coord, index) => ({ coord, index }))\n        .filter(r => normalizeLayer(r.coord.layer) === 'TOP'),\n    [localCoordinates]\n  );\n\n  const bottomRows = useMemo(\n    () =>\n      localCoordinates\n        .map((coord, index) => ({ coord, index }))\n        .filter(r => normalizeLayer(r.coord.layer) === 'BOTTOM'),\n    [localCoordinates]\n  );\n\n  return (\n    <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4 w-full\">\n      {/* : TOP */}\n      <div className=\"w-full\">\n        <div className=\"mb-2 flex items-center gap-2\">\n          <h4 className=\"text-xs font-semibold text-gray-700\">TOP</h4>\n          <span className=\"badge-stats bg-gray-100 text-gray-600\">{topRows.length}</span>\n        </div>\n        <CoordinateTable\n          rows={topRows}\n          bomRefSet={bomRefSet}\n          manualRefSet={manualRefSet}\n          onUpdate={handleUpdateCoord}\n          onDelete={handleDeleteCoord}\n        />\n      </div>\n\n      {/* : BOTTOM */}\n      <div className=\"w-full\">\n        <div className=\"mb-2 flex items-center gap-2\">\n          <h4 className=\"text-xs font-semibold text-gray-700\">BOTTOM</h4>\n          <span className=\"badge-stats bg-gray-100 text-gray-600\">{bottomRows.length}</span>\n        </div>\n        <CoordinateTable\n          rows={bottomRows}\n          bomRefSet={bomRefSet}\n          manualRefSet={manualRefSet}\n          onUpdate={handleUpdateCoord}\n          onDelete={handleDeleteCoord}\n        />\n      </div>\n    </div>\n  );\n}\n\nfunction CoordinateTable({\n  rows,\n  bomRefSet,\n  manualRefSet,\n  onUpdate,\n  onDelete,\n}: {\n  rows: Array<{ coord: CoordinateItem; index: number }>;\n  bomRefSet: Set<string>;\n  manualRefSet: Set<string>;\n  onUpdate: (coordIndex: number, patch: Partial<CoordinateItem>) => void;\n  onDelete?: (coordIndex: number, refDes: string) => void;\n}) {\n  const totalCount = rows.length;\n  const normalizeLayer = (layer?: string | null) => {\n    const v = (layer || '').trim().toUpperCase();\n    if (!v) return '';\n    if (v === 'TOP' || v === 'T' || v === 'TOPSIDE' || v === 'FRONT' || v === 'F') return 'TOP';\n    if (v === 'BOTTOM' || v === 'BOT' || v === 'B' || v === 'BOTTOMSIDE' || v === 'BACK') return 'BOTTOM';\n    return v;\n  };\n  const defaultLayerForTable: 'TOP' | 'BOTTOM' = rows[0]?.coord?.layer === 'BOTTOM' ? 'BOTTOM' : 'TOP';\n  \n  return (\n    <div className=\"border rounded-lg overflow-hidden bg-white shadow-sm w-full\">\n      <div className=\"overflow-x-auto w-full max-w-full\">\n        <Table className=\"w-full table-auto\">\n        <TableHeader className=\"bg-gray-50 sticky top-0 z-10\">\n            <TableRow className=\"h-6\">\n              <TableHead className=\"w-[50px] text-center !h-auto !py-0.5 !px-2\">\n                <span className=\"card-description\">No</span>\n              </TableHead>\n              <TableHead className=\"text-center whitespace-nowrap !h-auto !py-0.5 !px-2\" style={{ minWidth: '80px' }}>\n                <span className=\"card-description\"></span>\n              </TableHead>\n              <TableHead className=\"whitespace-nowrap !h-auto !py-0.5 !px-2\" style={{ minWidth: '120px' }}>\n                <span className=\"card-description\"></span>\n              </TableHead>\n              <TableHead className=\"w-[80px] text-center !h-auto !py-0.5 !px-2\">\n                <span className=\"card-description\">RefDes</span>\n              </TableHead>\n              <TableHead className=\"w-[70px] text-center !h-auto !py-0.5 !px-2\">\n                <span className=\"card-description\">Layer</span>\n              </TableHead>\n              <TableHead className=\"w-[90px] text-center !h-auto !py-0.5 !px-2\">\n                <span className=\"card-description\">X</span>\n              </TableHead>\n              <TableHead className=\"w-[90px] text-center !h-auto !py-0.5 !px-2\">\n                <span className=\"card-description\">Y</span>\n              </TableHead>\n              <TableHead className=\"w-[70px] text-center !h-auto !py-0.5 !px-2\">\n                <span className=\"card-description\">Angle</span>\n              </TableHead>\n              <TableHead className=\"!h-auto !py-0.5 !px-2\" style={{ minWidth: '80px' }}>\n                <span className=\"card-description\"></span>\n              </TableHead>\n              <TableHead className=\"w-[46px] text-center !h-auto !py-0.5 !px-1\">\n                <span className=\"card-description\"></span>\n              </TableHead>\n          </TableRow>\n        </TableHeader>\n        <TableBody>\n          {rows.length === 0 ? (\n            <TableRow>\n                <TableCell colSpan={10} className=\"text-center py-6 card-description\">\n                 .\n              </TableCell>\n            </TableRow>\n          ) : (\n              rows.map(({ coord: item, index: coordIndex }, rowIndex) => {\n                const isMissingBom = item.remark === 'BOM ';\n                //   BOM   \n                const isMissingInBom = item.refDes && !bomRefSet.has(item.refDes.toUpperCase());\n                const isManualRequired = item.refDes && manualRefSet.has(item.refDes.toUpperCase());\n                \n                return (\n                <TableRow \n                  key={coordIndex} \n                  className={`hover:bg-gray-50 ${item.remark === '' ? 'bg-gray-50' : ''} ${isMissingBom || isMissingInBom ? 'bg-red-50/60' : ''} ${isManualRequired && !(isMissingBom || isMissingInBom) ? 'bg-yellow-50 hover:bg-yellow-100' : ''}`}\n                >\n                  <TableCell className=\"text-center py-1 px-2\">\n                    <span className=\"text-[10px] text-gray-500\">{rowIndex + 1}</span>\n                  </TableCell>\n                  <TableCell className=\"text-center py-1 px-1 whitespace-nowrap\">\n                    <input\n                      type=\"text\"\n                      className={`w-full text-[10px] text-center border border-transparent hover:border-gray-200 focus:border-primary focus:outline-none rounded px-1 ${\n                        isMissingBom || isMissingInBom\n                          ? 'text-red-600 font-medium bg-red-50/40'\n                          : isManualRequired\n                            ? 'text-red-600 bg-yellow-50'\n                            : 'text-gray-600 bg-transparent'\n                      }`}\n                      style={{ fontSize: '10px', height: '24px' }}\n                      value={item.type || ''}\n                      onChange={(e) => onUpdate(coordIndex, { type: e.target.value })}\n                      placeholder=\"-\"\n                    />\n                  </TableCell>\n                  <TableCell className=\"py-1 px-1 whitespace-nowrap\">\n                    <input\n                      type=\"text\"\n                      className={`w-full text-[10px] border border-transparent hover:border-gray-200 focus:border-primary focus:outline-none rounded px-1 ${\n                        item.remark === ''\n                          ? 'text-gray-400 bg-gray-50'\n                          : isMissingBom || isMissingInBom\n                            ? 'text-red-600 font-medium bg-red-50/40'\n                            : isManualRequired\n                              ? 'text-red-600 bg-yellow-50'\n                              : 'text-gray-600 bg-transparent'\n                      }`}\n                      style={{ fontSize: '10px', height: '24px' }}\n                      value={item.partName || ''}\n                      onChange={(e) => onUpdate(coordIndex, { partName: e.target.value })}\n                      placeholder=\"-\"\n                    />\n                  </TableCell>\n                  <TableCell className=\"text-center py-1 px-2\">\n                    <input\n                      type=\"text\"\n                      className={`w-full text-[10px] text-center border border-transparent hover:border-gray-200 focus:border-primary focus:outline-none rounded px-1 ${\n                        isMissingBom || isMissingInBom\n                          ? 'text-red-700 font-medium bg-red-50/40'\n                          : isManualRequired\n                            ? 'text-red-700 bg-yellow-50'\n                            : 'text-gray-900 bg-transparent'\n                      }`}\n                      style={{ fontSize: '10px', height: '24px' }}\n                      value={item.refDes || ''}\n                      onChange={(e) => onUpdate(coordIndex, { refDes: e.target.value })}\n                      placeholder=\"-\"\n                    />\n                </TableCell>\n                  <TableCell className=\"text-center py-1 px-2\">\n                    <select\n                      className={`w-full text-[10px] text-center border border-gray-200 rounded px-1 h-6 bg-white ${\n                        isMissingBom || isMissingInBom\n                          ? 'text-red-700 border-red-200 bg-red-50/40'\n                          : isManualRequired\n                            ? 'text-red-700 border-yellow-300 bg-yellow-50'\n                            : 'text-gray-700'\n                      }`}\n                      value={normalizeLayer(item.layer) || defaultLayerForTable}\n                      onChange={(e) => onUpdate(coordIndex, { layer: e.target.value })}\n                    >\n                      <option value=\"TOP\">TOP</option>\n                      <option value=\"BOTTOM\">BOTTOM</option>\n                    </select>\n                </TableCell>\n                  <TableCell className=\"text-center py-1 px-2\">\n                    <input\n                      type=\"number\"\n                      inputMode=\"decimal\"\n                      step=\"0.01\"\n                      className={`w-full text-[10px] font-mono text-center border border-transparent hover:border-gray-200 focus:border-primary focus:outline-none rounded px-1 ${\n                        isMissingBom || isMissingInBom\n                          ? 'text-red-600 bg-red-50/40'\n                          : isManualRequired\n                            ? 'text-red-600 bg-yellow-50'\n                            : 'text-gray-600 bg-transparent'\n                      }`}\n                      style={{ fontSize: '10px', height: '24px' }}\n                      value={Number.isFinite(item.locationX) ? item.locationX : 0}\n                      onChange={(e) => {\n                        const next = Number(e.target.value);\n                        onUpdate(coordIndex, { locationX: Number.isFinite(next) ? next : item.locationX });\n                      }}\n                    />\n                  </TableCell>\n                  <TableCell className=\"text-center py-1 px-2\">\n                    <input\n                      type=\"number\"\n                      inputMode=\"decimal\"\n                      step=\"0.01\"\n                      className={`w-full text-[10px] font-mono text-center border border-transparent hover:border-gray-200 focus:border-primary focus:outline-none rounded px-1 ${\n                        isMissingBom || isMissingInBom\n                          ? 'text-red-600 bg-red-50/40'\n                          : isManualRequired\n                            ? 'text-red-600 bg-yellow-50'\n                            : 'text-gray-600 bg-transparent'\n                      }`}\n                      style={{ fontSize: '10px', height: '24px' }}\n                      value={Number.isFinite(item.locationY) ? item.locationY : 0}\n                      onChange={(e) => {\n                        const next = Number(e.target.value);\n                        onUpdate(coordIndex, { locationY: Number.isFinite(next) ? next : item.locationY });\n                      }}\n                    />\n                  </TableCell>\n                  <TableCell className=\"text-center py-1 px-2\">\n                    <input\n                      type=\"number\"\n                      inputMode=\"decimal\"\n                      step=\"0.01\"\n                      className={`w-full text-[10px] font-mono text-center border border-transparent hover:border-gray-200 focus:border-primary focus:outline-none rounded px-1 ${\n                        isMissingBom || isMissingInBom\n                          ? 'text-red-600 bg-red-50/40'\n                          : isManualRequired\n                            ? 'text-red-600 bg-yellow-50'\n                            : 'text-gray-600 bg-transparent'\n                      }`}\n                      style={{ fontSize: '10px', height: '24px' }}\n                      value={Number.isFinite(item.rotation) ? item.rotation : 0}\n                      onChange={(e) => {\n                        const next = Number(e.target.value);\n                        onUpdate(coordIndex, { rotation: Number.isFinite(next) ? next : item.rotation });\n                      }}\n                    />\n                  </TableCell>\n                  <TableCell className=\"py-1 px-2\">\n                    <input\n                      type=\"text\"\n                      className={`w-full text-[10px] border border-transparent hover:border-gray-200 focus:border-primary focus:outline-none rounded px-1 ${\n                        item.remark === ''\n                          ? 'text-red-500 font-medium bg-gray-50'\n                          : isMissingBom || isMissingInBom\n                            ? 'text-red-600 font-medium bg-red-50/40'\n                            : 'text-gray-500 bg-transparent'\n                      }`}\n                      style={{ fontSize: '10px', height: '24px' }}\n                      value={item.remark || ''}\n                      onChange={(e) => onUpdate(coordIndex, { remark: e.target.value })}\n                      placeholder={isMissingInBom && !isMissingBom ? 'BOM ' : ''}\n                    />\n                  </TableCell>\n\n                  {/*  */}\n                  <TableCell className=\"text-center py-1 px-1\">\n                    <Button\n                      type=\"button\"\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      className=\"h-6 w-6\"\n                      disabled={!item.refDes}\n                      onClick={() => {\n                        if (!item.refDes) return;\n                        const ok = window.confirm(`   ?\\n\\nRefDes: ${item.refDes}`);\n                        if (!ok) return;\n                        onDelete?.(coordIndex, item.refDes);\n                      }}\n                      title=\" \"\n                    >\n                      <Trash2 className=\"w-3.5 h-3.5 text-red-600\" />\n                    </Button>\n                  </TableCell>\n              </TableRow>\n              )})\n          )}\n        </TableBody>\n          {/*  */}\n          <tfoot className=\"bg-gray-50 border-t\">\n            <tr>\n              <td colSpan={10} className=\"py-2 px-2\">\n                <div className=\"flex justify-between items-center\">\n                  <span className=\"card-description\"> {totalCount} </span>\n                  <div className=\"flex gap-4 card-description\">\n                    <span className=\"flex items-center gap-1\">\n                      <span className=\"w-3 h-3 bg-yellow-100 border border-yellow-300 rounded\"></span>\n                       \n                    </span>\n                    <span className=\"flex items-center gap-1\">\n                      <span className=\"w-3 h-3 bg-gray-100 border border-gray-300 rounded\"></span>\n                      \n                    </span>\n                    <span className=\"flex items-center gap-1\">\n                      <span className=\"w-3 h-3 bg-red-50 border border-red-200 rounded\"></span>\n                      BOM \n                    </span>\n                  </div>\n                </div>\n              </td>\n            </tr>\n          </tfoot>\n      </Table>\n      </div>\n    </div>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport { createClient } from '@/lib/supabase/client';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\n// native table   (sticky header  )\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { Loader2, Download } from 'lucide-react';\nimport { toast } from 'sonner';\nimport { \n  generateBOMExcelFromTemplate, \n  downloadExcelBlob,\n  type ExcelMetadata \n} from '@/utils/excel-generator';\nimport { type BOMItem, type CoordinateItem, sortBOMItems, sortCoordinateItems } from '@/utils/v7-generator';\n\ninterface BomDetailModalProps {\n  boardId: string | null;\n  isOpen: boolean;\n  onClose: () => void;\n}\n\ninterface BoardData {\n  id: string;\n  board_name: string;\n  artwork_manager: string;\n  production_manager: string;\n  production_quantity: number;\n  created_at: string;\n  bomItems: BOMItem[];\n  topCoordinates: CoordinateItem[];\n  bottomCoordinates: CoordinateItem[];\n}\n\nexport default function BomDetailModal({ boardId, isOpen, onClose }: BomDetailModalProps) {\n  const [loading, setLoading] = useState(false);\n  const [boardData, setBoardData] = useState<BoardData | null>(null);\n  const [downloading, setDownloading] = useState(false);\n  \n  const supabase = createClient();\n\n  useEffect(() => {\n    if (isOpen && boardId) {\n      loadBoardData();\n    }\n  }, [isOpen, boardId]);\n\n  const loadBoardData = async () => {\n    if (!boardId) return;\n    \n    setLoading(true);\n    try {\n      //   \n      const { data: board, error: boardError } = await supabase\n        .from('cad_drawings')\n        .select('*')\n        .eq('id', boardId)\n        .single();\n      \n      if (boardError) throw boardError;\n\n      // BOM  \n      const { data: bomItems, error: bomError } = await supabase\n        .from('bom_items')\n        .select('*')\n        .eq('cad_drawing_id', boardId)\n        .order('line_number');\n      \n      if (bomError) throw bomError;\n\n      //   \n      const { data: coordinates, error: coordError } = await supabase\n        .from('part_placements')\n        .select('*')\n        .eq('cad_drawing_id', boardId);\n      \n      if (coordError) throw coordError;\n\n      // BOM  \n      const convertedBOMItems: BOMItem[] = (bomItems || []).map((item: any) => ({\n        lineNumber: item.line_number,\n        itemType: item.item_type || '',\n        itemName: item.item_name || '',\n        setCount: item.set_count || 0,\n        totalQuantity: item.total_quantity || 0,\n        stockQuantity: item.stock_quantity || 0,\n        checkStatus: item.check_status || '',\n        // refList   \n        refList: Array.isArray(item.ref_list) \n          ? item.ref_list.join(', ') \n          : (item.ref_list || ''),\n        alternativeItem: item.alternative_item || '',\n        remark: item.remark || '',\n        isManualRequired: item.is_manual_required || false,\n        isNewPart: item.is_new_part || false,\n        originalPart: item.original_part || '',\n        originalFootprint: item.original_footprint || '',\n      }));\n\n      //   (DB  )\n      const topCoords: CoordinateItem[] = [];\n      const bottomCoords: CoordinateItem[] = [];\n      \n      (coordinates || []).forEach((coord: any) => {\n        const coordItem: CoordinateItem = {\n          refDes: coord.ref || '',           // DB: ref\n          type: coord.part_type || '',       // DB: part_type\n          partName: coord.part_name || '',   // DB: part_name\n          layer: coord.side || 'TOP',        // DB: side\n          locationX: coord.x_coordinate || 0, // DB: x_coordinate\n          locationY: coord.y_coordinate || 0, // DB: y_coordinate\n          rotation: coord.angle || 0,        // DB: angle\n          remark: coord.remark || '',\n        };\n        \n        if (coord.side === 'TOP') {\n          topCoords.push(coordItem);\n        } else {\n          bottomCoords.push(coordItem);\n        }\n      });\n\n      setBoardData({\n        id: board.id,\n        board_name: board.board_name,\n        artwork_manager: board.artwork_manager || '',\n        production_manager: board.production_manager || '',\n        production_quantity: board.production_quantity || 0,\n        created_at: board.created_at,\n        bomItems: convertedBOMItems,\n        topCoordinates: topCoords,\n        bottomCoordinates: bottomCoords,\n      });\n    } catch (error) {\n      console.error('Error loading board data:', error);\n      toast.error('  .');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleDownloadExcel = async () => {\n    if (!boardData) return;\n    \n    setDownloading(true);\n    try {\n      const excelMetadata: ExcelMetadata = {\n        boardName: boardData.board_name,\n        artworkManager: boardData.artwork_manager,\n        productionManager: boardData.production_manager,\n        productionQuantity: boardData.production_quantity,\n      };\n\n      //   ( >  >   )\n      const sortedBomItems = sortBOMItems(boardData.bomItems);\n      const sortedTopCoords = sortCoordinateItems(boardData.topCoordinates);\n      const sortedBottomCoords = sortCoordinateItems(boardData.bottomCoordinates);\n\n      const blob = await generateBOMExcelFromTemplate(\n        sortedBomItems,\n        sortedTopCoords,\n        sortedBottomCoords,\n        excelMetadata\n      );\n\n      //  \n      const today = new Date();\n      const dateStr = today.getFullYear().toString().slice(2) + \n        String(today.getMonth() + 1).padStart(2, '0') + \n        String(today.getDate()).padStart(2, '0');\n      const cleanName = boardData.board_name.trim()\n        .replace(/_\\d{6}_$/, '')\n        .replace(/_$/, '')\n        .replace(/_\\d{6}$/, '');\n      const fileName = `${cleanName}_${dateStr}_.xlsx`;\n\n      await downloadExcelBlob(blob, fileName);\n      toast.success('  .');\n    } catch (error) {\n      console.error('Excel download error:', error);\n      toast.error('  .');\n    } finally {\n      setDownloading(false);\n    }\n  };\n\n  //    ( )\n  const checkIsMisap = (itemName: string, remark: string) => {\n    const nameUpper = (itemName || '').toUpperCase();\n    const remarkUpper = (remark || '').toUpperCase();\n    return remarkUpper.includes('') || \n      nameUpper.includes('_OPEN') || nameUpper.includes('OPEN_') ||\n      nameUpper.includes('_POGO') || nameUpper.includes('POGO_') ||\n      nameUpper.includes('_PAD') || nameUpper.includes('PAD_') ||\n      nameUpper.includes('_NC') || nameUpper.includes('NC_');\n  };\n\n  //  \n  const cleanBoardName = (name: string) => {\n    return (name || '').trim()\n      .replace(/_\\d{6}_$/, '')\n      .replace(/_$/, '')\n      .replace(/_\\d{6}$/, '');\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <Dialog open={isOpen} onOpenChange={(open) => !open && onClose()}>\n      <DialogContent maxWidth=\"max-w-fit\" showCloseButton={false} className=\"w-fit min-w-[600px] max-w-[90vw] max-h-[90vh] overflow-hidden flex flex-col p-4\">\n        <DialogHeader className=\"flex-shrink-0 !p-0 !border-0\">\n          <div className=\"flex justify-between items-start\">\n            <div>\n              <DialogTitle className=\"text-lg font-semibold text-gray-900\">\n                {boardData ? cleanBoardName(boardData.board_name) : ' ...'}\n              </DialogTitle>\n              {boardData && (\n                <div className=\"flex gap-4 mt-1 text-xs text-gray-500\">\n                  <span>Artwork: {boardData.artwork_manager || '-'}</span>\n                  <span>: {boardData.production_manager || '-'}</span>\n                  <span>: {boardData.production_quantity}</span>\n                </div>\n              )}\n            </div>\n            <div className=\"flex gap-2\">\n              <Button\n                onClick={handleDownloadExcel}\n                disabled={downloading || !boardData}\n                className=\"h-8 px-3 text-xs bg-green-600 hover:bg-green-700 text-white\"\n              >\n                {downloading ? (\n                  <Loader2 className=\"w-3 h-3 animate-spin mr-1\" />\n                ) : (\n                  <Download className=\"w-3 h-3 mr-1\" />\n                )}\n                Excel \n              </Button>\n            </div>\n          </div>\n        </DialogHeader>\n\n        <div className=\"flex-1 overflow-hidden mt-3\">\n          {loading ? (\n            <div className=\"flex items-center justify-center h-64\">\n              <Loader2 className=\"w-6 h-6 text-hansl-600 animate-spin mr-2\" />\n              <span className=\"text-sm text-gray-600\">  ...</span>\n            </div>\n          ) : boardData ? (\n            <Tabs defaultValue=\"bom\" className=\"h-full flex flex-col\">\n              <TabsList className=\"flex-shrink-0 mb-3 grid grid-cols-3 h-8 bg-gray-100 p-1 business-radius-button\">\n                <TabsTrigger \n                  value=\"bom\" \n                  className=\"text-[10px] h-7 data-[state=active]:bg-white data-[state=active]:text-hansl-600 data-[state=active]:shadow-sm\"\n                >\n                   BOM\n                  <span className=\"ml-1 badge-stats bg-gray-100 text-gray-600 data-[state=active]:bg-hansl-50 data-[state=active]:text-hansl-700\">\n                    {boardData.bomItems.length}\n                  </span>\n                </TabsTrigger>\n                <TabsTrigger \n                  value=\"top\" \n                  className=\"text-[10px] h-7 data-[state=active]:bg-white data-[state=active]:text-hansl-600 data-[state=active]:shadow-sm\"\n                >\n                  TOP\n                  <span className=\"ml-1 badge-stats bg-gray-100 text-gray-600 data-[state=active]:bg-hansl-50 data-[state=active]:text-hansl-700\">\n                    {boardData.topCoordinates.length}\n                  </span>\n                </TabsTrigger>\n                <TabsTrigger \n                  value=\"bottom\" \n                  className=\"text-[10px] h-7 data-[state=active]:bg-white data-[state=active]:text-hansl-600 data-[state=active]:shadow-sm\"\n                >\n                  BOTTOM\n                  <span className=\"ml-1 badge-stats bg-gray-100 text-gray-600 data-[state=active]:bg-orange-50 data-[state=active]:text-orange-700\">\n                    {boardData.bottomCoordinates.length}\n                  </span>\n                </TabsTrigger>\n              </TabsList>\n\n              {/* BOM  */}\n              <TabsContent value=\"bom\" className=\"flex-1 overflow-auto mt-0\">\n                <BOMTable items={boardData.bomItems} checkIsMisap={checkIsMisap} productionQuantity={boardData.production_quantity} />\n              </TabsContent>\n\n              {/* TOP  */}\n              <TabsContent value=\"top\" className=\"flex-1 overflow-auto mt-0\">\n                <CoordinateTable coordinates={boardData.topCoordinates} bomItems={boardData.bomItems} checkIsMisap={checkIsMisap} />\n              </TabsContent>\n\n              {/* BOTTOM  */}\n              <TabsContent value=\"bottom\" className=\"flex-1 overflow-auto mt-0\">\n                <CoordinateTable coordinates={boardData.bottomCoordinates} bomItems={boardData.bomItems} checkIsMisap={checkIsMisap} />\n              </TabsContent>\n            </Tabs>\n          ) : (\n            <div className=\"flex items-center justify-center h-64 text-gray-500\">\n                 .\n            </div>\n          )}\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\n// ============================================================================\n// BOM   (GeneratedPreviewPanel 100%  )\n// ============================================================================\nfunction BOMTable({ \n  items, \n  checkIsMisap,\n  productionQuantity \n}: { \n  items: BOMItem[]; \n  checkIsMisap: (name: string, remark: string) => boolean;\n  productionQuantity: number;\n}) {\n  let prevType = '';\n  const totalSetCount = items.reduce((sum, item) => sum + (item.setCount || 0), 0);\n  \n  //    ( )\n  const getRowClassName = (item: BOMItem) => {\n    const isMisap = checkIsMisap(item.itemName, item.remark);\n    if (item.isManualRequired) return 'bg-yellow-50 hover:bg-yellow-100';\n    if (item.isNewPart) return 'bg-red-50 hover:bg-red-100';\n    if (isMisap) return 'bg-gray-50 hover:bg-gray-100';\n    return 'hover:bg-gray-50';\n  };\n  \n  return (\n    <div className=\"border rounded-lg bg-white shadow-sm max-h-[55vh] overflow-auto\">\n      <table className=\"table-auto w-auto border-collapse text-[13px]\">\n        <thead className=\"bg-gray-50 sticky top-0 z-20\">\n            <tr className=\"h-6 border-b border-gray-200\">\n              <th className=\"w-[40px] sm:w-[50px] text-center py-0.5 px-2 bg-gray-50 text-[12px] font-semibold text-gray-700\">\n                <span className=\"card-description\">No</span>\n              </th>\n              <th className=\"text-center whitespace-nowrap py-0.5 px-2 bg-gray-50 text-[12px] font-semibold text-gray-700\">\n                <span className=\"card-description\"></span>\n              </th>\n              <th className=\"whitespace-nowrap py-0.5 px-2 bg-gray-50 text-[12px] font-semibold text-gray-700\">\n                <span className=\"card-description\"></span>\n              </th>\n              <th className=\"w-[50px] sm:w-[60px] text-center py-0.5 px-2 bg-gray-50 text-[12px] font-semibold text-gray-700\">\n                <span className=\"card-description\">SET</span>\n              </th>\n              <th className=\"w-[60px] sm:w-[80px] text-center py-0.5 px-2 bg-gray-50 text-[12px] font-semibold text-gray-700\">\n                <span className=\"card-description\"></span>\n              </th>\n              <th className=\"w-[50px] sm:w-[60px] text-center hidden sm:table-cell py-0.5 px-2 bg-gray-50 text-[12px] font-semibold text-gray-700\">\n                <span className=\"card-description\"></span>\n              </th>\n              <th className=\"min-w-[200px] sm:min-w-[300px] py-0.5 px-2 bg-gray-50 text-[12px] font-semibold text-gray-700\">\n                <span className=\"card-description\">REF</span>\n              </th>\n              <th className=\"w-[100px] sm:w-[150px] hidden md:table-cell py-0.5 px-2 bg-gray-50 text-[12px] font-semibold text-gray-700\">\n                <span className=\"card-description\"></span>\n              </th>\n              <th className=\"w-[100px] sm:w-[150px] py-0.5 px-2 bg-gray-50 text-[12px] font-semibold text-gray-700\">\n                <span className=\"card-description\"></span>\n              </th>\n            </tr>\n          </thead>\n          <tbody>\n            {items.length === 0 ? (\n              <tr>\n                <td colSpan={9} className=\"text-center py-6 card-description\">\n                   .\n                </td>\n              </tr>\n            ) : (\n              items.map((item, index) => {\n                const isMisap = checkIsMisap(item.itemName, item.remark);\n                const showType = item.itemType !== prevType;\n                prevType = item.itemType;\n                \n                return (\n                  <tr key={index} className={`${getRowClassName(item)} border-b border-gray-100`}>\n                    {/* No */}\n                    <td className=\"text-center py-1 px-2\">\n                      <span className={`text-[10px] ${isMisap ? 'text-red-600' : 'text-gray-500'}`}>{index + 1}</span>\n                    </td>\n                    \n                    {/*  -       */}\n                    <td className=\"text-center py-1 px-1 whitespace-nowrap\">\n                      <span className={`text-[10px] ${isMisap ? 'text-red-600' : 'text-gray-600'} ${\n                        item.itemType === ' ' ? '!text-red-500 font-bold' : ''\n                      }`}>\n                        {showType ? (item.itemType || '-') : ''}\n                      </span>\n                    </td>\n\n                    {/*  */}\n                    <td className=\"py-1 px-1 whitespace-nowrap\">\n                      <span className={`text-[10px] ${\n                        isMisap ? 'text-red-600 font-medium' : \n                        (item.isManualRequired || item.isNewPart) ? 'text-red-600' : 'text-gray-500'\n                      }`}>\n                        {item.itemName || '-'}\n                      </span>\n                    </td>\n\n                    {/* SET */}\n                    <td className=\"text-center py-1 px-2\">\n                      <span className={`text-[10px] font-medium ${isMisap ? 'text-red-600' : 'text-gray-900'}`}>\n                        {item.setCount}\n                      </span>\n                    </td>\n\n                    {/*  */}\n                    <td className=\"text-center py-1 px-2\">\n                      <span className={`text-[10px] font-bold ${isMisap ? 'text-red-600' : 'text-gray-900'}`}>\n                        {item.totalQuantity}\n                      </span>\n                    </td>\n\n                    {/*  */}\n                    <td className=\"hidden sm:table-cell text-center py-1 px-2\">\n                      <span className={`text-[10px] font-medium ${isMisap ? 'text-red-600' : 'text-gray-900'}`}>\n                        {item.stockQuantity || ''}\n                      </span>\n                    </td>\n\n                    {/* REF */}\n                    <td className=\"px-1 py-1 align-middle\" style={{ width: '300px', maxWidth: '300px' }}>\n                      <span \n                        className={`text-[10px] ${isMisap ? 'text-red-600' : 'text-gray-600'}`}\n                        style={{ \n                          display: 'block',\n                          width: '300px',\n                          maxWidth: '300px',\n                          lineHeight: '14px',\n                          wordWrap: 'break-word',\n                          overflowWrap: 'break-word',\n                          whiteSpace: 'pre-wrap'\n                        }}\n                      >\n                        {item.refList || '-'}\n                      </span>\n                    </td>\n\n                    {/*  */}\n                    <td className=\"hidden md:table-cell py-1 px-2\">\n                      <span className={`text-[10px] ${isMisap ? 'text-red-600' : 'text-gray-500'}`}>\n                        {item.alternativeItem || ''}\n                      </span>\n                    </td>\n\n                    {/*  */}\n                    <td className=\"py-1 px-2\">\n                      <span className={`text-[10px] ${isMisap ? 'text-red-600 font-medium' : 'text-gray-500'}`}>\n                        {item.remark || ''}\n                      </span>\n                    </td>\n                  </tr>\n                );\n              })\n            )}\n          </tbody>\n          {/*  -    ( ) */}\n          <tfoot className=\"bg-gray-50 border-t sticky bottom-0 z-20\">\n            <tr>\n              {/* No  */}\n              <td className=\"py-2 px-2 bg-gray-50\">\n                <span className=\"card-description whitespace-nowrap\"> {items.length} </span>\n              </td>\n              {/*  */}\n              <td className=\"bg-gray-50\"></td>\n              {/*  -   */}\n              <td className=\"text-right pr-2 bg-gray-50\">\n                <span className=\"card-description\">:</span>\n              </td>\n              {/* SET -   */}\n              <td className=\"text-center py-2 bg-gray-50\">\n                <span className=\"text-[11px] text-gray-700\">{totalSetCount}</span>\n              </td>\n              {/*  */}\n              <td className=\"bg-gray-50\"></td>\n              {/*  */}\n              <td className=\"hidden sm:table-cell bg-gray-50\"></td>\n              {/* REF */}\n              <td className=\"bg-gray-50\"></td>\n              {/*  */}\n              <td className=\"hidden md:table-cell bg-gray-50\"></td>\n              {/*  +  */}\n              <td className=\"py-2 px-2 text-right bg-gray-50\">\n                <div className=\"flex gap-4 card-description justify-end whitespace-nowrap\">\n                  <span className=\"flex items-center gap-1\">\n                    <span className=\"w-3 h-3 bg-yellow-100 border border-yellow-300 rounded\"></span>\n                     \n                  </span>\n                  <span className=\"flex items-center gap-1\">\n                    <span className=\"w-3 h-3 bg-red-50 border border-red-200 rounded\"></span>\n                    \n                  </span>\n                </div>\n              </td>\n            </tr>\n          </tfoot>\n        </table>\n    </div>\n  );\n}\n\n// ============================================================================\n//    (CoordinatePreviewPanel 100%  )\n// ============================================================================\nfunction CoordinateTable({ \n  coordinates, \n  bomItems = [],\n  checkIsMisap \n}: { \n  coordinates: CoordinateItem[]; \n  bomItems?: BOMItem[];\n  checkIsMisap: (name: string, remark: string) => boolean;\n}) {\n  let prevType = '';\n  const totalCount = coordinates.length;\n  \n  // BOM REF Set  (  )\n  const bomRefSet = new Set<string>();\n  bomItems.forEach((item: BOMItem) => {\n    if (item.refList) {\n      const refs = item.refList.split(',').map(r => r.trim().toUpperCase()).filter(Boolean);\n      refs.forEach(ref => bomRefSet.add(ref));\n    }\n  });\n  \n  return (\n    <div className=\"border rounded-lg bg-white shadow-sm max-h-[55vh] overflow-auto\">\n      <table className=\"table-auto w-auto border-collapse text-[13px]\">\n        <thead className=\"bg-gray-50 sticky top-0 z-20\">\n            <tr className=\"h-6 border-b border-gray-200\">\n              <th className=\"w-[40px] text-center py-0.5 px-2 bg-gray-50 text-[12px] font-semibold text-gray-700\">\n                <span className=\"card-description\">No</span>\n              </th>\n              <th className=\"text-center whitespace-nowrap py-0.5 px-2 bg-gray-50 text-[12px] font-semibold text-gray-700\">\n                <span className=\"card-description\"></span>\n              </th>\n              <th className=\"whitespace-nowrap py-0.5 px-2 bg-gray-50 text-[12px] font-semibold text-gray-700\">\n                <span className=\"card-description\"></span>\n              </th>\n              <th className=\"w-[80px] text-center py-0.5 px-2 bg-gray-50 text-[12px] font-semibold text-gray-700\">\n                <span className=\"card-description\">RefDes</span>\n              </th>\n              <th className=\"w-[60px] text-center py-0.5 px-2 bg-gray-50 text-[12px] font-semibold text-gray-700\">\n                <span className=\"card-description\">Layer</span>\n              </th>\n              <th className=\"w-[80px] text-center py-0.5 px-2 bg-gray-50 text-[12px] font-semibold text-gray-700\">\n                <span className=\"card-description\">X</span>\n              </th>\n              <th className=\"w-[80px] text-center py-0.5 px-2 bg-gray-50 text-[12px] font-semibold text-gray-700\">\n                <span className=\"card-description\">Y</span>\n              </th>\n              <th className=\"w-[60px] text-center py-0.5 px-2 bg-gray-50 text-[12px] font-semibold text-gray-700\">\n                <span className=\"card-description\">Angle</span>\n              </th>\n              <th className=\"w-[80px] py-0.5 px-2 bg-gray-50 text-[12px] font-semibold text-gray-700\">\n                <span className=\"card-description\"></span>\n              </th>\n            </tr>\n          </thead>\n          <tbody>\n            {coordinates.length === 0 ? (\n              <tr>\n                <td colSpan={9} className=\"text-center py-6 card-description\">\n                   .\n                </td>\n              </tr>\n            ) : (\n              coordinates.map((coord, index) => {\n                const isMisap = checkIsMisap(coord.partName || '', coord.remark || '');\n                const showType = coord.type !== prevType;\n                prevType = coord.type || '';\n                //   BOM   \n                const isMissingInBom = coord.refDes && !bomRefSet.has(coord.refDes.toUpperCase());\n                \n                return (\n                  <tr \n                    key={index} \n                    className={`hover:bg-gray-50 border-b border-gray-100 ${isMisap ? 'bg-gray-50' : ''} ${isMissingInBom ? 'bg-red-50/60' : ''}`}\n                  >\n                    {/* No */}\n                    <td className=\"text-center py-1 px-2\">\n                      <span className={`text-[10px] ${isMisap ? 'text-red-600' : 'text-gray-500'}`}>{index + 1}</span>\n                    </td>\n                    \n                    {/*  -       */}\n                    <td className=\"text-center py-1 px-1 whitespace-nowrap\">\n                      <span className={`text-[10px] ${isMisap || isMissingInBom ? 'text-red-600' : 'text-gray-600'}`}>\n                        {showType ? (coord.type || '-') : ''}\n                      </span>\n                    </td>\n                    \n                    {/*  */}\n                    <td className=\"py-1 px-1 whitespace-nowrap\">\n                      <span className={`text-[10px] ${isMisap || isMissingInBom ? 'text-red-600' : 'text-gray-600'}`}>\n                        {coord.partName || '-'}\n                      </span>\n                    </td>\n                    \n                    {/* RefDes */}\n                    <td className=\"text-center py-1 px-2\">\n                      <span className={`text-[10px] font-medium ${isMisap || isMissingInBom ? 'text-red-700' : 'text-gray-900'}`}>\n                        {coord.refDes}\n                      </span>\n                    </td>\n                    \n                    {/* Layer */}\n                    <td className=\"text-center py-1 px-2\">\n                      <Badge \n                        variant={coord.layer === 'TOP' ? 'default' : 'secondary'} \n                        className={`text-[9px] px-1.5 py-0 h-4 ${isMissingInBom ? 'bg-red-100 text-red-700 border border-red-200' : ''}`}\n                      >\n                        {coord.layer}\n                      </Badge>\n                    </td>\n                    \n                    {/* X */}\n                    <td className=\"text-center py-1 px-2\">\n                      <span className={`text-[10px] font-mono ${isMisap || isMissingInBom ? 'text-red-600' : 'text-gray-600'}`}>\n                        {coord.locationX?.toFixed(2)}\n                      </span>\n                    </td>\n                    \n                    {/* Y */}\n                    <td className=\"text-center py-1 px-2\">\n                      <span className={`text-[10px] font-mono ${isMisap || isMissingInBom ? 'text-red-600' : 'text-gray-600'}`}>\n                        {coord.locationY?.toFixed(2)}\n                      </span>\n                    </td>\n                    \n                    {/* Angle */}\n                    <td className=\"text-center py-1 px-2\">\n                      <span className={`text-[10px] font-mono ${isMisap || isMissingInBom ? 'text-red-600' : 'text-gray-600'}`}>\n                        {coord.rotation || 0}\n                      </span>\n                    </td>\n                    \n                    {/*  */}\n                    <td className=\"py-1 px-2\">\n                      <span className={`text-[10px] ${isMisap ? 'text-red-600 font-medium' : isMissingInBom ? 'text-red-600 font-medium' : 'text-gray-500'}`}>\n                        {isMissingInBom ? 'BOM ' : (coord.remark || '')}\n                      </span>\n                    </td>\n                  </tr>\n                );\n              })\n            )}\n          </tbody>\n          {/*  ( ) */}\n          <tfoot className=\"bg-gray-50 border-t sticky bottom-0 z-20\">\n            <tr>\n              <td colSpan={9} className=\"py-2 px-2 bg-gray-50\">\n                <div className=\"flex justify-between items-center\">\n                  <span className=\"card-description\"> {totalCount} </span>\n                  <div className=\"flex gap-4 card-description\">\n                    <span className=\"flex items-center gap-1\">\n                      <span className=\"w-3 h-3 bg-gray-100 border border-gray-300 rounded\"></span>\n                      \n                    </span>\n                    <span className=\"flex items-center gap-1\">\n                      <span className=\"w-3 h-3 bg-red-50 border border-red-200 rounded\"></span>\n                      BOM \n                    </span>\n                  </div>\n                </div>\n              </td>\n            </tr>\n          </tfoot>\n        </table>\n    </div>\n  );\n}\n","import { useState, useCallback, useEffect, useRef, useMemo } from 'react';\nimport { createClient } from '@/lib/supabase/client';\nimport { toast } from 'sonner';\nimport { Package, Upload, FileText, X, AlertCircle, Loader2, Download, Eye, Plus, Check, ChevronsUpDown, RotateCcw, Save, Link2, Trash2 } from 'lucide-react';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Command, CommandEmpty, CommandGroup, CommandInput, CommandItem, CommandList } from '@/components/ui/command';\nimport { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Progress } from '@/components/ui/progress';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { cn } from '@/lib/utils';\nimport GeneratedPreviewPanel, { type GeneratedPreviewPanelRef } from './GeneratedPreviewPanel';\nimport CoordinatePreviewPanel from './CoordinatePreviewPanel';\nimport BomDetailModal from './BomDetailModal';\nimport { \n  processBOMAndCoordinates, \n  type BOMItem, \n  type CoordinateItem,\n  type ProcessedResult,\n  sortBOMItems,\n  sortCoordinateItems\n} from '@/utils/v7-generator';\nimport { \n  generateBOMExcelFromTemplate, \n  downloadExcelBlob,\n  type ExcelMetadata \n} from '@/utils/excel-generator';\n\ninterface FileInfo {\n  bomFile: File | null;\n  coordFile: File | null;\n  bomUrl?: string;\n  coordUrl?: string;\n}\n\ninterface Metadata {\n  boardName: string;\n  artworkManager: string;\n  productionManager: string;\n  productionQuantity: number;\n}\n\nexport default function BomCoordinateIntegrated() {\n  const [viewMode, setViewMode] = useState<'list' | 'create'>('create');\n  const [step, setStep] = useState<'input' | 'processing' | 'preview'>('input');\n  const [fileInfo, setFileInfo] = useState<FileInfo>({\n    bomFile: null,\n    coordFile: null\n  });\n  const [metadata, setMetadata] = useState<Metadata>({\n    boardName: '',\n    artworkManager: '',\n    productionManager: '',\n    productionQuantity: 0\n  });\n  const [employees, setEmployees] = useState<{ id: string; name: string }[]>([]);\n  const [currentUser, setCurrentUser] = useState<{ email: string; name: string } | null>(null);\n  const [loading, setLoading] = useState(false);\n  const [uploading, setUploading] = useState(false);\n  const [openArtworkManager, setOpenArtworkManager] = useState(false);\n  const [openProductionManager, setOpenProductionManager] = useState(false);\n  const [processedResult, setProcessedResult] = useState<any>(null);\n  const [dragActive, setDragActive] = useState<string | null>(null);\n  const [savedBoards, setSavedBoards] = useState<Array<{\n    id: string;\n    board_name: string;\n    created_at: string;\n    artwork_manager?: string;\n    production_manager?: string;\n    status?: 'pending' | 'completed';\n  }>>([]);\n  const [editingBoardId, setEditingBoardId] = useState<string | null>(null); // pending     ID\n  const [loadingBoards, setLoadingBoards] = useState(false);\n  const [uploadedFilePaths, setUploadedFilePaths] = useState<{ bomPath: string; coordPath?: string } | null>(null);\n  const [errorMessage, setErrorMessage] = useState<string | null>(null);\n  const [progress, setProgress] = useState(0);\n  const [loadingText, setLoadingText] = useState('');\n  const [isMerged, setIsMerged] = useState(false);\n  const [deletingBoardId, setDeletingBoardId] = useState<string | null>(null);\n  const [detailModalBoardId, setDetailModalBoardId] = useState<string | null>(null);\n  const [isDetailModalOpen, setIsDetailModalOpen] = useState(false);\n  const [isSaving, setIsSaving] = useState(false);\n  const [skipTempDataLoad, setSkipTempDataLoad] = useState(false);\n\n  // REF    (BOM vs )\n  const { mismatchCount, missingInCoord, missingInBom } = useMemo(() => {\n    const bomItems = processedResult?.processedData?.bomItems ?? [];\n    const coords = processedResult?.processedData?.coordinates ?? [];\n    const coordinatesProvided = processedResult?.processedData?.coordinatesProvided !== false;\n\n    //          (BOM-only )\n    if (!coordinatesProvided) {\n      return { mismatchCount: 0, missingInCoord: 0, missingInBom: 0 };\n    }\n\n    const bomRefs = new Set<string>();\n    bomItems.forEach((item: BOMItem) => {\n      const refs = (item.refList || '').split(',').map(r => r.trim().toUpperCase()).filter(Boolean);\n      refs.forEach(ref => bomRefs.add(ref));\n    });\n\n    const coordRefs = new Set<string>();\n    coords.forEach((coord: CoordinateItem) => {\n      // refDes  ref   \n      const ref = coord?.refDes || (coord as any)?.ref;\n      if (ref) coordRefs.add(ref.trim().toUpperCase());\n    });\n\n    let missingInCoord = 0;\n    bomRefs.forEach(ref => {\n      if (!coordRefs.has(ref)) missingInCoord += 1;\n    });\n\n    let missingInBom = 0;\n    coordRefs.forEach(ref => {\n      if (!bomRefs.has(ref)) missingInBom += 1;\n    });\n\n    return {\n      mismatchCount: missingInCoord + missingInBom,\n      missingInCoord,\n      missingInBom\n    };\n  }, [processedResult?.processedData?.bomItems, processedResult?.processedData?.coordinates]);\n\n  //       \n  const hasMergeableItems = (() => {\n    const bomItems = processedResult?.processedData?.bomItems || [];\n    if (bomItems.length === 0) return false;\n    \n    const grouped = new Map<string, number>();\n    bomItems.forEach((item: BOMItem) => {\n      if (item.itemName?.includes(' ') || item.itemType === ' ') return;\n      const key = `${item.itemType}|${item.itemName}`;\n      grouped.set(key, (grouped.get(key) || 0) + 1);\n    });\n    \n    return Array.from(grouped.values()).some(count => count > 1);\n  })();\n\n  const supabase = createClient();\n  const previewPanelRef = useRef<GeneratedPreviewPanelRef>(null);\n  const { currentUserRoles } = useAuth();\n  \n  //   \n  const isAdmin = currentUserRoles.includes('app_admin');\n\n  const normalizeName = (name?: string | null) => (name || '').trim();\n\n  //  :   () \n  // : production_manager   \"\"  \"ID\"        \n  const canDeleteBoard = useCallback((board: { status?: 'pending' | 'completed'; production_manager?: string }) => {\n    if (isAdmin) return true;\n    if (board.status !== 'completed') return false;\n\n    const inspectorRaw = normalizeName(board.production_manager);\n    const myName = normalizeName(currentUser?.name);\n    const myId = normalizeName((currentUser as any)?.id);\n\n    if (!inspectorRaw) return false;\n\n    // 1) DB   \n    if (myName && inspectorRaw === myName) return true;\n    // 2) DB / ID  \n    if (myId && inspectorRaw === myId) return true;\n    // 3) inspector ID      (employees )\n    if (myName && employees?.length) {\n      const inspectorNameById = employees.find(emp => normalizeName(emp.id) === inspectorRaw)?.name;\n      if (normalizeName(inspectorNameById) && normalizeName(inspectorNameById) === myName) return true;\n    }\n\n    return false;\n  }, [isAdmin, currentUser, employees]);\n  \n  // localStorage   ( )\n  const getTempStorageKey = (userId: string) => `bom_temp_data_${userId}`;\n  \n  //   \n  const saveTempData = (userId: string) => {\n    if (!processedResult || !userId) return;\n    \n    try {\n      const tempData = {\n        step,\n        metadata,\n        processedResult,\n        savedAt: new Date().toISOString()\n      };\n      localStorage.setItem(getTempStorageKey(userId), JSON.stringify(tempData));\n      console.log('   ');\n    } catch (error) {\n      console.error('   :', error);\n    }\n  };\n  \n  //   \n  const loadTempData = async (userId: string, skipIfEmpty = false) => {\n    try {\n      // skipTempDataLoad     \n      if (skipTempDataLoad) {\n        console.log('       ');\n        return;\n      }\n      \n      const saved = localStorage.getItem(getTempStorageKey(userId));\n      if (!saved) return;\n      \n      const tempData = JSON.parse(saved);\n      \n      // skipIfEmpty true      \n      if (skipIfEmpty) {\n        const hasData = processedResult || \n                       (metadata.boardName || metadata.productionManager || metadata.productionQuantity > 0) ||\n                       fileInfo.bomFile || fileInfo.coordFile;\n        if (hasData) {\n          console.log('       ');\n          return;\n        }\n      }\n      \n      // 24    \n      const savedAt = new Date(tempData.savedAt);\n      const now = new Date();\n      const hoursDiff = (now.getTime() - savedAt.getTime()) / (1000 * 60 * 60);\n      \n      if (hoursDiff > 24) {\n        localStorage.removeItem(getTempStorageKey(userId));\n        console.log(' 24    ');\n        return;\n      }\n      \n      //   (  refDes  ref  )\n      let restoredResult = tempData.processedResult;\n      if (restoredResult?.processedData?.coordinates) {\n        restoredResult = {\n          ...restoredResult,\n          processedData: {\n            ...restoredResult.processedData,\n            coordinates: restoredResult.processedData.coordinates.map((coord: any) => ({\n              ...coord,\n              refDes: coord.refDes || coord.ref || ''\n            }))\n          }\n        };\n      }\n      \n      setStep(tempData.step);\n      setMetadata(tempData.metadata);\n      setProcessedResult(restoredResult);\n      setViewMode('create');\n      console.log('   ');\n    } catch (error) {\n      console.error('   :', error);\n    }\n  };\n  \n  //   \n  const clearTempData = async () => {\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (user) {\n        localStorage.removeItem(getTempStorageKey(user.id));\n        console.log('   ');\n      }\n    } catch (error) {\n      console.error('   :', error);\n    }\n  };\n\n  //       \n  useEffect(() => {\n    const loadData = async () => {\n      try {\n        //   \n        const { data: empData } = await supabase\n          .from('employees')\n          .select('id, name')\n          .order('name');\n        \n        if (empData) {\n          setEmployees(empData);\n        }\n\n        //    \n        const { data: { user } } = await supabase.auth.getUser();\n        if (user && user.email) {\n          const { data: userData } = await supabase\n            .from('employees')\n            .select('id, name')\n            .eq('email', user.email)\n            .single();\n          \n          setCurrentUser({\n            email: user.email,\n            name: userData?.name || user.email.split('@')[0]\n          });\n          \n          // Artwork     ID  (metadata  )\n          setMetadata(prev => {\n            if (!prev.boardName && !prev.productionManager && prev.productionQuantity === 0 && !skipTempDataLoad) {\n              return {\n            ...prev,\n                artworkManager: userData?.id || ''\n              };\n            }\n            return prev;\n          });\n          \n          //     (  ,    , skipTempDataLoad false )\n          if (!skipTempDataLoad) {\n            loadTempData(user.id, true);\n          }\n        }\n      } catch (error) {\n        console.error('Error loading data:', error);\n      }\n    };\n\n    loadData();\n  }, [supabase]);\n\n  // processedResult    \n  useEffect(() => {\n    const saveTemp = async () => {\n      if (!processedResult || step !== 'preview') return;\n      \n      const { data: { user } } = await supabase.auth.getUser();\n      if (user) {\n        saveTempData(user.id);\n      }\n    };\n    \n    saveTemp();\n  }, [processedResult, metadata, step]);\n\n  //    \n  useEffect(() => {\n    const loadSavedBoards = async () => {\n      if (viewMode !== 'list') return;\n      \n      try {\n        setLoadingBoards(true);\n        const { data: boards, error } = await supabase\n          .from('cad_drawings')\n          .select('id, board_name, created_at, artwork_manager, production_manager, status')\n          .order('created_at', { ascending: false });\n        \n        if (error) throw error;\n        \n        setSavedBoards(boards || []);\n      } catch (error) {\n        console.error('Error loading saved boards:', error);\n        toast.error(' BOM   .');\n      } finally {\n        setLoadingBoards(false);\n      }\n    };\n\n    loadSavedBoards();\n  }, [viewMode, supabase]);\n\n  //    \n  useEffect(() => {\n    if (fileInfo.bomFile) {\n      let name = fileInfo.bomFile.name;\n      //  \n      name = name.replace(/\\.(xlsx|xls|csv)$/i, '');\n      // .part.BOM, .BOM, _BOM, part.BOM     ( )\n      name = name.replace(/(\\.|_|\\s)?(part)?(\\.|_|\\s)?bom$/i, '');\n      //     \n      name = name.replace(/^\\d+_bom_/, '');\n      \n      //   (YYMMDD)  _ \n      const today = new Date();\n      const dateStr = today.getFullYear().toString().slice(2) + \n        (today.getMonth() + 1).toString().padStart(2, '0') + \n        today.getDate().toString().padStart(2, '0');\n      \n      name = `${name}_${dateStr}_`;\n\n      setMetadata(prev => ({ ...prev, boardName: name }));\n    }\n  }, [fileInfo.bomFile]);\n\n  const handleDrag = useCallback((e: React.DragEvent, type: string) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (e.type === 'dragenter' || e.type === 'dragover') {\n      setDragActive(type);\n    } else if (e.type === 'dragleave') {\n      setDragActive(null);\n    }\n  }, []);\n\n  const handleDrop = useCallback((e: React.DragEvent, type: 'bom' | 'coord') => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragActive(null);\n\n    if (e.dataTransfer.files && e.dataTransfer.files[0]) {\n      const file = e.dataTransfer.files[0];\n      if (type === 'bom') {\n        setFileInfo(prev => ({ ...prev, bomFile: file }));\n      } else {\n        setFileInfo(prev => ({ ...prev, coordFile: file }));\n      }\n    }\n  }, []);\n\n  const handleFileSelect = useCallback((e: React.ChangeEvent<HTMLInputElement>, type: 'bom' | 'coord') => {\n    if (e.target.files && e.target.files[0]) {\n      const file = e.target.files[0];\n      if (type === 'bom') {\n        setFileInfo(prev => ({ ...prev, bomFile: file }));\n      } else {\n        setFileInfo(prev => ({ ...prev, coordFile: file }));\n      }\n    }\n  }, []);\n\n  const handleRemoveFile = useCallback((type: 'bom' | 'coord') => {\n    if (type === 'bom') {\n      setFileInfo(prev => ({ ...prev, bomFile: null, bomUrl: undefined }));\n    } else {\n      setFileInfo(prev => ({ ...prev, coordFile: null, coordUrl: undefined }));\n    }\n  }, []);\n\n  const handleProcess = async () => {\n    if (!fileInfo.bomFile) {\n      toast.error('BOM  .');\n      return;\n    }\n\n    if (!metadata.boardName.trim()) {\n      toast.error('  .');\n      return;\n    }\n\n    //        validation \n    // if (!metadata.productionManager || metadata.productionManager === 'none') {\n    //   toast.error('  .');\n    //   return;\n    // }\n\n    if (metadata.productionQuantity <= 0) {\n      toast.error('   (1 ).');\n      return;\n    }\n\n    const coordinatesProvided = Boolean(fileInfo.coordFile);\n    let timer: NodeJS.Timeout | null = null;\n    let textTimer: NodeJS.Timeout | null = null;\n\n    try {\n      setUploading(true);\n      setStep('processing');\n      setErrorMessage(null);\n      setProgress(0);\n      setLoadingText('   ...');\n\n      //    \n      const totalSize = (fileInfo.bomFile?.size || 0) + (fileInfo.coordFile?.size || 0);\n      const estimatedDuration = 15000 + (totalSize / 1024) * 50; \n      \n      const updateInterval = 500;\n      const totalSteps = estimatedDuration / updateInterval;\n      const incrementPerStep = 90 / totalSteps;\n\n      //   \n      timer = setInterval(() => {\n        setProgress((oldProgress) => {\n          if (oldProgress >= 95) {\n            return oldProgress;\n          }\n          const randomFactor = Math.random() * 0.5 + 0.8;\n          return Math.min(oldProgress + (incrementPerStep * randomFactor), 95);\n        });\n      }, updateInterval);\n\n      //   \n      textTimer = setInterval(() => {\n        setLoadingText((current) => {\n          if (current === '   ...') return 'BOM   ...';\n          if (current === 'BOM   ...') return '   ...';\n          if (current === '   ...') return coordinatesProvided ? '   ...' : 'BOM  ...';\n          if (current === '   ...') return 'AI   ...';\n          if (current === 'AI   ...') return '  . !';\n          return current;\n        });\n      }, estimatedDuration / 5);\n\n      // 1.   (Storage) -  \n      // ... (    ) ...\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error(' .');\n\n      const timestamp = Date.now();\n      const sanitizeFileName = (fileName: string) => {\n        const lastDotIndex = fileName.lastIndexOf('.');\n        const extension = lastDotIndex > -1 ? fileName.slice(lastDotIndex) : '';\n        const nameWithoutExt = lastDotIndex > -1 ? fileName.slice(0, lastDotIndex) : fileName;\n        const safeName = nameWithoutExt\n          .replace(/[^a-zA-Z0-9\\-_]/g, '_')\n          .replace(/_+/g, '_')\n          .replace(/^_|_$/g, '');\n        return (safeName || 'file') + extension;\n      };\n\n      const safeBomFileName = sanitizeFileName(fileInfo.bomFile.name);\n      const bomPath = `raw/${timestamp}_bom_${safeBomFileName}`;\n\n      //  \n      const bomResult = await supabase.storage\n        .from('bom-files')\n        .upload(bomPath, fileInfo.bomFile, { cacheControl: '3600', upsert: true });\n\n      if (bomResult.error) throw bomResult.error;\n\n      let coordPath: string | undefined;\n      if (fileInfo.coordFile) {\n        const safeCoordFileName = sanitizeFileName(fileInfo.coordFile.name);\n        coordPath = `raw/${timestamp}_coord_${safeCoordFileName}`;\n\n        const coordResult = await supabase.storage\n          .from('bom-files')\n          .upload(coordPath, fileInfo.coordFile, { cacheControl: '3600', upsert: true });\n\n        if (coordResult.error) {\n          await supabase.storage.from('bom-files').remove([bomPath]);\n          throw coordResult.error;\n        }\n      }\n\n      // Signed URL \n      const { data: bomUrlData } = await supabase.storage\n        .from('bom-files')\n        .createSignedUrl(bomPath, 60 * 60);\n\n      const coordUrlData = coordPath\n        ? (await supabase.storage.from('bom-files').createSignedUrl(coordPath, 60 * 60)).data\n        : undefined;\n\n      if (!bomUrlData?.signedUrl || (coordPath && !coordUrlData?.signedUrl)) {\n        throw new Error(' URL  ');\n      }\n\n      //     ( DB   )\n      setUploadedFilePaths({ bomPath, ...(coordPath ? { coordPath } : {}) });\n\n      // 2. v7  BOM/  (  )\n      console.log('Processing BOM with v7 engine...');\n      setLoadingText('    ...');\n      \n      // v7-generator \n      const processedData = await processBOMAndCoordinates(\n        fileInfo.bomFile,\n        fileInfo.coordFile,\n        metadata.productionQuantity\n      );\n\n      if (timer) clearInterval(timer);\n      if (textTimer) clearInterval(textTimer);\n      setProgress(100);\n      setLoadingText('!');\n\n      if (!processedData || !processedData.bomItems) {\n        throw new Error('BOM    .');\n      }\n\n      // 3.    ( ID )\n      const resultWithId = {\n        cadDrawingId: `cad_${Date.now()}`,\n        processedData: {\n          bomItems: processedData.bomItems,\n          topCoordinates: processedData.topCoordinates,\n          bottomCoordinates: processedData.bottomCoordinates,\n          coordinates: [...processedData.topCoordinates, ...processedData.bottomCoordinates],\n          coordinatesProvided,\n          summary: processedData.summary\n        }\n      };\n\n      setProcessedResult(resultWithId);\n      \n      // 100%           \n      await new Promise(resolve => setTimeout(resolve, 500));\n      \n      toast.success('BOM    .');\n      setStep('preview');\n\n    } catch (error: any) {\n      console.error('Processing error:', error);\n      const msg = `   : ${error.message || error}`;\n      setErrorMessage(msg);\n      \n      if (timer) clearInterval(timer);\n      if (textTimer) clearInterval(textTimer);\n      \n      setUploading(false);\n      setStep('input'); \n      window.scrollTo({ top: 0, behavior: 'smooth' });\n    } finally {\n      //    clearInterval  \n      //      ,   \n      if (step === 'processing' && errorMessage) {\n         setUploading(false);\n      }\n    }\n  };\n\n  const handleSaveBOM = async (items: BOMItem[]) => {\n    if (!processedResult?.cadDrawingId) return;\n\n    // processedResult.isEditMode  (stale closure  )\n    const isEditMode = processedResult.isEditMode === true;\n\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) throw new Error(' .');\n\n      // 1. cad_drawings    /\n      let cadDrawingId = processedResult.cadDrawingId;\n      \n      //    (ID   employees  )\n      const artworkManagerName = employees.find(emp => emp.id === metadata.artworkManager)?.name || currentUser?.name || '';\n      const productionManagerName = employees.find(emp => emp.id === metadata.productionManager)?.name || metadata.productionManager;\n      \n      //   (isEditMode  ,   )\n      const saveStatus = isEditMode ? 'completed' : 'pending';\n      //       \n      const finalProductionManager = isEditMode ? currentUser?.name : null;\n\n      //    (isEditMode = pending   )\n      if (isEditMode) {\n        // cadDrawingId  processedResult.cadDrawingId  (boardId)\n        const { data: updatedRows, error: updateError } = await supabase\n          .from('cad_drawings')\n          .update({ \n            artwork_manager: artworkManagerName,\n            production_manager: finalProductionManager,\n            production_quantity: metadata.productionQuantity,\n            status: saveStatus\n          })\n          .eq('id', cadDrawingId)\n          .select('id, status, production_manager');\n\n        if (updateError) {\n          console.error('   :', updateError);\n          throw updateError;\n        }\n        // RLS UPDATE  error  0     (    )\n        if (!updatedRows || updatedRows.length === 0) {\n          console.error(' cad_drawings UPDATE 0  (RLS    )', { cadDrawingId, saveStatus });\n          toast.error('  (RLS).  cad_drawings UPDATE   .');\n          throw new Error('cad_drawings update blocked (0 rows updated)');\n        }\n      } else if (cadDrawingId.startsWith('cad_')) {\n        // cadDrawingId  ID  ( ) -  \n        //   /      \n        const today = new Date();\n        const dateStr = today.getFullYear().toString().slice(2) + \n          String(today.getMonth() + 1).padStart(2, '0') + \n          String(today.getDate()).padStart(2, '0');\n        \n        //       \n        const cleanBoardName = metadata.boardName.trim()\n          .replace(/_\\d{6}_$/, '')\n          .replace(/_$/, '')\n          .replace(/_\\d{6}$/, '');\n        const saveBoardName = `${cleanBoardName}_${dateStr}_`;\n\n        console.log('   :   ', { saveBoardName, saveStatus });\n        //    ( )\n          const { data: newBoard, error: boardError } = await supabase\n            .from('cad_drawings')\n          .insert({ \n            board_name: saveBoardName,\n            artwork_manager: artworkManagerName,\n            production_manager: finalProductionManager,\n            production_quantity: metadata.productionQuantity,\n            status: saveStatus\n          })\n            .select('id')\n            .single();\n\n          if (boardError) throw boardError;\n          cadDrawingId = newBoard.id;\n        const { data: afterInsertRow, error: afterInsertReadError } = await supabase\n          .from('cad_drawings')\n          .select('id, status, production_manager, created_at')\n          .eq('id', cadDrawingId)\n          .single();\n        console.log(' after insert readback (cad_drawings)', { afterInsertRow, afterInsertReadError });\n      } else if (!processedResult.cadDrawingId.startsWith('cad_')) {\n        //    (  )\n        const { error: updateExistingError } = await supabase\n          .from('cad_drawings')\n          .update({ \n            artwork_manager: artworkManagerName,\n            production_manager: finalProductionManager,\n            production_quantity: metadata.productionQuantity,\n            status: saveStatus\n          })\n          .eq('id', cadDrawingId);\n        if (updateExistingError) throw updateExistingError;\n      }\n\n      // 2.     (bom_raw_files)\n      // NOTE: bom_raw_files  coordinate_file_* NOT NULL\n      //   (BOM-only)  raw file  .\n      if (fileInfo.bomFile && fileInfo.coordFile && uploadedFilePaths?.bomPath && uploadedFilePaths?.coordPath) {\n        let bomFileUrl = '';\n        let coordFileUrl = '';\n\n        // Storage Signed URL  (1 )\n        const { data: bomUrlData } = await supabase.storage\n          .from('bom-files')\n          .createSignedUrl(uploadedFilePaths.bomPath, 60 * 60 * 24 * 365);\n\n        const { data: coordUrlData } = await supabase.storage\n          .from('bom-files')\n          .createSignedUrl(uploadedFilePaths.coordPath, 60 * 60 * 24 * 365);\n\n        if (bomUrlData?.signedUrl) bomFileUrl = bomUrlData.signedUrl;\n        if (coordUrlData?.signedUrl) coordFileUrl = coordUrlData.signedUrl;\n\n        // bom_raw_files  (   ,  )\n        const { data: existingRawFile } = await supabase\n          .from('bom_raw_files')\n          .select('id')\n          .eq('cad_drawing_id', cadDrawingId)\n          .single();\n\n        if (existingRawFile) {\n          const { error: updateRawError } = await supabase\n            .from('bom_raw_files')\n            .update({\n              bom_file_url: bomFileUrl,\n              coordinate_file_url: coordFileUrl,\n              bom_file_name: fileInfo.bomFile.name,\n              coordinate_file_name: fileInfo.coordFile.name,\n              uploaded_by: user.email || user.id\n            })\n            .eq('id', existingRawFile.id);\n\n          if (updateRawError) throw updateRawError;\n        } else {\n          const { error: insertRawError } = await supabase\n            .from('bom_raw_files')\n            .insert({\n              cad_drawing_id: cadDrawingId,\n              bom_file_url: bomFileUrl,\n              coordinate_file_url: coordFileUrl,\n              bom_file_name: fileInfo.bomFile.name,\n              coordinate_file_name: fileInfo.coordFile.name,\n              uploaded_by: user.email || user.id\n            });\n\n          if (insertRawError) throw insertRawError;\n        }\n      }\n\n      // 3.  bom_items    \n      const { error: deleteError } = await supabase\n        .from('bom_items')\n        .delete()\n        .eq('cad_drawing_id', cadDrawingId);\n\n      if (deleteError) throw deleteError;\n\n        const { error: insertError } = await supabase\n          .from('bom_items')\n          .insert(\n            items.map((item: BOMItem) => ({\n              cad_drawing_id: cadDrawingId,\n              line_number: item.lineNumber,\n            item_type: item.itemType,\n            item_name: item.itemName,\n            specification: item.originalFootprint || '',\n            set_count: item.setCount,\n            total_quantity: item.totalQuantity,\n            stock_quantity: item.stockQuantity || 0,\n            check_status: item.checkStatus,\n            ref_list: Array.isArray(item.refList) ? item.refList : (item.refList ? item.refList.split(',').map((r: string) => r.trim()) : []),\n            alternative_item: item.alternativeItem || '',\n            remark: item.remark || ''\n          }))\n        );\n\n      if (insertError) throw insertError;\n\n      // 4.    (part_placements)\n      if (Array.isArray(processedResult.processedData?.coordinates) && processedResult.processedData.coordinates.length > 0) {\n        const { error: deleteCoordError } = await supabase\n          .from('part_placements')\n          .delete()\n          .eq('cad_drawing_id', cadDrawingId);\n\n        if (deleteCoordError) throw deleteCoordError;\n\n        const { error: insertCoordError } = await supabase\n          .from('part_placements')\n          .insert(\n            processedResult.processedData.coordinates.map((coord: CoordinateItem) => ({\n              cad_drawing_id: cadDrawingId,\n              ref: coord.refDes,\n              part_name: coord.partName,\n              part_type: coord.type,\n              side: coord.layer,\n              x_coordinate: coord.locationX || 0,\n              y_coordinate: coord.locationY || 0,\n              angle: coord.rotation || null\n            }))\n          );\n\n        if (insertCoordError) throw insertCoordError;\n      }\n\n      // 5. AI    (:      )\n      //    (items, processedResult.processedData.coordinates)   \n      if (uploadedFilePaths) { //     \n        //      ,      \n        //  Edge Function   . \n        //  DB    JSON    \n        \n        /*     (ai_learning_records ) */\n        const { error: learningError } = await supabase\n          .from('ai_learning_records')\n          .insert({\n            cad_drawing_id: cadDrawingId,\n            //   URL ,    . \n            //    \n            processed_bom_data: items, //  /  BOM\n            processed_coordinate_data: processedResult.processedData?.coordinates,\n            cad_program_type: 'unknown', //   \n            created_at: new Date().toISOString()\n          });\n          \n        if (learningError) {\n            console.warn('    (  ):', learningError);\n        } else {\n          //            \n          const { resetLearningDataCache } = await import('@/utils/v7-generator');\n          resetLearningDataCache();\n          console.log('     ');\n        }\n      }\n      \n      // cadDrawingId \n      setProcessedResult((prev: any) => ({\n        ...prev,\n        cadDrawingId: cadDrawingId,\n        processedData: {\n          ...prev.processedData,\n          bomItems: items\n        }\n      }));\n\n      //          \n      clearTempData();\n      setEditingBoardId(null); //    ID \n      // UI  : savedBoards  id  status  ( stale   )\n      setSavedBoards(prev => prev.map(b => (\n        b.id === cadDrawingId\n          ? { ...b, status: saveStatus as any, production_manager: (finalProductionManager ?? b.production_manager) as any }\n          : b\n      )));\n      \n      //     (handleReset  viewMode )\n        setViewMode('list');\n      \n      //   (  )\n      setStep('input');\n      setFileInfo({ bomFile: null, coordFile: null });\n      setMetadata({\n        boardName: '',\n        artworkManager: '',\n        productionManager: '',\n        productionQuantity: 0\n      });\n      setProcessedResult(null);\n      \n      //     (isEditMode )\n      if (isEditMode) {\n        toast.success('  .');\n      } else {\n        toast.success('  .    .');\n      }\n\n    } catch (error: any) {\n      console.error('Save error:', error);\n      toast.error(` : ${error.message}`);\n    }\n  };\n\n  const handleReset = () => {\n    setStep('input');\n    setFileInfo({ bomFile: null, coordFile: null });\n    // artworkManager   , useEffect    \n    setMetadata({\n      boardName: '',\n      artworkManager: '',\n      productionManager: '',\n      productionQuantity: 0\n    });\n    setProcessedResult(null);\n    setUploadedFilePaths(null);\n    setErrorMessage(null);\n    setProgress(0);\n    setLoadingText('');\n    setIsMerged(false);\n    //         \n    setSkipTempDataLoad(true);\n    //      (/24  )\n  };\n\n  // BOM      \n  const handleBomChange = (updatedBomItems: BOMItem[]) => {\n    if (!processedResult?.processedData?.coordinates) return;\n    \n    // BOM refList  Ref /  \n    const refToItemMap = new Map<string, { type: string; partName: string }>();\n    \n    updatedBomItems.forEach(item => {\n      const refs = (item.refList || '').split(',').map(r => r.trim()).filter(r => r);\n      refs.forEach(ref => {\n        refToItemMap.set(ref.toUpperCase(), {\n          type: item.itemType || '',\n          partName: item.itemName || ''\n        });\n      });\n    });\n    \n    //   \n    const updatedCoordinates = processedResult.processedData.coordinates.map((coord: CoordinateItem) => {\n      const refKey = (coord.refDes || '').toUpperCase();\n      const bomInfo = refToItemMap.get(refKey);\n      \n      if (bomInfo) {\n        return {\n          ...coord,\n          type: bomInfo.type,\n          partName: bomInfo.partName\n        };\n      }\n      return coord;\n    });\n    \n    // processedResult \n    setProcessedResult((prev: any) => ({\n      ...prev,\n      processedData: {\n        ...prev.processedData,\n        bomItems: updatedBomItems,\n        coordinates: updatedCoordinates\n      }\n    }));\n  };\n\n  //      processedResult  (Full Edit)\n  const handleCoordinatesChange = useCallback((nextCoordinates: CoordinateItem[]) => {\n    setProcessedResult((prev: any) => {\n      if (!prev?.processedData) return prev;\n      return {\n        ...prev,\n        processedData: {\n          ...prev.processedData,\n          coordinates: nextCoordinates\n        }\n      };\n    });\n  }, []);\n\n  //    (refDes  BOM/  )\n  const handleDeleteRefs = useCallback(\n    (refs: string[]) => {\n      const normalizedToDelete = new Set(\n        (refs || [])\n          .map(r => (r || '').trim().toUpperCase())\n          .filter(Boolean)\n      );\n      if (normalizedToDelete.size === 0) return;\n\n      setProcessedResult((prev: any) => {\n        if (!prev?.processedData) return prev;\n\n        const prevBom: BOMItem[] = prev.processedData?.bomItems ?? [];\n        const prevCoords: CoordinateItem[] = prev.processedData?.coordinates ?? [];\n        const prevTop: CoordinateItem[] = prev.processedData?.topCoordinates ?? [];\n        const prevBottom: CoordinateItem[] = prev.processedData?.bottomCoordinates ?? [];\n\n        const normalizeRef = (v?: string | null) => (v || '').trim().toUpperCase();\n        const parseRefs = (refList?: string) =>\n          (refList || '')\n            .split(',')\n            .map(r => r.trim())\n            .filter(Boolean);\n\n        // 1)  refDes   \n        const nextCoords = prevCoords.filter(c => !normalizedToDelete.has(normalizeRef(c.refDes)));\n        const nextTop = prevTop.filter(c => !normalizedToDelete.has(normalizeRef(c.refDes)));\n        const nextBottom = prevBottom.filter(c => !normalizedToDelete.has(normalizeRef(c.refDes)));\n\n        // 2) BOM refList  ref  (  ref , ref 0  )\n        const nextBom: BOMItem[] = [];\n        for (const item of prevBom) {\n          const refsInRow = parseRefs(item.refList);\n          if (refsInRow.length === 0) {\n            nextBom.push(item);\n            continue;\n          }\n\n          const remaining = refsInRow.filter(r => !normalizedToDelete.has(normalizeRef(r)));\n          if (remaining.length === 0) {\n            //  BOM   \n            continue;\n          }\n\n          // ref     (ref  merge    ref     )\n          const nextSetCount = remaining.length;\n          const nextTotalQty = metadata.productionQuantity > 0 ? nextSetCount * metadata.productionQuantity : item.totalQuantity;\n          nextBom.push({\n            ...item,\n            refList: remaining.join(', '),\n            setCount: nextSetCount,\n            totalQuantity: nextTotalQty,\n          });\n        }\n\n        // lineNumber \n        const renumberedBom = nextBom.map((it, idx) => ({ ...it, lineNumber: idx + 1 }));\n\n        return {\n          ...prev,\n          processedData: {\n            ...prev.processedData,\n            bomItems: renumberedBom,\n            coordinates: nextCoords,\n            ...(prev.processedData?.topCoordinates ? { topCoordinates: nextTop } : {}),\n            ...(prev.processedData?.bottomCoordinates ? { bottomCoordinates: nextBottom } : {}),\n          },\n        };\n      });\n    },\n    [metadata.productionQuantity]\n  );\n\n  const handleDeleteRef = useCallback((refDes: string) => handleDeleteRefs([refDes]), [handleDeleteRefs]);\n\n  //  BOM \n  const handleDownloadSavedBOM = async (boardId: string, boardName: string) => {\n    try {\n      //    (  )\n      const { data: boardInfo, error: boardError } = await supabase\n        .from('cad_drawings')\n        .select('artwork_manager, production_manager, production_quantity')\n        .eq('id', boardId)\n        .single();\n      \n      if (boardError) throw boardError;\n\n      // BOM  \n      const { data: bomItems, error: bomError } = await supabase\n        .from('bom_items')\n        .select('*')\n        .eq('cad_drawing_id', boardId)\n        .order('line_number');\n      \n      if (bomError) throw bomError;\n\n      //   \n      const { data: coordinates, error: coordError } = await supabase\n        .from('part_placements')\n        .select('*')\n        .eq('cad_drawing_id', boardId);\n      \n      if (coordError) throw coordError;\n\n      // BOMItem  \n      const convertedBOMItems: BOMItem[] = (bomItems || []).map((item: any) => ({\n        lineNumber: item.line_number,\n        itemType: item.item_type || '',\n        itemName: item.item_name,\n        specification: item.specification || '',\n        setCount: item.set_count,\n        totalQuantity: item.total_quantity || 0,\n        stockQuantity: item.stock_quantity || 0,\n        checkStatus: item.check_status || '',\n        refList: Array.isArray(item.ref_list) ? item.ref_list.join(',') : (item.ref_list || ''),\n        alternativeItem: item.alternative_item || '',\n        remark: item.remark || ''\n      }));\n\n      // CoordinateItem   (    )\n      const normalizeLayer = (layer?: string | null) => {\n        const v = (layer || '').trim().toUpperCase();\n        if (!v) return '';\n        if (v === 'TOP' || v === 'T' || v === 'TOPSIDE' || v === 'FRONT' || v === 'F') return 'TOP';\n        if (v === 'BOTTOM' || v === 'BOT' || v === 'B' || v === 'BOTTOMSIDE' || v === 'BACK') return 'BOTTOM';\n        return v;\n      };\n\n      const convertedCoords: CoordinateItem[] = (coordinates || []).map((coord: any) => ({\n        type: coord.part_type || '',\n        partName: coord.part_name || '',\n        refDes: coord.ref || '',\n        layer: normalizeLayer(coord.side) || coord.side || '',\n        locationX: Number(coord.x_coordinate ?? 0) || 0,\n        locationY: Number(coord.y_coordinate ?? 0) || 0,\n        rotation: Number(coord.angle ?? 0) || 0,\n        remark: coord.remark || '',\n      }));\n\n      // Excel    - DB    \n      const excelMetadata: ExcelMetadata = {\n        boardName,\n        artworkManager: boardInfo?.artwork_manager || currentUser?.name || '',\n        productionManager: boardInfo?.production_manager || '',\n        productionQuantity: boardInfo?.production_quantity || (convertedBOMItems[0]?.totalQuantity && convertedBOMItems[0]?.setCount \n          ? Math.round(convertedBOMItems[0].totalQuantity / convertedBOMItems[0].setCount)\n          : 0)\n      };\n\n      // TOP/BOTTOM \n      const topCoords = convertedCoords.filter((c) => (c.layer || '').toUpperCase().includes('TOP'));\n      const bottomCoords = convertedCoords.filter((c) => (c.layer || '').toUpperCase().includes('BOT'));\n\n      //   ( >  >   )\n      const sortedBomItems = sortBOMItems(convertedBOMItems);\n      const sortedTopCoords = sortCoordinateItems(topCoords);\n      const sortedBottomCoords = sortCoordinateItems(bottomCoords);\n\n      const blob = await generateBOMExcelFromTemplate(\n        sortedBomItems,\n        sortedTopCoords,\n        sortedBottomCoords,\n        excelMetadata\n      );\n      \n      // : _YYMMDD_.xlsx (  )\n      const today = new Date();\n      const dateStr = today.getFullYear().toString().slice(2) + \n        String(today.getMonth() + 1).padStart(2, '0') + \n        String(today.getDate()).padStart(2, '0');\n      //  :    \n      const cleanName = boardName.trim()\n        .replace(/_\\d{6}_$/, '')\n        .replace(/_$/, '')\n        .replace(/_\\d{6}$/, '');\n      const fileName = `${cleanName}_${dateStr}_.xlsx`;\n      \n      downloadExcelBlob(blob, fileName);\n      \n      toast.success('  .');\n    } catch (error: any) {\n      console.error('Download error:', error);\n      toast.error(`   : ${error.message}`);\n    }\n  };\n\n\n  // (pending)       \n  const handleLoadPendingBoard = async (boardId: string) => {\n    try {\n      setLoading(true);\n      setLoadingText('  ...');\n\n      // 1.   \n      const { data: boardInfo, error: boardError } = await supabase\n        .from('cad_drawings')\n        .select('id, board_name, artwork_manager, production_manager, production_quantity, status')\n        .eq('id', boardId)\n        .single();\n      \n      if (boardError) throw boardError;\n\n      // 2. BOM  \n      const { data: bomItems, error: bomError } = await supabase\n        .from('bom_items')\n        .select('*')\n        .eq('cad_drawing_id', boardId)\n        .order('line_number');\n      \n      if (bomError) throw bomError;\n\n      // 3.   \n      const { data: coordinates, error: coordError } = await supabase\n        .from('part_placements')\n        .select('*')\n        .eq('cad_drawing_id', boardId);\n      \n      if (coordError) throw coordError;\n\n      // 4. BOMItem  \n      const convertedBOMItems: BOMItem[] = (bomItems || []).map((item: any) => {\n        const itemName = item.item_name || '';\n        const isDataMissing = itemName === ' ' || itemName.includes(' ');\n        return {\n        lineNumber: item.line_number,\n        itemType: item.item_type || '',\n          itemName: itemName,\n        specification: item.specification || '',\n        setCount: item.set_count,\n        totalQuantity: item.total_quantity || 0,\n        stockQuantity: item.stock_quantity || 0,\n        checkStatus: item.check_status || '',\n        refList: Array.isArray(item.ref_list) ? item.ref_list.join(',') : (item.ref_list || ''),\n        alternativeItem: item.alternative_item || '',\n          remark: item.remark || '',\n          isManualRequired: isDataMissing,\n          isNewPart: isDataMissing\n        };\n      });\n\n      // 5. CoordinateItem   (DB : ref,   ref: coord.refDes )\n      const convertedCoords: CoordinateItem[] = (coordinates || []).map((coord: any) => ({\n        type: coord.part_type || '',\n        partName: coord.part_name || '',\n        refDes: coord.ref || '',  // DB  'ref'\n        ref: coord.ref || '',     //   (  fallback )\n        layer: coord.side || '',\n        locationX: coord.x_coordinate || 0,\n        locationY: coord.y_coordinate || 0,\n        rotation: coord.angle || 0,\n        remark: coord.remark || ''\n      })) as any;\n\n      // 6.  \n      setMetadata({\n        boardName: boardInfo.board_name,\n        artworkManager: boardInfo.artwork_manager || '',\n        productionManager: boardInfo.production_manager || '',\n        productionQuantity: boardInfo.production_quantity || 0\n      });\n\n      console.log('Loaded coordinates:', convertedCoords.length, 'items');\n      console.log('Sample coord:', convertedCoords[0]);\n      \n      //    (DB    )\n      await clearTempData();\n      setSkipTempDataLoad(true); //    \n\n      setProcessedResult({\n        cadDrawingId: boardId, //    \n        isEditMode: true,      //    (pending  completed)\n        processedData: {\n          bomItems: convertedBOMItems,\n          coordinates: convertedCoords\n        }\n      });\n\n      setEditingBoardId(boardId); //    ID  ()\n\n      //  \n      setTimeout(() => {\n        setSkipTempDataLoad(false);\n      }, 500);\n      setViewMode('create');\n      setStep('preview');\n      \n      toast.success(' .    .');\n    } catch (error: any) {\n      console.error('Error loading pending board:', error);\n      toast.error(`  : ${error.message}`);\n    } finally {\n      setLoading(false);\n      setLoadingText('');\n    }\n  };\n\n  //  BOM  (app_admin    )\n  const handleDeleteSavedBOM = async (boardId: string, boardName: string) => {\n    const targetBoard = savedBoards.find(b => b.id === boardId);\n    if (!targetBoard || !canDeleteBoard(targetBoard)) {\n      toast.error('  .');\n      return;\n    }\n\n    //  \n    const confirmed = window.confirm(`\"${boardName}\" BOM ?\\n\\n  (BOM ,  ,   )  .`);\n    if (!confirmed) return;\n\n    try {\n      setDeletingBoardId(boardId);\n\n      // 1.    (   )\n      // bom_items \n      const { error: bomItemsError } = await supabase\n        .from('bom_items')\n        .delete()\n        .eq('cad_drawing_id', boardId);\n      \n      if (bomItemsError) {\n        console.warn('bom_items  :', bomItemsError);\n      }\n\n      // part_placements \n      const { error: placementsError } = await supabase\n        .from('part_placements')\n        .delete()\n        .eq('cad_drawing_id', boardId);\n      \n      if (placementsError) {\n        console.warn('part_placements  :', placementsError);\n      }\n\n      // bom_raw_files     \n      const { data: rawFilesData } = await supabase\n        .from('bom_raw_files')\n        .select('bom_file_url, coordinate_file_url')\n        .eq('cad_drawing_id', boardId);\n\n      // Storage   (URL  )\n      if (rawFilesData && rawFilesData.length > 0) {\n        for (const file of rawFilesData) {\n          // URL Storage   (: bom-files/uploads/xxx.xlsx)\n          try {\n            if (file.bom_file_url) {\n              const bomPath = file.bom_file_url.split('/bom-files/')[1]?.split('?')[0];\n              if (bomPath) {\n                await supabase.storage.from('bom-files').remove([decodeURIComponent(bomPath)]);\n              }\n            }\n            if (file.coordinate_file_url) {\n              const coordPath = file.coordinate_file_url.split('/bom-files/')[1]?.split('?')[0];\n              if (coordPath) {\n                await supabase.storage.from('bom-files').remove([decodeURIComponent(coordPath)]);\n              }\n            }\n          } catch (storageError) {\n            console.warn('Storage   :', storageError);\n          }\n        }\n      }\n\n      // bom_raw_files  \n      const { error: rawFilesError } = await supabase\n        .from('bom_raw_files')\n        .delete()\n        .eq('cad_drawing_id', boardId);\n      \n      if (rawFilesError) {\n        console.warn('bom_raw_files  :', rawFilesError);\n      }\n\n      // ai_learning_records     ()\n\n      // 2.  cad_drawings \n      const { error: cadError } = await supabase\n        .from('cad_drawings')\n        .delete()\n        .eq('id', boardId);\n\n      if (cadError) throw cadError;\n\n      // 3.   \n      setSavedBoards(prev => prev.filter(board => board.id !== boardId));\n      \n      toast.success(`\"${boardName}\" BOM .`);\n    } catch (error: any) {\n      console.error('Delete error:', error);\n      toast.error(`   : ${error.message}`);\n    } finally {\n      setDeletingBoardId(null);\n    }\n  };\n\n  return (\n    <div className=\"w-full\">\n      {/* Header */}\n      <div className=\"mb-4\">\n        <div>\n          <h1 className=\"page-title\">BOM/ </h1>\n          <div className=\"flex justify-between items-center\" style={{marginTop:'-2px',marginBottom:'-4px'}}>\n            <p className=\"page-subtitle mb-0\">BOM & Coordinate Management</p>\n            <div className=\"flex gap-2\">\n              <Button\n                onClick={async () => {\n                  //    \n                  await clearTempData();\n                  //      \n                  setSkipTempDataLoad(true);\n                  //   \n                  handleReset();\n                  setEditingBoardId(null); //    ID \n                  setViewMode('create');\n                  setStep('input');\n                  //      (    )\n                  setTimeout(() => {\n                    setSkipTempDataLoad(false);\n                  }, 1000);\n                }}\n                className={`button-base ${\n                  viewMode === 'create' \n                    ? 'bg-hansl-600 hover:bg-hansl-700 text-white' \n                    : 'border border-gray-300 bg-white text-gray-700 hover:bg-gray-50'\n                }`}\n              >\n                <Plus className=\"w-4 h-4 mr-2\" />\n                 \n              </Button>\n              <Button\n                onClick={() => {\n                  setViewMode('list');\n                  setStep('input');\n                }}\n                className={`button-base ${\n                  viewMode === 'list' \n                    ? 'bg-hansl-600 hover:bg-hansl-700 text-white' \n                    : 'border border-gray-300 bg-white text-gray-700 hover:bg-gray-50'\n                }`}\n              >\n                <Eye className=\"w-4 h-4 mr-2\" />\n                 BOM/ \n              </Button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/*  BOM  */}\n      {viewMode === 'list' && (\n        <div className=\"space-y-4\">\n          <Card>\n            <CardContent className=\"p-4 sm:p-6\">\n              {loadingBoards ? (\n                <div className=\"flex items-center justify-center py-12\">\n                  <Loader2 className=\"w-6 h-6 text-hansl-600 animate-spin mr-2\" />\n                  <span className=\"text-sm text-gray-600\">  ...</span>\n                </div>\n              ) : savedBoards.length === 0 ? (\n                <div className=\"text-center py-12\">\n                  <Package className=\"w-12 h-12 mx-auto mb-3 text-gray-300\" />\n                  <p className=\"text-sm text-gray-500 mb-4\"> BOM .</p>\n                  <Button\n                    onClick={() => setViewMode('create')}\n                    className=\"button-base bg-hansl-600 hover:bg-hansl-700 text-white\"\n                  >\n                    <Plus className=\"w-4 h-4 mr-2\" />\n                     BOM \n                  </Button>\n                </div>\n              ) : (\n                <div className=\"space-y-3\">\n                  <div className=\"flex justify-between items-center mb-4\">\n                    <div>\n                      <h3 className=\"page-title\"> BOM/ </h3>\n                      <p className=\"page-subtitle\">      .</p>\n                  </div>\n                  </div>\n                  <div className=\"border rounded-lg overflow-hidden bg-white shadow-sm\">\n                    <div className=\"overflow-x-auto\">\n                      <Table className=\"table-auto\">\n                        <TableHeader className=\"bg-gray-50 sticky top-0 z-10\">\n                          <TableRow className=\"h-6\">\n                            <TableHead className=\"w-[50px] text-center !py-1 !h-auto\">\n                              <span className=\"card-description\">No</span>\n                            </TableHead>\n                            <TableHead className=\"min-w-[200px] !py-1 !h-auto\">\n                              <span className=\"card-description\"></span>\n                            </TableHead>\n                            <TableHead className=\"w-[100px] text-center !py-1 !h-auto\">\n                              <span className=\"card-description\"> </span>\n                            </TableHead>\n                            <TableHead className=\"w-[100px] text-center !py-1 !h-auto\">\n                              <span className=\"card-description\"> </span>\n                            </TableHead>\n                            <TableHead className=\"w-[80px] text-center !py-1 !h-auto\">\n                              <span className=\"card-description\"></span>\n                            </TableHead>\n                            <TableHead className=\"w-[100px] text-center !py-1 !h-auto\">\n                              <span className=\"card-description\"></span>\n                            </TableHead>\n                            <TableHead className=\"w-[120px] text-center !py-1 !h-auto\">\n                              <span className=\"card-description\"></span>\n                            </TableHead>\n                          </TableRow>\n                        </TableHeader>\n                        <TableBody>\n                          {savedBoards.map((board, index) => (\n                            <TableRow \n                              key={board.id} \n                              className=\"hover:bg-gray-50 cursor-pointer\"\n                              onClick={() => {\n                                if (board.status === 'pending') {\n                                  //      \n                                  handleLoadPendingBoard(board.id);\n                                } else {\n                                  //      \n                                  setDetailModalBoardId(board.id);\n                                  setIsDetailModalOpen(true);\n                                }\n                              }}\n                            >\n                              <TableCell className=\"text-center py-1\">\n                                <span className=\"card-subtitle\">{index + 1}</span>\n                              </TableCell>\n                              <TableCell className=\"py-1\">\n                                <span className=\"text-[11px] font-medium text-gray-900\">{board.board_name}</span>\n                              </TableCell>\n                              <TableCell className=\"text-center py-1\">\n                                <span className=\"text-[10px] text-gray-600\">{board.artwork_manager || '-'}</span>\n                              </TableCell>\n                              <TableCell className=\"text-center py-1\">\n                                <span className=\"text-[10px] text-gray-600\">{board.production_manager || '-'}</span>\n                              </TableCell>\n                              <TableCell className=\"text-center py-1\">\n                                {board.status === 'pending' ? (\n                                  <Badge className=\"bg-yellow-100 text-yellow-800 hover:bg-yellow-100 text-[9px] px-1.5 py-0.5\"></Badge>\n                                ) : (\n                                  <Badge className=\"bg-green-100 text-green-800 hover:bg-green-100 text-[9px] px-1.5 py-0.5\"></Badge>\n                                )}\n                              </TableCell>\n                              <TableCell className=\"text-center py-1\">\n                                <span className=\"text-[10px] text-gray-500\">\n                                {new Date(board.created_at).toLocaleDateString('ko-KR', {\n                                  year: 'numeric',\n                                  month: '2-digit',\n                                  day: '2-digit'\n                                })}\n                                </span>\n                              </TableCell>\n                              <TableCell className=\"text-center py-1\" onClick={(e) => e.stopPropagation()}>\n                                <div className=\"flex gap-1 justify-center\">\n                            <Button\n                                    onClick={() => handleDownloadSavedBOM(board.id, board.board_name)}\n                              variant=\"outline\"\n                              size=\"sm\"\n                                    className=\"h-6 px-2 text-[10px] text-green-600 hover:text-green-700 hover:bg-green-50 border-green-200\"\n                            >\n                                    <Download className=\"w-3 h-3 mr-1\" />\n                                    Excel\n                            </Button>\n                                  {canDeleteBoard(board) && (\n                            <Button\n                                      onClick={() => handleDeleteSavedBOM(board.id, board.board_name)}\n                              variant=\"outline\"\n                              size=\"sm\"\n                                      disabled={deletingBoardId === board.id}\n                                      className=\"h-6 px-2 text-[10px] text-red-600 hover:text-red-700 hover:bg-red-50 border-red-200\"\n                            >\n                                      {deletingBoardId === board.id ? (\n                                        <Loader2 className=\"w-3 h-3 animate-spin\" />\n                                      ) : (\n                                        <Trash2 className=\"w-3 h-3\" />\n                                      )}\n                            </Button>\n                                  )}\n                          </div>\n                              </TableCell>\n                            </TableRow>\n                    ))}\n                        </TableBody>\n                        <tfoot className=\"bg-gray-50 border-t\">\n                          <tr>\n                            <td colSpan={7} className=\"py-2 px-4\">\n                              <span className=\"card-description\"> {savedBoards.length} </span>\n                            </td>\n                          </tr>\n                        </tfoot>\n                      </Table>\n                    </div>\n                  </div>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n      )}\n\n      {/*   /  */}\n      {viewMode === 'create' && (\n        <>\n      {/*   */}\n      {step === 'input' && (\n        <div className=\"space-y-4\">\n          {errorMessage && (\n            <div className=\"bg-red-50 border border-red-200 text-red-700 px-6 py-4 rounded-lg text-sm flex flex-col gap-2 shadow-sm animate-in fade-in slide-in-from-top-2\">\n              <div className=\"flex items-center gap-2 font-semibold\">\n                <AlertCircle className=\"w-5 h-5 flex-shrink-0 text-red-600\" />\n                <span> </span>\n              </div>\n              <p className=\"pl-7\">{errorMessage}</p>\n              {errorMessage.includes('quota') && (\n                <p className=\"pl-7 text-xs text-red-600 mt-1\">\n                  * OpenAI     10~20   .    .\n                </p>\n              )}\n            </div>\n          )}\n          \n          {/*    */}\n          <Card>\n            <CardContent className=\"py-4\">\n              <div className=\"flex flex-col lg:flex-row gap-4 lg:gap-6 items-stretch\">\n                {/* :   (50%) */}\n                <div className=\"w-full lg:w-[50%] grid grid-cols-1 sm:grid-cols-2 gap-3\">\n                  {/* BOM   */}\n                  <div \n                    className={cn(\n                      \"border-2 border-dashed rounded-lg p-2 text-center transition-colors cursor-pointer relative flex flex-col items-center justify-center h-full\",\n                      dragActive === 'bom' ? \"border-primary bg-primary/5\" : \"border-gray-200 hover:border-gray-300\",\n                      fileInfo.bomFile ? \"bg-green-50 border-green-200\" : \"\"\n                    )}\n                    onDragEnter={(e) => handleDrag(e, 'bom')}\n                    onDragLeave={(e) => handleDrag(e, 'bom')}\n                    onDragOver={(e) => handleDrag(e, 'bom')}\n                    onDrop={(e) => handleDrop(e, 'bom')}\n                    onClick={() => document.getElementById('bom-upload')?.click()}\n                  >\n                    <input \n                      id=\"bom-upload\" \n                      type=\"file\" \n                      className=\"hidden\" \n                      accept=\".xlsx,.xls\" \n                      onChange={(e) => handleFileSelect(e, 'bom')}\n                    />\n                    \n                    {fileInfo.bomFile ? (\n                      <div className=\"flex flex-col items-center gap-1 w-full px-1\">\n                        <span className=\"text-xs font-bold text-green-600\">BOM</span>\n                        <p className=\"text-[10px] font-medium text-green-700 w-full text-center break-all line-clamp-2\" title={fileInfo.bomFile.name}>\n                          {fileInfo.bomFile.name}\n                        </p>\n                        <Button \n                          variant=\"ghost\" \n                          size=\"sm\" \n                          className=\"absolute top-1 right-1 p-0 w-4 h-4 min-w-0\"\n                          onClick={(e) => { e.stopPropagation(); handleRemoveFile('bom'); }}\n                        >\n                          <X size={12} />\n                        </Button>\n                      </div>\n                    ) : (\n                      <div className=\"flex flex-col items-center gap-1\">\n                        <span className=\"text-xs font-bold text-gray-400\">BOM</span>\n                        <p className=\"text-[10px] font-medium text-gray-700\"> </p>\n                      </div>\n                    )}\n                  </div>\n\n                  {/*    () */}\n                  <div \n                    className={cn(\n                      \"border-2 border-dashed rounded-lg p-2 text-center transition-colors cursor-pointer relative flex flex-col items-center justify-center h-full\",\n                      dragActive === 'coord' ? \"border-primary bg-primary/5\" : \"border-gray-200 hover:border-gray-300\",\n                      fileInfo.coordFile ? \"bg-blue-50 border-blue-200\" : \"\"\n                    )}\n                    onDragEnter={(e) => handleDrag(e, 'coord')}\n                    onDragLeave={(e) => handleDrag(e, 'coord')}\n                    onDragOver={(e) => handleDrag(e, 'coord')}\n                    onDrop={(e) => handleDrop(e, 'coord')}\n                    onClick={() => document.getElementById('coord-upload')?.click()}\n                  >\n                    <input \n                      id=\"coord-upload\" \n                      type=\"file\" \n                      className=\"hidden\" \n                      accept=\".xlsx,.xls,.txt,.csv\" \n                      onChange={(e) => handleFileSelect(e, 'coord')}\n                    />\n                    \n                    {fileInfo.coordFile ? (\n                      <div className=\"flex flex-col items-center gap-1 w-full px-1\">\n                        <span className=\"text-xs font-bold text-blue-600\"></span>\n                        <p className=\"text-[10px] font-medium text-blue-700 w-full text-center break-all line-clamp-2\" title={fileInfo.coordFile.name}>\n                          {fileInfo.coordFile.name}\n                        </p>\n                        <Button \n                          variant=\"ghost\" \n                          size=\"sm\" \n                          className=\"absolute top-1 right-1 p-0 w-4 h-4 min-w-0\"\n                          onClick={(e) => { e.stopPropagation(); handleRemoveFile('coord'); }}\n                        >\n                          <X size={12} />\n                        </Button>\n                      </div>\n                    ) : (\n                      <div className=\"flex flex-col items-center gap-1\">\n                        <span className=\"text-xs font-bold text-gray-400\">()</span>\n                        <p className=\"text-[10px] font-medium text-gray-700\"> </p>\n                      </div>\n                    )}\n                  </div>\n                </div>\n\n                {/* :   (50%) */}\n                <div className=\"w-full lg:w-[50%] space-y-1\">\n                  {/* 1.   ( ) */}\n                  <div className=\"space-y-1 mb-3.5\">\n                    <Label className=\"text-[10px] text-gray-500\">  ()</Label>\n                    <Input\n                      value={metadata.boardName || 'BOM    '}\n                      disabled\n                      className=\"w-full bg-gray-50 border border-[#d2d2d7] rounded-md text-xs shadow-sm\"\n                      style={{ height: '32px' }}\n                    />\n                  </div>\n\n                  {/* 2. Artwork ,  ,  ,   ( ) */}\n                  <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-2\">\n                    {/* Artwork  */}\n                    <div className=\"space-y-1\">\n                      <Label className=\"text-[10px] text-gray-500\">Artwork  <span className=\"text-red-500\">*</span></Label>\n                      <Popover open={openArtworkManager} onOpenChange={setOpenArtworkManager}>\n                        <PopoverTrigger asChild>\n                          <Button\n                            variant=\"outline\"\n                            role=\"combobox\"\n                            aria-expanded={openArtworkManager}\n                            className=\"w-full justify-between text-xs h-8 min-h-[32px] px-2 bg-white border-[#d2d2d7] shadow-sm hover:bg-gray-50\"\n                          >\n                            {metadata.artworkManager\n                              ? employees.find((emp) => emp.id === metadata.artworkManager)?.name || metadata.artworkManager\n                              : currentUser?.name || \" \"}\n                            <ChevronsUpDown className=\"ml-2 h-3 w-3 shrink-0 opacity-50\" />\n                          </Button>\n                        </PopoverTrigger>\n                        <PopoverContent className=\"w-[200px] p-0\">\n                          <Command>\n                            <CommandInput placeholder=\" ...\" className=\"h-8 text-xs\" />\n                            <CommandList>\n                              <CommandEmpty>  </CommandEmpty>\n                              <CommandGroup>\n                                {employees.map((emp) => (\n                                  <CommandItem\n                                    key={emp.id}\n                                    value={emp.name}\n                                    onSelect={() => {\n                                      setMetadata(prev => ({ ...prev, artworkManager: emp.id }));\n                                      setOpenArtworkManager(false);\n                                    }}\n                                    className=\"text-xs\"\n                                  >\n                                    <Check\n                                      className={cn(\n                                        \"mr-2 h-3 w-3\",\n                                        metadata.artworkManager === emp.id ? \"opacity-100\" : \"opacity-0\"\n                                      )}\n                                    />\n                                    {emp.name}\n                                  </CommandItem>\n                                ))}\n                              </CommandGroup>\n                            </CommandList>\n                          </Command>\n                        </PopoverContent>\n                      </Popover>\n                    </div>\n\n                    {/*   (    ) */}\n                    <div className=\"space-y-1\">\n                      <Label className=\"text-[10px] text-gray-400\"> </Label>\n                      <Popover open={openProductionManager} onOpenChange={setOpenProductionManager}>\n                        <PopoverTrigger asChild>\n                          <Button\n                            variant=\"outline\"\n                            role=\"combobox\"\n                            aria-expanded={openProductionManager}\n                            disabled={true}\n                            className=\"w-full justify-between text-xs h-8 min-h-[32px] px-2 bg-gray-100 border-[#d2d2d7] shadow-sm cursor-not-allowed text-gray-400\"\n                          >\n                            {metadata.productionManager\n                              ? employees.find((emp) => emp.id === metadata.productionManager)?.name\n                              : \"    \"}\n                            <ChevronsUpDown className=\"ml-2 h-3 w-3 shrink-0 opacity-50\" />\n                          </Button>\n                        </PopoverTrigger>\n                        <PopoverContent className=\"w-[200px] p-0\">\n                          <Command>\n                            <CommandInput placeholder=\" ...\" className=\"h-8 text-xs\" />\n                            <CommandList>\n                              <CommandEmpty>  </CommandEmpty>\n                              <CommandGroup>\n                                {employees.map((emp) => (\n                                  <CommandItem\n                                    key={emp.id}\n                                    value={emp.name}\n                                    onSelect={() => {\n                                      setMetadata(prev => ({ ...prev, productionManager: emp.id }));\n                                      setOpenProductionManager(false);\n                                    }}\n                                    className=\"text-xs\"\n                                  >\n                                    <Check\n                                      className={cn(\n                                        \"mr-2 h-3 w-3\",\n                                        metadata.productionManager === emp.id ? \"opacity-100\" : \"opacity-0\"\n                                      )}\n                                    />\n                                    {emp.name}\n                                  </CommandItem>\n                                ))}\n                              </CommandGroup>\n                            </CommandList>\n                          </Command>\n                        </PopoverContent>\n                      </Popover>\n                    </div>\n\n                    {/*   */}\n                    <div className=\"space-y-1\">\n                      <Label className=\"text-[10px] text-gray-500\">  <span className=\"text-red-500\">*</span></Label>\n                      <div className=\"relative\">\n                        <Input\n                          type=\"number\"\n                          min=\"0\"\n                          value={metadata.productionQuantity === 0 ? '' : metadata.productionQuantity}\n                          onChange={(e) => setMetadata(prev => ({ ...prev, productionQuantity: parseInt(e.target.value) || 0 }))}\n                          className=\"w-full bg-white border border-[#d2d2d7] rounded-md text-xs shadow-sm hover:shadow-md transition-shadow duration-200 pr-8\"\n                          style={{ height: '32px' }}\n                          placeholder=\"0\"\n                        />\n                        <span className=\"absolute right-2.5 top-1/2 -translate-y-1/2 text-[10px] text-gray-500 font-medium pointer-events-none\">SET</span>\n                      </div>\n                    </div>\n\n                    {/*   */}\n                    <div className=\"flex items-end\">\n                      <Button \n                        onClick={handleProcess}\n                        disabled={\n                          !fileInfo.bomFile || \n                          !metadata.boardName || \n                          metadata.productionQuantity <= 0 ||\n                          uploading\n                        }\n                        className=\"w-full bg-hansl-500 hover:bg-hansl-600 text-white shadow-sm text-xs disabled:bg-gray-300 disabled:cursor-not-allowed\"\n                        style={{ height: '32px' }}\n                      >\n                          \n                      </Button>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/*   */}\n          {!fileInfo.bomFile && !fileInfo.coordFile && (\n            <div className=\"text-center py-6 sm:py-8 text-gray-500\">\n              <Package className=\"w-10 h-10 sm:w-12 sm:h-12 mx-auto mb-3 text-gray-300\" />\n              <p className=\"text-xs sm:text-sm px-4\">BOM    (  )</p>\n            </div>\n          )}\n        </div>\n      )}\n\n      {/*   */}\n      {step === 'processing' && (\n        <Card>\n          <CardContent className=\"py-12 sm:py-16 lg:py-20\">\n            <div className=\"flex flex-col items-center justify-center max-w-md mx-auto\">\n              <Loader2 className=\"w-8 h-8 sm:w-10 sm:h-10 text-hansl-600 animate-spin mb-6\" />\n              <h3 className=\"text-base sm:text-lg lg:text-xl font-semibold text-center mb-2\">{loadingText || 'AI BOM  '}</h3>\n              <p className=\"text-xs sm:text-sm text-gray-600 mb-6 text-center px-4\"> ... ( 30 ~ 1 )</p>\n              \n              <div className=\"w-full px-4\">\n                <Progress value={progress} className=\"h-2\" />\n                <p className=\"text-right text-xs text-gray-500 mt-1\">{Math.round(progress)}%</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/*   */}\n      {step === 'preview' && processedResult && (\n        <div className=\"space-y-4\">\n          <Card>\n            <CardContent className=\"p-4 sm:p-6 w-full max-w-full overflow-hidden\">\n              {/*  /  +  */}\n              <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-end gap-3 mb-4\">\n                  <div>\n                  <h3 className=\"page-title\">  <span className=\"text-xs font-medium text-gray-500 ml-3\">{(metadata.boardName || '').trim().replace(/_\\d{6}_$/, '').replace(/_$/, '').replace(/_\\d{6}$/, '')}</span></h3>\n                  <p className=\"page-subtitle\">     .</p>\n                  </div>\n                <div className=\"flex gap-2\">\n                <Button \n                    onClick={() => previewPanelRef.current?.handleMerge()}\n                    disabled={!hasMergeableItems && !isMerged}\n                    className={`button-base border ${\n                      !hasMergeableItems && !isMerged\n                        ? 'border-gray-200 bg-gray-100 text-gray-400 cursor-not-allowed'\n                        : isMerged \n                          ? 'border-orange-300 bg-orange-50 text-orange-700 hover:bg-orange-100' \n                          : 'border-gray-300 bg-white text-gray-700 hover:bg-gray-50'\n                    }`}\n                  >\n                    <Link2 className=\"w-4 h-4 mr-2\" />\n                    {isMerged ? ' ' : '  '}\n                  </Button>\n                  <Button \n                    onClick={() => previewPanelRef.current?.handleReset()}\n                    className=\"button-base border border-gray-300 bg-white text-gray-700 hover:bg-gray-50\"\n                  >\n                    <RotateCcw className=\"w-4 h-4 mr-2\" />\n                    \n                  </Button>\n                  <Button \n                    onClick={() => previewPanelRef.current?.handleSave()}\n                    disabled={isSaving}\n                    className={`button-base text-white ${\n                      processedResult?.isEditMode \n                        ? 'bg-green-600 hover:bg-green-700' \n                        : 'bg-hansl-500 hover:bg-hansl-600'\n                    }`}\n                  >\n                    {isSaving ? (\n                      <>\n                        <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                        {processedResult?.isEditMode ? ' ...' : ' ...'}\n                      </>\n                    ) : (\n                      <>\n                        {processedResult?.isEditMode ? (\n                          <>\n                            <Check className=\"w-4 h-4 mr-2\" />\n                             \n                          </>\n                        ) : (\n                          <>\n                            <Save className=\"w-4 h-4 mr-2\" />\n                             \n                          </>\n                        )}\n                      </>\n                    )}\n                  </Button>\n                  <Button \n                    onClick={() => previewPanelRef.current?.handleDownload()}\n                    className=\"button-base bg-green-500 hover:bg-green-600 text-white\"\n                >\n                    <Download className=\"w-4 h-4 mr-2\" />\n                    Excel\n                </Button>\n              </div>\n              </div>\n\n              {/*  */}\n              <Tabs defaultValue=\"bom\" className=\"w-full max-w-full\">\n                <TabsList className=\"flex space-x-1 bg-gray-50 p-1 business-radius-card border border-gray-200 mb-4 w-full\">\n                  <TabsTrigger \n                    value=\"bom\" \n                    className=\"flex-1 flex items-center justify-center space-x-2 py-1.5 px-3 sm:px-4 business-radius-button !text-xs font-medium transition-colors data-[state=active]:text-hansl-600 data-[state=active]:bg-white data-[state=active]:shadow-sm data-[state=active]:border data-[state=active]:border-gray-200 data-[state=inactive]:text-gray-600 data-[state=inactive]:bg-transparent data-[state=inactive]:hover:text-gray-900 data-[state=inactive]:hover:bg-white/50\"\n                  >\n                    <span className=\"whitespace-nowrap\"> BOM</span>\n                    <span className=\"badge-stats data-[state=active]:bg-hansl-50 data-[state=active]:text-hansl-700 bg-gray-100 text-gray-600\">\n                      {(processedResult.processedData?.bomItems ?? []).reduce(\n                        (sum: number, item: BOMItem) => sum + (item.setCount || 0),\n                        0\n                      )}\n                    </span>\n                    {(processedResult.processedData?.bomItems?.filter((item: { isManualRequired?: boolean }) => item.isManualRequired).length ?? 0) > 0 && (\n                      <span className=\"badge-stats bg-yellow-100 text-yellow-700 border border-yellow-300\">\n                          : {processedResult.processedData?.bomItems?.filter((item: { isManualRequired?: boolean }) => item.isManualRequired).length}\n                      </span>\n                    )}\n                    {processedResult?.processedData?.coordinatesProvided !== false && mismatchCount > 0 && (\n                      <span className=\"badge-stats bg-red-100 text-red-700 border border-red-200\">\n                        REF : {mismatchCount}\n                      </span>\n                    )}\n                    {processedResult?.processedData?.coordinatesProvided !== false && missingInCoord > 0 && (\n                      <span className=\"badge-stats bg-red-100 text-red-700 border border-red-200\">\n                         : {missingInCoord}\n                      </span>\n                    )}\n                  </TabsTrigger>\n                  <TabsTrigger \n                    value=\"coord\" \n                    className=\"flex-1 flex items-center justify-center space-x-2 py-1.5 px-3 sm:px-4 business-radius-button !text-xs font-medium transition-colors data-[state=active]:text-hansl-600 data-[state=active]:bg-white data-[state=active]:shadow-sm data-[state=active]:border data-[state=active]:border-gray-200 data-[state=inactive]:text-gray-600 data-[state=inactive]:bg-transparent data-[state=inactive]:hover:text-gray-900 data-[state=inactive]:hover:bg-white/50\"\n                  >\n                    <span className=\"whitespace-nowrap\"> </span>\n                    <span className=\"badge-stats data-[state=active]:bg-hansl-50 data-[state=active]:text-hansl-700 bg-gray-100 text-gray-600\">\n                      {processedResult.processedData?.coordinates?.filter((c: CoordinateItem) => c.layer === 'TOP').length || 0}\n                    </span>\n                    <span className=\"badge-stats data-[state=active]:bg-orange-50 data-[state=active]:text-orange-700 bg-gray-100 text-gray-600\">\n                      {processedResult.processedData?.coordinates?.filter((c: CoordinateItem) => c.layer === 'BOTTOM').length || 0}\n                    </span>\n                    {(processedResult.processedData?.bomItems?.filter((item: { isManualRequired?: boolean }) => item.isManualRequired).length ?? 0) > 0 && (\n                      <span className=\"badge-stats bg-yellow-100 text-yellow-700 border border-yellow-300\">\n                          : {processedResult.processedData?.bomItems?.filter((item: { isManualRequired?: boolean }) => item.isManualRequired).length}\n                      </span>\n                    )}\n                    {processedResult?.processedData?.coordinatesProvided !== false && missingInBom > 0 && (\n                      <span className=\"badge-stats bg-red-100 text-red-700 border border-red-200\">\n                        BOM : {missingInBom}\n                      </span>\n                    )}\n                  </TabsTrigger>\n                </TabsList>\n\n                <TabsContent value=\"bom\" forceMount className=\"mt-0 w-full max-w-full overflow-hidden\">\n              <GeneratedPreviewPanel \n                    ref={previewPanelRef}\n                bomItems={processedResult.processedData?.bomItems || []}\n                coordinates={processedResult.processedData?.coordinates || []}\n                    coordinatesProvided={processedResult?.processedData?.coordinatesProvided !== false}\n                boardName={metadata.boardName || 'Board'}\n                productionQuantity={metadata.productionQuantity}\n                    artworkManager={employees.find(emp => emp.id === metadata.artworkManager)?.name || currentUser?.name || ''}\n                    productionManager={employees.find(emp => emp.id === metadata.productionManager)?.name || ''}\n                onSave={handleSaveBOM}\n                    onMergeStateChange={setIsMerged}\n                    onBomChange={handleBomChange}\n                    onDeleteRefs={handleDeleteRefs}\n              />\n                </TabsContent>\n\n                <TabsContent value=\"coord\" forceMount className=\"mt-0 w-full max-w-full overflow-hidden\">\n              <CoordinatePreviewPanel \n                coordinates={processedResult.processedData?.coordinates || []}\n                    bomItems={processedResult.processedData?.bomItems || []}\n                    onCoordinatesChange={handleCoordinatesChange}\n                    onDeleteRef={handleDeleteRef}\n              />\n                </TabsContent>\n              </Tabs>\n            </CardContent>\n          </Card>\n        </div>\n      )}\n        </>\n      )}\n\n      {/* BOM   */}\n      <BomDetailModal\n        boardId={detailModalBoardId}\n        isOpen={isDetailModalOpen}\n        onClose={() => {\n          setIsDetailModalOpen(false);\n          setDetailModalBoardId(null);\n        }}\n      />\n    </div>\n  );\n}"],"file":"assets/BomCoordinateIntegrated-DvebrBGC.js"}